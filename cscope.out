cscope 15 O:\tool\dvs50"               0002450939
	@O:\tool\dvs50\app\app_procs.c

19 
	~<c⁄fig.h
>

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<î∫o.h
>

25 
	~<°rög.h
>

26 
	~<sig«l.h
>

27 
	~<loˇÀ.h
>

28 #ifde‡
HAVE_UNISTD_H


29 
	~<uni°d.h
>

33 #ifde‡
HAVE_LIBPNG


34 
	~<≤g.h
>

37 #ifde‡
GNOME


38 #unde‡
GTK_DISABLE_DEPRECATED


40 
	~<gnome.h
>

43 
	~<gtk/gtk.h
>

44 
	~<gmoduÀ.h
>

46 #ifde‡
HAVE_FREETYPE


47 
	~<∑ngo/∑ngo·2.h
>

50 
	~<libxml/∑r£r.h
>

51 
	~<libxml/xmÀº‹.h
>

53 
	~<glib/g°dio.h
>

55 
	~"öé.h
"

56 
	~"≠p_¥ocs.h
"

57 
	~"obje˘.h
"

58 
	~"comm™ds.h
"

59 
	~"toﬁ.h
"

60 
	~"öãrÁ˚.h
"

61 
	~"modify_toﬁ.h
"

62 
	~"group.h
"

63 
	~"mesßge.h
"

64 
	~"di•œy.h
"

65 
	~"œyî_dülog.h
"

66 
	~"lﬂd_ßve.h
"

67 
	~"¥e„ªn˚s.h
"

68 
	~"dü_dús.h
"

69 
	~"shìt.h
"

70 
	~"∂ug-ös.h
"

71 
	~"ª˚¡_fûes.h
"

72 
	~"auth‹s.h
"

73 
	~"autoßve.h
"

74 
	~"dy«mic_ª‰esh.h
"

75 
	~"≥rsi°í˚.h
"

76 
	~"shìts.h
"

77 
	~"exô_dülog.h
"

78 
	~"√wgroup.h
"

79 
	~"dülib.h
"

80 
	~"düîr‹.h
"

82 
gboﬁón


83 
h™dÀ_öôül_dügøm
(c⁄° *
öput_fûe_«me
,

84 c⁄° *
exp‹t_fûe_«me
,

85 c⁄° *
exp‹t_fûe_f‹m©
,

86 c⁄° *
size
,

87 *
show_œyîs
,

88 c⁄° *
outdú
);

90 
¸óã_u£r_dús
();

91 
PlugöInôResu…
 
öã∫Æ_∂ugö_öô
(
PlugöInfo
 *
öfo
);

92 
gboﬁón
 
h™dÀ_Æl_dügøms
(
GSLi°
 *
fûes
, *
exp‹t_fûe_«me
,

93 *
exp‹t_fûe_f‹m©
, *
size
, *
show_œyîs
,

94 c⁄° 
gch¨
 *
öput_dúe˘‹y
, c⁄° gch¨ *
ouçut_dúe˘‹y
);

95 
¥öt_¸edôs
(
gboﬁón
 
¸edôs
);

97 
gboﬁón
 
	gdü_is_öãø˘ive
 = 
FALSE
;

99 #ifde‡
GNOME


102 
	$£ssi⁄_dõ
 (
gpoöãr
 
˛õ¡_d©a
)

104 
	`gtk_maö_quô
 ();

105 
	}
}

108 
	$ßve_°©e
 (
GnomeClõ¡
 *
˛õ¡
,

109 
göt
 
pha£
,

110 
GnomeRe°¨tStyÀ
 
ßve_°yÀ
,

111 
göt
 
shutdown
,

112 
GnomeI¡îa˘StyÀ
 
öãø˘_°yÀ
,

113 
göt
 
Á°
,

114 
gpoöãr
 
˛õ¡_d©a
)

116 
gch¨
 *
¨gv
[20];

117 
göt
 
i
 = 0;

118 
GLi°
 *
l
;

119 
Dügøm
 *
dü
;

121 
¨gv
[
i
++] = "dia";

123 
l
 = 
	`dü_›í_dügøms
();Ü !
NULL
;Ü = 
	`g_li°_√xt
(l)) {

124 
dü
 = (
Dügøm
 *)
l
->
d©a
;

125 if(!
dü
->
unßved
) {

126 
¨gv
[
i
++] = 
dü
->
fûíame
;

130 
	`gnome_˛õ¡_£t_ª°¨t_comm™d
 (
˛õ¡
, 
i
, 
¨gv
);

131 
	`gnome_˛õ¡_£t_˛⁄e_comm™d
 (
˛õ¡
, 
i
, 
¨gv
);

133  
TRUE
;

134 
	}
}

138 
	$buûd_ouçut_fûe_«me
(c⁄° *
ö‚ame
, c⁄° *
f‹m©
, c⁄° *
outdú
)

140 c⁄° *
≥
 = 
	`°ºchr
(
ö‚ame
,'.');

141 c⁄° *
µ
 = 
	`°ºchr
(
ö‚ame
,
G_DIR_SEPARATOR
);

142 *
tmp
;

143 i‡(!
µ
)

144 
µ
 = 
ö‚ame
;

146 
µ
 += 1;

147 i‡(!
≥
)

148  
	`g_°rc⁄ˇt
(
outdú
 ? outdú : "", 
µ
,".",
f‹m©
,
NULL
);

150 
tmp
 = 
	`g_mÆloc0
(
	`°æí
(
µ
)+1+°æí(
f‹m©
)+1);

151 
	`mem˝y
(
tmp
,
µ
,
≥
-pp);

152 
	`°rˇt
(
tmp
,".");

153 
	`°rˇt
(
tmp
,
f‹m©
);

154 i‡(
outdú
) {

155 *
ªt
 = 
	`g_°rc⁄ˇt
(
outdú
, 
G_DIR_SEPARATOR_S
, 
tmp
, 
NULL
);

156 
	`g_‰ì
(
tmp
);

157  
ªt
;

159  
tmp
;

160 
	}
}

170 
	$show_œyîs_∑r£_numbîs
(
DügømD©a
 *
dügd©a
, 
gboﬁón
 *
visibÀ_œyîs
, 
göt
 
n_œyîs
, c⁄° *
°r
)

172 *
p
;

173 
low
 = 0;

174 
high
 = 
n_œyîs
;

175 
i
;

177 i‡(
°r
 =
NULL
)

181 i‡(*
°r
 == '-') {

182 
°r
++;

183 
low
 = 0;

184 
high
 = 
	`°πoul
(
°r
, &
p
, 10)+1;

186 
	`g_as£π
(
p
 !
°r
);

190 
low
 = 
	`°πoul
(
°r
, &
p
, 10);

191 
high
 = 
low
+1;

192 
	`g_as£π
(
p
 !
°r
);

193 i‡(*
p
 == '-')

196 
°r
 = 
p
 + 1;

197 i‡(*
°r
 == '\0')

198 
high
 = 
n_œyîs
;

201 
high
 = 
	`°πoul
(
°r
, &
p
, 10)+1;

202 
	`g_as£π
(
p
 !
°r
);

207 i‡–
high
 <
low
 ) {

209 
	`g_¥öt
(
	`_
("W¨nög: invÆidÜayîÑ™gê%lu - %lu\n"), 
low
, 
high
-1 );

212 i‡(
high
 > 
n_œyîs
)

213 
high
 = 
n_œyîs
;

216  
i
 = 
low
; i < 
high
; i++ )

218 
Layî
 *
œy
 = (Layî *)
	`g_±r_¨øy_ödex
(
dügd©a
->
œyîs
, 
i
);

220 i‡(
visibÀ_œyîs
[
i
] =
TRUE
)

221 
	`g_¥öt
(
	`_
("W¨nög: Layî %lu (%sË£À˘ed m‹êth™ on˚.\n"), 
i
, 
œy
->
«me
);

222 
visibÀ_œyîs
[
i
] = 
TRUE
;

224 
	}
}

227 
	$show_œyîs_∑r£_w‹d
(
DügømD©a
 *
dügd©a
, 
gboﬁón
 *
visibÀ_œyîs
, 
göt
 
n_œyîs
, c⁄° *
°r
)

229 
GPåAºay
 *
œyîs
 = 
dügd©a
->layers;

230 
gboﬁón
 
found
 = 
FALSE
;

233 i‡(
œyîs
) {

234 
Àn
,
k
 = 0;

235 
Layî
 *
œy
;

236 *
p
;

237 
k
 = 0; k < 
œyîs
->
Àn
; k++) {

238 
œy
 = (
Layî
 *)
	`g_±r_¨øy_ödex
(
œyîs
, 
k
);

240 i‡(
œy
->
«me
) {

241 
Àn
 = 
	`°æí
(
œy
->
«me
);

242 i‡((
p
 = 
	`°r°r
(
°r
, 
œy
->
«me
)Ë!
NULL
) {

243 i‡(((
p
 =
°r
) || (p[-1] == ','))

244 && ((
p
[
Àn
] == 0) || (p[len] == ','))){

245 
found
 = 
TRUE
;

246 i‡(
visibÀ_œyîs
[
k
] =
TRUE
)

247 
	`g_¥öt
(
	`_
("W¨nög: Layî %d (%sË£À˘ed m‹êth™ on˚.\n"), 
k
, 
œy
->
«me
);

248 
visibÀ_œyîs
[
k
] = 
TRUE
;

255 i‡(
found
 =
FALSE
)

256 
	`g_¥öt
(
	`_
("W¨nög: Thîêi†nÿœyîÇamed %s\n"), 
°r
);

257 
	}
}

260 
	$show_œyîs_∑r£_°rög
(
DügømD©a
 *
dügd©a
, 
gboﬁón
 *
visibÀ_œyîs
, 
göt
 
n_œyîs
, c⁄° *
°r
)

262 
gch¨
 **
µ
;

263 
i
;

265 
µ
 = 
	`g_°r•lô
(
°r
, ",", 100);

267 
i
 = 0; 
µ
[i]; i++) {

268 
gch¨
 *
p
 = 
µ
[
i
];

271 i‡(
	`°æí
(
p
) == 0)

277 i‡(
	`°æí
(
p
Ë!
	`°r•n
(p, "0123456789-") )

278 
	`show_œyîs_∑r£_w‹d
(
dügd©a
, 
visibÀ_œyîs
, 
n_œyîs
, 
p
);

280 
	`show_œyîs_∑r£_numbîs
(
dügd©a
, 
visibÀ_œyîs
, 
n_œyîs
, 
p
);

283 
	`g_°r‰ìv
(
µ
);

284 
	}
}

288 
	$h™dÀ_show_œyîs
(
DügømD©a
 *
dügd©a
, c⁄° *
show_œyîs
)

290 
gboﬁón
 *
visibÀ_œyîs
;

291 
Layî
 *
œyî
;

292 
i
;

294 
visibÀ_œyîs
 = 
	`g_mÆloc
(
dügd©a
->
œyîs
->
Àn
 * (
gboﬁón
));

296 
i
=0;i<
dügd©a
->
œyîs
->
Àn
;i++)

297 
visibÀ_œyîs
[
i
] = 
FALSE
;

300 
	`show_œyîs_∑r£_°rög
(
dügd©a
, 
visibÀ_œyîs
, dügd©a->
œyîs
->
Àn
,

301 
show_œyîs
);

304 
i
=0;i<
dügd©a
->
œyîs
->
Àn
;i++) {

305 
œyî
 = 
	`g_±r_¨øy_ödex
(
dügd©a
->
œyîs
, 
i
);

307 i‡(
visibÀ_œyîs
[
i
] =
TRUE
)

308 
œyî
->
visibÀ
 = 
TRUE
;

310 
œyî
->
visibÀ
 = 
FALSE
;

312 
	`g_‰ì
(
visibÀ_œyîs
);

313 
	}
}

316 c⁄° *
	g¨gv0
 = 
NULL
;

322 
gboﬁón


323 
	$do_c⁄vît
(c⁄° *
ö‚ame
,

324 c⁄° *
out‚ame
, 
DüExp‹tFûãr
 *
ef
,

325 c⁄° *
size
,

326 *
show_œyîs
)

328 
DüImp‹tFûãr
 *
öf
;

329 
DügømD©a
 *
dügd©a
 = 
NULL
;

331 
öf
 = 
	`fûãr_guess_imp‹t_fûãr
(
ö‚ame
);

332 i‡(!
öf
)

333 
öf
 = &
dü_imp‹t_fûãr
;

335 i‡(
ef
 =
NULL
) {

336 
ef
 = 
	`fûãr_guess_exp‹t_fûãr
(
out‚ame
);

337 i‡(!
ef
) {

338 
	`g_¸ôiˇl
(
	`_
("%sÉrror: don't know howÅoÉxport into %s\n"),

339 
¨gv0
,
out‚ame
);

340 
	`exô
(1);

344 
dü_is_öãø˘ive
 = 
FALSE
;

346 i‡(0==
	`°rcmp
(
ö‚ame
,
out‚ame
)) {

347 
	`g_¸ôiˇl
(
	`_
("%sÉrror: inputánd output fileÇame is identical: %s"),

348 
¨gv0
, 
ö‚ame
);

349 
	`exô
(1);

352 
dügd©a
 = 
	`g_obje˘_√w
 (
DIA_TYPE_DIAGRAM_DATA
, 
NULL
);

354 i‡(!
öf
->
	`imp‹t_func
(
ö‚ame
,
dügd©a
,öf->
u£r_d©a
)) {

355 
	`g_¸ôiˇl
(
	`_
("%sÉrror:Çeed valid input file %s\n"),

356 
¨gv0
, 
ö‚ame
);

357 
	`exô
(1);

361 i‡(
show_œyîs
)

362 
	`h™dÀ_show_œyîs
(
dügd©a
, 
show_œyîs
);

365 
	`d©a_upd©e_exã¡s
(
dügd©a
);

371 i‡(
size
) {

372 i‡(
ef
 =
	`fûãr_gë_by_«me
 ("png-libart"))

373 
ef
->
	`exp‹t_func
(
dügd©a
, 
out‚ame
, 
ö‚ame
, 
size
);

375 
	`g_w¨nög
 ("--sizeÖarameter unsupported for %s filter",

376 
ef
->
unique_«me
 ?Éf->unique_name : "selected");

377 
ef
->
	`exp‹t_func
(
dügd©a
, 
out‚ame
, 
ö‚ame
,Éf->
u£r_d©a
);

381 
ef
->
	`exp‹t_func
(
dügd©a
, 
out‚ame
, 
ö‚ame
,Éf->
u£r_d©a
);

382  
	`Ârötf
(
°dout
,

383 
	`_
("%s --> %s\n"),

384 
ö‚ame
,
out‚ame
);

385 
	`g_obje˘_uƒef
(
dügd©a
);

386  
TRUE
;

387 
	}
}

389 
debug_bªak
();

390 
	gdebug_bªak_d⁄t_›timize
 = 1;

392 
	$debug_bªak
()

394 i‡(
debug_bªak_d⁄t_›timize
 > 0)

395 
debug_bªak_d⁄t_›timize
 -= 1;

396 
	}
}

399 
	$dump_dïídícõs
()

401 #ifde‡
__GNUC__


402 
	`g_¥öt
 ("Compûî: GCC " 
__VERSION__
 "\n");

403 #ñi‡
deföed
 
_MSC_VER


404 
	`g_¥öt
 ("Compûî: MSC %d\n", 
_MSC_VER
);

406 
	`g_¥öt
 ("Compiler: unknown\n");

409 
	`g_¥öt
 (" with : "

410 #ifde‡
G_THREADS_ENABLED


413 #ifde‡
HAVE_CAIRO


416 #ifde‡
GNOME


419 #ifde‡
HAVE_GNOMEPRINT


422 #ifde‡
HAVE_LIBART


425 #ifde‡
HAVE_PANGOCAIRO


434 
	`g_¥öt
 ("Library versions (at compileÅime)\n");

435 #ifde‡
HAVE_LIBPNG


436 
	`g_¥öt
 ("lib≤g : %†(%s)\n", 
	`≤g_gë_hódî_vî
(
NULL
), 
PNG_LIBPNG_VER_STRING
);

438 #ifde‡
HAVE_FREETYPE


440 
FT_Libøry
 
·_libøry
;

441 
FT_I¡
 
·_maj‹_vîsi⁄
;

442 
FT_I¡
 
·_mö‹_vîsi⁄
;

443 
FT_I¡
 
·_mi¸o_vîsi⁄
;

445 i‡(
	`FT_Inô_FªeTy≥
 (&
·_libøry
) == 0) {

446 
	`FT_Libøry_Vîsi⁄
 (
·_libøry
,

447 &
·_maj‹_vîsi⁄
,

448 &
·_mö‹_vîsi⁄
,

449 &
·_mi¸o_vîsi⁄
);

451 
	`g_¥öt
 ("‰ìty≥: %d.%d.%d\n", 
·_maj‹_vîsi⁄
, 
·_mö‹_vîsi⁄
, 
·_mi¸o_vîsi⁄
);

452 
	`FT_D⁄e_FªeTy≥
 (
·_libøry
);

455 
	`g_¥öt
 ("freetype: ?.?.?\n");

459 c⁄° 
gch¨
* 
libxml_π_vîsi⁄
 = "?";

467 
	`xmlInôP¨£r
();

468 i‡(
	`xmlGëGlobÆSèã
())

469 
libxml_π_vîsi⁄
 = 
	`xmlGëGlobÆSèã
()->
xmlP¨£rVîsi⁄
;

471 
libxml_π_vîsi⁄
 = 
xmlP¨£rVîsi⁄
;

472 i‡(
	`©oi
(
libxml_π_vîsi⁄
))

473 
	`g_¥öt
 ("libxml : %d.%d.%d (%s)\n",

474 
	`©oi
(
libxml_π_vîsi⁄
) / 10000,átoi(libxml_rt_version) / 100 % 100,átoi(libxml_rt_version) % 100,

475 
LIBXML_DOTTED_VERSION
);

477 
	`g_¥öt
 ("libxm» : %†(%s)\n", 
libxml_π_vîsi⁄
 ?Üibxml_π_vîsi⁄ : "??", 
LIBXML_DOTTED_VERSION
);

479 
	`g_¥öt
 ("glib : %d.%d.%d (%d.%d.%d)\n",

480 
glib_maj‹_vîsi⁄
, 
glib_mö‹_vîsi⁄
, 
glib_mi¸o_vîsi⁄
,

481 
GLIB_MAJOR_VERSION
, 
GLIB_MINOR_VERSION
, 
GLIB_MICRO_VERSION
);

482 #ifde‡
PANGO_VERSION_ENCODE


483 
	`g_¥öt
 ("∑ngÿ : %†(%d.%d.%d)\n", 
	`∑ngo_vîsi⁄_°rög
(), 
PANGO_VERSION_MAJOR
, 
PANGO_VERSION_MINOR
, 
PANGO_VERSION_MICRO
);

485 
	`g_¥öt
 ("pango : versionÇotávailable (>= 1.14.x)\n");

487 #i‡
HAVE_CAIRO


488 #ifde‡
CAIRO_VERSION_STRING


489 
	`g_¥öt
 ("ˇúÿ : %†(%s)\n", 
	`ˇúo_vîsi⁄_°rög
(), 
CAIRO_VERSION_STRING
);

491 
	`g_¥öt
 ("ˇúÿ : %†(%d.%d.%d)\n", 
	`ˇúo_vîsi⁄_°rög
(), 
CAIRO_VERSION_MAJOR
, 
CAIRO_VERSION_MINOR
, 
CAIRO_VERSION_MICRO
);

496 
gch¨
 
löked«me
[1024];

497 
göt
 
Àn
 = 0;

500 i‡((
Àn
 = 
	`ªadlök
 (
PREFIX
 "/lib/lib∑ngo-1.0.so", 
löked«me
, 1023)) > 0) {

502 
löked«me
[
Àn
] = '\0';

503 
	`g_¥öt
 ("%s/%s\n", 
PREFIX
, 
löked«me
);

507 
	`g_¥öt
 ("gtk+ : %d.%d.%d (%d.%d.%d)\n",

508 
gtk_maj‹_vîsi⁄
, 
gtk_mö‹_vîsi⁄
, 
gtk_mi¸o_vîsi⁄
,

509 
GTK_MAJOR_VERSION
, 
GTK_MINOR_VERSION
, 
GTK_MICRO_VERSION
);

514 
	`g_¥öt
 ("gnome : %d.%d.%d (%d.%d.%d)\n"

515 
gnome_maj‹_vîsi⁄
, 
gnome_mö‹_vîsi⁄
, 
gnome_mi¸o_vîsi⁄
,

516 
GNOME_MAJOR_VERSION
, 
GNOME_MINOR_VERSION
, 
GNOME_MICRO_VERSION
);

518 
	}
}

520 
gboﬁón


521 
	$≠p_is_öãø˘ive
()

523  
dü_is_öãø˘ive
;

524 
	}
}

532 
gboﬁón


533 
	$h™dÀ_öôül_dügøm
(c⁄° *
ö_fûe_«me
,

534 c⁄° *
out_fûe_«me
,

535 c⁄° *
exp‹t_fûe_f‹m©
,

536 c⁄° *
size
,

537 * 
show_œyîs
,

538 c⁄° *
outdú
) {

539 
DDi•œy
 *
ddi•
 = 
NULL
;

540 
Dügøm
 *
dügøm
 = 
NULL
;

541 
gboﬁón
 
made_c⁄vîsi⁄s
 = 
FALSE
;

543 i‡(
exp‹t_fûe_f‹m©
) {

544 *
exp‹t_fûe_«me
 = 
NULL
;

545 
DüExp‹tFûãr
 *
ef
 = 
NULL
;

548 
exp‹t_fûe_«me
 = 
	`buûd_ouçut_fûe_«me
(
ö_fûe_«me
, 
exp‹t_fûe_f‹m©
, 
outdú
);

551 i‡–
size
 && 
	`°rcmp
(
exp‹t_fûe_f‹m©
, "png") == 0)

552 
ef
 = 
	`fûãr_gë_by_«me
 ("png-libart");

553 i‡(!
ef
)

554 
ef
 = 
	`fûãr_guess_exp‹t_fûãr
(
exp‹t_fûe_«me
);

555 i‡(
ef
 =
NULL
) {

556 
ef
 = 
	`fûãr_gë_by_«me
(
exp‹t_fûe_f‹m©
);

557 i‡(
ef
 =
NULL
) {

558 
	`g_¸ôiˇl
(
	`_
("C™'àföd ouçuàf‹m©/fûã∏%s\n"), 
exp‹t_fûe_f‹m©
);

559  
FALSE
;

561 
	`g_‰ì
 (
exp‹t_fûe_«me
);

562 
exp‹t_fûe_«me
 = 
	`buûd_ouçut_fûe_«me
(
ö_fûe_«me
, 
ef
->
exãnsi⁄s
[0], 
outdú
);

564 
made_c⁄vîsi⁄s
 |
	`do_c⁄vît
(
ö_fûe_«me
,

565 (
out_fûe_«me
 !
NULL
?out_fûe_«me:
exp‹t_fûe_«me
),

566 
ef
, 
size
, 
show_œyîs
);

567 
	`g_‰ì
(
exp‹t_fûe_«me
);

568 } i‡(
out_fûe_«me
) {

569 
DüExp‹tFûãr
 *
ef
 = 
NULL
;

572 i‡(
size
 && 
	`°r°r
(
out_fûe_«me
, ".png"))

573 
ef
 = 
	`fûãr_gë_by_«me
 ("png-libart");

575 
made_c⁄vîsi⁄s
 |
	`do_c⁄vît
(
ö_fûe_«me
, 
out_fûe_«me
, 
ef
,

576 
size
, 
show_œyîs
);

578 i‡(
	`g_fûe_ã°
(
ö_fûe_«me
, 
G_FILE_TEST_EXISTS
)) {

579 
dügøm
 = 
	`dügøm_lﬂd
 (
ö_fûe_«me
, 
NULL
);

581 
dügøm
 = 
	`√w_dügøm
 (
ö_fûe_«me
);

584 i‡(
dügøm
 !
NULL
) {

585 
	`dügøm_upd©e_exã¡s
(
dügøm
);

586 i‡(
	`≠p_is_öãø˘ive
()) {

587 
	`œyî_dülog_£t_dügøm
(
dügøm
);

589 
ddi•
 = 
	`√w_di•œy
(
dügøm
);

591 
	`g_obje˘_uƒef
(
dügøm
);

595  
made_c⁄vîsi⁄s
;

596 
	}
}

598 #ifde‡
HAVE_FREETYPE


600 
	#EPS_PANGO
 "ïs-∑ngo, "

	)

602 
	#EPS_PANGO
 ""

	)

605 #ifde‡
G_OS_WIN32


607 
	#WMF
 "wmf, "

	)

609 
	#WMF
 ""

	)

612 c⁄° 
gch¨
 *
	göput_dúe˘‹y
 = 
NULL
;

613 c⁄° 
gch¨
 *
	gouçut_dúe˘‹y
 = 
NULL
;

615 
gboﬁón


616 
	$_check_›ti⁄_öput_dúe˘‹y
 (c⁄° 
gch¨
 *
›ti⁄_«me
,

617 c⁄° 
gch¨
 *
vÆue
,

618 
gpoöãr
 
d©a
,

619 
GEº‹
 **
îr‹
)

621 
gch¨
 *
dúe˘‹y
 = 
	`g_fûíame_‰om_utf8
 (
vÆue
, -1, 
NULL
, NULL, NULL);

623 i‡(
	`g_fûe_ã°
 (
dúe˘‹y
, 
G_FILE_TEST_IS_DIR
)) {

624 
öput_dúe˘‹y
 = 
dúe˘‹y
;

625  
TRUE
;

627 
	`g_£t_îr‹
 (
îr‹
, 
DIA_ERROR
, 
DIA_ERROR_DIRECTORY
,

628 
	`_
("I≈ut-dúe˘‹y '%s' mu°Éxi°!\n"), 
dúe˘‹y
);

629 
	`g_‰ì
 (
dúe˘‹y
);

630  
FALSE
;

631 
	}
}

632 
gboﬁón


633 
	$_check_›ti⁄_ouçut_dúe˘‹y
 (c⁄° 
gch¨
 *
›ti⁄_«me
,

634 c⁄° 
gch¨
 *
vÆue
,

635 
gpoöãr
 
d©a
,

636 
GEº‹
 **
îr‹
)

638 
gch¨
 *
dúe˘‹y
 = 
	`g_fûíame_‰om_utf8
 (
vÆue
, -1, 
NULL
, NULL, NULL);

640 i‡(
	`g_fûe_ã°
 (
dúe˘‹y
, 
G_FILE_TEST_IS_DIR
)) {

641 
ouçut_dúe˘‹y
 = 
dúe˘‹y
;

642  
TRUE
;

644 
	`g_£t_îr‹
 (
îr‹
, 
DIA_ERROR
, 
DIA_ERROR_DIRECTORY
,

645 
	`_
("Ouçut-dúe˘‹y '%s' mu°Éxi°!\n"), 
dúe˘‹y
);

646 
	`g_‰ì
 (
dúe˘‹y
);

647  
FALSE
;

648 
	}
}

651 
	$_£tup_ãxtdomaös
 ()

653 #ifde‡
G_OS_WIN32


656 
gch¨
* 
loˇÀdú
 = 
	`dü_gë_lib_dúe˘‹y
 ("locale");

658 
	`bödãxtdomaö
(
GETTEXT_PACKAGE
, 
loˇÀdú
);

659 
	`g_‰ì
 (
loˇÀdú
);

662 c⁄° 
gch¨
 *
loˇÀdú
;

664 
loˇÀdú
 = 
	`g_gëív
("DIA_LOCALE_PATH");

665 if(
loˇÀdú
 !
NULL
) {

666 
	`bödãxtdomaö
(
GETTEXT_PACKAGE
, 
loˇÀdú
);

668 
	`bödãxtdomaö
(
GETTEXT_PACKAGE
, 
LOCALEDIR
);

672 #i‡
deföed
 
ENABLE_NLS
 && deföed 
HAVE_BIND_TEXTDOMAIN_CODESET


673 
	`böd_ãxtdomaö_code£t
(
GETTEXT_PACKAGE
,"UTF-8");

675 
	`ãxtdomaö
(
GETTEXT_PACKAGE
);

676 
	}
}

679 
	$≠p_öô
 (
¨gc
, **
¨gv
)

681 
gboﬁón
 
no•œsh
 = 
FALSE
;

682 
gboﬁón
 
n⁄ew
 = 
FALSE
;

683 
gboﬁón
 
u£_öãgøãd_ui
 = 
TRUE
;

684 
gboﬁón
 
¸edôs
 = 
FALSE
;

685 
gboﬁón
 
vîsi⁄
 = 
FALSE
;

686 
gboﬁón
 
vîbo£
 = 
FALSE
;

687 
gboﬁón
 
log_to_°dîr
 = 
FALSE
;

688 #ifde‡
GNOME


689 
GnomeClõ¡
 *
˛õ¡
;

691 *
exp‹t_fûe_«me
 = 
NULL
;

692 *
exp‹t_fûe_f‹m©
 = 
NULL
;

693 *
size
 = 
NULL
;

694 *
show_œyîs
 = 
NULL
;

695 
gboﬁón
 
made_c⁄vîsi⁄s
 = 
FALSE
;

696 
GSLi°
 *
fûes
 = 
NULL
;

697 c⁄° 
gch¨
 **
fûíames
 = 
NULL
;

698 
i
 = 0;

700 
gch¨
 *
exp‹t_f‹m©_°rög
 =

702 
	`g_°rdup_¥ötf
(
	`_
("SelectÅhe filter/format out of: %s"),

703 "cgm, dü, dxf,Éps,Éps-buûtö, " 
EPS_PANGO


705 #i‡
	`deföed
(
HAVE_LIBPNG
Ë&& deföed(
HAVE_LIBART
)

708 #ifde‡
HAVE_CAIRO


713 "sh≠e, svg,Åex (pgf-ãx,Ö°ricks-ãx), " 
WMF


716 
GO±i⁄C⁄ãxt
 *
c⁄ãxt
 = 
NULL
;

717 
GO±i⁄E¡ry
 
›ti⁄s
[] =

719 {"exp‹t", 'e', 0, 
G_OPTION_ARG_FILENAME
, 
NULL
 ,

720 
	`N_
("ExportÜoaded fileándÉxit"), N_("OUTPUT")},

721 {"fûãr",'t', 0, 
G_OPTION_ARG_STRING
, 
NULL
 ,

722 
NULL
 , 
	`N_
("TYPE") },

723 {"size", 's', 0, 
G_OPTION_ARG_STRING
, 
NULL
,

724 
	`N_
("Export graphics size"), N_("WxH")},

725 {"show-œyîs", 'L', 0, 
G_OPTION_ARG_STRING
, 
NULL
,

726 
	`N_
("Show only specifiedÜayers (e.g. whenÉxporting). Can beÉitherÅheÜayerÇame oráÑange ofÜayerÇumbers (X-Y)"),

727 
	`N_
("LAYER,LAYER,...")},

728 {"no•œsh", 'n', 0, 
G_OPTION_ARG_NONE
, &
no•œsh
,

729 
	`N_
("D⁄'àshowÅhê•œsh s¸ìn"), 
NULL
 },

730 {"n⁄ew", 'n', 0, 
G_OPTION_ARG_NONE
, &
n⁄ew
,

731 
	`N_
("D⁄'à¸óãÉm±y dügøm"), 
NULL
 },

732 {"öãgøãd", '\0', 0, 
G_OPTION_ARG_NONE
, &
u£_öãgøãd_ui
,

733 
	`N_
("Sèπ i¡egøãd u£∏öãrÁ˚ (dügøm†öÅabs)"), 
NULL
 },

734 {"log-to-°dîr", 'l', 0, 
G_OPTION_ARG_NONE
, &
log_to_°dîr
,

735 
	`N_
("SídÉº‹ mesßge†tÿ°dî∏ö°ód o‡showög dülogs."), 
NULL
 },

736 {"öput-dúe˘‹y", 'I', 0, 
G_OPTION_ARG_CALLBACK
, 
_check_›ti⁄_öput_dúe˘‹y
,

737 
	`N_
("Directory containing input files"), N_("DIRECTORY")},

738 {"ouçut-dúe˘‹y", 'O', 0, 
G_OPTION_ARG_CALLBACK
, 
_check_›ti⁄_ouçut_dúe˘‹y
,

739 
	`N_
("Directory containing output files"), N_("DIRECTORY")},

740 {"¸edôs", 'c', 0, 
G_OPTION_ARG_NONE
, &
¸edôs
,

741 
	`N_
("Di•œy cªdô†li°ándÉxô"), 
NULL
 },

742 {"vîbo£", 0, 0, 
G_OPTION_ARG_NONE
, &
vîbo£
,

743 
	`N_
("Gíî©êvîbo£ ouçut"), 
NULL
 },

744 {"vîsi⁄", 'v', 0, 
G_OPTION_ARG_NONE
, &
vîsi⁄
,

745 
	`N_
("Di•œy vîsi⁄ándÉxô"), 
NULL
 },

746 { 
G_OPTION_REMAINING
, 0, 0, 
G_OPTION_ARG_FILENAME_ARRAY
, 
NULL
 ,

747 
NULL
, NULL },

748 { 
NULL
 }

752 
dü_is_öãø˘ive
 = 
TRUE
;

754 
›ti⁄s
[0].
¨g_d©a
 = &
exp‹t_fûe_«me
;

755 
›ti⁄s
[1].
¨g_d©a
 = &
exp‹t_fûe_f‹m©
;

756 
›ti⁄s
[1].
des¸ùti⁄
 = 
exp‹t_f‹m©_°rög
;

757 
›ti⁄s
[2].
¨g_d©a
 = &
size
;

758 
›ti⁄s
[3].
¨g_d©a
 = &
show_œyîs
;

759 
	`g_as£π
 (
	`°rcmp
 (
›ti⁄s
[13].
l⁄g_«me
, 
G_OPTION_REMAINING
) == 0);

760 
›ti⁄s
[13].
¨g_d©a
 = (*)&
fûíames
;

762 
¨gv0
 = (
¨gc
 > 0Ë? 
¨gv
[0] : "(none)";

764 
	`gtk_£t_loˇÀ
();

765 
	`£éoˇÀ
(
LC_NUMERIC
, "C");

766 
	`_£tup_ãxtdomaös
 ();

768 
c⁄ãxt
 = 
	`g_›ti⁄_c⁄ãxt_√w
(
	`_
("[FILE...]"));

769 
	`g_›ti⁄_c⁄ãxt_add_maö_íåõs
 (
c⁄ãxt
, 
›ti⁄s
, 
GETTEXT_PACKAGE
);

770 
	`g_›ti⁄_c⁄ãxt_add_group
 (
c⁄ãxt
, 
	`gtk_gë_›ti⁄_group
 (
FALSE
));

772 i‡(
¨gv
) {

773 
GEº‹
 *
îr‹
 = 
NULL
;

775 i‡(!
	`g_›ti⁄_c⁄ãxt_∑r£
 (
c⁄ãxt
, &
¨gc
, &
¨gv
, &
îr‹
)) {

776 i‡(
îr‹
) {

777 
	`g_¥öt
 ("%s", 
îr‹
->
mesßge
);

778 
	`g_îr‹_‰ì
 (
îr‹
);

780 
	`g_¥öt
 (
	`_
("Invalid option?"));

783 
	`g_›ti⁄_c⁄ãxt_‰ì
(
c⁄ãxt
);

784 
	`exô
(1);

787 i‡(
fûíames
) {

788 
fûíames
[
i
] !
NULL
) {

789 
gch¨
 *
fûíame
;

790 
gch¨
 *
ã°∑th
;

792 i‡(
	`g_°r_has_¥efix
 (
fûíames
[
i
], "file://")) {

793 
fûíame
 = 
	`g_fûíame_‰om_uri
 (
fûíames
[
i
], 
NULL
, NULL);

794 i‡(!
	`g_utf8_vÆid©e
(
fûíame
, -1, 
NULL
)) {

795 
gch¨
 *
t‚
 = 
fûíame
;

796 
fûíame
 = 
	`g_fûíame_to_utf8
(fûíame, -1, 
NULL
, NULL, NULL);

797 
	`g_‰ì
(
t‚
);

800 
fûíame
 = 
	`g_fûíame_to_utf8
 (
fûíames
[
i
], -1, 
NULL
, NULL, NULL);

802 i‡(!
fûíame
) {

803 
	`g_¥öt
 (
	`_
("Fûíamêc⁄vîsi⁄ faûed: %s\n"), 
fûíames
[
i
]);

807 i‡(
	`g_∑th_is_absﬁuã
(
fûíame
))

808 
ã°∑th
 = 
fûíame
;

810 
ã°∑th
 = 
	`g_buûd_fûíame
(
öput_dúe˘‹y
 ? i≈ut_dúe˘‹y : ".", 
fûíame
, 
NULL
);

813 i‡(
	`g_fûe_ã°
 (
ã°∑th
, 
G_FILE_TEST_IS_REGULAR
))

814 
fûes
 = 
	`g_¶i°_≠≥nd
(fûes, 
fûíame
);

816 
	`g_¥öt
 (
	`_
("Missög i≈ut: %s\n"), 
fûíame
);

817 
	`g_‰ì
 (
fûíame
);

819 i‡(
fûíame
 !
ã°∑th
)

820 
	`g_‰ì
 (
ã°∑th
);

821 ++
i
;

825 i‡(
exp‹t_fûe_«me
 || 
exp‹t_fûe_f‹m©
 || 
size
)

826 
dü_is_öãø˘ive
 = 
FALSE
;

830 i‡(
¨gv
 && 
dü_is_öãø˘ive
 && !
vîsi⁄
) {

831 #ifde‡
GNOME


832 
GnomeProgøm
 *
¥ogøm
 =

833 
	`gnome_¥ogøm_öô
 (
PACKAGE
, 
VERSION
, 
LIBGNOMEUI_MODULE
,

834 
¨gc
, 
¨gv
,

836 
GNOME_PARAM_GOPTION_CONTEXT
, 
c⁄ãxt
,

837 
GNOME_PROGRAM_STANDARD_PROPERTIES
,

838 
GNOME_PARAM_NONE
);

839 
˛õ¡
 = 
	`gnome_ma°î_˛õ¡
();

840 if(
˛õ¡
 =
NULL
) {

841 
	`g_w¨nög
(
	`_
("Can't connectÅo session manager!\n"));

844 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
 (
˛õ¡
), "save_yourself",

845 
	`G_CALLBACK
 (
ßve_°©e
), 
NULL
);

846 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
 (
˛õ¡
), "die",

847 
	`G_CALLBACK
 (
£ssi⁄_dõ
), 
NULL
);

854 #ifde‡
G_THREADS_ENABLED


855 
	`g_thªad_öô
 (
NULL
);

857 
	`gtk_öô
(&
¨gc
, &
¨gv
);

861 #ifde‡
G_THREADS_ENABLED


862 
	`g_thªad_öô
 (
NULL
);

864 
	`g_ty≥_öô
();

865 #ifde‡
GDK_WINDOWING_WIN32


871 
	`gtk_öô
(&
¨gc
, &
¨gv
);

876 
	`g_‰ì
(
exp‹t_f‹m©_°rög
);

878 i‡(
vîsi⁄
) {

879 #i‡(
deföed
 
__TIME__
Ë&& (deföed 
__DATE__
)

881 
	`¥ötf
(
	`g_loˇÀ_‰om_utf8
(
	`_
("Dü vîsi⁄ %s, compûed %†%s\n"), -1, 
NULL
, NULL, NULL), 
VERSION
, 
__TIME__
, 
__DATE__
);

883 
	`¥ötf
(
	`g_loˇÀ_‰om_utf8
(
	`_
("Dü vîsi⁄ %s\n"), -1, 
NULL
, NULL, NULL), 
VERSION
);

885 i‡(
vîbo£
)

886 
	`dump_dïídícõs
();

887 
	`exô
(0);

890 i‡(!
dü_is_öãø˘ive
)

891 
log_to_°dîr
 = 
TRUE
;

893 
	`libdü_öô
 ( (
dü_is_öãø˘ive
 ? 
DIA_INTERACTIVE
 : 0)

894 | (
log_to_°dîr
 ? 
DIA_MESSAGE_STDERR
 : 0)

895 | (
vîbo£
 ? 
DIA_VERBOSE
 : 0) );

899 i‡(
dü_is_öãø˘ive
) {

900 
	`¸óã_u£r_dús
();

902 i‡(!
no•œsh
)

903 
	`≠p_•œsh_öô
("");

906 
deÁu…_curs‹
 = 
	`gdk_curs‹_√w
(
GDK_LEFT_PTR
);

907 
	`ddi•œy_£t_Æl_curs‹
(
deÁu…_curs‹
);

910 
	`dü_ªgi°î_∂ugös
();

911 
	`dü_ªgi°î_buûtö_∂ugö
(
öã∫Æ_∂ugö_öô
);

913 
	`lﬂd_Æl_shìts
();

915 
	`dü_log_mesßge
 ("object defaults");

916 
	`dü_obje˘_deÁu…s_lﬂd
 (
NULL
, 
TRUE
 );

918 
	`debug_bªak
();

920 i‡(
	`obje˘_gë_ty≥
("Sènd¨d - Box"Ë=
NULL
) {

921 
	`mesßge_îr‹
(
	`_
("Couldn't find standard objects whenÜooking for "

923 
	`g_¸ôiˇl
–
	`_
("Couldn't find standard objects whenÜooking for "

924 "obje˘-lib†ö '%s';Éxôög...\n"), 
	`dü_gë_lib_dúe˘‹y
("dia"));

925 
	`exô
(1);

928 
	`≥rsi°í˚_lﬂd
();

931 
	`¥efs_öô
();

933 i‡(
dü_is_öãø˘ive
) {

936 
a˘ive_toﬁ
 = 
	`¸óã_modify_toﬁ
();

938 
	`dü_log_mesßge
 ("ui creation");

939 i‡(
u£_öãgøãd_ui
) {

940 
	`¸óã_öãgøãd_ui
();

942 
	`¸óã_toﬁbox
();

944 
	`≥rsi°í˚_ªgi°î_wödow_¸óã
("layer_window",

945 (
NuŒ¨yFunc
*)&
¸óã_œyî_dülog
);

949 
	`ª˚¡_fûe_hi°‹y_öô
();

952 #i‡
	`GLIB_CHECK_VERSION
(2,14,0)

953 
	`g_timeout_add_£c⁄ds
(5*60, 
autoßve_check_autoßve
, 
NULL
);

955 
	`g_timeout_add
(5*60*1000, 
autoßve_check_autoßve
, 
NULL
);

959 
	`¸óã_åì_wödow
();

961 
	`≥rsi°í˚_ªgi°î_wödow_¸óã
("sheets_main_dialog",

962 (
NuŒ¨yFunc
*)&
shìts_dülog_¸óã
);

969 
	`dü_log_mesßge
 ("diagrams");

970 
made_c⁄vîsi⁄s
 = 
	`h™dÀ_Æl_dügøms
(
fûes
, 
exp‹t_fûe_«me
,

971 
exp‹t_fûe_f‹m©
, 
size
, 
show_œyîs
,

972 
öput_dúe˘‹y
, 
ouçut_dúe˘‹y
);

974 i‡(
dü_is_öãø˘ive
 && 
fûes
 =
NULL
 && !
n⁄ew
) {

975 i‡(
u£_öãgøãd_ui
)

977 
GLi°
 * 
li°
;

979 
	`fûe_√w_ˇŒback
(
NULL
);

980 
li°
 = 
	`dü_›í_dügøms
();

981 i‡(
li°
)

983 
Dügøm
 * 
dügøm
 = 
li°
->
d©a
;

984 
	`dügøm_upd©e_exã¡s
(
dügøm
);

985 
dügøm
->
is_deÁu…
 = 
TRUE
;

990 
gch¨
 *
fûíame
 = 
	`g_fûíame_‰om_utf8
(
	`_
("Dügøm1.dü"), -1, 
NULL
, NULL, NULL);

991 
Dügøm
 *
dügøm
 = 
	`√w_dügøm
 (
fûíame
);

992 
	`g_‰ì
(
fûíame
);

994 i‡(
dügøm
 !
NULL
) {

995 
	`dügøm_upd©e_exã¡s
(
dügøm
);

996 
dügøm
->
is_deÁu…
 = 
TRUE
;

999 
	`œyî_dülog_£t_dügøm
(
dügøm
);

1000 
	`√w_di•œy
(
dügøm
);

1004 
	`g_¶i°_‰ì
(
fûes
);

1005 i‡(
made_c⁄vîsi⁄s
Ë
	`exô
(0);

1007 
	`dynobj_ª‰esh_öô
();

1008 
	`dü_log_mesßge
 ("initialized");

1009 
	}
}

1011 
gboﬁón


1012 
	$≠p_exô
()

1014 
GLi°
 *
li°
;

1015 
GSLi°
 *
¶i°
;

1022 
gboﬁón
 
≠p_exô_⁄˚
 = 
FALSE
;

1024 i‡(
≠p_exô_⁄˚
) {

1025 
	`g_îr‹
(
	`_
("This shouldn't happen. Please fileá bugÑeportát bugzilla.gnome.org\n"

1027  
FALSE
;

1030 i‡(
	`dügøm_modifõd_exi°s
()) {

1031 i‡(
	`is_öãgøãd_ui
 ())

1033 
GtkWidgë
 *
dülog
;

1034 
ªsu…
;

1035 
exô_dülog_ôem_¨øy_t
 *
ôems
 = 
NULL
;

1036 
GLi°
 * 
li°
;

1037 
Dügøm
 * 
dügøm
;

1039 
dülog
 = 
	`exô_dülog_make
 (
	`GTK_WINDOW
 (
	`öãrÁ˚_gë_toﬁbox_shñl
 ()),

1040 
	`_
("Exiting Dia"));

1042 
li°
 = 
	`dü_›í_dügøms
();

1043 
li°
)

1045 
dügøm
 = 
li°
->
d©a
;

1047 i‡(
	`dügøm_is_modifõd
 (
dügøm
))

1049 c⁄° 
gch¨
 * 
«me
 = 
	`dügøm_gë_«me
 (
dügøm
);

1050 c⁄° 
gch¨
 * 
∑th
 = 
dügøm
->
fûíame
;

1051 
	`exô_dülog_add_ôem
 (
dülog
, 
«me
, 
∑th
, 
dügøm
);

1054 
li°
 = 
	`g_li°_√xt
 (list);

1057 
ªsu…
 = 
	`exô_dülog_run
 (
dülog
, &
ôems
);

1059 
	`gtk_widgë_de°roy
 (
dülog
);

1061 i‡(
ªsu…
 =
EXIT_DIALOG_EXIT_CANCEL
)

1063  
FALSE
;

1065 i‡(
ªsu…
 =
EXIT_DIALOG_EXIT_SAVE_SELECTED
)

1067 
i
;

1068 
i
 = 0 ; i < 
ôems
->
¨øy_size
 ; i++)

1070 
gch¨
 *
fûíame
;

1072 
dügøm
 = 
ôems
->
¨øy
[
i
].
d©a
;

1073 
fûíame
 = 
	`g_fûíame_‰om_utf8
 (
dügøm
->fûíame, -1, 
NULL
, NULL, NULL);

1074 
	`dügøm_upd©e_exã¡s
 (
dügøm
);

1075 i‡(!
	`dügøm_ßve
 (
dügøm
, 
fûíame
)) {

1076 
	`exô_dülog_‰ì_ôems
 (
ôems
);

1077  
FALSE
;

1079 
	`g_‰ì
 (
fûíame
);

1081 
	`exô_dülog_‰ì_ôems
 (
ôems
);

1083 i‡(
ªsu…
 =
EXIT_DIALOG_EXIT_NO_SAVE
)

1085 
li°
 = 
	`dü_›í_dügøms
();

1086 
li°
) {

1087 
dügøm
 = 
li°
->
d©a
;

1090 
	`dügøm_£t_modifõd
 (
dügøm
, 
FALSE
);

1091 
	`undo_˛ór
(
dügøm
->
undo
);

1092 
li°
 = 
	`g_li°_√xt
 (list);

1098 
GtkWidgë
 *
dülog
;

1099 
GtkWidgë
 *
buâ⁄
;

1100 
dülog
 = 
	`gtk_mesßge_dülog_√w
(

1101 
NULL
, 
GTK_DIALOG_MODAL
,

1102 
GTK_MESSAGE_QUESTION
,

1103 
GTK_BUTTONS_NONE
,

1104 
	`_
("Quitting without saving modified diagrams"));

1105 
	`gtk_mesßge_dülog_f‹m©_£c⁄d¨y_ãxt
(
	`GTK_MESSAGE_DIALOG
(
dülog
),

1106 
	`_
("Modified diagramsÉxist. "

1110 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
(
dülog
), 
	`_
("Quit Dia"));

1112 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_CANCEL
);

1113 
	`gtk_dülog_add_a˘i⁄_widgë
 (
	`GTK_DIALOG
(
dülog
), 
buâ⁄
, 
GTK_RESPONSE_CANCEL
);

1114 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄
, 
GTK_CAN_DEFAULT
);

1115 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
(
dülog
), 
GTK_RESPONSE_CANCEL
);

1117 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_QUIT
);

1118 
	`gtk_dülog_add_a˘i⁄_widgë
 (
	`GTK_DIALOG
(
dülog
), 
buâ⁄
, 
GTK_RESPONSE_OK
);

1120 
	`gtk_widgë_show_Æl
 (
dülog
);

1122 i‡(
	`gtk_dülog_run
(
	`GTK_DIALOG
(
dülog
)Ë!
GTK_RESPONSE_OK
) {

1123 
	`gtk_widgë_de°roy
(
dülog
);

1124  
FALSE
;

1126 
	`gtk_widgë_de°roy
(
dülog
);

1129 
	`¥efs_ßve
();

1131 
	`≥rsi°í˚_ßve
();

1133 
	`dynobj_ª‰esh_föish
();

1135 
	`dü_obje˘_deÁu…s_ßve
 (
NULL
);

1139 
li°
 = 
	`dü_›í_dügøms
();

1140 
li°
!=
NULL
) {

1141 
Dügøm
 *
dü
 = (Dügøm *)
li°
->
d©a
;

1142 
li°
 = 
	`g_li°_√xt
(list);

1144 
¶i°
 = 
dü
->
di•œys
;

1145 
¶i°
!=
NULL
) {

1146 
DDi•œy
 *
ddi•
 = (DDi•œy *)
¶i°
->
d©a
;

1147 
¶i°
 = 
	`g_¶i°_√xt
(slist);

1149 
	`gtk_widgë_de°roy
(
ddi•
->
shñl
);

1155 i‡(
dü_is_öãø˘ive
)

1156 
	`dü_∂ugörc_wrôe
();

1158 
	`gtk_maö_quô
();

1164 
≠p_exô_⁄˚
 = 
TRUE
;

1166  
TRUE
;

1167 
	}
}

1169 
	$¸óã_u£r_dús
()

1171 
gch¨
 *
dú
, *
subdú
;

1173 #ifde‡
G_OS_WIN32


1177 i‡(!
	`g_gë_home_dú
())

1179 
	`g_w¨nög
(
	`_
("CouldÇot createÖer-user Dia config directory"));

1183 
dú
 = 
	`g_°rc⁄ˇt
(
	`g_gë_home_dú
(), 
G_DIR_SEPARATOR_S
 ".dü", 
NULL
);

1184 i‡(
	`g_mkdú
(
dú
, 0755Ë&& 
î∫o
 !
EEXIST
) {

1185 #i‚de‡
G_OS_WIN32


1186 
	`g_¸ôiˇl
(
	`_
("CouldÇot createÖer-user Dia config directory"));

1187 
	`exô
(1);

1189 
	`g_w¨nög
(
	`_
("CouldÇot createÖer-user Dia config directory. Please make "

1195 
subdú
 = 
	`g_°rc⁄ˇt
(
dú
, 
G_DIR_SEPARATOR_S
 "obje˘s", 
NULL
);

1196 
	`g_mkdú
(
subdú
, 0755);

1197 
	`g_‰ì
(
subdú
);

1198 
subdú
 = 
	`g_°rc⁄ˇt
(
dú
, 
G_DIR_SEPARATOR_S
 "sh≠es", 
NULL
);

1199 
	`g_mkdú
(
subdú
, 0755);

1200 
	`g_‰ì
(
subdú
);

1201 
subdú
 = 
	`g_°rc⁄ˇt
(
dú
, 
G_DIR_SEPARATOR_S
 "shìts", 
NULL
);

1202 
	`g_mkdú
(
subdú
, 0755);

1203 
	`g_‰ì
(
subdú
);

1205 
	`g_‰ì
(
dú
);

1206 
	}
}

1208 
PlugöInôResu…


1209 
	$öã∫Æ_∂ugö_öô
(
PlugöInfo
 *
öfo
)

1211 i‡(!
	`dü_∂ugö_öfo_öô
(
öfo
, "Internal",

1212 
	`_
("Objectsánd filters internalÅo dia"),

1213 
NULL
, NULL))

1214  
DIA_PLUGIN_INIT_ERROR
;

1217 
	`obje˘_ªgi°î_ty≥
(&
group_ty≥
);

1218 #ifde‡
USE_NEWGROUP


1219 
	`obje˘_ªgi°î_ty≥
(&
√wgroup_ty≥
);

1223 
	`fûãr_ªgi°î_imp‹t
(&
dü_imp‹t_fûãr
);

1227 
	`fûãr_ªgi°î_exp‹t
(&
dü_exp‹t_fûãr
);

1229  
DIA_PLUGIN_INIT_OK
;

1230 
	}
}

1232 
gboﬁón


1233 
	$h™dÀ_Æl_dügøms
(
GSLi°
 *
fûes
, *
exp‹t_fûe_«me
,

1234 *
exp‹t_fûe_f‹m©
, *
size
, *
show_œyîs
,

1235 c⁄° 
gch¨
 *
öput_dúe˘‹y
, c⁄° gch¨ *
ouçut_dúe˘‹y
)

1237 
GSLi°
 *
node
 = 
NULL
;

1238 
gboﬁón
 
made_c⁄vîsi⁄s
 = 
FALSE
;

1240 
node
 = 
fûes
;Çode;Çodênode->
√xt
) {

1241 
gch¨
 *
ö∑th
 = 
öput_dúe˘‹y
 ? 
	`g_buûd_fûíame
(öput_dúe˘‹y, 
node
->
d©a
, 
NULL
) :Çode->data;

1242 
made_c⁄vîsi⁄s
 |=

1243 
	`h™dÀ_öôül_dügøm
(
ö∑th
, 
exp‹t_fûe_«me
,

1244 
exp‹t_fûe_f‹m©
, 
size
, 
show_œyîs
, 
ouçut_dúe˘‹y
);

1245 i‡(
ö∑th
 !
node
->
d©a
)

1246 
	`g_‰ì
(
ö∑th
);

1248  
made_c⁄vîsi⁄s
;

1249 
	}
}

1261 
	$¥öt_¸edôs
(
gboﬁón
 
¸edôs
)

1263 i‡(
¸edôs
) {

1264 
i
;

1265 c⁄° 
göt
 
«uth‹s
 = ((
auth‹s
) / (authors[0])) - 1;

1266 c⁄° 
göt
 
ndocumít‹s
 = ((
documít‹s
) / (documentors[0])) - 1;

1268 
	`g_¥öt
(
	`_
("The originaláuthor of Dia was:\n\n"));

1269 
i
 = 0; i < 
NUMBER_OF_ORIG_AUTHORS
; i++) {

1270 
	`g_¥öt
("%s\n", 
auth‹s
[
i
]);

1273 
	`g_¥öt
(
	`_
("\nThe current maintainers of Diaáre:\n\n"));

1274 
i
 = 
NUMBER_OF_ORIG_AUTHORS
; i < NUMBER_OF_ORIG_AUTHORS + 
NUMBER_OF_MAINTAINERS
; i++) {

1275 
	`g_¥öt
("%s\n", 
auth‹s
[
i
]);

1278 
	`g_¥öt
(
	`_
("\nOtheráuthorsáre:\n\n"));

1279 
i
 = 
NUMBER_OF_ORIG_AUTHORS
 + 
NUMBER_OF_MAINTAINERS
; i < 
«uth‹s
; i++) {

1280 
	`g_¥öt
("%s\n", 
auth‹s
[
i
]);

1283 
	`g_¥öt
(
	`_
("\nDia is documented by:\n\n"));

1284 
i
 = 0; i < 
ndocumít‹s
; i++) {

1285 
	`g_¥öt
("%s\n", 
documít‹s
[
i
]);

1288 
	`exô
(0);

1290 
	}
}

1292 
	$≠p_is_embedded
()

1295 
	}
}

	@O:\tool\dvs50\app\app_procs.h

18 #i‚de‡
APP_PROCS_H


19 
	#APP_PROCS_H


	)

21 
	~<glib.h
>

22 
	~"düv¨.h
"

24 
DIAVAR
 
≠p_öô
(
¨gc
, **
¨gv
);

29 
gboﬁón
 
≠p_exô
();

30 
≠p_is_embedded
();

32 
≠p_•œsh_öô
(c⁄° 
gch¨
* 
«me
);

33 
DIAVAR
 
≠p_•œsh_d⁄e
();

35 
DIAVAR
 
gboﬁón
 
≠p_is_öãø˘ive
();

37 
dü_ªdúe˘_c⁄sﬁe
 ();

	@O:\tool\dvs50\app\authors.h

54 c⁄° 
	gNUMBER_OF_ORIG_AUTHORS
 = 1;

55 c⁄° 
	gNUMBER_OF_MAINTAINERS
 = 1;

57 c⁄° 
gch¨
 *
	gauth‹s
[] = {

106 
NULL


109 c⁄° 
gch¨
 *
	gdocumít‹s
[] = {

114 
NULL


	@O:\tool\dvs50\app\autosave.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~<c⁄fig.h
>

33 
	~<°dio.h
>

34 
	~<sys/ty≥s.h
>

35 #ifde‡
HAVE_UNISTD_H


36 
	~<uni°d.h
>

39 
	~"öé.h
"

40 
	~"dü_dús.h
"

41 
	~"dügøm.h
"

42 
	~"lﬂd_ßve.h
"

43 
	~"dülogs.h
"

44 
	~<gtk/gtk.h
>

46 
gboﬁón
 
autoßve_check_autoßve
(
gpoöãr
 
d©a
);

49 
	$autoßve_ßve_dügøm
(
gpoöãr
 
d©a
)

51 
Dügøm
 *
dü
 = (Dügøm *)
d©a
;

53 
	`g_idÀ_ªmove_by_d©a
(
d©a
);

55 
	`dügøm_autoßve
(
dü
);

56 
	}
}

63 
gboﬁón


64 
	$autoßve_check_autoßve
(
gpoöãr
 
d©a
)

66 
GLi°
 *
dügøms
 = 
	`dü_›í_dügøms
();

67 
Dügøm
 *
dügøm
;

69 
dügøms
 !
NULL
) {

70 
dügøm
 = (
Dügøm
 *)
dügøms
->
d©a
;

71 i‡(
	`dügøm_is_modifõd
(
dügøm
) &&

72 !
dügøm
->
autoßved
) {

74 
	`g_idÀ_add
 ((
GSour˚Func
)
autoßve_ßve_dügøm
, 
dügøm
);

76 
dügøms
 = 
	`g_li°_√xt
(diagrams);

78  
TRUE
;

79 
	}
}

87 
	$autoßve_make_ª°‹e_dülog
(
GLi°
 *
fûes
)

89 
GtkWidgë
 *
ok
, *
ˇn˚l
;

90 
GtkWidgë
 *
dülog
 = 
	`dülog_make
(
	`_
("Recoveringáutosaved diagrams"),

91 
NULL
, NULL, &
ok
, &
ˇn˚l
);

92 
GtkWidgë
 *
vbox
 = 
	`GTK_DIALOG
(
dülog
)->vbox;

93 
GtkWidgë
 *
£À˘¨ó
 = 
	`gtk_˛i°_√w
(1);

94 
GLi°
 *
ôî
;

95 
gch¨
 **
fûóºay
 = (gch¨**)
	`g_√w
(gch¨ *, 
	`g_li°_Àngth
(
fûes
)+1);

96 
i
;

98 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
vbox
), 
	`gtk_œbñ_√w
(
	`_
("Autosaved filesÉxist.\nPlease selectÅhose you wishÅoÑecover.")));

100 
i
 = 0, 
ôî
 = 
fûes
; iã∏!
NULL
; i++, iã∏
	`g_li°_√xt
(iter)) {

101 
fûóºay
[
i
] = (
gch¨
 *)
ôî
->
d©a
;

103 
fûóºay
[
i
] = 0;

104 
	`gtk_˛i°_≠≥nd
(
	`GTK_CLIST
(
£À˘¨ó
), 
fûóºay
);

106 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
vbox
), 
£À˘¨ó
);

107 
	`gtk_widgë_show_Æl
(
dülog
);

108 
	}
}

113 
	$autoßve_ª°‹e_documíts
()

115 
gch¨
 *
ßvedú
 = 
	`dü_c⁄fig_fûíame
("autoßve" 
G_DIR_SEPARATOR_S
);

116 
GDú
 *
dú
 = 
	`g_dú_›í
(
ßvedú
, 0, 
NULL
);

117 c⁄° *
ít
;

118 
GLi°
 *
fûes
 = 
NULL
;

120 i‡(
dú
 =
NULL
) ;

121 (
ít
 = 
	`g_dú_ªad_«me
(
dú
)Ë!
NULL
) {

122 
	`¥ötf
("Foundáutoßvêfûê%s\n", 
ít
);

123 
fûes
 = 
	`g_li°_¥ïíd
(fûes, 
	`g_°rdup
(
ít
));

126 i‡(
fûes
 !
NULL
) {

127 
	`autoßve_make_ª°‹e_dülog
(
fûes
);

129 
	`g_dú_˛o£
(
dú
);

130 
	`g_‰ì
(
ßvedú
);

131 
	`g_li°_‰ì
(
fûes
);

132 
	}
}

	@O:\tool\dvs50\app\autosave.h

19 #i‚de‡
AUTOSAVE_H


20 
	#AUTOSAVE_H


	)

22 
gboﬁón
 
autoßve_check_autoßve
(
gpoöãr
 
d©a
);

	@O:\tool\dvs50\app\color_area.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<°dio.h
>

25 
	~"../lib/cﬁ‹.h
"

26 
	~"öé.h
"

28 
	~"cﬁ‹_¨ó.h
"

29 
	~"©åibuãs.h
"

30 
	~"≥rsi°í˚.h
"

32 
	#FORE_AREA
 0

	)

33 
	#BACK_AREA
 1

	)

34 
	#SWAP_AREA
 2

	)

35 
	#DEF_AREA
 3

	)

37 
	#FOREGROUND
 0

	)

38 
	#BACKGROUND
 1

	)

41 
	ga˘ive_cﬁ‹
 = 0;

44 
GtkWidgë
 *
	gcﬁ‹_¨ó
;

45 
GdkGC
 *
	gcﬁ‹_¨ó_gc
 = 
NULL
;

46 
GdkGC
 *
	gmask_gc
 = 
NULL
;

47 
GdkPixm≠
 *
	gcﬁ‹_¨ó_pixm≠
 = 
NULL
;

48 
GdkBôm≠
 *
	gcﬁ‹_¨ó_mask
 = 
NULL
;

49 
GdkPixm≠
 *
	gdeÁu…_pixm≠
 = 
NULL
;

50 
GdkBôm≠
 *
	gdeÁu…_mask
 = 
NULL
;

51 
GdkPixm≠
 *
	gsw≠_pixm≠
 = 
NULL
;

52 
GdkBôm≠
 *
	gsw≠_mask
 = 
NULL
;

54 
GtkWidgë
 *
	gcﬁ‹_£À˘
 = 
NULL
;

55 
	gcﬁ‹_£À˘_a˘ive
 = 0;

56 
	gedô_cﬁ‹
;

57 
Cﬁ‹
 
	g°‹ed_f‹eground
;

58 
Cﬁ‹
 
	g°‹ed_background
;

62 
cﬁ‹_£À˘i⁄_ok
 (
GtkWidgë
 *
w
,

63 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
);

65 
cﬁ‹_£À˘i⁄_ˇn˚l
 (
GtkWidgë
 *
w
,

66 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
);

68 
cﬁ‹_£À˘i⁄_ˇn˚l
 (
GtkWidgë
 *
w
,

69 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
);

70 
göt


71 
cﬁ‹_£À˘i⁄_dñëe
 (
GtkWidgë
 *
w
,

72 
GdkEvít
 *
evít
,

73 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
);

74 
göt


75 
cﬁ‹_£À˘i⁄_de°roy
 (
GtkWidgë
 *
w
,

76 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
);

78 
cﬁ‹_£À˘i⁄_ch™ged
 (
GtkWidgë
 *
w
,

79 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
);

83 
	$cﬁ‹_¨ó_èrgë
 (
x
,

84 
y
)

86 
göt
 
ª˘_w
, 
ª˘_h
;

87 
göt
 
width
, 
height
;

89 
	`gdk_døwabÀ_gë_size
 (
cﬁ‹_¨ó_pixm≠
, &
width
, &
height
);

91 
ª˘_w
 = 
width
 * 0.65;

92 
ª˘_h
 = 
height
 * 0.65;

95 i‡(
x
 > 0 && x < 
ª˘_w
 &&

96 
y
 > 0 && y < 
ª˘_h
)

97  
FORE_AREA
;

98 i‡(
x
 > (
width
 - 
ª˘_w
) && x < width &&

99 
y
 > (
height
 - 
ª˘_h
) && y < height)

100  
BACK_AREA
;

101 i‡(
x
 > 0 && x < (
width
 - 
ª˘_w
) &&

102 
y
 > 
ª˘_h
 && y < 
height
)

103  
DEF_AREA
;

104 i‡(
x
 > 
ª˘_w
 && x < 
width
 &&

105 
y
 > 0 && y < (
height
 - 
ª˘_h
))

106  
SWAP_AREA
;

109 
	}
}

112 
	$cﬁ‹_¨ó_døw
 ()

114 
Cﬁ‹
 
cﬁ
;

115 
GdkCﬁ‹
 *
wö_bg
;

116 
GdkCﬁ‹
 
fg
, 
bg
, 
bd
;

117 
göt
 
ª˘_w
, 
ª˘_h
;

118 
göt
 
width
, 
height
;

119 
göt
 
def_width
, 
def_height
;

120 
göt
 
sw≠_width
, 
sw≠_height
;

121 
GdkCﬁ‹
 
mask_∑âîn
;

126 i‡(!
cﬁ‹_¨ó_pixm≠
 || !
cﬁ‹_¨ó_gc
)

129 
	`gdk_døwabÀ_gë_size
 (
cﬁ‹_¨ó_pixm≠
, &
width
, &
height
);

131 
wö_bg
 = &(
cﬁ‹_¨ó
->
°yÀ
->
bg
[
GTK_STATE_NORMAL
]);

132 
cﬁ
 = 
	`©åibuãs_gë_f‹eground
();

133 
	`cﬁ‹_c⁄vît
(&
cﬁ
, &
fg
);

134 
cﬁ
 = 
	`©åibuãs_gë_background
();

135 
	`cﬁ‹_c⁄vît
(&
cﬁ
, &
bg
);

136 
bd
 = 
cﬁ‹_gdk_bœck
;

138 
ª˘_w
 = 
width
 * 0.65;

139 
ª˘_h
 = 
height
 * 0.65;

142 
mask_∑âîn
.
pixñ
 = 0;

143 
	`gdk_gc_£t_f‹eground
 (
mask_gc
, &
mask_∑âîn
);

144 
	`gdk_døw_ª˘™gÀ
 (
cﬁ‹_¨ó_mask
, 
mask_gc
, 
TRUE
, 0, 0, -1, -1);

147 
mask_∑âîn
.
pixñ
 = 1;

148 
	`gdk_gc_£t_f‹eground
 (
mask_gc
, &
mask_∑âîn
);

150 
	`gdk_gc_£t_f‹eground
 (
cﬁ‹_¨ó_gc
, 
wö_bg
);

151 
	`gdk_døw_ª˘™gÀ
 (
cﬁ‹_¨ó_pixm≠
, 
cﬁ‹_¨ó_gc
, 1,

152 0, 0, 
width
, 
height
);

154 
	`gdk_gc_£t_f‹eground
 (
cﬁ‹_¨ó_gc
, &
bg
);

155 
	`gdk_døw_ª˘™gÀ
 (
cﬁ‹_¨ó_pixm≠
, 
cﬁ‹_¨ó_gc
, 1,

156 (
width
 - 
ª˘_w
), (
height
 - 
ª˘_h
),Ñect_w,Ñect_h);

157 
	`gdk_døw_ª˘™gÀ
 (
cﬁ‹_¨ó_mask
, 
mask_gc
, 
TRUE
,

158 (
width
 - 
ª˘_w
), (
height
 - 
ª˘_h
),Ñect_w,Ñect_h);

160 i‡(
a˘ive_cﬁ‹
 =
FOREGROUND
)

161 
	`gtk_∑öt_shadow
 (
cﬁ‹_¨ó
->
°yÀ
, 
cﬁ‹_¨ó_pixm≠
, 
GTK_STATE_NORMAL
,

162 
GTK_SHADOW_OUT
,

163 
NULL
, 
cﬁ‹_¨ó
, NULL,

164 (
width
 - 
ª˘_w
), (
height
 - 
ª˘_h
),

165 
ª˘_w
, 
ª˘_h
);

167 
	`gtk_∑öt_shadow
 (
cﬁ‹_¨ó
->
°yÀ
, 
cﬁ‹_¨ó_pixm≠
, 
GTK_STATE_NORMAL
,

168 
GTK_SHADOW_IN
,

169 
NULL
, 
cﬁ‹_¨ó
, NULL,

170 (
width
 - 
ª˘_w
), (
height
 - 
ª˘_h
),

171 
ª˘_w
, 
ª˘_h
);

173 
	`gdk_gc_£t_f‹eground
 (
cﬁ‹_¨ó_gc
, &
fg
);

174 
	`gdk_døw_ª˘™gÀ
 (
cﬁ‹_¨ó_pixm≠
, 
cﬁ‹_¨ó_gc
, 1,

175 0, 0, 
ª˘_w
, 
ª˘_h
);

176 
	`gdk_døw_ª˘™gÀ
 (
cﬁ‹_¨ó_mask
, 
mask_gc
, 
TRUE
,

177 0, 0, 
ª˘_w
, 
ª˘_h
);

179 i‡(
a˘ive_cﬁ‹
 =
FOREGROUND
)

180 
	`gtk_∑öt_shadow
 (
cﬁ‹_¨ó
->
°yÀ
, 
cﬁ‹_¨ó_pixm≠
, 
GTK_STATE_NORMAL
,

181 
GTK_SHADOW_IN
,

182 
NULL
, 
cﬁ‹_¨ó
, NULL,

184 
ª˘_w
, 
ª˘_h
);

186 
	`gtk_∑öt_shadow
 (
cﬁ‹_¨ó
->
°yÀ
, 
cﬁ‹_¨ó_pixm≠
, 
GTK_STATE_NORMAL
,

187 
GTK_SHADOW_OUT
,

188 
NULL
, 
cﬁ‹_¨ó
, NULL,

190 
ª˘_w
, 
ª˘_h
);

193 
	`gdk_døwabÀ_gë_size
 (
deÁu…_pixm≠
, &
def_width
, &
def_height
);

194 
	`gdk_døw_døwabÀ
 (
cﬁ‹_¨ó_pixm≠
, 
cﬁ‹_¨ó_gc
, 
deÁu…_pixm≠
,

195 0, 0, 0, 
height
 - 
def_height
, 
def_width
, def_height);

196 
	`gdk_døw_døwabÀ
 (
cﬁ‹_¨ó_mask
, 
mask_gc
, 
deÁu…_mask
,

197 0, 0, 0, 
height
 - 
def_height
, 
def_width
, def_height);

200 
	`gdk_døwabÀ_gë_size
 (
sw≠_pixm≠
, &
sw≠_width
, &
sw≠_height
);

201 
	`gdk_døw_døwabÀ
 (
cﬁ‹_¨ó_pixm≠
, 
cﬁ‹_¨ó_gc
, 
sw≠_pixm≠
,

202 0, 0, 
width
 - 
sw≠_width
, 0, sw≠_width, 
sw≠_height
);

203 
	`gdk_døw_døwabÀ
 (
cﬁ‹_¨ó_mask
, 
mask_gc
, 
sw≠_mask
,

204 0, 0, 
width
 - 
sw≠_width
, 0, sw≠_width, 
sw≠_height
);

207 
	`gdk_gc_£t_˛ù_mask
 (
cﬁ‹_¨ó_gc
, 
cﬁ‹_¨ó_mask
);

208 
	`gdk_gc_£t_˛ù_‹igö
 (
cﬁ‹_¨ó_gc
, 0, 0);

209 
	`gdk_døw_døwabÀ
 (
cﬁ‹_¨ó
->
wödow
, 
cﬁ‹_¨ó_gc
, 
cﬁ‹_¨ó_pixm≠
,

210 0, 0, 0, 0, 
width
, 
height
);

213 
	`gdk_gc_£t_˛ù_mask
 (
cﬁ‹_¨ó_gc
, 
NULL
);

214 
	}
}

217 
	$cﬁ‹_£À˘i⁄_ok
 (
GtkWidgë
 *
w
,

218 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
)

220 
GtkCﬁ‹Sñe˘i⁄
 *
cﬁ‹£l
;

221 
GdkCﬁ‹
 
cﬁ‹
;

222 
Cﬁ‹
 
cﬁ
;

224 
cﬁ‹£l
=
	`GTK_COLOR_SELECTION
(
cs
->colorsel);

226 
	`gtk_cﬁ‹_£À˘i⁄_gë_cuºít_cﬁ‹
(
cﬁ‹£l
,&
cﬁ‹
);

227 
	`GDK_COLOR_TO_DIA
(
cﬁ‹
, 
cﬁ
);

229 i‡(
edô_cﬁ‹
 =
FOREGROUND
) {

230 
	`©åibuãs_£t_f‹eground
(&
cﬁ
);

232 
	`©åibuãs_£t_background
(&
cﬁ
);

234 
	`cﬁ‹_¨ó_døw
 ();

238 
	`gtk_widgë_hide
(
cﬁ‹_£À˘
);

239 
cﬁ‹_£À˘_a˘ive
 = 0;

240 
	}
}

243 
	$cﬁ‹_£À˘i⁄_ˇn˚l
 (
GtkWidgë
 *
w
,

244 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
)

246 i‡(
cﬁ‹_£À˘
 !
NULL
)

247 
	`gtk_widgë_hide
(
cﬁ‹_£À˘
);

248 
cﬁ‹_£À˘_a˘ive
 = 0;

249 
	`©åibuãs_£t_f‹eground
(&
°‹ed_f‹eground
);

250 
	`©åibuãs_£t_background
(&
°‹ed_background
);

252 
	`cﬁ‹_¨ó_døw
 ();

253 
	}
}

255 
göt


256 
	$cﬁ‹_£À˘i⁄_dñëe
 (
GtkWidgë
 *
w
,

257 
GdkEvít
 *
evít
,

258 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
)

260 
	`cﬁ‹_£À˘i⁄_ˇn˚l
(
w
,
cs
);

261  
TRUE
;

262 
	}
}

264 
göt


265 
	$cﬁ‹_£À˘i⁄_de°roy
 (
GtkWidgë
 *
w
,

266 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
)

268 
cﬁ‹_£À˘
 = 
NULL
;

269 
	`cﬁ‹_£À˘i⁄_ˇn˚l
(
w
,
cs
);

270  
TRUE
;

271 
	}
}

274 
	$cﬁ‹_£À˘i⁄_ch™ged
 (
GtkWidgë
 *
w
,

275 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
cs
)

277 
GtkCﬁ‹Sñe˘i⁄
 *
cﬁ‹£l
;

278 
GdkCﬁ‹
 
cﬁ‹
;

279 
Cﬁ‹
 
cﬁ
;

281 
cﬁ‹£l
=
	`GTK_COLOR_SELECTION
(
cs
->colorsel);

283 
	`gtk_cﬁ‹_£À˘i⁄_gë_cuºít_cﬁ‹
(
cﬁ‹£l
,&
cﬁ‹
);

284 
	`GDK_COLOR_TO_DIA
(
cﬁ‹
, 
cﬁ
);

286 i‡(
edô_cﬁ‹
 =
FOREGROUND
) {

287 
	`©åibuãs_£t_f‹eground
(&
cﬁ
);

289 
	`©åibuãs_£t_background
(&
cﬁ
);

291 
	`cﬁ‹_¨ó_døw
 ();

292 
	}
}

295 
	$cﬁ‹_¨ó_edô
 ()

297 
Cﬁ‹
 
cﬁ
;

298 
GtkWidgë
 *
wödow
;

299 
GdkCﬁ‹
 
cﬁ‹
;

301 i‡(!
cﬁ‹_£À˘_a˘ive
) {

302 
°‹ed_f‹eground
 = 
	`©åibuãs_gë_f‹eground
();

303 
°‹ed_background
 = 
	`©åibuãs_gë_background
();

306 i‡(
a˘ive_cﬁ‹
 =
FOREGROUND
) {

307 
cﬁ
 = 
	`©åibuãs_gë_f‹eground
();

308 
edô_cﬁ‹
 = 
FOREGROUND
;

310 
cﬁ
 = 
	`©åibuãs_gë_background
();

311 
edô_cﬁ‹
 = 
BACKGROUND
;

314 i‡(! 
cﬁ‹_£À˘
) {

315 
wödow
 = 
cﬁ‹_£À˘
 =

316 
	`gtk_cﬁ‹_£À˘i⁄_dülog_√w
(
edô_cﬁ‹
==
FOREGROUND
?

317 
	`_
("Select foreground color"):

318 
	`_
("Select background color"));

319 
cﬁ‹_£À˘_a˘ive
 = 1;

321 
	`gtk_cﬁ‹_£À˘i⁄_£t_has_∑Àâe
 (

322 
	`GTK_COLOR_SELECTION
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
wödow
)->
cﬁ‹£l
),

323 
TRUE
);

325 
	`gtk_wödow_£t_posôi⁄
 (
	`GTK_WINDOW
 (
wödow
), 
GTK_WIN_POS_MOUSE
);

327 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
wödow
), "delete_event",

328 
	`G_CALLBACK
(
cﬁ‹_£À˘i⁄_dñëe
),

329 
wödow
);

331 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
wödow
), "destroy",

332 
	`G_CALLBACK
(
cﬁ‹_£À˘i⁄_de°roy
),

333 
wödow
);

335 
	`g_sig«l_c⁄√˘
 (

336 
	`G_OBJECT
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
wödow
)->
cﬁ‹£l
),

338 
	`G_CALLBACK
(
cﬁ‹_£À˘i⁄_ch™ged
),

339 
wödow
);

341 
	`g_sig«l_c⁄√˘
 (

342 
	`G_OBJECT
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
wödow
)->
ok_buâ⁄
),

344 
	`G_CALLBACK
(
cﬁ‹_£À˘i⁄_ok
),

345 
wödow
);

347 
	`g_sig«l_c⁄√˘
 (

348 
	`G_OBJECT
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
wödow
)->
ˇn˚l_buâ⁄
),

350 
	`G_CALLBACK
(
cﬁ‹_£À˘i⁄_ˇn˚l
),

351 
wödow
);

355 
	`gtk_widgë_show_now
 (
cﬁ‹_£À˘
);

358 
	`gtk_wödow_£t_tôÀ
(
	`GTK_WINDOW
(
cﬁ‹_£À˘
),

359 
edô_cﬁ‹
==
FOREGROUND
?

360 
	`_
("Select foreground color"):

361 
	`_
("Select background color"));

362 i‡(! 
cﬁ‹_£À˘_a˘ive
) {

363 
	`gtk_widgë_show
 (
cﬁ‹_£À˘
);

366 
	`DIA_COLOR_TO_GDK
(
cﬁ
, 
cﬁ‹
);

368 
	`gtk_cﬁ‹_£À˘i⁄_£t_cuºít_cﬁ‹
(

369 
	`GTK_COLOR_SELECTION
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
cﬁ‹_£À˘
)->
cﬁ‹£l
),

370 &
cﬁ‹
);

372 
	}
}

374 
göt


375 
	$cﬁ‹_¨ó_evíts
 (
GtkWidgë
 *
widgë
,

376 
GdkEvít
 *
evít
)

378 
GdkEvítBuâ⁄
 *
bevít
;

379 
èrgë
;

381 
evít
->
ty≥
)

383 
GDK_CONFIGURE
:

384 i‡(
cﬁ‹_¨ó_pixm≠
)

386 
	`g_obje˘_uƒef
 (
cﬁ‹_¨ó_pixm≠
);

387 
	`g_obje˘_uƒef
 (
cﬁ‹_¨ó_mask
);

390 
cﬁ‹_¨ó_pixm≠
 = 
	`gdk_pixm≠_√w
 (
cﬁ‹_¨ó
->
wödow
,

391 
cﬁ‹_¨ó
->
Æloˇti⁄
.
width
,

392 
cﬁ‹_¨ó
->
Æloˇti⁄
.
height
, -1);

393 
cﬁ‹_¨ó_mask
 = 
	`gdk_pixm≠_√w
 (
cﬁ‹_¨ó
->
wödow
,

394 
cﬁ‹_¨ó
->
Æloˇti⁄
.
width
,

395 
cﬁ‹_¨ó
->
Æloˇti⁄
.
height
, 1);

397 
GDK_EXPOSE
:

398 i‡(
	`GTK_WIDGET_DRAWABLE
 (
cﬁ‹_¨ó
))

400 i‡(!
cﬁ‹_¨ó_gc
)

402 
cﬁ‹_¨ó_gc
 = 
	`gdk_gc_√w
 (
cﬁ‹_¨ó
->
wödow
);

403 
mask_gc
 = 
	`gdk_gc_√w
 (
cﬁ‹_¨ó_mask
);

406 
	`cﬁ‹_¨ó_døw
 ();

409 
GDK_BUTTON_PRESS
:

410 
bevít
 = (
GdkEvítBuâ⁄
 *Ë
evít
;

412 i‡(
bevít
->
buâ⁄
 == 1) {

413 (
èrgë
 = 
	`cﬁ‹_¨ó_èrgë
 (
bevít
->
x
, bevít->
y
))) {

414 
FORE_AREA
:

415 
BACK_AREA
:

416 i‡(
èrgë
 =
a˘ive_cﬁ‹
) {

417 
	`cﬁ‹_¨ó_edô
 ();

419 
a˘ive_cﬁ‹
 = 
èrgë
;

420 
	`cﬁ‹_¨ó_døw
();

423 
SWAP_AREA
:

424 
	`©åibuãs_sw≠_fgbg
();

425 
	`cﬁ‹_¨ó_døw
();

427 
DEF_AREA
:

428 
	`©åibuãs_deÁu…_fgbg
();

429 
	`cﬁ‹_¨ó_døw
();

439  
FALSE
;

440 
	}
}

443 
GtkWidgë
 *

444 
	$cﬁ‹_¨ó_¸óã
 (
width
,

445 
height
,

446 
GdkPixm≠
 *
deÁu…_pm≠
,

447 
GdkBôm≠
 *
deÁu…_msk
,

448 
GdkPixm≠
 *
sw≠_pm≠
,

449 
GdkBôm≠
 *
sw≠_msk
)

451 
GtkWidgë
 *
evít_box
;

453 
	`©åibuãs_£t_f‹eground
(
	`≥rsi°í˚_ªgi°î_cﬁ‹
("fg_cﬁ‹", &
cﬁ‹_bœck
));

454 
	`©åibuãs_£t_background
(
	`≥rsi°í˚_ªgi°î_cﬁ‹
("bg_cﬁ‹", &
cﬁ‹_whôe
));

456 
evít_box
 = 
	`gtk_evít_box_√w
();

457 
cﬁ‹_¨ó
 = 
	`gtk_døwög_¨ó_√w
 ();

458 
	`gtk_widgë_£t_size_ªque°
 (
cﬁ‹_¨ó
, 
width
, 
height
);

459 
	`gtk_widgë_£t_evíts
 (
cﬁ‹_¨ó
, 
GDK_EXPOSURE_MASK
 | 
GDK_BUTTON_PRESS_MASK
);

460 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
cﬁ‹_¨ó
), "event",

461 
	`G_CALLBACK
(
cﬁ‹_¨ó_evíts
),

462 
NULL
);

463 
deÁu…_pixm≠
 = 
deÁu…_pm≠
;

464 
deÁu…_mask
 = 
deÁu…_msk
;

465 
sw≠_pixm≠
 = 
sw≠_pm≠
;

466 
sw≠_mask
 = 
sw≠_msk
;

468 
	`gtk_widgë_show
(
cﬁ‹_¨ó
);

469 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
evít_box
), 
cﬁ‹_¨ó
);

470  
evít_box
;

471 
	}
}

	@O:\tool\dvs50\app\color_area.h

18 #i‚de‡
COLOR_AREA_H


19 
	#COLOR_AREA_H


	)

21 
	~<gtk/gtk.h
>

23 
GtkWidgë
 *
cﬁ‹_¨ó_¸óã
 (
width
,

24 
height
,

25 
GdkPixm≠
 *
deÁu…_pm≠
,

26 
GdkBôm≠
 *
deÁu…_msk
,

27 
GdkPixm≠
 *
sw≠_pm≠
,

28 
GdkBôm≠
 *
sw≠_msk
);

	@O:\tool\dvs50\app\commands.c

18 
	~<c⁄fig.h
>

20 #ifde‡
HAVE_UNISTD_H


21 
	~<uni°d.h
>

23 
	~<°dlib.h
>

24 
	~<°dio.h
>

25 
	~<°rög.h
>

26 
	~<sys/ty≥s.h
>

27 
	~<m©h.h
>

28 
	~<glib.h
>

30 #ifde‡
GNOME


31 #unde‡
GTK_DISABLE_DEPRECATED


32 
	~<gnome.h
>

35 
	~<gdk-pixbuf/gdk-pixbuf.h
>

36 
	~<gtk/gtk.h
>

38 
	~<ãxãdô.h
>

39 
	~<focus.h
>

40 
	~"c⁄fúm.h
"

47 #ifde‡
G_OS_WIN32


53 
__°dˇŒ


54 
ShñlExecuãA
 (
hwnd
,

55 c⁄° * 
ÕO≥øti⁄
,

56 c⁄° * 
ÕFûe
,

57 c⁄° * 
ÕP¨amëîs
,

58 c⁄° * 
ÕDúe˘‹y
,

59 
nShowCmd
);

62 
	~"öé.h
"

63 
	~"comm™ds.h
"

64 
	~"≠p_¥ocs.h
"

65 
	~"dügøm.h
"

66 
	~"di•œy.h
"

67 
	~"obje˘_›s.h
"

68 
	~"cut_n_∑°e.h
"

69 
	~"öãrÁ˚.h
"

70 
	~"lﬂd_ßve.h
"

71 
	~"utûs.h
"

72 
	~"mesßge.h
"

73 
	~"grid.h
"

74 
	~"¥›îtõs-dülog.h
"

75 
	~"¥›öã∫Æs.h
"

76 
	~"¥e„ªn˚s.h
"

77 
	~"œyî_dülog.h
"

78 
	~"c⁄√˘i⁄poöt_›s.h
"

79 
	~"undo.h
"

80 
	~"∑ge£tup.h
"

81 
	~"ãxt.h
"

82 
	~"dü_dús.h
"

83 
	~"focus.h
"

84 
	~<gdk/gdk.h
>

85 
	~<gdk/gdkkeysyms.h
>

86 
	~"lib/¥›îtõs.h
"

87 
	~"lib/∑ª¡.h
"

88 
	~"dü-¥›s.h
"

89 
	~"dügøm_åì_wödow.h
"

90 
	~"auth‹s.h
"

93 
	$fûe_quô_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

95 
	`≠p_exô
();

96 
	}
}

99 
	$fûe_∑ge£tup_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

101 
Dügøm
 *
dü
;

103 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

104 i‡(!
dü
) ;

105 
	`¸óã_∑ge_£tup_dlg
(
dü
);

106 
	}
}

109 
	$fûe_¥öt_ˇŒback
 (
GtkA˘i⁄
 *
_a˘i⁄
)

111 
Dügøm
 *
dü
;

112 
DDi•œy
 *
ddi•
;

113 
GtkA˘i⁄
 *
a˘i⁄
;

115 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

116 i‡(!
dü
) ;

117 
ddi•
 = 
	`ddi•œy_a˘ive
();

118 i‡(!
ddi•
) ;

120 
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("FilePrintGTK");

121 i‡(!
a˘i⁄
)

122 
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("FilePrintGDI");

123 i‡(!
a˘i⁄
)

124 
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("FilePrintPS");

126 i‡(
a˘i⁄
) {

127 i‡(
	`c⁄fúm_exp‹t_size
 (
dü
, 
	`GTK_WINDOW
(
ddi•
->
shñl
), 
CONFIRM_PRINT
|
CONFIRM_PAGES
))

128 
	`gtk_a˘i⁄_a˘iv©e
 (
a˘i⁄
);

130 
	`mesßge_îr‹
 (
	`_
("NoÖrintÖlug-in found!"));

132 
	}
}

135 
	$fûe_˛o£_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

138 i‡(
	`ddi•œy_a˘ive
())

139 
	`ddi•œy_˛o£
(
	`ddi•œy_a˘ive
());

140 
	}
}

143 
	$fûe_√w_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

145 
Dügøm
 *
dü
;

146 
DDi•œy
 *
ddi•
;

147 
u¡ôÀd_ƒ
 = 1;

148 
gch¨
 *
«me
, *
fûíame
;

150 
«me
 = 
	`g_°rdup_¥ötf
(
	`_
("Dügøm%d.dü"), 
u¡ôÀd_ƒ
++);

151 
fûíame
 = 
	`g_fûíame_‰om_utf8
(
«me
, -1, 
NULL
, NULL, NULL);

152 
dü
 = 
	`√w_dügøm
(
fûíame
);

153 
ddi•
 = 
	`√w_di•œy
(
dü
);

154 
	`dügøm_åì_add
(
	`dügøm_åì
(), 
dü
);

155 
	`g_‰ì
 (
«me
);

156 
	`g_‰ì
 (
fûíame
);

157 
	}
}

160 
	$fûe_¥e„ªn˚s_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

162 
	`¥efs_show
();

163 
	}
}

174 
	$ö£π_ãxt
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
, c⁄° 
gch¨
 *
ãxt
)

176 
Obje˘Ch™ge
 *
ch™ge
 = 
NULL
;

177 
modifõd
 = 
FALSE
, 
™y_modifõd
 = FALSE;

178 
DüObje˘
 *
obj
 = 
	`focus_gë_obje˘
(
focus
);

180 
ãxt
 !
NULL
) {

181 
gch¨
 *
√xt_löe
 = 
	`g_utf8_°rchr
(
ãxt
, -1, '\n');

182 i‡(
√xt_löe
 !
ãxt
) {

183 
göt
 
Àn
 = 
	`g_utf8_°æí
(
ãxt
, (
√xt_löe
-text));

184 
modifõd
 = (*
focus
->
key_evít
)(focus, 
GDK_A
, 
ãxt
, 
Àn
, &
ch™ge
);

186 i‡(
√xt_löe
 !
NULL
) {

187 
modifõd
 = (*
focus
->
key_evít
)(focus, 
GDK_Rëu∫
, "\n", 1, &
ch™ge
);

188 
ãxt
 = 
	`g_utf8_√xt_ch¨
(
√xt_löe
);

190 
ãxt
 = 
NULL
;

193 
Poöt
 
p
 = 
obj
->
posôi⁄
;

194 (
obj
->
›s
->
move
)(obj,&
p
); }

197 
	`obje˘_add_upd©es
(
obj
, 
ddi•
->
dügøm
);

199 i‡(
modifõd
 && (
ch™ge
 !
NULL
)) {

200 
	`undo_obje˘_ch™ge
(
ddi•
->
dügøm
, 
obj
, 
ch™ge
);

201 
™y_modifõd
 = 
TRUE
;

204 
	`dügøm_Êush
(
ddi•
->
dügøm
);

207 i‡(
™y_modifõd
) {

208 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

209 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

210 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

212 
	}
}

216 
	$ª˚ived_˛ùbﬂrd_h™dÀr
(
GtkClùbﬂrd
 *
˛ùbﬂrd
,

217 c⁄° 
gch¨
 *
ãxt
,

218 
gpoöãr
 
d©a
) {

219 
DDi•œy
 *
ddi•
 = (DDi•œy *)
d©a
;

220 
Focus
 *
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

222 i‡(
ãxt
 =
NULL
) ;

224 i‡((
focus
 =
NULL
Ë|| (!focus->
has_focus
)) ;

226 i‡(!
	`g_utf8_vÆid©e
(
ãxt
, -1, 
NULL
)) {

227 
	`mesßge_îr‹
("Not valid UTF8");

231 
	`ö£π_ãxt
(
ddi•
, 
focus
, 
ãxt
);

232 
	}
}

234 
Pr›Des¸ùti⁄
 
	gãxt_¥›_sögÀt⁄_desc
[] = {

235 { "ãxt", 
PROP_TYPE_TEXT
 },

236 
PROP_DESC_END
};

239 
	$make_ãxt_¥›_sögÀt⁄
(
GPåAºay
 **
¥›s
, 
TextPr›îty
 **
¥›
)

241 *
¥›s
 = 
	`¥›_li°_‰om_descs
(
ãxt_¥›_sögÀt⁄_desc
,
pdçp_åue
);

242 
	`g_as£π
((*
¥›s
)->
Àn
 == 1);

244 *
¥›
 = 
	`g_±r_¨øy_ödex
((*
¥›s
),0);

245 
	`g_‰ì
((*
¥›
)->
ãxt_d©a
);

246 (*
¥›
)->
ãxt_d©a
 = 
NULL
;

247 
	}
}

251 
	$edô_c›y_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

253 
GLi°
 *
c›y_li°
;

254 
DDi•œy
 *
ddi•
;

256 
ddi•
 = 
	`ddi•œy_a˘ive
();

257 i‡(!
ddi•
) ;

258 i‡(
	`ãxãdô_mode
(
ddi•
)) {

259 
Focus
 *
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

260 
DüObje˘
 *
obj
 = 
	`focus_gë_obje˘
(
focus
);

261 
GPåAºay
 *
ãxçr›s
;

262 
TextPr›îty
 *
¥›
;

264 i‡(
obj
->
›s
->
gë_¥›s
 =
NULL
)

267 
	`make_ãxt_¥›_sögÀt⁄
(&
ãxçr›s
,&
¥›
);

269 
obj
->
›s
->
	`gë_¥›s
(obj, 
ãxçr›s
);

274 #ifde‡
G_OS_WIN32


275 
	`gtk_˛ùbﬂrd_£t_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_NONE
),

276 
¥›
->
ãxt_d©a
, -1);

278 
	`gtk_˛ùbﬂrd_£t_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_SELECTION_PRIMARY
),

279 
¥›
->
ãxt_d©a
, -1);

281 
	`¥›_li°_‰ì
(
ãxçr›s
);

283 
c›y_li°
 = 
	`∑ª¡_li°_af„˘ed
(
	`dügøm_gë_s‹ãd_£À˘ed
(
ddi•
->
dügøm
));

285 
	`˙p_°‹e_obje˘s
(
	`obje˘_c›y_li°
(
c›y_li°
), 1);

286 
	`g_li°_‰ì
(
c›y_li°
);

288 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

290 
	}
}

293 
	$edô_cut_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

295 
GLi°
 *
cut_li°
;

296 
DDi•œy
 *
ddi•
;

297 
Ch™ge
 *
ch™ge
;

299 
ddi•
 = 
	`ddi•œy_a˘ive
();

300 i‡(!
ddi•
) ;

302 i‡(
	`ãxãdô_mode
(
ddi•
)) {

304 
	`dügøm_£À˘ed_bªak_exã∫Æ
(
ddi•
->
dügøm
);

306 
cut_li°
 = 
	`∑ª¡_li°_af„˘ed
(
	`dügøm_gë_s‹ãd_£À˘ed
(
ddi•
->
dügøm
));

308 
	`˙p_°‹e_obje˘s
(
	`obje˘_c›y_li°
(
cut_li°
), 0);

310 
ch™ge
 = 
	`undo_dñëe_obje˘s_chûdªn
(
ddi•
->
dügøm
, 
cut_li°
);

311 (
ch™ge
->
≠∂y
)(ch™ge, 
ddi•
->
dügøm
);

313 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

314 
	`dügøm_Êush
(
ddi•
->
dügøm
);

316 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

317 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

318 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

320 
	}
}

323 
	$edô_∑°e_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

325 
GLi°
 *
∑°e_li°
;

326 
DDi•œy
 *
ddi•
;

327 
Poöt
 
∑°e_c‹√r
;

328 
Poöt
 
dñè
;

329 
Ch™ge
 *
ch™ge
;

330 
gíî©i⁄
 = 0;

332 
ddi•
 = 
	`ddi•œy_a˘ive
();

333 i‡(!
ddi•
) ;

334 i‡(
	`ãxãdô_mode
(
ddi•
)) {

335 #ifde‡
G_OS_WIN32


336 
	`gtk_˛ùbﬂrd_ªque°_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_NONE
),

337 
ª˚ived_˛ùbﬂrd_h™dÀr
, 
ddi•
);

339 
	`gtk_˛ùbﬂrd_ªque°_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_SELECTION_PRIMARY
),

340 
ª˚ived_˛ùbﬂrd_h™dÀr
, 
ddi•
);

343 i‡(!
	`˙p_exi°_°‹ed_obje˘s
()) {

344 
	`mesßge_w¨nög
(
	`_
("NoÉxisting objectÅoÖaste.\n"));

348 
∑°e_li°
 = 
	`˙p_gë_°‹ed_obje˘s
(&
gíî©i⁄
);

350 
∑°e_c‹√r
 = 
	`obje˘_li°_c‹√r
(
∑°e_li°
);

352 
dñè
.
x
 = 
ddi•
->
visibÀ
.
À·
 - 
∑°e_c‹√r
.x;

353 
dñè
.
y
 = 
ddi•
->
visibÀ
.
t›
 - 
∑°e_c‹√r
.y;

356 
dñè
.
x
 +(
ddi•
->
visibÀ
.
right
 - ddi•->visibÀ.
À·
Ë* 0.1 * 
gíî©i⁄
;

357 
dñè
.
y
 +(
ddi•
->
visibÀ
.
bŸtom
 - ddi•->visibÀ.
t›
Ë* 0.1 * 
gíî©i⁄
;

359 i‡(
gíî©i⁄
)

360 
	`obje˘_li°_move_dñè
(
∑°e_li°
, &
dñè
);

362 
ch™ge
 = 
	`undo_ö£π_obje˘s
(
ddi•
->
dügøm
, 
∑°e_li°
, 0);

363 (
ch™ge
->
≠∂y
)(ch™ge, 
ddi•
->
dügøm
);

365 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

366 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

368 
	`dügøm_ªmove_Æl_£À˘ed
(
ddi•
->
dügøm
, 
TRUE
);

369 
	`dügøm_£À˘_li°
(
ddi•
->
dügøm
, 
∑°e_li°
);

371 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

372 
	`dügøm_Êush
(
ddi•
->
dügøm
);

374 
	}
}

386 
	$edô_du∂iˇã_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

388 
GLi°
 *
du∂iˇã_li°
;

389 
DDi•œy
 *
ddi•
;

390 
Poöt
 
du∂iˇã_c‹√r
;

391 
Poöt
 
dñè
;

392 
Ch™ge
 *
ch™ge
;

394 
ddi•
 = 
	`ddi•œy_a˘ive
();

395 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

396 
du∂iˇã_li°
 = 
	`obje˘_c›y_li°
(
	`dügøm_gë_s‹ãd_£À˘ed
(
ddi•
->
dügøm
));

397 
du∂iˇã_c‹√r
 = 
	`obje˘_li°_c‹√r
(
du∂iˇã_li°
);

400 
dñè
.
x
 = (
ddi•
->
visibÀ
.
right
 - ddi•->visibÀ.
À·
)*0.05;

401 
dñè
.
y
 = (
ddi•
->
visibÀ
.
bŸtom
 - ddi•->visibÀ.
t›
)*0.05;

403 
	`obje˘_li°_move_dñè
(
du∂iˇã_li°
, &
dñè
);

405 
ch™ge
 = 
	`undo_ö£π_obje˘s
(
ddi•
->
dügøm
, 
du∂iˇã_li°
, 0);

406 (
ch™ge
->
≠∂y
)(ch™ge, 
ddi•
->
dügøm
);

408 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

409 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

411 
	`dügøm_ªmove_Æl_£À˘ed
(
ddi•
->
dügøm
, 
TRUE
);

412 
	`dügøm_£À˘_li°
(
ddi•
->
dügøm
, 
du∂iˇã_li°
);

414 
	`dügøm_Êush
(
ddi•
->
dügøm
);

416 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

417 
	}
}

420 
	$obje˘s_move_up_œyî
(
GtkA˘i⁄
 *
a˘i⁄
)

422 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

423 
GLi°
 *
£À˘ed_li°
;

424 
Ch™ge
 *
ch™ge
;

426 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

427 
£À˘ed_li°
 = 
	`dügøm_gë_s‹ãd_£À˘ed
(
ddi•
->
dügøm
);

429 
ch™ge
 = 
	`undo_move_obje˘_Ÿhî_œyî
(
ddi•
->
dügøm
, 
£À˘ed_li°
, 
TRUE
);

431 (
ch™ge
->
≠∂y
)(ch™ge, 
ddi•
->
dügøm
);

433 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

434 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

436 
	`dügøm_Êush
(
ddi•
->
dügøm
);

438 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

439 
	}
}

442 
	$obje˘s_move_down_œyî
(
GtkA˘i⁄
 *
a˘i⁄
)

444 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

445 
GLi°
 *
£À˘ed_li°
;

446 
Ch™ge
 *
ch™ge
;

448 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

449 
£À˘ed_li°
 = 
	`dügøm_gë_s‹ãd_£À˘ed
(
ddi•
->
dügøm
);

453 
ch™ge
 = 
	`undo_move_obje˘_Ÿhî_œyî
(
ddi•
->
dügøm
, 
£À˘ed_li°
, 
FALSE
);

455 (
ch™ge
->
≠∂y
)(ch™ge, 
ddi•
->
dügøm
);

457 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

458 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

460 
	`dügøm_Êush
(
ddi•
->
dügøm
);

462 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

463 
	}
}

466 
	$edô_c›y_ãxt_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

468 
Focus
 *
focus
;

469 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

470 
DüObje˘
 *
obj
;

471 
GPåAºay
 *
ãxçr›s
;

472 
TextPr›îty
 *
¥›
;

474 i‡(
ddi•
 =
NULL
) ;

476 
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

478 i‡((
focus
 =
NULL
Ë|| (!focus->
has_focus
)) ;

480 
obj
 = 
	`focus_gë_obje˘
(
focus
);

482 i‡(
obj
->
›s
->
gë_¥›s
 =
NULL
)

485 
	`make_ãxt_¥›_sögÀt⁄
(&
ãxçr›s
,&
¥›
);

487 
obj
->
›s
->
	`gë_¥›s
(obj, 
ãxçr›s
);

492 #ifde‡
G_OS_WIN32


493 
	`gtk_˛ùbﬂrd_£t_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_NONE
),

494 
¥›
->
ãxt_d©a
, -1);

496 
	`gtk_˛ùbﬂrd_£t_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_SELECTION_PRIMARY
),

497 
¥›
->
ãxt_d©a
, -1);

499 
	`¥›_li°_‰ì
(
ãxçr›s
);

500 
	}
}

503 
	$edô_cut_ãxt_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

505 
Focus
 *
focus
;

506 
DDi•œy
 *
ddi•
;

507 
DüObje˘
 *
obj
;

508 
Text
 *
ãxt
;

509 
GPåAºay
 *
ãxçr›s
;

510 
TextPr›îty
 *
¥›
;

511 
Obje˘Ch™ge
 *
ch™ge
;

513 
ddi•
 = 
	`ddi•œy_a˘ive
();

514 i‡(!
ddi•
) ;

516 
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

517 i‡((
focus
 =
NULL
Ë|| (!focus->
has_focus
)) ;

519 
obj
 = 
	`focus_gë_obje˘
(
focus
);

520 
ãxt
 = (
Text
*)
focus
->
u£r_d©a
;

522 i‡(
obj
->
›s
->
gë_¥›s
 =
NULL
)

525 
	`make_ãxt_¥›_sögÀt⁄
(&
ãxçr›s
,&
¥›
);

527 
obj
->
›s
->
	`gë_¥›s
(obj, 
ãxçr›s
);

532 #ifde‡
G_OS_WIN32


533 
	`gtk_˛ùbﬂrd_£t_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_NONE
),

534 
¥›
->
ãxt_d©a
, -1);

536 
	`gtk_˛ùbﬂrd_£t_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_SELECTION_PRIMARY
),

537 
¥›
->
ãxt_d©a
, -1);

540 
	`¥›_li°_‰ì
(
ãxçr›s
);

542 i‡(
	`ãxt_dñëe_Æl
(
ãxt
, &
ch™ge
)) {

543 
	`obje˘_add_upd©es
(
obj
, 
ddi•
->
dügøm
);

544 
	`undo_obje˘_ch™ge
(
ddi•
->
dügøm
, 
obj
, 
ch™ge
);

545 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

546 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

547 
	`dügøm_Êush
(
ddi•
->
dügøm
);

549 
	}
}

552 
	$edô_∑°e_ãxt_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

554 
DDi•œy
 *
ddi•
;

556 
ddi•
 = 
	`ddi•œy_a˘ive
();

557 i‡(!
ddi•
) ;

559 #ifde‡
G_OS_WIN32


560 
	`gtk_˛ùbﬂrd_ªque°_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_NONE
),

561 
ª˚ived_˛ùbﬂrd_h™dÀr
, 
ddi•
);

563 
	`gtk_˛ùbﬂrd_ªque°_ãxt
(
	`gtk_˛ùbﬂrd_gë
(
GDK_SELECTION_PRIMARY
),

564 
ª˚ived_˛ùbﬂrd_h™dÀr
, 
ddi•
);

566 
	}
}

569 
	$edô_dñëe_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

571 
GLi°
 *
dñëe_li°
;

572 
DDi•œy
 *
ddi•
;

575 i‡(
	`gdk_poöãr_is_gøbbed
 ()) {

576 
	`gdk_bìp
 ();

580 
ddi•
 = 
	`ddi•œy_a˘ive
();

581 i‡(!
ddi•
) ;

582 i‡(
	`ãxãdô_mode
(
ddi•
)) {

583 
Obje˘Ch™ge
 *
ch™ge
 = 
NULL
;

584 
Focus
 *
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

585 i‡(!
	`ãxt_dñëe_key_h™dÀr
(
focus
, &
ch™ge
)) {

588 
	`obje˘_add_upd©es
(
focus
->
obj
, 
ddi•
->
dügøm
);

590 
Ch™ge
 *
ch™ge
 = 
NULL
;

591 
	`dügøm_£À˘ed_bªak_exã∫Æ
(
ddi•
->
dügøm
);

593 
dñëe_li°
 = 
	`dügøm_gë_s‹ãd_£À˘ed
(
ddi•
->
dügøm
);

594 
ch™ge
 = 
	`undo_dñëe_obje˘s_chûdªn
(
ddi•
->
dügøm
, 
dñëe_li°
);

595 
	`g_li°_‰ì
(
dñëe_li°
);

596 (
ch™ge
->
≠∂y
)(ch™ge, 
ddi•
->
dügøm
);

598 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

599 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

601 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

602 
	`dügøm_Êush
(
ddi•
->
dügøm
);

604 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

605 
	}
}

608 
	$edô_undo_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

610 
Dügøm
 *
dü
;

612 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

613 i‡(!
dü
) ;

616 
	`undo_ªvît_to_œ°_ç
(
dü
->
undo
);

617 
	`dügøm_modifõd
(
dü
);

618 
	`dügøm_upd©e_exã¡s
(
dü
);

620 
	`dügøm_Êush
(
dü
);

621 
	}
}

624 
	$edô_ªdo_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

626 
Dügøm
 *
dü
;

629 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

630 i‡(!
dü
) ;

632 
	`undo_≠∂y_to_√xt_ç
(
dü
->
undo
);

633 
	`dügøm_modifõd
(
dü
);

634 
	`dügøm_upd©e_exã¡s
(
dü
);

636 
	`dügøm_Êush
(
dü
);

637 
	}
}

640 
	$hñp_m™uÆ_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

642 #ifde‡
GNOME


643 
	`gnome_hñp_di•œy
("dü", 
NULL
, NULL);

645 *
hñpdú
, *
hñpödex
 = 
NULL
, *
comm™d
;

646 
guöt
 
be°sc‹e
 = 
G_MAXINT
;

647 
GDú
 *
dp
;

648 c⁄° *
díåy
;

649 
GEº‹
 *
îr‹
 = 
NULL
;

651 
hñpdú
 = 
	`dü_gë_d©a_dúe˘‹y
("help");

652 i‡(!
hñpdú
) {

653 
	`mesßge_w¨nög
(
	`_
("CouldÇot find help directory"));

658 
dp
 = 
	`g_dú_›í
 (
hñpdú
, 0, &
îr‹
);

659 i‡(!
dp
) {

660 
	`mesßge_w¨nög
(
	`_
("CouldÇot open help directory:\n%s"),

661 
îr‹
->
mesßge
);

662 
	`g_îr‹_‰ì
 (
îr‹
);

666 (
díåy
 = 
	`g_dú_ªad_«me
(
dp
)Ë!
NULL
) {

667 
guöt
 
sc‹e
;

669 
sc‹e
 = 
	`öé_sc‹e_loˇÀ
(
díåy
);

670 i‡(
sc‹e
 < 
be°sc‹e
) {

671 i‡(
hñpödex
)

672 
	`g_‰ì
(
hñpödex
);

673 #ifde‡
G_OS_WIN32


675 
hñpödex
 = 
	`g_°rc⁄ˇt
(
hñpdú
, 
G_DIR_SEPARATOR_S
, 
díåy
,

676 
G_DIR_SEPARATOR_S
 "dü-m™uÆ.chm", 
NULL
);

677 i‡(!
	`g_fûe_ã°
(
hñpödex
, 
G_FILE_TEST_EXISTS
)) {

678 
hñpödex
 = 
	`g_°rc⁄ˇt
(
hñpdú
, 
G_DIR_SEPARATOR_S
, 
díåy
,

679 
G_DIR_SEPARATOR_S
 "ödex.html", 
NULL
);

682 
hñpödex
 = 
	`g_°rc⁄ˇt
(
hñpdú
, 
G_DIR_SEPARATOR_S
, 
díåy
,

683 
G_DIR_SEPARATOR_S
 "ödex.html", 
NULL
);

685 
be°sc‹e
 = 
sc‹e
;

688 
	`g_dú_˛o£
 (
dp
);

689 
	`g_‰ì
(
hñpdú
);

690 i‡(!
hñpödex
) {

691 
	`mesßge_w¨nög
(
	`_
("CouldÇot find help directory"));

695 #ifde‡
G_OS_WIN32


696 
	#SW_SHOWNORMAL
 1

	)

697 
	`ShñlExecuãA
 (0, "›í", 
hñpödex
, 
NULL
, 
hñpdú
, 
SW_SHOWNORMAL
);

699 
comm™d
 = 
	`gëív
("BROWSER");

700 
comm™d
 = 
	`g_°rdup_¥ötf
("%†'fûe://%s' &", comm™d ? comm™d : "xdg-›í", 
hñpödex
);

701 
	`sy°em
(
comm™d
);

702 
	`g_‰ì
(
comm™d
);

705 
	`g_‰ì
(
hñpödex
);

707 
	}
}

710 
	$a˘iv©e_uæ
 (
GtkAboutDülog
 *
about
,

711 c⁄° 
gch¨
 *
lök
,

712 
gpoöãr
 
d©a
)

714 #ifde‡
G_OS_WIN32


715 
	`ShñlExecuãA
 (0, "›í", 
lök
, 
NULL
, NULL, 
SW_SHOWNORMAL
);

717 
gch¨
 *
comm™d
 = 
	`gëív
("BROWSER");

718 
comm™d
 = 
	`g_°rdup_¥ötf
("%†'%s' &", comm™d ? comm™d : "xdg-›í", 
lök
);

719 
	`sy°em
(
comm™d
);

720 
	`g_‰ì
(
comm™d
);

722 
	}
}

725 
	$hñp_about_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

727 c⁄° 
gch¨
 *
å™¶©‹s
 = 
	`_
("translator_credits-PLEASE_ADD_YOURSELF_HERE");

728 c⁄° 
gch¨
 *
li˚n£
 = 
	`_
(

743 
gch¨
 *
dú«me
 = 
	`dü_gë_d©a_dúe˘‹y
("");

744 
gch¨
 *
fûíame
 = 
	`g_buûd_fûíame
 (
dú«me
, "dü-•œsh.≤g", 
NULL
);

745 
GdkPixbuf
 *
logo
 = 
	`gdk_pixbuf_√w_‰om_fûe
(
fûíame
, 
NULL
);

747 
	`gtk_about_dülog_£t_uæ_hook
 (
a˘iv©e_uæ
, 
NULL
, NULL);

748 
	`gtk_show_about_dülog
 (
NULL
,

749 "logo", 
logo
,

751 "vîsi⁄", 
VERSION
,

752 "commíts", 
	`_
("AÖrogram for drawing structured diagrams."),

755 "auth‹s", 
auth‹s
,

756 "documíãrs", 
documít‹s
,

757 "å™¶©‹-¸edôs", 
	`°rcmp
 (
å™¶©‹s
, "translator_credits-PLEASE_ADD_YOURSELF_HERE")

758 ? 
å™¶©‹s
 : 
NULL
,

759 "li˚n£", 
li˚n£
,

760 
NULL
);

761 
	`g_‰ì
 (
dú«me
);

762 
	`g_‰ì
 (
fûíame
);

763 i‡(
logo
)

764 
	`g_obje˘_uƒef
 (
logo
);

765 
	}
}

768 
	$võw_zoom_ö_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

770 
DDi•œy
 *
ddi•
;

771 
Poöt
 
middÀ
;

772 
Re˘™gÀ
 *
visibÀ
;

774 
ddi•
 = 
	`ddi•œy_a˘ive
();

775 i‡(!
ddi•
) ;

776 
visibÀ
 = &
ddi•
->visible;

777 
middÀ
.
x
 = 
visibÀ
->
À·
*0.5 + visibÀ->
right
*0.5;

778 
middÀ
.
y
 = 
visibÀ
->
t›
*0.5 + visibÀ->
bŸtom
*0.5;

780 
	`ddi•œy_zoom
(
ddi•
, &
middÀ
, 
M_SQRT2
);

781 
	}
}

784 
	$võw_zoom_out_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

786 
DDi•œy
 *
ddi•
;

787 
Poöt
 
middÀ
;

788 
Re˘™gÀ
 *
visibÀ
;

790 
ddi•
 = 
	`ddi•œy_a˘ive
();

791 i‡(!
ddi•
) ;

792 
visibÀ
 = &
ddi•
->visible;

793 
middÀ
.
x
 = 
visibÀ
->
À·
*0.5 + visibÀ->
right
*0.5;

794 
middÀ
.
y
 = 
visibÀ
->
t›
*0.5 + visibÀ->
bŸtom
*0.5;

796 
	`ddi•œy_zoom
(
ddi•
, &
middÀ
, 
M_SQRT1_2
);

797 
	}
}

800 
	$võw_zoom_£t_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

802 
Á˘‹
;

804 
Á˘‹
 = 
	`©oi
 (
	`gtk_a˘i⁄_gë_«me
 (
a˘i⁄
Ë+ 
	`°æí
 ("ViewZoom"));

805 
	`võw_zoom_£t
 (
Á˘‹
);

806 
	}
}

809 
	$võw_show_cx_±s_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
)

811 
DDi•œy
 *
ddi•
;

812 
ﬁd_vÆ
;

814 
ddi•
 = 
	`ddi•œy_a˘ive
();

815 i‡(!
ddi•
) ;

817 
ﬁd_vÆ
 = 
ddi•
->
show_cx_±s
;

818 
ddi•
->
show_cx_±s
 = 
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
a˘i⁄
);

820 i‡(
ﬁd_vÆ
 !
ddi•
->
show_cx_±s
) {

821 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

822 
	`ddi•œy_Êush
(
ddi•
);

824 
	}
}

827 
	$võw_unfuŒs¸ìn
 ()

829 
DDi•œy
 *
ddi•
;

830 
GtkToggÀA˘i⁄
 *
ôem
;

832 
ddi•
 = 
	`ddi•œy_a˘ive
();

833 i‡(!
ddi•
) ;

836 
ôem
 = 
	`GTK_TOGGLE_ACTION
 (
	`míus_gë_a˘i⁄
 ("ViewFullscreen"));

837 i‡(
ôem
 && 
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (item)) {

838 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
ôem
, 
FALSE
);

840 
	}
}

843 
	$võw_fuŒs¸ìn_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
)

845 
DDi•œy
 *
ddi•
;

846 
fs
;

848 
ddi•
 = 
	`ddi•œy_a˘ive
();

849 i‡(!
ddi•
) ;

851 
fs
 = 
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
a˘i⁄
);

853 i‡(
fs
)

854 
	`gtk_wödow_fuŒs¸ìn
(
	`GTK_WINDOW
(
ddi•
->
shñl
));

856 
	`gtk_wödow_unfuŒs¸ìn
(
	`GTK_WINDOW
(
ddi•
->
shñl
));

857 
	}
}

860 
	$võw_Ø_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
)

862 
DDi•œy
 *
ddi•
;

863 
Ø
;

865 
ddi•
 = 
	`ddi•œy_a˘ive
();

866 i‡(!
ddi•
) ;

868 
Ø
 = 
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
a˘i⁄
);

870 i‡(
Ø
 !
ddi•
->
Ø_ªndîî
) {

871 
	`ddi•œy_£t_ªndîî
(
ddi•
, 
Ø
);

872 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

873 
	`ddi•œy_Êush
(
ddi•
);

875 
	}
}

878 
	$võw_visibÀ_grid_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
)

880 
DDi•œy
 *
ddi•
;

881 
guöt
 
ﬁd_vÆ
;

883 
ddi•
 = 
	`ddi•œy_a˘ive
();

884 i‡(!
ddi•
) ;

886 
ﬁd_vÆ
 = 
ddi•
->
grid
.
visibÀ
;

887 
ddi•
->
grid
.
visibÀ
 = 
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
a˘i⁄
);

889 i‡(
ﬁd_vÆ
 !
ddi•
->
grid
.
visibÀ
) {

890 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

891 
	`ddi•œy_Êush
(
ddi•
);

893 
	}
}

896 
	$võw_¢≠_to_grid_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
)

898 
DDi•œy
 *
ddi•
;

900 
ddi•
 = 
	`ddi•œy_a˘ive
();

901 i‡(!
ddi•
) ;

903 
	`ddi•œy_£t_¢≠_to_grid
(
ddi•
, 
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
a˘i⁄
));

904 
	}
}

907 
	$võw_¢≠_to_obje˘s_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
)

909 
DDi•œy
 *
ddi•
;

911 
ddi•
 = 
	`ddi•œy_a˘ive
();

912 i‡(!
ddi•
) ;

914 
	`ddi•œy_£t_¢≠_to_obje˘s
(
ddi•
, 
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
a˘i⁄
));

915 
	}
}

918 
	$võw_toggÀ_ruÀrs_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
)

920 
DDi•œy
 *
ddi•
;

922 
ddi•
 = 
	`ddi•œy_a˘ive
();

923 i‡(!
ddi•
) ;

925 i‡(!
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
a˘i⁄
)) {

926 i‡(
	`di•œy_gë_ruÀrs_showög
(
ddi•
)) {

927 
	`di•œy_ruÀrs_hide
 (
ddi•
);

930 i‡(!
	`di•œy_gë_ruÀrs_showög
(
ddi•
)) {

931 
	`di•œy_ruÀrs_show
 (
ddi•
);

934 
	}
}

937 
	$võw_√w_võw_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

939 
Dügøm
 *
dü
;

941 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

942 i‡(!
dü
) ;

944 
	`√w_di•œy
(
dü
);

945 
	}
}

948 
	$võw_˛⁄e_võw_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

950 
DDi•œy
 *
ddi•
;

952 
ddi•
 = 
	`ddi•œy_a˘ive
();

953 i‡(!
ddi•
) ;

955 
	`c›y_di•œy
(
ddi•
);

956 
	}
}

959 
	$võw_show_Æl_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

961 
DDi•œy
 *
ddi•
;

963 
ddi•
 = 
	`ddi•œy_a˘ive
();

964 i‡(!
ddi•
) ;

966 
	`ddi•œy_show_Æl
 (
ddi•
);

967 
	}
}

970 
	$võw_ªdøw_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

972 
DDi•œy
 *
ddi•
;

973 
ddi•
 = 
	`ddi•œy_a˘ive
();

974 i‡(!
ddi•
) ;

975 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

976 
	`ddi•œy_Êush
(
ddi•
);

977 
	}
}

980 
	$võw_dügøm_¥›îtõs_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

982 
DDi•œy
 *
ddi•
;

984 
ddi•
 = 
	`ddi•œy_a˘ive
();

985 i‡(!
ddi•
) ;

986 
	`dügøm_¥›îtõs_show
(
ddi•
->
dügøm
);

987 
	}
}

990 
	$võw_maö_toﬁb¨_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

992 i‡(
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
	`GTK_TOGGLE_ACTION
(
a˘i⁄
)Ë=
TRUE
)

994 
	`öãgøãd_ui_maö_toﬁb¨_show
 ();

998 
	`öãgøãd_ui_maö_toﬁb¨_hide
 ();

1000 
	}
}

1003 
	$võw_maö_°©usb¨_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1005 i‡(
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
	`GTK_TOGGLE_ACTION
(
a˘i⁄
)Ë=
TRUE
)

1007 
	`öãgøãd_ui_maö_°©usb¨_show
 ();

1011 
	`öãgøãd_ui_maö_°©usb¨_hide
 ();

1013 
	}
}

1016 
	$võw_œyîs_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1018 i‡(
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
	`GTK_TOGGLE_ACTION
(
a˘i⁄
)Ë=
TRUE
)

1020 
	`öãgøãd_ui_œyî_võw_show
 ();

1024 
	`öãgøãd_ui_œyî_võw_hide
 ();

1026 
	}
}

1029 
	$œyîs_add_œyî_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1031 
Dügøm
 *
dü
;

1033 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

1034 i‡(!
dü
) ;

1036 
	`dügøm_edô_œyî
 (
dü
, 
NULL
);

1037 
	}
}

1040 
	$œyîs_ª«me_œyî_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1042 
Dügøm
 *
dü
;

1044 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

1045 i‡(!
dü
) ;

1047 
	`dügøm_edô_œyî
 (
dü
, dü->
d©a
->
a˘ive_œyî
);

1048 
	}
}

1051 
	$obje˘s_∂a˚_ovî_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1053 
	`dügøm_∂a˚_ovî_£À˘ed
(
	`ddi•œy_a˘ive_dügøm
());

1054 
	}
}

1057 
	$obje˘s_∂a˚_undî_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1059 
	`dügøm_∂a˚_undî_£À˘ed
(
	`ddi•œy_a˘ive_dügøm
());

1060 
	}
}

1063 
	$obje˘s_∂a˚_up_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1065 
	`dügøm_∂a˚_up_£À˘ed
(
	`ddi•œy_a˘ive_dügøm
());

1066 
	}
}

1069 
	$obje˘s_∂a˚_down_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1071 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

1072 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

1074 
	`dügøm_∂a˚_down_£À˘ed
(
	`ddi•œy_a˘ive_dügøm
());

1075 
	}
}

1078 
	$obje˘s_∑ª¡_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1080 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

1081 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

1083 
	`dügøm_∑ª¡_£À˘ed
(
	`ddi•œy_a˘ive_dügøm
());

1084 
	}
}

1087 
	$obje˘s_u≈¨ít_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1089 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

1090 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

1092 
	`dügøm_u≈¨ít_£À˘ed
(
	`ddi•œy_a˘ive_dügøm
());

1093 
	}
}

1096 
	$obje˘s_u≈¨ít_chûdªn_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1098 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

1099 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

1101 
	`dügøm_u≈¨ít_chûdªn_£À˘ed
(
	`ddi•œy_a˘ive_dügøm
());

1102 
	}
}

1105 
	$obje˘s_group_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1107 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

1108 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

1110 
	`dügøm_group_£À˘ed
(
	`ddi•œy_a˘ive_dügøm
());

1111 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

1112 
	}
}

1115 
	$obje˘s_ungroup_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1117 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

1118 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

1120 
	`dügøm_ungroup_£À˘ed
(
	`ddi•œy_a˘ive_dügøm
());

1121 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

1122 
	}
}

1125 
	$dülogs_¥›îtõs_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1127 
Dügøm
 *
dü
;

1128 
DüObje˘
 *
£À˘ed
;

1130 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

1131 i‡(!
dü
 || 
	`ãxãdô_mode
(
	`ddi•œy_a˘ive
())) ;

1133 i‡(
dü
->
d©a
->
£À˘ed
 !
NULL
) {

1134 
	`obje˘_li°_¥›îtõs_show
(
dü
, dü->
d©a
->
£À˘ed
);

1136 
	`dügøm_¥›îtõs_show
(
dü
);

1138 
	}
}

1141 
	$dülogs_œyîs_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1143 
	`œyî_dülog_£t_dügøm
(
	`ddi•œy_a˘ive_dügøm
());

1144 
	`œyî_dülog_show
();

1145 
	}
}

1149 
	$obje˘s_Æign_h_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1151 c⁄° 
gch¨
 *
a
;

1152 
Æign
 = 
DIA_ALIGN_LEFT
;

1153 
Dügøm
 *
dü
;

1154 
GLi°
 *
obje˘s
;

1156 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

1157 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

1160 
a
 = 
	`gtk_a˘i⁄_gë_«me
 (
a˘i⁄
Ë+ 
	`°æí
 ("ObjectsAlign");

1161 i‡(0 =
	`°rcmp
 ("Le·", 
a
)) {

1162 
Æign
 = 
DIA_ALIGN_LEFT
;

1164 i‡(0 =
	`°rcmp
 ("Cíãr", 
a
)) {

1165 
Æign
 = 
DIA_ALIGN_CENTER
;

1167 i‡(0 =
	`°rcmp
 ("Right", 
a
)) {

1168 
Æign
 = 
DIA_ALIGN_RIGHT
;

1170 i‡(0 =
	`°rcmp
 ("S¥ódouth‹iz⁄èŒy", 
a
)) {

1171 
Æign
 = 
DIA_ALIGN_EQUAL
;

1173 i‡(0 =
	`°rcmp
 ("Adja˚¡", 
a
)) {

1174 
Æign
 = 
DIA_ALIGN_ADJACENT
;

1177 
	`g_w¨nög
 ("objects_align_v_callback() called withoutáppropriateálign");

1181 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

1182 i‡(!
dü
) ;

1183 
obje˘s
 = 
dü
->
d©a
->
£À˘ed
;

1185 
	`obje˘_add_upd©es_li°
(
obje˘s
, 
dü
);

1186 
	`obje˘_li°_Æign_h
(
obje˘s
, 
dü
, 
Æign
);

1187 
	`dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
dü
);

1188 
	`obje˘_add_upd©es_li°
(
obje˘s
, 
dü
);

1189 
	`dügøm_modifõd
(
dü
);

1190 
	`dügøm_Êush
(
dü
);

1192 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1193 
	}
}

1196 
	$obje˘s_Æign_v_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
)

1198 c⁄° 
gch¨
 *
a
;

1199 
Æign
;

1200 
Dügøm
 *
dü
;

1201 
GLi°
 *
obje˘s
;

1203 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

1204 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

1207 
a
 = 
	`gtk_a˘i⁄_gë_«me
 (
a˘i⁄
Ë+ 
	`°æí
 ("ObjectsAlign");

1208 i‡(0 =
	`°rcmp
 ("T›", 
a
)) {

1209 
Æign
 = 
DIA_ALIGN_TOP
;

1211 i‡(0 =
	`°rcmp
 ("MiddÀ", 
a
)) {

1212 
Æign
 = 
DIA_ALIGN_CENTER
;

1214 i‡(0 =
	`°rcmp
 ("BŸtom", 
a
)) {

1215 
Æign
 = 
DIA_ALIGN_BOTTOM
;

1217 i‡(0 =
	`°rcmp
 ("S¥ódoutvîtiˇŒy", 
a
)) {

1218 
Æign
 = 
DIA_ALIGN_EQUAL
;

1220 i‡(0 =
	`°rcmp
 ("Sècked", 
a
)) {

1221 
Æign
 = 
DIA_ALIGN_ADJACENT
;

1224 
	`g_w¨nög
 ("objects_align_v_callback() called withoutáppropriateálign");

1228 
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

1229 i‡(!
dü
) ;

1230 
obje˘s
 = 
dü
->
d©a
->
£À˘ed
;

1232 
	`obje˘_add_upd©es_li°
(
obje˘s
, 
dü
);

1233 
	`obje˘_li°_Æign_v
(
obje˘s
, 
dü
, 
Æign
);

1234 
	`dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
dü
);

1235 
	`obje˘_add_upd©es_li°
(
obje˘s
, 
dü
);

1236 
	`dügøm_modifõd
(
dü
);

1237 
	`dügøm_Êush
(
dü
);

1239 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1240 
	}
}

	@O:\tool\dvs50\app\commands.h

18 #i‚de‡
COMMANDS_H


19 
	#COMMANDS_H


	)

21 
	~<gtk/gtk.h
>

23 
fûe_quô_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

24 
fûe_∑ge£tup_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

25 
fûe_¥öt_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

26 
fûe_˛o£_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

27 
fûe_√w_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

28 
fûe_¥e„ªn˚s_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

30 
hñp_m™uÆ_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

31 
hñp_about_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

33 
edô_c›y_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

34 
edô_cut_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

35 
edô_∑°e_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

36 
edô_du∂iˇã_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

37 
edô_dñëe_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

38 
edô_undo_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

39 
edô_ªdo_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

40 
edô_∑°e_ãxt_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

41 
edô_c›y_ãxt_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

42 
edô_cut_ãxt_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

44 
ª˚ived_£À˘i⁄_h™dÀr
 (
GtkWidgë
 *
widgë
, 
GtkSñe˘i⁄D©a
 *
£À˘i⁄
,

45 
gpoöãr
 
d©a
);

46 
gë_£À˘i⁄_h™dÀr
(
GtkWidgë
 *
widgë
, 
GtkSñe˘i⁄D©a
 *
£À˘i⁄
,

47 
gpoöãr
 
d©a
);

49 
võw_zoom_ö_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

50 
võw_zoom_out_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

51 
võw_zoom_£t_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

52 
võw_unfuŒs¸ìn
 ();

53 
võw_fuŒs¸ìn_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
);

54 
võw_Ø_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
);

55 
võw_visibÀ_grid_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
);

56 
võw_¢≠_to_grid_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
);

57 
võw_¢≠_to_obje˘s_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
);

58 
võw_toggÀ_ruÀrs_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
);

59 
võw_show_cx_±s_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
);

60 
võw_√w_võw_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

61 
võw_˛⁄e_võw_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

62 
võw_show_Æl_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

63 
võw_ªdøw_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

64 
võw_dügøm_¥›îtõs_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

67 
võw_maö_toﬁb¨_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

68 
võw_maö_°©usb¨_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

69 
võw_œyîs_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

71 
œyîs_add_œyî_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

72 
œyîs_ª«me_œyî_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

74 
obje˘s_∂a˚_ovî_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

75 
obje˘s_∂a˚_undî_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

76 
obje˘s_∂a˚_up_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

77 
obje˘s_∂a˚_down_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

78 
obje˘s_move_up_œyî
 (
GtkA˘i⁄
 *
a˘i⁄
);

79 
obje˘s_move_down_œyî
 (
GtkA˘i⁄
 *
a˘i⁄
);

81 
obje˘s_∑ª¡_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

82 
obje˘s_u≈¨ít_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

83 
obje˘s_u≈¨ít_chûdªn_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

84 
obje˘s_group_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

85 
obje˘s_ungroup_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

86 
obje˘s_Æign_h_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

87 
obje˘s_Æign_v_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

89 
dülogs_¥›îtõs_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

90 
dülogs_œyîs_ˇŒback
 (
GtkA˘i⁄
 *
a˘i⁄
);

	@O:\tool\dvs50\app\confirm.c

23 
	~<c⁄fig.h
>

25 
	~"c⁄fúm.h
"

26 
	~"öé.h
"

28 
göt


29 
	$c⁄fúm_ª•⁄d
 (
GtkWidgë
 *
widgë
, 
göt
 
ª•⁄£_id
, 
gpoöãr
 
d©a
)

32 
	`gtk_widgë_hide
 (
widgë
);

34 
	}
}

39 
gboﬁón


40 
	$c⁄fúm_exp‹t_size
 (
Dügøm
 *
dü
, 
GtkWödow
 *
∑ª¡
, 
guöt
 
Êags
)

42 
GtkWidgë
 *
dülog
;

43 
∑ges
 = 0;

44 
göt64
 
byãs
 = 0;

45 
gch¨
 *
size
, *
msg
;

46 
gboﬁón
 
ªt
;

48 
∑ges
 = 
	`˚û
((
dü
->
d©a
->
exã¡s
.
right
 - dü->d©a->exã¡s.
À·
Ë/ dü->d©a->
∑≥r
.
width
)

49 * 
	`˚û
((
dü
->
d©a
->
exã¡s
.
bŸtom
 - dü->d©a->exã¡s.
t›
Ë/ dü->d©a->
∑≥r
.
height
);

51 
byãs
 = (
göt64
)4

52 * 
	`˚û
((
dü
->
d©a
->
exã¡s
.
right
 - dü->d©a->exã¡s.
À·
Ë* dü->d©a->
∑≥r
.
sˇlög
 * 20)

53 * 
	`˚û
((
dü
->
d©a
->
exã¡s
.
bŸtom
 - dü->d©a->exã¡s.
t›
Ë* dü->d©a->
∑≥r
.
sˇlög
 * 20);

55 i‡((
Êags
 & 
CONFIRM_PRINT
Ë&& (
∑ges
 < 10))

56  
TRUE
;

57 i‡((
Êags
 & 
CONFIRM_MEMORY
Ë&& (
byãs
 < (
	`G_GINT64_CONSTANT
(100)<<16)))

58  
TRUE
;

59 i‡((
Êags
 & 
CONFIRM_PAGES
Ë&& (
∑ges
 < 50))

60  
TRUE
;

63 #i‡
	`GLIB_CHECK_VERSION
(2,16,0)

64 
size
 = 
	`g_f‹m©_size_f‹_di•œy
 (
byãs
);

66 
size
 = 
	`g_°rdup_¥ötf
 ("%d MB", (
guöt
)(
byãs
 >> 20));

68 i‡(
Êags
 & 
CONFIRM_PRINT
)

69 
msg
 = 
	`g_°rdup_¥ötf
 (
	`_
("Youáªábouàtÿ¥öà®dügøm wôh %dÖages."), 
∑ges
);

70 i‡((
Êags
 & ~
CONFIRM_PAGES
) == 0)

71 
msg
 = 
	`g_°rdup_¥ötf
 (
	`_
("Youáªábouàtÿexp‹à®dügøm wôh %dÖages."), 
∑ges
);

73 
msg
 = 
	`g_°rdup_¥ötf
 (
	`_
("YouáreáboutÅoÉxportá diagram "

74 "which mayÑequúê%†o‡mem‹y.(%dÖages)."), 
size
, 
∑ges
);

75 
dülog
 = 
	`gtk_mesßge_dülog_√w
 (
∑ª¡
,

76 
GTK_DIALOG_MODAL
|
GTK_DIALOG_DESTROY_WITH_PARENT
,

77 
GTK_MESSAGE_WARNING
,

78 
GTK_BUTTONS_OK_CANCEL
,

79 "%s", 
msg
);

80 
	`gtk_mesßge_dülog_f‹m©_£c⁄d¨y_ãxt
 (
	`GTK_MESSAGE_DIALOG
 (
dülog
),

81 
	`_
("You canádjustÅhe size ofÅhe diagram by changing "

85 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
dülog
), 
	`_
("Confirm Diagram Size"));

86 
	`g_‰ì
 (
size
);

88 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
dülog
), "response",

89 
	`G_CALLBACK
(
c⁄fúm_ª•⁄d
), 
NULL
);

91 
ªt
 = (
GTK_RESPONSE_OK
 =
	`gtk_dülog_run
 (
	`GTK_DIALOG
 (
dülog
)));

92 
	`gtk_widgë_de°roy
(
dülog
);

93  
ªt
;

94 
	}
}

	@O:\tool\dvs50\app\confirm.h

1 
	~<gtk/gtk.h
>

2 
	~"dügøm.h
"

5 
	mCONFIRM_PAGES
 = (1<<0),

6 
	mCONFIRM_MEMORY
 = (1<<1),

7 
	mCONFIRM_PRINT
 = (1<<2)

8 } 
	tC⁄fúm©i⁄Köd
;

10 
gboﬁón
 
c⁄fúm_exp‹t_size
 (
Dügøm
 *
dü
, 
GtkWödow
 *
∑ª¡
, 
guöt
 
Êags
);

	@O:\tool\dvs50\app\connectionpoint_ops.c

18 
	~<c⁄fig.h
>

20 
	~<as£π.h
>

22 
	~"c⁄√˘i⁄poöt_›s.h
"

23 
	~"obje˘_›s.h
"

24 
	~"cﬁ‹.h
"

26 
Cﬁ‹
 
	gc⁄√˘i⁄poöt_cﬁ‹
 = { 0.4, 0.4, 1.0 };

28 
	#CP_SZ
 (
CONNECTIONPOINT_SIZE
/2)

	)

31 
	$c⁄√˘i⁄poöt_døw
(
C⁄√˘i⁄Poöt
 *
c⁄poöt
,

32 
DDi•œy
 *
ddi•
)

34 
x
,
y
;

35 
Poöt
 *
poöt
 = &
c⁄poöt
->
pos
;

36 
DüRídîî
 *
ªndîî
 = 
ddi•
->renderer;

37 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ddi•
->
ªndîî
);

38 
DüI¡îa˘iveRídîîI¡îÁ˚
 *
úídîî
 =

39 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ddi•
->
ªndîî
);

43 i‡(
c⁄poöt
->
Êags
 & 
CP_FLAG_ANYPLACE
) {

44 i‡(!
ddi•
->
maöpoöt_mag√tism
) {

45 
Cﬁ‹
 
midpoöt_cﬁ‹
 = { 1.0, 0.0, 0.0 };

47 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
poöt
->
x
,Öoöt->
y
, &x, &y);

49 
úídîî
->
	`døw_pixñ_löe
 (
ªndîî
,

50 
x
-
CP_SZ
,
y
-CP_SZ,

51 
x
+
CP_SZ
,
y
+CP_SZ,

52 &
midpoöt_cﬁ‹
);

54 
úídîî
->
	`døw_pixñ_löe
 (
ªndîî
,

55 
x
+
CP_SZ
,
y
-CP_SZ,

56 
x
-
CP_SZ
,
y
+CP_SZ,

57 &
midpoöt_cﬁ‹
);

62 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
poöt
->
x
,Öoöt->
y
, &x, &y);

64 
ªndîî_›s
->
	`£t_löewidth
 (
ªndîî
, 0.0);

65 
ªndîî_›s
->
	`£t_löe°yÀ
 (
ªndîî
, 
LINESTYLE_SOLID
);

67 
úídîî
->
	`døw_pixñ_löe
 (
ªndîî
,

68 
x
-
CP_SZ
,
y
-CP_SZ,

69 
x
+
CP_SZ
,
y
+CP_SZ,

70 &
c⁄√˘i⁄poöt_cﬁ‹
);

72 
úídîî
->
	`døw_pixñ_löe
 (
ªndîî
,

73 
x
+
CP_SZ
,
y
-CP_SZ,

74 
x
-
CP_SZ
,
y
+CP_SZ,

75 &
c⁄√˘i⁄poöt_cﬁ‹
);

76 
	}
}

79 
	$c⁄√˘i⁄poöt_add_upd©e
(
C⁄√˘i⁄Poöt
 *
c⁄poöt
,

80 
Dügøm
 *
dü
)

82 
	`dügøm_add_upd©e_pixñs
(
dü
, &
c⁄poöt
->
pos
,

83 
CONNECTIONPOINT_SIZE
, CONNECTIONPOINT_SIZE);

84 
	}
}

88 
	$dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
Dügøm
 *
dü
)

90 
GLi°
 *
li°
 = 
dü
->
d©a
->
£À˘ed
;

92 
li°
!=
NULL
) {

93 
DüObje˘
 * 
£À˘ed_obj
 = (DüObje˘ *Ë
li°
->
d©a
;

95 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
, 
£À˘ed_obj
, 
TRUE
);

97 
li°
 = 
	`g_li°_√xt
(list);

99 
	}
}

109 
	$dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
,

110 
upd©e_n⁄moved
)

112 
i
,
j
;

113 
C⁄√˘i⁄Poöt
 *
˝
;

114 
GLi°
 *
li°
;

115 
DüObje˘
 *
c⁄√˘ed_obj
;

116 
H™dÀ
 *
h™dÀ
;

118 
i
=0;i<
obj
->
num_c⁄√˘i⁄s
;i++) {

119 
˝
 = 
obj
->
c⁄√˘i⁄s
[
i
];

120 i‡((
upd©e_n⁄moved
) ||

121 (
	`di°™˚_poöt_poöt_m™h©èn
(&
˝
->
pos
, &˝->
œ°_pos
Ë> 
CHANGED_TRESHOLD
)) {

122 
˝
->
œ°_pos
 = cp->
pos
;

124 
li°
 = 
˝
->
c⁄√˘ed
;

125 
li°
!=
NULL
) {

126 
c⁄√˘ed_obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

128 
	`obje˘_add_upd©es
(
c⁄√˘ed_obj
, 
dü
);

129 
h™dÀ
 = 
NULL
;

130 
j
=0;j<
c⁄√˘ed_obj
->
num_h™dÀs
;j++) {

131 i‡(
c⁄√˘ed_obj
->
h™dÀs
[
j
]->
c⁄√˘ed_to
 =
˝
) {

132 
h™dÀ
 = 
c⁄√˘ed_obj
->
h™dÀs
[
j
];

133 
c⁄√˘ed_obj
->
›s
->
	`move_h™dÀ
(c⁄√˘ed_obj, 
h™dÀ
, &
˝
->
pos
,

134 
˝
, 
HANDLE_MOVE_CONNECTED
,0);

137 
	`obje˘_add_upd©es
(
c⁄√˘ed_obj
, 
dü
);

139 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
, 
c⁄√˘ed_obj
, 
FALSE
);

141 
li°
 = 
	`g_li°_√xt
(list);

145 i‡(
obj
->
chûdªn
) {

146 
GLi°
 *
chûd
;

147 
chûd
 = 
obj
->
chûdªn
; chûd !
NULL
; chûd = chûd->
√xt
) {

148 
DüObje˘
 *
chûd_obj
 = (DüObje˘ *)
chûd
->
d©a
;

149 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
, 
chûd_obj
, 
upd©e_n⁄moved
);

152 
	}
}

155 
	$ddi•œy_c⁄√˘_£À˘ed
(
DDi•œy
 *
ddi•
)

157 
GLi°
 *
li°
;

158 
DüObje˘
 *
£À˘ed_obj
;

159 
i
;

161 
li°
 = 
ddi•
->
dügøm
->
d©a
->
£À˘ed
;

163 
li°
!=
NULL
) {

164 
£À˘ed_obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

166 
i
=0; i<
£À˘ed_obj
->
num_h™dÀs
; i++) {

167 i‡(
£À˘ed_obj
->
h™dÀs
[
i
]->
c⁄√˘_ty≥
 !
HANDLE_NONCONNECTABLE
) {

168 
	`obje˘_c⁄√˘_di•œy
(
ddi•
, 
£À˘ed_obj
, sñe˘ed_obj->
h™dÀs
[
i
], 
FALSE
);

172 
li°
 = 
	`g_li°_√xt
(list);

174 
	}
}

177 
	$dügøm_unc⁄√˘_£À˘ed
(
Dügøm
 *
dü
)

179 
GLi°
 *
li°
;

180 
DüObje˘
 *
£À˘ed_obj
;

181 
H™dÀ
 *
h™dÀ
;

182 
i
;

184 
li°
 = 
dü
->
d©a
->
£À˘ed
;

186 
li°
!=
NULL
) {

187 
£À˘ed_obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

189 
i
=0; i<
£À˘ed_obj
->
num_h™dÀs
; i++) {

190 
h™dÀ
 = 
£À˘ed_obj
->
h™dÀs
[
i
];

192 i‡((
h™dÀ
->
c⁄√˘ed_to
 !
NULL
) &&

193 (
h™dÀ
->
c⁄√˘_ty≥
 =
HANDLE_CONNECTABLE
)){

195 i‡(!
	`dügøm_is_£À˘ed
(
dü
, 
h™dÀ
->
c⁄√˘ed_to
->
obje˘
)) {

196 
Ch™ge
 *
ch™ge
 = 
	`undo_unc⁄√˘
(
dü
, 
£À˘ed_obj
, 
h™dÀ
);

197 (
ch™ge
->
≠∂y
)(ch™ge, 
dü
);

202 
li°
 = 
	`g_li°_√xt
(list);

204 
	}
}

	@O:\tool\dvs50\app\connectionpoint_ops.h

18 #i‚de‡
CONNECTIONPOINT_OPS_H


19 
	#CONNECTIONPOINT_OPS_H


	)

21 
	~"c⁄√˘i⁄poöt.h
"

22 
	~"dügøm.h
"

23 
	~"di•œy.h
"

25 
c⁄√˘i⁄poöt_døw
(
C⁄√˘i⁄Poöt
 *
c⁄poöt
,

26 
DDi•œy
 *
ddi•
);

27 
c⁄√˘i⁄poöt_add_upd©e
(
C⁄√˘i⁄Poöt
 *
c⁄poöt
,

28 
Dügøm
 *
dü
);

29 
dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
Dügøm
 *
dü
);

30 
dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
,

31 
upd©e_n⁄moved
);

32 
ddi•œy_c⁄√˘_£À˘ed
(
DDi•œy
 *
ddi•
);

33 
dügøm_unc⁄√˘_£À˘ed
(
Dügøm
 *
dü
);

	@O:\tool\dvs50\app\create_object.c

18 
	~<c⁄fig.h
>

20 
	~"¸óã_obje˘.h
"

21 
	~"c⁄√˘i⁄poöt_›s.h
"

22 
	~"h™dÀ_›s.h
"

23 
	~"obje˘_›s.h
"

24 
	~"¥e„ªn˚s.h
"

25 
	~"undo.h
"

26 
	~"curs‹.h
"

27 
	~"highlight.h
"

28 
	~"ãxãdô.h
"

29 
	~"∑ª¡.h
"

30 
	~"mesßge.h
"

32 
¸óã_obje˘_buâ⁄_¥ess
(
Cª©eObje˘Toﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

33 
DDi•œy
 *
ddi•
);

34 
¸óã_obje˘_buâ⁄_ªÀa£
(
Cª©eObje˘Toﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

35 
DDi•œy
 *
ddi•
);

36 
¸óã_obje˘_mŸi⁄
(
Cª©eObje˘Toﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

37 
DDi•œy
 *
ddi•
);

38 
¸óã_obje˘_doubÀ_˛ick
(
Cª©eObje˘Toﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

39 
DDi•œy
 *
ddi•
);

43 
	$¸óã_obje˘_buâ⁄_¥ess
(
Cª©eObje˘Toﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

44 
DDi•œy
 *
ddi•
)

46 
Poöt
 
˛ickedpoöt
, 
‹igpoöt
;

47 
H™dÀ
 *
h™dÀ1
;

48 
H™dÀ
 *
h™dÀ2
;

49 
DüObje˘
 *
obj
;

50 
ªÆ
 
˛ick_di°™˚
;

52 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
,

53 ()
evít
->
x
, (Îvít->
y
,

54 &
˛ickedpoöt
.
x
, &˛ickedpoöt.
y
);

56 
‹igpoöt
 = 
˛ickedpoöt
;

58 
	`¢≠_to_grid
(
ddi•
, &
˛ickedpoöt
.
x
, &˛ickedpoöt.
y
);

60 
˛ick_di°™˚
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 3.0);

62 
obj
 = 
	`dü_obje˘_deÁu…_¸óã
 (
toﬁ
->
objty≥
, &
˛ickedpoöt
,

63 
toﬁ
->
u£r_d©a
,

64 &
h™dÀ1
, &
h™dÀ2
);

66 
toﬁ
->
obj
 = obj;

68 i‡(!
obj
) {

69 
toﬁ
->
movög
 = 
FALSE
;

70 
toﬁ
->
h™dÀ
 = 
NULL
;

71 
	`mesßge_îr‹
(
	`_
("'%s' cª©i⁄ faûed"), 
toﬁ
->
objty≥
 ?Åoﬁ->objty≥->
«me
 : "NULL");

75 
	`dügøm_add_obje˘
(
ddi•
->
dügøm
, 
obj
);

78 i‡(
h™dÀ1
 !
NULL
 &&

79 
h™dÀ1
->
c⁄√˘_ty≥
 !
HANDLE_NONCONNECTABLE
) {

80 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
;

81 
c⁄√˘i⁄poöt
 =

82 
	`obje˘_föd_c⁄√˘poöt_di•œy
(
ddi•
, &
‹igpoöt
, 
obj
, 
TRUE
);

83 i‡(
c⁄√˘i⁄poöt
 !
NULL
) {

84 (
obj
->
›s
->
move
)(obj, &
‹igpoöt
);

88 i‡(!(
evít
->
°©e
 & 
GDK_SHIFT_MASK
)) {

90 
	`dügøm_ªmove_Æl_£À˘ed
(
ddi•
->
dügøm
, 
TRUE
);

92 
	`dügøm_£À˘
(
ddi•
->
dügøm
, 
obj
);

95 i‡((
h™dÀ1
!
NULL
) &&

96 (
h™dÀ1
->
c⁄√˘_ty≥
 !
HANDLE_NONCONNECTABLE
)) {

97 
	`obje˘_c⁄√˘_di•œy
(
ddi•
, 
obj
, 
h™dÀ1
, 
TRUE
);

100 
	`obje˘_add_upd©es
(
obj
, 
ddi•
->
dügøm
);

101 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

102 
	`dügøm_Êush
(
ddi•
->
dügøm
);

104 i‡(
h™dÀ2
 !
NULL
) {

105 
toﬁ
->
h™dÀ
 = 
h™dÀ2
;

106 
toﬁ
->
movög
 = 
TRUE
;

107 
toﬁ
->
œ°_to
 = 
h™dÀ2
->
pos
;

109 
	`gdk_poöãr_gøb
 (
ddi•
->
ˇnvas
->
wödow
, 
FALSE
,

110 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

111 
NULL
, NULL, 
evít
->
time
);

112 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_SCROLL
));

114 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

115 
toﬁ
->
movög
 = 
FALSE
;

118 
	}
}

121 
	$¸óã_obje˘_doubÀ_˛ick
(
Cª©eObje˘Toﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

122 
DDi•œy
 *
ddi•
)

124 
	}
}

127 
	$¸óã_obje˘_buâ⁄_ªÀa£
(
Cª©eObje˘Toﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

128 
DDi•œy
 *
ddi•
)

130 
GLi°
 *
li°
 = 
NULL
;

131 
DüObje˘
 *
obj
 = 
toﬁ
->obj;

132 
gboﬁón
 
ª£t
;

134 
GLi°
 *
∑ª¡_ˇndid©es
;

136 
	`g_ªtu∫_if_Áû
 (
obj
 !
NULL
);

137 i‡(!
obj
)

140 i‡(
toﬁ
->
movög
) {

141 
	`gdk_poöãr_ungøb
 (
evít
->
time
);

143 
	`obje˘_add_upd©es
(
toﬁ
->
obj
, 
ddi•
->
dügøm
);

144 
toﬁ
->
obj
->
›s
->
	`move_h™dÀ
—oﬁ->obj,Åoﬁ->
h™dÀ
, &toﬁ->
œ°_to
,

145 
NULL
, 
HANDLE_MOVE_CREATE_FINAL
, 0);

146 
	`obje˘_add_upd©es
(
toﬁ
->
obj
, 
ddi•
->
dügøm
);

150 
∑ª¡_ˇndid©es
 =

151 
	`œyî_föd_obje˘s_c⁄èöög_ª˘™gÀ
(
obj
->
∑ª¡_œyî
,

152 &
obj
->
boundög_box
);

155 ; 
∑ª¡_ˇndid©es
 !
NULL
;Ö¨ít_ˇndid©e†
	`g_li°_√xt
(parent_candidates)) {

156 
DüObje˘
 *
∑ª¡_obj
 = (DüObje˘ *Ë
∑ª¡_ˇndid©es
->
d©a
;

157 i‡(
obj
 !
∑ª¡_obj


158 && 
	`obje˘_wôhö_∑ª¡
(
obj
, 
∑ª¡_obj
)) {

159 
Ch™ge
 *
ch™ge
 = 
	`undo_∑ª¡ög
(
ddi•
->
dügøm
, 
∑ª¡_obj
, 
obj
, 
TRUE
);

160 (
ch™ge
->
≠∂y
)(ch™ge, 
ddi•
->
dügøm
);

168 
	`g_li°_‰ì
(
∑ª¡_ˇndid©es
);

170 
li°
 = 
	`g_li°_¥ïíd
÷i°, 
toﬁ
->
obj
);

172 
	`undo_ö£π_obje˘s
(
ddi•
->
dügøm
, 
li°
, 1);

174 i‡(
toﬁ
->
movög
) {

175 i‡(
toﬁ
->
h™dÀ
->
c⁄√˘_ty≥
 !
HANDLE_NONCONNECTABLE
) {

176 
	`obje˘_c⁄√˘_di•œy
(
ddi•
, 
toﬁ
->
obj
,Åoﬁ->
h™dÀ
, 
TRUE
);

177 
	`dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
ddi•
->
dügøm
);

178 
	`dügøm_Êush
(
ddi•
->
dügøm
);

180 
toﬁ
->
movög
 = 
FALSE
;

181 
toﬁ
->
h™dÀ
 = 
NULL
;

182 
toﬁ
->
obj
 = 
NULL
;

187 
GtkSètusb¨
 *
°©usb¨
 = 
	`GTK_STATUSBAR
 (
ddi•
->
modifõd_°©us
);

188 
guöt
 
c⁄ãxt_id
 = 
	`gtk_°©usb¨_gë_c⁄ãxt_id
 (
°©usb¨
, "ObjectPos");

189 
	`gtk_°©usb¨_p›
 (
°©usb¨
, 
c⁄ãxt_id
);

192 
	`highlight_ª£t_Æl
(
ddi•
->
dügøm
);

193 
ª£t
 = 
¥efs
.
ª£t_toﬁs_a·î_¸óã
 !
toﬁ
->
övît_≥rsi°í˚
;

195 i‡(
	`ãxãdô_a˘iv©e_obje˘
(
ddi•
, 
obj
, 
NULL
Ë&& 
ª£t
) {

196 
	`gtk_a˘i⁄_a˘iv©e
 (
	`míus_gë_a˘i⁄
 ("ToolsTextedit"));

197 
ª£t
 = 
FALSE
;

199 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

200 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

202 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

204 i‡(
ª£t
)

205 
	`toﬁ_ª£t
();

206 
	`ddi•œy_£t_Æl_curs‹
(
deÁu…_curs‹
);

207 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

208 
	}
}

211 
	$¸óã_obje˘_mŸi⁄
(
Cª©eObje˘Toﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

212 
DDi•œy
 *
ddi•
)

214 
Poöt
 
to
;

215 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
 = 
NULL
;

216 
gch¨
 *
po°ext
;

217 
GtkSètusb¨
 *
°©usb¨
;

218 
guöt
 
c⁄ãxt_id
;

220 i‡(!
toﬁ
->
movög
)

223 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
, 
evít
->
x
,Évít->
y
, &
to
.x, &to.y);

226 
	`∑ª¡_h™dÀ_move_out_check
(
toﬁ
->
obj
, &
to
);

229 i‡(
toﬁ
->
h™dÀ
 !
NULL
 &&

230 
toﬁ
->
h™dÀ
->
c⁄√˘_ty≥
 !
HANDLE_NONCONNECTABLE
) {

231 
c⁄√˘i⁄poöt
 =

232 
	`obje˘_föd_c⁄√˘poöt_di•œy
(
ddi•
, &
to
, 
toﬁ
->
obj
, 
TRUE
);

234 i‡(
c⁄√˘i⁄poöt
 !
NULL
) {

235 
to
 = 
c⁄√˘i⁄poöt
->
pos
;

236 
	`highlight_obje˘
(
c⁄√˘i⁄poöt
->
obje˘
, 
NULL
, 
ddi•
->
dügøm
);

237 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_CONNECT
));

241 i‡(
c⁄√˘i⁄poöt
 =
NULL
) {

243 
	`¢≠_to_grid
(
ddi•
, &
to
.
x
, &to.
y
);

244 
	`highlight_ª£t_Æl
(
ddi•
->
dügøm
);

245 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_SCROLL
));

248 
	`obje˘_add_upd©es
(
toﬁ
->
obj
, 
ddi•
->
dügøm
);

249 
toﬁ
->
obj
->
›s
->
	`move_h™dÀ
—oﬁ->obj,Åoﬁ->
h™dÀ
, &
to
, 
c⁄√˘i⁄poöt
,

250 
HANDLE_MOVE_CREATE
, 0);

251 
	`obje˘_add_upd©es
(
toﬁ
->
obj
, 
ddi•
->
dügøm
);

254 
°©usb¨
 = 
	`GTK_STATUSBAR
 (
ddi•
->
modifõd_°©us
);

255 
c⁄ãxt_id
 = 
	`gtk_°©usb¨_gë_c⁄ãxt_id
 (
°©usb¨
, "ObjectPos");

257 
po°ext
 = 
	`g_°rdup_¥ötf
("%.3f, %.3f - %.3f, %.3f",

258 
toﬁ
->
obj
->
boundög_box
.
À·
,

259 
toﬁ
->
obj
->
boundög_box
.
t›
,

260 
toﬁ
->
obj
->
boundög_box
.
right
,

261 
toﬁ
->
obj
->
boundög_box
.
bŸtom
);

263 
	`gtk_°©usb¨_p›
 (
°©usb¨
, 
c⁄ãxt_id
);

264 
	`gtk_°©usb¨_push
 (
°©usb¨
, 
c⁄ãxt_id
, 
po°ext
);

266 
	`g_‰ì
(
po°ext
);

268 
	`dügøm_Êush
(
ddi•
->
dügøm
);

270 
toﬁ
->
œ°_to
 = 
to
;

273 
	}
}

277 
Toﬁ
 *

278 
	$¸óã_¸óã_obje˘_toﬁ
(
DüObje˘Ty≥
 *
objty≥
, *
u£r_d©a
,

279 
övît_≥rsi°í˚
)

281 
Cª©eObje˘Toﬁ
 *
toﬁ
;

283 
toﬁ
 = 
	`g_√w0
(
Cª©eObje˘Toﬁ
, 1);

284 
toﬁ
->toﬁ.
ty≥
 = 
CREATE_OBJECT_TOOL
;

285 
toﬁ
->toﬁ.
buâ⁄_¥ess_func
 = (
Buâ⁄PªssFunc
Ë&
¸óã_obje˘_buâ⁄_¥ess
;

286 
toﬁ
->toﬁ.
buâ⁄_ªÀa£_func
 = (
Buâ⁄Rñó£Func
Ë&
¸óã_obje˘_buâ⁄_ªÀa£
;

287 
toﬁ
->toﬁ.
mŸi⁄_func
 = (
MŸi⁄Func
Ë&
¸óã_obje˘_mŸi⁄
;

288 
toﬁ
->toﬁ.
doubÀ_˛ick_func
 = (
DoubÀClickFunc
Ë&
¸óã_obje˘_doubÀ_˛ick
;

290 
toﬁ
->
objty≥
 = objtype;

291 
toﬁ
->
u£r_d©a
 = user_data;

292 
toﬁ
->
movög
 = 
FALSE
;

293 
toﬁ
->
övît_≥rsi°í˚
 = invert_persistence;

295  (
Toﬁ
 *Ë
toﬁ
;

296 
	}
}

298 
	$‰ì_¸óã_obje˘_toﬁ
(
Toﬁ
 *
toﬁ
)

300 
Cª©eObje˘Toﬁ
 *
ªÆ_toﬁ
 = (Cª©eObje˘Toﬁ *)
toﬁ
;

302 i‡(
ªÆ_toﬁ
->
movög
) {

303 
	`gdk_poöãr_ungøb
 (
GDK_CURRENT_TIME
);

304 
	`ddi•œy_£t_Æl_curs‹
(
deÁu…_curs‹
);

306 
	`g_‰ì
(
toﬁ
);

307 
	}
}

	@O:\tool\dvs50\app\create_object.h

18 #i‚de‡
CREATE_OBJECT_H


19 
	#CREATE_OBJECT_H


	)

21 
	~"geomëry.h
"

22 
	~"obje˘.h
"

23 
	~"toﬁ.h
"

25 
_Cª©eObje˘Toﬁ
 
	tCª©eObje˘Toﬁ
;

27 
	s_Cª©eObje˘Toﬁ
 {

28 
Toﬁ
 
	mtoﬁ
;

30 
DüObje˘Ty≥
 *
	mobjty≥
;

31 *
	mu£r_d©a
;

33 
	mmovög
;

34 
H™dÀ
 *
	mh™dÀ
;

35 
DüObje˘
 *
	mobj
;

36 
Poöt
 
	mœ°_to
;

37 
	mövît_≥rsi°í˚
;

41 
Toﬁ
 *
¸óã_¸óã_obje˘_toﬁ
(
DüObje˘Ty≥
 *
objty≥
, *
u£r_d©e
, 
övît_≥rsi°í˚
);

42 
‰ì_¸óã_obje˘_toﬁ
(
Toﬁ
 *
toﬁ
);

	@O:\tool\dvs50\app\cursor.c

19 
	~<c⁄fig.h
>

21 
	~<gdk/gdk.h
>

23 
	#DIA_CURSOR
 
GDK_LAST_CURSOR


	)

25 
	~"di•œy.h
"

26 
	~"curs‹.h
"

28 
	~"pixm≠s/h™d-›í-d©a.xbm
"

29 
	~"pixm≠s/h™d-›í-mask.xbm
"

30 
	~"pixm≠s/h™d-˛o£d-d©a.xbm
"

31 
	~"pixm≠s/h™d-˛o£d-mask.xbm
"

32 
	~"pixm≠s/magnify-∂us-d©a.xbm
"

33 
	~"pixm≠s/magnify-∂us-mask.xbm
"

34 
	~"pixm≠s/magnify-möus-d©a.xbm
"

35 
	~"pixm≠s/magnify-möus-mask.xbm
"

40 
	mgdk_curs‹_numbî
;

41 
gch¨
 *
	md©a
;

42 
	mwidth
;

43 
	mheight
;

44 
gch¨
 *
	mmask
;

45 
	mhŸ_x
;

46 
	mhŸ_y
;

47 
GdkCurs‹
 *
	mcurs‹
;

48 } 
	gcurs‹s
[
MAX_CURSORS
] = {

49 { 
GDK_LEFT_PTR
 },

50 { 
GDK_FLEUR
 },

51 { 
DIA_CURSOR
,

52 
h™d_›í_d©a_bôs
,

53 
h™d_›í_d©a_width
, 
h™d_›í_d©a_height
,

54 
h™d_›í_mask_bôs
,

55 
h™d_›í_d©a_width
/2, 
h™d_›í_d©a_height
/2},

56 { 
DIA_CURSOR
,

57 
h™d_˛o£d_d©a_bôs
,

58 
h™d_˛o£d_d©a_width
, 
h™d_˛o£d_d©a_height
,

59 
h™d_˛o£d_mask_bôs
,

60 
h™d_˛o£d_d©a_width
/2, 
h™d_˛o£d_d©a_height
/2},

61 { 
DIA_CURSOR
,

62 
magnify_möus_d©a_bôs
,

63 
magnify_möus_d©a_width
, 
magnify_möus_d©a_height
,

64 
magnify_möus_mask_bôs
,

65 
magnify_möus_d©a_x_hŸ
, 
magnify_möus_d©a_y_hŸ
},

66 { 
DIA_CURSOR
,

67 
magnify_∂us_d©a_bôs
,

68 
magnify_∂us_d©a_width
, 
magnify_∂us_d©a_height
,

69 
magnify_∂us_mask_bôs
,

70 
magnify_∂us_d©a_x_hŸ
, 
magnify_∂us_d©a_y_hŸ
},

71 { 
GDK_CROSS_REVERSE
 },

72 { 
GDK_XTERM
 },

75 
GdkCurs‹
 *

76 
	$gë_curs‹
(
DüCurs‹Ty≥
 
˘y≥
) {

77 i‡(
˘y≥
 >
MAX_CURSORS
 || ctype < 0) {

78  
NULL
;

80 i‡(
curs‹s
[
˘y≥
].
curs‹
 =
NULL
) {

81 
GdkCurs‹
 *
√w_curs‹
 = 
NULL
;

83 i‡(
curs‹s
[
˘y≥
].
gdk_curs‹_numbî
 !
DIA_CURSOR
) {

84 
√w_curs‹
 = 
	`gdk_curs‹_√w
(
curs‹s
[
˘y≥
].
gdk_curs‹_numbî
);

86 
DDi•œy
 *
a˘ive_di•œy
 = 
	`ddi•œy_a˘ive
 ();

87 i‡(
a˘ive_di•œy
 !
NULL
)

88 
√w_curs‹
 = 
	`¸óã_curs‹
(
a˘ive_di•œy
->
ˇnvas
->
wödow
,

89 
curs‹s
[
˘y≥
].
d©a
,

90 
curs‹s
[
˘y≥
].
width
,

91 
curs‹s
[
˘y≥
].
height
,

92 
curs‹s
[
˘y≥
].
mask
,

93 
curs‹s
[
˘y≥
].
hŸ_x
,

94 
curs‹s
[
˘y≥
].
hŸ_y
);

96 
curs‹s
[
˘y≥
].
curs‹
 = 
√w_curs‹
;

99  
curs‹s
[
˘y≥
].
curs‹
;

100 
	}
}

102 
GdkCurs‹
 *

103 
	$¸óã_curs‹
(
GdkWödow
 *
wödow
,

104 c⁄° 
gch¨
 *
d©a
, 
width
, 
height
,

105 c⁄° 
gch¨
 *
mask
, 
hŸ_x
, 
hŸ_y
)

107 
GdkBôm≠
 *
dbô
, *
mbô
;

108 
GdkCﬁ‹
 
bœck
, 
whôe
;

109 
GdkCurs‹
 *
curs‹
;

111 
	`g_ªtu∫_vÆ_if_Áû
(
wödow
 !
NULL
, NULL);

113 
dbô
 = 
	`gdk_bôm≠_¸óã_‰om_d©a
(
wödow
, 
d©a
, 
width
, 
height
);

114 
mbô
 = 
	`gdk_bôm≠_¸óã_‰om_d©a
(
wödow
, 
mask
, 
width
, 
height
);

115 
	`g_as£π
(
dbô
 !
NULL
 && 
mbô
 != NULL);

118 
	`gdk_cﬁ‹_bœck
(
	`gdk_wödow_gë_cﬁ‹m≠
(
wödow
), &
whôe
);

119 
	`gdk_cﬁ‹_whôe
(
	`gdk_wödow_gë_cﬁ‹m≠
(
wödow
), &
bœck
);

121 
curs‹
 = 
	`gdk_curs‹_√w_‰om_pixm≠
(
dbô
, 
mbô
, &
whôe
, &
bœck
, 
hŸ_x
,
hŸ_y
);

122 
	`g_as£π
(
curs‹
 !
NULL
);

124 
	`gdk_bôm≠_uƒef
(
dbô
);

125 
	`gdk_bôm≠_uƒef
(
mbô
);

127  
curs‹
;

128 
	}
}

	@O:\tool\dvs50\app\cursor.h

24 
	mCURSOR_POINT
,

25 
	mCURSOR_SCROLL
,

26 
	mCURSOR_GRAB
,

27 
	mCURSOR_GRABBING
,

28 
	mCURSOR_ZOOM_OUT
,

29 
	mCURSOR_ZOOM_IN
,

30 
	mCURSOR_CONNECT
,

31 
	mCURSOR_XTERM
,

32 
	mMAX_CURSORS


33 } 
	tDüCurs‹Ty≥
;

36 
GdkCurs‹
 *
gë_curs‹
(
DüCurs‹Ty≥
 
˘y≥
);

37 
GdkCurs‹
 *
¸óã_curs‹
(
GdkWödow
 *
wödow
,

38 c⁄° 
gch¨
 *
d©a
, 
width
, 
height
,

39 c⁄° 
gch¨
 *
mask
, 
hŸ_x
, 
hŸ_y
);

	@O:\tool\dvs50\app\cut_n_paste.c

18 
	~<c⁄fig.h
>

20 
	~<°dio.h
>

22 
	~"cut_n_∑°e.h
"

23 
	~"obje˘.h
"

24 
	~"obje˘_›s.h
"

26 
GLi°
 *
	g°‹ed_li°
 = 
NULL
;

27 
	g°‹ed_gíî©i⁄
 = 0;

29 
	$‰ì_°‹ed
()

31 i‡(
°‹ed_li°
 !
NULL
) {

32 
	`de°roy_obje˘_li°
(
°‹ed_li°
);

33 
°‹ed_li°
 = 
NULL
;

35 
	}
}

38 
	$˙p_°‹e_obje˘s
(
GLi°
 *
obje˘_li°
, 
gíî©i⁄
)

40 
	`‰ì_°‹ed
();

41 
°‹ed_li°
 = 
obje˘_li°
;

42 
°‹ed_gíî©i⁄
 = 
gíî©i⁄
;

43 
	}
}

45 
GLi°
 *

46 
	$˙p_gë_°‹ed_obje˘s
(* 
gíî©i⁄
)

48 
GLi°
 *
c›õd_li°
;

49 
c›õd_li°
 = 
	`obje˘_c›y_li°
(
°‹ed_li°
);

50 *
gíî©i⁄
 = 
°‹ed_gíî©i⁄
;

51 ++
°‹ed_gíî©i⁄
;

52  
c›õd_li°
;

53 
	}
}

55 
göt


56 
	$˙p_exi°_°‹ed_obje˘s
()

58  (
°‹ed_li°
 !
NULL
);

59 
	}
}

	@O:\tool\dvs50\app\cut_n_paste.h

18 #i‚de‡
CUT_N_PASTE_H


19 
	#CUT_N_PASTE_H


	)

21 
	~<glib.h
>

22 
	~"düv¨.h
"

25 
DIAVAR
 
˙p_°‹e_obje˘s
(
GLi°
 *
obje˘_li°
, 
gíî©i⁄
);

28 
DIAVAR
 
GLi°
 *
˙p_gë_°‹ed_obje˘s
(* 
gíî©i⁄
);

30 
DIAVAR
 
göt
 
˙p_exi°_°‹ed_obje˘s
();

	@O:\tool\dvs50\app\defaults.c

19 
	~<c⁄fig.h
>

21 
	~<gtk/gtk.h
>

23 
	~"deÁu…s.h
"

24 
	~"öé.h
"

25 
	~"¥›îtõs-dülog.h
"

26 
	~"obje˘_›s.h
"

27 
	~"c⁄√˘i⁄poöt_›s.h
"

28 
	~"obje˘.h
"

30 
GtkWidgë
 *
	gdülog
 = 
NULL
;

31 
GtkWidgë
 *
	gdülog_vbox
 = 
NULL
;

32 
GtkWidgë
 *
	gobje˘_∑π
 = 
NULL
;

33 
DüObje˘Ty≥
 *
	gcuºít_objty≥
 = 
NULL
;

34 
DüObje˘
 *
	gcuºít_obje˘
 = 
NULL
;

36 
GtkWidgë
 *
	gno_deÁu…s_dülog
 = 
NULL
;

38 
göt
 
deÁu…s_ª•⁄d
(
GtkWidgë
 *
widgë
, göà
ª•⁄£_id
, 
gpoöãr
 
d©a
);

40 
	$¸óã_dülog
()

42 
dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
(

43 
	`_
("Object defaults"),

44 
NULL
, 0,

45 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

46 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

47 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

48 
NULL
);

50 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
(
dülog
), 
GTK_RESPONSE_OK
);

52 
dülog_vbox
 = 
	`GTK_DIALOG
 (
dülog
)->
vbox
;

54 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
dülog
), "defaults_window");

56 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
dülog
), "response",

57 
	`G_CALLBACK
(
deÁu…s_ª•⁄d
), 
NULL
);

58 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
dülog
), "delete_event",

59 
	`G_CALLBACK
(
gtk_widgë_hide
), 
NULL
);

61 
no_deÁu…s_dülog
 = 
	`gtk_œbñ_√w
(
	`_
("This object hasÇo defaults."));

62 
	`gtk_widgë_show
 (
no_deÁu…s_dülog
);

64 #i‡
	`GLIB_CHECK_VERSION
(2,10,0)

65 
	`g_obje˘_ªf_sök
(
	`GTK_OBJECT
(
no_deÁu…s_dülog
));

67 
	`g_obje˘_ªf
(
	`GTK_OBJECT
(
no_deÁu…s_dülog
));

68 
	`gtk_obje˘_sök
(
	`GTK_OBJECT
(
no_deÁu…s_dülog
));

70 
	}
}

72 
göt


73 
	$deÁu…s_dülog_de°royed
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

75 i‡(
widgë
 =
obje˘_∑π
) {

76 
obje˘_∑π
 = 
NULL
;

77 
cuºít_objty≥
 = 
NULL
;

78 
cuºít_obje˘
 = 
NULL
;

80 
dülog
 = 
NULL
;

82 
	}
}

84 
göt


85 
	$deÁu…s_ª•⁄d
(
GtkWidgë
 *
widgë
, 
göt
 
ª•⁄£_id
, 
gpoöãr
 
d©a
)

87 i‡(
ª•⁄£_id
 =
GTK_RESPONSE_OK
 ||

88 
ª•⁄£_id
 =
GTK_RESPONSE_APPLY
) {

89 i‡(
cuºít_objty≥
 !
NULL
) {

90 i‡(
cuºít_objty≥
->
›s
->
≠∂y_deÁu…s
)

91 
cuºít_objty≥
->
›s
->
	`≠∂y_deÁu…s
();

92 i‡(
cuºít_obje˘
 !
NULL
)

93 
	`obje˘_≠∂y_¥›s_‰om_dülog
 (
cuºít_obje˘
, 
obje˘_∑π
);

96 i‡(
ª•⁄£_id
 !
GTK_RESPONSE_APPLY
)

97 
	`gtk_widgë_hide
(
widgë
);

99 
	}
}

102 
	$deÁu…s_show
(
DüObje˘Ty≥
 *
objty≥
, 
gpoöãr
 
u£r_d©a
)

104 
GtkWidgë
 *
deÁu…s
;

105 
DüObje˘
 *
def_obje˘
 = 
NULL
;

106 
gch¨
 *
tôÀ
 = 
NULL
;

108 i‡(
objty≥
 !
NULL
) {

109 i‡(
objty≥
->
›s
->
gë_deÁu…s
 !
NULL
)

110 
deÁu…s
 = 
objty≥
->
›s
->
	`gë_deÁu…s
();

112 
def_obje˘
 = 
	`dü_obje˘_deÁu…_gë
 (
objty≥
, 
u£r_d©a
);

113 
deÁu…s
 = 
	`obje˘_¸óã_¥›s_dülog
 (
def_obje˘
, 
TRUE
);

115 
tôÀ
 = 
	`g_°rc⁄ˇt
(
	`_
("DeÁu…s: "), 
objty≥
->
«me
, 
NULL
);

117 
deÁu…s
 = 
NULL
;

120 i‡(
dülog
 =
NULL
)

121 
	`¸óã_dülog
();

123 i‡((
objty≥
==
NULL
Ë|| (
deÁu…s
 == NULL)) {

125 
deÁu…s
 = 
no_deÁu…s_dülog
;

126 
objty≥
 = 
NULL
;

129 i‡(
obje˘_∑π
 !
NULL
) {

130 
	`gtk_c⁄èöî_ªmove
(
	`GTK_CONTAINER
(
dülog_vbox
), 
obje˘_∑π
);

131 
obje˘_∑π
 = 
NULL
;

133 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
dülog
), "destroy",

134 
	`G_CALLBACK
(
deÁu…s_dülog_de°royed
), 
NULL
);

136 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
dülog
), "delete_event",

137 
	`G_CALLBACK
(
gtk_widgë_hide
), 
NULL
);

138 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
dülog
), "delete_event",

139 
	`G_CALLBACK
(
gtk_åue
), 
NULL
);

141 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
dülog_vbox
), 
deÁu…s
, 
TRUE
, TRUE, 0);

142 
	`gtk_widgë_show
 (
deÁu…s
);

144 i‡(
tôÀ
)

146 
	`gtk_wödow_£t_tôÀ
(
	`GTK_WINDOW
(
dülog
), 
tôÀ
);

147 
	`g_‰ì
(
tôÀ
);

150 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
dülog
), 
	`_
("Object defaults"));

152 i‡(
obje˘_∑π
 !
deÁu…s
) {

153 
	`gtk_wödow_ªsize
 (
	`GTK_WINDOW
(
dülog
), 1, 1);

154 i‡(
dülog
->
wödow
)

155 
	`gdk_wödow_övÆid©e_ª˘
 (
dülog
->
wödow
, 
NULL
, 
TRUE
);

157 
	`gtk_wödow_¥e£¡
 (
	`GTK_WINDOW
(
dülog
));

158 
obje˘_∑π
 = 
deÁu…s
;

159 
cuºít_objty≥
 = 
objty≥
;

160 
cuºít_obje˘
 = 
def_obje˘
;

161 
	}
}

	@O:\tool\dvs50\app\defaults.h

18 #i‚de‡
DEFAULTS_H


19 
	#DEFAULTS_H


	)

21 
	~"obje˘.h
"

22 
	~"dügøm.h
"

24 
deÁu…s_show
(
DüObje˘Ty≥
 *
obj
, 
gpoöãr
 
u£r_d©a
);

	@O:\tool\dvs50\app\dia-app-icons.h

3 #ifde‡
__SUNPRO_C


4 #¥agm®
Æign
 4 (
dü_c⁄√˘abÀ_ic⁄
)

6 #ifde‡
__GNUC__


7 c⁄° 
guöt8
 
	gdü_c⁄√˘abÀ_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

9 c⁄° 
guöt8
 
dü_c⁄√˘abÀ_ic⁄
[] =

84 #ifde‡
__SUNPRO_C


85 #¥agm®
Æign
 4 (
dü_c⁄√˘abÀ_em±y_ic⁄
)

87 #ifde‡
__GNUC__


88 c⁄° 
guöt8
 
	gdü_c⁄√˘abÀ_em±y_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

90 c⁄° 
guöt8
 
dü_c⁄√˘abÀ_em±y_ic⁄
[] =

199 #ifde‡
__SUNPRO_C


200 #¥agm®
Æign
 4 (
dü_£À˘abÀ_ic⁄
)

202 #ifde‡
__GNUC__


203 c⁄° 
guöt8
 
	gdü_£À˘abÀ_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

205 c⁄° 
guöt8
 
dü_£À˘abÀ_ic⁄
[] =

307 #ifde‡
__SUNPRO_C


308 #¥agm®
Æign
 4 (
dü_£À˘abÀ_em±y_ic⁄
)

310 #ifde‡
__GNUC__


311 c⁄° 
guöt8
 
	gdü_£À˘abÀ_em±y_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

313 c⁄° 
guöt8
 
dü_£À˘abÀ_em±y_ic⁄
[] =

422 #ifde‡
__SUNPRO_C


423 #¥agm®
Æign
 4 (
dü_⁄_grid_ic⁄
)

425 #ifde‡
__GNUC__


426 c⁄° 
guöt8
 
	gdü_⁄_grid_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

428 c⁄° 
guöt8
 
dü_⁄_grid_ic⁄
[] =

582 #ifde‡
__SUNPRO_C


583 #¥agm®
Æign
 4 (
dü_off_grid_ic⁄
)

585 #ifde‡
__GNUC__


586 c⁄° 
guöt8
 
	gdü_off_grid_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

588 c⁄° 
guöt8
 
dü_off_grid_ic⁄
[] =

743 #ifde‡
__SUNPRO_C


744 #¥agm®
Æign
 4 (
dü_visibÀ_ic⁄
)

746 #ifde‡
__GNUC__


747 c⁄° 
guöt8
 
	gdü_visibÀ_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

749 c⁄° 
guöt8
 
dü_visibÀ_ic⁄
[] =

849 #ifde‡
__SUNPRO_C


850 #¥agm®
Æign
 4 (
dü_visibÀ_em±y_ic⁄
)

852 #ifde‡
__GNUC__


853 c⁄° 
guöt8
 
	gdü_visibÀ_em±y_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

855 c⁄° 
guöt8
 
dü_visibÀ_em±y_ic⁄
[] =

964 #ifde‡
__SUNPRO_C


965 #¥agm®
Æign
 4 (
dü_modify_toﬁ_ic⁄
)

967 #ifde‡
__GNUC__


968 c⁄° 
guöt8
 
	gdü_modify_toﬁ_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

970 c⁄° 
guöt8
 
dü_modify_toﬁ_ic⁄
[] =

1060 #ifde‡
__SUNPRO_C


1061 #¥agm®
Æign
 4 (
dü_s¸ﬁl_toﬁ_ic⁄
)

1063 #ifde‡
__GNUC__


1064 c⁄° 
guöt8
 
	gdü_s¸ﬁl_toﬁ_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

1066 c⁄° 
guöt8
 
dü_s¸ﬁl_toﬁ_ic⁄
[] =

1144 #ifde‡
__SUNPRO_C


1145 #¥agm®
Æign
 4 (
dü_ãxãdô_toﬁ_ic⁄
)

1147 #ifde‡
__GNUC__


1148 c⁄° 
guöt8
 
	gdü_ãxãdô_toﬁ_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

1150 c⁄° 
guöt8
 
dü_ãxãdô_toﬁ_ic⁄
[] =

1235 #ifde‡
__SUNPRO_C


1236 #¥agm®
Æign
 4 (
dü_zoom_toﬁ_ic⁄
)

1238 #ifde‡
__GNUC__


1239 c⁄° 
guöt8
 
	gdü_zoom_toﬁ_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

1241 c⁄° 
guöt8
 
dü_zoom_toﬁ_ic⁄
[] =

1328 #ifde‡
__SUNPRO_C


1329 #¥agm®
Æign
 4 (
dü_group_ic⁄
)

1331 #ifde‡
__GNUC__


1332 c⁄° 
guöt8
 
	gdü_group_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

1334 c⁄° 
guöt8
 
dü_group_ic⁄
[] =

1402 #ifde‡
__SUNPRO_C


1403 #¥agm®
Æign
 4 (
dü_ungroup_ic⁄
)

1405 #ifde‡
__GNUC__


1406 c⁄° 
guöt8
 
	gdü_ungroup_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

1408 c⁄° 
guöt8
 
dü_ungroup_ic⁄
[] =

1476 #ifde‡
__SUNPRO_C


1477 #¥agm®
Æign
 4 (
dü_maöpoöts_⁄_ic⁄
)

1479 #ifde‡
__GNUC__


1480 c⁄° 
guöt8
 
	gdü_maöpoöts_⁄_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

1482 c⁄° 
guöt8
 
dü_maöpoöts_⁄_ic⁄
[] =

1630 #ifde‡
__SUNPRO_C


1631 #¥agm®
Æign
 4 (
dü_maöpoöts_off_ic⁄
)

1633 #ifde‡
__GNUC__


1634 c⁄° 
guöt8
 
	gdü_maöpoöts_off_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

1636 c⁄° 
guöt8
 
dü_maöpoöts_off_ic⁄
[] =

1784 #ifde‡
__SUNPRO_C


1785 #¥agm®
Æign
 4 (
dü_dügøm_ic⁄
)

1787 #ifde‡
__GNUC__


1788 c⁄° 
guöt8
 
	gdü_dügøm_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

1790 c⁄° 
guöt8
 
dü_dügøm_ic⁄
[] =

2142 #ifde‡
__SUNPRO_C


2143 #¥agm®
Æign
 4 (
dü_≠p_ic⁄
)

2145 #ifde‡
__GNUC__


2146 c⁄° 
guöt8
 
	gdü_≠p_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

2148 c⁄° 
guöt8
 
dü_≠p_ic⁄
[] =

2455 #ifde‡
__SUNPRO_C


2456 #¥agm®
Æign
 4 (
dü_obje˘s_œyî_above
)

2458 #ifde‡
__GNUC__


2459 c⁄° 
guöt8
 
	gdü_obje˘s_œyî_above
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

2461 c⁄° 
guöt8
 
dü_obje˘s_œyî_above
[] =

2531 #ifde‡
__SUNPRO_C


2532 #¥agm®
Æign
 4 (
dü_obje˘s_œyî_bñow
)

2534 #ifde‡
__GNUC__


2535 c⁄° 
guöt8
 
	gdü_obje˘s_œyî_bñow
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

2537 c⁄° 
guöt8
 
dü_obje˘s_œyî_bñow
[] =

2607 #ifde‡
__SUNPRO_C


2608 #¥agm®
Æign
 4 (
dü_œyîs
)

2610 #ifde‡
__GNUC__


2611 c⁄° 
guöt8
 
	gdü_œyîs
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

2613 c⁄° 
guöt8
 
dü_œyîs
[] =

2682 #ifde‡
__SUNPRO_C


2683 #¥agm®
Æign
 4 (
dü_œyî_add
)

2685 #ifde‡
__GNUC__


2686 c⁄° 
guöt8
 
	gdü_œyî_add
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

2688 c⁄° 
guöt8
 
dü_œyî_add
[] =

2759 #ifde‡
__SUNPRO_C


2760 #¥agm®
Æign
 4 (
dü_œyî_ª«me
)

2762 #ifde‡
__GNUC__


2763 c⁄° 
guöt8
 
	gdü_œyî_ª«me
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

2765 c⁄° 
guöt8
 
dü_œyî_ª«me
[] =

	@O:\tool\dvs50\app\dia-props.c

22 #ifde‡
HAVE_CONFIG_H


23 
	~<c⁄fig.h
>

26 
	~"dü-¥›s.h
"

28 
	~<gtk/gtk.h
>

30 
	~"öé.h
"

31 
	~"di•œy.h
"

32 
	~"widgës.h
"

33 
	~"di•œy.h
"

35 
GtkWidgë
 *
	gdülog
 = 
NULL
;

36 
GtkWidgë
 *
	gdy«mic_check
;

37 
GtkWidgë
 *
	gwidth_x_íåy
, *
	gwidth_y_íåy
;

38 
GtkWidgë
 *
	gvisibÀ_x_íåy
, *
	gvisibÀ_y_íåy
;

39 
GtkWidgë
 *
	gbg_cﬁour
, *
	ggrid_cﬁour
, *
	g∑gebªak_cﬁour
;

40 
GtkWidgë
 *
	ghex_check
, *
	ghex_size_íåy
;

42 
dügøm_¥›îtõs_ª•⁄d
(
GtkWidgë
 *
widgë
,

43 
göt
 
ª•⁄£_id
,

44 
gpoöãr
 
u£r_d©a
);

47 
	$dügøm_¥›îtõs_upd©e_£nsôivôy
(
GtkToggÀBuâ⁄
 *
widgë
,

48 
gpoöãr
 
u£rd©a
)

50 
Dügøm
 *
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

51 
gboﬁón
 
dyn_grid
, 
squ¨e_grid
, 
hex_grid
;

53 i‡(!
dü
)

56 
dü
->
grid
.
dy«mic
 =

57 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
dy«mic_check
));

58 
dyn_grid
 = 
dü
->
grid
.
dy«mic
;

59 i‡(!
dyn_grid
)

60 
dü
->
grid
.
hex
 =

61 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
hex_check
));

63 
squ¨e_grid
 = !
dyn_grid
 && !
dü
->
grid
.
hex
;

64 
hex_grid
 = !
dyn_grid
 && 
dü
->
grid
.
hex
;

67 
	`gtk_widgë_£t_£nsôive
(
width_x_íåy
, 
squ¨e_grid
);

68 
	`gtk_widgë_£t_£nsôive
(
width_y_íåy
, 
squ¨e_grid
);

69 
	`gtk_widgë_£t_£nsôive
(
visibÀ_x_íåy
, 
squ¨e_grid
);

70 
	`gtk_widgë_£t_£nsôive
(
visibÀ_y_íåy
, 
squ¨e_grid
);

71 
	`gtk_widgë_£t_£nsôive
(
hex_check
, !
dyn_grid
);

72 
	`gtk_widgë_£t_£nsôive
(
hex_size_íåy
, 
hex_grid
);

73 
	}
}

76 
	$¸óã_dügøm_¥›îtõs_dülog
(
Dügøm
 *
dü
)

78 
GtkWidgë
 *
dülog_vbox
;

79 
GtkWidgë
 *
nŸebook
;

80 
GtkWidgë
 *
èbÀ
;

81 
GtkWidgë
 *
œbñ
;

82 
GtkAdju°mít
 *
adj
;

84 
dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
(

85 
	`_
("Diagram Properties"),

86 
	`GTK_WINDOW
(
	`ddi•œy_a˘ive
()->
shñl
),

87 
GTK_DIALOG_DESTROY_WITH_PARENT
,

88 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CANCEL
,

89 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

90 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

91 
NULL
);

93 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
(
dülog
), 
GTK_RESPONSE_OK
);

95 
dülog_vbox
 = 
	`GTK_DIALOG
(
dülog
)->
vbox
;

97 
	`gtk_wödow_£t_rﬁe
(
	`GTK_WINDOW
(
dülog
), "diagram_properties");

99 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
dülog
), "response",

100 
	`G_CALLBACK
(
dügøm_¥›îtõs_ª•⁄d
),

101 
NULL
);

102 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
dülog
), "delete_event",

103 
	`G_CALLBACK
(
gtk_widgë_hide
), 
NULL
);

104 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
dülog
), "destroy",

105 
	`G_CALLBACK
(
gtk_widgë_de°royed
), &
dülog
);

107 
nŸebook
 = 
	`gtk_nŸebook_√w
();

108 
	`gtk_nŸebook_£t_èb_pos
(
	`GTK_NOTEBOOK
(
nŸebook
), 
GTK_POS_TOP
);

109 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
dülog_vbox
), 
nŸebook
, 
TRUE
, TRUE, 0);

110 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
nŸebook
), 2);

111 
	`gtk_widgë_show
(
nŸebook
);

114 
èbÀ
 = 
	`gtk_èbÀ_√w
(3,3,
FALSE
);

115 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
èbÀ
), 2);

116 
	`gtk_èbÀ_£t_row_•acögs
(
	`GTK_TABLE
(
èbÀ
), 1);

117 
	`gtk_èbÀ_£t_cﬁ_•acögs
(
	`GTK_TABLE
(
èbÀ
), 2);

119 
dy«mic_check
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Dynamic grid"));

120 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
dy«mic_check
, 1,2, 0,1,

121 
GTK_FILL
, GTK_FILL, 0, 0);

122 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
dy«mic_check
), "toggled",

123 
	`G_CALLBACK
(
dügøm_¥›îtõs_upd©e_£nsôivôy
), 
NULL
);

125 
	`gtk_widgë_show
(
dy«mic_check
);

127 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("x"));

128 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
œbñ
, 1,2, 1,2,

129 
GTK_FILL
, GTK_FILL, 0, 0);

130 
	`gtk_widgë_show
(
œbñ
);

131 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("y"));

132 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
œbñ
, 2,3, 1,2,

133 
GTK_FILL
, GTK_FILL, 0, 0);

134 
	`gtk_widgë_show
(
œbñ
);

136 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Spacing"));

137 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

138 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
œbñ
, 0,1, 2,3,

139 
GTK_FILL
, GTK_FILL, 0, 0);

140 
	`gtk_widgë_show
(
œbñ
);

142 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1.0, 0.0, 10.0, 0.1, 10.0, 0));

143 
width_x_íåy
 = 
	`gtk_•ö_buâ⁄_√w
(
adj
, 1.0, 3);

144 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
width_x_íåy
), 
TRUE
);

145 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
width_x_íåy
, 1,2, 2,3,

146 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

147 
	`gtk_widgë_show
(
width_x_íåy
);

149 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1.0, 0.0, 10.0, 0.1, 10.0, 0));

150 
width_y_íåy
 = 
	`gtk_•ö_buâ⁄_√w
(
adj
, 1.0, 3);

151 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
width_y_íåy
), 
TRUE
);

152 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
width_y_íåy
, 2,3, 2,3,

153 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

154 
	`gtk_widgë_show
(
width_y_íåy
);

156 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Visible spacing"));

157 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

158 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
œbñ
, 0,1, 3,4,

159 
GTK_FILL
, GTK_FILL, 0, 0);

160 
	`gtk_widgë_show
(
œbñ
);

162 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1.0, 0.0, 100.0, 1.0, 10.0, 0));

163 
visibÀ_x_íåy
 = 
	`gtk_•ö_buâ⁄_√w
(
adj
, 1.0, 0);

164 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
visibÀ_x_íåy
), 
TRUE
);

165 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
visibÀ_x_íåy
, 1,2, 3,4,

166 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

167 
	`gtk_widgë_show
(
visibÀ_x_íåy
);

169 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1.0, 0.0, 100.0, 1.0, 10.0, 0));

170 
visibÀ_y_íåy
 = 
	`gtk_•ö_buâ⁄_√w
(
adj
, 1.0, 0);

171 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
visibÀ_y_íåy
), 
TRUE
);

172 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
visibÀ_y_íåy
, 2,3, 3,4,

173 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

174 
	`gtk_widgë_show
(
visibÀ_y_íåy
);

177 
hex_check
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Hex grid"));

178 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
hex_check
, 1,2, 4,5,

179 
GTK_FILL
, GTK_FILL, 0, 0);

180 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
hex_check
), "toggled",

181 
	`G_CALLBACK
(
dügøm_¥›îtõs_upd©e_£nsôivôy
), 
NULL
);

183 
	`gtk_widgë_show
(
hex_check
);

185 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Hex grid size"));

186 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

187 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
œbñ
, 0,1, 5,6,

188 
GTK_FILL
, GTK_FILL, 0, 0);

189 
	`gtk_widgë_show
(
œbñ
);

191 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1.0, 0.0, 100.0, 1.0, 10.0, 0));

192 
hex_size_íåy
 = 
	`gtk_•ö_buâ⁄_√w
(
adj
, 1.0, 0);

193 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
hex_size_íåy
), 
TRUE
);

194 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
hex_size_íåy
, 1,2, 5,6,

195 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

196 
	`gtk_widgë_show
(
hex_size_íåy
);

198 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Grid"));

199 
	`gtk_nŸebook_≠≥nd_∑ge
(
	`GTK_NOTEBOOK
(
nŸebook
), 
èbÀ
, 
œbñ
);

200 
	`gtk_widgë_show
(
èbÀ
);

201 
	`gtk_widgë_show
(
œbñ
);

204 
èbÀ
 = 
	`gtk_èbÀ_√w
(1,2, 
FALSE
);

205 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
èbÀ
), 2);

206 
	`gtk_èbÀ_£t_row_•acögs
(
	`GTK_TABLE
(
èbÀ
), 1);

207 
	`gtk_èbÀ_£t_cﬁ_•acögs
(
	`GTK_TABLE
(
èbÀ
), 2);

209 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Background"));

210 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

211 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
œbñ
, 0,1, 0,1,

212 
GTK_FILL
, GTK_FILL, 0, 0);

213 
	`gtk_widgë_show
(
œbñ
);

215 
bg_cﬁour
 = 
	`dü_cﬁ‹_£À˘‹_√w
();

216 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
bg_cﬁour
, 1,2, 0,1,

217 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

218 
	`gtk_widgë_show
(
bg_cﬁour
);

220 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Grid Lines"));

221 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

222 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
œbñ
, 0,1, 1,2,

223 
GTK_FILL
, GTK_FILL, 0, 0);

224 
	`gtk_widgë_show
(
œbñ
);

226 
grid_cﬁour
 = 
	`dü_cﬁ‹_£À˘‹_√w
();

227 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
grid_cﬁour
, 1,2, 1,2,

228 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

229 
	`gtk_widgë_show
(
grid_cﬁour
);

231 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Page Breaks"));

232 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

233 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
œbñ
, 0,1, 2,3,

234 
GTK_FILL
, GTK_FILL, 0, 0);

235 
	`gtk_widgë_show
(
œbñ
);

237 
∑gebªak_cﬁour
 = 
	`dü_cﬁ‹_£À˘‹_√w
();

238 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
∑gebªak_cﬁour
, 1,2, 2,3,

239 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

240 
	`gtk_widgë_show
(
∑gebªak_cﬁour
);

242 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Colors"));

243 
	`gtk_nŸebook_≠≥nd_∑ge
(
	`GTK_NOTEBOOK
(
nŸebook
), 
èbÀ
, 
œbñ
);

244 
	`gtk_widgë_show
(
èbÀ
);

245 
	`gtk_widgë_show
(
œbñ
);

246 
	}
}

253 
	$dügøm_¥›îtõs_ªåõve
(
Dügøm
 *
dü
)

255 
gch¨
 *
tôÀ
;

256 
gch¨
 *
«me
 = 
dü
 ? 
	`dügøm_gë_«me
(dia) : "?";

258 
	`g_ªtu∫_if_Áû
(
dü
 !
NULL
);

259 i‡(!
dülog
)

263 
tôÀ
 = 
	`g_°rdup_¥ötf
(
	`_
("Dügøm Pr›îtõs: %s"), 
«me
 ?Çame : "??");

264 
	`gtk_wödow_£t_tôÀ
(
	`GTK_WINDOW
(
dülog
), 
tôÀ
);

265 
	`g_‰ì
(
«me
);

266 
	`g_‰ì
(
tôÀ
);

267 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
dy«mic_check
),

268 
dü
->
grid
.
dy«mic
);

269 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
width_x_íåy
),

270 
dü
->
grid
.
width_x
);

271 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
width_y_íåy
),

272 
dü
->
grid
.
width_y
);

273 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
visibÀ_x_íåy
),

274 
dü
->
grid
.
visibÀ_x
);

275 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
visibÀ_y_íåy
),

276 
dü
->
grid
.
visibÀ_y
);

277 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
hex_check
),

278 
dü
->
grid
.
hex
);

279 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
hex_size_íåy
),

280 
dü
->
grid
.
hex_size
);

282 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
bg_cﬁour
,

283 &
dü
->
d©a
->
bg_cﬁ‹
);

284 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
grid_cﬁour
,

285 &
dü
->
grid
.
cﬁour
);

286 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
∑gebªak_cﬁour
,

287 &
dü
->
∑gebªak_cﬁ‹
);

289 
	`dügøm_¥›îtõs_upd©e_£nsôivôy
(
	`GTK_TOGGLE_BUTTON
(
dy«mic_check
), 
dü
);

291 
	}
}

294 
	$dügøm_¥›îtõs_show
(
Dügøm
 *
dü
)

296 i‡(
dülog
) {

298 
	`gtk_widgë_de°roy
(
dülog
);

299 
dülog
 = 
NULL
;

302 
	`¸óã_dügøm_¥›îtõs_dülog
(
dü
);

304 
	`dügøm_¥›îtõs_ªåõve
(
dü
);

306 
	`gtk_wödow_£t_å™sõ¡_f‹
(
	`GTK_WINDOW
(
dülog
),

307 
	`GTK_WINDOW
 (
	`ddi•œy_a˘ive
()->
shñl
));

308 
	`gtk_widgë_show
(
dülog
);

309 
	}
}

312 
	$dügøm_¥›îtõs_ª•⁄d
(
GtkWidgë
 *
widgë
,

313 
göt
 
ª•⁄£_id
,

314 
gpoöãr
 
u£r_d©a
)

316 
Dügøm
 *
a˘ive_dügøm
 = 
	`ddi•œy_a˘ive_dügøm
();

318 i‡(
ª•⁄£_id
 =
GTK_RESPONSE_OK
 ||

319 
ª•⁄£_id
 =
GTK_RESPONSE_APPLY
) {

320 i‡(
a˘ive_dügøm
) {

321 
a˘ive_dügøm
->
grid
.
dy«mic
 =

322 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
dy«mic_check
));

323 
a˘ive_dügøm
->
grid
.
width_x
 =

324 
	`gtk_•ö_buâ⁄_gë_vÆue
(
	`GTK_SPIN_BUTTON
(
width_x_íåy
));

325 
a˘ive_dügøm
->
grid
.
width_y
 =

326 
	`gtk_•ö_buâ⁄_gë_vÆue
(
	`GTK_SPIN_BUTTON
(
width_y_íåy
));

327 
a˘ive_dügøm
->
grid
.
visibÀ_x
 =

328 
	`gtk_•ö_buâ⁄_gë_vÆue_as_öt
(
	`GTK_SPIN_BUTTON
(
visibÀ_x_íåy
));

329 
a˘ive_dügøm
->
grid
.
visibÀ_y
 =

330 
	`gtk_•ö_buâ⁄_gë_vÆue_as_öt
(
	`GTK_SPIN_BUTTON
(
visibÀ_y_íåy
));

331 
a˘ive_dügøm
->
grid
.
hex
 =

332 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
hex_check
));

333 
a˘ive_dügøm
->
grid
.
hex_size
 =

334 
	`gtk_•ö_buâ⁄_gë_vÆue
(
	`GTK_SPIN_BUTTON
(
hex_size_íåy
));

335 
	`dü_cﬁ‹_£À˘‹_gë_cﬁ‹
(
bg_cﬁour
,

336 &
a˘ive_dügøm
->
d©a
->
bg_cﬁ‹
);

337 
	`dü_cﬁ‹_£À˘‹_gë_cﬁ‹
(
grid_cﬁour
,

338 &
a˘ive_dügøm
->
grid
.
cﬁour
);

339 
	`dü_cﬁ‹_£À˘‹_gë_cﬁ‹
(
∑gebªak_cﬁour
,

340 &
a˘ive_dügøm
->
∑gebªak_cﬁ‹
);

341 
	`dügøm_add_upd©e_Æl
(
a˘ive_dügøm
);

342 
	`dügøm_Êush
(
a˘ive_dügøm
);

343 
	`dügøm_£t_modifõd
(
a˘ive_dügøm
, 
TRUE
);

346 i‡(
ª•⁄£_id
 !
GTK_RESPONSE_APPLY
)

347 
	`gtk_widgë_hide
(
dülog
);

348 
	}
}

355 
	$dügøm_¥›îtõs_£t_dügøm
(
Dügøm
 *
dü
)

357 i‡(
dülog
 && 
dü
 !
NULL
)

359 
	`dügøm_¥›îtõs_ªåõve
(
dü
);

361 
	}
}

	@O:\tool\dvs50\app\dia-props.h

22 #i‚de‡
_DIA_PROPS_H_


23 
	#_DIA_PROPS_H_


	)

24 
	~"dügøm.h
"

26 
dügøm_¥›îtõs_show
(
Dügøm
 *
dü
);

27 
dügøm_¥›îtõs_£t_dügøm
(
Dügøm
 *
dü
);

	@O:\tool\dvs50\app\diacanvas.c

27 
	~"düˇnvas.h
"

28 
	~"öé.h
"

31 
	mCHILD_PROP_0
,

32 
	mCHILD_PROP_X
,

33 
	mCHILD_PROP_Y


36 
dü_ˇnvas_˛ass_öô
 (
DüC™vasCœss
 *
kœss
);

37 
dü_ˇnvas_öô
 (
DüC™vas
 *
ˇnvas
);

38 
dü_ˇnvas_ªÆize
 (
GtkWidgë
 *
widgë
);

39 
dü_ˇnvas_size_ªque°
 (
GtkWidgë
 *
widgë
,

40 
GtkRequisôi⁄
 *
ªquisôi⁄
);

41 
dü_ˇnvas_size_Æloˇã
 (
GtkWidgë
 *
widgë
,

42 
GtkAŒoˇti⁄
 *
Æloˇti⁄
);

43 
dü_ˇnvas_add
 (
GtkC⁄èöî
 *
c⁄èöî
,

44 
GtkWidgë
 *
widgë
);

45 
dü_ˇnvas_ªmove
 (
GtkC⁄èöî
 *
c⁄èöî
,

46 
GtkWidgë
 *
widgë
);

47 
dü_ˇnvas_f‹Æl
 (
GtkC⁄èöî
 *
c⁄èöî
,

48 
gboﬁón
 
ö˛ude_öã∫Æs
,

49 
GtkCÆlback
 
ˇŒback
,

50 
gpoöãr
 
ˇŒback_d©a
);

51 
GTy≥
 
dü_ˇnvas_chûd_ty≥
 (
GtkC⁄èöî
 *
c⁄èöî
);

53 
dü_ˇnvas_£t_chûd_¥›îty
 (
GtkC⁄èöî
 *
c⁄èöî
,

54 
GtkWidgë
 *
chûd
,

55 
guöt
 
¥›îty_id
,

56 c⁄° 
GVÆue
 *
vÆue
,

57 
GP¨amS≥c
 *
p•ec
);

58 
dü_ˇnvas_gë_chûd_¥›îty
 (
GtkC⁄èöî
 *
c⁄èöî
,

59 
GtkWidgë
 *
chûd
,

60 
guöt
 
¥›îty_id
,

61 
GVÆue
 *
vÆue
,

62 
GP¨amS≥c
 *
p•ec
);

63 
dü_ˇnvas_£nd_c⁄figuª
 (
DüC™vas
 *
d¨ó
);

65 
GtkC⁄èöîCœss
 *
	g∑ª¡_˛ass
 = 
NULL
;

68 
GTy≥


69 
	$dü_ˇnvas_gë_ty≥
 ()

71 
GTy≥
 
ˇnvas_ty≥
 = 0;

73 i‡(!
ˇnvas_ty≥
)

75 c⁄° 
GTy≥Info
 
ˇnvas_öfo
 =

77  (
DüC™vasCœss
),

78 
NULL
,

79 
NULL
,

80 (
GCœssInôFunc
Ë
dü_ˇnvas_˛ass_öô
,

81 
NULL
,

82 
NULL
,

83  (
DüC™vas
),

85 (
GIn°™˚InôFunc
Ë
dü_ˇnvas_öô
,

88 
ˇnvas_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
GTK_TYPE_CONTAINER
, "DiaCanvas",

89 &
ˇnvas_öfo
, 0);

92  
ˇnvas_ty≥
;

93 
	}
}

96 
	$dü_ˇnvas_˛ass_öô
 (
DüC™vasCœss
 *
˛ass
)

98 
GtkWidgëCœss
 *
widgë_˛ass
;

99 
GtkC⁄èöîCœss
 *
c⁄èöî_˛ass
;

101 
widgë_˛ass
 = (
GtkWidgëCœss
*Ë
˛ass
;

102 
c⁄èöî_˛ass
 = (
GtkC⁄èöîCœss
*Ë
˛ass
;

104 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
˛ass
);

106 
widgë_˛ass
->
ªÆize
 = 
dü_ˇnvas_ªÆize
;

107 
widgë_˛ass
->
size_ªque°
 = 
dü_ˇnvas_size_ªque°
;

108 
widgë_˛ass
->
size_Æloˇã
 = 
dü_ˇnvas_size_Æloˇã
;

110 
c⁄èöî_˛ass
->
add
 = 
dü_ˇnvas_add
;

111 
c⁄èöî_˛ass
->
ªmove
 = 
dü_ˇnvas_ªmove
;

112 
c⁄èöî_˛ass
->
f‹Æl
 = 
dü_ˇnvas_f‹Æl
;

113 
c⁄èöî_˛ass
->
chûd_ty≥
 = 
dü_ˇnvas_chûd_ty≥
;

115 
c⁄èöî_˛ass
->
£t_chûd_¥›îty
 = 
dü_ˇnvas_£t_chûd_¥›îty
;

116 
c⁄èöî_˛ass
->
gë_chûd_¥›îty
 = 
dü_ˇnvas_gë_chûd_¥›îty
;

118 
	`gtk_c⁄èöî_˛ass_ö°Æl_chûd_¥›îty
 (
c⁄èöî_˛ass
,

119 
CHILD_PROP_X
,

120 
	`g_∑øm_•ec_öt
 ("x",

121 
	`_
("XÖosition"),

122 
	`_
("XÖosition of child widget"),

123 
G_MININT
,

124 
G_MAXINT
,

126 
G_PARAM_READWRITE
));

128 
	`gtk_c⁄èöî_˛ass_ö°Æl_chûd_¥›îty
 (
c⁄èöî_˛ass
,

129 
CHILD_PROP_Y
,

130 
	`g_∑øm_•ec_öt
 ("y",

131 
	`_
("YÖosition"),

132 
	`_
("YÖosition of child widget"),

133 
G_MININT
,

134 
G_MAXINT
,

136 
G_PARAM_READWRITE
));

137 
	}
}

139 
GTy≥


140 
	$dü_ˇnvas_chûd_ty≥
 (
GtkC⁄èöî
 *
c⁄èöî
)

142  
GTK_TYPE_WIDGET
;

143 
	}
}

146 
	$dü_ˇnvas_öô
 (
DüC™vas
 *
ˇnvas
)

148 
ˇnvas
->
chûdªn
 = 
NULL
;

149 
	}
}

151 
GtkWidgë
*

152 
	$dü_ˇnvas_√w
 ()

154  
	`g_obje˘_√w
 (
DIA_TYPE_CANVAS
, 
NULL
);

155 
	}
}

158 
	$dü_ˇnvas_£t_size
 (
DüC™vas
 *
ˇnvas
,

159 
göt
 
width
,

160 
göt
 
height
)

162 
	`g_ªtu∫_if_Áû
 (
	`DIA_IS_CANVAS
 (
ˇnvas
));

164 
ˇnvas
->
w™ãdsize
.
width
 = width;

165 
ˇnvas
->
w™ãdsize
.
height
 = height;

167 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
ˇnvas
));

168 
	}
}

171 
	$dü_ˇnvas_£nd_c⁄figuª
 (
DüC™vas
 *
d¨ó
)

173 
GtkWidgë
 *
widgë
;

174 
GdkEvít
 *
evít
 = 
	`gdk_evít_√w
 (
GDK_CONFIGURE
);

176 
widgë
 = 
	`GTK_WIDGET
 (
d¨ó
);

178 
evít
->
c⁄figuª
.
wödow
 = 
	`g_obje˘_ªf
 (
widgë
->window);

179 
evít
->
c⁄figuª
.
£nd_evít
 = 
TRUE
;

180 
evít
->
c⁄figuª
.
x
 = 
widgë
->
Æloˇti⁄
.x;

181 
evít
->
c⁄figuª
.
y
 = 
widgë
->
Æloˇti⁄
.y;

182 
evít
->
c⁄figuª
.
width
 = 
widgë
->
Æloˇti⁄
.width;

183 
evít
->
c⁄figuª
.
height
 = 
widgë
->
Æloˇti⁄
.height;

185 
	`gtk_widgë_evít
 (
widgë
, 
evít
);

186 
	`gdk_evít_‰ì
 (
evít
);

187 
	}
}

189 
DüC™vasChûd
*

190 
	$gë_chûd
 (
DüC™vas
 *
ˇnvas
,

191 
GtkWidgë
 *
widgë
)

193 
GLi°
 *
chûdªn
;

195 
chûdªn
 = 
ˇnvas
->children;

196 
chûdªn
)

198 
DüC™vasChûd
 *
chûd
;

200 
chûd
 = 
chûdªn
->
d©a
;

201 
chûdªn
 = chûdªn->
√xt
;

203 i‡(
chûd
->
widgë
 == widget)

204  
chûd
;

207  
NULL
;

208 
	}
}

211 
	$dü_ˇnvas_put
 (
DüC™vas
 *
ˇnvas
,

212 
GtkWidgë
 *
widgë
,

213 
göt
 
x
,

214 
göt
 
y
)

216 
DüC™vasChûd
 *
chûd_öfo
;

218 
	`g_ªtu∫_if_Áû
 (
	`DIA_IS_CANVAS
 (
ˇnvas
));

219 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WIDGET
 (
ˇnvas
));

221 
chûd_öfo
 = 
	`g_√w
 (
DüC™vasChûd
, 1);

222 
chûd_öfo
->
widgë
 = widget;

223 
chûd_öfo
->
x
 = x;

224 
chûd_öfo
->
y
 = y;

226 
	`gtk_widgë_£t_∑ª¡
 (
widgë
, 
	`GTK_WIDGET
 (
ˇnvas
));

228 
ˇnvas
->
chûdªn
 = 
	`g_li°_≠≥nd
 (ˇnvas->chûdªn, 
chûd_öfo
);

229 
	}
}

232 
	$dü_ˇnvas_move_öã∫Æ
 (
DüC™vas
 *
ˇnvas
,

233 
GtkWidgë
 *
widgë
,

234 
gboﬁón
 
ch™ge_x
,

235 
göt
 
x
,

236 
gboﬁón
 
ch™ge_y
,

237 
göt
 
y
)

239 
DüC™vasChûd
 *
chûd
;

241 
	`g_ªtu∫_if_Áû
 (
	`DIA_IS_CANVAS
 (
ˇnvas
));

242 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WIDGET
 (
widgë
));

243 
	`g_ªtu∫_if_Áû
 (
widgë
->
∑ª¡
 =
	`GTK_WIDGET
 (
ˇnvas
));

245 
chûd
 = 
	`gë_chûd
 (
ˇnvas
, 
widgë
);

247 
	`g_as£π
 (
chûd
);

249 
	`gtk_widgë_‰ìze_chûd_nŸify
 (
widgë
);

251 i‡(
ch™ge_x
)

253 
chûd
->
x
 = x;

254 
	`gtk_widgë_chûd_nŸify
 (
widgë
, "x");

257 i‡(
ch™ge_y
)

259 
chûd
->
y
 = y;

260 
	`gtk_widgë_chûd_nŸify
 (
widgë
, "y");

263 
	`gtk_widgë_thaw_chûd_nŸify
 (
widgë
);

265 i‡(
	`GTK_WIDGET_VISIBLE
 (
widgë
Ë&& GTK_WIDGET_VISIBLE (
ˇnvas
))

266 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
ˇnvas
));

267 
	}
}

270 
	$dü_ˇnvas_move
 (
DüC™vas
 *
ˇnvas
,

271 
GtkWidgë
 *
widgë
,

272 
göt
 
x
,

273 
göt
 
y
)

275 
	`dü_ˇnvas_move_öã∫Æ
 (
ˇnvas
, 
widgë
, 
TRUE
, 
x
, TRUE, 
y
);

276 
	}
}

279 
	$dü_ˇnvas_£t_chûd_¥›îty
 (
GtkC⁄èöî
 *
c⁄èöî
,

280 
GtkWidgë
 *
chûd
,

281 
guöt
 
¥›îty_id
,

282 c⁄° 
GVÆue
 *
vÆue
,

283 
GP¨amS≥c
 *
p•ec
)

285 
¥›îty_id
)

287 
CHILD_PROP_X
:

288 
	`dü_ˇnvas_move_öã∫Æ
 (
	`DIA_CANVAS
 (
c⁄èöî
),

289 
chûd
,

290 
TRUE
, 
	`g_vÆue_gë_öt
 (
vÆue
),

291 
FALSE
, 0);

293 
CHILD_PROP_Y
:

294 
	`dü_ˇnvas_move_öã∫Æ
 (
	`DIA_CANVAS
 (
c⁄èöî
),

295 
chûd
,

296 
FALSE
, 0,

297 
TRUE
, 
	`g_vÆue_gë_öt
 (
vÆue
));

300 
	`GTK_CONTAINER_WARN_INVALID_CHILD_PROPERTY_ID
 (
c⁄èöî
, 
¥›îty_id
, 
p•ec
);

303 
	}
}

306 
	$dü_ˇnvas_gë_chûd_¥›îty
 (
GtkC⁄èöî
 *
c⁄èöî
,

307 
GtkWidgë
 *
chûd
,

308 
guöt
 
¥›îty_id
,

309 
GVÆue
 *
vÆue
,

310 
GP¨amS≥c
 *
p•ec
)

312 
DüC™vasChûd
 *
ˇnvas_chûd
;

314 
ˇnvas_chûd
 = 
	`gë_chûd
 (
	`DIA_CANVAS
 (
c⁄èöî
), 
chûd
);

316 
¥›îty_id
)

318 
CHILD_PROP_X
:

319 
	`g_vÆue_£t_öt
 (
vÆue
, 
ˇnvas_chûd
->
x
);

321 
CHILD_PROP_Y
:

322 
	`g_vÆue_£t_öt
 (
vÆue
, 
ˇnvas_chûd
->
y
);

325 
	`GTK_CONTAINER_WARN_INVALID_CHILD_PROPERTY_ID
 (
c⁄èöî
, 
¥›îty_id
, 
p•ec
);

328 
	}
}

331 
	$dü_ˇnvas_ªÆize
 (
GtkWidgë
 *
widgë
)

333 
GdkWödowAâr
 
©åibuãs
;

334 
göt
 
©åibuãs_mask
;

336 
	`GTK_WIDGET_SET_FLAGS
 (
widgë
, 
GTK_REALIZED
);

338 
©åibuãs
.
wödow_ty≥
 = 
GDK_WINDOW_CHILD
;

339 
©åibuãs
.
x
 = 
widgë
->
Æloˇti⁄
.x;

340 
©åibuãs
.
y
 = 
widgë
->
Æloˇti⁄
.y;

341 
©åibuãs
.
width
 = 
widgë
->
Æloˇti⁄
.width;

342 
©åibuãs
.
height
 = 
widgë
->
Æloˇti⁄
.height;

343 
©åibuãs
.
w˛ass
 = 
GDK_INPUT_OUTPUT
;

344 
©åibuãs
.
visuÆ
 = 
	`gtk_widgë_gë_visuÆ
 (
widgë
);

345 
©åibuãs
.
cﬁ‹m≠
 = 
	`gtk_widgë_gë_cﬁ‹m≠
 (
widgë
);

346 
©åibuãs
.
evít_mask
 = 
	`gtk_widgë_gë_evíts
 (
widgë
);

347 
©åibuãs
.
evít_mask
 |
GDK_EXPOSURE_MASK
 | 
GDK_BUTTON_PRESS_MASK
;

349 
©åibuãs_mask
 = 
GDK_WA_X
 | 
GDK_WA_Y
 | 
GDK_WA_VISUAL
 | 
GDK_WA_COLORMAP
;

351 
widgë
->
wödow
 = 
	`gdk_wödow_√w
 (
	`gtk_widgë_gë_∑ª¡_wödow
 (widgë), &
©åibuãs
,

352 
©åibuãs_mask
);

353 
	`gdk_wödow_£t_u£r_d©a
 (
widgë
->
wödow
, widget);

355 
widgë
->
°yÀ
 = 
	`gtk_°yÀ_©èch
 (widgë->°yÀ, widgë->
wödow
);

356 
	`gtk_°yÀ_£t_background
 (
widgë
->
°yÀ
, widgë->
wödow
, 
GTK_STATE_NORMAL
);

358 
	`dü_ˇnvas_£nd_c⁄figuª
 (
	`DIA_CANVAS
 (
widgë
));

359 
	}
}

362 
	$dü_ˇnvas_size_ªque°
 (
GtkWidgë
 *
widgë
,

363 
GtkRequisôi⁄
 *
ªquisôi⁄
)

365 
DüC™vas
 *
ˇnvas
;

366 
DüC™vasChûd
 *
chûd
;

367 
GLi°
 *
chûdªn
;

368 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

370 
ˇnvas
 = 
	`DIA_CANVAS
 (
widgë
);

372 
ªquisôi⁄
->
width
 = 
ˇnvas
->
w™ãdsize
.width;

373 
ªquisôi⁄
->
height
 = 
ˇnvas
->
w™ãdsize
.height;

376 
chûdªn
 = 
ˇnvas
->children;

377 
chûdªn
)

379 
chûd
 = 
chûdªn
->
d©a
;

380 
chûdªn
 = chûdªn->
√xt
;

382 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
))

384 
	`gtk_widgë_size_ªque°
 (
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

386 
ªquisôi⁄
->
height
 = 
	`MAX
 (requisition->height,

387 
chûd
->
y
 +

388 
chûd_ªquisôi⁄
.
height
);

389 
ªquisôi⁄
->
width
 = 
	`MAX
 (requisition->width,

390 
chûd
->
x
 +

391 
chûd_ªquisôi⁄
.
width
);

398 
	}
}

401 
	$dü_ˇnvas_size_Æloˇã
 (
GtkWidgë
 *
widgë
,

402 
GtkAŒoˇti⁄
 *
Æloˇti⁄
)

404 
DüC™vas
 *
ˇnvas
;

405 
DüC™vasChûd
 *
chûd
;

406 
GtkAŒoˇti⁄
 
chûd_Æloˇti⁄
;

407 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

408 
GLi°
 *
chûdªn
;

409 
guöt16
 
b‹dî_width
;

411 
ˇnvas
 = 
	`DIA_CANVAS
 (
widgë
);

413 
widgë
->
Æloˇti⁄
 = *allocation;

415 i‡(
	`GTK_WIDGET_REALIZED
 (
widgë
)) {

416 
	`gdk_wödow_move_ªsize
 (
widgë
->
wödow
,

417 
Æloˇti⁄
->
x
,

418 
Æloˇti⁄
->
y
,

419 
Æloˇti⁄
->
width
,

420 
Æloˇti⁄
->
height
);

421 
	`dü_ˇnvas_£nd_c⁄figuª
 (
	`DIA_CANVAS
 (
widgë
));

423 
b‹dî_width
 = 
	`GTK_CONTAINER
 (
ˇnvas
)->border_width;

425 
chûdªn
 = 
ˇnvas
->children;

426 
chûdªn
)

428 
chûd
 = 
chûdªn
->
d©a
;

429 
chûdªn
 = chûdªn->
√xt
;

431 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
))

433 
	`gtk_widgë_gë_chûd_ªquisôi⁄
 (
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

434 
chûd_Æloˇti⁄
.
x
 = 
chûd
->x + 
b‹dî_width
;

435 
chûd_Æloˇti⁄
.
y
 = 
chûd
->y + 
b‹dî_width
;

437 i‡(
	`GTK_WIDGET_NO_WINDOW
 (
widgë
))

439 
chûd_Æloˇti⁄
.
x
 +
widgë
->
Æloˇti⁄
.x;

440 
chûd_Æloˇti⁄
.
y
 +
widgë
->
Æloˇti⁄
.y;

443 
chûd_Æloˇti⁄
.
width
 = 
chûd_ªquisôi⁄
.width;

444 
chûd_Æloˇti⁄
.
height
 = 
chûd_ªquisôi⁄
.height;

445 
	`gtk_widgë_size_Æloˇã
 (
chûd
->
widgë
, &
chûd_Æloˇti⁄
);

448 
	}
}

451 
	$dü_ˇnvas_add
 (
GtkC⁄èöî
 *
c⁄èöî
,

452 
GtkWidgë
 *
widgë
)

454 
	`dü_ˇnvas_put
 (
	`DIA_CANVAS
 (
c⁄èöî
), 
widgë
, 0, 0);

455 
	}
}

458 
	$dü_ˇnvas_ªmove
 (
GtkC⁄èöî
 *
c⁄èöî
,

459 
GtkWidgë
 *
widgë
)

461 
DüC™vas
 *
ˇnvas
;

462 
DüC™vasChûd
 *
chûd
;

463 
GLi°
 *
chûdªn
;

465 
ˇnvas
 = 
	`DIA_CANVAS
 (
c⁄èöî
);

467 
chûdªn
 = 
ˇnvas
->children;

468 
chûdªn
)

470 
chûd
 = 
chûdªn
->
d©a
;

472 i‡(
chûd
->
widgë
 == widget)

474 
gboﬁón
 
was_visibÀ
 = 
	`GTK_WIDGET_VISIBLE
 (
widgë
);

476 
	`gtk_widgë_u≈¨ít
 (
widgë
);

478 
ˇnvas
->
chûdªn
 = 
	`g_li°_ªmove_lök
 (canvas->children, children);

479 
	`g_li°_‰ì
 (
chûdªn
);

480 
	`g_‰ì
 (
chûd
);

482 i‡(
was_visibÀ
 && 
	`GTK_WIDGET_VISIBLE
 (
c⁄èöî
))

483 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
c⁄èöî
));

488 
chûdªn
 = chûdªn->
√xt
;

490 
	}
}

493 
	$dü_ˇnvas_f‹Æl
 (
GtkC⁄èöî
 *
c⁄èöî
,

494 
gboﬁón
 
ö˛ude_öã∫Æs
,

495 
GtkCÆlback
 
ˇŒback
,

496 
gpoöãr
 
ˇŒback_d©a
)

498 
DüC™vas
 *
ˇnvas
;

499 
DüC™vasChûd
 *
chûd
;

500 
GLi°
 *
chûdªn
;

502 
	`g_ªtu∫_if_Áû
 (
ˇŒback
 !
NULL
);

504 
ˇnvas
 = 
	`DIA_CANVAS
 (
c⁄èöî
);

506 
chûdªn
 = 
ˇnvas
->children;

507 
chûdªn
)

509 
chûd
 = 
chûdªn
->
d©a
;

510 
chûdªn
 = chûdªn->
√xt
;

512 (* 
ˇŒback
Ë(
chûd
->
widgë
, 
ˇŒback_d©a
);

514 
	}
}

	@O:\tool\dvs50\app\diacanvas.h

27 #i‚de‡
__DIA_CANVAS_H__


28 
	#__DIA_CANVAS_H__


	)

31 
	~<gdk/gdk.h
>

32 
	~<gtk/gtkc⁄èöî.h
>

35 #ifde‡
__˝lu•lus


40 
	#DIA_TYPE_CANVAS
 (
	`dü_ˇnvas_gë_ty≥
 ())

	)

41 
	#DIA_CANVAS
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_CANVAS
, 
DüC™vas
))

	)

42 
	#DIA_CANVAS_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_CANVAS
, 
DüC™vasCœss
))

	)

43 
	#DIA_IS_CANVAS
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_CANVAS
))

	)

44 
	#DIA_IS_CANVAS_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kœss), 
DIA_TYPE_CANVAS
))

	)

45 
	#DIA_CANVAS_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_CANVAS
, 
DüC™vasCœss
))

	)

48 
_DüC™vas
 
	tDüC™vas
;

49 
_DüC™vasCœss
 
	tDüC™vasCœss
;

50 
_DüC™vasChûd
 
	tDüC™vasChûd
;

52 
	s_DüC™vas


54 
GtkC⁄èöî
 
c⁄èöî
;

56 
GtkRequisôi⁄
 
w™ãdsize
;

57 
GLi°
 *
chûdªn
;

60 
	s_DüC™vasCœss


62 
GtkC⁄èöîCœss
 
∑ª¡_˛ass
;

65 
	s_DüC™vasChûd


67 
GtkWidgë
 *
widgë
;

68 
göt
 
x
;

69 
göt
 
y
;

73 
GTy≥
 
dü_ˇnvas_gë_ty≥
 (Ë
G_GNUC_CONST
;

74 
GtkWidgë
* 
dü_ˇnvas_√w
 ();

75 
dü_ˇnvas_put
 (
DüC™vas
 *
ˇnvas
,

76 
GtkWidgë
 *
widgë
,

77 
göt
 
x
,

78 
göt
 
y
);

79 
dü_ˇnvas_move
 (
DüC™vas
 *
ˇnvas
,

80 
GtkWidgë
 *
widgë
,

81 
göt
 
x
,

82 
göt
 
y
);

83 
dü_ˇnvas_£t_size
 (
DüC™vas
 *
ˇnvas
,

84 
göt
 
width
,

85 
göt
 
height
);

87 #ifde‡
__˝lu•lus


	@O:\tool\dvs50\app\diagram.c

19 
	~<c⁄fig.h
>

21 
	~<as£π.h
>

22 
	~<°rög.h
>

24 
	~"öé.h
"

25 
	~"dügøm.h
"

26 
	~"obje˘.h
"

27 
	~"group.h
"

28 
	~"obje˘_›s.h
"

29 
	~"focus.h
"

30 
	~"mesßge.h
"

31 
	~"míus.h
"

32 
	~"¥e„ªn˚s.h
"

33 
	~"¥›îtõs-dülog.h
"

34 
	~"cut_n_∑°e.h
"

35 
	~"œyî_dülog.h
"

36 
	~"≠p_¥ocs.h
"

37 
	~"dü_dús.h
"

38 
	~"lﬂd_ßve.h
"

39 
	~"ª˚¡_fûes.h
"

40 
	~"dügøm_åì_wödow.h
"

41 
	~"autoßve.h
"

42 
	~"dy«mic_ª‰esh.h
"

43 
	~"ãxãdô.h
"

44 
	~"lib/düm¨shÆ.h
"

45 
	~"∑ª¡.h
"

47 
GLi°
 *
	g›í_dügøms
 = 
NULL
;

49 
	s_Obje˘Exã¡


51 
DüObje˘
 *
	mobje˘
;

52 
Re˘™gÀ
 
	mexã¡
;

55 
_Obje˘Exã¡
 
	tObje˘Exã¡
;

57 
göt
 
dügøm_∑ª¡_s‹t_cb
(
gc⁄°poöãr
 
a
, gc⁄°poöã∏
b
);

60 
dügøm_˛ass_öô
 (
DügømCœss
 *
kœss
);

61 
gboﬁón
 
dügøm_öô
(
Dügøm
 *
obj
, c⁄° *
fûíame
);

62 
dügøm_upd©e_f‹_fûíame
(
Dügøm
 *
dü
);

65 
	mSELECTION_CHANGED
,

66 
	mREMOVED
,

67 
	mLAST_SIGNAL


70 
guöt
 
	gdügøm_sig«ls
[
LAST_SIGNAL
] = { 0, };

71 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

73 
GTy≥


74 
	$dügøm_gë_ty≥
 ()

76 
GTy≥
 
obje˘_ty≥
 = 0;

78 i‡(!
obje˘_ty≥
)

80 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

82  (
DügømCœss
),

83 (
GBa£InôFunc
Ë
NULL
,

84 (
GBa£FöÆizeFunc
Ë
NULL
,

85 (
GCœssInôFunc
Ë
dügøm_˛ass_öô
,

86 
NULL
,

87 
NULL
,

88  (
Dügøm
),

90 
NULL


93 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
DIA_TYPE_DIAGRAM_DATA
,

95 &
obje˘_öfo
, 0);

98  
obje˘_ty≥
;

99 
	}
}

102 
	$dügøm_föÆize
(
GObje˘
 *
obje˘
)

104 
Dügøm
 *
dü
 = 
	`DIA_DIAGRAM
(
obje˘
);

106 
	`as£π
(
dü
->
di•œys
==
NULL
);

108 
›í_dügøms
 = 
	`g_li°_ªmove
(›í_dügøms, 
dü
);

109 
	`œyî_dülog_upd©e_dügøm_li°
();

111 i‡(
dü
->
undo
)

112 
	`undo_de°roy
(
dü
->
undo
);

113 
dü
->
undo
 = 
NULL
;

115 
	`dügøm_åì_ªmove
(
	`dügøm_åì
(), 
dü
);

117 
	`dügøm_˛ónup_autoßve
(
dü
);

119 i‡(
dü
->
fûíame
)

120 
	`g_‰ì
(
dü
->
fûíame
);

121 
dü
->
fûíame
 = 
NULL
;

123 
	`G_OBJECT_CLASS
 (
∑ª¡_˛ass
)->
	`föÆize
 (
obje˘
);

124 
	}
}

127 
	$_dügøm_ªmoved
 (
Dügøm
* 
dü
)

129 
	}
}

132 
	$_dügøm_£À˘i⁄_ch™ged
 (
Dügøm
* 
dü
, 
n
)

134 
	}
}

137 
	$dügøm_˛ass_öô
 (
DügømCœss
 *
kœss
)

139 
GObje˘Cœss
 *
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
kœss
);

141 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
kœss
);

143 
dügøm_sig«ls
[
REMOVED
] =

144 
	`g_sig«l_√w
 ("removed",

145 
	`G_TYPE_FROM_CLASS
 (
kœss
),

146 
G_SIGNAL_RUN_FIRST
,

147 
	`G_STRUCT_OFFSET
 (
DügømCœss
, 
ªmoved
),

148 
NULL
, NULL,

149 
dü_m¨shÆ_VOID__VOID
,

150 
G_TYPE_NONE
, 0);

152 
dügøm_sig«ls
[
SELECTION_CHANGED
] =

153 
	`g_sig«l_√w
 ("selection_changed",

154 
	`G_TYPE_FROM_CLASS
 (
kœss
),

155 
G_SIGNAL_RUN_FIRST
,

156 
	`G_STRUCT_OFFSET
 (
DügømCœss
, 
£À˘i⁄_ch™ged
),

157 
NULL
, NULL,

158 
dü_m¨shÆ_VOID__INT
,

159 
G_TYPE_NONE
, 1,

160 
G_TYPE_INT
);

162 
kœss
->
ªmoved
 = 
_dügøm_ªmoved
;

163 
kœss
->
£À˘i⁄_ch™ged
 = 
_dügøm_£À˘i⁄_ch™ged
;

165 
obje˘_˛ass
->
föÆize
 = 
dügøm_föÆize
;

166 
	}
}

168 
GLi°
 *

169 
	$dü_›í_dügøms
()

171  
›í_dügøms
;

172 
	}
}

180 
gboﬁón


181 
	$dügøm_öô
(
Dügøm
 *
dü
, c⁄° *
fûíame
)

183 
gch¨
 *
√wfûíame
 = 
NULL
;

184 
GEº‹
 *
îr‹
 = 
NULL
;

186 
dü
->
d©a
 = &dü->
∑ª¡_ö°™˚
;

188 
dü
->
∑gebªak_cﬁ‹
 = 
¥efs
.
√w_dügøm
.pagebreak_color;

190 
	`gë_∑≥r_öfo
 (&
dü
->
d©a
->
∑≥r
, -1, &
¥efs
.
√w_dügøm
);

192 
dü
->
grid
.
width_x
 = 
¥efs
.grid.
x
;

193 
dü
->
grid
.
width_y
 = 
¥efs
.grid.
y
;

194 
dü
->
grid
.
width_w
 = 
¥efs
.grid.
w
;

195 
dü
->
grid
.
hex_size
 = 1.0;

196 
dü
->
grid
.
cﬁour
 = 
¥efs
.
√w_dügøm
.
grid_cﬁ‹
;

197 
dü
->
grid
.
hex
 = 
¥efs
.grid.hex;

198 
dü
->
grid
.
visibÀ_x
 = 1;

199 
dü
->
grid
.
visibÀ_y
 = 1;

200 
dü
->
grid
.
dy«mic
 = 
¥efs
.grid.dynamic;

201 
dü
->
grid
.
maj‹_löes
 = 
¥efs
.grid.major_lines;

203 
dü
->
guides
.
nhguides
 = 0;

204 
dü
->
guides
.
hguides
 = 
NULL
;

205 
dü
->
guides
.
nvguides
 = 0;

206 
dü
->
guides
.
vguides
 = 
NULL
;

208 i‡(
dü
->
fûíame
 !
NULL
)

209 
	`g_‰ì
(
dü
->
fûíame
);

211 i‡(!
	`g_∑th_is_absﬁuã
(
fûíame
)) {

212 
gch¨
 *
pwd
 = 
	`g_gë_cuºít_dú
();

214 
√wfûíame
 = 
	`g_buûd_fûíame
(
pwd
, 
fûíame
, 
NULL
);

215 
	`g_‰ì
(
pwd
);

216 
fûíame
 = 
√wfûíame
;

220 
dü
->
fûíame
 = 
	`g_fûíame_to_utf8
(fûíame, -1, 
NULL
, NULL, &
îr‹
);

221 i‡(
îr‹
 !
NULL
) {

222 
	`mesßge_îr‹
(
	`_
("Couldn't convert filename '%s'Åo UTF-8: %s\n"),

223 
	`dü_mesßge_fûíame
(
fûíame
), 
îr‹
->
mesßge
);

224 
	`g_îr‹_‰ì
(
îr‹
);

225 
dü
->
fûíame
 = 
	`g_°rdup
(
	`_
("Error"));

226  
FALSE
;

229 
dü
->
unßved
 = 
TRUE
;

230 
dü
->
mﬁlifõd
 = 
FALSE
;

231 
dü
->
autoßvefûíame
 = 
NULL
;

233 i‡(
dü
->
undo
)

234 
	`undo_de°roy
(
dü
->
undo
);

235 
dü
->
undo
 = 
	`√w_undo_°ack
(dia);

237 i‡(!
	`g_li°_föd
(
›í_dügøms
, 
dü
))

238 
›í_dügøms
 = 
	`g_li°_¥ïíd
(›í_dügøms, 
dü
);

240 i‡(
	`≠p_is_öãø˘ive
())

241 
	`œyî_dülog_upd©e_dügøm_li°
();

243 
	`g_‰ì
(
√wfûíame
);

244  
TRUE
;

245 
	}
}

248 
	$dügøm_lﬂd_öto
(
Dügøm
 *
dügøm
,

249 c⁄° *
fûíame
,

250 
DüImp‹tFûãr
 *
ifûãr
)

252 
gboﬁón
 
was_deÁu…
 = 
dügøm
->
is_deÁu…
;

253 i‡(!
ifûãr
)

254 
ifûãr
 = 
	`fûãr_guess_imp‹t_fûãr
(
fûíame
);

255 i‡(!
ifûãr
)

256 
ifûãr
 = &
dü_imp‹t_fûãr
;

258 i‡(
ifûãr
->
	`imp‹t_func
(
fûíame
, 
dügøm
->
d©a
, ifûãr->
u£r_d©a
)) {

259 i‡(
ifûãr
 !&
dü_imp‹t_fûãr
) {

262 i‡(
	`°rcmp
 (
dügøm
->
fûíame
, filename) == 0) {

264 
gch¨
 *
ﬁd_fûíame
 = 
	`g_°rdup
 (
dügøm
->
fûíame
);

265 
gch¨
 *
suffix_off£t
 = 
	`g_utf8_°ºchr
(
ﬁd_fûíame
, -1, (
gunich¨
)'.');

266 
gch¨
 *
√w_fûíame
;

267 i‡(
suffix_off£t
 !
NULL
) {

268 
√w_fûíame
 = 
	`g_°∫dup
(
ﬁd_fûíame
, 
suffix_off£t
 - old_filename);

269 
	`g_‰ì
(
ﬁd_fûíame
);

271 
√w_fûíame
 = 
ﬁd_fûíame
;

273 
ﬁd_fûíame
 = 
	`g_°rc⁄ˇt
(
√w_fûíame
, ".dü", 
NULL
);

274 
	`g_‰ì
(
√w_fûíame
);

275 
	`dügøm_£t_fûíame
(
dügøm
, 
ﬁd_fûíame
);

276 
	`g_‰ì
(
ﬁd_fûíame
);

277 
dügøm
->
unßved
 = 
TRUE
;

278 
	`dügøm_upd©e_f‹_fûíame
 (
dügøm
);

279 
	`dügøm_modifõd
(
dügøm
);

283 
dügøm
->
unßved
 =

284 
	`°rcmp
(
fûíame
, 
dügøm
->fûíameË=0 ? 
FALSE
 : 
was_deÁu…
;

286 
	`dügøm_£t_modifõd
(
dügøm
, 
TRUE
);

287  
TRUE
;

289  
FALSE
;

290 
	}
}

292 
Dügøm
 *

293 
	$dügøm_lﬂd
(c⁄° *
fûíame
, 
DüImp‹tFûãr
 *
ifûãr
)

295 
Dügøm
 *
dügøm
 = 
NULL
;

296 
GLi°
 *
dügøms
;

297 
gboﬁón
 
was_deÁu…
 = 
FALSE
;

299 
dügøms
 = 
›í_dügøms
; dügøm†!
NULL
; dügøm†
	`g_li°_√xt
(diagrams)) {

300 
Dügøm
 *
ﬁd_dügøm
 = (Dügøm*)
dügøms
->
d©a
;

301 i‡(
ﬁd_dügøm
->
is_deÁu…
) {

302 
dügøm
 = 
ﬁd_dügøm
;

303 
was_deÁu…
 = 
TRUE
;

309 i‡(
dügøm
 =
NULL
) {

310 
dügøm
 = 
	`√w_dügøm
(
fûíame
);

312 i‡(
dügøm
 =
NULL
)  NULL;

314 i‡–!
	`dügøm_öô
(
dügøm
, 
fûíame
)

315 || !
	`dügøm_lﬂd_öto
 (
dügøm
, 
fûíame
, 
ifûãr
)) {

316 i‡(!
was_deÁu…
)

317 
	`dügøm_de°roy
(
dügøm
);

318 
dügøm
 = 
NULL
;

321 
	`dügøm_£t_modifõd
(
dügøm
, 
FALSE
);

322 i‡(
	`≠p_is_öãø˘ive
()) {

323 
	`ª˚¡_fûe_hi°‹y_add
(
fûíame
);

324 
	`dügøm_åì_add
(
	`dügøm_åì
(), 
dügøm
);

328 i‡(
dügøm
 !
NULL
 && 
was_deÁu…
 && 
	`≠p_is_öãø˘ive
()) {

329 
	`dügøm_upd©e_f‹_fûíame
(
dügøm
);

330 
dügøm
->
is_deÁu…
 = 
FALSE
;

331 i‡–
	`g_¶i°_Àngth
(
dügøm
->
di•œys
) == 1 )

332 
	`di•œy_£t_a˘ive
 (
dügøm
->
di•œys
->
d©a
);

335  
dügøm
;

336 
	}
}

342 
Dügøm
 *

343 
	$√w_dügøm
(c⁄° *
fûíame
)

345 
Dügøm
 *
dü
 = 
	`g_obje˘_√w
(
DIA_TYPE_DIAGRAM
, 
NULL
);

347 i‡(
	`dügøm_öô
(
dü
, 
fûíame
)) {

348  
dü
;

350 
	`g_obje˘_uƒef
(
dü
);

351  
NULL
;

353 
	}
}

356 
	$dügøm_de°roy
(
Dügøm
 *
dü
)

358 
	`g_sig«l_emô
 (
dü
, 
dügøm_sig«ls
[
REMOVED
], 0);

359 
	`g_obje˘_uƒef
(
dü
);

360 
	}
}

364 
gboﬁón


365 
	$dügøm_is_modifõd
(
Dügøm
 *
dü
)

367  
dü
->
mﬁlifõd
 || !
	`undo_is_ßved
(dü->
undo
);

368 
	}
}

374 
	$dügøm_modifõd
(
Dügøm
 *
dü
)

376 
GSLi°
 *
di•œys
;

377 
gch¨
 *
dü_«me
 = 
	`dügøm_gë_«me
(
dü
);

378 
gch¨
 *
exåa
 = 
	`g_∑th_gë_dú«me
 (
dü
->
fûíame
);

379 
gch¨
 *
tôÀ
 = 
	`g_°rdup_¥ötf
 ("%s%†(%s)", 
	`dügøm_is_modifõd
(
dü
Ë? "*" : "", 
dü_«me
, 
exåa
 ?Éxtra : " ");

381 
	`g_‰ì
 (
dü_«me
);

382 
	`g_‰ì
 (
exåa
);

383 
di•œys
 = 
dü
->displays;

384 
di•œys
!=
NULL
) {

385 
DDi•œy
 *
ddi•
 = (DDi•œy *Ë
di•œys
->
d©a
;

387 
	`ddi•œy_£t_tôÀ
(
ddi•
, 
tôÀ
);

389 
di•œys
 = 
	`g_¶i°_√xt
(displays);

391 i‡(
	`dügøm_is_modifõd
(
dü
)) {

392 
dü
->
autoßved
 = 
FALSE
;

393 
dü
->
is_deÁu…
 = 
FALSE
;

396 
	`g_‰ì
 (
tôÀ
);

397 
	}
}

404 
	$dügøm_£t_modifõd
(
Dügøm
 *
dü
, 
modifõd
)

406 i‡(
dü
->
mﬁlifõd
 !
modifõd
)

408 
dü
->
mﬁlifõd
 = 
modifõd
;

410 
	`dügøm_modifõd
(
dü
);

411 
	}
}

419 
gboﬁón


420 
	$dügøm_£À˘ed_™y_groups
(
Dügøm
 *
dü
) {

421 
GLi°
 *
£À˘ed
;

423 
£À˘ed
 = 
dü
->
d©a
->selected;

424 
£À˘ed
 !
NULL
; sñe˘ed = sñe˘ed->
√xt
) {

425 
DüObje˘
 *
obj
 = (DüObje˘*)
£À˘ed
->
d©a
;

426 i‡(
	`IS_GROUP
(
obj
)Ë 
TRUE
;

428  
FALSE
;

429 
	}
}

431 
gboﬁón


432 
	$dügøm_£À˘ed_™y_∑ª¡s
(
Dügøm
 *
dü
) {

433 
GLi°
 *
£À˘ed
;

435 
£À˘ed
 = 
dü
->
d©a
->selected;

436 
£À˘ed
 !
NULL
; sñe˘ed = sñe˘ed->
√xt
) {

437 
DüObje˘
 *
obj
 = (DüObje˘*)
£À˘ed
->
d©a
;

438 i‡(
	`obje˘_Êags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
Ë&& obj->
chûdªn
 !
NULL
)

439  
TRUE
;

441  
FALSE
;

442 
	}
}

444 
gboﬁón


445 
	$dügøm_£À˘ed_™y_chûdªn
(
Dügøm
 *
dü
) {

446 
GLi°
 *
£À˘ed
;

448 
£À˘ed
 = 
dü
->
d©a
->selected;

449 
£À˘ed
 !
NULL
; sñe˘ed = sñe˘ed->
√xt
) {

450 
DüObje˘
 *
obj
 = (DüObje˘*)
£À˘ed
->
d©a
;

451 i‡(
obj
->
∑ª¡
 !
NULL
Ë 
TRUE
;

453  
FALSE
;

454 
	}
}

459 
gboﬁón


460 
	$dügøm_£À˘ed_ˇn_∑ª¡
(
Dügøm
 *
dü
) {

461 
GLi°
 *
£À˘ed
;

462 
GLi°
 *
∑ª¡s
 = 
NULL
;

464 
£À˘ed
 = 
dü
->
d©a
->selected;

465 
£À˘ed
 !
NULL
; sñe˘ed = sñe˘ed->
√xt
) {

466 
DüObje˘
 *
obj
 = (DüObje˘*)
£À˘ed
->
d©a
;

467 i‡(
	`obje˘_Êags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
)) {

468 
∑ª¡s
 = 
	`g_li°_¥ïíd
’¨íts, 
obj
);

471 
£À˘ed
 = 
dü
->
d©a
->selected;

472 
£À˘ed
 !
NULL
; sñe˘ed = sñe˘ed->
√xt
) {

473 
DüObje˘
 *
obj
 = (DüObje˘*)
£À˘ed
->
d©a
;

474 i‡(
obj
->
∑ª¡
 =
NULL
) {

475 
GLi°
 *
∑ª¡_tmp
;

476 
∑ª¡_tmp
 = 
∑ª¡s
;Ö¨ít_tm∞!
NULL
;Ö¨ít_tm∞∑ª¡_tmp->
√xt
) {

477 i‡(
	`obje˘_wôhö_∑ª¡
(
obj
, (
DüObje˘
*)
∑ª¡_tmp
->
d©a
)) {

478 
	`g_li°_‰ì
(
∑ª¡s
);

479  
TRUE
;

484 
	`g_li°_‰ì
(
∑ª¡s
);

485  
FALSE
;

486 
	}
}

490 
gboﬁón


491 
	$obje˘_wôhö_∑ª¡
(
DüObje˘
 *
obj
, DüObje˘ *
p
)

493 
Re˘™gÀ
 
obj_bb
 = 
obj
->
boundög_box
;

494 i‡(!
	`obje˘_Êags_£t
(
p
, 
DIA_OBJECT_CAN_PARENT
))

495  
FALSE
;

496 i‡(
p
 =
obj
)

497  
FALSE
;

498 i‡(
obj_bb
.
À·
 > 
p
->
boundög_box
.left &&

499 
obj_bb
.
right
 < 
p
->
boundög_box
.right &&

500 
obj_bb
.
t›
 > 
p
->
boundög_box
.top &&

501 
obj_bb
.
bŸtom
 < 
p
->
boundög_box
.bottom)

502  
TRUE
;

503  
FALSE
;

504 
	}
}

511 
	$dügøm_upd©e_míu_£nsôivôy
 (
Dügøm
 *
dü
)

513 
göt
 
£À˘ed_cou¡
 = 
	`g_li°_Àngth
 (
dü
->
d©a
->
£À˘ed
);

514 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

515 
gboﬁón
 
focus_a˘ive
 = (
	`gë_a˘ive_focus
(
dü
->
d©a
Ë!
NULL
);

516 
gboﬁón
 
ãxãdô_a˘ive
 = 
ddi•
 ? 
	`ãxãdô_mode
(ddi•Ë: 
FALSE
;

517 
GtkA˘i⁄
 *
a˘i⁄
;

520 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôUndo")Ë!
NULL
)

521 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, 
dü
 ? 
	`undo_avaûabÀ
(dü->
undo
, 
TRUE
Ë: 
FALSE
);

522 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôRedo")Ë!
NULL
)

523 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, 
dü
 ? 
	`undo_avaûabÀ
(dü->
undo
, 
FALSE
) : FALSE);

524 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôC›y")Ë!
NULL
)

525 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, 
ãxãdô_a˘ive
 || 
£À˘ed_cou¡
 > 0);

526 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôCut")Ë!
NULL
)

527 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, 
	`ãxãdô_mode
(
ddi•
Ë|| 
£À˘ed_cou¡
 > 0);

528 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôPa°e")Ë!
NULL
)

529 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, 
ãxãdô_a˘ive
 || 
	`˙p_exi°_°‹ed_obje˘s
());

530 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôDñëe")Ë!
NULL
)

531 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 0);

532 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôDu∂iˇã")Ë!
NULL
)

533 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 0);

535 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôC›yãxt")Ë!
NULL
)

536 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, 
focus_a˘ive
);

537 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôCuâext")Ë!
NULL
)

538 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, 
focus_a˘ive
);

539 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("EdôPa°ëext")Ë!
NULL
)

540 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, 
focus_a˘ive
);

543 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sSídtoback")Ë!
NULL
)

544 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 0);

545 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sBrögto‰⁄t")Ë!
NULL
)

546 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 0);

547 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sSídbackw¨ds")Ë!
NULL
)

548 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 0);

549 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sBrögf‹w¨ds")Ë!
NULL
)

550 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 0);

552 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sLayîAbove")Ë!
NULL
)

553 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 0);

554 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sLayîBñow")Ë!
NULL
)

555 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 0);

557 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sGroup")Ë!
NULL
)

558 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

559 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sUngroup")Ë!
NULL
)

560 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
	`dügøm_£À˘ed_™y_groups
 (
dü
));

561 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sP¨ít")Ë!
NULL
)

562 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
	`dügøm_£À˘ed_ˇn_∑ª¡
 (
dü
));

563 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sU≈¨ít")Ë!
NULL
)

564 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
	`dügøm_£À˘ed_™y_chûdªn
 (
dü
));

565 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sU≈¨ítchûdªn")Ë!
NULL
)

566 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
	`dügøm_£À˘ed_™y_∑ª¡s
 (
dü
));

568 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sPr›îtõs")Ë!
NULL
)

569 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, 
£À˘ed_cou¡
 > 0);

572 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignLe·")Ë!
NULL
)

573 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

574 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignCíãr")Ë!
NULL
)

575 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

576 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignRight")Ë!
NULL
)

577 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

578 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignS¥ódouth‹iz⁄èŒy")Ë!
NULL
)

579 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

580 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignAdja˚¡")Ë!
NULL
)

581 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

582 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignT›")Ë!
NULL
)

583 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

584 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignMiddÀ")Ë!
NULL
)

585 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

586 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignBŸtom")Ë!
NULL
)

587 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

588 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignS¥ódoutvîtiˇŒy")Ë!
NULL
)

589 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

590 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Obje˘sAlignSècked")Ë!
NULL
)

591 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
 && 
£À˘ed_cou¡
 > 1);

594 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘AŒ")Ë!
NULL
)

595 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

596 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘N⁄e")Ë!
NULL
)

597 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

598 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘Invît")Ë!
NULL
)

599 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

600 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘Tønsôive")Ë!
NULL
)

601 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

602 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘C⁄√˘ed")Ë!
NULL
)

603 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

604 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘Samëy≥")Ë!
NULL
)

605 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

607 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘Rïœ˚")Ë!
NULL
)

608 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

609 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘Uni⁄")Ë!
NULL
)

610 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

611 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘I¡î£˘i⁄")Ë!
NULL
)

612 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

613 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘Remove")Ë!
NULL
)

614 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

615 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("Sñe˘Invî£")Ë!
NULL
)

616 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

621 
gch¨
 * 
a˘i⁄_«mes
[] = {

625 "ToﬁsImage", "ToﬁsOuéöe", 
NULL


627 
i
;

628 
i
 = 0; 
a˘i⁄_«mes
[i] !
NULL
; ++i) {

629 i‡((
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 (
a˘i⁄_«mes
[
i
])Ë!
NULL
)

630 
	`gtk_a˘i⁄_£t_£nsôive
 (
a˘i⁄
, !
ãxãdô_a˘ive
);

634 
	}
}

638 
	$dügøm_add_ddi•œy
(
Dügøm
 *
dü
, 
DDi•œy
 *
ddi•
)

640 
dü
->
di•œys
 = 
	`g_¶i°_¥ïíd
(dü->di•œys, 
ddi•
);

641 
	}
}

644 
	$dügøm_ªmove_ddi•œy
(
Dügøm
 *
dü
, 
DDi•œy
 *
ddi•
)

646 
dü
->
di•œys
 = 
	`g_¶i°_ªmove
(dü->di•œys, 
ddi•
);

648 i‡(
	`g_¶i°_Àngth
(
dü
->
di•œys
) == 0) {

649 i‡(!
	`≠p_is_embedded
()) {

651 
	`dügøm_de°roy
(
dü
);

654 
	}
}

657 
	$dügøm_add_obje˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
)

659 
	`œyî_add_obje˘
(
dü
->
d©a
->
a˘ive_œyî
, 
obj
);

661 
	`dügøm_modifõd
(
dü
);

663 
	`dügøm_åì_add_obje˘
(
	`dügøm_åì
(), 
dü
, 
obj
);

664 
	}
}

667 
	$dügøm_add_obje˘_li°
(
Dügøm
 *
dü
, 
GLi°
 *
li°
)

669 
	`œyî_add_obje˘s
(
dü
->
d©a
->
a˘ive_œyî
, 
li°
);

671 
	`dügøm_modifõd
(
dü
);

673 
	`dügøm_åì_add_obje˘s
(
	`dügøm_åì
(), 
dü
, 
li°
);

674 
	}
}

677 
	$dügøm_£À˘ed_bªak_exã∫Æ
(
Dügøm
 *
dü
)

679 
GLi°
 *
li°
;

680 
GLi°
 *
c⁄√˘ed_li°
;

681 
DüObje˘
 *
obj
;

682 
DüObje˘
 *
Ÿhî_obj
;

683 
i
,
j
;

685 
li°
 = 
dü
->
d©a
->
£À˘ed
;

686 
li°
 !
NULL
) {

687 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

690 
i
=0;i<
obj
->
num_h™dÀs
;i++) {

691 
C⁄√˘i⁄Poöt
 *
c⁄_poöt
;

692 
c⁄_poöt
 = 
obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
;

694 i‡–
c⁄_poöt
 =
NULL
 )

697 
Ÿhî_obj
 = 
c⁄_poöt
->
obje˘
;

698 i‡(
	`g_li°_föd
(
dü
->
d©a
->
£À˘ed
, 
Ÿhî_obj
Ë=
NULL
) {

700 
Ch™ge
 *
ch™ge
 = 
	`undo_unc⁄√˘
(
dü
, 
obj
, obj->
h™dÀs
[
i
]);

701 (
ch™ge
->
≠∂y
)(ch™ge, 
dü
);

702 
	`obje˘_add_upd©es
(
obj
, 
dü
);

707 
i
=0;i<
obj
->
num_c⁄√˘i⁄s
;i++) {

708 
c⁄√˘ed_li°
 = 
obj
->
c⁄√˘i⁄s
[
i
]->
c⁄√˘ed
;

710 
c⁄√˘ed_li°
 !
NULL
) {

711 
Ÿhî_obj
 = (
DüObje˘
 *)
c⁄√˘ed_li°
->
d©a
;

713 i‡(
	`g_li°_föd
(
dü
->
d©a
->
£À˘ed
, 
Ÿhî_obj
Ë=
NULL
) {

717 
j
=0;j<
Ÿhî_obj
->
num_h™dÀs
;j++) {

718 
C⁄√˘i⁄Poöt
 *
c⁄_poöt
;

719 
c⁄_poöt
 = 
Ÿhî_obj
->
h™dÀs
[
j
]->
c⁄√˘ed_to
;

721 i‡(
c⁄_poöt
 && (c⁄_poöt->
obje˘
 =
obj
)) {

722 
Ch™ge
 *
ch™ge
;

723 
c⁄√˘ed_li°
 = 
	`g_li°_¥evious
(connected_list);

724 
ch™ge
 = 
	`undo_unc⁄√˘
(
dü
, 
Ÿhî_obj
,

725 
Ÿhî_obj
->
h™dÀs
[
j
]);

726 (
ch™ge
->
≠∂y
)(ch™ge, 
dü
);

727 i‡(
c⁄√˘ed_li°
 =
NULL
)

728 
c⁄√˘ed_li°
 = 
obj
->
c⁄√˘i⁄s
[
i
]->
c⁄√˘ed
;

733 
c⁄√˘ed_li°
 = 
	`g_li°_√xt
(connected_list);

736 
	`dügøm_åì_ªmove_obje˘
(
	`dügøm_åì
(), 
obj
);

737 
li°
 = 
	`g_li°_√xt
(list);

739 
	}
}

742 
	$dügøm_ªmove_Æl_£À˘ed
(
Dügøm
 *
dügøm
, 
dñëe_em±y
)

744 
	`obje˘_add_upd©es_li°
(
dügøm
->
d©a
->
£À˘ed
, diagram);

745 
	`ãxãdô_ªmove_focus_Æl
(
dügøm
);

746 
	`d©a_ªmove_Æl_£À˘ed
(
dügøm
->
d©a
);

747 
	`g_sig«l_emô
 (
dügøm
, 
dügøm_sig«ls
[
SELECTION_CHANGED
], 0, 
	`g_li°_Àngth
 (dügøm->
d©a
->
£À˘ed
));

748 
	}
}

751 
	$dügøm_un£À˘_obje˘
(
Dügøm
 *
dügøm
, 
DüObje˘
 *
obj
)

753 
	`obje˘_add_upd©es
(
obj
, 
dügøm
);

754 
	`ãxãdô_ªmove_focus
(
obj
, 
dügøm
);

755 
	`d©a_un£À˘
(
	`DIA_DIAGRAM_DATA
(
dügøm
), 
obj
);

756 
	`g_sig«l_emô
 (
dügøm
, 
dügøm_sig«ls
[
SELECTION_CHANGED
], 0,

757 
	`g_li°_Àngth
 (
	`DIA_DIAGRAM_DATA
(
dügøm
)->
£À˘ed
));

758 
	}
}

761 
	$dügøm_un£À˘_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
)

763 
GLi°
 *
li°
;

764 
DüObje˘
 *
obj
;

767 
	`g_sig«l_h™dÀrs_block_by_func
 (
dü
, 
_dügøm_£À˘i⁄_ch™ged
, 
NULL
);

768 
li°
 = 
obj_li°
;

769 
li°
 !
NULL
) {

770 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

772 i‡(
	`g_li°_föd
(
dü
->
d©a
->
£À˘ed
, 
obj
Ë!
NULL
){

773 
	`dügøm_un£À˘_obje˘
(
dü
, 
obj
);

776 
li°
 = 
	`g_li°_√xt
(list);

778 
	`g_sig«l_h™dÀrs_unblock_by_func
 (
dü
, 
_dügøm_£À˘i⁄_ch™ged
, 
NULL
);

779 
	`g_sig«l_emô
 (
dü
, 
dügøm_sig«ls
[
SELECTION_CHANGED
], 0, 
	`g_li°_Àngth
 (dü->
d©a
->
£À˘ed
));

780 
	}
}

789 
	$dügøm_£À˘
(
Dügøm
 *
dügøm
, 
DüObje˘
 *
obj
)

791 i‡(
	`dü_obje˘_is_£À˘abÀ
(
obj
)) {

792 
	`d©a_£À˘
(
dügøm
->
d©a
, 
obj
);

793 
obj
->
›s
->
	`£À˘f
(obj, 
NULL
, NULL);

794 
	`obje˘_add_upd©es
(
obj
, 
dügøm
);

795 
	`g_sig«l_emô
 (
dügøm
, 
dügøm_sig«ls
[
SELECTION_CHANGED
], 0,

796 
	`g_li°_Àngth
 (
dügøm
->
d©a
->
£À˘ed
));

798 
	}
}

801 
	$dügøm_£À˘_li°
(
Dügøm
 *
dü
, 
GLi°
 *
li°
)

803 
	`g_ªtu∫_if_Áû
 (
dü
 && 
li°
);

805 
	`g_sig«l_h™dÀrs_block_by_func
 (
dü
, 
_dügøm_£À˘i⁄_ch™ged
, 
NULL
);

806 
li°
 !
NULL
) {

807 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

809 
	`dügøm_£À˘
(
dü
, 
obj
);

811 
li°
 = 
	`g_li°_√xt
(list);

813 i‡(
	`gë_a˘ive_focus
((
DügømD©a
*Ë
dü
Ë=
NULL
) {

814 
	`ãxãdô_a˘iv©e_fú°
(
	`ddi•œy_a˘ive
());

816 
	`g_sig«l_h™dÀrs_unblock_by_func
 (
dü
, 
_dügøm_£À˘i⁄_ch™ged
, 
NULL
);

817 
	`g_sig«l_emô
 (
dü
, 
dügøm_sig«ls
[
SELECTION_CHANGED
], 0, 
	`g_li°_Àngth
 (dü->
d©a
->
£À˘ed
));

818 
	}
}

821 
	$dügøm_is_£À˘ed
(
Dügøm
 *
dügøm
, 
DüObje˘
 *
obj
)

823  
	`g_li°_föd
(
dügøm
->
d©a
->
£À˘ed
, 
obj
Ë!
NULL
;

824 
	}
}

827 
	$dügøm_ªdøw_Æl
()

829 
GLi°
 *
li°
;

830 
Dügøm
 *
dü
;

832 
li°
 = 
›í_dügøms
;

834 
li°
 !
NULL
) {

835 
dü
 = (
Dügøm
 *Ë
li°
->
d©a
;

837 
	`dügøm_add_upd©e_Æl
(
dü
);

838 
	`dügøm_Êush
(
dü
);

840 
li°
 = 
	`g_li°_√xt
(list);

843 
	}
}

846 
	$dügøm_add_upd©e_Æl
(
Dügøm
 *
dü
)

848 
GSLi°
 *
l
;

849 
DDi•œy
 *
ddi•
;

851 
l
 = 
dü
->
di•œys
;

852 
l
!=
NULL
) {

853 
ddi•
 = (
DDi•œy
 *Ë
l
->
d©a
;

855 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

857 
l
 = 
	`g_¶i°_√xt
(l);

859 
	}
}

862 
	$dügøm_add_upd©e
(
Dügøm
 *
dü
, 
Re˘™gÀ
 *
upd©e
)

864 
GSLi°
 *
l
;

865 
DDi•œy
 *
ddi•
;

867 
l
 = 
dü
->
di•œys
;

868 
l
!=
NULL
) {

869 
ddi•
 = (
DDi•œy
 *Ë
l
->
d©a
;

871 
	`ddi•œy_add_upd©e
(
ddi•
, 
upd©e
);

873 
l
 = 
	`g_¶i°_√xt
(l);

875 
	}
}

883 
	$dügøm_add_upd©e_wôh_b‹dî
(
Dügøm
 *
dü
, 
Re˘™gÀ
 *
upd©e
,

884 
pixñ_b‹dî
)

886 
GSLi°
 *
l
;

887 
DDi•œy
 *
ddi•
;

889 
l
 = 
dü
->
di•œys
;

890 
l
!=
NULL
) {

891 
ddi•
 = (
DDi•œy
 *Ë
l
->
d©a
;

893 
	`ddi•œy_add_upd©e_wôh_b‹dî
(
ddi•
, 
upd©e
, 
pixñ_b‹dî
);

895 
l
 = 
	`g_¶i°_√xt
(l);

897 
	}
}

900 
	$dügøm_add_upd©e_pixñs
(
Dügøm
 *
dü
, 
Poöt
 *
poöt
,

901 
pixñ_width
, 
pixñ_height
)

903 
GSLi°
 *
l
;

904 
DDi•œy
 *
ddi•
;

906 
l
 = 
dü
->
di•œys
;

907 
l
!=
NULL
) {

908 
ddi•
 = (
DDi•œy
 *Ë
l
->
d©a
;

910 
	`ddi•œy_add_upd©e_pixñs
(
ddi•
, 
poöt
, 
pixñ_width
, 
pixñ_height
);

912 
l
 = 
	`g_¶i°_√xt
(l);

914 
	}
}

917 
	$dügøm_Êush
(
Dügøm
 *
dü
)

919 
GSLi°
 *
l
;

920 
DDi•œy
 *
ddi•
;

921 
l
 = 
dü
->
di•œys
;

922 
l
!=
NULL
) {

923 
ddi•
 = (
DDi•œy
 *Ë
l
->
d©a
;

925 
	`ddi•œy_Êush
(
ddi•
);

927 
l
 = 
	`g_¶i°_√xt
(l);

929 
	`dynobj_ª‰esh_kick
();

930 
	}
}

932 
DüObje˘
 *

933 
	$dügøm_föd_˛icked_obje˘
(
Dügøm
 *
dü
, 
Poöt
 *
pos
,

934 
ªÆ
 
maxdi°
)

936  
	`œyî_föd_˛o£°_obje˘_ex˚±
(
dü
->
d©a
->
a˘ive_œyî
,

937 
pos
, 
maxdi°
, 
NULL
);

938 
	}
}

940 
DüObje˘
 *

941 
	$dügøm_föd_˛icked_obje˘_ex˚±
(
Dügøm
 *
dü
, 
Poöt
 *
pos
,

942 
ªÆ
 
maxdi°
, 
GLi°
 *
avoid
)

944  
	`œyî_föd_˛o£°_obje˘_ex˚±
(
dü
->
d©a
->
a˘ive_œyî
, 
pos
,

945 
maxdi°
, 
avoid
);

946 
	}
}

952 
ªÆ


953 
	$dügøm_föd_˛o£°_h™dÀ
(
Dügøm
 *
dü
, 
H™dÀ
 **
˛o£°
,

954 
DüObje˘
 **
obje˘
, 
Poöt
 *
pos
)

956 
GLi°
 *
l
;

957 
DüObje˘
 *
obj
;

958 
H™dÀ
 *
h™dÀ
;

959 
ªÆ
 
mödi°
, 
di°
;

960 
i
;

962 
mödi°
 = 1000000.0;

964 *
˛o£°
 = 
NULL
;

966 
l
 = 
dü
->
d©a
->
£À˘ed
;

967 
l
!=
NULL
) {

968 
obj
 = (
DüObje˘
 *Ë
l
->
d©a
;

970 
i
=0;i<
obj
->
num_h™dÀs
;i++) {

971 
h™dÀ
 = 
obj
->
h™dÀs
[
i
];

973 
di°
 = 
	`di°™˚_poöt_poöt_m™h©èn
(
pos
, &
h™dÀ
->pos);

974 i‡(
di°
<=
mödi°
) {

975 
mödi°
 = 
di°
;

976 *
˛o£°
 = 
h™dÀ
;

977 *
obje˘
 = 
obj
;

981 
l
 = 
	`g_li°_√xt
(l);

984  
mödi°
;

985 
	}
}

987 
ªÆ


988 
	$dügøm_föd_˛o£°_c⁄√˘i⁄poöt
(
Dügøm
 *
dü
,

989 
C⁄√˘i⁄Poöt
 **
˛o£°
,

990 
Poöt
 *
pos
,

991 
DüObje˘
 *
nŸthis
)

993 
ªÆ
 
di°
 = 100000000.0;

994 
guöt
 
i
;

995 
i
=0;i<
dü
->
d©a
->
œyîs
->
Àn
;i++) {

996 
Layî
 *
œyî
 = (Layî*)
	`g_±r_¨øy_ödex
(
dü
->
d©a
->
œyîs
, 
i
);

997 
C⁄√˘i⁄Poöt
 *
this_˝
;

998 
ªÆ
 
this_di°
;

999 i‡(
œyî
->
c⁄√˘abÀ
) {

1000 
this_di°
 = 
	`œyî_föd_˛o£°_c⁄√˘i⁄poöt
(
œyî
,

1001 &
this_˝
, 
pos
, 
nŸthis
);

1002 i‡(
this_di°
 < 
di°
) {

1003 
di°
 = 
this_di°
;

1004 *
˛o£°
 = 
this_˝
;

1008  
di°
;

1009 
	}
}

1012 
	$dügøm_upd©e_exã¡s
(
Dügøm
 *
dü
)

1014 
gÊﬂt
 
cur_sˇÀ
 = 
dü
->
d©a
->
∑≥r
.
sˇlög
;

1017 i‡(
	`d©a_upd©e_exã¡s
(
dü
->
d©a
)) {

1019 
GSLi°
 *
l
;

1020 
DDi•œy
 *
ddi•
;

1022 
l
 = 
dü
->
di•œys
;

1023 
l
!=
NULL
) {

1024 
ddi•
 = (
DDi•œy
 *Ë
l
->
d©a
;

1026 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

1028 
l
 = 
	`g_¶i°_√xt
(l);

1030 i‡(
cur_sˇÀ
 !
dü
->
d©a
->
∑≥r
.
sˇlög
) {

1031 
	`dügøm_add_upd©e_Æl
(
dü
);

1032 
	`dügøm_Êush
(
dü
);

1035 
	}
}

1039 
	$°rù_c⁄√˘i⁄s
(
DüObje˘
 *
obj
, 
GLi°
 *
nŸ_°rù_li°
, 
Dügøm
 *
dü
)

1041 
i
;

1042 
H™dÀ
 *
h™dÀ
;

1043 
Ch™ge
 *
ch™ge
;

1045 
i
=0;i<
obj
->
num_h™dÀs
;i++) {

1046 
h™dÀ
 = 
obj
->
h™dÀs
[
i
];

1047 i‡((
h™dÀ
->
c⁄√˘ed_to
 !
NULL
) &&

1048 (
	`g_li°_föd
(
nŸ_°rù_li°
, 
h™dÀ
->
c⁄√˘ed_to
->
obje˘
)==
NULL
)) {

1049 
ch™ge
 = 
	`undo_unc⁄√˘
(
dü
, 
obj
, 
h™dÀ
);

1050 (
ch™ge
->
≠∂y
)(ch™ge, 
dü
);

1053 
	}
}

1057 
göt


1058 
	$dügøm_∑ª¡_s‹t_cb
(
gc⁄°poöãr
 
_a
, gc⁄°poöã∏
_b
)

1060 
Obje˘Exã¡
 **
a
 = (Obje˘Exã¡ **)
_a
;

1061 
Obje˘Exã¡
 **
b
 = (Obje˘Exã¡ **)
_b
;

1063 i‡((*
a
)->
exã¡
.
À·
 < (*
b
)->extent.left)

1065 i‡((*
a
)->
exã¡
.
À·
 > (*
b
)->extent.left)

1068 i‡((*
a
)->
exã¡
.
t›
 < (*
b
)->extent.top)

1070 i‡((*
a
)->
exã¡
.
t›
 > (*
b
)->extent.top)

1074 
	}
}

1079 
	$dügøm_∑ª¡_£À˘ed
(
Dügøm
 *
dü
)

1081 
GLi°
 *
li°
 = 
dü
->
d©a
->
£À˘ed
;

1082 
Àngth
 = 
	`g_li°_Àngth
(
li°
);

1083 
idx
, 
idx2
;

1084 
Obje˘Exã¡
 *
€
;

1085 
gboﬁón
 
™y_∑ª¡ed
 = 
FALSE
;

1086 
GPåAºay
 *
exã¡s
 = 
	`g_±r_¨øy_sized_√w
(
Àngth
);

1087 
li°
)

1089 
€
 = 
	`g_√w
(
Obje˘Exã¡
, 1);

1090 
€
->
obje˘
 = 
li°
->
d©a
;

1091 
	`∑ª¡_h™dÀ_exã¡s
(
li°
->
d©a
, &
€
->
exã¡
);

1092 
	`g_±r_¨øy_add
(
exã¡s
, 
€
);

1093 
li°
 = 
	`g_li°_√xt
(list);

1096 
	`g_±r_¨øy_s‹t
(
exã¡s
, 
dügøm_∑ª¡_s‹t_cb
);

1098 
idx
 = 0; idx < 
Àngth
; idx++)

1100 
Obje˘Exã¡
 *
€1
 = 
	`g_±r_¨øy_ödex
(
exã¡s
, 
idx
);

1101 i‡(
€1
->
obje˘
->
∑ª¡
)

1104 
idx2
 = 
idx
 + 1; idx2 < 
Àngth
; idx2++)

1106 
Obje˘Exã¡
 *
€2
 = 
	`g_±r_¨øy_ödex
(
exã¡s
, 
idx2
);

1107 i‡(!
	`obje˘_Êags_£t
(
€2
->
obje˘
, 
DIA_OBJECT_CAN_PARENT
))

1110 i‡(
€1
->
exã¡
.
right
 <
€2
->extent.right

1111 && 
€1
->
exã¡
.
bŸtom
 <
€2
->extent.bottom)

1113 
Ch™ge
 *
ch™ge
;

1114 
ch™ge
 = 
	`undo_∑ª¡ög
(
dü
, 
€2
->
obje˘
, 
€1
->obje˘, 
TRUE
);

1115 (
ch™ge
->
≠∂y
)(ch™ge, 
dü
);

1116 
™y_∑ª¡ed
 = 
TRUE
;

1125 
	`g_±r_¨øy_‰ì
(
exã¡s
, 
TRUE
);

1126 i‡(
™y_∑ª¡ed
) {

1127 
	`dügøm_modifõd
(
dü
);

1128 
	`dügøm_Êush
(
dü
);

1129 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1131 
	}
}

1134 
	$dügøm_u≈¨ít_£À˘ed
(
Dügøm
 *
dü
)

1136 
GLi°
 *
li°
;

1137 
DüObje˘
 *
obj
, *
∑ª¡
;

1138 
Ch™ge
 *
ch™ge
;

1139 
gboﬁón
 
™y_u≈¨íãd
 = 
FALSE
;

1141 
li°
 = 
dü
->
d©a
->
£À˘ed
;Üi° !
NULL
;Üi° = 
	`g_li°_√xt
(list))

1143 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

1144 
∑ª¡
 = 
obj
->parent;

1146 i‡(!
∑ª¡
)

1149 
ch™ge
 = 
	`undo_∑ª¡ög
(
dü
, 
∑ª¡
, 
obj
, 
FALSE
);

1150 (
ch™ge
->
≠∂y
)(ch™ge, 
dü
);

1151 
™y_u≈¨íãd
 = 
TRUE
;

1157 i‡(
™y_u≈¨íãd
) {

1158 
	`dügøm_modifõd
(
dü
);

1159 
	`dügøm_Êush
(
dü
);

1160 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1162 
	}
}

1165 
	$dügøm_u≈¨ít_chûdªn_£À˘ed
(
Dügøm
 *
dü
)

1167 
GLi°
 *
li°
;

1168 
DüObje˘
 *
obj
, *
chûd
;

1169 
gboﬁón
 
™y_u≈¨íãd
 = 
FALSE
;

1170 
li°
 = 
dü
->
d©a
->
£À˘ed
;Üi° !
NULL
;Üi° = 
	`g_li°_√xt
(list))

1172 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

1173 i‡(!
	`obje˘_Êags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
Ë|| !obj->
chûdªn
)

1176 
™y_u≈¨íãd
 = 
TRUE
;

1181 
obj
->
chûdªn
 !
NULL
) {

1182 
Ch™ge
 *
ch™ge
;

1183 
chûd
 = (
DüObje˘
 *Ë
obj
->
chûdªn
->
d©a
;

1184 
ch™ge
 = 
	`undo_∑ª¡ög
(
dü
, 
obj
, 
chûd
, 
FALSE
);

1186 (
ch™ge
->
≠∂y
)(ch™ge, 
dü
);

1188 i‡(
obj
->
chûdªn
 !
NULL
)

1189 
	`¥ötf
("Obj still has %d children\n",

1190 
	`g_li°_Àngth
(
obj
->
chûdªn
));

1192 i‡(
™y_u≈¨íãd
) {

1193 
	`dügøm_modifõd
(
dü
);

1194 
	`dügøm_Êush
(
dü
);

1195 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1197 
	}
}

1199 
	$dügøm_group_£À˘ed
(
Dügøm
 *
dü
)

1201 
GLi°
 *
li°
;

1202 
GLi°
 *
group_li°
;

1203 
DüObje˘
 *
group
;

1204 
DüObje˘
 *
obj
;

1205 
GLi°
 *
‹ig_li°
;

1206 
Ch™ge
 *
ch™ge
;

1208 i‡(
	`g_li°_Àngth
(
dü
->
d©a
->
£À˘ed
) < 1) {

1209 
	`mesßge_îr‹
(
	`_
("TryingÅo group withÇo selected objects."));

1213 #ifde‡
USE_NEWGROUP


1214 
li°
 = 
dü
->
d©a
->
£À˘ed
;

1215 
cuºít_∑ª¡
 = ((
DüObje˘
 *Ë
li°
->
d©a
)->
∑ª¡
;

1216 
li°
 !
NULL
) {

1217 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

1218 i‡(
obj
->
∑ª¡
 !
cuºít_∑ª¡
) {

1219 
	`mesßge_w¨nög
(
	`_
("You cannot group objectsÅhat belongÅo different groups or have differentÖarents"));

1224 
group
 = ...

1226 
li°
 = 
dü
->
d©a
->
£À˘ed
;

1227 
li°
 !
NULL
) {

1228 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

1236 
dü
->
d©a
->
£À˘ed
 = 
	`∑ª¡_li°_af„˘ed
(dia->data->selected);

1239 
‹ig_li°
 = 
	`g_li°_c›y
(
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
);

1243 
group_li°
 = 
	`dügøm_gë_s‹ãd_£À˘ed_ªmove
(
dü
);

1245 
li°
 = 
group_li°
;

1246 
li°
 !
NULL
) {

1247 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

1252 
	`°rù_c⁄√˘i⁄s
(
obj
, 
dü
->
d©a
->
£À˘ed
, dia);

1254 
li°
 = 
	`g_li°_√xt
(list);

1258 
	`ãxãdô_ªmove_focus_Æl
(
dü
);

1259 
	`d©a_ªmove_Æl_£À˘ed
(
dü
->
d©a
);

1261 
group
 = 
	`group_¸óã
(
group_li°
);

1262 
ch™ge
 = 
	`undo_group_obje˘s
(
dü
, 
group_li°
, 
group
, 
‹ig_li°
);

1263 (
ch™ge
->
≠∂y
)(ch™ge, 
dü
);

1267 
	`dügøm_£À˘
(
dü
, 
group
);

1269 
	`dügøm_modifõd
(
dü
);

1270 
	`dügøm_Êush
(
dü
);

1272 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1273 
	}
}

1275 
	$dügøm_ungroup_£À˘ed
(
Dügøm
 *
dü
)

1277 
DüObje˘
 *
group
;

1278 
GLi°
 *
group_li°
;

1279 
GLi°
 *
£À˘ed
, *
£À˘i⁄_c›y
;

1280 
group_ödex
;

1281 
™y_groups
 = 0;

1283 i‡(
	`g_li°_Àngth
(
dü
->
d©a
->
£À˘ed
) < 1) {

1284 
	`mesßge_îr‹
("TryingÅo ungroup withÇo selected objects.");

1288 
£À˘i⁄_c›y
 = 
	`g_li°_c›y
(
dü
->
d©a
->
£À˘ed
);

1289 
£À˘ed
 = 
£À˘i⁄_c›y
;

1290 
£À˘ed
 !
NULL
) {

1291 
group
 = (
DüObje˘
 *)
£À˘ed
->
d©a
;

1293 i‡(
	`IS_GROUP
(
group
)) {

1294 
Ch™ge
 *
ch™ge
;

1297 
	`dügøm_un£À˘_obje˘
(
dü
, 
group
);

1299 
group_li°
 = 
	`group_obje˘s
(
group
);

1300 
	`dügøm_£À˘_li°
(
dü
, 
group_li°
);

1302 
group_ödex
 = 
	`œyî_obje˘_ödex
(
dü
->
d©a
->
a˘ive_œyî
, 
group
);

1304 
ch™ge
 = 
	`undo_ungroup_obje˘s
(
dü
, 
group_li°
, 
group
, 
group_ödex
);

1305 (
ch™ge
->
≠∂y
)(ch™ge, 
dü
);

1307 
™y_groups
 = 1;

1309 
£À˘ed
 = 
	`g_li°_√xt
(selected);

1311 
	`g_li°_‰ì
(
£À˘i⁄_c›y
);

1313 i‡(
™y_groups
) {

1314 
	`dügøm_modifõd
(
dü
);

1315 
	`dügøm_Êush
(
dü
);

1316 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1318 
	}
}

1320 
GLi°
 *

1321 
	$dügøm_gë_s‹ãd_£À˘ed
(
Dügøm
 *
dü
)

1323  
	`d©a_gë_s‹ãd_£À˘ed
(
dü
->
d©a
);

1324 
	}
}

1329 
GLi°
 *

1330 
	$dügøm_gë_s‹ãd_£À˘ed_ªmove
(
Dügøm
 *
dü
)

1332 
	`dügøm_modifõd
(
dü
);

1334  
	`d©a_gë_s‹ãd_£À˘ed_ªmove
(
dü
->
d©a
);

1335 
	}
}

1338 
	$dügøm_∂a˚_undî_£À˘ed
(
Dügøm
 *
dü
)

1340 
GLi°
 *
s‹ãd_li°
;

1341 
GLi°
 *
‹ig_li°
;

1343 i‡(
	`g_li°_Àngth
 (
dü
->
d©a
->
£À˘ed
) == 0)

1346 
‹ig_li°
 = 
	`g_li°_c›y
(
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
);

1348 
s‹ãd_li°
 = 
	`dügøm_gë_s‹ãd_£À˘ed_ªmove
(
dü
);

1349 
	`obje˘_add_upd©es_li°
(
s‹ãd_li°
, 
dü
);

1350 
	`œyî_add_obje˘s_fú°
(
dü
->
d©a
->
a˘ive_œyî
, 
s‹ãd_li°
);

1352 
	`undo_ª‹dî_obje˘s
(
dü
, 
	`g_li°_c›y
(
s‹ãd_li°
), 
‹ig_li°
);

1354 
	`dügøm_modifõd
(
dü
);

1355 
	`dügøm_Êush
(
dü
);

1356 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1357 
	}
}

1360 
	$dügøm_∂a˚_ovî_£À˘ed
(
Dügøm
 *
dü
)

1362 
GLi°
 *
s‹ãd_li°
;

1363 
GLi°
 *
‹ig_li°
;

1365 i‡(
	`g_li°_Àngth
 (
dü
->
d©a
->
£À˘ed
) == 0)

1368 
‹ig_li°
 = 
	`g_li°_c›y
(
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
);

1370 
s‹ãd_li°
 = 
	`dügøm_gë_s‹ãd_£À˘ed_ªmove
(
dü
);

1371 
	`obje˘_add_upd©es_li°
(
s‹ãd_li°
, 
dü
);

1372 
	`œyî_add_obje˘s
(
dü
->
d©a
->
a˘ive_œyî
, 
s‹ãd_li°
);

1374 
	`undo_ª‹dî_obje˘s
(
dü
, 
	`g_li°_c›y
(
s‹ãd_li°
), 
‹ig_li°
);

1376 
	`dügøm_modifõd
(
dü
);

1377 
	`dügøm_Êush
(
dü
);

1378 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1379 
	}
}

1382 
	$dügøm_∂a˚_up_£À˘ed
(
Dügøm
 *
dü
)

1384 
GLi°
 *
s‹ãd_li°
;

1385 
GLi°
 *
‹ig_li°
;

1386 
GLi°
 *
tmp
, *
°mp
;

1387 
GLi°
 *
√w_li°
 = 
NULL
;

1389 i‡(
	`g_li°_Àngth
 (
dü
->
d©a
->
£À˘ed
) == 0)

1392 
‹ig_li°
 = 
	`g_li°_c›y
(
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
);

1394 
s‹ãd_li°
 = 
	`dügøm_gë_s‹ãd_£À˘ed
(
dü
);

1395 
	`obje˘_add_upd©es_li°
(
‹ig_li°
, 
dü
);

1397 
√w_li°
 = 
	`g_li°_c›y
(
‹ig_li°
);

1398 
°mp
 = 
	`g_li°_œ°
(
s‹ãd_li°
);

1400 
tmp
 = 
	`g_li°_œ°
(
√w_li°
);

1401 
tmp
 !
NULL
;

1402 
tmp
 = 
	`g_li°_¥evious
(tmp)) {

1403 i‡(
°mp
 =
NULL
) ;

1404 i‡(
tmp
->
¥ev
 =
NULL
) ;

1405 i‡(
tmp
->
d©a
 =
°mp
->data) {

1406 
°mp
 = 
	`g_li°_¥evious
(stmp);

1407 } i‡(
tmp
->
¥ev
->
d©a
 =
°mp
->data) {

1408 *
sw≠
 = 
tmp
->
d©a
;

1409 
tmp
->
d©a
 =Åmp->
¥ev
->data;

1410 
tmp
->
¥ev
->
d©a
 = 
sw≠
;

1411 
°mp
 = 
	`g_li°_¥evious
(stmp);

1415 
	`œyî_£t_obje˘_li°
(
dü
->
d©a
->
a˘ive_œyî
, 
√w_li°
);

1417 
	`undo_ª‹dî_obje˘s
(
dü
, 
	`g_li°_c›y
(
s‹ãd_li°
), 
‹ig_li°
);

1419 
	`dügøm_modifõd
(
dü
);

1420 
	`dügøm_Êush
(
dü
);

1421 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1422 
	}
}

1425 
	$dügøm_∂a˚_down_£À˘ed
(
Dügøm
 *
dü
)

1427 
GLi°
 *
s‹ãd_li°
;

1428 
GLi°
 *
‹ig_li°
;

1429 
GLi°
 *
tmp
, *
°mp
;

1430 
GLi°
 *
√w_li°
 = 
NULL
;

1432 i‡(
	`g_li°_Àngth
 (
dü
->
d©a
->
£À˘ed
) == 0)

1435 
‹ig_li°
 = 
	`g_li°_c›y
(
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
);

1437 
s‹ãd_li°
 = 
	`dügøm_gë_s‹ãd_£À˘ed
(
dü
);

1438 
	`obje˘_add_upd©es_li°
(
‹ig_li°
, 
dü
);

1441 
	`g_as£π
(
	`g_li°_Àngth
 (
dü
->
d©a
->
£À˘ed
Ë=g_li°_Àngth(
s‹ãd_li°
));

1443 
√w_li°
 = 
	`g_li°_c›y
(
‹ig_li°
);

1444 
tmp
 = 
√w_li°
;

1445 
°mp
 = 
s‹ãd_li°
;

1447 
tmp
 = 
√w_li°
;Åm∞!
NULL
;Åm∞
	`g_li°_√xt
(tmp)) {

1448 i‡(
°mp
 =
NULL
) ;

1449 i‡(
tmp
->
√xt
 =
NULL
) ;

1450 i‡(
tmp
->
d©a
 =
°mp
->data) {

1452 
°mp
 = 
	`g_li°_√xt
(stmp);

1453 } i‡(
tmp
->
√xt
->
d©a
 =
°mp
->data) {

1455 *
sw≠
 = 
tmp
->
d©a
;

1456 
tmp
->
d©a
 =Åmp->
√xt
->data;

1457 
tmp
->
√xt
->
d©a
 = 
sw≠
;

1458 
°mp
 = 
	`g_li°_√xt
(stmp);

1462 
	`œyî_£t_obje˘_li°
(
dü
->
d©a
->
a˘ive_œyî
, 
√w_li°
);

1464 
	`undo_ª‹dî_obje˘s
(
dü
, 
	`g_li°_c›y
(
s‹ãd_li°
), 
‹ig_li°
);

1466 
	`dügøm_modifõd
(
dü
);

1467 
	`dügøm_Êush
(
dü
);

1468 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1469 
	}
}

1472 
	$dügøm_£t_fûíame
(
Dügøm
 *
dü
, c⁄° *
fûíame
)

1474 
	`g_‰ì
(
dü
->
fûíame
);

1475 
dü
->
fûíame
 = 
	`g_fûíame_to_utf8
(fûíame, -1, 
NULL
, NULL, NULL);

1477 
	`dügøm_upd©e_f‹_fûíame
(
dü
);

1478 
	}
}

1486 
	$dügøm_upd©e_f‹_fûíame
(
Dügøm
 *
dü
)

1488 
GSLi°
 *
l
;

1489 
DDi•œy
 *
ddi•
;

1490 *
tôÀ
;

1492 
tôÀ
 = 
	`dügøm_gë_«me
(
dü
);

1494 
l
 = 
dü
->
di•œys
;

1495 
l
!=
NULL
) {

1496 
ddi•
 = (
DDi•œy
 *Ë
l
->
d©a
;

1498 
	`ddi•œy_£t_tôÀ
(
ddi•
, 
tôÀ
);

1500 
l
 = 
	`g_¶i°_√xt
(l);

1503 
	`g_‰ì
(
tôÀ
);

1505 
	`œyî_dülog_upd©e_dügøm_li°
();

1507 
	`dügøm_åì_upd©e_«me
(
	`dügøm_åì
(), 
dü
);

1508 
	}
}

1514 
gch¨
 *

1515 
	$dügøm_gë_«me
(
Dügøm
 *
dü
)

1517  
	`g_∑th_gë_ba£«me
(
dü
->
fûíame
);

1518 
	}
}

1520 
	$dügøm_modifõd_exi°s
()

1522 
GLi°
 *
li°
;

1523 
Dügøm
 *
dü
;

1525 
li°
 = 
›í_dügøms
;

1527 
li°
 !
NULL
) {

1528 
dü
 = (
Dügøm
 *Ë
li°
->
d©a
;

1530 i‡(
	`dügøm_is_modifõd
(
dü
))

1531  
TRUE
;

1533 
li°
 = 
	`g_li°_√xt
(list);

1535  
FALSE
;

1536 
	}
}

1538 
	$dügøm_obje˘_modifõd
(
Dügøm
 *
dü
, 
DüObje˘
 *
obje˘
)

1540 
	`dügøm_åì_upd©e_obje˘
(
	`dügøm_åì
(), 
dü
, 
obje˘
);

1541 
	}
}

	@O:\tool\dvs50\app\diagram.h

18 #i‚de‡
DIAGRAM_H


19 
	#DIAGRAM_H


	)

21 
	~<gtk/gtk.h
>

23 
_Dügøm
 
	tDügøm
;

25 
	~"geomëry.h
"

26 
	~"h™dÀ.h
"

27 
	~"c⁄√˘i⁄poöt.h
"

28 
	~"di•œy.h
"

29 
	~"dügømd©a.h
"

30 
	~"undo.h
"

31 
	~"fûãr.h
"

32 
	~"míus.h
"

33 
	~"dügrid.h
"

35 
GTy≥
 
	$dügøm_gë_ty≥
 (Ë
G_GNUC_CONST
;

37 
	#DIA_TYPE_DIAGRAM
 (
	`dügøm_gë_ty≥
 ())

	)

38 
	#DIA_DIAGRAM
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_DIAGRAM
, 
Dügøm
))

	)

39 
	#DIA_DIAGRAM_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_DIAGRAM
, 
DügømCœss
))

	)

40 
	#DIA_IS_DIAGRAM
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_DIAGRAM
))

	)

41 
	#DIA_DIAGRAM_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_DIAGRAM
, 
DügømCœss
))

	)

43 
	s_Dügøm
 {

44 
DügømD©a
 
∑ª¡_ö°™˚
;

46 *
fûíame
;

47 
unßved
;

48 
gboﬁón
 
is_deÁu…
;

49 
mﬁlifõd
;

50 
gboﬁón
 
autoßved
;

51 *
autoßvefûíame
;

54 
Cﬁ‹
 
∑gebªak_cﬁ‹
;

55 
DüGrid
 
grid
;

60 
ªÆ
 *
hguides
, *
vguides
;

61 
guöt
 
nhguides
, 
nvguides
;

62 } 
guides
;

64 
DügømD©a
 *
d©a
;

66 
GSLi°
 *
di•œys
;

68 
UndoSèck
 *
undo
;

71 
	s_DügømCœss
 {

72 
DügømD©aCœss
 
∑ª¡_˛ass
;

75 (* 
ªmoved
Ë(
Dügøm
*);

76 (* 
£À˘i⁄_ch™ged
Ë(
Dügøm
*, );

78 } 
	tDügømCœss
;

80 
GLi°
 *
	`dü_›í_dügøms
();

82 
Dügøm
 *
	`dügøm_lﬂd
(c⁄° *
fûíame
, 
DüImp‹tFûãr
 *
ifûãr
);

83 
	`dügøm_lﬂd_öto
 (
Dügøm
 *
de°
, c⁄° *
fûíame
, 
DüImp‹tFûãr
 *
ifûãr
);

84 
Dügøm
 *
	`√w_dügøm
(c⁄° *
fûíame
);

86 
	`dügøm_£t_cuºít
(
Dügøm
 *
dügøm
);

87 
	`dügøm_de°roy
(
Dügøm
 *
dü
);

88 
gboﬁón
 
	`dügøm_is_modifõd
(
Dügøm
 *
dü
);

89 
	`dügøm_modifõd
(
Dügøm
 *
dü
);

90 
	`dügøm_£t_modifõd
(
Dügøm
 *
dü
, 
modifõd
);

91 
	`dügøm_add_ddi•œy
(
Dügøm
 *
dü
, 
DDi•œy
 *
ddi•
);

92 
	`dügøm_ªmove_ddi•œy
(
Dügøm
 *
dü
, 
DDi•œy
 *
ddi•
);

93 
	`dügøm_add_obje˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
);

94 
	`dügøm_add_obje˘_li°
(
Dügøm
 *
dü
, 
GLi°
 *
li°
);

95 
	`dügøm_£À˘ed_bªak_exã∫Æ
(
Dügøm
 *
dü
);

96 
	`dügøm_ªmove_Æl_£À˘ed
(
Dügøm
 *
dügøm
, 
dñëe_em±y
);

97 
	`dügøm_un£À˘_obje˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
);

98 
	`dügøm_un£À˘_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
);

99 
	`dügøm_£À˘
(
Dügøm
 *
dügøm
, 
DüObje˘
 *
obj
);

100 
	`dügøm_£À˘_li°
(
Dügøm
 *
dügøm
, 
GLi°
 *
li°
);

101 
	`dügøm_is_£À˘ed
(
Dügøm
 *
dügøm
, 
DüObje˘
 *
obj
);

102 
GLi°
 *
	`dügøm_gë_s‹ãd_£À˘ed
(
Dügøm
 *
dü
);

104 
GLi°
 *
	`dügøm_gë_s‹ãd_£À˘ed_ªmove
(
Dügøm
 *
dü
);

105 
	`dügøm_add_upd©e
(
Dügøm
 *
dü
, 
Re˘™gÀ
 *
upd©e
);

106 
	`dügøm_add_upd©e_wôh_b‹dî
(
Dügøm
 *
dü
, 
Re˘™gÀ
 *
upd©e
,

107 
pixñ_b‹dî
);

108 
	`dügøm_add_upd©e_Æl
(
Dügøm
 *
dü
);

109 
	`dügøm_add_upd©e_Æl_Æl_™d_Êush
();

110 
	`dügøm_add_upd©e_pixñs
(
Dügøm
 *
dü
, 
Poöt
 *
poöt
,

111 
pixñ_width
, 
pixñ_height
);

112 
	`dügøm_Êush
(
Dügøm
 *
dü
);

113 
DüObje˘
 *
	`dügøm_föd_˛icked_obje˘
(
Dügøm
 *
dü
,

114 
Poöt
 *
pos
,

115 
ªÆ
 
maxdi°
);

116 
DüObje˘
 *
	`dügøm_föd_˛icked_obje˘_ex˚±
(
Dügøm
 *
dü
,

117 
Poöt
 *
pos
,

118 
ªÆ
 
maxdi°
,

119 
GLi°
 *
avoid
);

120 
ªÆ
 
	`dügøm_föd_˛o£°_h™dÀ
(
Dügøm
 *
dü
, 
H™dÀ
 **
h™dÀ
,

121 
DüObje˘
 **
obj
, 
Poöt
 *
pos
);

122 
ªÆ
 
	`dügøm_föd_˛o£°_c⁄√˘i⁄poöt
(
Dügøm
 *
dü
,

123 
C⁄√˘i⁄Poöt
 **
˝
,

124 
Poöt
 *
pos
,

125 
DüObje˘
 *
nŸthis
);

126 
	`dügøm_upd©e_exã¡s
(
Dügøm
 *
dü
);

128 
	`dügøm_upd©e_míu_£nsôivôy
 (
Dügøm
 *
dü
);

130 
	`dügøm_∂a˚_undî_£À˘ed
(
Dügøm
 *
dü
);

131 
	`dügøm_∂a˚_ovî_£À˘ed
(
Dügøm
 *
dü
);

132 
	`dügøm_∂a˚_down_£À˘ed
(
Dügøm
 *
dü
);

133 
	`dügøm_∂a˚_up_£À˘ed
(
Dügøm
 *
dü
);

134 
	`dügøm_group_£À˘ed
(
Dügøm
 *
dü
);

135 
	`dügøm_ungroup_£À˘ed
(
Dügøm
 *
dü
);

136 
	`dügøm_∑ª¡_£À˘ed
(
Dügøm
 *
dü
);

137 
	`dügøm_u≈¨ít_£À˘ed
(
Dügøm
 *
dü
);

138 
	`dügøm_u≈¨ít_chûdªn_£À˘ed
(
Dügøm
 *
dü
);

140 
gboﬁón
 
	`obje˘_wôhö_∑ª¡
(
DüObje˘
 *
obj
, DüObje˘ *
∑ª¡
);

141 
	`dügøm_£t_fûíame
(
Dügøm
 *
dü
, c⁄° *
fûíame
);

142 
gch¨
 *
	`dügøm_gë_«me
(
Dügøm
 *
dü
);

144 
	`dügøm_modifõd_exi°s
();

146 
	`dügøm_ªdøw_Æl
();

148 
	`dügøm_obje˘_modifõd
(
Dügøm
 *
dü
, 
DüObje˘
 *
obje˘
);

	@O:\tool\dvs50\app\diagram_tree.c

26 
	~<°rög.h
>

28 #unde‡
GTK_DISABLE_DEPRECATED


30 
	~"¥›îtõs-dülog.h
"

31 
	~"dügøm_åì_míu.h
"

32 
	~"dügøm_åì_míu_ˇŒbacks.h
"

33 
	~"dügøm_åì.h
"

34 
	~"≥rsi°í˚.h
"

36 
	s_DügømTªe
 {

37 
GtkCTªe
 *
	måì
;

38 
GtkCTªeNode
 *
	mœ°
;

39 
DügømTªeMíus
 *
	mmíus
;

40 
GtkCLi°Com∑ªFunc
 
	mdü_cmp
;

41 
GtkCLi°Com∑ªFunc
 
	mobj_cmp
;

44 
	#is_obje˘_node
(
node
Ë(
	`GTK_CTREE_ROW
“ode)->
is_Àaf
)

	)

46 
göt


47 
	$föd_hiddí_ty≥
(
gc⁄°poöãr
 
ty≥
, gc⁄°poöã∏
obje˘_ty≥
)

49  !
ty≥


50 || !
obje˘_ty≥


51 || 
	`°rcmp
((c⁄° 
gch¨
 *)
obje˘_ty≥
, (c⁄° gch¨ *)
ty≥
);

52 
	}
}

54 
	#is_hiddí_ty≥
(
dåì
, 
ty≥
) \

55 
	`g_li°_föd_cu°om
(
	`≥rsi°ít_li°_gë_gli°
(
HIDDEN_TYPES_NAME
), \

56 (
gpoöãr
)
ty≥
, 
föd_hiddí_ty≥
)

	)

58 
	#is_hiddí_obje˘
(
dåì
, 
obje˘
) \

59 
	`is_hiddí_ty≥
(
dåì
, ((
DüObje˘
 *)
obje˘
)->
ty≥
->
«me
)

	)

62 
upd©e_obje˘
(
DügømTªe
 *
åì
, 
GtkCTªeNode
 *
node
, 
DüObje˘
 *
obje˘
);

65 
	$£À˘_node
(
DügømTªe
 *
åì
, 
GtkCTªeNode
 *
node
, 
gboﬁón
 
øi£
)

67 
Dügøm
 *
d
 = 
NULL
;

68 
GtkCTªeNode
 *
dnode
 = (
	`is_obje˘_node
(
node
)) ?

69 
	`GTK_CTREE_ROW
(
node
)->
∑ª¡
 :Çode;

70 
DüObje˘
 *
o
 = (DüObje˘ *)
	`gtk_˘ªe_node_gë_row_d©a
(
åì
->åì, 
node
);

73 
d
 = (
Dügøm
 *)
	`gtk_˘ªe_node_gë_row_d©a
(
åì
->åì, 
dnode
);

74 i‡(
d
) {

75 
GSLi°
 *
dli°
 = 
d
->
di•œys
;

76 i‡(
	`is_obje˘_node
(
node
)) {

77 i‡(
o
) {

78 
	`upd©e_obje˘
(
åì
, 
node
, 
o
);

79 
	`dügøm_ªmove_Æl_£À˘ed
(
d
, 
FALSE
);

80 
	`dügøm_£À˘
(
d
, 
o
);

83 
dli°
) {

84 
DDi•œy
 *
ddi•
 = (DDi•œy *)
dli°
->
d©a
;

85 i‡(
øi£
) {

86 
	`gdk_wödow_øi£
(
ddi•
->
shñl
->
wödow
);

88 i‡(
o
) {

89 
	`ddi•œy_s¸ﬁl_to_obje˘
(
ddi•
, 
o
);

92 
	`gtk_widgë_døw
(
ddi•
->
shñl
, 
NULL
);

93 
dli°
 = 
	`g_¶i°_√xt
(dlist);

96 
	}
}

99 
	$upd©e_œ°_node
(
DügømTªe
 *
åì
)

101 i‡(
	`is_obje˘_node
(
åì
->
œ°
)) {

102 
DüObje˘
 *
o
 = (DüObje˘ *)
	`gtk_˘ªe_node_gë_row_d©a
(
åì
->åì,Åªe->
œ°
);

103 i‡(
o
Ë
	`upd©e_obje˘
(
åì
,Åªe->
œ°
, o);

105 
	}
}

108 
göt


109 
	$buâ⁄_¥ess_ˇŒback
(
GtkCTªe
 *
åì
, 
GdkEvítBuâ⁄
 *
evít
,

110 
DügømTªe
 *
dåì
)

112 
göt
 
row
 = -1;

113 
göt
 
cﬁumn
 = -1;

115 
	`gtk_˛i°_gë_£À˘i⁄_öfo
(
	`GTK_CLIST
(
åì
), 
evít
->
x
,Évít->
y
,

116 &
row
, &
cﬁumn
);

117 i‡(
row
 !-1Ë
dåì
->
œ°
 = 
	`gtk_˘ªe_node_¡h
(
åì
,Ñow);

118 
dåì
->
œ°
 = 
NULL
;

120 i‡(
dåì
->
œ°
Ë
	`upd©e_œ°_node
(dtree);

123 i‡(
dåì
->
œ°
 && 
evít
->
ty≥
 =
GDK_2BUTTON_PRESS
) {

125 
	`£À˘_node
(
dåì
, dåì->
œ°
, 
TRUE
);

126 } i‡(
dåì
->
œ°
 && 
evít
->
ty≥
 =
GDK_BUTTON_PRESS
) {

127 i‡(
evít
->
buâ⁄
 == 3) {

128 
DügømTªeMíuTy≥
 
míu
 = (
	`is_obje˘_node
(
dåì
->
œ°
))?

129 
DIA_MENU_OBJECT
 : 
DIA_MENU_DIAGRAM
;

130 
	`dügøm_åì_míus_p›up_míu
(
dåì
->
míus
, 
míu
, 
evít
->
time
);

131 } i‡(
evít
->
buâ⁄
 == 1) {

132 
	`£À˘_node
(
dåì
, dåì->
œ°
, 
FALSE
);

134  
FALSE
;

137  
TRUE
;

138 
	}
}

142 
	$s‹t_obje˘s
(
DügømTªe
 *
åì
, 
GtkCTªeNode
 *
node
)

144 i‡(
åì
->
obj_cmp
) {

145 
GtkCTªeNode
 *
dnode
 =

146 (
	`is_obje˘_node
(
node
))? 
	`GTK_CTREE_ROW
“ode)->
∑ª¡
 :Çode;

147 
	`gtk_˛i°_£t_com∑ª_func
(
	`GTK_CLIST
(
åì
->åì),Åªe->
obj_cmp
);

148 
	`gtk_˘ªe_s‹t_node
(
åì
->åì, 
dnode
);

150 
	}
}

153 
	$s‹t_dügøms
(
DügømTªe
 *
åì
)

155 i‡(
åì
->
dü_cmp
) {

156 
	`gtk_˛i°_£t_com∑ª_func
(
	`GTK_CLIST
(
åì
->åì),Åªe->
dü_cmp
);

157 
	`gtk_˘ªe_s‹t_node
(
åì
->åì, 
NULL
);

159 
	}
}

161 
GLi°
*

162 
	$gë_dügøm_obje˘s
(
Dügøm
 *
dügøm
)

164 
GLi°
 *
ªsu…
 = 
NULL
;

165 
GPåAºay
 *
œyîs
 = 
dügøm
->
d©a
->layers;

166 i‡(
œyîs
) {

167 
k
 = 0;

168 
Layî
 *
œy
;

169 
k
 = 0; k < 
œyîs
->
Àn
; k++) {

170 
œy
 = (
Layî
 *)
	`g_±r_¨øy_ödex
(
œyîs
, 
k
);

171 
ªsu…
 = 
	`g_li°_c⁄ˇt
‘esu…, 
	`g_li°_c›y
(
œy
->
obje˘s
));

174  
ªsu…
;

175 
	}
}

178 
	$¸óã_obje˘_pixm≠
(
DüObje˘
 *
obje˘
, 
GtkWidgë
 *
∑ª¡
,

179 
GdkPixm≠
 **
pixm≠
, 
GdkBôm≠
 **
mask
)

181 
GtkStyÀ
 *
°yÀ
;

183 
	`g_as£π
(
obje˘
);

184 
	`g_as£π
(
pixm≠
);

185 
	`g_as£π
(
mask
);

187 
°yÀ
 = 
	`gtk_widgë_gë_°yÀ
(
∑ª¡
);

189 i‡(
obje˘
->
ty≥
->
pixm≠
 !
NULL
) {

190 i‡(
	`°∫cmp
((*)
obje˘
->
ty≥
->
pixm≠
, "GdkP", 4) == 0) {

191 
GdkPixbuf
 *
p
;

192 
p
 = 
	`gdk_pixbuf_√w_‰om_ölöe
(-1, (
guöt8
*)
obje˘
->
ty≥
->
pixm≠
, 
TRUE
, 
NULL
);

193 
	`gdk_pixbuf_ªndî_pixm≠_™d_mask_f‹_cﬁ‹m≠
(
p
, 
	`gtk_widgë_gë_cﬁ‹m≠
(
∑ª¡
), 
pixm≠
, 
mask
, 128);

194 
	`g_obje˘_uƒef
 (
p
);

196 *
pixm≠
 =

197 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

198 
	`gtk_widgë_gë_cﬁ‹m≠
(
∑ª¡
),

199 
mask
,

200 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
],

201 
obje˘
->
ty≥
->
pixm≠
);

203 } i‡(
obje˘
->
ty≥
->
pixm≠_fûe
 !
NULL
) {

204 *
pixm≠
 =

205 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm
(
NULL
,

206 
	`gtk_widgë_gë_cﬁ‹m≠
(
∑ª¡
),

207 
mask
,

208 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
],

209 
obje˘
->
ty≥
->
pixm≠_fûe
);

211 *
pixm≠
 = 
NULL
;

212 *
mask
 = 
NULL
;

214 
	}
}

216 
gch¨
 *

217 
	$gë_obje˘_«me
(
DüObje˘
 *
obje˘
)

219 íum {
SIZE
 = 31};

220 
gch¨
 
BUFFER
[
SIZE
];

222 
gch¨
 *
«me
 = 
	`obje˘_gë_di•œy«me
 (
obje˘
);

223 
	`g_¢¥ötf
(
BUFFER
, 
SIZE
, " %s", 
«me
);

224 
	`g_‰ì
(
«me
);

226  
BUFFER
;

227 
	}
}

230 
	$upd©e_obje˘
(
DügømTªe
 *
åì
, 
GtkCTªeNode
 *
node
, 
DüObje˘
 *
obje˘
)

232 *
ãxt
 = 
	`gë_obje˘_«me
(
obje˘
);

233 *
ﬁd
 = 
NULL
;

234 
	`gtk_˘ªe_node_gë_ãxt
(
åì
->åì, 
node
, 0, &
ﬁd
);

235 i‡(!
ﬁd
 || (
ãxt
 && 
	`°rcmp
(text, old))) {

236 
GdkPixm≠
 *
pixm≠
;

237 
GdkBôm≠
 *
mask
;

238 
	`¸óã_obje˘_pixm≠
(
obje˘
, 
	`GTK_WIDGET
(
åì
->åì), &
pixm≠
, &
mask
);

239 
	`gtk_˘ªe_£t_node_öfo
(
åì
->åì, 
node
, 
ãxt
, 3, 
pixm≠
, 
mask
,

240 
pixm≠
, 
mask
, 
TRUE
, TRUE);

241 
	`s‹t_obje˘s
(
åì
, 
node
);

243 
	}
}

245 
	s_Pixm≠sAndMasks


247 
GdkPixm≠
 *
	mpixm≠
;

248 
GdkBôm≠
 *
	mmask
;

249 } 
	tPixm≠sAndMasks
;

251 
GHashTabÀ
 *
	g_pixm≠s_™d_masks
 = 
NULL
;

254 
	$¸óã_obje˘_node
(
DügømTªe
 *
åì
, 
GtkCTªeNode
 *
dnode
, 
DüObje˘
 *
obj
)

256 
gboﬁón
 
ex∑nded
 = 
	`GTK_CTREE_ROW
(
dnode
)->expanded;

257 *
ãxt
[] = {
NULL
};

258 
GdkPixm≠
 *
pixm≠
;

259 
GdkBôm≠
 *
mask
;

260 
GtkCTªeNode
 *
node
;

261 
Pixm≠sAndMasks
 *
≤m
;

263 
ãxt
[0] = 
	`gë_obje˘_«me
(
obj
);

265 i‡(!
_pixm≠s_™d_masks
)

266 
_pixm≠s_™d_masks
 = 
	`g_hash_èbÀ_√w_fuŒ
(

267 
g_°r_hash
, 
g_°r_equÆ
, 
NULL
, 
g_‰ì
);

269 
≤m
 = 
	`g_hash_èbÀ_lookup
 (
_pixm≠s_™d_masks
, 
obj
->
ty≥
->
«me
);

270 i‡(!
≤m
) {

271 
≤m
 = 
	`g_√w0
 (
Pixm≠sAndMasks
, 1);

272 
	`¸óã_obje˘_pixm≠
(
obj
, 
	`GTK_WIDGET
(
åì
->åì), &
≤m
->
pixm≠
, &≤m->
mask
);

273 
	`g_hash_èbÀ_ö£π
 (
_pixm≠s_™d_masks
, 
obj
->
ty≥
->
«me
, 
≤m
);

275 
node
 = 
	`gtk_˘ªe_ö£π_node
(
åì
->åì, 
dnode
, 
NULL
, 
ãxt
, 3,

276 
≤m
->
pixm≠
 ? 
	`g_obje˘_ªf
 (≤m->pixm≠Ë: 
NULL
,

277 
≤m
->
mask
 ? 
	`g_obje˘_ªf
 (≤m->maskË: 
NULL
,

278 
NULL
, NULL, 
TRUE
, 
FALSE
);

279 
	`gtk_˘ªe_node_£t_row_d©a
(
åì
->åì, 
node
, (
gpoöãr
)
obj
);

280 i‡(
ex∑nded
Ë
	`gtk_˘ªe_ex∑nd
(
åì
->åì, 
dnode
);

281 
	`s‹t_obje˘s
(
åì
, 
dnode
);

282 
	}
}

286 
	$¸óã_dügøm_chûdªn
(
DügømTªe
 *
åì
, 
GtkCTªeNode
 *
node
,

287 
Dügøm
 *
dügøm
)

289 
GLi°
 *
obje˘s
 = 
	`gë_dügøm_obje˘s
(
dügøm
);

290 
GLi°
 *
‹g
 = 
obje˘s
;

291 
obje˘s
) {

292 i‡(!
	`is_hiddí_obje˘
(
åì
, 
obje˘s
->
d©a
)) {

293 
	`¸óã_obje˘_node
(
åì
, 
node
, (
DüObje˘
 *)
obje˘s
->
d©a
);

295 
obje˘s
 = 
	`g_li°_√xt
(objects);

297 
	`g_li°_‰ì
(
‹g
);

298 
	}
}

301 
	$upd©e_dügøm_chûdªn
(
DügømTªe
 *
åì
, 
GtkCTªeNode
 *
node
,

302 
Dügøm
 *
dügøm
)

304 
GLi°
 *
dobje˘s
 = 
	`gë_dügøm_obje˘s
(
dügøm
);

305 
GLi°
 *
‹g
 = 
dobje˘s
;

306 
GtkCTªeNode
 *
chûd
 = 
	`GTK_CTREE_ROW
(
node
)->
chûdªn
;

307 i‡(
dobje˘s
) {

308 
chûd
) {

309 
GtkCTªeNode
 *
cuºít
 = 
chûd
;

310 
gpoöãr
 
obj
 = 
	`gtk_˘ªe_node_gë_row_d©a
(
åì
->åì, 
cuºít
);

311 
chûd
 = 
	`GTK_CTREE_ROW
(chûd)->
siblög
;

312 i‡(!
	`g_li°_föd
(
dobje˘s
, 
obj
Ë|| 
	`is_hiddí_obje˘
(
åì
, obj))

313 
	`gtk_˘ªe_ªmove_node
(
åì
->åì, 
cuºít
);

316 
dobje˘s
) {

317 i‡(!
	`is_hiddí_obje˘
(
åì
, 
dobje˘s
->
d©a
)

318 && !
	`gtk_˘ªe_föd_by_row_d©a
(
åì
->åì, 
node
, 
dobje˘s
->
d©a
))

319 
	`¸óã_obje˘_node
(
åì
, 
node
, (
DüObje˘
 *)
dobje˘s
->
d©a
);

320 
dobje˘s
 = 
	`g_li°_√xt
(dobjects);

322 
	`g_li°_‰ì
(
‹g
);

323 
	`s‹t_obje˘s
(
åì
, 
node
);

324 
	}
}

327 
DügømTªe
*

328 
	$dügøm_åì_√w
(
GLi°
 *
dügøms
, 
GtkWödow
 *
wödow
,

329 
DügømTªeS‹tTy≥
 
dü_s‹t
,

330 
DügømTªeS‹tTy≥
 
obj_s‹t
)

332 
GLi°
 *
tm∂i°
;

333 
DügømTªe
 *
ªsu…
 = 
	`g_√w
(DiagramTree, 1);

334 
ªsu…
->
åì
 = 
	`GTK_CTREE
(
	`gtk_˘ªe_√w
(1, 0));

335 
ªsu…
->
œ°
 = 
NULL
;

336 
ªsu…
->
dü_cmp
 =Ñesu…->
obj_cmp
 = 
NULL
;

338 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
ªsu…
->
åì
),

340 
	`G_CALLBACK
(
buâ⁄_¥ess_ˇŒback
),

341 (
gpoöãr
)
ªsu…
);

342 
dügøms
) {

343 
	`dügøm_åì_add
(
ªsu…
, (
Dügøm
 *)
dügøms
->
d©a
);

344 
dügøms
 = 
	`g_li°_√xt
(diagrams);

346 
	`dügøm_åì_£t_dügøm_s‹t_ty≥
(
ªsu…
, 
dü_s‹t
);

347 
	`dügøm_åì_£t_obje˘_s‹t_ty≥
(
ªsu…
, 
obj_s‹t
);

348 
ªsu…
->
míus
 = 
	`dügøm_åì_míus_√w
‘esu…, 
wödow
);

350 
tm∂i°
 = 
	`≥rsi°ít_li°_gë_gli°
(
HIDDEN_TYPES_NAME
);

351 ; 
tm∂i°
 !
NULL
;Åm∂i° = 
	`g_li°_√xt
(tmplist)) {

352 
	`dügøm_åì_míus_add_hiddí_ty≥
(
ªsu…
->
míus
, 
tm∂i°
->
d©a
);

354  
ªsu…
;

355 
	}
}

358 
	$dügøm_åì_dñëe
(
DügømTªe
 *
åì
)

360 
	`g_ªtu∫_if_Áû
(
åì
);

361 
	`gtk_widgë_de°roy
(
	`GTK_WIDGET
(
åì
->tree));

362 
	}
}

365 
	$dügøm_åì_add
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
)

367 i‡(
åì
) {

368 i‡(
dügøm


369 && !
	`gtk_˘ªe_föd_by_row_d©a
(
åì
->åì, 
NULL
, (
gpoöãr
)
dügøm
))

371 *
ãxt
[] = {(*)
	`g_ba£«me
(
dügøm
->
fûíame
)};

372 
GtkCTªeNode
 *
node
 =

373 
	`gtk_˘ªe_ö£π_node
(
åì
->åì, 
NULL
, NULL, 
ãxt
, 1,

374 
NULL
, NULL, NULL, NULL, 
FALSE
, FALSE);

375 
	`gtk_˘ªe_node_£t_row_d©a
(
åì
->åì, 
node
, (
gpoöãr
)
dügøm
);

376 
	`¸óã_dügøm_chûdªn
(
åì
, 
node
, 
dügøm
);

377 
	`s‹t_dügøms
(
åì
);

380 
	}
}

383 
	$dügøm_åì_ªmove
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
)

385 i‡(
åì
) {

386 
GtkCTªeNode
 *
node
;

387 i‡(
dügøm


388 && (
node
 = 
	`gtk_˘ªe_föd_by_row_d©a
(
åì
->åì, 
NULL
,

389 (
gpoöãr
)
dügøm
)))

390 
	`gtk_˘ªe_ªmove_node
(
åì
->åì, 
node
);

392 
	}
}

395 
	$dügøm_åì_upd©e
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
)

397 i‡(
åì
) {

398 i‡(
	`dügøm_is_modifõd
(
dügøm
)) {

399 
GtkCTªeNode
 *
dnode
 =

400 
	`gtk_˘ªe_föd_by_row_d©a
(
åì
->åì, 
NULL
, (
gpoöãr
)
dügøm
);

401 i‡(
dnode
Ë
	`upd©e_dügøm_chûdªn
(
åì
, dnode, 
dügøm
);

402 
	`dügøm_åì_add
(
åì
, 
dügøm
);

405 
	}
}

408 
	$dügøm_åì_upd©e_Æl
(
DügømTªe
 *
åì
)

410 i‡(
åì
) {

411 
GtkCTªeNode
 *
node
 = 
	`gtk_˘ªe_node_¡h
(
åì
->tree, 0);

412 
node
) {

413 
Dügøm
 *
d
 = (Dügøm *)
	`gtk_˘ªe_node_gë_row_d©a
(
åì
->åì, 
node
);

414 i‡(
d
Ë
	`upd©e_dügøm_chûdªn
(
åì
, 
node
, d);

415 
node
 = 
	`GTK_CTREE_ROW
“ode)->
siblög
;

418 
	}
}

421 
	$dügøm_åì_upd©e_«me
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
)

423 i‡(
åì
) {

424 
GtkCTªeNode
 *
node
;

425 
	`g_ªtu∫_if_Áû
(
dügøm
);

426 
node
 = 
	`gtk_˘ªe_föd_by_row_d©a
(
åì
->åì, 
NULL
, (
gpoöãr
)
dügøm
);

427 i‡(
node
) {

428 
	`gtk_˘ªe_node_£t_ãxt
(
åì
->åì, 
node
, 0,

429 
	`g_ba£«me
(
dügøm
->
fûíame
));

430 
	`s‹t_dügøms
(
åì
);

433 
	}
}

436 
	$dügøm_åì_add_obje˘
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
, 
DüObje˘
 *
obje˘
)

438 i‡(
åì
) {

439 
	`g_ªtu∫_if_Áû
(
dügøm
);

440 i‡(
obje˘
 && !
	`is_hiddí_obje˘
(
åì
, object)) {

441 
GtkCTªeNode
 *
dnode
 =

442 
	`gtk_˘ªe_föd_by_row_d©a
(
åì
->åì, 
NULL
, (
gpoöãr
)
dügøm
);

443 i‡(!
dnode
Ë
	`dügøm_åì_add
(
åì
, 
dügøm
);

444 i‡(!
	`gtk_˘ªe_föd_by_row_d©a
(
åì
->åì, 
dnode
, (
gpoöãr
)
obje˘
))

445 
	`¸óã_obje˘_node
(
åì
, 
dnode
, 
obje˘
);

448 
	}
}

451 
	$dügøm_åì_add_obje˘s
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
, 
GLi°
 *
obje˘s
)

453 i‡(
åì
) {

454 
	`g_ªtu∫_if_Áû
(
dügøm
);

455 
obje˘s
) {

456 
	`dügøm_åì_add_obje˘
(
åì
, 
dügøm
, (
DüObje˘
 *)
obje˘s
->
d©a
);

457 
obje˘s
 = 
	`g_li°_√xt
(objects);

460 
	}
}

464 
	$dügøm_åì_ªmove_obje˘
(
DügømTªe
 *
åì
, 
DüObje˘
 *
obje˘
)

466 i‡(
åì
) {

467 i‡(
obje˘
) {

468 
GtkCTªeNode
 *
node
 =

469 
	`gtk_˘ªe_föd_by_row_d©a
(
åì
->åì, 
NULL
, (
gpoöãr
)
obje˘
);

470 i‡(
node
Ë
	`gtk_˘ªe_ªmove_node
(
åì
->tree,Çode);

473 
	}
}

476 
	$dügøm_åì_ªmove_obje˘s
(
DügømTªe
 *
åì
, 
GLi°
 *
obje˘s
)

478 i‡(
åì
) {

479 
obje˘s
) {

480 
	`dügøm_åì_ªmove_obje˘
(
åì
, (
DüObje˘
 *)
obje˘s
->
d©a
);

481 
obje˘s
 = 
	`g_li°_√xt
(objects);

484 
	}
}

487 
	$dügøm_åì_upd©e_obje˘
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
,

488 
DüObje˘
 *
obje˘
)

490 i‡(
åì
) {

491 
	`g_ªtu∫_if_Áû
(
dügøm
);

492 i‡(
obje˘
) {

493 
GtkCTªeNode
 *
node
 =

494 
	`gtk_˘ªe_föd_by_row_d©a
(
åì
->åì, 
NULL
,(
gpoöãr
)
obje˘
);

495 i‡(
node
) {

496 
	`upd©e_obje˘
(
åì
, 
node
, 
obje˘
);

500 
	}
}

503 
	$dügøm_åì_øi£
(
DügømTªe
 *
åì
)

505 i‡(
åì
 &&Åªe->
œ°
) {

506 
	`£À˘_node
(
åì
,Åªe->
œ°
, 
TRUE
);

508 
	}
}

511 
	$dügøm_åì_show_¥›îtõs
(c⁄° 
DügømTªe
 *
åì
)

513 i‡(
åì
 &&Åªe->
œ°
 && 
	`is_obje˘_node
(tree->last)) {

514 
GtkCTªeNode
 *
∑ª¡
 = 
	`GTK_CTREE_ROW
(
åì
->
œ°
)->parent;

515 i‡(
∑ª¡
) {

516 
Dügøm
 *
dü
 = (Dügøm *)
	`gtk_˘ªe_node_gë_row_d©a
(
åì
->åì, 
∑ª¡
);

517 
DüObje˘
 *
obj
 =

518 (
DüObje˘
 *)
	`gtk_˘ªe_node_gë_row_d©a
(
åì
->åì,Åªe->
œ°
);

519 
	`obje˘_¥›îtõs_show
(
dü
, 
obj
);

522 
	}
}

524 c⁄° 
gch¨
 *

525 
	$dügøm_åì_hide_ty≥
(
DügømTªe
 *
åì
)

527 i‡(
åì
 &&Åªe->
œ°
 && 
	`is_obje˘_node
(tree->last)) {

528 
DüObje˘
 *
obj
 =

529 (
DüObje˘
 *)
	`gtk_˘ªe_node_gë_row_d©a
(
åì
->åì,Åªe->
œ°
);

530 
	`g_as£π
(!
	`is_hiddí_obje˘
(
åì
, 
obj
));

531 
	`dügøm_åì_hide_ex∂icô_ty≥
(
åì
, 
obj
->
ty≥
->
«me
);

532  
obj
->
ty≥
->
«me
;

534  
NULL
;

535 
	}
}

538 
	$dügøm_åì_hide_ex∂icô_ty≥
(
DügømTªe
 *
åì
, c⁄° 
gch¨
 *
ty≥
)

540 i‡(
åì
 && 
ty≥
) {

541 
	`≥rsi°ít_li°_add
(
HIDDEN_TYPES_NAME
, 
ty≥
);

542 
	`dügøm_åì_míus_add_hiddí_ty≥
(
åì
->
míus
, 
ty≥
);

543 
	`dügøm_åì_upd©e_Æl
(
åì
);

545 
	}
}

548 
	$dügøm_åì_unhide_ty≥
(
DügømTªe
 *
åì
, c⁄° 
gch¨
 *
ty≥
)

550 i‡(
åì
 && 
ty≥
) {

551 
GLi°
 *
t
 = 
	`is_hiddí_ty≥
(
åì
, 
ty≥
);

552 i‡(
t
) {

553 
	`≥rsi°ít_li°_ªmove
(
HIDDEN_TYPES_NAME
, 
ty≥
);

554 
	`dügøm_åì_upd©e_Æl
(
åì
);

557 
	}
}

560 
göt


561 
	$cmp_«me_
(
GtkCLi°
 *
åì
, 
GtkCLi°Row
 *
lhm
, GtkCLi°Row *
rhm
)

563 
k
;

564 
gch¨
 *
«me1
 = 
lhm
->
˚Œ
->
u
.
ãxt
;

565 
gch¨
 *
«me2
 = 
rhm
->
˚Œ
->
u
.
ãxt
;

566 i‡(
«me1
 && !
«me2
Ë
k
 = -1;

567 i‡(!
«me1
 && 
«me2
Ë
k
 = 1;

568 i‡(!
«me1
 && !
«me2
Ë
k
 = 0;

569 
k
 = 
	`°rcmp
(
«me1
, 
«me2
);

570 i‡(
k
 > 0)  1;

571 i‡(
k
 < 0)  -1;

573 
	}
}

575 
göt


576 
	$cmp_ty≥_
(
GtkCLi°
 *
åì
, 
GtkCLi°Row
 *
lhm
, GtkCLi°Row *
rhm
)

578 
k
;

579 
DüObje˘
 *
o1
 = (DüObje˘ *)
lhm
->
d©a
;

580 
DüObje˘
 *
o2
 = (DüObje˘ *)
rhm
->
d©a
;

581 
k
 = 
	`°rcmp
(
o1
->
ty≥
->
«me
, 
o2
->type->name);

582 i‡(
k
 > 0)  1;

583 i‡(
k
 < 0)  -1;

585 
	}
}

587 
GtkCLi°Com∑ªFunc
 
	gcmp_funcs_
[] = {

588 (
GtkCLi°Com∑ªFunc
)
cmp_«me_
,

589 (
GtkCLi°Com∑ªFunc
)
cmp_ty≥_
,

590 
NULL


594 
	$dügøm_åì_s‹t_obje˘s
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
)

596 i‡(
åì
 && 
ty≥
 <
DIA_TREE_SORT_INSERT
 &&Åªe->
œ°
) {

597 
GtkCTªeNode
 *
node
 = 
	`is_obje˘_node
(
åì
->
œ°
)?

598 
	`GTK_CTREE_ROW
(
åì
->
œ°
)->
∑ª¡
 :Åree->last;

599 
	`gtk_˛i°_£t_com∑ª_func
(
	`GTK_CLIST
(
åì
->åì), 
cmp_funcs_
[
ty≥
]);

600 
	`gtk_˘ªe_s‹t_node
(
åì
->åì, 
node
);

602 
	}
}

605 
	$dügøm_åì_s‹t_Æl_obje˘s
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
)

608 i‡(
åì
 && 
ty≥
 <
DIA_TREE_SORT_INSERT
 &&Åªe->
œ°
) {

609 
GtkCTªeNode
 *
node
 = 
	`is_obje˘_node
(
åì
->
œ°
)?

610 
	`GTK_CTREE_ROW
(
åì
->
œ°
)->
∑ª¡
 :Åree->last;

611 
	`GTK_CTREE_NODE_PREV
(
node
))Çode = GTK_CTREE_NODE_PREV(node);

612 
node
) {

613 
	`gtk_˛i°_£t_com∑ª_func
(
	`GTK_CLIST
(
åì
->åì), 
cmp_funcs_
[
ty≥
]);

614 
	`gtk_˘ªe_s‹t_node
(
åì
->åì, 
node
);

615 
node
 = 
	`GTK_CTREE_ROW
“ode)->
siblög
;

618 
	}
}

621 
	$dügøm_åì_s‹t_dügøms
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
)

623 i‡(
åì
 && 
ty≥
 <
DIA_TREE_SORT_INSERT
 &&Åy≥ !
DIA_TREE_SORT_TYPE
) {

624 
	`gtk_˛i°_£t_com∑ª_func
(
	`GTK_CLIST
(
åì
->åì), 
cmp_funcs_
[
ty≥
]);

625 
	`gtk_˘ªe_s‹t_node
(
åì
->åì, 
NULL
);

627 
	}
}

630 
	$dügøm_åì_£t_obje˘_s‹t_ty≥
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
)

632 i‡(
åì
 && 
ty≥
 <
DIA_TREE_SORT_INSERT
) {

633 
åì
->
obj_cmp
 = 
cmp_funcs_
[
ty≥
];

634 
	`dügøm_åì_s‹t_Æl_obje˘s
(
åì
, 
ty≥
);

636 
	}
}

639 
	$dügøm_åì_£t_dügøm_s‹t_ty≥
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
)

641 i‡(
åì
 && 
ty≥
 <
DIA_TREE_SORT_INSERT
 &&Åy≥ !
DIA_TREE_SORT_TYPE
) {

642 
åì
->
dü_cmp
 = 
cmp_funcs_
[
ty≥
];

643 
	`dügøm_åì_s‹t_dügøms
(
åì
, 
ty≥
);

645 
	}
}

647 
DügømTªeS‹tTy≥


648 
	$s‹t_ty≥_lookup
(
GtkCLi°Com∑ªFunc
 
func
)

650 
k
;

651 
k
 = 0; k <
DIA_TREE_SORT_INSERT
; ++k) {

652 i‡(
cmp_funcs_
[
k
] =
func
)  k;

654 
	`g_as£π_nŸ_ªached
();

656 
	}
}

658 
DügømTªeS‹tTy≥


659 
	$dügøm_åì_dügøm_s‹t_ty≥
(c⁄° 
DügømTªe
 *
åì
)

661 i‡(
åì
) {

662  
	`s‹t_ty≥_lookup
(
åì
->
dü_cmp
);

664  
DIA_TREE_SORT_INSERT
;

665 
	}
}

668 
DügømTªeS‹tTy≥


669 
	$dügøm_åì_obje˘_s‹t_ty≥
(c⁄° 
DügømTªe
 *
åì
)

671 i‡(
åì
) {

672  
	`s‹t_ty≥_lookup
(
åì
->
obj_cmp
);

674  
DIA_TREE_SORT_INSERT
;

675 
	}
}

677 
GtkWidgë
*

678 
	$dügøm_åì_widgë
(c⁄° 
DügømTªe
 *
åì
)

680 
	`g_ªtu∫_vÆ_if_Áû
(
åì
, 
NULL
);

681  
	`GTK_WIDGET
(
åì
->tree);

682 
	}
}

	@O:\tool\dvs50\app\diagram_tree.h

24 #i‚de‡
DIAGRAM_TREE_H


25 
	#DIAGRAM_TREE_H


	)

27 
	~<gtk/gtk.h
>

28 
	~"dügøm.h
"

30 
	#HIDDEN_TYPES_NAME
 "dügøm-åì-hiddí-ty≥s"

	)

33 
_DügømTªe
 
	tDügømTªe
;

38 
	mDIA_TREE_SORT_NAME
,

39 
	mDIA_TREE_SORT_TYPE
,

40 
	mDIA_TREE_SORT_INSERT


41 } 
	tDügømTªeS‹tTy≥
;

46 
DügømTªe
*

47 
dügøm_åì_√w
(
GLi°
 *
dügøms
, 
GtkWödow
 *
wödow
,

48 
DügømTªeS‹tTy≥
 
dü_s‹t
,

49 
DügømTªeS‹tTy≥
 
obj_s‹t
);

53 
dügøm_åì_dñëe
(
DügømTªe
 *
åì
);

57 
dügøm_åì_add
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
);

61 
dügøm_åì_ªmove
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
);

65 
dügøm_åì_upd©e_Æl
(
DügømTªe
 *
åì
);

68 
dügøm_åì_upd©e
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
);

71 
dügøm_åì_upd©e_«me
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
);

75 
dügøm_åì_add_obje˘
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
, 
DüObje˘
 *
obje˘
);

78 
dügøm_åì_add_obje˘s
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
, 
GLi°
 *
obje˘s
);

81 
dügøm_åì_ªmove_obje˘
(
DügømTªe
 *
åì
, 
DüObje˘
 *
obje˘
);

84 
dügøm_åì_ªmove_obje˘s
(
DügømTªe
 *
åì
, 
GLi°
 *
obje˘s
);

87 
dügøm_åì_upd©e_obje˘
(
DügømTªe
 *
åì
, 
Dügøm
 *
dügøm
,

88 
DüObje˘
 *
obje˘
);

92 
dügøm_åì_øi£
(
DügømTªe
 *
åì
);

95 
dügøm_åì_show_¥›îtõs
(c⁄° 
DügømTªe
 *
åì
);

97 c⁄° 
gch¨
 *

98 
dügøm_åì_hide_ty≥
(
DügømTªe
 *
åì
);

101 
dügøm_åì_hide_ex∂icô_ty≥
(
DügømTªe
 *
åì
, c⁄° 
gch¨
 *
ty≥
);

104 
dügøm_åì_unhide_ty≥
(
DügømTªe
 *
åì
, c⁄° 
gch¨
 *
ty≥
);

107 
dügøm_åì_s‹t_obje˘s
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
);

110 
dügøm_åì_s‹t_Æl_obje˘s
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
);

113 
dügøm_åì_s‹t_dügøms
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
);

116 
dügøm_åì_£t_obje˘_s‹t_ty≥
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
);

119 
dügøm_åì_£t_dügøm_s‹t_ty≥
(
DügømTªe
 *
åì
, 
DügømTªeS‹tTy≥
 
ty≥
);

121 
DügømTªeS‹tTy≥


122 
dügøm_åì_dügøm_s‹t_ty≥
(c⁄° 
DügømTªe
 *
åì
);

124 
DügømTªeS‹tTy≥


125 
dügøm_åì_obje˘_s‹t_ty≥
(c⁄° 
DügømTªe
 *
åì
);

128 
GtkWidgë
*

129 
dügøm_åì_widgë
(c⁄° 
DügømTªe
 *
åì
);

	@O:\tool\dvs50\app\diagram_tree_menu.c

23 #ifde‡
HAVE_CONFIG_H


24 
	~<c⁄fig.h
>

27 #unde‡
GTK_DISABLE_DEPRECATED


28 
	~"dügøm_åì_míu_ˇŒbacks.h
"

29 
	~"dügøm_åì_míu.h
"

30 
	~"dügøm_åì_wödow.h
"

31 
	~"¥e„ªn˚s.h
"

32 
	~"öé.h
"

34 
	s_DügømTªeMíus
 {

35 
GtkIãmFa˘‹y
 *
	mÁ˘‹õs
[2];

36 
GtkWidgë
 *
	mmíus
[2];

37 
GtkWidgë
 *
	mshow_míus
[2];

38 
DügømTªe
 *
	måì
;

41 
	#SHOW_TYPE_PATH
 "/Show obje˘Åy≥"

	)

43 c⁄° 
gch¨
 *
	gROOT_NAMES_
[] = {"<DiagramTreeDia>", "<DiagramTreeObj>"};

45 
GtkIãmFa˘‹yE¡ry
 
	gcomm⁄_ôems_
[] = {

46 { "/£p0", 
NULL
, NULL, 0, "<Separator>" },

47 { 
N_
("/_S‹àobje˘s"), 
NULL
, NULL, 0, "<Branch>" },

48 { 
N_
("/S‹àobje˘s/by _«me"), 
NULL
, 
⁄_s‹t_obje˘s_a˘iv©e
,

49 
DIA_TREE_SORT_NAME
, "" },

50 { 
N_
("/S‹àobje˘s/by _ty≥"), 
NULL
, 
⁄_s‹t_obje˘s_a˘iv©e
,

51 
DIA_TREE_SORT_TYPE
, "" },

52 { 
N_
("/S‹àobje˘s/a†_ö£πed"), 
NULL
, 
⁄_s‹t_obje˘s_a˘iv©e
,

53 
DIA_TREE_SORT_INSERT
, "" },

54 { "/S‹àobje˘s/£p0", 
NULL
, NULL, 0, "<Separator>" },

55 { 
N_
("/S‹àobje˘s/AŒ byÇame"), 
NULL
, 
⁄_s‹t_Æl_obje˘s_a˘iv©e
,

56 
DIA_TREE_SORT_NAME
, "" },

57 { 
N_
("/S‹àobje˘s/AŒ byÅy≥"), 
NULL
, 
⁄_s‹t_Æl_obje˘s_a˘iv©e
,

58 
DIA_TREE_SORT_TYPE
, "" },

59 { 
N_
("/S‹àobje˘s/AŒá†ö£πed"), 
NULL
, 
⁄_s‹t_Æl_obje˘s_a˘iv©e
,

60 
DIA_TREE_SORT_INSERT
, "" },

61 { 
N_
("/S‹àobje˘s/_DeÁu…"), 
NULL
, NULL, 0, "<Branch>"},

62 { 
N_
("/S‹àobje˘s/DeÁu…/by _«me"), 
NULL
, 
⁄_s‹t_def_a˘iv©e
,

63 
DIA_TREE_SORT_NAME
, "<RadioItem>" },

64 { 
N_
("/S‹àobje˘s/DeÁu…/by _ty≥"), 
NULL
, 
⁄_s‹t_def_a˘iv©e
,

65 
DIA_TREE_SORT_TYPE
, "/Sort objects/Default/byÇame" },

66 { 
N_
("/S‹àobje˘s/DeÁu…/a†_ö£πed"), 
NULL
, 
⁄_s‹t_def_a˘iv©e
,

67 
DIA_TREE_SORT_INSERT
, "/Sort objects/Default/byÇame" },

68 { 
N_
("/S‹à_dügøms"), 
NULL
, NULL, 0, "<Branch>" },

69 { 
N_
("/S‹à_dügøms/by _«me"), 
NULL
, 
⁄_s‹t_dügøms_a˘iv©e
,

70 
DIA_TREE_SORT_NAME
, "" },

71 { 
N_
("/S‹à_dügøms/a†_ö£πed"), 
NULL
, 
⁄_s‹t_dügøms_a˘iv©e
,

72 
DIA_TREE_SORT_INSERT
, "" },

73 { 
N_
("/S‹àdügøms/_DeÁu…"), 
NULL
, NULL, 0, "<Branch>"},

74 { 
N_
("/S‹àdügøms/DeÁu…/by _«me"), 
NULL
, 
⁄_s‹t_dü_def_a˘iv©e
,

75 
DIA_TREE_SORT_NAME
, "<RadioItem>" },

76 { 
N_
("/S‹àdügøms/DeÁu…/a†_ö£πed"), 
NULL
, 
⁄_s‹t_dü_def_a˘iv©e
,

77 
DIA_TREE_SORT_INSERT
, "/Sort diagrams/Default/byÇame" },

80 c⁄° 
göt
 
	gCOMMON_ITEMS_SIZE_
 =

81  (
comm⁄_ôems_
) /  (common_items_[0]);

83 
GtkIãmFa˘‹yE¡ry
 
	gobje˘_ôems_
[] = {

84 { 
N_
("/_Loˇã"), 
NULL
, 
⁄_loˇã_obje˘_a˘iv©e
, 0, "" },

85 { 
N_
("/_Pr›îtõs"), 
NULL
, 
⁄_¥›îtõs_a˘iv©e
, 0, "" },

86 { 
N_
("/_Hidêthi†ty≥"), 
NULL
, 
⁄_hide_obje˘_a˘iv©e
, 0, "" },

87 { 
N_
(
SHOW_TYPE_PATH
), 
NULL
, NULL, 0, "<Branch>" },

92 
	#OBJ_ITEMS_SIZE_
 ( (
obje˘_ôems_
Ë/  (obje˘_ôems_[0]))

	)

94 
GtkIãmFa˘‹yE¡ry
 
	gdü_ôems_
[] = {

95 { 
N_
("/_Loˇã"), 
NULL
, 
⁄_loˇã_dü_a˘iv©e
, 0, "" },

96 { 
N_
(
SHOW_TYPE_PATH
), 
NULL
, NULL, 0, "<Branch>" },

99 
	#DIA_ITEMS_SIZE_
 ( (
dü_ôems_
Ë/  (dü_ôems_[0]))

	)

101 
GtkIãmFa˘‹yE¡ry
 *
	gôems_
[] = { 
dü_ôems_
, 
obje˘_ôems_
 };

102 
göt
 
	gôems_size_
[] = { 
DIA_ITEMS_SIZE_
, 
OBJ_ITEMS_SIZE_
 };

104 
gch¨
*

105 
	$_dü_å™¶©e
 (c⁄° 
gch¨
 *
ãrm
, 
gpoöãr
 
d©a
)

107 
gch¨
 *
å™s
 = 
ãrm
;

109 i‡(
ãrm
 && *term) {

111 
å™s
 = 
	`dgëãxt
 (
GETTEXT_PACKAGE
, 
ãrm
);

113 i‡(
ãrm
 =
å™s
)

114 
å™s
 = 
	`dgëãxt
 ("gtk20", 
ãrm
);

117 i‡(
ãrm
 =
å™s
) {

118 
gch¨
* 
kludge
 = 
	`g_°rdup_¥ötf
 ("/%s", 
ãrm
);

119 
å™s
 = 
	`dgëãxt
 (
GETTEXT_PACKAGE
, 
kludge
);

120 i‡(
kludge
 =
å™s
)

121 
å™s
 = 
ãrm
;

123 ++
å™s
;

124 
	`g_‰ì
 (
kludge
);

126 i‡(
ãrm
 =
å™s
)

127 
å™s
 = 
	`g_°rdup_¥ötf
 ("XXX: %s", 
ãrm
);

130  
å™s
;

131 
	}
}

133 
GtkIãmFa˘‹y
*

134 
	$¸óã_Á˘‹y
(
DügømTªe
 *
åì
, 
GtkWödow
 *
wödow
, 
göt
 
no
,

135 
GtkIãmFa˘‹yE¡ry
 
íåõs
[], c⁄° 
gch¨
 *
∑th
)

137 
GtkIãmFa˘‹y
 *
Á˘‹y
;

138 
GtkAc˚lGroup
 *
ac˚l
 = 
	`gtk_ac˚l_group_√w
();

139 
gch¨
 *
ôem_∑th
 = 
NULL
;

140 
GtkWidgë
 *
míu
;

142 
Á˘‹y
 = 
	`gtk_ôem_Á˘‹y_√w
(
GTK_TYPE_MENU
, 
∑th
, 
ac˚l
);

143 
	`gtk_ôem_Á˘‹y_£t_å™¶©e_func
(
Á˘‹y
, 
_dü_å™¶©e
, 
NULL
, NULL);

144 
	`gtk_ôem_Á˘‹y_¸óã_ôems
(
Á˘‹y
, 
no
, 
íåõs
,
åì
);

145 
	`gtk_ôem_Á˘‹y_¸óã_ôems
(
Á˘‹y
, 
COMMON_ITEMS_SIZE_
, 
comm⁄_ôems_
,

146 
åì
);

147 
	`gtk_wödow_add_ac˚l_group
(
wödow
, 
ac˚l
);

149 
	`dügøm_åì_obje˘_s‹t_ty≥
(
åì
)) {

150 
DIA_TREE_SORT_NAME
:

151 
ôem_∑th
 = 
	`g_°rc⁄ˇt
(
∑th
, "/S‹àobje˘s/DeÁu…/byÇame", 
NULL
);

153 
DIA_TREE_SORT_TYPE
:

154 
ôem_∑th
 = 
	`g_°rc⁄ˇt
(
∑th
, "/S‹àobje˘s/DeÁu…/byÅy≥", 
NULL
);

157 
DIA_TREE_SORT_INSERT
:

158 
ôem_∑th
 = 
	`g_°rc⁄ˇt
(
∑th
, "/S‹àobje˘s/DeÁu…/a†ö£πed", 
NULL
);

162 
míu
 = 
	`gtk_ôem_Á˘‹y_gë_widgë
(
Á˘‹y
, 
ôem_∑th
);

163 
	`gtk_check_míu_ôem_£t_a˘ive
(
	`GTK_CHECK_MENU_ITEM
(
míu
), 
TRUE
);

164 
	`g_‰ì
(
ôem_∑th
);

166 
	`dügøm_åì_dügøm_s‹t_ty≥
(
åì
)) {

167 
DIA_TREE_SORT_NAME
:

168 
ôem_∑th
 = 
	`g_°rc⁄ˇt
(
∑th
, "/S‹àdügøms/DeÁu…/byÇame", 
NULL
);

171 
DIA_TREE_SORT_INSERT
:

172 
ôem_∑th
 = 
	`g_°rc⁄ˇt
(
∑th
, "/S‹àdügøms/DeÁu…/a†ö£πed", 
NULL
);

176 
míu
 = 
	`gtk_ôem_Á˘‹y_gë_widgë
(
Á˘‹y
, 
ôem_∑th
);

177 
	`gtk_check_míu_ôem_£t_a˘ive
(
	`GTK_CHECK_MENU_ITEM
(
míu
), 
TRUE
);

178 
	`g_‰ì
(
ôem_∑th
);

180  
Á˘‹y
;

181 
	}
}

183 
DügømTªeMíus
 *

184 
	$dügøm_åì_míus_√w
(
DügømTªe
 *
åì
, 
GtkWödow
 *
wödow
)

186 
DügømTªeMíus
 *
ªsu…
;

187 
k
;

189 
	`g_ªtu∫_vÆ_if_Áû
(
åì
, 
NULL
);

190 
	`g_ªtu∫_vÆ_if_Áû
(
wödow
, 
NULL
);

192 
ªsu…
 = 
	`g_√w
(
DügømTªeMíus
, 1);

193 
ªsu…
->
åì
 =Åree;

194 
k
 = 0; k < 2; ++k) {

195 íum {
LEN
 = 128};

196 
gch¨
 
BUFF
[
LEN
];

197 
ªsu…
->
Á˘‹õs
[
k
] = 
	`¸óã_Á˘‹y
(
åì
, 
wödow
, 
ôems_size_
[k],

198 
ôems_
[
k
], 
ROOT_NAMES_
[k]);

199 
ªsu…
->
míus
[
k
] =

200 
	`gtk_ôem_Á˘‹y_gë_widgë
(
ªsu…
->
Á˘‹õs
[
k
], 
ROOT_NAMES_
[k]);

201 
	`g_¢¥ötf
(
BUFF
, 
LEN
, "%s%s", 
ROOT_NAMES_
[
k
], 
SHOW_TYPE_PATH
);

202 
ªsu…
->
show_míus
[
k
] =

203 
	`gtk_ôem_Á˘‹y_gë_widgë
(
ªsu…
->
Á˘‹õs
[
k
], 
BUFF
);

205  
ªsu…
;

206 
	}
}

208 
GtkWidgë
 *

209 
	$dügøm_åì_míus_gë_míu
(c⁄° 
DügømTªeMíus
 *
míus
,

210 
DügømTªeMíuTy≥
 
ty≥
)

212 
	`g_ªtu∫_vÆ_if_Áû
(
míus
, 
NULL
);

213 
	`g_ªtu∫_vÆ_if_Áû
(
ty≥
 <
DIA_MENU_OBJECT
, 
NULL
);

214  
míus
->míus[
ty≥
];

215 
	}
}

218 
	$dügøm_åì_míus_p›up_míu
(c⁄° 
DügømTªeMíus
 *
míus
,

219 
DügømTªeMíuTy≥
 
ty≥
, 
göt
 
time
)

221 
	`g_ªtu∫_if_Áû
(
míus
);

222 
	`g_ªtu∫_if_Áû
(
ty≥
 <
DIA_MENU_OBJECT
);

223 
	`gtk_míu_p›up
(
	`GTK_MENU
(
míus
->míus[
ty≥
]), 
NULL
, NULL, NULL, NULL, 3, 
time
);

224 
	}
}

227 
	s_ShowTy≥D©a


229 
DügømTªeMíus
 *
	mmíus
;

230 
GtkWidgë
 *
	môems
[2];

231 
gch¨
 *
	mty≥
;

232 } 
	tShowTy≥D©a
;

235 
	$⁄_show_obje˘_ty≥
(
GtkMíuIãm
 *
ôem
, 
ShowTy≥D©a
 *
d©a
)

237 
k
;

238 
	`dügøm_åì_unhide_ty≥
(
d©a
->
míus
->
åì
, d©a->
ty≥
);

239 
k
 = 0; k < 2; ++k) {

240 
	`gtk_c⁄èöî_ªmove
(
	`GTK_CONTAINER
(
d©a
->
míus
->
show_míus
[
k
]),

241 
d©a
->
ôems
[
k
]);

243 
	`g_‰ì
(
d©a
->
ty≥
);

244 
	`g_‰ì
(
d©a
);

245 
	}
}

248 
	$dügøm_åì_míus_add_hiddí_ty≥
(
DügømTªeMíus
 *
míus
,

249 c⁄° 
gch¨
 *
ty≥
)

251 
k
;

252 
ShowTy≥D©a
 *
d©a
;

253 
	`g_ªtu∫_if_Áû
(
míus
);

254 
	`g_ªtu∫_if_Áû
(
ty≥
);

255 
d©a
 = 
	`g_√w
(
ShowTy≥D©a
, 1);

256 
d©a
->
ty≥
 = 
	`g_°rdup
(type);

257 
d©a
->
míus
 = menus;

258 
k
 = 0; k < 2; ++k) {

259 
GtkMíuShñl
 *
shñl
 = 
	`GTK_MENU_SHELL
(
míus
->
show_míus
[
k
]);

260 
GtkWidgë
 *
ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
ty≥
);

261 
d©a
->
ôems
[
k
] = 
ôem
;

262 
	`gtk_míu_shñl_≠≥nd
(
shñl
, 
ôem
);

263 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
ôem
),

265 
	`G_CALLBACK
(
⁄_show_obje˘_ty≥
),

266 (
gpoöãr
)
d©a
);

267 
	`gtk_widgë_show
(
ôem
);

269 
	}
}

	@O:\tool\dvs50\app\diagram_tree_menu.h

23 #i‚de‡
DIAGRAM_TREE_MENU_H


24 
	#DIAGRAM_TREE_MENU_H


	)

26 
	~"dügøm_åì.h
"

28 
_DügømTªeMíus
 
	tDügømTªeMíus
;

30 
	mDIA_MENU_DIAGRAM
,

31 
	mDIA_MENU_OBJECT


32 } 
	tDügømTªeMíuTy≥
;

34 
DügømTªeMíus
 *

35 
dügøm_åì_míus_√w
(
DügømTªe
 *
åì
, 
GtkWödow
 *
wödow
);

38 
GtkWidgë
 *

39 
dügøm_åì_míus_gë_míu
(c⁄° 
DügømTªeMíus
 *
míus
,

40 
DügømTªeMíuTy≥
 
ty≥
);

43 
dügøm_åì_míus_p›up_míu
(c⁄° 
DügømTªeMíus
 *
míus
,

44 
DügømTªeMíuTy≥
 
ty≥
, 
göt
 
time
);

48 
dügøm_åì_míus_add_hiddí_ty≥
(
DügømTªeMíus
 *
míus
,

49 c⁄° 
gch¨
 *
ty≥
);

52 
dügøm_åì_míus_ªmove_hiddí_ty≥
(
DügømTªeMíus
 *
míus
,

53 c⁄° 
gch¨
 *
ty≥
);

	@O:\tool\dvs50\app\diagram_tree_menu_callbacks.c

23 #ifde‡
HAVE_CONFIG_H


24 
	~<c⁄fig.h
>

27 
	~<gtk/gtk.h
>

29 
	~"dügøm_åì_míu_ˇŒbacks.h
"

30 
	~"dügøm_åì_míu.h
"

31 
	~"dügøm_åì_wödow.h
"

32 
	~"¥e„ªn˚s.h
"

35 
	$⁄_loˇã_obje˘_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

36 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
míuôem
)

39 
	`dügøm_åì_øi£
((
DügømTªe
 *)
u£r_d©a
);

40 
	}
}

43 
	$⁄_¥›îtõs_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

44 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
míuôem
)

46 
	`dügøm_åì_show_¥›îtõs
((
DügømTªe
 *)
u£r_d©a
);

47 
	}
}

50 
	$⁄_s‹t_obje˘s_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

51 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
míuôem
)

53 
	`dügøm_åì_s‹t_obje˘s
((
DügømTªe
 *)
u£r_d©a
, 
a˘i⁄
);

54 
	}
}

57 
	$⁄_s‹t_Æl_obje˘s_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

58 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
míuôem
)

60 
	`dügøm_åì_s‹t_Æl_obje˘s
((
DügømTªe
 *)
u£r_d©a
, 
a˘i⁄
);

61 
	}
}

64 
	$⁄_s‹t_def_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

65 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
)

67 
¥efs
.
dü_åì
.
obj_s‹t
 = 
a˘i⁄
;

68 
	`dügøm_åì_£t_obje˘_s‹t_ty≥
((
DügømTªe
 *)
u£r_d©a
, 
a˘i⁄
);

69 
	}
}

72 
	$⁄_dñëe_obje˘_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

73 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
míuôem
)

76 
	}
}

79 
	$⁄_loˇã_dü_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

80 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
míuôem
)

82 
	`dügøm_åì_øi£
((
DügømTªe
 *)
u£r_d©a
);

83 
	}
}

87 
	$⁄_s‹t_dügøms_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

88 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
míuôem
)

90 
	`dügøm_åì_s‹t_dügøms
((
DügømTªe
 *)
u£r_d©a
, 
a˘i⁄
);

91 
	}
}

95 
	$⁄_s‹t_dü_def_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

96 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
)

98 
¥efs
.
dü_åì
.
dü_s‹t
 = 
a˘i⁄
;

99 
	`dügøm_åì_£t_dügøm_s‹t_ty≥
((
DügømTªe
 *)
u£r_d©a
, 
a˘i⁄
);

100 
	}
}

103 
	$⁄_hide_obje˘_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

104 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
míuôem
)

106 
	`dügøm_åì_hide_ty≥
((
DügømTªe
 *)
u£r_d©a
);

107 
	}
}

	@O:\tool\dvs50\app\diagram_tree_menu_callbacks.h

23 #i‚de‡
DIAGRAM_TREE_MENU_CALLBACKS_H


24 
	#DIAGRAM_TREE_MENU_CALLBACKS_H


	)

26 
	~<gtk/gtk.h
>

27 
	~"dügøm_åì.h
"

30 
⁄_loˇã_obje˘_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

31 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

34 
⁄_¥›îtõs_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

35 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

38 
⁄_s‹t_obje˘s_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

39 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

42 
⁄_s‹t_Æl_obje˘s_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

43 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

46 
⁄_s‹t_def_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

47 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

50 
⁄_hide_obje˘_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

51 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

54 
⁄_dñëe_obje˘_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

55 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

58 
⁄_loˇã_dü_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

59 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

62 
⁄_s‹t_dügøms_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

63 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

66 
⁄_s‹t_dü_def_a˘iv©e
(
gpoöãr
 
u£r_d©a
,

67 
guöt
 
a˘i⁄
, 
GtkMíuIãm
 *
ôem
);

	@O:\tool\dvs50\app\diagram_tree_window.c

23 #ifde‡
HAVE_CONFIG_H


24 
	~<c⁄fig.h
>

27 
	~<°rög.h
>

29 
	~"öé.h
"

30 
	~"¥e„ªn˚s.h
"

31 
	~"dügøm.h
"

32 
	~"dügøm_åì.h
"

33 
	~"dügøm_åì_wödow.h
"

34 
	~"dügøm_åì_míu.h
"

35 
	~"≥rsi°í˚.h
"

37 
GtkWidgë
 *
	gdügwödow_
 = 
NULL
;

38 
GtkToggÀA˘i⁄
 *
	gtoggÀ_a˘i⁄_
 = 
NULL
;

39 
DügømTªe
 *
	gdügåì_
 = 
NULL
;

40 
DügømTªeC⁄fig
 *
	gc⁄fig_
 = 
NULL
;

44 
	$dügøm_åì_wödow_hide
(
GtkWidgë
 *
wödow
)

46 i‡(
toggÀ_a˘i⁄_
 &&

47 
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
(
toggÀ_a˘i⁄_
)) {

48 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
(
toggÀ_a˘i⁄_
, 
FALSE
);

50 
	`gtk_widgë_hide
(
wödow
);

51 
	}
}

55 
	$dügøm_åì_wödow_de°royed
(
GtkWidgë
 *
wödow
)

57 
dügwödow_
 = 
NULL
;

58 
	`g_‰ì
(
dügåì_
);

59 
dügåì_
 = 
NULL
;

61 i‡(
toggÀ_a˘i⁄_
 &&

62 
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
(
toggÀ_a˘i⁄_
)) {

63 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
(
toggÀ_a˘i⁄_
, 
FALSE
);

65 
	}
}

68 
GtkWidgë
*

69 
	$dügøm_åì_wödow_√w
(
DügømTªeC⁄fig
 *
c⁄fig
)

71 
GtkWidgë
 *
wödow
;

72 
GtkWidgë
 *
s¸ﬁl
;

73 
GtkWidgë
 *
åì
;

76 
wödow
 = 
	`gtk_wödow_√w
(
GTK_WINDOW_TOPLEVEL
);

78 
	`g_ªtu∫_vÆ_if_Áû
(
wödow
, 
NULL
);

80 
	`gtk_wödow_£t_tôÀ
(
	`GTK_WINDOW
(
wödow
), 
	`_
("Diagram Tree"));

81 
	`gtk_wödow_£t_rﬁe
(
	`GTK_WINDOW
(
wödow
), "diagram_tree");

84 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
wödow
), "destroy",

85 
	`G_CALLBACK
(
dügøm_åì_wödow_de°royed
), 
NULL
);

87 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
wödow
), "delete_event",

88 
	`G_CALLBACK
(
dügøm_åì_wödow_hide
), 
NULL
);

91 i‡(!
dügåì_
)

93 
	`≥rsi°í˚_ªgi°î_li°
(
HIDDEN_TYPES_NAME
);

94 i‡(!
c⁄fig
->
ßve_hiddí
) {

95 
	`≥rsi°ít_li°_ªmove_Æl
(
HIDDEN_TYPES_NAME
);

97 
dügåì_
 = 
	`dügøm_åì_√w
(
	`dü_›í_dügøms
(), 
	`GTK_WINDOW
(
wödow
),

98 
c⁄fig
->
dü_s‹t
, c⁄fig->
obj_s‹t
);

99 
	`dügøm_åì_upd©e_Æl
(
dügåì_
);

101 
åì
 = 
	`dügøm_åì_widgë
(
dügåì_
);

104 
s¸ﬁl
 = 
	`gtk_s¸ﬁÀd_wödow_√w
(
NULL
, NULL);

105 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
(
	`GTK_SCROLLED_WINDOW
(
s¸ﬁl
),

106 
GTK_POLICY_NEVER
, 
GTK_POLICY_AUTOMATIC
);

107 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
s¸ﬁl
), 
åì
);

108 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
wödow
), 
s¸ﬁl
);

110 
	`gtk_widgë_show
(
åì
);

111 
	`gtk_widgë_show
(
s¸ﬁl
);

113 
	`≥rsi°í˚_ªgi°î_wödow
(
	`GTK_WINDOW
(
wödow
));

115  
wödow
;

116 
	}
}

119 
DügømTªe
 *

120 
	$dügøm_åì
()

122  
dügåì_
;

123 
	}
}

126 
	$¸óã_dügøm_åì_wödow
(
DügømTªeC⁄fig
 *
c⁄fig
, 
GtkToggÀA˘i⁄
 *
a˘i⁄
)

128 
c⁄fig_
 = 
c⁄fig
;

129 
toggÀ_a˘i⁄_
 = 
a˘i⁄
;

130 i‡(!
dügwödow_
) {

131 
dügwödow_
 = 
	`dügøm_åì_wödow_√w
(
c⁄fig_
);

133 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
(
a˘i⁄
, 
	`GTK_WIDGET_REALIZED
(
dügwödow_
));

134 
	}
}

138 
	$dügåì_show_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
, 
gpoöãr
 
u£r_d©a
)

140 i‡(!
dügwödow_
) {

141 
dügwödow_
 = 
	`dügøm_åì_wödow_√w
(
c⁄fig_
);

143 
GLi°
 *
›í
 = 
	`dü_›í_dügøms
();

144 
›í
) {

145 
	`dügøm_åì_add
(
dügåì_
, (
Dügøm
 *)
›í
->
d©a
);

146 
›í
 = 
	`g_li°_√xt
(open);

149 i‡(!
toggÀ_a˘i⁄_
ËtoggÀ_a˘i⁄_ = 
a˘i⁄
;

150 i‡(
	`gtk_toggÀ_a˘i⁄_gë_a˘ive
 (
toggÀ_a˘i⁄_
))

151 
	`gtk_widgë_show
(
dügwödow_
);

153 
	`gtk_widgë_hide
(
dügwödow_
);

154 
	}
}

	@O:\tool\dvs50\app\diagram_tree_window.h

24 #i‚de‡
DIAGRAM_TREE_WINDOW_H


25 
	#DIAGRAM_TREE_WINDOW_H


	)

27 
	~<gtk/gtk.h
>

28 
	~"dügøm_åì.h
"

31 
_DügømTªeC⁄fig
 
	tDügømTªeC⁄fig
;

33 
	s_DügømTªeC⁄fig
 {

34 
DügømTªeS‹tTy≥
 
	mdü_s‹t
;

35 
DügømTªeS‹tTy≥
 
	mobj_s‹t
;

36 
gboﬁón
 
	mßve_hiddí
;

40 
DügømTªe
 *

41 
dügøm_åì
();

44 
¸óã_dügøm_åì_wödow
(
DügømTªeC⁄fig
 *
c⁄fig
, 
GtkToggÀA˘i⁄
 *
a˘i⁄
);

49 
dügåì_show_ˇŒback
 (
GtkToggÀA˘i⁄
 *
a˘i⁄
, 
gpoöãr
 
u£r_d©a
);

	@O:\tool\dvs50\app\diagrid.h

1 #i‚de‡
DIA_GRID_H


2 
	#DIA_GRID_H


	)

4 
_DüGrid
 
	tDüGrid
;

6 
	s_DüGrid
 {

8 
ªÆ
 
	mwidth_x
, 
	mwidth_y
, 
	mwidth_w
;

10 
guöt
 
	mvisibÀ_x
, 
	mvisibÀ_y
;

15 
guöt
 
	mmaj‹_löes
;

19 
gboﬁón
 
	mdy«mic
;

22 
Cﬁ‹
 
	mcﬁour
;

24 
gboﬁón
 
	mhex
;

26 
ªÆ
 
	mhex_size
;

	@O:\tool\dvs50\app\diapagelayout.c

24 #ifde‡
HAVE_CONFIG_H


25 
	~<c⁄fig.h
>

28 #unde‡
GTK_DISABLE_DEPRECATED


29 
	~"dü∑gñayout.h
"

30 
	~"widgës.h
"

32 
	~"öé.h
"

34 
	~"pixm≠s/p‹åaô.xpm
"

35 
	~"pixm≠s/œndsˇ≥.xpm
"

37 
	~"¥e„ªn˚s.h
"

38 
	~"∑≥r.h
"

39 
	~"¥efs.h
"

42 
	#DIA_PAGE_LAYOUT_CLASS
(
kœss
Ë
	`GTK_CHECK_CLASS_CAST
(kœss, 
	`dü_∑ge_œyout_gë_ty≥
(), 
DüPageLayoutCœss
)

	)

43 
	#DIA_IS_PAGE_LAYOUT
(
obj
Ë
	`GTK_CHECK_TYPE
(obj, 
	`dü_∑ge_œyout_gë_ty≥
())

	)

45 
_DüPageLayoutCœss
 
	tDüPageLayoutCœss
;

47 
	s_DüPageLayout
 {

48 
GtkTabÀ
 
	m∑ª¡
;

51 
GtkWidgë
 *
	m∑≥r_size
, *
	m∑≥r_œbñ
;

52 
GtkWidgë
 *
	m‹õ¡_p‹åaô
, *
	m‹õ¡_œndsˇ≥
;

53 
GtkWidgë
 *
	mtm¨gö
, *
	mbm¨gö
, *
	mlm¨gö
, *
	mrm¨gö
;

54 
GtkWidgë
 *
	msˇÀ
, *
	mfôto
;

55 
GtkWidgë
 *
	msˇlög
, *
	mfôw
, *
	mfôh
;

57 
GtkWidgë
 *
	md¨ó
;

59 
GdkGC
 *
	mgc
;

60 
GdkCﬁ‹
 
	mwhôe
, 
	mbœck
, 
	mblue
;

61 
göt
 
	m∑≥∫um
;

64 
göt
 
	mx
, 
	my
, 
	mwidth
, 
	mheight
;

66 
gboﬁón
 
	mblock_ch™ged
;

69 
	s_DüPageLayoutCœss
 {

70 
GtkTabÀCœss
 
	m∑ª¡_˛ass
;

72 (*
	mch™ged
)(
DüPageLayout
 *
	m∂
);

77 
	mCHANGED
,

78 
	mLAST_SIGNAL


81 
guöt
 
	g∂_sig«ls
[
LAST_SIGNAL
] = { 0 };

82 
GtkObje˘Cœss
 *
	g∑ª¡_˛ass
;

84 
dü_∑ge_œyout_˛ass_öô
(
DüPageLayoutCœss
 *
˛ass
);

85 
dü_∑ge_œyout_öô
(
DüPageLayout
 *
£lf
);

86 
dü_∑ge_œyout_de°roy
(
GtkObje˘
 *
obje˘
);

88 
GtkTy≥


89 
	$dü_∑ge_œyout_gë_ty≥
()

91 
GtkTy≥
 
∂_ty≥
 = 0;

93 i‡(!
∂_ty≥
) {

94 c⁄° 
GtkTy≥Info
 
∂_öfo
 = {

96 (
DüPageLayout
),

97 (
DüPageLayoutCœss
),

98 (
GtkCœssInôFunc
Ë
dü_∑ge_œyout_˛ass_öô
,

99 (
GtkObje˘InôFunc
Ë
dü_∑ge_œyout_öô
,

100 
NULL
,

101 
NULL
,

102 (
GtkCœssInôFunc
Ë
NULL
,

104 
∂_ty≥
 = 
	`gtk_ty≥_unique
(
	`gtk_èbÀ_gë_ty≥
(), &
∂_öfo
);

106  
∂_ty≥
;

107 
	}
}

110 
	$dü_∑ge_œyout_˛ass_öô
(
DüPageLayoutCœss
 *
˛ass
)

112 
GtkObje˘Cœss
 *
obje˘_˛ass
;

114 
obje˘_˛ass
 = (
GtkObje˘Cœss
*Ë
˛ass
;

115 
∑ª¡_˛ass
 = 
	`gtk_ty≥_˛ass
(
	`gtk_èbÀ_gë_ty≥
());

117 
∂_sig«ls
[
CHANGED
] =

118 
	`gtk_sig«l_√w
("changed",

119 
GTK_RUN_FIRST
,

120 
	`GTK_CLASS_TYPE
 (
obje˘_˛ass
),

121 
	`GTK_SIGNAL_OFFSET
(
DüPageLayoutCœss
, 
ch™ged
),

122 
gtk_sig«l_deÁu…_m¨shÆÀr
,

123 
GTK_TYPE_NONE
, 0);

125 
	`gtk_obje˘_˛ass_add_sig«ls
(
obje˘_˛ass
, 
∂_sig«ls
, 
LAST_SIGNAL
);

128 
obje˘_˛ass
->
de°roy
 = 
dü_∑ge_œyout_de°roy
;

129 
	}
}

131 
d¨ó_size_Æloˇã
(
DüPageLayout
 *
£lf
, 
GtkAŒoˇti⁄
 *
Æloc
);

132 
göt
 
d¨ó_expo£_evít
(
DüPageLayout
 *
£lf
, 
GdkEvítExpo£
 *
ev
);

133 
∑≥r_size_ch™ge
(
GtkMíuIãm
 *
ôem
, 
DüPageLayout
 *
£lf
);

134 
‹õ¡_ch™ged
(
DüPageLayout
 *
£lf
);

135 
m¨gö_ch™ged
(
DüPageLayout
 *
£lf
);

136 
sˇÀmode_ch™ged
(
DüPageLayout
 *
£lf
);

137 
sˇÀ_ch™ged
(
DüPageLayout
 *
£lf
);

140 
	$dü_∑ge_œyout_öô
(
DüPageLayout
 *
£lf
)

142 
GtkWidgë
 *
‰ame
, *
box
, *
èbÀ
, *
míu
, *
míuôem
, *
wid
;

143 
GdkPixm≠
 *
pix
;

144 
GdkBôm≠
 *
mask
;

145 
GLi°
 *
∑≥r_«mes
;

146 
göt
 
i
;

148 
	`gtk_èbÀ_ªsize
(
	`GTK_TABLE
(
£lf
), 3, 2);

149 
	`gtk_èbÀ_£t_row_•acögs
(
	`GTK_TABLE
(
£lf
), 5);

150 
	`gtk_èbÀ_£t_cﬁ_•acögs
(
	`GTK_TABLE
(
£lf
), 5);

153 
‰ame
 = 
	`gtk_‰ame_√w
(
	`_
("Paper Size"));

154 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
£lf
), 
‰ame
, 0,1, 0,1,

155 
GTK_FILL
, GTK_FILL, 0, 0);

156 
	`gtk_widgë_show
(
‰ame
);

158 
box
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

159 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
box
), 5);

160 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
‰ame
), 
box
);

161 
	`gtk_widgë_show
(
box
);

163 
£lf
->
∑≥r_size
 = 
	`gtk_›ti⁄_míu_√w
();

164 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
box
), 
£lf
->
∑≥r_size
, 
TRUE
, 
FALSE
, 0);

166 
míu
 = 
	`gtk_míu_√w
();

168 
∑≥r_«mes
 = 
	`gë_∑≥r_«me_li°
();

169 
i
 = 0; 
∑≥r_«mes
 !
NULL
;

170 
i
++, 
∑≥r_«mes
 = 
	`g_li°_√xt
(paper_names)) {

171 
míuôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
∑≥r_«mes
->
d©a
);

172 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
míuôem
), "u£r_d©a", 
	`GINT_TO_POINTER
(
i
));

173 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
míuôem
), "activate",

174 
	`G_CALLBACK
(
∑≥r_size_ch™ge
), 
£lf
);

175 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
míu
), 
míuôem
);

176 
	`gtk_widgë_show
(
míuôem
);

178 
	`gtk_›ti⁄_míu_£t_míu
(
	`GTK_OPTION_MENU
(
£lf
->
∑≥r_size
), 
míu
);

179 
	`gtk_widgë_show
(
£lf
->
∑≥r_size
);

181 
£lf
->
∑≥r_œbñ
 = 
	`gtk_œbñ_√w
("");

182 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
box
), 
£lf
->
∑≥r_œbñ
, 
TRUE
, TRUE, 0);

183 
	`gtk_widgë_show
(
£lf
->
∑≥r_œbñ
);

186 
‰ame
 = 
	`gtk_‰ame_√w
(
	`_
("Orientation"));

187 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
£lf
), 
‰ame
, 1,2, 0,1,

188 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

189 
	`gtk_widgë_show
(
‰ame
);

191 
box
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

192 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
box
), 5);

193 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
‰ame
), 
box
);

194 
	`gtk_widgë_show
(
box
);

196 
£lf
->
‹õ¡_p‹åaô
 = 
	`gtk_ødio_buâ⁄_√w
(
NULL
);

197 
pix
 = 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

198 
	`gtk_widgë_gë_cﬁ‹m≠
(
	`GTK_WIDGET
(
£lf
)), &
mask
, 
NULL
,

199 
p‹åaô_xpm
);

200 
wid
 = 
	`gtk_pixm≠_√w
(
pix
, 
mask
);

201 
	`gdk_pixm≠_uƒef
(
pix
);

202 
	`gdk_bôm≠_uƒef
(
mask
);

203 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
£lf
->
‹õ¡_p‹åaô
), 
wid
);

204 
	`gtk_widgë_show
(
wid
);

206 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
box
), 
£lf
->
‹õ¡_p‹åaô
, 
TRUE
, TRUE, 0);

207 
	`gtk_widgë_show
(
£lf
->
‹õ¡_p‹åaô
);

209 
£lf
->
‹õ¡_œndsˇ≥
 = 
	`gtk_ødio_buâ⁄_√w
(

210 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(
£lf
->
‹õ¡_p‹åaô
)));

211 
pix
 = 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

212 
	`gtk_widgë_gë_cﬁ‹m≠
(
	`GTK_WIDGET
(
£lf
)), &
mask
, 
NULL
,

213 
œndsˇ≥_xpm
);

214 
wid
 = 
	`gtk_pixm≠_√w
(
pix
, 
mask
);

215 
	`gdk_pixm≠_uƒef
(
pix
);

216 
	`gdk_bôm≠_uƒef
(
mask
);

217 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
£lf
->
‹õ¡_œndsˇ≥
), 
wid
);

218 
	`gtk_widgë_show
(
wid
);

220 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
box
), 
£lf
->
‹õ¡_œndsˇ≥
, 
TRUE
, TRUE, 0);

221 
	`gtk_widgë_show
(
£lf
->
‹õ¡_œndsˇ≥
);

224 
‰ame
 = 
	`gtk_‰ame_√w
(
	`_
("Margins"));

225 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
£lf
), 
‰ame
, 0,1, 1,2,

226 
GTK_FILL
, GTK_FILL, 0, 0);

227 
	`gtk_widgë_show
(
‰ame
);

229 
èbÀ
 = 
	`gtk_èbÀ_√w
(4, 2, 
FALSE
);

230 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
èbÀ
), 5);

231 
	`gtk_èbÀ_£t_row_•acögs
(
	`GTK_TABLE
(
èbÀ
), 5);

232 
	`gtk_èbÀ_£t_cﬁ_•acögs
(
	`GTK_TABLE
(
èbÀ
), 5);

233 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
‰ame
), 
èbÀ
);

234 
	`gtk_widgë_show
(
èbÀ
);

236 
wid
 = 
	`gtk_œbñ_√w
(
	`_
("Top:"));

237 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
wid
), 1.0, 0.5);

238 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
wid
, 0,1, 0,1,

239 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

240 
	`gtk_widgë_show
(
wid
);

242 
£lf
->
tm¨gö
 = 
	`dü_unô_•ö√r_√w
(

243 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1, 0,100, 0.1,10,0)),

244 
	`¥efs_gë_Àngth_unô
());

245 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
£lf
->
tm¨gö
, 1,2, 0,1,

246 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

247 
	`gtk_widgë_show
(
£lf
->
tm¨gö
);

249 
wid
 = 
	`gtk_œbñ_√w
(
	`_
("Bottom:"));

250 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
wid
), 1.0, 0.5);

251 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
wid
, 0,1, 1,2,

252 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

253 
	`gtk_widgë_show
(
wid
);

255 
£lf
->
bm¨gö
 = 
	`dü_unô_•ö√r_√w
(

256 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1, 0,100, 0.1,10,0)),

257 
	`¥efs_gë_Àngth_unô
());

258 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
£lf
->
bm¨gö
, 1,2, 1,2,

259 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

260 
	`gtk_widgë_show
(
£lf
->
bm¨gö
);

262 
wid
 = 
	`gtk_œbñ_√w
(
	`_
("Left:"));

263 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
wid
), 1.0, 0.5);

264 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
wid
, 0,1, 2,3,

265 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

266 
	`gtk_widgë_show
(
wid
);

268 
£lf
->
lm¨gö
 = 
	`dü_unô_•ö√r_√w
(

269 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1, 0,100, 0.1,10,0)),

270 
	`¥efs_gë_Àngth_unô
());

271 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
£lf
->
lm¨gö
, 1,2, 2,3,

272 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

273 
	`gtk_widgë_show
(
£lf
->
lm¨gö
);

275 
wid
 = 
	`gtk_œbñ_√w
(
	`_
("Right:"));

276 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
wid
), 1.0, 0.5);

277 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
wid
, 0,1, 3,4,

278 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

279 
	`gtk_widgë_show
(
wid
);

281 
£lf
->
rm¨gö
 = 
	`dü_unô_•ö√r_√w
(

282 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1, 0,100, 0.1,10,0)),

283 
	`¥efs_gë_Àngth_unô
());

284 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
£lf
->
rm¨gö
, 1,2, 3,4,

285 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

286 
	`gtk_widgë_show
(
£lf
->
rm¨gö
);

289 
‰ame
 = 
	`gtk_‰ame_√w
(
	`_
("Scaling"));

290 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
£lf
), 
‰ame
, 0,1, 2,3,

291 
GTK_FILL
, GTK_FILL, 0, 0);

292 
	`gtk_widgë_show
(
‰ame
);

294 
èbÀ
 = 
	`gtk_èbÀ_√w
(2, 4, 
FALSE
);

295 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
èbÀ
), 5);

296 
	`gtk_èbÀ_£t_row_•acögs
(
	`GTK_TABLE
(
èbÀ
), 5);

297 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
‰ame
), 
èbÀ
);

298 
	`gtk_widgë_show
(
èbÀ
);

300 
£lf
->
sˇÀ
 = 
	`gtk_ødio_buâ⁄_√w_wôh_œbñ
(
NULL
, 
	`_
("Scale:"));

301 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
£lf
->
sˇÀ
, 0,1, 0,1,

302 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

303 
	`gtk_widgë_show
(
£lf
->
sˇÀ
);

305 
£lf
->
sˇlög
 = 
	`gtk_•ö_buâ⁄_√w
(

306 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(100,1,10000, 1,10,0)), 1, 0);

307 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
£lf
->
sˇlög
, 1,4, 0,1,

308 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

309 
	`gtk_widgë_show
(
£lf
->
sˇlög
);

311 
£lf
->
fôto
 = 
	`gtk_ødio_buâ⁄_√w_wôh_œbñ
(

312 
	`GTK_RADIO_BUTTON
(
£lf
->
sˇÀ
)->
group
, 
	`_
("FitÅo:"));

313 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
£lf
->
fôto
, 0,1, 1,2,

314 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

315 
	`gtk_widgë_show
(
£lf
->
fôto
);

317 
£lf
->
fôw
 = 
	`gtk_•ö_buâ⁄_√w
(

318 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1, 1, 1000, 1, 10, 0)), 1, 0);

319 
	`gtk_widgë_£t_£nsôive
(
£lf
->
fôw
, 
FALSE
);

320 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
£lf
->
fôw
, 1,2, 1,2,

321 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

322 
	`gtk_widgë_show
(
£lf
->
fôw
);

324 
wid
 = 
	`gtk_œbñ_√w
(
	`_
("by"));

325 
	`gtk_misc_£t_∑ddög
(
	`GTK_MISC
(
wid
), 5, 0);

326 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
wid
, 2,3, 1,2,

327 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

328 
	`gtk_widgë_show
(
wid
);

330 
£lf
->
fôh
 = 
	`gtk_•ö_buâ⁄_√w
(

331 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1, 1, 1000, 1, 10, 0)), 1, 0);

332 
	`gtk_widgë_£t_£nsôive
(
£lf
->
fôh
, 
FALSE
);

333 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
èbÀ
), 
£lf
->
fôh
, 3,4, 1,2,

334 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

335 
	`gtk_widgë_show
(
£lf
->
fôh
);

338 
£lf
->
d¨ó
 = 
	`gtk_døwög_¨ó_√w
();

339 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
£lf
), sñf->
d¨ó
, 1,2, 1,3,

340 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

341 
	`gtk_widgë_show
(
£lf
->
d¨ó
);

344 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
‹õ¡_p‹åaô
), "toggled",

345 
	`G_CALLBACK
(
‹õ¡_ch™ged
), 
	`GTK_OBJECT
(
£lf
));

347 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
tm¨gö
), "changed",

348 
	`G_CALLBACK
(
m¨gö_ch™ged
), 
	`GTK_OBJECT
(
£lf
));

349 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
bm¨gö
), "changed",

350 
	`G_CALLBACK
(
m¨gö_ch™ged
), 
	`GTK_OBJECT
(
£lf
));

351 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
lm¨gö
), "changed",

352 
	`G_CALLBACK
(
m¨gö_ch™ged
), 
	`GTK_OBJECT
(
£lf
));

353 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
rm¨gö
), "changed",

354 
	`G_CALLBACK
(
m¨gö_ch™ged
), 
	`GTK_OBJECT
(
£lf
));

356 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
fôto
), "toggled",

357 
	`G_CALLBACK
(
sˇÀmode_ch™ged
),

358 
	`GTK_OBJECT
(
£lf
));

359 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
sˇlög
), "changed",

360 
	`G_CALLBACK
(
sˇÀ_ch™ged
), 
	`GTK_OBJECT
(
£lf
));

361 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
fôw
), "changed",

362 
	`G_CALLBACK
(
sˇÀ_ch™ged
), 
	`GTK_OBJECT
(
£lf
));

363 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
fôh
), "changed",

364 
	`G_CALLBACK
(
sˇÀ_ch™ged
), 
	`GTK_OBJECT
(
£lf
));

366 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
d¨ó
), "size_allocate",

367 
	`G_CALLBACK
(
d¨ó_size_Æloˇã
),

368 
	`GTK_OBJECT
(
£lf
));

369 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
(
£lf
->
d¨ó
), "expose_event",

370 
	`G_CALLBACK
(
d¨ó_expo£_evít
),

371 
	`GTK_OBJECT
(
£lf
));

373 
	`gdk_cﬁ‹_whôe
(
	`gtk_widgë_gë_cﬁ‹m≠
(
	`GTK_WIDGET
(
£lf
)), &£lf->
whôe
);

374 
	`gdk_cﬁ‹_bœck
(
	`gtk_widgë_gë_cﬁ‹m≠
(
	`GTK_WIDGET
(
£lf
)), &£lf->
bœck
);

375 
£lf
->
blue
.
ªd
 = 0;

376 
£lf
->
blue
.
gªí
 = 0;

377 
£lf
->
blue
.blue = 0x7fff;

378 
	`gdk_cﬁ‹_Æloc
(
	`gtk_widgë_gë_cﬁ‹m≠
(
	`GTK_WIDGET
(
£lf
)), &£lf->
blue
);

380 
£lf
->
gc
 = 
NULL
;

381 
£lf
->
block_ch™ged
 = 
FALSE
;

382 
	}
}

384 
GtkWidgë
 *

385 
	$dü_∑ge_œyout_√w
()

387 
DüPageLayout
 *
£lf
 = 
	`gtk_ty≥_√w
(
	`dü_∑ge_œyout_gë_ty≥
());

389 
	`dü_∑ge_œyout_£t_∑≥r
(
£lf
, "");

390  
	`GTK_WIDGET
(
£lf
);

391 
	}
}

393 c⁄° 
gch¨
 *

394 
	$dü_∑ge_œyout_gë_∑≥r
(
DüPageLayout
 *
£lf
)

396  
	`gë_∑≥r_«me
(
£lf
->
∑≥∫um
);

397 
	}
}

400 
	$dü_∑ge_œyout_£t_∑≥r
(
DüPageLayout
 *
£lf
, c⁄° 
gch¨
 *
∑≥r
)

402 
göt
 
i
;

404 
i
 = 
	`föd_∑≥r
(
∑≥r
);

405 i‡(
i
 == -1)

406 
i
 = 
	`föd_∑≥r
(
¥efs
.
√w_dügøm
.
∑≥πy≥
);

407 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
£lf
->
∑≥r_size
), 
i
);

408 
	`gtk_míu_ôem_a˘iv©e
(

409 
	`GTK_MENU_ITEM
(
	`GTK_OPTION_MENU
(
£lf
->
∑≥r_size
)->
míu_ôem
));

410 
	}
}

413 
	$dü_∑ge_œyout_gë_m¨gös
(
DüPageLayout
 *
£lf
,

414 
gÊﬂt
 *
tm¨gö
, gÊﬂà*
bm¨gö
,

415 
gÊﬂt
 *
lm¨gö
, gÊﬂà*
rm¨gö
)

417 i‡(
tm¨gö
)

418 *
tm¨gö
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->tmargin));

419 i‡(
bm¨gö
)

420 *
bm¨gö
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->bmargin));

421 i‡(
lm¨gö
)

422 *
lm¨gö
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->lmargin));

423 i‡(
rm¨gö
)

424 *
rm¨gö
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->rmargin));

425 
	}
}

428 
	$dü_∑ge_œyout_£t_m¨gös
(
DüPageLayout
 *
£lf
,

429 
gÊﬂt
 
tm¨gö
, gÊﬂà
bm¨gö
,

430 
gÊﬂt
 
lm¨gö
, gÊﬂà
rm¨gö
)

432 
£lf
->
block_ch™ged
 = 
TRUE
;

433 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¨gö
),Åmargin);

434 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¨gö
), bmargin);

435 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¨gö
),Ümargin);

436 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¨gö
),Ñmargin);

437 
£lf
->
block_ch™ged
 = 
FALSE
;

439 
	`gtk_sig«l_emô
(
	`GTK_OBJECT
(
£lf
), 
∂_sig«ls
[
CHANGED
]);

440 
	}
}

442 
DüPageOrõ¡©i⁄


443 
	$dü_∑ge_œyout_gë_‹õ¡©i⁄
(
DüPageLayout
 *
£lf
)

445 i‡(
	`GTK_TOGGLE_BUTTON
(
£lf
->
‹õ¡_p‹åaô
)->
a˘ive
)

446  
DIA_PAGE_ORIENT_PORTRAIT
;

448  
DIA_PAGE_ORIENT_LANDSCAPE
;

449 
	}
}

452 
	$dü_∑ge_œyout_£t_‹õ¡©i⁄
(
DüPageLayout
 *
£lf
,

453 
DüPageOrõ¡©i⁄
 
‹õ¡
)

455 
‹õ¡
) {

456 
DIA_PAGE_ORIENT_PORTRAIT
:

457 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
£lf
->
‹õ¡_p‹åaô
),

458 
TRUE
);

460 
DIA_PAGE_ORIENT_LANDSCAPE
:

461 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
£lf
->
‹õ¡_œndsˇ≥
),

462 
TRUE
);

465 
	}
}

467 
gboﬁón


468 
	$dü_∑ge_œyout_gë_fôto
(
DüPageLayout
 *
£lf
)

470  
	`GTK_TOGGLE_BUTTON
(
£lf
->
fôto
)->
a˘ive
;

471 
	}
}

474 
	$dü_∑ge_œyout_£t_fôto
(
DüPageLayout
 *
£lf
, 
gboﬁón
 
fôto
)

476 i‡(
fôto
)

477 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
£lf
->
fôto
), 
TRUE
);

479 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
£lf
->
sˇÀ
), 
TRUE
);

480 
	}
}

482 
gÊﬂt


483 
	$dü_∑ge_œyout_gë_sˇlög
(
DüPageLayout
 *
£lf
)

485  
	`GTK_SPIN_BUTTON
(
£lf
->
sˇlög
)->
adju°mít
->
vÆue
 / 100.0;

486 
	}
}

489 
	$dü_∑ge_œyout_£t_sˇlög
(
DüPageLayout
 *
£lf
, 
gÊﬂt
 
sˇlög
)

491 
	`GTK_SPIN_BUTTON
(
£lf
->
sˇlög
)->
adju°mít
->
vÆue
 = scaling * 100.0;

492 
	`gtk_adju°mít_vÆue_ch™ged
(
	`GTK_SPIN_BUTTON
(
£lf
->
sˇlög
)->
adju°mít
);

493 
	}
}

496 
	$dü_∑ge_œyout_£t_ch™ged
 (
DüPageLayout
 *
£lf
, 
gboﬁón
 
ch™ged
)

498 
£lf
->
block_ch™ged
 = 
ch™ged
;

499 
	}
}

502 
	$dü_∑ge_œyout_gë_fô_dims
(
DüPageLayout
 *
£lf
, 
göt
 *
w
, göà*
h
)

504 i‡(
w
)

505 *
w
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_öt
(
	`GTK_SPIN_BUTTON
(
£lf
->
fôw
));

506 i‡(
h
)

507 *
h
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_öt
(
	`GTK_SPIN_BUTTON
(
£lf
->
fôh
));

508 
	}
}

511 
	$dü_∑ge_œyout_£t_fô_dims
(
DüPageLayout
 *
£lf
, 
göt
 
w
, göà
h
)

513 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
£lf
->
fôw
), 
w
);

514 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
£lf
->
fôh
), 
h
);

515 
	}
}

518 
	$dü_∑ge_œyout_gë_ef„˘ive_¨ó
(
DüPageLayout
 *
£lf
, 
gÊﬂt
 *
width
,

519 
gÊﬂt
 *
height
)

521 
gÊﬂt
 
h
, 
w
, 
sˇlög
;

523 i‡(
	`GTK_TOGGLE_BUTTON
(
£lf
->
‹õ¡_p‹åaô
)->
a˘ive
) {

524 
w
 = 
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
);

525 
h
 = 
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
);

527 
h
 = 
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
);

528 
w
 = 
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
);

530 
h
 -
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¨gö
));

531 
	`g_ªtu∫_if_Áû
 (
h
 > 0.0);

532 
h
 -
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¨gö
));

533 
	`g_ªtu∫_if_Áû
 (
h
 > 0.0);

534 
w
 -
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¨gö
));

535 
	`g_ªtu∫_if_Áû
 (
w
 > 0.0);

536 
w
 -
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¨gö
));

537 
	`g_ªtu∫_if_Áû
 (
w
 > 0.0);

538 
sˇlög
 = 
	`GTK_SPIN_BUTTON
(
£lf
->sˇlög)->
adju°mít
->
vÆue
 / 100.0;

539 
h
 /
sˇlög
;

540 
w
 /
sˇlög
;

542 i‡(
width
Ë*width = 
w
;

543 i‡(
height
Ë*heighà
h
;

544 
	}
}

547 
	$dü_∑ge_œyout_gë_∑≥r_size
(c⁄° 
gch¨
 *
∑≥r
,

548 
gÊﬂt
 *
width
, gÊﬂà*
height
)

550 
göt
 
i
;

552 
i
 = 
	`föd_∑≥r
(
∑≥r
);

553 i‡(
i
 == -1)

554 
i
 = 
	`föd_∑≥r
(
¥efs
.
√w_dügøm
.
∑≥πy≥
);

555 i‡(
width
)

556 *
width
 = 
	`gë_∑≥r_pswidth
(
i
);

557 i‡(
height
)

558 *
height
 = 
	`gë_∑≥r_psheight
(
i
);

559 
	}
}

562 
	$dü_∑ge_œyout_gë_deÁu…_m¨gös
(c⁄° 
gch¨
 *
∑≥r
,

563 
gÊﬂt
 *
tm¨gö
, gÊﬂà*
bm¨gö
,

564 
gÊﬂt
 *
lm¨gö
, gÊﬂà*
rm¨gö
)

566 
göt
 
i
;

568 
i
 = 
	`föd_∑≥r
(
∑≥r
);

569 i‡(
i
 == -1)

570 
i
 = 
	`föd_∑≥r
(
¥efs
.
√w_dügøm
.
∑≥πy≥
);

571 i‡(
tm¨gö
)

572 *
tm¨gö
 = 
	`gë_∑≥r_tm¨gö
(
i
);

573 i‡(
bm¨gö
)

574 *
bm¨gö
 = 
	`gë_∑≥r_bm¨gö
(
i
);

575 i‡(
lm¨gö
)

576 *
lm¨gö
 = 
	`gë_∑≥r_lm¨gö
(
i
);

577 i‡(
rm¨gö
)

578 *
rm¨gö
 = 
	`gë_∑≥r_rm¨gö
(
i
);

579 
	}
}

582 
	$size_∑ge
(
DüPageLayout
 *
£lf
, 
GtkAŒoˇti⁄
 *
a
)

584 
£lf
->
width
 = 
a
->width - 3;

585 
£lf
->
height
 = 
a
->height - 3;

588 i‡(
	`GTK_TOGGLE_BUTTON
(
£lf
->
‹õ¡_p‹åaô
)->
a˘ive
) {

589 i‡(
£lf
->
width
 * 
	`gë_∑≥r_psheight
(£lf->
∑≥∫um
) >

590 
£lf
->
height
 * 
	`gë_∑≥r_pswidth
(£lf->
∑≥∫um
))

591 
£lf
->
width
 = sñf->
height
 * 
	`gë_∑≥r_pswidth
(£lf->
∑≥∫um
) /

592 
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
);

594 
£lf
->
height
 = sñf->
width
 * 
	`gë_∑≥r_psheight
(£lf->
∑≥∫um
) /

595 
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
);

597 i‡(
£lf
->
width
 * 
	`gë_∑≥r_pswidth
(£lf->
∑≥∫um
) >

598 
£lf
->
height
 * 
	`gë_∑≥r_psheight
(£lf->
∑≥∫um
))

599 
£lf
->
width
 = sñf->
height
 * 
	`gë_∑≥r_psheight
(£lf->
∑≥∫um
) /

600 
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
);

602 
£lf
->
height
 = sñf->
width
 * 
	`gë_∑≥r_pswidth
(£lf->
∑≥∫um
) /

603 
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
);

606 
£lf
->
x
 = (
a
->
width
 - self->width - 3) / 2;

607 
£lf
->
y
 = (
a
->
height
 - self->height - 3) / 2;

608 
	}
}

611 
	$d¨ó_size_Æloˇã
(
DüPageLayout
 *
£lf
, 
GtkAŒoˇti⁄
 *
Æloˇti⁄
)

613 
	`size_∑ge
(
£lf
, 
Æloˇti⁄
);

614 
	}
}

616 
göt


617 
	$d¨ó_expo£_evít
(
DüPageLayout
 *
£lf
, 
GdkEvítExpo£
 *
evít
)

619 
GdkWödow
 *
wödow

£lf
->
d¨ó
->window;

620 
gÊﬂt
 
vÆ
;

621 
göt
 
num
;

623 i‡(!
wödow
)

624  
FALSE
;

626 i‡(!
£lf
->
gc
)

627 
£lf
->
gc
 = 
	`gdk_gc_√w
(
wödow
);

629 
	`gdk_wödow_˛ór_¨ó
 (
wödow
,

631 
£lf
->
d¨ó
->
Æloˇti⁄
.
width
,

632 
£lf
->
d¨ó
->
Æloˇti⁄
.
height
);

635 
	`gdk_gc_£t_f‹eground
(
£lf
->
gc
, &£lf->
bœck
);

636 
	`gdk_døw_ª˘™gÀ
(
wödow
, 
£lf
->
gc
, 
TRUE
, sñf->
x
+3, sñf->
y
+3,

637 
£lf
->
width
, sñf->
height
);

638 
	`gdk_gc_£t_f‹eground
(
£lf
->
gc
, &£lf->
whôe
);

639 
	`gdk_døw_ª˘™gÀ
(
wödow
, 
£lf
->
gc
, 
TRUE
, sñf->
x
, sñf->
y
,

640 
£lf
->
width
, sñf->
height
);

641 
	`gdk_gc_£t_f‹eground
(
£lf
->
gc
, &£lf->
bœck
);

642 
	`gdk_døw_ª˘™gÀ
(
wödow
, 
£lf
->
gc
, 
FALSE
, sñf->
x
, sñf->
y
,

643 
£lf
->
width
-1, sñf->
height
-1);

645 
	`gdk_gc_£t_f‹eground
(
£lf
->
gc
, &£lf->
blue
);

648 i‡(
	`GTK_TOGGLE_BUTTON
(
£lf
->
‹õ¡_p‹åaô
)->
a˘ive
) {

649 
vÆ
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¨gö
));

650 
num
 = 
£lf
->
y
 + 
vÆ
 * sñf->
height
 /
	`gë_∑≥r_psheight
(£lf->
∑≥∫um
);

651 
	`gdk_døw_löe
(
wödow
, 
£lf
->
gc
, sñf->
x
+1, 
num
, sñf->x+£lf->
width
-2,num);

653 
vÆ
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¨gö
));

654 
num
 = 
£lf
->
y
 + sñf->
height
 -

655 
vÆ
 * 
£lf
->
height
 / 
	`gë_∑≥r_psheight
(£lf->
∑≥∫um
);

656 
	`gdk_døw_löe
(
wödow
, 
£lf
->
gc
, sñf->
x
+1, 
num
, sñf->x+£lf->
width
-2,num);

658 
vÆ
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¨gö
));

659 
num
 = 
£lf
->
x
 + 
vÆ
 * sñf->
width
 / 
	`gë_∑≥r_pswidth
(£lf->
∑≥∫um
);

660 
	`gdk_døw_löe
(
wödow
, 
£lf
->
gc
, 
num
, sñf->
y
+1,num,£lf->y+£lf->
height
-2);

662 
vÆ
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¨gö
));

663 
num
 = 
£lf
->
x
 + sñf->
width
 -

664 
vÆ
 * 
£lf
->
width
 / 
	`gë_∑≥r_pswidth
(£lf->
∑≥∫um
);

665 
	`gdk_døw_löe
(
wödow
, 
£lf
->
gc
, 
num
, sñf->
y
+1,num,£lf->y+£lf->
height
-2);

667 
vÆ
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¨gö
));

668 
num
 = 
£lf
->
y
 + 
vÆ
 * sñf->
height
 /
	`gë_∑≥r_pswidth
(£lf->
∑≥∫um
);

669 
	`gdk_døw_löe
(
wödow
, 
£lf
->
gc
, sñf->
x
+1, 
num
, sñf->x+£lf->
width
-2,num);

671 
vÆ
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¨gö
));

672 
num
 = 
£lf
->
y
 + sñf->
height
 -

673 
vÆ
 * 
£lf
->
height
 / 
	`gë_∑≥r_pswidth
(£lf->
∑≥∫um
);

674 
	`gdk_døw_löe
(
wödow
, 
£lf
->
gc
, sñf->
x
+1, 
num
, sñf->x+£lf->
width
-2,num);

676 
vÆ
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¨gö
));

677 
num
 = 
£lf
->
x
 + 
vÆ
 * sñf->
width
 / 
	`gë_∑≥r_psheight
(£lf->
∑≥∫um
);

678 
	`gdk_døw_löe
(
wödow
, 
£lf
->
gc
, 
num
, sñf->
y
+1,num,£lf->y+£lf->
height
-2);

680 
vÆ
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¨gö
));

681 
num
 = 
£lf
->
x
 + sñf->
width
 -

682 
vÆ
 * 
£lf
->
width
 / 
	`gë_∑≥r_psheight
(£lf->
∑≥∫um
);

683 
	`gdk_døw_löe
(
wödow
, 
£lf
->
gc
, 
num
, sñf->
y
+1,num,£lf->y+£lf->
height
-2);

686  
FALSE
;

687 
	}
}

696 
	$max_m¨gö
 (
size
)

698  
size
 / 2.0 - 0.5;

699 
	}
}

702 
	$∑≥r_size_ch™ge
(
GtkMíuIãm
 *
ôem
, 
DüPageLayout
 *
£lf
)

704 
gch¨
 
buf
[512];

706 
£lf
->
∑≥∫um
 = 
	`GPOINTER_TO_INT
(
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
(
ôem
), "user_data"));

707 
	`size_∑ge
(
£lf
, &£lf->
d¨ó
->
Æloˇti⁄
);

708 
	`gtk_widgë_queue_døw
(
£lf
->
d¨ó
);

710 
£lf
->
block_ch™ged
 = 
TRUE
;

711 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¨gö
),

712 
	`gë_∑≥r_tm¨gö
(
£lf
->
∑≥∫um
));

713 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¨gö
),

714 
	`gë_∑≥r_bm¨gö
(
£lf
->
∑≥∫um
));

715 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¨gö
),

716 
	`gë_∑≥r_lm¨gö
(
£lf
->
∑≥∫um
));

717 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¨gö
),

718 
	`gë_∑≥r_rm¨gö
(
£lf
->
∑≥∫um
));

720 i‡(
	`GTK_TOGGLE_BUTTON
(
£lf
->
‹õ¡_p‹åaô
)->
a˘ive
) {

721 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
tm¨gö
),

722 
	`max_m¨gö
(
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
)));

723 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
bm¨gö
),

724 
	`max_m¨gö
(
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
)));

725 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
lm¨gö
),

726 
	`max_m¨gö
(
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
)));

727 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
rm¨gö
),

728 
	`max_m¨gö
(
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
)));

730 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
tm¨gö
),

731 
	`max_m¨gö
(
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
)));

732 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
bm¨gö
),

733 
	`max_m¨gö
(
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
)));

734 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
lm¨gö
),

735 
	`max_m¨gö
(
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
)));

736 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
rm¨gö
),

737 
	`max_m¨gö
(
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
)));

739 
£lf
->
block_ch™ged
 = 
FALSE
;

741 
	`g_¢¥ötf
(
buf
, (buf), 
	`_
("%0.3gcm x %0.3gcm"),

742 
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
),

743 
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
));

744 
	`gtk_œbñ_£t
(
	`GTK_LABEL
(
£lf
->
∑≥r_œbñ
), 
buf
);

746 
	`gtk_sig«l_emô
(
	`GTK_OBJECT
(
£lf
), 
∂_sig«ls
[
CHANGED
]);

747 
	}
}

750 
	$‹õ¡_ch™ged
(
DüPageLayout
 *
£lf
)

752 
	`size_∑ge
(
£lf
, &£lf->
d¨ó
->
Æloˇti⁄
);

753 
	`gtk_widgë_queue_døw
(
£lf
->
d¨ó
);

755 i‡(
	`GTK_TOGGLE_BUTTON
(
£lf
->
‹õ¡_p‹åaô
)->
a˘ive
) {

756 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
tm¨gö
),

757 
	`max_m¨gö
(
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
)));

758 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
bm¨gö
),

759 
	`max_m¨gö
(
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
)));

760 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
lm¨gö
),

761 
	`max_m¨gö
(
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
)));

762 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
rm¨gö
),

763 
	`max_m¨gö
(
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
)));

765 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
tm¨gö
),

766 
	`max_m¨gö
(
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
)));

767 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
bm¨gö
),

768 
	`max_m¨gö
(
	`gë_∑≥r_pswidth
(
£lf
->
∑≥∫um
)));

769 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
lm¨gö
),

770 
	`max_m¨gö
(
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
)));

771 
	`dü_unô_•ö√r_£t_uµî
 (
	`DIA_UNIT_SPINNER
(
£lf
->
rm¨gö
),

772 
	`max_m¨gö
(
	`gë_∑≥r_psheight
(
£lf
->
∑≥∫um
)));

775 i‡(!
£lf
->
block_ch™ged
)

776 
	`gtk_sig«l_emô
(
	`GTK_OBJECT
(
£lf
), 
∂_sig«ls
[
CHANGED
]);

777 
	}
}

780 
	$m¨gö_ch™ged
(
DüPageLayout
 *
£lf
)

782 
	`gtk_widgë_queue_døw
(
£lf
->
d¨ó
);

783 i‡(!
£lf
->
block_ch™ged
)

784 
	`gtk_sig«l_emô
(
	`GTK_OBJECT
(
£lf
), 
∂_sig«ls
[
CHANGED
]);

785 
	}
}

788 
	$sˇÀmode_ch™ged
(
DüPageLayout
 *
£lf
)

790 i‡(
	`GTK_TOGGLE_BUTTON
(
£lf
->
fôto
)->
a˘ive
) {

791 
	`gtk_widgë_£t_£nsôive
(
£lf
->
sˇlög
, 
FALSE
);

792 
	`gtk_widgë_£t_£nsôive
(
£lf
->
fôw
, 
TRUE
);

793 
	`gtk_widgë_£t_£nsôive
(
£lf
->
fôh
, 
TRUE
);

795 
	`gtk_widgë_£t_£nsôive
(
£lf
->
sˇlög
, 
TRUE
);

796 
	`gtk_widgë_£t_£nsôive
(
£lf
->
fôw
, 
FALSE
);

797 
	`gtk_widgë_£t_£nsôive
(
£lf
->
fôh
, 
FALSE
);

799 i‡(!
£lf
->
block_ch™ged
)

800 
	`gtk_sig«l_emô
(
	`GTK_OBJECT
(
£lf
), 
∂_sig«ls
[
CHANGED
]);

801 
	}
}

804 
	$sˇÀ_ch™ged
(
DüPageLayout
 *
£lf
)

806 i‡(!
£lf
->
block_ch™ged
)

807 
	`gtk_sig«l_emô
(
	`GTK_OBJECT
(
£lf
), 
∂_sig«ls
[
CHANGED
]);

808 
	}
}

811 
	$dü_∑ge_œyout_de°roy
(
GtkObje˘
 *
obje˘
)

813 
DüPageLayout
 *
£lf
 = 
	`DIA_PAGE_LAYOUT
(
obje˘
);

815 i‡(
£lf
->
gc
) {

816 
	`gdk_gc_uƒef
(
£lf
->
gc
);

817 
£lf
->
gc
 = 
NULL
;

820 i‡(
∑ª¡_˛ass
->
de°roy
)

821 (* 
∑ª¡_˛ass
->
de°roy
)(
obje˘
);

822 
	}
}

824 #ifde‡
PAGELAYOUT_TEST


827 
	$ch™ged_sig«l
(
DüPageLayout
 *
£lf
)

829 
	`g_mesßge
("changed");

830 
	}
}

832 
	$fôt›age_sig«l
(
DüPageLayout
 *
£lf
)

834 
	`g_mesßge
("fitÅoÖage");

835 
	}
}

838 
	$maö
(
¨gc
, **
¨gv
)

840 
GtkWidgë
 *
wö
, *
∂
;

842 
	`gtk_öô
(&
¨gc
, &
¨gv
);

844 
wö
 = 
	`gtk_wödow_√w
(
GTK_WINDOW_TOPLEVEL
);

845 
	`gtk_wödow_£t_tôÀ
(
	`GTK_WINDOW
(
wö
), 
	`_
("Page Setup"));

846 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
wö
), "destroy",

847 
	`G_CALLBACK
(
gtk_maö_quô
), 
NULL
);

849 
∂
 = 
	`dü_∑ge_œyout_√w
();

850 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
∂
), 5);

851 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
wö
), 
∂
);

852 
	`gtk_widgë_show
(
∂
);

854 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
∂
), "changed",

855 
	`G_CALLBACK
(
ch™ged_sig«l
), 
NULL
);

856 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
∂
), "fittopage",

857 
	`G_CALLBACK
(
fôt›age_sig«l
), 
NULL
);

859 
	`gtk_widgë_show
(
wö
);

860 
	`gtk_maö
();

861 
	}
}

	@O:\tool\dvs50\app\diapagelayout.h

22 #i‚de‡
DIAPAGELAYOUT_H


23 
	#DIAPAGELAYOUT_H


	)

25 
	~<gtk/gtk.h
>

28 
_DüPageLayout
 
	tDüPageLayout
;

29 
GTy≥
 
dü_∑ge_œyout_gë_ty≥
 ();

30 
	#DIA_PAGE_LAYOUT
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_∑ge_œyout_gë_ty≥
(), 
DüPageLayout
)

	)

33 
	mDIA_PAGE_ORIENT_PORTRAIT
,

34 
	mDIA_PAGE_ORIENT_LANDSCAPE


35 } 
	tDüPageOrõ¡©i⁄
;

37 
GtkWidgë
 *
dü_∑ge_œyout_√w
 ();

39 c⁄° 
gch¨
 *
dü_∑ge_œyout_gë_∑≥r
 (
DüPageLayout
 *
∂
);

40 
dü_∑ge_œyout_£t_∑≥r
 (
DüPageLayout
 *
∂
,

41 c⁄° 
gch¨
 *
∑≥r
);

42 
dü_∑ge_œyout_gë_m¨gös
 (
DüPageLayout
 *
∂
,

43 
gÊﬂt
 *
tm¨gö
, gÊﬂà*
bm¨gö
,

44 
gÊﬂt
 *
lm¨gö
, gÊﬂà*
rm¨gö
);

45 
dü_∑ge_œyout_£t_m¨gös
 (
DüPageLayout
 *
∂
,

46 
gÊﬂt
 
tm¨gö
, gÊﬂà
bm¨gö
,

47 
gÊﬂt
 
lm¨gö
, gÊﬂà
rm¨gö
);

48 
DüPageOrõ¡©i⁄
 
dü_∑ge_œyout_gë_‹õ¡©i⁄
 (
DüPageLayout
 *
∂
);

49 
dü_∑ge_œyout_£t_‹õ¡©i⁄
 (
DüPageLayout
 *
∂
,

50 
DüPageOrõ¡©i⁄
 
‹õ¡
);

51 
gboﬁón
 
dü_∑ge_œyout_gë_fôto
 (
DüPageLayout
 *
£lf
);

52 
dü_∑ge_œyout_£t_fôto
 (
DüPageLayout
 *
£lf
,

53 
gboﬁón
 
fôto
);

54 
gÊﬂt
 
dü_∑ge_œyout_gë_sˇlög
 (
DüPageLayout
 *
£lf
);

55 
dü_∑ge_œyout_£t_sˇlög
 (
DüPageLayout
 *
£lf
,

56 
gÊﬂt
 
sˇlög
);

57 
dü_∑ge_œyout_gë_fô_dims
(
DüPageLayout
 *
£lf
,

58 
göt
 *
w
, göà*
h
);

59 
dü_∑ge_œyout_£t_fô_dims
(
DüPageLayout
 *
£lf
,

60 
göt
 
w
, göà
h
);

61 
dü_∑ge_œyout_£t_ch™ged
 (
DüPageLayout
 *
£lf
,

62 
gboﬁón
 
ch™ged
);

64 
dü_∑ge_œyout_gë_ef„˘ive_¨ó
 (
DüPageLayout
 *
£lf
,

65 
gÊﬂt
 *
width
,

66 
gÊﬂt
 *
height
);

69 
dü_∑ge_œyout_gë_∑≥r_size
 (c⁄° 
gch¨
 *
∑≥r
,

70 
gÊﬂt
 *
width
, gÊﬂà*
height
);

71 
dü_∑ge_œyout_gë_deÁu…_m¨gös
 (c⁄° 
gch¨
 *
∑≥r
,

72 
gÊﬂt
 *
tm¨gö
, gÊﬂà*
bm¨gö
,

73 
gÊﬂt
 *
lm¨gö
, gÊﬂà*
rm¨gö
);

	@O:\tool\dvs50\app\disp_callbacks.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<°dio.h
>

24 
	~<°rög.h
>

25 
	~<m©h.h
>

26 #ifde‡
GNOME


27 #unde‡
GTK_DISABLE_DEPRECATED


28 
	~<gnome.h
>

30 
	~<gtk/gtk.h
>

31 
	~<gdk/gdkkeysyms.h
>

33 
	~"di•œy.h
"

34 
	~"dügøm.h
"

35 
	~"toﬁ.h
"

36 
	~"öãrÁ˚.h
"

37 
	~"focus.h
"

38 
	~"obje˘_›s.h
"

39 
	~"c⁄√˘i⁄poöt_›s.h
"

40 
	~"míus.h
"

41 
	~"mesßge.h
"

42 
	~"öé.h
"

43 
	~"magnify.h
"

44 
	~"dümíu.h
"

45 
	~"¥e„ªn˚s.h
"

46 
	~"s¸ﬁl_toﬁ.h
"

47 
	~"comm™ds.h
"

48 
	~"highlight.h
"

49 
	~"ãxãdô.h
"

50 
	~"lib/∑ª¡.h
"

53 
Poöt
 
	gobje˘_míu_˛icked_poöt
;

56 
GdkEvít
 *
	mevít
;

57 
DDi•œy
 *
	mddi•
;

58 
guöt
 
	mèg
;

59 } 
	tHﬁdTimeoutD©a
;

61 
HﬁdTimeoutD©a
 
	ghﬁd_d©a
 = {
NULL
, NULL, 0};

66 
	$obje˘_míu_¥oxy
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

68 
DüMíuIãm
 *
dü_míu_ôem
;

69 
Obje˘Ch™ge
 *
obj_ch™ge
;

70 
DüObje˘
 *
obj
;

71 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

73 i‡(!
ddi•
) ;

75 
obj
 = (
DüObje˘
 *)
ddi•
->
dügøm
->
d©a
->
£À˘ed
->data;

76 
dü_míu_ôem
 = (
DüMíuIãm
 *Ë
d©a
;

79 
	`obje˘_add_upd©es
(
obj
, 
ddi•
->
dügøm
);

80 
obj_ch™ge
 = (
dü_míu_ôem
->
ˇŒback
)(
obj
, &
obje˘_míu_˛icked_poöt
,

81 
dü_míu_ôem
->
ˇŒback_d©a
);

82 
	`obje˘_add_upd©es
(
obj
, 
ddi•
->
dügøm
);

83 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
ddi•
->
dügøm
, 
obj
, 
TRUE
);

85 i‡(
obj_ch™ge
 !
NULL
) {

86 
	`undo_obje˘_ch™ge
(
ddi•
->
dügøm
, 
obj
, 
obj_ch™ge
);

88 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

90 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

92 i‡(
obj_ch™ge
 !
NULL
) {

93 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

95 
	`mesßge_w¨nög
(
	`_
("This object doesn't support Undo/Redo.\n"

97 
	`undo_˛ór
(
ddi•
->
dügøm
->
undo
);

100 
	`dügøm_Êush
(
ddi•
->
dügøm
);

101 
	}
}

104 
	$dü_míu_‰ì
(
DüMíu
 *
dü_míu
)

106 i‡(
dü_míu
->
≠p_d©a
)

107 
	`gtk_obje˘_de°roy
((
GtkObje˘
 *)
dü_míu
->
≠p_d©a
);

108 
dü_míu
->
≠p_d©a
 = 
NULL
;

109 
dü_míu
->
≠p_d©a_‰ì
 = 
NULL
;

110 
	}
}

120 
	$add_¥›îtõs_míu_ôem
 (
GtkMíu
 *
míu
, 
gboﬁón
 
£∑øt‹
)

122 
GtkWidgë
 *
míu_ôem
 = 
NULL
;

124 i‡(
£∑øt‹
) {

125 
míu_ôem
 = 
	`gtk_míu_ôem_√w
();

126 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míu_ôem
);

127 
	`gtk_widgë_show
(
míu_ôem
);

130 
míu_ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`_
("Properties..."));

131 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
míu_ôem
), "a˘iv©e", 
	`G_CALLBACK
(
dülogs_¥›îtõs_ˇŒback
), 
NULL
);

132 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míu_ôem
);

133 
	`gtk_widgë_show
(
míu_ôem
);

134 
	}
}

137 
	$¸óã_obje˘_míu
(
DüMíu
 *
dü_míu
)

139 
i
;

140 
GtkWidgë
 *
míu
;

141 
GtkWidgë
 *
míu_ôem
;

143 
míu
 = 
	`gtk_míu_√w
();

145 i‡–
dü_míu
->
tôÀ
 ) {

146 
míu_ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`gëãxt
(
dü_míu
->
tôÀ
));

147 
	`gtk_widgë_£t_£nsôive
(
míu_ôem
, 
FALSE
);

148 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míu_ôem
);

149 
	`gtk_widgë_show
(
míu_ôem
);

197 
	`add_¥›îtõs_míu_ôem
(
	`GTK_MENU
 (
míu
), 
i
 > 0);

199 
dü_míu
->
≠p_d©a
 = 
míu
;

200 
dü_míu
->
≠p_d©a_‰ì
 = 
dü_míu_‰ì
;

201 
	}
}

203 
DüMíuIãm
 
	gem±y_míu_ôems
[] = { {0, } };

204 
DüMíu
 
	gem±y_míu
 = {

205 
NULL
,

207 
em±y_míu_ôems
,

208 
NULL


212 
	$p›up_obje˘_míu
(
DDi•œy
 *
ddi•
, 
GdkEvítBuâ⁄
 *
bevít
)

214 
Dügøm
 *
dügøm
;

215 
DüObje˘
 *
obj
;

216 
GtkMíu
 *
míu
 = 
NULL
;

217 
DüMíu
 *
dü_míu
 = 
NULL
;

218 
GLi°
 *
£À˘ed_li°
;

219 
i
;

220 
num_ôems
;

222 
dügøm
 = 
ddi•
->diagram;

223 i‡(
	`g_li°_Àngth
 (
dügøm
->
d©a
->
£À˘ed
) < 1)

227 
£À˘ed_li°
 = 
dügøm
->
d©a
->
£À˘ed
;

230 i‡(
£À˘ed_li°
 =
NULL
) {

231 
	`mesßge_îr‹
("SelectedÜist is %s while selected_count is %d\n",

232 (
£À˘ed_li°
?"l⁄g":"em±y"), 
	`g_li°_Àngth
 (
dügøm
->
d©a
->
£À˘ed
));

236 
obj
 = (
DüObje˘
 *)
	`g_li°_fú°
(
£À˘ed_li°
)->
d©a
;

241 i‡–
	`g_li°_Àngth
 (
dügøm
->
d©a
->
£À˘ed
) > 1

242 || 
obj
->
›s
->
gë_obje˘_míu
 =
NULL


243 || (
obj
->
›s
->
gë_obje˘_míu
)(obj, &
obje˘_míu_˛icked_poöt
Ë=
NULL
) {

244 
dü_míu
 = &
em±y_míu
;

245 i‡(
dü_míu
->
tôÀ
 &&

246 (0 !
	`°rcmp
(
dü_míu
->
tôÀ
,
obj
->
ty≥
->
«me
))) {

247 
dü_míu
->
	`≠p_d©a_‰ì
(dia_menu);

249 i‡(
	`g_li°_Àngth
 (
dügøm
->
d©a
->
£À˘ed
) > 1)

250 
dü_míu
->
tôÀ
 = 
	`_
("Selection");

252 
dü_míu
->
tôÀ
 = 
obj
->
ty≥
->
«me
;

253 
num_ôems
 = 0;

255 
dü_míu
 = (
obj
->
›s
->
gë_obje˘_míu
)(obj, &
obje˘_míu_˛icked_poöt
);

256 
num_ôems
 = 
dü_míu
->num_items;

259 i‡(
dü_míu
->
≠p_d©a
 =
NULL
) {

260 
	`¸óã_obje˘_míu
(
dü_míu
);

263 
i
=0;i<
num_ôems
;i++) {

264 
DüMíuIãm
 *
ôem
 = &
dü_míu
->
ôems
[
i
];

265 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
ôem
->
≠p_d©a
),

266 
ôem
->
a˘ive
 & 
DIAMENU_ACTIVE
);

267 i‡(
ôem
->
a˘ive
 & 
DIAMENU_TOGGLE
) {

268 
	`g_sig«l_h™dÀrs_block_by_func
 (
	`G_OBJECT
 (
	`GTK_CHECK_MENU_ITEM
 (
ôem
->
≠p_d©a
)),

269 
	`G_CALLBACK
 (
obje˘_míu_¥oxy
), 
ôem
);

270 
	`gtk_check_míu_ôem_£t_a˘ive
 (
	`GTK_CHECK_MENU_ITEM
(
ôem
->
≠p_d©a
),

271 
ôem
->
a˘ive
 & 
DIAMENU_TOGGLE_ON
);

272 
	`g_sig«l_h™dÀrs_unblock_by_func
 (
	`G_OBJECT
 (
	`GTK_CHECK_MENU_ITEM
(
ôem
->
≠p_d©a
)),

273 
	`G_CALLBACK
 (
obje˘_míu_¥oxy
), 
ôem
);

277 
míu
 = 
	`GTK_MENU
(
dü_míu
->
≠p_d©a
);

280 
	`gtk_míu_p›up
(
míu
, 
NULL
, NULL, NULL, NULL, 
bevít
->
buâ⁄
, bevít->
time
);

281 
	}
}

283 
göt


284 
	$ddi•œy_focus_ö_evít
(
GtkWidgë
 *
widgë
, 
GdkEvítFocus
 *
evít
, 
gpoöãr
 
d©a
)

286 
DDi•œy
 *
ddi•
;

288 
	`g_ªtu∫_vÆ_if_Áû
 (
widgë
 !
NULL
, 
FALSE
);

289 
	`g_ªtu∫_vÆ_if_Áû
 (
evít
 !
NULL
, 
FALSE
);

290 
	`g_ªtu∫_vÆ_if_Áû
 (
d©a
 !
NULL
, 
FALSE
);

292 
ddi•
 = (
DDi•œy
 *)
d©a
;

294 
	`GTK_WIDGET_SET_FLAGS
(
widgë
, 
GTK_HAS_FOCUS
);

296 
	`gtk_im_c⁄ãxt_focus_ö
(
	`GTK_IM_CONTEXT
(
ddi•
->
im_c⁄ãxt
));

298  
FALSE
;

299 
	}
}

301 
göt


302 
	$ddi•œy_focus_out_evít
(
GtkWidgë
 *
widgë
, 
GdkEvítFocus
 *
evít
,
gpoöãr
 
d©a
)

304 
DDi•œy
 *
ddi•
;

305 
ªtu∫_vÆ
;

307 
	`g_ªtu∫_vÆ_if_Áû
 (
widgë
 !
NULL
, 
FALSE
);

308 
	`g_ªtu∫_vÆ_if_Áû
 (
evít
 !
NULL
, 
FALSE
);

309 
	`g_ªtu∫_vÆ_if_Áû
 (
d©a
 !
NULL
, 
FALSE
);

311 
ªtu∫_vÆ
 = 
FALSE
;

313 
ddi•
 = (
DDi•œy
 *)
d©a
;

315 
	`GTK_WIDGET_UNSET_FLAGS
 (
widgë
, 
GTK_HAS_FOCUS
);

317 
	`gtk_im_c⁄ãxt_focus_out
(
	`GTK_IM_CONTEXT
(
ddi•
->
im_c⁄ãxt
));

319  
ªtu∫_vÆ
;

320 
	}
}

323 
	$ddi•œy_ªÆize
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

325 
DDi•œy
 *
ddi•
;

327 
	`g_ªtu∫_if_Áû
(
widgë
 !
NULL
);

328 
	`g_ªtu∫_if_Áû
(
d©a
 !
NULL
);

330 
ddi•
 = (
DDi•œy
 *)
d©a
;

332 
	`gtk_im_c⁄ãxt_£t_˛õ¡_wödow
(
	`GTK_IM_CONTEXT
(
ddi•
->
im_c⁄ãxt
),

333 
	`GDK_WINDOW
(
ddi•
->
shñl
->
wödow
));

334 
	}
}

337 
	$ddi•œy_uƒólize
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

339 
DDi•œy
 *
ddi•
;

341 
	`g_ªtu∫_if_Áû
 (
widgë
 !
NULL
);

342 
	`g_ªtu∫_if_Áû
 (
d©a
 !
NULL
);

344 
ddi•
 = (
DDi•œy
 *Ë
d©a
;

346 i‡(
ddi•
->
im_c⁄ãxt
)

347 
	`gtk_im_c⁄ãxt_£t_˛õ¡_wödow
(
	`GTK_IM_CONTEXT
(
ddi•
->
im_c⁄ãxt
),

348 
	`GDK_WINDOW
(
ddi•
->
shñl
->
wödow
));

349 
	}
}

352 
	$ddi•œy_size_Æloˇã
 (
GtkWidgë
 *
widgë
,

353 
GtkAŒoˇti⁄
 *
Æloˇti⁄
,

354 
gpoöãr
 
d©a
)

356 
DDi•œy
 *
ddi•
;

358 
	`g_ªtu∫_if_Áû
 (
widgë
 !
NULL
);

359 
	`g_ªtu∫_if_Áû
 (
Æloˇti⁄
 !
NULL
);

360 
	`g_ªtu∫_if_Áû
 (
d©a
 !
NULL
);

363 
	`g_¥öt
 ("ddi•::size_Æloˇã: %d,%d -> %d,%d\n", 
Æloˇti⁄
->
width
,áŒoˇti⁄->
height
,

364 
widgë
->
Æloˇti⁄
.
width
, widgë->Æloˇti⁄.
height
);

366 
widgë
->
Æloˇti⁄
 = *allocation;

367 
ddi•
 = (
DDi•œy
 *)
d©a
;

368 
	}
}

371 
	$ddi•œy_p›up_míu
(
DDi•œy
 *
ddi•
, 
GdkEvítBuâ⁄
 *
evít
)

373 
GtkWidgë
 *
míu
;

375 
míu
 = 
	`míus_gë_di•œy_p›up
();

377 
	`gtk_míu_p›up
(
	`GTK_MENU
(
míu
), 
NULL
, NULL, NULL, NULL,

378 
evít
->
buâ⁄
,Évít->
time
);

379 
	}
}

381 
	$h™dÀ_key_evít
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
, 
guöt
 
keysym
,

382 c⁄° 
gch¨
 *
°r
, 
°æí
)

384 
DüObje˘
 *
obj
 = 
	`focus_gë_obje˘
(
focus
);

385 
Poöt
 
p
 = 
obj
->
posôi⁄
;

386 
Obje˘Ch™ge
 *
obj_ch™ge
 = 
NULL
;

387 
gboﬁón
 
modifõd
;

389 
	`obje˘_add_upd©es
(
obj
, 
ddi•
->
dügøm
);

391 
modifõd
 = (
focus
->
key_evít
)(focus, 
keysym
, 
°r
, 
°æí
,

392 &
obj_ch™ge
);

395 
p
 = 
obj
->
posôi⁄
;

396 (
obj
->
›s
->
move
)(obj,&
p
);

397 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
ddi•
->
dügøm
,
obj
,
TRUE
);

399 
	`obje˘_add_upd©es
(
obj
, 
ddi•
->
dügøm
);

401 i‡(
modifõd
) {

402 i‡(
obj_ch™ge
 !
NULL
) {

403 
	`undo_obje˘_ch™ge
(
ddi•
->
dügøm
, 
obj
, 
obj_ch™ge
);

404 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

406 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

407 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

410 
	`dügøm_Êush
(
ddi•
->
dügøm
);

411 
	}
}

415 
	$ddi•œy_im_c⁄ãxt_commô
(
GtkIMC⁄ãxt
 *
c⁄ãxt
, c⁄° 
gch¨
 *
°r
,

416 
DDi•œy
 *
ddi•
)

425 
Focus
 *
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

427 
	`ddi•œy_im_c⁄ãxt_¥ìdô_ª£t
(
ddi•
, 
focus
);

429 i‡(
focus
 !
NULL
)

430 
	`h™dÀ_key_evít
(
ddi•
, 
focus
, 0, 
°r
, 
	`g_utf8_°æí
(str,-1));

431 
	}
}

434 
	$ddi•œy_im_c⁄ãxt_¥ìdô_ch™ged
(
GtkIMC⁄ãxt
 *
c⁄ãxt
,

435 
DDi•œy
 *
ddi•
)

437 
göt
 
curs‹_pos
;

438 
Focus
 *
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

440 
	`ddi•œy_im_c⁄ãxt_¥ìdô_ª£t
(
ddi•
, 
focus
);

442 
	`gtk_im_c⁄ãxt_gë_¥ìdô_°rög
(
c⁄ãxt
, &
ddi•
->
¥ìdô_°rög
,

443 &
ddi•
->
¥ìdô_©ås
, &
curs‹_pos
);

444 i‡(
ddi•
->
¥ìdô_°rög
 !
NULL
) {

445 i‡(
focus
 !
NULL
) {

446 
	`h™dÀ_key_evít
(
ddi•
, 
focus
, 0, ddi•->
¥ìdô_°rög
,

447 
	`g_utf8_°æí
(
ddi•
->
¥ìdô_°rög
,-1));

449 
	`ddi•œy_im_c⁄ãxt_¥ìdô_ª£t
(
ddi•
, 
focus
);

452 
	}
}

455 
	$_s¸ﬁl_∑ge
 (
DDi•œy
 *
ddi•
, 
Dúe˘i⁄
 
dú
)

457 
Poöt
 
dñè
 = {0, 0};

459 
dú
) {

460 
DIR_LEFT
 :

461 
dñè
.
x
 = 
ddi•
->
dügøm
->
d©a
->
∑≥r
.
width
 * ddi•->dügøm->d©a->∑≥r.
sˇlög
;

463 
DIR_RIGHT
 :

464 
dñè
.
x
 = -
ddi•
->
dügøm
->
d©a
->
∑≥r
.
width
 * ddi•->dügøm->d©a->∑≥r.
sˇlög
;

466 
DIR_UP
 :

467 
dñè
.
y
 = -
ddi•
->
dügøm
->
d©a
->
∑≥r
.
height
 * ddi•->dügøm->d©a->∑≥r.
sˇlög
;

469 
DIR_DOWN
 :

470 
dñè
.
y
 = 
ddi•
->
dügøm
->
d©a
->
∑≥r
.
height
 * ddi•->dügøm->d©a->∑≥r.
sˇlög
;

473 
	`ddi•œy_s¸ﬁl
(
ddi•
, &
dñè
);

474 
	`ddi•œy_Êush
(
ddi•
);

475 
	}
}

478 
	$_s¸ﬁl_°ï
 (
DDi•œy
 *
ddi•
, 
guöt
 
keyvÆ
)

480 
keyvÆ
) {

481 
GDK_Up
 :

482 
	`ddi•œy_s¸ﬁl_up
(
ddi•
);

483 
	`ddi•œy_Êush
(
ddi•
);

485 
GDK_Down
:

486 
	`ddi•œy_s¸ﬁl_down
(
ddi•
);

487 
	`ddi•œy_Êush
(
ddi•
);

489 
GDK_Le·
:

490 
	`ddi•œy_s¸ﬁl_À·
(
ddi•
);

491 
	`ddi•œy_Êush
(
ddi•
);

493 
GDK_Right
:

494 
	`ddi•œy_s¸ﬁl_right
(
ddi•
);

495 
	`ddi•œy_Êush
(
ddi•
);

498 
	`g_as£π_nŸ_ªached
 ();

500 
	}
}

505 
	$hﬁd_ªmove_h™dÀr
()

507 i‡(
hﬁd_d©a
.
èg
 != 0) {

508 
	`g_sour˚_ªmove
(
hﬁd_d©a
.
èg
);

509 
hﬁd_d©a
.
èg
 = 0;

510 
	`gdk_evít_‰ì
(
hﬁd_d©a
.
evít
);

512 
	}
}

520 
gboﬁón


521 
	$hﬁd_timeout_h™dÀr
(
gpoöãr
 
d©a
)

523 i‡(
a˘ive_toﬁ
->
buâ⁄_hﬁd_func
)

524 (*
a˘ive_toﬁ
->
buâ⁄_hﬁd_func
Ë◊˘ive_toﬁ, (
GdkEvítBuâ⁄
 *)(
hﬁd_d©a
.
evít
), hﬁd_d©a.
ddi•
);

525 
	`hﬁd_ªmove_h™dÀr
();

526  
FALSE
;

527 
	}
}

532 
göt


533 
	$ddi•œy_ˇnvas_evíts
 (
GtkWidgë
 *
ˇnvas
,

534 
GdkEvít
 *
evít
,

535 
DDi•œy
 *
ddi•
)

537 
GdkEvítExpo£
 *
ìvít
;

538 
GdkEvítMŸi⁄
 *
mevít
;

539 
GdkEvítBuâ⁄
 *
bevít
;

540 
GdkEvítKey
 *
kevít
;

541 
GdkEvítS¸ﬁl
 *
£vít
;

542 
göt
 
tx
, 
ty
;

543 
GdkModifõrTy≥
 
tmask
;

544 
guöt
 
°©e
 = 0;

545 
Focus
 *
focus
;

546 
DüObje˘
 *
obj
;

547 
Re˘™gÀ
 *
visibÀ
;

548 
Poöt
 
middÀ
;

549 
ªtu∫_vÆ
;

550 
key_h™dÀd
;

551 
width
, 
height
;

552 
√w_size
;

553 
im_c⁄ãxt_u£d
;

554 
gboﬁón
 
movög
 = 
FALSE
;

556 
ªtu∫_vÆ
 = 
FALSE
;

558 i‡(!
ˇnvas
->
wödow
)

559  
FALSE
;

561 
evít
->
ty≥
)

563 
GDK_EXPOSE
:

564 
ìvít
 = (
GdkEvítExpo£
 *Ë
evít
;

565 
	`ddi•œy_add_di•œy_¨ó
(
ddi•
,

566 
ìvít
->
¨ó
.
x
,Éevít->¨ó.
y
,

567 
ìvít
->
¨ó
.
x
 +Éevít->¨ó.
width
,

568 
ìvít
->
¨ó
.
y
 +Éevít->¨ó.
height
);

569 
	`ddi•œy_Êush
(
ddi•
);

572 
GDK_SCROLL
:

573 
£vít
 = (
GdkEvítS¸ﬁl
 *Ë
evít
;

575 
£vít
->
dúe˘i⁄
)

577 
GDK_SCROLL_UP
:

578 i‡(
£vít
->
°©e
 & 
GDK_SHIFT_MASK
)

579 
	`ddi•œy_s¸ﬁl_À·
(
ddi•
);

580 i‡(
£vít
->
°©e
 & 
GDK_CONTROL_MASK
) {

581 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
, ()
£vít
->
x
, ()£vít->
y
, &
middÀ
.x, &middle.y);

583 
	`ddi•œy_zoom_˚¡îed
(
ddi•
, &
middÀ
, 1.090508);

586 
	`ddi•œy_s¸ﬁl_up
(
ddi•
);

588 
GDK_SCROLL_DOWN
:

589 i‡(
£vít
->
°©e
 & 
GDK_SHIFT_MASK
)

590 
	`ddi•œy_s¸ﬁl_right
(
ddi•
);

591 i‡(
£vít
->
°©e
 & 
GDK_CONTROL_MASK
) {

592 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
, ()
£vít
->
x
, ()£vít->
y
, &
middÀ
.x, &middle.y);

594 
	`ddi•œy_zoom_˚¡îed
(
ddi•
, &
middÀ
, 0.917004);

597 
	`ddi•œy_s¸ﬁl_down
(
ddi•
);

599 
GDK_SCROLL_LEFT
:

600 
	`ddi•œy_s¸ﬁl_À·
(
ddi•
);

602 
GDK_SCROLL_RIGHT
:

603 
	`ddi•œy_s¸ﬁl_right
(
ddi•
);

608 
	`ddi•œy_Êush
 (
ddi•
);

611 
GDK_CONFIGURE
:

612 i‡(
ddi•
->
ªndîî
 !
NULL
) {

613 
width
 = 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
);

614 
height
 = 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
);

615 
√w_size
 = ((
width
 !
ddi•
->
ˇnvas
->
Æloˇti⁄
.width) ||

616 (
height
 !
ddi•
->
ˇnvas
->
Æloˇti⁄
.height));

618 
√w_size
 = 
TRUE
;

620 i‡(
√w_size
) {

621 
	`ddi•œy_ªsize_ˇnvas
(
ddi•
,

622 
ddi•
->
ˇnvas
->
Æloˇti⁄
.
width
,

623 
ddi•
->
ˇnvas
->
Æloˇti⁄
.
height
);

624 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

629 i‡(
	`is_öãgøãd_ui
 () == 0)

630 
	`di•œy_£t_a˘ive
(
ddi•
);

633 
GDK_FOCUS_CHANGE
: {

634 
GdkEvítFocus
 *
focus
 = (GdkEvítFocus*)
evít
;

635 
	`hﬁd_ªmove_h™dÀr
();

636 i‡(
focus
->
ö
) {

637 
	`di•œy_£t_a˘ive
(
ddi•
);

638 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

642 
GDK_2BUTTON_PRESS
:

643 
	`di•œy_£t_a˘ive
(
ddi•
);

644 
	`hﬁd_ªmove_h™dÀr
();

645 
bevít
 = (
GdkEvítBuâ⁄
 *Ë
evít
;

646 
°©e
 = 
bevít
->state;

648 
bevít
->
buâ⁄
)

651 i‡(
å™sõ¡_toﬁ
)

653 i‡(
a˘ive_toﬁ
->
doubÀ_˛ick_func
)

654 (*
a˘ive_toﬁ
->
doubÀ_˛ick_func
Ë◊˘ive_toﬁ, 
bevít
, 
ddi•
);

668 
GDK_BUTTON_PRESS
:

669 
	`di•œy_£t_a˘ive
(
ddi•
);

670 
bevít
 = (
GdkEvítBuâ⁄
 *Ë
evít
;

671 
°©e
 = 
bevít
->state;

673 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
,

674 ()
bevít
->
x
, ()bevít->
y
,

675 &
obje˘_míu_˛icked_poöt
.
x
,

676 &
obje˘_míu_˛icked_poöt
.
y
);

678 
bevít
->
buâ⁄
)

681 i‡(
å™sõ¡_toﬁ
)

684 
movög
 = 
TRUE
;

685 
	`gtk_widgë_gøb_focus
(
ˇnvas
);

686 i‡(
a˘ive_toﬁ
->
buâ⁄_¥ess_func
)

687 (*
a˘ive_toﬁ
->
buâ⁄_¥ess_func
Ë◊˘ive_toﬁ, 
bevít
, 
ddi•
);

692 
hﬁd_d©a
.
evít
 = 
	`gdk_evít_c›y
(event);

693 
hﬁd_d©a
.
ddi•
 = ddisp;

694 
hﬁd_d©a
.
èg
 = 
	`g_timeout_add
(1000, 
hﬁd_timeout_h™dÀr
, 
NULL
);

698 i‡(
ddi•
->
míu_b¨
 =
NULL
 && !
	`is_öãgøãd_ui
()) {

699 
	`p›up_obje˘_míu
(
ddi•
, 
bevít
);

701 i‡(!
å™sõ¡_toﬁ
) {

702 
	`gtk_widgë_gøb_focus
(
ˇnvas
);

703 
å™sõ¡_toﬁ
 = 
	`¸óã_s¸ﬁl_toﬁ
();

704 (*
å™sõ¡_toﬁ
->
buâ⁄_¥ess_func
Ë—ønsõ¡_toﬁ, 
bevít
, 
ddi•
);

709 i‡(
å™sõ¡_toﬁ
)

711 i‡(
ddi•
->
míu_b¨
 =
NULL
) {

712 i‡(
bevít
->
°©e
 & 
GDK_CONTROL_MASK
 || 
	`is_öãgøãd_ui
 ()) {

714 
	`p›up_obje˘_míu
(
ddi•
, 
bevít
);

717 
	`ddi•œy_p›up_míu
(
ddi•
, 
bevít
);

721 
	`p›up_obje˘_míu
(
ddi•
, 
bevít
);

729 
GDK_BUTTON_RELEASE
:

730 
	`di•œy_£t_a˘ive
(
ddi•
);

731 
bevít
 = (
GdkEvítBuâ⁄
 *Ë
evít
;

732 
°©e
 = 
bevít
->state;

734 
bevít
->
buâ⁄
)

737 i‡(
movög
)

738 
movög
 = 
FALSE
;

739 i‡(
a˘ive_toﬁ
->
buâ⁄_ªÀa£_func
)

740 (*
a˘ive_toﬁ
->
buâ⁄_ªÀa£_func
) (active_tool,

741 
bevít
, 
ddi•
);

743 
	`hﬁd_ªmove_h™dÀr
();

747 i‡(
å™sõ¡_toﬁ
) {

748 (*
å™sõ¡_toﬁ
->
buâ⁄_ªÀa£_func
) (transient_tool,

749 
bevít
, 
ddi•
);

751 
	`toﬁ_‰ì
(
å™sõ¡_toﬁ
);

752 
å™sõ¡_toﬁ
 = 
NULL
;

764 
GDK_MOTION_NOTIFY
:

766 
	`gdk_wödow_gë_poöãr
 (
ˇnvas
->
wödow
, &
tx
, &
ty
, &
tmask
);

767 
	`hﬁd_ªmove_h™dÀr
();

769 
mevít
 = (
GdkEvítMŸi⁄
 *Ë
evít
;

770 
°©e
 = 
mevít
->state;

772 i‡(
mevít
->
is_höt
) {

773 
mevít
->
x
 = 
tx
;

774 
mevít
->
y
 = 
ty
;

775 
mevít
->
°©e
 = 
tmask
;

776 
mevít
->
is_höt
 = 
FALSE
;

778 i‡(
å™sõ¡_toﬁ
 && (*å™sõ¡_toﬁ->
mŸi⁄_func
))

779 (*
å™sõ¡_toﬁ
->
mŸi⁄_func
Ë—ønsõ¡_toﬁ, 
mevít
, 
ddi•
);

780 i‡(
a˘ive_toﬁ
->
mŸi⁄_func
)

781 (*
a˘ive_toﬁ
->
mŸi⁄_func
Ë◊˘ive_toﬁ, 
mevít
, 
ddi•
);

784 
GDK_KEY_PRESS
:

785 i‡(
movög
)

787 
	`di•œy_£t_a˘ive
(
ddi•
);

788 
kevít
 = (
GdkEvítKey
 *)
evít
;

789 
°©e
 = 
kevít
->state;

790 
key_h™dÀd
 = 
FALSE
;

791 
im_c⁄ãxt_u£d
 = 
FALSE
;

793 
	`¥ötf
("Key i≈uà%d i¿°©ê%d\n", 
kevít
->
keyvÆ
, 
	`ãxãdô_mode
(
ddi•
));

795 
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

796 i‡(
focus
 !
NULL
) {

798 
obj
 = 
	`focus_gë_obje˘
(
focus
);

799 i‡(
	`dügøm_is_£À˘ed
(
ddi•
->
dügøm
, 
obj
)) {

801 i‡(!
	`gtk_im_c⁄ãxt_fûãr_key¥ess
(

802 
	`GTK_IM_CONTEXT
(
ddi•
->
im_c⁄ãxt
), 
kevít
)) {

804 
kevít
->
keyvÆ
) {

805 
GDK_Tab
:

806 
focus
 = 
	`ãxãdô_move_focus
(
ddi•
, focus,

807 (
°©e
 & 
GDK_SHIFT_MASK
) == 0);

808 
obj
 = 
	`focus_gë_obje˘
(
focus
);

810 
GDK_Esˇ≥
:

811 
	`ãxãdô_dó˘iv©e_focus
();

812 
	`toﬁ_ª£t
 ();

813 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

817 
	`h™dÀ_key_evít
(
ddi•
, 
focus
, 
kevít
->
keyvÆ
,

818 
kevít
->
°rög
, kevít->
Àngth
);

820 
	`dügøm_Êush
(
ddi•
->
dügøm
);

823 
ªtu∫_vÆ
 = 
key_h™dÀd
 = 
im_c⁄ãxt_u£d
 = 
TRUE
;

830 i‡(!
key_h™dÀd
 && (
°©e
 & (
GDK_CONTROL_MASK
 | 
GDK_MOD1_MASK
))) {

832 i‡(!
key_h™dÀd
) {

835 
ªtu∫_vÆ
 = 
TRUE
;

837 
kevít
->
keyvÆ
) {

838 
GDK_Home
 :

840 
	`ddi•œy_£t_‹igo
(
ddi•
, ddi•->
dügøm
->
d©a
->
exã¡s
.
À·
, ddi•->dügøm->d©a->exã¡s.
t›
);

841 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

842 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

844 
GDK_End
 :

846 
visibÀ
 = &
ddi•
->visible;

847 
	`ddi•œy_£t_‹igo
(
ddi•
,

848 
ddi•
->
dügøm
->
d©a
->
exã¡s
.
right
 - (
visibÀ
->righà- visibÀ->
À·
),

849 
ddi•
->
dügøm
->
d©a
->
exã¡s
.
bŸtom
 - (
visibÀ
->bŸtom - visibÀ->
t›
));

850 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

851 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

853 
GDK_Page_Up
 :

854 
	`_s¸ﬁl_∑ge
 (
ddi•
, !(
°©e
 & 
GDK_CONTROL_MASK
Ë? 
DIR_UP
 : 
DIR_LEFT
);

856 
GDK_Page_Down
 :

857 
	`_s¸ﬁl_∑ge
 (
ddi•
, !(
°©e
 & 
GDK_CONTROL_MASK
Ë? 
DIR_DOWN
 : 
DIR_RIGHT
);

859 
GDK_Up
:

860 
GDK_Down
:

861 
GDK_Le·
:

862 
GDK_Right
:

863 i‡(
	`g_li°_Àngth
 (
ddi•
->
dügøm
->
d©a
->
£À˘ed
) > 0) {

864 
Dügøm
 *
dü
 = 
ddi•
->
dügøm
;

865 
GLi°
 *
obje˘s
 = 
dü
->
d©a
->
£À˘ed
;

866 
Dúe˘i⁄
 
dú
 = 
GDK_Up
 =
kevít
->
keyvÆ
 ? 
DIR_UP
 :

867 
GDK_Down
 =
kevít
->
keyvÆ
 ? 
DIR_DOWN
 :

868 
GDK_Right
 =
kevít
->
keyvÆ
 ? 
DIR_RIGHT
 : 
DIR_LEFT
;

869 
	`obje˘_add_upd©es_li°
(
obje˘s
, 
dü
);

870 
	`obje˘_li°_nudge
(
obje˘s
, 
dü
, 
dú
,

872 
	`ddi•œy_u¡ønsf‹m_Àngth
 (
ddi•
, (
°©e
 & 
GDK_SHIFT_MASK
) ? 10 : 1));

873 
	`dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
dü
);

874 
	`obje˘_add_upd©es_li°
(
obje˘s
, 
dü
);

875 
	`dügøm_modifõd
(
dü
);

876 
	`dügøm_Êush
(
dü
);

878 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

880 
	`_s¸ﬁl_°ï
 (
ddi•
, 
kevít
->
keyvÆ
);

883 
GDK_KP_Add
:

884 
GDK_∂us
:

885 
visibÀ
 = &
ddi•
->visible;

886 
middÀ
.
x
 = 
visibÀ
->
À·
*0.5 + visibÀ->
right
*0.5;

887 
middÀ
.
y
 = 
visibÀ
->
t›
*0.5 + visibÀ->
bŸtom
*0.5;

889 
	`ddi•œy_zoom
(
ddi•
, &
middÀ
, 
M_SQRT2
);

891 
GDK_KP_Subåa˘
:

892 
GDK_möus
:

893 
visibÀ
 = &
ddi•
->visible;

894 
middÀ
.
x
 = 
visibÀ
->
À·
*0.5 + visibÀ->
right
*0.5;

895 
middÀ
.
y
 = 
visibÀ
->
t›
*0.5 + visibÀ->
bŸtom
*0.5;

897 
	`ddi•œy_zoom
(
ddi•
, &
middÀ
, 
M_SQRT1_2
);

899 
GDK_Shi·_L
:

900 
GDK_Shi·_R
:

901 i‡(
a˘ive_toﬁ
->
ty≥
 =
MAGNIFY_TOOL
)

902 
	`£t_zoom_out
(
a˘ive_toﬁ
);

904 
GDK_Esˇ≥
:

905 
	`võw_unfuŒs¸ìn
();

907 
GDK_F2
:

908 
GDK_Rëu∫
:

909 
	`gtk_a˘i⁄_a˘iv©e
 (
	`míus_gë_a˘i⁄
 ("ToolsTextedit"));

912 i‡(
kevít
->
°rög
 && kevít->
keyvÆ
 == ' ') {

913 
	`toﬁ_£À˘_f‹mî
();

914 } i‡((
kevít
->
°©e
 & (
GDK_MOD1_MASK
|
GDK_CONTROL_MASK
)) == 0 &&

915 
kevít
->
Àngth
 != 0) {

917 #ifde‡
NEW_TEXT_EDIT


918 
	`modify_edô_fú°_ãxt
(
ddi•
);

919 
ªtu∫_vÆ
 = 
FALSE
;

925 i‡(!
im_c⁄ãxt_u£d
)

926 
	`gtk_im_c⁄ãxt_ª£t
(
	`GTK_IM_CONTEXT
(
ddi•
->
im_c⁄ãxt
));

930 
GDK_KEY_RELEASE
:

931 
kevít
 = (
GdkEvítKey
 *Ë
evít
;

932 
°©e
 = 
kevít
->state;

933 i‡(
	`gtk_im_c⁄ãxt_fûãr_key¥ess
(
	`GTK_IM_CONTEXT
(
ddi•
->
im_c⁄ãxt
),

934 
kevít
)) {

935 
ªtu∫_vÆ
 = 
TRUE
;

937 
kevít
->
keyvÆ
) {

938 
GDK_Shi·_L
:

939 
GDK_Shi·_R
:

940 i‡(
a˘ive_toﬁ
->
ty≥
 =
MAGNIFY_TOOL
)

941 
	`£t_zoom_ö
(
a˘ive_toﬁ
);

953  
ªtu∫_vÆ
;

954 
	}
}

956 
göt


957 
	$ddi•œy_hsb_upd©e
 (
GtkAdju°mít
 *
adju°mít
,

958 
DDi•œy
 *
ddi•
)

960 
	`ddi•œy_£t_‹igo
(
ddi•
, 
adju°mít
->
vÆue
, ddi•->
‹igo
.
y
);

961 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

962 
	`ddi•œy_Êush
(
ddi•
);

963  
FALSE
;

964 
	}
}

966 
göt


967 
	$ddi•œy_vsb_upd©e
 (
GtkAdju°mít
 *
adju°mít
,

968 
DDi•œy
 *
ddi•
)

970 
	`ddi•œy_£t_‹igo
(
ddi•
, ddi•->
‹igo
.
x
, 
adju°mít
->
vÆue
);

971 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

972 
	`ddi•œy_Êush
(
ddi•
);

973  
FALSE
;

974 
	}
}

976 
göt


977 
	$ddi•œy_dñëe
 (
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
, 
gpoöãr
 
d©a
)

979 
DDi•œy
 *
ddi•
;

981 
ddi•
 = (
DDi•œy
 *)
d©a
;

983 
	`ddi•œy_˛o£
(
ddi•
);

984  
TRUE
;

985 
	}
}

988 
	$ddi•œy_de°roy
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

990 
DDi•œy
 *
ddi•
;

992 
ddi•
 = (
DDi•œy
 *Ë
d©a
;

994 
	`ddi•œy_ªÆly_de°roy
(
ddi•
);

995 
	}
}

998 
DüObje˘
 *

999 
	$ddi•œy_dr›_obje˘
(
DDi•œy
 *
ddi•
, 
göt
 
x
, göà
y
, 
DüObje˘Ty≥
 *
Ÿy≥
,

1000 
gpoöãr
 
u£r_d©a
)

1002 
Poöt
 
dr›poöt
;

1003 
Poöt
 
dr›poöt_‹ig
;

1004 
H™dÀ
 *
h™dÀ1
, *
h™dÀ2
;

1005 
DüObje˘
 *
obj
, *
p_obj
;

1006 
GLi°
 *
li°
;

1007 
ªÆ
 
˛ick_di°™˚
;

1009 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
, 
x
, 
y
, &
dr›poöt
.x, &droppoint.y);

1012 
dr›poöt_‹ig
 = 
dr›poöt
;

1014 
	`¢≠_to_grid
(
ddi•
, &
dr›poöt
.
x
, &dr›poöt.
y
);

1016 
obj
 = 
	`dü_obje˘_deÁu…_¸óã
 (
Ÿy≥
, &
dr›poöt
,

1017 
u£r_d©a
,

1018 &
h™dÀ1
, &
h™dÀ2
);

1020 i‡(!
obj
)

1021  
NULL
;

1023 
˛ick_di°™˚
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 3.0);

1029 
p_obj
 = 
	`dügøm_föd_˛icked_obje˘
(
ddi•
->
dügøm
, &
dr›poöt_‹ig
,

1030 
˛ick_di°™˚
);

1032 i‡(
p_obj
 && 
	`obje˘_Êags_£t
’_obj, 
DIA_OBJECT_CAN_PARENT
))

1035 
Re˘™gÀ
 
p_ext
, 
c_ext
;

1036 
ªÆ
 
∑ª¡_height
, 
chûd_height
, 
∑ª¡_width
, 
chûd_width
;

1037 
ªÆ
 
vadju°
 = 0.0, 
hadju°
 = 0.0;

1038 
Poöt
 
√w_pos
;

1040 
obj
->
∑ª¡
 = 
p_obj
;

1041 
p_obj
->
chûdªn
 = 
	`g_li°_≠≥nd
’_obj->chûdªn, 
obj
);

1048 
	`∑ª¡_h™dÀ_exã¡s
(
p_obj
, &
p_ext
);

1049 
	`∑ª¡_h™dÀ_exã¡s
(
obj
, &
c_ext
);

1051 
∑ª¡_height
 = 
p_ext
.
bŸtom
 -Ö_ext.
t›
;

1052 
chûd_height
 = 
c_ext
.
bŸtom
 - c_ext.
t›
;

1054 
∑ª¡_width
 = 
p_ext
.
right
 -Ö_ext.
À·
;

1055 
chûd_width
 = 
c_ext
.
right
 - c_ext.
À·
;

1059 
c_ext
.
À·
 = 
dr›poöt_‹ig
.
x
 - (
obj
->
posôi⁄
.x - c_ext.left);

1060 
c_ext
.
t›
 = 
dr›poöt_‹ig
.
y
 - (
obj
->
posôi⁄
.y - c_ext.top);

1061 
c_ext
.
right
 = c_ext.
À·
 + 
chûd_width
;

1062 
c_ext
.
bŸtom
 = c_ext.
t›
 + 
chûd_height
;

1064 i‡(
c_ext
.
À·
 < 
p_ext
.left) {

1065 
hadju°
 = 
p_ext
.
À·
 - 
c_ext
.left;

1066 } i‡(
c_ext
.
right
 > 
p_ext
.right) {

1067 
hadju°
 = 
p_ext
.
right
 - 
c_ext
.right;

1069 i‡(
c_ext
.
t›
 < 
p_ext
.top) {

1070 
vadju°
 = 
p_ext
.
t›
 - 
c_ext
.top;

1071 } i‡(
c_ext
.
bŸtom
 > 
p_ext
.bottom) {

1072 
vadju°
 = 
p_ext
.
bŸtom
 - 
c_ext
.bottom;

1075 i‡(
chûd_width
 > 
∑ª¡_width
 ||

1076 
chûd_height
 > 
∑ª¡_height
) {

1077 
	`mesßge_îr‹
(
	`_
("The object you dropped cannot fit into itsÖarent. \nEitherÉxpandÅheÖarent object, or dropÅhe objectÉlsewhere."));

1078 
obj
->
∑ª¡
->
chûdªn
 = 
	`g_li°_ªmove
(obj->parent->children, obj);

1079 
obj
->
›s
->
	`de°roy
 (obj);

1080  
NULL
;

1083 i‡(
hadju°
 || 
vadju°
) {

1084 
√w_pos
.
x
 = 
dr›poöt
.x + 
hadju°
;

1085 
√w_pos
.
y
 = 
dr›poöt
.y + 
vadju°
;

1086 
obj
->
›s
->
	`move
(obj, &
√w_pos
);

1090 
	`dügøm_add_obje˘
(
ddi•
->
dügøm
, 
obj
);

1091 
	`dügøm_ªmove_Æl_£À˘ed
(
ddi•
->
dügøm
, 
TRUE
);

1092 
	`dügøm_£À˘
(
ddi•
->
dügøm
, 
obj
);

1093 
obj
->
›s
->
	`£À˘f
(obj, &
dr›poöt
, 
ddi•
->
ªndîî
);

1094 
	`ãxãdô_a˘iv©e_obje˘
(
ddi•
, 
obj
, 
NULL
);

1097 i‡((
h™dÀ1
 !
NULL
) &&

1098 (
h™dÀ1
->
c⁄√˘_ty≥
 !
HANDLE_NONCONNECTABLE
)) {

1099 
	`obje˘_c⁄√˘_di•œy
(
ddi•
, 
obj
, 
h™dÀ1
, 
FALSE
);

1101 
	`obje˘_add_upd©es
(
obj
, 
ddi•
->
dügøm
);

1102 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

1103 
	`dügøm_Êush
(
ddi•
->
dügøm
);

1105 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
obj
);

1106 
	`undo_ö£π_obje˘s
(
ddi•
->
dügøm
, 
li°
, 1);

1107 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

1109 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

1110 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

1111 i‡(
¥efs
.
ª£t_toﬁs_a·î_¸óã
)

1112 
	`toﬁ_ª£t
();

1113  
obj
;

1114 
	}
}

	@O:\tool\dvs50\app\disp_callbacks.h

18 #i‚de‡
DISP_CALLBACKS_H


19 
	#DISP_CALLBACKS_H


	)

21 
	~"di•œy.h
"

23 
	#CANVAS_EVENT_MASK
 \

24 
GDK_EXPOSURE_MASK
 | 
GDK_POINTER_MOTION_MASK
 | \

25 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON_PRESS_MASK
 | \

26 
GDK_BUTTON_RELEASE_MASK
 | 
GDK_STRUCTURE_MASK
 | \

27 
GDK_ENTER_NOTIFY_MASK
 | 
GDK_KEY_PRESS_MASK
 | \

28 
GDK_KEY_RELEASE_MASK


	)

30 
göt
 
ddi•œy_focus_ö_evít
 (
GtkWidgë
 *
widgë
, 
GdkEvítFocus
 *
evít
,

31 
gpoöãr
 
d©a
);

32 
göt
 
ddi•œy_focus_out_evít
 (
GtkWidgë
 *
widgë
, 
GdkEvítFocus
 *
evít
,

33 
gpoöãr
 
d©a
);

34 
ddi•œy_ªÆize
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
);

35 
ddi•œy_uƒólize
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
);

36 
ddi•œy_size_Æloˇã
 (
GtkWidgë
 *
widgë
, 
GtkAŒoˇti⁄
 *
Æloˇti⁄
,

37 
gpoöãr
 
d©a
);

39 
göt
 
ddi•œy_ˇnvas_evíts
 (
GtkWidgë
 *, 
GdkEvít
 *, 
DDi•œy
 *
ddi•
);

40 
ddi•œy_p›up_míu
(
DDi•œy
 *
ddi•
, 
GdkEvítBuâ⁄
 *
evít
);

41 
göt
 
ddi•œy_hsb_upd©e
 (
GtkAdju°mít
 *
adju°mít
, 
DDi•œy
 *
ddi•
);

42 
göt
 
ddi•œy_vsb_upd©e
 (
GtkAdju°mít
 *
adju°mít
, 
DDi•œy
 *
ddi•
);

43 
göt
 
ddi•œy_dñëe
 (
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
, 
gpoöãr
 
d©a
);

44 
ddi•œy_de°roy
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
);

46 
DüObje˘
 *
ddi•œy_dr›_obje˘
(
DDi•œy
 *
ddi•
, 
göt
 
x
, göà
y
, 
DüObje˘Ty≥
 *
Ÿy≥
,

47 
gpoöãr
 
u£r_d©a
);

48 
ddi•œy_im_c⁄ãxt_commô
(
GtkIMC⁄ãxt
 *
c⁄ãxt
, c⁄° 
gch¨
 *
°r
,

49 
DDi•œy
 *
ddi•
);

50 
ddi•œy_im_c⁄ãxt_¥ìdô_ch™ged
(
GtkIMC⁄ãxt
 *
c⁄ãxt
,

51 
DDi•œy
 *
ddi•
);

	@O:\tool\dvs50\app\display.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<°rög.h
>

24 
	~<°dio.h
>

25 
	~<m©h.h
>

27 #ifde‡
GNOME


28 #unde‡
GTK_DISABLE_DEPRECATED


29 
	~<gnome.h
>

32 
	~<gdk/gdkkeysyms.h
>

34 
	~"öé.h
"

36 
	~"di•œy.h
"

37 
	~"group.h
"

38 
	~"öãrÁ˚.h
"

39 
	~"focus.h
"

40 
	~"cﬁ‹.h
"

41 
	~"obje˘.h
"

42 
	~"h™dÀ_›s.h
"

43 
	~"c⁄√˘i⁄poöt_›s.h
"

44 
	~"míus.h
"

45 
	~"cut_n_∑°e.h
"

46 
	~"mesßge.h
"

47 
	~"¥e„ªn˚s.h
"

48 
	~"≠p_¥ocs.h
"

49 
	~"œyî_dülog.h
"

50 
	~"lﬂd_ßve.h
"

51 
	~"dü-¥›s.h
"

52 
	~"ªndî_gdk.h
"

53 
	~"düå™sf‹m.h
"

55 
GHashTabÀ
 *
	gdi•œy_ht
 = 
NULL
;

56 
GdkCurs‹
 *
	gcuºít_curs‹
 = 
NULL
;

58 
GdkCurs‹
 *
	gdeÁu…_curs‹
 = 
NULL
;

60 
DDi•œy
 *
	ga˘ive_di•œy
 = 
NULL
;

63 
	s_IRe˘™gÀ
 {

64 
	mt›
, 
	mbŸtom
;

65 
	mÀ·
,
	mright
;

66 } 
	tIRe˘™gÀ
;

68 
guöt
 
di•œy_hash
(
DDi•œy
 *
ddi•
);

71 
	$upd©e_zoom_°©us
(
DDi•œy
 *
ddi•
)

73 
gch¨
* 
zoom_ãxt
;

75 i‡(
	`is_öãgøãd_ui
 ())

77 
zoom_ãxt
 = 
	`g_°rdup_¥ötf
("%.0f%%",

78 
ddi•
->
zoom_Á˘‹
 * 100.0 / 
DDISPLAY_NORMAL_ZOOM
);

80 
	`öãgøãd_ui_toﬁb¨_£t_zoom_ãxt
 (
ddi•
->
comm⁄_toﬁb¨
, 
zoom_ãxt
);

84 
GtkWidgë
 *
zoomcombo
;

85 
zoom_ãxt
 = 
	`g_°rdup_¥ötf
("%.1f%%",

86 
ddi•
->
zoom_Á˘‹
 * 100.0 / 
DDISPLAY_NORMAL_ZOOM
);

87 
zoomcombo
 = 
ddi•
->
zoom_°©us
;

88 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
 (
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
(
zoomcombo
), "user_data")),

89 
zoom_ãxt
);

92 
	`g_‰ì
(
zoom_ãxt
);

93 
	}
}

96 
	$£À˘i⁄_ch™ged
 (
Dügøm
* 
dü
, 
n
, 
DDi•œy
* 
ddi•
)

98 
GtkSètusb¨
 *
°©usb¨
;

99 
guöt
 
c⁄ãxt_id
;

102 i‡(
	`g_¶i°_Àngth
(
dü
->
di•œys
) < 1)

105 
°©usb¨
 = 
	`GTK_STATUSBAR
 (
ddi•
->
modifõd_°©us
);

106 
c⁄ãxt_id
 = 
	`gtk_°©usb¨_gë_c⁄ãxt_id
 (
°©usb¨
, "Selection");

108 i‡(
n
 > 1)

110 
gch¨
 *
msg
;

115 
msg
 = 
	`g_°rdup_¥ötf
 (
	`ngëãxt
 ("Sñe˘i⁄ o‡%d obje˘", "Sñe˘i⁄ o‡%d obje˘s", 
n
),Ç);

116 
	`gtk_°©usb¨_p›
 (
°©usb¨
, 
c⁄ãxt_id
);

117 
	`gtk_°©usb¨_push
 (
°©usb¨
, 
c⁄ãxt_id
, 
msg
);

118 
	`g_‰ì
 (
msg
);

120 i‡(
n
 == 1)

123 
DüObje˘
 *
obje˘
 = (DüObje˘ *)
ddi•
->
dügøm
->
d©a
->
£À˘ed
->data;

124 
gch¨
 *
«me
 = 
	`obje˘_gë_di•œy«me
 (
obje˘
);

125 
gch¨
 *
msg
 = 
	`g_°rdup_¥ötf
 (
	`_
("Sñe˘ed '%s'"), 
«me
);

127 
	`gtk_°©usb¨_p›
 (
°©usb¨
, 
c⁄ãxt_id
);

128 
	`gtk_°©usb¨_push
 (
°©usb¨
, 
c⁄ãxt_id
, 
msg
);

130 
	`g_‰ì
 (
«me
);

131 
	`g_‰ì
 (
msg
);

135 
	`gtk_°©usb¨_p›
 (
°©usb¨
, 
c⁄ãxt_id
);

138 
	`ddi•œy_do_upd©e_míu_£nsôivôy
 (
ddi•
);

139 
	}
}

142 
	$≠≥nd_im_míu
 (
DDi•œy
* 
ddi•
, 
GtkA˘i⁄
* 
a˘i⁄
)

144 
GSLi°
 *
¥oxõs
;

145 
GtkWidgë
 *
im_míu
;

148 
¥oxõs
 = 
	`gtk_a˘i⁄_gë_¥oxõs
 (
a˘i⁄
);

149 
¥oxõs
) {

150 i‡(
	`GTK_IS_MENU_ITEM
 (
¥oxõs
->
d©a
)) {

151 
im_míu
 = 
	`gtk_míu_√w
 ();

156 
	`gtk_im_mu…ic⁄ãxt_≠≥nd_míuôems
 (

157 
	`GTK_IM_MULTICONTEXT
(
ddi•
->
im_c⁄ãxt
),

158 
	`GTK_MENU_SHELL
(
im_míu
));

159 
	`gtk_míu_ôem_£t_submíu
 (
	`GTK_MENU_ITEM
(
¥oxõs
->
d©a
), 
im_míu
);

160 
	`gtk_widgë_show
 (
	`GTK_WIDGET
 (
¥oxõs
->
d©a
));

161 
	`gtk_widgë_show
 (
	`GTK_WIDGET
 (
im_míu
));

163 
¥oxõs
 =Öroxõs->
√xt
;

165 
	}
}

172 
	$öôülize_di•œy_widgës
(
DDi•œy
 *
ddi•
)

174 
GtkA˘i⁄
* 
im_míu_ôem
;

175 
gboﬁón
 
öput_mëhods_d⁄e
 = 
FALSE
;

176 
Dügøm
 *
dü
 = 
ddi•
->
dügøm
;

177 
gch¨
 *
fûíame
;

181 
ddi•
->
im_c⁄ãxt
 = 
	`gtk_im_mu…ic⁄ãxt_√w
();

182 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
ddi•
->
im_c⁄ãxt
), "commit",

183 
	`G_CALLBACK
 (
ddi•œy_im_c⁄ãxt_commô
), 
ddi•
);

184 
ddi•
->
¥ìdô_°rög
 = 
NULL
;

185 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
ddi•
->
im_c⁄ãxt
), "preedit_changed",

186 
	`G_CALLBACK
 (
ddi•œy_im_c⁄ãxt_¥ìdô_ch™ged
),

187 
ddi•
);

188 
ddi•
->
¥ìdô_©ås
 = 
NULL
;

190 
fûíame
 = 
	`°ºchr
(
dü
->fûíame, 
G_DIR_SEPARATOR
);

191 i‡(
fûíame
==
NULL
) {

192 
fûíame
 = 
dü
->filename;

194 
fûíame
++;

196 
	`¸óã_di•œy_shñl
(
ddi•
, 
¥efs
.
√w_võw
.
width
,Öªfs.√w_võw.
height
,

197 
fûíame
, 
¥efs
.
√w_võw
.
u£_míu_b¨
, !
	`≠p_is_embedded
());

199 
	`ddi•œy_upd©e_°©usb¨
 (
ddi•
);

201 
	`ddi•œy_£t_‹igo
(
ddi•
, ddi•->
visibÀ
.
À·
, ddi•->visibÀ.
t›
);

202 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

203 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

205 i‡(!
di•œy_ht
)

206 
di•œy_ht
 = 
	`g_hash_èbÀ_√w
 ((
GHashFunc
Ë
di•œy_hash
, 
NULL
);

208 i‡(!
	`≠p_is_embedded
())

209 
	`ddi•œy_£t_curs‹
(
ddi•
, 
cuºít_curs‹
);

211 
	`g_hash_èbÀ_ö£π
 (
di•œy_ht
, 
ddi•
->
shñl
, ddisp);

212 
	`g_hash_èbÀ_ö£π
 (
di•œy_ht
, 
ddi•
->
ˇnvas
, ddisp);

214 i‡(!
öput_mëhods_d⁄e
) {

215 
im_míu_ôem
 = 
	`míus_gë_a˘i⁄
 ("InputMethods");

216 
	`g_as£π
 (
im_míu_ôem
);

217 
	`≠≥nd_im_míu
 (
ddi•
, 
im_míu_ôem
);

218 
öput_mëhods_d⁄e
 = 
TRUE
;

221 i‡(
ddi•
->
míu_b¨
) {

222 
im_míu_ôem
 = 
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
ddi•
->
a˘i⁄s
, "InputMethods");

223 
	`g_as£π
 (
im_míu_ôem
);

224 
	`≠≥nd_im_míu
 (
ddi•
, 
im_míu_ôem
);

226 
	}
}

237 
DDi•œy
 *

238 
	$c›y_di•œy
(
DDi•œy
 *
‹ig_ddi•
)

240 
DDi•œy
 *
ddi•
;

241 
Dügøm
 *
dü
 = 
‹ig_ddi•
->
dügøm
;

243 
ddi•
 = 
	`g_√w0
(
DDi•œy
,1);

245 
ddi•
->
dügøm
 = 
‹ig_ddi•
->diagram;

247 
	`g_obje˘_ªf
(
dü
);

249 
ddi•
->
grid
 = 
‹ig_ddi•
->grid;

251 
ddi•
->
show_cx_±s
 = 
‹ig_ddi•
->show_cx_pts;

254 
ddi•
->
autos¸ﬁl
 = 
‹ig_ddi•
->autoscroll;

255 
ddi•
->
maöpoöt_mag√tism
 = 
‹ig_ddi•
->mainpoint_magnetism;

257 
ddi•
->
Ø_ªndîî
 = 
‹ig_ddi•
->aa_renderer;

259 
ddi•
->
upd©e_¨ós
 = 
‹ig_ddi•
->update_areas;

260 
ddi•
->
di•œy_¨ós
 = 
‹ig_ddi•
->display_areas;

261 
ddi•
->
upd©e_id
 = 0;

263 
	`dügøm_add_ddi•œy
(
dü
, 
ddi•
);

264 
	`g_sig«l_c⁄√˘
 (
dü
, "£À˘i⁄_ch™ged", 
	`G_CALLBACK
(
£À˘i⁄_ch™ged
), 
ddi•
);

265 
ddi•
->
‹igo
 = 
‹ig_ddi•
->origo;

266 
ddi•
->
zoom_Á˘‹
 = 
‹ig_ddi•
->zoom_factor;

267 
ddi•
->
visibÀ
 = 
‹ig_ddi•
->visible;

269 
	`öôülize_di•œy_widgës
(
ddi•
);

270  
ddi•
;

271 
	}
}

278 
DDi•œy
 *

279 
	$√w_di•œy
(
Dügøm
 *
dü
)

281 
DDi•œy
 *
ddi•
;

282 
Re˘™gÀ
 
visibÀ
;

284 
ddi•
 = 
	`g_√w0
(
DDi•œy
,1);

286 
ddi•
->
dügøm
 = 
dü
;

288 
	`g_obje˘_ªf
(
dü
);

290 
ddi•
->
grid
.
visibÀ
 = 
¥efs
.grid.visible;

291 
ddi•
->
grid
.
¢≠
 = 
¥efs
.grid.snap;

293 
ddi•
->
show_cx_±s
 = 
¥efs
.show_cx_pts;

295 
ddi•
->
autos¸ﬁl
 = 
TRUE
;

296 
ddi•
->
maöpoöt_mag√tism
 = 
¥efs
.
¢≠_obje˘
;

298 
ddi•
->
Ø_ªndîî
 = 
¥efs
.
võw_™tüli£d
;

300 
ddi•
->
upd©e_¨ós
 = 
NULL
;

301 
ddi•
->
di•œy_¨ós
 = 
NULL
;

302 
ddi•
->
upd©e_id
 = 0;

304 
	`dügøm_add_ddi•œy
(
dü
, 
ddi•
);

305 
	`g_sig«l_c⁄√˘
 (
dü
, "£À˘i⁄_ch™ged", 
	`G_CALLBACK
(
£À˘i⁄_ch™ged
), 
ddi•
);

306 
ddi•
->
‹igo
.
x
 = 0.0;

307 
ddi•
->
‹igo
.
y
 = 0.0;

308 
ddi•
->
zoom_Á˘‹
 = 
¥efs
.
√w_võw
.
zoom
/100.0*
DDISPLAY_NORMAL_ZOOM
;

309 i‡((
ddi•
->
dügøm
Ë&& (ddi•->dügøm->
d©a
)) {

310 
Re˘™gÀ
 *
exã¡s
 = &
ddi•
->
dügøm
->
d©a
->extents;

312 
visibÀ
.
À·
 = 
exã¡s
->left;

313 
visibÀ
.
t›
 = 
exã¡s
->top;

315 
visibÀ
.
À·
 = 0.0;

316 
visibÀ
.
t›
 = 0.0;

318 
visibÀ
.
right
 = visibÀ.
À·
 + 
¥efs
.
√w_võw
.
width
/
ddi•
->
zoom_Á˘‹
;

319 
visibÀ
.
bŸtom
 = visibÀ.
t›
 + 
¥efs
.
√w_võw
.
height
/
ddi•
->
zoom_Á˘‹
;

321 
ddi•
->
visibÀ
 = visible;

323 
	`öôülize_di•œy_widgës
(
ddi•
);

324  
ddi•
;

325 
	}
}

327 
guöt


328 
	$di•œy_hash
(
DDi•œy
 *
ddi•
)

330  (
gul⁄g
Ë
ddi•
;

331 
	}
}

334 
	$ddi•œy_å™sf‹m_co‹ds_doubÀ
(
DDi•œy
 *
ddi•
,

335 
co‹d
 
x
, co‹d 
y
,

336 *
xi
, *
yi
)

338 
Re˘™gÀ
 *
visibÀ
 = &
ddi•
->visible;

339 
width
 = 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
);

340 
height
 = 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
);

342 *
xi
 = (
x
 - 
visibÀ
->
À·
Ë* (
ªÆ
)
width
 / (visibÀ->
right
 - visible->left);

343 *
yi
 = (
y
 - 
visibÀ
->
t›
Ë* (
ªÆ
)
height
 / (visibÀ->
bŸtom
 - visible->top);

344 
	}
}

348 
	$ddi•œy_å™sf‹m_co‹ds
(
DDi•œy
 *
ddi•
,

349 
co‹d
 
x
, co‹d 
y
,

350 *
xi
, *
yi
)

352 
Re˘™gÀ
 *
visibÀ
 = &
ddi•
->visible;

353 
width
 = 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
);

354 
height
 = 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
);

356 *
xi
 = 
	`ROUND
 ( (
x
 - 
visibÀ
->
À·
Ë* (
ªÆ
)
width
 /

357 (
visibÀ
->
right
 - visibÀ->
À·
) );

358 *
yi
 = 
	`ROUND
 ( (
y
 - 
visibÀ
->
t›
Ë* (
ªÆ
)
height
 /

359 (
visibÀ
->
bŸtom
 - visibÀ->
t›
) );

360 
	}
}

363 
ªÆ


364 
	$ddi•œy_å™sf‹m_Àngth
(
DDi•œy
 *
ddi•
, 
ªÆ
 
Àn
)

366  
Àn
 * 
ddi•
->
zoom_Á˘‹
;

367 
	}
}

370 
ªÆ


371 
	$ddi•œy_u¡ønsf‹m_Àngth
(
DDi•œy
 *
ddi•
, 
ªÆ
 
Àn
)

373  
Àn
 / 
ddi•
->
zoom_Á˘‹
;

374 
	}
}

378 
	$ddi•œy_u¡ønsf‹m_co‹ds
(
DDi•œy
 *
ddi•
,

379 
xi
, 
yi
,

380 
co‹d
 *
x
, co‹d *
y
)

382 
Re˘™gÀ
 *
visibÀ
 = &
ddi•
->visible;

383 
width
 = 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
);

384 
height
 = 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
);

386 *
x
 = 
visibÀ
->
À·
 + 
xi
*(visibÀ->
right
 - visibÀ->À·Ë/ (
ªÆ
)
width
;

387 *
y
 = 
visibÀ
->
t›
 + 
yi
*(visibÀ->
bŸtom
 - visibÀ->t›Ë/ (
ªÆ
)
height
;

388 
	}
}

392 
	$ddi•œy_add_upd©e_pixñs
(
DDi•œy
 *
ddi•
, 
Poöt
 *
poöt
,

393 
pixñ_width
, 
pixñ_height
)

395 
Re˘™gÀ
 
ª˘
;

396 
ªÆ
 
size_x
, 
size_y
;

398 
size_x
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 
pixñ_width
+1);

399 
size_y
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 
pixñ_height
+1);

401 
ª˘
.
À·
 = 
poöt
->
x
 - 
size_x
/2.0;

402 
ª˘
.
t›
 = 
poöt
->
y
 - 
size_y
/2.0;

403 
ª˘
.
right
 = 
poöt
->
x
 + 
size_x
/2.0;

404 
ª˘
.
bŸtom
 = 
poöt
->
y
 + 
size_y
/2.0;

406 
	`ddi•œy_add_upd©e
(
ddi•
, &
ª˘
);

407 
	}
}

411 
	$ddi•œy_‰ì_di•œy_¨ós
(
DDi•œy
 *
ddi•
)

413 
GSLi°
 *
l
;

414 
l
 = 
ddi•
->
di•œy_¨ós
;

415 
l
!=
NULL
) {

416 
	`g_‰ì
(
l
->
d©a
);

417 
l
 = 
	`g_¶i°_√xt
(l);

419 
	`g_¶i°_‰ì
(
ddi•
->
di•œy_¨ós
);

420 
ddi•
->
di•œy_¨ós
 = 
NULL
;

421 
	}
}

425 
	$ddi•œy_‰ì_upd©e_¨ós
(
DDi•œy
 *
ddi•
)

427 
GSLi°
 *
l
;

428 
l
 = 
ddi•
->
upd©e_¨ós
;

429 
l
!=
NULL
) {

430 
	`g_‰ì
(
l
->
d©a
);

431 
l
 = 
	`g_¶i°_√xt
(l);

433 
	`g_¶i°_‰ì
(
ddi•
->
upd©e_¨ós
);

434 
ddi•
->
upd©e_¨ós
 = 
NULL
;

435 
	}
}

441 
	$ddi•œy_add_upd©e_Æl
(
DDi•œy
 *
ddi•
)

443 i‡(
ddi•
->
upd©e_¨ós
 !
NULL
) {

444 
	`ddi•œy_‰ì_upd©e_¨ós
(
ddi•
);

446 i‡(
ddi•
->
di•œy_¨ós
 !
NULL
) {

447 
	`ddi•œy_‰ì_di•œy_¨ós
(
ddi•
);

449 
	`ddi•œy_add_upd©e
(
ddi•
, &ddi•->
visibÀ
);

450 
	}
}

455 
	$ddi•œy_add_upd©e_wôh_b‹dî
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
ª˘
,

456 
pixñ_b‹dî
)

458 
Re˘™gÀ
 
r
;

459 
ªÆ
 
size
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 
pixñ_b‹dî
+1);

461 
r
.
À·
 = 
ª˘
->À·-
size
;

462 
r
.
t›
 = 
ª˘
->t›-
size
;

463 
r
.
right
 = 
ª˘
->right+
size
;

464 
r
.
bŸtom
 = 
ª˘
->bŸtom+
size
;

466 
	`ddi•œy_add_upd©e
(
ddi•
, &
r
);

467 
	}
}

470 
	$ddi•œy_add_upd©e
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
ª˘
)

472 
Re˘™gÀ
 *
r
;

473 
t›
,
bŸtom
,
À·
,
right
;

474 
Re˘™gÀ
 *
visibÀ
;

475 
width
, 
height
;

477 i‡(!
ddi•
->
ªndîî
)

479 
width
 = 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
);

480 
height
 = 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
);

482 i‡(!
	`ª˘™gÀ_öãr£˘s
(
ª˘
, &
ddi•
->
visibÀ
))

486 i‡(
ddi•
->
upd©e_¨ós
==
NULL
) {

487 
r
 = 
	`g_√w
(
Re˘™gÀ
,1);

488 *
r
 = *
ª˘
;

489 
	`ª˘™gÀ_öãr£˘i⁄
(
r
, &
ddi•
->
visibÀ
);

490 
ddi•
->
upd©e_¨ós
 = 
	`g_¶i°_¥ïíd
(ddi•->upd©e_¨ós, 
r
);

492 
r
 = (
Re˘™gÀ
 *Ë
ddi•
->
upd©e_¨ós
->
d©a
;

493 
	`ª˘™gÀ_uni⁄
(
r
, 
ª˘
);

494 
	`ª˘™gÀ_öãr£˘i⁄
(
r
, &
ddi•
->
visibÀ
);

497 
visibÀ
 = &
ddi•
->visible;

498 
À·
 = 
	`Êo‹
–(
r
->À· - 
visibÀ
->À·Ë* (
ªÆ
)
width
 /

499 (
visibÀ
->
right
 - visibÀ->
À·
) ) - 1;

500 
t›
 = 
	`Êo‹
–(
r
->t› - 
visibÀ
->t›Ë* (
ªÆ
)
height
 /

501 (
visibÀ
->
bŸtom
 - visibÀ->
t›
) ) - 1;

502 
right
 = 
	`˚û
–(
r
->righà- 
visibÀ
->
À·
Ë* (
ªÆ
)
width
 /

503 (
visibÀ
->
right
 - visibÀ->
À·
) ) + 1;

504 
bŸtom
 = 
	`˚û
–(
r
->bŸtom - 
visibÀ
->
t›
Ë* (
ªÆ
)
height
 /

505 (
visibÀ
->
bŸtom
 - visibÀ->
t›
) ) + 1;

507 
	`ddi•œy_add_di•œy_¨ó
(
ddi•
,

508 
À·
, 
t›
,

509 
right
, 
bŸtom
);

510 
	}
}

513 
	$ddi•œy_add_di•œy_¨ó
(
DDi•œy
 *
ddi•
,

514 
À·
, 
t›
,

515 
right
, 
bŸtom
)

517 
IRe˘™gÀ
 *
r
;

519 i‡(!
ddi•
->
ªndîî
)

521 i‡(
À·
 < 0)

522 
À·
 = 0;

523 i‡(
t›
 < 0)

524 
t›
 = 0;

525 i‡(
right
 > 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
))

526 
right
 = 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
);

527 i‡(
bŸtom
 > 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
))

528 
bŸtom
 = 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
);

534 i‡(
ddi•
->
di•œy_¨ós
==
NULL
) {

535 
r
 = 
	`g_√w
(
IRe˘™gÀ
,1);

536 
r
->
t›
 =Å›;Ñ->
bŸtom
 = bottom;

537 
r
->
À·
 =Üe·;Ñ->
right
 =Ñight;

538 
ddi•
->
di•œy_¨ós
 = 
	`g_¶i°_¥ïíd
(ddi•->di•œy_¨ós, 
r
);

540 
r
 = (
IRe˘™gÀ
 *Ë
ddi•
->
di•œy_¨ós
->
d©a
;

542 
r
->
t›
 = 
	`MIN
(Ñ->top,Åop );

543 
r
->
bŸtom
 = 
	`MAX
(Ñ->bottom, bottom );

544 
r
->
À·
 = 
	`MIN
(Ñ->left,Üeft );

545 
r
->
right
 = 
	`MAX
(Ñ->right,Ñight );

547 
	}
}

549 
gboﬁón


550 
	$ddi•œy_upd©e_h™dÀr
(
DDi•œy
 *
ddi•
)

552 
GSLi°
 *
l
;

553 
IRe˘™gÀ
 *
ú
;

554 
Re˘™gÀ
 *
r
, 
tŸª˘
;

555 
DüI¡îa˘iveRídîîI¡îÁ˚
 *
ªndîî
;

558 
ªndîî
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ddi•
->renderer);

561 
l
 = 
ddi•
->
upd©e_¨ós
;

562 i‡(
l
 !
NULL
)

564 
tŸª˘
 = *(
Re˘™gÀ
 *Ë
l
->
d©a
;

566 
	`g_ªtu∫_vÆ_if_Áû
 ( 
ªndîî
->
˛ù_ªgi⁄_˛ór
 !
NULL


567 && 
ªndîî
->
˛ù_ªgi⁄_add_ª˘
 !
NULL
, 
FALSE
);

569 
ªndîî
->
	`˛ù_ªgi⁄_˛ór
 (
ddi•
->renderer);

571 
l
!=
NULL
) {

572 
r
 = (
Re˘™gÀ
 *Ë
l
->
d©a
;

574 
	`ª˘™gÀ_uni⁄
(&
tŸª˘
, 
r
);

575 
ªndîî
->
	`˛ù_ªgi⁄_add_ª˘
 (
ddi•
->ªndîî, 
r
);

577 
l
 = 
	`g_¶i°_√xt
(l);

580 
	`ddi•œy_‰ì_upd©e_¨ós
(
ddi•
);

582 
tŸª˘
.
À·
 -= 0.1;

583 
tŸª˘
.
right
 += 0.1;

584 
tŸª˘
.
t›
 -= 0.1;

585 
tŸª˘
.
bŸtom
 += 0.1;

587 
	`ddi•œy_ªndî_pixm≠
(
ddi•
, &
tŸª˘
);

590 
l
 = 
ddi•
->
di•œy_¨ós
;

591 
l
!=
NULL
) {

592 
ú
 = (
IRe˘™gÀ
 *Ë
l
->
d©a
;

594 
	`g_ªtu∫_vÆ_if_Áû
 (
ªndîî
->
c›y_to_wödow
, 
FALSE
);

595 
ªndîî
->
	`c›y_to_wödow
(
ddi•
->renderer,

596 
ddi•
->
ˇnvas
->
wödow
,

597 
ú
->
À·
, ir->
t›
,

598 
ú
->
right
 - ir->
À·
, ir->
bŸtom
 - ir->
t›
);

600 
l
 = 
	`g_¶i°_√xt
(l);

603 
	`ddi•œy_‰ì_di•œy_¨ós
(
ddi•
);

605 
ddi•
->
upd©e_id
 = 0;

607  
FALSE
;

608 
	}
}

611 
	$ddi•œy_Êush
(
DDi•œy
 *
ddi•
)

614 i‡(!
ddi•
->
upd©e_id
)

615 
ddi•
->
upd©e_id
 = 
	`g_idÀ_add_fuŒ
 (
G_PRIORITY_DEFAULT_IDLE
, (
GSour˚Func
)
ddi•œy_upd©e_h™dÀr
, ddi•, 
NULL
);

616 
	}
}

619 
	$ddi•œy_obj_ªndî
(
DüObje˘
 *
obj
, 
DüRídîî
 *
ªndîî
,

620 
a˘ive_œyî
,

621 
gpoöãr
 
d©a
)

623 
DDi•œy
 *
ddi•
 = (DDi•œy *)
d©a
;

624 
i
;

626 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_obje˘
‘ídîî, 
obj
);

627 i‡(
ddi•
->
show_cx_±s
 &&

628 
obj
->
∑ª¡_œyî
 !
NULL
 && obj->∑ª¡_œyî->
c⁄√˘abÀ
) {

629 
i
=0;i<
obj
->
num_c⁄√˘i⁄s
;i++) {

630 
	`c⁄√˘i⁄poöt_døw
(
obj
->
c⁄√˘i⁄s
[
i
], 
ddi•
);

633 
	}
}

636 
	$ddi•œy_ªndî_pixm≠
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
upd©e
)

638 
GLi°
 *
li°
;

639 
DüObje˘
 *
obj
;

640 
i
;

641 
DüI¡îa˘iveRídîîI¡îÁ˚
 *
ªndîî
;

642 #ifde‡
TRACES


643 
GTimî
 *
timî
;

646 i‡(
ddi•
->
ªndîî
==
NULL
) {

647 
	`¥ötf
("ERROR! Renderer was NULL!!\n");

651 
ªndîî
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ddi•
->renderer);

654 
	`g_ªtu∫_if_Áû
 (
ªndîî
->
fûl_pixñ_ª˘
 !
NULL
);

655 
	`DIA_RENDERER_GET_CLASS
(
ddi•
->
ªndîî
)->
	`begö_ªndî
(ddisp->renderer);

656 
ªndîî
->
	`fûl_pixñ_ª˘
 (
ddi•
->renderer,

658 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
),

659 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
),

660 &
ddi•
->
dügøm
->
d©a
->
bg_cﬁ‹
);

663 
	`grid_døw
(
ddi•
, 
upd©e
);

664 
	`∑gebªak_døw
(
ddi•
, 
upd©e
);

666 #ifde‡
TRACES


667 
timî
 = 
	`g_timî_√w
();

669 
	`d©a_ªndî
(
ddi•
->
dügøm
->
d©a
, ddi•->
ªndîî
, 
upd©e
,

670 
ddi•œy_obj_ªndî
, (
gpoöãr
Ë
ddi•
);

671 #ifde‡
TRACES


672 
	`g_¥öt
 ("d©a_ªndî(%g%%Ëtook %g sec⁄ds\n", 
ddi•
->
zoom_Á˘‹
 * 5.0, 
	`g_timî_ñ≠£d
 (
timî
, 
NULL
));

673 
	`g_timî_de°roy
 (
timî
);

676 
li°
 = 
ddi•
->
dügøm
->
d©a
->
£À˘ed
;

677 
li°
!=
NULL
) {

678 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

680 
i
=0;i<
obj
->
num_h™dÀs
;i++) {

681 
	`h™dÀ_døw
(
obj
->
h™dÀs
[
i
], 
ddi•
);

683 
li°
 = 
	`g_li°_√xt
(list);

685 
	`DIA_RENDERER_GET_CLASS
(
ddi•
->
ªndîî
)->
	`íd_ªndî
(ddisp->renderer);

686 
	}
}

689 
	$ddi•œy_upd©e_s¸ﬁlb¨s
(
DDi•œy
 *
ddi•
)

691 
Re˘™gÀ
 *
exã¡s
 = &
ddi•
->
dügøm
->
d©a
->extents;

692 
Re˘™gÀ
 *
visibÀ
 = &
ddi•
->visible;

693 
GtkAdju°mít
 *
hsbd©a
, *
vsbd©a
;

695 
hsbd©a
 = 
ddi•
->hsbdata;

697 
hsbd©a
->
lowî
 = 
	`MIN
(
exã¡s
->
À·
, 
visibÀ
->left);

698 
hsbd©a
->
uµî
 = 
	`MAX
(
exã¡s
->
right
, 
visibÀ
->right);

699 
hsbd©a
->
∑ge_size
 = 
visibÀ
->
right
 - visibÀ->
À·
 - 0.0001;

701 
hsbd©a
->
∑ge_ö¸emít
 = (
visibÀ
->
right
 - visibÀ->
À·
) / 2.0;

702 
hsbd©a
->
°ï_ö¸emít
 = (
visibÀ
->
right
 - visibÀ->
À·
) / 10.0;

703 
hsbd©a
->
vÆue
 = 
visibÀ
->
À·
;

705 
	`g_sig«l_emô_by_«me
 (
	`G_OBJECT
 (
ddi•
->
hsbd©a
), "changed");

708 
vsbd©a
 = 
ddi•
->vsbdata;

709 
vsbd©a
->
lowî
 = 
	`MIN
(
exã¡s
->
t›
, 
visibÀ
->top);

710 
vsbd©a
->
uµî
 = 
	`MAX
(
exã¡s
->
bŸtom
, 
visibÀ
->bottom);

711 
vsbd©a
->
∑ge_size
 = 
visibÀ
->
bŸtom
 - visibÀ->
t›
 - 0.00001;

713 
vsbd©a
->
∑ge_ö¸emít
 = (
visibÀ
->
bŸtom
 - visibÀ->
t›
) / 2.0;

714 
vsbd©a
->
°ï_ö¸emít
 = (
visibÀ
->
bŸtom
 - visibÀ->
t›
) / 10.0;

715 
vsbd©a
->
vÆue
 = 
visibÀ
->
t›
;

717 
	`g_sig«l_emô_by_«me
 (
	`G_OBJECT
 (
ddi•
->
vsbd©a
), "changed");

718 
	}
}

721 
	$ddi•œy_£t_‹igo
(
DDi•œy
 *
ddi•
, 
co‹d
 
x
, co‹d 
y
)

723 
Re˘™gÀ
 *
exã¡s
 = &
ddi•
->
dügøm
->
d©a
->extents;

724 
Re˘™gÀ
 *
visibÀ
 = &
ddi•
->visible;

725 
width
, 
height
;

728 
ddi•
->
‹igo
.
x
 = x;

729 
ddi•
->
‹igo
.
y
 = y;

731 i‡(
ddi•
->
zoom_Á˘‹
<
DDISPLAY_MIN_ZOOM
)

732 
ddi•
->
zoom_Á˘‹
 = 
DDISPLAY_MIN_ZOOM
;

734 i‡(
ddi•
->
zoom_Á˘‹
 > 
DDISPLAY_MAX_ZOOM
)

735 
ddi•
->
zoom_Á˘‹
 = 
DDISPLAY_MAX_ZOOM
;

737 
width
 = 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
);

738 
height
 = 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
);

740 
visibÀ
->
À·
 = 
ddi•
->
‹igo
.
x
;

741 
visibÀ
->
t›
 = 
ddi•
->
‹igo
.
y
;

742 
visibÀ
->
right
 = 
ddi•
->
‹igo
.
x
 + 
	`ddi•œy_u¡ønsf‹m_Àngth
(ddi•, 
width
);

743 
visibÀ
->
bŸtom
 = 
ddi•
->
‹igo
.
y
 + 
	`ddi•œy_u¡ønsf‹m_Àngth
(ddi•, 
height
);

745 
	`gtk_ruÀr_£t_ønge
 (
	`GTK_RULER
 (
ddi•
->
hruÀ
),

746 
visibÀ
->
À·
,

747 
visibÀ
->
right
,

749 
	`MAX
(
exã¡s
->
right
, 
visibÀ
->right) );

750 
	`gtk_ruÀr_£t_ønge
 (
	`GTK_RULER
 (
ddi•
->
vruÀ
),

751 
visibÀ
->
t›
,

752 
visibÀ
->
bŸtom
,

754 
	`MAX
(
exã¡s
->
bŸtom
, 
visibÀ
->bottom) );

755 
	}
}

758 
	$ddi•œy_zoom
(
DDi•œy
 *
ddi•
, 
Poöt
 *
poöt
, 
ªÆ
 
magnify
)

760 
Re˘™gÀ
 *
visibÀ
;

761 
ªÆ
 
width
, 
height
, 
ﬁd_zoom
;

763 
visibÀ
 = &
ddi•
->visible;

765 i‡((
ddi•
->
zoom_Á˘‹
 <
DDISPLAY_MIN_ZOOM
Ë&& (
magnify
<=1.0))

767 i‡((
ddi•
->
zoom_Á˘‹
 >
DDISPLAY_MAX_ZOOM
Ë&& (
magnify
>=1.0))

770 
ﬁd_zoom
 = 
ddi•
->
zoom_Á˘‹
;

771 
ddi•
->
zoom_Á˘‹
 = 
ﬁd_zoom
 * 
magnify
;

774 i‡(
ddi•
->
zoom_Á˘‹
 < 
DDISPLAY_MIN_ZOOM
)

775 
ddi•
->
zoom_Á˘‹
 = 
DDISPLAY_MIN_ZOOM
;

776 i‡(
ddi•
->
zoom_Á˘‹
 > 
DDISPLAY_MAX_ZOOM
)

777 
ddi•
->
zoom_Á˘‹
 = 
DDISPLAY_MAX_ZOOM
;

780 
magnify
 = 
ddi•
->
zoom_Á˘‹
 / 
ﬁd_zoom
;

781 
width
 = (
visibÀ
->
right
 - visibÀ->
À·
)/
magnify
;

782 
height
 = (
visibÀ
->
bŸtom
 - visibÀ->
t›
)/
magnify
;

785 
	`ddi•œy_£t_‹igo
(
ddi•
, 
poöt
->
x
 - 
width
/2.0,Öoöt->
y
 - 
height
/2.0);

787 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

788 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

789 
	`ddi•œy_Êush
(
ddi•
);

791 
	`upd©e_zoom_°©us
 (
ddi•
);

792 
	}
}

801 
	$ddi•œy_zoom_˚¡îed
(
DDi•œy
 *
ddi•
, 
Poöt
 *
poöt
, 
ªÆ
 
magnify
)

803 
Re˘™gÀ
 *
visibÀ
;

804 
ªÆ
 
width
, 
height
;

806 
ªÆ
 
rx
,
ry
;

808 i‡((
ddi•
->
zoom_Á˘‹
 <
DDISPLAY_MIN_ZOOM
Ë&& (
magnify
<=1.0))

810 i‡((
ddi•
->
zoom_Á˘‹
 >
DDISPLAY_MAX_ZOOM
Ë&& (
magnify
>=1.0))

813 
visibÀ
 = &
ddi•
->visible;

816 
rx
 = (
poöt
->
x
-
visibÀ
->
À·
)/(visibÀ->
right
 - visible->left);

817 
ry
 = (
poöt
->
y
-
visibÀ
->
t›
)/(visibÀ->
bŸtom
 - visible->top);

819 
width
 = (
visibÀ
->
right
 - visibÀ->
À·
)/
magnify
;

820 
height
 = (
visibÀ
->
bŸtom
 - visibÀ->
t›
)/
magnify
;

822 
ddi•
->
zoom_Á˘‹
 *
magnify
;

825 
	`ddi•œy_£t_‹igo
(
ddi•
, 
poöt
->
x
-(
width
*
rx
),poöt->
y
-(
height
*
ry
));

827 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

828 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

829 
	`ddi•œy_Êush
(
ddi•
);

831 
	`upd©e_zoom_°©us
 (
ddi•
);

832 
	}
}

837 
	$ddi•œy_£t_¢≠_to_grid
(
DDi•œy
 *
ddi•
, 
gboﬁón
 
¢≠
)

839 
GtkToggÀA˘i⁄
 *
¢≠_to_grid
;

840 
ddi•
->
grid
.
¢≠
 = snap;

842 i‡(
ddi•
->
míu_b¨
 =
NULL
) {

843 
¢≠_to_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`míus_gë_a˘i⁄
 ("ViewSnaptogrid"));

844 i‡(
	`is_öãgøãd_ui
 ())

845 
	`öãgøãd_ui_toﬁb¨_grid_¢≠_synchr⁄ize_to_di•œy
 (
ddi•
);

847 
¢≠_to_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
ddi•
->
a˘i⁄s
, "ViewSnaptogrid"));

851 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
¢≠_to_grid
, 
ddi•
->
grid
.
¢≠
);

852 
	`ddi•œy_upd©e_°©usb¨
(
ddi•
);

853 
	}
}

857 
	$upd©e_¢≠_grid_°©us
(
DDi•œy
 *
ddi•
)

859 i‡(
ddi•
->
grid_°©us
)

861 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
 (
	`GTK_TOGGLE_BUTTON
 (
ddi•
->
grid_°©us
),

862 
ddi•
->
grid
.
¢≠
);

864 
	}
}

869 
	$ddi•œy_£t_¢≠_to_obje˘s
(
DDi•œy
 *
ddi•
, 
gboﬁón
 
mag√tic
)

871 
GtkToggÀA˘i⁄
 *
maöpoöt_mag√tism
;

872 
ddi•
->
maöpoöt_mag√tism
 = 
mag√tic
;

874 i‡(
ddi•
->
míu_b¨
 =
NULL
) {

875 
maöpoöt_mag√tism
 = 
	`GTK_TOGGLE_ACTION
 (
	`míus_gë_a˘i⁄
 ("ViewSnaptoobjects"));

876 i‡(
	`is_öãgøãd_ui
 ())

877 
	`öãgøãd_ui_toﬁb¨_obje˘_¢≠_synchr⁄ize_to_di•œy
 (
ddi•
);

879 
maöpoöt_mag√tism
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
ddi•
->
a˘i⁄s
, "ViewSnaptoobjects"));

884 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
maöpoöt_mag√tism
, 
ddi•
->mainpoint_magnetism);

885 
	`ddi•œy_upd©e_°©usb¨
(
ddi•
);

886 
	}
}

890 
	$upd©e_maöpoöt_°©us
(
DDi•œy
 *
ddi•
)

892 i‡(
ddi•
->
maöpoöt_°©us
)

894 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
ddi•
->
maöpoöt_°©us
),

895 
ddi•
->
maöpoöt_mag√tism
);

897 
	}
}

900 
gboﬁón


901 
	$ddi•œy_autos¸ﬁl
(
DDi•œy
 *
ddi•
, 
x
, 
y
)

903 
guöt16
 
width
, 
height
;

904 
Poöt
 
s¸ﬁl
;

906 i‡(! 
ddi•
->
autos¸ﬁl
)

907  
FALSE
;

909 
s¸ﬁl
.
x
 = s¸ﬁl.
y
 = 0;

911 
width
 = 
	`GTK_WIDGET
(
ddi•
->
ˇnvas
)->
Æloˇti⁄
.width;

912 
height
 = 
	`GTK_WIDGET
(
ddi•
->
ˇnvas
)->
Æloˇti⁄
.height;

914 i‡(
x
 < 0)

916 
s¸ﬁl
.
x
 = x;

918 i‡–
x
 > 
width
)

920 
s¸ﬁl
.
x
 = x - 
width
;

923 i‡(
y
 < 0)

925 
s¸ﬁl
.
y
 = y;

927 i‡(
y
 > 
height
)

929 
s¸ﬁl
.
y
 = y - 
height
;

932 i‡((
s¸ﬁl
.
x
 !0Ë|| (s¸ﬁl.
y
 != 0))

934 
gboﬁón
 
s¸ﬁÀd
;

936 
s¸ﬁl
.
x
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, scroll.x);

937 
s¸ﬁl
.
y
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, scroll.y);

939 
s¸ﬁÀd
 = 
	`ddi•œy_s¸ﬁl
(
ddi•
, &
s¸ﬁl
);

941 i‡(
s¸ﬁÀd
) {

942 
	`ddi•œy_Êush
(
ddi•
);

943  
TRUE
;

946  
FALSE
;

947 
	}
}

950 
gboﬁón


951 
	$ddi•œy_s¸ﬁl
(
DDi•œy
 *
ddi•
, 
Poöt
 *
dñè
)

953 
Re˘™gÀ
 *
visibÀ
 = &
ddi•
->visible;

954 
ªÆ
 
width
 = 
visibÀ
->
right
 - visibÀ->
À·
;

955 
ªÆ
 
height
 = 
visibÀ
->
bŸtom
 - visibÀ->
t›
;

957 
Re˘™gÀ
 
exã¡s
 = 
ddi•
->
dügøm
->
d©a
->extents;

958 
ªÆ
 
ex_width
 = 
exã¡s
.
right
 -Éxã¡s.
À·
;

959 
ªÆ
 
ex_height
 = 
exã¡s
.
bŸtom
 -Éxã¡s.
t›
;

961 
Poöt
 
√w_‹igo
 = 
ddi•
->
‹igo
;

962 
	`poöt_add
(&
√w_‹igo
, 
dñè
);

964 
	`ª˘™gÀ_uni⁄
(&
exã¡s
, 
visibÀ
);

966 i‡(
√w_‹igo
.
x
 < 
exã¡s
.
À·
 - 
ex_width
)

967 
√w_‹igo
.
x
 = 
exã¡s
.
À·
 - 
ex_width
;

969 i‡(
√w_‹igo
.
x
+
width
 > 
exã¡s
.
right
 + 
ex_width
)

970 
√w_‹igo
.
x
 = 
exã¡s
.
right
 - 
width
 + 
ex_width
;

972 i‡(
√w_‹igo
.
y
 < 
exã¡s
.
t›
 - 
ex_height
)

973 
√w_‹igo
.
y
 = 
exã¡s
.
t›
 - 
ex_height
;

975 i‡(
√w_‹igo
.
y
+
height
 > 
exã¡s
.
bŸtom
 + 
ex_height
)

976 
√w_‹igo
.
y
 = 
exã¡s
.
bŸtom
 - 
height
 + 
ex_height
;

978 i‡–(
√w_‹igo
.
x
 !
ddi•
->
‹igo
.x) ||

979 (
√w_‹igo
.
y
 !
ddi•
->
‹igo
.y) ) {

980 
	`ddi•œy_£t_‹igo
(
ddi•
, 
√w_‹igo
.
x
,Çew_‹igo.
y
);

981 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

982 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

983  
TRUE
;

985  
FALSE
;

986 
	}
}

988 
	$ddi•œy_s¸ﬁl_up
(
DDi•œy
 *
ddi•
)

990 
Poöt
 
dñè
;

992 
dñè
.
x
 = 0;

993 
dñè
.
y
 = -(
ddi•
->
visibÀ
.
bŸtom
 - ddi•->visibÀ.
t›
)/4.0;

995 
	`ddi•œy_s¸ﬁl
(
ddi•
, &
dñè
);

996 
	}
}

998 
	$ddi•œy_s¸ﬁl_down
(
DDi•œy
 *
ddi•
)

1000 
Poöt
 
dñè
;

1002 
dñè
.
x
 = 0;

1003 
dñè
.
y
 = (
ddi•
->
visibÀ
.
bŸtom
 - ddi•->visibÀ.
t›
)/4.0;

1005 
	`ddi•œy_s¸ﬁl
(
ddi•
, &
dñè
);

1006 
	}
}

1008 
	$ddi•œy_s¸ﬁl_À·
(
DDi•œy
 *
ddi•
)

1010 
Poöt
 
dñè
;

1012 
dñè
.
x
 = -(
ddi•
->
visibÀ
.
right
 - ddi•->visibÀ.
À·
)/4.0;

1013 
dñè
.
y
 = 0;

1015 
	`ddi•œy_s¸ﬁl
(
ddi•
, &
dñè
);

1016 
	}
}

1018 
	$ddi•œy_s¸ﬁl_right
(
DDi•œy
 *
ddi•
)

1020 
Poöt
 
dñè
;

1022 
dñè
.
x
 = (
ddi•
->
visibÀ
.
right
 - ddi•->visibÀ.
À·
)/4.0;

1023 
dñè
.
y
 = 0;

1025 
	`ddi•œy_s¸ﬁl
(
ddi•
, &
dñè
);

1026 
	}
}

1030 
gboﬁón


1031 
	$ddi•œy_s¸ﬁl_˚¡î_poöt
(
DDi•œy
 *
ddi•
, 
Poöt
 *
p
)

1033 
Poöt
 
˚¡î
;

1036 
˚¡î
.
x
 = (
ddi•
->
visibÀ
.
right
+ddi•->visibÀ.
À·
)/2;

1037 
˚¡î
.
y
 = (
ddi•
->
visibÀ
.
t›
+ddi•->visibÀ.
bŸtom
)/2;

1039 
	`poöt_sub
(
p
, &
˚¡î
);

1040  
	`ddi•œy_s¸ﬁl
(
ddi•
, 
p
);

1041 
	}
}

1045 
gboﬁón


1046 
	$ddi•œy_s¸ﬁl_to_obje˘
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
)

1048 
Re˘™gÀ
 
r
 = 
obj
->
boundög_box
;

1050 
Poöt
 
p
;

1051 
p
.
x
 = (
r
.
À·
+r.
right
)/2;

1052 
p
.
y
 = (
r
.
t›
+r.
bŸtom
)/2;

1054 
	`di•œy_£t_a˘ive
(
ddi•
);

1055  
	`ddi•œy_s¸ﬁl_˚¡î_poöt
(
ddi•
, &
p
);

1056 
	}
}

1060 
gboﬁón


1061 
	$ddi•œy_¥e£¡_obje˘
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
)

1063 c⁄° 
Re˘™gÀ
 *
r
 = 
	`dü_obje˘_gë_í˛osög_box
(
obj
);

1064 c⁄° 
Re˘™gÀ
 *
v
 = &
ddi•
->
visibÀ
;

1066 
	`di•œy_£t_a˘ive
(
ddi•
);

1067 i‡(!
	`ª˘™gÀ_ö_ª˘™gÀ
(
v
, 
r
)) {

1068 
Poöt
 
dñè
 = { 0, 0 };

1070 i‡((
r
->
right
 -Ñ->
À·
Ë> (
v
->right - v->left))

1071 
dñè
.
x
 = (
r
->
À·
 - 
v
->À· +Ñ->
right
 - v->right) / 2;

1072 i‡(
r
->
À·
 < 
v
->left)

1073 
dñè
.
x
 = 
r
->
À·
 - 
v
->left;

1074 i‡(
r
->
right
 > 
v
->right)

1075 
dñè
.
x
 = 
r
->
right
 - 
v
->right;

1077 i‡((
r
->
bŸtom
 -Ñ->
t›
Ë> (
v
->bottom - v->top))

1078 
dñè
.
y
 = (
r
->
t›
 - 
v
->t› +Ñ->
bŸtom
 - v->bottom) / 2;

1079 i‡(
r
->
t›
 < 
v
->top)

1080 
dñè
.
y
 = 
r
->
t›
 - 
v
->top;

1081 i‡(
r
->
bŸtom
 > 
v
->bottom)

1082 
dñè
.
y
 = 
r
->
bŸtom
 - 
v
->bottom;

1084 
	`ddi•œy_s¸ﬁl
(
ddi•
, &
dñè
);

1085  
TRUE
;

1087  
FALSE
;

1088 
	}
}

1096 
DüRídîî
 *

1097 
	$√w_Ø_ªndîî
 (
DDi•œy
 *
ddi•
)

1099 
GTy≥
 
ªndîî_ty≥
;

1101 
ªndîî_ty≥
 = 
	`g_ty≥_‰om_«me
 ("DiaLibartRenderer");

1102 i‡(
ªndîî_ty≥
) {

1103 
DüRídîî
 *
ªndîî
 = 
	`g_obje˘_√w
(
ªndîî_ty≥
, 
NULL
);

1104 
	`g_obje˘_£t
 (
ªndîî
,

1105 "å™sf‹m", 
	`dü_å™sf‹m_√w
 (&
ddi•
->
visibÀ
, &ddi•->
zoom_Á˘‹
),

1106 
NULL
);

1107  
ªndîî
;

1110 
ªndîî_ty≥
 = 
	`g_ty≥_‰om_«me
 ("DiaCairoInteractiveRenderer");

1111 i‡(
ªndîî_ty≥
) {

1112 
DüRídîî
 *
ªndîî
 = 
	`g_obje˘_√w
(
ªndîî_ty≥
, 
NULL
);

1113 
	`g_obje˘_£t
 (
ªndîî
,

1114 "zoom", &
ddi•
->
zoom_Á˘‹
,

1115 "ª˘", &
ddi•
->
visibÀ
,

1116 
NULL
);

1117  
ªndîî
;

1121 
	`mesßge_w¨nög
 (
	`_
("Noánti-aliasedÑenderer found"));

1123  
	`√w_gdk_ªndîî
 (
ddi•
);

1124 
	}
}

1127 
	$ddi•œy_£t_ªndîî
(
DDi•œy
 *
ddi•
, 
Ø_ªndîî
)

1129 
width
, 
height
;

1132 i‡(
ddi•
->
upd©e_id
) {

1133 
	`g_sour˚_ªmove
 (
ddi•
->
upd©e_id
);

1134 
ddi•
->
upd©e_id
 = 0;

1137 i‡(
ddi•
->
ªndîî
)

1138 
	`g_obje˘_uƒef
 (
ddi•
->
ªndîî
);

1140 
ddi•
->
Ø_ªndîî
 =áa_renderer;

1142 
width
 = 
ddi•
->
ˇnvas
->
Æloˇti⁄
.width;

1143 
height
 = 
ddi•
->
ˇnvas
->
Æloˇti⁄
.height;

1145 i‡(
ddi•
->
Ø_ªndîî
){

1146 
ddi•
->
ªndîî
 = 
	`√w_Ø_ªndîî
 (ddisp);

1148 
ddi•
->
ªndîî
 = 
	`√w_gdk_ªndîî
(ddisp);

1151 
	`dü_ªndîî_£t_size
(
ddi•
->
ªndîî
, ddi•->
ˇnvas
->
wödow
, 
width
, 
height
);

1152 
	}
}

1155 
	$ddi•œy_ªsize_ˇnvas
(
DDi•œy
 *
ddi•
,

1156 
width
, 
height
)

1158 i‡(
ddi•
->
ªndîî
==
NULL
) {

1159 i‡(
ddi•
->
Ø_ªndîî
)

1160 
ddi•
->
ªndîî
 = 
	`√w_Ø_ªndîî
 (ddisp);

1162 
ddi•
->
ªndîî
 = 
	`√w_gdk_ªndîî
(ddisp);

1165 
	`dü_ªndîî_£t_size
(
ddi•
->
ªndîî
, ddi•->
ˇnvas
->
wödow
, 
width
, 
height
);

1167 
	`ddi•œy_£t_‹igo
(
ddi•
, ddi•->
‹igo
.
x
, ddi•->‹igo.
y
);

1169 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

1170 
	`ddi•œy_Êush
(
ddi•
);

1171 
	}
}

1173 
DDi•œy
 *

1174 
	$ddi•œy_a˘ive
()

1176  
a˘ive_di•œy
;

1177 
	}
}

1179 
Dügøm
 *

1180 
	$ddi•œy_a˘ive_dügøm
()

1182 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
 ();

1184 i‡(!
ddi•
Ë 
NULL
;

1185  
ddi•
->
dügøm
;

1186 
	}
}

1189 
	$ddi•_de°roy
(
DDi•œy
 *
ddi•
)

1191 
	`g_sig«l_h™dÀrs_disc⁄√˘_by_func
 (
ddi•
->
dügøm
, 
£À˘i⁄_ch™ged
, ddisp);

1193 
	`g_obje˘_uƒef
 (
	`G_OBJECT
 (
ddi•
->
im_c⁄ãxt
));

1194 
ddi•
->
im_c⁄ãxt
 = 
NULL
;

1196 
	`ddi•œy_im_c⁄ãxt_¥ìdô_ª£t
(
ddi•
, 
	`gë_a˘ive_focus
((
DügømD©a
 *Ëddi•->
dügøm
));

1199 i‡(
ddi•
->
is_°™dÆ⁄e_wödow
)

1200 
	`gtk_widgë_de°roy
 (
ddi•
->
shñl
);

1202 
	`gtk_widgë_de°roy
 (
ddi•
->
c⁄èöî
);

1203 
	`ddi•œy_ªÆly_de°roy
 (
ddi•
);

1205 
	}
}

1208 
	$¨e_you_suª_˛o£_dülog_ª•⁄d
(
GtkWidgë
 *
widgë
,

1209 
göt
 
ª•⁄£_id
,

1210 
gpoöãr
 
u£r_d©a
)

1212 
DDi•œy
 *
ddi•
 = (DDi•œy *)
u£r_d©a
;

1213 
gboﬁón
 
˛o£_ddi•
 = 
TRUE
;

1215 
ª•⁄£_id
) {

1216 
GTK_RESPONSE_YES
 :

1218 i‡(!
	`dügøm_ßve
(
ddi•
->
dügøm
, ddi•->dügøm->
fûíame
))

1219 
˛o£_ddi•
 = 
FALSE
;

1221 i‡(
ddi•
->
upd©e_id
 && 
˛o£_ddi•
) {

1222 
	`g_sour˚_ªmove
 (
ddi•
->
upd©e_id
);

1223 
ddi•
->
upd©e_id
 = 0;

1226 
GTK_RESPONSE_NO
 :

1227 i‡(
˛o£_ddi•
)

1228 
	`ddi•_de°roy
 (
ddi•
);

1230 
GTK_RESPONSE_CANCEL
 :

1231 
GTK_RESPONSE_NONE
 :

1232 
GTK_RESPONSE_DELETE_EVENT
 :

1233 
	`gtk_widgë_de°roy
(
widgë
);

1236 
	`g_as£π_nŸ_ªached
();

1238 
	}
}

1241 
	$ddi•œy_˛o£
(
DDi•œy
 *
ddi•
)

1243 
Dügøm
 *
dü
;

1244 
GtkWidgë
 *
dülog
, *
buâ⁄
;

1245 
gch¨
 *
‚ame
;

1247 
	`g_ªtu∫_if_Áû
(
ddi•
 !
NULL
);

1249 
dü
 = 
ddi•
->
dügøm
;

1251 i‡–(
	`g_¶i°_Àngth
(
dü
->
di•œys
) > 1) ||

1252 (!
	`dügøm_is_modifõd
(
dü
)) ) {

1253 
	`ddi•_de°roy
(
ddi•
);

1257 
‚ame
 = 
dü
->
fûíame
;

1258 i‡(!
‚ame
)

1259 
‚ame
 = 
	`_
("<unnamed>");

1261 
dülog
 = 
	`gtk_mesßge_dülog_√w
(
	`GTK_WINDOW
 (
ddi•
->
shñl
),

1262 
GTK_DIALOG_MODAL
,

1263 
GTK_MESSAGE_QUESTION
,

1264 
GTK_BUTTONS_NONE
,

1265 
	`_
("Closing diagram without saving"));

1266 
	`gtk_mesßge_dülog_f‹m©_£c⁄d¨y_ãxt
(
	`GTK_MESSAGE_DIALOG
(
dülog
),

1267 
	`_
("The diagram '%s'\n"

1268 "ha†nŸ bì¿ßved. Savêch™ge†now?"), 
‚ame
);

1269 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
(
dülog
), 
	`_
("Close Diagram"));

1271 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_CANCEL
);

1272 
	`gtk_dülog_add_a˘i⁄_widgë
 (
	`GTK_DIALOG
(
dülog
), 
buâ⁄
, 
GTK_RESPONSE_CANCEL
);

1274 
buâ⁄
 = 
	`gtk_buâ⁄_√w_wôh_m√m⁄ic
 (
	`_
("_Discard Changes"));

1275 
	`gtk_dülog_add_a˘i⁄_widgë
 (
	`GTK_DIALOG
(
dülog
), 
buâ⁄
, 
GTK_RESPONSE_NO
);

1278 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_SAVE
);

1279 
	`gtk_dülog_add_a˘i⁄_widgë
 (
	`GTK_DIALOG
(
dülog
), 
buâ⁄
, 
GTK_RESPONSE_YES
);

1280 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄
, 
GTK_CAN_DEFAULT
);

1281 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
(
dülog
), 
GTK_RESPONSE_YES
);

1283 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
dülog
), "response",

1284 
	`G_CALLBACK
(
¨e_you_suª_˛o£_dülog_ª•⁄d
),

1285 
ddi•
);

1287 
	`gtk_widgë_show_Æl
(
dülog
);

1288 
	}
}

1291 
	$di•œy_upd©e_míu_°©e
(
DDi•œy
 *
ddi•
)

1293 
GtkToggÀA˘i⁄
 *
ruÀrs
;

1294 
GtkToggÀA˘i⁄
 *
visibÀ_grid
;

1295 
GtkToggÀA˘i⁄
 *
¢≠_to_grid
;

1296 
GtkToggÀA˘i⁄
 *
show_cx_±s
;

1297 
GtkToggÀA˘i⁄
 *
™tülü£d
;

1299 i‡(
ddi•
->
míu_b¨
 =
NULL
) {

1300 
ruÀrs
 = 
	`GTK_TOGGLE_ACTION
 (
	`míus_gë_a˘i⁄
 ("ViewShowrulers"));

1301 
visibÀ_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`míus_gë_a˘i⁄
 ("ViewShowgrid"));

1302 
¢≠_to_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`míus_gë_a˘i⁄
 ("ViewSnaptogrid"));

1303 
show_cx_±s
 = 
	`GTK_TOGGLE_ACTION
 (
	`míus_gë_a˘i⁄
 ("ViewShowconnectionpoints"));

1304 
™tülü£d
 = 
	`GTK_TOGGLE_ACTION
 (
	`míus_gë_a˘i⁄
 ("ViewAntialiased"));

1306 
ruÀrs
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
ddi•
->
a˘i⁄s
, "ViewShowrulers"));

1307 
visibÀ_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
ddi•
->
a˘i⁄s
, "ViewShowgrid"));

1308 
¢≠_to_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
ddi•
->
a˘i⁄s
, "ViewSnaptogrid"));

1309 
show_cx_±s
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
ddi•
->
a˘i⁄s
, "ViewShowconnectionpoints"));

1311 
™tülü£d
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
ddi•
->
a˘i⁄s
, "ViewAntialiased"));

1313 
	`gtk_a˘i⁄_£t_£nsôive
 (
	`míus_gë_a˘i⁄
 ("ViewAntialiased"),

1314 
	`g_ty≥_‰om_«me
 ("DiaCairoInteractiveRenderer") != 0 || g_type_from_name ("DiaLibartRenderer") != 0);

1317 
	`ddi•œy_do_upd©e_míu_£nsôivôy
 (
ddi•
);

1319 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
ruÀrs
, 
	`di•œy_gë_ruÀrs_showög
(
ddi•
));

1320 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
visibÀ_grid
,

1321 
ddi•
->
grid
.
visibÀ
);

1322 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
¢≠_to_grid
,

1323 
ddi•
->
grid
.
¢≠
);

1324 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
show_cx_±s
,

1325 
ddi•
->
show_cx_±s
);

1327 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
™tülü£d
,

1328 
ddi•
->
Ø_ªndîî
);

1329 
	}
}

1332 
	$ddi•œy_do_upd©e_míu_£nsôivôy
 (
DDi•œy
 *
ddi•
)

1334 
Dügøm
 *
dü
;

1336 i‡(
ddi•
 =
NULL
) {

1339 
dü
 = 
ddi•
->
dügøm
;

1340 
	`dügøm_upd©e_míu_£nsôivôy
 (
dü
);

1341 
	}
}

1347 
	$ddi•œy_ªÆly_de°roy
(
DDi•œy
 *
ddi•
)

1349 i‡(
a˘ive_di•œy
 =
ddi•
)

1350 
	`di•œy_£t_a˘ive
(
NULL
);

1353 i‡(
ddi•
->
upd©e_id
) {

1354 
	`g_sour˚_ªmove
 (
ddi•
->
upd©e_id
);

1355 
ddi•
->
upd©e_id
 = 0;

1358 i‡(
ddi•
->
dügøm
) {

1359 
	`dügøm_ªmove_ddi•œy
(
ddi•
->
dügøm
, ddisp);

1361 
	`g_obje˘_uƒef
(
ddi•
->
dügøm
);

1362 
ddi•
->
dügøm
 = 
NULL
;

1365 
	`g_obje˘_uƒef
 (
ddi•
->
ªndîî
);

1366 
ddi•
->
ªndîî
 = 
NULL
;

1368 
	`g_hash_èbÀ_ªmove
(
di•œy_ht
, 
ddi•
->
shñl
);

1369 
	`g_hash_èbÀ_ªmove
(
di•œy_ht
, 
ddi•
->
ˇnvas
);

1372 
	`ddi•œy_‰ì_upd©e_¨ós
(
ddi•
);

1374 
	`ddi•œy_‰ì_di•œy_¨ós
(
ddi•
);

1376 
	`g_‰ì
(
ddi•
);

1377 
	}
}

1381 
	$ddi•œy_£t_tôÀ
(
DDi•œy
 *
ddi•
, *
tôÀ
)

1383 i‡(
ddi•
->
is_°™dÆ⁄e_wödow
)

1384 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
ddi•
->
shñl
), 
tôÀ
);

1387 
GtkNŸebook
 *
nŸebook
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
ddi•
->
shñl
),

1388 
DIA_MAIN_NOTEBOOK
);

1390 
göt
 
num_∑ges
 = 
	`gtk_nŸebook_gë_n_∑ges
 (
nŸebook
);

1391 
göt
 
num
;

1392 
GtkWidgë
 *
∑ge
;

1393 
num
 = 0 ;Çum < 
num_∑ges
 ;Çum++)

1395 
∑ge
 = 
	`gtk_nŸebook_gë_¡h_∑ge
 (
nŸebook
,
num
);

1396 i‡(
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
∑ge
), "DDi•œy"Ë=
ddi•
)

1398 
GtkLabñ
 *
œbñ
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
∑ge
), "tab-label");

1400 
gch¨
 *
«me
 = 
	`dügøm_gë_«me
(
ddi•
->
dügøm
);

1401 
	`gtk_œbñ_£t_ãxt
(
œbñ
,
«me
);

1402 
	`g_‰ì
(
«me
);

1408 c⁄° 
gch¨
 *
≤ame
 = 
	`g_gë_¥g«me
();

1409 
gch¨
 *
fuŒtôÀ
 = 
	`g_°rdup_¥ötf
 ("%†- %s", 
tôÀ
, 
≤ame
 ?Öname : "Dia");

1410 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
ddi•
->
shñl
), 
fuŒtôÀ
);

1411 
	`g_‰ì
(
fuŒtôÀ
);

1414 
	}
}

1417 
	$ddi•œy_£t_Æl_curs‹
(
GdkCurs‹
 *
curs‹
)

1419 
Dügøm
 *
dü
;

1420 
DDi•œy
 *
ddi•
;

1421 
GLi°
 *
li°
;

1422 
GSLi°
 *
¶i°
;

1424 
cuºít_curs‹
 = 
curs‹
;

1426 
li°
 = 
	`dü_›í_dügøms
();

1427 
li°
 !
NULL
) {

1428 
dü
 = (
Dügøm
 *Ë
li°
->
d©a
;

1430 
¶i°
 = 
dü
->
di•œys
;

1431 
¶i°
 !
NULL
) {

1432 
ddi•
 = (
DDi•œy
 *Ë
¶i°
->
d©a
;

1434 
	`ddi•œy_£t_curs‹
(
ddi•
, 
curs‹
);

1436 
¶i°
 = 
	`g_¶i°_√xt
(slist);

1439 
li°
 = 
	`g_li°_√xt
(list);

1441 
	}
}

1444 
	$ddi•œy_£t_curs‹
(
DDi•œy
 *
ddi•
, 
GdkCurs‹
 *
curs‹
)

1446 i‡(
ddi•
->
ˇnvas
->
wödow
)

1447 
	`gdk_wödow_£t_curs‹
(
ddi•
->
ˇnvas
->
wödow
, 
curs‹
);

1448 
	}
}

1452 
gboﬁón
 
	$di•œy_gë_ruÀrs_showög
(
DDi•œy
 *
ddi•
) {

1453  
ddi•
->
ruÀrs_¨e_showög
;

1454 
	}
}

1464 
	$di•œy_ruÀrs_show
 (
DDi•œy
 *
ddi•
)

1466 i‡(
ddi•
)

1468 
GtkWidgë
 *
∑ª¡
 = 
	`GTK_WIDGET
 (
ddi•
->
‹igö
->parent);

1470 
	`gtk_widgë_show
 (
ddi•
->
‹igö
);

1471 
	`gtk_widgë_show
 (
ddi•
->
hruÀ
);

1472 
	`gtk_widgë_show
 (
ddi•
->
vruÀ
);

1474 i‡(
	`GTK_WIDGET_VISIBLE
 (
∑ª¡
))

1475 
	`gtk_widgë_queue_ªsize
 (
∑ª¡
);

1477 
ddi•
->
ruÀrs_¨e_showög
 = 
TRUE
;

1479 
	}
}

1488 
	$di•œy_ruÀrs_hide
 (
DDi•œy
 *
ddi•
)

1490 i‡(
ddi•
)

1492 
GtkWidgë
 *
∑ª¡
 = 
	`GTK_WIDGET
 (
ddi•
->
‹igö
->parent);

1494 
	`gtk_widgë_hide
 (
ddi•
->
‹igö
);

1495 
	`gtk_widgë_hide
 (
ddi•
->
hruÀ
);

1496 
	`gtk_widgë_hide
 (
ddi•
->
vruÀ
);

1498 i‡(
	`GTK_WIDGET_VISIBLE
 (
∑ª¡
))

1499 
	`gtk_widgë_queue_ªsize
 (
∑ª¡
);

1501 
ddi•
->
ruÀrs_¨e_showög
 = 
FALSE
;

1503 
	}
}

1506 
	$ddi•œy_upd©e_°©usb¨
(
DDi•œy
 *
ddi•
)

1508 
	`upd©e_zoom_°©us
 (
ddi•
);

1509 
	`upd©e_¢≠_grid_°©us
 (
ddi•
);

1510 
	`upd©e_maöpoöt_°©us
 (
ddi•
);

1511 
	}
}

1514 
	$di•œy_£t_a˘ive
(
DDi•œy
 *
ddi•
)

1516 i‡(
ddi•
 !
a˘ive_di•œy
) {

1517 
a˘ive_di•œy
 = 
ddi•
;

1520 
	`œyî_dülog_£t_dügøm
(
ddi•
 ? ddi•->
dügøm
 : 
NULL
);

1521 
	`dügøm_¥›îtõs_£t_dügøm
(
ddi•
 ? ddi•->
dügøm
 : 
NULL
);

1523 i‡(
ddi•
) {

1524 i‡(
ddi•
->
is_°™dÆ⁄e_wödow
)

1526 
	`di•œy_upd©e_míu_°©e
(
ddi•
);

1528 i‡(
¥efs
.
toﬁbox_⁄_t›
) {

1529 
	`gtk_wödow_£t_å™sõ¡_f‹
(
	`GTK_WINDOW
(
	`öãrÁ˚_gë_toﬁbox_shñl
()),

1530 
	`GTK_WINDOW
(
ddi•
->
shñl
));

1532 
	`gtk_wödow_£t_å™sõ¡_f‹
(
	`GTK_WINDOW
(
	`öãrÁ˚_gë_toﬁbox_shñl
()),

1533 
NULL
);

1536 
GtkNŸebook
 *
nŸebook
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
ddi•
->
shñl
),

1537 
DIA_MAIN_NOTEBOOK
);

1539 
göt
 
num_∑ges
 = 
	`gtk_nŸebook_gë_n_∑ges
 (
nŸebook
);

1540 
göt
 
num
;

1541 
GtkWidgë
 *
∑ge
;

1542 
num
 = 0 ;Çum < 
num_∑ges
 ;Çum++)

1544 
∑ge
 = 
	`gtk_nŸebook_gë_¡h_∑ge
 (
nŸebook
,
num
);

1545 i‡(
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
∑ge
), "DDi•œy"Ë=
ddi•
)

1547 
	`gtk_nŸebook_£t_cuºít_∑ge
 (
nŸebook
,
num
);

1553 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

1556 
	`upd©e_zoom_°©us
 (
ddi•
);

1559 
	`ddi•œy_£t_¢≠_to_grid
 (
ddi•
, ddi•->
grid
.
¢≠
);

1562 
	`ddi•œy_£t_¢≠_to_obje˘s
 (
ddi•
, ddi•->
maöpoöt_mag√tism
);

1564 
	`di•œy_upd©e_míu_°©e
 (
ddi•
);

1566 
	`gtk_wödow_¥e£¡
 (
	`GTK_WINDOW
(
ddi•
->
shñl
));

1570 
	`gtk_wödow_£t_å™sõ¡_f‹
(
	`GTK_WINDOW
(
	`öãrÁ˚_gë_toﬁbox_shñl
()),

1571 
NULL
);

1574 
	}
}

1577 
	$ddi•œy_im_c⁄ãxt_¥ìdô_ª£t
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
)

1579 i‡(
ddi•
->
¥ìdô_°rög
 !
NULL
) {

1580 i‡(
focus
 !
NULL
) {

1581 
i
;

1582 
Obje˘Ch™ge
 *
ch™ge
;

1584 
i
 = 0; i < 
	`g_utf8_°æí
(
ddi•
->
¥ìdô_°rög
, -1); i++) {

1585 (
focus
->
key_evít
)(focus, 
GDK_BackS∑˚
, 
NULL
, 0, &
ch™ge
);

1589 
	`g_‰ì
(
ddi•
->
¥ìdô_°rög
);

1590 
ddi•
->
¥ìdô_°rög
 = 
NULL
;

1592 i‡(
ddi•
->
¥ìdô_©ås
 !
NULL
) {

1593 
	`∑ngo_©å_li°_uƒef
(
ddi•
->
¥ìdô_©ås
);

1594 
ddi•
->
¥ìdô_©ås
 = 
NULL
;

1596 
	}
}

1605 
Focus
 *

1606 
	$ddi•œy_a˘ive_focus
(
DDi•œy
 *
ddi•
)

1608  
ddi•
 ? ddi•->
a˘ive_focus
 : 
NULL
;

1609 
	}
}

1621 
	$ddi•œy_£t_a˘ive_focus
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
)

1623 
ddi•
->
a˘ive_focus
 = 
focus
;

1624 
	}
}

1627 
	$ddi•œy_show_Æl
 (
DDi•œy
 *
ddi•
)

1629 
Dügøm
 *
dü
;

1630 
ªÆ
 
magnify_x
, 
magnify_y
;

1631 
width
, 
height
;

1632 
Poöt
 
middÀ
;

1634 
	`g_ªtu∫_if_Áû
 (
ddi•
 !
NULL
);

1636 
dü
 = 
ddi•
->
dügøm
;

1638 
width
 = 
	`dü_ªndîî_gë_width_pixñs
 (
ddi•
->
ªndîî
);

1639 
height
 = 
	`dü_ªndîî_gë_height_pixñs
 (
ddi•
->
ªndîî
);

1642 i‡(
dü
->
d©a
->
£À˘ed
) {

1643 
GLi°
 *
li°
 = 
dü
->
d©a
->
£À˘ed
;

1644 
Re˘™gÀ
 
exã¡s
 = *
	`dü_obje˘_gë_í˛osög_box
 ((
DüObje˘
*)
li°
->
d©a
);

1645 
li°
 = 
	`g_li°_√xt
(list);

1646 
li°
) {

1647 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

1648 
	`ª˘™gÀ_uni⁄
(&
exã¡s
, 
	`dü_obje˘_gë_í˛osög_box
 (
obj
));

1649 
li°
 = 
	`g_li°_√xt
(list);

1651 
magnify_x
 = (
ªÆ
)
width
 / (
exã¡s
.
right
 -Éxã¡s.
À·
Ë/ 
ddi•
->
zoom_Á˘‹
;

1652 
magnify_y
 = (
ªÆ
)
height
 / (
exã¡s
.
bŸtom
 -Éxã¡s.
t›
Ë/ 
ddi•
->
zoom_Á˘‹
;

1653 
middÀ
.
x
 = 
exã¡s
.
À·
 + (exã¡s.
right
 -Éxtents.left) / 2.0;

1654 
middÀ
.
y
 = 
exã¡s
.
t›
 + (exã¡s.
bŸtom
 -Éxtents.top) / 2.0;

1656 
magnify_x
 = (
ªÆ
)
width
 /

1657 (
dü
->
d©a
->
exã¡s
.
right
 - dü->d©a->exã¡s.
À·
Ë/ 
ddi•
->
zoom_Á˘‹
;

1658 
magnify_y
 = (
ªÆ
)
height
 /

1659 (
dü
->
d©a
->
exã¡s
.
bŸtom
 - dü->d©a->exã¡s.
t›
Ë/ 
ddi•
->
zoom_Á˘‹
;

1661 
middÀ
.
x
 = 
dü
->
d©a
->
exã¡s
.
À·
 +

1662 (
dü
->
d©a
->
exã¡s
.
right
 - dü->d©a->exã¡s.
À·
) / 2.0;

1663 
middÀ
.
y
 = 
dü
->
d©a
->
exã¡s
.
t›
 +

1664 (
dü
->
d©a
->
exã¡s
.
bŸtom
 - dü->d©a->exã¡s.
t›
) / 2.0;

1667 
	`ddi•œy_zoom
 (
ddi•
, &
middÀ
,

1668 ((
magnify_x
<
magnify_y
)?magnify_x:magnify_y)/1.05);

1670 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

1671 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

1672 
	`ddi•œy_Êush
(
ddi•
);

1673 
	}
}

	@O:\tool\dvs50\app\display.h

18 #i‚de‡
DDISPLAY_H


19 
	#DDISPLAY_H


	)

21 
	~<gtk/gtk.h
>

22 
	~<gtk/gtkimc⁄ãxt.h
>

24 
_DDi•œy
 
	tDDi•œy
;

26 
	~"lib/geomëry.h
"

27 
	~"dügøm.h
"

28 
	~"grid.h
"

29 
	~"míus.h
"

30 
	~"düªndîî.h
"

36 
	#DDISPLAY_MAX_ZOOM
 2000.0

	)

37 
	#DDISPLAY_NORMAL_ZOOM
 20.0

	)

38 
	#DDISPLAY_MIN_ZOOM
 0.2

	)

47 
	s_DDi•œy
 {

48 
Dügøm
 *
	mdügøm
;

50 
GtkWidgë
 *
	mshñl
;

51 
GtkWidgë
 *
	mˇnvas
;

52 
GtkWidgë
 *
	mhsb
, *
	mvsb
;

53 
GtkWidgë
 *
	mhruÀ
, *
	mvruÀ
;

54 
GtkWidgë
 *
	m‹igö
;

55 
GtkWidgë
 *
	mmíu_b¨
;

56 
GtkUIM™agî
 *
	mui_m™agî
;

57 
GtkA˘i⁄Group
 *
	ma˘i⁄s
;

60 
GtkMíuIãm
 *
	mruÀrs
;

62 
GtkWidgë
 *
	mzoom_°©us
;

63 
GtkWidgë
 *
	mgrid_°©us
;

64 
GtkWidgë
 *
	mmaöpoöt_°©us
;

65 
GtkWidgë
 *
	mmodifõd_°©us
;

67 
GtkAc˚lGroup
 *
	mac˚l_group
;

69 
GtkAdju°mít
 *
	mhsbd©a
;

70 
GtkAdju°mít
 *
	mvsbd©a
;

72 
Poöt
 
	m‹igo
;

73 
ªÆ
 
	mzoom_Á˘‹
;

74 
Re˘™gÀ
 
	mvisibÀ
;

76 
Grid
 
	mgrid
;

78 
gboﬁón
 
	mshow_cx_±s
;

79 
gboﬁón
 
	mautos¸ﬁl
;

80 
gboﬁón
 
	mmaöpoöt_mag√tism
;

82 
	mØ_ªndîî
;

83 
DüRídîî
 *
	mªndîî
;

85 
GSLi°
 *
	mupd©e_¨ós
;

86 
GSLi°
 *
	mdi•œy_¨ós
;

87 
guöt
 
	mupd©e_id
;

89 
GtkIMC⁄ãxt
 *
	mim_c⁄ãxt
;

92 
gch¨
 *
	m¥ìdô_°rög
;

93 
P™goAârLi°
 *
	m¥ìdô_©ås
;

97 
gboﬁón
 
	mis_°™dÆ⁄e_wödow
;

100 
GtkToﬁb¨
 *
	mcomm⁄_toﬁb¨
;

103 
GtkWidgë
 *
	mc⁄èöî
;

106 
gboﬁón
 
	mruÀrs_¨e_showög
;

109 
Focus
 *
	ma˘ive_focus
;

112 
GdkCurs‹
 *
deÁu…_curs‹
;

114 
DDi•œy
 *
√w_di•œy
(
Dügøm
 *
dü
);

115 
DDi•œy
 *
c›y_di•œy
(DDi•œy *
‹ig_ddi•
);

117 
ddi•œy_ªÆly_de°roy
(
DDi•œy
 *
ddi•
);

118 
ddi•œy_å™sf‹m_co‹ds_doubÀ
(
DDi•œy
 *
ddi•
,

119 
co‹d
 
x
, co‹d 
y
,

120 *
xi
, *
yi
);

121 
ddi•œy_å™sf‹m_co‹ds
(
DDi•œy
 *
ddi•
,

122 
co‹d
 
x
, co‹d 
y
,

123 *
xi
, *
yi
);

124 
ddi•œy_u¡ønsf‹m_co‹ds
(
DDi•œy
 *
ddi•
,

125 
xi
, 
yi
,

126 
co‹d
 *
x
, co‹d *
y
);

127 
ªÆ
 
ddi•œy_å™sf‹m_Àngth
(
DDi•œy
 *
ddi•
,Ñó»
Àn
);

128 
ªÆ
 
ddi•œy_u¡ønsf‹m_Àngth
(
DDi•œy
 *
ddi•
,Ñó»
Àn
);

129 
ddi•œy_add_upd©e_pixñs
(
DDi•œy
 *
ddi•
, 
Poöt
 *
poöt
,

130 
pixñ_width
, 
pixñ_height
);

131 
ddi•œy_add_upd©e_Æl
(
DDi•œy
 *
ddi•
);

132 
ddi•œy_add_upd©e_wôh_b‹dî
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
ª˘
,

133 
pixñ_b‹dî
);

134 
ddi•œy_add_upd©e
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
ª˘
);

135 
ddi•œy_add_di•œy_¨ó
(
DDi•œy
 *
ddi•
,

136 
À·
, 
t›
,

137 
right
, 
bŸtom
);

138 
ddi•œy_Êush
(
DDi•œy
 *
ddi•
);

139 
ddi•œy_upd©e_s¸ﬁlb¨s
(
DDi•œy
 *
ddi•
);

140 
ddi•œy_£t_‹igo
(
DDi•œy
 *
ddi•
,

141 
co‹d
 
x
, co‹d 
y
);

142 
ddi•œy_zoom
(
DDi•œy
 *
ddi•
, 
Poöt
 *
poöt
,

143 
ªÆ
 
zoom_Á˘‹
);

144 
ddi•œy_zoom_˚¡îed
(
DDi•œy
 *
ddi•
, 
Poöt
 *
poöt
, 
ªÆ
 
magnify
);

145 
ddi•œy_£t_¢≠_to_grid
(
DDi•œy
 *
ddi•
, 
gboﬁón
 
¢≠
);

146 
ddi•œy_£t_¢≠_to_obje˘s
(
DDi•œy
 *
ddi•
, 
gboﬁón
 
mag√tic
);

147 
ddi•œy_£t_ªndîî
(
DDi•œy
 *
ddi•
, 
Ø_ªndîî
);

148 
ddi•œy_ªsize_ˇnvas
(
DDi•œy
 *
ddi•
,

149 
width
,

150 
height
);

152 
ddi•œy_ªndî_pixm≠
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
upd©e
);

154 
DDi•œy
 *
ddi•œy_a˘ive
();

155 
Dügøm
 *
ddi•œy_a˘ive_dügøm
();

157 
ddi•œy_˛o£
(
DDi•œy
 *
ddi•
);

159 
ddi•œy_£t_tôÀ
(
DDi•œy
 *
ddi•
, *
tôÀ
);

160 
ddi•œy_£t_curs‹
(
DDi•œy
 *
ddi•
, 
GdkCurs‹
 *
curs‹
);

161 
ddi•œy_£t_Æl_curs‹
(
GdkCurs‹
 *
curs‹
);

163 
gboﬁón
 
di•œy_gë_ruÀrs_showög
(
DDi•œy
 *
ddi•
);

164 
di•œy_ruÀrs_show
 (
DDi•œy
 *
ddi•
);

165 
di•œy_ruÀrs_hide
 (
DDi•œy
 *
ddi•
);

167 
gboﬁón
 
ddi•œy_s¸ﬁl
(
DDi•œy
 *
ddi•
, 
Poöt
 *
dñè
);

168 
gboﬁón
 
ddi•œy_autos¸ﬁl
(
DDi•œy
 *
ddi•
, 
x
, 
y
);

169 
ddi•œy_s¸ﬁl_up
(
DDi•œy
 *
ddi•
);

170 
ddi•œy_s¸ﬁl_down
(
DDi•œy
 *
ddi•
);

171 
ddi•œy_s¸ﬁl_À·
(
DDi•œy
 *
ddi•
);

172 
ddi•œy_s¸ﬁl_right
(
DDi•œy
 *
ddi•
);

173 
gboﬁón
 
ddi•œy_s¸ﬁl_˚¡î_poöt
(
DDi•œy
 *
ddi•
, 
Poöt
 *
p
);

174 
gboﬁón
 
ddi•œy_s¸ﬁl_to_obje˘
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
);

175 
gboﬁón
 
ddi•œy_¥e£¡_obje˘
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
);

177 
ddi•œy_show_Æl
 (
DDi•œy
 *
ddi•
);

179 
di•œy_upd©e_míu_°©e
(
DDi•œy
 *
ddi•
);

180 
ddi•œy_upd©e_°©usb¨
(
DDi•œy
 *
ddi•
);

181 
ddi•œy_do_upd©e_míu_£nsôivôy
 (
DDi•œy
 *
ddi•
);

183 
di•œy_£t_a˘ive
(
DDi•œy
 *
ddi•
);

185 
ddi•œy_im_c⁄ãxt_¥ìdô_ª£t
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
);

187 
Focus
 *
ddi•œy_a˘ive_focus
(
DDi•œy
 *
ddi•
);

188 
ddi•œy_£t_a˘ive_focus
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
);

	@O:\tool\dvs50\app\dynamic_refresh.c

21 
	~"dy«mic_ª‰esh.h
"

22 
	~"dy«mic_obj.h
"

23 
	~"dügøm.h
"

24 
	~"dügømd©a.h
"

25 
	~"obje˘_›s.h
"

26 
	~"c⁄√˘i⁄poöt_›s.h
"

27 
	~<glib.h
>

29 
guöt
 
	gtimeout
 = 0;

30 
guöt
 
	gidÀ_id
 = 0;

31 
guöt
 
	gtimî_id
 = 0;

33 
	$f‹óch_dynobj
(
DüObje˘
* 
obj
, 
gpoöãr
 
d©a
) {

34 
gboﬁón
 
moved
 = 
FALSE
;

35 
GLi°
* 
li°
 = 
	`dü_›í_dügøms
();

37 
li°
 !
NULL
) {

38 
Dügøm
* 
dü
;

39 
DügømD©a
* 
obj_dd©a
;

40 
Layî
* 
œyî
;

42 
dü
 = (
Dügøm
*)
li°
->
d©a
;

43 
li°
 = 
	`g_li°_√xt
(list);

45 
œyî
 = 
	`dü_obje˘_gë_∑ª¡_œyî
(
obj
);

46 i‡(!
œyî
) ;

48 
obj_dd©a
 = 
	`œyî_gë_∑ª¡_dügøm
(
œyî
);

49 i‡(!
obj_dd©a
) ;

51 i‡(
dü
->
d©a
 =
obj_dd©a
) {

52 i‡(!
moved
) {

53 
obj
->
›s
->
	`move
(obj,&obj->
posôi⁄
);

54 
moved
 = 
TRUE
;

56 
	`obje˘_add_upd©es
(
obj
,
dü
);

57 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
,
obj
, 
TRUE
);

60 
	}
}

62 
gboﬁón
 
	$timî_h™dÀr
(
gpoöãr
 
d©a
) {

63 
GLi°
* 
li°
;

65 
	`dynobj_li°_f‹óch
(
f‹óch_dynobj
,
d©a
);

67 
li°
 = 
	`dü_›í_dügøms
();

68 
li°
 !
NULL
) {

69 
Dügøm
* 
dü
 = (Dügøm*)
li°
->
d©a
;

70 
li°
 = 
	`g_li°_√xt
(list);

72 
	`dügøm_Êush
(
dü
);

75 
	`dynobj_ª‰esh_kick
();

76  
TRUE
;

77 
	}
}

79 
gboﬁón


80 
	$idÀ_h™dÀr
 (
gpoöãr
 
d©a
)

82 
guöt
 
√w_timeout
;

84 
√w_timeout
 = 
	`dynobj_li°_gë_dynobj_øã
();

85 i‡(
timeout
 !
√w_timeout
) {

86 i‡(
timî_id
) {

87 
	`g_sour˚_ªmove
 (
timî_id
);

88 
timî_id
 = 0;

90 
timeout
 = 
√w_timeout
;

91 i‡(
timeout
) {

92 
timî_id
 = 
	`g_timeout_add_fuŒ
 (
G_PRIORITY_LOW
, 
timeout
, 
timî_h™dÀr
, 
NULL
, NULL);

95 
idÀ_id
 = 0;

97  
FALSE
;

98 
	}
}

101 
	$dynobj_ª‰esh_kick
()

103 i‡(!
idÀ_id
)

104 
idÀ_id
 = 
	`g_idÀ_add_fuŒ
 (
G_PRIORITY_LOW
, 
idÀ_h™dÀr
, 
NULL
, NULL);

105 
	}
}

108 
	$dynobj_ª‰esh_öô
()

111 
	}
}

114 
	$dynobj_ª‰esh_föish
 ()

116 i‡(
timî_id
)

117 
	`g_sour˚_ªmove
 (
timî_id
);

118 i‡(
idÀ_id
)

119 
	`g_sour˚_ªmove
(
idÀ_id
);

120 
	}
}

	@O:\tool\dvs50\app\dynamic_refresh.h

22 #i‚de‡
DYNAMIC_REFRESH_H


23 
	#DYNAMIC_REFRESH_H


	)

26 
dynobj_ª‰esh_öô
();

29 
dynobj_ª‰esh_föish
();

32 
dynobj_ª‰esh_kick
();

	@O:\tool\dvs50\app\exit_dialog.c

24 
	~<c⁄fig.h
>

26 
	~"exô_dülog.h
"

28 
	~"öé.h
"

30 
	~<gtk/gtk.h
>

32 
	~<glib.h
>

34 
	#EXIT_DIALOG_TREEVIEW
 "EXIT_DIALOG_TREEVIEW"

	)

37 
	mCHECK_COL
,

38 
	mNAME_COL
,

39 
	mPATH_COL
,

40 
	mDATA_COL
,

41 
	mNUM_COL


44 
£À˘ed_°©e_£t_Æl
 (
GtkTªeVõw
 * 
åìvõw
,

45 
gboﬁón
 
°©e
);

47 
göt
 
gë_£À˘ed_ôems
 (
GtkWidgë
 * 
dülog
,

48 
exô_dülog_ôem_¨øy_t
 ** 
ôems
);

51 
exô_dülog_de°roy
 (
GtkWidgë
 * 
exô_dülog
,

52 
gpoöãr
 
d©a
);

54 
£À˘_Æl_˛icked
 (
GtkBuâ⁄
 * 
buâ⁄
,

55 
gpoöãr
 
d©a
);

57 
£À˘_n⁄e_˛icked
 (
GtkBuâ⁄
 * 
buâ⁄
,

58 
gpoöãr
 
d©a
);

60 
toggÀ_check_buâ⁄
 (
GtkCñlRídîîToggÀ
 * 
ªndîî
,

61 
gch¨
 * 
∑th
,

62 
GtkTªeVõw
 * 
åìvõw
);

71 
GtkWidgë
 *

72 
	$exô_dülog_make
 (
GtkWödow
 * 
∑ª¡_wödow
,

73 
gch¨
 * 
tôÀ
)

75 
GtkWidgë
 * 
dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
 (
tôÀ
, 
∑ª¡_wödow
,

76 
GTK_DIALOG_MODAL
,

77 
	`_
("Do Not Exit"),

78 
EXIT_DIALOG_EXIT_CANCEL
,

79 
	`_
("Exit Without Save"),

80 
EXIT_DIALOG_EXIT_NO_SAVE
,

81 
	`_
("Save Selected"),

82 
EXIT_DIALOG_EXIT_SAVE_SELECTED
,

83 
NULL
);

85 
GtkBox
 * 
vbox
 = 
	`GTK_BOX
 (
	`GTK_DIALOG
(
dülog
)->vbox);

87 
GtkWidgë
 * 
œbñ
 = 
	`gtk_œbñ_√w
 (
	`_
("The followingáreÇot saved:"));

89 
GtkWidgë
 * 
s¸ﬁÀd
;

90 
GtkWidgë
 * 
buâ⁄
;

91 
GtkWidgë
 * 
hbox
;

93 
GtkWidgë
 * 
åìvõw
;

94 
GtkLi°St‹e
 * 
modñ
;

95 
GtkCñlRídîî
 * 
ªndîî
;

96 
GtkTªeVõwCﬁumn
 * 
cﬁumn
;

98 
	`gtk_box_∑ck_°¨t
 (
vbox
, 
œbñ
, 
FALSE
, FALSE, 0);

100 
	`gtk_widgë_show
 (
œbñ
);

103 
s¸ﬁÀd
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

104 
	`gtk_box_∑ck_°¨t
 (
vbox
, 
s¸ﬁÀd
, 
TRUE
, TRUE, 0);

105 
	`gtk_widgë_show
 (
s¸ﬁÀd
);

107 
modñ
 = 
	`gtk_li°_°‹e_√w
 (
NUM_COL
, 
G_TYPE_BOOLEAN
, 
G_TYPE_STRING
, G_TYPE_STRING, 
G_TYPE_POINTER
);

109 
åìvõw
 = 
	`gtk_åì_võw_√w_wôh_modñ
 ( 
	`GTK_TREE_MODEL
(
modñ
));

111 
ªndîî
 = 
	`gtk_˚Œ_ªndîî_toggÀ_√w
 ();

113 
cﬁumn
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
 (
	`_
("Save"), 
ªndîî
,

114 "a˘ive", 
CHECK_COL
,

115 
NULL
);

116 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
	`GTK_TREE_VIEW
 (
åìvõw
), 
cﬁumn
);

118 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
ªndîî
), "toggled",

119 
	`G_CALLBACK
 (
toggÀ_check_buâ⁄
),

120 
åìvõw
);

122 
ªndîî
 = 
	`gtk_˚Œ_ªndîî_ãxt_√w
 ();

123 
cﬁumn
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
 (
	`_
("Name"), 
ªndîî
,

124 "ãxt", 
NAME_COL
,

125 
NULL
);

126 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
	`GTK_TREE_VIEW
 (
åìvõw
), 
cﬁumn
);

128 
ªndîî
 = 
	`gtk_˚Œ_ªndîî_ãxt_√w
 ();

129 
cﬁumn
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
 (
	`_
("P©h"), 
ªndîî
,

130 "ãxt", 
PATH_COL
,

131 
NULL
);

132 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
	`GTK_TREE_VIEW
 (
åìvõw
), 
cﬁumn
);

135 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd
), 
	`GTK_WIDGET
 (
åìvõw
));

138 
hbox
 = 
	`gtk_hbox_√w
 (
FALSE
, 3);

139 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, FALSE, 0);

140 
	`gtk_widgë_show
 (
hbox
);

142 
buâ⁄
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
 (
	`_
("Select All"));

143 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
buâ⁄
, 
FALSE
, FALSE, 3);

144 
	`gtk_widgë_show
 (
buâ⁄
);

146 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
buâ⁄
), "clicked",

147 
	`G_CALLBACK
 (
£À˘_Æl_˛icked
),

148 
åìvõw
);

150 
buâ⁄
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
 (
	`_
("Select None"));

151 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
buâ⁄
, 
FALSE
, FALSE, 3);

152 
	`gtk_widgë_show
 (
buâ⁄
);

154 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
buâ⁄
), "clicked",

155 
	`G_CALLBACK
 (
£À˘_n⁄e_˛icked
),

156 
åìvõw
);

158 
	`g_obje˘_uƒef
 (
modñ
);

159 
	`gtk_widgë_show
 (
	`GTK_WIDGET
 (
åìvõw
));

161 
	`gtk_widgë_show_Æl
 (
	`GTK_WIDGET
(
vbox
));

163 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
dülog
), 
EXIT_DIALOG_TREEVIEW
, 
åìvõw
);

165 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
dülog
), "destroy",

166 
	`G_CALLBACK
 (
exô_dülog_de°roy
),

167 
åìvõw
);

169  
dülog
;

170 
	}
}

180 
	$exô_dülog_add_ôem
 (
GtkWidgë
 * 
dülog
,

181 c⁄° 
gch¨
 * 
«me
,

182 c⁄° 
gch¨
 * 
∑th
,

183 c⁄° 
gpoöãr
 
›ti⁄Æ_d©a
)

185 
GtkTªeVõw
 * 
åìvõw
;

186 
GtkTªeIãr
 
ôî
;

187 
GtkLi°St‹e
 * 
modñ
;

188 c⁄° 
gch¨
 * 
«me_c›y
 = 
	`g_°rdup
 (
«me
);

189 c⁄° 
gch¨
 * 
∑th_c›y
 = 
	`g_°rdup
 (
∑th
);

191 
åìvõw
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
dülog
), 
EXIT_DIALOG_TREEVIEW
);

193 
modñ
 = 
	`GTK_LIST_STORE
 (
	`gtk_åì_võw_gë_modñ
 (
åìvõw
));

195 
	`gtk_li°_°‹e_≠≥nd
 (
modñ
, &
ôî
);

197 
	`gtk_li°_°‹e_£t
 (
modñ
, &
ôî
,

198 
CHECK_COL
, 1,

199 
NAME_COL
, 
«me_c›y
,

200 
PATH_COL
, 
∑th_c›y
,

201 
DATA_COL
, 
›ti⁄Æ_d©a
,

203 
	}
}

205 
göt


206 
	$exô_dülog_run
 (
GtkWidgë
 * 
dülog
,

207 
exô_dülog_ôem_¨øy_t
 ** 
ôems
)

209 
göt
 
ªsu…
;

210 
göt
 
cou¡
;

212 
TRUE
)

214 
ªsu…
 = 
	`gtk_dülog_run
 ( 
	`GTK_DIALOG
(
dülog
));

216 
ªsu…
)

218 
EXIT_DIALOG_EXIT_CANCEL
:

219 
EXIT_DIALOG_EXIT_NO_SAVE
:

220 *
ôems
 = 
NULL
;

221  
ªsu…
;

222 
EXIT_DIALOG_EXIT_SAVE_SELECTED
 :

225  
EXIT_DIALOG_EXIT_CANCEL
;

228 
cou¡
 = 
	`gë_£À˘ed_ôems
 (
dülog
, 
ôems
);

230 i‡(
cou¡
 == 0)

232 
GtkWidgë
 * 
msg_dülog
 = 
	`gtk_mesßge_dülog_√w
 (
	`GTK_WINDOW
 (
dülog
),

233 
GTK_DIALOG_MODAL
,

234 
GTK_MESSAGE_WARNING
,

235 
GTK_BUTTONS_YES_NO
,

236 
	`_
("Nothing selected for saving. Would youÜikeÅoÅryágain?"));

238 
göt
 
yes_‹_no
 = 
	`gtk_dülog_run
 (
	`GTK_DIALOG
 (
msg_dülog
));

240 
	`gtk_widgë_de°roy
 (
msg_dülog
);

242 i‡(
yes_‹_no
 =
GTK_RESPONSE_NO
)

244  
EXIT_DIALOG_EXIT_NO_SAVE
;

249  
EXIT_DIALOG_EXIT_SAVE_SELECTED
;

252 
	}
}

261 
göt


262 
	$gë_£À˘ed_ôems
 (
GtkWidgë
 * 
dülog
,

263 
exô_dülog_ôem_¨øy_t
 ** 
ôems
)

265 
GtkTªeVõw
 * 
åìvõw
;

266 
GtkTªeIãr
 
ôî
;

267 
GtkLi°St‹e
 * 
modñ
;

268 
gboﬁón
 
vÆid
;

269 
GSLi°
 * 
li°
 = 
NULL
;

270 
GSLi°
 * 
li°_ôî
;

271 
göt
 
£À˘ed_cou¡
;

272 
göt
 
i
;

274 
åìvõw
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
dülog
), 
EXIT_DIALOG_TREEVIEW
);

276 
modñ
 = 
	`GTK_LIST_STORE
 (
	`gtk_åì_võw_gë_modñ
 (
åìvõw
));

279 
vÆid
 = 
	`gtk_åì_modñ_gë_ôî_fú°
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
);

282 
vÆid
)

284 c⁄° * 
«me
;

285 c⁄° * 
∑th
;

286 
gpoöãr
 
d©a
;

287 
gboﬁón
 
is_£À˘ed
;

289 
	`gtk_åì_modñ_gë
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
,

290 
CHECK_COL
, &
is_£À˘ed
,

291 
NAME_COL
, &
«me
,

292 
PATH_COL
, &
∑th
,

293 
DATA_COL
, &
d©a
,

296 i‡(
is_£À˘ed
)

298 
exô_dülog_ôem_t
 * 
ôem
 = 
	`g_√w
 (exit_dialog_item_t,1);

299 
ôem
->
«me
 =Çame;

300 
ôem
->
∑th
 =Öath;

301 
ôem
->
d©a
 = data;

302 
li°
 = 
	`g_¶i°_¥ïíd
 (li°, 
ôem
);

305 
vÆid
 = 
	`gtk_åì_modñ_ôî_√xt
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
);

308 
£À˘ed_cou¡
 = 
	`g_¶i°_Àngth
 (
li°
);

310 i‡(
£À˘ed_cou¡
 > 0)

312 *
ôems
 = 
	`g_√w
 (
exô_dülog_ôem_¨øy_t
,1);

313 (*
ôems
)->
¨øy_size
 = 
£À˘ed_cou¡
;

314 (*
ôems
)->
¨øy
 = 
	`g_√w
 (
exô_dülog_ôem_t
, (*ôems)->
¨øy_size
);

316 
li°_ôî
 = 
li°
;

317 
i
 = 0 ; i < 
£À˘ed_cou¡
 ; i++)

319 
exô_dülog_ôem_t
 * 
ôem
 = 
li°_ôî
->
d©a
;

320 (*
ôems
)->
¨øy
[
i
].
«me
 = 
ôem
->name;

321 (*
ôems
)->
¨øy
[
i
].
∑th
 = 
ôem
->path;

322 (*
ôems
)->
¨øy
[
i
].
d©a
 = 
ôem
->data;

323 
li°_ôî
 = 
	`g_¶i°_√xt
(list_iter);

326 
	`g_¶i°_‰ì
 (
li°
);

330 *
ôems
 = 
NULL
;

333  
£À˘ed_cou¡
;

334 
	}
}

341 
	$exô_dülog_‰ì_ôems
 (
exô_dülog_ôem_¨øy_t
 * 
ôems
)

343 i‡(
ôems
)

345 
i
;

346 
i
 = 0 ; i < 
ôems
->
¨øy_size
 ; i++)

349 
	`g_‰ì
 ( (*)
ôems
->
¨øy
[
i
].
«me
);

350 
	`g_‰ì
 ( (*)
ôems
->
¨øy
[
i
].
∑th
);

353 
	`g_‰ì
 (
ôems
);

355 
	}
}

362 
	$toggÀ_check_buâ⁄
 (
GtkCñlRídîîToggÀ
 * 
ªndîî
,

363 
gch¨
 * 
∑th
,

364 
GtkTªeVõw
 * 
åìvõw
)

366 
GtkTªeModñ
 * 
modñ
;

367 
GtkTªeIãr
 
ôî
;

368 
gboﬁón
 
vÆue
;

370 
modñ
 = 
	`gtk_åì_võw_gë_modñ
 (
åìvõw
);

371 i‡(
	`gtk_åì_modñ_gë_ôî_‰om_°rög
 (
modñ
, &
ôî
, 
∑th
))

373 
	`gtk_åì_modñ_gë
 (
modñ
, &
ôî
, 
CHECK_COL
, &
vÆue
, -1);

374 
	`gtk_li°_°‹e_£t
 (
	`GTK_LIST_STORE
 (
modñ
), &
ôî
, 
CHECK_COL
, !
vÆue
, -1);

376 
	}
}

384 
	$exô_dülog_de°roy
 (
GtkWidgë
 * 
exô_dülog
,

385 
gpoöãr
 
d©a
)

387 
GtkTªeVõw
 * 
åìvõw
;

388 
GtkTªeIãr
 
ôî
;

389 
GtkTªeModñ
 * 
modñ
;

390 
gboﬁón
 
vÆid
;

392 
åìvõw
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
exô_dülog
), 
EXIT_DIALOG_TREEVIEW
);

394 
modñ
 = 
	`GTK_TREE_MODEL
 (
	`gtk_åì_võw_gë_modñ
 (
åìvõw
));

397 
vÆid
 = 
	`gtk_åì_modñ_gë_ôî_fú°
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
);

399 
vÆid
)

401 
gch¨
 * 
«me
 = 
NULL
;

402 
gch¨
 * 
∑th
 = 
NULL
;

404 
	`gtk_åì_modñ_gë
 (
modñ
, &
ôî
,

405 
NAME_COL
, &
«me
,

406 
PATH_COL
, &
∑th
,

409 
	`g_‰ì
 (
«me
);

410 
	`g_‰ì
 (
∑th
);

412 
vÆid
 = 
	`gtk_åì_modñ_ôî_√xt
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
);

414 
	}
}

422 
	$£À˘ed_°©e_£t_Æl
 (
GtkTªeVõw
 * 
åìvõw
,

423 
gboﬁón
 
°©e
)

425 
GtkTªeIãr
 
ôî
;

426 
GtkLi°St‹e
 * 
modñ
;

427 
gboﬁón
 
vÆid
;

429 
modñ
 = 
	`GTK_LIST_STORE
 (
	`gtk_åì_võw_gë_modñ
 (
åìvõw
));

432 
vÆid
 = 
	`gtk_åì_modñ_gë_ôî_fú°
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
);

434 
vÆid
)

436 
	`gtk_li°_°‹e_£t
 (
modñ
, &
ôî
,

437 
CHECK_COL
, 
°©e
,

440 
vÆid
 = 
	`gtk_åì_modñ_ôî_√xt
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
);

442 
	}
}

450 
	$£À˘_Æl_˛icked
 (
GtkBuâ⁄
 * 
buâ⁄
,

451 
gpoöãr
 
d©a
)

453 
	`£À˘ed_°©e_£t_Æl
 (
d©a
, 
TRUE
);

454 
	}
}

462 
	$£À˘_n⁄e_˛icked
 (
GtkBuâ⁄
 * 
buâ⁄
,

463 
gpoöãr
 
d©a
)

465 
	`£À˘ed_°©e_£t_Æl
 (
d©a
, 
FALSE
);

466 
	}
}

	@O:\tool\dvs50\app\exit_dialog.h

22 #i‚de‡
EXIT_DIALOG_H


23 
	#EXIT_DIALOG_H


	)

25 
	~<gtk/gtkwidgë.h
>

26 
	~<gtk/gtkwödow.h
>

28 
G_BEGIN_DECLS


31 
	mEXIT_DIALOG_EXIT_NO_SAVE
,

32 
	mEXIT_DIALOG_EXIT_SAVE_SELECTED
,

33 
	mEXIT_DIALOG_EXIT_CANCEL


36 
GtkWidgë
 *

37 
exô_dülog_make
 (
GtkWödow
 * 
∑ª¡_wödow
,

38 
gch¨
 * 
tôÀ
);

41 
exô_dülog_add_ôem
 (
GtkWidgë
 * 
dülog
,

42 c⁄° 
gch¨
 * 
«me
,

43 c⁄° 
gch¨
 * 
fûï©h
,

44 c⁄° 
gpoöãr
 
›ti⁄Æ_d©a
);

48 c⁄° 
gch¨
 * 
	m«me
;

49 c⁄° 
gch¨
 * 
	m∑th
;

50 
gpoöãr
 
	md©a
;

52 } 
	texô_dülog_ôem_t
;

56 
size_t
 
	m¨øy_size
;

57 
exô_dülog_ôem_t
 * 
	m¨øy
;

59 } 
	texô_dülog_ôem_¨øy_t
;

61 
göt


62 
exô_dülog_run
 (
GtkWidgë
 * 
dülog
,

63 
exô_dülog_ôem_¨øy_t
 ** 
ôems_to_ßve
);

65 
exô_dülog_‰ì_ôems
 (
exô_dülog_ôem_¨øy_t
 *);

67 
	gG_END_DECLS


	@O:\tool\dvs50\app\filedlg.c

22 
	~<c⁄fig.h
>

24 
	~<sys/ty≥s.h
>

25 
	~<sys/°©.h
>

26 
	~<°rög.h
>

27 #ifde‡
HAVE_UNISTD_H


28 
	~<uni°d.h
>

30 
	~<°dio.h
>

31 
	~<glib/g°dio.h
>

33 #unde‡
GTK_DISABLE_DEPRECATED


34 
	~<gtk/gtk.h
>

35 
	~"öé.h
"

36 
	~"fûãr.h
"

37 
	~"dü_dús.h
"

38 
	~"≥rsi°í˚.h
"

39 
	~"di•œy.h
"

40 
	~"mesßge.h
"

41 
	~"œyî_dülog.h
"

42 
	~"lﬂd_ßve.h
"

43 
	~"¥e„ªn˚s.h
"

44 
	~"öãrÁ˚.h
"

45 
	~"ª˚¡_fûes.h
"

46 
	~"c⁄fúm.h
"

48 
	~"fûedlg.h
"

50 
GtkWidgë
 *
	g›ídlg
 = 
NULL
;

51 
GtkWidgë
 *
	gßvedlg
 = 
NULL
;

52 
GtkWidgë
 *
	gexp‹tdlg
 = 
NULL
;

55 
	$toggÀ_com¥ess_ˇŒback
(
GtkWidgë
 *
widgë
)

62 
¥efs
.
√w_dügøm
.
com¥ess_ßve
 =

63 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
widgë
));

64 
	}
}

70 
DüImp‹tFûãr
 *

71 
	$ifûãr_by_ödex
 (
ödex
, c⁄° * 
fûíame
)

73 
DüImp‹tFûãr
 *
ifûãr
 = 
NULL
;

75 i‡(
ödex
 >= 0)

76 
ifûãr
 = 
	`g_li°_¡h_d©a
 (
	`fûãr_gë_imp‹t_fûãrs
(), 
ödex
);

77 i‡(
fûíame
)

78 
ifûãr
 = 
	`fûãr_guess_imp‹t_fûãr
(
fûíame
);

80  
ifûãr
;

81 
	}
}

83 * (* 
	tFûãrGuessFunc
Ë(c⁄° 
	tgch¨
* 
	tfûíame
);

89 
gboﬁón


90 
	$m©chög_exãnsi⁄s_fûãr
 (c⁄° 
GtkFûeFûãrInfo
* 
fi
,

91 
gpoöãr
 
d©a
)

93 
FûãrGuessFunc
 
guess_func
 = (FûãrGuessFunc)
d©a
;

95 
	`g_as£π
 (
guess_func
);

97 i‡(!
fi
->
fûíame
)

100 i‡(
	`guess_func
 (
fi
->
fûíame
))

104 
	}
}

116 
	$dügøm_ªmoved
 (
Dügøm
* 
dü
, 
GtkWidgë
* 
dülog
)

118 
	`g_ªtu∫_if_Áû
 (
	`DIA_IS_DIAGRAM
 (
dü
));

119 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WIDGET
 (
dülog
));

121 
	`gtk_widgë_de°roy
 (
dülog
);

122 
	}
}

125 
GtkFûeFûãr
 *

126 
	$buûd_gtk_fûe_fûãr_‰om_ödex
 (
ödex
)

128 
DüImp‹tFûãr
 *
ifûãr
 = 
NULL
;

129 
GtkFûeFûãr
 *
fûãr
 = 
NULL
;

131 
ifûãr
 = 
	`g_li°_¡h_d©a
 (
	`fûãr_gë_imp‹t_fûãrs
(), 
ödex
-1);

132 i‡(
ifûãr
) {

133 
GSåög
 *
∑âîn
 = 
	`g_°rög_√w
 ("*.");

134 
i
 = 0;

136 
fûãr
 = 
	`gtk_fûe_fûãr_√w
 ();

138 
ifûãr
->
exãnsi⁄s
[
i
] !
NULL
) {

139 i‡(
i
 != 0)

140 
	`g_°rög_≠≥nd
 (
∑âîn
, "|*.");

141 
	`g_°rög_≠≥nd
 (
∑âîn
, 
ifûãr
->
exãnsi⁄s
[
i
]);

142 ++
i
;

144 
	`gtk_fûe_fûãr_£t_«me
 (
fûãr
, 
	`_
("Supported Formats"));

145 
	`gtk_fûe_fûãr_add_∑âîn
 (
fûãr
, 
∑âîn
->
°r
);

147 
	`g_°rög_‰ì
 (
∑âîn
, 
TRUE
);

151 
fûãr
 = 
	`gtk_fûe_fûãr_√w
 ();

152 
	`gtk_fûe_fûãr_£t_«me
 (
fûãr
, 
	`_
("Supported Formats"));

153 
	`gtk_fûe_fûãr_add_cu°om
 (
fûãr
, 
GTK_FILE_FILTER_FILENAME
,

154 
m©chög_exãnsi⁄s_fûãr
, 
fûãr_guess_imp‹t_fûãr
, 
NULL
);

156  
fûãr
;

157 
	}
}

160 
	$imp‹t_ad≠t_exãnsi⁄_ˇŒback
(
GtkWidgë
 *
widgë
)

162 
ödex
 = 
	`gtk_combo_box_gë_a˘ive
 (
	`GTK_COMBO_BOX
(
widgë
));

163 
GtkFûeFûãr
 *
f‹mî
 = 
NULL
;

164 
GSLi°
 *
li°
, *
ñem
;

166 
li°
 = 
	`gtk_fûe_choo£r_li°_fûãrs
 (
	`GTK_FILE_CHOOSER
 (
›ídlg
));

167 
ñem
 = 
li°
;ÉÀm !
NULL
;ÉÀm = 
	`g_¶i°_√xt
 (elem))

168 i‡(
	`°rcmp
 (
	`_
("Suµ‹ãd F‹m©s"), 
	`gtk_fûe_fûãr_gë_«me
 (
	`GTK_FILE_FILTER
(
ñem
->
d©a
))) == 0)

169 
f‹mî
 = 
	`GTK_FILE_FILTER
(
ñem
->
d©a
);

170 
	`g_¶i°_‰ì
 (
li°
);

172 i‡(
f‹mî
) {

174 
GtkFûeFûãr
 *
fûãr
 = 
	`buûd_gtk_fûe_fûãr_‰om_ödex
 (
ödex
);

175 
	`gtk_fûe_choo£r_ªmove_fûãr
 (
	`GTK_FILE_CHOOSER
 (
›ídlg
), 
f‹mî
);

176 
	`gtk_fûe_choo£r_add_fûãr
 (
	`GTK_FILE_CHOOSER
 (
›ídlg
), 
fûãr
);

177 
	`gtk_fûe_choo£r_£t_fûãr
 (
	`GTK_FILE_CHOOSER
 (
›ídlg
), 
fûãr
);

179 
	}
}

184 
GtkWidgë
 *

185 
	$¸óã_›í_míu
()

187 
GtkWidgë
 *
míu
;

188 
GLi°
 *
tmp
;

191 
míu
 = 
	`gtk_combo_box_√w_ãxt
 ();

192 
	`gtk_combo_box_≠≥nd_ãxt
(
	`GTK_COMBO_BOX
(
míu
), 
	`_
("ByÉxtension"));

194 
tmp
 = 
	`fûãr_gë_imp‹t_fûãrs
();Åm∞!
NULL
;Åm∞tmp->
√xt
) {

195 
DüImp‹tFûãr
 *
ifûãr
 = 
tmp
->
d©a
;

196 
gch¨
 *
fûãr_œbñ
;

198 i‡(!
ifûãr
)

200 
fûãr_œbñ
 = 
	`fûãr_gë_imp‹t_fûãr_œbñ
(
ifûãr
);

201 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
(
míu
), 
fûãr_œbñ
);

202 
	`g_‰ì
(
fûãr_œbñ
);

204 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
míu
), "changed",

205 
	`G_CALLBACK
(
imp‹t_ad≠t_exãnsi⁄_ˇŒback
), 
NULL
);

206  
míu
;

207 
	}
}

213 
	$fûe_›í_ª•⁄£_ˇŒback
(
GtkWidgë
 *
fs
,

214 
göt
 
ª•⁄£
,

215 
gpoöãr
 
u£r_d©a
)

217 *
fûíame
;

218 
Dügøm
 *
dügøm
 = 
NULL
;

220 i‡(
ª•⁄£
 =
GTK_RESPONSE_ACCEPT
) {

221 
göt
 
ödex
 = 
	`gtk_combo_box_gë_a˘ive
 (
	`GTK_COMBO_BOX
(
u£r_d©a
));

223 i‡(
ödex
 >= 0)

224 
	`≥rsi°í˚_£t_öãgî
 ("imp‹t-fûãr", 
ödex
);

225 
fûíame
 = 
	`gtk_fûe_choo£r_gë_fûíame
(
	`GTK_FILE_CHOOSER
(
fs
));

227 
dügøm
 = 
	`dügøm_lﬂd
(
fûíame
, 
	`ifûãr_by_ödex
 (
ödex
 - 1, filename));

229 
	`g_‰ì
 (
fûíame
);

231 i‡(
dügøm
 !
NULL
) {

232 
	`dügøm_upd©e_exã¡s
(
dügøm
);

233 
	`œyî_dülog_£t_dügøm
(
dügøm
);

235 i‡(
dügøm
->
di•œys
 =
NULL
) {

247 
	`√w_di•œy
(
dügøm
);

251 
	`gtk_widgë_de°roy
(
›ídlg
);

252 
	}
}

260 
	$fûe_›í_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

262 i‡(!
›ídlg
) {

263 
DDi•œy
 *
ddi•
;

264 
Dügøm
 *
dü
 = 
NULL
;

265 
GtkWödow
 *
∑ª¡_wödow
;

266 
gch¨
 *
fûíame
 = 
NULL
;

273 
ddi•
 = 
	`ddi•œy_a˘ive
();

274 i‡(
ddi•
) {

275 
dü
 = 
ddi•
->
dügøm
;

276 
∑ª¡_wödow
 = 
	`GTK_WINDOW
(
ddi•
->
shñl
);

278 
∑ª¡_wödow
 = 
	`GTK_WINDOW
(
	`öãrÁ˚_gë_toﬁbox_shñl
());

280 
	`≥rsi°í˚_ªgi°î_öãgî
 ("import-filter", 0);

281 
›ídlg
 = 
	`gtk_fûe_choo£r_dülog_√w_wôh_backíd
(
	`_
("O≥¿Dügøm"), 
∑ª¡_wödow
,

282 
GTK_FILE_CHOOSER_ACTION_OPEN
,

284 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

285 
GTK_STOCK_OPEN
, 
GTK_RESPONSE_ACCEPT
,

286 
NULL
);

287 
	`gtk_dülog_£t_deÁu…_ª•⁄£
(
	`GTK_DIALOG
(
›ídlg
), 
GTK_RESPONSE_ACCEPT
);

288 
	`gtk_wödow_£t_rﬁe
(
	`GTK_WINDOW
(
›ídlg
), "open_diagram");

289 i‡(
dü
 && dü->
fûíame
)

290 
fûíame
 = 
	`g_fûíame_‰om_utf8
(
dü
->fûíame, -1, 
NULL
, NULL, NULL);

291 i‡(
fûíame
 !
NULL
) {

292 * 
‚abs
 = 
	`dü_gë_absﬁuã_fûíame
 (
fûíame
);

293 i‡(
‚abs
)

294 
	`gtk_fûe_choo£r_£t_fûíame
(
	`GTK_FILE_CHOOSER
(
›ídlg
), 
‚abs
);

295 
	`g_‰ì
(
‚abs
);

296 
	`g_‰ì
(
fûíame
);

298 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
›ídlg
), "destroy",

299 
	`G_CALLBACK
(
gtk_widgë_de°royed
), &
›ídlg
);

301 
	`gtk_widgë_£t_£nsôive
(
›ídlg
, 
TRUE
);

302 i‡(
	`GTK_WIDGET_VISIBLE
(
›ídlg
))

305 i‡(!
	`gtk_fûe_choo£r_gë_exåa_widgë
(
	`GTK_FILE_CHOOSER
(
›ídlg
))) {

306 
GtkWidgë
 *
hbox
, *
œbñ
, *
omíu
, *
›ti⁄s
;

307 
GtkFûeFûãr
* 
fûãr
;

309 
›ti⁄s
 = 
	`gtk_‰ame_√w
(
	`_
("Open Options"));

310 
	`gtk_‰ame_£t_shadow_ty≥
(
	`GTK_FRAME
(
›ti⁄s
), 
GTK_SHADOW_ETCHED_IN
);

312 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 1);

313 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
hbox
), 5);

314 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
›ti⁄s
), 
hbox
);

315 
	`gtk_widgë_show
(
hbox
);

317 
œbñ
 = 
	`gtk_œbñ_√w
 (
	`_
("Determine fileÅype:"));

318 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
œbñ
, 
FALSE
, 
TRUE
, 0);

319 
	`gtk_widgë_show
 (
œbñ
);

321 
omíu
 = 
	`¸óã_›í_míu
();

322 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
hbox
), 
omíu
, 
TRUE
, TRUE, 0);

323 
	`gtk_widgë_show
(
omíu
);

325 
	`gtk_fûe_choo£r_£t_exåa_widgë
(
	`GTK_FILE_CHOOSER
(
›ídlg
),

326 
›ti⁄s
);

328 
	`gtk_widgë_show
(
›ti⁄s
);

329 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
›ídlg
), "response",

330 
	`G_CALLBACK
(
fûe_›í_ª•⁄£_ˇŒback
), 
omíu
);

334 
	`gtk_fûe_choo£r_add_fûãr
 (
	`GTK_FILE_CHOOSER
 (
›ídlg
),

335 
	`buûd_gtk_fûe_fûãr_‰om_ödex
 (0));

336 
fûãr
 = 
	`gtk_fûe_fûãr_√w
 ();

337 
	`gtk_fûe_fûãr_£t_«me
 (
fûãr
, 
	`_
("All Files"));

338 
	`gtk_fûe_fûãr_add_∑âîn
 (
fûãr
, "*");

339 
	`gtk_fûe_choo£r_add_fûãr
 (
	`GTK_FILE_CHOOSER
 (
›ídlg
), 
fûãr
);

341 
	`gtk_combo_box_£t_a˘ive
 (
	`GTK_COMBO_BOX
 (
omíu
), 
	`≥rsi°í˚_gë_öãgî
 ("import-filter"));

344 
	`gtk_widgë_show
(
›ídlg
);

345 
	}
}

351 
	$fûe_ßve_as_ª•⁄£_ˇŒback
(
GtkWidgë
 *
fs
,

352 
göt
 
ª•⁄£
,

353 
gpoöãr
 
u£r_d©a
)

355 *
fûíame
;

356 
Dügøm
 *
dü
;

357 
°©
 
°©_°ru˘
;

359 i‡(
ª•⁄£
 =
GTK_RESPONSE_ACCEPT
) {

360 
dü
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
(
fs
), "user_data");

362 
fûíame
 = 
	`gtk_fûe_choo£r_gë_fûíame
(
	`GTK_FILE_CHOOSER
(
fs
));

364 i‡(
	`g_°©
(
fûíame
, &
°©_°ru˘
) == 0) {

365 
GtkWidgë
 *
dülog
 = 
NULL
;

366 *
utf8fûíame
 = 
NULL
;

367 i‡(!
	`g_utf8_vÆid©e
(
fûíame
, -1, 
NULL
)) {

368 
utf8fûíame
 = 
	`g_fûíame_to_utf8
(
fûíame
, -1, 
NULL
, NULL, NULL);

369 i‡(
utf8fûíame
 =
NULL
) {

370 
	`mesßge_w¨nög
(
	`_
("Some characters inÅhe filenameáreÇeither UTF-8\n"

374 i‡(
utf8fûíame
 =
NULL
Ëutf8fûíamê
	`g_°rdup
(
fûíame
);

377 
dülog
 = 
	`gtk_mesßge_dülog_√w
 (
	`GTK_WINDOW
(
fs
),

378 
GTK_DIALOG_MODAL
, 
GTK_MESSAGE_QUESTION
,

379 
GTK_BUTTONS_YES_NO
,

380 
	`_
("FileálreadyÉxists"));

381 
	`gtk_mesßge_dülog_f‹m©_£c⁄d¨y_ãxt
(
	`GTK_MESSAGE_DIALOG
(
dülog
),

382 
	`_
("The file '%s'álreadyÉxists.\n"

383 "Dÿyou w™àtÿovîwrôêô?"), 
utf8fûíame
);

384 
	`g_‰ì
(
utf8fûíame
);

385 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
 (
dülog
), 
GTK_RESPONSE_YES
);

387 i‡(
	`gtk_dülog_run
 (
	`GTK_DIALOG
 (
dülog
)Ë!
GTK_RESPONSE_YES
) {

389 
	`gtk_wödow_¥e£¡
 (
	`GTK_WINDOW
 (
fs
));

390 
	`gtk_widgë_de°roy
(
dülog
);

391 
	`g_‰ì
 (
fûíame
);

394 
	`gtk_widgë_de°roy
(
dülog
);

398 
dü
->
d©a
->
is_com¥es£d
 = 0;

400 
	`dügøm_upd©e_exã¡s
(
dü
);

402 
	`dügøm_£t_fûíame
(
dü
, 
fûíame
);

403 i‡(
	`dügøm_ßve
(
dü
, 
fûíame
))

404 
	`ª˚¡_fûe_hi°‹y_add
(
fûíame
);

406 
	`g_‰ì
 (
fûíame
);

409 i‡((
dü
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
(
fs
), "u£r_d©a")Ë!
NULL
) {

410 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
(
fs
), "u£r_d©a", 
NULL
);

411 
	`g_obje˘_uƒef
 (
dü
);

413 
	`gtk_widgë_de°roy
(
	`GTK_WIDGET
(
fs
));

414 
	}
}

424 
	$fûe_ßve_as_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

426 
DDi•œy
 *
ddi•
;

427 
Dügøm
 *
dü
;

428 
gch¨
 *
fûíame
 = 
NULL
;

430 
ddi•
 = 
	`ddi•œy_a˘ive
();

431 i‡(!
ddi•
) ;

432 
dü
 = 
ddi•
->
dügøm
;

434 i‡(!
ßvedlg
) {

435 
GtkWidgë
 *
com¥essbuâ⁄
;

437 
ßvedlg
 = 
	`gtk_fûe_choo£r_dülog_√w_wôh_backíd
(
	`_
("Save Diagram"),

438 
	`GTK_WINDOW
(
ddi•
->
shñl
),

439 
GTK_FILE_CHOOSER_ACTION_SAVE
,

441 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

442 
GTK_STOCK_SAVE
, 
GTK_RESPONSE_ACCEPT
,

443 
NULL
);

444 
	`gtk_dülog_£t_deÁu…_ª•⁄£
(
	`GTK_DIALOG
(
ßvedlg
), 
GTK_RESPONSE_ACCEPT
);

445 
	`gtk_wödow_£t_rﬁe
(
	`GTK_WINDOW
(
ßvedlg
), "save_diagram");

448 
com¥essbuâ⁄
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Compress diagram files"));

449 
	`gtk_fûe_choo£r_£t_exåa_widgë
(
	`GTK_FILE_CHOOSER
(
ßvedlg
),

450 
com¥essbuâ⁄
);

452 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
com¥essbuâ⁄
),

453 
dü
->
d©a
->
is_com¥es£d
);

454 
	`gtk_widgë_£t_£nsôive
(
com¥essbuâ⁄
,
FALSE
);

455 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
com¥essbuâ⁄
), "toggled",

456 
	`G_CALLBACK
(
toggÀ_com¥ess_ˇŒback
), 
NULL
);

457 
	`gtk_widgë_show
(
com¥essbuâ⁄
);

458 #i‡
	`GTK_CHECK_VERSION
 (2,12,0)

459 
	`gtk_widgë_£t_toﬁtù_ãxt
 (
com¥essbuâ⁄
,

460 
	`_
("CompressionÑeduces file sizeÅoÜessÅhan 1/10th "

464 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
com¥essbuâ⁄
,

465 
	`_
("CompressionÑeduces file sizeÅoÜessÅhan 1/10th "

467 "¥ogøm†ˇ¬Ÿ m™ùuœã com¥es£d fûes."), 
NULL
);

469 
	`g_sig«l_c⁄√˘
 (
	`GTK_FILE_CHOOSER
(
ßvedlg
),

470 "ª•⁄£", 
	`G_CALLBACK
(
fûe_ßve_as_ª•⁄£_ˇŒback
), 
com¥essbuâ⁄
);

471 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
ßvedlg
), "destroy",

472 
	`G_CALLBACK
(
gtk_widgë_de°royed
), &
ßvedlg
);

474 
GtkWidgë
 *
com¥essbuâ⁄
 = 
	`gtk_fûe_choo£r_gë_exåa_widgë
(
	`GTK_FILE_CHOOSER
(
ßvedlg
));

475 
	`gtk_widgë_£t_£nsôive
(
ßvedlg
, 
TRUE
);

476 
	`g_sig«l_h™dÀrs_block_by_func
(
	`G_OBJECT
(
com¥essbuâ⁄
), 
toggÀ_com¥ess_ˇŒback
, 
NULL
);

477 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
com¥essbuâ⁄
),

478 
dü
->
d©a
->
is_com¥es£d
);

479 
	`g_sig«l_h™dÀrs_unblock_by_func
(
	`G_OBJECT
(
com¥essbuâ⁄
), 
toggÀ_com¥ess_ˇŒback
, 
NULL
);

480 i‡(
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
ßvedlg
), "u£r_d©a"Ë!
NULL
)

481 
	`g_obje˘_uƒef
 (
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
ßvedlg
), "user_data"));

482 i‡(
	`GTK_WIDGET_VISIBLE
(
ßvedlg
)) {

484 
	`g_obje˘_ªf
(
dü
);

485 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ßvedlg
), "u£r_d©a", 
dü
);

486 
	`gtk_wödow_¥e£¡
 (
	`GTK_WINDOW
(
ßvedlg
));

490 i‡(
dü
 && dü->
fûíame
)

491 
fûíame
 = 
	`g_fûíame_‰om_utf8
(
dü
->fûíame, -1, 
NULL
, NULL, NULL);

492 i‡(
fûíame
 !
NULL
) {

493 * 
‚abs
 = 
	`dü_gë_absﬁuã_fûíame
 (
fûíame
);

494 i‡(
‚abs
) {

495 
gch¨
 *
ba£
 = 
	`g_∑th_gë_ba£«me
(
dü
->
fûíame
);

496 
	`gtk_fûe_choo£r_£t_fûíame
(
	`GTK_FILE_CHOOSER
(
ßvedlg
), 
‚abs
);

499 
	`gtk_fûe_choo£r_£t_cuºít_«me
(
	`GTK_FILE_CHOOSER
(
ßvedlg
), 
ba£
);

500 
	`g_‰ì
(
ba£
);

502 
	`g_‰ì
(
‚abs
);

503 
	`g_‰ì
(
fûíame
);

505 
	`g_obje˘_ªf
(
dü
);

506 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ßvedlg
), "u£r_d©a", 
dü
);

508 
	`gtk_widgë_show
(
ßvedlg
);

509 
	}
}

517 
	$fûe_ßve_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

519 
Dügøm
 *
dügøm
;

521 
dügøm
 = 
	`ddi•œy_a˘ive_dügøm
();

522 i‡(!
dügøm
) ;

524 i‡(
dügøm
->
unßved
) {

525 
	`fûe_ßve_as_ˇŒback
(
d©a
, 
a˘i⁄
, 
widgë
);

527 
gch¨
 *
fûíame
 = 
	`g_fûíame_‰om_utf8
(
dügøm
->fûíame, -1, 
NULL
, NULL, NULL);

528 
	`dügøm_upd©e_exã¡s
(
dügøm
);

529 i‡(
	`dügøm_ßve
(
dügøm
, 
fûíame
))

530 
	`ª˚¡_fûe_hi°‹y_add
(
fûíame
);

531 
	`g_‰ì
 (
fûíame
);

533 
	}
}

538 
DüExp‹tFûãr
 *

539 
	$efûãr_by_ödex
 (
ödex
, c⁄° 
gch¨
** 
ext
)

541 
DüExp‹tFûãr
 *
efûãr
 = 
NULL
;

545 i‡(
ödex
 >= 0) {

546 
efûãr
 = 
	`g_li°_¡h_d©a
 (
	`fûãr_gë_exp‹t_fûãrs
(), 
ödex
);

547 i‡(
efûãr
) {

548 i‡(
ext
)

549 *
ext
 = 
efûãr
->
exãnsi⁄s
[0];

550  
efûãr
;

553 
	`g_w¨nög
 ("efûãr_by_ödex(Ëödex=%d ouào‡ønge", 
ödex
);

556  
efûãr
;

557 
	}
}

563 
	$exp‹t_ad≠t_exãnsi⁄
 (c⁄° 
gch¨
* 
«me
, 
ödex
)

565 c⁄° 
gch¨
* 
ext
 = 
NULL
;

566 
DüExp‹tFûãr
 *
efûãr
 = 
	`efûãr_by_ödex
 (
ödex
, &
ext
);

567 
gch¨
 *
ba£«me
 = 
	`g_∑th_gë_ba£«me
 (
«me
);

568 
gch¨
 *
utf8_«me
 = 
NULL
;

570 i‡(!
efûãr
 || !
ext
)

571 
utf8_«me
 = 
	`g_fûíame_to_utf8
 (
ba£«me
, -1, 
NULL
, NULL, NULL);

573 c⁄° 
gch¨
 *
œ°_dŸ
 = 
	`°ºchr
(
ba£«me
, '.');

574 
GSåög
 *
s
 = 
	`g_°rög_√w
(
ba£«me
);

575 i‡(
œ°_dŸ
)

576 
	`g_°rög_åunˇã
(
s
, 
œ°_dŸ
-
ba£«me
);

577 
	`g_°rög_≠≥nd
(
s
, ".");

578 
	`g_°rög_≠≥nd
(
s
, 
ext
);

579 
utf8_«me
 = 
	`g_fûíame_to_utf8
 (
s
->
°r
, -1, 
NULL
, NULL, NULL);

580 
	`g_°rög_‰ì
 (
s
, 
TRUE
);

582 
	`gtk_fûe_choo£r_£t_cuºít_«me
(
	`GTK_FILE_CHOOSER
(
exp‹tdlg
), 
utf8_«me
);

583 
	`g_‰ì
 (
utf8_«me
);

584 
	`g_‰ì
 (
ba£«me
);

585 
	}
}

587 
	$exp‹t_ad≠t_exãnsi⁄_ˇŒback
(
GtkWidgë
 *
widgë
)

589 
ödex
 = 
	`gtk_combo_box_gë_a˘ive
 (
	`GTK_COMBO_BOX
(
widgë
));

590 
gch¨
 *
«me
 = 
	`gtk_fûe_choo£r_gë_fûíame
(
	`GTK_FILE_CHOOSER
(
exp‹tdlg
));

592 i‡(
«me
 && 
ödex
 > 0)

593 
	`exp‹t_ad≠t_exãnsi⁄
 (
«me
, 
ödex
 - 1);

594 
	`g_‰ì
 (
«me
);

595 
	}
}

600 
GtkWidgë
 *

601 
	$¸óã_exp‹t_míu
()

603 
GtkWidgë
 *
míu
;

604 
GLi°
 *
tmp
;

606 
míu
 = 
	`gtk_combo_box_√w_ãxt
 ();

607 
	`gtk_combo_box_≠≥nd_ãxt
(
	`GTK_COMBO_BOX
(
míu
), 
	`_
("ByÉxtension"));

609 
tmp
 = 
	`fûãr_gë_exp‹t_fûãrs
();Åm∞!
NULL
;Åm∞tmp->
√xt
) {

610 
DüExp‹tFûãr
 *
ef
 = 
tmp
->
d©a
;

611 
gch¨
 *
fûãr_œbñ
;

613 i‡(!
ef
)

615 
fûãr_œbñ
 = 
	`fûãr_gë_exp‹t_fûãr_œbñ
(
ef
);

616 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
(
míu
), 
fûãr_œbñ
);

617 
	`g_‰ì
(
fûãr_œbñ
);

619 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
míu
), "changed",

620 
	`G_CALLBACK
(
exp‹t_ad≠t_exãnsi⁄_ˇŒback
), 
NULL
);

621  
míu
;

622 
	}
}

628 
	$fûe_exp‹t_ª•⁄£_ˇŒback
(
GtkWidgë
 *
fs
,

629 
göt
 
ª•⁄£
,

630 
gpoöãr
 
u£r_d©a
)

632 *
fûíame
;

633 
Dügøm
 *
dü
;

634 
DüExp‹tFûãr
 *
ef
;

635 
°©
 
°©buf
;

637 
dü
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
fs
), "user_data");

638 
	`g_as£π
 (
dü
);

640 i‡(
ª•⁄£
 =
GTK_RESPONSE_ACCEPT
) {

641 
göt
 
ödex
;

643 
	`dügøm_upd©e_exã¡s
(
dü
);

645 
fûíame
 = 
	`gtk_fûe_choo£r_gë_fûíame
(
	`GTK_FILE_CHOOSER
(
fs
));

647 i‡(
	`g_°©
(
fûíame
, &
°©buf
) == 0) {

648 
GtkWidgë
 *
dülog
 = 
NULL
;

650 
dülog
 = 
	`gtk_mesßge_dülog_√w
 (
	`GTK_WINDOW
(
fs
),

651 
GTK_DIALOG_MODAL
 | 
GTK_DIALOG_DESTROY_WITH_PARENT
,

652 
GTK_MESSAGE_QUESTION
,

653 
GTK_BUTTONS_YES_NO
,

654 
	`_
("FileálreadyÉxists"));

655 
	`gtk_mesßge_dülog_f‹m©_£c⁄d¨y_ãxt
(
	`GTK_MESSAGE_DIALOG
(
dülog
),

656 
	`_
("The file '%s'álreadyÉxists.\n"

657 "Dÿyou w™àtÿovîwrôêô?"), 
	`dü_mesßge_fûíame
(
fûíame
));

658 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
 (
dülog
), 
GTK_RESPONSE_YES
);

660 i‡(
	`gtk_dülog_run
 (
	`GTK_DIALOG
 (
dülog
)Ë!
GTK_RESPONSE_YES
) {

662 
	`gtk_widgë_de°roy
(
dülog
);

663 
	`g_‰ì
 (
fûíame
);

666 
	`gtk_widgë_de°roy
(
dülog
);

669 
ödex
 = 
	`gtk_combo_box_gë_a˘ive
 (
	`GTK_COMBO_BOX
(
u£r_d©a
));

670 i‡(
ödex
 >= 0)

671 
	`≥rsi°í˚_£t_öãgî
 ("exp‹t-fûãr", 
ödex
);

672 
ef
 = 
	`efûãr_by_ödex
 (
ödex
 - 1, 
NULL
);

673 i‡(!
ef
)

674 
ef
 = 
	`fûãr_guess_exp‹t_fûãr
(
fûíame
);

675 i‡(
ef
) {

676 
	`g_obje˘_ªf
(
dü
->
d©a
);

677 
ef
->
	`exp‹t_func
(
dü
->
d©a
, 
fûíame
, dü->fûíame,Éf->
u£r_d©a
);

678 
	`g_obje˘_uƒef
(
dü
->
d©a
);

680 
	`mesßge_îr‹
(
	`_
("CouldÇot determine whichÉxport filter\n"

681 "tÿu£Åÿßvê'%s'"), 
	`dü_mesßge_fûíame
(
fûíame
));

682 
	`g_‰ì
 (
fûíame
);

684 
	`g_obje˘_uƒef
 (
dü
);

685 
	`gtk_widgë_de°roy
(
exp‹tdlg
);

686 
	}
}

692 
	$fûe_exp‹t_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

694 
DDi•œy
 *
ddi•
;

695 
Dügøm
 *
dü
;

696 
gch¨
 *
fûíame
 = 
NULL
;

698 
ddi•
 = 
	`ddi•œy_a˘ive
();

699 i‡(!
ddi•
) ;

700 
dü
 = 
ddi•
->
dügøm
;

702 i‡(!
	`c⁄fúm_exp‹t_size
 (
dü
, 
	`GTK_WINDOW
(
ddi•
->
shñl
), 
CONFIRM_MEMORY
|
CONFIRM_PAGES
))

705 i‡(!
exp‹tdlg
) {

706 
	`≥rsi°í˚_ªgi°î_öãgî
 ("export-filter", 0);

707 
exp‹tdlg
 = 
	`gtk_fûe_choo£r_dülog_√w_wôh_backíd
(
	`_
("Export Diagram"),

708 
	`GTK_WINDOW
(
ddi•
->
shñl
),

709 
GTK_FILE_CHOOSER_ACTION_SAVE
,

711 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

712 
GTK_STOCK_SAVE
, 
GTK_RESPONSE_ACCEPT
,

713 
NULL
);

714 
	`gtk_dülog_£t_deÁu…_ª•⁄£
(
	`GTK_DIALOG
(
exp‹tdlg
), 
GTK_RESPONSE_ACCEPT
);

715 
	`gtk_wödow_£t_rﬁe
(
	`GTK_WINDOW
(
exp‹tdlg
), "export_diagram");

716 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
exp‹tdlg
), "destroy",

717 
	`G_CALLBACK
(
gtk_widgë_de°royed
), &
exp‹tdlg
);

719 i‡(!
	`gtk_fûe_choo£r_gë_exåa_widgë
(
	`GTK_FILE_CHOOSER
(
exp‹tdlg
))) {

720 
GtkWidgë
 *
hbox
, *
œbñ
, *
omíu
, *
›ti⁄s
;

721 
GtkFûeFûãr
* 
fûãr
;

723 
›ti⁄s
 = 
	`gtk_‰ame_√w
(
	`_
("Export Options"));

724 
	`gtk_‰ame_£t_shadow_ty≥
(
	`GTK_FRAME
(
›ti⁄s
), 
GTK_SHADOW_ETCHED_IN
);

726 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 1);

727 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
hbox
), 5);

728 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
›ti⁄s
), 
hbox
);

729 
	`gtk_widgë_show
(
hbox
);

731 
œbñ
 = 
	`gtk_œbñ_√w
 (
	`_
("Determine fileÅype:"));

732 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
œbñ
, 
FALSE
, 
TRUE
, 0);

733 
	`gtk_widgë_show
 (
œbñ
);

735 
omíu
 = 
	`¸óã_exp‹t_míu
();

736 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
hbox
), 
omíu
, 
TRUE
, TRUE, 0);

737 
	`gtk_widgë_show
(
omíu
);

738 
	`g_obje˘_£t_d©a
(
	`G_OBJECT
(
exp‹tdlg
), "exp‹t-míu", 
omíu
);

740 
	`gtk_widgë_show
(
›ti⁄s
);

741 
	`gtk_fûe_choo£r_£t_exåa_widgë
(
	`GTK_FILE_CHOOSER
(
exp‹tdlg
), 
›ti⁄s
);

743 
fûãr
 = 
	`gtk_fûe_fûãr_√w
 ();

744 
	`gtk_fûe_fûãr_£t_«me
 (
fûãr
, 
	`_
("All Files"));

745 
	`gtk_fûe_fûãr_add_∑âîn
 (
fûãr
, "*");

746 
	`gtk_fûe_choo£r_add_fûãr
 (
	`GTK_FILE_CHOOSER
 (
exp‹tdlg
), 
fûãr
);

748 
fûãr
 = 
	`gtk_fûe_fûãr_√w
 ();

749 
	`gtk_fûe_fûãr_£t_«me
 (
fûãr
, 
	`_
("Supported Formats"));

750 
	`gtk_fûe_fûãr_add_cu°om
 (
fûãr
, 
GTK_FILE_FILTER_FILENAME
,

751 
m©chög_exãnsi⁄s_fûãr
, 
fûãr_guess_exp‹t_fûãr
, 
NULL
);

752 
	`gtk_fûe_choo£r_add_fûãr
 (
	`GTK_FILE_CHOOSER
 (
exp‹tdlg
), 
fûãr
);

754 
	`gtk_combo_box_£t_a˘ive
 (
	`GTK_COMBO_BOX
 (
omíu
), 
	`≥rsi°í˚_gë_öãgî
 ("export-filter"));

756 
	`g_sig«l_c⁄√˘
(
	`GTK_FILE_CHOOSER
(
exp‹tdlg
),

757 "ª•⁄£", 
	`G_CALLBACK
(
fûe_exp‹t_ª•⁄£_ˇŒback
), 
omíu
);

759 i‡(
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
(
exp‹tdlg
), "user_data"))

760 
	`g_obje˘_uƒef
 (
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
(
exp‹tdlg
), "user_data"));

761 
	`g_obje˘_ªf
(
dü
);

762 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
exp‹tdlg
), "u£r_d©a", 
dü
);

763 
	`gtk_widgë_£t_£nsôive
(
exp‹tdlg
, 
TRUE
);

765 i‡(
dü
 && dü->
fûíame
)

766 
fûíame
 = 
	`g_fûíame_‰om_utf8
(
dü
->fûíame, -1, 
NULL
, NULL, NULL);

767 i‡(
fûíame
 !
NULL
) {

768 * 
‚abs
 = 
	`dü_gë_absﬁuã_fûíame
 (
fûíame
);

769 i‡(
‚abs
) {

770 *
fﬁdî
 = 
	`g_∑th_gë_dú«me
 (
‚abs
);

771 *
ba£«me
 = 
	`g_∑th_gë_ba£«me
 (
‚abs
);

773 
	`gtk_fûe_choo£r_£t_cuºít_fﬁdî
 (
	`GTK_FILE_CHOOSER
(
exp‹tdlg
), 
fﬁdî
);

774 
	`exp‹t_ad≠t_exãnsi⁄
 (
ba£«me
, 
	`≥rsi°í˚_gë_öãgî
 ("export-filter") - 1);

775 
	`g_‰ì
 (
fﬁdî
);

776 
	`g_‰ì
 (
ba£«me
);

778 
	`g_‰ì
(
‚abs
);

779 
	`g_‰ì
(
fûíame
);

782 
	`gtk_widgë_show
(
exp‹tdlg
);

783 
	}
}

	@O:\tool\dvs50\app\filedlg.h

22 #i‚de‡
FILEDLG_H


23 
	#FILEDLG_H


	)

25 
	~<gtk/gtk.h
>

27 
fûe_›í_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

28 
fûe_ßve_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

29 
fûe_ßve_as_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

30 
fûe_exp‹t_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

	@O:\tool\dvs50\app\find-and-replace.c

24 
	~<c⁄fig.h
>

26 
	~<gtk/gtk.h
>

28 
	~"öé.h
"

30 
	~"dügøm.h
"

31 
	~"di•œy.h
"

32 
	~"obje˘.h
"

33 
	~"obje˘_›s.h
"

34 
	~"c⁄√˘i⁄poöt_›s.h
"

35 
	~"undo.h
"

37 
	~"föd-™d-ª∂a˚.h
"

39 
	~"¥›öã∫Æs.h
"

42 
	mRESPONSE_FIND
 = -20,

43 
	mRESPONSE_REPLACE
 = -21,

44 
	mRESPONSE_REPLACE_ALL
 = -23

48 
	mMATCH_CASE
 = (1<<0),

49 
	mMATCH_WORD
 = (1<<1),

51 
	mMATCH_ALL_PROPERTIES
 = (1<<2)

54 
	s_SórchD©a
 {

55 c⁄° 
gch¨
 *
	mkey
;

56 
guöt
 
	mÊags
;

57 
Dügøm
 *
	mdügøm
;

58 
DüObje˘
 *
	mfú°
;

59 
DüObje˘
 *
	mfound
;

60 
DüObje˘
 *
	mœ°
;

61 
gboﬁón
 
	m£í_œ°
;

62 } 
	tSórchD©a
;

67 
gboﬁón


68 
	$_m©ch_ãxt_¥›
 (
DüObje˘
 *
obj
, c⁄° 
SórchD©a
 *
sd
, c⁄° 
gch¨
 *
ª∂a˚mít
, gch¨ **
vÆue_to_m©ch
)

70 
gboﬁón
 
is_m©ch
 = 
FALSE
;

71 
gch¨
 *
ª∂
 = 
NULL
;

73 i‡(!
vÆue_to_m©ch
 || *vÆue_to_m©ch =
NULL
)

74  
FALSE
;

77 i‡(
sd
->
Êags
 & 
MATCH_CASE
) {

78 c⁄° 
gch¨
 *
p
 = 
	`°r°r
 (*
vÆue_to_m©ch
, 
sd
->
key
);

79 
is_m©ch
 = 
p
 !
NULL
;

80 i‡(
p
 && 
ª∂a˚mít
) {

81 
gch¨
 *
a
 = 
	`g_°∫dup
 (*
vÆue_to_m©ch
, 
p
 - *value_to_match);

82 
gch¨
 *
b
 = 
	`g_°rdup
 (
p
 + 
	`°æí
(
sd
->
key
));

83 
ª∂
 = 
	`g_°rdup_¥ötf
 ("%s%s%s", 
a
, 
ª∂a˚mít
, 
b
);

84 
	`g_‰ì
 (
a
);

85 
	`g_‰ì
 (
b
);

88 
gch¨
 *
s1
 = 
	`g_utf8_ˇ£fﬁd
 (*
vÆue_to_m©ch
, -1);

89 
gch¨
 *
s2
 = 
	`g_utf8_ˇ£fﬁd
 (
sd
->
key
, -1);

90 c⁄° 
gch¨
 *
p
 = 
	`°r°r
 (
s1
, 
s2
);

91 
is_m©ch
 = 
p
 !
NULL
;

92 i‡(
p
 && 
ª∂a˚mít
) {

93 
gch¨
 *
a
 = 
	`g_°∫dup
 (*
vÆue_to_m©ch
, 
p
 - 
s1
);

94 
gch¨
 *
b
 = 
	`g_°rdup
 (*
vÆue_to_m©ch
 + 
	`°æí
(
a
Ë+ såÀn(
sd
->
key
));

95 
ª∂
 = 
	`g_°rdup_¥ötf
 ("%s%s%s", 
a
, 
ª∂a˚mít
, 
b
);

96 
	`g_‰ì
 (
a
);

97 
	`g_‰ì
 (
b
);

99 
	`g_‰ì
 (
s1
);

100 
	`g_‰ì
 (
s2
);

103 i‡(
sd
->
Êags
 & 
MATCH_WORD
)

104 
is_m©ch
 = (is_m©ch && 
	`°æí
(*
vÆue_to_m©ch
Ë=°æí(
sd
->
key
));

107 i‡(
is_m©ch
 && 
ª∂a˚mít
) {

108 
	`g_‰ì
 (*
vÆue_to_m©ch
);

109 *
vÆue_to_m©ch
 = 
ª∂
;

111 
	`g_‰ì
 (
ª∂
);

114  
is_m©ch
;

115 
	}
}

119 
GPåAºay
 *

120 
	$_m©ch_«me_¥›
 (
DüObje˘
 *
obj
, c⁄° 
SórchD©a
 *
sd
, c⁄° 
gch¨
 *
ª∂a˚mít
)

122 
Pr›îty
 *
¥›
;

123 
gch¨
 **
«me
;

124 
gboﬁón
 
is_m©ch
 = 
FALSE
;

125 
GPåAºay
 *
∂i°
 = 
NULL
;

127 i‡((
¥›
 = 
	`obje˘_¥›_by_«me
(
obj
, "«me")Ë!
NULL
)

128 
«me
 = &((
SåögPr›îty
 *)
¥›
)->
°rög_d©a
;

129 i‡((
¥›
 = 
	`obje˘_¥›_by_«me
(
obj
, "ãxt")Ë!
NULL
)

130 
«me
 = &((
TextPr›îty
 *)
¥›
)->
ãxt_d©a
;

132  
NULL
;

134 
is_m©ch
 = 
	`_m©ch_ãxt_¥›
 (
obj
, 
sd
, 
ª∂a˚mít
, 
«me
);

136 i‡(!
is_m©ch
) {

137 
¥›
->
›s
->
	`‰ì
 (prop);

138  
NULL
;

141 
∂i°
 = 
	`¥›_li°_‰om_sögÀ
 (
¥›
);

143  
∂i°
;

144 
	}
}

147 
gboﬁón


148 
	$_m©ch_¥›
 (
DüObje˘
 *
obj
, c⁄° 
SórchD©a
 *
sd
, c⁄° 
gch¨
 *
ª∂a˚mít
, 
Pr›îty
 *
¥›
)

150 
Pr›îtyTy≥
 
¥›_ty≥
;

151 
gboﬁón
 
is_m©ch
 = 
FALSE
;

152 
gch¨
 **
ãxt_d©a
;

154 i‡(!
¥›
)

155  
FALSE
;

159 
¥›_ty≥
 = 
¥›
->
ty≥
;

160 i‡(!
¥›_ty≥
)

161  
FALSE
;

167 i‡–
	`°rcmp
 (
¥›_ty≥
, 
PROP_TYPE_SARRAY
) == 0

168 || 
	`°rcmp
 (
¥›_ty≥
, 
PROP_TYPE_DARRAY
) == 0) {

169 
GPåAºay
 *
ªc‹ds
 = ((
AºayPr›îty
 *Ë
¥›
)->records;

170 
guöt
 
∫um
;

172 i‡(!
ªc‹ds
)

173  
FALSE
;

175 
∫um
 = 0;Ñnum < 
ªc‹ds
->
Àn
 && !
is_m©ch
; ++rnum) {

176 
GPåAºay
 *
sub_¥›s
 = 
	`g_±r_¨øy_ödex
 (
ªc‹ds
, 
∫um
);

177 
guöt
 
sub_num
;

179 
sub_num
 = 0; sub_num < 
sub_¥›s
->
Àn
 && !
is_m©ch
; ++sub_num) {

180 
Pr›îty
 *
sub_¥›
 = 
	`g_±r_¨øy_ödex
 (
sub_¥›s
, 
sub_num
);

182 
is_m©ch
 = 
	`_m©ch_¥›
 (
obj
, 
sd
, 
ª∂a˚mít
, 
sub_¥›
);

186  
is_m©ch
;

191 i‡–
	`°rcmp
 (
¥›_ty≥
, 
PROP_TYPE_MULTISTRING
) == 0

192 || 
	`°rcmp
 (
¥›_ty≥
, 
PROP_TYPE_STRING
) == 0)

194 
ãxt_d©a
 = &((
SåögPr›îty
 *Ë
¥›
)->
°rög_d©a
;

195 } i‡(
	`°rcmp
 (
¥›_ty≥
, 
PROP_TYPE_TEXT
) == 0) {

196 
ãxt_d©a
 = &((
TextPr›îty
 *Ë
¥›
)->text_data;

205  
FALSE
;

208  
	`_m©ch_ãxt_¥›
 (
obj
, 
sd
, 
ª∂a˚mít
, 
ãxt_d©a
);

209 
	}
}

212 
GPåAºay
 *

213 
	$_m©ch_Æl_¥›s
 (
DüObje˘
 *
obj
, c⁄° 
SórchD©a
 *
sd
, c⁄° 
gch¨
 *
ª∂a˚mít
)

215 
GPåAºay
 *
Æl_∂i°
 = 
NULL
;

216 
GPåAºay
 *
m©ched_∂i°
 = 
NULL
;

217 c⁄° 
Pr›Des¸ùti⁄
 *
desc
;

218 
guöt
 
≤um
;

220 i‡(!
obj
)

221  
NULL
;

223 
desc
 = 
	`obje˘_gë_¥›_des¸ùti⁄s
 (
obj
);

224 i‡(!
desc
)

225  
NULL
;

227 
Æl_∂i°
 = 
	`¥›_li°_‰om_descs
 (
desc
, 
pdçp_åue
);

228 i‡(!
Æl_∂i°
)

229  
NULL
;

234 
≤um
 = 0;Önum < 
Æl_∂i°
->
Àn
; ++pnum) {

235 
Pr›îty
 *
¥›
 = 
	`g_±r_¨øy_ödex
 (
Æl_∂i°
, 
≤um
);

236 
gboﬁón
 
is_m©ch
 = 
FALSE
;

237 c⁄° 
gch¨
 *
¥›_«me
;

239 i‡(!
¥›
 || !¥›->
«me
)

243 
¥›_«me
 = 
¥›
->
«me
;

244 
¥›
->
›s
->
	`‰ì
 (prop);

245 
¥›
 = 
	`obje˘_¥›_by_«me
 (
obj
, 
¥›_«me
);

247 
is_m©ch
 = 
	`_m©ch_¥›
 (
obj
, 
sd
, 
ª∂a˚mít
, 
¥›
);

249 i‡(!
is_m©ch
) {

250 
¥›
->
›s
->
	`‰ì
 (prop);

255 i‡(!
m©ched_∂i°
) {

257 
m©ched_∂i°
 = 
	`¥›_li°_‰om_sögÀ
 (
¥›
);

261 
GPåAºay
 *
≠≥nd_∂i°
;

262 
≠≥nd_∂i°
 = 
	`¥›_li°_‰om_sögÀ
 (
¥›
);

263 
	`¥›_li°_add_li°
 (
m©ched_∂i°
, 
≠≥nd_∂i°
);

264 
	`¥›_li°_‰ì
 (
≠≥nd_∂i°
);

269  
m©ched_∂i°
;

270 
	}
}

275 
GPåAºay
 *

276 
	$_m©ch_¥›s
 (
DüObje˘
 *
obj
, c⁄° 
SórchD©a
 *
sd
, c⁄° 
gch¨
 *
ª∂a˚mít
)

278 
	`g_ªtu∫_vÆ_if_Áû
 (
obj
 && 
sd
, 
NULL
);

280 i‡(
sd
->
Êags
 & 
MATCH_ALL_PROPERTIES
)

281  
	`_m©ch_Æl_¥›s
 (
obj
, 
sd
, 
ª∂a˚mít
);

283  
	`_m©ch_«me_¥›
 (
obj
, 
sd
, 
ª∂a˚mít
);

284 
	}
}

288 
gboﬁón


289 
	$_m©ches
 (
DüObje˘
 *
obj
, c⁄° 
SórchD©a
 *
sd
)

291 
GPåAºay
 *
∂i°
 = 
NULL
;

293 i‡(!
obj
)

294  
FALSE
;

296 
∂i°
 = 
	`_m©ch_¥›s
 (
obj
, 
sd
, 
NULL
);

297 i‡(!
∂i°
)

298  
FALSE
;

300 
	`¥›_li°_‰ì
 (
∂i°
);

302  
TRUE
;

303 
	}
}

306 
	$föd_func
 (
gpoöãr
 
d©a
, gpoöã∏
u£r_d©a
)

308 
DüObje˘
 *
obj
 = 
d©a
;

309 
SórchD©a
 *
sd
 = (SórchD©®*)
u£r_d©a
;

311 i‡(!
sd
->
found
) {

312 i‡(
	`_m©ches
 (
obj
, 
sd
)) {

313 i‡(!
sd
->
fú°
)

314 
sd
->
fú°
 = 
obj
;

315 i‡(
obj
 =
sd
->
œ°
)

316 
sd
->
£í_œ°
 = 
TRUE
;

317 i‡(
sd
->
£í_œ°
) {

318 
sd
->
found
 = 
obj
;

322 
	}
}

325 
gboﬁón


326 
	$_ª∂a˚
 (
DüObje˘
 *
obj
, c⁄° 
SórchD©a
 *
sd
, c⁄° *
ª∂a˚mít
)

328 
Obje˘Ch™ge
 *
obj_ch™ge
;

329 
GPåAºay
 *
∂i°
 = 
NULL
;

331 
∂i°
 = 
	`_m©ch_¥›s
 (
obj
, 
sd
, 
ª∂a˚mít
);

332 i‡(!
∂i°
)

333  
FALSE
;

336 
obj_ch™ge
 = 
	`obje˘_≠∂y_¥›s
 (
obj
, 
∂i°
);

337 
	`¥›_li°_‰ì
 (
∂i°
);

339 i‡(
obj_ch™ge
)

340 
	`undo_obje˘_ch™ge
(
sd
->
dügøm
, 
obj
, 
obj_ch™ge
);

342 
	`obje˘_add_upd©es
(
obj
, 
sd
->
dügøm
);

343 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
sd
->
dügøm
, 
obj
, 
TRUE
);

344 
	`dügøm_modifõd
(
sd
->
dügøm
);

345 
	`dügøm_obje˘_modifõd
(
sd
->
dügøm
, 
obj
);

346 
	`dügøm_upd©e_exã¡s
(
sd
->
dügøm
);

347 
	`dügøm_Êush
(
sd
->
dügøm
);

349  
TRUE
;

350 
	}
}

352 
göt


353 
	$‚r_ª•⁄d
 (
GtkWidgë
 *
widgë
, 
göt
 
ª•⁄£_id
, 
gpoöãr
 
d©a
)

355 c⁄° 
gch¨
 *
£¨ch
 = 
	`gtk_íåy_gë_ãxt
 (
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
widgë
), "search-entry"));

356 c⁄° 
gch¨
 *
ª∂a˚
;

357 
DDi•œy
 *
ddi•
 = (DDi•œy*)
d©a
;

358 
SórchD©a
 
sd
 = { 0, };

359 
sd
.
dügøm
 = 
ddi•
->diagram;

360 
sd
.
Êags
 = 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
–
	`GTK_TOGGLE_BUTTON
 (

361 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
widgë
), "m©ch-ˇ£"))Ë? 
MATCH_CASE
 : 0;

362 
sd
.
Êags
 |
	`gtk_toggÀ_buâ⁄_gë_a˘ive
–
	`GTK_TOGGLE_BUTTON
 (

363 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
widgë
), "m©ch-w‹d"))Ë? 
MATCH_WORD
 : 0;

364 
sd
.
Êags
 |
	`gtk_toggÀ_buâ⁄_gë_a˘ive
–
	`GTK_TOGGLE_BUTTON
 (

365 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
widgë
), "m©ch-Æl-¥›îtõs"))Ë? 
MATCH_ALL_PROPERTIES
 : 0;

368 
ª•⁄£_id
) {

369 
RESPONSE_FIND
 :

370 
sd
.
key
 = 
£¨ch
;

371 
sd
.
œ°
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
widgë
), "last-found");

372 i‡(!
	`_m©ches
 (
sd
.
œ°
, &sd))

373 
sd
.
œ°
 = 
NULL
;

374 
	`dügøm_ªmove_Æl_£À˘ed
 (
ddi•
->
dügøm
, 
TRUE
);

375 
	`d©a_f‹óch_obje˘
 (
ddi•
->
dügøm
->
d©a
, 
föd_func
, &
sd
);

377 
sd
.
œ°
 = sd.
found
 ? sd.found : sd.
fú°
;

378 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
widgë
), "œ°-found", 
sd
.
œ°
);

379 i‡(
sd
.
œ°
) {

380 i‡(
	`dü_obje˘_gë_∑ª¡_œyî
(
sd
.
œ°
Ë!
ddi•
->
dügøm
->
d©a
->
a˘ive_œyî
) {

382 
	`d©a_£t_a˘ive_œyî
(
ddi•
->
dügøm
->
d©a
, 
	`dü_obje˘_gë_∑ª¡_œyî
(
sd
.
œ°
));

383 
	`dügøm_add_upd©e_Æl
(
ddi•
->
dügøm
);

384 
	`dügøm_Êush
(
ddi•
->
dügøm
);

386 
	`dügøm_£À˘
 (
ddi•
->
dügøm
, 
sd
.
œ°
);

387 
	`ddi•œy_¥e£¡_obje˘
 (
ddi•
, 
sd
.
œ°
);

390 
RESPONSE_REPLACE
 :

391 
ª∂a˚
 = 
	`gtk_íåy_gë_ãxt
 (
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
widgë
), "replace-entry"));

392 
sd
.
key
 = 
£¨ch
;

393 
sd
.
œ°
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
widgë
), "last-found");

394 i‡(!
	`_m©ches
 (
sd
.
œ°
, &sd)) {

395 
sd
.
œ°
 = 
NULL
;

396 
	`d©a_f‹óch_obje˘
 (
ddi•
->
dügøm
->
d©a
, 
föd_func
, &
sd
);

398 
sd
.
œ°
 = sd.
found
 ? sd.found : sd.
fú°
;

399 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
widgë
), "œ°-found", 
sd
.
œ°
);

400 i‡(
sd
.
œ°
) {

401 
	`_ª∂a˚
 (
sd
.
œ°
, &sd, 
ª∂a˚
);

402 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

404 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
widgë
), "œ°-found", 
sd
.
œ°
);

406 
RESPONSE_REPLACE_ALL
 :

407 
ª∂a˚
 = 
	`gtk_íåy_gë_ãxt
 (
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
widgë
), "replace-entry"));

408 
sd
.
key
 = 
£¨ch
;

409 
sd
.
œ°
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
widgë
), "last-found");

411 i‡(!
	`_m©ches
 (
sd
.
œ°
, &sd)) {

412 
sd
.
œ°
 = 
NULL
;

413 
sd
.
fú°
 = 
NULL
;

414 
	`d©a_f‹óch_obje˘
 (
ddi•
->
dügøm
->
d©a
, 
föd_func
, &
sd
);

416 
sd
.
œ°
 = sd.
found
 ? sd.found : sd.
fú°
;

417 i‡(
sd
.
œ°
)

418 i‡(!
	`_ª∂a˚
 (
sd
.
œ°
, &sd, 
ª∂a˚
))

419 
sd
.
œ°
 = 
NULL
;

420 } 
sd
.
œ°
);

421 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
widgë
), "œ°-found", 
sd
.
œ°
);

422 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

425 
	`gtk_widgë_hide
 (
widgë
);

428 
	}
}

431 
	$‚r_dülog_£tup_comm⁄
 (
GtkWidgë
 *
dülog
, 
gboﬁón
 
is_ª∂a˚
, 
DDi•œy
 *
ddi•
)

433 
GtkWidgë
 *
vbox
;

434 
GtkWidgë
 *
hbox
;

435 
GtkWidgë
 *
œbñ
;

436 
GtkWidgë
 *
£¨ch_íåy
;

437 
GtkWidgë
 *
m©ch_ˇ£
;

438 
GtkWidgë
 *
m©ch_w‹d
;

439 
GtkWidgë
 *
m©ch_Æl_¥›îtõs
;

441 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
 (
dülog
), 
RESPONSE_FIND
);

444 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
dülog
), "response",

445 
	`G_CALLBACK
(
‚r_ª•⁄d
), 
ddi•
);

446 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
dülog
), "delete_event",

447 
	`G_CALLBACK
(
gtk_widgë_hide
), 
NULL
);

448 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
dülog
), "delete_event",

449 
	`G_CALLBACK
(
gtk_åue
), 
NULL
);

451 
vbox
 = 
	`GTK_DIALOG
(
dülog
)->vbox;

453 
hbox
 = 
	`gtk_hbox_√w
 (
FALSE
, 12);

454 
œbñ
 = 
	`gtk_œbñ_√w_wôh_m√m⁄ic
 (
	`_
("_Search for:"));

455 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
œbñ
, 
FALSE
, FALSE, 0);

456 
£¨ch_íåy
 = 
	`gtk_íåy_√w
 ();

457 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
dülog
), "£¨ch-íåy", 
£¨ch_íåy
);

458 
	`gtk_œbñ_£t_m√m⁄ic_widgë
 (
	`GTK_LABEL
 (
œbñ
), 
£¨ch_íåy
);

459 
	`gtk_íåy_£t_width_ch¨s
 (
	`GTK_ENTRY
 (
£¨ch_íåy
), 30);

460 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
£¨ch_íåy
, 
TRUE
, TRUE, 0);

461 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, FALSE, 6);

463 i‡(
is_ª∂a˚
) {

464 
GtkWidgë
 *
ª∂a˚_íåy
;

466 
hbox
 = 
	`gtk_hbox_√w
 (
FALSE
, 12);

467 
œbñ
 = 
	`gtk_œbñ_√w_wôh_m√m⁄ic
 (
	`_
("Replace _with:"));

468 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
œbñ
, 
FALSE
, FALSE, 0);

469 
ª∂a˚_íåy
 = 
	`gtk_íåy_√w
 ();

470 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
dülog
), "ª∂a˚-íåy", 
ª∂a˚_íåy
);

471 
	`gtk_œbñ_£t_m√m⁄ic_widgë
 (
	`GTK_LABEL
 (
œbñ
), 
ª∂a˚_íåy
);

472 
	`gtk_íåy_£t_width_ch¨s
 (
	`GTK_ENTRY
 (
ª∂a˚_íåy
), 30);

473 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
ª∂a˚_íåy
, 
TRUE
, TRUE, 0);

474 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, FALSE, 6);

477 
m©ch_ˇ£
 = 
	`gtk_check_buâ⁄_√w_wôh_m√m⁄ic
 (
	`_
("_Match case"));

478 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
m©ch_ˇ£
, 
FALSE
, FALSE, 6);

479 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
dülog
), "m©ch-ˇ£", 
m©ch_ˇ£
);

481 
m©ch_w‹d
 = 
	`gtk_check_buâ⁄_√w_wôh_m√m⁄ic
 (
	`_
("Match _entire word only"));

482 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
m©ch_w‹d
, 
FALSE
, FALSE, 6);

483 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
dülog
), "m©ch-w‹d", 
m©ch_w‹d
);

485 
m©ch_Æl_¥›îtõs
 = 
	`gtk_check_buâ⁄_√w_wôh_m√m⁄ic
 (
	`_
("Match _allÖroperties (not just objectÇame)"));

486 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
m©ch_Æl_¥›îtõs
, 
FALSE
, FALSE, 6);

487 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
dülog
), "m©ch-Æl-¥›îtõs", 
m©ch_Æl_¥›îtõs
);

488 i‡(
is_ª∂a˚
)

489 
	`gtk_widgë_£t_£nsôive
 (
	`GTK_WIDGET
 (
m©ch_Æl_¥›îtõs
), 
FALSE
);

492 
	`gtk_widgë_show_Æl
 (
vbox
);

493 
	}
}

499 
	$edô_föd_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

501 
DDi•œy
 *
ddi•
;

502 
Dügøm
 *
dü
;

503 
GtkWidgë
 *
dülog
;

505 
ddi•
 = 
	`ddi•œy_a˘ive
();

506 i‡(!
ddi•
) ;

507 
dü
 = 
ddi•
->
dügøm
;

510 
dülog
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
ddi•
->
shñl
), "edit-find-dialog");

511 i‡(!
dülog
) {

512 
dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
 (

513 
	`_
("Find"),

514 
	`GTK_WINDOW
 (
ddi•
->
shñl
), 
GTK_DIALOG_DESTROY_WITH_PARENT
,

515 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

516 
GTK_STOCK_FIND
, 
RESPONSE_FIND
,

517 
NULL
);

519 
	`‚r_dülog_£tup_comm⁄
 (
dülog
, 
FALSE
, 
ddi•
);

521 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ddi•
->
shñl
), "edô-föd-dülog", 
dülog
);

523 
	`gtk_dülog_run
 (
	`GTK_DIALOG
 (
dülog
));

524 
	}
}

530 
	$edô_ª∂a˚_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

532 
DDi•œy
 *
ddi•
;

533 
Dügøm
 *
dü
;

534 
GtkWidgë
 *
dülog
;

536 
ddi•
 = 
	`ddi•œy_a˘ive
();

537 i‡(!
ddi•
) ;

538 
dü
 = 
ddi•
->
dügøm
;

541 
dülog
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
ddi•
->
shñl
), "edit-replace-dialog");

542 i‡(!
dülog
) {

543 
GtkWidgë
 *
buâ⁄
;

544 
dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
 (

545 
	`_
("Replace"),

546 
	`GTK_WINDOW
 (
ddi•
->
shñl
), 
GTK_DIALOG_DESTROY_WITH_PARENT
,

547 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

548 
	`_
("Rïœ˚ _AŒ"), 
RESPONSE_REPLACE_ALL
,

549 
NULL
);

553 
buâ⁄
 = 
	`gtk_dülog_add_buâ⁄
 (
	`GTK_DIALOG
 (
dülog
), 
	`_
("_Rïœ˚"), 
RESPONSE_REPLACE
);

554 
	`gtk_buâ⁄_£t_image
 (
	`GTK_BUTTON
 (
buâ⁄
),

555 
	`gtk_image_√w_‰om_°ock
 (
GTK_STOCK_FIND_AND_REPLACE
, 
GTK_ICON_SIZE_BUTTON
));

557 
	`gtk_dülog_add_buâ⁄
 (
	`GTK_DIALOG
 (
dülog
), 
GTK_STOCK_FIND
, 
RESPONSE_FIND
);

559 
	`‚r_dülog_£tup_comm⁄
 (
dülog
, 
TRUE
, 
ddi•
);

561 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ddi•
->
shñl
), "edô-ª∂a˚-dülog", 
dülog
);

563 
	`gtk_dülog_run
 (
	`GTK_DIALOG
 (
dülog
));

564 
	}
}

	@O:\tool\dvs50\app\find-and-replace.h

23 #i‚de‡
FIND_AND_REPLACE_H


24 
	#FIND_AND_REPLACE_H


	)

26 
edô_föd_ˇŒback
 (
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

27 
edô_ª∂a˚_ˇŒback
 (
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

	@O:\tool\dvs50\app\grid.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<°dio.h
>

24 
	~<°dlib.h
>

25 
	~<m©h.h
>

26 
	~<glib.h
>

28 
	~"öé.h
"

29 
	~"grid.h
"

30 
	~"¥e„ªn˚s.h
"

36 
	$ˇlcuœã_dy«mic_grid
(
DDi•œy
 *
ddi•
, 
ªÆ
 *
width_x
,Ñó»*
width_y
)

38 
ªÆ
 
zoom
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 1.0);

39 
ªÆ
 
ªt
, 
tmp
;

41 
zoom
 *= 5;

42 
ªt
 = 
	`pow
(10, 
	`˚û
(
	`log10
(
zoom
)));

44 
tmp
 = 
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
, 
ªt
);

45 i‡(
tmp
 < 10.0)

46 
ªt
 *= 2.0;

47 i‡(
tmp
 > 35.0)

48 
ªt
 /= 2.0;

49 *
width_x
 = 
ªt
;

50 *
width_y
 = 
ªt
;

51 
	}
}

54 
	$grid_døw_h‹iz⁄èl_löes
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
upd©e
, 
ªÆ
 
Àngth
)

56 
x
, 
y
;

57 
ªÆ
 
pos
;

58 
height
, 
width
;

59 
guöt
 
maj‹_löes
 = 
ddi•
->
dügøm
->
grid
.major_lines;

60 
DüRídîî
 *
ªndîî
 = 
ddi•
->renderer;

61 
DüI¡îa˘iveRídîîI¡îÁ˚
 *
úídîî
;

62 
maj‹_cou¡
 = 0;

64 
úídîî
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ªndîî
);

66 
pos
 = 
	`˚û
–
upd©e
->
t›
 / 
Àngth
 ) *Üength;

67 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
upd©e
->
À·
, 
pos
, &
x
, &
y
);

68 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
upd©e
->
right
, upd©e->
bŸtom
, &
width
, &
height
);

80 i‡(
maj‹_löes
) {

81 
maj‹_cou¡
 = 
	`ROUND
 (
pos
/
Àngth
);

82 if(
maj‹_cou¡
 < 0Ëmaj‹_cou¡ -
maj‹_löes
 * major_count;

83 
maj‹_cou¡
 %
maj‹_löes
;

86 
y
 < 
height
) {

87 i‡(
maj‹_löes
) {

88 i‡(
maj‹_cou¡
 == 0)

89 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

91 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_DOTTED
);

92 
maj‹_cou¡
 = (maj‹_cou¡+1)%
maj‹_löes
;

94 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
, 
x
, 
y
, 
width
, y,

95 &
ddi•
->
dügøm
->
grid
.
cﬁour
);

96 
pos
 +
Àngth
;

97 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
upd©e
->
À·
, 
pos
, &
x
, &
y
);

99 
	}
}

102 
	$grid_døw_vîtiˇl_löes
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
upd©e
, 
ªÆ
 
Àngth
)

104 
x
 = 0, 
y
 = 0;

105 
ªÆ
 
pos
;

106 
height
, 
width
;

107 
guöt
 
maj‹_löes
 = 
ddi•
->
dügøm
->
grid
.major_lines;

108 
DüRídîî
 *
ªndîî
 = 
ddi•
->renderer;

109 
DüI¡îa˘iveRídîîI¡îÁ˚
 *
úídîî
;

110 
maj‹_cou¡
 = 0;

112 
úídîî
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ªndîî
);

114 
pos
 = 
	`˚û
–
upd©e
->
À·
 / 
Àngth
 ) *Üength;

115 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
upd©e
->
right
, upd©e->
bŸtom
, &
width
, &
height
);

117 i‡(
maj‹_löes
) {

118 
maj‹_cou¡
 = 
	`ROUND
 (
pos
/
Àngth
);

119 if(
maj‹_cou¡
 < 0Ëmaj‹_cou¡ -
maj‹_löes
 * major_count;

120 
maj‹_cou¡
 %
maj‹_löes
;

123 
x
 < 
width
) {

124 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
pos
, 
upd©e
->
t›
, &
x
, &
y
);

125 i‡(
maj‹_löes
) {

126 i‡(
maj‹_cou¡
 == 0)

127 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

129 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_DOTTED
);

130 
maj‹_cou¡
 = (maj‹_cou¡+1)%
maj‹_löes
;

132 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
, 
x
, 
y
, x, 
height
,

133 &
ddi•
->
dügøm
->
grid
.
cﬁour
);

134 
pos
 +
Àngth
;

136 
	}
}

139 
	$grid_døw_hex
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
upd©e
, 
ªÆ
 
Àngth
)

141 
ªÆ
 
h‹iz_pos
, 
vît_pos
;

142 
to_x
, 
to_y
, 
x
, 
y
;

143 
DüRídîî
 *
ªndîî
 = 
ddi•
->renderer;

144 
DüI¡îa˘iveRídîîI¡îÁ˚
 *
úídîî
;

146 
úídîî
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ªndîî
);

149 
vît_pos
 = 
	`˚û
–
upd©e
->
t›
 / (
Àngth
 * 
	`sqπ
(3)) ) *Üength * sqrt(3);

150 
vît_pos
 <
upd©e
->
bŸtom
) {

151 
h‹iz_pos
 = 
	`˚û
–(
upd©e
->
À·
Ë/ (3 * 
Àngth
) ) *Üength * 3 -Üength * 2.5;

152 
h‹iz_pos
 <
upd©e
->
right
) {

153 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
, 
vît_pos
, &
x
, &
y
);

154 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
 + 
Àngth
, 
vît_pos
, &
to_x
, &
y
);

156 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
,

157 
x
, 
y
, 
to_x
, y,

158 &
ddi•
->
dügøm
->
grid
.
cﬁour
);

159 
h‹iz_pos
 +3 * 
Àngth
;

162 
vît_pos
 +
	`sqπ
(3Ë* 
Àngth
;

166 
vît_pos
 = 
	`˚û
–
upd©e
->
t›
 / (
Àngth
 * 
	`sqπ
(3)) ) *Üength * sqrt(3) - 0.5 * sqrt(3) *Üength;

167 
vît_pos
 <
upd©e
->
bŸtom
) {

168 
h‹iz_pos
 = 
	`˚û
–(
upd©e
->
À·
Ë/ (3 * 
Àngth
) ) *Üength * 3 -Üength;

169 
h‹iz_pos
 <
upd©e
->
right
) {

170 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
, 
vît_pos
, &
x
, &
y
);

171 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
+
Àngth
, 
vît_pos
, &
to_x
, &
y
);

173 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
,

174 
x
, 
y
, 
to_x
, y,

175 &
ddi•
->
dügøm
->
grid
.
cﬁour
);

176 
h‹iz_pos
 +3 * 
Àngth
;

179 
vît_pos
 +
	`sqπ
(3Ë* 
Àngth
;

183 
vît_pos
 = 
	`˚û
–
upd©e
->
t›
 / (
Àngth
 * 
	`sqπ
(3)) ) *Üength * sqrt(3) -Üength * sqrt(3);

184 
vît_pos
 <
upd©e
->
bŸtom
) {

185 
h‹iz_pos
 = 
	`˚û
–(
upd©e
->
À·
Ë/ (3 * 
Àngth
) ) *Üength * 3 -Üength * 2.5;

186 
h‹iz_pos
 <
upd©e
->
right
) {

187 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
 + 
Àngth
, 
vît_pos
, &
x
, &
y
);

188 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
 + 1.5 * 
Àngth
, 
vît_pos
 +Üígth * 
	`sqπ
(3Ë* 0.5, &
to_x
, &
to_y
);

190 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
,

191 
x
, 
y
, 
to_x
, 
to_y
,

192 &
ddi•
->
dügøm
->
grid
.
cﬁour
);

194 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
, 
vît_pos
, &
x
, &
y
);

195 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
 - 0.5 * 
Àngth
, 
vît_pos
 +Üígth * 
	`sqπ
(3Ë* 0.5, &
to_x
, &
to_y
);

197 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
,

198 
x
, 
y
, 
to_x
, 
to_y
,

199 &
ddi•
->
dügøm
->
grid
.
cﬁour
);

200 
h‹iz_pos
 +3 * 
Àngth
;

203 
vît_pos
 +
	`sqπ
(3Ë* 
Àngth
;

207 
vît_pos
 = 
	`˚û
–
upd©e
->
t›
 / (
Àngth
 * 
	`sqπ
(3)) ) *Üength * sqrt(3) - 0.5 * sqrt(3) *Üength;

208 
vît_pos
 <
upd©e
->
bŸtom
) {

209 
h‹iz_pos
 = 
	`˚û
–(
upd©e
->
À·
Ë/ (3 * 
Àngth
) ) *Üength * 3 -Üength;

210 
h‹iz_pos
 <
upd©e
->
right
) {

211 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
, 
vît_pos
, &
x
, &
y
);

212 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
 - 0.5 * 
Àngth
, 
vît_pos
 + 0.5 * 
	`sqπ
(3Ë*Üígth, &
to_x
, &
to_y
);

214 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
,

215 
x
, 
y
, 
to_x
, 
to_y
,

216 &
ddi•
->
dügøm
->
grid
.
cﬁour
);

218 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
 + 
Àngth
, 
vît_pos
, &
x
, &
y
);

219 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h‹iz_pos
 + 1.5 * 
Àngth
, 
vît_pos
 + 0.5 * 
	`sqπ
(3Ë*Üígth, &
to_x
, &
to_y
);

221 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
,

222 
x
, 
y
, 
to_x
, 
to_y
,

223 &
ddi•
->
dügøm
->
grid
.
cﬁour
);

224 
h‹iz_pos
 +3 * 
Àngth
;

227 
vît_pos
 +
	`sqπ
(3Ë* 
Àngth
;

230 
	}
}

233 
	$grid_døw
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
upd©e
)

235 
Grid
 *
grid
 = &
ddi•
->grid;

236 
DüRídîî
 *
ªndîî
 = 
ddi•
->renderer;

238 i‡(
grid
->
visibÀ
) {

240 
ªÆ
 
width_x
 = 
ddi•
->
dügøm
->
grid
.width_x;

241 
ªÆ
 
width_y
 = 
ddi•
->
dügøm
->
grid
.width_y;

242 
ªÆ
 
width_w
 = 
ddi•
->
dügøm
->
grid
.width_w;

243 i‡(
ddi•
->
dügøm
->
grid
.
dy«mic
) {

244 
	`ˇlcuœã_dy«mic_grid
(
ddi•
, &
width_x
, &
width_y
);

246 
width_x
 = 
ddi•
->
dügøm
->
grid
.width_x *

247 
ddi•
->
dügøm
->
grid
.
visibÀ_x
;

248 
width_y
 = 
ddi•
->
dügøm
->
grid
.width_y *

249 
ddi•
->
dügøm
->
grid
.
visibÀ_y
;

252 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
(renderer, 0.0);

253 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_dashÀngth
(renderer,

254 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 31));

256 i‡(
ddi•
->
dügøm
->
grid
.
hex
) {

257 
	`grid_døw_hex
(
ddi•
, 
upd©e
, 
width_w
);

259 i‡(
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
, 
width_y
) >= 2.0 &&

260 
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
, 
width_x
) >= 2.0) {

262 
	`grid_døw_vîtiˇl_löes
(
ddi•
, 
upd©e
, 
width_x
);

264 
	`grid_døw_h‹iz⁄èl_löes
(
ddi•
, 
upd©e
, 
width_y
);

268 
	}
}

271 
	$∑gebªak_døw
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
upd©e
)

273 
DüRídîî
 *
ªndîî
 = 
ddi•
->renderer;

274 
DüI¡îa˘iveRídîîI¡îÁ˚
 *
úídîî
;

276 
width
 = 
	`dü_ªndîî_gë_width_pixñs
(
ddi•
->
ªndîî
);

277 
height
 = 
	`dü_ªndîî_gë_height_pixñs
(
ddi•
->
ªndîî
);

279 
úídîî
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ªndîî
);

280 i‡(
¥efs
.
∑gebªak
.
visibÀ
) {

281 
Dügøm
 *
dü
 = 
ddi•
->
dügøm
;

282 
ªÆ
 
‹igx
 = 0, 
‹igy
 = 0, 
pos
;

283 
ªÆ
 
pwidth
 = 
dü
->
d©a
->
∑≥r
.
width
;

284 
ªÆ
 
pheight
 = 
dü
->
d©a
->
∑≥r
.
height
;

285 
x
,
y
;

287 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
(renderer, 0.0);

288 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_dashÀngth
(renderer,

289 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 31));

290 i‡(
¥efs
.
∑gebªak
.
sﬁid
)

291 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

293 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_DOTTED
);

295 i‡(
dü
->
d©a
->
∑≥r
.
fôto
) {

296 
‹igx
 = 
dü
->
d©a
->
exã¡s
.
À·
;

297 
‹igy
 = 
dü
->
d©a
->
exã¡s
.
t›
;

301 
pos
 = 
‹igx
 + 
	`˚û
((
upd©e
->
À·
 - origxË/ 
pwidth
) *Öwidth;

302 
pos
 <
upd©e
->
right
) {

303 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
pos
,0,&
x
,&
y
);

304 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
,

305 
x
, 0, x, 
height
,

306 &
dü
->
∑gebªak_cﬁ‹
);

307 
pos
 +
pwidth
;

310 
pos
 = 
‹igy
 + 
	`˚û
((
upd©e
->
t›
 - origyË/ 
pheight
) *Öheight;

311 
pos
 <
upd©e
->
bŸtom
) {

312 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 0,
pos
,&
x
,&
y
);

313 
úídîî
->
	`døw_pixñ_löe
(
ªndîî
,

314 0, 
y
, 
width
, y,

315 &
dü
->
∑gebªak_cﬁ‹
);

316 
pos
 +
pheight
;

319 
	}
}

322 
	$¢≠_to_grid
(
DDi•œy
 *
ddi•
, 
co‹d
 *
x
, co‹d *
y
)

324 i‡(
ddi•
->
grid
.
¢≠
) {

325 i‡(
ddi•
->
dügøm
->
grid
.
hex
) {

326 
ªÆ
 
width_x
 = 
ddi•
->
dügøm
->
grid
.
width_w
;

327 
ªÆ
 
x_mod
 = (*
x
 - 1*
width_x
Ë- 
	`Êo‹
((*x - 1*width_x) / (3*width_x)) * 3 * width_x;

328 
ªÆ
 
y_mod
 = (*
y
 - 0.25*
	`sqπ
(3Ë* 
width_x
) -

329 
	`Êo‹
((*
y
 - 0.25 * 
	`sqπ
(3Ë* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x;

331 i‡–
x_mod
 < (1.5 * 
width_x
) ) {

332 i‡–
y_mod
 < 0.5 * 
	`sqπ
(3Ë* 
width_x
 ) {

333 *
x
 = 
	`Êo‹
((*x + 0.5*
width_x
) / (3*width_x)) * 3 * width_x + 2 * width_x;

334 *
y
 = 
	`Êo‹
((*y - 0.25 * 
	`sqπ
(3Ë* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x + 0.5 * sqrt(3) * width_x;

336 *
x
 = 
	`Êo‹
((*x + 0.5*
width_x
) / (3*width_x)) * 3 * width_x + 1.5 * width_x;

337 *
y
 = 
	`Êo‹
((*y - 0.25 * 
	`sqπ
(3Ë* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x + sqrt(3) * width_x;

340 i‡–
y_mod
 < 0.5 * 
	`sqπ
(3Ë* 
width_x
 ) {

341 *
x
 = 
	`Êo‹
((*x + 0.5*
width_x
) / (3*width_x)) * 3 * width_x ;

342 *
y
 = 
	`Êo‹
((*y - 0.25 * 
	`sqπ
(3Ë* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x + 0.5 * sqrt(3) * width_x;

344 *
x
 = 
	`Êo‹
((*x + 0.5*
width_x
) / (3*width_x)) * 3 * width_x + 0.5 * width_x;

345 *
y
 = 
	`Êo‹
((*y - 0.25 * 
	`sqπ
(3Ë* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x + sqrt(3) * width_x;

349 
ªÆ
 
width_x
 = 
ddi•
->
dügøm
->
grid
.width_x;

350 
ªÆ
 
width_y
 = 
ddi•
->
dügøm
->
grid
.width_y;

351 i‡(
ddi•
->
dügøm
->
grid
.
dy«mic
) {

352 
	`ˇlcuœã_dy«mic_grid
(
ddi•
, &
width_x
, &
width_y
);

354 *
x
 = 
	`ROUND
((*xË/ 
width_x
) * width_x;

355 *
y
 = 
	`ROUND
((*yË/ 
width_y
) * width_y;

358 
	}
}

	@O:\tool\dvs50\app\grid.h

18 #i‚de‡
GRID_H


19 
	#GRID_H


	)

21 
	~<gtk/gtk.h
>

23 
_Grid
 
	tGrid
;

25 
	~"geomëry.h
"

26 
	s_Grid
 {

27 
guöt
 
	mvisibÀ
;

28 
guöt
 
	m¢≠
;

31 
	~"di•œy.h
"

33 
grid_døw
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
upd©e
);

34 
∑gebªak_døw
(
DDi•œy
 *
ddi•
, 
Re˘™gÀ
 *
upd©e
);

35 
¢≠_to_grid
(
DDi•œy
 *
ddi•
, 
co‹d
 *
x
, co‹d *
y
);

	@O:\tool\dvs50\app\gtkhwrapbox.c

23 
	~"c⁄fig.h
"

25 
	~"gtkhwøpbox.h
"

29 
gtk_hwøp_box_˛ass_öô
 (
GtkHWøpBoxCœss
 *
kœss
);

30 
gtk_hwøp_box_öô
 (
GtkHWøpBox
 *
hwbox
);

31 
gtk_hwøp_box_size_ªque°
 (
GtkWidgë
 *
widgë
,

32 
GtkRequisôi⁄
 *
ªquisôi⁄
);

33 
gtk_hwøp_box_size_Æloˇã
 (
GtkWidgë
 *
widgë
,

34 
GtkAŒoˇti⁄
 *
Æloˇti⁄
);

35 
GSLi°
* 
ªvî£_li°_row_chûdªn
 (
GtkWøpBox
 *
wbox
,

36 
GtkWøpBoxChûd
 **
chûd_p
,

37 
GtkAŒoˇti⁄
 *
¨ó
,

38 
guöt
 *
max_height
,

39 
gboﬁón
 *
ˇn_vex∑nd
);

43 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

47 
GTy≥


48 
	$gtk_hwøp_box_gë_ty≥
 ()

50 
GTy≥
 
hwøp_box_ty≥
 = 0;

52 i‡(! 
hwøp_box_ty≥
)

54 c⁄° 
GTy≥Info
 
hwøp_box_öfo
 =

56  (
GtkHWøpBoxCœss
),

57 
NULL
,

58 
NULL
,

59 (
GCœssInôFunc
Ë
gtk_hwøp_box_˛ass_öô
,

60 
NULL
,

61 
NULL
,

62  (
GtkHWøpBox
),

64 (
GIn°™˚InôFunc
Ë
gtk_hwøp_box_öô
,

67 
hwøp_box_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
GTK_TYPE_WRAP_BOX
, "GtkHWrapBox",

68 &
hwøp_box_öfo
, 0);

71  
hwøp_box_ty≥
;

72 
	}
}

75 
	$gtk_hwøp_box_˛ass_öô
 (
GtkHWøpBoxCœss
 *
˛ass
)

77 
GObje˘Cœss
 *
obje˘_˛ass
;

78 
GtkWidgëCœss
 *
widgë_˛ass
;

79 
GtkC⁄èöîCœss
 *
c⁄èöî_˛ass
;

80 
GtkWøpBoxCœss
 *
wøp_box_˛ass
;

82 
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
˛ass
);

83 
widgë_˛ass
 = 
	`GTK_WIDGET_CLASS
 (
˛ass
);

84 
c⁄èöî_˛ass
 = 
	`GTK_CONTAINER_CLASS
 (
˛ass
);

85 
wøp_box_˛ass
 = 
	`GTK_WRAP_BOX_CLASS
 (
˛ass
);

87 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
˛ass
);

89 
widgë_˛ass
->
size_ªque°
 = 
gtk_hwøp_box_size_ªque°
;

90 
widgë_˛ass
->
size_Æloˇã
 = 
gtk_hwøp_box_size_Æloˇã
;

92 
wøp_box_˛ass
->
æi°_löe_chûdªn
 = 
ªvî£_li°_row_chûdªn
;

93 
	}
}

96 
	$gtk_hwøp_box_öô
 (
GtkHWøpBox
 *
hwbox
)

98 
hwbox
->
max_chûd_width
 = 0;

99 
hwbox
->
max_chûd_height
 = 0;

100 
	}
}

102 
GtkWidgë
*

103 
	$gtk_hwøp_box_√w
 (
gboﬁón
 
homogíeous
)

105  
	`g_obje˘_√w
 (
GTK_TYPE_HWRAP_BOX
, "homogíeous", 
homogíeous
, 
NULL
);

106 
	}
}

108 
ölöe
 

109 
	$gë_chûd_ªquisôi⁄
 (
GtkWøpBox
 *
wbox
,

110 
GtkWidgë
 *
chûd
,

111 
GtkRequisôi⁄
 *
chûd_ªquisôi⁄
)

113 i‡(
wbox
->
homogíeous
)

115 
GtkHWøpBox
 *
hwbox
 = 
	`GTK_HWRAP_BOX
 (
wbox
);

117 
chûd_ªquisôi⁄
->
width
 = 
hwbox
->
max_chûd_width
;

118 
chûd_ªquisôi⁄
->
height
 = 
hwbox
->
max_chûd_height
;

121 
	`gtk_widgë_gë_chûd_ªquisôi⁄
 (
chûd
, 
chûd_ªquisôi⁄
);

122 
	}
}

124 
gÊﬂt


125 
	$gë_œyout_size
 (
GtkHWøpBox
 *
this
,

126 
guöt
 
max_width
,

127 
guöt
 *
width_öc
)

129 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
this
);

130 
GtkWøpBoxChûd
 *
chûd
;

131 
guöt
 
n_rows
, 
À·_ovî
 = 0, 
tŸÆ_height
 = 0;

132 
gboﬁón
 
œ°_row_fûÀd
 = 
TRUE
;

134 *
width_öc
 = 
this
->
max_chûd_width
 + 1;

136 
n_rows
 = 0;

137 
chûd
 = 
wbox
->
chûdªn
; chûd; chûd = chûd->
√xt
)

139 
GtkWøpBoxChûd
 *
row_chûd
;

140 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

141 
guöt
 
row_width
, 
row_height
, 
n
 = 1;

143 i‡(!
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
))

146 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

147 i‡(!
œ°_row_fûÀd
)

148 *
width_öc
 = 
	`MIN
 (*width_öc, 
chûd_ªquisôi⁄
.
width
 - 
À·_ovî
);

149 
row_width
 = 
chûd_ªquisôi⁄
.
width
;

150 
row_height
 = 
chûd_ªquisôi⁄
.
height
;

151 
row_chûd
 = 
chûd
->
√xt
;Ñow_chûd && 
n
 < 
wbox
->
chûd_limô
;Ñow_child =Ñow_child->next)

153 i‡(
	`GTK_WIDGET_VISIBLE
 (
row_chûd
->
widgë
))

155 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
row_chûd
->
widgë
, &
chûd_ªquisôi⁄
);

156 i‡(
row_width
 + 
wbox
->
h•acög
 + 
chûd_ªquisôi⁄
.
width
 > 
max_width
)

158 
row_width
 +
wbox
->
h•acög
 + 
chûd_ªquisôi⁄
.
width
;

159 
row_height
 = 
	`MAX
 (row_height, 
chûd_ªquisôi⁄
.
height
);

160 
n
++;

162 
chûd
 = 
row_chûd
;

164 
œ°_row_fûÀd
 = 
n
 >
wbox
->
chûd_limô
;

165 
À·_ovî
 = 
œ°_row_fûÀd
 ? 0 : 
max_width
 - (
row_width
 + 
wbox
->
h•acög
);

166 
tŸÆ_height
 +(
n_rows
 ? 
wbox
->
v•acög
 : 0Ë+ 
row_height
;

167 
n_rows
++;

170 i‡(*
width_öc
 > 
this
->
max_chûd_width
)

171 *
width_öc
 = 0;

173  
	`MAX
 (
tŸÆ_height
, 1);

174 
	}
}

177 
	$gtk_hwøp_box_size_ªque°
 (
GtkWidgë
 *
widgë
,

178 
GtkRequisôi⁄
 *
ªquisôi⁄
)

180 
GtkHWøpBox
 *
this
 = 
	`GTK_HWRAP_BOX
 (
widgë
);

181 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widgë
);

182 
GtkWøpBoxChûd
 *
chûd
;

183 
gÊﬂt
 
øtio_di°
, 
œyout_width
 = 0;

184 
guöt
 
row_öc
 = 0;

186 
	`g_ªtu∫_if_Áû
 (
ªquisôi⁄
 !
NULL
);

188 
ªquisôi⁄
->
width
 = 0;

189 
ªquisôi⁄
->
height
 = 0;

190 
this
->
max_chûd_width
 = 0;

191 
this
->
max_chûd_height
 = 0;

194 
chûd
 = 
wbox
->
chûdªn
; chûd; chûd = chûd->
√xt
)

195 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
))

197 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

199 
	`gtk_widgë_size_ªque°
 (
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

201 
this
->
max_chûd_width
 = 
	`MAX
 (this->max_chûd_width, 
chûd_ªquisôi⁄
.
width
);

202 
this
->
max_chûd_height
 = 
	`MAX
 (this->max_chûd_height, 
chûd_ªquisôi⁄
.
height
);

206 
øtio_di°
 = 32768;

207 
œyout_width
 = 
this
->
max_chûd_width
;

210 
gÊﬂt
 
œyout_height
;

211 
gÊﬂt
 
øtio
, 
di°
;

213 
œyout_width
 +
row_öc
;

214 
œyout_height
 = 
	`gë_œyout_size
 (
this
, 
œyout_width
, &
row_öc
);

215 
øtio
 = 
œyout_width
 / 
œyout_height
;

216 
di°
 = 
	`MAX
 (
øtio
, 
wbox
->
a•e˘_øtio
Ë- 
	`MIN
 (ratio, wbox->aspect_ratio);

217 i‡(
di°
 < 
øtio_di°
)

219 
øtio_di°
 = 
di°
;

220 
ªquisôi⁄
->
width
 = 
œyout_width
;

221 
ªquisôi⁄
->
height
 = 
œyout_height
;

230 
row_öc
);

232 
ªquisôi⁄
->
width
 +
	`GTK_CONTAINER
 (
wbox
)->
b‹dî_width
 * 2;

233 
ªquisôi⁄
->
height
 +
	`GTK_CONTAINER
 (
wbox
)->
b‹dî_width
 * 2;

238 
	}
}

240 
GSLi°
*

241 
	$ªvî£_li°_row_chûdªn
 (
GtkWøpBox
 *
wbox
,

242 
GtkWøpBoxChûd
 **
chûd_p
,

243 
GtkAŒoˇti⁄
 *
¨ó
,

244 
guöt
 *
max_chûd_size
,

245 
gboﬁón
 *
ex∑nd_löe
)

247 
GSLi°
 *
¶i°
 = 
NULL
;

248 
guöt
 
width
 = 0, 
row_width
 = 
¨ó
->width;

249 
GtkWøpBoxChûd
 *
chûd
 = *
chûd_p
;

251 *
max_chûd_size
 = 0;

252 *
ex∑nd_löe
 = 
FALSE
;

254 
chûd
 && !
	`GTK_WIDGET_VISIBLE
 (chûd->
widgë
))

256 *
chûd_p
 = 
chûd
->
√xt
;

257 
chûd
 = *
chûd_p
;

260 i‡(
chûd
)

262 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

263 
guöt
 
n
 = 1;

265 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

266 
width
 +
chûd_ªquisôi⁄
.width;

267 *
max_chûd_size
 = 
	`MAX
 (*max_chûd_size, 
chûd_ªquisôi⁄
.
height
);

268 *
ex∑nd_löe
 |
chûd
->
vex∑nd
;

269 
¶i°
 = 
	`g_¶i°_¥ïíd
 (¶i°, 
chûd
);

270 *
chûd_p
 = 
chûd
->
√xt
;

271 
chûd
 = *
chûd_p
;

273 
chûd
 && 
n
 < 
wbox
->
chûd_limô
)

275 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
))

277 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

278 i‡(
width
 + 
wbox
->
h•acög
 + 
chûd_ªquisôi⁄
.width > 
row_width
 ||

279 
chûd
->
wøµed
)

281 
width
 +
wbox
->
h•acög
 + 
chûd_ªquisôi⁄
.width;

282 *
max_chûd_size
 = 
	`MAX
 (*max_chûd_size, 
chûd_ªquisôi⁄
.
height
);

283 *
ex∑nd_löe
 |
chûd
->
vex∑nd
;

284 
¶i°
 = 
	`g_¶i°_¥ïíd
 (¶i°, 
chûd
);

285 
n
++;

287 *
chûd_p
 = 
chûd
->
√xt
;

288 
chûd
 = *
chûd_p
;

292  
¶i°
;

293 
	}
}

296 
	$œyout_row
 (
GtkWøpBox
 *
wbox
,

297 
GtkAŒoˇti⁄
 *
¨ó
,

298 
GSLi°
 *
chûdªn
,

299 
guöt
 
chûdªn_≥r_löe
,

300 
gboﬁón
 
vex∑nd
)

302 
GSLi°
 *
¶i°
;

303 
guöt
 
n_chûdªn
 = 0, 
n_ex∑nd_chûdªn
 = 0, 
have_ex∑nd_chûdªn
 = 0;

304 
göt
 
tŸÆ_width
 = 0;

305 
gÊﬂt
 
x
, 
width
, 
exåa
;

306 
GtkAŒoˇti⁄
 
chûd_Æloˇti⁄
;

308 
¶i°
 = 
chûdªn
; sli°; sli° = sli°->
√xt
)

310 
GtkWøpBoxChûd
 *
chûd
 = 
¶i°
->
d©a
;

311 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

313 
n_chûdªn
++;

314 i‡(
chûd
->
hex∑nd
)

315 
n_ex∑nd_chûdªn
++;

317 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

318 
tŸÆ_width
 +
chûd_ªquisôi⁄
.
width
;

321 
width
 = 
	`MAX
 (1, 
¨ó
->width - (
n_chûdªn
 - 1Ë* 
wbox
->
h•acög
);

322 i‡(
width
 > 
tŸÆ_width
)

323 
exåa
 = 
width
 - 
tŸÆ_width
;

325 
exåa
 = 0;

326 
have_ex∑nd_chûdªn
 = 
n_ex∑nd_chûdªn
 && 
exåa
;

328 
x
 = 
¨ó
->x;

329 i‡(
wbox
->
homogíeous
)

331 
width
 = 
	`MAX
 (1, 
¨ó
->width - (
chûdªn_≥r_löe
 - 1Ë* 
wbox
->
h•acög
);

332 
width
 /((
gdoubÀ
Ë
chûdªn_≥r_löe
);

333 
exåa
 = 0;

335 i‡(
have_ex∑nd_chûdªn
 && 
wbox
->
ju°ify
 !
GTK_JUSTIFY_FILL
)

337 
width
 = 
exåa
;

338 
exåa
 /((
gdoubÀ
Ë
n_ex∑nd_chûdªn
);

342 i‡(
wbox
->
ju°ify
 =
GTK_JUSTIFY_FILL
)

344 
width
 = 
exåa
;

345 
have_ex∑nd_chûdªn
 = 
TRUE
;

346 
n_ex∑nd_chûdªn
 = 
n_chûdªn
;

347 
exåa
 /((
gdoubÀ
Ë
n_ex∑nd_chûdªn
);

349 i‡(
wbox
->
ju°ify
 =
GTK_JUSTIFY_CENTER
)

351 
x
 +
exåa
 / 2;

352 
width
 = 0;

353 
exåa
 = 0;

355 i‡(
wbox
->
ju°ify
 =
GTK_JUSTIFY_LEFT
)

357 
width
 = 0;

358 
exåa
 = 0;

360 i‡(
wbox
->
ju°ify
 =
GTK_JUSTIFY_RIGHT
)

362 
x
 +
exåa
;

363 
width
 = 0;

364 
exåa
 = 0;

368 
n_chûdªn
 = 0;

369 
¶i°
 = 
chûdªn
; sli°; sli° = sli°->
√xt
)

371 
GtkWøpBoxChûd
 *
chûd
 = 
¶i°
->
d©a
;

373 
chûd_Æloˇti⁄
.
x
 = x;

374 
chûd_Æloˇti⁄
.
y
 = 
¨ó
->y;

375 i‡(
wbox
->
homogíeous
)

377 
chûd_Æloˇti⁄
.
height
 = 
¨ó
->height;

378 
chûd_Æloˇti⁄
.
width
 = width;

379 
x
 +
chûd_Æloˇti⁄
.
width
 + 
wbox
->
h•acög
;

383 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

385 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

387 i‡(
chûd_ªquisôi⁄
.
height
 >
¨ó
->height)

388 
chûd_Æloˇti⁄
.
height
 = 
¨ó
->height;

391 
chûd_Æloˇti⁄
.
height
 = 
chûd_ªquisôi⁄
.height;

392 i‡(
wbox
->
löe_ju°ify
 =
GTK_JUSTIFY_FILL
 || 
chûd
->
vfûl
)

393 
chûd_Æloˇti⁄
.
height
 = 
¨ó
->height;

394 i‡(
chûd
->
vex∑nd
 || 
wbox
->
löe_ju°ify
 =
GTK_JUSTIFY_CENTER
)

395 
chûd_Æloˇti⁄
.
y
 +(
¨ó
->
height
 - 
chûd_ªquisôi⁄
.height) / 2;

396 i‡(
wbox
->
löe_ju°ify
 =
GTK_JUSTIFY_BOTTOM
)

397 
chûd_Æloˇti⁄
.
y
 +
¨ó
->
height
 - 
chûd_ªquisôi⁄
.height;

400 i‡(
have_ex∑nd_chûdªn
)

402 
chûd_Æloˇti⁄
.
width
 = 
chûd_ªquisôi⁄
.width;

403 i‡(
chûd
->
hex∑nd
 || 
wbox
->
ju°ify
 =
GTK_JUSTIFY_FILL
)

405 
guöt
 
•a˚
;

407 
n_ex∑nd_chûdªn
--;

408 
•a˚
 = 
exåa
 * 
n_ex∑nd_chûdªn
;

409 
•a˚
 = 
width
 - space;

410 
width
 -
•a˚
;

411 i‡(
chûd
->
hfûl
)

412 
chûd_Æloˇti⁄
.
width
 +
•a˚
;

415 
chûd_Æloˇti⁄
.
x
 +
•a˚
 / 2;

416 
x
 +
•a˚
;

424 
chûd_Æloˇti⁄
.
x
 +
n_chûdªn
 * 
exåa
;

427 
chûd_Æloˇti⁄
.
width
 = 
	`MIN
 (
chûd_ªquisôi⁄
.width,

428 
¨ó
->
width
 - 
chûd_Æloˇti⁄
.
x
 +área->x);

432 
x
 +
chûd_Æloˇti⁄
.
width
 + 
wbox
->
h•acög
;

433 
	`gtk_widgë_size_Æloˇã
 (
chûd
->
widgë
, &
chûd_Æloˇti⁄
);

434 
n_chûdªn
++;

436 
	}
}

438 
_Löe
 
	tLöe
;

439 
	s_Löe


441 
GSLi°
 *
	mchûdªn
;

442 
guöt16
 
	mmö_size
;

443 
guöt
 
	mex∑nd
 : 1;

444 
Löe
 *
	m√xt
;

448 
	$œyout_rows
 (
GtkWøpBox
 *
wbox
,

449 
GtkAŒoˇti⁄
 *
¨ó
)

451 
GtkWøpBoxChûd
 *
√xt_chûd
;

452 
guöt
 
mö_height
;

453 
gboﬁón
 
vex∑nd
;

454 
GSLi°
 *
¶i°
;

455 
Löe
 *
löe_li°
 = 
NULL
;

456 
guöt
 
tŸÆ_height
 = 0, 
n_ex∑nd_löes
 = 0, 
n_löes
 = 0;

457 
gÊﬂt
 
shrök_height
;

458 
guöt
 
chûdªn_≥r_löe
;

460 
√xt_chûd
 = 
wbox
->
chûdªn
;

461 
¶i°
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`æi°_löe_chûdªn
 (wbox,

462 &
√xt_chûd
,

463 
¨ó
,

464 &
mö_height
,

465 &
vex∑nd
);

466 
¶i°
 = 
	`g_¶i°_ªvî£
 (slist);

468 
chûdªn_≥r_löe
 = 
	`g_¶i°_Àngth
 (
¶i°
);

469 
¶i°
)

471 #i‡
	`GLIB_CHECK_VERSION
(2,10,0)

472 
Löe
 *
löe
 = 
	`g_¶i˚_√w
 (Line);

474 
Löe
 *
löe
 = 
	`g_√w
 (Line, 1);

477 
löe
->
chûdªn
 = 
¶i°
;

478 
löe
->
mö_size
 = 
mö_height
;

479 
tŸÆ_height
 +
mö_height
;

480 
löe
->
ex∑nd
 = 
vex∑nd
;

481 i‡(
vex∑nd
)

482 
n_ex∑nd_löes
++;

483 
löe
->
√xt
 = 
löe_li°
;

484 
löe_li°
 = 
löe
;

485 
n_löes
++;

487 
¶i°
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`æi°_löe_chûdªn
 (wbox,

488 &
√xt_chûd
,

489 
¨ó
,

490 &
mö_height
,

491 &
vex∑nd
);

492 
¶i°
 = 
	`g_¶i°_ªvî£
 (slist);

495 i‡(
tŸÆ_height
 > 
¨ó
->
height
)

496 
shrök_height
 = 
tŸÆ_height
 - 
¨ó
->
height
;

498 
shrök_height
 = 0;

502 
Löe
 *
¥ev
 = 
NULL
, *
œ°
 = NULL;

503 
gÊﬂt
 
n_shrök_löes
 = 
n_löes
;

505 
löe_li°
)

507 
Löe
 *
tmp
 = 
löe_li°
->
√xt
;

509 i‡(
shrök_height
)

511 
Löe
 *
löe
 = 
löe_li°
;

512 
guöt
 
shrök_‰a˘
 = 
shrök_height
 / 
n_shrök_löes
 + 0.5;

514 i‡(
löe
->
mö_size
 > 
shrök_‰a˘
)

516 
shrök_height
 -
shrök_‰a˘
;

517 
löe
->
mö_size
 -
shrök_‰a˘
;

521 
shrök_height
 -
löe
->
mö_size
 - 1;

522 
löe
->
mö_size
 = 1;

525 
n_shrök_löes
--;

527 
œ°
 = 
löe_li°
;

528 
löe_li°
->
√xt
 = 
¥ev
;

529 
¥ev
 = 
löe_li°
;

530 
löe_li°
 = 
tmp
;

532 
löe_li°
 = 
œ°
;

535 i‡(
n_löes
)

537 
Löe
 *
löe
;

538 
gÊﬂt
 
y
, 
height
, 
exåa
 = 0;

540 
height
 = 
¨ó
->height;

541 
height
 = 
	`MAX
 (
n_löes
, heighà- (n_löe†- 1Ë* 
wbox
->
v•acög
);

543 i‡(
wbox
->
homogíeous
)

544 
height
 /((
gdoubÀ
Ë
n_löes
);

545 i‡(
n_ex∑nd_löes
)

547 
height
 = 
	`MAX
 (0, heighà- 
tŸÆ_height
);

548 
exåa
 = 
height
 / ((
gdoubÀ
Ë
n_ex∑nd_löes
);

551 
height
 = 0;

553 
y
 = 
¨ó
->y;

554 
löe
 = 
löe_li°
;

555 
löe
)

557 
GtkAŒoˇti⁄
 
row_Æloˇti⁄
;

558 
Löe
 *
√xt_löe
 = 
löe
->
√xt
;

560 
row_Æloˇti⁄
.
x
 = 
¨ó
->x;

561 
row_Æloˇti⁄
.
width
 = 
¨ó
->width;

562 i‡(
wbox
->
homogíeous
)

563 
row_Æloˇti⁄
.
height
 = height;

566 
row_Æloˇti⁄
.
height
 = 
löe
->
mö_size
;

568 i‡(
löe
->
ex∑nd
)

569 
row_Æloˇti⁄
.
height
 +
exåa
;

572 
row_Æloˇti⁄
.
y
 = y;

574 
y
 +
row_Æloˇti⁄
.
height
 + 
wbox
->
v•acög
;

575 
	`œyout_row
 (
wbox
,

576 &
row_Æloˇti⁄
,

577 
löe
->
chûdªn
,

578 
chûdªn_≥r_löe
,

579 
löe
->
ex∑nd
);

581 
	`g_¶i°_‰ì
 (
löe
->
chûdªn
);

582 #i‡(!
	`GLIB_CHECK_VERSION
(2,10,0))

583 
	`g_‰ì
 (
löe
);

585 
löe
 = 
√xt_löe
;

588 #i‡
	`GLIB_CHECK_VERSION
(2,10,0)

589 
	`g_¶i˚_‰ì_chaö
 (
Löe
, 
löe_li°
, 
√xt
);

592 
	}
}

595 
	$gtk_hwøp_box_size_Æloˇã
 (
GtkWidgë
 *
widgë
,

596 
GtkAŒoˇti⁄
 *
Æloˇti⁄
)

598 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widgë
);

599 
GtkAŒoˇti⁄
 
¨ó
;

600 
göt
 
b‹dî
 = 
	`GTK_CONTAINER
 (
wbox
)->
b‹dî_width
;

602 
widgë
->
Æloˇti⁄
 = *allocation;

603 
¨ó
.
x
 = 
Æloˇti⁄
->x + 
b‹dî
;

604 
¨ó
.
y
 = 
Æloˇti⁄
->y + 
b‹dî
;

605 
¨ó
.
width
 = 
	`MAX
 (1, (
göt
Ë
Æloˇti⁄
->width - 
b‹dî
 * 2);

606 
¨ó
.
height
 = 
	`MAX
 (1, (
göt
Ë
Æloˇti⁄
->heighà- 
b‹dî
 * 2);

615 
	`œyout_rows
 (
wbox
, &
¨ó
);

616 
	}
}

	@O:\tool\dvs50\app\gtkhwrapbox.h

23 #i‚de‡
__GTK_HWRAP_BOX_H__


24 
	#__GTK_HWRAP_BOX_H__


	)

27 
	~"gtkwøpbox.h
"

29 
	gG_BEGIN_DECLS


33 
	#GTK_TYPE_HWRAP_BOX
 (
	`gtk_hwøp_box_gë_ty≥
 ())

	)

34 
	#GTK_HWRAP_BOX
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
GTK_TYPE_HWRAP_BOX
, 
GtkHWøpBox
))

	)

35 
	#GTK_HWRAP_BOX_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
GTK_TYPE_HWRAP_BOX
, 
GtkHWøpBoxCœss
))

	)

36 
	#GTK_IS_HWRAP_BOX
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
GTK_TYPE_HWRAP_BOX
))

	)

37 
	#GTK_IS_HWRAP_BOX_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kœss), 
GTK_TYPE_HWRAP_BOX
))

	)

38 
	#GTK_HWRAP_BOX_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
GTK_TYPE_HWRAP_BOX
, 
GtkHWøpBoxCœss
))

	)

42 
_GtkHWøpBox
 
	tGtkHWøpBox
;

43 
_GtkHWøpBoxCœss
 
	tGtkHWøpBoxCœss
;

47 
	s_GtkHWøpBox


49 
GtkWøpBox
 
	m∑ª¡_widgë
;

52 
guöt
 
	mmax_chûd_width
;

53 
guöt
 
	mmax_chûd_height
;

57 
	s_GtkHWøpBoxCœss


59 
GtkWøpBoxCœss
 
	m∑ª¡_˛ass
;

64 
GTy≥
 
	$gtk_hwøp_box_gë_ty≥
 (Ë
G_GNUC_CONST
;

65 
GtkWidgë
 * 
	`gtk_hwøp_box_√w
 (
gboﬁón
 
homogíeous
);

68 
G_END_DECLS


	@O:\tool\dvs50\app\gtkvwrapbox.c

23 
	~"c⁄fig.h
"

25 
	~"gtkvwøpbox.h
"

29 
gtk_vwøp_box_˛ass_öô
 (
GtkVWøpBoxCœss
 *
kœss
);

30 
gtk_vwøp_box_öô
 (
GtkVWøpBox
 *
vwbox
);

31 
gtk_vwøp_box_size_ªque°
 (
GtkWidgë
 *
widgë
,

32 
GtkRequisôi⁄
 *
ªquisôi⁄
);

33 
gtk_vwøp_box_size_Æloˇã
 (
GtkWidgë
 *
widgë
,

34 
GtkAŒoˇti⁄
 *
Æloˇti⁄
);

35 
GSLi°
* 
ªvî£_li°_cﬁ_chûdªn
 (
GtkWøpBox
 *
wbox
,

36 
GtkWøpBoxChûd
 **
chûd_p
,

37 
GtkAŒoˇti⁄
 *
¨ó
,

38 
guöt
 *
max_width
,

39 
gboﬁón
 *
ˇn_hex∑nd
);

43 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

47 
GTy≥


48 
	$gtk_vwøp_box_gë_ty≥
 ()

50 
GTy≥
 
vwøp_box_ty≥
 = 0;

52 i‡(! 
vwøp_box_ty≥
)

54 c⁄° 
GTy≥Info
 
vwøp_box_öfo
 =

56  (
GtkVWøpBoxCœss
),

57 
NULL
,

58 
NULL
,

59 (
GCœssInôFunc
Ë
gtk_vwøp_box_˛ass_öô
,

60 
NULL
,

61 
NULL
,

62  (
GtkVWøpBox
),

64 (
GIn°™˚InôFunc
Ë
gtk_vwøp_box_öô
,

67 
vwøp_box_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
GTK_TYPE_WRAP_BOX
, "GtkVWrapBox",

68 &
vwøp_box_öfo
, 0);

71  
vwøp_box_ty≥
;

72 
	}
}

75 
	$gtk_vwøp_box_˛ass_öô
 (
GtkVWøpBoxCœss
 *
˛ass
)

77 
GObje˘Cœss
 *
obje˘_˛ass
;

78 
GtkWidgëCœss
 *
widgë_˛ass
;

79 
GtkC⁄èöîCœss
 *
c⁄èöî_˛ass
;

80 
GtkWøpBoxCœss
 *
wøp_box_˛ass
;

82 
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
˛ass
);

83 
widgë_˛ass
 = 
	`GTK_WIDGET_CLASS
 (
˛ass
);

84 
c⁄èöî_˛ass
 = 
	`GTK_CONTAINER_CLASS
 (
˛ass
);

85 
wøp_box_˛ass
 = 
	`GTK_WRAP_BOX_CLASS
 (
˛ass
);

87 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
˛ass
);

89 
widgë_˛ass
->
size_ªque°
 = 
gtk_vwøp_box_size_ªque°
;

90 
widgë_˛ass
->
size_Æloˇã
 = 
gtk_vwøp_box_size_Æloˇã
;

92 
wøp_box_˛ass
->
æi°_löe_chûdªn
 = 
ªvî£_li°_cﬁ_chûdªn
;

93 
	}
}

96 
	$gtk_vwøp_box_öô
 (
GtkVWøpBox
 *
vwbox
)

98 
vwbox
->
max_chûd_height
 = 0;

99 
vwbox
->
max_chûd_width
 = 0;

100 
	}
}

102 
GtkWidgë
*

103 
	$gtk_vwøp_box_√w
 (
gboﬁón
 
homogíeous
)

105  
	`g_obje˘_√w
 (
GTK_TYPE_VWRAP_BOX
, "homogíeous", 
homogíeous
, 
NULL
);

106 
	}
}

108 
ölöe
 

109 
	$gë_chûd_ªquisôi⁄
 (
GtkWøpBox
 *
wbox
,

110 
GtkWidgë
 *
chûd
,

111 
GtkRequisôi⁄
 *
chûd_ªquisôi⁄
)

113 i‡(
wbox
->
homogíeous
)

115 
GtkVWøpBox
 *
vwbox
 = 
	`GTK_VWRAP_BOX
 (
wbox
);

117 
chûd_ªquisôi⁄
->
height
 = 
vwbox
->
max_chûd_height
;

118 
chûd_ªquisôi⁄
->
width
 = 
vwbox
->
max_chûd_width
;

121 
	`gtk_widgë_gë_chûd_ªquisôi⁄
 (
chûd
, 
chûd_ªquisôi⁄
);

122 
	}
}

124 
gÊﬂt


125 
	$gë_œyout_size
 (
GtkVWøpBox
 *
this
,

126 
guöt
 
max_height
,

127 
guöt
 *
height_öc
)

129 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
this
);

130 
GtkWøpBoxChûd
 *
chûd
;

131 
guöt
 
n_cﬁs
, 
À·_ovî
 = 0, 
tŸÆ_width
 = 0;

132 
gboﬁón
 
œ°_cﬁ_fûÀd
 = 
TRUE
;

134 *
height_öc
 = 
this
->
max_chûd_height
 + 1;

136 
n_cﬁs
 = 0;

137 
chûd
 = 
wbox
->
chûdªn
; chûd; chûd = chûd->
√xt
)

139 
GtkWøpBoxChûd
 *
cﬁ_chûd
;

140 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

141 
guöt
 
cﬁ_height
, 
cﬁ_width
, 
n
 = 1;

143 i‡(!
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
))

146 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

147 i‡(!
œ°_cﬁ_fûÀd
)

148 *
height_öc
 = 
	`MIN
 (*height_öc, 
chûd_ªquisôi⁄
.
height
 - 
À·_ovî
);

149 
cﬁ_height
 = 
chûd_ªquisôi⁄
.
height
;

150 
cﬁ_width
 = 
chûd_ªquisôi⁄
.
width
;

151 
cﬁ_chûd
 = 
chûd
->
√xt
; cﬁ_chûd && 
n
 < 
wbox
->
chûd_limô
; col_child = col_child->next)

153 i‡(
	`GTK_WIDGET_VISIBLE
 (
cﬁ_chûd
->
widgë
))

155 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
cﬁ_chûd
->
widgë
, &
chûd_ªquisôi⁄
);

156 i‡(
cﬁ_height
 + 
wbox
->
v•acög
 + 
chûd_ªquisôi⁄
.
height
 > 
max_height
)

158 
cﬁ_height
 +
wbox
->
v•acög
 + 
chûd_ªquisôi⁄
.
height
;

159 
cﬁ_width
 = 
	`MAX
 (cﬁ_width, 
chûd_ªquisôi⁄
.
width
);

160 
n
++;

162 
chûd
 = 
cﬁ_chûd
;

164 
œ°_cﬁ_fûÀd
 = 
n
 >
wbox
->
chûd_limô
;

165 
À·_ovî
 = 
œ°_cﬁ_fûÀd
 ? 0 : 
max_height
 - (
cﬁ_height
 + 
wbox
->
v•acög
);

166 
tŸÆ_width
 +(
n_cﬁs
 ? 
wbox
->
h•acög
 : 0Ë+ 
cﬁ_width
;

167 
n_cﬁs
++;

170 i‡(*
height_öc
 > 
this
->
max_chûd_height
)

171 *
height_öc
 = 0;

173  
	`MAX
 (
tŸÆ_width
, 1);

174 
	}
}

177 
	$gtk_vwøp_box_size_ªque°
 (
GtkWidgë
 *
widgë
,

178 
GtkRequisôi⁄
 *
ªquisôi⁄
)

180 
GtkVWøpBox
 *
this
 = 
	`GTK_VWRAP_BOX
 (
widgë
);

181 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widgë
);

182 
GtkWøpBoxChûd
 *
chûd
;

183 
gÊﬂt
 
øtio_di°
, 
œyout_height
 = 0;

184 
guöt
 
cﬁ_öc
 = 0;

186 
	`g_ªtu∫_if_Áû
 (
ªquisôi⁄
 !
NULL
);

188 
ªquisôi⁄
->
height
 = 0;

189 
ªquisôi⁄
->
width
 = 0;

190 
this
->
max_chûd_height
 = 0;

191 
this
->
max_chûd_width
 = 0;

194 
chûd
 = 
wbox
->
chûdªn
; chûd; chûd = chûd->
√xt
)

195 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
))

197 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

199 
	`gtk_widgë_size_ªque°
 (
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

201 
this
->
max_chûd_height
 = 
	`MAX
 (this->max_chûd_height, 
chûd_ªquisôi⁄
.
height
);

202 
this
->
max_chûd_width
 = 
	`MAX
 (this->max_chûd_width, 
chûd_ªquisôi⁄
.
width
);

206 
øtio_di°
 = 32768;

207 
œyout_height
 = 
this
->
max_chûd_height
;

210 
gÊﬂt
 
œyout_width
;

211 
gÊﬂt
 
øtio
, 
di°
;

213 
œyout_height
 +
cﬁ_öc
;

214 
œyout_width
 = 
	`gë_œyout_size
 (
this
, 
œyout_height
, &
cﬁ_öc
);

215 
øtio
 = 
œyout_width
 / 
œyout_height
;

216 
di°
 = 
	`MAX
 (
øtio
, 
wbox
->
a•e˘_øtio
Ë- 
	`MIN
 (ratio, wbox->aspect_ratio);

217 i‡(
di°
 < 
øtio_di°
)

219 
øtio_di°
 = 
di°
;

220 
ªquisôi⁄
->
height
 = 
œyout_height
;

221 
ªquisôi⁄
->
width
 = 
œyout_width
;

230 
cﬁ_öc
);

232 
ªquisôi⁄
->
width
 +
	`GTK_CONTAINER
 (
wbox
)->
b‹dî_width
 * 2;

233 
ªquisôi⁄
->
height
 +
	`GTK_CONTAINER
 (
wbox
)->
b‹dî_width
 * 2;

238 
	}
}

240 
GSLi°
*

241 
	$ªvî£_li°_cﬁ_chûdªn
 (
GtkWøpBox
 *
wbox
,

242 
GtkWøpBoxChûd
 **
chûd_p
,

243 
GtkAŒoˇti⁄
 *
¨ó
,

244 
guöt
 *
max_chûd_size
,

245 
gboﬁón
 *
ex∑nd_löe
)

247 
GSLi°
 *
¶i°
 = 
NULL
;

248 
guöt
 
height
 = 0, 
cﬁ_height
 = 
¨ó
->height;

249 
GtkWøpBoxChûd
 *
chûd
 = *
chûd_p
;

251 *
max_chûd_size
 = 0;

252 *
ex∑nd_löe
 = 
FALSE
;

254 
chûd
 && !
	`GTK_WIDGET_VISIBLE
 (chûd->
widgë
))

256 *
chûd_p
 = 
chûd
->
√xt
;

257 
chûd
 = *
chûd_p
;

260 i‡(
chûd
)

262 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

263 
guöt
 
n
 = 1;

265 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

266 
height
 +
chûd_ªquisôi⁄
.height;

267 *
max_chûd_size
 = 
	`MAX
 (*max_chûd_size, 
chûd_ªquisôi⁄
.
width
);

268 *
ex∑nd_löe
 |
chûd
->
hex∑nd
;

269 
¶i°
 = 
	`g_¶i°_¥ïíd
 (¶i°, 
chûd
);

270 *
chûd_p
 = 
chûd
->
√xt
;

271 
chûd
 = *
chûd_p
;

273 
chûd
 && 
n
 < 
wbox
->
chûd_limô
)

275 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
))

277 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

278 i‡(
height
 + 
wbox
->
v•acög
 + 
chûd_ªquisôi⁄
.heighà> 
cﬁ_height
 ||

279 
chûd
->
wøµed
)

281 
height
 +
wbox
->
v•acög
 + 
chûd_ªquisôi⁄
.height;

282 *
max_chûd_size
 = 
	`MAX
 (*max_chûd_size, 
chûd_ªquisôi⁄
.
width
);

283 *
ex∑nd_löe
 |
chûd
->
hex∑nd
;

284 
¶i°
 = 
	`g_¶i°_¥ïíd
 (¶i°, 
chûd
);

285 
n
++;

287 *
chûd_p
 = 
chûd
->
√xt
;

288 
chûd
 = *
chûd_p
;

292  
¶i°
;

293 
	}
}

296 
	$œyout_cﬁ
 (
GtkWøpBox
 *
wbox
,

297 
GtkAŒoˇti⁄
 *
¨ó
,

298 
GSLi°
 *
chûdªn
,

299 
guöt
 
chûdªn_≥r_löe
,

300 
gboﬁón
 
hex∑nd
)

302 
GSLi°
 *
¶i°
;

303 
guöt
 
n_chûdªn
 = 0, 
n_ex∑nd_chûdªn
 = 0, 
have_ex∑nd_chûdªn
 = 0;

304 
göt
 
tŸÆ_height
 = 0;

305 
gÊﬂt
 
y
, 
height
, 
exåa
;

306 
GtkAŒoˇti⁄
 
chûd_Æloˇti⁄
;

308 
¶i°
 = 
chûdªn
; sli°; sli° = sli°->
√xt
)

310 
GtkWøpBoxChûd
 *
chûd
 = 
¶i°
->
d©a
;

311 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

313 
n_chûdªn
++;

314 i‡(
chûd
->
vex∑nd
)

315 
n_ex∑nd_chûdªn
++;

317 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

318 
tŸÆ_height
 +
chûd_ªquisôi⁄
.
height
;

321 
height
 = 
	`MAX
 (1, 
¨ó
->heighà- (
n_chûdªn
 - 1Ë* 
wbox
->
v•acög
);

322 i‡(
height
 > 
tŸÆ_height
)

323 
exåa
 = 
height
 - 
tŸÆ_height
;

325 
exåa
 = 0;

326 
have_ex∑nd_chûdªn
 = 
n_ex∑nd_chûdªn
 && 
exåa
;

328 
y
 = 
¨ó
->y;

329 i‡(
wbox
->
homogíeous
)

331 
height
 = 
	`MAX
 (1, 
¨ó
->heighà- (
chûdªn_≥r_löe
 - 1Ë* 
wbox
->
v•acög
);

332 
height
 /((
gdoubÀ
Ë
chûdªn_≥r_löe
);

333 
exåa
 = 0;

335 i‡(
have_ex∑nd_chûdªn
 && 
wbox
->
ju°ify
 !
GTK_JUSTIFY_FILL
)

337 
height
 = 
exåa
;

338 
exåa
 /((
gdoubÀ
Ë
n_ex∑nd_chûdªn
);

342 i‡(
wbox
->
ju°ify
 =
GTK_JUSTIFY_FILL
)

344 
height
 = 
exåa
;

345 
have_ex∑nd_chûdªn
 = 
TRUE
;

346 
n_ex∑nd_chûdªn
 = 
n_chûdªn
;

347 
exåa
 /((
gdoubÀ
Ë
n_ex∑nd_chûdªn
);

349 i‡(
wbox
->
ju°ify
 =
GTK_JUSTIFY_CENTER
)

351 
y
 +
exåa
 / 2;

352 
height
 = 0;

353 
exåa
 = 0;

355 i‡(
wbox
->
ju°ify
 =
GTK_JUSTIFY_LEFT
)

357 
height
 = 0;

358 
exåa
 = 0;

360 i‡(
wbox
->
ju°ify
 =
GTK_JUSTIFY_RIGHT
)

362 
y
 +
exåa
;

363 
height
 = 0;

364 
exåa
 = 0;

368 
n_chûdªn
 = 0;

369 
¶i°
 = 
chûdªn
; sli°; sli° = sli°->
√xt
)

371 
GtkWøpBoxChûd
 *
chûd
 = 
¶i°
->
d©a
;

373 
chûd_Æloˇti⁄
.
y
 = y;

374 
chûd_Æloˇti⁄
.
x
 = 
¨ó
->x;

375 i‡(
wbox
->
homogíeous
)

377 
chûd_Æloˇti⁄
.
width
 = 
¨ó
->width;

378 
chûd_Æloˇti⁄
.
height
 = height;

379 
y
 +
chûd_Æloˇti⁄
.
height
 + 
wbox
->
v•acög
;

383 
GtkRequisôi⁄
 
chûd_ªquisôi⁄
;

385 
	`gë_chûd_ªquisôi⁄
 (
wbox
, 
chûd
->
widgë
, &
chûd_ªquisôi⁄
);

387 i‡(
chûd_ªquisôi⁄
.
width
 >
¨ó
->width)

388 
chûd_Æloˇti⁄
.
width
 = 
¨ó
->width;

391 
chûd_Æloˇti⁄
.
width
 = 
chûd_ªquisôi⁄
.width;

392 i‡(
wbox
->
löe_ju°ify
 =
GTK_JUSTIFY_FILL
 || 
chûd
->
hfûl
)

393 
chûd_Æloˇti⁄
.
width
 = 
¨ó
->width;

394 i‡(
chûd
->
hex∑nd
 || 
wbox
->
löe_ju°ify
 =
GTK_JUSTIFY_CENTER
)

395 
chûd_Æloˇti⁄
.
x
 +(
¨ó
->
width
 - 
chûd_ªquisôi⁄
.width) / 2;

396 i‡(
wbox
->
löe_ju°ify
 =
GTK_JUSTIFY_BOTTOM
)

397 
chûd_Æloˇti⁄
.
x
 +
¨ó
->
width
 - 
chûd_ªquisôi⁄
.width;

400 i‡(
have_ex∑nd_chûdªn
)

402 
chûd_Æloˇti⁄
.
height
 = 
chûd_ªquisôi⁄
.height;

403 i‡(
chûd
->
vex∑nd
 || 
wbox
->
ju°ify
 =
GTK_JUSTIFY_FILL
)

405 
guöt
 
•a˚
;

407 
n_ex∑nd_chûdªn
--;

408 
•a˚
 = 
exåa
 * 
n_ex∑nd_chûdªn
;

409 
•a˚
 = 
height
 - space;

410 
height
 -
•a˚
;

411 i‡(
chûd
->
vfûl
)

412 
chûd_Æloˇti⁄
.
height
 +
•a˚
;

415 
chûd_Æloˇti⁄
.
y
 +
•a˚
 / 2;

416 
y
 +
•a˚
;

424 
chûd_Æloˇti⁄
.
y
 +
n_chûdªn
 * 
exåa
;

427 
chûd_Æloˇti⁄
.
height
 = 
	`MIN
 (
chûd_ªquisôi⁄
.height,

428 
¨ó
->
height
 - 
chûd_Æloˇti⁄
.
y
 +área->y);

432 
y
 +
chûd_Æloˇti⁄
.
height
 + 
wbox
->
v•acög
;

433 
	`gtk_widgë_size_Æloˇã
 (
chûd
->
widgë
, &
chûd_Æloˇti⁄
);

434 
n_chûdªn
++;

436 
	}
}

438 
_Löe
 
	tLöe
;

439 
	s_Löe


441 
GSLi°
 *
	mchûdªn
;

442 
guöt16
 
	mmö_size
;

443 
guöt
 
	mex∑nd
 : 1;

444 
Löe
 *
	m√xt
;

448 
	$œyout_cﬁs
 (
GtkWøpBox
 *
wbox
,

449 
GtkAŒoˇti⁄
 *
¨ó
)

451 
GtkWøpBoxChûd
 *
√xt_chûd
;

452 
guöt
 
mö_width
;

453 
gboﬁón
 
hex∑nd
;

454 
GSLi°
 *
¶i°
;

455 
Löe
 *
löe_li°
 = 
NULL
;

456 
guöt
 
tŸÆ_width
 = 0, 
n_ex∑nd_löes
 = 0, 
n_löes
 = 0;

457 
gÊﬂt
 
shrök_width
;

458 
guöt
 
chûdªn_≥r_löe
;

460 
√xt_chûd
 = 
wbox
->
chûdªn
;

461 
¶i°
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`æi°_löe_chûdªn
 (wbox,

462 &
√xt_chûd
,

463 
¨ó
,

464 &
mö_width
,

465 &
hex∑nd
);

466 
¶i°
 = 
	`g_¶i°_ªvî£
 (slist);

468 
chûdªn_≥r_löe
 = 
	`g_¶i°_Àngth
 (
¶i°
);

469 
¶i°
)

471 #i‡
	`GLIB_CHECK_VERSION
(2,10,0)

472 
Löe
 *
löe
 = 
	`g_¶i˚_√w
 (Line);

474 
Löe
 *
löe
 = 
	`g_√w
 (Line, 1);

477 
löe
->
chûdªn
 = 
¶i°
;

478 
löe
->
mö_size
 = 
mö_width
;

479 
tŸÆ_width
 +
mö_width
;

480 
löe
->
ex∑nd
 = 
hex∑nd
;

481 i‡(
hex∑nd
)

482 
n_ex∑nd_löes
++;

483 
löe
->
√xt
 = 
löe_li°
;

484 
löe_li°
 = 
löe
;

485 
n_löes
++;

487 
¶i°
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`æi°_löe_chûdªn
 (wbox,

488 &
√xt_chûd
,

489 
¨ó
,

490 &
mö_width
,

491 &
hex∑nd
);

492 
¶i°
 = 
	`g_¶i°_ªvî£
 (slist);

495 i‡(
tŸÆ_width
 > 
¨ó
->
width
)

496 
shrök_width
 = 
tŸÆ_width
 - 
¨ó
->
width
;

498 
shrök_width
 = 0;

502 
Löe
 *
¥ev
 = 
NULL
, *
œ°
 = NULL;

503 
gÊﬂt
 
n_shrök_löes
 = 
n_löes
;

505 
löe_li°
)

507 
Löe
 *
tmp
 = 
löe_li°
->
√xt
;

509 i‡(
shrök_width
)

511 
Löe
 *
löe
 = 
löe_li°
;

512 
guöt
 
shrök_‰a˘
 = 
shrök_width
 / 
n_shrök_löes
 + 0.5;

514 i‡(
löe
->
mö_size
 > 
shrök_‰a˘
)

516 
shrök_width
 -
shrök_‰a˘
;

517 
löe
->
mö_size
 -
shrök_‰a˘
;

521 
shrök_width
 -
löe
->
mö_size
 - 1;

522 
löe
->
mö_size
 = 1;

525 
n_shrök_löes
--;

527 
œ°
 = 
löe_li°
;

528 
löe_li°
->
√xt
 = 
¥ev
;

529 
¥ev
 = 
löe_li°
;

530 
löe_li°
 = 
tmp
;

532 
löe_li°
 = 
œ°
;

535 i‡(
n_löes
)

537 
Löe
 *
löe
;

538 
gÊﬂt
 
x
, 
width
, 
exåa
 = 0;

540 
width
 = 
¨ó
->width;

541 
width
 = 
	`MAX
 (
n_löes
, width - (n_löe†- 1Ë* 
wbox
->
h•acög
);

543 i‡(
wbox
->
homogíeous
)

544 
width
 /((
gdoubÀ
Ë
n_löes
);

545 i‡(
n_ex∑nd_löes
)

547 
width
 = 
	`MAX
 (0, width - 
tŸÆ_width
);

548 
exåa
 = 
width
 / ((
gdoubÀ
Ë
n_ex∑nd_löes
);

551 
width
 = 0;

553 
x
 = 
¨ó
->x;

554 
löe
 = 
löe_li°
;

555 
löe
)

557 
GtkAŒoˇti⁄
 
cﬁ_Æloˇti⁄
;

558 
Löe
 *
√xt_löe
 = 
löe
->
√xt
;

560 
cﬁ_Æloˇti⁄
.
y
 = 
¨ó
->y;

561 
cﬁ_Æloˇti⁄
.
height
 = 
¨ó
->height;

562 i‡(
wbox
->
homogíeous
)

563 
cﬁ_Æloˇti⁄
.
width
 = width;

566 
cﬁ_Æloˇti⁄
.
width
 = 
löe
->
mö_size
;

568 i‡(
löe
->
ex∑nd
)

569 
cﬁ_Æloˇti⁄
.
width
 +
exåa
;

572 
cﬁ_Æloˇti⁄
.
x
 = x;

574 
x
 +
cﬁ_Æloˇti⁄
.
width
 + 
wbox
->
h•acög
;

575 
	`œyout_cﬁ
 (
wbox
,

576 &
cﬁ_Æloˇti⁄
,

577 
löe
->
chûdªn
,

578 
chûdªn_≥r_löe
,

579 
löe
->
ex∑nd
);

581 
	`g_¶i°_‰ì
 (
löe
->
chûdªn
);

582 #i‡(!
	`GLIB_CHECK_VERSION
(2,10,0))

583 
	`g_‰ì
 (
löe
);

585 
löe
 = 
√xt_löe
;

588 #i‡
	`GLIB_CHECK_VERSION
(2,10,0)

589 
	`g_¶i˚_‰ì_chaö
 (
Löe
, 
löe_li°
, 
√xt
);

592 
	}
}

595 
	$gtk_vwøp_box_size_Æloˇã
 (
GtkWidgë
 *
widgë
,

596 
GtkAŒoˇti⁄
 *
Æloˇti⁄
)

598 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widgë
);

599 
GtkAŒoˇti⁄
 
¨ó
;

600 
göt
 
b‹dî
 = 
	`GTK_CONTAINER
 (
wbox
)->
b‹dî_width
;

602 
widgë
->
Æloˇti⁄
 = *allocation;

603 
¨ó
.
y
 = 
Æloˇti⁄
->y + 
b‹dî
;

604 
¨ó
.
x
 = 
Æloˇti⁄
->x + 
b‹dî
;

605 
¨ó
.
height
 = 
	`MAX
 (1, (
göt
Ë
Æloˇti⁄
->heighà- 
b‹dî
 * 2);

606 
¨ó
.
width
 = 
	`MAX
 (1, (
göt
Ë
Æloˇti⁄
->width - 
b‹dî
 * 2);

615 
	`œyout_cﬁs
 (
wbox
, &
¨ó
);

616 
	}
}

	@O:\tool\dvs50\app\gtkvwrapbox.h

23 #i‚de‡
__GTK_VWRAP_BOX_H__


24 
	#__GTK_VWRAP_BOX_H__


	)

27 
	~"gtkwøpbox.h
"

29 
	gG_BEGIN_DECLS


33 
	#GTK_TYPE_VWRAP_BOX
 (
	`gtk_vwøp_box_gë_ty≥
 ())

	)

34 
	#GTK_VWRAP_BOX
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
GTK_TYPE_VWRAP_BOX
, 
GtkVWøpBox
))

	)

35 
	#GTK_VWRAP_BOX_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
GTK_TYPE_VWRAP_BOX
, 
GtkVWøpBoxCœss
))

	)

36 
	#GTK_IS_VWRAP_BOX
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
GTK_TYPE_VWRAP_BOX
))

	)

37 
	#GTK_IS_VWRAP_BOX_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kœss), 
GTK_TYPE_VWRAP_BOX
))

	)

38 
	#GTK_VWRAP_BOX_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
GTK_TYPE_VWRAP_BOX
, 
GtkVWøpBoxCœss
))

	)

42 
_GtkVWøpBox
 
	tGtkVWøpBox
;

43 
_GtkVWøpBoxCœss
 
	tGtkVWøpBoxCœss
;

47 
	s_GtkVWøpBox


49 
GtkWøpBox
 
	m∑ª¡_widgë
;

52 
guöt
 
	mmax_chûd_width
;

53 
guöt
 
	mmax_chûd_height
;

57 
	s_GtkVWøpBoxCœss


59 
GtkWøpBoxCœss
 
	m∑ª¡_˛ass
;

64 
GTy≥
 
	$gtk_vwøp_box_gë_ty≥
 (Ë
G_GNUC_CONST
;

65 
GtkWidgë
 * 
	`gtk_vwøp_box_√w
 (
gboﬁón
 
homogíeous
);

68 
G_END_DECLS


	@O:\tool\dvs50\app\gtkwrapbox.c

23 
	~"c⁄fig.h
"

25 
	~"gtkwøpbox.h
"

30 
	mPROP_0
,

31 
	mPROP_HOMOGENEOUS
,

32 
	mPROP_JUSTIFY
,

33 
	mPROP_HSPACING
,

34 
	mPROP_VSPACING
,

35 
	mPROP_LINE_JUSTIFY
,

36 
	mPROP_ASPECT_RATIO
,

37 
	mPROP_CURRENT_RATIO
,

38 
	mPROP_CHILD_LIMIT


42 
	mCHILD_PROP_0
,

43 
	mCHILD_PROP_POSITION
,

44 
	mCHILD_PROP_HEXPAND
,

45 
	mCHILD_PROP_HFILL
,

46 
	mCHILD_PROP_VEXPAND
,

47 
	mCHILD_PROP_VFILL
,

48 
	mCHILD_PROP_WRAPPED


53 
gtk_wøp_box_˛ass_öô
 (
GtkWøpBoxCœss
 *
kœss
);

54 
gtk_wøp_box_öô
 (
GtkWøpBox
 *
wbox
);

55 
gtk_wøp_box_£t_¥›îty
 (
GObje˘
 *
obje˘
,

56 
guöt
 
¥›îty_id
,

57 c⁄° 
GVÆue
 *
vÆue
,

58 
GP¨amS≥c
 *
p•ec
);

59 
gtk_wøp_box_gë_¥›îty
 (
GObje˘
 *
obje˘
,

60 
guöt
 
¥›îty_id
,

61 
GVÆue
 *
vÆue
,

62 
GP¨amS≥c
 *
p•ec
);

63 
gtk_wøp_box_£t_chûd_¥›îty
 (
GtkC⁄èöî
 *
c⁄èöî
,

64 
GtkWidgë
 *
chûd
,

65 
guöt
 
¥›îty_id
,

66 c⁄° 
GVÆue
 *
vÆue
,

67 
GP¨amS≥c
 *
p•ec
);

68 
gtk_wøp_box_gë_chûd_¥›îty
 (
GtkC⁄èöî
 *
c⁄èöî
,

69 
GtkWidgë
 *
chûd
,

70 
guöt
 
¥›îty_id
,

71 
GVÆue
 *
vÆue
,

72 
GP¨amS≥c
 *
p•ec
);

73 
gtk_wøp_box_m≠
 (
GtkWidgë
 *
widgë
);

74 
gtk_wøp_box_unm≠
 (
GtkWidgë
 *
widgë
);

75 
göt
 
gtk_wøp_box_expo£
 (
GtkWidgë
 *
widgë
,

76 
GdkEvítExpo£
 *
evít
);

77 
gtk_wøp_box_add
 (
GtkC⁄èöî
 *
c⁄èöî
,

78 
GtkWidgë
 *
widgë
);

79 
gtk_wøp_box_ªmove
 (
GtkC⁄èöî
 *
c⁄èöî
,

80 
GtkWidgë
 *
widgë
);

81 
gtk_wøp_box_f‹Æl
 (
GtkC⁄èöî
 *
c⁄èöî
,

82 
gboﬁón
 
ö˛ude_öã∫Æs
,

83 
GtkCÆlback
 
ˇŒback
,

84 
gpoöãr
 
ˇŒback_d©a
);

85 
GTy≥
 
gtk_wøp_box_chûd_ty≥
 (
GtkC⁄èöî
 *
c⁄èöî
);

89 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

93 
GTy≥


94 
	$gtk_wøp_box_gë_ty≥
 ()

96 
GTy≥
 
wøp_box_ty≥
 = 0;

98 i‡(! 
wøp_box_ty≥
)

100 c⁄° 
GTy≥Info
 
wøp_box_öfo
 =

102  (
GtkWøpBoxCœss
),

103 
NULL
,

104 
NULL
,

105 (
GCœssInôFunc
Ë
gtk_wøp_box_˛ass_öô
,

106 
NULL
,

107 
NULL
,

108  (
GtkWøpBox
),

110 (
GIn°™˚InôFunc
Ë
gtk_wøp_box_öô
,

113 
wøp_box_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
GTK_TYPE_CONTAINER
, "GtkWrapBox",

114 &
wøp_box_öfo
, 0);

117  
wøp_box_ty≥
;

118 
	}
}

121 
	$gtk_wøp_box_˛ass_öô
 (
GtkWøpBoxCœss
 *
˛ass
)

123 
GObje˘Cœss
 *
obje˘_˛ass
;

124 
GtkWidgëCœss
 *
widgë_˛ass
;

125 
GtkC⁄èöîCœss
 *
c⁄èöî_˛ass
;

127 
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
˛ass
);

128 
widgë_˛ass
 = 
	`GTK_WIDGET_CLASS
 (
˛ass
);

129 
c⁄èöî_˛ass
 = 
	`GTK_CONTAINER_CLASS
 (
˛ass
);

131 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
˛ass
);

133 
obje˘_˛ass
->
£t_¥›îty
 = 
gtk_wøp_box_£t_¥›îty
;

134 
obje˘_˛ass
->
gë_¥›îty
 = 
gtk_wøp_box_gë_¥›îty
;

136 
widgë_˛ass
->
m≠
 = 
gtk_wøp_box_m≠
;

137 
widgë_˛ass
->
unm≠
 = 
gtk_wøp_box_unm≠
;

138 
widgë_˛ass
->
expo£_evít
 = 
gtk_wøp_box_expo£
;

140 
c⁄èöî_˛ass
->
add
 = 
gtk_wøp_box_add
;

141 
c⁄èöî_˛ass
->
ªmove
 = 
gtk_wøp_box_ªmove
;

142 
c⁄èöî_˛ass
->
f‹Æl
 = 
gtk_wøp_box_f‹Æl
;

143 
c⁄èöî_˛ass
->
chûd_ty≥
 = 
gtk_wøp_box_chûd_ty≥
;

144 
c⁄èöî_˛ass
->
£t_chûd_¥›îty
 = 
gtk_wøp_box_£t_chûd_¥›îty
;

145 
c⁄èöî_˛ass
->
gë_chûd_¥›îty
 = 
gtk_wøp_box_gë_chûd_¥›îty
;

147 
˛ass
->
æi°_löe_chûdªn
 = 
NULL
;

149 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
,

150 
PROP_HOMOGENEOUS
,

151 
	`g_∑øm_•ec_boﬁón
 ("homogeneous",

152 
NULL
,

153 
NULL
,

154 
FALSE
,

155 
G_PARAM_READWRITE
));

156 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
,

157 
PROP_JUSTIFY
,

158 
	`g_∑øm_•ec_íum
 ("justify",

159 
NULL
,

160 
NULL
,

161 
GTK_TYPE_JUSTIFICATION
,

162 
GTK_JUSTIFY_LEFT
,

163 
G_PARAM_READWRITE
));

164 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
,

165 
PROP_HSPACING
,

166 
	`g_∑øm_•ec_uöt
 ("hspacing",

167 
NULL
,

168 
NULL
,

170 
G_MAXINT
,

172 
G_PARAM_READWRITE
));

174 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
,

175 
PROP_VSPACING
,

176 
	`g_∑øm_•ec_uöt
 ("vspacing",

177 
NULL
,

178 
NULL
,

180 
G_MAXINT
,

182 
G_PARAM_READWRITE
));

184 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
,

185 
PROP_LINE_JUSTIFY
,

186 
	`g_∑øm_•ec_íum
 ("line-justify",

187 
NULL
,

188 
NULL
,

189 
GTK_TYPE_JUSTIFICATION
,

190 
GTK_JUSTIFY_BOTTOM
,

191 
G_PARAM_READWRITE
));

193 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
,

194 
PROP_ASPECT_RATIO
,

195 
	`g_∑øm_•ec_Êﬂt
 ("aspect-ratio",

196 
NULL
,

197 
NULL
,

199 
G_MAXFLOAT
,

201 
G_PARAM_READWRITE
));

203 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
,

204 
PROP_CURRENT_RATIO
,

205 
	`g_∑øm_•ec_Êﬂt
 ("current-ratio",

206 
NULL
,

207 
NULL
,

209 
G_MAXFLOAT
,

211 
G_PARAM_READABLE
));

213 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
,

214 
PROP_CHILD_LIMIT
,

215 
	`g_∑øm_•ec_uöt
 ("max-children-per-line",

216 
NULL
,

217 
NULL
,

221 
G_PARAM_READWRITE
));

223 
	`gtk_c⁄èöî_˛ass_ö°Æl_chûd_¥›îty
 (
c⁄èöî_˛ass
,

224 
CHILD_PROP_POSITION
,

225 
	`g_∑øm_•ec_öt
 ("position",

226 
NULL
,

227 
NULL
,

228 -1, 
G_MAXINT
, 0,

229 
G_PARAM_READWRITE
));

230 
	`gtk_c⁄èöî_˛ass_ö°Æl_chûd_¥›îty
 (
c⁄èöî_˛ass
,

231 
CHILD_PROP_HEXPAND
,

232 
	`g_∑øm_•ec_boﬁón
 ("hexpand",

233 
NULL
,

234 
NULL
,

235 
FALSE
,

236 
G_PARAM_READWRITE
));

237 
	`gtk_c⁄èöî_˛ass_ö°Æl_chûd_¥›îty
 (
c⁄èöî_˛ass
,

238 
CHILD_PROP_HFILL
,

239 
	`g_∑øm_•ec_boﬁón
 ("hfill",

240 
NULL
,

241 
NULL
,

242 
FALSE
,

243 
G_PARAM_READWRITE
));

244 
	`gtk_c⁄èöî_˛ass_ö°Æl_chûd_¥›îty
 (
c⁄èöî_˛ass
,

245 
CHILD_PROP_VEXPAND
,

246 
	`g_∑øm_•ec_boﬁón
 ("vexpand",

247 
NULL
,

248 
NULL
,

249 
FALSE
,

250 
G_PARAM_READWRITE
));

251 
	`gtk_c⁄èöî_˛ass_ö°Æl_chûd_¥›îty
 (
c⁄èöî_˛ass
,

252 
CHILD_PROP_VFILL
,

253 
	`g_∑øm_•ec_boﬁón
 ("vfill",

254 
NULL
,

255 
NULL
,

256 
FALSE
,

257 
G_PARAM_READWRITE
));

258 
	`gtk_c⁄èöî_˛ass_ö°Æl_chûd_¥›îty
 (
c⁄èöî_˛ass
,

259 
CHILD_PROP_WRAPPED
,

260 
	`g_∑øm_•ec_boﬁón
 ("wrapped",

261 
NULL
,

262 
NULL
,

263 
FALSE
,

264 
G_PARAM_READWRITE
));

265 
	}
}

268 
	$gtk_wøp_box_öô
 (
GtkWøpBox
 *
wbox
)

270 
	`GTK_WIDGET_SET_FLAGS
 (
wbox
, 
GTK_NO_WINDOW
);

272 
wbox
->
homogíeous
 = 
FALSE
;

273 
wbox
->
h•acög
 = 0;

274 
wbox
->
v•acög
 = 0;

275 
wbox
->
ju°ify
 = 
GTK_JUSTIFY_LEFT
;

276 
wbox
->
löe_ju°ify
 = 
GTK_JUSTIFY_BOTTOM
;

277 
wbox
->
n_chûdªn
 = 0;

278 
wbox
->
chûdªn
 = 
NULL
;

279 
wbox
->
a•e˘_øtio
 = 1.0;

280 
wbox
->
chûd_limô
 = 32767;

281 
	}
}

284 
	$gtk_wøp_box_£t_¥›îty
 (
GObje˘
 *
obje˘
,

285 
guöt
 
¥›îty_id
,

286 c⁄° 
GVÆue
 *
vÆue
,

287 
GP¨amS≥c
 *
p•ec
)

289 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
obje˘
);

291 
¥›îty_id
)

293 
PROP_HOMOGENEOUS
:

294 
	`gtk_wøp_box_£t_homogíeous
 (
wbox
, 
	`g_vÆue_gë_boﬁón
 (
vÆue
));

296 
PROP_JUSTIFY
:

297 
	`gtk_wøp_box_£t_ju°ify
 (
wbox
, 
	`g_vÆue_gë_íum
 (
vÆue
));

299 
PROP_LINE_JUSTIFY
:

300 
	`gtk_wøp_box_£t_löe_ju°ify
 (
wbox
, 
	`g_vÆue_gë_íum
 (
vÆue
));

302 
PROP_HSPACING
:

303 
	`gtk_wøp_box_£t_h•acög
 (
wbox
, 
	`g_vÆue_gë_uöt
 (
vÆue
));

305 
PROP_VSPACING
:

306 
	`gtk_wøp_box_£t_v•acög
 (
wbox
, 
	`g_vÆue_gë_uöt
 (
vÆue
));

308 
PROP_ASPECT_RATIO
:

309 
	`gtk_wøp_box_£t_a•e˘_øtio
 (
wbox
, 
	`g_vÆue_gë_Êﬂt
 (
vÆue
));

311 
PROP_CHILD_LIMIT
:

312 i‡(
wbox
->
chûd_limô
 !
	`g_vÆue_gë_uöt
 (
vÆue
))

313 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
wbox
));

316 
	`G_OBJECT_WARN_INVALID_PROPERTY_ID
 (
obje˘
, 
¥›îty_id
, 
p•ec
);

319 
	}
}

322 
	$gtk_wøp_box_gë_¥›îty
 (
GObje˘
 *
obje˘
,

323 
guöt
 
¥›îty_id
,

324 
GVÆue
 *
vÆue
,

325 
GP¨amS≥c
 *
p•ec
)

327 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
obje˘
);

328 
GtkWidgë
 *
widgë
 = 
	`GTK_WIDGET
 (
obje˘
);

330 
¥›îty_id
)

332 
PROP_HOMOGENEOUS
:

333 
	`g_vÆue_£t_boﬁón
 (
vÆue
, 
wbox
->
homogíeous
);

335 
PROP_JUSTIFY
:

336 
	`g_vÆue_£t_íum
 (
vÆue
, 
wbox
->
ju°ify
);

338 
PROP_LINE_JUSTIFY
:

339 
	`g_vÆue_£t_íum
 (
vÆue
, 
wbox
->
löe_ju°ify
);

341 
PROP_HSPACING
:

342 
	`g_vÆue_£t_uöt
 (
vÆue
, 
wbox
->
h•acög
);

344 
PROP_VSPACING
:

345 
	`g_vÆue_£t_uöt
 (
vÆue
, 
wbox
->
v•acög
);

347 
PROP_ASPECT_RATIO
:

348 
	`g_vÆue_£t_Êﬂt
 (
vÆue
, 
wbox
->
a•e˘_øtio
);

350 
PROP_CURRENT_RATIO
:

351 
	`g_vÆue_£t_Êﬂt
 (
vÆue
, (((
gÊﬂt
Ë
widgë
->
Æloˇti⁄
.
width
) /

352 ((
gÊﬂt
Ë
widgë
->
Æloˇti⁄
.
height
)));

354 
PROP_CHILD_LIMIT
:

355 
	`g_vÆue_£t_uöt
 (
vÆue
, 
wbox
->
chûd_limô
);

358 
	`G_OBJECT_WARN_INVALID_PROPERTY_ID
 (
obje˘
, 
¥›îty_id
, 
p•ec
);

361 
	}
}

364 
	$gtk_wøp_box_£t_chûd_¥›îty
 (
GtkC⁄èöî
 *
c⁄èöî
,

365 
GtkWidgë
 *
chûd
,

366 
guöt
 
¥›îty_id
,

367 c⁄° 
GVÆue
 *
vÆue
,

368 
GP¨amS≥c
 *
p•ec
)

370 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
c⁄èöî
);

371 
gboﬁón
 
hex∑nd
 = 
FALSE
, 
hfûl
 = FALSE;

372 
gboﬁón
 
vex∑nd
 = 
FALSE
, 
vfûl
 = FALSE;

373 
gboﬁón
 
wøµed
 = 
FALSE
;

375 i‡(
¥›îty_id
 !
CHILD_PROP_POSITION
)

376 
	`gtk_wøp_box_quîy_chûd_∑ckög
 (
wbox
, 
chûd
,

377 &
hex∑nd
, &
hfûl
,

378 &
vex∑nd
, &
vfûl
,

379 &
wøµed
);

381 
¥›îty_id
)

383 
CHILD_PROP_POSITION
:

384 
	`gtk_wøp_box_ª‹dî_chûd
 (
wbox
, 
chûd
, 
	`g_vÆue_gë_öt
 (
vÆue
));

386 
CHILD_PROP_HEXPAND
:

387 
	`gtk_wøp_box_£t_chûd_∑ckög
 (
wbox
, 
chûd
,

388 
	`g_vÆue_gë_boﬁón
 (
vÆue
), 
hfûl
,

389 
vex∑nd
, 
vfûl
,

390 
wøµed
);

392 
CHILD_PROP_HFILL
:

393 
	`gtk_wøp_box_£t_chûd_∑ckög
 (
wbox
, 
chûd
,

394 
hex∑nd
, 
	`g_vÆue_gë_boﬁón
 (
vÆue
),

395 
vex∑nd
, 
vfûl
,

396 
wøµed
);

398 
CHILD_PROP_VEXPAND
:

399 
	`gtk_wøp_box_£t_chûd_∑ckög
 (
wbox
, 
chûd
,

400 
hex∑nd
, 
hfûl
,

401 
	`g_vÆue_gë_boﬁón
 (
vÆue
), 
vfûl
,

402 
wøµed
);

404 
CHILD_PROP_VFILL
:

405 
	`gtk_wøp_box_£t_chûd_∑ckög
 (
wbox
, 
chûd
,

406 
hex∑nd
, 
hfûl
,

407 
vex∑nd
, 
	`g_vÆue_gë_boﬁón
 (
vÆue
),

408 
wøµed
);

410 
CHILD_PROP_WRAPPED
:

411 
	`gtk_wøp_box_£t_chûd_∑ckög
 (
wbox
, 
chûd
,

412 
hex∑nd
, 
hfûl
,

413 
vex∑nd
, 
vfûl
,

414 
	`g_vÆue_gë_boﬁón
 (
vÆue
));

417 
	`GTK_CONTAINER_WARN_INVALID_CHILD_PROPERTY_ID
 (
c⁄èöî
, 
¥›îty_id
, 
p•ec
);

420 
	}
}

423 
	$gtk_wøp_box_gë_chûd_¥›îty
 (
GtkC⁄èöî
 *
c⁄èöî
,

424 
GtkWidgë
 *
chûd
,

425 
guöt
 
¥›îty_id
,

426 
GVÆue
 *
vÆue
,

427 
GP¨amS≥c
 *
p•ec
)

429 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
c⁄èöî
);

430 
gboﬁón
 
hex∑nd
 = 
FALSE
, 
hfûl
 = FALSE;

431 
gboﬁón
 
vex∑nd
 = 
FALSE
, 
vfûl
 = FALSE;

432 
gboﬁón
 
wøµed
 = 
FALSE
;

434 i‡(
¥›îty_id
 !
CHILD_PROP_POSITION
)

435 
	`gtk_wøp_box_quîy_chûd_∑ckög
 (
wbox
, 
chûd
,

436 &
hex∑nd
, &
hfûl
,

437 &
vex∑nd
, &
vfûl
,

438 &
wøµed
);

440 
¥›îty_id
)

442 
GtkWøpBoxChûd
 *
chûd_öfo
;

443 
guöt
 
i
;

444 
CHILD_PROP_POSITION
:

445 
i
 = 0;

446 
chûd_öfo
 = 
wbox
->
chûdªn
; chûd_öfo; chûd_öfÿchûd_öfo->
√xt
)

448 i‡(
chûd_öfo
->
widgë
 =
chûd
)

450 
i
 += 1;

452 
	`g_vÆue_£t_öt
 (
vÆue
, 
chûd_öfo
 ? 
i
 : -1);

454 
CHILD_PROP_HEXPAND
:

455 
	`g_vÆue_£t_boﬁón
 (
vÆue
, 
hex∑nd
);

457 
CHILD_PROP_HFILL
:

458 
	`g_vÆue_£t_boﬁón
 (
vÆue
, 
hfûl
);

460 
CHILD_PROP_VEXPAND
:

461 
	`g_vÆue_£t_boﬁón
 (
vÆue
, 
vex∑nd
);

463 
CHILD_PROP_VFILL
:

464 
	`g_vÆue_£t_boﬁón
 (
vÆue
, 
vfûl
);

466 
CHILD_PROP_WRAPPED
:

467 
	`g_vÆue_£t_boﬁón
 (
vÆue
, 
wøµed
);

470 
	`GTK_CONTAINER_WARN_INVALID_CHILD_PROPERTY_ID
 (
c⁄èöî
, 
¥›îty_id
, 
p•ec
);

473 
	}
}

475 
GTy≥


476 
	$gtk_wøp_box_chûd_ty≥
 (
GtkC⁄èöî
 *
c⁄èöî
)

478  
GTK_TYPE_WIDGET
;

479 
	}
}

482 
	$gtk_wøp_box_£t_homogíeous
 (
GtkWøpBox
 *
wbox
,

483 
gboﬁón
 
homogíeous
)

485 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

487 
homogíeous
 = homogíeou†!
FALSE
;

488 i‡(
wbox
->
homogíeous
 != homogeneous)

490 
wbox
->
homogíeous
 = homogeneous;

491 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
wbox
));

493 
	}
}

496 
	$gtk_wøp_box_£t_h•acög
 (
GtkWøpBox
 *
wbox
,

497 
guöt
 
h•acög
)

499 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

501 i‡(
wbox
->
h•acög
 != hspacing)

503 
wbox
->
h•acög
 = hspacing;

504 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
wbox
));

506 
	}
}

509 
	$gtk_wøp_box_£t_v•acög
 (
GtkWøpBox
 *
wbox
,

510 
guöt
 
v•acög
)

512 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

514 i‡(
wbox
->
v•acög
 != vspacing)

516 
wbox
->
v•acög
 = vspacing;

517 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
wbox
));

519 
	}
}

522 
	$gtk_wøp_box_£t_ju°ify
 (
GtkWøpBox
 *
wbox
,

523 
GtkJu°ifiˇti⁄
 
ju°ify
)

525 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

526 
	`g_ªtu∫_if_Áû
 (
ju°ify
 <
GTK_JUSTIFY_FILL
);

528 i‡(
wbox
->
ju°ify
 != justify)

530 
wbox
->
ju°ify
 = justify;

531 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
wbox
));

533 
	}
}

536 
	$gtk_wøp_box_£t_löe_ju°ify
 (
GtkWøpBox
 *
wbox
,

537 
GtkJu°ifiˇti⁄
 
löe_ju°ify
)

539 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

540 
	`g_ªtu∫_if_Áû
 (
löe_ju°ify
 <
GTK_JUSTIFY_FILL
);

542 i‡(
wbox
->
löe_ju°ify
 !=Üine_justify)

544 
wbox
->
löe_ju°ify
 =Üine_justify;

545 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
wbox
));

547 
	}
}

550 
	$gtk_wøp_box_£t_a•e˘_øtio
 (
GtkWøpBox
 *
wbox
,

551 
gÊﬂt
 
a•e˘_øtio
)

553 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

555 
a•e˘_øtio
 = 
	`CLAMP
 (aspect_ratio, 1.0 / 256.0, 256.0);

557 i‡(
wbox
->
a•e˘_øtio
 !=áspect_ratio)

559 
wbox
->
a•e˘_øtio
 =áspect_ratio;

560 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
wbox
));

562 
	}
}

565 
	$gtk_wøp_box_∑ck
 (
GtkWøpBox
 *
wbox
,

566 
GtkWidgë
 *
chûd
,

567 
gboﬁón
 
hex∑nd
,

568 
gboﬁón
 
hfûl
,

569 
gboﬁón
 
vex∑nd
,

570 
gboﬁón
 
vfûl
)

572 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

573 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WIDGET
 (
chûd
));

574 
	`g_ªtu∫_if_Áû
 (
chûd
->
∑ª¡
 =
NULL
);

576 
	`gtk_wøp_box_∑ck_wøµed
 (
wbox
, 
chûd
, 
hex∑nd
, 
hfûl
, 
vex∑nd
, 
vfûl
, 
FALSE
);

577 
	}
}

580 
	$gtk_wøp_box_∑ck_wøµed
 (
GtkWøpBox
 *
wbox
,

581 
GtkWidgë
 *
chûd
,

582 
gboﬁón
 
hex∑nd
,

583 
gboﬁón
 
hfûl
,

584 
gboﬁón
 
vex∑nd
,

585 
gboﬁón
 
vfûl
,

586 
gboﬁón
 
wøµed
)

588 
GtkWøpBoxChûd
 *
chûd_öfo
;

590 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

591 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WIDGET
 (
chûd
));

592 
	`g_ªtu∫_if_Áû
 (
chûd
->
∑ª¡
 =
NULL
);

594 #i‡
	`GLIB_CHECK_VERSION
(2,10,0)

595 
chûd_öfo
 = 
	`g_¶i˚_√w
 (
GtkWøpBoxChûd
);

597 
chûd_öfo
 = 
	`g_√w
 (
GtkWøpBoxChûd
, 1);

600 
chûd_öfo
->
widgë
 = 
chûd
;

601 
chûd_öfo
->
hex∑nd
 = hex∑nd ? 
TRUE
 : 
FALSE
;

602 
chûd_öfo
->
hfûl
 = hfû»? 
TRUE
 : 
FALSE
;

603 
chûd_öfo
->
vex∑nd
 = vex∑nd ? 
TRUE
 : 
FALSE
;

604 
chûd_öfo
->
vfûl
 = vfû»? 
TRUE
 : 
FALSE
;

605 
chûd_öfo
->
wøµed
 = wøµed ? 
TRUE
 : 
FALSE
;

606 
chûd_öfo
->
√xt
 = 
NULL
;

607 i‡(
wbox
->
chûdªn
)

609 
GtkWøpBoxChûd
 *
œ°
 = 
wbox
->
chûdªn
;

611 
œ°
->
√xt
)

612 
œ°
 =Üa°->
√xt
;

613 
œ°
->
√xt
 = 
chûd_öfo
;

616 
wbox
->
chûdªn
 = 
chûd_öfo
;

617 
wbox
->
n_chûdªn
++;

619 
	`gtk_widgë_£t_∑ª¡
 (
chûd
, 
	`GTK_WIDGET
 (
wbox
));

621 i‡(
	`GTK_WIDGET_REALIZED
 (
wbox
))

622 
	`gtk_widgë_ªÆize
 (
chûd
);

624 i‡(
	`GTK_WIDGET_VISIBLE
 (
wbox
Ë&& GTK_WIDGET_VISIBLE (
chûd
))

626 i‡(
	`GTK_WIDGET_MAPPED
 (
wbox
))

627 
	`gtk_widgë_m≠
 (
chûd
);

629 
	`gtk_widgë_queue_ªsize
 (
chûd
);

631 
	}
}

634 
	$gtk_wøp_box_ª‹dî_chûd
 (
GtkWøpBox
 *
wbox
,

635 
GtkWidgë
 *
chûd
,

636 
göt
 
posôi⁄
)

638 
GtkWøpBoxChûd
 *
chûd_öfo
, *
œ°
 = 
NULL
;

640 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

641 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WIDGET
 (
chûd
));

643 
chûd_öfo
 = 
wbox
->
chûdªn
; chûd_öfo; 
œ°
 = chûd_öfo, chûd_öfÿœ°->
√xt
)

644 i‡(
chûd_öfo
->
widgë
 =
chûd
)

647 i‡(
chûd_öfo
 && 
wbox
->
chûdªn
->
√xt
)

649 
GtkWøpBoxChûd
 *
tmp
;

651 i‡(
œ°
)

652 
œ°
->
√xt
 = 
chûd_öfo
->next;

654 
wbox
->
chûdªn
 = 
chûd_öfo
->
√xt
;

656 
œ°
 = 
NULL
;

657 
tmp
 = 
wbox
->
chûdªn
;

658 
posôi⁄
 && 
tmp
->
√xt
)

660 
posôi⁄
--;

661 
œ°
 = 
tmp
;

662 
tmp
 = 
œ°
->
√xt
;

665 i‡(
posôi⁄
)

667 
tmp
->
√xt
 = 
chûd_öfo
;

668 
chûd_öfo
->
√xt
 = 
NULL
;

672 
chûd_öfo
->
√xt
 = 
tmp
;

673 i‡(
œ°
)

674 
œ°
->
√xt
 = 
chûd_öfo
;

676 
wbox
->
chûdªn
 = 
chûd_öfo
;

679 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
Ë&& GTK_WIDGET_VISIBLE (
wbox
))

680 
	`gtk_widgë_queue_ªsize
 (
chûd
);

682 
	}
}

685 
	$gtk_wøp_box_quîy_chûd_∑ckög
 (
GtkWøpBox
 *
wbox
,

686 
GtkWidgë
 *
chûd
,

687 
gboﬁón
 *
hex∑nd
,

688 
gboﬁón
 *
hfûl
,

689 
gboﬁón
 *
vex∑nd
,

690 
gboﬁón
 *
vfûl
,

691 
gboﬁón
 *
wøµed
)

693 
GtkWøpBoxChûd
 *
chûd_öfo
;

695 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

696 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WIDGET
 (
chûd
));

698 
chûd_öfo
 = 
wbox
->
chûdªn
; chûd_öfo; chûd_öfÿchûd_öfo->
√xt
)

699 i‡(
chûd_öfo
->
widgë
 =
chûd
)

702 i‡(
chûd_öfo
)

704 i‡(
hex∑nd
)

705 *
hex∑nd
 = 
chûd_öfo
->hexpand;

706 i‡(
hfûl
)

707 *
hfûl
 = 
chûd_öfo
->hfill;

708 i‡(
vex∑nd
)

709 *
vex∑nd
 = 
chûd_öfo
->vexpand;

710 i‡(
vfûl
)

711 *
vfûl
 = 
chûd_öfo
->vfill;

712 i‡(
wøµed
)

713 *
wøµed
 = 
chûd_öfo
->wrapped;

715 
	}
}

718 
	$gtk_wøp_box_£t_chûd_∑ckög
 (
GtkWøpBox
 *
wbox
,

719 
GtkWidgë
 *
chûd
,

720 
gboﬁón
 
hex∑nd
,

721 
gboﬁón
 
hfûl
,

722 
gboﬁón
 
vex∑nd
,

723 
gboﬁón
 
vfûl
,

724 
gboﬁón
 
wøµed
)

726 
GtkWøpBoxChûd
 *
chûd_öfo
;

728 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

729 
	`g_ªtu∫_if_Áû
 (
	`GTK_IS_WIDGET
 (
chûd
));

731 
hex∑nd
 = hex∑nd !
FALSE
;

732 
hfûl
 = hfû»!
FALSE
;

733 
vex∑nd
 = vex∑nd !
FALSE
;

734 
vfûl
 = vfû»!
FALSE
;

735 
wøµed
 = wøµed !
FALSE
;

737 
chûd_öfo
 = 
wbox
->
chûdªn
; chûd_öfo; chûd_öfÿchûd_öfo->
√xt
)

738 i‡(
chûd_öfo
->
widgë
 =
chûd
)

741 i‡(
chûd_öfo
 &&

742 (
chûd_öfo
->
hex∑nd
 !hex∑nd || chûd_öfo->
vex∑nd
 != vexpand ||

743 
chûd_öfo
->
hfûl
 !hfû»|| chûd_öfo->
vfûl
 != vfill ||

744 
chûd_öfo
->
wøµed
 != wrapped))

746 
chûd_öfo
->
hex∑nd
 = hexpand;

747 
chûd_öfo
->
hfûl
 = hfill;

748 
chûd_öfo
->
vex∑nd
 = vexpand;

749 
chûd_öfo
->
vfûl
 = vfill;

750 
chûd_öfo
->
wøµed
 = wrapped;

752 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
Ë&& GTK_WIDGET_VISIBLE (
wbox
))

753 
	`gtk_widgë_queue_ªsize
 (
chûd
);

755 
	}
}

757 
guöt
*

758 
	$gtk_wøp_box_quîy_löe_Àngths
 (
GtkWøpBox
 *
wbox
,

759 
guöt
 *
_n_löes
)

761 
GtkWøpBoxChûd
 *
√xt_chûd
 = 
NULL
;

762 
GtkAŒoˇti⁄
 
¨ó
, *
Æloˇti⁄
;

763 
gboﬁón
 
ex∑nd_löe
;

764 
GSLi°
 *
¶i°
;

765 
guöt
 
max_chûd_size
, 
b‹dî
, 
n_löes
 = 0, *
löes
 = 
NULL
;

767 i‡(
_n_löes
)

768 *
_n_löes
 = 0;

769 
	`g_ªtu∫_vÆ_if_Áû
 (
	`GTK_IS_WRAP_BOX
 (
wbox
), 
NULL
);

771 
Æloˇti⁄
 = &
	`GTK_WIDGET
 (
wbox
)->allocation;

772 
b‹dî
 = 
	`GTK_CONTAINER
 (
wbox
)->
b‹dî_width
;

773 
¨ó
.
x
 = 
Æloˇti⁄
->x + 
b‹dî
;

774 
¨ó
.
y
 = 
Æloˇti⁄
->y + 
b‹dî
;

775 
¨ó
.
width
 = 
	`MAX
 (1, (
göt
Ë
Æloˇti⁄
->width - 
b‹dî
 * 2);

776 
¨ó
.
height
 = 
	`MAX
 (1, (
göt
Ë
Æloˇti⁄
->heighà- 
b‹dî
 * 2);

778 
√xt_chûd
 = 
wbox
->
chûdªn
;

779 
¶i°
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`æi°_löe_chûdªn
 (wbox,

780 &
√xt_chûd
,

781 &
¨ó
,

782 &
max_chûd_size
,

783 &
ex∑nd_löe
);

784 
¶i°
)

786 
guöt
 
l
 = 
n_löes
++;

788 
löes
 = 
	`g_ª√w
 (
guöt
,Üöes, 
n_löes
);

789 
löes
[
l
] = 
	`g_¶i°_Àngth
 (
¶i°
);

790 
	`g_¶i°_‰ì
 (
¶i°
);

792 
¶i°
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`æi°_löe_chûdªn
 (wbox,

793 &
√xt_chûd
,

794 &
¨ó
,

795 &
max_chûd_size
,

796 &
ex∑nd_löe
);

799 i‡(
_n_löes
)

800 *
_n_löes
 = 
n_löes
;

802  
löes
;

803 
	}
}

806 
	$gtk_wøp_box_m≠
 (
GtkWidgë
 *
widgë
)

808 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widgë
);

809 
GtkWøpBoxChûd
 *
chûd
;

811 
	`GTK_WIDGET_SET_FLAGS
 (
wbox
, 
GTK_MAPPED
);

813 
chûd
 = 
wbox
->
chûdªn
; chûd; chûd = chûd->
√xt
)

814 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
) &&

815 !
	`GTK_WIDGET_MAPPED
 (
chûd
->
widgë
))

816 
	`gtk_widgë_m≠
 (
chûd
->
widgë
);

817 
	}
}

820 
	$gtk_wøp_box_unm≠
 (
GtkWidgë
 *
widgë
)

822 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widgë
);

823 
GtkWøpBoxChûd
 *
chûd
;

825 
	`GTK_WIDGET_UNSET_FLAGS
 (
wbox
, 
GTK_MAPPED
);

827 
chûd
 = 
wbox
->
chûdªn
; chûd; chûd = chûd->
√xt
)

828 i‡(
	`GTK_WIDGET_VISIBLE
 (
chûd
->
widgë
) &&

829 
	`GTK_WIDGET_MAPPED
 (
chûd
->
widgë
))

830 
	`gtk_widgë_unm≠
 (
chûd
->
widgë
);

831 
	}
}

833 
göt


834 
	$gtk_wøp_box_expo£
 (
GtkWidgë
 *
widgë
,

835 
GdkEvítExpo£
 *
evít
)

837  
	`GTK_WIDGET_CLASS
 (
∑ª¡_˛ass
)->
	`expo£_evít
 (
widgë
, 
evít
);

838 
	}
}

841 
	$gtk_wøp_box_add
 (
GtkC⁄èöî
 *
c⁄èöî
,

842 
GtkWidgë
 *
widgë
)

844 
	`gtk_wøp_box_∑ck
 (
	`GTK_WRAP_BOX
 (
c⁄èöî
), 
widgë
, 
FALSE
, 
TRUE
, FALSE, TRUE);

845 
	}
}

848 
	$gtk_wøp_box_ªmove
 (
GtkC⁄èöî
 *
c⁄èöî
,

849 
GtkWidgë
 *
widgë
)

851 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
c⁄èöî
);

852 
GtkWøpBoxChûd
 *
chûd
, *
œ°
 = 
NULL
;

854 
chûd
 = 
wbox
->
chûdªn
;

855 
chûd
)

857 i‡(
chûd
->
widgë
 == widget)

859 
gboﬁón
 
was_visibÀ
;

861 
was_visibÀ
 = 
	`GTK_WIDGET_VISIBLE
 (
widgë
);

862 
	`gtk_widgë_u≈¨ít
 (
widgë
);

864 i‡(
œ°
)

865 
œ°
->
√xt
 = 
chûd
->next;

867 
wbox
->
chûdªn
 = 
chûd
->
√xt
;

868 #i‡
	`GLIB_CHECK_VERSION
(2,10,0)

869 
	`g_¶i˚_‰ì
 (
GtkWøpBoxChûd
, 
chûd
);

871 
	`g_‰ì
 (
chûd
);

873 
wbox
->
n_chûdªn
--;

875 i‡(
was_visibÀ
)

876 
	`gtk_widgë_queue_ªsize
 (
	`GTK_WIDGET
 (
c⁄èöî
));

881 
œ°
 = 
chûd
;

882 
chûd
 = 
œ°
->
√xt
;

884 
	}
}

887 
	$gtk_wøp_box_f‹Æl
 (
GtkC⁄èöî
 *
c⁄èöî
,

888 
gboﬁón
 
ö˛ude_öã∫Æs
,

889 
GtkCÆlback
 
ˇŒback
,

890 
gpoöãr
 
ˇŒback_d©a
)

892 
GtkWøpBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
c⁄èöî
);

893 
GtkWøpBoxChûd
 *
chûd
;

895 
chûd
 = 
wbox
->
chûdªn
;

896 
chûd
)

898 
GtkWidgë
 *
widgë
 = 
chûd
->widget;

900 
chûd
 = chûd->
√xt
;

902 
	`ˇŒback
 (
widgë
, 
ˇŒback_d©a
);

904 
	}
}

	@O:\tool\dvs50\app\gtkwrapbox.h

23 #i‚de‡
__GTK_WRAP_BOX_H__


24 
	#__GTK_WRAP_BOX_H__


	)

27 
	~<gtk/gtkc⁄èöî.h
>

29 
	gG_BEGIN_DECLS


33 
	#GTK_TYPE_WRAP_BOX
 (
	`gtk_wøp_box_gë_ty≥
 ())

	)

34 
	#GTK_WRAP_BOX
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
GTK_TYPE_WRAP_BOX
, 
GtkWøpBox
))

	)

35 
	#GTK_WRAP_BOX_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
GTK_TYPE_WRAP_BOX
, 
GtkWøpBoxCœss
))

	)

36 
	#GTK_IS_WRAP_BOX
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
GTK_TYPE_WRAP_BOX
))

	)

37 
	#GTK_IS_WRAP_BOX_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kœss), 
GTK_TYPE_WRAP_BOX
))

	)

38 
	#GTK_WRAP_BOX_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
GTK_TYPE_WRAP_BOX
, 
GtkWøpBoxCœss
))

	)

42 
_GtkWøpBox
 
	tGtkWøpBox
;

43 
_GtkWøpBoxCœss
 
	tGtkWøpBoxCœss
;

44 
_GtkWøpBoxChûd
 
	tGtkWøpBoxChûd
;

47 
	s_GtkWøpBox


49 
GtkC⁄èöî
 
	mc⁄èöî
;

51 
guöt
 
	mhomogíeous
 : 1;

52 
guöt
 
	mju°ify
 : 4;

53 
guöt
 
	mlöe_ju°ify
 : 4;

54 
guöt8
 
	mh•acög
;

55 
guöt8
 
	mv•acög
;

56 
guöt16
 
	mn_chûdªn
;

57 
GtkWøpBoxChûd
 *
	mchûdªn
;

58 
gÊﬂt
 
	ma•e˘_øtio
;

59 
guöt
 
	mchûd_limô
;

61 
	s_GtkWøpBoxCœss


63 
GtkC⁄èöîCœss
 
	m∑ª¡_˛ass
;

65 
	mGSLi°
* (*
	mæi°_löe_chûdªn
Ë(
GtkWøpBox
 *
	mwbox
,

66 
GtkWøpBoxChûd
 **
	mchûd_p
,

67 
GtkAŒoˇti⁄
 *
	m¨ó
,

68 
guöt
 *
	mmax_chûd_size
,

69 
gboﬁón
 *
	mex∑nd_löe
);

71 
	s_GtkWøpBoxChûd


73 
GtkWidgë
 *
	mwidgë
;

74 
guöt
 
	mhex∑nd
 : 1;

75 
guöt
 
	mhfûl
 : 1;

76 
guöt
 
	mvex∑nd
 : 1;

77 
guöt
 
	mvfûl
 : 1;

78 
guöt
 
	mwøµed
 : 1;

80 
GtkWøpBoxChûd
 *
	m√xt
;

82 
	#GTK_JUSTIFY_TOP
 
GTK_JUSTIFY_LEFT


	)

83 
	#GTK_JUSTIFY_BOTTOM
 
GTK_JUSTIFY_RIGHT


	)

87 
GTy≥
 
	$gtk_wøp_box_gë_ty≥
 (Ë
G_GNUC_CONST
;

88 
	`gtk_wøp_box_£t_homogíeous
 (
GtkWøpBox
 *
wbox
,

89 
gboﬁón
 
homogíeous
);

90 
	`gtk_wøp_box_£t_h•acög
 (
GtkWøpBox
 *
wbox
,

91 
guöt
 
h•acög
);

92 
	`gtk_wøp_box_£t_v•acög
 (
GtkWøpBox
 *
wbox
,

93 
guöt
 
v•acög
);

94 
	`gtk_wøp_box_£t_ju°ify
 (
GtkWøpBox
 *
wbox
,

95 
GtkJu°ifiˇti⁄
 
ju°ify
);

96 
	`gtk_wøp_box_£t_löe_ju°ify
 (
GtkWøpBox
 *
wbox
,

97 
GtkJu°ifiˇti⁄
 
löe_ju°ify
);

98 
	`gtk_wøp_box_£t_a•e˘_øtio
 (
GtkWøpBox
 *
wbox
,

99 
gÊﬂt
 
a•e˘_øtio
);

100 
	`gtk_wøp_box_∑ck
 (
GtkWøpBox
 *
wbox
,

101 
GtkWidgë
 *
chûd
,

102 
gboﬁón
 
hex∑nd
,

103 
gboﬁón
 
hfûl
,

104 
gboﬁón
 
vex∑nd
,

105 
gboﬁón
 
vfûl
);

106 
	`gtk_wøp_box_∑ck_wøµed
 (
GtkWøpBox
 *
wbox
,

107 
GtkWidgë
 *
chûd
,

108 
gboﬁón
 
hex∑nd
,

109 
gboﬁón
 
hfûl
,

110 
gboﬁón
 
vex∑nd
,

111 
gboﬁón
 
vfûl
,

112 
gboﬁón
 
wøµed
);

113 
	`gtk_wøp_box_ª‹dî_chûd
 (
GtkWøpBox
 *
wbox
,

114 
GtkWidgë
 *
chûd
,

115 
göt
 
posôi⁄
);

116 
	`gtk_wøp_box_quîy_chûd_∑ckög
 (
GtkWøpBox
 *
wbox
,

117 
GtkWidgë
 *
chûd
,

118 
gboﬁón
 *
hex∑nd
,

119 
gboﬁón
 *
hfûl
,

120 
gboﬁón
 *
vex∑nd
,

121 
gboﬁón
 *
vfûl
,

122 
gboﬁón
 *
wøµed
);

123 
	`gtk_wøp_box_£t_chûd_∑ckög
 (
GtkWøpBox
 *
wbox
,

124 
GtkWidgë
 *
chûd
,

125 
gboﬁón
 
hex∑nd
,

126 
gboﬁón
 
hfûl
,

127 
gboﬁón
 
vex∑nd
,

128 
gboﬁón
 
vfûl
,

129 
gboﬁón
 
wøµed
);

130 
guöt
* 
	`gtk_wøp_box_quîy_löe_Àngths
 (
GtkWøpBox
 *
wbox
,

131 
guöt
 *
n_löes
);

134 
G_END_DECLS


	@O:\tool\dvs50\app\handle_ops.c

18 
	~<c⁄fig.h
>

20 
	~"h™dÀ_›s.h
"

21 
	~"cﬁ‹.h
"

24 
	#HANDLE_SIZE
 7

	)

26 c⁄° 
Cﬁ‹
 
	gh™dÀ_cﬁ‹
[
NUM_HANDLE_TYPES
<<1] =

37 c⁄° 
Cﬁ‹
 
	gh™dÀ_cﬁ‹_c⁄√˘ed
[
NUM_HANDLE_TYPES
<<1] =

49 
	$h™dÀ_døw
(
H™dÀ
 *
h™dÀ
, 
DDi•œy
 *
ddi•
)

51 
gboﬁón
 
some_£À˘ed
;

52 
x
,
y
;

53 
DüRídîî
 *
ªndîî
 = 
ddi•
->renderer;

54 
DüI¡îa˘iveRídîîI¡îÁ˚
 *
úídîî
 =

55 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ddi•
->
ªndîî
);

56 c⁄° 
Cﬁ‹
 *
cﬁ‹
;

58 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
, 
h™dÀ
->
pos
.
x
, h™dÀ->pos.
y
, &x, &y);

61 
some_£À˘ed
 = 
	`g_li°_Àngth
 (
ddi•
->
dügøm
->
d©a
->
£À˘ed
) > 1;

63 i‡(
h™dÀ
->
c⁄√˘ed_to
 !
NULL
) {

64 
cﬁ‹
 = &
h™dÀ_cﬁ‹_c⁄√˘ed
[
h™dÀ
->
ty≥
 + (
some_£À˘ed
 ? 
NUM_HANDLE_TYPES
 : 0)];

66 
cﬁ‹
 = &
h™dÀ_cﬁ‹
[
h™dÀ
->
ty≥
 + (
some_£À˘ed
 ? 
NUM_HANDLE_TYPES
 : 0)];

69 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
(renderer, 0.0);

70 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

71 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

72 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_fûl°yÀ
‘ídîî, 
FILLSTYLE_SOLID
);

75 
úídîî
->
	`fûl_pixñ_ª˘
(
ªndîî
,

76 
x
 - 
HANDLE_SIZE
/2 + 1,

77 
y
 - 
HANDLE_SIZE
/2 + 1,

78 
HANDLE_SIZE
-2, HANDLE_SIZE-2,

80 (
Cﬁ‹
 *)
cﬁ‹
);

82 
úídîî
->
	`døw_pixñ_ª˘
(
ªndîî
,

83 
x
 - 
HANDLE_SIZE
/2,

84 
y
 - 
HANDLE_SIZE
/2,

85 
HANDLE_SIZE
-1, HANDLE_SIZE-1,

86 &
cﬁ‹_bœck
);

90 i‡(
h™dÀ
->
c⁄√˘_ty≥
 !
HANDLE_NONCONNECTABLE
) {

91 
úídîî
->
døw_pixñ_löe


92 (
ªndîî
,

93 
x
 - 
HANDLE_SIZE
/2, 
y
 - HANDLE_SIZE/2,

94 
x
 + 
HANDLE_SIZE
/2, 
y
 + HANDLE_SIZE/2,

95 &
cﬁ‹_bœck
);

96 
úídîî
->
døw_pixñ_löe


97 (
ªndîî
,

98 
x
 - 
HANDLE_SIZE
/2, 
y
 + HANDLE_SIZE/2,

99 
x
 + 
HANDLE_SIZE
/2, 
y
 - HANDLE_SIZE/2,

100 &
cﬁ‹_bœck
);

102 
	}
}

105 
	$h™dÀ_add_upd©e
(
H™dÀ
 *
h™dÀ
, 
Dügøm
 *
dü
)

107 
	`dügøm_add_upd©e_pixñs
(
dü
, &
h™dÀ
->
pos
,

108 
HANDLE_SIZE
, HANDLE_SIZE);

109 
	}
}

113 
	$h™dÀ_is_˛icked
(
DDi•œy
 *
ddi•
, 
H™dÀ
 *
h™dÀ
, 
Poöt
 *
pos
)

115 
ªÆ
 
dx
, 
dy
;

116 
idx
, 
idy
;

118 i‡(
h™dÀ
==
NULL
)

119  
FALSE
;

121 
dx
 = 
	`ABS
(
h™dÀ
->
pos
.
x
 -Öos->x);

122 
dy
 = 
	`ABS
(
h™dÀ
->
pos
.
y
 -Öos->y);

124 
idx
 = 
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
, 
dx
);

125 
idy
 = 
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
, 
dy
);

127  (
idx
<(
HANDLE_SIZE
+1)/2Ë&& (
idy
<(HANDLE_SIZE+1)/2);

128 
	}
}

	@O:\tool\dvs50\app\handle_ops.h

18 #i‚de‡
HANDLE_OPS_H


19 
	#HANDLE_OPS_H


	)

21 
	~"h™dÀ.h
"

22 
	~"di•œy.h
"

24 
h™dÀ_døw
(
H™dÀ
 *
h™dÀ
, 
DDi•œy
 *
ddi•
);

25 
h™dÀ_add_upd©e
(
H™dÀ
 *
h™dÀ
, 
Dügøm
 *
dü
);

26 
h™dÀ_is_˛icked
(
DDi•œy
 *
ddi•
, 
H™dÀ
 *
h™dÀ
, 
Poöt
 *
pos
);

	@O:\tool\dvs50\app\highlight.c

19 
	~"highlight.h
"

21 
	~"glib.h
"

23 
	~"dügøm.h
"

24 
	~"dügømd©a.h
"

25 
	~"obje˘.h
"

26 
	~"obje˘_›s.h
"

27 
	~"group.h
"

43 
Cﬁ‹
 
	gªd
 = { 1.0, 0.0, 0.0 };

46 
	$highlight_obje˘
(
DüObje˘
 *
obj
, 
Cﬁ‹
 *
cﬁ
, 
Dügøm
 *
dü
)

48 i‡(
cﬁ
)

49 
obj
->
highlight_cﬁ‹
 = 
cﬁ
;

51 
obj
->
highlight_cﬁ‹
 = &
ªd
;

53 
	`obje˘_add_upd©es
(
obj
, 
dü
);

54 
	}
}

57 
	$highlight_obje˘_off
(
DüObje˘
 *
obj
, 
Dügøm
 *
dü
)

59 i‡(
obj
->
highlight_cﬁ‹
 !
NULL
) {

61 
	`obje˘_add_upd©es
(
obj
, 
dü
);

62 
obj
->
highlight_cﬁ‹
 = 
NULL
;

64 
	}
}

70 
	$highlight_ª£t_obje˘s
(
GLi°
 *
obje˘s
, 
Dügøm
 *
dü
)

72 ; 
obje˘s
 !
NULL
; obje˘†
	`g_li°_√xt
(objects)) {

73 
DüObje˘
 *
obje˘
 = (DüObje˘*)
obje˘s
->
d©a
;

74 
	`highlight_obje˘_off
(
obje˘
, 
dü
);

75 i‡(
	`IS_GROUP
(
obje˘
)) {

76 
	`highlight_ª£t_obje˘s
(
	`group_obje˘s
(
obje˘
), 
dü
);

79 
	}
}

88 
	$highlight_ª£t_Æl
(
Dügøm
 *
dü
) {

89 
i
;

90 
i
 = 0; i < 
dü
->
d©a
->
œyîs
->
Àn
; i++) {

91 
	`highlight_ª£t_obje˘s
(((
Layî
*)
	`g_±r_¨øy_ödex
(
dü
->
d©a
->
œyîs
, 
i
))->
obje˘s
, dia);

93 
	}
}

	@O:\tool\dvs50\app\highlight.h

18 #i‚de‡
HIGHLIGHT_H


19 
	#HIGHLIGHT_H


	)

21 
	~"glib.h
"

23 
	~"düty≥s.h
"

24 
	~"dügøm.h
"

25 
	~"cﬁ‹.h
"

34 
highlight_obje˘
(
DüObje˘
 *
obj
, 
Cﬁ‹
 *
cﬁ
, 
Dügøm
 *
dü
);

37 
highlight_obje˘_off
(
DüObje˘
 *
obj
, 
Dügøm
 *
dü
);

39 
highlight_ª£t_Æl
(
Dügøm
 *
dü
);

	@O:\tool\dvs50\app\interface.c

19 
	~<c⁄fig.h
>

21 #ifde‡
GNOME


22 #unde‡
GTK_DISABLE_DEPRECATED


23 
	~<gnome.h
>

25 #unde‡
GTK_DISABLE_DEPRECATED


26 
	~<gtk/gtk.h
>

28 
	~"gtkwøpbox.h
"

29 
	~"gtkhwøpbox.h
"

31 
	~<°dio.h
>

32 
	~<°rög.h
>

34 
	~"dügøm.h
"

35 
	~"obje˘.h
"

36 
	~"œyî_dülog.h
"

37 
	~"öãrÁ˚.h
"

38 
	~"di•œy.h
"

39 
	~"¥e„ªn˚s.h
"

40 
	~"comm™ds.h
"

41 
	~"dü_dús.h
"

42 
	~"dügøm_åì_wödow.h
"

43 
	~"öé.h
"

44 
	~"«vig©i⁄.h
"

45 
	~"≥rsi°í˚.h
"

46 
	~"dü¨rowchoo£r.h
"

47 
	~"dülöechoo£r.h
"

48 
	~"widgës.h
"

49 
	~"mesßge.h
"

51 
	~<gdk-pixbuf/gdk-pixbuf.h
>

52 
	~"dü-≠p-ic⁄s.h
"

53 
	~"düˇnvas.h
"

55 
	~"pixm≠s/sw≠.xpm
"

56 
	~"pixm≠s/deÁu….xpm
"

57 
	~"pixm≠s/missög.xpm
"

63 
	mDIA_DND_TYPE_URI_LIST
,

64 
	mDIA_DND_TYPE_TEXT_PLAIN
,

67 
GtkT¨gëE¡ry
 
	gtoﬁbox_èrgë_èbÀ
[] =

69 { "ãxt/uri-li°", 0, 
DIA_DND_TYPE_URI_LIST
 },

70 { "ãxt/∂aö", 0, 
DIA_DND_TYPE_TEXT_PLAIN
 }

73 
guöt
 
	gtoﬁbox_n_èrgës
 = ( (
toﬁbox_èrgë_èbÀ
) /

74  (
toﬁbox_èrgë_èbÀ
[0]));

77 
u£_öãgøãd_ui_f‹_di•œy_shñl
(
DDi•œy
 *
ddi•
, *
tôÀ
);

80 
	$dü_dnd_fûe_døg_d©a_ª˚ived
 (
GtkWidgë
 *
widgë
,

81 
GdkDøgC⁄ãxt
 *
c⁄ãxt
,

82 
göt
 
x
,

83 
göt
 
y
,

84 
GtkSñe˘i⁄D©a
 *
d©a
,

85 
guöt
 
öfo
,

86 
guöt
 
time
,

87 
DDi•œy
 *
ddi•
)

89 
c⁄ãxt
->
a˘i⁄
)

91 
GDK_ACTION_DEFAULT
:

92 
GDK_ACTION_COPY
:

93 
GDK_ACTION_MOVE
:

94 
GDK_ACTION_LINK
:

95 
GDK_ACTION_ASK
:

98 
Dügøm
 *
dügøm
 = 
NULL
;

99 
gch¨
 *
sP©h
 = 
NULL
, *
pFrom
, *
pTo
;

101 
pFrom
 = 
	`°r°r
((
gch¨
 *Ë
d©a
->data, "file:");

102 
pFrom
) {

103 
GEº‹
 *
îr‹
 = 
NULL
;

105 
pTo
 = 
pFrom
;

106 *
pTo
 != 0 && *pTo != 0xd && *pTo != 0xa)ÖTo ++;

107 
sP©h
 = 
	`g_°∫dup
(
pFrom
, 
pTo
 -ÖFrom);

110 
pFrom
 = 
	`g_fûíame_‰om_uri
 (
sP©h
, 
NULL
, &
îr‹
);

111 i‡(!
ddi•
)

112 
dügøm
 = 
	`dügøm_lﬂd
 (
pFrom
, 
NULL
);

114 
dügøm
 = 
ddi•
->diagram;

115 i‡(!
	`dügøm_lﬂd_öto
 (
dügøm
, 
pFrom
, 
NULL
)) {

117 
	`gtk_døg_föish
 (
c⁄ãxt
, 
TRUE
, 
FALSE
, 
time
);

122 
	`g_‰ì
 (
pFrom
);

123 
	`g_‰ì
(
sP©h
);

125 i‡(
dügøm
 !
NULL
) {

126 
	`dügøm_upd©e_exã¡s
(
dügøm
);

127 
	`œyî_dülog_£t_dügøm
(
dügøm
);

129 i‡(
dügøm
->
di•œys
 =
NULL
) {

130 
	`√w_di•œy
(
dügøm
);

134 
pFrom
 = 
	`°r°r
(
pTo
, "file:");

136 
	`gtk_døg_föish
 (
c⁄ãxt
, 
TRUE
, 
FALSE
, 
time
);

141 
	}
}

143 c⁄° 
GtkT¨gëE¡ry
 
	gdi•œy_èrgë_èbÀ
[] = {

145 { "ãxt/uri-li°", 0, 
DIA_DND_TYPE_URI_LIST
 },

146 { "ãxt/∂aö", 0, 
DIA_DND_TYPE_TEXT_PLAIN
 }

148 
	gdi•œy_n_èrgës
 = (
di•œy_èrgë_èbÀ
)/(display_target_table[0]);

150 
ToﬁBuâ⁄
 
	gtoﬁ_d©a
[] =

152 { (**Ë
dü_modify_toﬁ_ic⁄
,

153 
N_
("Modify object(s)\nUse <Space>ÅoÅoggle betweenÅhisánd otherÅools"),

154 
NULL
,

156 { 
MODIFY_TOOL
, 
NULL
, NULL}

158 { (**Ë
dü_ãxãdô_toﬁ_ic⁄
,

159 
N_
("TextÉdit(s)\nUse <Esc>ÅoÜeaveÅhisÅool"),

162 { 
TEXTEDIT_TOOL
, 
NULL
, NULL}

164 { (**Ë
dü_zoom_toﬁ_ic⁄
,

165 
N_
("Magnify"),

168 { 
MAGNIFY_TOOL
, 
NULL
, NULL}

170 { (**Ë
dü_s¸ﬁl_toﬁ_ic⁄
,

171 
N_
("ScrollároundÅhe diagram"),

174 { 
SCROLL_TOOL
, 
NULL
, NULL}

176 { 
NULL
,

177 
N_
("Text"),

180 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - Text", 
NULL
 }

182 { 
NULL
,

183 
N_
("Box"),

186 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - Box", 
NULL
 }

188 { 
NULL
,

189 
N_
("Ellipse"),

192 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - EŒù£", 
NULL
 }

194 { 
NULL
,

195 
N_
("Polygon"),

198 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - Pﬁyg⁄", 
NULL
 }

200 { 
NULL
,

201 
N_
("Beziergon"),

204 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - Bezõrg⁄", 
NULL
 }

206 { 
NULL
,

207 
N_
("Line"),

210 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - Löe", 
NULL
 }

212 { 
NULL
,

213 
N_
("Arc"),

216 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - Arc", 
NULL
 }

218 { 
NULL
,

219 
N_
("Zigzagline"),

222 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - ZigZagLöe", 
NULL
 }

224 { 
NULL
,

225 
N_
("Polyline"),

226 
NULL
,

228 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - PﬁyLöe", 
NULL
 }

230 { 
NULL
,

231 
N_
("Bezierline"),

234 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - BezõrLöe", 
NULL
 }

236 { 
NULL
,

237 
N_
("Image"),

240 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - Image", 
NULL
 }

241 #ifde‡
HAVE_CAIRO


243 { 
NULL
,

244 
N_
("Outline"),

245 
NULL
,

247 { 
CREATE_OBJECT_TOOL
, "Sènd¨d - Ouéöe", 
NULL
 }

252 
	#NUM_TOOLS
 ( (
toﬁ_d©a
Ë/  (
ToﬁBuâ⁄
))

	)

253 c⁄° 
	gnum_toﬁs
 = 
NUM_TOOLS
;

255 
	#COLUMNS
 4

	)

256 
	#ROWS
 3

	)

258 
GtkWidgë
 *
	gtoﬁbox_shñl
 = 
NULL
;

259 
GtkWidgë
 *
	gtoﬁ_widgës
[
NUM_TOOLS
];

263 
GtkWödow
 * 
	mmaö_wödow
;

264 
GtkToﬁb¨
 * 
	mtoﬁb¨
;

265 
GtkNŸebook
 * 
	mdügøm_nŸebook
;

266 
GtkSètusb¨
 * 
	m°©usb¨
;

267 
GtkWidgë
 * 
	mœyî_võw
;

268 } 
	gui
;

270  
GtkToﬁtùs
 *
	gtoﬁ_tùs
;

271 
GSLi°
 *
	gtoﬁ_group
 = 
NULL
;

273 
GtkWidgë
 *
	gmodify_toﬁ_buâ⁄
;

281 
	$is_öãgøãd_ui
 ()

283  
ui
.
maö_wödow
 =
NULL
? 0 : 1;

284 
	}
}

287 
	$grid_toggÀ_¢≠
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

289 
DDi•œy
 *
ddi•
 = (DDi•œy *)
d©a
;

290 
	`ddi•œy_£t_¢≠_to_grid
(
ddi•
,

291 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
widgë
)));

292 
	}
}

295 
	$öãrÁ˚_toggÀ_maöpoöt_mag√tism
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

297 
DDi•œy
 *
ddi•
 = (DDi•œy *)
d©a
;

298 
	`ddi•œy_£t_¢≠_to_obje˘s
(
ddi•
,

299 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
widgë
)));

300 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

301 
	`ddi•œy_Êush
(
ddi•
);

302 
	}
}

304 
göt


305 
	$‹igö_buâ⁄_¥ess
(
GtkWidgë
 *
widgë
, 
GdkEvítBuâ⁄
 *
evít
, 
gpoöãr
 
d©a
)

307 
DDi•œy
 *
ddi•
 = (DDi•œy *)
d©a
;

309 
	`di•œy_£t_a˘ive
(
ddi•
);

310 
	`ddi•œy_p›up_míu
(
ddi•
, 
evít
);

314 
	`gtk_sig«l_emô_°›_by_«me
(
	`GTK_OBJECT
(
widgë
), "button_press_event");

316  
FALSE
;

317 
	}
}

320 
	$võw_zoom_£t
 (
Á˘‹
)

322 
DDi•œy
 *
ddi•
;

323 
ªÆ
 
sˇÀ
;

324 
Poöt
 
middÀ
;

325 
Re˘™gÀ
 *
visibÀ
;

327 
ddi•
 = 
	`ddi•œy_a˘ive
();

328 i‡(!
ddi•
) ;

330 
visibÀ
 = &
ddi•
->visible;

331 
middÀ
.
x
 = 
visibÀ
->
À·
*0.5 + visibÀ->
right
*0.5;

332 
middÀ
.
y
 = 
visibÀ
->
t›
*0.5 + visibÀ->
bŸtom
*0.5;

334 
sˇÀ
 = ((
ªÆ
Ë
Á˘‹
)/1000.0 * 
DDISPLAY_NORMAL_ZOOM
;

336 
	`ddi•œy_zoom
(
ddi•
, &
middÀ
, 
sˇÀ
 / ddi•->
zoom_Á˘‹
);

337 
	}
}

340 
	$zoom_a˘iv©e_ˇŒback
(
GtkWidgë
 *
ôem
, 
gpoöãr
 
u£r_d©a
)

342 
DDi•œy
 *
ddi•
 = (DDi•œy *)
u£r_d©a
;

343 c⁄° 
gch¨
 *
zoom_ãxt
 =

344 
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
ddi•
->
zoom_°©us
))));

345 
zoom_amou¡
, 
magnify
;

346 
gch¨
 *
zoomamou¡
 = 
	`g_obje˘_gë_d©a
(
	`G_OBJECT
(
ôem
), "zoomamount");

347 i‡(
zoomamou¡
 !
NULL
) {

348 
zoom_ãxt
 = 
zoomamou¡
;

351 i‡(
	`ssˇnf
(
zoom_ãxt
, "%f", &
zoom_amou¡
) == 1) {

352 
Poöt
 
middÀ
;

353 
Re˘™gÀ
 *
visibÀ
;

356 i‡(
zoom_amou¡
 < .1) {

357 
zoom_amou¡
 = .1;

358 } i‡(
zoom_amou¡
 > 1e4) {

359 
zoom_amou¡
 = 1e4;

361 
zoomamou¡
 = 
	`g_°rdup_¥ötf
("%f%%\n", 
zoom_amou¡
);

362 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
ddi•
->
zoom_°©us
))), 
zoomamou¡
);

363 
	`g_‰ì
(
zoomamou¡
);

364 
magnify
 = (
zoom_amou¡
*
DDISPLAY_NORMAL_ZOOM
/100.0)/
ddi•
->
zoom_Á˘‹
;

365 i‡(
	`Ábs
(
magnify
 - 1.0) > 0.000001) {

366 
visibÀ
 = &
ddi•
->visible;

367 
middÀ
.
x
 = 
visibÀ
->
À·
*0.5 + visibÀ->
right
*0.5;

368 
middÀ
.
y
 = 
visibÀ
->
t›
*0.5 + visibÀ->
bŸtom
*0.5;

369 
	`ddi•œy_zoom
(
ddi•
, &
middÀ
, 
magnify
);

372 
	}
}

375 
	$zoom_add_zoom_amou¡
(
GtkWidgë
 *
míu
, 
gch¨
 *
ãxt
, 
DDi•œy
 *
ddi•
)

377 
GtkWidgë
 *
míuôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
ãxt
);

378 
	`gtk_míu_shñl_≠≥nd
(
	`GTK_MENU_SHELL
(
míu
), 
míuôem
);

379 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
míuôem
),

380 "a˘iv©e", 
	`G_CALLBACK
(
zoom_a˘iv©e_ˇŒback
),

381 
ddi•
);

382 
	`g_obje˘_£t_d©a
(
	`G_OBJECT
(
míuôem
), "zoomamou¡", 
ãxt
);

383 
	}
}

386 
	$zoom_p›up_míu
(
GtkWidgë
 *
buâ⁄
, 
GdkEvítBuâ⁄
 *
evít
, 
gpoöãr
 
u£r_d©a
) {

390 
GtkMíu
 *
míu
 = 
	`GTK_MENU
(
u£r_d©a
);

392 
	`gtk_míu_p›up
(
míu
, 
NULL
, NULL, NULL, NULL,

393 
evít
->
buâ⁄
,Évít->
time
);

396 
	`gtk_sig«l_emô_°›_by_«me
(
	`GTK_OBJECT
(
buâ⁄
), "button_press_event");

397 
	}
}

399 
GtkWidgë
*

400 
	$¸óã_zoom_widgë
(
DDi•œy
 *
ddi•
) {

401 
GtkWidgë
 *
combo
;

402 
GtkWidgë
 *
íåy
;

403 
GtkWidgë
 *
míu
;

404 
GtkWidgë
 *
buâ⁄
;

405 
GtkWidgë
 *
¨row
;

407 
combo
 = 
	`gtk_hbox_√w
(
FALSE
, 0);

408 
íåy
 = 
	`gtk_íåy_√w
();

409 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

410 
	`G_CALLBACK
(
zoom_a˘iv©e_ˇŒback
),

411 
ddi•
);

412 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
combo
), 
íåy
);

413 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
(
combo
), "u£r_d©a", 
íåy
);

414 
	`gtk_íåy_£t_width_ch¨s
(
	`GTK_ENTRY
(
íåy
), 8);

415 
	`gtk_widgë_show
(
íåy
);

417 
buâ⁄
 = 
	`gtk_buâ⁄_√w
();

418 
	`GTK_WIDGET_UNSET_FLAGS
(
buâ⁄
, 
GTK_CAN_FOCUS
);

419 
¨row
 = 
	`gtk_¨row_√w
(
GTK_ARROW_DOWN
, 
GTK_SHADOW_OUT
);

420 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
buâ⁄
), 
¨row
);

421 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
combo
), 
buâ⁄
);

422 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
(
combo
), "u£r_d©a", 
íåy
);

423 
	`gtk_widgë_show_Æl
(
buâ⁄
);

425 
míu
 = 
	`gtk_míu_√w
();

426 
	`zoom_add_zoom_amou¡
(
míu
, "800%", 
ddi•
);

427 
	`zoom_add_zoom_amou¡
(
míu
, "400%", 
ddi•
);

428 
	`zoom_add_zoom_amou¡
(
míu
, "200%", 
ddi•
);

429 
	`zoom_add_zoom_amou¡
(
míu
, "100%", 
ddi•
);

430 
	`zoom_add_zoom_amou¡
(
míu
, "50%", 
ddi•
);

431 
	`zoom_add_zoom_amou¡
(
míu
, "25%", 
ddi•
);

432 
	`zoom_add_zoom_amou¡
(
míu
, "12%", 
ddi•
);

434 
	`gtk_widgë_show_Æl
(
míu
);

436 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "button_press_event",

437 
	`G_CALLBACK
(
zoom_p›up_míu
),

438 
míu
);

440  
combo
;

441 
	}
}

443 
gboﬁón


444 
	$di•œy_dr›_ˇŒback
(
GtkWidgë
 *
widgë
, 
GdkDøgC⁄ãxt
 *
c⁄ãxt
,

445 
göt
 
x
, göà
y
, 
guöt
 
time
)

447 i‡(
	`gtk_døg_gë_sour˚_widgë
(
c⁄ãxt
Ë!
NULL
) {

450  
TRUE
;

452 
	`gtk_døg_föish
 (
c⁄ãxt
, 
FALSE
, FALSE, 
time
);

453  
FALSE
;

454 
	}
}

457 
	$di•œy_d©a_ª˚ived_ˇŒback
 (
GtkWidgë
 *
widgë
,

458 
GdkDøgC⁄ãxt
 *
c⁄ãxt
,

459 
göt
 
x
,

460 
göt
 
y
,

461 
GtkSñe˘i⁄D©a
 *
d©a
,

462 
guöt
 
öfo
,

463 
guöt
 
time
,

464 
DDi•œy
 *
ddi•
)

466 i‡(
d©a
->
f‹m©
 =8 && d©a->
Àngth
 =(
ToﬁBuâ⁄D©a
 *) &&

467 
	`gtk_døg_gë_sour˚_widgë
(
c⁄ãxt
Ë!
NULL
) {

468 
ToﬁBuâ⁄D©a
 *
toﬁd©a
 = *(ToﬁBuâ⁄D©®**)
d©a
->data;

471 
	`ddi•œy_dr›_obje˘
(
ddi•
, 
x
, 
y
,

472 
	`obje˘_gë_ty≥
((
gch¨
 *)
toﬁd©a
->
exåa_d©a
),

473 
toﬁd©a
->
u£r_d©a
);

475 
	`gtk_døg_föish
 (
c⁄ãxt
, 
TRUE
, 
FALSE
, 
time
);

477 
	`dü_dnd_fûe_døg_d©a_ª˚ived
 (
widgë
, 
c⁄ãxt
, 
x
, 
y
, 
d©a
, 
öfo
, 
time
, 
ddi•
);

478 
	}
}

485 
	$˛o£_nŸebook_∑ge_ˇŒback
 (
GtkBuâ⁄
 *
buâ⁄
,

486 
gpoöãr
 
u£r_d©a
)

488 
GtkBox
 *
∑ge
 = 
u£r_d©a
;

489 
DDi•œy
 *
ddi•
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
∑ge
), "DDisplay");

492 
	`ddi•œy_˛o£
 (
ddi•
);

493 
	}
}

500 
	$u£_öãgøãd_ui_f‹_di•œy_shñl
(
DDi•œy
 *
ddi•
, *
tôÀ
)

502 
GtkWidgë
 *
èbÀ
;

503 
GtkWidgë
 *
«vig©i⁄_buâ⁄
;

506 
GtkWidgë
 *
œbñ
;

507 
GtkWidgë
 *
èb_œbñ_c⁄èöî
;

508 
width
, 
height
;

509 
GtkWidgë
 *
image
;

510 
GtkWidgë
 *
˛o£_buâ⁄
;

512 
GtkRcStyÀ
 *
rc°yÀ
;

513 
göt
 
nŸebook_∑ge_ödex
;

515 
ddi•
->
is_°™dÆ⁄e_wödow
 = 
FALSE
;

517 
ddi•
->
shñl
 = 
	`GTK_WIDGET
 (
ui
.
maö_wödow
);

520 
ddi•
->
modifõd_°©us
 = 
	`GTK_WIDGET
 (
ui
.
°©usb¨
);

522 
èb_œbñ_c⁄èöî
 = 
	`gtk_hbox_√w
(
FALSE
,3);

524 
œbñ
 = 
	`gtk_œbñ_√w
–
tôÀ
 );

525 
	`gtk_box_∑ck_°¨t
–
	`GTK_BOX
(
èb_œbñ_c⁄èöî
), 
œbñ
, 
FALSE
, FALSE, 0 );

526 
	`gtk_widgë_show
 (
œbñ
);

529 
ddi•
->
c⁄èöî
 = 
	`gtk_vbox_√w
(
FALSE
, 0);

532 
ddi•
->
c⁄èöî
 = 
	`gtk_vbox_√w
(
FALSE
, 0);

536 
˛o£_buâ⁄
 = 
	`gtk_buâ⁄_√w
();

537 
	`gtk_buâ⁄_£t_ªlõf
 (
	`GTK_BUTTON
 (
˛o£_buâ⁄
), 
GTK_RELIEF_NONE
);

538 
	`gtk_buâ⁄_£t_focus_⁄_˛ick
 (
	`GTK_BUTTON
 (
˛o£_buâ⁄
), 
FALSE
);

541 
rc°yÀ
 = 
	`gtk_rc_°yÀ_√w
 ();

542 
rc°yÀ
->
xthick√ss
 =Ñc°yÀ->
ythick√ss
 = 0;

543 
	`gtk_widgë_modify_°yÀ
 (
˛o£_buâ⁄
, 
rc°yÀ
);

544 
	`gtk_rc_°yÀ_uƒef
 (
rc°yÀ
),

546 
image
 = 
	`gtk_image_√w_‰om_°ock
 (
GTK_STOCK_CLOSE
,

547 
GTK_ICON_SIZE_MENU
);

549 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
(
˛o£_buâ⁄
), 
image
);

550 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
˛o£_buâ⁄
), "clicked",

551 
	`GTK_SIGNAL_FUNC
 (
˛o£_nŸebook_∑ge_ˇŒback
), 
ddi•
->
c⁄èöî
);

554 
	`gtk_box_∑ck_°¨t
–
	`GTK_BOX
(
èb_œbñ_c⁄èöî
), 
˛o£_buâ⁄
, 
FALSE
, FALSE, 0 );

555 
	`gtk_widgë_show
 (
˛o£_buâ⁄
);

556 
	`gtk_widgë_show
 (
image
);

559 
	`gtk_widgë_£t_evíts
 (
ddi•
->
c⁄èöî
,

560 
GDK_POINTER_MOTION_MASK
 |

561 
GDK_POINTER_MOTION_HINT_MASK
 |

562 
GDK_FOCUS_CHANGE_MASK
);

564 
nŸebook_∑ge_ödex
 = 
	`gtk_nŸebook_≠≥nd_∑ge
 (
	`GTK_NOTEBOOK
(
ui
.
dügøm_nŸebook
),

565 
ddi•
->
c⁄èöî
,

566 
èb_œbñ_c⁄èöî
);

568 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ddi•
->
c⁄èöî
), "DDisplay", ddisp);

569 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ddi•
->
c⁄èöî
), "èb-œbñ", 
œbñ
);

570 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ddi•
->
c⁄èöî
), "wödow", 
ui
.
maö_wödow
);

573 
èbÀ
 = 
	`gtk_èbÀ_√w
 (3, 3, 
FALSE
);

574 
	`gtk_èbÀ_£t_cﬁ_•acög
 (
	`GTK_TABLE
 (
èbÀ
), 0, 1);

575 
	`gtk_èbÀ_£t_cﬁ_•acög
 (
	`GTK_TABLE
 (
èbÀ
), 1, 2);

576 
	`gtk_èbÀ_£t_row_•acög
 (
	`GTK_TABLE
 (
èbÀ
), 0, 1);

577 
	`gtk_èbÀ_£t_row_•acög
 (
	`GTK_TABLE
 (
èbÀ
), 1, 2);

578 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
èbÀ
), 2);

580 
	`gtk_box_∑ck_°¨t
–
	`GTK_BOX
(
ddi•
->
c⁄èöî
), 
èbÀ
, 
TRUE
, TRUE, 0 );

583 
ddi•
->
‹igö
 = 
	`gtk_‰ame_√w
 (
NULL
);

584 
	`gtk_‰ame_£t_shadow_ty≥
 (
	`GTK_FRAME
 (
ddi•
->
‹igö
), 
GTK_SHADOW_OUT
);

586 
ddi•
->
hruÀ
 = 
	`gtk_hruÀr_√w
 ();

587 
	`g_sig«l_c⁄√˘_sw≠≥d
 (
	`GTK_OBJECT
 (
ddi•
->
c⁄èöî
), "motion_notify_event",

588 
	`G_CALLBACK
(
	`GTK_WIDGET_GET_CLASS
 (
ddi•
->
hruÀ
)->
mŸi⁄_nŸify_evít
),

589 
	`GTK_OBJECT
 (
ddi•
->
hruÀ
));

591 
ddi•
->
vruÀ
 = 
	`gtk_vruÀr_√w
 ();

592 
	`g_sig«l_c⁄√˘_sw≠≥d
 (
	`GTK_OBJECT
 (
ddi•
->
c⁄èöî
), "motion_notify_event",

593 
	`G_CALLBACK
(
	`GTK_WIDGET_GET_CLASS
 (
ddi•
->
vruÀ
)->
mŸi⁄_nŸify_evít
),

594 
	`GTK_OBJECT
 (
ddi•
->
vruÀ
));

598 
width
 = 100;

599 
height
 = 100;

602 
ddi•
->
hsbd©a
 = 
	`GTK_ADJUSTMENT
 (
	`gtk_adju°mít_√w
 (0, 0, 
width
, 1, (width-1)/4, width-1));

603 
ddi•
->
vsbd©a
 = 
	`GTK_ADJUSTMENT
 (
	`gtk_adju°mít_√w
 (0, 0, 
height
, 1, (height-1)/4, height-1));

605 
ddi•
->
hsb
 = 
	`gtk_hs¸ﬁlb¨_√w
 (ddi•->
hsbd©a
);

606 
	`GTK_WIDGET_UNSET_FLAGS
 (
ddi•
->
hsb
, 
GTK_CAN_FOCUS
);

607 
ddi•
->
vsb
 = 
	`gtk_vs¸ﬁlb¨_√w
 (ddi•->
vsbd©a
);

608 
	`GTK_WIDGET_UNSET_FLAGS
 (
ddi•
->
vsb
, 
GTK_CAN_FOCUS
);

611 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
hsbd©a
), "value_changed",

612 
	`G_CALLBACK
(
ddi•œy_hsb_upd©e
),

613 
ddi•
);

614 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
vsbd©a
), "value_changed",

615 
	`G_CALLBACK
(
ddi•œy_vsb_upd©e
),

616 
ddi•
);

619 
«vig©i⁄_buâ⁄
 = 
	`«vig©i⁄_p›up_√w
(
ddi•
);

620 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
«vig©i⁄_buâ⁄
,

621 
	`_
("P›†u∞thêNavig©i⁄ wödow."), 
NULL
);

622 
	`gtk_widgë_show
(
«vig©i⁄_buâ⁄
);

625 
ddi•
->
ˇnvas
 = 
	`dü_ˇnvas_√w
();

628 
	`gtk_widgë_£t_doubÀ_buf„ªd
 (
ddi•
->
ˇnvas
, 
FALSE
);

630 
	`gtk_widgë_£t_evíts
 (
ddi•
->
ˇnvas
, 
CANVAS_EVENT_MASK
);

631 
	`GTK_WIDGET_SET_FLAGS
 (
ddi•
->
ˇnvas
, 
GTK_CAN_FOCUS
);

632 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
ˇnvas
), "event",

633 
	`G_CALLBACK
(
ddi•œy_ˇnvas_evíts
),

634 
ddi•
);

636 
	`gtk_døg_de°_£t
(
ddi•
->
ˇnvas
, 
GTK_DEST_DEFAULT_ALL
,

637 
di•œy_èrgë_èbÀ
, 
di•œy_n_èrgës
, 
GDK_ACTION_COPY
);

638 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
ˇnvas
), "drag_drop",

639 
	`G_CALLBACK
(
di•œy_dr›_ˇŒback
), 
NULL
);

640 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
ˇnvas
), "drag_data_received",

641 
	`G_CALLBACK
(
di•œy_d©a_ª˚ived_ˇŒback
), 
ddi•
);

644 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
‹igö
, 0, 1, 0, 1,

645 
GTK_FILL
, GTK_FILL, 0, 0);

646 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
hruÀ
, 1, 2, 0, 1,

647 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, GTK_FILL, 0, 0);

648 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
vruÀ
, 0, 1, 1, 2,

649 
GTK_FILL
, 
GTK_EXPAND
 | 
GTK_SHRINK
 | GTK_FILL, 0, 0);

650 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
ˇnvas
, 1, 2, 1, 2,

651 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
,

652 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, 0, 0);

653 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
hsb
, 0, 2, 2, 3,

654 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, GTK_FILL, 0, 0);

655 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
vsb
, 2, 3, 0, 2,

656 
GTK_FILL
, 
GTK_EXPAND
 | 
GTK_SHRINK
 | GTK_FILL, 0, 0);

657 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
«vig©i⁄_buâ⁄
, 2, 3, 2, 3,

658 
GTK_FILL
, GTK_FILL, 0, 0);

660 
ddi•
->
comm⁄_toﬁb¨
 = 
ui
.
toﬁb¨
;

663 
ddi•
->
míu_b¨
 = 
NULL
;

666 
ddi•
->
zoom_°©us
 = 
NULL
;

669 
ddi•
->
grid_°©us
 = 
NULL
;

672 
ddi•
->
maöpoöt_°©us
 = 
NULL
;

674 
	`gtk_widgë_show
 (
ddi•
->
c⁄èöî
);

675 
	`gtk_widgë_show
 (
èbÀ
);

676 
	`gtk_widgë_show
 (
ddi•
->
hsb
);

677 
	`gtk_widgë_show
 (
ddi•
->
vsb
);

678 
	`di•œy_ruÀrs_show
 (
ddi•
);

679 
	`gtk_widgë_show
 (
ddi•
->
ˇnvas
);

682 
	`gtk_nŸebook_£t_cuºít_∑ge
 (
ui
.
dügøm_nŸebook
, 
nŸebook_∑ge_ödex
);

684 
	`öãgøãd_ui_toﬁb¨_grid_¢≠_synchr⁄ize_to_di•œy
 (
ddi•
);

686 
	`öãgøãd_ui_toﬁb¨_obje˘_¢≠_synchr⁄ize_to_di•œy
 (
ddi•
);

693 
	`ddi•œy_£t_ªndîî
(
ddi•
, ddi•->
Ø_ªndîî
);

696 
	`gtk_widgë_gøb_focus
 (
ddi•
->
ˇnvas
);

697 
	}
}

708 
	$¸óã_di•œy_shñl
(
DDi•œy
 *
ddi•
,

709 
width
, 
height
,

710 *
tôÀ
, 
u£_mb¨
, 
t›_Àvñ_wödow
)

712 
GtkWidgë
 *
èbÀ
, *
widgë
;

713 
GtkWidgë
 *
«vig©i⁄_buâ⁄
;

714 
GtkWidgë
 *
°©us_hbox
;

715 
GtkWidgë
 *
roŸ_vbox
 = 
NULL
;

716 
GtkWidgë
 *
zoom_hbox
, *
zoom_œbñ
;

717 
s_width
, 
s_height
;

719 i‡(
	`≠p_is_öãø˘ive
(Ë&& 
	`is_öãgøãd_ui
())

721 
	`u£_öãgøãd_ui_f‹_di•œy_shñl
(
ddi•
, 
tôÀ
);

725 
ddi•
->
is_°™dÆ⁄e_wödow
 = 
TRUE
;

726 
ddi•
->
c⁄èöî
 = 
NULL
;

729 i‡(!
toﬁ_tùs
)

730 
toﬁ_tùs
 = 
	`gtk_toﬁtùs_√w
 ();

732 
s_width
 = 
	`gdk_s¸ìn_width
 ();

733 
s_height
 = 
	`gdk_s¸ìn_height
 ();

734 i‡(
width
 > 
s_width
)

735 
width
 = 
s_width
;

736 i‡(
height
 > 
s_height
)

737 
height
 = 
s_height
;

740 
ddi•
->
hsbd©a
 = 
	`GTK_ADJUSTMENT
 (
	`gtk_adju°mít_√w
 (0, 0, 
width
, 1, (width-1)/4, width-1));

741 
ddi•
->
vsbd©a
 = 
	`GTK_ADJUSTMENT
 (
	`gtk_adju°mít_√w
 (0, 0, 
height
, 1, (height-1)/4, height-1));

744 i‡(
t›_Àvñ_wödow
) {

745 
ddi•
->
shñl
 = 
	`gtk_wödow_√w
 (
GTK_WINDOW_TOPLEVEL
);

746 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
ddi•
->
shñl
), 
tôÀ
);

747 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
ddi•
->
shñl
), "diagram_window");

748 
	`gtk_wödow_£t_ic⁄_«me
 (
	`GTK_WINDOW
 (
ddi•
->
shñl
), "dia");

749 
	`gtk_wödow_£t_deÁu…_size
(
	`GTK_WINDOW
 (
ddi•
->
shñl
), 
width
, 
height
);

751 i‡(!
	`gtk_wödow_gë_ic⁄
 (
	`GTK_WINDOW
 (
ddi•
->
shñl
))) {

752 
GdkPixbuf
 *
pixbuf
 = 
NULL
;

754 i‡(!
pixbuf
)

755 
pixbuf
 = 
	`gdk_pixbuf_√w_‰om_ölöe
(-1, 
dü_dügøm_ic⁄
, 
FALSE
, 
NULL
);

756 i‡(
pixbuf
)

757 
	`gtk_wödow_£t_ic⁄
 (
	`GTK_WINDOW
 (
ddi•
->
shñl
), 
pixbuf
);

760 
ddi•
->
shñl
 = 
	`gtk_evít_box_√w
 ();

762 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ddi•
->
shñl
), "u£r_d©a", (
gpoöãr
) ddisp);

764 
	`gtk_widgë_£t_evíts
 (
ddi•
->
shñl
,

765 
GDK_POINTER_MOTION_MASK
 |

766 
GDK_POINTER_MOTION_HINT_MASK
 |

767 
GDK_FOCUS_CHANGE_MASK
);

770 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
shñl
), "delete_event",

771 
	`G_CALLBACK
 (
ddi•œy_dñëe
),

772 
ddi•
);

773 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
shñl
), "destroy",

774 
	`G_CALLBACK
 (
ddi•œy_de°roy
),

775 
ddi•
);

776 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
shñl
), "focus_out_event",

777 
	`G_CALLBACK
 (
ddi•œy_focus_out_evít
),

778 
ddi•
);

779 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
shñl
), "focus_in_event",

780 
	`G_CALLBACK
 (
ddi•œy_focus_ö_evít
),

781 
ddi•
);

782 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
shñl
), "realize",

783 
	`G_CALLBACK
 (
ddi•œy_ªÆize
),

784 
ddi•
);

785 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
shñl
), "unrealize",

786 
	`G_CALLBACK
 (
ddi•œy_uƒólize
),

787 
ddi•
);

795 
èbÀ
 = 
	`gtk_èbÀ_√w
 (4, 3, 
FALSE
);

796 
	`gtk_èbÀ_£t_cﬁ_•acög
 (
	`GTK_TABLE
 (
èbÀ
), 0, 1);

797 
	`gtk_èbÀ_£t_cﬁ_•acög
 (
	`GTK_TABLE
 (
èbÀ
), 1, 2);

798 
	`gtk_èbÀ_£t_row_•acög
 (
	`GTK_TABLE
 (
èbÀ
), 0, 1);

799 
	`gtk_èbÀ_£t_row_•acög
 (
	`GTK_TABLE
 (
èbÀ
), 1, 2);

800 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
èbÀ
), 2);

801 i‡(
u£_mb¨
)

803 
roŸ_vbox
 = 
	`gtk_vbox_√w
 (
FALSE
, 1);

804 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
ddi•
->
shñl
), 
roŸ_vbox
);

805 
	`gtk_box_∑ck_íd
 (
	`GTK_BOX
 (
roŸ_vbox
), 
èbÀ
, 
TRUE
, TRUE, 0);

809 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
ddi•
->
shñl
), 
èbÀ
);

814 i‡(!
u£_mb¨
) {

815 
ddi•
->
‹igö
 = 
	`gtk_buâ⁄_√w
();

816 
	`GTK_WIDGET_UNSET_FLAGS
(
ddi•
->
‹igö
, 
GTK_CAN_FOCUS
);

817 
widgë
 = 
	`gtk_¨row_√w
(
GTK_ARROW_RIGHT
, 
GTK_SHADOW_OUT
);

818 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
ddi•
->
‹igö
), 
widgë
);

819 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
widgë
, 
	`_
("Dügøm míu."), 
NULL
);

820 
	`gtk_widgë_show
(
widgë
);

821 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
ddi•
->
‹igö
), "button_press_event",

822 
	`G_CALLBACK
(
‹igö_buâ⁄_¥ess
), 
ddi•
);

825 
ddi•
->
‹igö
 = 
	`gtk_‰ame_√w
 (
NULL
);

826 
	`gtk_‰ame_£t_shadow_ty≥
 (
	`GTK_FRAME
 (
ddi•
->
‹igö
), 
GTK_SHADOW_OUT
);

830 
ddi•
->
hruÀ
 = 
	`gtk_hruÀr_√w
 ();

831 
	`g_sig«l_c⁄√˘_sw≠≥d
 (
	`GTK_OBJECT
 (
ddi•
->
shñl
), "motion_notify_event",

832 
	`G_CALLBACK
(
	`GTK_WIDGET_GET_CLASS
 (
ddi•
->
hruÀ
)->
mŸi⁄_nŸify_evít
),

833 
	`GTK_OBJECT
 (
ddi•
->
hruÀ
));

835 
ddi•
->
vruÀ
 = 
	`gtk_vruÀr_√w
 ();

836 
	`g_sig«l_c⁄√˘_sw≠≥d
 (
	`GTK_OBJECT
 (
ddi•
->
shñl
), "motion_notify_event",

837 
	`G_CALLBACK
(
	`GTK_WIDGET_GET_CLASS
 (
ddi•
->
vruÀ
)->
mŸi⁄_nŸify_evít
),

838 
	`GTK_OBJECT
 (
ddi•
->
vruÀ
));

840 
ddi•
->
hsb
 = 
	`gtk_hs¸ﬁlb¨_√w
 (ddi•->
hsbd©a
);

841 
	`GTK_WIDGET_UNSET_FLAGS
 (
ddi•
->
hsb
, 
GTK_CAN_FOCUS
);

842 
ddi•
->
vsb
 = 
	`gtk_vs¸ﬁlb¨_√w
 (ddi•->
vsbd©a
);

843 
	`GTK_WIDGET_UNSET_FLAGS
 (
ddi•
->
vsb
, 
GTK_CAN_FOCUS
);

847 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
hsbd©a
), "value_changed",

848 
	`G_CALLBACK
(
ddi•œy_hsb_upd©e
),

849 
ddi•
);

850 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
vsbd©a
), "value_changed",

851 
	`G_CALLBACK
(
ddi•œy_vsb_upd©e
),

852 
ddi•
);

855 
«vig©i⁄_buâ⁄
 = 
	`«vig©i⁄_p›up_√w
(
ddi•
);

856 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
«vig©i⁄_buâ⁄
,

857 
	`_
("P›†u∞thêNavig©i⁄ wödow."), 
NULL
);

858 
	`gtk_widgë_show
(
«vig©i⁄_buâ⁄
);

862 
ddi•
->
ˇnvas
 = 
	`dü_ˇnvas_√w
();

864 
	`gtk_widgë_£t_doubÀ_buf„ªd
 (
ddi•
->
ˇnvas
, 
FALSE
);

866 
	`dü_ˇnvas_£t_size
(
	`DIA_CANVAS
 (
ddi•
->
ˇnvas
), 
width
, 
height
);

868 
	`gtk_widgë_£t_evíts
 (
ddi•
->
ˇnvas
, 
CANVAS_EVENT_MASK
);

869 
	`GTK_WIDGET_SET_FLAGS
 (
ddi•
->
ˇnvas
, 
GTK_CAN_FOCUS
);

870 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
ˇnvas
), "event",

871 
	`G_CALLBACK
(
ddi•œy_ˇnvas_evíts
),

872 
ddi•
);

874 
	`gtk_døg_de°_£t
(
ddi•
->
ˇnvas
, 
GTK_DEST_DEFAULT_ALL
,

875 
di•œy_èrgë_èbÀ
, 
di•œy_n_èrgës
, 
GDK_ACTION_COPY
);

876 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
ˇnvas
), "drag_drop",

877 
	`G_CALLBACK
(
di•œy_dr›_ˇŒback
), 
NULL
);

878 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ddi•
->
ˇnvas
), "drag_data_received",

879 
	`G_CALLBACK
(
di•œy_d©a_ª˚ived_ˇŒback
), 
ddi•
);

881 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ddi•
->
ˇnvas
), "u£r_d©a", (
gpoöãr
) ddisp);

884 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
‹igö
, 0, 1, 0, 1,

885 
GTK_FILL
, GTK_FILL, 0, 0);

886 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
hruÀ
, 1, 2, 0, 1,

887 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, GTK_FILL, 0, 0);

888 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
vruÀ
, 0, 1, 1, 2,

889 
GTK_FILL
, 
GTK_EXPAND
 | 
GTK_SHRINK
 | GTK_FILL, 0, 0);

890 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
ˇnvas
, 1, 2, 1, 2,

891 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
,

892 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, 0, 0);

893 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
hsb
, 0, 2, 2, 3,

894 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, GTK_FILL, 0, 0);

895 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ddi•
->
vsb
, 2, 3, 0, 2,

896 
GTK_FILL
, 
GTK_EXPAND
 | 
GTK_SHRINK
 | GTK_FILL, 0, 0);

897 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
«vig©i⁄_buâ⁄
, 2, 3, 2, 3,

898 
GTK_FILL
, GTK_FILL, 0, 0);

901 
ddi•
->
ac˚l_group
 = 
	`míus_gë_di•œy_ac˚ls
 ();

902 i‡(
t›_Àvñ_wödow
)

903 
	`gtk_wödow_add_ac˚l_group
(
	`GTK_WINDOW
(
ddi•
->
shñl
), ddi•->
ac˚l_group
);

904 i‡(
u£_mb¨
)

906 
ddi•
->
míu_b¨
 = 
	`míus_¸óã_di•œy_míub¨
 (&ddi•->
ui_m™agî
, &ddi•->
a˘i⁄s
);

907 
	`g_as£π
 (
ddi•
->
míu_b¨
);

908 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
roŸ_vbox
), 
ddi•
->
míu_b¨
, 
FALSE
, 
TRUE
, 0);

912 
°©us_hbox
 = 
	`gtk_hbox_√w
 (
FALSE
, 2);

920 
ddi•
->
zoom_°©us
 = 
	`¸óã_zoom_widgë
(ddisp);

921 
zoom_hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 0);

922 
zoom_œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Zoom"));

923 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
(
zoom_hbox
), 
zoom_œbñ
,

924 
FALSE
, FALSE, 0);

925 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
(
zoom_hbox
), 
ddi•
->
zoom_°©us
,

926 
FALSE
, FALSE, 0);

928 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
°©us_hbox
), 
zoom_hbox
, 
FALSE
, FALSE, 0);

931 
ddi•
->
grid_°©us
 = 
	`dü_toggÀ_buâ⁄_√w_wôh_ic⁄s
(
dü_⁄_grid_ic⁄
,

932 
dü_off_grid_ic⁄
);

934 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
ddi•
->
grid_°©us
), "toggled",

935 
	`G_CALLBACK
 (
grid_toggÀ_¢≠
), 
ddi•
);

936 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
ddi•
->
grid_°©us
,

937 
	`_
("ToggÀ†¢≠-to-grid f‹Åhi†wödow."), 
NULL
);

938 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
°©us_hbox
), 
ddi•
->
grid_°©us
,

939 
FALSE
, FALSE, 0);

942 
ddi•
->
maöpoöt_°©us
 = 
	`dü_toggÀ_buâ⁄_√w_wôh_ic⁄s
(
dü_maöpoöts_⁄_ic⁄
,

943 
dü_maöpoöts_off_ic⁄
);

945 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
ddi•
->
maöpoöt_°©us
), "toggled",

946 
	`G_CALLBACK
 (
öãrÁ˚_toggÀ_maöpoöt_mag√tism
), 
ddi•
);

947 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
ddi•
->
maöpoöt_°©us
,

948 
	`_
("ToggÀ†obje˘ s«µög f‹Åhi†wödow."), 
NULL
);

949 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
°©us_hbox
), 
ddi•
->
maöpoöt_°©us
,

950 
FALSE
, FALSE, 0);

954 
ddi•
->
modifõd_°©us
 = 
	`gtk_°©usb¨_√w
 ();

956 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
°©us_hbox
), 
ddi•
->
modifõd_°©us
,

957 
TRUE
, TRUE, 0);

959 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
°©us_hbox
, 0, 3, 3, 4,

960 
GTK_FILL
, GTK_FILL, 0, 0);

962 
	`gtk_widgë_show
 (
ddi•
->
hsb
);

963 
	`gtk_widgë_show
 (
ddi•
->
vsb
);

964 
	`di•œy_ruÀrs_show
 (
ddi•
);

965 
	`gtk_widgë_show
 (
ddi•
->
zoom_°©us
);

966 
	`gtk_widgë_show
 (
zoom_hbox
);

967 
	`gtk_widgë_show
 (
zoom_œbñ
);

968 
	`gtk_widgë_show
 (
ddi•
->
grid_°©us
);

969 
	`gtk_widgë_show
 (
ddi•
->
maöpoöt_°©us
);

970 
	`gtk_widgë_show
 (
ddi•
->
modifõd_°©us
);

971 
	`gtk_widgë_show
 (
°©us_hbox
);

972 
	`gtk_widgë_show
 (
èbÀ
);

973 i‡(
u£_mb¨
)

975 
	`gtk_widgë_show
 (
ddi•
->
míu_b¨
);

976 
	`gtk_widgë_show
 (
roŸ_vbox
);

978 
	`gtk_widgë_show
 (
ddi•
->
shñl
);

981 i‡(
u£_mb¨
 && 
ddi•
->
hruÀ
->
Æloˇti⁄
.
width
 > width)

990 
width
 = 
ddi•
->
hruÀ
->
Æloˇti⁄
.width;

992 
ddi•
->
hsbd©a
->
uµî
 = 
width
;

993 
ddi•
->
hsbd©a
->
∑ge_ö¸emít
 = (
width
 - 1) / 4;

994 
ddi•
->
hsbd©a
->
∑ge_size
 = 
width
 - 1;

996 
	`gtk_adju°mít_ch™ged
 (
	`GTK_ADJUSTMENT
(
ddi•
->
hsbd©a
));

998 
	`gtk_widgë_show
 (
ddi•
->
ˇnvas
);

1001 
	`gtk_widgë_gøb_focus
 (
ddi•
->
ˇnvas
);

1002 
	}
}

1005 
	$toﬁ_£À˘_upd©e
 (
GtkWidgë
 *
w
,

1006 
gpoöãr
 
d©a
)

1008 
ToﬁBuâ⁄D©a
 *
toﬁd©a
 = (ToﬁBuâ⁄D©®*Ë
d©a
;

1010 i‡(
toﬁd©a
 =
NULL
) {

1011 
	`g_w¨nög
("NULLÅooldata inÅool_select_update");

1015 i‡(
toﬁd©a
->
ty≥
 != -1) {

1016 
göt
 
x
, 
y
;

1017 
GdkModifõrTy≥
 
mask
;

1019 
	`gdk_wödow_gë_poöãr
 (
	`gtk_widgë_gë_∑ª¡_wödow
(
w
), &
x
, &
y
, &
mask
);

1020 
	`toﬁ_£À˘
 (
toﬁd©a
->
ty≥
,Åoﬁd©a->
exåa_d©a
,Åoﬁd©a->
u£r_d©a
,

1021 
w
, 
mask
&1);

1023 
	}
}

1025 
göt


1026 
	$toﬁ_buâ⁄_¥ess
 (
GtkWidgë
 *
w
,

1027 
GdkEvítBuâ⁄
 *
evít
,

1028 
gpoöãr
 
d©a
)

1030 
ToﬁBuâ⁄D©a
 *
toﬁd©a
 = (ToﬁBuâ⁄D©®*Ë
d©a
;

1032 i‡((
evít
->
ty≥
 =
GDK_2BUTTON_PRESS
) &&

1033 (
evít
->
buâ⁄
 == 1)) {

1036  
TRUE
;

1039  
FALSE
;

1040 
	}
}

1043 
	$toﬁ_døg_d©a_gë
 (
GtkWidgë
 *
widgë
, 
GdkDøgC⁄ãxt
 *
c⁄ãxt
,

1044 
GtkSñe˘i⁄D©a
 *
£À˘i⁄_d©a
, 
guöt
 
öfo
,

1045 
guöt32
 
time
, 
ToﬁBuâ⁄D©a
 *
toﬁd©a
)

1047 i‡(
öfo
 == 0) {

1048 
	`gtk_£À˘i⁄_d©a_£t
(
£À˘i⁄_d©a
, sñe˘i⁄_d©a->
èrgë
,

1049 8, (
guch¨
 *)&
toﬁd©a
, (
ToﬁBuâ⁄D©a
 *));

1051 
	}
}

1054 
	$toﬁ_£tup_døg_sour˚
(
GtkWidgë
 *
buâ⁄
, 
ToﬁBuâ⁄D©a
 *
toﬁd©a
,

1055 
GdkPixm≠
 *
pixm≠
, 
GdkBôm≠
 *
mask
)

1057 
	`g_ªtu∫_if_Áû
(
toﬁd©a
->
ty≥
 =
CREATE_OBJECT_TOOL
);

1059 
	`gtk_døg_sour˚_£t
(
buâ⁄
, 
GDK_BUTTON1_MASK
,

1060 
di•œy_èrgë_èbÀ
, 
di•œy_n_èrgës
,

1061 
GDK_ACTION_DEFAULT
|
GDK_ACTION_COPY
);

1062 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
buâ⁄
), "drag_data_get",

1063 
	`G_CALLBACK
(
toﬁ_døg_d©a_gë
), 
toﬁd©a
);

1064 i‡(
pixm≠
)

1065 
	`gtk_døg_sour˚_£t_ic⁄
(
buâ⁄
, 
	`gtk_widgë_gë_cﬁ‹m≠
(button),

1066 
pixm≠
, 
mask
);

1067 
	}
}

1091 
GtkWidgë
 *

1092 
	$¸óã_widgë_‰om_xpm_‹_gdkp
(
gch¨
 **
ic⁄_d©a
, 
GtkWidgë
 *
buâ⁄
)

1094 
GtkWidgë
 *
pixm≠widgë
;

1096 i‡(
	`°∫cmp
((*)
ic⁄_d©a
, "GdkP", 4) == 0) {

1097 
GdkPixbuf
 *
p
;

1098 
p
 = 
	`gdk_pixbuf_√w_‰om_ölöe
(-1, (*)
ic⁄_d©a
, 
TRUE
, 
NULL
);

1099 
pixm≠widgë
 = 
	`gtk_image_√w_‰om_pixbuf
(
p
);

1101 
GdkBôm≠
 *
mask
 = 
NULL
;

1102 
GtkStyÀ
 *
°yÀ
;

1103 **
pixm≠_d©a
;

1104 
GdkPixm≠
 *
pixm≠
 = 
NULL
;

1106 
pixm≠_d©a
 = 
ic⁄_d©a
;

1107 
°yÀ
 = 
	`gtk_widgë_gë_°yÀ
(
buâ⁄
);

1108 
pixm≠
 = 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

1109 
	`gtk_widgë_gë_cﬁ‹m≠
(
buâ⁄
), &
mask
,

1110 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
], 
pixm≠_d©a
);

1111 
pixm≠widgë
 = 
	`gtk_pixm≠_√w
(
pixm≠
, 
mask
);

1113  
pixm≠widgë
;

1114 
	}
}

1117 
	$¸óã_toﬁs
(
GtkWidgë
 *
∑ª¡
)

1119 
GtkWidgë
 *
buâ⁄
;

1120 
GtkWidgë
 *
pixm≠widgë
;

1121 
GdkPixm≠
 *
pixm≠
 = 
NULL
;

1122 
GdkBôm≠
 *
mask
 = 
NULL
;

1124 **
pixm≠_d©a
;

1125 
i
;

1127 
i
 = 0; i < 
NUM_TOOLS
; i++) {

1128 
toﬁ_widgës
[
i
] = 
buâ⁄
 = 
	`gtk_ødio_buâ⁄_√w
 (
toﬁ_group
);

1129 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
buâ⁄
), 0);

1130 
	`gtk_buâ⁄_£t_ªlõf
(
	`GTK_BUTTON
(
buâ⁄
), 
GTK_RELIEF_HALF
);

1131 
toﬁ_group
 = 
	`gtk_ødio_buâ⁄_group
 (
	`GTK_RADIO_BUTTON
 (
buâ⁄
));

1132 
	`gtk_toggÀ_buâ⁄_£t_mode
 (
	`GTK_TOGGLE_BUTTON
 (
buâ⁄
), 
FALSE
);

1134 
	`gtk_wøp_box_∑ck
(
	`GTK_WRAP_BOX
(
∑ª¡
), 
buâ⁄
,

1135 
TRUE
, TRUE, 
FALSE
, TRUE);

1137 i‡(
toﬁ_d©a
[
i
].
ˇŒback_d©a
.
ty≥
 =
MODIFY_TOOL
) {

1138 
modify_toﬁ_buâ⁄
 = 
	`GTK_WIDGET
(
buâ⁄
);

1141 i‡(
toﬁ_d©a
[
i
].
ic⁄_d©a
==
NULL
) {

1142 
DüObje˘Ty≥
 *
ty≥
;

1143 
ty≥
 =

1144 
	`obje˘_gë_ty≥
((*)
toﬁ_d©a
[
i
].
ˇŒback_d©a
.
exåa_d©a
);

1145 i‡(
ty≥
 =
NULL
)

1146 
pixm≠_d©a
 = 
toﬁ_d©a
[0].
ic⁄_d©a
;

1148 
pixm≠_d©a
 = 
ty≥
->
pixm≠
;

1149 
pixm≠widgë
 = 
	`¸óã_widgë_‰om_xpm_‹_gdkp
(
pixm≠_d©a
, 
buâ⁄
);

1151 
pixm≠widgë
 = 
	`¸óã_widgë_‰om_xpm_‹_gdkp
(
toﬁ_d©a
[
i
].
ic⁄_d©a
, 
buâ⁄
);

1155 
	`gtk_misc_£t_∑ddög
(
	`GTK_MISC
(
pixm≠widgë
), 2, 2);

1157 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
buâ⁄
), 
pixm≠widgë
);

1159 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1160 
	`G_CALLBACK
 (
toﬁ_£À˘_upd©e
),

1161 &
toﬁ_d©a
[
i
].
ˇŒback_d©a
);

1163 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "button_press_event",

1164 
	`G_CALLBACK
 (
toﬁ_buâ⁄_¥ess
),

1165 &
toﬁ_d©a
[
i
].
ˇŒback_d©a
);

1167 i‡(
toﬁ_d©a
[
i
].
ˇŒback_d©a
.
ty≥
 =
CREATE_OBJECT_TOOL
)

1168 
	`toﬁ_£tup_døg_sour˚
(
buâ⁄
, &
toﬁ_d©a
[
i
].
ˇŒback_d©a
,

1169 
pixm≠
, 
mask
);

1171 i‡(
pixm≠
Ë
	`gdk_pixm≠_uƒef
(pixmap);

1172 i‡(
mask
Ë
	`gdk_bôm≠_uƒef
(mask);

1174 
toﬁ_d©a
[
i
].
ˇŒback_d©a
.
widgë
 = 
buâ⁄
;

1176 i‡(
toﬁ_d©a
[
i
].
toﬁ_ac˚Àøt‹
) {

1177 
guöt
 
key
;

1178 
GdkModifõrTy≥
 
mods
;

1179 
gch¨
 *
Æabñ
, *
©ù
;

1181 
	`gtk_ac˚Àøt‹_∑r£
 (
toﬁ_d©a
[
i
].
toﬁ_ac˚Àøt‹
, &
key
, &
mods
);

1183 
Æabñ
 = 
	`gtk_ac˚Àøt‹_gë_œbñ
(
key
, 
mods
);

1184 
©ù
 = 
	`g_°rc⁄ˇt
(
	`gëãxt
(
toﬁ_d©a
[
i
].
toﬁ_desc
), " (", 
Æabñ
, ")", 
NULL
);

1185 
	`gtk_toﬁtùs_£t_tù
 (
toﬁ_tùs
, 
buâ⁄
, 
©ù
, 
NULL
);

1186 
	`g_‰ì
 (
©ù
);

1187 
	`g_‰ì
 (
Æabñ
);

1190 
	`gtk_toﬁtùs_£t_tù
 (
toﬁ_tùs
, 
buâ⁄
,

1191 
	`gëãxt
(
toﬁ_d©a
[
i
].
toﬁ_desc
), 
NULL
);

1194 
	`gtk_widgë_show
 (
pixm≠widgë
);

1195 
	`gtk_widgë_show
 (
buâ⁄
);

1197 
	}
}

1199 
GtkWidgë
 *
	gshìt_›ti⁄_míu
;

1200 
GtkWidgë
 *
	gshìt_wbox
;

1202 
gch¨
 *
	göãrÁ˚_cuºít_shìt_«me
;

1204 
Shìt
 *

1205 
	$gë_shìt_by_«me
(c⁄° 
gch¨
 *
«me
)

1207 
GSLi°
 *
tmp
;

1208 
tmp
 = 
	`gë_shìts_li°
();Åm∞!
NULL
;Åm∞tmp->
√xt
) {

1209 
Shìt
 *
shìt
 = 
tmp
->
d©a
;

1213 i‡(0 =
	`g_°rˇ£cmp
(
«me
, 
shìt
->«meË|| 0 =g_°rˇ£cmp“ame, 
	`gëãxt
(sheet->name)))

1214  
shìt
;

1216  
NULL
;

1217 
	}
}

1220 
	$fûl_shìt_wbox
(
Shìt
 *
shìt
)

1222 
rows
;

1223 
GtkStyÀ
 *
°yÀ
;

1224 
GSLi°
 *
tmp
;

1225 
GtkWidgë
 *
fú°_buâ⁄
 = 
NULL
;

1227 
	`gtk_c⁄èöî_f‹óch
(
	`GTK_CONTAINER
(
shìt_wbox
),

1228 (
GtkCÆlback
)
gtk_widgë_de°roy
, 
NULL
);

1229 
toﬁ_group
 = 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(
toﬁ_widgës
[0]));

1232 
öãrÁ˚_cuºít_shìt_«me
 = 
shìt
->
«me
;

1235 
rows
 = 
	`˚û
(
	`g_¶i°_Àngth
(
shìt
->
obje˘s
Ë/ ()
COLUMNS
);

1236 i‡(
rows
<1)Ñows = 1;

1237 
	`gtk_wøp_box_£t_a•e˘_øtio
(
	`GTK_WRAP_BOX
(
shìt_wbox
),

1238 
COLUMNS
 * 1.0 / 
rows
);

1239 
°yÀ
 = 
	`gtk_widgë_gë_°yÀ
(
shìt_wbox
);

1240 
tmp
 = 
shìt
->
obje˘s
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

1241 
ShìtObje˘
 *
shìt_obj
 = 
tmp
->
d©a
;

1242 
GdkPixm≠
 *
pixm≠
 = 
NULL
;

1243 
GdkBôm≠
 *
mask
 = 
NULL
;

1244 
GtkWidgë
 *
pixm≠widgë
;

1245 
GtkWidgë
 *
buâ⁄
;

1246 
ToﬁBuâ⁄D©a
 *
d©a
;

1248 i‡(
shìt_obj
->
pixm≠
 !
NULL
) {

1249 
pixm≠
 = 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

1250 
	`gtk_widgë_gë_cﬁ‹m≠
(
shìt_wbox
), &
mask
,

1251 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
], 
shìt_obj
->
pixm≠
);

1252 } i‡(
shìt_obj
->
pixm≠_fûe
 !
NULL
) {

1253 
GdkPixbuf
 *
pixbuf
;

1254 
GEº‹
* 
gîr‹
 = 
NULL
;

1256 
pixbuf
 = 
	`gdk_pixbuf_√w_‰om_fûe
(
shìt_obj
->
pixm≠_fûe
, &
gîr‹
);

1257 i‡(
pixbuf
 !
NULL
) {

1258 
width
 = 
	`gdk_pixbuf_gë_width
 (
pixbuf
);

1259 
height
 = 
	`gdk_pixbuf_gë_height
 (
pixbuf
);

1260 i‡(
width
 > 22) {

1261 
GdkPixbuf
 *
¸›≥d
;

1262 
	`g_w¨nög
 ("Sh≠êic⁄ '%s' sizêwr⁄g, cr›≥d.", 
shìt_obj
->
pixm≠_fûe
);

1263 
¸›≥d
 = 
	`gdk_pixbuf_√w_subpixbuf
 (
pixbuf
,

1264 (
width
 - 22Ë/ 2, 
height
 > 22 ? (height - 22) / 2 : 0,

1265 22, 
height
 > 22 ? 22 : height);

1266 
	`g_obje˘_uƒef
 (
pixbuf
);

1267 
pixbuf
 = 
¸›≥d
;

1269 
	`gdk_pixbuf_ªndî_pixm≠_™d_mask_f‹_cﬁ‹m≠
(
pixbuf
, 
	`gtk_widgë_gë_cﬁ‹m≠
(
shìt_wbox
), &
pixm≠
, &
mask
, 1.0);

1270 
	`gdk_pixbuf_uƒef
(
pixbuf
);

1272 
pixm≠
 = 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

1273 
	`gtk_widgë_gë_cﬁ‹m≠
(
shìt_wbox
), &
mask
,

1274 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
], 
missög
);

1276 
	`mesßge_w¨nög
("failedÅoÜoad icon for file\n %s\n cause=%s",

1277 
shìt_obj
->
pixm≠_fûe
,
gîr‹
?gîr‹->
mesßge
:"[NULL]");

1280 
DüObje˘Ty≥
 *
ty≥
;

1281 
ty≥
 = 
	`obje˘_gë_ty≥
(
shìt_obj
->
obje˘_ty≥
);

1282 
pixm≠
 = 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

1283 
	`gtk_widgë_gë_cﬁ‹m≠
(
shìt_wbox
), &
mask
,

1284 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
], 
ty≥
->
pixm≠
);

1286 i‡(
pixm≠
) {

1287 
pixm≠widgë
 = 
	`gtk_pixm≠_√w
(
pixm≠
, 
mask
);

1288 
	`gdk_pixm≠_uƒef
(
pixm≠
);

1289 i‡(
mask
Ë
	`gdk_bôm≠_uƒef
(mask);

1291 
pixm≠widgë
 = 
	`gtk_ty≥_√w
(
	`gtk_pixm≠_gë_ty≥
());

1294 
buâ⁄
 = 
	`gtk_ødio_buâ⁄_√w
 (
toﬁ_group
);

1295 
	`gtk_toggÀ_buâ⁄_£t_mode
 (
	`GTK_TOGGLE_BUTTON
 (
buâ⁄
), 
FALSE
);

1296 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
buâ⁄
), 0);

1297 
toﬁ_group
 = 
	`gtk_ødio_buâ⁄_group
 (
	`GTK_RADIO_BUTTON
 (
buâ⁄
));

1299 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
buâ⁄
), 
pixm≠widgë
);

1300 
	`gtk_widgë_show
(
pixm≠widgë
);

1302 
	`gtk_wøp_box_∑ck_wøµed
(
	`GTK_WRAP_BOX
(
shìt_wbox
), 
buâ⁄
,

1303 
FALSE
, 
TRUE
, FALSE, TRUE, 
shìt_obj
->
löe_bªak
);

1304 
	`gtk_widgë_show
(
buâ⁄
);

1306 
d©a
 = 
	`g_√w
(
ToﬁBuâ⁄D©a
, 1);

1307 
d©a
->
ty≥
 = 
CREATE_OBJECT_TOOL
;

1308 
d©a
->
exåa_d©a
 = 
shìt_obj
->
obje˘_ty≥
;

1309 
d©a
->
u£r_d©a
 = 
shìt_obj
->user_data;

1310 
	`gtk_obje˘_£t_d©a_fuŒ
(
	`GTK_OBJECT
(
buâ⁄
), "Dia::ToolButtonData",

1311 
d©a
, (
GdkDe°royNŸify
)
g_‰ì
);

1312 i‡(
fú°_buâ⁄
 =
NULL
Ëfú°_buâ⁄ = 
buâ⁄
;

1314 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1315 
	`G_CALLBACK
 (
toﬁ_£À˘_upd©e
), 
d©a
);

1316 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "button_press_event",

1317 
	`G_CALLBACK
 (
toﬁ_buâ⁄_¥ess
), 
d©a
);

1319 
	`toﬁ_£tup_døg_sour˚
(
buâ⁄
, 
d©a
, 
pixm≠
, 
mask
);

1321 
	`gtk_toﬁtùs_£t_tù
 (
toﬁ_tùs
, 
buâ⁄
,

1322 
	`gëãxt
(
shìt_obj
->
des¸ùti⁄
), 
NULL
);

1325 i‡(
a˘ive_toﬁ
 !
NULL
 &&

1326 
a˘ive_toﬁ
->
ty≥
 =
CREATE_OBJECT_TOOL
 &&

1327 
fú°_buâ⁄
 !
NULL
)

1328 
	`gtk_sig«l_emô_by_«me
(
	`GTK_OBJECT
(
fú°_buâ⁄
), "toggled",

1329 
	`GTK_BUTTON
(
fú°_buâ⁄
), 
NULL
);

1330 
	}
}

1333 
	$shìt_›ti⁄_míu_ch™ged
(
DüDy«micMíu
 *
míu
, 
gpoöãr
 
u£r_d©a
)

1335 *
°rög
 = 
	`dü_dy«mic_míu_gë_íåy
(
míu
);

1336 
Shìt
 *
shìt
 = 
	`gë_shìt_by_«me
(
°rög
);

1337 i‡(
shìt
 =
NULL
) {

1338 
	`mesßge_w¨nög
(
	`_
("Nÿshìà«med %s"), 
°rög
);

1340 
	`≥rsi°í˚_£t_°rög
("œ°-shìt-£À˘ed", 
°rög
);

1341 
	`fûl_shìt_wbox
(
shìt
);

1343 
	`g_‰ì
(
°rög
);

1344 
	}
}

1347 
	$cmp_«mes
 (c⁄° *
a
, c⁄° *
b
)

1349  
	`g_utf8_cﬁœã
(
	`gëãxt
–(
gch¨
 *)
a
 ), gëãxt–(gch¨ *)
b
 ));

1350 
	}
}

1352 
GLi°
 *

1353 
	$gë_shìt_«mes
()

1355 
GSLi°
 *
tmp
;

1356 
GLi°
 *
«mes
 = 
NULL
;

1357 
tmp
 = 
	`gë_shìts_li°
();Åm∞!
NULL
;Åm∞tmp->
√xt
) {

1358 
Shìt
 *
shìt
 = 
tmp
->
d©a
;

1359 
«mes
 = 
	`g_li°_≠≥nd
“ames, 
shìt
->
«me
);

1362  
	`g_li°_s‹t
 (
«mes
, 
cmp_«mes
);

1363 
	}
}

1366 
	$¸óã_shìt_dr›down_míu
(
GtkWidgë
 *
∑ª¡
)

1368 
GLi°
 *
shìt_«mes
 = 
	`gë_shìt_«mes
();

1370 i‡(
shìt_›ti⁄_míu
 !
NULL
) {

1371 
	`gtk_c⁄èöî_ªmove
(
	`GTK_CONTAINER
(
∑ª¡
), 
shìt_›ti⁄_míu
);

1372 
shìt_›ti⁄_míu
 = 
NULL
;

1375 
shìt_›ti⁄_míu
 =

1376 
	`dü_dy«mic_míu_√w_°rögli°ba£d
(
	`_
("STRUCT"), 
shìt_«mes
,

1377 
NULL
, "sheets");

1389 
	`gtk_wøp_box_∑ck_wøµed
(
	`GTK_WRAP_BOX
(
∑ª¡
), 
shìt_›ti⁄_míu
,

1390 
TRUE
, TRUE, 
FALSE
, FALSE, TRUE);

1392 
	`gtk_wøp_box_ª‹dî_chûd
(
	`GTK_WRAP_BOX
(
∑ª¡
),

1393 
shìt_›ti⁄_míu
, 
NUM_TOOLS
+1);

1394 
	`gtk_widgë_show
(
shìt_›ti⁄_míu
);

1395 
	}
}

1398 
	$fûl_shìt_míu
()

1400 
gch¨
 *
£À˘i⁄
 = 
	`dü_dy«mic_míu_gë_íåy
(
	`DIA_DYNAMIC_MENU
(
shìt_›ti⁄_míu
));

1401 
	`¸óã_shìt_dr›down_míu
(
	`gtk_widgë_gë_∑ª¡
(
shìt_›ti⁄_míu
));

1402 
	`dü_dy«mic_míu_£À˘_íåy
(
	`DIA_DYNAMIC_MENU
(
shìt_›ti⁄_míu
), 
£À˘i⁄
);

1403 
	`g_‰ì
(
£À˘i⁄
);

1404 
	}
}

1407 
	$¸óã_shìts
(
GtkWidgë
 *
∑ª¡
)

1409 
GtkWidgë
 *
£∑øt‹
;

1410 
GtkWidgë
 *
œbñ
;

1411 
GtkWidgë
 *
swö
;

1412 
gch¨
 *
shìäame
;

1413 
Shìt
 *
shìt
;

1415 
£∑øt‹
 = 
	`gtk_h£∑øt‹_√w
 ();

1417 
œbñ
 = 
	`gtk_vbox_√w
(
FALSE
, 0);

1418 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
œbñ
), 
£∑øt‹
, 
TRUE
, TRUE, 3);

1419 
	`gtk_widgë_show
(
œbñ
);

1421 
	`gtk_wøp_box_∑ck_wøµed
 (
	`GTK_WRAP_BOX
(
∑ª¡
), 
œbñ
, 
TRUE
,TRUE, 
FALSE
,FALSE, TRUE);

1422 
	`gtk_widgë_show
(
£∑øt‹
);

1424 
	`¸óã_shìt_dr›down_míu
(
∑ª¡
);

1426 
swö
 = 
	`gtk_s¸ﬁÀd_wödow_√w
(
NULL
, NULL);

1427 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
(
	`GTK_SCROLLED_WINDOW
(
swö
),

1428 
GTK_POLICY_NEVER
, 
GTK_POLICY_AUTOMATIC
);

1429 
	`gtk_wøp_box_∑ck_wøµed
(
	`GTK_WRAP_BOX
(
∑ª¡
), 
swö
, 
TRUE
, TRUE, TRUE, TRUE, TRUE);

1430 
	`gtk_widgë_show
(
swö
);

1432 
shìt_wbox
 = 
	`gtk_hwøp_box_√w
(
FALSE
);

1433 
	`gtk_wøp_box_£t_ju°ify
(
	`GTK_WRAP_BOX
(
shìt_wbox
), 
GTK_JUSTIFY_TOP
);

1434 
	`gtk_wøp_box_£t_löe_ju°ify
(
	`GTK_WRAP_BOX
(
shìt_wbox
), 
GTK_JUSTIFY_LEFT
);

1435 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
(
	`GTK_SCROLLED_WINDOW
(
swö
), 
shìt_wbox
);

1436 
	`gtk_widgë_show
(
shìt_wbox
);

1438 
shìäame
 = 
	`≥rsi°í˚_ªgi°î_°rög
("œ°-shìt-£À˘ed", 
	`_
("Flowchart"));

1439 
shìt
 = 
	`gë_shìt_by_«me
(
shìäame
);

1440 i‡(
shìt
 =
NULL
) {

1443 
	`fûl_shìt_wbox
(
shìt
);

1444 
	`dü_dy«mic_míu_£À˘_íåy
(
	`DIA_DYNAMIC_MENU
(
shìt_›ti⁄_míu
),

1445 
shìäame
);

1447 
	`g_‰ì
(
shìäame
);

1448 
	}
}

1451 
	$¸óã_cﬁ‹_¨ó
 (
GtkWidgë
 *
∑ª¡
)

1453 
GtkWidgë
 *
‰ame
;

1454 
GtkWidgë
 *
Æignmít
;

1455 
GtkWidgë
 *
cﬁ_¨ó
;

1456 
GtkWidgë
 *
löe_¨ó
;

1457 
GdkPixm≠
 *
deÁu…_pixm≠
;

1458 
GdkBôm≠
 *
deÁu…_mask
;

1459 
GdkPixm≠
 *
sw≠_pixm≠
;

1460 
GdkBôm≠
 *
sw≠_mask
;

1461 
GtkStyÀ
 *
°yÀ
;

1462 
GtkWidgë
 *
hbox
;

1464 
	`gtk_widgë_ísuª_°yÀ
(
∑ª¡
);

1465 
°yÀ
 = 
	`gtk_widgë_gë_°yÀ
(
∑ª¡
);

1467 
deÁu…_pixm≠
 =

1468 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

1469 
	`gtk_widgë_gë_cﬁ‹m≠
(
∑ª¡
), &
deÁu…_mask
,

1470 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
], 
deÁu…_xpm
);

1471 
sw≠_pixm≠
 =

1472 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

1473 
	`gtk_widgë_gë_cﬁ‹m≠
(
∑ª¡
), &
sw≠_mask
,

1474 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
], 
sw≠_xpm
);

1476 
‰ame
 = 
	`gtk_‰ame_√w
 (
NULL
);

1477 
	`gtk_‰ame_£t_shadow_ty≥
 (
	`GTK_FRAME
 (
‰ame
), 
GTK_SHADOW_OUT
);

1478 
	`gtk_wøp_box_∑ck_wøµed
(
	`GTK_WRAP_BOX
(
∑ª¡
), 
‰ame
, 
TRUE
, TRUE, 
FALSE
, FALSE, TRUE);

1479 
	`gtk_widgë_ªÆize
 (
‰ame
);

1481 
hbox
 = 
	`gtk_hbox_√w
 (
FALSE
, 1);

1482 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
hbox
), 0);

1483 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame
), 
hbox
);

1486 
Æignmít
 = 
	`gtk_Æignmít_√w
 (0.5, 0.5, 0.0, 0.0);

1487 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
Æignmít
), 3);

1489 
cﬁ_¨ó
 = 
	`cﬁ‹_¨ó_¸óã
 (54, 42,

1490 
deÁu…_pixm≠
, 
deÁu…_mask
,

1491 
sw≠_pixm≠
, 
sw≠_mask
);

1492 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
Æignmít
), 
cﬁ_¨ó
);

1495 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
Æignmít
, 
TRUE
, TRUE, 0);

1497 
	`gtk_toﬁtùs_£t_tù
 (
toﬁ_tùs
, 
cﬁ_¨ó
,

1498 
	`_
("Foreground & background colors forÇew objects. "

1502 
NULL
);

1504 
	`gtk_widgë_show
 (
Æignmít
);

1507 
Æignmít
 = 
	`gtk_Æignmít_√w
 (0.5, 0.5, 0.0, 0.0);

1508 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
Æignmít
), 3);

1510 
löe_¨ó
 = 
	`löewidth_¨ó_¸óã
 ();

1511 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
Æignmít
), 
löe_¨ó
);

1512 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
Æignmít
, 
TRUE
, TRUE, 0);

1513 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
löe_¨ó
, 
	`_
("Löêwidths. Click o¿®löêtÿ£àthêdeÁu…Üöêwidth f‹Çew obje˘s. DoubÀ-˛ickÅÿ£àthêlöêwidth m‹ê¥eci£ly."), 
NULL
);

1514 
	`gtk_widgë_show
 (
Æignmít
);

1516 
	`gtk_widgë_show
 (
cﬁ_¨ó
);

1517 
	`gtk_widgë_show
 (
löe_¨ó
);

1518 
	`gtk_widgë_show
 (
hbox
);

1519 
	`gtk_widgë_show
 (
‰ame
);

1520 
	}
}

1523 
	$ch™ge_°¨t_¨row_°yÀ
(
Aºow
 
¨row
, 
gpoöãr
 
u£r_d©a
)

1525 
	`©åibuãs_£t_deÁu…_°¨t_¨row
(
¨row
);

1526 
	}
}

1528 
	$ch™ge_íd_¨row_°yÀ
(
Aºow
 
¨row
, 
gpoöãr
 
u£r_d©a
)

1530 
	`©åibuãs_£t_deÁu…_íd_¨row
(
¨row
);

1531 
	}
}

1533 
	$ch™ge_löe_°yÀ
(
LöeStyÀ
 
l°yÀ
, 
ªÆ
 
dash_Àngth
, 
gpoöãr
 
u£r_d©a
)

1535 
	`©åibuãs_£t_deÁu…_löe_°yÀ
(
l°yÀ
, 
dash_Àngth
);

1536 
	}
}

1539 
	$¸óã_löïr›s_¨ó
(
GtkWidgë
 *
∑ª¡
)

1541 
GtkWidgë
 *
choo£r
;

1542 
Aºow
 
¨row
;

1543 
ªÆ
 
dash_Àngth
;

1544 
LöeStyÀ
 
°yÀ
;

1545 
gch¨
 *
¨row_«me
;

1547 
choo£r
 = 
	`dü_¨row_choo£r_√w
(
TRUE
, 
ch™ge_°¨t_¨row_°yÀ
, 
NULL
, 
toﬁ_tùs
);

1548 
	`gtk_wøp_box_∑ck_wøµed
(
	`GTK_WRAP_BOX
(
∑ª¡
), 
choo£r
, 
FALSE
, 
TRUE
, FALSE, TRUE, TRUE);

1549 
¨row
.
width
 = 
	`≥rsi°í˚_ªgi°î_ªÆ
("°¨t-¨row-width", 
DEFAULT_ARROW_WIDTH
);

1550 
¨row
.
Àngth
 = 
	`≥rsi°í˚_ªgi°î_ªÆ
("°¨t-¨row-Àngth", 
DEFAULT_ARROW_LENGTH
);

1551 
¨row_«me
 = 
	`≥rsi°í˚_ªgi°î_°rög
("start-arrow-type", "None");

1552 
¨row
.
ty≥
 = 
	`¨row_ty≥_‰om_«me
(
¨row_«me
);

1553 
	`g_‰ì
(
¨row_«me
);

1554 
	`dü_¨row_choo£r_£t_¨row
(
	`DIA_ARROW_CHOOSER
(
choo£r
), &
¨row
);

1555 
	`©åibuãs_£t_deÁu…_°¨t_¨row
(
¨row
);

1556 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
choo£r
, 
	`_
("Aºow styÀáàthêbegönög o‡√wÜöes. ClickÅÿpická¿¨row, o∏£à¨rowÖ¨amëî†wôh Dëaûs..."), 
NULL
);

1557 
	`gtk_widgë_show
(
choo£r
);

1559 
choo£r
 = 
	`dü_löe_choo£r_√w
(
ch™ge_löe_°yÀ
, 
NULL
);

1560 
	`gtk_wøp_box_∑ck
(
	`GTK_WRAP_BOX
(
∑ª¡
), 
choo£r
, 
TRUE
, TRUE, 
FALSE
, TRUE);

1561 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
choo£r
, 
	`_
("Löê°yÀ f‹ÇewÜöes. ClickÅÿpickáÜöê°yÀ, o∏£àlöê°yÀÖ¨amëî†wôh Dëaûs..."), 
NULL
);

1562 
°yÀ
 = 
	`≥rsi°í˚_ªgi°î_öãgî
("löe-°yÀ", 
LINESTYLE_SOLID
);

1563 
dash_Àngth
 = 
	`≥rsi°í˚_ªgi°î_ªÆ
("dash-Àngth", 
DEFAULT_LINESTYLE_DASHLEN
);

1564 
	`dü_löe_choo£r_£t_löe_°yÀ
(
	`DIA_LINE_CHOOSER
(
choo£r
), 
°yÀ
, 
dash_Àngth
);

1565 
	`gtk_widgë_show
(
choo£r
);

1567 
choo£r
 = 
	`dü_¨row_choo£r_√w
(
FALSE
, 
ch™ge_íd_¨row_°yÀ
, 
NULL
, 
toﬁ_tùs
);

1568 
¨row
.
width
 = 
	`≥rsi°í˚_ªgi°î_ªÆ
("íd-¨row-width", 
DEFAULT_ARROW_WIDTH
);

1569 
¨row
.
Àngth
 = 
	`≥rsi°í˚_ªgi°î_ªÆ
("íd-¨row-Àngth", 
DEFAULT_ARROW_LENGTH
);

1570 
¨row_«me
 = 
	`≥rsi°í˚_ªgi°î_°rög
("end-arrow-type", "Filled Concave");

1571 
¨row
.
ty≥
 = 
	`¨row_ty≥_‰om_«me
(
¨row_«me
);

1572 
	`g_‰ì
(
¨row_«me
);

1573 
	`dü_¨row_choo£r_£t_¨row
(
	`DIA_ARROW_CHOOSER
(
choo£r
), &
¨row
);

1574 
	`©åibuãs_£t_deÁu…_íd_¨row
(
¨row
);

1576 
	`gtk_wøp_box_∑ck
(
	`GTK_WRAP_BOX
(
∑ª¡
), 
choo£r
, 
FALSE
, 
TRUE
, FALSE, TRUE);

1577 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
choo£r
, 
	`_
("Aºow styÀáàthêíd o‡√wÜöes. ClickÅÿpická¿¨row, o∏£à¨rowÖ¨amëî†wôh Dëaûs..."), 
NULL
);

1578 
	`gtk_widgë_show
(
choo£r
);

1579 
	}
}

1582 
	$toﬁbox_de°roy
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

1584 
	`≠p_exô
();

1585 
	}
}

1587 
gboﬁón


1588 
	$toﬁbox_dñëe
 (
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
, 
gpoöãr
 
d©a
)

1590 i‡(!
	`≠p_is_embedded
()) {

1591 
gul⁄g
 
h™dÀrid
;

1593 
h™dÀrid
 = 
	`g_sig«l_h™dÀr_föd
(
widgë
, 
G_SIGNAL_MATCH_FUNC
,

1594 0, 0, 
NULL
, 
toﬁbox_de°roy
, NULL);

1595 i‡(
h™dÀrid
 != 0)

1596 
	`g_sig«l_h™dÀr_disc⁄√˘
 (
	`GTK_OBJECT
 (
widgë
), 
h™dÀrid
);

1599  (!
	`≠p_exô
());

1601  
FALSE
;

1602 
	}
}

1605 
	$≠p_£t_ic⁄
 (
GtkWödow
 *
wödow
)

1607 
	`gtk_wödow_£t_ic⁄_«me
 (
wödow
, "dia");

1608 i‡(!
	`gtk_wödow_gë_ic⁄
 (
wödow
)) {

1609 
GdkPixbuf
 *
pixbuf
 = 
	`gdk_pixbuf_√w_‰om_ölöe
 (-1, 
dü_≠p_ic⁄
, 
FALSE
, 
NULL
);

1610 i‡(
pixbuf
) {

1611 
	`gtk_wödow_£t_ic⁄
 (
wödow
, 
pixbuf
);

1612 
	`g_obje˘_uƒef
 (
pixbuf
);

1615 
	}
}

1621 
	$¸óã_öãgøãd_ui
 ()

1623 
GtkWidgë
 *
wödow
;

1624 
GtkWidgë
 *
maö_vbox
;

1625 
GtkWidgë
 *
hbox
;

1626 
GtkWidgë
 *
wøpbox
;

1627 
GtkWidgë
 *
míub¨
;

1628 
GtkWidgë
 *
toﬁb¨
;

1629 
GtkWidgë
 *
nŸebook
;

1630 
GtkWidgë
 *
°©usb¨
;

1631 
GtkAc˚lGroup
 *
ac˚l_group
;

1632 
GdkPixbuf
 *
pixbuf
;

1634 
GtkWidgë
 *
œyî_võw
;

1636 #ifde‡
GNOME


1637 
wödow
 = 
	`gnome_≠p_√w
 ("Dü", 
	`_
("Diagram Editor"));

1639 
wödow
 = 
	`gtk_wödow_√w
 (
GTK_WINDOW_TOPLEVEL
);

1640 
	`gtk_widgë_ªf
 (
wödow
);

1641 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
wödow
), "Dü v" 
VERSION
);

1646 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
wödow
), 
DIA_MAIN_WINDOW
);

1648 
	`gtk_wödow_£t_deÁu…_size
 (
	`GTK_WINDOW
 (
wödow
), 146, 349);

1650 
	`≠p_£t_ic⁄
 (
	`GTK_WINDOW
 (
wödow
));

1652 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
wödow
), "delete_event",

1653 
	`G_CALLBACK
 (
toﬁbox_dñëe
),

1654 
wödow
);

1656 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
wödow
), "destroy",

1657 
	`G_CALLBACK
 (
toﬁbox_de°roy
),

1658 
wödow
);

1660 
maö_vbox
 = 
	`gtk_vbox_√w
 (
FALSE
, 1);

1661 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
maö_vbox
), 1);

1662 #ifde‡
GNOME


1663 
	`gnome_≠p_£t_c⁄ã¡s
 (
	`GNOME_APP
(
wödow
), 
maö_vbox
);

1665 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
wödow
), 
maö_vbox
);

1667 
	`gtk_widgë_show
 (
maö_vbox
);

1670 
°©usb¨
 = 
	`gtk_°©usb¨_√w
 ();

1671 
	`gtk_box_∑ck_íd
 (
	`GTK_BOX
 (
maö_vbox
), 
°©usb¨
, 
FALSE
, 
TRUE
, 0);

1673 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 0);

1674 
	`gtk_box_∑ck_íd
 (
	`GTK_BOX
 (
maö_vbox
), 
hbox
, 
TRUE
, TRUE, 0);

1675 
	`gtk_widgë_show
 (
hbox
);

1678 
œyî_võw
 = 
	`¸óã_œyî_võw_widgë
 ();

1679 
	`gtk_box_∑ck_íd
 (
	`GTK_BOX
 (
hbox
), 
œyî_võw
, 
FALSE
, FALSE, 0);

1682 
nŸebook
 = 
	`gtk_nŸebook_√w
 ();

1683 
	`gtk_box_∑ck_íd
 (
	`GTK_BOX
 (
hbox
), 
nŸebook
, 
TRUE
, TRUE, 0);

1684 
	`gtk_nŸebook_£t_s¸ﬁœbÀ
 (
	`GTK_NOTEBOOK
 (
nŸebook
), 
TRUE
);

1685 
	`gtk_widgë_show
 (
nŸebook
);

1688 
toﬁ_tùs
 = 
	`gtk_toﬁtùs_√w
 ();

1690 
wøpbox
 = 
	`gtk_hwøp_box_√w
(
FALSE
);

1691 
	`gtk_wøp_box_£t_a•e˘_øtio
(
	`GTK_WRAP_BOX
(
wøpbox
), 144.0 / 318.0);

1692 
	`gtk_wøp_box_£t_ju°ify
(
	`GTK_WRAP_BOX
(
wøpbox
), 
GTK_JUSTIFY_TOP
);

1693 
	`gtk_wøp_box_£t_löe_ju°ify
(
	`GTK_WRAP_BOX
(
wøpbox
), 
GTK_JUSTIFY_LEFT
);

1696 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
wøpbox
, 
FALSE
, 
TRUE
, 0);

1697 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
wøpbox
), 0);

1698 
	`gtk_widgë_show
 (
wøpbox
);

1700 
	`¸óã_toﬁs
 (
wøpbox
);

1701 
	`¸óã_shìts
 (
wøpbox
);

1702 
	`¸óã_cﬁ‹_¨ó
 (
wøpbox
);

1703 
	`¸óã_löïr›s_¨ó
 (
wøpbox
);

1706 
	`gtk_døg_de°_£t
 (
wøpbox
,

1707 
GTK_DEST_DEFAULT_ALL
,

1708 
toﬁbox_èrgë_èbÀ
, 
toﬁbox_n_èrgës
,

1709 
GDK_ACTION_COPY
);

1710 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
wøpbox
), "drag_data_received",

1711 
	`G_CALLBACK
 (
dü_dnd_fûe_døg_d©a_ª˚ived
),

1712 
NULL
);

1716 
	`míus_gë_öãgøãd_ui_míub¨
(&
míub¨
, &
toﬁb¨
, &
ac˚l_group
);

1717 
	`gtk_wödow_add_ac˚l_group
 (
	`GTK_WINDOW
 (
wödow
), 
ac˚l_group
);

1718 #ifde‡
GNOME


1719 
	`gnome_≠p_£t_míus
 (
	`GNOME_APP
 (
wödow
), 
	`GTK_MENU_BAR
 (
míub¨
));

1721 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
maö_vbox
), 
míub¨
, 
FALSE
, 
TRUE
, 0);

1722 
	`gtk_widgë_show
 (
míub¨
);

1727 
	`gtk_toﬁb¨_£t_°yÀ
 (
	`GTK_TOOLBAR
 (
toﬁb¨
), 
GTK_TOOLBAR_ICONS
);

1728 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
maö_vbox
), 
toﬁb¨
, 
FALSE
, 
TRUE
, 0);

1729 
	`gtk_widgë_show
 (
toﬁb¨
);

1731 
	`≥rsi°í˚_ªgi°î_wödow
(
	`GTK_WINDOW
(
wödow
));

1733 
ui
.
maö_wödow
 = 
	`GTK_WINDOW
 (
wödow
);

1734 
ui
.
toﬁb¨
 = 
	`GTK_TOOLBAR
 (toolbar);

1735 
ui
.
dügøm_nŸebook
 = 
	`GTK_NOTEBOOK
 (
nŸebook
);

1736 
ui
.
°©usb¨
 = 
	`GTK_STATUSBAR
 (statusbar);

1737 
ui
.
œyî_võw
 =Üayer_view;

1741 
	`öãgøãd_ui_maö_toﬁb¨_show
 ();

1742 
	`öãgøãd_ui_maö_°©usb¨_show
 ();

1745 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
ui
.
maö_wödow
), 
DIA_MAIN_NOTEBOOK
, 
nŸebook
);

1748 
toﬁbox_shñl
 = 
wödow
;

1749 
	}
}

1755 
	$¸óã_toﬁbox
 ()

1757 
GtkWidgë
 *
wödow
;

1758 
GtkWidgë
 *
maö_vbox
;

1759 
GtkWidgë
 *
wøpbox
;

1760 
GtkWidgë
 *
míub¨
;

1761 
GtkAc˚lGroup
 *
ac˚l_group
;

1763 #ifde‡
GNOME


1764 
wödow
 = 
	`gnome_≠p_√w
 ("Dü", 
	`_
("Diagram Editor"));

1766 
wödow
 = 
	`gtk_wödow_√w
 (
GTK_WINDOW_TOPLEVEL
);

1767 
	`gtk_widgë_ªf
 (
wödow
);

1768 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
wödow
), "Dü v" 
VERSION
);

1770 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
wödow
), "toolbox_window");

1771 
	`gtk_wödow_£t_deÁu…_size
(
	`GTK_WINDOW
(
wödow
), 146, 349);

1773 
	`≠p_£t_ic⁄
 (
	`GTK_WINDOW
 (
wödow
));

1774 i‡(!
	`gtk_wödow_gë_ic⁄
 (
	`GTK_WINDOW
 (
wödow
))) {

1775 
GdkPixbuf
 *
pixbuf
 = 
	`gdk_pixbuf_√w_‰om_ölöe
 (-1, 
dü_≠p_ic⁄
, 
FALSE
, 
NULL
);

1776 i‡(
pixbuf
) {

1777 
	`gtk_wödow_£t_ic⁄
 (
	`GTK_WINDOW
 (
wödow
), 
pixbuf
);

1778 
	`g_obje˘_uƒef
 (
pixbuf
);

1782 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
wödow
), "delete_event",

1783 
	`G_CALLBACK
 (
toﬁbox_dñëe
),

1784 
wödow
);

1786 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
wödow
), "destroy",

1787 
	`G_CALLBACK
 (
toﬁbox_de°roy
),

1788 
wödow
);

1790 
maö_vbox
 = 
	`gtk_vbox_√w
 (
FALSE
, 1);

1791 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
maö_vbox
), 1);

1792 #ifde‡
GNOME


1793 
	`gnome_≠p_£t_c⁄ã¡s
(
	`GNOME_APP
(
wödow
), 
maö_vbox
);

1795 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
wödow
), 
maö_vbox
);

1797 
	`gtk_widgë_show
 (
maö_vbox
);

1800 
toﬁ_tùs
 = 
	`gtk_toﬁtùs_√w
 ();

1806 
wøpbox
 = 
	`gtk_hwøp_box_√w
(
FALSE
);

1807 
	`gtk_wøp_box_£t_a•e˘_øtio
(
	`GTK_WRAP_BOX
(
wøpbox
), 144.0 / 318.0);

1808 
	`gtk_wøp_box_£t_ju°ify
(
	`GTK_WRAP_BOX
(
wøpbox
), 
GTK_JUSTIFY_TOP
);

1809 
	`gtk_wøp_box_£t_löe_ju°ify
(
	`GTK_WRAP_BOX
(
wøpbox
), 
GTK_JUSTIFY_LEFT
);

1813 
	`gtk_box_∑ck_íd
 (
	`GTK_BOX
 (
maö_vbox
), 
wøpbox
, 
TRUE
, TRUE, 0);

1814 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
wøpbox
), 0);

1815 
	`gtk_widgë_show
 (
wøpbox
);

1817 
	`¸óã_toﬁs
 (
wøpbox
);

1818 
	`¸óã_shìts
 (
wøpbox
);

1819 
	`¸óã_cﬁ‹_¨ó
 (
wøpbox
);

1820 
	`¸óã_löïr›s_¨ó
 (
wøpbox
);

1823 
	`gtk_døg_de°_£t
 (
wøpbox
,

1824 
GTK_DEST_DEFAULT_ALL
,

1825 
toﬁbox_èrgë_èbÀ
, 
toﬁbox_n_èrgës
,

1826 
GDK_ACTION_COPY
);

1827 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
wøpbox
), "drag_data_received",

1828 
	`G_CALLBACK
 (
dü_dnd_fûe_døg_d©a_ª˚ived
),

1829 
NULL
);

1833 
	`míus_gë_toﬁbox_míub¨
(&
míub¨
, &
ac˚l_group
);

1834 
	`gtk_wödow_add_ac˚l_group
 (
	`GTK_WINDOW
 (
wödow
), 
ac˚l_group
);

1835 #ifde‡
GNOME


1836 
	`gnome_≠p_£t_míus
(
	`GNOME_APP
(
wödow
), 
	`GTK_MENU_BAR
(
míub¨
));

1838 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
maö_vbox
), 
míub¨
, 
FALSE
, 
TRUE
, 0);

1839 
	`gtk_widgë_show
 (
míub¨
);

1841 
	`≥rsi°í˚_ªgi°î_wödow
(
	`GTK_WINDOW
(
wödow
));

1843 
toﬁbox_shñl
 = 
wödow
;

1844 
	}
}

1847 
	$toﬁbox_show
()

1849 
	`gtk_widgë_show
(
toﬁbox_shñl
);

1850 
	}
}

1853 
	$toﬁbox_hide
()

1855 
	`gtk_widgë_hide
(
toﬁbox_shñl
);

1856 
	}
}

1859 
	$¸óã_åì_wödow
()

1861 
GtkA˘i⁄
 *
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 ("FileTree");

1862 
	`¸óã_dügøm_åì_wödow
(&
¥efs
.
dü_åì
, 
	`GTK_TOGGLE_ACTION
(
a˘i⁄
));

1863 
	}
}

1865 
GtkWidgë
 *

1866 
	$öãrÁ˚_gë_toﬁbox_shñl
()

1868 i‡(
	`is_öãgøãd_ui
 ())

1869  
	`GTK_WIDGET
(
ui
.
maö_wödow
);

1871  
toﬁbox_shñl
;

1872 
	}
}

1877 
gboﬁón
 
	$öãgøãd_ui_maö_toﬁb¨_is_showög
 ()

1879 i‡(
ui
.
toﬁb¨
)

1881  
	`GTK_WIDGET_VISIBLE
 (
ui
.
toﬁb¨
)? 
TRUE
 : 
FALSE
;

1883  
FALSE
;

1884 
	}
}

1887 
	$öãgøãd_ui_maö_toﬁb¨_show
 ()

1889 i‡(
ui
.
toﬁb¨
)

1891 
GtkA˘i⁄
 *
a˘i⁄
 = 
NULL
;

1892 
	`gtk_widgë_show
 (
	`GTK_WIDGET
 (
ui
.
toﬁb¨
));

1893 
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 (
VIEW_MAIN_TOOLBAR_ACTION
);

1894 i‡(
a˘i⁄
)

1895 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
	`GTK_TOGGLE_ACTION
 (
a˘i⁄
), 
TRUE
);

1897 
	}
}

1900 
	$öãgøãd_ui_maö_toﬁb¨_hide
 ()

1902 i‡(
ui
.
toﬁb¨
)

1904 
GtkA˘i⁄
 *
a˘i⁄
 = 
NULL
;

1905 
	`gtk_widgë_hide
 (
	`GTK_WIDGET
 (
ui
.
toﬁb¨
));

1906 
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 (
VIEW_MAIN_TOOLBAR_ACTION
);

1907 i‡(
a˘i⁄
)

1908 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
	`GTK_TOGGLE_ACTION
 (
a˘i⁄
), 
FALSE
);

1910 
	}
}

1915 
gboﬁón
 
	$öãgøãd_ui_œyî_võw_is_showög
 ()

1917 i‡(
ui
.
œyî_võw
)

1919  
	`GTK_WIDGET_VISIBLE
 (
ui
.
œyî_võw
)? 
TRUE
 : 
FALSE
;

1921  
FALSE
;

1922 
	}
}

1924 
	$öãgøãd_ui_œyî_võw_show
 ()

1926 i‡(
ui
.
œyî_võw
)

1928 
GtkA˘i⁄
 *
a˘i⁄
 = 
NULL
;

1929 
	`gtk_widgë_show
 (
ui
.
œyî_võw
);

1930 
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 (
VIEW_LAYERS_ACTION
);

1931 i‡(
a˘i⁄
)

1933 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
	`GTK_TOGGLE_ACTION
 (
a˘i⁄
), 
TRUE
);

1936 
	}
}

1938 
	$öãgøãd_ui_œyî_võw_hide
 ()

1940 i‡(
ui
.
œyî_võw
)

1942 
GtkA˘i⁄
 *
a˘i⁄
 = 
NULL
;

1943 
	`gtk_widgë_hide
 (
ui
.
œyî_võw
);

1944 
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 (
VIEW_LAYERS_ACTION
);

1945 i‡(
a˘i⁄
)

1947 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
	`GTK_TOGGLE_ACTION
 (
a˘i⁄
), 
FALSE
);

1950 
	}
}

1955 
gboﬁón
 
	$öãgøãd_ui_maö_°©usb¨_is_showög
 ()

1957 i‡(
ui
.
°©usb¨
)

1959  
	`GTK_WIDGET_VISIBLE
 (
ui
.
°©usb¨
)? 
TRUE
 : 
FALSE
;

1961  
FALSE
;

1962 
	}
}

1965 
	$öãgøãd_ui_maö_°©usb¨_show
 ()

1967 i‡(
ui
.
°©usb¨
)

1969 
GtkA˘i⁄
 *
a˘i⁄
 = 
NULL
;

1970 
	`gtk_widgë_show
 (
	`GTK_WIDGET
 (
ui
.
°©usb¨
));

1971 
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 (
VIEW_MAIN_STATUSBAR_ACTION
);

1972 i‡(
a˘i⁄
)

1973 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
	`GTK_TOGGLE_ACTION
 (
a˘i⁄
), 
TRUE
);

1975 
	}
}

1978 
	$öãgøãd_ui_maö_°©usb¨_hide
 ()

1980 i‡(
ui
.
°©usb¨
)

1982 
GtkA˘i⁄
 *
a˘i⁄
 = 
NULL
;

1983 
	`gtk_widgë_hide
 (
	`GTK_WIDGET
 (
ui
.
°©usb¨
));

1984 
a˘i⁄
 = 
	`míus_gë_a˘i⁄
 (
VIEW_MAIN_STATUSBAR_ACTION
);

1985 i‡(
a˘i⁄
)

1986 
	`gtk_toggÀ_a˘i⁄_£t_a˘ive
 (
	`GTK_TOGGLE_ACTION
 (
a˘i⁄
), 
FALSE
);

1988 
	}
}

	@O:\tool\dvs50\app\interface.h

18 #i‚de‡
INTERFACE_H


19 
	#INTERFACE_H


	)

21 
	~"di•œy.h
"

23 
	~"míus.h
"

24 
	~"di•_ˇŒbacks.h
"

25 
	~"toﬁ.h
"

26 
	~"shìt.h
"

27 
	~"≠p_¥ocs.h
"

28 
	~"¨rows.h
"

29 
	~"cﬁ‹_¨ó.h
"

30 
	~"löewidth_¨ó.h
"

31 
	~"©åibuãs.h
"

34 
	#DIA_MAIN_WINDOW
 "dü-maö-wödow"

	)

35 
	#DIA_MAIN_NOTEBOOK
 "dü-maö-nŸebook"

	)

38 
	#DIA_TOOLBOX
 "dü-toﬁbox"

	)

40 
¸óã_öãgøãd_ui
 ();

42 
gboﬁón
 
öãgøãd_ui_maö_toﬁb¨_is_showög
 ();

43 
öãgøãd_ui_maö_toﬁb¨_show
 ();

44 
öãgøãd_ui_maö_toﬁb¨_hide
 ();

46 
gboﬁón
 
öãgøãd_ui_maö_°©usb¨_is_showög
 ();

47 
öãgøãd_ui_maö_°©usb¨_show
 ();

48 
öãgøãd_ui_maö_°©usb¨_hide
 ();

50 
gboﬁón
 
öãgøãd_ui_œyî_võw_is_showög
 ();

51 
öãgøãd_ui_œyî_võw_show
 ();

52 
öãgøãd_ui_œyî_võw_hide
 ();

54 
is_öãgøãd_ui
 ();

56 
¸óã_di•œy_shñl
(
DDi•œy
 *
ddi•
,

57 
width
, 
height
,

58 *
tôÀ
, 
u£_mb¨
, 
t›_Àvñ_wödow
);

60 
¸óã_toﬁbox
 ();

61 
	$__de˛•ec
(
dŒexp‹t
Ë
	`toﬁbox_show
();

62 
	`toﬁbox_hide
();

64 
GtkWidgë
 *
	`öãrÁ˚_gë_toﬁbox_shñl
();

66 
	`toﬁ_£À˘_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
);

67 
	`¸óã_öãgøãd_ui
 ();

68 
	`¸óã_åì_wödow
();

70 
	`¸óã_shìts
(
GtkWidgë
 *
∑ª¡
);

71 
GtkWidgë
 *
modify_toﬁ_buâ⁄
;

73 
	`võw_zoom_£t
 (
zoom_Á˘‹
);

75 
_ToﬁBuâ⁄
 
	tToﬁBuâ⁄
;

77 
_ToﬁBuâ⁄D©a
 
	tToﬁBuâ⁄D©a
;

79 
	s_ToﬁBuâ⁄D©a


81 
ToﬁTy≥
 
ty≥
;

82 
gpoöãr
 
exåa_d©a
;

83 
gpoöãr
 
u£r_d©a
;

84 
GtkWidgë
 *
widgë
;

87 
	s_ToﬁBuâ⁄


89 
gch¨
 **
ic⁄_d©a
;

90 *
toﬁ_desc
;

91 *
toﬁ_ac˚Àøt‹
;

92 *
a˘i⁄_«me
;

93 
ToﬁBuâ⁄D©a
 
ˇŒback_d©a
;

96 c⁄° 
num_toﬁs
;

97 
ToﬁBuâ⁄
 
toﬁ_d©a
[];

98 
gch¨
 *
öãrÁ˚_cuºít_shìt_«me
;

100 
	`toﬁ_£À˘_upd©e
 (
GtkWidgë
 *
w
, 
gpoöãr
 
d©a
);

101 
	`fûl_shìt_míu
();

103 #i‚de‡
GTK_DISABLE_DEPRECATED


104 
GtkToﬁtùs
 *
toﬁ_tùs
;

107 
	`˛o£_nŸebook_∑ge_ˇŒback
 (
GtkBuâ⁄
 *
buâ⁄
, 
gpoöãr
 
u£r_d©a
);

	@O:\tool\dvs50\app\layer_dialog.c

25 #ifde‡
HAVE_CONFIG_H


26 
	~<c⁄fig.h
>

29 
	~<as£π.h
>

30 
	~<°rög.h
>

31 
	~<gdk/gdkkeysyms.h
>

32 #unde‡
GTK_DISABLE_DEPRECATED


33 
	~<gtk/gtk.h
>

35 
	~"öé.h
"

37 
	~"œyî_dülog.h
"

38 
	~"≥rsi°í˚.h
"

39 
	~"widgës.h
"

40 
	~"öãrÁ˚.h
"

42 
	~"dü-≠p-ic⁄s.h
"

45 
	#DIA_LAYER_WIDGET
(
obj
) \

46 
	`GTK_CHECK_CAST
 (
obj
, 
	`dü_œyî_widgë_gë_ty≥
 (), 
DüLayîWidgë
)

	)

47 
	#DIA_LAYER_WIDGET_CLASS
(
kœss
) \

48 
	`GTK_CHECK_CLASS_CAST
 (
kœss
, 
	`dü_œyî_widgë_gë_ty≥
 (), 
DüLayîWidgëCœss
)

	)

49 
	#IS_DIA_LAYER_WIDGET
(
obj
) \

50 
	`GTK_CHECK_TYPE
 (
obj
, 
	`dü_œyî_widgë_gë_ty≥
 ())

	)

52 
_DüLayîWidgëCœss
 
	tDüLayîWidgëCœss
;

53 
_EdôLayîDülog
 
	tEdôLayîDülog
;

55 
	s_DüLayîWidgë


57 
GtkLi°Iãm
 
	mli°_ôem
;

59 
Dügøm
 *
	mdü
;

60 
Layî
 *
	mœyî
;

62 
GtkWidgë
 *
	mvisibÀ
;

63 
GtkWidgë
 *
	mc⁄√˘abÀ
;

64 
GtkWidgë
 *
	mœbñ
;

66 
EdôLayîDülog
 *
	medô_dülog
;

71 
gboﬁón
 
	mc⁄√˘_⁄
;

75 
gboﬁón
 
	mc⁄√˘_off
;

78 
	s_EdôLayîDülog


80 
GtkWidgë
 *
	mdülog
;

81 
GtkWidgë
 *
	m«me_íåy
;

82 
DüLayîWidgë
 *
	mœyî_widgë
;

86 
	s_DüLayîWidgëCœss


88 
GtkLi°IãmCœss
 
	m∑ª¡_˛ass
;

91 
GtkTy≥
 
dü_œyî_widgë_gë_ty≥
();

93 
	sLayîDülog


95 
GtkWidgë
 *
	mdülog
;

96 
GtkWidgë
 *
	mdügøm_omíu
;

98 
GtkWidgë
 *
	mœyî_li°
;

100 
Dügøm
 *
	mdügøm
;

103 
LayîDülog
 *
	gœyî_dülog
 = 
NULL
;

105 
_Buâ⁄D©a
 
	tBuâ⁄D©a
;

107 
	s_Buâ⁄D©a


109 
gch¨
 *
	m°ock_«me
;

110 
gpoöãr
 
	mˇŒback
;

111 *
	mtoﬁtù
;

114 
	eLayîCh™geTy≥


116 
	mTYPE_DELETE_LAYER
,

117 
	mTYPE_ADD_LAYER
,

118 
	mTYPE_RAISE_LAYER
,

119 
	mTYPE_LOWER_LAYER
,

122 
	sLayîCh™ge


124 
Ch™ge
 
	mch™ge
;

126 
LayîCh™geTy≥
 
	mty≥
;

127 
Layî
 *
	mœyî
;

128 
	mödex
;

129 
	m≠∂õd
;

132 
	sLayîVisibûôyCh™ge


134 
Ch™ge
 
	mch™ge
;

136 
GLi°
 *
	m‹igöÆ_visibûôy
;

137 
Layî
 *
	mœyî
;

138 
gboﬁón
 
	mis_ex˛usive
;

139 
	m≠∂õd
;

148 
gboﬁón
 
	göã∫Æ_ˇŒ
 = 
FALSE
;

150 
Ch™ge
 *

151 
undo_œyî
(
Dügøm
 *
dü
, 
Layî
 *
œyî
, 
LayîCh™geTy≥
, 
ödex
);

152 
LayîVisibûôyCh™ge
 *

153 
undo_œyî_visibûôy
(
Dügøm
 *
dü
, 
Layî
 *
œyî
, 
gboﬁón
 
ex˛usive
);

155 
œyî_visibûôy_ch™ge_≠∂y
(
LayîVisibûôyCh™ge
 *
ch™ge
,

156 
Dügøm
 *
dü
);

158 
œyî_dülog_√w_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
gd©a
);

159 
œyî_dülog_øi£_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
gd©a
);

160 
œyî_dülog_lowî_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
gd©a
);

161 
œyî_dülog_dñëe_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
gd©a
);

162 
œyî_dülog_edô_œyî
(
DüLayîWidgë
 *
œyî_widgë
, 
Dügøm
 *
dü
, 
Layî
 *
œyî
);

164 
Buâ⁄D©a
 
	gbuâ⁄s
[] =

166 { 
GTK_STOCK_ADD
, 
œyî_dülog_√w_ˇŒback
, 
N_
("New Layer") },

167 { 
GTK_STOCK_GO_UP
, 
œyî_dülog_øi£_ˇŒback
, 
N_
("Raise Layer") },

168 { 
GTK_STOCK_GO_DOWN
, 
œyî_dülog_lowî_ˇŒback
, 
N_
("Lower Layer") },

169 { 
GTK_STOCK_DELETE
, 
œyî_dülog_dñëe_ˇŒback
, 
N_
("Delete Layer") },

174 
	mBUTTON_NEW
 = 0,

175 
	mBUTTON_RAISE
,

176 
	mBUTTON_LOWER
,

177 
	mBUTTON_DELETE


180 
	#BUTTON_EVENT_MASK
 
GDK_EXPOSURE_MASK
 | 
GDK_ENTER_NOTIFY_MASK
 | 
GDK_LEAVE_NOTIFY_MASK
 | \

181 
GDK_BUTTON_PRESS_MASK
 | 
GDK_BUTTON_RELEASE_MASK


	)

183 
	gnum_buâ⁄s
 = (
buâ⁄s
)/(
Buâ⁄D©a
);

185 
	#NORMAL
 0

	)

186 
	#SELECTED
 1

	)

187 
	#INSENSITIVE
 2

	)

189 
GtkWidgë
 *

190 
	$¸óã_buâ⁄_box
(
GtkWidgë
 *
∑ª¡
, 
gboﬁón
 
show_œbñs
)

192 
GtkWidgë
 *
buâ⁄
;

193 
GtkWidgë
 *
buâ⁄_box
;

194 
i
;

196 
buâ⁄_box
 = 
	`gtk_hbox_√w
 (
TRUE
, 1);

198 
i
=0; i<
num_buâ⁄s
; i++)

200 i‡(
show_œbñs
 =
TRUE
)

202 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
buâ⁄s
[
i
].
°ock_«me
);

206 
GtkWidgë
 * 
image
;

208 
buâ⁄
 = 
	`gtk_buâ⁄_√w
 ();

210 
image
 = 
	`gtk_image_√w_‰om_°ock
 (
buâ⁄s
[
i
].
°ock_«me
,

211 
GTK_ICON_SIZE_BUTTON
);

213 
	`gtk_buâ⁄_£t_image
 (
	`GTK_BUTTON
 (
buâ⁄
), 
image
);

216 
	`g_sig«l_c⁄√˘_sw≠≥d
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

217 
	`G_CALLBACK
(
buâ⁄s
[
i
].
ˇŒback
),

218 
	`GTK_OBJECT
 (
∑ª¡
));

220 i‡(
toﬁ_tùs
 !
NULL
)

221 
	`gtk_toﬁtùs_£t_tù
 (
toﬁ_tùs
, 
buâ⁄
, 
	`gëãxt
(
buâ⁄s
[
i
].
toﬁtù
), 
NULL
);

223 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
(
buâ⁄_box
), 
buâ⁄
, 
TRUE
, TRUE, 0);

225 
	`gtk_widgë_show
 (
buâ⁄
);

228  
buâ⁄_box
;

229 
	}
}

231 
göt


232 
	$œyî_li°_evíts
 (
GtkWidgë
 *
widgë
,

233 
GdkEvít
 *
evít
)

235 
GdkEvítKey
 *
kevít
;

236 
GdkEvítBuâ⁄
 *
bevít
;

237 
GtkWidgë
 *
evít_widgë
;

238 
DüLayîWidgë
 *
œyî_widgë
;

240 
evít_widgë
 = 
	`gtk_gë_evít_widgë
 (
evít
);

242 i‡(
	`GTK_IS_LIST_ITEM
 (
evít_widgë
))

244 
œyî_widgë
 = 
	`DIA_LAYER_WIDGET
(
evít_widgë
);

246 
evít
->
ty≥
)

248 
GDK_BUTTON_PRESS
:

249 
bevít
 = (
GdkEvítBuâ⁄
 *Ë
evít
;

252 
GDK_2BUTTON_PRESS
:

253 
bevít
 = (
GdkEvítBuâ⁄
 *Ë
evít
;

254 
	`œyî_dülog_edô_œyî
(
œyî_widgë
, 
NULL
, NULL);

255  
TRUE
;

257 
GDK_KEY_PRESS
:

258 
kevít
 = (
GdkEvítKey
 *Ë
evít
;

259 
kevít
->
keyvÆ
)

261 
GDK_Up
:

264 
GDK_Down
:

268  
FALSE
;

270  
TRUE
;

277  
FALSE
;

278 
	}
}

280 
gboﬁón


281 
	$œyî_dülog_dñëe
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

283 
	`gtk_widgë_hide
(
widgë
);

285  
TRUE
;

286 
	}
}

289 
	$œyî_võw_hide_buâ⁄_˛icked
 (* 
nŸ_u£d
)

291 
	`öãgøãd_ui_œyî_võw_hide
 ();

292 
	}
}

294 
GtkWidgë
 * 
	$¸óã_œyî_võw_widgë
 ()

296 
GtkWidgë
 *
vbox
;

297 
GtkWidgë
 *
hbox
;

298 
GtkWidgë
 *
œbñ
;

299 
GtkWidgë
 *
hide_buâ⁄
;

300 
GtkRcStyÀ
 *
rc°yÀ
;

301 
GtkWidgë
 *
image
;

302 
GtkWidgë
 *
li°
;

303 
GtkWidgë
 *
£∑øt‹
;

304 
GtkWidgë
 *
s¸ﬁÀd_wö
;

305 
GtkWidgë
 *
buâ⁄_box
;

310 
œyî_dülog
 = 
	`g_√w
 (
LayîDülog
, 1);

312 
œyî_dülog
->
dügøm
 = 
NULL
;

314 
œyî_dülog
->
dülog
 = 
vbox
 = 
	`gtk_vbox_√w
 (
FALSE
, 1);

316 
hbox
 = 
	`gtk_hbox_√w
 (
FALSE
, 1);

318 
œbñ
 = 
	`gtk_œbñ_√w
 (
	`_
 ("Layers:"));

319 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
œbñ
, 
FALSE
, FALSE, 2);

320 
	`gtk_widgë_show
 (
œbñ
);

322 
œyî_dülog
->
dügøm_omíu
 = 
NULL
;

325 
hide_buâ⁄
 = 
	`gtk_buâ⁄_√w
 ();

326 
	`gtk_buâ⁄_£t_ªlõf
 (
	`GTK_BUTTON
 (
hide_buâ⁄
), 
GTK_RELIEF_NONE
);

327 
	`gtk_buâ⁄_£t_focus_⁄_˛ick
 (
	`GTK_BUTTON
 (
hide_buâ⁄
), 
FALSE
);

330 
rc°yÀ
 = 
	`gtk_rc_°yÀ_√w
 ();

331 
rc°yÀ
->
xthick√ss
 =Ñc°yÀ->
ythick√ss
 = 0;

332 
	`gtk_widgë_modify_°yÀ
 (
hide_buâ⁄
, 
rc°yÀ
);

333 
	`gtk_rc_°yÀ_uƒef
 (
rc°yÀ
);

335 
image
 = 
	`gtk_image_√w_‰om_°ock
 (
GTK_STOCK_CLOSE
,

336 
GTK_ICON_SIZE_MENU
);

338 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
(
hide_buâ⁄
), 
image
);

339 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
hide_buâ⁄
), "clicked",

340 
	`GTK_SIGNAL_FUNC
 (
œyî_võw_hide_buâ⁄_˛icked
), 
NULL
);

342 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
hide_buâ⁄
, 
FALSE
, FALSE, 2);

344 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
(
vbox
), 
hbox
, 
FALSE
, FALSE, 2);

345 
	`gtk_widgë_show_Æl
 (
hbox
);

347 
buâ⁄_box
 = 
	`¸óã_buâ⁄_box
(
vbox
, 
FALSE
);

349 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
buâ⁄_box
, 
FALSE
, FALSE, 2);

350 
	`gtk_widgë_show
 (
buâ⁄_box
);

352 
£∑øt‹
 = 
	`gtk_h£∑øt‹_√w
();

353 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
vbox
), 
£∑øt‹
, 
FALSE
, FALSE, 2);

354 
	`gtk_widgë_show
 (
£∑øt‹
);

356 
s¸ﬁÀd_wö
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

357 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
),

358 
GTK_POLICY_AUTOMATIC
,

359 
GTK_POLICY_AUTOMATIC
);

360 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
s¸ﬁÀd_wö
, 
TRUE
, TRUE, 2);

362 
œyî_dülog
->
œyî_li°
 = 
li°
 = 
	`gtk_li°_√w
();

364 
	`gtk_li°_£t_£À˘i⁄_mode
 (
	`GTK_LIST
 (
li°
), 
GTK_SELECTION_BROWSE
);

365 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
), 
li°
);

366 
	`gtk_c⁄èöî_£t_focus_vadju°mít
 (
	`GTK_CONTAINER
 (
li°
),

367 
	`gtk_s¸ﬁÀd_wödow_gë_vadju°mít
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
)));

368 
	`gtk_widgë_show
 (
s¸ﬁÀd_wö
);

369 
	`gtk_widgë_show
 (
li°
);

371 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°
), "event",

372 (
GtkSig«lFunc
Ë
œyî_li°_evíts
,

373 
NULL
);

375  
vbox
;

376 
	}
}

379 
	$¸óã_œyî_dülog
()

381 
GtkWidgë
 *
dülog
;

382 
GtkWidgë
 *
vbox
;

383 
GtkWidgë
 *
hbox
;

384 
GtkWidgë
 *
œbñ
;

385 
GtkWidgë
 *
omíu
;

386 
GtkWidgë
 *
míu
;

387 
GtkWidgë
 *
li°
;

388 
GtkWidgë
 *
£∑øt‹
;

389 
GtkWidgë
 *
s¸ﬁÀd_wö
;

390 
GtkWidgë
 *
buâ⁄_box
;

391 
GtkWidgë
 *
buâ⁄
;

393 
œyî_dülog
 = 
	`g_√w
(
LayîDülog
, 1);

395 
œyî_dülog
->
dügøm
 = 
NULL
;

397 
œyî_dülog
->
dülog
 = dülog = 
	`gtk_dülog_√w
 ();

398 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
dülog
), 
	`_
("Layers"));

399 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
dülog
), "layer_window");

400 
	`gtk_wödow_£t_ªsizabÀ
 (
	`GTK_WINDOW
 (
dülog
), 
TRUE
);

402 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
dülog
), "delete_event",

403 
	`G_CALLBACK
(
œyî_dülog_dñëe
), 
NULL
);

404 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
dülog
), "destroy",

405 
	`G_CALLBACK
(
gtk_widgë_de°royed
),

406 &(
œyî_dülog
->
dülog
));

408 
vbox
 = 
	`GTK_DIALOG
(
dülog
)->vbox;

410 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 1);

412 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Diagram:"));

413 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
hbox
), 
œbñ
, 
FALSE
, FALSE, 2);

414 
	`gtk_widgë_show
 (
œbñ
);

416 
œyî_dülog
->
dügøm_omíu
 = 
omíu
 = 
	`gtk_›ti⁄_míu_√w
();

417 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
hbox
), 
omíu
, 
TRUE
, TRUE, 2);

418 
	`gtk_widgë_show
 (
omíu
);

420 
míu
 = 
	`gtk_míu_√w
();

421 
	`gtk_›ti⁄_míu_£t_míu
(
	`GTK_OPTION_MENU
(
omíu
), 
míu
);

423 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
vbox
), 
hbox
, 
FALSE
, FALSE, 2);

424 
	`gtk_widgë_show
 (
hbox
);

426 
£∑øt‹
 = 
	`gtk_h£∑øt‹_√w
();

427 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
vbox
), 
£∑øt‹
, 
FALSE
, FALSE, 2);

428 
	`gtk_widgë_show
 (
£∑øt‹
);

430 
s¸ﬁÀd_wö
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

431 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
),

432 
GTK_POLICY_AUTOMATIC
,

433 
GTK_POLICY_AUTOMATIC
);

434 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
s¸ﬁÀd_wö
, 
TRUE
, TRUE, 2);

436 
œyî_dülog
->
œyî_li°
 = 
li°
 = 
	`gtk_li°_√w
();

438 
	`gtk_li°_£t_£À˘i⁄_mode
 (
	`GTK_LIST
 (
li°
), 
GTK_SELECTION_BROWSE
);

439 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
), 
li°
);

440 
	`gtk_c⁄èöî_£t_focus_vadju°mít
 (
	`GTK_CONTAINER
 (
li°
),

441 
	`gtk_s¸ﬁÀd_wödow_gë_vadju°mít
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
)));

442 
	`gtk_widgë_show
 (
s¸ﬁÀd_wö
);

443 
	`gtk_widgë_show
 (
li°
);

445 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°
), "event",

446 (
GtkSig«lFunc
Ë
œyî_li°_evíts
,

447 
NULL
);

449 
buâ⁄_box
 = 
	`¸óã_buâ⁄_box
(
dülog
, 
TRUE
);

451 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
buâ⁄_box
, 
FALSE
, FALSE, 2);

452 
	`gtk_widgë_show
 (
buâ⁄_box
);

454 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dülog
)->
a˘i⁄_¨ó
),

457 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_CLOSE
);

458 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
	`GTK_DIALOG
 (
dülog
)->
a˘i⁄_¨ó
),

459 
buâ⁄
, 
TRUE
, TRUE, 0);

460 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

461 
	`G_CALLBACK
(
gtk_widgë_hide
),

462 
	`GTK_OBJECT
(
dülog
));

464 
	`gtk_widgë_show
 (
buâ⁄
);

466 
	`≥rsi°í˚_ªgi°î_wödow
(
	`GTK_WINDOW
(
dülog
));

468 
	`œyî_dülog_upd©e_dügøm_li°
();

469 
	}
}

472 
	$dü_œyî_£À˘_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

474 
DüLayîWidgë
 *
lw
;

475 
lw
 = 
	`DIA_LAYER_WIDGET
(
widgë
);

479 i‡(
lw
->
dü
->
d©a
->
a˘ive_œyî
 !lw->
œyî
)

481 
	`dügøm_ªmove_Æl_£À˘ed
(
lw
->
dü
, 
TRUE
);

483 
	`dügøm_upd©e_exã¡s
(
lw
->
dü
);

484 
	`d©a_£t_a˘ive_œyî
(
lw
->
dü
->
d©a
,Üw->
œyî
);

485 
	`dügøm_add_upd©e_Æl
(
lw
->
dü
);

486 
	`dügøm_Êush
(
lw
->
dü
);

488 
öã∫Æ_ˇŒ
 = 
TRUE
;

489 i‡(
lw
->
c⁄√˘_off
)

491 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
lw
->
c⁄√˘abÀ
), 
FALSE
);

495 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
lw
->
c⁄√˘abÀ
), 
TRUE
);

497 
öã∫Æ_ˇŒ
 = 
FALSE
;

498 
	}
}

501 
	$dü_œyî_de£À˘_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

503 
DüLayîWidgë
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
widgë
);

506 i‡(
œyî_dülog
 =
NULL
 ||Üayî_dülog->
dügøm
 == NULL) ;

508 
öã∫Æ_ˇŒ
 = 
TRUE
;

510 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
lw
->
c⁄√˘abÀ
),

511 
lw
->
c⁄√˘_⁄
);

512 
öã∫Æ_ˇŒ
 = 
FALSE
;

513 
	}
}

517 
	$œyî_dülog_√w_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
gd©a
)

519 
Layî
 *
œyî
;

520 
Dügøm
 *
dü
;

521 
GtkWidgë
 *
£À˘ed
;

522 
GLi°
 *
li°
 = 
NULL
;

523 
GtkWidgë
 *
œyî_widgë
;

524 
pos
;

525 
√xt_œyî_num
 = 1;

527 
dü
 = 
œyî_dülog
->
dügøm
;

529 i‡(
dü
 !
NULL
)

531 
gch¨
* 
√w_œyî_«me
 = 
	`g_°rdup_¥ötf
(
	`_
("NewÜayer %d"),

532 
√xt_œyî_num
++);

533 
œyî
 = 
	`√w_œyî
(
√w_œyî_«me
, 
dü
->
d©a
);

535 
	`as£π
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
)->
£À˘i⁄
 !
NULL
);

536 
£À˘ed
 = 
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
)->
£À˘i⁄
->
d©a
;

537 
pos
 = 
	`gtk_li°_chûd_posôi⁄
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
£À˘ed
);

539 
	`d©a_add_œyî_©
(
dü
->
d©a
, 
œyî
, dü->d©a->
œyîs
->
Àn
 - 
pos
);

541 
	`dügøm_add_upd©e_Æl
(
dü
);

542 
	`dügøm_Êush
(
dü
);

544 
œyî_widgë
 = 
	`dü_œyî_widgë_√w
(
dü
, 
œyî
);

545 
	`gtk_widgë_show
(
œyî_widgë
);

547 
li°
 = 
	`g_li°_¥ïíd
÷i°, 
œyî_widgë
);

549 
	`gtk_li°_ö£π_ôems
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
li°
, 
pos
);

551 
	`gtk_li°_£À˘_ôem
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
pos
);

553 
	`undo_œyî
(
dü
, 
œyî
, 
TYPE_ADD_LAYER
, dü->
d©a
->
œyîs
->
Àn
 - 
pos
);

554 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

556 
	}
}

559 
	$œyî_dülog_dñëe_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
gd©a
)

561 
Dügøm
 *
dü
;

562 
GtkWidgë
 *
£À˘ed
;

563 
Layî
 *
œyî
;

564 
pos
;

566 
dü
 = 
œyî_dülog
->
dügøm
;

568 i‡((
dü
 !
NULL
Ë&& (dü->
d©a
->
œyîs
->
Àn
>1))

570 
	`as£π
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
)->
£À˘i⁄
 !
NULL
);

571 
£À˘ed
 = 
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
)->
£À˘i⁄
->
d©a
;

573 
œyî
 = 
dü
->
d©a
->
a˘ive_œyî
;

575 
	`d©a_dñëe_œyî
(
dü
->
d©a
, 
œyî
);

576 
	`dügøm_add_upd©e_Æl
(
dü
);

577 
	`dügøm_Êush
(
dü
);

579 
pos
 = 
	`gtk_li°_chûd_posôi⁄
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
£À˘ed
);

580 
	`gtk_c⁄èöî_ªmove
(
	`GTK_CONTAINER
(
œyî_dülog
->
œyî_li°
), 
£À˘ed
);

582 
	`undo_œyî
(
dü
, 
œyî
, 
TYPE_DELETE_LAYER
,

583 
dü
->
d©a
->
œyîs
->
Àn
 - 
pos
);

584 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

586 i‡(--
pos
<0)

587 
pos
 = 0;

589 
	`gtk_li°_£À˘_ôem
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
pos
);

591 
	}
}

594 
	$œyî_dülog_øi£_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
gd©a
)

596 
Layî
 *
œyî
;

597 
Dügøm
 *
dü
;

598 
GtkWidgë
 *
£À˘ed
;

599 
GLi°
 *
li°
 = 
NULL
;

600 
pos
;

602 
dü
 = 
œyî_dülog
->
dügøm
;

604 i‡((
dü
 !
NULL
Ë&& (dü->
d©a
->
œyîs
->
Àn
>1))

606 
	`as£π
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
)->
£À˘i⁄
 !
NULL
);

607 
£À˘ed
 = 
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
)->
£À˘i⁄
->
d©a
;

609 
pos
 = 
	`gtk_li°_chûd_posôi⁄
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
£À˘ed
);

611 i‡(
pos
 > 0)

613 
œyî
 = 
	`DIA_LAYER_WIDGET
(
£À˘ed
)->layer;

614 
	`d©a_øi£_œyî
(
dü
->
d©a
, 
œyî
);

616 
li°
 = 
	`g_li°_¥ïíd
÷i°, 
£À˘ed
);

618 
	`gtk_widgë_ªf
(
£À˘ed
);

620 
	`gtk_li°_ªmove_ôems
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
),

621 
li°
);

623 
	`gtk_li°_ö£π_ôems
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
),

624 
li°
, 
pos
 - 1);

626 
	`gtk_widgë_uƒef
(
£À˘ed
);

628 
	`gtk_li°_£À˘_ôem
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
pos
-1);

630 
	`dügøm_add_upd©e_Æl
(
dü
);

631 
	`dügøm_Êush
(
dü
);

633 
	`undo_œyî
(
dü
, 
œyî
, 
TYPE_RAISE_LAYER
, 0);

634 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

638 
	}
}

641 
	$œyî_dülog_lowî_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
gd©a
)

643 
Layî
 *
œyî
;

644 
Dügøm
 *
dü
;

645 
GtkWidgë
 *
£À˘ed
;

646 
GLi°
 *
li°
 = 
NULL
;

647 
pos
;

649 
dü
 = 
œyî_dülog
->
dügøm
;

651 i‡((
dü
 !
NULL
Ë&& (dü->
d©a
->
œyîs
->
Àn
>1))

653 
	`as£π
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
)->
£À˘i⁄
 !
NULL
);

654 
£À˘ed
 = 
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
)->
£À˘i⁄
->
d©a
;

656 
pos
 = 
	`gtk_li°_chûd_posôi⁄
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
£À˘ed
);

658 i‡(
pos
 < 
dü
->
d©a
->
œyîs
->
Àn
-1)

660 
œyî
 = 
	`DIA_LAYER_WIDGET
(
£À˘ed
)->layer;

661 
	`d©a_lowî_œyî
(
dü
->
d©a
, 
œyî
);

663 
li°
 = 
	`g_li°_¥ïíd
÷i°, 
£À˘ed
);

665 
	`gtk_widgë_ªf
(
£À˘ed
);

667 
	`gtk_li°_ªmove_ôems
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
),

668 
li°
);

670 
	`gtk_li°_ö£π_ôems
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
),

671 
li°
, 
pos
 + 1);

673 
	`gtk_widgë_uƒef
(
£À˘ed
);

675 
	`gtk_li°_£À˘_ôem
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
pos
+1);

677 
	`dügøm_add_upd©e_Æl
(
dü
);

678 
	`dügøm_Êush
(
dü
);

680 
	`undo_œyî
(
dü
, 
œyî
, 
TYPE_LOWER_LAYER
, 0);

681 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

685 
	}
}

689 
	$œyî_dülog_£À˘_dügøm_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
gd©a
)

691 
Dügøm
 *
dü
 = (Dügøm *Ë
gd©a
;

693 
	`œyî_dülog_£t_dügøm
(
dü
);

694 
	}
}

697 
	$œyî_dülog_upd©e_dügøm_li°
()

699 
GtkWidgë
 *
√w_míu
;

700 
GtkWidgë
 *
míu_ôem
;

701 
GLi°
 *
dü_li°
;

702 
Dügøm
 *
dü
;

703 *
fûíame
;

704 
i
;

705 
cuºít_ƒ
;

707 i‡(
œyî_dülog
 =
NULL
 ||Üayî_dülog->
dülog
 == NULL)

709 i‡(!
	`dü_›í_dügøms
())

712 
	`¸óã_œyî_dülog
();

715 i‡(!
œyî_dülog
->
dügøm_omíu
)

718 
√w_míu
 = 
	`gtk_míu_√w
();

720 
cuºít_ƒ
 = -1;

722 
i
 = 0;

723 
dü_li°
 = 
	`dü_›í_dügøms
();

724 
dü_li°
 !
NULL
)

726 
dü
 = (
Dügøm
 *Ë
dü_li°
->
d©a
;

728 i‡(
dü
 =
œyî_dülog
->
dügøm
)

730 
cuºít_ƒ
 = 
i
;

733 
fûíame
 = 
	`°ºchr
(
dü
->fûíame, 
G_DIR_SEPARATOR
);

734 i‡(
fûíame
==
NULL
)

736 
fûíame
 = 
dü
->filename;

740 
fûíame
++;

743 
míu_ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
fûíame
);

745 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
míu_ôem
), "activate",

746 (
GtkSig«lFunc
Ë
œyî_dülog_£À˘_dügøm_ˇŒback
,

747 (
gpoöãr
Ë
dü
);

749 
	`gtk_míu_≠≥nd
–
	`GTK_MENU
(
√w_míu
), 
míu_ôem
);

750 
	`gtk_widgë_show
 (
míu_ôem
);

752 
dü_li°
 = 
	`g_li°_√xt
(dia_list);

753 
i
++;

756 i‡(
	`dü_›í_dügøms
()==
NULL
)

758 
míu_ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
 (
	`_
("none"));

759 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
míu_ôem
), "activate",

760 (
GtkSig«lFunc
Ë
œyî_dülog_£À˘_dügøm_ˇŒback
,

761 (
gpoöãr
Ë
NULL
);

762 
	`gtk_míu_≠≥nd
–
	`GTK_MENU
(
√w_míu
), 
míu_ôem
);

763 
	`gtk_widgë_show
 (
míu_ôem
);

766 
	`gtk_›ti⁄_míu_ªmove_míu
(
	`GTK_OPTION_MENU
(
œyî_dülog
->
dügøm_omíu
));

768 
	`gtk_›ti⁄_míu_£t_míu
(
	`GTK_OPTION_MENU
(
œyî_dülog
->
dügøm_omíu
),

769 
√w_míu
);

771 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
œyî_dülog
->
dügøm_omíu
),

772 
cuºít_ƒ
);

773 
	`gtk_míu_£t_a˘ive
(
	`GTK_MENU
(
√w_míu
), 
cuºít_ƒ
);

775 i‡(
cuºít_ƒ
 == -1)

777 
dü
 = 
NULL
;

778 i‡(
	`dü_›í_dügøms
()!=
NULL
)

780 
dü
 = (
Dügøm
 *Ë
	`dü_›í_dügøms
()->
d©a
;

782 
	`œyî_dülog_£t_dügøm
(
dü
);

784 
	}
}

787 
	$œyî_dülog_show
()

789 i‡(
	`is_öãgøãd_ui
 (Ë=
FALSE
)

791 i‡(
œyî_dülog
 =
NULL
 ||Üayî_dülog->
dülog
 == NULL)

792 
	`¸óã_œyî_dülog
();

793 
	`gtk_wödow_¥e£¡
(
	`GTK_WINDOW
(
œyî_dülog
->
dülog
));

795 
	}
}

804 
	$_œyî_widgë_˛ór_œyî
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
u£r_d©a
)

806 
DüLayîWidgë
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
widgë
);

807 
lw
->
œyî
 = 
NULL
;

808 
	}
}

811 
	$œyî_dülog_£t_dügøm
(
Dügøm
 *
dü
)

813 
DügømD©a
 *
d©a
;

814 
GtkWidgë
 *
œyî_widgë
;

815 
Layî
 *
œyî
;

816 
Layî
 *
a˘ive_œyî
 = 
NULL
;

817 
£l_pos
;

818 
i
,
j
;

820 i‡(
dü
!=
NULL
)

821 
a˘ive_œyî
 = 
dü
->
d©a
->active_layer;

823 i‡(
œyî_dülog
 =
NULL
 ||Üayî_dülog->
dülog
 == NULL)

824 
	`¸óã_œyî_dülog
();

826 
	`gtk_c⁄èöî_f‹óch
 (
	`GTK_CONTAINER
(
œyî_dülog
->
œyî_li°
),

827 
_œyî_widgë_˛ór_œyî
, 
NULL
);

828 
	`gtk_li°_˛ór_ôems
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 0, -1);

829 
œyî_dülog
->
dügøm
 = 
dü
;

830 i‡(
dü
 !
NULL
)

832 
i
 = 
	`g_li°_ödex
(
	`dü_›í_dügøms
(), 
dü
);

833 i‡(
i
 >0 && 
œyî_dülog
->
dügøm_omíu
 !
NULL
)

834 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
œyî_dülog
->
dügøm_omíu
),

835 
i
);

838 i‡(
dü
 !
NULL
)

840 
d©a
 = 
dü
->data;

842 
£l_pos
 = 0;

843 
i
=
d©a
->
œyîs
->
Àn
-1,
j
=0; i>=0; i--,j++)

845 
œyî
 = (
Layî
 *Ë
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
);

846 
œyî_widgë
 = 
	`dü_œyî_widgë_√w
(
dü
, 
œyî
);

847 
	`gtk_widgë_show
(
œyî_widgë
);

848 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
œyî_dülog
->
œyî_li°
), 
œyî_widgë
);

849 i‡(
œyî
==
a˘ive_œyî
)

850 
£l_pos
 = 
j
;

852 
	`gtk_li°_£À˘_ôem
(
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
), 
£l_pos
);

854 
	}
}

869 
	$dü_œyî_widgë_uƒólize
(
GtkWidgë
 *
widgë
)

871 
DüLayîWidgë
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
widgë
);

873 i‡(
lw
->
edô_dülog
 !
NULL
)

875 
	`gtk_widgë_de°roy
(
lw
->
edô_dülog
->
dülog
);

876 
	`g_‰ì
(
lw
->
edô_dülog
);

877 
lw
->
edô_dülog
 = 
NULL
;

880 (* 
	`GTK_WIDGET_CLASS
 (
	`gtk_ty≥_˛ass
(
	`gtk_li°_ôem_gë_ty≥
 ()))->
uƒólize
Ë(
widgë
);

881 
	}
}

884 
	$dü_œyî_widgë_˛ass_öô
(
DüLayîWidgëCœss
 *
kœss
)

886 
GtkObje˘Cœss
 *
obje˘_˛ass
;

887 
GtkWidgëCœss
 *
widgë_˛ass
;

889 
obje˘_˛ass
 = (
GtkObje˘Cœss
*Ë
kœss
;

890 
widgë_˛ass
 = (
GtkWidgëCœss
*Ë
kœss
;

892 
widgë_˛ass
->
uƒólize
 = 
dü_œyî_widgë_uƒólize
;

893 
	}
}

896 
	$dü_œyî_widgë_£t_c⁄√˘abÀ
(
DüLayîWidgë
 *
widgë
, 
gboﬁón
 
⁄
)

898 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
widgë
->
c⁄√˘abÀ
), 
⁄
);

899 
	}
}

902 
	$dü_œyî_widgë_ex˛usive_c⁄√˘abÀ
(
DüLayîWidgë
 *
œyî_widgë
)

904 
GLi°
 *
li°
;

905 
DüLayîWidgë
 *
lw
;

906 
Layî
 *
œyî
;

907 
c⁄√˘abÀ
 = 
FALSE
;

908 
i
;

911 
i
=0; i<
œyî_widgë
->
dü
->
d©a
->
œyîs
->
Àn
; i++)

913 
œyî
 = 
	`g_±r_¨øy_ödex
(
œyî_widgë
->
dü
->
d©a
->
œyîs
, 
i
);

914 i‡(
œyî_widgë
->
œyî
 !=Üayer)

916 
c⁄√˘abÀ
 |
œyî
->connectable;

921 
li°
 = 
	`GTK_LIST
(
œyî_dülog
->
œyî_li°
)->
chûdªn
;

922 
li°
)

924 
lw
 = 
	`DIA_LAYER_WIDGET
(
li°
->
d©a
);

925 i‡(
lw
 !
œyî_widgë
)

926 
	`dü_œyî_widgë_£t_c⁄√˘abÀ
(
lw
, !
c⁄√˘abÀ
);

929 
	`dü_œyî_widgë_£t_c⁄√˘abÀ
(
lw
, 
TRUE
);

931 
	`gtk_widgë_queue_døw
(
	`GTK_WIDGET
(
lw
));

933 
li°
 = 
	`g_li°_√xt
(list);

935 
	}
}

937 
gboﬁón
 
	gshi·ed
 = 
FALSE
;

939 
gboﬁón


940 
	$dü_œyî_widgë_buâ⁄_evít
(
GtkWidgë
 *
widgë
,

941 
GdkEvítBuâ⁄
 *
evít
,

942 
gpoöãr
 
u£rd©a
)

944 
DüLayîWidgë
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
u£rd©a
);

946 
shi·ed
 = 
evít
->
°©e
 & 
GDK_SHIFT_MASK
;

947 
öã∫Æ_ˇŒ
 = 
FALSE
;

949 
	`gtk_widgë_queue_døw
(
	`GTK_WIDGET
(
lw
));

950  
FALSE
;

951 
	}
}

954 
	$dü_œyî_widgë_c⁄√˘abÀ_toggÀd
(
GtkToggÀBuâ⁄
 *
widgë
,

955 
gpoöãr
 
u£rd©a
)

957 
DüLayîWidgë
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
u£rd©a
);

958 i‡(!
lw
->
œyî
)

960 i‡(
shi·ed
)

962 
shi·ed
 = 
FALSE
;

963 
öã∫Æ_ˇŒ
 = 
TRUE
;

964 
	`dü_œyî_widgë_ex˛usive_c⁄√˘abÀ
(
lw
);

965 
öã∫Æ_ˇŒ
 = 
FALSE
;

969 
lw
->
œyî
->
c⁄√˘abÀ
 = 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
widgë
);

971 i‡(
lw
->
œyî
 =lw->
dü
->
d©a
->
a˘ive_œyî
)

973 
lw
->
c⁄√˘_off
 = !
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
widgë
);

974 i‡(
lw
->
c⁄√˘_off
Ëlw->
c⁄√˘_⁄
 = 
FALSE
;

978 
lw
->
c⁄√˘_⁄
 = 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
widgë
);

979 i‡(
lw
->
c⁄√˘_⁄
Ëlw->
c⁄√˘_off
 = 
FALSE
;

981 
	`gtk_widgë_queue_døw
(
	`GTK_WIDGET
(
lw
));

982 i‡(!
öã∫Æ_ˇŒ
)

984 
	`dügøm_add_upd©e_Æl
(
lw
->
dü
);

985 
	`dügøm_Êush
(
lw
->
dü
);

987 
	}
}

990 
	$dü_œyî_widgë_visibÀ_˛icked
(
GtkToggÀBuâ⁄
 *
widgë
,

991 
gpoöãr
 
u£rd©a
)

993 
DüLayîWidgë
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
u£rd©a
);

994 
LayîVisibûôyCh™ge
 *
ch™ge
;

999 i‡(!
öã∫Æ_ˇŒ
)

1001 
Dügøm
 *
dü
 = 
lw
->dia;

1002 
ch™ge
 = 
	`undo_œyî_visibûôy
(
dü
, 
lw
->
œyî
, 
shi·ed
);

1004 
	`œyî_visibûôy_ch™ge_≠∂y
(
ch™ge
, 
dü
);

1005 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1007 
	}
}

1010 
	$dü_œyî_widgë_öô
(
DüLayîWidgë
 *
lw
)

1012 
GtkWidgë
 *
hbox
;

1013 
GtkWidgë
 *
visibÀ
;

1014 
GtkWidgë
 *
c⁄√˘abÀ
;

1015 
GtkWidgë
 *
œbñ
;

1017 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 0);

1019 
lw
->
dü
 = 
NULL
;

1020 
lw
->
œyî
 = 
NULL
;

1021 
lw
->
edô_dülog
 = 
NULL
;

1023 
lw
->
c⁄√˘_⁄
 = 
FALSE
;

1024 
lw
->
c⁄√˘_off
 = 
FALSE
;

1026 
lw
->
visibÀ
 = visible =

1027 
	`dü_toggÀ_buâ⁄_√w_wôh_ic⁄s
(
dü_visibÀ_ic⁄
, 
dü_visibÀ_em±y_ic⁄
);

1029 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
visibÀ
), "button-release-event",

1030 
	`G_CALLBACK
(
dü_œyî_widgë_buâ⁄_evít
), 
lw
);

1031 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
visibÀ
), "button-press-event",

1032 
	`G_CALLBACK
(
dü_œyî_widgë_buâ⁄_evít
), 
lw
);

1033 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
visibÀ
), "clicked",

1034 
	`G_CALLBACK
(
dü_œyî_widgë_visibÀ_˛icked
), 
lw
);

1035 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
visibÀ
, 
FALSE
, 
TRUE
, 2);

1036 
	`gtk_widgë_show
(
visibÀ
);

1040 
lw
->
c⁄√˘abÀ
 = connectable =

1041 
	`dü_toggÀ_buâ⁄_√w_wôh_ic⁄s
(
dü_c⁄√˘abÀ_ic⁄
,

1042 
dü_c⁄√˘abÀ_em±y_ic⁄
);

1044 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
c⁄√˘abÀ
), "button-release-event",

1045 
	`G_CALLBACK
(
dü_œyî_widgë_buâ⁄_evít
), 
lw
);

1046 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
c⁄√˘abÀ
), "button-press-event",

1047 
	`G_CALLBACK
(
dü_œyî_widgë_buâ⁄_evít
), 
lw
);

1048 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
c⁄√˘abÀ
), "clicked",

1049 
	`G_CALLBACK
(
dü_œyî_widgë_c⁄√˘abÀ_toggÀd
), 
lw
);

1051 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
c⁄√˘abÀ
, 
FALSE
, 
TRUE
, 2);

1052 
	`gtk_widgë_show
(
c⁄√˘abÀ
);

1054 
lw
->
œbñ
 =Üabñ = 
	`gtk_œbñ_√w
("layer_default_label");

1055 
	`gtk_œbñ_£t_ju°ify
(
	`GTK_LABEL
(
œbñ
), 
GTK_JUSTIFY_LEFT
);

1056 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
hbox
), 
œbñ
, 
FALSE
, 
TRUE
, 0);

1057 
	`gtk_widgë_show
(
œbñ
);

1059 
	`gtk_widgë_show
(
hbox
);

1061 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
lw
), 
hbox
);

1063 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
lw
), "select",

1064 (
GtkSig«lFunc
Ë
dü_œyî_£À˘_ˇŒback
,

1065 (
gpoöãr
Ë
NULL
);

1066 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
lw
), "deselect",

1067 (
GtkSig«lFunc
Ë
dü_œyî_de£À˘_ˇŒback
,

1068 (
gpoöãr
Ë
NULL
);

1069 
	}
}

1071 
GtkTy≥


1072 
	$dü_œyî_widgë_gë_ty≥
()

1074 
GtkTy≥
 
dlw_ty≥
 = 0;

1076 i‡(!
dlw_ty≥
)

1078 c⁄° 
GtkTy≥Info
 
dlw_öfo
 =

1081  (
DüLayîWidgë
),

1082  (
DüLayîWidgëCœss
),

1083 (
GtkCœssInôFunc
Ë
dü_œyî_widgë_˛ass_öô
,

1084 (
GtkObje˘InôFunc
Ë
dü_œyî_widgë_öô
,

1085 
NULL
,

1086 
NULL
,

1087 (
GtkCœssInôFunc
Ë
NULL
,

1090 
dlw_ty≥
 = 
	`gtk_ty≥_unique
 (
	`gtk_li°_ôem_gë_ty≥
 (), &
dlw_öfo
);

1093  
dlw_ty≥
;

1094 
	}
}

1096 
GtkWidgë
 *

1097 
	$dü_œyî_widgë_√w
(
Dügøm
 *
dü
, 
Layî
 *
œyî
)

1099 
GtkWidgë
 *
widgë
;

1101 
widgë
 = 
	`GTK_WIDGET
 ( 
	`gtk_ty≥_√w
 (
	`dü_œyî_widgë_gë_ty≥
 ()));

1102 
	`dü_œyî_£t_œyî
(
	`DIA_LAYER_WIDGET
(
widgë
), 
dü
, 
œyî
);

1106 
	`DIA_LAYER_WIDGET
(
widgë
)->
c⁄√˘_⁄
 = 
FALSE
;

1107 
	`DIA_LAYER_WIDGET
(
widgë
)->
c⁄√˘_off
 = 
FALSE
;

1109  
widgë
;

1110 
	}
}

1114 
	$dü_œyî_£t_œyî
(
DüLayîWidgë
 *
widgë
, 
Dügøm
 *
dü
, 
Layî
 *
œyî
)

1116 
widgë
->
dü
 = dia;

1117 
widgë
->
œyî
 =Üayer;

1119 
	`dü_œyî_upd©e_‰om_œyî
(
widgë
);

1120 
	}
}

1123 
	$dü_œyî_upd©e_‰om_œyî
 (
DüLayîWidgë
 *
widgë
)

1125 
öã∫Æ_ˇŒ
 = 
TRUE
;

1126 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
widgë
->
visibÀ
),

1127 
widgë
->
œyî
->
visibÀ
);

1129 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
widgë
->
c⁄√˘abÀ
),

1130 
widgë
->
œyî
->
c⁄√˘abÀ
);

1131 
öã∫Æ_ˇŒ
 = 
FALSE
;

1133 
	`gtk_œbñ_£t_ãxt
 (
	`GTK_LABEL
 (
widgë
->
œbñ
), widgë->
œyî
->
«me
);

1134 
	}
}

1142 
	$edô_œyî_ok_ˇŒback
 (
GtkWidgë
 *
w
, 
gpoöãr
 
˛õ¡_d©a
)

1144 
EdôLayîDülog
 *
dülog
 = (EdôLayîDülog *Ë
˛õ¡_d©a
;

1145 
Layî
 *
œyî
;

1147 
	`g_ªtu∫_if_Áû
 (
dülog
->
œyî_widgë
 !
NULL
);

1149 
œyî
 = 
dülog
->
œyî_widgë
->layer;

1151 
	`g_‰ì
 (
œyî
->
«me
);

1152 
œyî
->
«me
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
	`GTK_ENTRY
 (
dülog
->
«me_íåy
)));

1154 
	`dügøm_add_upd©e_Æl
 (
dülog
->
œyî_widgë
->
dü
);

1155 
	`dügøm_Êush
 (
dülog
->
œyî_widgë
->
dü
);

1157 
	`dü_œyî_upd©e_‰om_œyî
 (
dülog
->
œyî_widgë
);

1159 
dülog
->
œyî_widgë
->
edô_dülog
 = 
NULL
;

1160 
	`gtk_widgë_de°roy
 (
dülog
->dialog);

1161 
	`g_‰ì
 (
dülog
);

1162 
	}
}

1165 
	$edô_œyî_add_ok_ˇŒback
 (
GtkWidgë
 *
w
, 
gpoöãr
 
˛õ¡_d©a
)

1167 
EdôLayîDülog
 *
dülog
 = (EdôLayîDülog *Ë
˛õ¡_d©a
;

1168 
Dügøm
 *
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

1169 
Layî
 *
œyî
;

1170 
pos
 = 
	`d©a_œyî_gë_ödex
 (
dü
->
d©a
, dü->d©a->
a˘ive_œyî
) + 1;

1172 
œyî
 = 
	`√w_œyî
(
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
	`GTK_ENTRY
 (
dülog
->
«me_íåy
))), 
dü
->
d©a
);

1173 
	`d©a_add_œyî_©
(
dü
->
d©a
, 
œyî
, 
pos
);

1174 
	`d©a_£t_a˘ive_œyî
(
dü
->
d©a
, 
œyî
);

1176 
	`dügøm_add_upd©e_Æl
(
dü
);

1177 
	`dügøm_Êush
(
dü
);

1179 
	`undo_œyî
(
dü
, 
œyî
, 
TYPE_ADD_LAYER
, 
pos
);

1180 
	`undo_£t_å™ß˘i⁄poöt
(
dü
->
undo
);

1182 
	`gtk_widgë_de°roy
 (
dülog
->dialog);

1183 
	`g_‰ì
 (
dülog
);

1184 
	}
}

1187 
	$edô_œyî_ª«me_ok_ˇŒback
 (
GtkWidgë
 *
w
, 
gpoöãr
 
˛õ¡_d©a
)

1189 
EdôLayîDülog
 *
dülog
 = (EdôLayîDülog *Ë
˛õ¡_d©a
;

1190 
Dügøm
 *
dü
 = 
	`ddi•œy_a˘ive_dügøm
();

1191 
Layî
 *
œyî
 = 
dü
->
d©a
->
a˘ive_œyî
;

1193 
	`g_‰ì
 (
œyî
->
«me
);

1194 
œyî
->
«me
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
	`GTK_ENTRY
 (
dülog
->
«me_íåy
)));

1196 
	`dügøm_add_upd©e_Æl
(
dü
);

1197 
	`dügøm_Êush
(
dü
);

1200 
	`gtk_widgë_de°roy
 (
dülog
->dialog);

1201 
	`g_‰ì
 (
dülog
);

1202 
	}
}

1204 
	$edô_œyî_ˇn˚l_ˇŒback
 (
GtkWidgë
 *
w
,

1205 
gpoöãr
 
˛õ¡_d©a
)

1207 
EdôLayîDülog
 *
dülog
;

1209 
dülog
 = (
EdôLayîDülog
 *Ë
˛õ¡_d©a
;

1211 i‡(
dülog
->
œyî_widgë
)

1212 
dülog
->
œyî_widgë
->
edô_dülog
 = 
NULL
;

1213 i‡(
dülog
->dülog !
NULL
)

1214 
	`gtk_widgë_de°roy
 (
dülog
->dialog);

1215 
	`g_‰ì
 (
dülog
);

1216 
	}
}

1218 
göt


1219 
	$edô_œyî_dñëe_ˇŒback
 (
GtkWidgë
 *
w
,

1220 
GdkEvít
 *
e
,

1221 
gpoöãr
 
˛õ¡_d©a
)

1223 
	`edô_œyî_ˇn˚l_ˇŒback
 (
w
, 
˛õ¡_d©a
);

1225  
TRUE
;

1226 
	}
}

1229 
	$œyî_dülog_edô_œyî
 (
DüLayîWidgë
 *
œyî_widgë
, 
Dügøm
 *
dü
, 
Layî
 *
œyî
)

1231 
EdôLayîDülog
 *
dülog
;

1232 
GtkWidgë
 *
vbox
;

1233 
GtkWidgë
 *
hbox
;

1234 
GtkWidgë
 *
œbñ
;

1235 
GtkWidgë
 *
buâ⁄
;

1238 
dülog
 = (
EdôLayîDülog
 *Ë
	`g_mÆloc
 ( (EditLayerDialog));

1239 
dülog
->
œyî_widgë
 =Üayer_widget;

1242 
dülog
->dülog = 
	`gtk_dülog_√w
 ();

1243 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
dülog
->dialog), "edit_layer_attrributes");

1244 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
dülog
->dialog),

1245 (
œyî_widgë
 || 
œyî
Ë? 
	`_
("Edit Layer") : _("Add Layer"));

1246 
	`gtk_wödow_£t_posôi⁄
 (
	`GTK_WINDOW
 (
dülog
->dülog), 
GTK_WIN_POS_MOUSE
);

1249 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
dülog
->dialog), "delete_event",

1250 
	`G_CALLBACK
 (
edô_œyî_dñëe_ˇŒback
),

1251 
dülog
);

1252 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
dülog
->dialog), "destroy",

1253 
	`G_CALLBACK
 (
gtk_widgë_de°roy
),

1254 &
dülog
->dialog);

1257 
vbox
 = 
	`gtk_vbox_√w
 (
FALSE
, 1);

1258 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox
), 2);

1259 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
	`GTK_DIALOG
 (
dülog
->dülog)->
vbox
), vbox, 
TRUE
, TRUE, 0);

1262 
hbox
 = 
	`gtk_hbox_√w
 (
FALSE
, 1);

1263 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, FALSE, 0);

1264 
œbñ
 = 
	`gtk_œbñ_√w
 (
	`_
("LayerÇame:"));

1265 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
œbñ
, 
FALSE
, FALSE, 0);

1266 
	`gtk_widgë_show
 (
œbñ
);

1267 
dülog
->
«me_íåy
 = 
	`gtk_íåy_√w
 ();

1268 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
dülog
->
«me_íåy
, 
TRUE
, TRUE, 0);

1269 i‡(
œyî_widgë
)

1270 
	`gtk_íåy_£t_ãxt
 (
	`GTK_ENTRY
 (
dülog
->
«me_íåy
), 
œyî_widgë
->
œyî
->
«me
);

1271 i‡(
œyî
)

1272 
	`gtk_íåy_£t_ãxt
 (
	`GTK_ENTRY
 (
dülog
->
«me_íåy
), 
œyî
->
«me
);

1273 i‡(
dü
)

1275 
gch¨
 *
«me
 = 
	`g_°rdup_¥ötf
 (
	`_
("NewÜayî %d"), 
dü
->
d©a
->
œyîs
->
Àn
);

1276 
	`gtk_íåy_£t_ãxt
 (
	`GTK_ENTRY
 (
dülog
->
«me_íåy
), 
«me
);

1277 
	`g_‰ì
 (
«me
);

1280 
	`gtk_widgë_show
 (
dülog
->
«me_íåy
);

1281 
	`gtk_widgë_show
 (
hbox
);

1283 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_OK
);

1284 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄
, 
GTK_CAN_DEFAULT
);

1285 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
	`GTK_DIALOG
 (
dülog
->dülog)->
a˘i⁄_¨ó
),

1286 
buâ⁄
, 
TRUE
, TRUE, 0);

1287 i‡(
œyî_widgë
)

1288 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1289 
	`G_CALLBACK
(
edô_œyî_ok_ˇŒback
), 
dülog
);

1290 i‡(
œyî
)

1291 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1292 
	`G_CALLBACK
(
edô_œyî_ª«me_ok_ˇŒback
), 
dülog
);

1293 i‡(
dü
)

1294 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1295 
	`G_CALLBACK
(
edô_œyî_add_ok_ˇŒback
), 
dülog
);

1297 
	`gtk_widgë_gøb_deÁu…
 (
buâ⁄
);

1298 
	`gtk_widgë_show
 (
buâ⁄
);

1300 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_CANCEL
);

1301 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄
, 
GTK_CAN_DEFAULT
);

1302 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
	`GTK_DIALOG
 (
dülog
->dülog)->
a˘i⁄_¨ó
),

1303 
buâ⁄
, 
TRUE
, TRUE, 0);

1304 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1305 
	`G_CALLBACK
(
edô_œyî_ˇn˚l_ˇŒback
),

1306 
dülog
);

1307 
	`gtk_widgë_show
 (
buâ⁄
);

1309 
	`gtk_widgë_show
 (
vbox
);

1310 
	`gtk_widgë_show
 (
dülog
->dialog);

1312 i‡(
œyî_widgë
)

1313 
œyî_widgë
->
edô_dülog
 = 
dülog
;

1314 
	}
}

1320 
	$œyî_ch™ge_≠∂y
(
LayîCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

1322 
ch™ge
->
≠∂õd
 = 1;

1324 
ch™ge
->
ty≥
)

1326 
TYPE_DELETE_LAYER
:

1327 
	`d©a_dñëe_œyî
(
dü
->
d©a
, 
ch™ge
->
œyî
);

1329 
TYPE_ADD_LAYER
:

1330 
	`d©a_add_œyî_©
(
dü
->
d©a
, 
ch™ge
->
œyî
, ch™ge->
ödex
);

1332 
TYPE_RAISE_LAYER
:

1333 
	`d©a_øi£_œyî
(
dü
->
d©a
, 
ch™ge
->
œyî
);

1335 
TYPE_LOWER_LAYER
:

1336 
	`d©a_lowî_œyî
(
dü
->
d©a
, 
ch™ge
->
œyî
);

1340 
	`dügøm_add_upd©e_Æl
(
dü
);

1342 i‡(
œyî_dülog
->
dügøm
 =
dü
)

1344 
	`œyî_dülog_£t_dügøm
(
dü
);

1346 
	}
}

1349 
	$œyî_ch™ge_ªvît
(
LayîCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

1351 
ch™ge
->
ty≥
)

1353 
TYPE_DELETE_LAYER
:

1354 
	`d©a_add_œyî_©
(
dü
->
d©a
, 
ch™ge
->
œyî
, ch™ge->
ödex
);

1356 
TYPE_ADD_LAYER
:

1357 
	`d©a_dñëe_œyî
(
dü
->
d©a
, 
ch™ge
->
œyî
);

1359 
TYPE_RAISE_LAYER
:

1360 
	`d©a_lowî_œyî
(
dü
->
d©a
, 
ch™ge
->
œyî
);

1362 
TYPE_LOWER_LAYER
:

1363 
	`d©a_øi£_œyî
(
dü
->
d©a
, 
ch™ge
->
œyî
);

1367 
	`dügøm_add_upd©e_Æl
(
dü
);

1369 i‡(
œyî_dülog
->
dügøm
 =
dü
)

1371 
	`œyî_dülog_£t_dügøm
(
dü
);

1374 
ch™ge
->
≠∂õd
 = 0;

1375 
	}
}

1378 
	$œyî_ch™ge_‰ì
(
LayîCh™ge
 *
ch™ge
)

1380 
ch™ge
->
ty≥
)

1382 
TYPE_DELETE_LAYER
:

1383 i‡(
ch™ge
->
≠∂õd
)

1385 
	`œyî_de°roy
(
ch™ge
->
œyî
);

1388 
TYPE_ADD_LAYER
:

1389 i‡(!
ch™ge
->
≠∂õd
)

1391 
	`œyî_de°roy
(
ch™ge
->
œyî
);

1394 
TYPE_RAISE_LAYER
:

1396 
TYPE_LOWER_LAYER
:

1399 
	}
}

1401 
Ch™ge
 *

1402 
	$undo_œyî
(
Dügøm
 *
dü
, 
Layî
 *
œyî
, 
LayîCh™geTy≥
 
ty≥
, 
ödex
)

1404 
LayîCh™ge
 *
ch™ge
;

1406 
ch™ge
 = 
	`g_√w0
(
LayîCh™ge
, 1);

1408 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
œyî_ch™ge_≠∂y
;

1409 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
œyî_ch™ge_ªvît
;

1410 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
œyî_ch™ge_‰ì
;

1412 
ch™ge
->
ty≥
 =Åype;

1413 
ch™ge
->
œyî
 =Üayer;

1414 
ch™ge
->
ödex
 = index;

1415 
ch™ge
->
≠∂õd
 = 1;

1417 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

1418  (
Ch™ge
 *)
ch™ge
;

1419 
	}
}

1422 
	$œyî_visibûôy_ch™ge_≠∂y
(
LayîVisibûôyCh™ge
 *
ch™ge
,

1423 
Dügøm
 *
dü
)

1425 
GPåAºay
 *
œyîs
;

1426 
Layî
 *
œyî
 = 
ch™ge
->layer;

1427 
visibÀ
 = 
FALSE
;

1428 
i
;

1430 i‡(
ch™ge
->
is_ex˛usive
)

1434 
i
=0; i<
dü
->
d©a
->
œyîs
->
Àn
; i++)

1436 
Layî
 *
ãmp_œyî
 = 
	`g_±r_¨øy_ödex
(
dü
->
d©a
->
œyîs
, 
i
);

1437 i‡(
ãmp_œyî
 !
œyî
)

1439 
visibÀ
 |
ãmp_œyî
->visible;

1444 
œyîs
 = 
dü
->
d©a
->layers;

1445 
i
 = 0; i < 
œyîs
->
Àn
; i++)

1447 
Layî
 *
ãmp_œyî
 = (Layî *Ë
	`g_±r_¨øy_ödex
(
œyîs
, 
i
);

1448 i‡(
ãmp_œyî
 =
œyî
)

1450 
ãmp_œyî
->
visibÀ
 = 
TRUE
;

1454 
ãmp_œyî
->
visibÀ
 = !visible;

1460 
œyî
->
visibÀ
 = !layer->visible;

1462 
	`dügøm_add_upd©e_Æl
(
dü
);

1464 i‡(
œyî_dülog
->
dügøm
 =
dü
)

1466 
	`œyî_dülog_£t_dügøm
(
dü
);

1468 
	}
}

1473 
	$œyî_visibûôy_ch™ge_ªvît
(
LayîVisibûôyCh™ge
 *
ch™ge
,

1474 
Dügøm
 *
dü
)

1476 
GLi°
 *
vis
 = 
ch™ge
->
‹igöÆ_visibûôy
;

1477 
GPåAºay
 *
œyîs
 = 
dü
->
d©a
->layers;

1478 
i
;

1480 
i
 = 0; 
vis
 !
NULL
 && i < 
œyîs
->
Àn
; vi†
	`g_li°_√xt
(vis), i++)

1482 
Layî
 *
œyî
 = (Layî*Ë
	`g_±r_¨øy_ödex
(
œyîs
, 
i
);

1483 
œyî
->
visibÀ
 = (
gboﬁón
)
vis
->
d©a
;

1486 i‡(
vis
 !
NULL
 || 
i
 < 
œyîs
->
Àn
)

1488 
	`¥ötf
("InternalÉrror: visibility undo has %d visibilities, but %dÜayers\n",

1489 
	`g_li°_Àngth
(
ch™ge
->
‹igöÆ_visibûôy
), 
œyîs
->
Àn
);

1492 
	`dügøm_add_upd©e_Æl
(
dü
);

1494 i‡(
œyî_dülog
->
dügøm
 =
dü
)

1496 
	`œyî_dülog_£t_dügøm
(
dü
);

1498 
	}
}

1501 
	$œyî_visibûôy_ch™ge_‰ì
(
LayîVisibûôyCh™ge
 *
ch™ge
)

1503 
	`g_li°_‰ì
(
ch™ge
->
‹igöÆ_visibûôy
);

1504 
	}
}

1506 
LayîVisibûôyCh™ge
 *

1507 
	$undo_œyî_visibûôy
(
Dügøm
 *
dü
, 
Layî
 *
œyî
, 
gboﬁón
 
ex˛usive
)

1509 
LayîVisibûôyCh™ge
 *
ch™ge
;

1510 
GLi°
 *
visibûôõs
 = 
NULL
;

1511 
i
;

1512 
GPåAºay
 *
œyîs
 = 
dü
->
d©a
->layers;

1514 
ch™ge
 = 
	`g_√w0
(
LayîVisibûôyCh™ge
, 1);

1516 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
œyî_visibûôy_ch™ge_≠∂y
;

1517 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
œyî_visibûôy_ch™ge_ªvît
;

1518 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
œyî_visibûôy_ch™ge_‰ì
;

1520 
i
 = 0; i < 
œyîs
->
Àn
; i++)

1522 
Layî
 *
ãmp_œyî
 = (Layî *Ë
	`g_±r_¨øy_ödex
(
œyîs
, 
i
);

1523 
visibûôõs
 = 
	`g_li°_≠≥nd
(visibûôõs, (
gpoöãr
)
ãmp_œyî
->
visibÀ
);

1526 
ch™ge
->
‹igöÆ_visibûôy
 = 
visibûôõs
;

1527 
ch™ge
->
œyî
 =Üayer;

1528 
ch™ge
->
is_ex˛usive
 = 
ex˛usive
;

1530 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

1531  
ch™ge
;

1532 
	}
}

1538 
	$dügøm_edô_œyî
(
Dügøm
 *
dü
, 
Layî
 *
œyî
)

1540 
	`g_ªtu∫_if_Áû
(
dü
 !
NULL
);

1542 
	`œyî_dülog_edô_œyî
 (
NULL
, 
œyî
 ? NULL : 
dü
,Üayer);

1543 
	}
}

	@O:\tool\dvs50\app\layer_dialog.h

18 #i‚de‡
LAYER_DIALOG_H


19 
	#LAYER_DIALOG_H


	)

21 
	~<gtk/gtk.h
>

22 
	~"dügøm.h
"

25 
¸óã_œyî_dülog
();

26 
œyî_dülog_upd©e_dügøm_li°
();

27 
œyî_dülog_show
();

28 
œyî_dülog_£t_dügøm
(
Dügøm
 *
dü
);

31 
GtkWidgë
 * 
¸óã_œyî_võw_widgë
 ();

33 
_DüLayîWidgë
 
	tDüLayîWidgë
;

35 
GtkWidgë
* 
dü_œyî_widgë_√w
(
Dügøm
 *
dü
, 
Layî
 *
œyî
);

36 
dü_œyî_£t_œyî
(
DüLayîWidgë
 *
widgë
, 
Dügøm
 *
dü
, 
Layî
 *
œyî
);

37 
dü_œyî_upd©e_‰om_œyî
(
DüLayîWidgë
 *
widgë
);

39 
dügøm_edô_œyî
(
Dügøm
 *
dü
, 
Layî
 *
œyî
);

	@O:\tool\dvs50\app\linewidth_area.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~"löewidth_¨ó.h
"

24 
	~"©åibuãs.h
"

25 
	~"≥rsi°í˚.h
"

26 
	~"öãrÁ˚.h
"

27 
	~"öé.h
"

29 #i‡!
deföed
(
röt
)

30 
	~<m©h.h
>

31 
	#röt
(
x
Ë
	`Êo‹
 ((xË+ 0.5)

	)

34 
	#BASE_WIDTH
 0.05

	)

35 
	#PIXELS_BETWEEN_LINES
 6

	)

36 
	#NUMLINES
 5

	)

38 
	#X_OFFSET
(
i
Ë(
PIXELS_BETWEEN_LINES
*(i)+((i)-1)*(i)/2)

	)

40 
	#AREA_WIDTH
 
	`X_OFFSET
(
NUMLINES
+1)

	)

41 
	#AREA_HEIGHT
 42

	)

43 
löewidth_¸óã_dülog
();

45 
	ga˘ive_löewidth
 = 2;

46 
GdkGC
 *
	glöewidth_¨ó_gc
 = 
NULL
;

47 
GdkPixm≠
 *
	glöewidth_¨ó_pixm≠
 = 
NULL
;

49 
GtkWidgë
 *
	glöewidth_¨ó_widgë
 = 
NULL
;

50 
GtkWidgë
 *
	glöewidth_dülog
 = 
NULL
;

51 
GtkWidgë
 *
	glöewidth_buâ⁄
 = 
NULL
;

54 
	$löewidth_¨ó_èrgë
 (
x
, 
y
)

56 
i
;

57 
x_offs
;

58 
i
=1;i<=
NUMLINES
;i++) {

59 
x_offs
 = 
	`X_OFFSET
(
i
);

60 i‡((
x
>=
x_offs
-
PIXELS_BETWEEN_LINES
/2) &&

61 (
x
<
x_offs
+
i
+
PIXELS_BETWEEN_LINES
/2))

62  
i
;

65 
	}
}

68 
	$löewidth_¨ó_døw
 (
GtkWidgë
 *
löewidth_¨ó
)

70 
GdkCﬁ‹
 *
wö_bg
;

71 
GdkCﬁ‹
 
löe
;

72 
width
, 
height
;

73 
i
;

74 
x_offs
;

76 i‡(!
löewidth_¨ó_pixm≠
)

81 i‡(!
löewidth_¨ó_gc
) {

82 
löewidth_¨ó_gc
 = 
	`gdk_gc_√w
 (
löewidth_¨ó_pixm≠
);

83 
	`gdk_gc_£t_löe_©åibuãs
(
löewidth_¨ó_gc
, 1,

84 
GDK_LINE_ON_OFF_DASH
,

85 
GDK_CAP_BUTT
,

86 
GDK_JOIN_MITER
);

89 
	`gdk_wödow_gë_size
 (
löewidth_¨ó_pixm≠
, &
width
, &
height
);

91 
wö_bg
 = &(
löewidth_¨ó
->
°yÀ
->
bg
[
GTK_STATE_NORMAL
]);

92 
löe
 = 
cﬁ‹_gdk_bœck
;

94 
	`gdk_gc_£t_f‹eground
 (
löewidth_¨ó_gc
, 
wö_bg
);

95 
	`gdk_døw_ª˘™gÀ
 (
löewidth_¨ó_pixm≠
, 
löewidth_¨ó_gc
, 1,

96 0, 0, 
width
, 
height
);

98 
	`gdk_gc_£t_f‹eground
 (
löewidth_¨ó_gc
, &
löe
);

100 
i
=0;i<=
NUMLINES
;i++) {

101 
x_offs
 = 
	`X_OFFSET
(
i
);

103 
	`gdk_døw_ª˘™gÀ
 (
löewidth_¨ó_pixm≠
, 
löewidth_¨ó_gc
, 1,

104 
x_offs
, 2, 
i
, 
height
-4);

108 i‡(
a˘ive_löewidth
 != 0) {

109 
	`gdk_døw_ª˘™gÀ
 (
löewidth_¨ó_pixm≠
, 
löewidth_¨ó_gc
, 0,

110 
	`X_OFFSET
(
a˘ive_löewidth
)-2, 0,

111 
a˘ive_löewidth
+4, 
height
-1);

114 
	`gdk_døw_pixm≠
 (
löewidth_¨ó
->
wödow
, 
löewidth_¨ó_gc
, 
löewidth_¨ó_pixm≠
,

115 0, 0, 0, 0, 
width
, 
height
);

116 
	}
}

118 
göt


119 
	$löewidth_¨ó_evíts
 (
GtkWidgë
 *
widgë
,

120 
GdkEvít
 *
evít
)

122 
GdkEvítBuâ⁄
 *
bevít
;

123 
GdkEvítC⁄figuª
 *
˚vít
;

124 
èrgë
;

126 
evít
->
ty≥
)

128 
GDK_CONFIGURE
:

129 
˚vít
 = (
GdkEvítC⁄figuª
 *Ë
evít
;

130 i‡(
˚vít
->
width
 > 1) {

131 
löewidth_¨ó_pixm≠
 = 
	`gdk_pixm≠_√w
 (
widgë
->
wödow
,

132 
˚vít
->
width
,

133 
˚vít
->
height
, -1);

136 
GDK_EXPOSE
:

137 
	`löewidth_¨ó_døw
 (
löewidth_¨ó_widgë
);

140 
GDK_BUTTON_PRESS
:

141 
bevít
 = (
GdkEvítBuâ⁄
 *Ë
evít
;

142 i‡(
bevít
->
buâ⁄
 == 1) {

143 
èrgë
 = 
	`löewidth_¨ó_èrgë
 (
bevít
->
x
, bevít->
y
);

145 i‡(
èrgë
 != 0) {

146 
a˘ive_löewidth
 = 
èrgë
;

147 
	`löewidth_¨ó_døw
(
löewidth_¨ó_widgë
);

148 
	`©åibuãs_£t_deÁu…_löewidth
(
BASE_WIDTH
*(
èrgë
-1));

153 
GDK_2BUTTON_PRESS
:

154 i‡(
löewidth_dülog
 =
NULL
)

155 
	`löewidth_¸óã_dülog
();

157 
	`gtk_widgë_gøb_focus
(
löewidth_buâ⁄
);

158 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
löewidth_buâ⁄
), 
	`©åibuãs_gë_deÁu…_löewidth
());

160 
	`gtk_widgë_show
(
löewidth_dülog
);

167  
FALSE
;

168 
	}
}

172 
	$löewidth_numbî_‰om_width
(
ªÆ
 
width
)

174 i‡(
	`Ábs
(
width
/
BASE_WIDTH
-
	`röt
(width/BASE_WIDTH)) > 0.0005 ||

175 (
width
/
BASE_WIDTH
 > 
NUMLINES
)) {

178  
width
/
BASE_WIDTH
+1.0005;

180 
	}
}

182 
GtkWidgë
 *

183 
	$löewidth_¨ó_¸óã
 ()

185 
GtkWidgë
 *
löewidth_¨ó
;

186 
GtkWidgë
 *
evít_box
;

188 
	`©åibuãs_£t_deÁu…_löewidth
(
	`≥rsi°í˚_ªgi°î_ªÆ
("linewidth", 0.1));

189 
a˘ive_löewidth
 = 
	`löewidth_numbî_‰om_width
(
	`©åibuãs_gë_deÁu…_löewidth
());

191 
evít_box
 = 
	`gtk_evít_box_√w
();

192 
löewidth_¨ó
 = 
	`gtk_døwög_¨ó_√w
 ();

193 
	`gtk_widgë_£t_size_ªque°
 (
löewidth_¨ó
, 
AREA_WIDTH
, 
AREA_HEIGHT
);

194 
	`gtk_widgë_£t_evíts
 (
löewidth_¨ó
, 
GDK_EXPOSURE_MASK
 | 
GDK_BUTTON_PRESS_MASK
);

195 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
löewidth_¨ó
), "event",

196 
	`G_CALLBACK
(
löewidth_¨ó_evíts
),

197 
NULL
);

199 
löewidth_¨ó_widgë
 = 
löewidth_¨ó
;

201 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
evít_box
), 
löewidth_¨ó
);

202 
	`gtk_widgë_show
(
löewidth_¨ó
);

203  
evít_box
;

204 
	}
}

207 
	$gë_cuºít_löe_width
()

209 
√wvÆue
 = 
	`gtk_•ö_buâ⁄_gë_vÆue
 (
	`GTK_SPIN_BUTTON
 (
löewidth_buâ⁄
));

210 
a˘ive_löewidth
 = 
	`löewidth_numbî_‰om_width
(
√wvÆue
);

211 
	`löewidth_¨ó_døw
(
	`GTK_WIDGET
(
löewidth_¨ó_widgë
));

212 
	`©åibuãs_£t_deÁu…_löewidth
(
√wvÆue
);

213 
	}
}

216 
	$löewidth_dülog_ª•⁄d
(
GtkWidgë
 *
widgë
, 
göt
 
ª•⁄£_id
, 
gpoöãr
 
d©a
)

218 i‡(
ª•⁄£_id
 =
GTK_RESPONSE_OK
) {

219 
	`gë_cuºít_löe_width
();

221 
	`gtk_widgë_hide
(
löewidth_dülog
);

222 
	}
}

225 
	$löewidth_dülog_ok
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

227 
	`gtk_dülog_ª•⁄£
(
	`GTK_DIALOG
(
löewidth_dülog
), 
GTK_RESPONSE_OK
);

228 
	}
}

232 
	$dülog_de°royed
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

234 
GtkWidgë
 **
wid
 = (GtkWidgë**)
d©a
;

235 i‡(
wid
Ë*wid = 
NULL
;

236 
	}
}

239 
	$löewidth_¸óã_dülog
()

241 
GtkWidgë
 *
hbox
;

242 
GtkWidgë
 *
œbñ
;

243 
GtkAdju°mít
 *
adj
;

245 
löewidth_dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
(

246 
	`_
("Löêwidth"), 
	`GTK_WINDOW
(
	`öãrÁ˚_gë_toﬁbox_shñl
()),

248 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

249 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

250 
NULL
);

252 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
(
löewidth_dülog
), 
GTK_RESPONSE_OK
);

253 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
löewidth_dülog
), "linewidth_window");

254 
	`gtk_wödow_£t_ªsizabÀ
 (
	`GTK_WINDOW
 (
löewidth_dülog
), 
TRUE
);

255 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
löewidth_dülog
), 2);

257 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

258 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Line width:"));

259 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
œbñ
, 
FALSE
, 
TRUE
, 0);

260 
	`gtk_widgë_show
 (
œbñ
);

261 
adj
 = (
GtkAdju°mít
 *Ë
	`gtk_adju°mít_√w
(0.1, 0.00, 10.0, 0.01, 0.05, 0.0);

262 
löewidth_buâ⁄
 = 
	`gtk_•ö_buâ⁄_√w
(
adj
, 
	`©åibuãs_gë_deÁu…_löewidth
(), 2);

263 
	`gtk_•ö_buâ⁄_£t_wøp
(
	`GTK_SPIN_BUTTON
(
löewidth_buâ⁄
), 
TRUE
);

264 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
löewidth_buâ⁄
), 
TRUE
);

265 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
 (
hbox
), 
löewidth_buâ⁄
, 
TRUE
, TRUE, 0);

266 
	`gtk_widgë_show
 (
löewidth_buâ⁄
);

267 
	`gtk_widgë_show
(
hbox
);

268 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
(
	`GTK_DIALOG
 (
löewidth_dülog
)->
vbox
), 
hbox
, 
TRUE
, TRUE, 0);

270 
	`gtk_widgë_show
 (
löewidth_buâ⁄
);

272 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
löewidth_dülog
), "response",

273 
	`G_CALLBACK
 (
löewidth_dülog_ª•⁄d
), 
NULL
);

274 
	`g_sig«l_c⁄√˘_a·î
(
	`G_OBJECT
 (
löewidth_buâ⁄
), "activate",

275 
	`G_CALLBACK
 (
löewidth_dülog_ok
), 
NULL
);

277 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
löewidth_dülog
), "delete_event",

278 
	`G_CALLBACK
(
gtk_widgë_hide
), 
NULL
);

279 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
löewidth_dülog
), "destroy",

280 
	`G_CALLBACK
(
dülog_de°royed
), &
löewidth_dülog
);

282 
	`≥rsi°í˚_ªgi°î_wödow
 (
	`GTK_WINDOW
 (
löewidth_dülog
));

283 
	}
}

	@O:\tool\dvs50\app\linewidth_area.h

18 #i‚de‡
LINEWDITH_AREA_H


19 
	#LINEWDITH_AREA_H


	)

21 
	~<gtk/gtk.h
>

23 
GtkWidgë
 *
löewidth_¨ó_¸óã
 ();

	@O:\tool\dvs50\app\load_save.c

18 
	~<c⁄fig.h
>

20 
	#_BSD_SOURCE
 1

	)

21 
	#_POSIX_C_SOURCE
 2

	)

22 
	~<sys/°©.h
>

23 #ifde‡
HAVE_UNISTD_H


24 
	~<uni°d.h
>

26 
	~<°dlib.h
>

27 
	~<sys/ty≥s.h
>

28 
	~<°dio.h
>

29 
	~<f˙é.h
>

30 
	~<°rög.h
>

32 
	~<glib.h
>

33 
	~<glib/g°dio.h
>

34 
	~<î∫o.h
>

36 #i‚de‡
W_OK


37 
	#W_OK
 2

	)

40 
	~"öé.h
"

42 
	~<libxml/åì.h
>

43 
	~<libxml/∑r£r.h
>

44 
	~<libxml/xmlmem‹y.h
>

45 
	~"dü_xml_libxml.h
"

46 
	~"dü_xml.h
"

48 
	~"lﬂd_ßve.h
"

49 
	~"group.h
"

50 
	~"dügømd©a.h
"

51 
	~"obje˘.h
"

52 
	~"mesßge.h
"

53 
	~"¥e„ªn˚s.h
"

54 
	~"dü∑gñayout.h
"

55 
	~"autoßve.h
"

56 
	~"√wgroup.h
"

58 #ifde‡
G_OS_WIN32


59 
	~<io.h
>

62 
ªad_c⁄√˘i⁄s
(
GLi°
 *
obje˘s
, 
xmlNodePå
 
œyî_node
,

63 
GHashTabÀ
 *
obje˘s_hash
);

64 
GHFuncUnknownObje˘s
(
gpoöãr
 
key
,

65 
gpoöãr
 
vÆue
,

66 
gpoöãr
 
u£r_d©a
);

67 
GLi°
 *
ªad_obje˘s
(
xmlNodePå
 
obje˘s
,

68 
GHashTabÀ
 *
obje˘s_hash
,

69 c⁄° *
fûíame
, 
DüObje˘
 *
∑ª¡
,

70 
GHashTabÀ
 *
unknown_obje˘s_hash
);

71 
hash_‰ì_°rög
(
gpoöãr
 
key
,

72 
gpoöãr
 
vÆue
,

73 
gpoöãr
 
u£r_d©a
);

74 
xmlNodePå
 
föd_node_«med
 (xmlNodePå 
p
, c⁄° *
«me
);

75 
gboﬁón
 
dügøm_d©a_lﬂd
(c⁄° *
fûíame
, 
DügømD©a
 *
d©a
,

76 * 
u£r_d©a
);

77 
gboﬁón
 
wrôe_obje˘s
(
GLi°
 *
obje˘s
, 
xmlNodePå
 
obje˘s_node
,

78 
GHashTabÀ
 *
obje˘s_hash
, *
obj_ƒ
,

79 c⁄° *
fûíame
);

80 
gboﬁón
 
wrôe_c⁄√˘i⁄s
(
GLi°
 *
obje˘s
, 
xmlNodePå
 
œyî_node
,

81 
GHashTabÀ
 *
obje˘s_hash
);

82 
xmlDocPå
 
dügøm_d©a_wrôe_doc
(
DügømD©a
 *
d©a
, c⁄° *
fûíame
);

83 
dügøm_d©a_øw_ßve
(
DügømD©a
 *
d©a
, c⁄° *
fûíame
);

84 
dügøm_d©a_ßve
(
DügømD©a
 *
d©a
, c⁄° *
fûíame
);

88 
	$GHFuncUnknownObje˘s
(
gpoöãr
 
key
,

89 
gpoöãr
 
vÆue
,

90 
gpoöãr
 
u£r_d©a
)

92 
GSåög
* 
s
 = (GSåög*)
u£r_d©a
;

93 
	`g_°rög_≠≥nd
(
s
, "\n");

94 
	`g_°rög_≠≥nd
(
s
, (
gch¨
*)
key
);

95 
	`g_‰ì
(
key
);

96 
	}
}

115 
GLi°
 *

116 
	$ªad_obje˘s
(
xmlNodePå
 
obje˘s
,

117 
GHashTabÀ
 *
obje˘s_hash
,c⁄° *
fûíame
, 
DüObje˘
 *
∑ª¡
,

118 
GHashTabÀ
 *
unknown_obje˘s_hash
)

120 
GLi°
 *
li°
;

121 
DüObje˘Ty≥
 *
ty≥
;

122 
DüObje˘
 *
obj
;

123 
Obje˘Node
 
obj_node
;

124 *
ty≥°r
;

125 *
vîsi⁄°r
;

126 *
id
;

127 
vîsi⁄
;

128 
xmlNodePå
 
chûd_node
;

130 
li°
 = 
NULL
;

132 
obj_node
 = 
obje˘s
->
xmlChûdªnNode
;

134  
obj_node
 !
NULL
) {

135 i‡(
	`xmlIsBœnkNode
(
obj_node
)) {

136 
obj_node
 = obj_node->
√xt
;

140 i‡(!
obj_node
) ;

142 i‡(
	`xmlSåcmp
(
obj_node
->
«me
, (c⁄° 
xmlCh¨
 *)"object")==0) {

143 
ty≥°r
 = (*Ë
	`xmlGëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"type");

144 
vîsi⁄°r
 = (*Ë
	`xmlGëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"version");

145 
id
 = (*Ë
	`xmlGëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"id");

147 
vîsi⁄
 = 0;

148 i‡(
vîsi⁄°r
 !
NULL
) {

149 
vîsi⁄
 = 
	`©oi
(
vîsi⁄°r
);

150 
	`xmlFªe
(
vîsi⁄°r
);

153 
ty≥
 = 
	`obje˘_gë_ty≥
((*)
ty≥°r
);

155 i‡(!
ty≥
) {

156 i‡(
	`g_utf8_vÆid©e
 (
ty≥°r
, -1, 
NULL
) &&

157 
NULL
 =
	`g_hash_èbÀ_lookup
(
unknown_obje˘s_hash
, 
ty≥°r
))

158 
	`g_hash_èbÀ_ö£π
(
unknown_obje˘s_hash
, 
	`g_°rdup
(
ty≥°r
), 0);

162 
obj
 = 
ty≥
->
›s
->
	`lﬂd
(
obj_node
, 
vîsi⁄
, 
fûíame
);

163 
li°
 = 
	`g_li°_≠≥nd
÷i°, 
obj
);

165 i‡(
∑ª¡
)

167 
obj
->
∑ª¡
 =Öarent;

168 
∑ª¡
->
chûdªn
 = 
	`g_li°_≠≥nd
’¨ít->chûdªn, 
obj
);

171 
	`g_hash_èbÀ_ö£π
(
obje˘s_hash
, 
	`g_°rdup
((*)
id
), 
obj
);

173 
chûd_node
 = 
obj_node
->
chûdªn
;

175 
chûd_node
)

177 i‡(
	`xmlSåcmp
(
chûd_node
->
«me
, (c⁄° 
xmlCh¨
 *)"children") == 0)

179 
GLi°
 *
chûdªn_ªad
 = 
	`ªad_obje˘s
(
chûd_node
, 
obje˘s_hash
, 
fûíame
, 
obj
, 
unknown_obje˘s_hash
);

180 
li°
 = 
	`g_li°_c⁄ˇt
÷i°, 
chûdªn_ªad
);

183 
chûd_node
 = chûd_node->
√xt
;

186 i‡(
ty≥°r
Ë
	`xmlFªe
(typestr);

187 i‡(
id
Ë
	`xmlFªe
 (id);

188 } i‡(
	`xmlSåcmp
(
obj_node
->
«me
, (c⁄° 
xmlCh¨
 *)"group")==0

189 && 
obj_node
->
chûdªn
) {

191 
GLi°
 *
ö√r_obje˘s
 = 
	`ªad_obje˘s
(
obj_node
, 
obje˘s_hash
, 
fûíame
, 
NULL
, 
unknown_obje˘s_hash
);

193 i‡(
ö√r_obje˘s
) {

194 
obj
 = 
	`group_¸óã
(
ö√r_obje˘s
);

196 #ifde‡
USE_NEWGROUP


203 
DüObje˘
 *
√wgroup
;

204 
GLi°
 *
obje˘s
;

205 
Poöt
 
lowî_right
;

206 
ty≥
 = 
	`obje˘_gë_ty≥
("Misc - NewGroup");

207 
lowî_right
 = 
obj
->
posôi⁄
;

208 
√wgroup
 = 
ty≥
->
›s
->
	`¸óã
(&
lowî_right
,

209 
NULL
,

210 
NULL
,

211 
NULL
);

212 
li°
 = 
	`g_li°_≠≥nd
÷i°, 
√wgroup
);

214 
obje˘s
 = 
	`group_obje˘s
(
obj
); obje˘†!
NULL
; obje˘†
	`g_li°_√xt
(objects)) {

215 
DüObje˘
 *
subobj
 = (DüObje˘ *Ë
obje˘s
->
d©a
;

216 
li°
 = 
	`g_li°_≠≥nd
÷i°, 
subobj
);

217 
subobj
->
∑ª¡
 = 
√wgroup
;

218 
√wgroup
->
chûdªn
 = 
	`g_li°_≠≥nd
“ewgroup->chûdªn, 
subobj
);

219 i‡(
subobj
->
boundög_box
.
right
 > 
lowî_right
.
x
) {

220 
lowî_right
.
x
 = 
subobj
->
boundög_box
.
right
;

222 i‡(
subobj
->
boundög_box
.
bŸtom
 > 
lowî_right
.
y
) {

223 
lowî_right
.
y
 = 
subobj
->
boundög_box
.
bŸtom
;

226 
√wgroup
->
›s
->
	`move_h™dÀ
“ewgroup,Çewgroup->
h™dÀs
[7],

227 &
lowî_right
, 
NULL
,

228 
HANDLE_MOVE_CREATE_FINAL
, 0);

230 
	`group_de°roy_shÆlow
(
obj
);

233 
li°
 = 
	`g_li°_≠≥nd
÷i°, 
obj
);

240 
obj_node
 = obj_node->
√xt
;

242  
li°
;

243 
	}
}

246 
	$ªad_c⁄√˘i⁄s
(
GLi°
 *
obje˘s
, 
xmlNodePå
 
œyî_node
,

247 
GHashTabÀ
 *
obje˘s_hash
)

249 
Obje˘Node
 
obj_node
;

250 
GLi°
 *
li°
;

251 
xmlNodePå
 
c⁄√˘i⁄s
;

252 
xmlNodePå
 
c⁄√˘i⁄
;

253 *
h™dÀ°r
;

254 *
to°r
;

255 *
c⁄n°r
;

256 
h™dÀ
, 
c⁄n
;

257 
DüObje˘
 *
to
;

259 
li°
 = 
obje˘s
;

260 
obj_node
 = 
œyî_node
->
xmlChûdªnNode
;

261 (
li°
 !
NULL
Ë&& (
obj_node
 != NULL)) {

262 
DüObje˘
 *
obj
 = (DüObje˘ *Ë
li°
->
d©a
;

265 
obj_node
 && (
	`xmlIsBœnkNode
(obj_nodeË|| 
XML_COMMENT_NODE
 =obj_node->
ty≥
))

266 
obj_node
 = obj_node->
√xt
;

267 i‡(!
obj_node
) ;

269 
	`IS_GROUP
(
obj
) {

270 
	`ªad_c⁄√˘i⁄s
(
	`group_obje˘s
(
obj
), 
obj_node
, 
obje˘s_hash
);

272 
gboﬁón
 
brokí
 = 
FALSE
;

274 
gboﬁón
 
w™ts_upd©e
 = 
obj
->
boundög_box
.
right
 >obj->boundög_box.
À·


275 || 
obj
->
boundög_box
.
t›
 >obj->boundög_box.
bŸtom
;

276 
c⁄√˘i⁄s
 = 
obj_node
->
xmlChûdªnNode
;

277 (
c⁄√˘i⁄s
!=
NULL
) &&

278 (
	`xmlSåcmp
(
c⁄√˘i⁄s
->
«me
, (c⁄° 
xmlCh¨
 *)"connections")!=0))

279 
c⁄√˘i⁄s
 = c⁄√˘i⁄s->
√xt
;

280 i‡(
c⁄√˘i⁄s
 !
NULL
) {

281 
c⁄√˘i⁄
 = 
c⁄√˘i⁄s
->
xmlChûdªnNode
;

282 
c⁄√˘i⁄
 !
NULL
) {

283 *
d⁄e°r
;

284 i‡(
	`xmlIsBœnkNode
(
c⁄√˘i⁄
)) {

285 
c⁄√˘i⁄
 = c⁄√˘i⁄->
√xt
;

288 
h™dÀ°r
 = (* )
	`xmlGëPr›
(
c⁄√˘i⁄
, (c⁄° 
xmlCh¨
 *)"handle");

289 
to°r
 = (*Ë
	`xmlGëPr›
(
c⁄√˘i⁄
, (c⁄° 
xmlCh¨
 *)"to");

290 
c⁄n°r
 = (*Ë
	`xmlGëPr›
(
c⁄√˘i⁄
, (c⁄° 
xmlCh¨
 *)"connection");

292 
h™dÀ
 = 
	`©oi
(
h™dÀ°r
);

293 
c⁄n
 = 
	`°πﬁ
(
c⁄n°r
, &
d⁄e°r
, 10);

294 i‡(*
d⁄e°r
 != '\0') {

295 
c⁄n
 = -1;

298 
to
 = 
	`g_hash_èbÀ_lookup
(
obje˘s_hash
, 
to°r
);

300 i‡(
to
 =
NULL
) {

301 
	`mesßge_îr‹
(
	`_
("ErrorÜoading diagram.\n"

303 
brokí
 = 
TRUE
;

304 } i‡(
h™dÀ
 < 0 || h™dÀ >
obj
->
num_h™dÀs
) {

305 
	`mesßge_îr‹
(
	`_
("ErrorÜoading diagram.\n"

307 
h™dÀ
, 
to
->
ty≥
->
«me
);

308 
brokí
 = 
TRUE
;

310 i‡(
c⁄n
 == -1) {

311 
i
;

312 
i
 = 0; i < 
to
->
num_c⁄√˘i⁄s
; i++) {

313 i‡(
to
->
c⁄√˘i⁄s
[
i
]->
«me
 !
NULL
 &&

314 
	`°rcmp
(
to
->
c⁄√˘i⁄s
[
i
]->
«me
, 
c⁄n°r
) == 0) {

315 
c⁄n
 = 
i
;

320 i‡(
c⁄n
 >0 && c⁄¿< 
to
->
num_c⁄√˘i⁄s
) {

321 
	`obje˘_c⁄√˘
(
obj
, obj->
h™dÀs
[
h™dÀ
],

322 
to
->
c⁄√˘i⁄s
[
c⁄n
]);

324 i‡(
w™ts_upd©e
) {

325 
obj
->
h™dÀs
[
h™dÀ
]->
pos
 =

326 
to
->
c⁄√˘i⁄s
[
c⁄n
]->
œ°_pos
 =Åo->c⁄√˘i⁄s[c⁄n]->
pos
;

328 
obj
->
›s
->
	`move_h™dÀ
(obj, obj->
h™dÀs
[
h™dÀ
], &
to
->
c⁄√˘i⁄s
[
c⁄n
]->
pos
,

329 
to
->
c⁄√˘i⁄s
[
c⁄n
], 
HANDLE_MOVE_CONNECTED
,0);

333 
	`mesßge_îr‹
(
	`_
("ErrorÜoading diagram.\n"

335 
c⁄n
, 
to
->
ty≥
->
«me
);

336 
brokí
 = 
TRUE
;

340 i‡(
h™dÀ°r
Ë
	`xmlFªe
(handlestr);

341 i‡(
to°r
Ë
	`xmlFªe
(tostr);

342 i‡(
c⁄n°r
Ë
	`xmlFªe
(connstr);

344 
c⁄√˘i⁄
 = c⁄√˘i⁄->
√xt
;

350 i‡(!
brokí
 && 
obj
 && obj->
›s
->
£t_¥›s
 && 
w™ts_upd©e
) {

352 
obj
->
›s
->
	`move
(obj,&obj->
posôi⁄
);

354 
h™dÀ
 = 0; h™dÀ < 
obj
->
num_h™dÀs
; ++handle) {

355 i‡(
obj
->
h™dÀs
[
h™dÀ
]->
c⁄√˘ed_to
)

356 
obj
->
›s
->
	`move_h™dÀ
(obj, obj->
h™dÀs
[
h™dÀ
], &obj->h™dÀs[h™dÀ]->
pos
,

357 
obj
->
h™dÀs
[
h™dÀ
]->
c⁄√˘ed_to
, 
HANDLE_MOVE_CONNECTED
,0);

364 
c⁄√˘i⁄s
 = 
obj_node
->
xmlChûdªnNode
;

365 (
c⁄√˘i⁄s
!=
NULL
) &&

366 (
	`xmlSåcmp
(
c⁄√˘i⁄s
->
«me
, (c⁄° 
xmlCh¨
 *)"childnode")!=0))

367 
c⁄√˘i⁄s
 = c⁄√˘i⁄s->
√xt
;

368 i‡(
c⁄√˘i⁄s
 !
NULL
) {

369 
to°r
 = (*)
	`xmlGëPr›
(
c⁄√˘i⁄s
, (c⁄° 
xmlCh¨
 *)"parent");

370 i‡(
to°r
) {

371 
obj
->
∑ª¡
 = 
	`g_hash_èbÀ_lookup
(
obje˘s_hash
, 
to°r
);

372 i‡(
obj
->
∑ª¡
 =
NULL
) {

373 
	`mesßge_îr‹
(
	`_
("Can't findÖarent %s of %s object\n"),

374 
to°r
, 
obj
->
ty≥
->
«me
);

376 
obj
->
∑ª¡
->
chûdªn
 = 
	`g_li°_¥ïíd
(obj->parent->children, obj);

381 
li°
 = 
	`g_li°_√xt
(list);

382 
obj_node
 = obj_node->
√xt
;

384 
	}
}

387 
	$hash_‰ì_°rög
(
gpoöãr
 
key
,

388 
gpoöãr
 
vÆue
,

389 
gpoöãr
 
u£r_d©a
)

391 
	`g_‰ì
(
key
);

392 
	}
}

394 
xmlNodePå


395 
	$föd_node_«med
 (
xmlNodePå
 
p
, c⁄° *
«me
)

397 
p
 && 0 !
	`xmlSåcmp
’->
«me
, (
xmlCh¨
 *)name))

398 
p
 =Ö->
√xt
;

399  
p
;

400 
	}
}

402 
gboﬁón


403 
	$dügøm_d©a_lﬂd
(c⁄° *
fûíame
, 
DügømD©a
 *
d©a
, * 
u£r_d©a
)

405 
GHashTabÀ
 *
obje˘s_hash
;

406 
fd
;

407 
GLi°
 *
li°
;

408 
xmlDocPå
 
doc
;

409 
xmlNodePå
 
dügømd©a
;

410 
xmlNodePå
 
∑≥röfo
, 
gridöfo
, 
guideöfo
;

411 
xmlNodePå
 
œyî_node
;

412 
AâribuãNode
 
©å
;

413 
Layî
 *
œyî
;

414 
xmlNsPå
 
«me•a˚
;

415 
gch¨
 
fú°ch¨
;

416 
Dügøm
 *
dügøm
 = 
	`DIA_IS_DIAGRAM
 (
d©a
Ë? 
	`DIA_DIAGRAM
 (d©aË: 
NULL
;

417 
Layî
 *
a˘ive_œyî
 = 
NULL
;

418 
GHashTabÀ
* 
unknown_obje˘s_hash
 = 
	`g_hash_èbÀ_√w
(
g_°r_hash
, 
g_°r_equÆ
);

421 i‡(
	`g_fûe_ã°
 (
fûíame
, 
G_FILE_TEST_IS_DIR
)) {

422 
	`mesßge_îr‹
(
	`_
("You must specifyá file,Çotá directory.\n"));

423  
FALSE
;

426 
fd
 = 
	`g_›í
(
fûíame
, 
O_RDONLY
, 0);

428 i‡(
fd
==-1) {

429 
	`mesßge_îr‹
(
	`_
("Couldn't open: '%s' forÑeading.\n"),

430 
	`dü_mesßge_fûíame
(
fûíame
));

431  
FALSE
;

434 i‡(
	`ªad
(
fd
, &
fú°ch¨
, 1)) {

435 
d©a
->
is_com¥es£d
 = (
fú°ch¨
 != '<');

438 
d©a
->
is_com¥es£d
 = 
¥efs
.
√w_dügøm
.
com¥ess_ßve
;

442 
	`˛o£
(
fd
);

444 
doc
 = 
	`xmlDüP¨£Fûe
(
fûíame
);

446 i‡(
doc
 =
NULL
){

447 
	`mesßge_îr‹
(
	`_
("ErrorÜoading diagram %s.\nUnknown fileÅype."),

448 
	`dü_mesßge_fûíame
(
fûíame
));

449  
FALSE
;

452 i‡(
doc
->
xmlRoŸNode
 =
NULL
) {

453 
	`mesßge_îr‹
(
	`_
("ErrorÜoading diagram %s.\nUnknown fileÅype."),

454 
	`dü_mesßge_fûíame
(
fûíame
));

455 
	`xmlFªeDoc
 (
doc
);

456  
FALSE
;

459 
«me•a˚
 = 
	`xmlSórchNs
(
doc
, doc->
xmlRoŸNode
, (c⁄° 
xmlCh¨
 *)"dia");

460 i‡(
	`xmlSåcmp
 (
doc
->
xmlRoŸNode
->
«me
, (c⁄° 
xmlCh¨
 *)"dügøm"Ë|| (
«me•a˚
 =
NULL
)){

461 
	`mesßge_îr‹
(
	`_
("ErrorÜoading diagram %s.\nNotá Dia file."),

462 
	`dü_mesßge_fûíame
(
fûíame
));

463 
	`xmlFªeDoc
 (
doc
);

464  
FALSE
;

468 
	`g_±r_¨øy_ªmove
(
d©a
->
œyîs
, d©a->
a˘ive_œyî
);

469 
	`œyî_de°roy
(
d©a
->
a˘ive_œyî
);

471 
dügømd©a
 =

472 
	`föd_node_«med
 (
doc
->
xmlRoŸNode
->
xmlChûdªnNode
, "diagramdata");

475 
d©a
->
bg_cﬁ‹
 = 
¥efs
.
√w_dügøm
.bg_color;

476 
©å
 = 
	`composôe_föd_©åibuã
(
dügømd©a
, "background");

477 i‡(
©å
 !
NULL
)

478 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
d©a
->
bg_cﬁ‹
);

480 i‡(
dügøm
) {

481 
dügøm
->
∑gebªak_cﬁ‹
 = 
¥efs
.
√w_dügøm
.pagebreak_color;

482 
©å
 = 
	`composôe_föd_©åibuã
(
dügømd©a
, "pagebreak");

483 i‡(
©å
 !
NULL
)

484 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
dügøm
->
∑gebªak_cﬁ‹
);

487 
©å
 = 
	`composôe_föd_©åibuã
(
dügømd©a
, "paper");

488 i‡(
©å
 !
NULL
) {

489 
∑≥röfo
 = 
	`©åibuã_fú°_d©a
(
©å
);

491 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "name");

492 i‡(
©å
 !
NULL
) {

493 
	`g_‰ì
(
d©a
->
∑≥r
.
«me
);

494 
d©a
->
∑≥r
.
«me
 = 
	`d©a_°rög
(
	`©åibuã_fú°_d©a
(
©å
));

496 i‡(
d©a
->
∑≥r
.
«me
 =
NULL
 || data->paper.name[0] == '\0') {

497 
d©a
->
∑≥r
.
«me
 = 
	`g_°rdup
(
¥efs
.
√w_dügøm
.
∑≥πy≥
);

500 
	`dü_∑ge_œyout_gë_deÁu…_m¨gös
(
d©a
->
∑≥r
.
«me
,

501 &
d©a
->
∑≥r
.
tm¨gö
,

502 &
d©a
->
∑≥r
.
bm¨gö
,

503 &
d©a
->
∑≥r
.
lm¨gö
,

504 &
d©a
->
∑≥r
.
rm¨gö
);

506 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "tmargin");

507 i‡(
©å
 !
NULL
)

508 
d©a
->
∑≥r
.
tm¨gö
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

509 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "bmargin");

510 i‡(
©å
 !
NULL
)

511 
d©a
->
∑≥r
.
bm¨gö
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

512 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "lmargin");

513 i‡(
©å
 !
NULL
)

514 
d©a
->
∑≥r
.
lm¨gö
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

515 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "rmargin");

516 i‡(
©å
 !
NULL
)

517 
d©a
->
∑≥r
.
rm¨gö
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

519 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "is_portrait");

520 
d©a
->
∑≥r
.
is_p‹åaô
 = 
TRUE
;

521 i‡(
©å
 !
NULL
)

522 
d©a
->
∑≥r
.
is_p‹åaô
 = 
	`d©a_boﬁón
(
	`©åibuã_fú°_d©a
(
©å
));

524 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "scaling");

525 
d©a
->
∑≥r
.
sˇlög
 = 1.0;

526 i‡(
©å
 !
NULL
)

527 
d©a
->
∑≥r
.
sˇlög
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

529 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "fitto");

530 
d©a
->
∑≥r
.
fôto
 = 
FALSE
;

531 i‡(
©å
 !
NULL
)

532 
d©a
->
∑≥r
.
fôto
 = 
	`d©a_boﬁón
(
	`©åibuã_fú°_d©a
(
©å
));

534 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "fitwidth");

535 
d©a
->
∑≥r
.
fôwidth
 = 1;

536 i‡(
©å
 !
NULL
)

537 
d©a
->
∑≥r
.
fôwidth
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

539 
©å
 = 
	`composôe_föd_©åibuã
(
∑≥röfo
, "fitheight");

540 
d©a
->
∑≥r
.
fôheight
 = 1;

541 i‡(
©å
 !
NULL
)

542 
d©a
->
∑≥r
.
fôheight
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

545 
	`dü_∑ge_œyout_gë_∑≥r_size
(
d©a
->
∑≥r
.
«me
,

546 &
d©a
->
∑≥r
.
width
,

547 &
d©a
->
∑≥r
.
height
);

548 i‡(!
d©a
->
∑≥r
.
is_p‹åaô
) {

549 
gÊﬂt
 
tmp
 = 
d©a
->
∑≥r
.
width
;

551 
d©a
->
∑≥r
.
width
 = d©a->∑≥r.
height
;

552 
d©a
->
∑≥r
.
height
 = 
tmp
;

554 
d©a
->
∑≥r
.
width
 -d©a->∑≥r.
lm¨gö
;

555 
d©a
->
∑≥r
.
width
 -d©a->∑≥r.
rm¨gö
;

556 
d©a
->
∑≥r
.
height
 -d©a->∑≥r.
tm¨gö
;

557 
d©a
->
∑≥r
.
height
 -d©a->∑≥r.
bm¨gö
;

558 
d©a
->
∑≥r
.
width
 /d©a->∑≥r.
sˇlög
;

559 
d©a
->
∑≥r
.
height
 /d©a->∑≥r.
sˇlög
;

562 i‡(
dügøm
) {

563 
©å
 = 
	`composôe_föd_©åibuã
(
dügømd©a
, "grid");

564 i‡(
©å
 !
NULL
) {

565 
gridöfo
 = 
	`©åibuã_fú°_d©a
(
©å
);

567 
©å
 = 
	`composôe_föd_©åibuã
(
gridöfo
, "width_x");

568 i‡(
©å
 !
NULL
)

569 
dügøm
->
grid
.
width_x
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

570 
©å
 = 
	`composôe_föd_©åibuã
(
gridöfo
, "width_y");

571 i‡(
©å
 !
NULL
)

572 
dügøm
->
grid
.
width_y
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

573 
©å
 = 
	`composôe_föd_©åibuã
(
gridöfo
, "visible_x");

574 i‡(
©å
 !
NULL
)

575 
dügøm
->
grid
.
visibÀ_x
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

576 
©å
 = 
	`composôe_föd_©åibuã
(
gridöfo
, "visible_y");

577 i‡(
©å
 !
NULL
)

578 
dügøm
->
grid
.
visibÀ_y
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

580 
dügøm
->
grid
.
cﬁour
 = 
¥efs
.
√w_dügøm
.
grid_cﬁ‹
;

581 
©å
 = 
	`composôe_föd_©åibuã
(
dügømd©a
, "color");

582 i‡(
©å
 !
NULL
)

583 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
dügøm
->
grid
.
cﬁour
);

586 i‡(
dügøm
) {

587 
©å
 = 
	`composôe_föd_©åibuã
(
dügømd©a
, "guides");

588 i‡(
©å
 !
NULL
) {

589 
guöt
 
i
;

590 
D©aNode
 
guide
;

592 
guideöfo
 = 
	`©åibuã_fú°_d©a
(
©å
);

594 
©å
 = 
	`composôe_föd_©åibuã
(
guideöfo
, "hguides");

595 i‡(
©å
 !
NULL
) {

596 
dügøm
->
guides
.
nhguides
 = 
	`©åibuã_num_d©a
(
©å
);

597 
	`g_‰ì
(
dügøm
->
guides
.
hguides
);

598 
dügøm
->
guides
.
hguides
 = 
	`g_√w
(
ªÆ
, dügøm->guides.
nhguides
);

600 
guide
 = 
	`©åibuã_fú°_d©a
(
©å
);

601 
i
 = 0; i < 
dügøm
->
guides
.
nhguides
; i++, 
guide
 = 
	`d©a_√xt
(guide))

602 
dügøm
->
guides
.
hguides
[
i
] = 
	`d©a_ªÆ
(
guide
);

604 
©å
 = 
	`composôe_föd_©åibuã
(
guideöfo
, "vguides");

605 i‡(
©å
 !
NULL
) {

606 
dügøm
->
guides
.
nvguides
 = 
	`©åibuã_num_d©a
(
©å
);

607 
	`g_‰ì
(
dügøm
->
guides
.
vguides
);

608 
dügøm
->
guides
.
vguides
 = 
	`g_√w
(
ªÆ
, dügøm->guides.
nvguides
);

610 
guide
 = 
	`©åibuã_fú°_d©a
(
©å
);

611 
i
 = 0; i < 
dügøm
->
guides
.
nvguides
; i++, 
guide
 = 
	`d©a_√xt
(guide))

612 
dügøm
->
guides
.
vguides
[
i
] = 
	`d©a_ªÆ
(
guide
);

618 
œyî_node
 =

619 
	`föd_node_«med
 (
doc
->
xmlRoŸNode
->
xmlChûdªnNode
, "layer");

621 
obje˘s_hash
 = 
	`g_hash_èbÀ_√w
(
g_°r_hash
, 
g_°r_equÆ
);

623 
œyî_node
 !
NULL
) {

624 
gch¨
 *
«me
;

625 *
visibÀ
;

626 *
a˘ive
;

628 i‡(
	`xmlIsBœnkNode
(
œyî_node
)) {

629 
œyî_node
 =Üayî_node->
√xt
;

633 i‡(!
œyî_node
) ;

635 
«me
 = (*)
	`xmlGëPr›
(
œyî_node
, (c⁄° 
xmlCh¨
 *)"name");

636 i‡(!
«me
) ;

638 
œyî
 = 
	`√w_œyî
(
	`g_°rdup
(
«me
), 
d©a
);

639 i‡(
«me
Ë
	`xmlFªe
(name);

641 
œyî
->
visibÀ
 = 
FALSE
;

642 
visibÀ
 = (*)
	`xmlGëPr›
(
œyî_node
, (c⁄° 
xmlCh¨
 *)"visible");

643 i‡(
visibÀ
) {

644 i‡(
	`°rcmp
(
visibÀ
, "true")==0)

645 
œyî
->
visibÀ
 = 
TRUE
;

646 
	`xmlFªe
(
visibÀ
);

650 
li°
 = 
	`ªad_obje˘s
(
œyî_node
, 
obje˘s_hash
, 
fûíame
, 
NULL
, 
unknown_obje˘s_hash
);

651 
	`œyî_add_obje˘s
 (
œyî
, 
li°
);

652 
	`ªad_c⁄√˘i⁄s
–
li°
, 
œyî_node
, 
obje˘s_hash
);

654 
	`d©a_add_œyî
(
d©a
, 
œyî
);

656 
a˘ive
 = (*)
	`xmlGëPr›
(
œyî_node
, (c⁄° 
xmlCh¨
 *)"active");

657 i‡(
a˘ive
) {

658 i‡(
	`°rcmp
(
a˘ive
, "true")==0)

659 
a˘ive_œyî
 = 
œyî
;

660 
	`xmlFªe
(
a˘ive
);

663 
œyî_node
 =Üayî_node->
√xt
;

666 i‡(!
a˘ive_œyî
)

667 
d©a
->
a˘ive_œyî
 = (
Layî
 *Ë
	`g_±r_¨øy_ödex
(d©a->
œyîs
, 0);

669 
	`d©a_£t_a˘ive_œyî
(
d©a
, 
a˘ive_œyî
);

671 
	`xmlFªeDoc
(
doc
);

673 
	`g_hash_èbÀ_f‹óch
(
obje˘s_hash
, 
hash_‰ì_°rög
, 
NULL
);

675 
	`g_hash_èbÀ_de°roy
(
obje˘s_hash
);

677 i‡(
d©a
->
œyîs
->
Àn
 < 1) {

678 
	`mesßge_îr‹
 (
	`_
("ErrorÜoading diagram:\n%s.\n"

680 
	`dü_mesßge_fûíame
(
fûíame
));

681  
FALSE
;

682 } i‡(0 < 
	`g_hash_èbÀ_size
(
unknown_obje˘s_hash
)) {

683 
GSåög
* 
unknown_°r
 = 
	`g_°rög_√w
("UnknownÅypes whileÑeading diagram file");

686 
	`g_hash_èbÀ_f‹óch
(
unknown_obje˘s_hash
,

687 
GHFuncUnknownObje˘s
,

688 
unknown_°r
);

689 
	`mesßge_w¨nög
("%s", 
unknown_°r
->
°r
);

690 
	`g_°rög_‰ì
(
unknown_°r
, 
TRUE
);

692 
	`g_hash_èbÀ_de°roy
(
unknown_obje˘s_hash
);

694  
TRUE
;

695 
	}
}

697 
gboﬁón


698 
	$wrôe_obje˘s
(
GLi°
 *
obje˘s
, 
xmlNodePå
 
obje˘s_node
,

699 
GHashTabÀ
 *
obje˘s_hash
, *
obj_ƒ
, c⁄° *
fûíame
)

701 
buf„r
[31];

702 
Obje˘Node
 
obj_node
;

703 
xmlNodePå
 
group_node
;

704 
GLi°
 *
li°
;

706 
li°
 = 
obje˘s
;

707 
li°
 !
NULL
) {

708 
DüObje˘
 *
obj
 = (DüObje˘ *Ë
li°
->
d©a
;

710 i‡(
	`g_hash_èbÀ_lookup
(
obje˘s_hash
, 
obj
))

712 
li°
 = 
	`g_li°_√xt
(list);

716 i‡(
	`IS_GROUP
(
obj
Ë&& 
	`group_obje˘s
(objË!
NULL
) {

717 
group_node
 = 
	`xmlNewChûd
(
obje˘s_node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"group", NULL);

718 
	`wrôe_obje˘s
(
	`group_obje˘s
(
obj
), 
group_node
,

719 
obje˘s_hash
, 
obj_ƒ
, 
fûíame
);

721 
obj_node
 = 
	`xmlNewChûd
(
obje˘s_node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"object", NULL);

723 
	`xmlSëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"ty≥", (xmlCh¨ *)
obj
->
ty≥
->
«me
);

724 
	`g_¢¥ötf
(
buf„r
, 30, "%d", 
obj
->
ty≥
->
vîsi⁄
);

725 
	`xmlSëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"vîsi⁄", (xmlCh¨ *)
buf„r
);

727 
	`g_¢¥ötf
(
buf„r
, 30, "O%d", *
obj_ƒ
);

728 
	`xmlSëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"id", (xmlCh¨ *)
buf„r
);

730 (*
obj
->
ty≥
->
›s
->
ßve
)(obj, 
obj_node
, 
fûíame
);

733 
	`g_hash_èbÀ_ö£π
(
obje˘s_hash
, 
obj
, 
	`GINT_TO_POINTER
(*
obj_ƒ
));

734 (*
obj_ƒ
)++;

748 
li°
 = 
	`g_li°_√xt
(list);

750  
TRUE
;

751 
	}
}

757 
gboﬁón


758 
	$wrôe_c⁄√˘i⁄s
(
GLi°
 *
obje˘s
, 
xmlNodePå
 
œyî_node
,

759 
GHashTabÀ
 *
obje˘s_hash
)

761 
Obje˘Node
 
obj_node
;

762 
GLi°
 *
li°
;

763 
xmlNodePå
 
c⁄√˘i⁄s
;

764 
xmlNodePå
 
c⁄√˘i⁄
;

765 
buf„r
[31];

766 
i
;

768 
li°
 = 
obje˘s
;

769 
obj_node
 = 
œyî_node
->
xmlChûdªnNode
;

770 (
li°
 !
NULL
Ë&& (
obj_node
 != NULL)) {

771 
DüObje˘
 *
obj
 = (DüObje˘ *Ë
li°
->
d©a
;

773 
obj_node
 && 
	`xmlIsBœnkNode
(obj_node)Ëobj_nodêobj_node->
√xt
;

774 i‡(!
obj_node
) ;

776 
	`IS_GROUP
(
obj
) {

777 
	`wrôe_c⁄√˘i⁄s
(
	`group_obje˘s
(
obj
), 
obj_node
, 
obje˘s_hash
);

779 
c⁄√˘i⁄s
 = 
NULL
;

781 
i
=0;i<
obj
->
num_h™dÀs
;i++) {

782 
C⁄√˘i⁄Poöt
 *
c⁄_poöt
;

783 
H™dÀ
 *
h™dÀ
;

785 
h™dÀ
 = 
obj
->
h™dÀs
[
i
];

786 
c⁄_poöt
 = 
h™dÀ
->
c⁄√˘ed_to
;

788 i‡–
c⁄_poöt
 !
NULL
 ) {

789 
DüObje˘
 *
Ÿhî_obj
;

790 
c⁄_poöt_ƒ
;

792 
Ÿhî_obj
 = 
c⁄_poöt
->
obje˘
;

794 
c⁄_poöt_ƒ
=0;

795 
Ÿhî_obj
->
c⁄√˘i⁄s
[
c⁄_poöt_ƒ
] !
c⁄_poöt
) {

796 
c⁄_poöt_ƒ
++;

797 i‡(
c⁄_poöt_ƒ
>=
Ÿhî_obj
->
num_c⁄√˘i⁄s
) {

798 
	`mesßge_îr‹
("InternalÉrror saving diagram\n con_point_nr >= other_obj->num_connections\n");

799  
FALSE
;

803 i‡(
c⁄√˘i⁄s
 =
NULL
)

804 
c⁄√˘i⁄s
 = 
	`xmlNewChûd
(
obj_node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"connections", NULL);

806 
c⁄√˘i⁄
 = 
	`xmlNewChûd
(
c⁄√˘i⁄s
, 
NULL
, (c⁄° 
xmlCh¨
 *)"connection", NULL);

808 
	`g_¢¥ötf
(
buf„r
, 30, "%d", 
i
);

809 
	`xmlSëPr›
(
c⁄√˘i⁄
, (c⁄° 
xmlCh¨
 *)"h™dÀ", (xmlCh¨ *)
buf„r
);

811 
	`g_¢¥ötf
(
buf„r
, 30, "O%d",

812 
	`GPOINTER_TO_INT
(
	`g_hash_èbÀ_lookup
(
obje˘s_hash
,

813 
Ÿhî_obj
)));

815 
	`xmlSëPr›
(
c⁄√˘i⁄
, (c⁄° 
xmlCh¨
 *)"to", (xmlCh¨ *Ë
buf„r
);

817 i‡(
Ÿhî_obj
->
c⁄√˘i⁄s
[
c⁄_poöt_ƒ
]->
«me
 !
NULL
) {

818 
	`g_¢¥ötf
(
buf„r
, 30, "%s", 
Ÿhî_obj
->
c⁄√˘i⁄s
[
c⁄_poöt_ƒ
]->
«me
);

820 
	`g_¢¥ötf
(
buf„r
, 30, "%d", 
c⁄_poöt_ƒ
);

822 
	`xmlSëPr›
(
c⁄√˘i⁄
, (c⁄° 
xmlCh¨
 *)"c⁄√˘i⁄", (xmlCh¨ *Ë
buf„r
);

827 i‡(
obj
->
∑ª¡
) {

828 
DüObje˘
 *
Ÿhî_obj
 = 
obj
->
∑ª¡
;

829 
xmlNodePå
 
∑ª¡
;

830 
	`g_¢¥ötf
(
buf„r
, 30, "O%d",

831 
	`GPOINTER_TO_INT
(
	`g_hash_èbÀ_lookup
(
obje˘s_hash
, 
Ÿhî_obj
)));

832 
∑ª¡
 = 
	`xmlNewChûd
(
obj_node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"childnode", NULL);

833 
	`xmlSëPr›
(
∑ª¡
, (c⁄° 
xmlCh¨
 *)"∑ª¡", (xmlCh¨ *)
buf„r
);

836 
li°
 = 
	`g_li°_√xt
(list);

837 
obj_node
 = obj_node->
√xt
;

839  
TRUE
;

840 
	}
}

843 
xmlDocPå


844 
	$dügøm_d©a_wrôe_doc
(
DügømD©a
 *
d©a
, c⁄° *
fûíame
)

846 
xmlDocPå
 
doc
;

847 
xmlNodePå
 
åì
;

848 
xmlNodePå
 
∑geöfo
, 
gridöfo
, 
guideöfo
;

849 
xmlNodePå
 
œyî_node
;

850 
GHashTabÀ
 *
obje˘s_hash
;

851 
gboﬁón
 
ªs
;

852 
obj_ƒ
;

853 
guöt
 
i
;

854 
Layî
 *
œyî
;

855 
AâribuãNode
 
©å
;

856 
xmlNs
 *
«me_•a˚
;

857 
Dügøm
 *
dügøm
 = 
	`DIA_IS_DIAGRAM
 (
d©a
Ë? 
	`DIA_DIAGRAM
 (d©aË: 
NULL
;

859 
doc
 = 
	`xmlNewDoc
((c⁄° 
xmlCh¨
 *)"1.0");

860 
doc
->
ícodög
 = 
	`xmlSådup
((c⁄° 
xmlCh¨
 *)"UTF-8");

861 
doc
->
xmlRoŸNode
 = 
	`xmlNewDocNode
(doc, 
NULL
, (c⁄° 
xmlCh¨
 *)"diagram", NULL);

863 
«me_•a˚
 = 
	`xmlNewNs
(
doc
->
xmlRoŸNode
,

864 (c⁄° 
xmlCh¨
 *)
DIA_XML_NAME_SPACE_BASE
,

865 (c⁄° 
xmlCh¨
 *)"dia");

866 
	`xmlSëNs
(
doc
->
xmlRoŸNode
, 
«me_•a˚
);

868 
åì
 = 
	`xmlNewChûd
(
doc
->
xmlRoŸNode
, 
«me_•a˚
, (c⁄° 
xmlCh¨
 *)"dügømd©a", 
NULL
);

870 
©å
 = 
	`√w_©åibuã
((
Obje˘Node
)
åì
, "background");

871 
	`d©a_add_cﬁ‹
(
©å
, &
d©a
->
bg_cﬁ‹
);

873 i‡(
dügøm
) {

874 
©å
 = 
	`√w_©åibuã
((
Obje˘Node
)
åì
, "pagebreak");

875 
	`d©a_add_cﬁ‹
(
©å
, &
dügøm
->
∑gebªak_cﬁ‹
);

877 
©å
 = 
	`√w_©åibuã
((
Obje˘Node
)
åì
, "paper");

878 
∑geöfo
 = 
	`d©a_add_composôe
(
©å
, "paper");

879 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
∑geöfo
, "name"),

880 
d©a
->
∑≥r
.
«me
);

881 
	`d©a_add_ªÆ
(
	`composôe_add_©åibuã
(
∑geöfo
, "tmargin"),

882 
d©a
->
∑≥r
.
tm¨gö
);

883 
	`d©a_add_ªÆ
(
	`composôe_add_©åibuã
(
∑geöfo
, "bmargin"),

884 
d©a
->
∑≥r
.
bm¨gö
);

885 
	`d©a_add_ªÆ
(
	`composôe_add_©åibuã
(
∑geöfo
, "lmargin"),

886 
d©a
->
∑≥r
.
lm¨gö
);

887 
	`d©a_add_ªÆ
(
	`composôe_add_©åibuã
(
∑geöfo
, "rmargin"),

888 
d©a
->
∑≥r
.
rm¨gö
);

889 
	`d©a_add_boﬁón
(
	`composôe_add_©åibuã
(
∑geöfo
, "is_portrait"),

890 
d©a
->
∑≥r
.
is_p‹åaô
);

891 
	`d©a_add_ªÆ
(
	`composôe_add_©åibuã
(
∑geöfo
, "scaling"),

892 
d©a
->
∑≥r
.
sˇlög
);

893 
	`d©a_add_boﬁón
(
	`composôe_add_©åibuã
(
∑geöfo
, "fitto"),

894 
d©a
->
∑≥r
.
fôto
);

895 i‡(
d©a
->
∑≥r
.
fôto
) {

896 
	`d©a_add_öt
(
	`composôe_add_©åibuã
(
∑geöfo
, "fitwidth"),

897 
d©a
->
∑≥r
.
fôwidth
);

898 
	`d©a_add_öt
(
	`composôe_add_©åibuã
(
∑geöfo
, "fitheight"),

899 
d©a
->
∑≥r
.
fôheight
);

902 i‡(
dügøm
) {

903 
©å
 = 
	`√w_©åibuã
((
Obje˘Node
)
åì
, "grid");

904 
gridöfo
 = 
	`d©a_add_composôe
(
©å
, "grid");

905 
	`d©a_add_ªÆ
(
	`composôe_add_©åibuã
(
gridöfo
, "width_x"),

906 
dügøm
->
grid
.
width_x
);

907 
	`d©a_add_ªÆ
(
	`composôe_add_©åibuã
(
gridöfo
, "width_y"),

908 
dügøm
->
grid
.
width_y
);

909 
	`d©a_add_öt
(
	`composôe_add_©åibuã
(
gridöfo
, "visible_x"),

910 
dügøm
->
grid
.
visibÀ_x
);

911 
	`d©a_add_öt
(
	`composôe_add_©åibuã
(
gridöfo
, "visible_y"),

912 
dügøm
->
grid
.
visibÀ_y
);

913 
©å
 = 
	`√w_©åibuã
((
Obje˘Node
)
åì
, "color");

914 
	`d©a_add_composôe
(
gridöfo
, "color");

915 
	`d©a_add_cﬁ‹
(
©å
, &
dügøm
->
grid
.
cﬁour
);

917 
©å
 = 
	`√w_©åibuã
((
Obje˘Node
)
åì
, "guides");

918 
guideöfo
 = 
	`d©a_add_composôe
(
©å
, "guides");

919 
©å
 = 
	`composôe_add_©åibuã
(
guideöfo
, "hguides");

920 
i
 = 0; i < 
dügøm
->
guides
.
nhguides
; i++)

921 
	`d©a_add_ªÆ
(
©å
, 
dügøm
->
guides
.
hguides
[
i
]);

922 
©å
 = 
	`composôe_add_©åibuã
(
guideöfo
, "vguides");

923 
i
 = 0; i < 
dügøm
->
guides
.
nvguides
; i++)

924 
	`d©a_add_ªÆ
(
©å
, 
dügøm
->
guides
.
vguides
[
i
]);

927 
obje˘s_hash
 = 
	`g_hash_èbÀ_√w
(
g_dúe˘_hash
, 
g_dúe˘_equÆ
);

929 
obj_ƒ
 = 0;

931 
i
 = 0; i < 
d©a
->
œyîs
->
Àn
; i++) {

932 
œyî_node
 = 
	`xmlNewChûd
(
doc
->
xmlRoŸNode
, 
«me_•a˚
, (c⁄° 
xmlCh¨
 *)"œyî", 
NULL
);

933 
œyî
 = (
Layî
 *Ë
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
);

934 
	`xmlSëPr›
(
œyî_node
, (c⁄° 
xmlCh¨
 *)"«me", (xmlCh¨ *)
œyî
->
«me
);

936 i‡(
œyî
->
visibÀ
)

937 
	`xmlSëPr›
(
œyî_node
, (c⁄° 
xmlCh¨
 *)"visible", (const xmlChar *)"true");

939 
	`xmlSëPr›
(
œyî_node
, (c⁄° 
xmlCh¨
 *)"visible", (const xmlChar *)"false");

941 i‡(
œyî
 =
d©a
->
a˘ive_œyî
)

942 
	`xmlSëPr›
(
œyî_node
, (c⁄° 
xmlCh¨
 *)"active", (const xmlChar *)"true");

944 
	`wrôe_obje˘s
(
œyî
->
obje˘s
, 
œyî_node
,

945 
obje˘s_hash
, &
obj_ƒ
, 
fûíame
);

947 
ªs
 = 
	`wrôe_c⁄√˘i⁄s
(
œyî
->
obje˘s
, 
œyî_node
, 
obje˘s_hash
);

949 i‡(!
ªs
)

950  
NULL
;

952 
	`g_hash_èbÀ_de°roy
(
obje˘s_hash
);

954 i‡(
d©a
->
is_com¥es£d
)

955 
	`xmlSëDocCom¥essMode
(
doc
, 9);

957 
	`xmlSëDocCom¥essMode
(
doc
, 0);

959  
doc
;

960 
	}
}

966 
	$dügøm_d©a_øw_ßve
(
DügømD©a
 *
d©a
, c⁄° *
fûíame
)

968 
xmlDocPå
 
doc
;

969 
ªt
;

971 
doc
 = 
	`dügøm_d©a_wrôe_doc
(
d©a
, 
fûíame
);

973 
ªt
 = 
	`xmlDüSaveFûe
 (
fûíame
, 
doc
);

974 
	`xmlFªeDoc
(
doc
);

976  
ªt
;

977 
	}
}

986 
	$dügøm_d©a_ßve
(
DügømD©a
 *
d©a
, c⁄° *
u£r_fûíame
)

988 
FILE
 *
fûe
;

989 *
bak«me
=
NULL
,*
tm≤ame
=NULL,*
dú«me
=NULL,*
p
;

990 *
fûíame
 = (*)
u£r_fûíame
;

991 
mode
,
_umask
;

992 
fûdes
;

993 
ªt
 = 0;

996 #i‡
	`GLIB_CHECK_VERSION
(2,8,0Ë&& !
deföed
 
G_OS_WIN32


999 i‡–
	`g_fûe_ã°
(
fûíame
, 
G_FILE_TEST_EXISTS
)

1000 && 
	`g_ac˚ss
(
fûíame
, 
W_OK
) != 0) {

1001 
	`mesßge_îr‹
(
	`_
("NotállowedÅo writeÅo output file %s\n"),

1002 
	`dü_mesßge_fûíame
(
fûíame
));

1003 
CLEANUP
;

1007 i‡(
	`g_fûe_ã°
(
u£r_fûíame
, 
G_FILE_TEST_IS_SYMLINK
)) {

1008 
GEº‹
 *
îr‹
 = 
NULL
;

1009 
fûíame
 = 
	`g_fûe_ªad_lök
(
u£r_fûíame
, &
îr‹
);

1010 i‡(!
fûíame
) {

1011 
	`mesßge_îr‹
("%s", 
îr‹
->
mesßge
);

1012 
	`g_îr‹_‰ì
(
îr‹
);

1013 
CLEANUP
;

1018 
dú«me
 = 
	`g_°rdup
(
fûíame
);

1019 
p
 = 
	`°ºchr
((*)
dú«me
,
G_DIR_SEPARATOR
);

1020 i‡(
p
) {

1021 *(
p
+1) = 0;

1023 
	`g_‰ì
(
dú«me
);

1024 
dú«me
 = 
	`g_°rdup
("." 
G_DIR_SEPARATOR_S
);

1026 
tm≤ame
 = 
	`g_°rc⁄ˇt
(
dú«me
,"__düXXXXXX",
NULL
);

1027 
bak«me
 = 
	`g_°rc⁄ˇt
(
fûíame
,"~",
NULL
);

1029 #i‡
	`GLIB_CHECK_VERSION
(2,8,0Ë&& !
deföed
 
G_OS_WIN32


1031 i‡–
	`g_fûe_ã°
(
dú«me
, 
G_FILE_TEST_EXISTS
)

1032 && 
	`g_ac˚ss
(
dú«me
, 
W_OK
) != 0) {

1033 
	`mesßge_îr‹
(
	`_
("NotállowedÅo writeÅemporary files in %s\n"),

1034 
	`dü_mesßge_fûíame
(
dú«me
));

1035 
CLEANUP
;

1041 
fûdes
 = 
	`g_mk°emp
(
tm≤ame
);

1043 
_umask
 = 
	`umask
(0); umask(_umask);

1044 
mode
 = 0666 & ~
_umask
;

1045 #i‚de‡
G_OS_WIN32


1046 
ªt
 = 
	`fchmod
(
fûdes
,
mode
);

1048 
ªt
 = 0;

1050 
fûe
 = 
	`fd›í
(
fûdes
,"wb");

1054 i‡(
fûe
==
NULL
) {

1055 
	`mesßge_îr‹
(
	`_
("Can't open output file %s: %s\n"),

1056 
	`dü_mesßge_fûíame
(
tm≤ame
), 
	`°ªº‹
(
î∫o
));

1057 
CLEANUP
;

1059 
	`f˛o£
(
fûe
);

1061 
ªt
 = 
	`dügøm_d©a_øw_ßve
(
d©a
, 
tm≤ame
);

1063 i‡(
ªt
 < 0) {

1066 
	`mesßge_îr‹
(
	`_
("InternalÉrror %d writing file %s\n"),

1067 
ªt
, 
	`dü_mesßge_fûíame
(
tm≤ame
));

1068 
	`g_u∆ök
(
tm≤ame
);

1069 
CLEANUP
;

1073 
	`g_u∆ök
(
bak«me
);

1074 
	`g_ª«me
(
fûíame
,
bak«me
);

1075 
ªt
 = 
	`g_ª«me
(
tm≤ame
,
fûíame
);

1076 i‡(
ªt
 < 0) {

1077 
	`mesßge_îr‹
(
	`_
("Can'tÑename %sÅo final output file %s: %s\n"),

1078 
	`dü_mesßge_fûíame
(
fûíame
),

1079 
	`dü_mesßge_fûíame
(
fûíame
), 
	`°ªº‹
(
î∫o
));

1081 
CLEANUP
:

1082 i‡(
fûíame
 !
u£r_fûíame
)

1083 
	`g_‰ì
(
fûíame
);

1084 
	`g_‰ì
(
tm≤ame
);

1085 
	`g_‰ì
(
dú«me
);

1086 
	`g_‰ì
(
bak«me
);

1087  (
ªt
?
FALSE
:
TRUE
);

1088 
	}
}

1091 
	$dügøm_ßve
(
Dügøm
 *
dü
, c⁄° *
fûíame
)

1093 
gboﬁón
 
ªs
 = 
	`dügøm_d©a_ßve
(
dü
->
d©a
, 
fûíame
);

1095 i‡(!
ªs
) {

1096  
ªs
;

1099 
dü
->
unßved
 = 
FALSE
;

1100 
	`undo_m¨k_ßve
(
dü
->
undo
);

1101 
	`dügøm_£t_modifõd
 (
dü
, 
FALSE
);

1103 
	`dügøm_˛ónup_autoßve
(
dü
);

1105  
TRUE
;

1106 
	}
}

1110 
	$dügøm_˛ónup_autoßve
(
Dügøm
 *
dü
)

1112 
gch¨
 *
ßvefûe
;

1113 
°©
 
°©buf
;

1115 
ßvefûe
 = 
dü
->
autoßvefûíame
;

1116 i‡(
ßvefûe
 =
NULL
) ;

1117 #ifde‡
TRACES


1118 
	`g_¥öt
("Cleaning upáutosave %s for %s\n",

1119 
ßvefûe
, 
dü
->
fûíame
 ? dia->filename : "<noÇame>");

1121 i‡(
	`g_°©
(
ßvefûe
, &
°©buf
) == 0) {

1122 
	`g_u∆ök
(
ßvefûe
);

1124 
	`g_‰ì
(
ßvefûe
);

1125 
dü
->
autoßvefûíame
 = 
NULL
;

1126 
dü
->
autoßved
 = 
FALSE
;

1127 
	}
}

1133 
	$dügøm_autoßve
(
Dügøm
 *
dü
)

1135 
gch¨
 *
ßve_fûíame
;

1138 
GLi°
 *
dügøms
 = 
	`dü_›í_dügøms
();

1139 
Dügøm
 *
dügøm
;

1140 
dügøms
 !
NULL
) {

1141 
dügøm
 = (
Dügøm
 *)
dügøms
->
d©a
;

1142 i‡(
dügøm
 =
dü
 &&

1143 
	`dügøm_is_modifõd
(
dügøm
) &&

1144 !
dügøm
->
autoßved
) {

1145 
ßve_fûíame
 = 
	`g_°rdup_¥ötf
("%s.autoßve", 
dü
->
fûíame
);

1147 i‡(
dü
->
autoßvefûíame
 !
NULL
)

1148 
	`g_‰ì
(
dü
->
autoßvefûíame
);

1149 
dü
->
autoßvefûíame
 = 
ßve_fûíame
;

1150 
	`dügøm_d©a_øw_ßve
(
dü
->
d©a
, 
ßve_fûíame
);

1151 
dü
->
autoßved
 = 
TRUE
;

1154 
dügøms
 = 
	`g_li°_√xt
(diagrams);

1156 
	}
}

1160 
	$exp‹t_«tive
(
DügømD©a
 *
d©a
, c⁄° 
gch¨
 *
fûíame
,

1161 c⁄° 
gch¨
 *
düfûíame
, * 
u£r_d©a
)

1163 
	`dügøm_d©a_ßve
(
d©a
, 
fûíame
);

1164 
	}
}

1166 c⁄° 
gch¨
 *
	gexãnsi⁄s
[] = { "dü", 
NULL
 };

1167 
DüExp‹tFûãr
 
	gdü_exp‹t_fûãr
 = {

1168 
N_
("Dia Diagram File"),

1169 
exãnsi⁄s
,

1170 
exp‹t_«tive


1172 
DIAVAR
 
DüImp‹tFûãr
 
	gdü_imp‹t_fûãr
 = {

1173 
N_
("Dia Diagram File"),

1174 
exãnsi⁄s
,

1175 
dügøm_d©a_lﬂd


	@O:\tool\dvs50\app\load_save.h

18 #i‚de‡
LOAD_SAVE_H


19 
	#LOAD_SAVE_H


	)

21 
	~"dügøm.h
"

22 
	~"fûãr.h
"

24 
dügøm_ßve
(
Dügøm
 *
dü
, c⁄° *
fûíame
);

25 
dügøm_autoßve
(
Dügøm
 *
dü
);

26 
dügøm_˛ónup_autoßve
(
Dügøm
 *
dü
);

28 
DüExp‹tFûãr
 
dü_exp‹t_fûãr
;

29 
DüImp‹tFûãr
 
dü_imp‹t_fûãr
;

	@O:\tool\dvs50\app\magnify.c

18 
	~<c⁄fig.h
>

19 
	~<°dlib.h
>

20 
	~<m©h.h
>

22 
	~"magnify.h
"

23 
	~"curs‹.h
"

26 
	$magnify_buâ⁄_¥ess
(
MagnifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

27 
DDi•œy
 *
ddi•
)

29 
toﬁ
->
x
 =Åoﬁ->
ﬁdx
 = 
evít
->x;

30 
toﬁ
->
y
 =Åoﬁ->
ﬁdy
 = 
evít
->y;

31 
toﬁ
->
box_a˘ive
 = 
TRUE
;

32 
toﬁ
->
moved
 = 
FALSE
;

33 
	`gdk_poöãr_gøb
 (
ddi•
->
ˇnvas
->
wödow
, 
FALSE
,

34 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

35 
NULL
, NULL, 
evít
->
time
);

36 
	}
}

39 
	$magnify_buâ⁄_ªÀa£
(
MagnifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

40 
DDi•œy
 *
ddi•
)

42 
Re˘™gÀ
 *
visibÀ
;

43 
Poöt
 
p1
, 
p2
, 
é
;

44 
ªÆ
 
diff
;

45 
idiff
;

46 
ªÆ
 
Á˘‹
;

48 
toﬁ
->
box_a˘ive
 = 
FALSE
;

50 
visibÀ
 = &
ddi•
->visible;

52 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
, 
toﬁ
->
x
,Åoﬁ->
y
, &
p1
.x, &p1.y);

53 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
, 
evít
->
x
,Évít->
y
, &
p2
.x, &p2.y);

55 
é
.
x
 = 
	`MIN
(
p1
.x, 
p2
.x);

56 
é
.
y
 = 
	`MIN
(
p1
.y, 
p2
.y);

58 
diff
 = 
	`MAX
(
	`Ábs
(
p2
.
x
 - 
p1
.x), fabs’2.
y
 -Ö1.y));

59 
idiff
 = 
	`MAX
(
	`abs
(
toﬁ
->
x
 - 
evít
->x),ábs—oﬁ->
y
 -Évent->y));

61 i‡(
toﬁ
->
moved
) {

62 i‡(
idiff
 <= 4) {

63 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

64 
	`ddi•œy_Êush
(
ddi•
);

65 } i‡(!(
evít
->
°©e
 & 
GDK_CONTROL_MASK
)) {

66 
Á˘‹
 = (
visibÀ
->
right
 - visibÀ->
À·
Ë/ 
diff
;

67 
é
.
x
 +(
visibÀ
->
right
 - visibÀ->
À·
)/(2.0*
Á˘‹
);

68 
é
.
y
 +(
visibÀ
->
bŸtom
 - visibÀ->
t›
)/(2.0*
Á˘‹
);

69 
	`ddi•œy_zoom
(
ddi•
, &
é
, 
Á˘‹
);

71 
Á˘‹
 = 
diff
 / (
visibÀ
->
right
 - visibÀ->
À·
);

72 
é
.
x
 =Ål.x * 
Á˘‹
 +Ål.x;

73 
é
.
y
 =Ål.y * 
Á˘‹
 +Ål.y;

74 
	`ddi•œy_zoom
(
ddi•
, &
é
, 
Á˘‹
);

77 i‡(
evít
->
°©e
 & 
GDK_SHIFT_MASK
)

78 
	`ddi•œy_zoom
(
ddi•
, &
é
, 0.5);

80 
	`ddi•œy_zoom
(
ddi•
, &
é
, 2.0);

83 
	`gdk_poöãr_ungøb
 (
evít
->
time
);

84 
	}
}

86 
	sötPoöt
 { 
	mx
,
	my
; } 
	tötPoöt
;

89 
	$magnify_mŸi⁄
(
MagnifyToﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

90 
DDi•œy
 *
ddi•
)

92 
ötPoöt
 
é
, 
br
;

94 i‡(
toﬁ
->
box_a˘ive
) {

95 
toﬁ
->
moved
 = 
TRUE
;

97 i‡(
toﬁ
->
gc
 =
NULL
) {

98 
toﬁ
->
gc
 = 
	`gdk_gc_√w
(
ddi•
->
ˇnvas
->
wödow
);

99 
	`gdk_gc_£t_löe_©åibuãs
(
toﬁ
->
gc
, 1, 
GDK_LINE_ON_OFF_DASH
,

100 
GDK_CAP_BUTT
, 
GDK_JOIN_MITER
);

101 
	`gdk_gc_£t_f‹eground
(
toﬁ
->
gc
, &
cﬁ‹_gdk_whôe
);

102 
	`gdk_gc_£t_fun˘i⁄
(
toﬁ
->
gc
, 
GDK_XOR
);

105 
é
.
x
 = 
	`MIN
(
toﬁ
->x,Åoﬁ->
ﬁdx
);Ål.
y
 = MIN—oﬁ->y,Åoﬁ->
ﬁdy
);

106 
br
.
x
 = 
	`MAX
(
toﬁ
->x,Åoﬁ->
ﬁdx
); br.
y
 = MAX—oﬁ->y,Åoﬁ->
ﬁdy
);

108 
	`gdk_døw_ª˘™gÀ
 (
ddi•
->
ˇnvas
->
wödow
,

109 
toﬁ
->
gc
, 
FALSE
, 
é
.
x
,Ål.
y
, 
br
.x -Ål.x, br.y -Ål.y);

111 
é
.
x
 = 
	`MIN
(
toﬁ
->x, 
evít
->x);Ål.
y
 = MIN(tool->y,Évent->y);

112 
br
.
x
 = 
	`MAX
(
toﬁ
->x, 
evít
->x); br.
y
 = MAX(tool->y,Évent->y);

114 
	`gdk_døw_ª˘™gÀ
 (
ddi•
->
ˇnvas
->
wödow
,

115 
toﬁ
->
gc
, 
FALSE
, 
é
.
x
,Ål.
y
, 
br
.x -Ål.x, br.y -Ål.y);

117 
toﬁ
->
ﬁdx
 = 
evít
->
x
;

118 
toﬁ
->
ﬁdy
 = 
evít
->
y
;

120 
	}
}

123 
	$£t_zoom_out
(
Toﬁ
 *
toﬁ
)

125 ((
MagnifyToﬁ
 *)
toﬁ
)->
zoom_out
 = 
TRUE
;

126 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_ZOOM_OUT
));

127 
	}
}

130 
	$£t_zoom_ö
(
Toﬁ
 *
toﬁ
)

132 ((
MagnifyToﬁ
 *)
toﬁ
)->
zoom_out
 = 
FALSE
;

133 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_ZOOM_IN
));

134 
	}
}

136 
Toﬁ
 *

137 
	$¸óã_magnify_toﬁ
()

139 
MagnifyToﬁ
 *
toﬁ
;

141 
toﬁ
 = 
	`g_√w0
(
MagnifyToﬁ
, 1);

142 
toﬁ
->toﬁ.
ty≥
 = 
MAGNIFY_TOOL
;

143 
toﬁ
->toﬁ.
buâ⁄_¥ess_func
 = (
Buâ⁄PªssFunc
Ë&
magnify_buâ⁄_¥ess
;

144 
toﬁ
->toﬁ.
buâ⁄_ªÀa£_func
 = (
Buâ⁄PªssFunc
Ë&
magnify_buâ⁄_ªÀa£
;

145 
toﬁ
->toﬁ.
mŸi⁄_func
 = (
MŸi⁄Func
Ë&
magnify_mŸi⁄
;

146 
toﬁ
->toﬁ.
doubÀ_˛ick_func
 = 
NULL
;

148 
toﬁ
->
gc
 = 
NULL
;

149 
toﬁ
->
box_a˘ive
 = 
FALSE
;

150 
toﬁ
->
zoom_out
 = 
FALSE
;

152 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_ZOOM_IN
));

154  (
Toﬁ
 *Ë
toﬁ
;

155 
	}
}

158 
	$‰ì_magnify_toﬁ
(
Toﬁ
 *
toﬁ
)

160 
	`g_‰ì
(
toﬁ
);

161 
	`ddi•œy_£t_Æl_curs‹
(
deÁu…_curs‹
);

162 
	}
}

	@O:\tool\dvs50\app\magnify.h

18 #i‚de‡
MAGNIFY_H


19 
	#MAGNIFY_H


	)

21 
	~"toﬁ.h
"

23 
_MagnifyToﬁ
 
	tMagnifyToﬁ
;

25 
	s_MagnifyToﬁ
 {

26 
Toﬁ
 
	mtoﬁ
;

28 
GdkGC
 *
	mgc
;

30 
	mbox_a˘ive
;

31 
	mmoved
;

32 
	mx
, 
	my
;

33 
	mﬁdx
, 
	mﬁdy
;

35 
gboﬁón
 
	mzoom_out
;

38 
DIAVAR
 
Toﬁ
 *
¸óã_magnify_toﬁ
();

39 
DIAVAR
 
‰ì_magnify_toﬁ
(
Toﬁ
 *
toﬁ
);

40 
DIAVAR
 
£t_zoom_out
(
Toﬁ
 *
toﬁ
);

41 
DIAVAR
 
£t_zoom_ö
(
Toﬁ
 *
toﬁ
);

	@O:\tool\dvs50\app\main.c

18 
	~<c⁄fig.h
>

20 
	~"≠p_¥ocs.h
"

22 
	~"öãrÁ˚.h
"

24 
	$maö
(
¨gc
, *
¨gv
[])

26 
	`≠p_öô
(
¨gc
, 
¨gv
);

28 i‡(!
	`≠p_is_öãø˘ive
())

31 
	`toﬁbox_show
();

33 
	`≠p_•œsh_d⁄e
();

35 
	`gtk_maö
 ();

38 
	}
}

	@O:\tool\dvs50\app\menus.c

20 #ifde‡
HAVE_CONFIG_H


21 
	~<c⁄fig.h
>

24 #unde‡
GTK_DISABLE_DEPRECATED


25 
	~<gtk/gtk.h
>

26 
	~<gdk/gdkkeysyms.h
>

27 
	~<°rög.h
>

29 
	~"öé.h
"

30 
	~"míus.h
"

31 
	~"toﬁ.h
"

32 
	~"comm™ds.h
"

33 
	~"mesßge.h
"

34 
	~"öãrÁ˚.h
"

35 
	~"di•œy.h
"

36 
	~"fûedlg.h
"

37 
	~"föd-™d-ª∂a˚.h
"

38 
	~"∂ugö-m™agî.h
"

39 
	~"£À˘.h
"

40 
	~"dü_dús.h
"

41 
	~"dügøm_åì_wödow.h
"

42 
	~"obje˘_›s.h
"

43 
	~"shìts.h
"

44 
	~"dü-≠p-ic⁄s.h
"

45 
	~"widgës.h
"

46 
	~"¥e„ªn˚s.h
"

48 
	#DIA_STOCK_GROUP
 "dü-°ock-group"

	)

49 
	#DIA_STOCK_UNGROUP
 "dü-°ock-ungroup"

	)

50 
	#DIA_STOCK_LAYER_ADD
 "dü-°ock-œyî-add"

	)

51 
	#DIA_STOCK_LAYER_RENAME
 "dü-°ock-œyî-ª«me"

	)

52 
	#DIA_STOCK_OBJECTS_LAYER_ABOVE
 "dü-°ock-obje˘s-œyî-above"

	)

53 
	#DIA_STOCK_OBJECTS_LAYER_BELOW
 "dü-°ock-obje˘s-œyî-bñow"

	)

54 
	#DIA_STOCK_LAYERS
 "dü-°ock-œyîs"

	)

56 
	#DIA_SHOW_TEAROFFS
 
TRUE


	)

59 
	#DIA_INTEGRATED_TOOLBAR_ZOOM_COMBO
 "dü-öãgøãd-toﬁb¨-zoom-combo_íåy"

	)

60 
	#DIA_INTEGRATED_TOOLBAR_SNAP_GRID
 "dü-öãgøãd-toﬁb¨-¢≠-grid"

	)

61 
	#DIA_INTEGRATED_TOOLBAR_OBJECT_SNAP
 "dü-öãgøãd-toﬁb¨-obje˘-¢≠"

	)

63 
	#ZOOM_FIT
 
	`_
("Fô")

	)

65 
∂ugö_ˇŒback
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
);

67 
GtkWidgë
 *

68 
¸óã_öãgøãd_ui_toﬁb¨
 ();

70 
add_∂ugö_a˘i⁄s
 (
GtkUIM™agî
 *
ui_m™agî
, c⁄° *
ba£_∑th
);

72 
gch¨
*

73 
buûd_ui_fûíame
 (c⁄° 
gch¨
* 
«me
);

79 c⁄° 
GtkA˘i⁄E¡ry
 
	gcomm⁄_íåõs
[] =

81 { "Fûe", 
NULL
, 
N_
("_File"), NULL, NULL, NULL },

82 { "FûeNew", 
GTK_STOCK_NEW
, 
NULL
, "<c⁄åﬁ>N", NULL, 
G_CALLBACK
 (
fûe_√w_ˇŒback
) },

83 { "FûeO≥n", 
GTK_STOCK_OPEN
, 
NULL
,"<c⁄åﬁ>O", NULL, 
G_CALLBACK
 (
fûe_›í_ˇŒback
) },

84 { "FûeQuô", 
GTK_STOCK_QUIT
, 
NULL
, "<c⁄åﬁ>Q", NULL, 
G_CALLBACK
 (
fûe_quô_ˇŒback
) },

85 { "Hñp", 
NULL
, 
N_
("_Help"), NULL, NULL, NULL },

86 { "HñpC⁄ã¡s", 
GTK_STOCK_HELP
, 
NULL
, "F1", NULL, 
G_CALLBACK
 (
hñp_m™uÆ_ˇŒback
) },

87 { "HñpAbout", 
GTK_STOCK_ABOUT
, 
NULL
, NULL, NULL, 
G_CALLBACK
 (
hñp_about_ˇŒback
) }

91 c⁄° 
GtkA˘i⁄E¡ry
 
	gtoﬁbox_íåõs
[] =

93 { "FûeShìts", 
NULL
, 
N_
("Shìt†™d Obje˘s..."), "F9", NULL, 
G_CALLBACK
 (
shìts_dülog_show_ˇŒback
) },

94 { "FûePªfs", 
GTK_STOCK_PREFERENCES
, 
NULL
, NULL, NULL, 
G_CALLBACK
 (
fûe_¥e„ªn˚s_ˇŒback
) },

95 { "FûePlugös", 
NULL
, 
N_
("Plugös..."), NULL, NULL, 
G_CALLBACK
 (
fûe_∂ugös_ˇŒback
) }

99 c⁄° 
GtkToggÀA˘i⁄E¡ry
 
	gtoﬁbox_toggÀ_íåõs
[] =

101 { "FûeTªe", 
NULL
, 
N_
("_DügømÅªe..."), "F8", NULL, 
G_CALLBACK
 (
dügåì_show_ˇŒback
) }

105 c⁄° 
GtkToggÀA˘i⁄E¡ry
 
	göãgøãd_ui_võw_toggÀ_íåõs
[] =

107 { 
VIEW_MAIN_TOOLBAR_ACTION
, 
NULL
, 
N_
("Show Toﬁb¨"), NULL, NULL, 
G_CALLBACK
 (
võw_maö_toﬁb¨_ˇŒback
) },

108 { 
VIEW_MAIN_STATUSBAR_ACTION
, 
NULL
, 
N_
("Show Sètusb¨"), NULL, NULL, 
G_CALLBACK
 (
võw_maö_°©usb¨_ˇŒback
) },

109 { 
VIEW_LAYERS_ACTION
, 
NULL
, 
N_
("Show Layîs"), "<c⁄åﬁ>L", NULL, 
G_CALLBACK
 (
võw_œyîs_ˇŒback
) }

113 c⁄° 
GtkA˘i⁄E¡ry
 
	gdi•œy_íåõs
[] =

115 { "FûeSave", 
GTK_STOCK_SAVE
, 
NULL
, "<c⁄åﬁ>S", NULL, 
G_CALLBACK
 (
fûe_ßve_ˇŒback
) },

116 { "FûeSavós", 
GTK_STOCK_SAVE_AS
, 
NULL
, "<c⁄åﬁ><shi·>S", NULL, 
G_CALLBACK
 (
fûe_ßve_as_ˇŒback
) },

117 { "FûeExp‹t", 
GTK_STOCK_CONVERT
, 
N_
("_Exp‹à..."), 
NULL
, NULL, 
G_CALLBACK
 (
fûe_exp‹t_ˇŒback
) },

118 { "DügømPr›îtõs", 
GTK_STOCK_PROPERTIES
, 
N_
("_Dügøm Pr›îtõs"), "<shi·><Æt>Rëu∫", 
NULL
, 
G_CALLBACK
 (
võw_dügøm_¥›îtõs_ˇŒback
) },

119 { "FûePage£tup", 
NULL
, 
N_
("PagêSë_up..."), NULL, NULL, 
G_CALLBACK
 (
fûe_∑ge£tup_ˇŒback
) },

120 { "FûePröt", 
GTK_STOCK_PRINT
, 
NULL
, "<c⁄åﬁ>P", NULL, 
G_CALLBACK
 (
fûe_¥öt_ˇŒback
) },

121 { "FûeClo£", 
GTK_STOCK_CLOSE
, 
NULL
, "<c⁄åﬁ>W", NULL, 
G_CALLBACK
 (
fûe_˛o£_ˇŒback
) },

123 { "Edô", 
NULL
, 
N_
("_Edit"), NULL, NULL, NULL },

124 { "EdôUndo", 
GTK_STOCK_UNDO
, 
NULL
, "<c⁄åﬁ>Z", NULL, 
G_CALLBACK
 (
edô_undo_ˇŒback
) },

125 { "EdôRedo", 
GTK_STOCK_REDO
, 
NULL
, "<c⁄åﬁ><shi·>Z", NULL, 
G_CALLBACK
 (
edô_ªdo_ˇŒback
) },

127 { "EdôC›y", 
GTK_STOCK_COPY
, 
NULL
, "<c⁄åﬁ>C", NULL, 
G_CALLBACK
 (
edô_c›y_ˇŒback
) },

128 { "EdôCut", 
GTK_STOCK_CUT
, 
NULL
, "<c⁄åﬁ>X", NULL, 
G_CALLBACK
 (
edô_cut_ˇŒback
) },

129 { "EdôPa°e", 
GTK_STOCK_PASTE
, 
NULL
, "<c⁄åﬁ>V", NULL, 
G_CALLBACK
 (
edô_∑°e_ˇŒback
) },

130 { "EdôDu∂iˇã", 
NULL
, 
N_
("_Du∂iˇã"), "<c⁄åﬁ>D", NULL, 
G_CALLBACK
 (
edô_du∂iˇã_ˇŒback
) },

131 { "EdôDñëe", 
GTK_STOCK_DELETE
, 
NULL
, "Dñëe", NULL, 
G_CALLBACK
 (
edô_dñëe_ˇŒback
) },

133 { "EdôFöd", 
GTK_STOCK_FIND
, 
NULL
, "<c⁄åﬁ>F", NULL, 
G_CALLBACK
 (
edô_föd_ˇŒback
) },

134 { "EdôRïœ˚", 
GTK_STOCK_FIND_AND_REPLACE
, 
NULL
, "<c⁄åﬁ>H", NULL, 
G_CALLBACK
 (
edô_ª∂a˚_ˇŒback
) },

138 { "EdôC›yãxt", 
NULL
, 
N_
("C›y Text"), NULL, NULL, 
G_CALLBACK
 (
edô_c›y_ãxt_ˇŒback
) },

139 { "EdôCuâext", 
NULL
, 
N_
("CuàText"), "<c⁄åﬁ><shi·>X", NULL, 
G_CALLBACK
 (
edô_cut_ãxt_ˇŒback
) },

140 { "EdôPa°ëext", 
NULL
, 
N_
("Pa°ê_Text"), "<c⁄åﬁ><shi·>V", NULL, 
G_CALLBACK
 (
edô_∑°e_ãxt_ˇŒback
) },

142 { "Layîs", 
NULL
, 
N_
("_Layers"), NULL, NULL, NULL },

143 { "LayîAdd", 
DIA_STOCK_LAYER_ADD
, 
N_
("Add Layî..."), 
NULL
, NULL, 
G_CALLBACK
 (
œyîs_add_œyî_ˇŒback
) },

144 { "LayîRíame", 
DIA_STOCK_LAYER_RENAME
, 
N_
("RíamêLayî..."), 
NULL
, NULL, 
G_CALLBACK
 (
œyîs_ª«me_œyî_ˇŒback
) },

145 { "Obje˘sLayîAbove", 
DIA_STOCK_OBJECTS_LAYER_ABOVE
, 
N_
("Movê£À˘i⁄Åÿœyîábove"), 
NULL
, NULL, 
G_CALLBACK
 (
obje˘s_move_up_œyî
) },

146 { "Obje˘sLayîBñow", 
DIA_STOCK_OBJECTS_LAYER_BELOW
, 
N_
("Movê£À˘i⁄Åÿœyî bñow"), 
NULL
, NULL, 
G_CALLBACK
 (
obje˘s_move_down_œyî
) },

147 { "DügømLayîs", 
DIA_STOCK_LAYERS
, 
N_
("_Layîs..."), "<c⁄åﬁ>L", 
NULL
, 
G_CALLBACK
 (
dülogs_œyîs_ˇŒback
) },

149 { "Võw", 
NULL
, 
N_
("_View"), NULL, NULL, NULL },

150 { "VõwZoomö", 
GTK_STOCK_ZOOM_IN
, 
NULL
, "<c⁄åﬁ>∂us", NULL, 
G_CALLBACK
 (
võw_zoom_ö_ˇŒback
) },

151 { "VõwZoomout", 
GTK_STOCK_ZOOM_OUT
, 
NULL
, "<c⁄åﬁ>möus", NULL, 
G_CALLBACK
 (
võw_zoom_out_ˇŒback
) },

152 { "VõwZoom", 
NULL
, 
N_
("_Zoom"), NULL, NULL, NULL },

153 { "VõwZoom16000", 
NULL
, 
N_
("1600%"), NULL, NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

154 { "VõwZoom8000", 
NULL
, 
N_
("800%"), NULL, NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

155 { "VõwZoom4000", 
NULL
, 
N_
("400%"), "<Æt>4", NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

156 { "VõwZoom2830", 
NULL
, 
N_
("283"), NULL, NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

157 { "VõwZoom2000", 
NULL
, 
N_
("200"), "<Æt>2", NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

158 { "VõwZoom1410", 
NULL
, 
N_
("141"), NULL, NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

159 { "VõwZoom1000", 
GTK_STOCK_ZOOM_100
, 
NULL
, "<Æt>1", NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

160 { "VõwZoom850", 
NULL
, 
N_
("85"), NULL, NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

161 { "VõwZoom707", 
NULL
, 
N_
("70.7"), NULL, NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

162 { "VõwZoom500", 
NULL
, 
N_
("50"), "<Æt>5", NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

163 { "VõwZoom354", 
NULL
, 
N_
("35.4"), NULL, NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

164 { "VõwZoom250", 
NULL
, 
N_
("25"), NULL, NULL, 
G_CALLBACK
 (
võw_zoom_£t_ˇŒback
) },

166 { "VõwShowÆl", 
GTK_STOCK_ZOOM_FIT
, 
NULL
, "<c⁄åﬁ>E", NULL, 
G_CALLBACK
 (
võw_show_Æl_ˇŒback
) },

170 { "VõwNewvõw", 
NULL
, 
N_
("New _Võw"), NULL, NULL, 
G_CALLBACK
 (
võw_√w_võw_ˇŒback
) },

171 { "VõwCl⁄evõw", 
NULL
, 
N_
("C_l⁄êVõw"), NULL, NULL, 
G_CALLBACK
 (
võw_˛⁄e_võw_ˇŒback
) },

172 { "VõwRedøw", 
GTK_STOCK_REFRESH
, 
NULL
, NULL, NULL, 
G_CALLBACK
 (
võw_ªdøw_ˇŒback
) },

174 { "Obje˘s", 
NULL
, 
N_
("_Objects"), NULL, NULL },

175 { "Obje˘sSídtoback", 
GTK_STOCK_GOTO_BOTTOM
, 
N_
("SídÅÿ_Back"), "<c⁄åﬁ><shi·>B", 
NULL
, 
G_CALLBACK
 (
obje˘s_∂a˚_undî_ˇŒback
) },

176 { "Obje˘sBrögto‰⁄t", 
GTK_STOCK_GOTO_TOP
, 
N_
("BrögÅÿ_Fr⁄t"), "<c⁄åﬁ><shi·>F", 
NULL
, 
G_CALLBACK
 (
obje˘s_∂a˚_ovî_ˇŒback
) },

177 { "Obje˘sSídbackw¨ds", 
GTK_STOCK_GO_DOWN
, 
N_
("Síd Backw¨ds"), 
NULL
, NULL, 
G_CALLBACK
 (
obje˘s_∂a˚_down_ˇŒback
) },

178 { "Obje˘sBrögf‹w¨ds", 
GTK_STOCK_GO_UP
, 
N_
("Brög F‹w¨ds"), 
NULL
, NULL, 
G_CALLBACK
 (
obje˘s_∂a˚_up_ˇŒback
) },

180 { "Obje˘sGroup", 
DIA_STOCK_GROUP
, 
N_
("_Group"), "<c⁄åﬁ>G", 
NULL
, 
G_CALLBACK
 (
obje˘s_group_ˇŒback
) },

182 { "Obje˘sUngroup", 
DIA_STOCK_UNGROUP
, 
N_
("_Ungroup"), "<c⁄åﬁ><shi·>G", 
NULL
, 
G_CALLBACK
 (
obje˘s_ungroup_ˇŒback
) },

184 { "Obje˘sP¨ít", 
NULL
, 
N_
("_P¨ít"), "<c⁄åﬁ>K", NULL, 
G_CALLBACK
 (
obje˘s_∑ª¡_ˇŒback
) },

185 { "Obje˘sU≈¨ít", 
NULL
, 
N_
("_U≈¨ít"), "<c⁄åﬁ><shi·>K", NULL, 
G_CALLBACK
 (
obje˘s_u≈¨ít_ˇŒback
) },

186 { "Obje˘sU≈¨ítchûdªn", 
NULL
, 
N_
("_U≈¨íàChûdªn"), NULL, NULL, 
G_CALLBACK
 (
obje˘s_u≈¨ít_chûdªn_ˇŒback
) },

188 { "Obje˘sAlign", 
NULL
, 
N_
("Align"), NULL, NULL, NULL },

189 { "Obje˘sAlignLe·", 
GTK_STOCK_JUSTIFY_LEFT
, 
NULL
, "<Æt><shi·>L", NULL, 
G_CALLBACK
 (
obje˘s_Æign_h_ˇŒback
) },

190 { "Obje˘sAlignCíãr", 
GTK_STOCK_JUSTIFY_CENTER
, 
NULL
, "<Æt><shi·>C", NULL, 
G_CALLBACK
 (
obje˘s_Æign_h_ˇŒback
) },

191 { "Obje˘sAlignRight", 
GTK_STOCK_JUSTIFY_RIGHT
, 
NULL
, "<Æt><shi·>R", NULL, 
G_CALLBACK
 (
obje˘s_Æign_h_ˇŒback
) },

193 { "Obje˘sAlignT›", 
NULL
, 
N_
("T›"), "<Æt><shi·>T", NULL, 
G_CALLBACK
 (
obje˘s_Æign_v_ˇŒback
) },

194 { "Obje˘sAlignMiddÀ", 
NULL
, 
N_
("MiddÀ"), "<Æt><shi·>M", NULL, 
G_CALLBACK
 (
obje˘s_Æign_v_ˇŒback
) },

195 { "Obje˘sAlignBŸtom", 
NULL
, 
N_
("BŸtom"), "<Æt><shi·>B", NULL, 
G_CALLBACK
 (
obje˘s_Æign_v_ˇŒback
) },

197 { "Obje˘sAlignS¥ódouth‹iz⁄èŒy", 
NULL
, 
N_
("S¥ód OuàH‹iz⁄èŒy"), "<Æt><shi·>H", NULL, 
G_CALLBACK
 (
obje˘s_Æign_h_ˇŒback
) },

198 { "Obje˘sAlignS¥ódoutvîtiˇŒy", 
NULL
, 
N_
("S¥ód OuàVîtiˇŒy"), "<Æt><shi·>V", NULL, 
G_CALLBACK
 (
obje˘s_Æign_v_ˇŒback
) },

199 { "Obje˘sAlignAdja˚¡", 
NULL
, 
N_
("Adja˚¡"), "<Æt><shi·>A", NULL, 
G_CALLBACK
 (
obje˘s_Æign_h_ˇŒback
) },

200 { "Obje˘sAlignSècked", 
NULL
, 
N_
("Sècked"), "<Æt><shi·>S", NULL, 
G_CALLBACK
 (
obje˘s_Æign_v_ˇŒback
) },

202 { "Obje˘sPr›îtõs", 
GTK_STOCK_PROPERTIES
, 
NULL
, "<Æt>Rëu∫", NULL, 
G_CALLBACK
 (
dülogs_¥›îtõs_ˇŒback
) },

204 { "Sñe˘", 
NULL
, 
N_
("_Select"), NULL, NULL, NULL },

205 { "Sñe˘AŒ", 
NULL
, 
N_
("AŒ"), "<c⁄åﬁ>A", NULL, 
G_CALLBACK
 (
£À˘_Æl_ˇŒback
) },

206 { "Sñe˘N⁄e", 
NULL
, 
N_
("N⁄e"), "<c⁄åﬁ><shi·>A", NULL, 
G_CALLBACK
 (
£À˘_n⁄e_ˇŒback
) },

207 { "Sñe˘Invît", 
NULL
, 
N_
("Invît"), "<c⁄åﬁ>I", NULL, 
G_CALLBACK
 (
£À˘_övît_ˇŒback
) },

209 { "Sñe˘Tønsôive", 
NULL
, 
N_
("Tønsôive"), "<c⁄åﬁ>T", NULL, 
G_CALLBACK
 (
£À˘_å™sôive_ˇŒback
) },

210 { "Sñe˘C⁄√˘ed", 
NULL
, 
N_
("C⁄√˘ed"), "<c⁄åﬁ><shi·>T", NULL, 
G_CALLBACK
 (
£À˘_c⁄√˘ed_ˇŒback
) },

211 { "Sñe˘Samëy≥", 
NULL
, 
N_
("SamêTy≥"), NULL, NULL, 
G_CALLBACK
 (
£À˘_ßme_ty≥_ˇŒback
) },

215 { "Sñe˘By", 
NULL
, 
N_
("Select By"), NULL, NULL, NULL },

217 { "I≈utMëhods", 
NULL
, 
N_
("_Input Methods"), NULL, NULL, NULL },

219 { "Dülogs", 
NULL
, 
N_
("D_ialogs"), NULL, NULL, NULL },

221 { "Debug", 
NULL
, 
N_
("D_ebug"), NULL, NULL, NULL }

225 c⁄° 
GtkA˘i⁄E¡ry
 
	gtoﬁ_íåõs
[] =

227 { "Toﬁs", 
NULL
, 
N_
("_Tools"), NULL, NULL, NULL },

228 { "ToﬁsModify", 
NULL
, 
N_
("Modify"), "N", NULL, NULL },

229 { "ToﬁsMagnify", 
NULL
, 
N_
("Magnify"), "M", NULL, NULL },

230 { "ToﬁsTexãdô", 
NULL
, 
N_
("EditÅext"), "F2", NULL, NULL },

231 { "ToﬁsS¸ﬁl", 
NULL
, 
N_
("Scroll"), "S", NULL, NULL },

232 { "ToﬁsText", 
NULL
, 
N_
("Text"), "T", NULL, NULL },

233 { "ToﬁsBox", 
NULL
, 
N_
("Box"), "R", NULL, NULL },

234 { "ToﬁsEŒù£", 
NULL
, 
N_
("Ellipse"), "E", NULL, NULL },

235 { "ToﬁsPﬁyg⁄", 
NULL
, 
N_
("Polygon"), "P", NULL, NULL },

236 { "ToﬁsBezõrg⁄", 
NULL
, 
N_
("Beziergon"), "B", NULL, NULL },

238 { "ToﬁsLöe", 
NULL
, 
N_
("Line"), "L", NULL, NULL },

239 { "ToﬁsArc", 
NULL
, 
N_
("Arc"), "A", NULL, NULL },

240 { "ToﬁsZigzaglöe", 
NULL
, 
N_
("Zigzagline"), "Z", NULL, NULL },

241 { "ToﬁsPﬁylöe", 
NULL
, 
N_
("Polyline"), "Y", NULL },

242 { "ToﬁsBezõæöe", 
NULL
, 
N_
("Bezierline"), "C", NULL, NULL },

243 { "ToﬁsOuéöe", 
NULL
, 
N_
("Outline"), "O", NULL, NULL },

245 { "ToﬁsImage", 
NULL
, 
N_
("Image"), "I", NULL, NULL },

249 c⁄° 
GtkToggÀA˘i⁄E¡ry
 
	gdi•œy_toggÀ_íåõs
[] =

251 #ifde‡
GTK_STOCK_FULLSCREEN


252 { "VõwFuŒs¸ìn", 
GTK_STOCK_FULLSCREEN
, 
NULL
, "F11", NULL, 
G_CALLBACK
 (
võw_fuŒs¸ìn_ˇŒback
) },

254 { "VõwFuŒs¸ìn", 
NULL
, 
N_
("FuŒs¸_ìn"), "F11", NULL, 
G_CALLBACK
 (
võw_fuŒs¸ìn_ˇŒback
) },

256 { "VõwA¡ülü£d", 
NULL
, 
N_
("_A¡iAlü£d"), NULL, NULL, 
G_CALLBACK
 (
võw_Ø_ˇŒback
) },

257 { "VõwShowgrid", 
NULL
, 
N_
("Show _Grid"), NULL, NULL, 
G_CALLBACK
 (
võw_visibÀ_grid_ˇŒback
) },

258 { "VõwS«±ogrid", 
NULL
, 
N_
("_S«∞TÿGrid"), NULL, NULL, 
G_CALLBACK
 (
võw_¢≠_to_grid_ˇŒback
) },

259 { "VõwS«±oobje˘s", 
NULL
, 
N_
("S«∞Tÿ_Obje˘s"), NULL, NULL, 
G_CALLBACK
 (
võw_¢≠_to_obje˘s_ˇŒback
) },

260 { "VõwShowruÀrs", 
NULL
, 
N_
("Show _RuÀrs"), NULL, NULL, 
G_CALLBACK
 (
võw_toggÀ_ruÀrs_ˇŒback
) },

261 { "VõwShowc⁄√˘i⁄poöts", 
NULL
, 
N_
("Show _C⁄√˘i⁄ Poöts"), NULL, NULL, 
G_CALLBACK
 (
võw_show_cx_±s_ˇŒback
) }

265 c⁄° 
GtkRadioA˘i⁄E¡ry
 
	gdi•œy_£À˘_ødio_íåõs
[] =

267 { "Sñe˘Rïœ˚", 
NULL
, 
N_
("Rïœ˚"), NULL, NULL, 
SELECT_REPLACE
 },

268 { "Sñe˘Uni⁄", 
NULL
, 
N_
("Uni⁄"), NULL, NULL, 
SELECT_UNION
 },

269 { "Sñe˘I¡î£˘i⁄", 
NULL
, 
N_
("I¡î£˘i⁄"), NULL, NULL, 
SELECT_INTERSECTION
 },

270 { "Sñe˘Remove", 
NULL
, 
N_
("Remove"), NULL, NULL, 
SELECT_REMOVE
 },

272 { "Sñe˘Invî£", 
NULL
, 
N_
("Invî£"), NULL, NULL, 
SELECT_INVERT
 }

276 
gboﬁón
 
	göôüli£
 = 
TRUE
;

279 
GtkUIM™agî
 *
	göãgøãd_ui_m™agî
 = 
NULL
;

280 
GtkA˘i⁄Group
 *
	göãgøãd_ui_a˘i⁄s
 = 
NULL
;

281 
GtkA˘i⁄Group
 *
	göãgøãd_ui_toﬁ_a˘i⁄s
 = 
NULL
;

282 
GtkAc˚lGroup
 *
	göãgøãd_ui_ac˚ls
 = 
NULL
;

283 
GtkWidgë
 *
	göãgøãd_ui_míub¨
 = 
NULL
;

284 
GtkWidgë
 *
	göãgøãd_ui_toﬁb¨
 = 
NULL
;

287 
GtkUIM™agî
 *
	gtoﬁbox_ui_m™agî
 = 
NULL
;

288 
GtkA˘i⁄Group
 *
	gtoﬁbox_a˘i⁄s
 = 
NULL
;

289 
GtkAc˚lGroup
 *
	gtoﬁbox_ac˚ls
 = 
NULL
;

290 
GtkWidgë
 *
	gtoﬁbox_míub¨
 = 
NULL
;

292 
GtkA˘i⁄Group
 *
	gª˚¡_a˘i⁄s
 = 
NULL
;

293 
GSLi°
 *
	gª˚¡_mîge_ids
 = 
NULL
;

296 
GtkUIM™agî
 *
	gdi•œy_ui_m™agî
 = 
NULL
;

297 
GtkA˘i⁄Group
 *
	gdi•œy_a˘i⁄s
 = 
NULL
;

298 
GtkA˘i⁄Group
 *
	gdi•œy_toﬁ_a˘i⁄s
 = 
NULL
;

299 
GtkAc˚lGroup
 *
	gdi•œy_ac˚ls
 = 
NULL
;

300 
GtkWidgë
 *
	gdi•œy_míub¨
 = 
NULL
;

302 
gch¨
*

303 
	$_dü_å™¶©e
 (c⁄° 
gch¨
* 
ãrm
, 
gpoöãr
 
d©a
)

305 
gch¨
* 
å™s
 = (gch¨*Ë
ãrm
;

307 i‡(
ãrm
 && *term) {

309 
å™s
 = 
	`dgëãxt
 (
GETTEXT_PACKAGE
, 
ãrm
);

311 i‡(
ãrm
 =
å™s
)

312 
å™s
 = 
	`dgëãxt
 ("gtk20", 
ãrm
);

315 i‡(
ãrm
 =
å™s
) {

316 
gch¨
* 
kludge
 = 
	`g_°rdup_¥ötf
 ("/%s", 
ãrm
);

317 
å™s
 = 
	`dgëãxt
 (
GETTEXT_PACKAGE
, 
kludge
);

318 i‡(
kludge
 =
å™s
)

319 
å™s
 = 
ãrm
;

321 ++
å™s
;

322 
	`g_‰ì
 (
kludge
);

324 i‡(
ãrm
 =
å™s
)

325 
å™s
 = 
	`g_°rdup_¥ötf
 ("XXX: %s", 
ãrm
);

328  
å™s
;

329 
	}
}

332 
	$toﬁ_míu_£À˘
(
GtkWidgë
 *
w
, 
gpoöãr
 
d©a
) {

333 
ToﬁBuâ⁄D©a
 *
toﬁd©a
 = (ToﬁBuâ⁄D©®*Ë
d©a
;

335 i‡(
toﬁd©a
 =
NULL
) {

336 
	`g_w¨nög
(
	`_
("NULLÅooldata inÅool_menu_select"));

340 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
toﬁd©a
->
widgë
),
TRUE
);

341 
	}
}

343 
göt


344 
	$ßve_ac˚ls
(
gpoöãr
 
d©a
)

346 
gch¨
 *
ac˚lfûíame
;

348 
ac˚lfûíame
 = 
	`dü_c⁄fig_fûíame
("menurc");

349 i‡(
ac˚lfûíame
) {

350 
	`gtk_ac˚l_m≠_ßve
 (
ac˚lfûíame
);

351 
	`g_‰ì
 (
ac˚lfûíame
);

353  
TRUE
;

354 
	}
}

361 
	$öãgøãd_ui_toﬁb¨_obje˘_¢≠_synchr⁄ize_to_di•œy
(
gpoöãr
 
∑øm
)

363 
DDi•œy
 *
ddi•
 = 
∑øm
;

364 i‡(
ddi•
 && ddi•->
comm⁄_toﬁb¨
)

366 
GtkToggÀBuâ⁄
 *
b
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
ddi•
->
comm⁄_toﬁb¨
),

367 
DIA_INTEGRATED_TOOLBAR_OBJECT_SNAP
);

368 
gboﬁón
 
a˘ive
 = 
ddi•
->
maöpoöt_mag√tism
? 
TRUE
 : 
FALSE
;

369 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
 (
b
, 
a˘ive
);

371 
	}
}

379 
	$öãgøãd_ui_toﬁb¨_obje˘_¢≠_toggÀ
(
GtkToggÀBuâ⁄
 *
b
, 
gpoöãr
 *
nŸ_u£d
)

381 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
 ();

382 i‡(
ddi•
)

384 
	`ddi•œy_£t_¢≠_to_obje˘s
 (
ddi•
, 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
 (
b
));

386 
	}
}

393 
	$öãgøãd_ui_toﬁb¨_grid_¢≠_synchr⁄ize_to_di•œy
(
gpoöãr
 
∑øm
)

395 
DDi•œy
 *
ddi•
 = 
∑øm
;

396 i‡(
ddi•
 && ddi•->
comm⁄_toﬁb¨
)

398 
GtkToggÀBuâ⁄
 *
b
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
ddi•
->
comm⁄_toﬁb¨
),

399 
DIA_INTEGRATED_TOOLBAR_SNAP_GRID
);

400 
gboﬁón
 
a˘ive
 = 
ddi•
->
grid
.
¢≠
? 
TRUE
 : 
FALSE
;

401 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
 (
b
, 
a˘ive
);

403 
	}
}

411 
	$öãgøãd_ui_toﬁb¨_grid_¢≠_toggÀ
(
GtkToggÀBuâ⁄
 *
b
, 
gpoöãr
 *
nŸ_u£d
)

413 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
 ();

414 i‡(
ddi•
)

416 
	`ddi•œy_£t_¢≠_to_grid
 (
ddi•
, 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
 (
b
));

418 
	}
}

425 
	$öãgøãd_ui_toﬁb¨_£t_zoom_ãxt
 (
GtkToﬁb¨
 *
toﬁb¨
, c⁄° 
gch¨
 * 
ãxt
)

427 i‡(
toﬁb¨
)

429 
GtkComboBoxE¡ry
 *
combo_íåy
 = 
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
toﬁb¨
),

430 
DIA_INTEGRATED_TOOLBAR_ZOOM_COMBO
);

432 i‡(
combo_íåy
)

434 
GtkWidgë
 * 
íåy
 = 
	`gtk_bö_gë_chûd
 (
	`GTK_BIN
 (
combo_íåy
));

436 
	`gtk_íåy_£t_ãxt
 (
	`GTK_ENTRY
 (
íåy
), 
ãxt
);

439 
	}
}

447 
	$öãgøãd_ui_toﬁb¨_add_cu°om_ôem
 (
GtkToﬁb¨
 *
toﬁb¨
, 
GtkWidgë
 *
w
)

449 
GtkToﬁIãm
 *
toﬁ_ôem
;

450 
GtkWidgë
 *
c
;

452 
toﬁ_ôem
 = 
	`gtk_toﬁ_ôem_√w
 ();

453 
c
 = 
	`gtk_vbox_√w
 (
FALSE
, 0);

454 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
toﬁ_ôem
), 
c
);

455 
	`gtk_box_£t_homogíeous
 (
	`GTK_BOX
 (
c
), 
TRUE
);

456 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
c
), 
w
, 
FALSE
, FALSE, 0);

457 
	`gtk_toﬁb¨_ö£π
 (
toﬁb¨
, 
toﬁ_ôem
, -1);

458 
	`gtk_widgë_show
 (
	`GTK_WIDGET
 (
toﬁ_ôem
));

459 
	`gtk_widgë_show
 (
c
);

460 
	`gtk_widgë_show
 (
w
);

461 
	}
}

464 
	$öãgøãd_ui_toﬁb¨_zoom_a˘iv©e
 (
GtkWidgë
 *
ôem
,

465 
gpoöãr
 
u£r_d©a
)

467 c⁄° 
gch¨
 *
ãxt
 = 
	`gtk_íåy_gë_ãxt
 (
	`GTK_ENTRY
 (
ôem
));

468 
zoom_≥r˚¡
;

470 i‡(
	`ssˇnf
 (
ãxt
, "%f", &
zoom_≥r˚¡
) == 1)

472 
	`võw_zoom_£t
 (10.0 * 
zoom_≥r˚¡
);

474 
	}
}

477 
	$öãgøãd_ui_toﬁb¨_zoom_combo_£À˘i⁄_ch™ged
 (
GtkComboBox
 *
combo
,

478 
gpoöãr
 
u£r_d©a
)

484 i‡(
	`gtk_combo_box_gë_a˘ive
 (
combo
) != -1)

486 
zoom_≥r˚¡
;

487 
gch¨
 * 
ãxt
 = 
	`gtk_combo_box_gë_a˘ive_ãxt
 (
combo
);

489 i‡(
	`ssˇnf
 (
ãxt
, "%f", &
zoom_≥r˚¡
) == 1)

491 
	`võw_zoom_£t
 (
zoom_≥r˚¡
 * 10.0);

493 i‡(
	`g_°rˇ£cmp
 (
ãxt
, 
ZOOM_FIT
) == 0)

495 
	`võw_show_Æl_ˇŒback
 (
NULL
);

498 
	`g_‰ì
 (
ãxt
);

500 
	}
}

502 
guöt


503 
	$ísuª_míu_∑th
 (
GtkUIM™agî
 *
ui_m™agî
, 
GtkA˘i⁄Group
 *
a˘i⁄s
, c⁄° 
gch¨
 *
∑th
, 
gboﬁón
 
íd
)

505 
guöt
 
id
 = 
	`gtk_ui_m™agî_√w_mîge_id
 (
ui_m™agî
);

507 i‡(!
	`gtk_ui_m™agî_gë_widgë
 (
ui_m™agî
, 
∑th
)) {

508 
gch¨
 *
sub∑th
 = 
	`g_°rdup
 (
∑th
);

510 i‡(
	`°ºchr
 (
sub∑th
, '/')) {

511 c⁄° 
gch¨
 *
a˘i⁄_«me
;

512 
gch¨
 *
£p
;

514 
GtkA˘i⁄
 *
a˘i⁄
;

516 
£p
 = 
	`°ºchr
 (
sub∑th
, '/');

517 *
£p
 = '\0';

518 
a˘i⁄_«me
 = 
£p
 + 1;

520 
	`ísuª_míu_∑th
 (
ui_m™agî
, 
a˘i⁄s
, 
sub∑th
, 
FALSE
);

522 
a˘i⁄
 = 
	`gtk_a˘i⁄_√w
 (
a˘i⁄_«me
, 
£p
 + 1, 
NULL
, NULL);

523 i‡(!
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
a˘i⁄s
, 
a˘i⁄_«me
))

524 
	`gtk_a˘i⁄_group_add_a˘i⁄
 (
a˘i⁄s
, 
a˘i⁄
);

525 
	`g_obje˘_uƒef
 (
	`G_OBJECT
 (
a˘i⁄
));

527 
	`gtk_ui_m™agî_add_ui
 (
ui_m™agî
, 
id
, 
sub∑th
,

528 
a˘i⁄_«me
,áction_name,

529 
íd
 ? 
GTK_UI_MANAGER_SEPARATOR
 : 
GTK_UI_MANAGER_MENU
,

530 
FALSE
);

532 
	`g_w¨nög
 ("ísuª_míu_∑th(ËövÆid míuÖ©h: %s.", 
sub∑th
 ? subpath : "NULL");

534 
	`g_‰ì
 (
sub∑th
);

536  
id
;

537 
	}
}

543 
GtkWidgë
 *

544 
	$¸óã_öãgøãd_ui_toﬁb¨
 ()

546 
GtkToﬁb¨
 *
toﬁb¨
;

547 
GtkToﬁIãm
 *
£p
;

548 
GtkWidgë
 *
w
;

549 
GEº‹
 *
îr‹
 = 
NULL
;

550 
gch¨
 *
uifûe
;

552 
uifûe
 = 
	`buûd_ui_fûíame
 ("ui/toolbar-ui.xml");

553 i‡(!
	`gtk_ui_m™agî_add_ui_‰om_fûe
 (
öãgøãd_ui_m™agî
, 
uifûe
, &
îr‹
)) {

554 
	`g_w¨nög
 ("buûdög míu†Áûed: %s", 
îr‹
->
mesßge
);

555 
	`g_îr‹_‰ì
 (
îr‹
);

556 
îr‹
 = 
NULL
;

557 
toﬁb¨
 = 
	`GTK_TOOLBAR
 (
	`gtk_toﬁb¨_√w
 ());

560 
toﬁb¨
 = 
	`GTK_TOOLBAR
(
	`gtk_ui_m™agî_gë_widgë
 (
öãgøãd_ui_m™agî
, "/Toolbar"));

562 
	`g_‰ì
 (
uifûe
);

565 
w
 = 
	`gtk_combo_box_íåy_√w_ãxt
 ();

567 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
toﬁb¨
),

568 
DIA_INTEGRATED_TOOLBAR_ZOOM_COMBO
,

569 
w
);

570 
	`öãgøãd_ui_toﬁb¨_add_cu°om_ôem
 (
toﬁb¨
, 
w
);

572 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
ZOOM_FIT
);

573 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("800%"));

574 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("400%"));

575 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("300%"));

576 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("200%"));

577 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("150%"));

578 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("100%"));

579 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("75%"));

580 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("50%"));

581 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("25%"));

582 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("10%"));

584 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
w
),

586 
	`G_CALLBACK
 (
öãgøãd_ui_toﬁb¨_zoom_combo_£À˘i⁄_ch™ged
),

587 
NULL
);

590 
w
 = 
	`gtk_bö_gë_chûd
 (
	`GTK_BIN
 (w));

591 
	`gtk_íåy_£t_width_ch¨s
 (
	`GTK_ENTRY
 (
w
), 6);

593 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
w
), "activate",

594 
	`G_CALLBACK
(
öãgøãd_ui_toﬁb¨_zoom_a˘iv©e
),

595 
NULL
);

598 
£p
 = 
	`gtk_£∑øt‹_toﬁ_ôem_√w
 ();

599 
	`gtk_toﬁb¨_ö£π
 (
toﬁb¨
, 
£p
, -1);

600 
	`gtk_widgë_show
 (
	`GTK_WIDGET
 (
£p
));

603 
w
 = 
	`dü_toggÀ_buâ⁄_√w_wôh_ic⁄s
 (
dü_⁄_grid_ic⁄
,

604 
dü_off_grid_ic⁄
);

605 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
w
), "toggled",

606 
	`G_CALLBACK
 (
öãgøãd_ui_toﬁb¨_grid_¢≠_toggÀ
), 
toﬁb¨
);

607 
	`gtk_toﬁtùs_£t_tù
 (
toﬁ_tùs
, 
w
,

608 
	`_
("ToggÀ†¢≠-to-grid."), 
NULL
);

609 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
toﬁb¨
),

610 
DIA_INTEGRATED_TOOLBAR_SNAP_GRID
,

611 
w
);

612 
	`öãgøãd_ui_toﬁb¨_add_cu°om_ôem
 (
toﬁb¨
, 
w
);

615 
w
 = 
	`dü_toggÀ_buâ⁄_√w_wôh_ic⁄s
 (
dü_maöpoöts_⁄_ic⁄
,

616 
dü_maöpoöts_off_ic⁄
);

617 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
w
), "toggled",

618 
	`G_CALLBACK
 (
öãgøãd_ui_toﬁb¨_obje˘_¢≠_toggÀ
), 
toﬁb¨
);

619 
	`gtk_toﬁtùs_£t_tù
 (
toﬁ_tùs
, 
w
,

620 
	`_
("ToggÀ†obje˘ s«µög."), 
NULL
);

621 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
toﬁb¨
),

622 
DIA_INTEGRATED_TOOLBAR_OBJECT_SNAP
,

623 
w
);

624 
	`öãgøãd_ui_toﬁb¨_add_cu°om_ôem
 (
toﬁb¨
, 
w
);

626 
£p
 = 
	`gtk_£∑øt‹_toﬁ_ôem_√w
 ();

627 
	`gtk_toﬁb¨_ö£π
 (
toﬁb¨
, 
£p
, -1);

628 
	`gtk_widgë_show
 (
	`GTK_WIDGET
 (
£p
));

630  
	`GTK_WIDGET
 (
toﬁb¨
);

631 
	}
}

637 
GtkA˘i⁄Group
 *

638 
	$¸óã_toﬁ_a˘i⁄s
 ()

640 
GtkA˘i⁄Group
 *
a˘i⁄s
;

641 
GtkA˘i⁄
 *
a˘i⁄
;

642 
i
;

643 
gch¨
 *
«me
;

644 
guöt
 
˙t
 = 0;

646 
«me
 = 
	`g_°rdup_¥ötf
 ("toﬁ-a˘i⁄s-%d", 
˙t
);

647 
a˘i⁄s
 = 
	`gtk_a˘i⁄_group_√w
 (
«me
);

648 
	`gtk_a˘i⁄_group_£t_å™¶©i⁄_domaö
 (
a˘i⁄s
, 
NULL
);

649 
	`gtk_a˘i⁄_group_£t_å™¶©e_func
 (
a˘i⁄s
, 
_dü_å™¶©e
, 
NULL
, NULL);

650 
	`g_‰ì
 (
«me
);

651 
«me
 = 
NULL
;

652 
˙t
++;

654 
	`gtk_a˘i⁄_group_add_a˘i⁄s
 (
a˘i⁄s
, 
toﬁ_íåõs
,

655 
	`G_N_ELEMENTS
 (
toﬁ_íåõs
), 
NULL
);

657 
i
 = 0; i < 
num_toﬁs
; i++) {

658 
a˘i⁄
 = 
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
a˘i⁄s
, 
toﬁ_d©a
[
i
].
a˘i⁄_«me
);

659 i‡(
a˘i⁄
 !
NULL
) {

660 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
a˘i⁄
), "activate",

661 
	`G_CALLBACK
 (
toﬁ_míu_£À˘
),

662 &
toﬁ_d©a
[
i
].
ˇŒback_d©a
);

665 
	`g_w¨nög
 ("couldn'àfödÅoﬁ míu iãm %s", 
toﬁ_d©a
[
i
].
a˘i⁄_«me
);

668  
a˘i⁄s
;

669 
	}
}

673 
	$add_∂ugö_a˘i⁄s
 (
GtkUIM™agî
 *
ui_m™agî
, c⁄° 
gch¨
 *
ba£_∑th
)

675 
GtkA˘i⁄Group
 *
a˘i⁄s
;

676 
GtkA˘i⁄
 *
a˘i⁄
;

677 
GLi°
 *
cbli°
;

678 
DüCÆlbackFûãr
 *
cbf
 = 
NULL
;

679 
gch¨
 *
«me
;

680 
guöt
 
id
;

681 
guöt
 
˙t
 = 0;

683 
«me
 = 
	`g_°rdup_¥ötf
 ("∂ugö-a˘i⁄s-%d", 
˙t
);

684 
a˘i⁄s
 = 
	`gtk_a˘i⁄_group_√w
 (
«me
);

685 
	`gtk_a˘i⁄_group_£t_å™¶©i⁄_domaö
 (
a˘i⁄s
, 
NULL
);

686 
	`gtk_a˘i⁄_group_£t_å™¶©e_func
 (
a˘i⁄s
, 
_dü_å™¶©e
, 
NULL
, NULL);

687 
	`g_‰ì
 (
«me
);

688 
«me
 = 
NULL
;

689 
˙t
++;

691 
	`gtk_ui_m™agî_ö£π_a˘i⁄_group
 (
ui_m™agî
, 
a˘i⁄s
, 5 );

692 
	`g_obje˘_uƒef
 (
a˘i⁄s
);

694 
cbli°
 = 
	`fûãr_gë_ˇŒbacks
(); cbli°; cbli° = cbli°->
√xt
) {

695 
gch¨
 *
míu_∑th
 = 
NULL
;

697 
cbf
 = 
cbli°
->
d©a
;

699 i‡(
cbf
 =
NULL
) {

700 
	`g_w¨nög
 ("missing DiaCallbackFilter instance");

704 i‡(
cbf
->
a˘i⁄
 =
NULL
) {

705 
	`g_w¨nög
 ("Plugin '%s': doesn't specifyáction. Loading failed.",

706 
cbf
->
des¸ùti⁄
);

710 i‡–
ba£_∑th
 !
NULL


711 && 
	`°∫cmp
 (
cbf
->
míu∑th
, 
ba£_∑th
, 
	`°æí
 (base_path)) != 0) {

714 } i‡(!
ba£_∑th
) {

716 i‡(
	`°∫cmp
 (
cbf
->
míu∑th
, 
DISPLAY_MENU
, 
	`°æí
 (DISPLAY_MENU)) == 0)

717 
míu_∑th
 = 
	`g_°rdup_¥ötf
 ("%s%s", 
INTEGRATED_MENU
, 
cbf
->
míu∑th
 + 
	`°æí
 (
DISPLAY_MENU
));

718 i‡(
	`°∫cmp
 (
cbf
->
míu∑th
, 
TOOLBOX_MENU
, 
	`°æí
 (TOOLBOX_MENU)) == 0)

719 
míu_∑th
 = 
	`g_°rdup_¥ötf
 ("%s%s", 
INTEGRATED_MENU
, 
cbf
->
míu∑th
 + 
	`°æí
 (
TOOLBOX_MENU
));

722 
a˘i⁄
 = 
	`gtk_a˘i⁄_√w
 (
cbf
->a˘i⁄, cbf->
des¸ùti⁄
, 
NULL
, NULL);

723 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
a˘i⁄
), "activate",

724 
	`G_CALLBACK
 (
∂ugö_ˇŒback
), (
gpoöãr
Ë
cbf
);

726 
	`gtk_a˘i⁄_group_add_a˘i⁄
 (
a˘i⁄s
, 
a˘i⁄
);

727 
	`g_obje˘_uƒef
 (
	`G_OBJECT
 (
a˘i⁄
));

729 
id
 = 
	`ísuª_míu_∑th
 (
ui_m™agî
, 
a˘i⁄s
, 
míu_∑th
 ? míu_∑th : 
cbf
->
míu∑th
, 
TRUE
);

730 
	`gtk_ui_m™agî_add_ui
 (
ui_m™agî
, 
id
,

731 
míu_∑th
 ? míu_∑th : 
cbf
->
míu∑th
,

732 
cbf
->
des¸ùti⁄
,

733 
cbf
->
a˘i⁄
,

734 
GTK_UI_MANAGER_AUTO
,

735 
FALSE
);

736 
	`g_‰ì
 (
míu_∑th
);

738 
	}
}

741 
	$_add_°ock_ic⁄
 (
GtkIc⁄Fa˘‹y
 *
Á˘‹y
, c⁄° *
«me
, c⁄° 
guöt8
 *
d©a
, c⁄° 
size_t
 
size
)

743 
GdkPixbuf
 *
pixbuf
;

744 
GtkIc⁄Së
 *
£t
;

745 
GEº‹
 *
îr
 = 
NULL
;

747 
pixbuf
 = 
	`gdk_pixbuf_√w_‰om_ölöe
 (
size
, 
d©a
, 
FALSE
, &
îr
);

748 i‡(
îr
) {

749 
	`g_w¨nög
 ("%s", 
îr
->
mesßge
);

750 
	`g_îr‹_‰ì
 (
îr
);

751 
îr
 = 
NULL
;

753 
£t
 = 
	`gtk_ic⁄_£t_√w_‰om_pixbuf
 (
pixbuf
);

754 
	`gtk_ic⁄_Á˘‹y_add
 (
Á˘‹y
, 
«me
, 
£t
);

755 
	`g_obje˘_uƒef
 (
pixbuf
);

756 
pixbuf
 = 
NULL
;

757 
	}
}

760 
	$ªgi°î_°ock_ic⁄s
 ()

762 
GtkIc⁄Fa˘‹y
 *
Á˘‹y
;

764 
Á˘‹y
 = 
	`gtk_ic⁄_Á˘‹y_√w
 ();

766 
	`_add_°ock_ic⁄
 (
Á˘‹y
, 
DIA_STOCK_GROUP
, 
dü_group_ic⁄
, (dia_group_icon));

767 
	`_add_°ock_ic⁄
 (
Á˘‹y
, 
DIA_STOCK_UNGROUP
, 
dü_ungroup_ic⁄
, (dia_ungroup_icon));

769 
	`_add_°ock_ic⁄
 (
Á˘‹y
, 
DIA_STOCK_LAYER_ADD
, 
dü_œyî_add
, (dia_layer_add));

770 
	`_add_°ock_ic⁄
 (
Á˘‹y
, 
DIA_STOCK_LAYER_RENAME
, 
dü_œyî_ª«me
, (dia_layer_rename));

771 
	`_add_°ock_ic⁄
 (
Á˘‹y
, 
DIA_STOCK_OBJECTS_LAYER_ABOVE
, 
dü_obje˘s_œyî_above
, (dia_objects_layer_above));

772 
	`_add_°ock_ic⁄
 (
Á˘‹y
, 
DIA_STOCK_OBJECTS_LAYER_BELOW
, 
dü_obje˘s_œyî_bñow
, (dia_objects_layer_below));

773 
	`_add_°ock_ic⁄
 (
Á˘‹y
, 
DIA_STOCK_LAYERS
, 
dü_œyîs
, (dia_layers));

775 
	`gtk_ic⁄_Á˘‹y_add_deÁu…
 (
Á˘‹y
);

776 
	`g_obje˘_uƒef
 (
Á˘‹y
);

777 
Á˘‹y
 = 
NULL
;

778 
	}
}

780 
gch¨
*

781 
	$buûd_ui_fûíame
 (c⁄° 
gch¨
* 
«me
)

783 
gch¨
* 
uifûe
;

785 i‡(
	`g_gëív
 ("DIA_BASE_PATH"Ë!
NULL
) {

787 c⁄° 
gch¨
* 
p
 = 
	`°ºchr
 (
«me
, '/');

788 i‡(
p
 !
NULL
)

789 
«me
 = 
p
+1;

790 
uifûe
 = 
	`g_buûd_fûíame
 (
	`g_gëív
 ("DIA_BASE_PATH"), "d©a", 
«me
, 
NULL
);

792 
uifûe
 = 
	`dü_gë_d©a_dúe˘‹y
 (
«me
);

794  
uifûe
;

795 
	}
}

803 
	$_ui_m™agî_c⁄√˘_¥oxy
 (
GtkUIM™agî
 *
m™agî
,

804 
GtkA˘i⁄
 *
a˘i⁄
,

805 
GtkWidgë
 *
¥oxy
)

807 i‡(
	`GTK_IS_MENU_ITEM
 (
¥oxy
))

809 
gch¨
 *
toﬁtù
;

811 
	`g_obje˘_gë
 (
a˘i⁄
, "toﬁtù", &
toﬁtù
, 
NULL
);

813 i‡(
toﬁtù
)

815 
	`gtk_toﬁtùs_£t_tù
 (
toﬁ_tùs
, 
¥oxy
, 
toﬁtù
, 
NULL
);

816 
	`g_‰ì
 (
toﬁtù
);

819 
	}
}

821 
GtkA˘i⁄Group
 *

822 
	$¸óã_‹_ªf_di•œy_a˘i⁄s
 ()

824 i‡(
di•œy_a˘i⁄s
)

825  
	`g_obje˘_ªf
 (
di•œy_a˘i⁄s
);

826 
di•œy_a˘i⁄s
 = 
	`gtk_a˘i⁄_group_√w
 ("display-actions");

827 
	`gtk_a˘i⁄_group_£t_å™¶©i⁄_domaö
 (
di•œy_a˘i⁄s
, 
NULL
);

828 
	`gtk_a˘i⁄_group_£t_å™¶©e_func
 (
di•œy_a˘i⁄s
, 
_dü_å™¶©e
, 
NULL
, NULL);

829 
	`gtk_a˘i⁄_group_add_a˘i⁄s
 (
di•œy_a˘i⁄s
, 
comm⁄_íåõs
,

830 
	`G_N_ELEMENTS
 (
comm⁄_íåõs
), 
NULL
);

831 
	`gtk_a˘i⁄_group_add_a˘i⁄s
 (
di•œy_a˘i⁄s
, 
di•œy_íåõs
,

832 
	`G_N_ELEMENTS
 (
di•œy_íåõs
), 
NULL
);

833 
	`gtk_a˘i⁄_group_add_toggÀ_a˘i⁄s
 (
di•œy_a˘i⁄s
, 
di•œy_toggÀ_íåõs
,

834 
	`G_N_ELEMENTS
 (
di•œy_toggÀ_íåõs
),

835 
NULL
);

836 
	`gtk_a˘i⁄_group_add_ødio_a˘i⁄s
 (
di•œy_a˘i⁄s
,

837 
di•œy_£À˘_ødio_íåõs
,

838 
	`G_N_ELEMENTS
 (
di•œy_£À˘_ødio_íåõs
),

840 
	`G_CALLBACK
 (
£À˘_°yÀ_ˇŒback
),

841 
NULL
);

843  
di•œy_a˘i⁄s
;

844 
	}
}

848 c⁄° 
gch¨
 *
	gui_öfo
 =

859 
	$míus_öô
()

861 
gch¨
 *
ac˚lfûíame
;

862 
GEº‹
 *
îr‹
 = 
NULL
;

863 
gch¨
 *
uifûe
;

865 i‡(!
öôüli£
)

868 
öôüli£
 = 
FALSE
;

870 
	`ªgi°î_°ock_ic⁄s
 ();

873 
toﬁbox_a˘i⁄s
 = 
	`gtk_a˘i⁄_group_√w
 ("toolbox-actions");

874 
	`gtk_a˘i⁄_group_£t_å™¶©i⁄_domaö
 (
toﬁbox_a˘i⁄s
, 
NULL
);

875 
	`gtk_a˘i⁄_group_£t_å™¶©e_func
 (
toﬁbox_a˘i⁄s
, 
_dü_å™¶©e
, 
NULL
, NULL);

876 
	`gtk_a˘i⁄_group_add_a˘i⁄s
 (
toﬁbox_a˘i⁄s
, 
comm⁄_íåõs
,

877 
	`G_N_ELEMENTS
 (
comm⁄_íåõs
), 
NULL
);

878 
	`gtk_a˘i⁄_group_add_a˘i⁄s
 (
toﬁbox_a˘i⁄s
, 
toﬁbox_íåõs
,

879 
	`G_N_ELEMENTS
 (
toﬁbox_íåõs
), 
NULL
);

880 
	`gtk_a˘i⁄_group_add_toggÀ_a˘i⁄s
 (
toﬁbox_a˘i⁄s
, 
toﬁbox_toggÀ_íåõs
,

881 
	`G_N_ELEMENTS
 (
toﬁbox_toggÀ_íåõs
),

882 
NULL
);

884 
toﬁbox_ui_m™agî
 = 
	`gtk_ui_m™agî_√w
 ();

885 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
toﬁbox_ui_m™agî
),

887 
	`G_CALLBACK
 (
_ui_m™agî_c⁄√˘_¥oxy
),

888 
NULL
);

889 
	`gtk_ui_m™agî_£t_add_ã¨offs
 (
toﬁbox_ui_m™agî
, 
DIA_SHOW_TEAROFFS
);

890 
	`gtk_ui_m™agî_ö£π_a˘i⁄_group
 (
toﬁbox_ui_m™agî
, 
toﬁbox_a˘i⁄s
, 0);

891 
uifûe
 = 
	`buûd_ui_fûíame
 ("ui/toolbox-ui.xml");

892 i‡(!
	`gtk_ui_m™agî_add_ui_‰om_fûe
 (
toﬁbox_ui_m™agî
, 
uifûe
, &
îr‹
)) {

893 
	`g_w¨nög
 ("buûdög míu†Áûed: %s", 
îr‹
->
mesßge
);

894 
	`g_îr‹_‰ì
 (
îr‹
);

895 
îr‹
 = 
NULL
;

897 
	`g_‰ì
 (
uifûe
);

899 
toﬁbox_ac˚ls
 = 
	`gtk_ui_m™agî_gë_ac˚l_group
 (
toﬁbox_ui_m™agî
);

900 
toﬁbox_míub¨
 = 
	`gtk_ui_m™agî_gë_widgë
 (
toﬁbox_ui_m™agî
, 
TOOLBOX_MENU
);

903 
di•œy_a˘i⁄s
 = 
	`¸óã_‹_ªf_di•œy_a˘i⁄s
 ();

904 
di•œy_toﬁ_a˘i⁄s
 = 
	`¸óã_toﬁ_a˘i⁄s
 ();

906 
di•œy_ui_m™agî
 = 
	`gtk_ui_m™agî_√w
 ();

907 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
di•œy_ui_m™agî
),

909 
	`G_CALLBACK
 (
_ui_m™agî_c⁄√˘_¥oxy
),

910 
NULL
);

911 
	`gtk_ui_m™agî_£t_add_ã¨offs
 (
di•œy_ui_m™agî
, 
DIA_SHOW_TEAROFFS
);

912 
	`gtk_ui_m™agî_ö£π_a˘i⁄_group
 (
di•œy_ui_m™agî
, 
di•œy_a˘i⁄s
, 0);

913 
	`gtk_ui_m™agî_ö£π_a˘i⁄_group
 (
di•œy_ui_m™agî
, 
di•œy_toﬁ_a˘i⁄s
, 0);

914 i‡(!
	`gtk_ui_m™agî_add_ui_‰om_°rög
 (
di•œy_ui_m™agî
, 
ui_öfo
, -1, &
îr‹
)) {

915 
	`g_w¨nög
 ("buût-ö míu†Áûed: %s", 
îr‹
->
mesßge
);

916 
	`g_îr‹_‰ì
 (
îr‹
);

917 
îr‹
 = 
NULL
;

920 
uifûe
 = 
	`buûd_ui_fûíame
 ("ui/popup-ui.xml");

923 i‡(!
	`gtk_ui_m™agî_add_ui_‰om_fûe
 (
di•œy_ui_m™agî
, 
uifûe
, &
îr‹
)) {

924 
	`g_w¨nög
 ("buûdög míu†Áûed: %s", 
îr‹
->
mesßge
);

925 
	`g_îr‹_‰ì
 (
îr‹
);

926 
îr‹
 = 
NULL
;

928 
	`g_‰ì
 (
uifûe
);

930 
di•œy_ac˚ls
 = 
	`gtk_ui_m™agî_gë_ac˚l_group
 (
di•œy_ui_m™agî
);

931 
di•œy_míub¨
 = 
	`gtk_ui_m™agî_gë_widgë
 (
di•œy_ui_m™agî
, 
DISPLAY_MENU
);

932 
	`g_as£π
 (
di•œy_míub¨
);

934 
	`add_∂ugö_a˘i⁄s
 (
toﬁbox_ui_m™agî
, 
TOOLBOX_MENU
);

935 
	`add_∂ugö_a˘i⁄s
 (
di•œy_ui_m™agî
, 
DISPLAY_MENU
);

936 
	`add_∂ugö_a˘i⁄s
 (
di•œy_ui_m™agî
, 
INVISIBLE_MENU
);

939 
ac˚lfûíame
 = 
	`dü_c⁄fig_fûíame
("menurc");

941 i‡(
ac˚lfûíame
) {

942 
	`gtk_ac˚l_m≠_lﬂd
(
ac˚lfûíame
);

943 
	`g_‰ì
(
ac˚lfûíame
);

945 
	`gtk_quô_add
(1, 
ßve_ac˚ls
, 
NULL
);

946 
	}
}

949 
	$míus_gë_öãgøãd_ui_míub¨
 (
GtkWidgë
 **
míub¨
,

950 
GtkWidgë
 **
toﬁb¨
,

951 
GtkAc˚lGroup
 **
ac˚l_group
)

953 
GEº‹
 *
îr‹
 = 
NULL
;

954 
gch¨
 *
uifûe
;

956 i‡(
öôüli£
)

957 
	`míus_öô
();

960 
öãgøãd_ui_a˘i⁄s
 = 
	`gtk_a˘i⁄_group_√w
 ("integrated-ui-actions");

961 
	`gtk_a˘i⁄_group_£t_å™¶©i⁄_domaö
 (
öãgøãd_ui_a˘i⁄s
, 
NULL
);

962 
	`gtk_a˘i⁄_group_£t_å™¶©e_func
 (
öãgøãd_ui_a˘i⁄s
, 
_dü_å™¶©e
, 
NULL
, NULL);

963 
	`gtk_a˘i⁄_group_add_a˘i⁄s
 (
öãgøãd_ui_a˘i⁄s
, 
comm⁄_íåõs
,

964 
	`G_N_ELEMENTS
 (
comm⁄_íåõs
), 
NULL
);

965 
	`gtk_a˘i⁄_group_add_a˘i⁄s
 (
öãgøãd_ui_a˘i⁄s
, 
toﬁbox_íåõs
,

966 
	`G_N_ELEMENTS
 (
toﬁbox_íåõs
), 
NULL
);

967 
	`gtk_a˘i⁄_group_add_a˘i⁄s
 (
öãgøãd_ui_a˘i⁄s
, 
di•œy_íåõs
,

968 
	`G_N_ELEMENTS
 (
di•œy_íåõs
), 
NULL
);

969 
	`gtk_a˘i⁄_group_add_toggÀ_a˘i⁄s
 (
öãgøãd_ui_a˘i⁄s
, 
öãgøãd_ui_võw_toggÀ_íåõs
,

970 
	`G_N_ELEMENTS
 (
öãgøãd_ui_võw_toggÀ_íåõs
), 
NULL
);

971 
	`gtk_a˘i⁄_group_add_toggÀ_a˘i⁄s
 (
öãgøãd_ui_a˘i⁄s
, 
toﬁbox_toggÀ_íåõs
,

972 
	`G_N_ELEMENTS
 (
toﬁbox_toggÀ_íåõs
),

973 
NULL
);

974 
	`gtk_a˘i⁄_group_add_toggÀ_a˘i⁄s
 (
öãgøãd_ui_a˘i⁄s
, 
di•œy_toggÀ_íåõs
,

975 
	`G_N_ELEMENTS
 (
di•œy_toggÀ_íåõs
),

976 
NULL
);

977 
	`gtk_a˘i⁄_group_add_ødio_a˘i⁄s
 (
öãgøãd_ui_a˘i⁄s
,

978 
di•œy_£À˘_ødio_íåõs
,

979 
	`G_N_ELEMENTS
 (
di•œy_£À˘_ødio_íåõs
),

981 
	`G_CALLBACK
 (
£À˘_°yÀ_ˇŒback
),

982 
NULL
);

984 
öãgøãd_ui_toﬁ_a˘i⁄s
 = 
	`¸óã_toﬁ_a˘i⁄s
 ();

986 
öãgøãd_ui_m™agî
 = 
	`gtk_ui_m™agî_√w
 ();

987 
	`gtk_ui_m™agî_£t_add_ã¨offs
 (
öãgøãd_ui_m™agî
, 
DIA_SHOW_TEAROFFS
);

988 
	`gtk_ui_m™agî_ö£π_a˘i⁄_group
 (
öãgøãd_ui_m™agî
, 
öãgøãd_ui_a˘i⁄s
, 0);

989 
	`gtk_ui_m™agî_ö£π_a˘i⁄_group
 (
öãgøãd_ui_m™agî
, 
öãgøãd_ui_toﬁ_a˘i⁄s
, 0);

991 
uifûe
 = 
	`buûd_ui_fûíame
 ("ui/integrated-ui.xml");

992 i‡(!
	`gtk_ui_m™agî_add_ui_‰om_fûe
 (
öãgøãd_ui_m™agî
, 
uifûe
, &
îr‹
)) {

993 
	`g_w¨nög
 ("buûdög i¡egøãd uòmíu†Áûed: %s", 
îr‹
->
mesßge
);

994 
	`g_îr‹_‰ì
 (
îr‹
);

995 
îr‹
 = 
NULL
;

997 
	`g_‰ì
 (
uifûe
);

998 i‡(!
	`gtk_ui_m™agî_add_ui_‰om_°rög
 (
öãgøãd_ui_m™agî
, 
ui_öfo
, -1, &
îr‹
)) {

999 
	`g_w¨nög
 ("buût-ö míu†Áûed: %s", 
îr‹
->
mesßge
);

1000 
	`g_îr‹_‰ì
 (
îr‹
);

1001 
îr‹
 = 
NULL
;

1004 
	`add_∂ugö_a˘i⁄s
 (
öãgøãd_ui_m™agî
, 
NULL
);

1006 
öãgøãd_ui_ac˚ls
 = 
	`gtk_ui_m™agî_gë_ac˚l_group
 (
öãgøãd_ui_m™agî
);

1007 
öãgøãd_ui_míub¨
 = 
	`gtk_ui_m™agî_gë_widgë
 (
öãgøãd_ui_m™agî
, 
INTEGRATED_MENU
);

1008 
öãgøãd_ui_toﬁb¨
 = 
	`¸óã_öãgøãd_ui_toﬁb¨
 ();

1010 i‡(
míub¨
)

1011 *
míub¨
 = 
öãgøãd_ui_míub¨
;

1012 i‡(
toﬁb¨
)

1013 *
toﬁb¨
 = 
öãgøãd_ui_toﬁb¨
;

1014 i‡(
ac˚l_group
)

1015 *
ac˚l_group
 = 
öãgøãd_ui_ac˚ls
;

1016 
	}
}

1019 
	$míus_gë_toﬁbox_míub¨
 (
GtkWidgë
 **
míub¨
,

1020 
GtkAc˚lGroup
 **
ac˚l_group
)

1022 i‡(
öôüli£
)

1023 
	`míus_öô
();

1025 i‡(
míub¨
)

1026 *
míub¨
 = 
toﬁbox_míub¨
;

1027 i‡(
ac˚l_group
)

1028 *
ac˚l_group
 = 
toﬁbox_ac˚ls
;

1029 
	}
}

1031 
GtkWidgë
 *

1032 
	$míus_gë_di•œy_p›up
 ()

1034 i‡(
öôüli£
)

1035 
	`míus_öô
();

1037  
di•œy_míub¨
;

1038 
	}
}

1040 
GtkAc˚lGroup
 *

1041 
	$míus_gë_di•œy_ac˚ls
 ()

1043 i‡(
öôüli£
)

1044 
	`míus_öô
();

1046 i‡(
	`is_öãgøãd_ui
 ())

1047  
öãgøãd_ui_ac˚ls
;

1049  
di•œy_ac˚ls
;

1050 
	}
}

1052 
GtkWidgë
 *

1053 
	$míus_¸óã_di•œy_míub¨
 (
GtkUIM™agî
 **
ui_m™agî
,

1054 
GtkA˘i⁄Group
 **
a˘i⁄s
)

1056 
GtkA˘i⁄Group
 *
toﬁ_a˘i⁄s
;

1057 
GtkWidgë
 *
míu_b¨
;

1058 
GEº‹
 *
îr‹
 = 
NULL
;

1059 
gch¨
 *
uifûe
;

1062 *
a˘i⁄s
 = 
	`¸óã_‹_ªf_di•œy_a˘i⁄s
 ();

1063 
toﬁ_a˘i⁄s
 = 
	`¸óã_toﬁ_a˘i⁄s
 ();

1065 *
ui_m™agî
 = 
	`gtk_ui_m™agî_√w
 ();

1066 
	`gtk_ui_m™agî_£t_add_ã¨offs
 (*
ui_m™agî
, 
DIA_SHOW_TEAROFFS
);

1067 
	`gtk_ui_m™agî_ö£π_a˘i⁄_group
 (*
ui_m™agî
, *
a˘i⁄s
, 0);

1068 
	`gtk_ui_m™agî_ö£π_a˘i⁄_group
 (*
ui_m™agî
, 
toﬁ_a˘i⁄s
, 0);

1069 
	`g_obje˘_uƒef
 (
	`G_OBJECT
 (
toﬁ_a˘i⁄s
));

1071 
uifûe
 = 
	`buûd_ui_fûíame
 ("ui/display-ui.xml");

1072 i‡(!
	`gtk_ui_m™agî_add_ui_‰om_fûe
 (*
ui_m™agî
, 
uifûe
, &
îr‹
)) {

1073 
	`g_w¨nög
 ("buûdög míu†Áûed: %s", 
îr‹
->
mesßge
);

1074 
	`g_îr‹_‰ì
 (
îr‹
);

1075 
	`g_‰ì
 (
uifûe
);

1076  
NULL
;

1078 
	`g_‰ì
 (
uifûe
);

1080 
	`add_∂ugö_a˘i⁄s
 (*
ui_m™agî
, 
DISPLAY_MENU
);

1081 
míu_b¨
 = 
	`gtk_ui_m™agî_gë_widgë
 (*
ui_m™agî
, 
DISPLAY_MENU
);

1082  
míu_b¨
;

1083 
	}
}

1085 
GtkAc˚lGroup
 *

1086 
	$míus_gë_ac˚l_group
 ()

1088  
	`is_öãgøãd_ui
 ()? 
öãgøãd_ui_ac˚ls
 : 
toﬁbox_ac˚ls
;

1089 
	}
}

1091 
GtkA˘i⁄Group
 *

1092 
	$míus_gë_a˘i⁄_group
 ()

1094  
	`is_öãgøãd_ui
 ()? 
öãgøãd_ui_a˘i⁄s
 : 
toﬁbox_a˘i⁄s
;

1095 
	}
}

1097 
GtkA˘i⁄
 *

1098 
	$míus_gë_a˘i⁄
 (c⁄° 
gch¨
 *
«me
)

1100 
GtkA˘i⁄
 *
a˘i⁄
;

1102 i‡(
	`is_öãgøãd_ui
 ())

1104 
a˘i⁄
 = 
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
öãgøãd_ui_a˘i⁄s
, 
«me
);

1105 i‡(
a˘i⁄
 =
NULL
) {

1106 
a˘i⁄
 = 
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
öãgøãd_ui_toﬁ_a˘i⁄s
, 
«me
);

1111 
a˘i⁄
 = 
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
toﬁbox_a˘i⁄s
, 
«me
);

1112 i‡(
a˘i⁄
 =
NULL
) {

1113 
a˘i⁄
 = 
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
di•œy_a˘i⁄s
, 
«me
);

1115 i‡(
a˘i⁄
 =
NULL
) {

1116 
a˘i⁄
 = 
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
di•œy_toﬁ_a˘i⁄s
, 
«me
);

1119 i‡(!
a˘i⁄
) {

1120 
GLi°
 *
groups
, *
li°
;

1123 
groups
 = 
	`gtk_ui_m™agî_gë_a˘i⁄_groups
 (
di•œy_ui_m™agî
);

1124 
li°
 = 
groups
;Üi° !
NULL
;Üi° =Üi°->
√xt
) {

1125 
a˘i⁄
 = 
	`gtk_a˘i⁄_group_gë_a˘i⁄
 (
	`GTK_ACTION_GROUP
 (
li°
->
d©a
), 
«me
);

1126 i‡(
a˘i⁄
)

1131  
a˘i⁄
;

1132 
	}
}

1135 
	$míus_£t_ª˚¡
 (
GtkA˘i⁄Group
 *
a˘i⁄s
)

1137 
GLi°
 *
li°
;

1138 
guöt
 
id
;

1139 
GtkUIM™agî
 *
ui_m™agî
;

1140 c⁄° *
ª˚¡_∑th
;

1142 i‡(
	`is_öãgøãd_ui
 ())

1144 
ui_m™agî
 = 
öãgøãd_ui_m™agî
;

1145 
ª˚¡_∑th
 = 
INTEGRATED_MENU
 "/File/FileRecentEnd";

1149 
ui_m™agî
 = 
toﬁbox_ui_m™agî
;

1150 
ª˚¡_∑th
 = 
TOOLBOX_MENU
 "/File/FileRecentEnd";

1153 i‡(
ª˚¡_a˘i⁄s
) {

1154 
	`míus_˛ór_ª˚¡
 ();

1157 
li°
 = 
	`gtk_a˘i⁄_group_li°_a˘i⁄s
 (
a˘i⁄s
);

1158 
	`g_ªtu∫_if_Áû
 (
li°
);

1160 
ª˚¡_a˘i⁄s
 = 
a˘i⁄s
;

1161 
	`g_obje˘_ªf
 (
	`G_OBJECT
 (
ª˚¡_a˘i⁄s
));

1162 
	`gtk_ui_m™agî_ö£π_a˘i⁄_group
 (
ui_m™agî
,

1163 
ª˚¡_a˘i⁄s
,

1167 
id
 = 
	`gtk_ui_m™agî_√w_mîge_id
 (
ui_m™agî
);

1168 
ª˚¡_mîge_ids
 = 
	`g_¶i°_¥ïíd
 (ª˚¡_mîge_ids, (
gpoöãr
Ë
id
);

1170 
	`gtk_ui_m™agî_add_ui
 (
ui_m™agî
, 
id
,

1171 
ª˚¡_∑th
,

1172 
	`gtk_a˘i⁄_gë_«me
 (
	`GTK_ACTION
 (
li°
->
d©a
)),

1173 
	`gtk_a˘i⁄_gë_«me
 (
	`GTK_ACTION
 (
li°
->
d©a
)),

1174 
GTK_UI_MANAGER_AUTO
,

1175 
TRUE
);

1177 } 
NULL
 !(
li°
 =Üi°->
√xt
));

1178 
	}
}

1181 
	$míus_˛ór_ª˚¡
 ()

1183 
GSLi°
 *
id
;

1184 
GtkUIM™agî
 *
ui_m™agî
;

1186 i‡(
	`is_öãgøãd_ui
 ())

1187 
ui_m™agî
 = 
öãgøãd_ui_m™agî
;

1189 
ui_m™agî
 = 
toﬁbox_ui_m™agî
;

1191 i‡(
ª˚¡_mîge_ids
) {

1192 
id
 = 
ª˚¡_mîge_ids
;

1194 
	`gtk_ui_m™agî_ªmove_ui
 (
ui_m™agî
, (
guöt
Ë
id
->
d©a
);

1196 } 
NULL
 !(
id
 = id->
√xt
));

1198 
	`g_¶i°_‰ì
 (
ª˚¡_mîge_ids
);

1199 
ª˚¡_mîge_ids
 = 
NULL
;

1202 i‡(
ª˚¡_a˘i⁄s
) {

1203 
	`gtk_ui_m™agî_ªmove_a˘i⁄_group
 (
ui_m™agî
, 
ª˚¡_a˘i⁄s
);

1204 
	`g_obje˘_uƒef
 (
	`G_OBJECT
 (
ª˚¡_a˘i⁄s
));

1205 
ª˚¡_a˘i⁄s
 = 
NULL
;

1207 
	}
}

1210 
	$∂ugö_ˇŒback
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

1212 
DüCÆlbackFûãr
 *
cbf
 = 
d©a
;

1215 i‡(
cbf
->
ˇŒback
) {

1216 
DDi•œy
 *
ddi•
 = 
NULL
;

1217 
DügømD©a
* 
düd©a
 = 
NULL
;

1219 i‡(
	`°∫cmp
 (
cbf
->
míu∑th
, 
TOOLBOX_MENU
, 
	`°æí
 (TOOLBOX_MENU)) != 0) {

1220 
ddi•
 = 
	`ddi•œy_a˘ive
();

1221 
düd©a
 = 
ddi•
 ? ddi•->
dügøm
->
d©a
 : 
NULL
;

1223 
cbf
->
	`ˇŒback
 (
düd©a
, 
ddi•
 ? ddi•->
dügøm
->
fûíame
 : 
NULL
, 0, cbf->
u£r_d©a
);

1225 
	}
}

	@O:\tool\dvs50\app\menus.h

18 #i‚de‡
MENUS_H


19 
	#MENUS_H


	)

21 
	~<gtk/gtk.h
>

23 
	#TOOLBOX_MENU
 "/ToﬁboxMíu"

	)

24 
	#DISPLAY_MENU
 "/Di•œyMíu"

	)

25 
	#INTEGRATED_MENU
 "/I¡egøãdUIMíu"

	)

26 
	#INVISIBLE_MENU
 "/InvisibÀMíu"

	)

28 
	szoom_∑ú
 { c⁄° 
gch¨
 *
	m°rög
; c⁄° 
göt
 
	mvÆue
; };

30 c⁄° 
zoom_∑ú
 
zooms
[10];

32 
öãgøãd_ui_toﬁb¨_£t_zoom_ãxt
 (
GtkToﬁb¨
 *
toﬁb¨
, c⁄° 
gch¨
 * 
ãxt
);

34 
öãgøãd_ui_toﬁb¨_grid_¢≠_synchr⁄ize_to_di•œy
 (
gpoöãr
 
ddi•
);

36 
öãgøãd_ui_toﬁb¨_obje˘_¢≠_synchr⁄ize_to_di•œy
 (
gpoöãr
 
ddi•
);

39 
míus_gë_öãgøãd_ui_míub¨
 (
GtkWidgë
 **
míub¨
, GtkWidgë **
toﬁb¨
,

40 
GtkAc˚lGroup
 **
ac˚l
);

41 
míus_gë_toﬁbox_míub¨
 (
GtkWidgë
 **
míub¨
, 
GtkAc˚lGroup
 **
ac˚l
);

42 
GtkWidgë
 * 
míus_gë_di•œy_p›up
 ();

43 
GtkAc˚lGroup
 * 
míus_gë_di•œy_ac˚ls
 ();

44 
GtkWidgë
 * 
míus_¸óã_di•œy_míub¨
 (
GtkUIM™agî
 **
ui_m™agî
, 
GtkA˘i⁄Group
 **
a˘i⁄s
);

46 
GtkAc˚lGroup
 * 
míus_gë_ac˚l_group
 ();

47 
GtkA˘i⁄Group
 * 
míus_gë_a˘i⁄_group
 ();

49 
GtkA˘i⁄
 * 
míus_gë_a˘i⁄
 (c⁄° 
gch¨
 *
«me
);

50 
míus_£t_ª˚¡
 (
GtkA˘i⁄Group
 *
a˘i⁄s
);

51 
míus_˛ór_ª˚¡
 ();

53 
	#VIEW_MAIN_TOOLBAR_ACTION
 "VõwMaöToﬁb¨"

	)

54 
	#VIEW_MAIN_STATUSBAR_ACTION
 "VõwMaöSètusb¨"

	)

55 
	#VIEW_LAYERS_ACTION
 "VõwLayîs"

	)

	@O:\tool\dvs50\app\modify_tool.c

18 
	~<c⁄fig.h
>

20 
	~<°dio.h
>

21 
	~<m©h.h
>

23 
	~"modify_toﬁ.h
"

24 
	~"h™dÀ_›s.h
"

25 
	~"obje˘_›s.h
"

26 
	~"c⁄√˘i⁄poöt_›s.h
"

27 
	~"mesßge.h
"

28 
	~"¥›îtõs-dülog.h
"

29 
	~"£À˘.h
"

30 
	~"¥e„ªn˚s.h
"

31 
	~"curs‹.h
"

32 
	~"highlight.h
"

33 
	~"ãxãdô.h
"

34 
	~"ãxéöe.h
"

36 
	~"∑ª¡.h
"

37 
	~"düˇnvas.h
"

38 
	~"¥›_ãxt.h
"

39 
	~"gtk/gtk.h
"

42 
DüObje˘
 *
˛ick_£À˘_obje˘
(
DDi•œy
 *
ddi•
, 
Poöt
 *
˛ickedpoöt
,

43 
GdkEvítBuâ⁄
 *
evít
);

44 
do_if_˛icked_h™dÀ
(
DDi•œy
 *
ddi•
, 
ModifyToﬁ
 *
toﬁ
,

45 
Poöt
 *
˛ickedpoöt
,

46 
GdkEvítBuâ⁄
 *
evít
);

47 
modify_buâ⁄_¥ess
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

48 
DDi•œy
 *
ddi•
);

49 
modify_buâ⁄_hﬁd
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

50 
DDi•œy
 *
ddi•
);

51 
modify_buâ⁄_ªÀa£
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

52 
DDi•œy
 *
ddi•
);

53 
modify_mŸi⁄
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

54 
DDi•œy
 *
ddi•
);

55 
modify_doubÀ_˛ick
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

56 
DDi•œy
 *
ddi•
);

57 
modify_make_ãxt_edô
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
,

58 
Poöt
 *
˛ickedpoöt
);

59 
modify_°¨t_ãxt_edô
(
DDi•œy
 *
ddi•
, 
Text
 *
ãxt
, 
DüObje˘
 *
obj
,

60 
Poöt
 *
˛ickedpoöt
);

63 
Toﬁ
 *

64 
	$¸óã_modify_toﬁ
()

66 
ModifyToﬁ
 *
toﬁ
;

68 
toﬁ
 = 
	`g_√w0
(
ModifyToﬁ
, 1);

69 
toﬁ
->toﬁ.
ty≥
 = 
MODIFY_TOOL
;

70 
toﬁ
->toﬁ.
buâ⁄_¥ess_func
 = (
Buâ⁄PªssFunc
Ë&
modify_buâ⁄_¥ess
;

71 
toﬁ
->toﬁ.
buâ⁄_hﬁd_func
 = (
Buâ⁄HﬁdFunc
Ë&
modify_buâ⁄_hﬁd
;

72 
toﬁ
->toﬁ.
buâ⁄_ªÀa£_func
 = (
Buâ⁄Rñó£Func
Ë&
modify_buâ⁄_ªÀa£
;

73 
toﬁ
->toﬁ.
mŸi⁄_func
 = (
MŸi⁄Func
Ë&
modify_mŸi⁄
;

74 
toﬁ
->toﬁ.
doubÀ_˛ick_func
 = (
DoubÀClickFunc
Ë&
modify_doubÀ_˛ick
;

75 
toﬁ
->
gc
 = 
NULL
;

76 
toﬁ
->
°©e
 = 
STATE_NONE
;

77 
toﬁ
->
bªak_c⁄√˘i⁄s
 = 0;

78 
toﬁ
->
auto_s¸ﬁÀd
 = 
FALSE
;

80 
toﬁ
->
‹ig_pos
 = 
NULL
;

82  (
Toﬁ
 *)
toﬁ
;

83 
	}
}

85 
ModifõrKeys


86 
	$gdk_evít_to_dü_ModifõrKeys
(
guöt
 
evít_°©e
)

88 
ModifõrKeys
 
mod
 = 
MODIFIER_NONE
;

89 i‡(
evít_°©e
 & 
GDK_SHIFT_MASK
)

90 
mod
 |
MODIFIER_SHIFT
;

95  
mod
;

96 
	}
}

100 
	$‰ì_modify_toﬁ
(
Toﬁ
 *
toﬁ
)

102 
ModifyToﬁ
 *
mtoﬁ
 = (ModifyToﬁ *)
toﬁ
;

103 i‡(
mtoﬁ
->
gc
)

104 
	`gdk_gc_uƒef
(
mtoﬁ
->
gc
);

105 
	`g_‰ì
(
mtoﬁ
);

106 
	}
}

131 
DüObje˘
 *

132 
	$˛ick_£À˘_obje˘
(
DDi•œy
 *
ddi•
, 
Poöt
 *
˛ickedpoöt
,

133 
GdkEvítBuâ⁄
 *
evít
)

135 
Dügøm
 *
dügøm
;

136 
ªÆ
 
˛ick_di°™˚
;

137 
DüObje˘
 *
obj
;

139 
dügøm
 = 
ddi•
->diagram;

143 
˛ick_di°™˚
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 3.0);

145 
obj
 = 
	`dügøm_föd_˛icked_obje˘
(
dügøm
, 
˛ickedpoöt
,

146 
˛ick_di°™˚
);

148 i‡(
obj
!=
NULL
) {

150 
GLi°
 *
Æªady
;

153 
Æªady
 = 
	`g_li°_föd
(
dügøm
->
d©a
->
£À˘ed
, 
obj
);

154 i‡(
Æªady
 =
NULL
) {

157 i‡(!(
evít
->
°©e
 & 
GDK_SHIFT_MASK
)) {

159 
	`dügøm_ªmove_Æl_£À˘ed
(
dügøm
, 
TRUE
);

162 
	`dügøm_£À˘
(
dügøm
, 
obj
);

175 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

176 
	`obje˘_add_upd©es_li°
(
dügøm
->
d©a
->
£À˘ed
, diagram);

177 
	`dügøm_Êush
(
dügøm
);

179  
obj
;

186 
	`obje˘_add_upd©es_li°
(
dügøm
->
d©a
->
£À˘ed
, diagram);

187 
	`dügøm_Êush
(
dügøm
);

189 i‡(
evít
->
°©e
 & 
GDK_SHIFT_MASK
) {

191 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

192 
	`dügøm_un£À˘_obje˘
(
dügøm
, (
DüObje˘
 *)
Æªady
->
d©a
);

193 
	`dügøm_Êush
(
ddi•
->
dügøm
);

196 #ifde‡
NEW_TEXT_EDIT


197 
	`modify_make_ãxt_edô
(
ddi•
, 
obj
, 
˛ickedpoöt
);

199  
obj
;

204  
NULL
;

205 
	}
}

207 
gl⁄g


208 
	$time_mi¸o
()

210 
GTimeVÆ
 
tv
;

212 
	`g_gë_cuºít_time
(&
tv
);

213  
tv
.
tv_£c
*
G_USEC_PER_SEC
+tv.
tv_u£c
;

214 
	}
}

216 
	$do_if_˛icked_h™dÀ
(
DDi•œy
 *
ddi•
, 
ModifyToﬁ
 *
toﬁ
,

217 
Poöt
 *
˛ickedpoöt
, 
GdkEvítBuâ⁄
 *
evít
)

219 
DüObje˘
 *
obj
;

220 
H™dÀ
 *
h™dÀ
;

221 
ªÆ
 
di°
;

223 
h™dÀ
 = 
NULL
;

224 
di°
 = 
	`dügøm_föd_˛o£°_h™dÀ
(
ddi•
->
dügøm
, &
h™dÀ
,

225 &
obj
, 
˛ickedpoöt
);

226 i‡(
	`h™dÀ_is_˛icked
(
ddi•
, 
h™dÀ
, 
˛ickedpoöt
)) {

227 
toﬁ
->
°©e
 = 
STATE_MOVE_HANDLE
;

228 
toﬁ
->
bªak_c⁄√˘i⁄s
 = 
TRUE
;

229 
toﬁ
->
œ°_to
 = 
h™dÀ
->
pos
;

230 
toﬁ
->
h™dÀ
 = handle;

231 
toﬁ
->
obje˘
 = 
obj
;

232 
	`gdk_poöãr_gøb
 (
ddi•
->
ˇnvas
->
wödow
, 
FALSE
,

233 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

234 
NULL
, NULL, 
evít
->
time
);

235 
toﬁ
->
°¨t_©
 = 
h™dÀ
->
pos
;

236 
toﬁ
->
°¨t_time
 = 
	`time_mi¸o
();

237 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_SCROLL
));

238  
TRUE
;

240  
FALSE
;

241 
	}
}

244 
	$modify_buâ⁄_¥ess
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

245 
DDi•œy
 *
ddi•
)

247 
Poöt
 
˛ickedpoöt
;

248 
DüObje˘
 *
˛icked_obj
;

249 
gboﬁón
 
some_£À˘ed
;

251 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
,

252 ()
evít
->
x
, (Îvít->
y
,

253 &
˛ickedpoöt
.
x
, &˛ickedpoöt.
y
);

256 
some_£À˘ed
 = 
	`g_li°_Àngth
 (
ddi•
->
dügøm
->
d©a
->
£À˘ed
) > 1;

257 i‡(!
some_£À˘ed
 && 
	`do_if_˛icked_h™dÀ
(
ddi•
, 
toﬁ
, &
˛ickedpoöt
, 
evít
))

260 
˛icked_obj
 = 
	`˛ick_£À˘_obje˘
(
ddi•
, &
˛ickedpoöt
, 
evít
);

261 i‡(!
some_£À˘ed
 && 
	`do_if_˛icked_h™dÀ
(
ddi•
, 
toﬁ
, &
˛ickedpoöt
, 
evít
))

264 i‡–
˛icked_obj
 !
NULL
 ) {

265 
toﬁ
->
°©e
 = 
STATE_MOVE_OBJECT
;

266 
toﬁ
->
obje˘
 = 
˛icked_obj
;

267 
toﬁ
->
move_com≥nßã
 = 
˛icked_obj
->
posôi⁄
;

268 
	`poöt_sub
(&
toﬁ
->
move_com≥nßã
, &
˛ickedpoöt
);

269 
toﬁ
->
bªak_c⁄√˘i⁄s
 = 
TRUE
;

270 
	`gdk_poöãr_gøb
 (
ddi•
->
ˇnvas
->
wödow
, 
FALSE
,

271 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

272 
NULL
, NULL, 
evít
->
time
);

273 
toﬁ
->
°¨t_©
 = 
˛ickedpoöt
;

274 
toﬁ
->
°¨t_time
 = 
	`time_mi¸o
();

275 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_SCROLL
));

277 
toﬁ
->
°©e
 = 
STATE_BOX_SELECT
;

278 
toﬁ
->
°¨t_box
 = 
˛ickedpoöt
;

279 
toﬁ
->
íd_box
 = 
˛ickedpoöt
;

280 
toﬁ
->
x1
 =Åoﬁ->
x2
 = (Ë
evít
->
x
;

281 
toﬁ
->
y1
 =Åoﬁ->
y2
 = (Ë
evít
->
y
;

283 i‡(
toﬁ
->
gc
 =
NULL
) {

284 
toﬁ
->
gc
 = 
	`gdk_gc_√w
(
ddi•
->
ˇnvas
->
wödow
);

285 
	`gdk_gc_£t_löe_©åibuãs
(
toﬁ
->
gc
, 1, 
GDK_LINE_ON_OFF_DASH
,

286 
GDK_CAP_BUTT
, 
GDK_JOIN_MITER
);

287 
	`gdk_gc_£t_f‹eground
(
toﬁ
->
gc
, &
cﬁ‹_gdk_whôe
);

288 
	`gdk_gc_£t_fun˘i⁄
(
toﬁ
->
gc
, 
GDK_XOR
);

291 
	`gdk_døw_ª˘™gÀ
 (
ddi•
->
ˇnvas
->
wödow
, 
toﬁ
->
gc
, 
FALSE
,

292 
toﬁ
->
x1
,Åoﬁ->
y1
,

293 
toﬁ
->
x2
 -Åoﬁ->
x1
,Åoﬁ->
y2
 -Åoﬁ->
y1
);

295 
	`gdk_poöãr_gøb
 (
ddi•
->
ˇnvas
->
wödow
, 
FALSE
,

296 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

297 
NULL
, NULL, 
evít
->
time
);

299 
	}
}

303 
	$modify_buâ⁄_hﬁd
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

304 
DDi•œy
 *
ddi•
)

306 
Poöt
 
˛ickedpoöt
;

308 
toﬁ
->
°©e
) {

309 
STATE_MOVE_OBJECT
:

312 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
,

313 ()
evít
->
x
, (Îvít->
y
,

314 &
˛ickedpoöt
.
x
, &˛ickedpoöt.
y
);

316 i‡(
toﬁ
->
obje˘
 !
NULL
 &&

317 
	`dügøm_is_£À˘ed
(
ddi•
->
dügøm
, 
toﬁ
->
obje˘
)) {

318 i‡(
	`ãxãdô_a˘iv©e_obje˘
(
ddi•
, 
toﬁ
->
obje˘
, &
˛ickedpoöt
)) {

320 
	`gdk_poöãr_ungøb
 (
evít
->
time
);

321 
toﬁ
->
‹ig_pos
 = 
NULL
;

322 
toﬁ
->
°©e
 = 
STATE_NONE
;

324 
	`gtk_a˘i⁄_a˘iv©e
 (
	`míus_gë_a˘i⁄
 ("ToolsTextedit"));

328 
STATE_MOVE_HANDLE
:

330 
STATE_BOX_SELECT
:

332 
STATE_NONE
:

335 
	`mesßge_îr‹
("InternalÉrror: Strange state in modify_tool (button_hold)\n");

337 
	}
}

340 
	$modify_doubÀ_˛ick
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

341 
DDi•œy
 *
ddi•
)

343 
Poöt
 
˛ickedpoöt
;

344 
DüObje˘
 *
˛icked_obj
;

346 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
,

347 ()
evít
->
x
, (Îvít->
y
,

348 &
˛ickedpoöt
.
x
, &˛ickedpoöt.
y
);

350 
˛icked_obj
 = 
	`˛ick_£À˘_obje˘
(
ddi•
, &
˛ickedpoöt
, 
evít
);

352 i‡–
˛icked_obj
 !
NULL
 ) {

353 
	`obje˘_li°_¥›îtõs_show
(
ddi•
->
dügøm
, ddi•->dügøm->
d©a
->
£À˘ed
);

356 i‡(!(
evít
->
°©e
 & 
GDK_SHIFT_MASK
)) {

358 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

359 
	`dügøm_ªmove_Æl_£À˘ed
(
ddi•
->
dügøm
, 
TRUE
);

360 
	`dügøm_Êush
(
ddi•
->
dügøm
);

363 
	}
}

365 
	#MIN_PIXELS
 10

	)

378 
gboﬁón


379 
	$modify_move_Æªady
(
ModifyToﬁ
 *
toﬁ
, 
DDi•œy
 *
ddi•
, 
Poöt
 *
to
)

381 
gboﬁón
 
£âögs_èkí
 = 
FALSE
;

382 
doubÀ_˛ick_time
 = 250;

383 
ªÆ
 
di°
;

385 i‡(!
£âögs_èkí
) {

390 
GtkSëtögs
 *
£âögs
 = 
	`gtk_£âögs_gë_deÁu…
();

391 i‡(
£âögs
 =
NULL
) {

392 
	`g_mesßge
(
	`_
("Couldn't get GTK settings"));

394 
	`g_obje˘_gë
(
	`G_OBJECT
(
£âögs
),

395 "gtk-doubÀ-˛ick-time", &
doubÀ_˛ick_time
, 
NULL
);

397 
£âögs_èkí
 = 
TRUE
;

399 i‡(
toﬁ
->
°¨t_time
 < 
	`time_mi¸o
()-
doubÀ_˛ick_time
*1000) {

400  
TRUE
;

402 
di°
 = 
	`di°™˚_poöt_poöt_m™h©èn
(&
toﬁ
->
°¨t_©
, 
to
);

403 i‡(
ddi•
->
grid
.
¢≠
) {

404 
ªÆ
 
grid_x
 = 
ddi•
->
dügøm
->
grid
.
width_x
;

405 
ªÆ
 
grid_y
 = 
ddi•
->
dügøm
->
grid
.
width_y
;

406 i‡(
di°
 > 
grid_x
 || di° > 
grid_y
) {

407  
TRUE
;

410 i‡(
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
, 
di°
Ë> 
MIN_PIXELS
) {

411  (
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
, 
di°
Ë> 
MIN_PIXELS
);

413  
FALSE
;

415 
	}
}

418 
Cﬁ‹
 
	gmaöpoöt_cﬁ‹
 = { 1.0, 0.8, 0.0 };

420 
Cﬁ‹
 
	g˝_cﬁ‹
 = { 1.0, 0.0, 0.0 };

423 
	$modify_mŸi⁄
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

424 
DDi•œy
 *
ddi•
)

426 
Poöt
 
to
;

427 
Poöt
 
now
, 
dñè
, 
fuŒ_dñè
;

428 
gboﬁón
 
auto_s¸ﬁl
, 
vîtiˇl
 = 
FALSE
;

429 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
 = 
NULL
;

430 
Obje˘Ch™ge
 *
objch™ge
;

432 i‡(
toﬁ
->
°©e
==
STATE_NONE
)

435 
auto_s¸ﬁl
 = 
	`ddi•œy_autos¸ﬁl
(
ddi•
, 
evít
->
x
,Évít->
y
);

437 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
, 
evít
->
x
,Évít->
y
, &
to
.x, &to.y);

439 i‡(!
	`modify_move_Æªady
(
toﬁ
, 
ddi•
, &
to
)) ;

441 
toﬁ
->
°©e
) {

442 
STATE_MOVE_OBJECT
:

444 i‡(
toﬁ
->
‹ig_pos
 =
NULL
) {

445 
GLi°
 *
li°
;

446 
i
;

447 
DüObje˘
 *
obj
;

450 
li°
 = 
	`∑ª¡_li°_af„˘ed
(
ddi•
->
dügøm
->
d©a
->
£À˘ed
);

451 
toﬁ
->
‹ig_pos
 = 
	`g_√w
(
Poöt
, 
	`g_li°_Àngth
(
li°
));

452 
i
=0;

453 
li°
 !
NULL
) {

454 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

455 
toﬁ
->
‹ig_pos
[
i
] = 
obj
->
posôi⁄
;

456 
li°
 = 
	`g_li°_√xt
÷i°); 
i
++;

460 i‡(
toﬁ
->
bªak_c⁄√˘i⁄s
)

461 
	`dügøm_unc⁄√˘_£À˘ed
(
ddi•
->
dügøm
);

463 i‡(
evít
->
°©e
 & 
GDK_CONTROL_MASK
) {

464 
fuŒ_dñè
 = 
to
;

465 
	`poöt_sub
(&
fuŒ_dñè
, &
toﬁ
->
°¨t_©
);

466 
vîtiˇl
 = (
	`Ábs
(
fuŒ_dñè
.
x
Ë< fabs(fuŒ_dñè.
y
));

469 
	`poöt_add
(&
to
, &
toﬁ
->
move_com≥nßã
);

470 
	`¢≠_to_grid
(
ddi•
, &
to
.
x
, &to.
y
);

472 
now
 = 
toﬁ
->
obje˘
->
posôi⁄
;

474 
dñè
 = 
to
;

475 
	`poöt_sub
(&
dñè
, &
now
);

477 i‡(
evít
->
°©e
 & 
GDK_CONTROL_MASK
) {

479 i‡(
vîtiˇl
) {

480 
dñè
.
x
 = 
toﬁ
->
°¨t_©
.x +Åoﬁ->
move_com≥nßã
.x - 
now
.x;

482 
dñè
.
y
 = 
toﬁ
->
°¨t_©
.y +Åoﬁ->
move_com≥nßã
.y - 
now
.y;

486 
	`obje˘_add_upd©es_li°
(
ddi•
->
dügøm
->
d©a
->
£À˘ed
, ddisp->diagram);

487 
objch™ge
 = 
	`obje˘_li°_move_dñè
(
ddi•
->
dügøm
->
d©a
->
£À˘ed
, &
dñè
);

488 i‡(
objch™ge
 !
NULL
) {

489 
	`undo_obje˘_ch™ge
(
ddi•
->
dügøm
, 
toﬁ
->
obje˘
, 
objch™ge
);

491 
	`obje˘_add_upd©es_li°
(
ddi•
->
dügøm
->
d©a
->
£À˘ed
, ddisp->diagram);

493 
	`obje˘_add_upd©es
(
toﬁ
->
obje˘
, 
ddi•
->
dügøm
);

497 
gch¨
 *
po°ext
;

498 
GtkSètusb¨
 *
°©usb¨
 = 
	`GTK_STATUSBAR
 (
ddi•
->
modifõd_°©us
);

499 
guöt
 
c⁄ãxt_id
 = 
	`gtk_°©usb¨_gë_c⁄ãxt_id
 (
°©usb¨
, "ObjectPos");

500 
	`gtk_°©usb¨_p›
 (
°©usb¨
, 
c⁄ãxt_id
);

501 
po°ext
 = 
	`g_°rdup_¥ötf
("%.3f, %.3f - %.3f, %.3f",

502 
toﬁ
->
obje˘
->
boundög_box
.
À·
,

503 
toﬁ
->
obje˘
->
boundög_box
.
t›
,

504 
toﬁ
->
obje˘
->
boundög_box
.
right
,

505 
toﬁ
->
obje˘
->
boundög_box
.
bŸtom
);

507 
	`gtk_°©usb¨_p›
 (
°©usb¨
, 
c⁄ãxt_id
);

508 
	`gtk_°©usb¨_push
 (
°©usb¨
, 
c⁄ãxt_id
, 
po°ext
);

510 
	`g_‰ì
(
po°ext
);

513 
	`dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
ddi•
->
dügøm
);

514 
	`dügøm_Êush
(
ddi•
->
dügøm
);

516 
STATE_MOVE_HANDLE
:

517 
fuŒ_dñè
 = 
to
;

518 
	`poöt_sub
(&
fuŒ_dñè
, &
toﬁ
->
°¨t_©
);

526 i‡(!
	`∑ª¡_h™dÀ_move_out_check
(
toﬁ
->
obje˘
, &
to
))

527 
	`∑ª¡_h™dÀ_move_ö_check
(
toﬁ
->
obje˘
, &
to
, &toﬁ->
°¨t_©
);

529 i‡(
evít
->
°©e
 & 
GDK_CONTROL_MASK
)

530 
vîtiˇl
 = (
	`Ábs
(
fuŒ_dñè
.
x
Ë< fabs(fuŒ_dñè.
y
));

532 
	`highlight_ª£t_Æl
(
ddi•
->
dügøm
);

533 i‡((
toﬁ
->
h™dÀ
->
c⁄√˘_ty≥
 !
HANDLE_NONCONNECTABLE
)) {

535 
c⁄√˘i⁄poöt
 =

536 
	`obje˘_föd_c⁄√˘poöt_di•œy
(
ddi•
, &
to
, 
toﬁ
->
obje˘
, 
TRUE
);

537 i‡(
c⁄√˘i⁄poöt
 !
NULL
) {

538 
Cﬁ‹
 *
hi_cﬁ‹
;

539 
to
 = 
c⁄√˘i⁄poöt
->
pos
;

540 i‡(
c⁄√˘i⁄poöt
->
Êags
 & 
CP_FLAGS_MAIN
) {

541 
hi_cﬁ‹
 = &
maöpoöt_cﬁ‹
;

543 
hi_cﬁ‹
 = &
˝_cﬁ‹
;

545 
	`highlight_obje˘
(
c⁄√˘i⁄poöt
->
obje˘
, 
hi_cﬁ‹
, 
ddi•
->
dügøm
);

546 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_CONNECT
));

549 i‡(
c⁄√˘i⁄poöt
 =
NULL
) {

551 
	`¢≠_to_grid
(
ddi•
, &
to
.
x
, &to.
y
);

552 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_SCROLL
));

555 i‡(
toﬁ
->
bªak_c⁄√˘i⁄s
) {

557 i‡(
toﬁ
->
h™dÀ
->
c⁄√˘ed_to
!=
NULL
) {

558 
Ch™ge
 *
ch™ge
 = 
	`undo_unc⁄√˘
(
ddi•
->
dügøm
, 
toﬁ
->
obje˘
,

559 
toﬁ
->
h™dÀ
);

561 (
ch™ge
->
≠∂y
)(ch™ge, 
ddi•
->
dügøm
);

565 i‡(
evít
->
°©e
 & 
GDK_CONTROL_MASK
) {

567 i‡(
vîtiˇl
) {

568 
to
.
x
 = 
toﬁ
->
°¨t_©
.x;

570 
to
.
y
 = 
toﬁ
->
°¨t_©
.y;

574 i‡(
toﬁ
->
‹ig_pos
 =
NULL
) {

575 
toﬁ
->
‹ig_pos
 = 
	`g_√w
(
Poöt
, 1);

576 *
toﬁ
->
‹ig_pos
 =Åoﬁ->
h™dÀ
->
pos
;

581 
gch¨
 *
po°ext
;

582 
GtkSètusb¨
 *
°©usb¨
 = 
	`GTK_STATUSBAR
 (
ddi•
->
modifõd_°©us
);

583 
guöt
 
c⁄ãxt_id
 = 
	`gtk_°©usb¨_gë_c⁄ãxt_id
 (
°©usb¨
, "ObjectPos");

585 i‡(
toﬁ
->
obje˘
) {

586 
ªÆ
 
w
 = 
toﬁ
->
obje˘
->
boundög_box
.
right
 -Åoﬁ->obje˘->boundög_box.
À·
;

587 
ªÆ
 
h
 = 
toﬁ
->
obje˘
->
boundög_box
.
bŸtom
 -Åoﬁ->obje˘->boundög_box.
t›
;

588 
po°ext
 = 
	`g_°rdup_¥ötf
("%.3f, %.3‡(%.3fx%.3f)", 
to
.
x
,Åo.
y
, 
w
, 
h
);

590 
po°ext
 = 
	`g_°rdup_¥ötf
("%.3f, %.3f", 
to
.
x
,Åo.
y
);

593 
	`gtk_°©usb¨_p›
 (
°©usb¨
, 
c⁄ãxt_id
);

594 
	`gtk_°©usb¨_push
 (
°©usb¨
, 
c⁄ãxt_id
, 
po°ext
);

596 
	`g_‰ì
(
po°ext
);

599 
	`obje˘_add_upd©es
(
toﬁ
->
obje˘
, 
ddi•
->
dügøm
);

602 
objch™ge
 = 
toﬁ
->
obje˘
->
›s
->
	`move_h™dÀ
—oﬁ->obje˘,Åoﬁ->
h™dÀ
,

603 &
to
, 
c⁄√˘i⁄poöt
,

604 
HANDLE_MOVE_USER
, 
	`gdk_evít_to_dü_ModifõrKeys
(
evít
->
°©e
));

605 i‡(
objch™ge
 !
NULL
) {

606 
	`undo_obje˘_ch™ge
(
ddi•
->
dügøm
, 
toﬁ
->
obje˘
, 
objch™ge
);

608 
	`obje˘_add_upd©es
(
toﬁ
->
obje˘
, 
ddi•
->
dügøm
);

610 
	`dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
ddi•
->
dügøm
);

611 
	`dügøm_Êush
(
ddi•
->
dügøm
);

613 
STATE_BOX_SELECT
:

615 i‡(!
auto_s¸ﬁl
 && !
toﬁ
->
auto_s¸ﬁÀd
)

617 
	`gdk_døw_ª˘™gÀ
 (
ddi•
->
ˇnvas
->
wödow
, 
toﬁ
->
gc
, 
FALSE
,

618 
toﬁ
->
x1
,Åoﬁ->
y1
,

619 
toﬁ
->
x2
 -Åoﬁ->
x1
,Åoﬁ->
y2
 -Åoﬁ->
y1
);

622 
toﬁ
->
íd_box
 = 
to
;

624 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
,

625 
	`MIN
(
toﬁ
->
°¨t_box
.
x
,Åoﬁ->
íd_box
.x),

626 
	`MIN
(
toﬁ
->
°¨t_box
.
y
,Åoﬁ->
íd_box
.y),

627 &
toﬁ
->
x1
, &toﬁ->
y1
);

628 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
,

629 
	`MAX
(
toﬁ
->
°¨t_box
.
x
,Åoﬁ->
íd_box
.x),

630 
	`MAX
(
toﬁ
->
°¨t_box
.
y
,Åoﬁ->
íd_box
.y),

631 &
toﬁ
->
x2
, &toﬁ->
y2
);

633 
	`gdk_døw_ª˘™gÀ
 (
ddi•
->
ˇnvas
->
wödow
, 
toﬁ
->
gc
, 
FALSE
,

634 
toﬁ
->
x1
,Åoﬁ->
y1
,

635 
toﬁ
->
x2
 -Åoﬁ->
x1
,Åoﬁ->
y2
 -Åoﬁ->
y1
);

637 
STATE_NONE
:

641 
	`mesßge_îr‹
("InternalÉrror: Strange state in modify_tool\n");

644 
toﬁ
->
œ°_to
 = 
to
;

645 
toﬁ
->
auto_s¸ﬁÀd
 = 
auto_s¸ﬁl
;

646 
	}
}

650 
GLi°
 *

651 
	$föd_£À˘ed_obje˘s
(
DDi•œy
 *
ddi•
, 
ModifyToﬁ
 *
toﬁ
)

653 
Re˘™gÀ
 
r
;

654 
r
.
À·
 = 
	`MIN
(
toﬁ
->
°¨t_box
.
x
,Åoﬁ->
íd_box
.x);

655 
r
.
right
 = 
	`MAX
(
toﬁ
->
°¨t_box
.
x
,Åoﬁ->
íd_box
.x);

656 
r
.
t›
 = 
	`MIN
(
toﬁ
->
°¨t_box
.
y
,Åoﬁ->
íd_box
.y);

657 
r
.
bŸtom
 = 
	`MAX
(
toﬁ
->
°¨t_box
.
y
,Åoﬁ->
íd_box
.y);

659 i‡(
¥efs
.
ªvî£_rubbîb™dög_öãr£˘s
 &&

660 
toﬁ
->
°¨t_box
.
x
 >Åoﬁ->
íd_box
.x) {

662 
	`œyî_föd_obje˘s_öãr£˘ög_ª˘™gÀ
(
ddi•
->
dügøm
->
d©a
->
a˘ive_œyî
, &
r
);

665 
	`œyî_föd_obje˘s_ö_ª˘™gÀ
(
ddi•
->
dügøm
->
d©a
->
a˘ive_œyî
, &
r
);

667 
	}
}

670 
	$modify_buâ⁄_ªÀa£
(
ModifyToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

671 
DDi•œy
 *
ddi•
)

673 
Poöt
 *
de°_pos
, 
to
;

674 
GLi°
 *
li°
;

675 
i
;

676 
DüObje˘
 *
a˘ive_obj
 = 
NULL
;

677 
Obje˘Ch™ge
 *
objch™ge
;

678 
Focus
 *
a˘ive_focus
;

680 
toﬁ
->
bªak_c⁄√˘i⁄s
 = 
FALSE
;

681 
	`ddi•œy_£t_Æl_curs‹
(
deÁu…_curs‹
);

685 
GtkSètusb¨
 *
°©usb¨
 = 
	`GTK_STATUSBAR
 (
ddi•
->
modifõd_°©us
);

686 
guöt
 
c⁄ãxt_id
 = 
	`gtk_°©usb¨_gë_c⁄ãxt_id
 (
°©usb¨
, "ObjectPos");

687 
	`gtk_°©usb¨_p›
 (
°©usb¨
, 
c⁄ãxt_id
);

689 
toﬁ
->
°©e
) {

690 
STATE_MOVE_OBJECT
:

692 
	`gdk_poöãr_ungøb
 (
evít
->
time
);

694 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
, 
evít
->
x
,Évít->
y
, &
to
.x, &to.y);

695 i‡(!
	`modify_move_Æªady
(
toﬁ
, 
ddi•
, &
to
)) {

696 
toﬁ
->
‹ig_pos
 = 
NULL
;

697 
toﬁ
->
°©e
 = 
STATE_NONE
;

701 
	`dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
ddi•
->
dügøm
);

703 i‡(
toﬁ
->
‹ig_pos
 !
NULL
) {

705 
li°
 = 
	`∑ª¡_li°_af„˘ed
(
ddi•
->
dügøm
->
d©a
->
£À˘ed
);

706 
de°_pos
 = 
	`g_√w
(
Poöt
, 
	`g_li°_Àngth
(
li°
));

707 
i
=0;

708 
li°
 !
NULL
) {

709 
DüObje˘
 *
obj
 = (DüObje˘ *Ë
li°
->
d©a
;

710 
de°_pos
[
i
] = 
obj
->
posôi⁄
;

711 
li°
 = 
	`g_li°_√xt
÷i°); 
i
++;

714 
	`undo_move_obje˘s
(
ddi•
->
dügøm
, 
toﬁ
->
‹ig_pos
, 
de°_pos
,

715 
	`∑ª¡_li°_af„˘ed
(
ddi•
->
dügøm
->
d©a
->
£À˘ed
));

718 
	`ddi•œy_c⁄√˘_£À˘ed
(
ddi•
);

719 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

720 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

721 
	`dügøm_Êush
(
ddi•
->
dügøm
);

723 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

725 
toﬁ
->
‹ig_pos
 = 
NULL
;

726 
toﬁ
->
°©e
 = 
STATE_NONE
;

728 
STATE_MOVE_HANDLE
:

729 
	`gdk_poöãr_ungøb
 (
evít
->
time
);

730 
toﬁ
->
°©e
 = 
STATE_NONE
;

732 i‡(
toﬁ
->
‹ig_pos
 !
NULL
) {

733 
	`undo_move_h™dÀ
(
ddi•
->
dügøm
, 
toﬁ
->
h™dÀ
,Åoﬁ->
obje˘
,

734 *
toﬁ
->
‹ig_pos
,Åoﬁ->
œ°_to
);

738 
	`obje˘_add_upd©es
(
toﬁ
->
obje˘
, 
ddi•
->
dügøm
);

739 
objch™ge
 = 
toﬁ
->
obje˘
->
›s
->
	`move_h™dÀ
—oﬁ->obje˘,Åoﬁ->
h™dÀ
,

740 &
toﬁ
->
œ°_to
, 
NULL
,

741 
HANDLE_MOVE_USER_FINAL
,
	`gdk_evít_to_dü_ModifõrKeys
(
evít
->
°©e
));

742 i‡(
objch™ge
 !
NULL
) {

743 
	`undo_obje˘_ch™ge
(
ddi•
->
dügøm
, 
toﬁ
->
obje˘
, 
objch™ge
);

746 
	`obje˘_add_upd©es
(
toﬁ
->
obje˘
, 
ddi•
->
dügøm
);

749 i‡(
toﬁ
->
h™dÀ
->
c⁄√˘_ty≥
 !
HANDLE_NONCONNECTABLE
) {

750 
	`obje˘_c⁄√˘_di•œy
(
ddi•
, 
toﬁ
->
obje˘
,Åoﬁ->
h™dÀ
, 
TRUE
);

751 
	`dügøm_upd©e_c⁄√˘i⁄s_£À˘i⁄
(
ddi•
->
dügøm
);

754 
	`highlight_ª£t_Æl
(
ddi•
->
dügøm
);

755 
	`dügøm_Êush
(
ddi•
->
dügøm
);

757 
	`dügøm_modifõd
(
ddi•
->
dügøm
);

758 
	`dügøm_upd©e_exã¡s
(
ddi•
->
dügøm
);

760 
	`undo_£t_å™ß˘i⁄poöt
(
ddi•
->
dügøm
->
undo
);

762 i‡(
toﬁ
->
‹ig_pos
 !
NULL
) {

763 
	`g_‰ì
(
toﬁ
->
‹ig_pos
);

764 
toﬁ
->
‹ig_pos
 = 
NULL
;

768 
STATE_BOX_SELECT
:

770 
	`gdk_poöãr_ungøb
 (
evít
->
time
);

772 
a˘ive_focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

773 
a˘ive_obj
 = 
a˘ive_focus
!=
NULL
?
	`focus_gë_obje˘
(active_focus):NULL;

775 i‡(!
toﬁ
->
auto_s¸ﬁÀd
) {

776 
	`gdk_døw_ª˘™gÀ
 (
ddi•
->
ˇnvas
->
wödow
, 
toﬁ
->
gc
, 
FALSE
,

777 
toﬁ
->
x1
,Åoﬁ->
y1
,

778 
toﬁ
->
x2
 -Åoﬁ->
x1
,Åoﬁ->
y2
 -Åoﬁ->
y1
);

782 
GLi°
 *
li°
, *
li°_to_‰ì
;

784 
li°
 = 
li°_to_‰ì
 = 
	`föd_£À˘ed_obje˘s
(
ddi•
, 
toﬁ
);

786 i‡(
£À˘i⁄_°yÀ
 =
SELECT_REPLACE
 &&

787 !(
evít
->
°©e
 & 
GDK_SHIFT_MASK
)) {

789 
	`dügøm_ªmove_Æl_£À˘ed
(
ddi•
->
dügøm
, 
TRUE
);

792 i‡(
£À˘i⁄_°yÀ
 =
SELECT_INTERSECTION
) {

793 
GLi°
 *
öãr£˘i⁄
 = 
NULL
;

795 
li°
 !
NULL
) {

796 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

798 i‡(
	`dügøm_is_£À˘ed
(
ddi•
->
dügøm
, 
obj
)) {

799 
öãr£˘i⁄
 = 
	`g_li°_≠≥nd
(öãr£˘i⁄, 
obj
);

802 
li°
 = 
	`g_li°_√xt
(list);

804 
li°
 = 
öãr£˘i⁄
;

805 
	`dügøm_ªmove_Æl_£À˘ed
(
ddi•
->
dügøm
, 
TRUE
);

806 
li°
 !
NULL
) {

807 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

809 
	`dügøm_£À˘
(
ddi•
->
dügøm
, 
obj
);

811 
li°
 = 
	`g_li°_√xt
(list);

813 
	`g_li°_‰ì
(
öãr£˘i⁄
);

815 
li°
 !
NULL
) {

816 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

818 i‡(
£À˘i⁄_°yÀ
 =
SELECT_REMOVE
) {

819 i‡(
	`dügøm_is_£À˘ed
(
ddi•
->
dügøm
, 
obj
))

820 
	`dügøm_un£À˘_obje˘
(
ddi•
->
dügøm
, 
obj
);

821 } i‡(
£À˘i⁄_°yÀ
 =
SELECT_INVERT
) {

822 i‡(
	`dügøm_is_£À˘ed
(
ddi•
->
dügøm
, 
obj
))

823 
	`dügøm_un£À˘_obje˘
(
ddi•
->
dügøm
, 
obj
);

825 
	`dügøm_£À˘
(
ddi•
->
dügøm
, 
obj
);

827 i‡(!
	`dügøm_is_£À˘ed
(
ddi•
->
dügøm
, 
obj
))

828 
	`dügøm_£À˘
(
ddi•
->
dügøm
, 
obj
);

831 
li°
 = 
	`g_li°_√xt
(list);

835 
	`g_li°_‰ì
(
li°_to_‰ì
);

848 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

849 
	`ddi•œy_Êush
(
ddi•
);

851 
toﬁ
->
°©e
 = 
STATE_NONE
;

853 
STATE_NONE
:

856 
	`mesßge_îr‹
("InternalÉrror: Strange state in modify_tool\n");

859 
	}
}

861 
	#EDIT_BORDER_WIDTH
 5

	)

863 
gboﬁón


864 
	$modify_edô_íd
(
GtkWidgë
 *
widgë
, 
GdkEvítFocus
 *
evít
, 
gpoöãr
 
d©a
)

866 
GtkTextVõw
 *
võw
 = 
	`GTK_TEXT_VIEW
(
widgë
);

867 
DüObje˘
 *
obj
 = (DüObje˘*)
d©a
;

868 
GQu¨k
 
qu¨k
 = 
	`g_qu¨k_‰om_°rög
(
PROP_TYPE_TEXT
);

869 c⁄° 
Pr›Des¸ùti⁄
 *
¥›s
 = 
obj
->
›s
->
	`des¸ibe_¥›s
(obj);

870 
i
;

872 
	`¥ötf
("Ending focus\n");

874 
i
 = 0; 
¥›s
[i].
«me
 !
NULL
; i++) {

875 
	`¥ötf
("Te°ögÅÿªmove: %s\n", 
¥›s
[
i
].
«me
);

876 i‡(
¥›s
[
i
].
ty≥_qu¨k
 =
qu¨k
) {

877 
GPåAºay
 *
ãxçr›s
 = 
	`g_±r_¨øy_sized_√w
(1);

878 
TextPr›îty
 *
ãxçr›
;

879 
Pr›îty
 *
¥›
 = 
¥›s
[
i
].
›s
->
	`√w_¥›
(&¥›s[i], 
pdçp_åue
);

880 
GtkTextBuf„r
 *
buf
;

881 
GtkTextIãr
 
°¨t
, 
íd
;

883 
	`¥ötf
("GoögÅÿ°› %d\n", 
i
);

884 
buf
 = 
	`gtk_ãxt_võw_gë_buf„r
(
võw
);

885 
	`g_±r_¨øy_add
(
ãxçr›s
, 
¥›
);

886 
obj
->
›s
->
	`gë_¥›s
(obj, 
ãxçr›s
);

887 
ãxçr›
 = (
TextPr›îty
*)
¥›
;

888 i‡(
ãxçr›
->
ãxt_d©a
 !
NULL
Ë
	`g_‰ì
(textprop->text_data);

889 
	`gtk_ãxt_buf„r_gë_bounds
(
buf
, &
°¨t
, &
íd
);

890 
ãxçr›
->
ãxt_d©a
 = 
	`gtk_ãxt_buf„r_gë_ãxt
(
buf
, &
°¨t
, &
íd
, 
TRUE
);

891 
	`¥ötf
("SëtögÅexà%s\n", 
ãxçr›
->
ãxt_d©a
);

892 
obj
->
›s
->
	`£t_¥›s
(obj, 
ãxçr›s
);

893 
	`gtk_widgë_de°roy
(
widgë
);

896  
FALSE
;

897 
	}
}

900 
	$modify_°¨t_ãxt_edô
(
DDi•œy
 *
ddi•
, 
Text
 *
ãxt
, 
DüObje˘
 *
obj
, 
Poöt
 *
˛ickedpoöt
)

902 
GtkWidgë
 *
võw
 = 
	`gtk_ãxt_võw_√w
();

903 
x
, 
y
, 
i
;

904 
GtkTextBuf„r
 *
buf
;

905 
GtkTextTag
 *
f⁄âag
;

906 
GtkTextIãr
 
°¨t
, 
íd
;

907 
Re˘™gÀ
 
ãxt_bbox
;

909 
	`¥ötf
("modify_start_text_edit\n");

911 
	`ãxt_ˇlc_boundögbox
(
ãxt
, &
ãxt_bbox
);

912 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
,

913 
ãxt_bbox
.
À·
,

914 
ãxt_bbox
.
t›
,

915 &
x
, &
y
);

916 
	`dü_ˇnvas_put
(
	`DIA_CANVAS
(
ddi•
->
ˇnvas
), 
võw
,

917 
x
-
EDIT_BORDER_WIDTH
, 
y
-EDIT_BORDER_WIDTH);

918 
buf
 = 
	`gtk_ãxt_võw_gë_buf„r
(
	`GTK_TEXT_VIEW
(
võw
));

919 
i
 = 0; i < 
ãxt
->
numlöes
; i++) {

920 
	`gtk_ãxt_buf„r_ö£π_©_curs‹
(
buf
, 
	`ãxt_gë_löe
(
ãxt
, 
i
), -1);

922 
f⁄âag
 =

923 
	`gtk_ãxt_buf„r_¸óã_èg
(
buf
,

924 
NULL
,

926 
	`dü_f⁄t_gë_des¸ùti⁄
(
ãxt
->
f⁄t
),

927 
NULL
);

928 
	`gtk_ãxt_buf„r_gë_bounds
(
buf
, &
°¨t
, &
íd
);

929 
	`gtk_ãxt_buf„r_≠∂y_èg
(
buf
, 
f⁄âag
, &
°¨t
, &
íd
);

931 
	`¥ötf
("AboveÜines %d below %d\n",

932 
	`gtk_ãxt_võw_gë_pixñs_above_löes
(
	`GTK_TEXT_VIEW
(
võw
)),

933 
	`gtk_ãxt_võw_gë_pixñs_bñow_löes
(
	`GTK_TEXT_VIEW
(
võw
)));

935 
	`gtk_ãxt_võw_£t_b‹dî_wödow_size
(
	`GTK_TEXT_VIEW
(
võw
),

936 
GTK_TEXT_WINDOW_LEFT
,

937 
EDIT_BORDER_WIDTH
);

938 
	`gtk_ãxt_võw_£t_b‹dî_wödow_size
(
	`GTK_TEXT_VIEW
(
võw
),

939 
GTK_TEXT_WINDOW_RIGHT
,

940 
EDIT_BORDER_WIDTH
);

941 
	`gtk_ãxt_võw_£t_b‹dî_wödow_size
(
	`GTK_TEXT_VIEW
(
võw
),

942 
GTK_TEXT_WINDOW_TOP
,

943 
EDIT_BORDER_WIDTH
);

944 
	`gtk_ãxt_võw_£t_b‹dî_wödow_size
(
	`GTK_TEXT_VIEW
(
võw
),

945 
GTK_TEXT_WINDOW_BOTTOM
,

946 
EDIT_BORDER_WIDTH
);

949 #ifde‡
NEW_TEXT_EDIT


950 
	`gtk_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
võw
), "focus-out-event",

951 
modify_edô_íd
, 
obj
);

953 
	`gtk_widgë_gøb_focus
(
võw
);

954 
	`gtk_widgë_show
(
võw
);

955 
	}
}

958 
	$modify_make_ãxt_edô
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
, 
Poöt
 *
˛ickedpoöt
)

960 c⁄° 
Pr›Des¸ùti⁄
 *
¥›s
 = 
obj
->
›s
->
	`des¸ibe_¥›s
(obj);

961 
i
;

962 
i
 = 0; 
¥›s
[i].
«me
 !
NULL
; i++) {

963 
GQu¨k
 
ty≥
 = 
	`g_qu¨k_‰om_°rög
(
PROP_TYPE_TEXT
);

964 
	`¥ötf
("Te°ög %s\n", 
¥›s
[
i
].
ty≥
);

965 i‡(
¥›s
[
i
].
ty≥_qu¨k
 =
ty≥
) {

966 
GtkWidgë
 *
võw
 = 
	`gtk_ãxt_võw_√w
();

967 
GPåAºay
 *
ãxçr›s
 = 
	`g_±r_¨øy_sized_√w
(1);

968 
TextPr›îty
 *
ãxçr›
;

969 
Pr›îty
 *
¥›
 = 
¥›s
[
i
].
›s
->
	`√w_¥›
(&¥›s[i], 
pdçp_åue
);

970 
x
, 
y
;

971 
GtkTextBuf„r
 *
buf
;

972 
GtkTextTag
 *
f⁄âag
;

973 
GtkTextIãr
 
°¨t
, 
íd
;

974 
ªÆ
 
as˚¡
;

975 
as˚¡_pixñs
;

976 
TextLöe
 *
ãmp_löe
;

978 
	`g_±r_¨øy_add
(
ãxçr›s
, 
¥›
);

980 
	`¥ötf
("FoundÅexà¥› %d\n", 
i
);

981 
obj
->
›s
->
	`gë_¥›s
(obj, 
ãxçr›s
);

982 
ãxçr›
 = (
TextPr›îty
*)
¥›
;

983 
	`ddi•œy_å™sf‹m_co‹ds
(
ddi•
,

984 
ãxçr›
->
©å
.
posôi⁄
.
x
,

985 
ãxçr›
->
©å
.
posôi⁄
.
y
,

986 &
x
, &
y
);

987 
ãmp_löe
 = 
	`ãxt_löe_√w
(
ãxçr›
->
ãxt_d©a
,

988 
ãxçr›
->
©å
.
f⁄t
,

989 
ãxçr›
->
©å
.
height
);

991 
as˚¡
 = 
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
,

992 
	`ãxt_löe_gë_as˚¡
(
ãmp_löe
));

993 
	`ãxt_löe_de°roy
(
ãmp_löe
);

994 
	`¥ötf
("TextÖrop string %sÖos %d, %dáscent %f\n",

995 
ãxçr›
->
ãxt_d©a
, 
x
, 
y
, 
as˚¡
);

996 
as˚¡_pixñs
 = 
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
, 
as˚¡
);

997 
y
 -
as˚¡_pixñs
;

998 
	`dü_ˇnvas_put
(
	`DIA_CANVAS
(
ddi•
->
ˇnvas
), 
võw
,

999 
x
-
EDIT_BORDER_WIDTH
, 
y
-EDIT_BORDER_WIDTH);

1000 
buf
 = 
	`gtk_ãxt_võw_gë_buf„r
(
	`GTK_TEXT_VIEW
(
võw
));

1001 
	`gtk_ãxt_buf„r_ö£π_©_curs‹
(
buf
, 
ãxçr›
->
ãxt_d©a
, -1);

1002 
f⁄âag
 =

1003 
	`gtk_ãxt_buf„r_¸óã_èg
(
buf
,

1004 
NULL
,

1006 
	`dü_f⁄t_gë_des¸ùti⁄
(
ãxçr›
->
©å
.
f⁄t
),

1007 
NULL
);

1008 
	`gtk_ãxt_buf„r_gë_bounds
(
buf
, &
°¨t
, &
íd
);

1009 
	`gtk_ãxt_buf„r_≠∂y_èg
(
buf
, 
f⁄âag
, &
°¨t
, &
íd
);

1011 
	`¥ötf
("AboveÜines %d below %d\n",

1012 
	`gtk_ãxt_võw_gë_pixñs_above_löes
(
	`GTK_TEXT_VIEW
(
võw
)),

1013 
	`gtk_ãxt_võw_gë_pixñs_bñow_löes
(
	`GTK_TEXT_VIEW
(
võw
)));

1015 
	`gtk_ãxt_võw_£t_b‹dî_wödow_size
(
	`GTK_TEXT_VIEW
(
võw
),

1016 
GTK_TEXT_WINDOW_LEFT
,

1017 
EDIT_BORDER_WIDTH
);

1018 
	`gtk_ãxt_võw_£t_b‹dî_wödow_size
(
	`GTK_TEXT_VIEW
(
võw
),

1019 
GTK_TEXT_WINDOW_RIGHT
,

1020 
EDIT_BORDER_WIDTH
);

1021 
	`gtk_ãxt_võw_£t_b‹dî_wödow_size
(
	`GTK_TEXT_VIEW
(
võw
),

1022 
GTK_TEXT_WINDOW_TOP
,

1023 
EDIT_BORDER_WIDTH
);

1024 
	`gtk_ãxt_võw_£t_b‹dî_wödow_size
(
	`GTK_TEXT_VIEW
(
võw
),

1025 
GTK_TEXT_WINDOW_BOTTOM
,

1026 
EDIT_BORDER_WIDTH
);

1029 #ifde‡
NEW_TEXT_EDIT


1030 
	`gtk_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
võw
), "focus-out-event",

1031 
modify_edô_íd
, 
obj
);

1033 
	`gtk_widgë_gøb_focus
(
võw
);

1034 
	`gtk_widgë_show
(
võw
);

1037 
	}
}

	@O:\tool\dvs50\app\modify_tool.h

18 #i‚de‡
MODIFY_TOOL_H


19 
	#MODIFY_TOOL_H


	)

21 
	~"geomëry.h
"

22 
	~"toﬁ.h
"

23 
	~"time.h
"

25 
_ModifyToﬁ
 
	tModifyToﬁ
;

27 
	eModifyToﬁSèã
 {

28 
	mSTATE_NONE
,

29 
	mSTATE_MOVE_OBJECT
,

30 
	mSTATE_MOVE_HANDLE
,

31 
	mSTATE_BOX_SELECT


34 
	s_ModifyToﬁ
 {

35 
Toﬁ
 
	mtoﬁ
;

37 
ModifyToﬁSèã
 
	m°©e
;

38 
	mbªak_c⁄√˘i⁄s
;

39 
Poöt
 
	mmove_com≥nßã
;

40 
DüObje˘
 *
	mobje˘
;

41 
H™dÀ
 *
	mh™dÀ
;

42 
Poöt
 
	mœ°_to
;

43 
Poöt
 
	m°¨t_©
;

44 
time_t
 
	m°¨t_time
;

46 
GdkGC
 *
	mgc
;

48 
	mx1
, 
	my1
, 
	mx2
, 
	my2
;

49 
Poöt
 
	m°¨t_box
;

50 
Poöt
 
	míd_box
;

52 
gboﬁón
 
	mauto_s¸ﬁÀd
;

55 
Poöt
 *
	m‹ig_pos
;

58 
Toﬁ
 *
¸óã_modify_toﬁ
();

59 
‰ì_modify_toﬁ
(
Toﬁ
 *
toﬁ
);

	@O:\tool\dvs50\app\navigation.c

25 
	~<gtk/gtk.h
>

27 
	~"dügøm.h
"

28 
	~"di•œy.h
"

29 
	~"dügdkªndîî.h
"

31 
	~"«vig©i⁄.h
"

34 
	#THUMBNAIL_MAX_SIZE
 150

	)

37 
	s_Navig©i⁄Wödow


39 
GtkWidgë
 * 
	mp›up_wödow
;

42 
	mwidth
;

43 
	mheight
;

44 
	mmax_size
;

46 
gboﬁón
 
	mis_fú°_expo£
;

49 
	m‰ame_w
;

50 
	m‰ame_h
;

51 
GdkGC
 * 
	mgc
;

52 
GdkCurs‹
 * 
	mcurs‹
;

55 
gdoubÀ
 
	mhadj_c€f
;

56 
gdoubÀ
 
	mvadj_c€f
;

59 
GdkPixm≠
 * 
	mbuf„r
;

62 
DDi•œy
 * 
	mddi•
;

65 
_Navig©i⁄Wödow
 
	tNavig©i⁄Wödow
;

67 
Navig©i⁄Wödow
 
	g_«v
;

68 
Navig©i⁄Wödow
 * 
	g«v
 = &
_«v
;

71 
	#DIAGRAM_OFFSET
 1

	)

72 
	#FRAME_THICKNESS
 2

	)

73 
	#STD_CURSOR_MIN
 16

	)

76 
⁄_buâ⁄_«vig©i⁄_p›up_¥es£d
 (
GtkBuâ⁄
 * 
buâ⁄
, 
gpoöãr
 
_ddi•
);

77 
⁄_buâ⁄_«vig©i⁄_p›up_ªÀa£d
 (
GtkBuâ⁄
 * 
buâ⁄
, 
gpoöãr
 
unu£d
);

79 
ª£t_sc_adj
 (
GtkAdju°mít
 * 
adj
, 
gdoubÀ
 
lowî
, gdoubÀ 
uµî
, gdoubÀ 
∑ge
);

81 
gboﬁón
 
⁄_da_expo£_evít
 (
GtkWidgë
 * 
widgë
, 
GdkEvítExpo£
 * 
evít
, 
gpoöãr
 
unu£d
);

82 
gboﬁón
 
⁄_da_mŸi⁄_nŸify_evít
 (
GtkWidgë
 * 
widgë
, 
GdkEvítMŸi⁄
 * 
evít
, 
gpoöãr
 
unu£d
);

83 
gboﬁón
 
⁄_da_buâ⁄_ªÀa£_evít
 (
GtkWidgë
 * 
widgë
, 
GdkEvítBuâ⁄
 * 
evít
, 
gpoöãr
 
p›up_wödow
);

86 * 
	g«v_xpm
[] = {

102 
GtkWidgë
 *

103 
	$«vig©i⁄_p›up_√w
 (
DDi•œy
 *
ddi•
)

105 
GtkWidgë
 * 
buâ⁄
;

107 
GtkWidgë
 * 
image
;

108 
GdkPixm≠
 * 
pixm≠
;

109 
GdkBôm≠
 * 
mask
 = 
NULL
;

111 
buâ⁄
 = 
	`gtk_buâ⁄_√w
 ();

112 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
buâ⁄
), 0);

113 
	`gtk_buâ⁄_£t_ªlõf
 (
	`GTK_BUTTON
(
buâ⁄
), 
GTK_RELIEF_NONE
);

114 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
buâ⁄
), "pressed",

115 
	`G_CALLBACK
 (
⁄_buâ⁄_«vig©i⁄_p›up_¥es£d
), 
ddi•
);

117 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
buâ⁄
), "released",

118 
	`G_CALLBACK
 (
⁄_buâ⁄_«vig©i⁄_p›up_ªÀa£d
), 
NULL
);

120 
pixm≠
 = 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

121 
	`gtk_widgë_gë_cﬁ‹m≠
(
buâ⁄
),

122 &
mask
,

123 &(
buâ⁄
->
°yÀ
->
bg
[
GTK_STATE_NORMAL
]),

124 
«v_xpm
);

126 
image
 = 
	`gtk_image_√w_‰om_pixm≠
 (
pixm≠
, 
mask
);

127 
	`g_obje˘_uƒef
(
pixm≠
);

128 
	`g_obje˘_uƒef
(
mask
);

130 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
buâ⁄
), 
image
);

131 
	`gtk_widgë_show
(
image
);

134  
buâ⁄
;

135 
	}
}

139 
	$⁄_buâ⁄_«vig©i⁄_p›up_¥es£d
 (
GtkBuâ⁄
 * 
buâ⁄
, 
gpoöãr
 
_ddi•
)

141 
GtkWidgë
 * 
p›up_wödow
;

142 
GtkWidgë
 * 
‰ame
;

144 
GtkWidgë
 * 
døwög_¨ó
;

146 
DügømD©a
 * 
d©a
;

148 
Re˘™gÀ
 
ª˘
;

149 
ªÆ
 
zoom
;

152 
	`mem£t
 (
«v
, 0, (
Navig©i⁄Wödow
));

154 
«v
->
ddi•
 = (
DDi•œy
 *Ë
_ddi•
;

155 
d©a
 = 
«v
->
ddi•
->
dügøm
->data;

159 
ˇnvas_width
, 
ˇnvas_height
;

160 
dügøm_width
, 
dügøm_height
;

161 
GtkAdju°mít
 * 
adj
;

163 
«v
->
max_size
 = 
THUMBNAIL_MAX_SIZE
;

166 
ª˘
.
t›
 = 
d©a
->
exã¡s
.t› - 
DIAGRAM_OFFSET
;

167 
ª˘
.
À·
 = 
d©a
->
exã¡s
.À· - 
DIAGRAM_OFFSET
;

168 
ª˘
.
bŸtom
 = 
d©a
->
exã¡s
.bŸtom + 
DIAGRAM_OFFSET
 + 1;

169 
ª˘
.
right
 = 
d©a
->
exã¡s
.righà+ 
DIAGRAM_OFFSET
 + 1;

171 
zoom
 = 
«v
->
max_size
 / 
	`MAX
–(
ª˘
.
right
 -Ñe˘.
À·
Ë, (ª˘.
bŸtom
 -Ñe˘.
t›
) );

173 
«v
->
width
 = 
	`MIN
–«v->
max_size
, (
ª˘
.
right
 -Ñe˘.
À·
Ë* 
zoom
);

174 
«v
->
height
 = 
	`MIN
–«v->
max_size
, (
ª˘
.
bŸtom
 -Ñe˘.
t›
Ë* 
zoom
);

177 
dügøm_width
 = (Ë
	`ddi•œy_å™sf‹m_Àngth
 (
«v
->
ddi•
, (
ª˘
.
right
 -Ñe˘.
À·
));

178 
dügøm_height
 = (Ë
	`ddi•œy_å™sf‹m_Àngth
 (
«v
->
ddi•
, (
ª˘
.
bŸtom
 -Ñe˘.
t›
));

180 i‡(
dügøm_width
 * 
dügøm_height
 == 0)

183 
ˇnvas_width
 = 
«v
->
ddi•
->
ˇnvas
->
Æloˇti⁄
.
width
;

184 
ˇnvas_height
 = 
«v
->
ddi•
->
ˇnvas
->
Æloˇti⁄
.
height
;

186 
«v
->
‰ame_w
 =Çav->
width
 * 
ˇnvas_width
 / 
dügøm_width
;

187 
«v
->
‰ame_h
 =Çav->
height
 * 
ˇnvas_height
 / 
dügøm_height
;

192 
adj
 = 
«v
->
ddi•
->
hsbd©a
;

193 
	`ª£t_sc_adj
 (
adj
, 
ª˘
.
À·
,Ñe˘.
right
, 
ˇnvas_width
 / 
«v
->
ddi•
->
zoom_Á˘‹
);

194 
«v
->
hadj_c€f
 = (
adj
->
uµî
 -ádj->
∑ge_size
 -ádj->
lowî
Ë/ («v->
width
 -Çav->
‰ame_w
);

196 
adj
 = 
«v
->
ddi•
->
vsbd©a
;

197 
	`ª£t_sc_adj
 (
adj
, 
ª˘
.
t›
,Ñe˘.
bŸtom
, 
ˇnvas_height
 / 
«v
->
ddi•
->
zoom_Á˘‹
);

198 
«v
->
vadj_c€f
 = (
adj
->
uµî
 -ádj->
∑ge_size
 -ádj->
lowî
Ë/ («v->
height
 -Çav->
‰ame_h
);

203 
p›up_wödow
 = 
	`gtk_wödow_√w
 (
GTK_WINDOW_POPUP
);

204 
«v
->
p›up_wödow
 =Öopup_window;

205 
	`gtk_wödow_£t_posôi⁄
 (
	`GTK_WINDOW
 (
p›up_wödow
), 
GTK_WIN_POS_MOUSE
);

207 
‰ame
 = 
	`gtk_‰ame_√w
 (
NULL
);

208 
	`gtk_‰ame_£t_shadow_ty≥
 (
	`GTK_FRAME
 (
‰ame
), 
GTK_SHADOW_ETCHED_OUT
);

211 
døwög_¨ó
 = 
	`gtk_døwög_¨ó_√w
 ();

212 
	`gtk_widgë_£t_size_ªque°
 (
døwög_¨ó
, 
«v
->
width
,Çav->
height
);

214 
	`gtk_widgë_£t_evíts
 (
døwög_¨ó
, 0

215 | 
GDK_EXPOSURE_MASK


216 | 
GDK_POINTER_MOTION_MASK


217 | 
GDK_BUTTON_RELEASE_MASK


220 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
døwög_¨ó
), "expose_event",

221 
	`G_CALLBACK
 (
⁄_da_expo£_evít
), 
NULL
);

222 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
døwög_¨ó
), "motion_notify_event",

223 
	`G_CALLBACK
 (
⁄_da_mŸi⁄_nŸify_evít
), 
NULL
);

224 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
døwög_¨ó
), "button_release_event",

225 
	`G_CALLBACK
 (
⁄_da_buâ⁄_ªÀa£_evít
), 
NULL
);

228 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame
), 
døwög_¨ó
);

229 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
p›up_wödow
), 
‰ame
);

230 
	`gtk_widgë_show
 (
døwög_¨ó
);

231 
	`gtk_widgë_show
 (
‰ame
);

232 
	`gtk_widgë_show
 (
p›up_wödow
);

235 
«v
->
gc
 = 
	`gdk_gc_√w
 (
døwög_¨ó
->
wödow
);

236 
	`gdk_gc_£t_löe_©åibuãs
 (
«v
->
gc
,

237 
FRAME_THICKNESS
,

238 
GDK_LINE_SOLID
, 
GDK_CAP_BUTT
, 
GDK_JOIN_MITER
);

241 if(
	`MIN
(
«v
->
‰ame_h
,Çav->
‰ame_w
Ë> 
STD_CURSOR_MIN
){

242 
«v
->
curs‹
 = 
	`gdk_curs‹_√w
 (
GDK_FLEUR
);

245 
curs‹_n⁄e_d©a
[] = { 0x00 };

246 
GdkBôm≠
 * 
bôm≠
;

247 
GdkCﬁ‹
 
fg
 = { 0, 65535, 65535, 65535};

248 
GdkCﬁ‹
 
bg
 = { 0, 0, 0, 0 };

250 
bôm≠
 = 
	`gdk_bôm≠_¸óã_‰om_d©a
(
NULL
, 
curs‹_n⁄e_d©a
, 1, 1);

251 
«v
->
curs‹
 = 
	`gdk_curs‹_√w_‰om_pixm≠
(
bôm≠
, bôm≠, &
fg
, &
bg
, 1, 1);

252 
	`g_obje˘_uƒef
(
bôm≠
);

256 
	`gdk_poöãr_gøb
 (
døwög_¨ó
->
wödow
, 
TRUE
,

257 
GDK_BUTTON_RELEASE_MASK
 | 
GDK_BUTTON_MOTION_MASK
,

258 
døwög_¨ó
->
wödow
,

259 
«v
->
curs‹
,

260 
GDK_CURRENT_TIME
);

263 
«v
->
buf„r
 = 
	`gdk_pixm≠_√w
 (
døwög_¨ó
->
wödow
,

264 
«v
->
width
,Çav->
height
, -1);

265 
	`gdk_døw_ª˘™gÀ
 (
«v
->
buf„r
,

266 
døwög_¨ó
->
°yÀ
->
bœck_gc
, 
TRUE
,

267 0, 0, 
«v
->
width
,Çav->
height
);

270 
DüGdkRídîî
 *
ªndîî
;

271 
GdkCﬁ‹
 
cﬁ‹
;

273 
ªndîî
 = 
	`g_obje˘_√w
 (
DIA_TYPE_GDK_RENDERER
, 
NULL
);

274 
ªndîî
->
å™sf‹m
 = 
	`dü_å™sf‹m_√w
 (&
ª˘
, &
zoom
);

275 
ªndîî
->
pixm≠
 = 
«v
->
buf„r
;

276 
ªndîî
->
gc
 = 
	`gdk_gc_√w
 (
«v
->
buf„r
);

279 
	`cﬁ‹_c⁄vît
 (&
d©a
->
bg_cﬁ‹
, &
cﬁ‹
);

280 
	`gdk_gc_£t_f‹eground
 (
ªndîî
->
gc
, &
cﬁ‹
);

281 
	`gdk_døw_ª˘™gÀ
 (
ªndîî
->
pixm≠
,Ñídîî->
gc
, 1, 0, 0, 
«v
->
width
,Çav->
height
);

284 
	`d©a_ªndî
 (
d©a
, 
	`DIA_RENDERER
 (
ªndîî
), 
NULL
, NULL, NULL);

286 
	`g_obje˘_ªf
 (
ªndîî
->
pixm≠
);

287 
	`g_obje˘_uƒef
 (
ªndîî
);

290 
«v
->
is_fú°_expo£
 = 
TRUE
;

291 
	}
}

296 
	$ª£t_sc_adj
 (
GtkAdju°mít
 * 
adj
, 
gdoubÀ
 
lowî
, gdoubÀ 
uµî
, gdoubÀ 
∑ge
)

298 
adj
->
∑ge_size
 = 
∑ge
;

300 
adj
->
lowî
 =Üower;

301 
adj
->
uµî
 = upper;

303 i‡(
adj
->
vÆue
 < 
lowî
)ádj->value =Üower;

304 i‡(
adj
->
vÆue
 > (
uµî
 - 
∑ge
))ádj->value = upper -Öage;

306 
	`gtk_adju°mít_ch™ged
(
adj
);

307 
	}
}

310 
gboﬁón


311 
	$⁄_da_expo£_evít
 (
GtkWidgë
 * 
widgë
, 
GdkEvítExpo£
 * 
evít
, 
gpoöãr
 
unu£d
)

314 
	`gdk_døw_pixm≠
 (
widgë
->
wödow
,

315 
widgë
->
°yÀ
->
fg_gc
[
	`GTK_WIDGET_STATE
 (widget)],

316 
	`GDK_PIXMAP
(
«v
->
buf„r
),

317 
evít
->
¨ó
.
x
,Évít->¨ó.
y
,

318 
evít
->
¨ó
.
x
,Évít->¨ó.
y
,

319 
evít
->
¨ó
.
width
,Évít->¨ó.
height
);

322 if(
«v
->
is_fú°_expo£
){

324 
GtkAdju°mít
 * 
adj
;

325 
x
, 
y
;

327 
adj
 = 
«v
->
ddi•
->
hsbd©a
;

328 
x
 = (
adj
->
vÆue
 -ádj->
lowî
Ë/ (adj->
uµî
 -ádj->lowîË* (
«v
->
width
) +1;

330 
adj
 = 
«v
->
ddi•
->
vsbd©a
;

331 
y
 = (
adj
->
vÆue
 -ádj->
lowî
Ë/ (adj->
uµî
 -ádj->lowîË* (
«v
->
height
) +1;

334 
	`gdk_døw_ª˘™gÀ
 (
widgë
->
wödow
,

335 
«v
->
gc
, 
FALSE
,

336 
x
, 
y
, 
«v
->
‰ame_w
,Çav->
‰ame_h
);

338 
«v
->
is_fú°_expo£
 = 
FALSE
;

340  
FALSE
;

341 
	}
}

344 
gboﬁón


345 
	$⁄_da_mŸi⁄_nŸify_evít
 (
GtkWidgë
 * 
døwög_¨ó
, 
GdkEvítMŸi⁄
 * 
evít
, 
gpoöãr
 
unu£d
)

347 
GtkAdju°mít
 * 
adj
;

348 
gboﬁón
 
vÆue_ch™ged
;

350 
w
 = 
«v
->
‰ame_w
;

351 
h
 = 
«v
->
‰ame_h
;

353 
x
, 
y
;

356 i‡(
w
 >
«v
->
width
-1 && 
h
 >«v->
height
-1Ë 
FALSE
;

358 
x
 = 
	`CLAMP
 (
evít
->x - 
w
/2 , 0, 
«v
->
width
 - w);

359 
y
 = 
	`CLAMP
 (
evít
->y - 
h
/2 , 0, 
«v
->
height
 - h);

361 
adj
 = 
«v
->
ddi•
->
hsbd©a
;

362 
vÆue_ch™ged
 = 
FALSE
;

363 i‡(
w
/2 <
evít
->
x
 &&Évít->x <(
«v
->
width
 - w/2)){

364 
adj
->
vÆue
 =ádj->
lowî
 + 
x
 * 
«v
->
hadj_c€f
;

365 
vÆue_ch™ged
 = 
TRUE
;

367 i‡(
x
 =0 && 
adj
->
vÆue
 !adj->
lowî
){

368 
adj
->
vÆue
 =ádj->
lowî
;

369 
vÆue_ch™ged
 = 
TRUE
;

371 i‡(
x
 =(
«v
->
width
 - 
w
Ë&& 
adj
->
vÆue
 !◊dj->
uµî
 -ádj->
∑ge_size
)){

372 
adj
->
vÆue
 =ádj->
uµî
 -ádj->
∑ge_size
;

373 
vÆue_ch™ged
 = 
TRUE
;

375 i‡(
vÆue_ch™ged
Ë
	`gtk_adju°mít_vÆue_ch™ged
(
adj
);

377 
adj
 = 
«v
->
ddi•
->
vsbd©a
;

378 
vÆue_ch™ged
 = 
FALSE
;

379 i‡(
h
/2 <
evít
->
y
 &&Évít->y <(
«v
->
height
 - h/2)){

380 
adj
->
vÆue
 =ádj->
lowî
 + 
y
 * 
«v
->
vadj_c€f
;

381 
vÆue_ch™ged
 = 
TRUE
;

383 i‡(
y
 =0 && 
adj
->
vÆue
 !adj->
lowî
){

384 
adj
->
vÆue
 =ádj->
lowî
;

385 
vÆue_ch™ged
 = 
TRUE
;

387 i‡(
y
 =(
«v
->
height
 - 
h
Ë&& 
adj
->
vÆue
 !◊dj->
uµî
 -ádj->
∑ge_size
)){

388 
adj
->
vÆue
 =ádj->
uµî
 -ádj->
∑ge_size
;

389 
vÆue_ch™ged
 = 
TRUE
;

391 i‡(
vÆue_ch™ged
Ë
	`gtk_adju°mít_vÆue_ch™ged
(
adj
);

396 
	`gdk_døw_pixm≠
 (
døwög_¨ó
->
wödow
,

397 
døwög_¨ó
->
°yÀ
->
fg_gc
[
	`GTK_WIDGET_STATE
 (drawing_area)],

398 
	`GDK_PIXMAP
(
«v
->
buf„r
),

399 0, 0, 0, 0, 
«v
->
width
,Çav->
height
);

401 
	`gdk_døw_ª˘™gÀ
 (
døwög_¨ó
->
wödow
,

402 
«v
->
gc
, 
FALSE
,

403 
x
, 
y
, 
w
, 
h
);

404  
FALSE
;

405 
	}
}

408 
gboﬁón


409 
	$⁄_da_buâ⁄_ªÀa£_evít
 (
GtkWidgë
 * 
widgë
, 
GdkEvítBuâ⁄
 * 
evít
, 
gpoöãr
 
unu£d
)

414 i‡(
«v
->
buf„r
)

415 
	`g_obje˘_uƒef
 (
«v
->
buf„r
);

416 
«v
->
buf„r
 = 
NULL
;

418 i‡(
«v
->
gc
)

419 
	`g_obje˘_uƒef
 (
«v
->
gc
);

420 
«v
->
gc
 = 
NULL
;

422 i‡(
«v
->
curs‹
)

423 
	`gdk_curs‹_uƒef
 (
«v
->
curs‹
);

424 
«v
->
curs‹
 = 
NULL
;

426 i‡(
«v
->
p›up_wödow
)

427 
	`gtk_widgë_de°roy
 (
«v
->
p›up_wödow
);

428 
«v
->
p›up_wödow
 = 
NULL
;

431 
	`gtk_widgë_gøb_focus
(
«v
->
ddi•
->
ˇnvas
);

432  
FALSE
;

433 
	}
}

436 
	$⁄_buâ⁄_«vig©i⁄_p›up_ªÀa£d
 (
GtkBuâ⁄
 * 
buâ⁄
, 
gpoöãr
 
z
)

439 i‡(!
«v
->
is_fú°_expo£
)

440 
	`⁄_da_buâ⁄_ªÀa£_evít
 (
NULL
, NULL, NULL);

441 
	}
}

	@O:\tool\dvs50\app\navigation.h

25 #i‚de‡
NAVIGATION_H


26 
	#NAVIGATION_H


	)

28 
	~<gtk/gtk.h
>

29 
	~"di•œy.h
"

43 
GtkWidgë
 * 
«vig©i⁄_p›up_√w
 (
DDi•œy
 *
ddi•
);

	@O:\tool\dvs50\app\object_ops.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<°dlib.h
>

25 
	~"obje˘_›s.h
"

26 
	~"c⁄√˘i⁄poöt_›s.h
"

27 
	~"h™dÀ_›s.h
"

28 
	~"mesßge.h
"

30 
	#OBJECT_CONNECT_DISTANCE
 4.5

	)

33 
	$obje˘_add_upd©es
(
DüObje˘
 *
obj
, 
Dügøm
 *
dü
)

35 
i
;

38 i‡(
obj
->
highlight_cﬁ‹
 !
NULL
) {

39 
	`dügøm_add_upd©e_wôh_b‹dî
(
dü
, &
obj
->
boundög_box
, 5);

41 
	`dügøm_add_upd©e
(
dü
, 
	`dü_obje˘_gë_í˛osög_box
 (
obj
));

45 
i
=0;i<
obj
->
num_h™dÀs
;i++) {

46 
	`h™dÀ_add_upd©e
(
obj
->
h™dÀs
[
i
], 
dü
);

50 
i
=0;i<
obj
->
num_c⁄√˘i⁄s
;i++) {

51 
	`c⁄√˘i⁄poöt_add_upd©e
(
obj
->
c⁄√˘i⁄s
[
i
], 
dü
);

54 
	}
}

57 
	$obje˘_add_upd©es_li°
(
GLi°
 *
li°
, 
Dügøm
 *
dü
)

59 
DüObje˘
 *
obj
;

61 
li°
 !
NULL
) {

62 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

64 
	`obje˘_add_upd©es
(
obj
, 
dü
);

66 
li°
 = 
	`g_li°_√xt
(list);

68 
	}
}

79 
C⁄√˘i⁄Poöt
 *

80 
	$obje˘_föd_c⁄√˘poöt_di•œy
(
DDi•œy
 *
ddi•
, 
Poöt
 *
pos
,

81 
DüObje˘
 *
nŸthis
, 
gboﬁón
 
¢≠_to_obje˘s
)

83 
ªÆ
 
di°™˚
;

84 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
;

85 
GLi°
 *
avoid
 = 
NULL
;

86 
DüObje˘
 *
obj_hîe
;

88 
di°™˚
 =

89 
	`dügøm_föd_˛o£°_c⁄√˘i⁄poöt
(
ddi•
->
dügøm
, &
c⁄√˘i⁄poöt
,

90 
pos
, 
nŸthis
);

92 
di°™˚
 = 
	`ddi•œy_å™sf‹m_Àngth
(
ddi•
, distance);

93 i‡(
di°™˚
 < 
OBJECT_CONNECT_DISTANCE
) {

94  
c⁄√˘i⁄poöt
;

96 i‡(
ddi•
->
maöpoöt_mag√tism
 && 
¢≠_to_obje˘s
) {

97 
DüObje˘
 *
∑ª¡
;

100 
avoid
 = 
	`g_li°_¥ïíd
◊void, 
nŸthis
);

101 
∑ª¡
 = 
nŸthis
->∑ª¡;Ö¨íà!
NULL
;Öarent =Öarent->parent) {

102 
avoid
 = 
	`g_li°_¥ïíd
◊void, 
∑ª¡
);

104 
obj_hîe
 = 
	`dügøm_föd_˛icked_obje˘_ex˚±
(
ddi•
->
dügøm
, 
pos
, 0.00001, 
avoid
);

105 i‡(
obj_hîe
 !
NULL
) {

106 
i
;

107 
i
 = 0; i < 
obj_hîe
->
num_c⁄√˘i⁄s
; i++) {

108 i‡(
obj_hîe
->
c⁄√˘i⁄s
[
i
]->
Êags
 & 
CP_FLAG_ANYPLACE
) {

109 
	`g_li°_‰ì
(
avoid
);

110  
obj_hîe
->
c⁄√˘i⁄s
[
i
];

116  
NULL
;

117 
	}
}

121 
	$obje˘_c⁄√˘_di•œy
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
,

122 
gboﬁón
 
¢≠_to_obje˘s
)

124 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
;

126 i‡(
h™dÀ
 =
NULL
)

129 i‡(
h™dÀ
->
c⁄√˘ed_to
 =
NULL
) {

130 
c⁄√˘i⁄poöt
 = 
	`obje˘_föd_c⁄√˘poöt_di•œy
(
ddi•
, &
h™dÀ
->
pos
,

131 
obj
, 
¢≠_to_obje˘s
);

133 i‡(
c⁄√˘i⁄poöt
 !
NULL
) {

134 
Ch™ge
 *
ch™ge
 = 
	`undo_c⁄√˘
(
ddi•
->
dügøm
, 
obj
, 
h™dÀ
,

135 
c⁄√˘i⁄poöt
);

136 (
ch™ge
->
≠∂y
)(ch™ge, 
ddi•
->
dügøm
);

139 
	}
}

141 
Poöt


142 
	$obje˘_li°_c‹√r
(
GLi°
 *
li°
)

144 
Poöt
 
p
 = {0.0,0.0};

145 
DüObje˘
 *
obj
;

147 i‡(
li°
 =
NULL
)

148  
p
;

150 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

151 
p
.
x
 = 
obj
->
boundög_box
.
À·
;

152 
p
.
y
 = 
obj
->
boundög_box
.
t›
;

154 
li°
 = 
	`g_li°_√xt
(list);

156 
li°
 !
NULL
) {

157 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

159 i‡(
p
.
x
 > 
obj
->
boundög_box
.
À·
)

160 
p
.
x
 = 
obj
->
boundög_box
.
À·
;

161 i‡(
p
.
y
 > 
obj
->
boundög_box
.
t›
)

162 
p
.
y
 = 
obj
->
boundög_box
.
t›
;

164 
li°
 = 
	`g_li°_√xt
(list);

167  
p
;

168 
	}
}

171 
	$obje˘_li°_s‹t_vîtiˇl
(c⁄° *
o1
, c⁄° *
o2
) {

172 
DüObje˘
 *
obj1
 = *(DüObje˘ **)
o1
;

173 
DüObje˘
 *
obj2
 = *(DüObje˘ **)
o2
;

175  (
obj1
->
boundög_box
.
bŸtom
+obj1->boundög_box.
t›
)/2 -

176 (
obj2
->
boundög_box
.
bŸtom
+obj2->boundög_box.
t›
)/2;

177 
	}
}

183 
	$obje˘_li°_Æign_v
(
GLi°
 *
obje˘s
, 
Dügøm
 *
dü
, 
Æign
)

185 
GLi°
 *
li°
;

186 
Poöt
 *
‹ig_pos
;

187 
Poöt
 *
de°_pos
;

188 
ªÆ
 
y_pos
 = 0;

189 
DüObje˘
 *
obj
;

190 
Poöt
 
pos
;

191 
ªÆ
 
t›
, 
bŸtom
, 
‰ì•c
;

192 
nobjs
;

193 
i
;

194 
gboﬁón
 
s‹t_Æloc
 = 
FALSE
;

196 i‡(
obje˘s
==
NULL
)

199 
obj
 = (
DüObje˘
 *Ë
obje˘s
->
d©a
;

201 
t›
 = 
obj
->
boundög_box
.top;

202 
bŸtom
 = 
obj
->
boundög_box
.bottom;

203 
‰ì•c
 = 
bŸtom
 - 
t›
;

205 
nobjs
 = 1;

206 
li°
 = 
obje˘s
->
√xt
;

207 
li°
 !
NULL
) {

208 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

210 i‡(
obj
->
boundög_box
.
t›
 <Åop)

211 
t›
 = 
obj
->
boundög_box
.top;

212 i‡(
obj
->
boundög_box
.
bŸtom
 > bottom)

213 
bŸtom
 = 
obj
->
boundög_box
.bottom;

215 
‰ì•c
 +
obj
->
boundög_box
.
bŸtom
 - obj->boundög_box.
t›
;

216 
nobjs
++;

218 
li°
 = 
	`g_li°_√xt
(list);

225 i‡(
Æign
 =
DIA_ALIGN_EQUAL
 ||álig¿=
DIA_ALIGN_ADJACENT
) {

226 
DüObje˘
 **
obje˘_¨øy
 = (DüObje˘ **)
	`g_mÆloc
((DüObje˘*)*
nobjs
);

227 
i
 = 0;

229 
li°
 = 
obje˘s
;

230 
li°
 !
NULL
) {

231 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

232 
obje˘_¨øy
[
i
] = 
obj
;

233 
i
++;

234 
li°
 = 
	`g_li°_√xt
(list);

236 
	`qs‹t
(
obje˘_¨øy
, 
nobjs
, (
DüObje˘
*), 
obje˘_li°_s‹t_vîtiˇl
);

237 
li°
 = 
NULL
;

238 
i
 = 0; i < 
nobjs
; i++) {

239 
li°
 = 
	`g_li°_≠≥nd
÷i°, 
obje˘_¨øy
[
i
]);

241 
obje˘s
 = 
li°
;

242 
s‹t_Æloc
 = 
TRUE
;

243 
	`g_‰ì
(
obje˘_¨øy
);

246 
Æign
) {

247 
DIA_ALIGN_TOP
:

248 
y_pos
 = 
t›
;

250 
DIA_ALIGN_CENTER
:

251 
y_pos
 = (
t›
 + 
bŸtom
)/2.0;

253 
DIA_ALIGN_BOTTOM
:

254 
y_pos
 = 
bŸtom
;

256 
DIA_ALIGN_POSITION
:

257 
y_pos
 = (
t›
 + 
bŸtom
)/2.0;

259 
DIA_ALIGN_EQUAL
:

260 
‰ì•c
 = (
bŸtom
 - 
t›
 - fªe•c)/()(
nobjs
 - 1);

261 
y_pos
 = 
t›
;

263 
DIA_ALIGN_ADJACENT
:

264 
y_pos
 = 
t›
;

267 
	`mesßge_w¨nög
("WrongárgumentÅo object_list_align_v()\n");

270 
de°_pos
 = 
	`g_√w
(
Poöt
, 
nobjs
);

271 
‹ig_pos
 = 
	`g_√w
(
Poöt
, 
nobjs
);

273 
i
 = 0;

274 
li°
 = 
obje˘s
;

275 
li°
 !
NULL
) {

276 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

278 
pos
.
x
 = 
obj
->
posôi⁄
.x;

280 
Æign
) {

281 
DIA_ALIGN_TOP
:

282 
pos
.
y
 = 
y_pos
 + 
obj
->
posôi⁄
.y - obj->
boundög_box
.
t›
;

284 
DIA_ALIGN_CENTER
:

285 
pos
.
y
 = 
y_pos
 + 
obj
->
posôi⁄
.y - (obj->
boundög_box
.
t›
 + obj->boundög_box.
bŸtom
)/2.0;

287 
DIA_ALIGN_BOTTOM
:

288 
pos
.
y
 = 
y_pos
 - (
obj
->
boundög_box
.
bŸtom
 - obj->
posôi⁄
.y);

290 
DIA_ALIGN_POSITION
:

291 
pos
.
y
 = 
y_pos
;

293 
DIA_ALIGN_EQUAL
:

294 
pos
.
y
 = 
y_pos
 + 
obj
->
posôi⁄
.y - obj->
boundög_box
.
t›
;

295 
y_pos
 +
obj
->
boundög_box
.
bŸtom
 - obj->boundög_box.
t›
 + 
‰ì•c
;

297 
DIA_ALIGN_ADJACENT
:

298 
pos
.
y
 = 
y_pos
 + 
obj
->
posôi⁄
.y - obj->
boundög_box
.
t›
;

299 
y_pos
 +
obj
->
boundög_box
.
bŸtom
 - obj->boundög_box.
t›
;

303 
pos
.
x
 = 
obj
->
posôi⁄
.x;

305 
‹ig_pos
[
i
] = 
obj
->
posôi⁄
;

306 
de°_pos
[
i
] = 
pos
;

308 
obj
->
›s
->
	`move
(obj, &
pos
);

310 
i
++;

311 
li°
 = 
	`g_li°_√xt
(list);

314 
	`undo_move_obje˘s
(
dü
, 
‹ig_pos
, 
de°_pos
, 
	`g_li°_c›y
(
obje˘s
));

315 i‡(
s‹t_Æloc
)

316 
	`g_li°_‰ì
(
obje˘s
);

317 
	}
}

321 
	$obje˘_li°_s‹t_h‹iz⁄èl
(c⁄° *
o1
, c⁄° *
o2
) {

322 
DüObje˘
 *
obj1
 = *(DüObje˘ **)
o1
;

323 
DüObje˘
 *
obj2
 = *(DüObje˘ **)
o2
;

325  (
obj1
->
boundög_box
.
right
+obj1->boundög_box.
À·
)/2 -

326 (
obj2
->
boundög_box
.
right
+obj2->boundög_box.
À·
)/2;

327 
	}
}

333 
	$obje˘_li°_Æign_h
(
GLi°
 *
obje˘s
, 
Dügøm
 *
dü
, 
Æign
)

335 
GLi°
 *
li°
;

336 
Poöt
 *
‹ig_pos
;

337 
Poöt
 *
de°_pos
;

338 
ªÆ
 
x_pos
 = 0;

339 
DüObje˘
 *
obj
;

340 
Poöt
 
pos
;

341 
ªÆ
 
À·
, 
right
, 
‰ì•c
 = 0;

342 
nobjs
;

343 
i
;

344 
gboﬁón
 
s‹t_Æloc
 = 
FALSE
;

346 i‡(
obje˘s
==
NULL
)

349 
obj
 = (
DüObje˘
 *Ë
obje˘s
->
d©a
;

351 
À·
 = 
obj
->
boundög_box
.left;

352 
right
 = 
obj
->
boundög_box
.right;

353 
‰ì•c
 = 
right
 - 
À·
;

355 
nobjs
 = 1;

356 
li°
 = 
obje˘s
->
√xt
;

357 
li°
 !
NULL
) {

358 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

360 i‡(
obj
->
boundög_box
.
À·
 <Üeft)

361 
À·
 = 
obj
->
boundög_box
.left;

362 i‡(
obj
->
boundög_box
.
right
 >Ñight)

363 
right
 = 
obj
->
boundög_box
.right;

365 
‰ì•c
 +
obj
->
boundög_box
.
right
 - obj->boundög_box.
À·
;

366 
nobjs
++;

368 
li°
 = 
	`g_li°_√xt
(list);

375 i‡(
Æign
 =
DIA_ALIGN_EQUAL
 ||álig¿=
DIA_ALIGN_ADJACENT
) {

376 
DüObje˘
 **
obje˘_¨øy
 = (DüObje˘ **)
	`g_mÆloc
((DüObje˘*)*
nobjs
);

377 
i
 = 0;

379 
li°
 = 
obje˘s
;

380 
li°
 !
NULL
) {

381 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

382 
obje˘_¨øy
[
i
] = 
obj
;

383 
i
++;

384 
li°
 = 
	`g_li°_√xt
(list);

386 
	`qs‹t
(
obje˘_¨øy
, 
nobjs
, (
DüObje˘
*), 
obje˘_li°_s‹t_h‹iz⁄èl
);

387 
li°
 = 
NULL
;

388 
i
 = 0; i < 
nobjs
; i++) {

389 
li°
 = 
	`g_li°_≠≥nd
÷i°, 
obje˘_¨øy
[
i
]);

391 
obje˘s
 = 
li°
;

392 
s‹t_Æloc
 = 
TRUE
;

393 
	`g_‰ì
(
obje˘_¨øy
);

396 
Æign
) {

397 
DIA_ALIGN_LEFT
:

398 
x_pos
 = 
À·
;

400 
DIA_ALIGN_CENTER
:

401 
x_pos
 = (
À·
 + 
right
)/2.0;

403 
DIA_ALIGN_RIGHT
:

404 
x_pos
 = 
right
;

406 
DIA_ALIGN_POSITION
:

407 
x_pos
 = (
À·
 + 
right
)/2.0;

409 
DIA_ALIGN_EQUAL
:

410 
‰ì•c
 = (
right
 - 
À·
 - fªe•c)/()(
nobjs
 - 1);

411 
x_pos
 = 
À·
;

413 
DIA_ALIGN_ADJACENT
:

414 
x_pos
 = 
À·
;

417 
	`mesßge_w¨nög
("WrongárgumentÅo object_list_align_h()\n");

420 
de°_pos
 = 
	`g_√w
(
Poöt
, 
nobjs
);

421 
‹ig_pos
 = 
	`g_√w
(
Poöt
, 
nobjs
);

423 
i
 = 0;

424 
li°
 = 
obje˘s
;

425 
li°
 !
NULL
) {

426 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

428 
Æign
) {

429 
DIA_ALIGN_LEFT
:

430 
pos
.
x
 = 
x_pos
 + 
obj
->
posôi⁄
.x - obj->
boundög_box
.
À·
;

432 
DIA_ALIGN_CENTER
:

433 
pos
.
x
 = 
x_pos
 + 
obj
->
posôi⁄
.x - (obj->
boundög_box
.
À·
 + obj->boundög_box.
right
)/2.0;

435 
DIA_ALIGN_RIGHT
:

436 
pos
.
x
 = 
x_pos
 - (
obj
->
boundög_box
.
right
 - obj->
posôi⁄
.x);

438 
DIA_ALIGN_POSITION
:

439 
pos
.
x
 = 
x_pos
;

441 
DIA_ALIGN_EQUAL
:

442 
pos
.
x
 = 
x_pos
 + 
obj
->
posôi⁄
.x - obj->
boundög_box
.
À·
;

443 
x_pos
 +
obj
->
boundög_box
.
right
 - obj->boundög_box.
À·
 + 
‰ì•c
;

445 
DIA_ALIGN_ADJACENT
:

446 
pos
.
x
 = 
x_pos
 + 
obj
->
posôi⁄
.x - obj->
boundög_box
.
À·
;

447 
x_pos
 +
obj
->
boundög_box
.
right
 - obj->boundög_box.
À·
;

451 
pos
.
y
 = 
obj
->
posôi⁄
.y;

453 
‹ig_pos
[
i
] = 
obj
->
posôi⁄
;

454 
de°_pos
[
i
] = 
pos
;

456 
obj
->
›s
->
	`move
(obj, &
pos
);

458 
i
++;

459 
li°
 = 
	`g_li°_√xt
(list);

462 
	`undo_move_obje˘s
(
dü
, 
‹ig_pos
, 
de°_pos
, 
	`g_li°_c›y
(
obje˘s
));

463 i‡(
s‹t_Æloc
)

464 
	`g_li°_‰ì
(
obje˘s
);

465 
	}
}

475 
	$obje˘_li°_nudge
(
GLi°
 *
obje˘s
, 
Dügøm
 *
dü
, 
Dúe˘i⁄
 
dú
, 
ªÆ
 
°ï
)

477 
Poöt
 *
‹ig_pos
;

478 
Poöt
 *
de°_pos
;

479 
guöt
 
nobjs
, 
i
;

480 
ªÆ
 
öc_x
, 
öc_y
;

481 
GLi°
 *
li°
;

482 
DüObje˘
 *
obj
;

484 i‡(!
obje˘s
)

486 
	`g_ªtu∫_if_Áû
 (
°ï
 > 0);

488 
nobjs
 = 
	`g_li°_Àngth
 (
obje˘s
);

489 
	`g_ªtu∫_if_Áû
 (
nobjs
 > 0);

491 
de°_pos
 = 
	`g_√w
(
Poöt
, 
nobjs
);

492 
‹ig_pos
 = 
	`g_√w
(
Poöt
, 
nobjs
);

494 
öc_x
 = 
DIR_RIGHT
 =
dú
 ? 
°ï
 : (
DIR_LEFT
 == dir ? -step : 0);

495 
öc_y
 = 
DIR_DOWN
 =
dú
 ? 
°ï
 : (
DIR_UP
 == dir ? -step : 0);

498 
i
 = 0;

499 
li°
 = 
obje˘s
;

500 
li°
 !
NULL
) {

501 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

503 
‹ig_pos
[
i
] = 
obj
->
posôi⁄
;

504 
de°_pos
[
i
].
x
 = 
‹ig_pos
[i].x + 
öc_x
;

505 
de°_pos
[
i
].
y
 = 
‹ig_pos
[i].y + 
öc_y
;

507 
obj
->
›s
->
	`move
(obj, &
de°_pos
[
i
]);

508 ++
i
;

509 
li°
 = 
	`g_li°_√xt
(list);

511 
	`undo_move_obje˘s
(
dü
, 
‹ig_pos
, 
de°_pos
, 
	`g_li°_c›y
(
obje˘s
));

512 
	}
}

	@O:\tool\dvs50\app\object_ops.h

18 #i‚de‡
OBJECT_OPS_H


19 
	#OBJECT_OPS_H


	)

21 
	~"obje˘.h
"

22 
	~"di•œy.h
"

23 
	~"dügøm.h
"

26 
	#DIA_ALIGN_TOP
 0

	)

27 
	#DIA_ALIGN_LEFT
 0

	)

28 
	#DIA_ALIGN_CENTER
 1

	)

29 
	#DIA_ALIGN_BOTTOM
 2

	)

30 
	#DIA_ALIGN_RIGHT
 2

	)

31 
	#DIA_ALIGN_POSITION
 3

	)

32 
	#DIA_ALIGN_EQUAL
 4

	)

33 
	#DIA_ALIGN_ADJACENT
 5

	)

35 
obje˘_add_upd©es
(
DüObje˘
 *
obj
, 
Dügøm
 *
dü
);

36 
obje˘_add_upd©es_li°
(
GLi°
 *
li°
, 
Dügøm
 *
dü
);

37 
C⁄√˘i⁄Poöt
 *
obje˘_föd_c⁄√˘poöt_di•œy
(
DDi•œy
 *
ddi•
,

38 
Poöt
 *
pos
,

39 
DüObje˘
 *
nŸthis
,

40 
gboﬁón
 
¢≠_to_obje˘s
);

42 
obje˘_c⁄√˘_di•œy
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
,

43 
H™dÀ
 *
h™dÀ
, 
gboﬁón
 
¢≠_to_obje˘s
);

46 
Poöt
 
obje˘_li°_c‹√r
(
GLi°
 *
li°
);

47 
obje˘_li°_Æign_h
(
GLi°
 *
obje˘s
, 
Dügøm
 *
dü
, 
Æign
);

48 
obje˘_li°_Æign_v
(
GLi°
 *
obje˘s
, 
Dügøm
 *
dü
, 
Æign
);

51 
	mDIR_UP
 = 1,

52 
	mDIR_DOWN
,

53 
	mDIR_LEFT
,

54 
	mDIR_RIGHT


55 } 
	tDúe˘i⁄
;

57 
obje˘_li°_nudge
(
GLi°
 *
obje˘s
, 
Dügøm
 *
dü
, 
Dúe˘i⁄
 
dú
, 
ªÆ
 
°ï
);

	@O:\tool\dvs50\app\pagesetup.c

22 #ifde‡
HAVE_CONFIG_H


23 
	~<c⁄fig.h
>

26 
	~<gtk/gtk.h
>

28 
	~<m©h.h
>

30 
	~"∑ge£tup.h
"

31 
	~"öé.h
"

32 
	~"dü∑gñayout.h
"

34 
_PageSëup
 
	tPageSëup
;

35 
	s_PageSëup
 {

36 
Dügøm
 *
	mdü
;

37 
GtkWidgë
 *
	mwödow
;

38 
GtkWidgë
 *
	m∑≥r
;

39 
gboﬁón
 
	mch™ged
;

42 
∑ge£tup_ch™ged
 (
GtkWidgë
 *
wid
, 
PageSëup
 *
ps
);

43 
∑ge£tup_≠∂y
 (
GtkWidgë
 *
wid
, 
PageSëup
 *
ps
);

45 
göt


46 
	$∑ge£tup_ª•⁄d
(
GtkWidgë
 *
widgë
,

47 
göt
 
ª•⁄£_id
,

48 
gpoöãr
 
d©a
)

50 
PageSëup
 *
ps
 = (PageSëu∞*)
d©a
;

52 i‡–
ª•⁄£_id
 =
GTK_RESPONSE_APPLY


53 || 
ª•⁄£_id
 =
GTK_RESPONSE_OK
) {

54 i‡(
ps
->
ch™ged
)

55 
	`∑ge£tup_≠∂y
(
widgë
, 
ps
);

58 i‡(
ª•⁄£_id
 !
GTK_RESPONSE_APPLY
) {

59 
	`g_obje˘_uƒef
(
ps
->
dü
);

60 
	`gtk_widgë_de°roy
(
ps
->
wödow
);

64 
	}
}

67 
	$¸óã_∑ge_£tup_dlg
(
Dügøm
 *
dü
)

69 
PageSëup
 *
ps
;

70 
GtkWidgë
 *
vbox
;

72 
ps
 = 
	`g_√w
(
PageSëup
, 1);

73 
ps
->
dü
 = dia;

74 
	`g_obje˘_ªf
(
ps
->
dü
);

75 
ps
->
wödow
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
(

76 
	`_
("Page Setup"),

77 
	`GTK_WINDOW
 (
	`ddi•œy_a˘ive
()->
shñl
),

78 
GTK_DIALOG_DESTROY_WITH_PARENT
,

79 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

80 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

81 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

82 
NULL
);

83 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
(
ps
->
wödow
), 
GTK_RESPONSE_OK
);

84 
vbox
 = 
	`GTK_DIALOG
(
ps
->
wödow
)->vbox;

85 
	`gtk_dülog_£t_ª•⁄£_£nsôive
(
	`GTK_DIALOG
(
ps
->
wödow
), 
GTK_RESPONSE_APPLY
, 
FALSE
);

86 
ps
->
ch™ged
 = 
FALSE
;

88 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
ps
->
wödow
), "response",

89 
	`G_CALLBACK
 (
∑ge£tup_ª•⁄d
), 
ps
);

92 
	`g_d©Æi°_£t_d©a_fuŒ
 (&
	`G_OBJECT
 (
ps
->
wödow
)->
qd©a
, "∑ge£tup",Ös, 
g_‰ì
);

94 
ps
->
∑≥r
 = 
	`dü_∑ge_œyout_√w
();

95 
	`dü_∑ge_œyout_£t_∑≥r
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
), 
dü
->
d©a
->∑≥r.
«me
);

96 
	`dü_∑ge_œyout_£t_m¨gös
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

97 
dü
->
d©a
->
∑≥r
.
tm¨gö
,

98 
dü
->
d©a
->
∑≥r
.
bm¨gö
,

99 
dü
->
d©a
->
∑≥r
.
lm¨gö
,

100 
dü
->
d©a
->
∑≥r
.
rm¨gö
);

101 
	`dü_∑ge_œyout_£t_‹õ¡©i⁄
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

102 
dü
->
d©a
->
∑≥r
.
is_p‹åaô
 ? 
DIA_PAGE_ORIENT_PORTRAIT
 :

103 
DIA_PAGE_ORIENT_LANDSCAPE
);

104 
	`dü_∑ge_œyout_£t_sˇlög
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

105 
dü
->
d©a
->
∑≥r
.
sˇlög
);

106 
	`dü_∑ge_œyout_£t_fôto
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

107 
dü
->
d©a
->
∑≥r
.
fôto
);

108 
	`dü_∑ge_œyout_£t_fô_dims
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

109 
dü
->
d©a
->
∑≥r
.
fôwidth
,

110 
dü
->
d©a
->
∑≥r
.
fôheight
);

112 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
ps
->
∑≥r
), 5);

113 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
vbox
), 
ps
->
∑≥r
, 
TRUE
, TRUE, 0);

114 
	`gtk_widgë_show
(
ps
->
∑≥r
);

116 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
ps
->
∑≥r
), "changed",

117 
	`G_CALLBACK
(
∑ge£tup_ch™ged
), 
ps
);

119 
	`gtk_widgë_show
(
ps
->
wödow
);

120 
	}
}

123 
	$∑ge£tup_ch™ged
(
GtkWidgë
 *
wid
, 
PageSëup
 *
ps
)

125 
gÊﬂt
 
dwidth
, 
dheight
;

126 
gÊﬂt
 
pwidth
, 
pheight
;

127 
gÊﬂt
 
xsˇÀ
, 
ysˇÀ
;

128 
göt
 
fôw
 = 0, 
fôh
 = 0;

129 
gÊﬂt
 
cur_sˇlög
;

132 
	`gtk_dülog_£t_ª•⁄£_£nsôive
(
	`GTK_DIALOG
(
ps
->
wödow
), 
GTK_RESPONSE_APPLY
, 
TRUE
);

133 
ps
->
ch™ged
 = 
TRUE
;

135 
dwidth
 = 
ps
->
dü
->
d©a
->
exã¡s
.
right
 -Ös->dü->d©a->exã¡s.
À·
;

136 
dheight
 = 
ps
->
dü
->
d©a
->
exã¡s
.
bŸtom
 -Ös->dü->d©a->exã¡s.
t›
;

138 i‡(
dwidth
 <0.0 || 
dheight
 <= 0.0)

141 
	`dü_∑ge_œyout_£t_ch™ged
 (
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
), 
TRUE
);

143 
cur_sˇlög
 = 
	`dü_∑ge_œyout_gë_sˇlög
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
));

144 
	`dü_∑ge_œyout_gë_ef„˘ive_¨ó
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

145 &
pwidth
, &
pheight
);

146 
	`g_ªtu∫_if_Áû
 (
pwidth
 > 0.0 && 
pheight
 > 0.0);

147 
pwidth
 *
cur_sˇlög
;

148 
pheight
 *
cur_sˇlög
;

150 i‡(
	`dü_∑ge_œyout_gë_fôto
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
))) {

151 
	`dü_∑ge_œyout_gë_fô_dims
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
), &
fôw
, &
fôh
);

152 
xsˇÀ
 = 
fôw
 * 
pwidth
 / 
dwidth
;

153 
ysˇÀ
 = 
fôh
 * 
pheight
 / 
dheight
;

154 
	`dü_∑ge_œyout_£t_sˇlög
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

155 
	`MIN
(
xsˇÀ
, 
ysˇÀ
));

157 
fôw
 = 
	`˚û
(
dwidth
 * 
cur_sˇlög
 / 
pwidth
);

158 
fôh
 = 
	`˚û
(
dheight
 * 
cur_sˇlög
 / 
pheight
);

159 
	`dü_∑ge_œyout_£t_fô_dims
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
), 
fôw
, 
fôh
);

162 
	`dü_∑ge_œyout_£t_ch™ged
 (
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
), 
FALSE
);

163 
	}
}

169 
	$∑ge£tup_≠∂y
(
GtkWidgë
 *
wid
, 
PageSëup
 *
ps
)

171 
	`g_‰ì
(
ps
->
dü
->
d©a
->
∑≥r
.
«me
);

172 
ps
->
dü
->
d©a
->
∑≥r
.
«me
 =

173 
	`g_°rdup
(
	`dü_∑ge_œyout_gë_∑≥r
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
)));

175 
	`dü_∑ge_œyout_gë_m¨gös
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

176 &
ps
->
dü
->
d©a
->
∑≥r
.
tm¨gö
,

177 &
ps
->
dü
->
d©a
->
∑≥r
.
bm¨gö
,

178 &
ps
->
dü
->
d©a
->
∑≥r
.
lm¨gö
,

179 &
ps
->
dü
->
d©a
->
∑≥r
.
rm¨gö
);

181 
ps
->
dü
->
d©a
->
∑≥r
.
is_p‹åaô
 =

182 
	`dü_∑ge_œyout_gë_‹õ¡©i⁄
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
)) ==

183 
DIA_PAGE_ORIENT_PORTRAIT
;

184 
ps
->
dü
->
d©a
->
∑≥r
.
sˇlög
 =

185 
	`dü_∑ge_œyout_gë_sˇlög
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
));

187 
ps
->
dü
->
d©a
->
∑≥r
.
fôto
 = 
	`dü_∑ge_œyout_gë_fôto
(

188 
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
));

189 
	`dü_∑ge_œyout_gë_fô_dims
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

190 &
ps
->
dü
->
d©a
->
∑≥r
.
fôwidth
,

191 &
ps
->
dü
->
d©a
->
∑≥r
.
fôheight
);

193 
	`dü_∑ge_œyout_gë_ef„˘ive_¨ó
(
	`DIA_PAGE_LAYOUT
(
ps
->
∑≥r
),

194 &
ps
->
dü
->
d©a
->
∑≥r
.
width
,

195 &
ps
->
dü
->
d©a
->
∑≥r
.
height
);

198 
	`gtk_dülog_£t_ª•⁄£_£nsôive
(
	`GTK_DIALOG
(
ps
->
wödow
), 
GTK_RESPONSE_APPLY
, 
FALSE
);

199 
ps
->
ch™ged
 = 
FALSE
;

202 
	`dügøm_£t_modifõd
(
ps
->
dü
, 
TRUE
);

203 
	`dügøm_add_upd©e_Æl
(
ps
->
dü
);

204 
	`dügøm_Êush
(
ps
->
dü
);

205 
	}
}

	@O:\tool\dvs50\app\pagesetup.h

22 #i‚de‡
PAGESETUP_H


23 
	#PAGESETUP_H


	)

25 
	~"dügøm.h
"

27 
¸óã_∑ge_£tup_dlg
 (
Dügøm
 *
dü
);

	@O:\tool\dvs50\app\plugin-manager.c

24 #ifde‡
HAVE_CONFIG_H


25 
	~<c⁄fig.h
>

28 
	~<°rög.h
>

30 
	~<gtk/gtk.h
>

32 
	~"∂ugö-m™agî.h
"

33 
	~"öé.h
"

34 
	~"∂ug-ös.h
"

35 
	~"mesßge.h
"

37 
göt


38 
	$pm_ª•⁄d
(
GtkWidgë
 *
widgë
, 
göt
 
ª•⁄£_id
, 
gpoöãr
 
d©a
)

40 i‡(
ª•⁄£_id
 !
GTK_RESPONSE_APPLY
)

41 
	`gtk_widgë_hide
(
widgë
);

43 
	}
}

47 
	mLOADED_COLUMN
,

48 
	mNAME_COLUMN
,

49 
	mDESC_COLUMN
,

50 
	mFILENAME_COLUMN
,

51 
	mAUTOLOAD_COLUMN
,

52 
	mPLUGIN_COLUMN
,

53 
	mNUM_COLUMNS


57 
	$toggÀ_lﬂded_ˇŒback
 (
GtkCñlRídîîToggÀ
 *
˚ŒtoggÀ
,

58 
gch¨
 *
∑th_°rög
,

59 
GtkTªeVõw
 *
åì_võw
)

61 
GtkTªeModñ
 *
modñ
 = 
	`gtk_åì_võw_gë_modñ
 (
åì_võw
);

62 
GtkTªeP©h
 *
∑th
;

63 
GtkTªeIãr
 
ôî
;

64 
gboﬁón
 
lﬂded
;

65 
PlugöInfo
 *
öfo
;

67 
∑th
 = 
	`gtk_åì_∑th_√w_‰om_°rög
 (
∑th_°rög
);

68 i‡(!
	`gtk_åì_modñ_gë_ôî
 (
modñ
, &
ôî
, 
∑th
))

70 
	`g_w¨nög
 ("%s: badÖ©h?", 
G_STRLOC
);

73 
	`gtk_åì_∑th_‰ì
 (
∑th
);

75 
	`gtk_åì_modñ_gë
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
,

76 
LOADED_COLUMN
, &
lﬂded
, -1);

77 
	`gtk_åì_modñ_gë
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
,

78 
PLUGIN_COLUMN
, &
öfo
, -1);

80 i‡(
lﬂded
 && 
	`dü_∂ugö_ˇn_u∆ﬂd
(
öfo
))

82 
	`dü_∂ugö_u∆ﬂd
(
öfo
);

83 
lﬂded
 = 
FALSE
;

85 i‡(!
lﬂded
)

87 
	`dü_∂ugö_lﬂd
(
öfo
);

88 
lﬂded
 = 
TRUE
;

91 
	`mesßge_nŸi˚
("C™'àu∆ﬂdÖlug-ö '%s'!", 
	`dü_∂ugö_gë_«me
(
öfo
));

92 
	`gtk_li°_°‹e_£t
 (
	`GTK_LIST_STORE
 (
modñ
), &
ôî
,

93 
LOADED_COLUMN
, 
lﬂded
, -1);

94 
	}
}

97 
	$ˇn_u∆ﬂd
 (
GtkTªeVõwCﬁumn
 *
åì_cﬁumn
,

98 
GtkCñlRídîî
 *
˚Œ
,

99 
GtkTªeModñ
 *
åì_modñ
,

100 
GtkTªeIãr
 *
ôî
,

101 
gpoöãr
 
d©a
)

103 
PlugöInfo
 *
öfo
;

104 
gboﬁón
 
lﬂded
;

106 
	`gtk_åì_modñ_gë
(
åì_modñ
, 
ôî
,

107 
PLUGIN_COLUMN
, &
öfo
, -1);

108 
	`gtk_åì_modñ_gë
(
åì_modñ
, 
ôî
,

109 
LOADED_COLUMN
, &
lﬂded
, -1);

110 i‡(!
lﬂded
 || (lﬂded && 
	`dü_∂ugö_ˇn_u∆ﬂd
(
öfo
)))

112 
˚Œ
->
mode
 = 
GTK_CELL_RENDERER_MODE_ACTIVATABLE
;

113 
	`GTK_CELL_RENDERER_TOGGLE
(
˚Œ
)->
a˘iv©abÀ
 = 
TRUE
;

117 
˚Œ
->
mode
 = 
GTK_CELL_RENDERER_MODE_INERT
;

118 
	`GTK_CELL_RENDERER_TOGGLE
(
˚Œ
)->
a˘iv©abÀ
 = 
FALSE
;

120 
	}
}

123 
	$toggÀ_autﬁﬂd_ˇŒback
 (
GtkCñlRídîîToggÀ
 *
˚ŒtoggÀ
,

124 
gch¨
 *
∑th_°rög
,

125 
GtkTªeVõw
 *
åì_võw
)

127 
GtkTªeModñ
 *
modñ
 = 
	`gtk_åì_võw_gë_modñ
 (
åì_võw
);

128 
GtkTªeP©h
 *
∑th
;

129 
GtkTªeIãr
 
ôî
;

130 
gboﬁón
 
lﬂd
;

131 
PlugöInfo
 *
öfo
;

133 
∑th
 = 
	`gtk_åì_∑th_√w_‰om_°rög
 (
∑th_°rög
);

134 i‡(!
	`gtk_åì_modñ_gë_ôî
 (
modñ
, &
ôî
, 
∑th
))

136 
	`g_w¨nög
 ("%s: badÖ©h?", 
G_STRLOC
);

139 
	`gtk_åì_∑th_‰ì
 (
∑th
);

141 
	`gtk_åì_modñ_gë
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
,

142 
AUTOLOAD_COLUMN
, &
lﬂd
, -1);

143 
	`gtk_åì_modñ_gë
 (
	`GTK_TREE_MODEL
 (
modñ
), &
ôî
,

144 
PLUGIN_COLUMN
, &
öfo
, -1);

149 i‡–0 =
	`°rcmp
(
	`dü_∂ugö_gë_«me
(
öfo
), "Standard")

150 || 0 =
	`°rcmp
(
	`dü_∂ugö_gë_«me
(
öfo
), "Internal"))

151 
	`mesßge_nŸi˚
("You don't wantÅo inhibitÜoading\n"

152 "o‡∂ug-ö '%s'!", 
	`dü_∂ugö_gë_«me
(
öfo
));

154 
	`dü_∂ugö_£t_öhibô_lﬂd
(
öfo
, 
lﬂd
);

155 
	`gtk_li°_°‹e_£t
 (
	`GTK_LIST_STORE
 (
modñ
), &
ôî
,

156 
AUTOLOAD_COLUMN
, !
lﬂd
, -1);

158 
	}
}

161 
	$ˇn_öhibô
 (
GtkTªeVõwCﬁumn
 *
åì_cﬁumn
,

162 
GtkCñlRídîî
 *
˚Œ
,

163 
GtkTªeModñ
 *
åì_modñ
,

164 
GtkTªeIãr
 *
ôî
,

165 
gpoöãr
 
d©a
)

167 
PlugöInfo
 *
öfo
;

169 
	`gtk_åì_modñ_gë
(
åì_modñ
, 
ôî
,

170 
PLUGIN_COLUMN
, &
öfo
, -1);

171 i‡–0 =
	`°rcmp
(
	`dü_∂ugö_gë_«me
(
öfo
), "Standard")

172 || 0 =
	`°rcmp
(
	`dü_∂ugö_gë_«me
(
öfo
), "Internal"))

174 
˚Œ
->
mode
 = 
GTK_CELL_RENDERER_MODE_INERT
;

175 
	`GTK_CELL_RENDERER_TOGGLE
(
˚Œ
)->
a˘iv©abÀ
 = 
FALSE
;

179 
˚Œ
->
mode
 = 
GTK_CELL_RENDERER_MODE_ACTIVATABLE
;

180 
	`GTK_CELL_RENDERER_TOGGLE
(
˚Œ
)->
a˘iv©abÀ
 = 
TRUE
;

182 
	}
}

184 
GtkWidgë
 *

185 
	$gë_∂ugö_m™agî
()

187 
GtkWidgë
 *
dülog
 = 
NULL
;

188 
GtkWidgë
 *
vbox
, *
s¸ﬁÀd_wödow
, *
åì_võw
;

189 
GtkLi°St‹e
 *
°‹e
;

190 
GtkCñlRídîî
 *
ªndîî
;

191 
GtkTªeVõwCﬁumn
 *
cﬁ
;

192 
GtkTªeIãr
 
ôî
;

193 
GLi°
 *
tmp
;

195 i‡(
dülog
)

196  
dülog
;

199 
dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
(

200 
	`_
("Plug-ins"),

201 
NULL
, 0,

202 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

203 
NULL
);

205 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
(
dülog
), 
GTK_RESPONSE_CLOSE
);

207 
vbox
 = 
	`GTK_DIALOG
(
dülog
)->vbox;

210 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
dülog
), "response",

211 
	`G_CALLBACK
(
pm_ª•⁄d
), 
NULL
);

212 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
dülog
), "delete_event",

213 
	`G_CALLBACK
(
gtk_widgë_hide
), 
NULL
);

214 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
dülog
), "delete_event",

215 
	`G_CALLBACK
(
gtk_åue
), 
NULL
);

216 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
dülog
), "destroy",

217 
	`G_CALLBACK
(
gtk_widgë_de°royed
), &
dülog
);

219 
s¸ﬁÀd_wödow
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

220 
	`gtk_s¸ﬁÀd_wödow_£t_shadow_ty≥
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wödow
), 
GTK_SHADOW_ETCHED_IN
);

221 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wödow
), 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

222 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
s¸ﬁÀd_wödow
, 
TRUE
, TRUE, 0);

225 
°‹e
 = 
	`gtk_li°_°‹e_√w
 (
NUM_COLUMNS
,

226 
G_TYPE_BOOLEAN
,

227 
G_TYPE_STRING
,

228 
G_TYPE_STRING
,

229 
G_TYPE_STRING
,

230 
G_TYPE_BOOLEAN
,

231 
G_TYPE_POINTER
);

232 
åì_võw
 = 
	`gtk_åì_võw_√w_wôh_modñ
 (
	`GTK_TREE_MODEL
 (
°‹e
));

233 
	`gtk_åì_võw_£t_ruÀs_höt
 (
	`GTK_TREE_VIEW
 (
åì_võw
), 
TRUE
);

236 
tmp
 = 
	`dü_li°_∂ugös
();Åm∞!
NULL
;Åm∞tmp->
√xt
) {

237 
PlugöInfo
 *
öfo
 = 
tmp
->
d©a
;

239 
	`gtk_li°_°‹e_≠≥nd
 (
°‹e
, &
ôî
);

240 
	`gtk_li°_°‹e_£t
 (
°‹e
, &
ôî
,

241 
LOADED_COLUMN
, 
	`dü_∂ugö_is_lﬂded
(
öfo
),

242 
NAME_COLUMN
, 
	`dü_∂ugö_gë_«me
(
öfo
),

243 
DESC_COLUMN
, 
	`dü_∂ugö_gë_des¸ùti⁄
(
öfo
),

244 
FILENAME_COLUMN
, 
	`dü_∂ugö_gë_fûíame
(
öfo
),

245 
AUTOLOAD_COLUMN
, !
	`dü_∂ugö_gë_öhibô_lﬂd
(
öfo
),

246 
PLUGIN_COLUMN
, 
öfo
,

251 
ªndîî
 = 
	`gtk_˚Œ_ªndîî_toggÀ_√w
 ();

252 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
ªndîî
), "toggled",

253 
	`G_CALLBACK
 (
toggÀ_lﬂded_ˇŒback
), 
åì_võw
);

254 
cﬁ
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
(

255 
	`_
("Lﬂded"), 
ªndîî
,

256 "a˘ive", 
LOADED_COLUMN
, 
NULL
);

257 
	`gtk_åì_võw_cﬁumn_£t_˚Œ_d©a_func
 (

258 
cﬁ
, 
ªndîî
, 
ˇn_u∆ﬂd
, 
NULL
, NULL);

259 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
	`GTK_TREE_VIEW
 (
åì_võw
), 
cﬁ
);

261 
cﬁ
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
(

262 
	`_
("Name"), 
	`gtk_˚Œ_ªndîî_ãxt_√w
 (),

263 "ãxt", 
NAME_COLUMN
, 
NULL
);

264 
	`gtk_åì_võw_cﬁumn_£t_s‹t_cﬁumn_id
 (
cﬁ
, 
NAME_COLUMN
);

265 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
	`GTK_TREE_VIEW
 (
åì_võw
), 
cﬁ
);

267 
cﬁ
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
(

268 
	`_
("Des¸ùti⁄"), 
	`gtk_˚Œ_ªndîî_ãxt_√w
 (),

269 "ãxt", 
DESC_COLUMN
, 
NULL
);

270 
	`gtk_åì_võw_cﬁumn_£t_s‹t_cﬁumn_id
 (
cﬁ
, 
DESC_COLUMN
);

271 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
	`GTK_TREE_VIEW
 (
åì_võw
), 
cﬁ
);

273 
ªndîî
 = 
	`gtk_˚Œ_ªndîî_toggÀ_√w
 ();

274 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
ªndîî
), "toggled",

275 
	`G_CALLBACK
 (
toggÀ_autﬁﬂd_ˇŒback
), 
åì_võw
);

276 
cﬁ
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
(

277 
	`_
("LﬂdáàSèπup"), 
ªndîî
,

278 "a˘ive", 
AUTOLOAD_COLUMN
, 
NULL
);

279 
	`gtk_åì_võw_cﬁumn_£t_˚Œ_d©a_func
 (

280 
cﬁ
, 
ªndîî
, 
ˇn_öhibô
, 
NULL
, NULL);

281 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
	`GTK_TREE_VIEW
 (
åì_võw
), 
cﬁ
);

283 
cﬁ
 = 
	`gtk_åì_võw_cﬁumn_√w_wôh_©åibuãs
(

284 
	`_
("FûêName"), 
	`gtk_˚Œ_ªndîî_ãxt_√w
 (),

285 "ãxt", 
FILENAME_COLUMN
, 
NULL
);

286 
	`gtk_åì_võw_cﬁumn_£t_s‹t_cﬁumn_id
 (
cﬁ
, 
FILENAME_COLUMN
);

287 
	`gtk_åì_võw_≠≥nd_cﬁumn
 (
	`GTK_TREE_VIEW
 (
åì_võw
), 
cﬁ
);

289 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
s¸ﬁÀd_wödow
), 
åì_võw
);

290 
	`gtk_wödow_£t_deÁu…_size
 (
	`GTK_WINDOW
 (
dülog
), 480, 400);

291 
	`gtk_widgë_show_Æl
 (
dülog
);

293  
dülog
;

294 
	}
}

297 
	$fûe_∂ugös_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

299 
GtkWidgë
 *
pm
 = 
	`gë_∂ugö_m™agî
();

301 
	`gtk_widgë_show
(
pm
);

302 
	}
}

	@O:\tool\dvs50\app\plugin-manager.h

22 #i‚de‡
PLUGIN_MANAGER_H


23 
	#PLUGIN_MANAGER_H


	)

25 
	~<gtk/gtk.h
>

27 
fûe_∂ugös_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

	@O:\tool\dvs50\app\preferences.c

18 
	~<c⁄fig.h
>

20 
	~<°dlib.h
>

21 
	~<°dio.h
>

22 
	~<°rög.h
>

23 
	~<sys/ty≥s.h
>

24 #ifde‡
HAVE_UNISTD_H


25 
	~<uni°d.h
>

27 #ifde‡
HAVE_STDDEF_H


28 
	~<°ddef.h
>

31 
	~<gtk/gtk.h
>

33 
	~"öé.h
"

34 
	~"widgës.h
"

35 
	~"dügøm.h
"

36 
	~"mesßge.h
"

37 
	~"¥e„ªn˚s.h
"

38 
	~"dü_dús.h
"

39 
	~"dügømd©a.h
"

40 
	~"∑≥r.h
"

41 
	~"öãrÁ˚.h
"

42 
	~"lib/¥efs.h
"

43 
	~"≥rsi°í˚.h
"

45 #ifde‡
G_OS_WIN32


46 
	~<io.h
>

49 
DüPª„ªn˚s
 
	g¥efs
;

51 
	eDüPªfTy≥
 {

52 
	mPREF_NONE
,

53 
	mPREF_BOOLEAN
,

54 
	mPREF_INT
,

55 
	mPREF_UINT
,

56 
	mPREF_REAL
,

57 
	mPREF_UREAL
,

58 
	mPREF_COLOUR
,

59 
	mPREF_CHOICE
,

60 
	mPREF_STRING
,

61 
	mPREF_END_GROUP


64 
	s_DüPªfD©a
 {

65 *
	m«me
;

66 
DüPªfTy≥
 
	mty≥
;

67 
	moff£t
;

68 c⁄° *
	mdeÁu…_vÆue
;

69 
	mèb
;

70 *
	mœbñ_ãxt
;

71 
GtkWidgë
 *
	mwidgë
;

72 
gboﬁón
 
	mhiddí
;

73 
	mGLi°
 *(*
	mchoi˚_li°_fun˘i⁄
)(
_DüPªfD©a
 *
	m¥ef
);

75 (*
	mupd©e_fun˘i⁄
)(
_DüPªfD©a
 *
	m¥ef
, 
gpoöãr
 
	m±r
);

76 c⁄° *
	mkey
;

77 } 
	tDüPªfD©a
;

79 
upd©e_Êﬂtög_toﬁbox
(
DüPªfD©a
 *
¥ef
, 
gpoöãr
 
±r
);

80 
upd©e_öã∫Æ_¥efs
(
DüPªfD©a
 *
¥ef
, 
gpoöãr
 
±r
);

82 
	gdeÁu…_åue
 = 1;

83 
	gdeÁu…_Ál£
 = 0;

84 
	gdeÁu…_maj‹_löes
 = 5;

85 
ªÆ
 
	gdeÁu…_ªÆ_⁄e
 = 1.0;

86 
ªÆ
 
	gdeÁu…_ªÆ_zoom
 = 100.0;

87 
	gdeÁu…_öt_w
 = 500;

88 
	gdeÁu…_öt_h
 = 400;

89 
	gdeÁu…_undo_dïth
 = 15;

90 
guöt
 
	gdeÁu…_ª˚¡_documíts
 = 5;

91 
Cﬁ‹
 
	gdeÁu…_cﬁour
 = 
DEFAULT_GRID_COLOR
;

92 
Cﬁ‹
 
	gpbªak_cﬁour
 = 
DEFAULT_PAGEBREAK_COLOR
;

93 
guöt
 
	gdeÁu…_dåì_dü_s‹t
 = 
DIA_TREE_SORT_INSERT
;

94 
guöt
 
	gdeÁu…_dåì_obj_s‹t
 = 
DIA_TREE_SORT_INSERT
;

95 c⁄° 
gch¨
 *
	gdeÁu…_∑≥r_«me
 = 
NULL
;

96 c⁄° 
gch¨
 *
	gdeÁu…_Àngth_unô
 = "Centimeter";

97 c⁄° 
gch¨
 *
	gdeÁu…_f⁄tsize_unô
 = "Point";

99 c⁄° *
	gdeÁu…_Áv‹ed_fûãr
 = 
N_
("any");

101 
	sDüPªfsTab
 {

102 *
	mtôÀ
;

103 
GtkTabÀ
 *
	mèbÀ
;

104 
	mrow
;

108 
	mUI_TAB
,

109 
	mDIA_TAB
,

110 
	mVIEW_TAB
,

111 
	mFAVOR_TAB
,

112 
	mGRID_TAB
,

113 
	mTREE_TAB


114 } 
	tTabIndex
;

116 
DüPªfsTab
 
	g¥efs_èbs
[] =

118 {
N_
("U£∏I¡îÁ˚"), 
NULL
, 0},

119 {
N_
("Dügøm DeÁu…s"), 
NULL
, 0},

120 {
N_
("Võw DeÁu…s"), 
NULL
, 0},

121 {
N_
("Fav‹ôes"), 
NULL
, 0},

122 {
N_
("Grid Löes"), 
NULL
, 0},

123 {
N_
("Dügøm Tªe"), 
NULL
, 0},

126 
	#NUM_PREFS_TABS
 ((
¥efs_èbs
)/(
DüPªfsTab
))

	)

128 
GLi°
 *

129 
	$_gë_unôs_«me_li°
(
DüPªfD©a
 *
¥ef
)

131 
	`g_ªtu∫_vÆ_if_Áû
(
¥ef
->
key
 =
NULL
, NULL);

132  
	`gë_unôs_«me_li°
();

133 
	}
}

134 
GLi°
 *

135 
	$_gë_∑≥r_«me_li°
(
DüPªfD©a
 *
¥ef
)

137 
	`g_ªtu∫_vÆ_if_Áû
(
¥ef
->
key
 =
NULL
, NULL);

138  
	`gë_∑≥r_«me_li°
();

139 
	}
}

140 
GLi°
 *

141 
	$gë_exp‹ãr_«mes
 (
DüPªfD©a
 *
¥ef
)

143 
GLi°
 *
li°
 = 
	`fûãr_gë_unique_exp‹t_«mes
(
¥ef
->
key
);

144 
li°
 = 
	`g_li°_¥ïíd
 (li°, 
	`N_
("any"));

145  
li°
;

146 
	}
}

149 
	$£t_Áv‹ed_exp‹ãr
 (
DüPªfD©a
 *
¥ef
, 
gpoöãr
 
±r
)

151 *
vÆ
 = *((
gch¨
 **)
±r
);

152 
	`fûãr_£t_Áv‹ed_exp‹t
(
¥ef
->
key
, 
vÆ
);

153 
	}
}

156 #ifde‡
off£tof


157 
	#PREF_OFFSET
(
fõld
Ë((Ë
	`off£tof
 (
DüPª„ªn˚s
, fõld))

	)

159 
	#PREF_OFFSET
(
fõld
Ë((Ë((*Ë&((
DüPª„ªn˚s
 *Ë0)->fõld))

	)

162 
DüPªfD©a
 
	g¥efs_d©a
[] =

164 { "ª£t_toﬁs_a·î_¸óã", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
ª£t_toﬁs_a·î_¸óã
),

165 &
deÁu…_åue
, 
UI_TAB
, 
N_
("ResetÅoolsáfter create") },

167 { "undo_dïth", 
PREF_UINT
, 
PREF_OFFSET
(
undo_dïth
),

168 &
deÁu…_undo_dïth
, 
UI_TAB
, 
N_
("Number of undoÜevels:") },

170 { "ªvî£_rubbîb™dög_öãr£˘s", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
ªvî£_rubbîb™dög_öãr£˘s
),

171 &
deÁu…_åue
, 
UI_TAB
, 
N_
("Reverse dragging selects\nintersecting objects") },

173 { "ª˚¡_documíts_li°_size", 
PREF_UINT
, 
PREF_OFFSET
(
ª˚¡_documíts_li°_size
),

174 &
deÁu…_ª˚¡_documíts
, 0, 
N_
("Recent documentsÜist size:") },

176 { "u£_míu_b¨", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
√w_võw
.
u£_míu_b¨
),

177 &
deÁu…_åue
, 
UI_TAB
, 
N_
("Use menu bar") },

179 { "toﬁbox_⁄_t›", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
toﬁbox_⁄_t›
),

180 &
deÁu…_Ál£
, 
UI_TAB
, 
N_
("KeepÅool box onÅop of diagram windows"),

181 
NULL
, 
FALSE
, NULL, 
upd©e_Êﬂtög_toﬁbox
},

182 { "Àngth_unô", 
PREF_CHOICE
, 
PREF_OFFSET
(
Àngth_unô
),

183 &
deÁu…_Àngth_unô
, 
UI_TAB
, 
N_
("Lígth unô:"), 
NULL
, 
FALSE
,

184 
_gë_unôs_«me_li°
, 
upd©e_öã∫Æ_¥efs
 },

185 { "f⁄tsize_unô", 
PREF_CHOICE
, 
PREF_OFFSET
(
f⁄tsize_unô
),

186 &
deÁu…_f⁄tsize_unô
, 
UI_TAB
, 
N_
("F⁄t-sizêunô:"), 
NULL
, 
FALSE
,

187 
_gë_unôs_«me_li°
, 
upd©e_öã∫Æ_¥efs
 },

189 { 
NULL
, 
PREF_NONE
, 0, NULL, 
DIA_TAB
, 
N_
("New diagram:") },

190 { "is_p‹åaô", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
√w_dügøm
.
is_p‹åaô
), &
deÁu…_åue
, 
DIA_TAB
, 
N_
("Portrait") },

191 { "√w_dügøm_∑≥πy≥", 
PREF_CHOICE
, 
PREF_OFFSET
(
√w_dügøm
.
∑≥πy≥
),

192 &
deÁu…_∑≥r_«me
, 
DIA_TAB
, 
N_
("P≠îÅy≥:"), 
NULL
, 
FALSE
, 
_gë_∑≥r_«me_li°
 },

193 { "√w_dügøm_bgcﬁour", 
PREF_COLOUR
, 
PREF_OFFSET
(
√w_dügøm
.
bg_cﬁ‹
),

194 &
cﬁ‹_whôe
, 
DIA_TAB
, 
N_
("Background Color:") },

195 { "com¥ess_ßve", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
√w_dügøm
.
com¥ess_ßve
),

196 &
deÁu…_åue
, 
DIA_TAB
, 
N_
("Compress saved files") },

197 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
DIA_TAB
, NULL },

199 { 
NULL
, 
PREF_NONE
, 0, NULL, 
DIA_TAB
, 
N_
("Connection Points:") },

200 { "show_cx_±s", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
show_cx_±s
), &
deÁu…_åue
, 
DIA_TAB
, 
N_
("Visible") },

201 { "¢≠_obje˘", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
¢≠_obje˘
), &
deÁu…_åue
, 
DIA_TAB
, 
N_
("SnapÅo object") },

202 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
DIA_TAB
, NULL },

204 { 
NULL
, 
PREF_NONE
, 0, NULL, 
VIEW_TAB
, 
N_
("New window:") },

205 { "√w_võw_width", 
PREF_UINT
, 
PREF_OFFSET
(
√w_võw
.
width
), &
deÁu…_öt_w
, 
VIEW_TAB
, 
N_
("Width:") },

206 { "√w_võw_height", 
PREF_UINT
, 
PREF_OFFSET
(
√w_võw
.
height
), &
deÁu…_öt_h
, 
VIEW_TAB
, 
N_
("Height:") },

207 { "√w_võw_zoom", 
PREF_UREAL
, 
PREF_OFFSET
(
√w_võw
.
zoom
), &
deÁu…_ªÆ_zoom
, 
VIEW_TAB
, 
N_
("Magnify:") },

208 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 1, NULL },

210 { 
NULL
, 
PREF_NONE
, 0, NULL, 
VIEW_TAB
, 
N_
("Page breaks:") },

211 { "∑gebªak_visibÀ", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
∑gebªak
.
visibÀ
), &
deÁu…_åue
, 
VIEW_TAB
, 
N_
("Visible") },

212 { "∑gebªak_cﬁour", 
PREF_COLOUR
, 
PREF_OFFSET
(
√w_dügøm
.
∑gebªak_cﬁ‹
), &
pbªak_cﬁour
, 
VIEW_TAB
, 
N_
("Color:") },

213 { "∑gebªak_sﬁid", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
∑gebªak
.
sﬁid
), &
deÁu…_åue
, 
VIEW_TAB
, 
N_
("SolidÜines") },

214 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
VIEW_TAB
, NULL },

216 { 
NULL
, 
PREF_NONE
, 0, NULL, 
VIEW_TAB
, 
N_
("Antialias:") },

217 { "võw_™tüli£d", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
võw_™tüli£d
), &
deÁu…_Ál£
, 
VIEW_TAB
, 
N_
("viewántialised") },

218 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
VIEW_TAB
, NULL },

221 { 
NULL
, 
PREF_NONE
, 0, NULL, 
FAVOR_TAB
, 
N_
("Export") },

222 { "Áv‹ed_≤g_exp‹t", 
PREF_CHOICE
, 
PREF_OFFSET
(
Áv‹ed_fûãr
.
≤g
), &
deÁu…_Áv‹ed_fûãr
,

223 
FAVOR_TAB
, 
N_
("P‹èbÀ Nëw‹k Gøphics"), 
NULL
, 
FALSE
, 
gë_exp‹ãr_«mes
, 
£t_Áv‹ed_exp‹ãr
, "PNG" },

224 { "Áv‹ed_svg_exp‹t", 
PREF_CHOICE
, 
PREF_OFFSET
(
Áv‹ed_fûãr
.
svg
), &
deÁu…_Áv‹ed_fûãr
,

225 
FAVOR_TAB
, 
N_
("SˇœbÀ Ve˘‹ Gøphics"), 
NULL
, 
FALSE
, 
gë_exp‹ãr_«mes
, 
£t_Áv‹ed_exp‹ãr
, "SVG" },

226 { "Áv‹ed_ps_exp‹t", 
PREF_CHOICE
, 
PREF_OFFSET
(
Áv‹ed_fûãr
.
ps
), &
deÁu…_Áv‹ed_fûãr
,

227 
FAVOR_TAB
, 
N_
("Po°S¸ùt"), 
NULL
, 
FALSE
, 
gë_exp‹ãr_«mes
, 
£t_Áv‹ed_exp‹ãr
, "PS" },

228 { "Áv‹ed_wmf_exp‹t", 
PREF_CHOICE
, 
PREF_OFFSET
(
Áv‹ed_fûãr
.
wmf
), &
deÁu…_Áv‹ed_fûãr
,

229 
FAVOR_TAB
, 
N_
("Wödow†MëaFûe"), 
NULL
, 
FALSE
, 
gë_exp‹ãr_«mes
, 
£t_Áv‹ed_exp‹ãr
, "WMF" },

230 { "Áv‹ed_emf_exp‹t", 
PREF_CHOICE
, 
PREF_OFFSET
(
Áv‹ed_fûãr
.
emf
), &
deÁu…_Áv‹ed_fûãr
,

231 
FAVOR_TAB
, 
N_
("Enh™˚d MëaFûe"), 
NULL
, 
FALSE
, 
gë_exp‹ãr_«mes
, 
£t_Áv‹ed_exp‹ãr
, "EMF" },

232 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
FAVOR_TAB
, NULL },

235 { "grid_visibÀ", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
grid
.
visibÀ
), &
deÁu…_åue
, 
GRID_TAB
, 
N_
("Visible") },

236 { "grid_¢≠", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
grid
.
¢≠
), &
deÁu…_Ál£
, 
GRID_TAB
, 
N_
("SnapÅo") },

237 { "grid_dy«mic", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
grid
.
dy«mic
), &
deÁu…_åue
, 
GRID_TAB
, 
N_
("Dynamic gridÑesizing") },

238 { "grid_x", 
PREF_UREAL
, 
PREF_OFFSET
(
grid
.
x
), &
deÁu…_ªÆ_⁄e
, 
GRID_TAB
, 
N_
("X Size:") },

239 { "grid_y", 
PREF_UREAL
, 
PREF_OFFSET
(
grid
.
y
), &
deÁu…_ªÆ_⁄e
, 
GRID_TAB
, 
N_
("Y Size:") },

240 { "grid_cﬁour", 
PREF_COLOUR
, 
PREF_OFFSET
(
√w_dügøm
.
grid_cﬁ‹
), &
deÁu…_cﬁour
, 
GRID_TAB
, 
N_
("Color:") },

241 { "grid_maj‹", 
PREF_UINT
, 
PREF_OFFSET
(
grid
.
maj‹_löes
), &
deÁu…_maj‹_löes
, 
GRID_TAB
, 
N_
("LinesÖer majorÜine") },

242 { "grid_hex", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
grid
.
hex
), &
deÁu…_Ál£
, 
GRID_TAB
, 
N_
("Hex grid") },

243 { "grid_w", 
PREF_UREAL
, 
PREF_OFFSET
(
grid
.
w
), &
deÁu…_ªÆ_⁄e
, 
GRID_TAB
, 
N_
("Hex Size:") },

246 { "ªndî_boundög_boxes", 
PREF_BOOLEAN
,
PREF_OFFSET
(
ªndî_boundög_boxes
),

247 &
deÁu…_Ál£
,0,"ªndî boundög boxes",
NULL
, 
TRUE
},

255 { 
NULL
, 
PREF_NONE
, 0, NULL, 
TREE_TAB
, 
N_
("DiagramÅree window:") },

256 { "dügøm_åì_ßve_hiddí", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
dü_åì
.
ßve_hiddí
),

257 &
deÁu…_Ál£
, 
TREE_TAB
, 
N_
("Save hidden objectÅypes")},

258 { "dügøm_åì_dü_s‹t", 
PREF_UINT
, 
PREF_OFFSET
(
dü_åì
.
dü_s‹t
),

259 &
deÁu…_dåì_dü_s‹t
, 
TREE_TAB
, "deÁu… dügøm s‹à‹dî", 
NULL
, 
TRUE
},

260 { "dügøm_åì_obj_s‹t", 
PREF_UINT
, 
PREF_OFFSET
(
dü_åì
.
obj_s‹t
),

261 &
deÁu…_dåì_obj_s‹t
, 
TREE_TAB
, "deÁu… obje˘ s‹à‹dî", 
NULL
, 
TRUE
},

262 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
TREE_TAB
, NULL },

265 
	#NUM_PREFS_DATA
 ((
¥efs_d©a
)/(
DüPªfD©a
))

	)

267 
¥efs_¸óã_dülog
();

268 
¥efs_£t_vÆue_ö_widgë
(
GtkWidgë
 * 
widgë
, 
DüPªfD©a
 *
d©a
, 
gpoöãr
 
±r
);

269 
¥efs_gë_vÆue_‰om_widgë
(
GtkWidgë
 * 
widgë
, 
DüPªfD©a
 *
d©a
, 
gpoöãr
 
±r
);

270 
¥efs_upd©e_dülog_‰om_¥efs
();

271 
¥efs_upd©e_¥efs_‰om_dülog
();

275 
GtkWidgë
 *
	g¥efs_dülog
 = 
NULL
;

278 
	$¥efs_show
()

280 
	`¥efs_¸óã_dülog
();

281 
	`gtk_widgë_show
(
¥efs_dülog
);

283 
	`¥efs_upd©e_dülog_‰om_¥efs
();

284 
	}
}

287 
	$¥efs_£t_deÁu…s
()

289 
i
;

290 
gpoöãr
 
±r
;

295 i‡(
deÁu…_∑≥r_«me
 =
NULL
)

296 
deÁu…_∑≥r_«me
 = 
	`gë_∑≥r_«me
(
	`gë_deÁu…_∑≥r
());

298 
i
=0;i<
NUM_PREFS_DATA
;i++) {

299 
±r
 = (*)&
¥efs
 + 
¥efs_d©a
[
i
].
off£t
;

301 
¥efs_d©a
[
i
].
ty≥
) {

302 
PREF_BOOLEAN
:

303 *(*)
±r
 = *(*)
¥efs_d©a
[
i
].
deÁu…_vÆue
;

304 *(*)
±r
 = 
	`≥rsi°í˚_ªgi°î_boﬁón
(
¥efs_d©a
[
i
].
«me
, *(*)ptr);

306 
PREF_INT
:

307 
PREF_UINT
:

308 *(*)
±r
 = *(*)
¥efs_d©a
[
i
].
deÁu…_vÆue
;

309 *(*)
±r
 = 
	`≥rsi°í˚_ªgi°î_öãgî
(
¥efs_d©a
[
i
].
«me
, *(*)ptr);

311 
PREF_REAL
:

312 
PREF_UREAL
:

313 *(
ªÆ
 *)
±r
 = *‘ó»*)
¥efs_d©a
[
i
].
deÁu…_vÆue
;

314 *(
ªÆ
 *)
±r
 = 
	`≥rsi°í˚_ªgi°î_ªÆ
(
¥efs_d©a
[
i
].
«me
, *(real *)ptr);

316 
PREF_COLOUR
:

317 *(
Cﬁ‹
 *)
±r
 = *(Cﬁ‹ *)
¥efs_d©a
[
i
].
deÁu…_vÆue
;

318 *(
Cﬁ‹
 *)
±r
 = *
	`≥rsi°í˚_ªgi°î_cﬁ‹
(
¥efs_d©a
[
i
].
«me
, (Color *)ptr);

320 
PREF_CHOICE
:

321 
PREF_STRING
:

322 *(
gch¨
 **)
±r
 = *(gch¨ **)
¥efs_d©a
[
i
].
deÁu…_vÆue
;

323 *(
gch¨
 **)
±r
 = 
	`≥rsi°í˚_ªgi°î_°rög
(
¥efs_d©a
[
i
].
«me
, *(gchar **)ptr);

325 
PREF_NONE
:

326 
PREF_END_GROUP
:

330 i‡(
¥efs_d©a
[
i
].
upd©e_fun˘i⁄
)

331 (
¥efs_d©a
[
i
].
upd©e_fun˘i⁄
)(&¥efs_d©a[i], 
±r
);

333 
	`upd©e_öã∫Æ_¥efs
(&
¥efs_d©a
[
i
], 
NULL
);

334 
	}
}

337 
	$¥efs_ßve
()

339 
i
;

340 
gpoöãr
 
±r
;

341 
i
=0;i<
NUM_PREFS_DATA
;i++) {

342 i‡((
¥efs_d©a
[
i
].
ty≥
 =
PREF_NONE
Ë|| (¥efs_d©a[i].ty≥ =
PREF_END_GROUP
))

345 
±r
 = (*)&
¥efs
 + 
¥efs_d©a
[
i
].
off£t
;

347 
¥efs_d©a
[
i
].
ty≥
) {

348 
PREF_BOOLEAN
:

349 
	`≥rsi°í˚_£t_boﬁón
(
¥efs_d©a
[
i
].
«me
, *(
göt
 *)
±r
);

351 
PREF_INT
:

352 
PREF_UINT
:

353 
	`≥rsi°í˚_£t_öãgî
(
¥efs_d©a
[
i
].
«me
, *(
göt
 *)
±r
);

355 
PREF_REAL
:

356 
PREF_UREAL
:

358 
	`≥rsi°í˚_£t_ªÆ
(
¥efs_d©a
[
i
].
«me
, *(
ªÆ
 *)
±r
);

360 
PREF_COLOUR
:

361 
	`≥rsi°í˚_£t_cﬁ‹
(
¥efs_d©a
[
i
].
«me
, (
Cﬁ‹
 *)
±r
);

363 
PREF_CHOICE
:

364 
PREF_STRING
:

365 
	`≥rsi°í˚_£t_°rög
(
¥efs_d©a
[
i
].
«me
, *(
gch¨
 **)
±r
);

367 
PREF_NONE
:

368 
PREF_END_GROUP
:

372 
	}
}

377 
	$¥efs_öô
()

379 
	`¥efs_£t_deÁu…s
();

381 
ªndî_boundög_boxes
 = 
¥efs
.render_bounding_boxes;

382 
	}
}

385 
	$¥efs_£t_vÆue_ö_widgë
(
GtkWidgë
 * 
widgë
, 
DüPªfD©a
 *
d©a
,

386 
gpoöãr
 
±r
)

388 
d©a
->
ty≥
) {

389 
PREF_BOOLEAN
:

390 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
widgë
), *((*)
±r
));

392 
PREF_INT
:

393 
PREF_UINT
:

394 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
widgë
),

395 (
gÊﬂt
Ë(*((*)
±r
)));

397 
PREF_REAL
:

398 
PREF_UREAL
:

399 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
widgë
),

400 (
gÊﬂt
Ë(*((
ªÆ
 *)
±r
)));

402 
PREF_COLOUR
:

403 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
widgë
, (
Cﬁ‹
 *)
±r
);

405 
PREF_CHOICE
: {

406 
GLi°
 *
«mes
 = (
d©a
->
choi˚_li°_fun˘i⁄
)(data);

407 
ödex
;

408 *
vÆ
 = *((
gch¨
**)
±r
);

409 
ödex
 = 0; 
«mes
 !
NULL
;Çame†
	`g_li°_√xt
(names), index++) {

410 i‡(!
vÆ
 || !
	`°rcmp
(vÆ, (
gch¨
 *)
«mes
->
d©a
))

413 i‡(
«mes
 =
NULL
) ;

414 
	`gtk_combo_box_£t_a˘ive
 (
	`GTK_COMBO_BOX
 (
widgë
), 
ödex
);

417 
PREF_STRING
:

418 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
widgë
), (
gch¨
 *)(*((gch¨ **)
±r
)));

420 
PREF_NONE
:

421 
PREF_END_GROUP
:

424 
	}
}

427 
	$¥efs_gë_vÆue_‰om_widgë
(
GtkWidgë
 * 
widgë
, 
DüPªfD©a
 *
d©a
,

428 
gpoöãr
 
±r
)

430 
gboﬁón
 
ch™ged
 = 
FALSE
;

431 
d©a
->
ty≥
) {

432 
PREF_BOOLEAN
: {

433 
¥ev
 = *((*)
±r
);

434 *((*)
±r
Ë
	`GTK_TOGGLE_BUTTON
(
widgë
)->
a˘ive
;

435 
ch™ged
 = (
¥ev
 !*((*)
±r
));

438 
PREF_INT
:

439 
PREF_UINT
: {

440 
¥ev
 = *((*)
±r
);

441 *((*)
±r
Ë
	`gtk_•ö_buâ⁄_gë_vÆue_as_öt
(
	`GTK_SPIN_BUTTON
(
widgë
));

442 
ch™ged
 = (
¥ev
 !*((*)
±r
));

445 
PREF_REAL
:

446 
PREF_UREAL
: {

447 
ªÆ
 
¥ev
 = *(‘ó»*)
±r
);

448 *((
ªÆ
 *)
±r
) = (real)

449 
	`gtk_•ö_buâ⁄_gë_vÆue
 (
	`GTK_SPIN_BUTTON
(
widgë
));

450 
ch™ged
 = (
¥ev
 !*((
ªÆ
 *)
±r
));

453 
PREF_COLOUR
: {

454 
Cﬁ‹
 
¥ev
 = *(Cﬁ‹ *)
±r
;

455 
	`dü_cﬁ‹_£À˘‹_gë_cﬁ‹
(
widgë
, (
Cﬁ‹
 *)
±r
);

456 
ch™ged
 = 
	`memcmp
 (&
¥ev
, 
±r
, (
Cﬁ‹
));

459 
PREF_CHOICE
: {

460 
ödex
 = 
	`gtk_combo_box_gë_a˘ive
 (
	`GTK_COMBO_BOX
 (
widgë
));

461 
GLi°
 *
«mes
 = (
d©a
->
choi˚_li°_fun˘i⁄
)(data);

462 *((
gch¨
 **)
±r
Ë
	`g_°rdup
((gch¨ *)
	`g_li°_¡h_d©a
(
«mes
, 
ödex
));

464 
ch™ged
 = 
TRUE
;

467 
PREF_STRING
:

468 *((
gch¨
 **)
±r
Ë(gch¨ *)
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
widgë
));

470 
ch™ged
 = 
TRUE
;

472 
PREF_NONE
:

473 
PREF_END_GROUP
:

476 i‡(
ch™ged
 && 
d©a
->
upd©e_fun˘i⁄
 !
NULL
) {

477 (
d©a
->
upd©e_fun˘i⁄
)(d©a, 
±r
);

479 
	}
}

482 
	$¥efs_boﬁón_toggÀ
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

484 
guöt
 
a˘ive
 = 
	`GTK_TOGGLE_BUTTON
(
widgë
)->active;

485 
	`gtk_buâ⁄_£t_œbñ
(
	`GTK_BUTTON
(
widgë
), 
a˘ive
 ? 
	`_
("Yes") : _("No"));

486 
	}
}

488 
GtkWidgë
 *

489 
	$¥efs_gë_¥›îty_widgë
(
DüPªfD©a
 *
d©a
)

491 
GtkWidgë
 *
widgë
 = 
NULL
;

492 
GtkAdju°mít
 *
adj
;

494 
d©a
->
ty≥
) {

495 
PREF_BOOLEAN
:

496 
widgë
 = 
	`gtk_toggÀ_buâ⁄_√w_wôh_œbñ
 (
	`_
("No"));

497 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
widgë
), "toggled",

498 
	`G_CALLBACK
 (
¥efs_boﬁón_toggÀ
), 
NULL
);

500 
PREF_INT
:

501 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(0.0,

502 
G_MININT
, 
G_MAXINT
,

504 
widgë
 = 
	`gtk_•ö_buâ⁄_√w
 (
adj
, 1.0, 0);

505 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
widgë
), 
TRUE
);

506 
	`gtk_widgë_£t_size_ªque°
 (
widgë
, 80, -1);

508 
PREF_UINT
:

509 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(0.0,

510 0.0, 
G_MAXINT
,

512 
widgë
 = 
	`gtk_•ö_buâ⁄_√w
 (
adj
, 1.0, 0);

513 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
widgë
), 
TRUE
);

514 
	`gtk_widgë_£t_size_ªque°
 (
widgë
, 80, -1);

516 
PREF_REAL
:

517 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(0.0,

518 
G_MINFLOAT
, 
G_MAXFLOAT
,

520 
widgë
 = 
	`gtk_•ö_buâ⁄_√w
 (
adj
, 1.0, 3);

521 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
widgë
), 
TRUE
);

522 
	`gtk_widgë_£t_size_ªque°
 (
widgë
, 80, -1);

524 
PREF_UREAL
:

525 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(0.0,

526 0.0, 
G_MAXFLOAT
,

528 
widgë
 = 
	`gtk_•ö_buâ⁄_√w
 (
adj
, 1.0, 3);

529 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
widgë
), 
TRUE
);

530 
	`gtk_widgë_£t_size_ªque°
 (
widgë
, 80, -1);

532 
PREF_COLOUR
:

533 
widgë
 = 
	`dü_cﬁ‹_£À˘‹_√w
();

535 
PREF_STRING
:

536 
widgë
 = 
	`gtk_íåy_√w
();

538 
PREF_CHOICE
: {

539 
GLi°
 *
«mes
;

540 
widgë
 = 
	`gtk_combo_box_√w_ãxt
 ();

541 
«mes
 = (
d©a
->
choi˚_li°_fun˘i⁄
)(data);

542 
«mes
 !
NULL
;

543 
«mes
 = 
	`g_li°_√xt
(names)) {

544 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
widgë
), (
gch¨
 *)
«mes
->
d©a
);

548 
PREF_NONE
:

549 
PREF_END_GROUP
:

550 
widgë
 = 
NULL
;

553 i‡(
widgë
 !
NULL
)

554 
	`gtk_widgë_show
(
widgë
);

555  
widgë
;

556 
	}
}

558 
göt


559 
	$¥efs_ª•⁄d
(
GtkWidgë
 *
widgë
,

560 
göt
 
ª•⁄£_id
,

561 
gpoöãr
 
d©a
)

563 i‡–
ª•⁄£_id
 =
GTK_RESPONSE_APPLY


564 || 
ª•⁄£_id
 =
GTK_RESPONSE_OK
) {

565 
	`¥efs_upd©e_¥efs_‰om_dülog
();

566 
	`¥efs_ßve
();

567 
	`dügøm_ªdøw_Æl
();

570 i‡(
ª•⁄£_id
 !
GTK_RESPONSE_APPLY
)

571 
	`gtk_widgë_hide
(
widgë
);

574 
	}
}

577 
	$¥efs_¸óã_dülog
()

579 
GtkWidgë
 *
œbñ
;

580 
GtkWidgë
 *
dülog_vbox
;

581 
GtkWidgë
 *
nŸebook
;

582 
GtkTabÀ
 *
t›_èbÀ
 = 
NULL
;

583 
GtkTabÀ
 *
cuºít_èbÀ
 = 
NULL
;

584 
i
;

585 
èb_idx
 = -1;

587 i‡(
¥efs_dülog
 !
NULL
)

590 
¥efs_dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
(

591 
	`_
("Preferences"),

592 
	`GTK_WINDOW
(
	`öãrÁ˚_gë_toﬁbox_shñl
()),

593 
GTK_DIALOG_DESTROY_WITH_PARENT
,

594 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

595 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

596 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

597 
NULL
);

598 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
(
¥efs_dülog
), 
GTK_RESPONSE_OK
);

599 
	`gtk_wödow_£t_ªsizabÀ
 (
	`GTK_WINDOW
 (
¥efs_dülog
), 
TRUE
);

601 
dülog_vbox
 = 
	`GTK_DIALOG
 (
¥efs_dülog
)->
vbox
;

603 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
¥efs_dülog
), "preferences_window");

605 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
¥efs_dülog
), "response",

606 
	`G_CALLBACK
 (
¥efs_ª•⁄d
), 
NULL
);

608 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
¥efs_dülog
), "delete_event",

609 
	`G_CALLBACK
(
gtk_widgë_hide
), 
NULL
);

610 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
¥efs_dülog
), "destroy",

611 
	`G_CALLBACK
(
gtk_widgë_de°royed
), &
¥efs_dülog
);

613 
nŸebook
 = 
	`gtk_nŸebook_√w
 ();

614 
	`gtk_nŸebook_£t_èb_pos
 (
	`GTK_NOTEBOOK
 (
nŸebook
), 
GTK_POS_TOP
);

615 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
dülog_vbox
), 
nŸebook
, 
TRUE
, TRUE, 0);

616 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
nŸebook
), 2);

617 
	`gtk_widgë_show
 (
nŸebook
);

619 
i
=0;i<
NUM_PREFS_TABS
;i++) {

620 
GtkWidgë
 *
èbÀ
;

621 
GtkWidgë
 *
nŸebook_∑ge
;

623 
œbñ
 = 
	`gtk_œbñ_√w
(
	`gëãxt
(
¥efs_èbs
[
i
].
tôÀ
));

624 
	`gtk_widgë_show
(
œbñ
);

626 
èbÀ
 = 
	`gtk_èbÀ_√w
 (9, 2, 
FALSE
);

627 
¥efs_èbs
[
i
].
èbÀ
 = 
	`GTK_TABLE
(table);

628 
	`gtk_widgë_£t_size_ªque°
(
èbÀ
, -1, -1);

629 
	`gtk_widgë_show
(
èbÀ
);

631 #ifde‡
SCROLLED_PAGES


632 
nŸebook_∑ge
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

633 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
nŸebook_∑ge
),

634 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

635 
	`gtk_widgë_show
(
nŸebook_∑ge
);

637 
nŸebook_∑ge
 = 
èbÀ
;

640 
	`gtk_nŸebook_≠≥nd_∑ge
(
	`GTK_NOTEBOOK
(
nŸebook
), 
nŸebook_∑ge
, 
œbñ
);

642 #ifde‡
SCROLLED_PAGES


643 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
(
	`GTK_SCROLLED_WINDOW
(
nŸebook_∑ge
),

644 
èbÀ
);

645 
	`gtk_võwp‹t_£t_shadow_ty≥
(
	`GTK_VIEWPORT
(
	`GTK_BIN
(
nŸebook_∑ge
)->
chûd
),

646 
GTK_SHADOW_NONE
);

650 
	`gtk_nŸebook_£t_èb_pos
(
	`GTK_NOTEBOOK
(
nŸebook
), 
GTK_POS_LEFT
);

652 
èb_idx
 = -1;

653 
i
=0;i<
NUM_PREFS_DATA
;i++) {

654 
GtkWidgë
 *
widgë
 = 
NULL
;

655 
row
;

657 i‡(
¥efs_d©a
[
i
].
hiddí
)

660 i‡(
èb_idx
 !
¥efs_d©a
[
i
].
èb
) {

661 
èb_idx
 = 
¥efs_d©a
[
i
].
èb
;

662 
t›_èbÀ
 = 
¥efs_èbs
[
¥efs_d©a
[
i
].
èb
].
èbÀ
;

663 
cuºít_èbÀ
 = 
t›_èbÀ
;

665 
row
 = 
¥efs_èbs
[
èb_idx
].row++;

666 
¥efs_d©a
[
i
].
ty≥
) {

667 
PREF_NONE
:

668 
widgë
 = 
	`gtk_‰ame_√w
(
	`gëãxt
(
¥efs_d©a
[
i
].
œbñ_ãxt
));

669 
	`gtk_widgë_show
 (
widgë
);

670 
	`gtk_èbÀ_©èch
 (
cuºít_èbÀ
, 
widgë
, 0, 2,

671 
row
,Ñow + 1,

672 
GTK_FILL
 | 
GTK_EXPAND
, GTK_FILL, 1, 1);

673 
cuºít_èbÀ
 = 
	`GTK_TABLE
(
	`gtk_èbÀ_√w
 (9, 2, 
FALSE
));

674 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
widgë
), 
	`GTK_WIDGET
(
cuºít_èbÀ
));

675 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
cuºít_èbÀ
));

677 
PREF_END_GROUP
:

678 
cuºít_èbÀ
 = 
t›_èbÀ
;

680 
PREF_BOOLEAN
:

681 
widgë
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
 (
	`gëãxt
(
¥efs_d©a
[
i
].
œbñ_ãxt
));

682 
	`gtk_widgë_show
 (
widgë
);

683 
	`gtk_èbÀ_©èch
 (
cuºít_èbÀ
, 
widgë
, 0, 2,

684 
row
,Ñow + 1,

685 
GTK_FILL
 | 
GTK_EXPAND
, GTK_FILL, 1, 1);

688 
œbñ
 = 
	`gtk_œbñ_√w
 (
	`gëãxt
(
¥efs_d©a
[
i
].
œbñ_ãxt
));

689 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.3);

690 
	`gtk_widgë_show
 (
œbñ
);

692 
	`gtk_èbÀ_©èch
 (
cuºít_èbÀ
, 
œbñ
, 0, 1,

693 
row
,Ñow + 1,

694 
GTK_FILL
 | 
GTK_EXPAND
, GTK_FILL, 1, 1);

696 
widgë
 = 
	`¥efs_gë_¥›îty_widgë
(&
¥efs_d©a
[
i
]);

697 i‡(
widgë
 !
NULL
) {

698 
	`gtk_èbÀ_©èch
 (
cuºít_èbÀ
, 
widgë
, 1, 2,

699 
row
,Ñow + 1,

700 
GTK_FILL
, GTK_FILL, 1, 1);

704 
¥efs_d©a
[
i
].
widgë
 = widget;

708 
	`gtk_widgë_show
 (
¥efs_dülog
);

709 
	}
}

712 
	$¥efs_upd©e_¥efs_‰om_dülog
()

714 
GtkWidgë
 *
widgë
;

715 
i
;

716 
gpoöãr
 
±r
;

718 
i
=0;i<
NUM_PREFS_DATA
;i++) {

719 i‡(
¥efs_d©a
[
i
].
hiddí
) ;

720 
widgë
 = 
¥efs_d©a
[
i
].widget;

721 
±r
 = (*)&
¥efs
 + 
¥efs_d©a
[
i
].
off£t
;

723 
	`¥efs_gë_vÆue_‰om_widgë
(
widgë
, &
¥efs_d©a
[
i
], 
±r
);

725 
	}
}

728 
	$¥efs_upd©e_dülog_‰om_¥efs
()

730 
GtkWidgë
 *
widgë
;

731 
i
;

732 
gpoöãr
 
±r
;

734 
i
=0;i<
NUM_PREFS_DATA
;i++) {

735 i‡(
¥efs_d©a
[
i
].
hiddí
) ;

736 
widgë
 = 
¥efs_d©a
[
i
].widget;

737 
±r
 = (*)&
¥efs
 + 
¥efs_d©a
[
i
].
off£t
;

739 
	`¥efs_£t_vÆue_ö_widgë
(
widgë
, &
¥efs_d©a
[
i
], 
±r
);

741 
	}
}

747 
	$upd©e_öã∫Æ_¥efs
(
DüPªfD©a
 *
¥ef
, 
gpoöãr
 
±r
)

749 *
vÆ
 = 
NULL
;

751 i‡(!
±r
)

753 
vÆ
 = *(**)
±r
;

754 i‡(
¥efs
.
Àngth_unô
)

755 
	`¥efs_£t_Àngth_unô
(
¥efs
.
Àngth_unô
);

756 i‡(
¥efs
.
f⁄tsize_unô
)

757 
	`¥efs_£t_f⁄tsize_unô
(
¥efs
.
f⁄tsize_unô
);

758 
	}
}

761 
	$upd©e_Êﬂtög_toﬁbox
(
DüPªfD©a
 *
¥ef
, 
gpoöãr
 
±r
)

763 
	`g_ªtu∫_if_Áû
 (
¥ef
->
key
 =
NULL
);

765 i‡(!
	`≠p_is_öãø˘ive
())

768 i‡(
¥efs
.
toﬁbox_⁄_t›
) {

770 
GLi°
 *
dügøms
;

771 
dügøms
 = 
	`dü_›í_dügøms
(); dügøm†!
NULL
;

772 
dügøms
 = 
	`g_li°_√xt
(diagrams)) {

773 
Dügøm
 *
dügøm
 = (Dügøm *)
dügøms
->
d©a
;

774 
GSLi°
 *
di•œys
;

775 
di•œys
 = 
dügøm
->di•œys; di•œy†!
NULL
;

776 
di•œys
 = 
	`g_¶i°_√xt
(displays)) {

777 
DDi•œy
 *
ddi•
 = (DDi•œy *)
di•œys
->
d©a
;

778 
	`gtk_wödow_£t_å™sõ¡_f‹
(
	`GTK_WINDOW
(
	`öãrÁ˚_gë_toﬁbox_shñl
()),

779 
	`GTK_WINDOW
(
ddi•
->
shñl
));

783 
GtkWödow
 *
shñl
 = 
	`GTK_WINDOW
(
	`öãrÁ˚_gë_toﬁbox_shñl
());

784 i‡(
shñl
)

785 
	`gtk_wödow_£t_å™sõ¡_f‹
(
shñl
, 
NULL
);

787 
	}
}

	@O:\tool\dvs50\app\preferences.h

18 #i‚de‡
PREFERENCES_H


19 
	#PREFERENCES_H


	)

21 
	~"geomëry.h
"

22 
	~"cﬁ‹.h
"

23 
	~"dügøm_åì_wödow.h
"

24 
	~"dügømd©a.h
"

25 
	~"lib/widgës.h
"

27 
	#DEFAULT_GRID_COLOR
 { 0.85, .90, .90 }

	)

28 
	#DEFAULT_PAGEBREAK_COLOR
 { 0.0, 0.0, 0.6 }

	)

30 
	sDüPª„ªn˚s
 {

32 
	mvisibÀ
;

33 
	m¢≠
;

34 
gboﬁón
 
	mdy«mic
;

35 
ªÆ
 
	mx
;

36 
ªÆ
 
	my
;

37 
	mmaj‹_löes
;

38 
	mhex
;

39 
ªÆ
 
	mw
;

40 } 
	mgrid
;

43 
	mwidth
;

44 
	mheight
;

45 
ªÆ
 
	mzoom
;

46 
	mu£_míu_b¨
;

47 } 
	m√w_võw
;

49 
NewDügømD©a
 
	m√w_dügøm
;

51 
	mshow_cx_±s
;

52 
	m¢≠_obje˘
;

53 
	mvõw_™tüli£d
;

55 
	mª£t_toﬁs_a·î_¸óã
;

56 
	mundo_dïth
;

57 
	mªvî£_rubbîb™dög_öãr£˘s
;

58 
guöt
 
	mª˚¡_documíts_li°_size
;

60 
gch¨
* 
	mÀngth_unô
;

61 
gch¨
* 
	mf⁄tsize_unô
;

64 
	mvisibÀ
;

65 
	msﬁid
;

66 } 
	m∑gebªak
;

68 
	mªndî_boundög_boxes
;

70 
	mtoﬁbox_⁄_t›
;

72 
DügømTªeC⁄fig
 
	mdü_åì
;

74 
	mu£_öãgøãd_ui
;

78 *
	m≤g
;

79 *
	msvg
;

80 *
	mps
;

81 *
	mwmf
;

82 *
	memf
;

83 *
	m¥öt
;

84 } 
	mÁv‹ed_fûãr
;

87 
DüPª„ªn˚s
 
¥efs
;

89 
¥efs_show
();

90 
¥efs_£t_deÁu…s
();

91 
¥efs_ßve
();

92 
¥efs_öô
();

	@O:\tool\dvs50\app\properties-dialog.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<gtk/gtk.h
>

24 
	~<gdk/gdkkeysyms.h
>

26 
	~"öé.h
"

27 
	~"¥›îtõs-dülog.h
"

28 
	~"obje˘_›s.h
"

29 
	~"c⁄√˘i⁄poöt_›s.h
"

30 
	~"undo.h
"

31 
	~"mesßge.h
"

32 
	~<°rög.h
>

34 
GtkWidgë
 *
	gdülog
 = 
NULL
;

35 
GtkWidgë
 *
	gdülog_vbox
 = 
NULL
;

36 
GtkWidgë
 *
	gobje˘_∑π
 = 
NULL
;

37 
GLi°
 *
	gcuºít_obje˘s
 = 
NULL
;

38 
Dügøm
 *
	gcuºít_dü
 = 
NULL
;

40 
GtkWidgë
 *
	gno_¥›îtõs_dülog
 = 
NULL
;

42 
göt
 
¥›îtõs_ª•⁄d
(
GtkWidgë
 *
widgë
,

43 
göt
 
ª•⁄£_id
,

44 
gpoöãr
 
d©a
);

45 
gboﬁón
 
¥›îtõs_key_evít
(
GtkWidgë
 *
widgë
,

46 
GdkEvítKey
 *
evít
,

47 
gpoöãr
 
d©a
);

48 
¥›îtõs_dülog_hide
();

50 
	$¸óã_dülog
()

55 
dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
(

56 
	`_
("ObjectÖroperties"),

57 
	`GTK_WINDOW
 (
	`ddi•œy_a˘ive
()->
shñl
),

58 
GTK_DIALOG_DESTROY_WITH_PARENT
,

59 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

60 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

61 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

62 
NULL
);

64 
	`gtk_dülog_£t_deÁu…_ª•⁄£
 (
	`GTK_DIALOG
(
dülog
), 
GTK_RESPONSE_OK
);

66 
dülog_vbox
 = 
	`GTK_DIALOG
(
dülog
)->
vbox
;

68 
	`gtk_wödow_£t_rﬁe
(
	`GTK_WINDOW
 (
dülog
), "properties_window");

70 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
dülog
), "response",

71 
	`G_CALLBACK
 (
¥›îtõs_ª•⁄d
), 
NULL
);

72 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
dülog
), "delete_event",

73 
	`G_CALLBACK
(
¥›îtõs_dülog_hide
), 
NULL
);

74 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
dülog
), "destroy",

75 
	`G_CALLBACK
(
gtk_widgë_de°royed
), &
dülog
);

76 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
dülog
), "destroy",

77 
	`G_CALLBACK
(
gtk_widgë_de°royed
), &
dülog_vbox
);

78 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
 (
dülog
), "key-release-event",

79 
	`G_CALLBACK
(
¥›îtõs_key_evít
), 
NULL
);

81 
no_¥›îtõs_dülog
 = 
	`gtk_œbñ_√w
(
	`_
("This object hasÇoÖroperties."));

82 
	`gtk_widgë_show
 (
no_¥›îtõs_dülog
);

83 #i‡
	`GLIB_CHECK_VERSION
(2,10,0)

84 
	`g_obje˘_ªf_sök
 (
	`G_OBJECT
 (
no_¥›îtõs_dülog
));

86 
	`g_obje˘_ªf
 (
	`G_OBJECT
 (
no_¥›îtõs_dülog
));

87 
	`gtk_obje˘_sök
 (
	`GTK_OBJECT
 (
no_¥›îtõs_dülog
));

90 
	}
}

93 
göt


94 
	$¥›îtõs_∑π_de°royed
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

96 i‡(
widgë
 =
obje˘_∑π
) {

97 
obje˘_∑π
 = 
NULL
;

98 
cuºít_obje˘s
 = 
NULL
;

99 
cuºít_dü
 = 
NULL
;

102 
	}
}

104 
gboﬁón


105 
	$¥›îtõs_key_evít
(
GtkWidgë
 *
widgë
, 
GdkEvítKey
 *
evít
, 
gpoöãr
 
d©a
)

120  
FALSE
;

121 
	}
}

123 
göt


124 
	$¥›îtõs_ª•⁄d
(
GtkWidgë
 *
widgë
,

125 
göt
 
ª•⁄£_id
,

126 
gpoöãr
 
d©a
)

128 
Obje˘Ch™ge
 *
obj_ch™ge
 = 
NULL
;

129 
gboﬁón
 
£t_ç
 = 
TRUE
;

130 
GLi°
 *
tmp
;

132 i‡–
ª•⁄£_id
 =
GTK_RESPONSE_APPLY


133 || 
ª•⁄£_id
 =
GTK_RESPONSE_OK
) {

134 i‡((
cuºít_obje˘s
 !
NULL
Ë&& (
cuºít_dü
 != NULL)) {

135 
	`obje˘_add_upd©es_li°
(
cuºít_obje˘s
, 
cuºít_dü
);

137 
tmp
 = 
cuºít_obje˘s
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

138 
DüObje˘
 *
cuºít_obj
 = (DüObje˘*)
tmp
->
d©a
;

139 
obj_ch™ge
 = 
cuºít_obj
->
›s
->
	`≠∂y_¥›îtõs_‰om_dülog
(cuºít_obj, 
obje˘_∑π
);

140 
	`obje˘_add_upd©es
(
cuºít_obj
, 
cuºít_dü
);

141 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
cuºít_dü
, 
cuºít_obj
, 
TRUE
);

143 i‡(
obj_ch™ge
 !
NULL
) {

144 
	`undo_obje˘_ch™ge
(
cuºít_dü
, 
cuºít_obj
, 
obj_ch™ge
);

145 
£t_ç
 = së_ç && 
TRUE
;

147 
£t_ç
 = 
FALSE
;

149 
	`dügøm_obje˘_modifõd
(
cuºít_dü
, 
cuºít_obj
);

152 
	`dügøm_modifõd
(
cuºít_dü
);

153 
	`dügøm_upd©e_exã¡s
(
cuºít_dü
);

155 i‡(
£t_ç
) {

156 
	`undo_£t_å™ß˘i⁄poöt
(
cuºít_dü
->
undo
);

158 
	`mesßge_w¨nög
(
	`_
("This object doesn't support Undo/Redo.\n"

160 
	`undo_˛ór
(
cuºít_dü
->
undo
);

163 
	`dügøm_Êush
(
cuºít_dü
);

167 i‡(
ª•⁄£_id
 !
GTK_RESPONSE_APPLY
) {

168 #ifde‡
G_OS_WIN32


171 
	`gtk_widgë_de°roy
 (
dülog
);

173 
	`¥›îtõs_dülog_hide
();

178 
	}
}

184 
	$¥›îtõs_give_focus
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

186 i‡(
	`GTK_WIDGET_CAN_FOCUS
(
widgë
)) {

187 
	`gtk_widgë_gøb_focus
(
widgë
);

189 i‡(
	`GTK_IS_CONTAINER
(
widgë
)) {

190 
	`gtk_c⁄èöî_f‹óch
(
	`GTK_CONTAINER
(
widgë
), 
¥›îtõs_give_focus
, 
d©a
);

193 
	}
}

196 
	$˛ór_dülog_globÆs
()

198 i‡(
obje˘_∑π
 !
NULL
) {

199 
	`gtk_c⁄èöî_ªmove
(
	`GTK_CONTAINER
(
dülog_vbox
), 
obje˘_∑π
);

200 
obje˘_∑π
 = 
NULL
;

202 
	`g_li°_‰ì
(
cuºít_obje˘s
);

203 
cuºít_obje˘s
 = 
NULL
;

204 
cuºít_dü
 = 
NULL
;

205 
	}
}

208 
	$obje˘_¥›îtõs_show
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
)

210 
GLi°
 *
tmp
 = 
NULL
;

211 
tmp
 = 
	`g_li°_≠≥nd
—mp, 
obj
);

212 
	`obje˘_li°_¥›îtõs_show
(
dü
, 
tmp
);

213 
	`g_li°_‰ì
(
tmp
);

214 
	}
}

217 
	$obje˘_li°_¥›îtõs_show
(
Dügøm
 *
dü
, 
GLi°
 *
obje˘s
)

219 
GtkWidgë
 *
¥›îtõs
;

220 
DüObje˘
 *
⁄e_obj
;

225 i‡(!
dülog
)

226 
	`¸óã_dülog
();

227 
	`˛ór_dülog_globÆs
();

230 i‡(!
obje˘s
) {

232 
	`¥›îtõs_dülog_hide
();

237 
⁄e_obj
 = (
	`g_li°_Àngth
(
obje˘s
Ë=1Ë? obje˘s->
d©a
 : 
NULL
;

239 i‡(
⁄e_obj
)

240 
¥›îtõs
 = 
⁄e_obj
->
›s
->
	`gë_¥›îtõs
(⁄e_obj, 
FALSE
);

242 
¥›îtõs
 = 
	`obje˘_li°_¸óã_¥›s_dülog
(
⁄e_obj
, 
FALSE
);

243 i‡(
¥›îtõs
 =
NULL
) {

244 
¥›îtõs
 = 
no_¥›îtõs_dülog
;

247 i‡(
⁄e_obj
) {

248 
DüObje˘Ty≥
 *
Ÿy≥
 = 
⁄e_obj
->
ty≥
;

249 
gch¨
 *
buf
;

251 
buf
 = 
	`g_°rc⁄ˇt
(
	`_
("Pr›îtõs: "), 
Ÿy≥
->
«me
, 
NULL
);

252 
	`gtk_wödow_£t_tôÀ
(
	`GTK_WINDOW
(
dülog
), 
	`gtk_widgë_gë_«me
(
¥›îtõs
));

253 
	`g_‰ì
(
buf
);

255 
	`gtk_wödow_£t_tôÀ
(
	`GTK_WINDOW
(
dülog
),
	`gtk_widgë_gë_«me
(
¥›îtõs
));

258 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
¥›îtõs
), "destroy",

259 
	`G_CALLBACK
(
¥›îtõs_∑π_de°royed
), 
NULL
);

260 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
dülog_vbox
), 
¥›îtõs
, 
TRUE
, TRUE, 0);

262 
	`gtk_widgë_show
 (
¥›îtõs
);

264 
	`¥›îtõs_give_focus
(
¥›îtõs
, 
NULL
);

268 
	`gtk_wödow_ªsize
 (
	`GTK_WINDOW
(
dülog
), 1, 1);

269 
	`gtk_wödow_£t_å™sõ¡_f‹
(
	`GTK_WINDOW
(
dülog
),

270 
	`GTK_WINDOW
 (
	`ddi•œy_a˘ive
()->
shñl
));

271 
	`gtk_wödow_¥e£¡
 (
	`GTK_WINDOW
 (
dülog
));

272 
obje˘_∑π
 = 
¥›îtõs
;

273 
cuºít_obje˘s
 = 
	`g_li°_c›y
(
obje˘s
);

274 
cuºít_dü
 = 
dü
;

275 
	}
}

278 
	$¥›îtõs_dülog_hide
()

280 i‡(!
dülog
)

282 
	`˛ór_dülog_globÆs
();

283 
	`gtk_widgë_hide
(
dülog
);

284 
	}
}

287 
	$¥›îtõs_hide_if_shown
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
)

289 i‡(
	`g_li°_föd
(
cuºít_obje˘s
, 
obj
)) {

290 i‡(
	`g_li°_Àngth
(
cuºít_obje˘s
) == 1)

292 
	`¥›îtõs_dülog_hide
();

295 
GLi°
 *
tmp
 = 
	`g_li°_c›y
(
cuºít_obje˘s
);

296 
tmp
 = 
	`g_li°_ªmove
—mp, 
obj
);

297 
	`obje˘_li°_¥›îtõs_show
(
dü
, 
tmp
);

298 
	`g_li°_‰ì
(
tmp
);

301 
	}
}

304 
	$¥›îtõs_upd©e_if_shown
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
)

309 i‡(
	`g_li°_Àngth
(
cuºít_obje˘s
) != 1)

314 
	`obje˘_¥›îtõs_show
(
dü
, (
DüObje˘
*)
cuºít_obje˘s
->
d©a
);

316 
	}
}

	@O:\tool\dvs50\app\properties-dialog.h

18 #i‚de‡
PROPERTIES_H


19 
	#PROPERTIES_H


	)

21 
	~"obje˘.h
"

22 
	~"dügøm.h
"

24 
obje˘_¥›îtõs_show
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
);

25 
obje˘_li°_¥›îtõs_show
(
Dügøm
 *
dü
, 
GLi°
 *
obje˘s
);

26 
¥›îtõs_upd©e_if_shown
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
);

27 
¥›îtõs_hide_if_shown
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
);

	@O:\tool\dvs50\app\recent_files.c

22 #ifde‡
HAVE_CONFIG_H


23 
	~<c⁄fig.h
>

26 #ifde‡
GNOME


27 #unde‡
GTK_DISABLE_DEPRECATED


28 
	~<gnome.h
>

30 
	~<gdk/gdkkeysyms.h
>

33 
	~<glib.h
>

34 
	~<gtk/gtk.h
>

35 
	~<°dio.h
>

36 
	~<°rög.h
>

38 
	~"dü_dús.h
"

39 
	~"ª˚¡_fûes.h
"

40 
	~"míus.h
"

41 
	~"dügøm.h
"

42 
	~"di•œy.h
"

43 
	~"öãrÁ˚.h
"

44 
	~"œyî_dülog.h
"

45 
	~"¥e„ªn˚s.h
"

46 
	~"../lib/fûãr.h
"

47 
	~"../lib/öé.h
"

48 
	~"mesßge.h
"

49 
	~"≥rsi°í˚.h
"

51 
›í_ª˚¡_fûe_ˇŒback
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
);

52 
ª˚¡_fûe_hi°‹y_ªmove
 (c⁄° *
‚ame
);

55 
	$ª˚¡_fûe_hi°‹y_˛ór_míu
()

57 
	`míus_˛ór_ª˚¡
 ();

58 
	}
}

64 
	$ª˚¡_fûe_hi°‹y_make_míu
()

66 
GLi°
 *
ôems
;

67 
GtkA˘i⁄Group
 *
group
;

68 
GtkA˘i⁄
 *
a˘i⁄
;

69 
göt
 
i
 = 0;

71 
ôems
 = 
	`≥rsi°ít_li°_gë_gli°
 ("recent-files");

72 i‡(!
ôems
)

75 
group
 = 
	`gtk_a˘i⁄_group_√w
 ("recent-files");

76 
	`gtk_a˘i⁄_group_£t_å™¶©i⁄_domaö
 (
group
, 
NULL
);

78 
i
 = 0;

79 
ôems
 !
NULL
 && 
i
 < 
¥efs
.
ª˚¡_documíts_li°_size
;

80 
ôems
 = 
	`g_li°_√xt
(ôems), 
i
++) {

82 
gch¨
 *
«me
 = 
	`g_°rdup_¥ötf
 ("FûeRe˚¡_%d", 
i
);

83 
gch¨
 *
fûe
 = 
	`g_∑th_gë_ba£«me
 ((c⁄° gch¨ *Ë
ôems
->
d©a
);

84 
gch¨
 **
•lô
 = 
	`g_°r•lô
 (
fûe
, "_", -1);

85 
gch¨
 *
fûe_esˇ≥d
 = 
	`g_°rjoöv
 ("__", 
•lô
);

86 
gch¨
 *
œbñ
 = 
	`g_°rdup_¥ötf
 ("_%d. %s", 
i
 + 1, 
fûe_esˇ≥d
);

87 
gch¨
 *
ac˚l
 = 
	`g_°rdup_¥ötf
 ("<c⁄åﬁ>%d", 
i
 + 1);

89 
a˘i⁄
 = 
	`gtk_a˘i⁄_√w
 (
«me
, 
œbñ
,

90 (c⁄° 
gch¨
 *Ë
ôems
->
d©a
,

91 
NULL
);

92 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
a˘i⁄
), "activate",

93 
	`G_CALLBACK
 (
›í_ª˚¡_fûe_ˇŒback
),

94 
ôems
->
d©a
);

96 
	`gtk_a˘i⁄_group_add_a˘i⁄_wôh_ac˚l
 (
group
, 
a˘i⁄
, 
ac˚l
);

98 
	`g_‰ì
 (
«me
);

99 
	`g_‰ì
 (
fûe
);

100 
	`g_°r‰ìv
 (
•lô
);

101 
	`g_‰ì
 (
fûe_esˇ≥d
);

102 
	`g_‰ì
 (
œbñ
);

103 
	`g_‰ì
 (
ac˚l
);

105 
	`míus_£t_ª˚¡
 (
group
);

106 
	}
}

113 
	$ª˚¡_fûe_hi°‹y_add
(c⁄° *
‚ame
)

115 
gch¨
 *
ab¢ame
 = 
	`dü_gë_absﬁuã_fûíame
(
‚ame
);

116 
gch¨
 *
fûíame
 = 
	`g_fûíame_to_utf8
(
ab¢ame
, -1, 
NULL
, NULL, NULL);

117 
	`ª˚¡_fûe_hi°‹y_˛ór_míu
();

118 
	`≥rsi°ít_li°_add
("ª˚¡-fûes", 
fûíame
);

119 
	`g_‰ì
(
ab¢ame
);

120 
	`g_‰ì
(
fûíame
);

122 
	`ª˚¡_fûe_hi°‹y_make_míu
();

123 
	}
}

127 
	$ª˚¡_fûe_hi°‹y_öô
()

129 
¥efs
.
ª˚¡_documíts_li°_size
 = 
	`CLAMP
(prefs.recent_documents_list_size, 0, 16);

131 
	`≥rsi°í˚_ªgi°î_li°
("recent-files");

133 
	`ª˚¡_fûe_hi°‹y_make_míu
();

134 
	}
}

139 
	$ª˚¡_fûe_hi°‹y_ªmove
 (c⁄° *
‚ame
)

141 
gch¨
 *
ab¢ame
 = 
	`dü_gë_absﬁuã_fûíame
(
‚ame
);

142 
gch¨
 *
fûíame
 = 
	`g_fûíame_to_utf8
(
ab¢ame
, -1, 
NULL
, NULL, NULL);

144 
	`ª˚¡_fûe_hi°‹y_˛ór_míu
();

146 
	`≥rsi°ít_li°_ªmove
("ª˚¡-fûes", 
fûíame
);

147 
	`g_‰ì
(
ab¢ame
);

148 
	`g_‰ì
(
fûíame
);

150 
	`ª˚¡_fûe_hi°‹y_make_míu
();

151 
	}
}

154 
	$›í_ª˚¡_fûe_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

156 
DüImp‹tFûãr
 *
ifûãr
 = 
NULL
;

157 
Dügøm
 *
dügøm
 = 
NULL
;

158 
gch¨
 *
fûíame
 = 
	`g_fûíame_‰om_utf8
((gch¨ *)
d©a
, -1, 
NULL
, NULL, NULL);

160 
ifûãr
 = 
	`fûãr_guess_imp‹t_fûãr
(
fûíame
);

162 
dügøm
 = 
	`dügøm_lﬂd
(
fûíame
, 
ifûãr
);

163 i‡(
dügøm
 !
NULL
) {

164 
	`dügøm_upd©e_exã¡s
(
dügøm
);

165 
	`œyî_dülog_£t_dügøm
(
dügøm
);

166 i‡(
dügøm
->
di•œys
 =
NULL
) {

167 
	`√w_di•œy
(
dügøm
);

170 
	`ª˚¡_fûe_hi°‹y_ªmove
 (
fûíame
);

171 
	`g_‰ì
(
fûíame
);

172 
	}
}

	@O:\tool\dvs50\app\recent_files.h

22 #i‚de‡
RECENT_FILES_H


23 
	#RECENT_FILES_H


	)

25 
ª˚¡_fûe_hi°‹y_add
(c⁄° *
‚ame
);

26 
ª˚¡_fûe_hi°‹y_öô
();

	@O:\tool\dvs50\app\render_gdk.c

19 
	~<c⁄fig.h
>

21 
	~<m©h.h
>

22 
	~<°dlib.h
>

23 
	~<°rög.h
>

24 
	~<gdk/gdk.h
>

26 
	~"mesßge.h
"

27 
	~"ªndî_gdk.h
"

28 
	~"dügdkªndîî.h
"

30 
˛ù_ªgi⁄_˛ór
(
DüRídîî
 *
ªndîî
);

31 
˛ù_ªgi⁄_add_ª˘
(
DüRídîî
 *
ªndîî
,

32 
Re˘™gÀ
 *
ª˘
);

34 
døw_pixñ_löe
(
DüRídîî
 *
ªndîî
,

35 
x1
, 
y1
,

36 
x2
, 
y2
,

37 
Cﬁ‹
 *
cﬁ‹
);

38 
døw_pixñ_ª˘
(
DüRídîî
 *
ªndîî
,

39 
x
, 
y
,

40 
width
, 
height
,

41 
Cﬁ‹
 *
cﬁ‹
);

42 
fûl_pixñ_ª˘
(
DüRídîî
 *
ªndîî
,

43 
x
, 
y
,

44 
width
, 
height
,

45 
Cﬁ‹
 *
cﬁ‹
);

46 
£t_size
 (
DüRídîî
 *
ªndîî
,

47 
gpoöãr
 
wödow
,

48 
width
, 
height
);

49 
c›y_to_wödow
 (
DüRídîî
 *
ªndîî
,

50 
gpoöãr
 
wödow
,

51 
x
, 
y
, 
width
, 
height
);

53 
	$dü_gdk_ªndîî_iÁ˚_öô
 (
DüI¡îa˘iveRídîîI¡îÁ˚
* 
iÁ˚
)

55 
iÁ˚
->
˛ù_ªgi⁄_˛ór
 = clip_region_clear;

56 
iÁ˚
->
˛ù_ªgi⁄_add_ª˘
 = clip_region_add_rect;

57 
iÁ˚
->
døw_pixñ_löe
 = draw_pixel_line;

58 
iÁ˚
->
døw_pixñ_ª˘
 = draw_pixel_rect;

59 
iÁ˚
->
fûl_pixñ_ª˘
 = fill_pixel_rect;

60 
iÁ˚
->
c›y_to_wödow
 = copy_to_window;

61 
iÁ˚
->
£t_size
 = set_size;

62 
	}
}

64 
DüRídîî
 *

65 
	$√w_gdk_ªndîî
(
DDi•œy
 *
ddi•
)

67 
DüGdkRídîî
 *
ªndîî
;

68 
GTy≥
 
ªndîî_ty≥
 = 0;

70 
ªndîî
 = 
	`g_obje˘_√w
 (
DIA_TYPE_GDK_RENDERER
, 
NULL
);

71 
ªndîî
->
å™sf‹m
 = 
	`dü_å™sf‹m_√w
 (&
ddi•
->
visibÀ
, &ddi•->
zoom_Á˘‹
);

72 i‡(!
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ªndîî
))

74 c⁄° 
GI¡îÁ˚Info
 
úídîî_iÁ˚_öfo
 =

76 (
GI¡îÁ˚InôFunc
Ë
dü_gdk_ªndîî_iÁ˚_öô
,

77 
NULL
,

78 
NULL


81 
ªndîî_ty≥
 = 
DIA_TYPE_GDK_RENDERER
;

83 
	`g_ty≥_add_öãrÁ˚_°©ic
 (
ªndîî_ty≥
,

84 
DIA_TYPE_INTERACTIVE_RENDERER_INTERFACE
,

85 &
úídîî_iÁ˚_öfo
);

88 
ªndîî
->
∑ª¡_ö°™˚
.
is_öãø˘ive
 = 1;

89 
ªndîî
->
gc
 = 
NULL
;

91 
ªndîî
->
pixm≠
 = 
NULL
;

92 
ªndîî
->
˛ù_ªgi⁄
 = 
NULL
;

94  
	`DIA_RENDERER
(
ªndîî
);

95 
	}
}

98 
	$£t_size
(
DüRídîî
 *
obje˘
, 
gpoöãr
 
wödow
,

99 
width
, 
height
)

101 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

103 i‡(
ªndîî
->
pixm≠
 !
NULL
)

104 
	`gdk_døwabÀ_uƒef
(
ªndîî
->
pixm≠
);

106 i‡(
wödow
)

107 
ªndîî
->
pixm≠
 = 
	`gdk_pixm≠_√w
(
	`GDK_WINDOW
(
wödow
), 
width
, 
height
, -1);

109 
ªndîî
->
pixm≠
 = 
	`gdk_pixm≠_√w
(
NULL
, 
width
, 
height
, 24);

111 i‡(
ªndîî
->
gc
 =
NULL
) {

112 
ªndîî
->
gc
 = 
	`gdk_gc_√w
‘ídîî->
pixm≠
);

114 
	`gdk_gc_£t_löe_©åibuãs
(
ªndîî
->
gc
,

115 
ªndîî
->
löe_width
,

116 
ªndîî
->
löe_°yÀ
,

117 
ªndîî
->
ˇp_°yÀ
,

118 
ªndîî
->
joö_°yÀ
);

120 
	}
}

123 
	$c›y_to_wödow
 (
DüRídîî
 *
obje˘
, 
gpoöãr
 
wödow
,

124 
x
, 
y
, 
width
, 
height
)

126 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

127 
GdkGC
 *
c›y_gc
 = 
NULL
;

129 i‡(!
c›y_gc
)

130 
c›y_gc
 = 
	`gdk_gc_√w
(
wödow
);

132 
	`gdk_døw_pixm≠
 (
	`GDK_WINDOW
(
wödow
),

133 
c›y_gc
,

134 
ªndîî
->
pixm≠
,

135 
x
, 
y
,

136 
x
, 
y
,

137 
width
, 
height
);

138 
	}
}

141 
	$˛ù_ªgi⁄_˛ór
(
DüRídîî
 *
obje˘
)

143 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

145 i‡(
ªndîî
->
˛ù_ªgi⁄
 !
NULL
)

146 
	`gdk_ªgi⁄_de°roy
(
ªndîî
->
˛ù_ªgi⁄
);

148 
ªndîî
->
˛ù_ªgi⁄
 = 
	`gdk_ªgi⁄_√w
();

150 
	`gdk_gc_£t_˛ù_ªgi⁄
(
ªndîî
->
gc
,Ñídîî->
˛ù_ªgi⁄
);

151 
	}
}

154 
	$˛ù_ªgi⁄_add_ª˘
(
DüRídîî
 *
obje˘
,

155 
Re˘™gÀ
 *
ª˘
)

157 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

158 
GdkRe˘™gÀ
 
˛ù_ª˘
;

159 
x1
,
y1
;

160 
x2
,
y2
;

162 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
, 
ª˘
->
À·
,Ñe˘->
t›
, &
x1
, &
y1
);

163 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
, 
ª˘
->
right
,Ñe˘->
bŸtom
, &
x2
, &
y2
);

165 
˛ù_ª˘
.
x
 = 
x1
;

166 
˛ù_ª˘
.
y
 = 
y1
;

167 
˛ù_ª˘
.
width
 = 
x2
 - 
x1
 + 1;

168 
˛ù_ª˘
.
height
 = 
y2
 - 
y1
 + 1;

170 
	`gdk_ªgi⁄_uni⁄_wôh_ª˘
–
ªndîî
->
˛ù_ªgi⁄
, &
˛ù_ª˘
 );

172 
	`gdk_gc_£t_˛ù_ªgi⁄
(
ªndîî
->
gc
,Ñídîî->
˛ù_ªgi⁄
);

173 
	}
}

176 
	$døw_pixñ_löe
(
DüRídîî
 *
obje˘
,

177 
x1
, 
y1
,

178 
x2
, 
y2
,

179 
Cﬁ‹
 *
cﬁ‹
)

181 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

182 
GdkGC
 *
gc
 = 
ªndîî
->gc;

183 
GdkCﬁ‹
 
gdkcﬁ‹
;

184 
èrgë_width
, 
èrgë_height
;

186 
	`dü_gdk_ªndîî_£t_dashes
(
ªndîî
, 
x1
+
y1
);

188 
	`gdk_døwabÀ_gë_size
 (
	`GDK_DRAWABLE
 (
ªndîî
->
pixm≠
), &
èrgë_width
, &
èrgë_height
);

190 i‡–(
x1
 < 0 && 
x2
 < 0)

191 || (
y1
 < 0 && 
y2
 < 0)

192 || (
x1
 > 
èrgë_width
 && 
x2
 >Åarget_width)

193 || (
y1
 > 
èrgë_height
 && 
y2
 >Åarget_height))

196 
	`cﬁ‹_c⁄vît
(
cﬁ‹
, &
gdkcﬁ‹
);

197 
	`gdk_gc_£t_f‹eground
(
gc
, &
gdkcﬁ‹
);

199 
	`gdk_døw_löe
(
ªndîî
->
pixm≠
, 
gc
, 
x1
, 
y1
, 
x2
, 
y2
);

200 
	}
}

203 
	$døw_pixñ_ª˘
(
DüRídîî
 *
obje˘
,

204 
x
, 
y
,

205 
width
, 
height
,

206 
Cﬁ‹
 *
cﬁ‹
)

208 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

209 
GdkGC
 *
gc
 = 
ªndîî
->gc;

210 
GdkCﬁ‹
 
gdkcﬁ‹
;

211 
èrgë_width
, 
èrgë_height
;

213 
	`dü_gdk_ªndîî_£t_dashes
(
ªndîî
, 
x
+
y
);

215 
	`gdk_døwabÀ_gë_size
 (
	`GDK_DRAWABLE
 (
ªndîî
->
pixm≠
), &
èrgë_width
, &
èrgë_height
);

217 i‡(
x
 + 
width
 < 0 || 
y
 + 
height
 < 0 || x > 
èrgë_width
 || y > 
èrgë_height
)

220 
	`cﬁ‹_c⁄vît
(
cﬁ‹
, &
gdkcﬁ‹
);

221 
	`gdk_gc_£t_f‹eground
(
gc
, &
gdkcﬁ‹
);

223 
	`gdk_døw_ª˘™gÀ
 (
ªndîî
->
pixm≠
, 
gc
, 
FALSE
,

224 
x
, 
y
, 
width
, 
height
);

225 
	}
}

228 
	$fûl_pixñ_ª˘
(
DüRídîî
 *
obje˘
,

229 
x
, 
y
,

230 
width
, 
height
,

231 
Cﬁ‹
 *
cﬁ‹
)

233 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

234 
GdkGC
 *
gc
 = 
ªndîî
->gc;

235 
GdkCﬁ‹
 
gdkcﬁ‹
;

236 
èrgë_width
, 
èrgë_height
;

238 
	`gdk_døwabÀ_gë_size
 (
	`GDK_DRAWABLE
 (
ªndîî
->
pixm≠
), &
èrgë_width
, &
èrgë_height
);

240 i‡(
x
 + 
width
 < 0 || 
y
 + 
height
 < 0 || x > 
èrgë_width
 || y > 
èrgë_height
)

243 
	`cﬁ‹_c⁄vît
(
cﬁ‹
, &
gdkcﬁ‹
);

244 
	`gdk_gc_£t_f‹eground
(
gc
, &
gdkcﬁ‹
);

246 
	`gdk_døw_ª˘™gÀ
 (
ªndîî
->
pixm≠
, 
gc
, 
TRUE
,

247 
x
, 
y
, 
width
, 
height
);

248 
	}
}

	@O:\tool\dvs50\app\render_gdk.h

18 #i‚de‡
RENDER_GDK_H


19 
	#RENDER_GDK_H


	)

21 
	~"di•œy.h
"

23 
DüRídîî
 *
√w_gdk_ªndîî
(
DDi•œy
 *
ddi•
);

24 
gdk_ªndîî_£t_size
(
DüRídîî
 *
ªndîî
, 
GdkWödow
 *
wödow
,

25 
width
, 
height
);

26 
ªndîî_gdk_c›y_to_wödow
(
DüRídîî
 *
ªndîî
,

27 
GdkWödow
 *
wödow
,

28 
x
, 
y
,

29 
width
, 
height
);

	@O:\tool\dvs50\app\scroll_tool.c

18 
	~<c⁄fig.h
>

20 
	~"s¸ﬁl_toﬁ.h
"

21 
	~"h™dÀ_›s.h
"

22 
	~"obje˘_›s.h
"

23 
	~"c⁄√˘i⁄poöt_›s.h
"

24 
	~"mesßge.h
"

25 
	~"curs‹.h
"

27 
s¸ﬁl_buâ⁄_¥ess
(
S¸ﬁlToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

28 
DDi•œy
 *
ddi•
);

29 
s¸ﬁl_buâ⁄_ªÀa£
(
S¸ﬁlToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

30 
DDi•œy
 *
ddi•
);

31 
s¸ﬁl_mŸi⁄
(
S¸ﬁlToﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

32 
DDi•œy
 *
ddi•
);

33 
s¸ﬁl_doubÀ_˛ick
(
S¸ﬁlToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

34 
DDi•œy
 *
ddi•
);

36 
Toﬁ
 *

37 
	$¸óã_s¸ﬁl_toﬁ
()

39 
S¸ﬁlToﬁ
 *
toﬁ
;

41 
toﬁ
 = 
	`g_√w0
(
S¸ﬁlToﬁ
, 1);

42 
toﬁ
->toﬁ.
ty≥
 = 
SCROLL_TOOL
;

43 
toﬁ
->toﬁ.
buâ⁄_¥ess_func
 = (
Buâ⁄PªssFunc
Ë&
s¸ﬁl_buâ⁄_¥ess
;

44 
toﬁ
->toﬁ.
buâ⁄_ªÀa£_func
 = (
Buâ⁄Rñó£Func
Ë&
s¸ﬁl_buâ⁄_ªÀa£
;

45 
toﬁ
->toﬁ.
mŸi⁄_func
 = (
MŸi⁄Func
Ë&
s¸ﬁl_mŸi⁄
;

46 
toﬁ
->toﬁ.
doubÀ_˛ick_func
 = (
DoubÀClickFunc
Ë&
s¸ﬁl_doubÀ_˛ick
;

48 
toﬁ
->
s¸ﬁlög
 = 
FALSE
;

49 
toﬁ
->
u£_h™d
 = 
TRUE
;

51 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_GRAB
));

53  (
Toﬁ
 *)
toﬁ
;

54 
	}
}

57 
	$‰ì_s¸ﬁl_toﬁ
(
Toﬁ
 *
toﬁ
)

59 
	`g_‰ì
(
toﬁ
);

60 
	`ddi•œy_£t_Æl_curs‹
(
deÁu…_curs‹
);

62 
	}
}

65 
	$s¸ﬁl_doubÀ_˛ick
(
S¸ﬁlToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

66 
DDi•œy
 *
ddi•
)

69 
	}
}

72 
	$s¸ﬁl_buâ⁄_¥ess
(
S¸ﬁlToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

73 
DDi•œy
 *
ddi•
)

75 
Poöt
 
˛ickedpoöt
;

77 
toﬁ
->
u£_h™d
 = (
evít
->
°©e
 & 
GDK_SHIFT_MASK
) == 0;

78 i‡(
toﬁ
->
u£_h™d
)

79 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_GRABBING
));

81 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_SCROLL
));

83 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
,

84 ()
evít
->
x
, (Îvít->
y
,

85 &
˛ickedpoöt
.
x
, &˛ickedpoöt.
y
);

87 
toﬁ
->
s¸ﬁlög
 = 
TRUE
;

88 
toﬁ
->
œ°_pos
 = 
˛ickedpoöt
;

89 
	}
}

95 
	$s¸ﬁl_mŸi⁄
(
S¸ﬁlToﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

96 
DDi•œy
 *
ddi•
)

98 
Poöt
 
to
;

99 
Poöt
 
dñè
;

102 i‡(!
toﬁ
->
s¸ﬁlög
) {

104 i‡((
evít
->
°©e
 & 
GDK_SHIFT_MASK
) == 0) {

105 i‡(!
toﬁ
->
u£_h™d
) {

106 
toﬁ
->
u£_h™d
 = 
TRUE
;

107 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_GRAB
));

110 i‡(
toﬁ
->
u£_h™d
) {

111 
toﬁ
->
u£_h™d
 = 
FALSE
;

112 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_SCROLL
));

117 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
, 
evít
->
x
,Évít->
y
, &
to
.x, &to.y);

119 i‡(
toﬁ
->
u£_h™d
) {

120 
dñè
 = 
toﬁ
->
œ°_pos
;

121 
	`poöt_sub
(&
dñè
, &
to
);

123 
toﬁ
->
œ°_pos
 = 
to
;

124 
	`poöt_add
(&
toﬁ
->
œ°_pos
, &
dñè
);

127 
	`poöt_add
(&
dñè
, &
ddi•
->
‹igo
);

128 
	`ddi•œy_£t_‹igo
(
ddi•
, 
dñè
.
x
, dñè.
y
);

129 
	`ddi•œy_upd©e_s¸ﬁlb¨s
(
ddi•
);

130 
	`ddi•œy_add_upd©e_Æl
(
ddi•
);

132 
dñè
 = 
to
;

133 
	`poöt_sub
(&
dñè
, &
toﬁ
->
œ°_pos
);

134 
	`poöt_sˇÀ
(&
dñè
, 0.5);

136 
	`ddi•œy_s¸ﬁl
(
ddi•
, &
dñè
);

137 
toﬁ
->
œ°_pos
 = 
to
;

139 
	`ddi•œy_Êush
(
ddi•
);

140 
	}
}

144 
	$s¸ﬁl_buâ⁄_ªÀa£
(
S¸ﬁlToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

145 
DDi•œy
 *
ddi•
)

147 
toﬁ
->
u£_h™d
 = (
evít
->
°©e
 & 
GDK_SHIFT_MASK
) == 0;

148 i‡(
toﬁ
->
u£_h™d
) {

149 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_GRAB
));

151 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_SCROLL
));

153 
toﬁ
->
s¸ﬁlög
 = 
FALSE
;

154 
	}
}

	@O:\tool\dvs50\app\scroll_tool.h

18 #i‚de‡
SCROLL_TOOL_H


19 
	#SCROLL_TOOL_H


	)

21 
	~"geomëry.h
"

22 
	~"toﬁ.h
"

24 
_S¸ﬁlToﬁ
 
	tS¸ﬁlToﬁ
;

26 
	s_S¸ﬁlToﬁ
 {

27 
Toﬁ
 
	mtoﬁ
;

29 
	ms¸ﬁlög
;

30 
	mu£_h™d
;

31 
Poöt
 
	mœ°_pos
;

34 
Toﬁ
 *
¸óã_s¸ﬁl_toﬁ
();

35 
‰ì_s¸ﬁl_toﬁ
(
Toﬁ
 *
toﬁ
);

	@O:\tool\dvs50\app\select.c

20 
	~<c⁄fig.h
>

22 
	~<as£π.h
>

24 
	~"£À˘.h
"

25 
	~"míus.h
"

26 
	~"öé.h
"

27 
	~"obje˘_›s.h
"

28 
	~"ãxãdô.h
"

30 
Sñe˘i⁄StyÀ
 
	g£À˘i⁄_°yÀ
 = 
SELECT_REPLACE
;

33 
	$£À˘_Æl_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

35 
Dügøm
 *
dü
;

36 
GLi°
 *
obje˘s
;

37 
DDi•œy
 * 
ddi•
 = 
	`ddi•œy_a˘ive
();

39 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

40 
dü
 = 
ddi•
->
dügøm
;

42 
obje˘s
 = 
dü
->
d©a
->
a˘ive_œyî
->objects;

44 
obje˘s
 !
NULL
)

46 
DüObje˘
 *
obj
 = (DüObje˘ *)
obje˘s
->
d©a
;

48 i‡(!
	`dügøm_is_£À˘ed
(
dü
, 
obj
))

50 
	`dügøm_£À˘
(
dü
, 
obj
);

53 
obje˘s
 = 
	`g_li°_√xt
(objects);

56 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

57 
	`obje˘_add_upd©es_li°
(
dü
->
d©a
->
£À˘ed
, dia);

58 
	`dügøm_Êush
(
dü
);

59 
	}
}

62 
	$£À˘_n⁄e_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

64 
Dügøm
 * 
dü
;

65 
DDi•œy
 * 
ddi•
 = 
	`ddi•œy_a˘ive
();

67 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

68 
dü
 = 
ddi•
->
dügøm
;

70 
	`dügøm_ªmove_Æl_£À˘ed
(
dü
, 
TRUE
);

72 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

73 
	`obje˘_add_upd©es_li°
(
dü
->
d©a
->
£À˘ed
, dia);

74 
	`dügøm_Êush
(
dü
);

75 
	}
}

78 
	$£À˘_övît_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

80 
Dügøm
 *
dü
;

81 
GLi°
 *
tmp
;

82 
DDi•œy
 * 
ddi•
 = 
	`ddi•œy_a˘ive
();

84 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

85 
dü
 = 
ddi•
->
dügøm
;

87 
tmp
 = 
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
;

89 ; 
tmp
 !
NULL
;Åm∞
	`g_li°_√xt
(tmp))

91 
DüObje˘
 *
obj
 = (DüObje˘ *)
tmp
->
d©a
;

93 i‡(!
	`dügøm_is_£À˘ed
(
dü
, 
obj
))

95 
	`dügøm_£À˘
(
dü
, 
obj
);

99 
	`dügøm_un£À˘_obje˘
(
dü
, 
obj
);

103 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

104 
	`obje˘_add_upd©es_li°
(
dü
->
d©a
->
£À˘ed
, dia);

105 
	`dügøm_Êush
(
dü
);

107 
	}
}

113 
	$£À˘_c⁄√˘ed_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

115 
Dügøm
 *
dü
;

116 
DDi•œy
 * 
ddi•
 = 
	`ddi•œy_a˘ive
();

117 
GLi°
 *
obje˘s
, *
tmp
;

119 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

120 
dü
 = 
ddi•
->
dügøm
;

122 
obje˘s
 = 
dü
->
d©a
->
£À˘ed
;

124 
tmp
 = 
obje˘s
;Åm∞!
NULL
;Åm∞
	`g_li°_√xt
(tmp))

126 
DüObje˘
 *
obj
 = (DüObje˘ *)
tmp
->
d©a
;

127 
i
;

129 
i
 = 0; i < 
obj
->
num_h™dÀs
; i++)

131 
H™dÀ
 *
h™dÀ
 = 
obj
->
h™dÀs
[
i
];

133 i‡(
h™dÀ
->
c⁄√˘ed_to
 !
NULL


134 && 
	`dü_obje˘_is_£À˘abÀ
(
h™dÀ
->
c⁄√˘ed_to
->
obje˘
)

135 && !
	`dügøm_is_£À˘ed
(
dü
, 
h™dÀ
->
c⁄√˘ed_to
->
obje˘
))

137 
	`dügøm_£À˘
(
dü
, 
h™dÀ
->
c⁄√˘ed_to
->
obje˘
);

142 
tmp
 = 
obje˘s
;Åm∞!
NULL
;Åm∞tmp->
√xt
)

144 
DüObje˘
 *
obj
 = (DüObje˘ *)
tmp
->
d©a
;

145 
i
;

147 
i
 = 0; i < 
obj
->
num_c⁄√˘i⁄s
; i++)

149 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄
 = 
obj
->
c⁄√˘i⁄s
[
i
];

150 
GLi°
 *
c⁄ns
 = 
c⁄√˘i⁄
->
c⁄√˘ed
;

152 ; 
c⁄ns
 !
NULL
; c⁄n†
	`g_li°_√xt
(conns))

154 
DüObje˘
 *
obj2
 = (DüObje˘ *)
c⁄ns
->
d©a
;

156 i‡(
	`dü_obje˘_is_£À˘abÀ
(
obj2
)

157 && !
	`dügøm_is_£À˘ed
(
dü
, 
obj2
))

159 
	`dügøm_£À˘
(
dü
, 
obj2
);

165 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

166 
	`obje˘_add_upd©es_li°
(
dü
->
d©a
->
£À˘ed
, dia);

167 
	`dügøm_Êush
(
dü
);

168 
	}
}

171 
	$£À˘_å™sôivñy
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
)

173 
i
;

175 
GLi°
 *
√wly_£À˘ed
 = 
NULL
;

177 
i
 = 0; i < 
obj
->
num_h™dÀs
; i++)

179 
H™dÀ
 *
h™dÀ
 = 
obj
->
h™dÀs
[
i
];

181 i‡(
h™dÀ
->
c⁄√˘ed_to
 !
NULL
 &&

182 
	`dü_obje˘_is_£À˘abÀ
(
h™dÀ
->
c⁄√˘ed_to
->
obje˘
))

184 
DüObje˘
 *
c⁄√˘ed_obje˘
 = 
h™dÀ
->
c⁄√˘ed_to
->
obje˘
;

185 i‡(!
	`dügøm_is_£À˘ed
(
dü
, 
c⁄√˘ed_obje˘
))

187 
	`dügøm_£À˘
(
dü
, 
c⁄√˘ed_obje˘
);

188 
√wly_£À˘ed
 = 
	`g_li°_¥ïíd
“ewly_£À˘ed, 
c⁄√˘ed_obje˘
);

193 
i
 = 0; i < 
obj
->
num_c⁄√˘i⁄s
; i++)

195 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄
 = 
obj
->
c⁄√˘i⁄s
[
i
];

196 
GLi°
 *
c⁄ns
 = 
c⁄√˘i⁄
->
c⁄√˘ed
;

198 ; 
c⁄ns
 !
NULL
; c⁄n†
	`g_li°_√xt
(conns))

200 
DüObje˘
 *
obj2
 = (DüObje˘ *)
c⁄ns
->
d©a
;

202 i‡(
	`dü_obje˘_is_£À˘abÀ
(
obj2
Ë&& !
	`dügøm_is_£À˘ed
(
dü
, obj2))

204 
	`dügøm_£À˘
(
dü
, 
obj2
);

205 
√wly_£À˘ed
 = 
	`g_li°_¥ïíd
“ewly_£À˘ed, 
obj2
);

210 
√wly_£À˘ed
 !
NULL
)

212 
	`£À˘_å™sôivñy
(
dü
, (
DüObje˘
 *)
√wly_£À˘ed
->
d©a
);

213 
√wly_£À˘ed
 = 
	`g_li°_√xt
(newly_selected);

215 
	}
}

221 
	$£À˘_å™sôive_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

223 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

224 
Dügøm
 *
dü
;

225 
GLi°
 *
obje˘s
, *
tmp
;

227 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

228 
dü
 = 
ddi•
->
dügøm
;

230 
obje˘s
 = 
dü
->
d©a
->
£À˘ed
;

232 
tmp
 = 
obje˘s
;Åm∞!
NULL
;Åm∞
	`g_li°_√xt
(tmp))

234 
	`£À˘_å™sôivñy
(
dü
, (
DüObje˘
 *)
tmp
->
d©a
);

237 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

238 
	`obje˘_add_upd©es_li°
(
dü
->
d©a
->
£À˘ed
, dia);

239 
	`dügøm_Êush
(
dü
);

240 
	}
}

243 
	$£À˘_ßme_ty≥_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

247 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

248 
Dügøm
 *
dü
;

249 
GLi°
 *
obje˘s
, *
tmp
, *
tmp2
;

251 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

252 
dü
 = 
ddi•
->
dügøm
;

254 
tmp
 = 
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
;

256 
obje˘s
 = 
dü
->
d©a
->
£À˘ed
;

258 ; 
tmp
 !
NULL
;Åm∞
	`g_li°_√xt
(tmp))

260 
DüObje˘
 *
obj
 = (DüObje˘ *)
tmp
->
d©a
;

262 i‡(!
	`dügøm_is_£À˘ed
(
dü
, 
obj
))

264 
tmp2
 = 
obje˘s
;Åmp2 !
NULL
;Åmp2 = 
	`g_li°_√xt
(tmp2))

266 
DüObje˘
 *
obj2
 = (DüObje˘ *)
tmp2
->
d©a
;

268 i‡(
obj
->
ty≥
 =
obj2
->type)

270 
	`dügøm_£À˘
(
dü
, 
obj
);

277 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

278 
	`obje˘_add_upd©es_li°
(
dü
->
d©a
->
£À˘ed
, dia);

279 
	`dügøm_Êush
(
dü
);

280 
	}
}

283 
	$£À˘_°yÀ_ˇŒback
(
GtkA˘i⁄
 *
a˘i⁄
, 
GtkRadioA˘i⁄
 *
cuºít
, 
gpoöãr
 
u£r_d©a
)

285 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

286 i‡(!
ddi•
 || 
	`ãxãdô_mode
(ddisp)) ;

289 
£À˘i⁄_°yÀ
 = 
	`gtk_ødio_a˘i⁄_gë_cuºít_vÆue
 (
cuºít
);

290 
	}
}

	@O:\tool\dvs50\app\select.h

18 #i‚de‡
SELECT_H


19 
	#SELECT_H


	)

21 
	~"dügøm.h
"

22 
	~"di•œy.h
"

25 
	mSELECT_REPLACE
,

26 
	mSELECT_UNION
,

27 
	mSELECT_INTERSECTION
,

28 
	mSELECT_REMOVE
,

29 
	mSELECT_INVERT


30 } 
	tSñe˘i⁄StyÀ
;

32 
Sñe˘i⁄StyÀ
 
£À˘i⁄_°yÀ
;

34 
£À˘_Æl_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

35 
£À˘_n⁄e_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

36 
£À˘_övît_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

37 
£À˘_c⁄√˘ed_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

38 
£À˘_å™sôive_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
*
widgë
);

39 
£À˘_ßme_ty≥_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
);

40 
£À˘_°yÀ_ˇŒback
(
GtkA˘i⁄
 *
a˘i⁄
, 
GtkRadioA˘i⁄
 *
cuºít
, 
gpoöãr
 
u£r_d©a
);

	@O:\tool\dvs50\app\sheets.c

23 
	~<°rög.h
>

25 #unde‡
GTK_DISABLE_DEPRECATED


26 #ifde‡
GNOME


27 
	~<gnome.h
>

29 
	~<gtk/gtk.h
>

32 
	~<gdk-pixbuf/gdk-pixbuf.h
>

33 
	~<gmoduÀ.h
>

35 
	~"../lib/∂ug-ös.h
"

36 
	~"../lib/shìt.h
"

37 
	~"../lib/mesßge.h
"

38 
	~"../lib/obje˘.h
"

39 
	~"../≠p/pixm≠s/missög.xpm
"

41 
	~"öãrÁ˚.h
"

42 
	~"shìts.h
"

43 
	~"shìts_dülog.h
"

44 
	~"gtkhwøpbox.h
"

46 
GtkWidgë
 *
	gshìts_dülog
 = 
NULL
;

47 
GSLi°
 *
	gshìts_mods_li°
 = 
NULL
;

48 
GtkToﬁtùs
 *
	gshìts_dülog_toﬁtùs
 = 
NULL
;

49 
gpoöãr
 
	gcu°om_ty≥_symbﬁ
 = 
NULL
;

57 
ShìtObje˘Mod
 *

58 
	$shìts_≠≥nd_shìt_obje˘_mod
(
ShìtObje˘
 *
so
, 
ShìtMod
 *
sm
)

60 
ShìtObje˘Mod
 *
shìt_obje˘_mod
;

61 
DüObje˘Ty≥
 *
Ÿ
;

63 
	`g_ªtu∫_vÆ_if_Áû
 (
so
 !
NULL
 && 
sm
 != NULL, NULL);

64 
	`g_ªtu∫_vÆ_if_Áû
 (
cu°om_ty≥_symbﬁ
 !
NULL
, NULL);

66 
shìt_obje˘_mod
 = 
	`g_√w0
(
ShìtObje˘Mod
, 1);

67 
shìt_obje˘_mod
->
shìt_obje˘
 = *
so
;

68 
shìt_obje˘_mod
->
mod
 = 
SHEET_OBJECT_MOD_NONE
;

70 
Ÿ
 = 
	`obje˘_gë_ty≥
(
so
->
obje˘_ty≥
);

71 
	`g_as£π
(
Ÿ
);

72 i‡(
Ÿ
->
›s
 =((
DüObje˘Ty≥
 *)(
cu°om_ty≥_symbﬁ
))->ops)

73 
shìt_obje˘_mod
->
ty≥
 = 
OBJECT_TYPE_SVG
;

75 
shìt_obje˘_mod
->
ty≥
 = 
OBJECT_TYPE_PROGRAMMED
;

77 
sm
->
shìt
.
obje˘s
 = 
	`g_¶i°_≠≥nd
(sm->shìt.obje˘s, 
shìt_obje˘_mod
);

79  
shìt_obje˘_mod
;

80 
	}
}

84 
ShìtMod
 *

85 
	$shìts_≠≥nd_shìt_mods
(
Shìt
 *
shìt
)

87 
ShìtMod
 *
shìt_mod
;

88 
GSLi°
 *
shìt_obje˘s_li°
;

90 
	`g_ªtu∫_vÆ_if_Áû
 (
shìt
 !
NULL
, NULL);

92 
shìt_mod
 = 
	`g_√w0
(
ShìtMod
, 1);

93 
shìt_mod
->
shìt
 = *sheet;

94 
shìt_mod
->
ty≥
 = 
SHEETMOD_TYPE_NORMAL
;

95 
shìt_mod
->
mod
 = 
SHEETMOD_MOD_NONE
;

96 
shìt_mod
->
shìt
.
obje˘s
 = 
NULL
;

98 
shìt_obje˘s_li°
 = 
shìt
->
obje˘s
; sheet_objects_list;

99 
shìt_obje˘s_li°
 = 
	`g_¶i°_√xt
(sheet_objects_list))

100 
	`shìts_≠≥nd_shìt_obje˘_mod
(
shìt_obje˘s_li°
->
d©a
, 
shìt_mod
);

102 
shìts_mods_li°
 = 
	`g_¶i°_≠≥nd
(shìts_mods_li°, 
shìt_mod
);

104  
shìt_mod
;

105 
	}
}

107 
göt


108 
	$míu_ôem_com∑ª_œbñs
(
gc⁄°poöãr
 
a
, gc⁄°poöã∏
b
)

110 
GLi°
 *
a_li°
;

111 
gch¨
 *
œbñ
;

113 
a_li°
 = 
	`gtk_c⁄èöî_gë_chûdªn
(
	`GTK_CONTAINER
(
	`GTK_MENU_ITEM
(
a
)));

114 
	`g_as£π
(
	`g_li°_Àngth
(
a_li°
) == 1);

116 
	`gtk_œbñ_gë
(
	`GTK_LABEL
(
a_li°
->
d©a
), &
œbñ
);

117 
	`g_li°_‰ì
(
a_li°
);

119 i‡(!
	`°rcmp
(
œbñ
, (
gch¨
 *)
b
))

123 
	}
}

126 
	$shìts_›ti⁄míu_¸óã
(
GtkWidgë
 *
›ti⁄_míu
, GtkWidgë *
wøpbox
,

127 
gch¨
 *
shìt_«me
)

129 
GtkWidgë
 *
›ti⁄míu_míu
;

130 
GSLi°
 *
shìts_li°
;

131 
GLi°
 *
míu_ôem_li°
;

135 
›ti⁄míu_míu
 = 
	`gtk_›ti⁄_míu_gë_míu
(
	`GTK_OPTION_MENU
(
›ti⁄_míu
));

136 
	`gtk_c⁄èöî_f‹óch
(
	`GTK_CONTAINER
(
›ti⁄míu_míu
),

137 (
GtkCÆlback
)
gtk_widgë_de°roy
, 
NULL
);

139 i‡(!
shìts_dülog_toﬁtùs
)

140 
shìts_dülog_toﬁtùs
 = 
	`gtk_toﬁtùs_√w
();

142 
shìts_li°
 = 
shìts_mods_li°
; sheets_list;

143 
shìts_li°
 = 
	`g_¶i°_√xt
(sheets_list))

145 
ShìtMod
 *
shìt_mod
;

146 
GtkWidgë
 *
míu_ôem
;

147 
gch¨
 *
tù
;

149 
shìt_mod
 = 
shìts_li°
->
d©a
;

153 i‡(
shìt_mod
->
mod
 =
SHEETMOD_MOD_DELETED
)

157 
míu_ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`gëãxt
(
shìt_mod
->
shìt
.
«me
));

159 
	`gtk_míu_≠≥nd
(
	`GTK_MENU
(
›ti⁄míu_míu
), 
míu_ôem
);

161 i‡(
shìt_mod
->
shìt
.
sc›e
 =
SHEET_SCOPE_SYSTEM
)

162 
tù
 = 
	`g_°rdup_¥ötf
(
	`_
("%s\nSy°em shìt"), 
shìt_mod
->
shìt
.
des¸ùti⁄
);

164 
tù
 = 
	`g_°rdup_¥ötf
(
	`_
("%s\nU£∏shìt"), 
shìt_mod
->
shìt
.
des¸ùti⁄
);

166 
	`gtk_toﬁtùs_£t_tù
(
	`GTK_TOOLTIPS
(
shìts_dülog_toﬁtùs
), 
míu_ôem
, 
tù
,

167 
NULL
);

168 
	`g_‰ì
(
tù
);

171 
	`gtk_widgë_show
(
míu_ôem
);

173 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
míu_ôem
), "wøpbox", 
wøpbox
);

175 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
míu_ôem
), "activate",

176 
	`G_CALLBACK
(
⁄_shìts_dülog_›ti⁄míu_a˘iv©e
),

177 (
gpoöãr
)
shìt_mod
);

180 
míu_ôem_li°
 = 
	`gtk_c⁄èöî_gë_chûdªn
(
	`GTK_CONTAINER
(
›ti⁄míu_míu
));

185 i‡(
shìt_«me
)

187 
göt
 
ödex
 = 0;

188 
GLi°
 *
li°
;

190 
li°
 = 
	`g_li°_föd_cu°om
(
míu_ôem_li°
, 
shìt_«me
,

191 
míu_ôem_com∑ª_œbñs
);

192 i‡(
li°
)

193 
ödex
 = 
	`g_li°_posôi⁄
(
míu_ôem_li°
, 
li°
);

194 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
›ti⁄_míu
), 
ödex
);

195 
	`gtk_míu_ôem_a˘iv©e
(
	`GTK_MENU_ITEM
(
	`g_li°_¡h_d©a
(
míu_ôem_li°
,

196 
ödex
)));

200 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
›ti⁄_míu
), 0);

201 
	`gtk_míu_ôem_a˘iv©e
(
	`GTK_MENU_ITEM
(
míu_ôem_li°
->
d©a
));

204 
	`g_li°_‰ì
(
míu_ôem_li°
);

205 
	}
}

207 
gboﬁón


208 
	$shìts_dülog_¸óã
()

210 
GLi°
 *
∂ugö_li°
;

211 
GSLi°
 *
shìts_li°
;

212 
GtkWidgë
 *
›ti⁄_míu
;

213 
GtkWidgë
 *
sw
;

214 
GtkWidgë
 *
wøpbox
;

215 
gch¨
 *
shìt_À·
;

216 
gch¨
 *
shìt_right
;

218 i‡(
shìts_mods_li°
)

223 
	`g_¶i°_f‹óch
(
shìts_mods_li°
, (
GFunc
)
g_‰ì
, 
NULL
);

224 
	`g_¶i°_‰ì
(
shìts_mods_li°
);

226 
shìts_mods_li°
 = 
NULL
;

228 i‡(
shìts_dülog
 =
NULL
)

230 
shìts_dülog
 = 
	`¸óã_shìts_maö_dülog
();

232 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
shìts_dülog
), "destroy",

233 
	`G_CALLBACK
 (
gtk_widgë_de°royed
),

234 &
shìts_dülog
);

235 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
shìts_dülog
), "destroy",

236 
	`G_CALLBACK
 (
gtk_widgë_de°royed
),

237 &
shìts_dülog_toﬁtùs
);

239 
shìt_À·
 = 
NULL
;

240 
shìt_right
 = 
NULL
;

244 
›ti⁄_míu
 = 
	`lookup_widgë
(
shìts_dülog
, "optionmenu_left");

245 
shìt_À·
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
›ti⁄_míu
),

248 
›ti⁄_míu
 = 
	`lookup_widgë
(
shìts_dülog
, "optionmenu_right");

249 
shìt_right
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
›ti⁄_míu
),

252 
wøpbox
 = 
	`lookup_widgë
(
shìts_dülog
, "wrapbox_left");

253 
	`gtk_widgë_de°roy
(
wøpbox
);

255 
wøpbox
 = 
	`lookup_widgë
(
shìts_dülog
, "wrapbox_right");

256 
	`gtk_widgë_de°roy
(
wøpbox
);

259 i‡(
cu°om_ty≥_symbﬁ
 =
NULL
)

264 
cu°om_ty≥_symbﬁ
 = 
NULL
;

265 
∂ugö_li°
 = 
	`dü_li°_∂ugös
();Ölugö_li° !
NULL
;

266 
∂ugö_li°
 = 
	`g_li°_√xt
(plugin_list))

268 
PlugöInfo
 *
öfo
 = 
∂ugö_li°
->
d©a
;

270 
cu°om_ty≥_symbﬁ
 = (
gpoöãr
)
	`dü_∂ugö_gë_symbﬁ
 (
öfo
,"custom_type");

271 i‡(
cu°om_ty≥_symbﬁ
)

276 i‡(!
cu°om_ty≥_symbﬁ
)

278 
	`mesßge_w¨nög
 (
	`_
("Can't get symbol 'custom_type' fromány module.\n"

280  
FALSE
;

283 
shìts_li°
 = 
	`gë_shìts_li°
(); sheets_list;

284 
shìts_li°
 = 
	`g_¶i°_√xt
(sheets_list))

285 
	`shìts_≠≥nd_shìt_mods
(
shìts_li°
->
d©a
);

287 
sw
 = 
	`lookup_widgë
(
shìts_dülog
, "scrolledwindow_right");

288 
wøpbox
 = 
	`gtk_hwøp_box_√w
(
FALSE
);

289 
	`gtk_widgë_ªf
(
wøpbox
);

290 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
shìts_dülog
), "wøpbox_right", 
wøpbox
);

291 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
(
	`GTK_SCROLLED_WINDOW
(
sw
), 
wøpbox
);

292 
	`gtk_wøp_box_£t_ju°ify
(
	`GTK_WRAP_BOX
(
wøpbox
), 
GTK_JUSTIFY_TOP
);

293 
	`gtk_wøp_box_£t_löe_ju°ify
(
	`GTK_WRAP_BOX
(
wøpbox
), 
GTK_JUSTIFY_LEFT
);

294 
	`gtk_widgë_show
(
wøpbox
);

295 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
wøpbox
), "is_À·", 
FALSE
);

296 
›ti⁄_míu
 = 
	`lookup_widgë
(
shìts_dülog
, "optionmenu_right");

297 
	`shìts_›ti⁄míu_¸óã
(
›ti⁄_míu
, 
wøpbox
, 
shìt_right
);

299 
sw
 = 
	`lookup_widgë
(
shìts_dülog
, "scrolledwindow_left");

300 
wøpbox
 = 
	`gtk_hwøp_box_√w
(
FALSE
);

301 
	`gtk_widgë_ªf
(
wøpbox
);

302 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
shìts_dülog
), "wøpbox_À·", 
wøpbox
);

303 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
(
	`GTK_SCROLLED_WINDOW
(
sw
), 
wøpbox
);

304 
	`gtk_wøp_box_£t_ju°ify
(
	`GTK_WRAP_BOX
(
wøpbox
), 
GTK_JUSTIFY_TOP
);

305 
	`gtk_wøp_box_£t_löe_ju°ify
(
	`GTK_WRAP_BOX
(
wøpbox
), 
GTK_JUSTIFY_LEFT
);

306 
	`gtk_widgë_show
(
wøpbox
);

307 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
wøpbox
), "is_À·", (
gpoöãr
)
TRUE
);

308 
›ti⁄_míu
 = 
	`lookup_widgë
(
shìts_dülog
, "optionmenu_left");

309 
	`shìts_›ti⁄míu_¸óã
(
›ti⁄_míu
, 
wøpbox
, 
shìt_À·
);

311  
TRUE
;

312 
	}
}

315 
	$¸óã_obje˘_pixm≠
(
ShìtObje˘
 *
so
, 
GtkWidgë
 *
∑ª¡
,

316 
GdkPixm≠
 **
pixm≠
, 
GdkBôm≠
 **
mask
)

318 
GtkStyÀ
 *
°yÀ
;

320 
	`g_as£π
(
so
);

321 
	`g_as£π
(
pixm≠
);

322 
	`g_as£π
(
mask
);

324 
°yÀ
 = 
	`gtk_widgë_gë_°yÀ
(
∑ª¡
);

326 i‡(
so
->
pixm≠
 !
NULL
)

328 *
pixm≠
 =

329 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

330 
	`gtk_widgë_gë_cﬁ‹m≠
(
∑ª¡
),

331 
mask
,

332 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
],

333 
so
->
pixm≠
);

337 i‡(
so
->
pixm≠_fûe
 !
NULL
)

339 
GdkPixbuf
 *
pixbuf
;

340 
GEº‹
 *
îr‹
 = 
NULL
;

342 
pixbuf
 = 
	`gdk_pixbuf_√w_‰om_fûe
(
so
->
pixm≠_fûe
, &
îr‹
);

343 i‡(
pixbuf
 !
NULL
)

345 
width
 = 
	`gdk_pixbuf_gë_width
 (
pixbuf
);

346 
height
 = 
	`gdk_pixbuf_gë_height
 (
pixbuf
);

347 i‡(
width
 > 22)

349 
GdkPixbuf
 *
¸›≥d
;

350 
	`g_w¨nög
 ("Sh≠êic⁄ '%s' sizêwr⁄g, cr›≥d.", 
so
->
pixm≠_fûe
);

351 
¸›≥d
 = 
	`gdk_pixbuf_√w_subpixbuf
 (
pixbuf
,

352 (
width
 - 22Ë/ 2, 
height
 > 22 ? (height - 22) / 2 : 0,

353 22, 
height
 > 22 ? 22 : height);

354 
	`g_obje˘_uƒef
 (
pixbuf
);

355 
pixbuf
 = 
¸›≥d
;

357 
	`gdk_pixbuf_ªndî_pixm≠_™d_mask
(
pixbuf
, 
pixm≠
, 
mask
, 1.0);

358 
	`gdk_pixbuf_uƒef
(
pixbuf
);

360 
	`mesßge_w¨nög
 ("%s", 
îr‹
->
mesßge
);

361 
	`g_îr‹_‰ì
 (
îr‹
);

362 *
pixm≠
 = 
gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d


363 (
NULL
,

364 
	`gtk_widgë_gë_cﬁ‹m≠
(
∑ª¡
),

365 
mask
,

366 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
],

367 
missög
);

372 *
pixm≠
 = 
NULL
;

373 *
mask
 = 
NULL
;

376 
	}
}

378 
GtkWidgë
*

379 
	$lookup_widgë
 (
GtkWidgë
 *
widgë
,

380 c⁄° 
gch¨
 *
widgë_«me
)

382 
GtkWidgë
 *
∑ª¡
, *
found_widgë
;

386 i‡(
	`GTK_IS_MENU
 (
widgë
))

387 
∑ª¡
 = 
	`gtk_míu_gë_©èch_widgë
 (
	`GTK_MENU
 (
widgë
));

389 
∑ª¡
 = 
widgë
->parent;

390 i‡(
∑ª¡
 =
NULL
)

392 
widgë
 = 
∑ª¡
;

395 
found_widgë
 = (
GtkWidgë
*Ë
	`gtk_obje˘_gë_d©a
 (
	`GTK_OBJECT
 (
widgë
),

396 
widgë_«me
);

397 i‡(!
found_widgë
)

398 
	`g_w¨nög
 (
	`_
("WidgëÇŸ found: %s"), 
widgë_«me
);

399  
found_widgë
;

400 
	}
}

402 
	~"pixm≠s/n_a.xpm
"

403 
	~"pixm≠s/löe_bªak.xpm
"

408 
GtkWidgë
 *

409 
	$¸óã_pixm≠
(
GtkWidgë
 *
dülog
, 
gch¨
 *
fûíame
, 
gboﬁón
 
¨g3
)

411 
GdkPixm≠
 *
pixm≠
, *
mask
;

412 
GtkWidgë
 *
buâ⁄
;

413 
GtkWidgë
 *
wøpbox
;

414 
GLi°
 *
buâ⁄_li°
;

415 
ShìtObje˘Mod
 *
som
;

417 
buâ⁄
 = 
	`shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

418 
som
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
buâ⁄
), "sheet_object_mod");

420 i‡(
som
)

421 
	`¸óã_obje˘_pixm≠
(&
som
->
shìt_obje˘
, 
wøpbox
, &
pixm≠
, &
mask
);

424 
GtkStyÀ
 *
°yÀ
;

425 
gch¨
 **
ic⁄
;

427 
°yÀ
 = 
	`gtk_widgë_gë_°yÀ
(
wøpbox
);

429 i‡((
gboﬁón
)
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
buâ⁄
), "is_hidden_button")

430 =
TRUE
)

431 
ic⁄
 = 
n_a_xpm
;

433 
ic⁄
 = 
löe_bªak_xpm
;

435 
pixm≠
 =

436 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

437 
	`gtk_widgë_gë_cﬁ‹m≠
(
wøpbox
),

438 &
mask
,

439 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
],

440 
ic⁄
);

443  
	`gtk_pixm≠_√w
(
pixm≠
, 
mask
);

444 
	}
}

449 
	$shìts_dülog_show_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
, 
GtkWidgë
 *
widgë
)

451 
GtkWidgë
 *
wøpbox
;

452 
GtkWidgë
 *
›ti⁄_míu
;

454 i‡(!
shìts_dülog
)

455 
	`shìts_dülog_¸óã
();

456 i‡(!
shìts_dülog
)

459 
wøpbox
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
shìts_dülog
), "wrapbox_left");

460 
›ti⁄_míu
 = 
	`lookup_widgë
(
shìts_dülog
, "optionmenu_left");

461 
	`shìts_›ti⁄míu_¸óã
(
›ti⁄_míu
, 
wøpbox
, 
öãrÁ˚_cuºít_shìt_«me
);

463 
	`g_as£π
(
	`GTK_IS_WIDGET
(
shìts_dülog
));

464 
	`gtk_widgë_show
(
shìts_dülog
);

465 
	}
}

467 
gch¨
 *

468 
	$shìt_obje˘_mod_gë_ty≥_°rög
(
ShìtObje˘Mod
 *
som
)

470 
som
->
ty≥
)

472 
OBJECT_TYPE_SVG
:

473  
	`_
("SVG Shape");

474 
OBJECT_TYPE_PROGRAMMED
:

475  
	`_
("Programmed DiaObject");

477 
	`g_as£π_nŸ_ªached
();

480 
	}
}

	@O:\tool\dvs50\app\sheets.h

23 #i‚de‡
SHEETS_H


25 #ifde‡
GNOME


26 
	~<gnome.h
>

28 
	~<gtk/gtk.h
>

31 
	~"../lib/shìt.h
"

33 
	~"shìts_dülog_ˇŒbacks.h
"

41 
_ShìtObje˘Mod
 
	tShìtObje˘Mod
;

42 
_ShìtMod
 
	tShìtMod
;

44 
	s_ShìtObje˘Mod


46 
ShìtObje˘
 
	mshìt_obje˘
;

48 íum { 
	mOBJECT_TYPE_SVG
,

49 
	mOBJECT_TYPE_PROGRAMMED
,

50 
	mOBJECT_TYPE_UNASSIGNED
 } 
	mty≥
;

52 íum { 
	mSHEET_OBJECT_MOD_NONE
,

53 
	mSHEET_OBJECT_MOD_NEW
,

54 
	mSHEET_OBJECT_MOD_CHANGED
,

55 
	mSHEET_OBJECT_MOD_DELETED
 } 
	mmod
;

57 
gch¨
 *
	msvg_fûíame
;

60 
	s_ShìtMod


62 
Shìt
 
	mshìt
;

64 íum { 
	mSHEETMOD_TYPE_NORMAL
,

65 
	mSHEETMOD_TYPE_UNASSIGNED
 } 
	mty≥
;

67 íum { 
	mSHEETMOD_MOD_NONE
,

68 
	mSHEETMOD_MOD_NEW
,

69 
	mSHEETMOD_MOD_CHANGED
,

70 
	mSHEETMOD_MOD_DELETED
 } 
	mmod
;

73 
GtkWidgë
 *
shìts_dülog
;

74 
GtkWidgë
 *
shìts_dülog_›ti⁄míu_míu
;

75 #i‚de‡
GTK_DISABLE_DEPRECATED


76 
GtkToﬁtùs
 *
shìts_dülog_toﬁtùs
;

79 
ShìtObje˘Mod
 *
shìts_≠≥nd_shìt_obje˘_mod
(
ShìtObje˘
 *
so
, 
ShìtMod
 *
sm
);

80 
ShìtMod
 *
shìts_≠≥nd_shìt_mods
(
Shìt
 *
shìt
);

81 
shìts_›ti⁄míu_¸óã
(
GtkWidgë
 *
›ti⁄_míu
, GtkWidgë *
wøpbox
,

82 
gch¨
 *
shìt_«me
);

83 
¸óã_obje˘_pixm≠
(
ShìtObje˘
 *
so
, 
GtkWidgë
 *
∑ª¡
,

84 
GdkPixm≠
 **
pixm≠
, 
GdkBôm≠
 **
mask
);

86 
gch¨
 *
shìt_obje˘_mod_gë_ty≥_°rög
(
ShìtObje˘Mod
 *
som
);

88 
gboﬁón
 
shìts_dülog_¸óã
();

89 
shìts_dülog_show_ˇŒback
(
gpoöãr
 
d©a
, 
guöt
 
a˘i⁄
,

90 
GtkWidgë
 *
widgë
);

91 
GtkWidgë
 *
lookup_widgë
(GtkWidgë *
widgë
,

92 c⁄° 
gch¨
 *
widgë_«me
);

93 
GtkWidgë
 *
¸óã_pixm≠
(GtkWidgë *
dülog
, 
gch¨
 *
fûíame
, 
gboﬁón
 
¨g3
);

	@O:\tool\dvs50\app\sheets_dialog.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~<c⁄fig.h
>

33 
	~<sys/ty≥s.h
>

34 #ifde‡
HAVE_UNISTD_H


35 
	~<uni°d.h
>

37 
	~<°rög.h
>

39 #unde‡
GTK_DISABLE_DEPRECATED


40 
	~<gtk/gtk.h
>

41 
	~<gdk/gdkkeysyms.h
>

43 
	~"shìts.h
"

44 
	~"shìts_dülog_ˇŒbacks.h
"

45 
	~"shìts_dülog.h
"

47 
	~"öé.h
"

48 
	~"≥rsi°í˚.h
"

50 
GtkWidgë
*

51 
	$¸óã_shìts_maö_dülog
 ()

53 
GtkWidgë
 *
shìts_maö_dülog
;

54 
GtkWidgë
 *
dülog_vbox1
;

55 
GtkWidgë
 *
èbÀ_shìts
;

56 
GtkWidgë
 *
vbuâ⁄box
;

57 
GtkWidgë
 *
buâ⁄_c›y
;

58 
GtkWidgë
 *
buâ⁄_c›y_Æl
;

59 
GtkWidgë
 *
buâ⁄_move
;

60 
GtkWidgë
 *
buâ⁄_move_Æl
;

61 
GtkWidgë
 *
›ti⁄míu_right
;

62 
GtkWidgë
 *
›ti⁄míu_right_míu
;

63 
GtkWidgë
 *
›ti⁄míu_À·
;

64 
GtkWidgë
 *
›ti⁄míu_À·_míu
;

65 
GtkWidgë
 *
gœde_míuôem
;

66 
GtkWidgë
 *
s¸ﬁÀdwödow_À·
;

67 
GtkWidgë
 *
s¸ﬁÀdwödow_right
;

68 
GtkWidgë
 *
dülog_a˘i⁄_¨ó1
;

69 
GtkWidgë
 *
hbox1
;

70 
GtkWidgë
 *
buâ⁄_√w
;

71 
GtkWidgë
 *
buâ⁄_move_up
;

72 
GtkWidgë
 *
buâ⁄_move_down
;

73 
GtkWidgë
 *
buâ⁄_edô
;

74 
GtkWidgë
 *
buâ⁄_ªmove
;

75 
GtkWidgë
 *
buâ⁄_≠∂y
;

76 
GtkWidgë
 *
buâ⁄_ªvît
;

77 
GtkWidgë
 *
buâ⁄_˛o£
;

78 
GtkAc˚lGroup
 *
ac˚l_group
;

80 
ac˚l_group
 = 
	`gtk_ac˚l_group_√w
 ();

82 
shìts_maö_dülog
 = 
	`gtk_dülog_√w
 ();

83 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "sheets_main_dialog", sheets_main_dialog);

84 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
shìts_maö_dülog
), 
	`_
("Sheetsánd Objects"));

85 
	`gtk_wödow_£t_rﬁe
(
	`GTK_WINDOW
(
shìts_maö_dülog
), "sheets_main_dialog");

86 
	`gtk_wödow_£t_deÁu…_size
 (
	`GTK_WINDOW
 (
shìts_maö_dülog
), 506, 261);

87 
	`gtk_wödow_£t_ªsizabÀ
 (
	`GTK_WINDOW
 (
shìts_maö_dülog
), 
TRUE
);

89 
dülog_vbox1
 = 
	`GTK_DIALOG
 (
shìts_maö_dülog
)->
vbox
;

90 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "dülog_vbox1", 
dülog_vbox1
);

91 
	`gtk_widgë_show
 (
dülog_vbox1
);

93 
èbÀ_shìts
 = 
	`gtk_èbÀ_√w
 (2, 3, 
FALSE
);

94 
	`gtk_widgë_ªf
 (
èbÀ_shìts
);

95 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "èbÀ_shìts", 
èbÀ_shìts
,

96 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

97 
	`gtk_widgë_show
 (
èbÀ_shìts
);

98 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
dülog_vbox1
), 
èbÀ_shìts
, 
TRUE
, TRUE, 0);

100 
vbuâ⁄box
 = 
	`gtk_vbuâ⁄_box_√w
 ();

101 
	`gtk_widgë_ªf
 (
vbuâ⁄box
);

102 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "vbuâ⁄box", 
vbuâ⁄box
,

103 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

104 
	`gtk_widgë_show
 (
vbuâ⁄box
);

105 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ_shìts
), 
vbuâ⁄box
, 1, 2, 1, 2,

106 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

107 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
), 17, 0);

108 
	`gtk_buâ⁄_box_£t_œyout
 (
	`GTK_BUTTON_BOX
 (
vbuâ⁄box
), 
GTK_BUTTONBOX_SPREAD
);

110 
buâ⁄_c›y
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
 (
	`_
("<- Copy"));

111 
	`gtk_widgë_ªf
 (
buâ⁄_c›y
);

112 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_c›y", 
buâ⁄_c›y
,

113 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

114 
	`gtk_widgë_show
 (
buâ⁄_c›y
);

115 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
vbuâ⁄box
), 
buâ⁄_c›y
);

116 
	`gtk_widgë_add_ac˚Àøt‹
 (
buâ⁄_c›y
, "˛icked", 
ac˚l_group
,

117 
GDK_c
, 
GDK_CONTROL_MASK
,

118 
GTK_ACCEL_VISIBLE
);

120 
buâ⁄_c›y_Æl
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
 (
	`_
("<- Copy All"));

121 
	`gtk_widgë_ªf
 (
buâ⁄_c›y_Æl
);

122 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_c›y_Æl", 
buâ⁄_c›y_Æl
,

123 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

124 
	`gtk_widgë_show
 (
buâ⁄_c›y_Æl
);

125 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
vbuâ⁄box
), 
buâ⁄_c›y_Æl
);

127 
buâ⁄_move
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
 (
	`_
("<- Move"));

128 
	`gtk_widgë_ªf
 (
buâ⁄_move
);

129 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_move", 
buâ⁄_move
,

130 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

131 
	`gtk_widgë_show
 (
buâ⁄_move
);

132 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
vbuâ⁄box
), 
buâ⁄_move
);

133 
	`gtk_widgë_add_ac˚Àøt‹
 (
buâ⁄_move
, "˛icked", 
ac˚l_group
,

134 
GDK_m
, 
GDK_CONTROL_MASK
,

135 
GTK_ACCEL_VISIBLE
);

137 
buâ⁄_move_Æl
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
 (
	`_
("<- Move All"));

138 
	`gtk_widgë_ªf
 (
buâ⁄_move_Æl
);

139 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_move_Æl", 
buâ⁄_move_Æl
,

140 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

141 
	`gtk_widgë_show
 (
buâ⁄_move_Æl
);

142 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
vbuâ⁄box
), 
buâ⁄_move_Æl
);

144 
›ti⁄míu_right
 = 
	`gtk_›ti⁄_míu_√w
 ();

145 
	`gtk_widgë_ªf
 (
›ti⁄míu_right
);

146 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "›ti⁄míu_right", 
›ti⁄míu_right
,

147 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

148 
	`gtk_widgë_show
 (
›ti⁄míu_right
);

149 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ_shìts
), 
›ti⁄míu_right
, 2, 3, 0, 1,

150 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

151 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
), 0, 0);

152 
›ti⁄míu_right_míu
 = 
	`gtk_míu_√w
 ();

153 
	`gtk_›ti⁄_míu_£t_míu
 (
	`GTK_OPTION_MENU
 (
›ti⁄míu_right
), 
›ti⁄míu_right_míu
);

155 
›ti⁄míu_À·
 = 
	`gtk_›ti⁄_míu_√w
 ();

156 
	`gtk_widgë_ªf
 (
›ti⁄míu_À·
);

157 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "›ti⁄míu_À·", 
›ti⁄míu_À·
,

158 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

159 
	`gtk_widgë_show
 (
›ti⁄míu_À·
);

160 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ_shìts
), 
›ti⁄míu_À·
, 0, 1, 0, 1,

161 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

162 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
), 0, 0);

163 
›ti⁄míu_À·_míu
 = 
	`gtk_míu_√w
 ();

164 
gœde_míuôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
 ("");

165 
	`gtk_widgë_show
 (
gœde_míuôem
);

166 
	`gtk_míu_≠≥nd
 (
	`GTK_MENU
 (
›ti⁄míu_À·_míu
), 
gœde_míuôem
);

167 
	`gtk_›ti⁄_míu_£t_míu
 (
	`GTK_OPTION_MENU
 (
›ti⁄míu_À·
), 
›ti⁄míu_À·_míu
);

169 
s¸ﬁÀdwödow_À·
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

170 
	`gtk_widgë_ªf
 (
s¸ﬁÀdwödow_À·
);

171 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "s¸ﬁÀdwödow_À·", 
s¸ﬁÀdwödow_À·
,

172 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

173 
	`gtk_widgë_show
 (
s¸ﬁÀdwödow_À·
);

174 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ_shìts
), 
s¸ﬁÀdwödow_À·
, 0, 1, 1, 2,

175 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

176 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
), 0, 0);

177 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀdwödow_À·
), 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

179 
s¸ﬁÀdwödow_right
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

180 
	`gtk_widgë_ªf
 (
s¸ﬁÀdwödow_right
);

181 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "s¸ﬁÀdwödow_right", 
s¸ﬁÀdwödow_right
,

182 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

183 
	`gtk_widgë_show
 (
s¸ﬁÀdwödow_right
);

184 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ_shìts
), 
s¸ﬁÀdwödow_right
, 2, 3, 1, 2,

185 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

186 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
), 0, 0);

187 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀdwödow_right
), 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

189 
dülog_a˘i⁄_¨ó1
 = 
	`GTK_DIALOG
 (
shìts_maö_dülog
)->
a˘i⁄_¨ó
;

190 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "dülog_a˘i⁄_¨ó1", 
dülog_a˘i⁄_¨ó1
);

191 
	`gtk_widgë_show
 (
dülog_a˘i⁄_¨ó1
);

192 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
dülog_a˘i⁄_¨ó1
), 10);

194 
hbox1
 = 
	`gtk_hbox_√w
 (
TRUE
, 0);

195 
	`gtk_widgë_ªf
 (
hbox1
);

196 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "hbox1", 
hbox1
,

197 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

198 
	`gtk_widgë_show
 (
hbox1
);

199 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
dülog_a˘i⁄_¨ó1
), 
hbox1
, 
TRUE
, TRUE, 0);

201 
buâ⁄_√w
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_NEW
);

202 
	`gtk_widgë_ªf
 (
buâ⁄_√w
);

203 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_√w", 
buâ⁄_√w
,

204 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

205 
	`gtk_widgë_show
 (
buâ⁄_√w
);

206 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox1
), 
buâ⁄_√w
, 
FALSE
, 
TRUE
, 0);

207 
	`gtk_widgë_add_ac˚Àøt‹
 (
buâ⁄_√w
, "˛icked", 
ac˚l_group
,

208 
GDK_n
, 
GDK_CONTROL_MASK
,

209 
GTK_ACCEL_VISIBLE
);

211 
buâ⁄_move_up
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_UP
);

212 
	`gtk_widgë_ªf
 (
buâ⁄_move_up
);

213 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_move_up", 
buâ⁄_move_up
,

214 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

215 
	`gtk_widgë_show
 (
buâ⁄_move_up
);

216 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox1
), 
buâ⁄_move_up
, 
FALSE
, 
TRUE
, 0);

217 
	`gtk_widgë_add_ac˚Àøt‹
 (
buâ⁄_move_up
, "˛icked", 
ac˚l_group
,

218 
GDK_u
, 
GDK_CONTROL_MASK
,

219 
GTK_ACCEL_VISIBLE
);

220 
buâ⁄_move_down
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_DOWN
);

221 
	`gtk_widgë_ªf
 (
buâ⁄_move_down
);

222 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_move_down", 
buâ⁄_move_down
,

223 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

224 
	`gtk_widgë_show
 (
buâ⁄_move_down
);

225 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox1
), 
buâ⁄_move_down
, 
FALSE
, 
TRUE
, 0);

226 
	`gtk_widgë_add_ac˚Àøt‹
 (
buâ⁄_move_down
, "˛icked", 
ac˚l_group
,

227 
GDK_d
, 
GDK_CONTROL_MASK
,

228 
GTK_ACCEL_VISIBLE
);

230 
buâ⁄_edô
 = 
	`gtk_buâ⁄_√w
();

232 
GtkWidgë
 *
œbñ
;

234 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Edit"));

235 
	`gtk_widgë_ªf
(
œbñ
);

236 
	`gtk_œbñ_∑r£_ulöe
(
	`GTK_LABEL
(
œbñ
), 
	`_
("_Edit"));

237 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
buâ⁄_edô
), 
œbñ
);

238 
	`gtk_widgë_show
(
œbñ
);

240 
	`gtk_widgë_ªf
 (
buâ⁄_edô
);

241 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_edô", 
buâ⁄_edô
,

242 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

243 
	`gtk_widgë_show
 (
buâ⁄_edô
);

244 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox1
), 
buâ⁄_edô
, 
FALSE
, 
TRUE
, 0);

245 
	`gtk_widgë_add_ac˚Àøt‹
 (
buâ⁄_edô
, "˛icked", 
ac˚l_group
,

246 
GDK_e
, 
GDK_CONTROL_MASK
,

247 
GTK_ACCEL_VISIBLE
);

249 
buâ⁄_ªmove
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_REMOVE
);

250 
	`gtk_widgë_ªf
 (
buâ⁄_ªmove
);

251 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_ªmove", 
buâ⁄_ªmove
,

252 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

253 
	`gtk_widgë_show
 (
buâ⁄_ªmove
);

254 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox1
), 
buâ⁄_ªmove
, 
FALSE
, 
TRUE
, 0);

255 
	`gtk_widgë_add_ac˚Àøt‹
 (
buâ⁄_ªmove
, "˛icked", 
ac˚l_group
,

256 
GDK_r
, 
GDK_CONTROL_MASK
,

257 
GTK_ACCEL_VISIBLE
);

259 
buâ⁄_≠∂y
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_APPLY
);

260 
	`gtk_widgë_ªf
 (
buâ⁄_≠∂y
);

261 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_≠∂y", 
buâ⁄_≠∂y
,

262 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

263 
	`gtk_widgë_show
 (
buâ⁄_≠∂y
);

264 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox1
), 
buâ⁄_≠∂y
, 
FALSE
, 
TRUE
, 0);

265 
	`gtk_widgë_£t_£nsôive
 (
buâ⁄_≠∂y
, 
FALSE
);

267 
buâ⁄_ªvît
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
(
	`_
("Revert"));

268 
	`gtk_widgë_ªf
 (
buâ⁄_ªvît
);

269 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_ªvît", 
buâ⁄_ªvît
,

270 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

271 
	`gtk_widgë_show
 (
buâ⁄_ªvît
);

272 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox1
), 
buâ⁄_ªvît
, 
FALSE
, 
TRUE
, 0);

273 
	`gtk_widgë_£t_£nsôive
 (
buâ⁄_ªvît
, 
FALSE
);

275 
buâ⁄_˛o£
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_CLOSE
);

276 
	`gtk_widgë_ªf
 (
buâ⁄_˛o£
);

277 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "buâ⁄_˛o£", 
buâ⁄_˛o£
,

278 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

279 
	`gtk_widgë_show
 (
buâ⁄_˛o£
);

280 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox1
), 
buâ⁄_˛o£
, 
FALSE
, 
TRUE
, 0);

282 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
shìts_maö_dülog
), "delete_event",

283 
	`G_CALLBACK
 (
⁄_shìts_maö_dülog_dñëe_evít
),

284 
NULL
);

285 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_c›y
), "clicked",

286 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_c›y_˛icked
),

287 
NULL
);

288 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_c›y_Æl
), "clicked",

289 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_c›y_Æl_˛icked
),

290 
NULL
);

291 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_move
), "clicked",

292 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_move_˛icked
),

293 
NULL
);

294 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_move_Æl
), "clicked",

295 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_move_Æl_˛icked
),

296 
NULL
);

297 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_√w
), "clicked",

298 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_√w_˛icked
),

299 
NULL
);

300 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_move_up
), "clicked",

301 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_move_up_˛icked
),

302 
NULL
);

303 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_move_down
), "clicked",

304 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_move_down_˛icked
),

305 
NULL
);

306 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_edô
), "clicked",

307 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_edô_˛icked
),

308 
NULL
);

309 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_ªmove
), "clicked",

310 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_ªmove_˛icked
),

311 
NULL
);

312 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_≠∂y
), "clicked",

313 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_≠∂y_˛icked
),

314 
NULL
);

315 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_ªvît
), "clicked",

316 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_ªvît_˛icked
),

317 
NULL
);

318 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_˛o£
), "clicked",

319 
	`G_CALLBACK
 (
⁄_shìts_dülog_buâ⁄_˛o£_˛icked
),

320 
NULL
);

322 
	`gtk_wödow_add_ac˚l_group
 (
	`GTK_WINDOW
 (
shìts_maö_dülog
), 
ac˚l_group
);

324 
	`≥rsi°í˚_ªgi°î_wödow
(
	`GTK_WINDOW
(
shìts_maö_dülog
));

326  
shìts_maö_dülog
;

327 
	}
}

329 
GtkWidgë
*

330 
	$¸óã_shìts_√w_dülog
 ()

332 
GtkWidgë
 *
shìts_√w_dülog
;

333 
GtkWidgë
 *
dülog_vbox2
;

334 
GtkWidgë
 *
Ty≥fg
;

335 
GtkWidgë
 *
èbÀ1
;

336 
GtkWidgë
 *
buâ⁄_brow£
;

337 
GSLi°
 *
èbÀ1_group
 = 
NULL
;

338 
GtkWidgë
 *
ødiobuâ⁄_svg_sh≠e
;

339 
GtkWidgë
 *
combo_‰om_fûe
;

340 
GtkWidgë
 *
combo_íåy_‰om_fûe
;

341 
GtkWidgë
 *
œbñ_des¸ùti⁄
;

342 
GtkWidgë
 *
ødiobuâ⁄_shìt
;

343 
GtkWidgë
 *
íåy_shìt_«me
;

344 
GtkWidgë
 *
ødiobuâ⁄_löe_bªak
;

345 
GtkWidgë
 *
íåy_svg_des¸ùti⁄
;

346 
GtkWidgë
 *
íåy_shìt_des¸ùti⁄
;

347 
GtkWidgë
 *
œbñ_svg_des¸ùti⁄
;

348 
GtkWidgë
 *
dülog_a˘i⁄_¨ó2
;

349 
GtkWidgë
 *
hbuâ⁄box1
;

350 
GtkWidgë
 *
buâ⁄_ok
;

351 
GtkWidgë
 *
buâ⁄_ˇn˚l
;

353 
shìts_√w_dülog
 = 
	`gtk_dülog_√w
 ();

354 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "sheets_new_dialog", sheets_new_dialog);

355 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
shìts_√w_dülog
), 
	`_
("New"));

356 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
shìts_√w_dülog
), "sheets_new_dialog");

357 
	`gtk_wödow_£t_ªsizabÀ
 (
	`GTK_WINDOW
 (
shìts_√w_dülog
), 
FALSE
);

359 
dülog_vbox2
 = 
	`GTK_DIALOG
 (
shìts_√w_dülog
)->
vbox
;

360 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "dülog_vbox2", 
dülog_vbox2
);

361 
	`gtk_widgë_show
 (
dülog_vbox2
);

363 
Ty≥fg
 = 
	`gtk_‰ame_√w
 (
	`_
("Type"));

364 
	`gtk_widgë_ªf
 (
Ty≥fg
);

365 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "Ty≥fg", 
Ty≥fg
,

366 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

367 
	`gtk_widgë_show
 (
Ty≥fg
);

368 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
dülog_vbox2
), 
Ty≥fg
, 
TRUE
, TRUE, 0);

369 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
Ty≥fg
), 5);

371 
èbÀ1
 = 
	`gtk_èbÀ_√w
 (5, 4, 
FALSE
);

372 
	`gtk_widgë_ªf
 (
èbÀ1
);

373 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "èbÀ1", 
èbÀ1
,

374 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

375 
	`gtk_widgë_show
 (
èbÀ1
);

376 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
Ty≥fg
), 
èbÀ1
);

378 
buâ⁄_brow£
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
 (
	`_
("Browse..."));

379 
	`gtk_widgë_ªf
 (
buâ⁄_brow£
);

380 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "buâ⁄_brow£", 
buâ⁄_brow£
,

381 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

382 
	`gtk_widgë_show
 (
buâ⁄_brow£
);

383 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
buâ⁄_brow£
, 3, 4, 0, 1,

384 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

385 (
GtkAâachO±i⁄s
) (0), 3, 0);

387 
ødiobuâ⁄_svg_sh≠e
 = 
	`gtk_ødio_buâ⁄_√w_wôh_œbñ
 (
èbÀ1_group
, 
	`_
("SVG Shape:"));

388 
èbÀ1_group
 = 
	`gtk_ødio_buâ⁄_group
 (
	`GTK_RADIO_BUTTON
 (
ødiobuâ⁄_svg_sh≠e
));

389 
	`gtk_widgë_ªf
 (
ødiobuâ⁄_svg_sh≠e
);

390 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "ødiobuâ⁄_svg_sh≠e", 
ødiobuâ⁄_svg_sh≠e
,

391 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

392 
	`gtk_widgë_show
 (
ødiobuâ⁄_svg_sh≠e
);

393 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
ødiobuâ⁄_svg_sh≠e
, 0, 1, 0, 1,

394 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

395 (
GtkAâachO±i⁄s
) (0), 0, 0);

396 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
 (
	`GTK_TOGGLE_BUTTON
 (
ødiobuâ⁄_svg_sh≠e
), 
TRUE
);

398 
combo_‰om_fûe
 = 
	`gtk_combo_√w
 ();

399 
	`gtk_widgë_ªf
 (
combo_‰om_fûe
);

400 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "combo_‰om_fûe", 
combo_‰om_fûe
,

401 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

402 
	`gtk_widgë_show
 (
combo_‰om_fûe
);

403 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
combo_‰om_fûe
, 1, 3, 0, 1,

404 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

405 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
), 0, 0);

406 
	`gtk_combo_£t_ˇ£_£nsôive
 (
	`GTK_COMBO
 (
combo_‰om_fûe
), 
TRUE
);

408 
combo_íåy_‰om_fûe
 = 
	`GTK_COMBO
 (
combo_‰om_fûe
)->
íåy
;

409 
	`gtk_widgë_ªf
 (
combo_íåy_‰om_fûe
);

410 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "combo_íåy_‰om_fûe", 
combo_íåy_‰om_fûe
,

411 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

412 
	`gtk_widgë_show
 (
combo_íåy_‰om_fûe
);

414 
œbñ_des¸ùti⁄
 = 
	`gtk_œbñ_√w
 (
	`_
("description:"));

415 
	`gtk_widgë_ªf
 (
œbñ_des¸ùti⁄
);

416 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "œbñ_des¸ùti⁄", 
œbñ_des¸ùti⁄
,

417 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

418 
	`gtk_widgë_show
 (
œbñ_des¸ùti⁄
);

419 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
œbñ_des¸ùti⁄
, 0, 1, 4, 5,

420 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

421 (
GtkAâachO±i⁄s
) (0), 0, 0);

422 
	`gtk_widgë_£t_£nsôive
 (
œbñ_des¸ùti⁄
, 
FALSE
);

423 
	`gtk_œbñ_£t_ju°ify
 (
	`GTK_LABEL
 (
œbñ_des¸ùti⁄
), 
GTK_JUSTIFY_RIGHT
);

424 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ_des¸ùti⁄
), 0.77, 0.5);

426 
ødiobuâ⁄_shìt
 = 
	`gtk_ødio_buâ⁄_√w_wôh_œbñ
 (
èbÀ1_group
, 
	`_
("SheetÇame:"));

427 
èbÀ1_group
 = 
	`gtk_ødio_buâ⁄_group
 (
	`GTK_RADIO_BUTTON
 (
ødiobuâ⁄_shìt
));

428 
	`gtk_widgë_ªf
 (
ødiobuâ⁄_shìt
);

429 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "ødiobuâ⁄_shìt", 
ødiobuâ⁄_shìt
,

430 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

431 
	`gtk_widgë_show
 (
ødiobuâ⁄_shìt
);

432 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
ødiobuâ⁄_shìt
, 0, 1, 3, 4,

433 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

434 (
GtkAâachO±i⁄s
) (0), 0, 0);

436 
íåy_shìt_«me
 = 
	`gtk_íåy_√w
 ();

437 
	`gtk_widgë_ªf
 (
íåy_shìt_«me
);

438 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "íåy_shìt_«me", 
íåy_shìt_«me
,

439 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

440 
	`gtk_widgë_show
 (
íåy_shìt_«me
);

441 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
íåy_shìt_«me
, 1, 3, 3, 4,

442 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

443 (
GtkAâachO±i⁄s
) (0), 0, 0);

444 
	`gtk_widgë_£t_usize
 (
íåy_shìt_«me
, 255, -2);

445 
	`gtk_widgë_£t_£nsôive
 (
íåy_shìt_«me
, 
FALSE
);

447 
ødiobuâ⁄_löe_bªak
 = 
	`gtk_ødio_buâ⁄_√w_wôh_œbñ
 (
èbÀ1_group
, 
	`_
("Line Break"));

448 
èbÀ1_group
 = 
	`gtk_ødio_buâ⁄_group
 (
	`GTK_RADIO_BUTTON
 (
ødiobuâ⁄_löe_bªak
));

449 
	`gtk_widgë_ªf
 (
ødiobuâ⁄_löe_bªak
);

450 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "ødiobuâ⁄_löe_bªak", 
ødiobuâ⁄_löe_bªak
,

451 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

452 
	`gtk_widgë_show
 (
ødiobuâ⁄_löe_bªak
);

453 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
ødiobuâ⁄_löe_bªak
, 0, 1, 2, 3,

454 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

455 (
GtkAâachO±i⁄s
) (0), 0, 0);

457 
íåy_svg_des¸ùti⁄
 = 
	`gtk_íåy_√w
 ();

458 
	`gtk_widgë_ªf
 (
íåy_svg_des¸ùti⁄
);

459 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "íåy_svg_des¸ùti⁄", 
íåy_svg_des¸ùti⁄
,

460 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

461 
	`gtk_widgë_show
 (
íåy_svg_des¸ùti⁄
);

462 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
íåy_svg_des¸ùti⁄
, 1, 3, 1, 2,

463 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

464 (
GtkAâachO±i⁄s
) (0), 0, 0);

466 
íåy_shìt_des¸ùti⁄
 = 
	`gtk_íåy_√w
 ();

467 
	`gtk_widgë_ªf
 (
íåy_shìt_des¸ùti⁄
);

468 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "íåy_shìt_des¸ùti⁄", 
íåy_shìt_des¸ùti⁄
,

469 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

470 
	`gtk_widgë_show
 (
íåy_shìt_des¸ùti⁄
);

471 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
íåy_shìt_des¸ùti⁄
, 1, 3, 4, 5,

472 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

473 (
GtkAâachO±i⁄s
) (0), 0, 0);

474 
	`gtk_widgë_£t_usize
 (
íåy_shìt_des¸ùti⁄
, 255, -2);

475 
	`gtk_widgë_£t_£nsôive
 (
íåy_shìt_des¸ùti⁄
, 
FALSE
);

477 
œbñ_svg_des¸ùti⁄
 = 
	`gtk_œbñ_√w
 (
	`_
("description:"));

478 
	`gtk_widgë_ªf
 (
œbñ_svg_des¸ùti⁄
);

479 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "œbñ_svg_des¸ùti⁄", 
œbñ_svg_des¸ùti⁄
,

480 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

481 
	`gtk_widgë_show
 (
œbñ_svg_des¸ùti⁄
);

482 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ1
), 
œbñ_svg_des¸ùti⁄
, 0, 1, 1, 2,

483 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

484 (
GtkAâachO±i⁄s
) (0), 0, 0);

485 
	`gtk_œbñ_£t_ju°ify
 (
	`GTK_LABEL
 (
œbñ_svg_des¸ùti⁄
), 
GTK_JUSTIFY_RIGHT
);

486 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ_svg_des¸ùti⁄
), 0.77, 0.5);

488 
dülog_a˘i⁄_¨ó2
 = 
	`GTK_DIALOG
 (
shìts_√w_dülog
)->
a˘i⁄_¨ó
;

489 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "dülog_a˘i⁄_¨ó2", 
dülog_a˘i⁄_¨ó2
);

490 
	`gtk_widgë_show
 (
dülog_a˘i⁄_¨ó2
);

491 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
dülog_a˘i⁄_¨ó2
), 10);

493 
hbuâ⁄box1
 = 
	`gtk_hbuâ⁄_box_√w
 ();

494 
	`gtk_widgë_ªf
 (
hbuâ⁄box1
);

495 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "hbuâ⁄box1", 
hbuâ⁄box1
,

496 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

497 
	`gtk_widgë_show
 (
hbuâ⁄box1
);

498 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
dülog_a˘i⁄_¨ó2
), 
hbuâ⁄box1
, 
TRUE
, TRUE, 0);

499 
	`gtk_buâ⁄_box_£t_œyout
 (
	`GTK_BUTTON_BOX
 (
hbuâ⁄box1
), 
GTK_BUTTONBOX_END
);

500 
	`gtk_buâ⁄_box_£t_•acög
 (
	`GTK_BUTTON_BOX
 (
hbuâ⁄box1
), 0);

502 
buâ⁄_ok
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_OK
);

503 
	`gtk_widgë_ªf
 (
buâ⁄_ok
);

504 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "buâ⁄_ok", 
buâ⁄_ok
,

505 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

506 
	`gtk_widgë_show
 (
buâ⁄_ok
);

507 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
hbuâ⁄box1
), 
buâ⁄_ok
);

508 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄_ok
, 
GTK_CAN_DEFAULT
);

510 
buâ⁄_ˇn˚l
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_CANCEL
);

511 
	`gtk_widgë_ªf
 (
buâ⁄_ˇn˚l
);

512 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_√w_dülog
), "buâ⁄_ˇn˚l", 
buâ⁄_ˇn˚l
,

513 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

514 
	`gtk_widgë_show
 (
buâ⁄_ˇn˚l
);

515 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
hbuâ⁄box1
), 
buâ⁄_ˇn˚l
);

516 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄_ˇn˚l
, 
GTK_CAN_DEFAULT
);

518 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_brow£
), "clicked",

519 
	`G_CALLBACK
 (
⁄_shìts_√w_dülog_buâ⁄_brow£_˛icked
),

520 
NULL
);

521 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ødiobuâ⁄_svg_sh≠e
), "toggled",

522 
	`G_CALLBACK
 (
⁄_shìts_√w_dülog_ødiobuâ⁄_svg_sh≠e_toggÀd
),

523 
NULL
);

524 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ødiobuâ⁄_shìt
), "toggled",

525 
	`G_CALLBACK
 (
⁄_shìts_√w_dülog_ødiobuâ⁄_shìt_toggÀd
),

526 
NULL
);

527 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ødiobuâ⁄_löe_bªak
), "toggled",

528 
	`G_CALLBACK
 (
⁄_shìts_√w_dülog_ødiobuâ⁄_löe_bªak_toggÀd
),

529 
NULL
);

530 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_ok
), "clicked",

531 
	`G_CALLBACK
 (
⁄_shìts_√w_dülog_buâ⁄_ok_˛icked
),

532 
NULL
);

533 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_ˇn˚l
), "clicked",

534 
	`G_CALLBACK
 (
⁄_shìts_√w_dülog_buâ⁄_ˇn˚l_˛icked
),

535 
NULL
);

537 
	`gtk_widgë_gøb_deÁu…
 (
buâ⁄_ok
);

538  
shìts_√w_dülog
;

539 
	}
}

541 
GtkWidgë
*

542 
	$¸óã_shìts_edô_dülog
 ()

544 
GtkWidgë
 *
shìts_edô_dülog
;

545 
GtkWidgë
 *
dülog_vbox3
;

546 
GtkWidgë
 *
vbox1
;

547 
GtkWidgë
 *
‰ame_obje˘
;

548 
GtkWidgë
 *
èbÀ6
;

549 
GtkWidgë
 *
œbñ_obje˘_des¸ùti⁄
;

550 
GtkWidgë
 *
íåy_obje˘_des¸ùti⁄
;

551 
GtkWidgë
 *
œbñ_obje˘_ty≥
;

552 
GtkWidgë
 *
íåy_obje˘_ty≥
;

553 
GtkWidgë
 *
‰ame_obje˘_pixm≠
;

554 
GtkWidgë
 *
pixm≠_obje˘
;

555 
GtkWidgë
 *
‰ame_shìt
;

556 
GtkWidgë
 *
èbÀ3
;

557 
GtkWidgë
 *
œbñ_shìt_«me
;

558 
GtkWidgë
 *
íåy_shìt_des¸ùti⁄
;

559 
GtkWidgë
 *
œbñ_shìt_des¸ùti⁄
;

560 
GtkWidgë
 *
íåy_shìt_«me
;

561 
GtkWidgë
 *
dülog_a˘i⁄_¨ó3
;

562 
GtkWidgë
 *
hbuâ⁄box2
;

563 
GtkWidgë
 *
buâ⁄_ok
;

564 
GtkWidgë
 *
buâ⁄_ˇn˚l
;

566 
shìts_edô_dülog
 = 
	`gtk_dülog_√w
 ();

567 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "sheets_edit_dialog", sheets_edit_dialog);

568 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
shìts_edô_dülog
), 5);

569 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
shìts_edô_dülog
), 
	`_
("Edit Attributes"));

570 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
shìts_edô_dülog
), "sheets_edit_dialog");

571 
	`gtk_wödow_£t_ªsizabÀ
 (
	`GTK_WINDOW
 (
shìts_edô_dülog
), 
FALSE
);

573 
dülog_vbox3
 = 
	`GTK_DIALOG
 (
shìts_edô_dülog
)->
vbox
;

574 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "dülog_vbox3", 
dülog_vbox3
);

575 
	`gtk_widgë_show
 (
dülog_vbox3
);

577 
vbox1
 = 
	`gtk_vbox_√w
 (
FALSE
, 0);

578 
	`gtk_widgë_ªf
 (
vbox1
);

579 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "vbox1", 
vbox1
,

580 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

581 
	`gtk_widgë_show
 (
vbox1
);

582 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
dülog_vbox3
), 
vbox1
, 
TRUE
, TRUE, 0);

584 
‰ame_obje˘
 = 
	`gtk_‰ame_√w
 (
	`_
("DiaObject"));

585 
	`gtk_widgë_ªf
 (
‰ame_obje˘
);

586 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "‰ame_obje˘", 
‰ame_obje˘
,

587 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

588 
	`gtk_widgë_show
 (
‰ame_obje˘
);

589 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox1
), 
‰ame_obje˘
, 
TRUE
, TRUE, 0);

591 
èbÀ6
 = 
	`gtk_èbÀ_√w
 (3, 2, 
FALSE
);

592 
	`gtk_widgë_ªf
 (
èbÀ6
);

593 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "èbÀ6", 
èbÀ6
,

594 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

595 
	`gtk_widgë_show
 (
èbÀ6
);

596 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame_obje˘
), 
èbÀ6
);

597 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
èbÀ6
), 5);

598 
	`gtk_èbÀ_£t_cﬁ_•acögs
 (
	`GTK_TABLE
 (
èbÀ6
), 6);

600 
œbñ_obje˘_des¸ùti⁄
 = 
	`gtk_œbñ_√w
 (
	`_
("Description:"));

601 
	`gtk_widgë_ªf
 (
œbñ_obje˘_des¸ùti⁄
);

602 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "œbñ_obje˘_des¸ùti⁄", 
œbñ_obje˘_des¸ùti⁄
,

603 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

604 
	`gtk_widgë_show
 (
œbñ_obje˘_des¸ùti⁄
);

605 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ6
), 
œbñ_obje˘_des¸ùti⁄
, 0, 1, 1, 2,

606 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

607 (
GtkAâachO±i⁄s
) (0), 0, 0);

608 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ_obje˘_des¸ùti⁄
), 0, 0.5);

610 
íåy_obje˘_des¸ùti⁄
 = 
	`gtk_íåy_√w
 ();

611 
	`gtk_widgë_ªf
 (
íåy_obje˘_des¸ùti⁄
);

612 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "íåy_obje˘_des¸ùti⁄", 
íåy_obje˘_des¸ùti⁄
,

613 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

614 
	`gtk_widgë_show
 (
íåy_obje˘_des¸ùti⁄
);

615 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ6
), 
íåy_obje˘_des¸ùti⁄
, 1, 2, 1, 2,

616 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

617 (
GtkAâachO±i⁄s
) (0), 0, 0);

619 
œbñ_obje˘_ty≥
 = 
	`gtk_œbñ_√w
 (
	`_
("Type:"));

620 
	`gtk_widgë_ªf
 (
œbñ_obje˘_ty≥
);

621 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "œbñ_obje˘_ty≥", 
œbñ_obje˘_ty≥
,

622 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

623 
	`gtk_widgë_show
 (
œbñ_obje˘_ty≥
);

624 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ6
), 
œbñ_obje˘_ty≥
, 0, 1, 2, 3,

625 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

626 (
GtkAâachO±i⁄s
) (0), 0, 0);

627 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ_obje˘_ty≥
), 0, 0.5);

629 
íåy_obje˘_ty≥
 = 
	`gtk_íåy_√w
 ();

630 
	`gtk_widgë_ªf
 (
íåy_obje˘_ty≥
);

631 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "íåy_obje˘_ty≥", 
íåy_obje˘_ty≥
,

632 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

633 
	`gtk_widgë_show
 (
íåy_obje˘_ty≥
);

634 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ6
), 
íåy_obje˘_ty≥
, 1, 2, 2, 3,

635 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

636 (
GtkAâachO±i⁄s
) (0), 0, 0);

637 
	`gtk_widgë_£t_£nsôive
 (
íåy_obje˘_ty≥
, 
FALSE
);

638 
	`gtk_íåy_£t_edôabÀ
 (
	`GTK_ENTRY
 (
íåy_obje˘_ty≥
), 
FALSE
);

640 
‰ame_obje˘_pixm≠
 = 
	`gtk_‰ame_√w
 (
NULL
);

641 
	`gtk_widgë_ªf
 (
‰ame_obje˘_pixm≠
);

642 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "‰ame_obje˘_pixm≠", 
‰ame_obje˘_pixm≠
,

643 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

644 
	`gtk_widgë_show
 (
‰ame_obje˘_pixm≠
);

645 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ6
), 
‰ame_obje˘_pixm≠
, 0, 1, 0, 1,

646 (
GtkAâachO±i⁄s
) (0),

647 (
GtkAâachO±i⁄s
) (0), 0, 0);

648 
	`gtk_‰ame_£t_shadow_ty≥
 (
	`GTK_FRAME
 (
‰ame_obje˘_pixm≠
), 
GTK_SHADOW_ETCHED_OUT
);

650 
pixm≠_obje˘
 = 
	`¸óã_pixm≠
 (
shìts_edô_dülog
, 
NULL
, 
FALSE
);

651 
	`gtk_widgë_ªf
 (
pixm≠_obje˘
);

652 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "pixm≠_obje˘", 
pixm≠_obje˘
,

653 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

654 
	`gtk_widgë_show
 (
pixm≠_obje˘
);

655 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame_obje˘_pixm≠
), 
pixm≠_obje˘
);

657 
‰ame_shìt
 = 
	`gtk_‰ame_√w
 (
	`_
("Sheet"));

658 
	`gtk_widgë_ªf
 (
‰ame_shìt
);

659 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "‰ame_shìt", 
‰ame_shìt
,

660 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

661 
	`gtk_widgë_show
 (
‰ame_shìt
);

662 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox1
), 
‰ame_shìt
, 
TRUE
, TRUE, 0);

664 
èbÀ3
 = 
	`gtk_èbÀ_√w
 (2, 2, 
FALSE
);

665 
	`gtk_widgë_ªf
 (
èbÀ3
);

666 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "èbÀ3", 
èbÀ3
,

667 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

668 
	`gtk_widgë_show
 (
èbÀ3
);

669 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame_shìt
), 
èbÀ3
);

670 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
èbÀ3
), 5);

671 
	`gtk_èbÀ_£t_cﬁ_•acögs
 (
	`GTK_TABLE
 (
èbÀ3
), 6);

673 
œbñ_shìt_«me
 = 
	`gtk_œbñ_√w
 (
	`_
("Name:"));

674 
	`gtk_widgë_ªf
 (
œbñ_shìt_«me
);

675 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "œbñ_shìt_«me", 
œbñ_shìt_«me
,

676 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

677 
	`gtk_widgë_show
 (
œbñ_shìt_«me
);

678 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ3
), 
œbñ_shìt_«me
, 0, 1, 0, 1,

679 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

680 (
GtkAâachO±i⁄s
) (0), 0, 0);

681 
	`gtk_œbñ_£t_ju°ify
 (
	`GTK_LABEL
 (
œbñ_shìt_«me
), 
GTK_JUSTIFY_RIGHT
);

682 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ_shìt_«me
), 0, 0.5);

684 
íåy_shìt_des¸ùti⁄
 = 
	`gtk_íåy_√w
 ();

685 
	`gtk_widgë_ªf
 (
íåy_shìt_des¸ùti⁄
);

686 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "íåy_shìt_des¸ùti⁄", 
íåy_shìt_des¸ùti⁄
,

687 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

688 
	`gtk_widgë_show
 (
íåy_shìt_des¸ùti⁄
);

689 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ3
), 
íåy_shìt_des¸ùti⁄
, 1, 2, 1, 2,

690 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

691 (
GtkAâachO±i⁄s
) (0), 0, 0);

693 
œbñ_shìt_des¸ùti⁄
 = 
	`gtk_œbñ_√w
 (
	`_
("Description:"));

694 
	`gtk_widgë_ªf
 (
œbñ_shìt_des¸ùti⁄
);

695 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "œbñ_shìt_des¸ùti⁄", 
œbñ_shìt_des¸ùti⁄
,

696 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

697 
	`gtk_widgë_show
 (
œbñ_shìt_des¸ùti⁄
);

698 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ3
), 
œbñ_shìt_des¸ùti⁄
, 0, 1, 1, 2,

699 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

700 (
GtkAâachO±i⁄s
) (0), 0, 0);

701 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ_shìt_des¸ùti⁄
), 0, 0.5);

703 
íåy_shìt_«me
 = 
	`gtk_íåy_√w
 ();

704 
	`gtk_widgë_ªf
 (
íåy_shìt_«me
);

705 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "íåy_shìt_«me", 
íåy_shìt_«me
,

706 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

707 
	`gtk_widgë_show
 (
íåy_shìt_«me
);

708 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ3
), 
íåy_shìt_«me
, 1, 2, 0, 1,

709 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

710 (
GtkAâachO±i⁄s
) (0), 0, 0);

711 
	`gtk_widgë_£t_usize
 (
íåy_shìt_«me
, 220, -2);

713 
dülog_a˘i⁄_¨ó3
 = 
	`GTK_DIALOG
 (
shìts_edô_dülog
)->
a˘i⁄_¨ó
;

714 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "dülog_a˘i⁄_¨ó3", 
dülog_a˘i⁄_¨ó3
);

715 
	`gtk_widgë_show
 (
dülog_a˘i⁄_¨ó3
);

716 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
dülog_a˘i⁄_¨ó3
), 10);

718 
hbuâ⁄box2
 = 
	`gtk_hbuâ⁄_box_√w
 ();

719 
	`gtk_widgë_ªf
 (
hbuâ⁄box2
);

720 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "hbuâ⁄box2", 
hbuâ⁄box2
,

721 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

722 
	`gtk_widgë_show
 (
hbuâ⁄box2
);

723 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
dülog_a˘i⁄_¨ó3
), 
hbuâ⁄box2
, 
TRUE
, TRUE, 0);

724 
	`gtk_buâ⁄_box_£t_œyout
 (
	`GTK_BUTTON_BOX
 (
hbuâ⁄box2
), 
GTK_BUTTONBOX_END
);

725 
	`gtk_buâ⁄_box_£t_•acög
 (
	`GTK_BUTTON_BOX
 (
hbuâ⁄box2
), 0);

727 
buâ⁄_ok
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_OK
);

728 
	`gtk_widgë_ªf
 (
buâ⁄_ok
);

729 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "buâ⁄_ok", 
buâ⁄_ok
,

730 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

731 
	`gtk_widgë_show
 (
buâ⁄_ok
);

732 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
hbuâ⁄box2
), 
buâ⁄_ok
);

733 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄_ok
, 
GTK_CAN_DEFAULT
);

735 
buâ⁄_ˇn˚l
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_CANCEL
);

736 
	`gtk_widgë_ªf
 (
buâ⁄_ˇn˚l
);

737 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_edô_dülog
), "buâ⁄_ˇn˚l", 
buâ⁄_ˇn˚l
,

738 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

739 
	`gtk_widgë_show
 (
buâ⁄_ˇn˚l
);

740 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
hbuâ⁄box2
), 
buâ⁄_ˇn˚l
);

741 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄_ˇn˚l
, 
GTK_CAN_DEFAULT
);

743 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy_obje˘_des¸ùti⁄
), "changed",

744 
	`G_CALLBACK
 (
⁄_shìts_edô_dülog_íåy_obje˘_des¸ùti⁄_ch™ged
),

745 
NULL
);

746 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy_shìt_des¸ùti⁄
), "changed",

747 
	`G_CALLBACK
 (
⁄_shìts_edô_dülog_íåy_shìt_des¸ùti⁄_ch™ged
),

748 
NULL
);

749 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy_shìt_«me
), "changed",

750 
	`G_CALLBACK
 (
⁄_shìts_edô_dülog_íåy_shìt_«me_ch™ged
),

751 
NULL
);

752 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_ok
), "clicked",

753 
	`G_CALLBACK
 (
⁄_shìts_edô_dülog_buâ⁄_ok_˛icked
),

754 
NULL
);

755 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_ˇn˚l
), "clicked",

756 
	`G_CALLBACK
 (
⁄_shìts_edô_dülog_buâ⁄_ˇn˚l_˛icked
),

757 
NULL
);

759 
	`gtk_widgë_gøb_deÁu…
 (
buâ⁄_ok
);

760  
shìts_edô_dülog
;

761 
	}
}

763 
GtkWidgë
*

764 
	$¸óã_shìts_ªmove_dülog
 ()

766 
GtkWidgë
 *
shìts_ªmove_dülog
;

767 
GtkWidgë
 *
dülog_vbox4
;

768 
GtkWidgë
 *
‰ame
;

769 
GtkWidgë
 *
èbÀ7
;

770 
GSLi°
 *
èbÀ7_group
 = 
NULL
;

771 
GtkWidgë
 *
ødiobuâ⁄_obje˘
;

772 
GtkWidgë
 *
‰ame_obje˘_pixm≠
;

773 
GtkWidgë
 *
pixm≠_obje˘
;

774 
GtkWidgë
 *
ødiobuâ⁄_shìt
;

775 
GtkWidgë
 *
íåy_obje˘
;

776 
GtkWidgë
 *
íåy_shìt
;

777 
GtkWidgë
 *
dülog_a˘i⁄_¨ó4
;

778 
GtkWidgë
 *
hbuâ⁄box3
;

779 
GtkWidgë
 *
buâ⁄_ok
;

780 
GtkWidgë
 *
buâ⁄_ˇn˚l
;

782 
shìts_ªmove_dülog
 = 
	`gtk_dülog_√w
 ();

783 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
),

784 "shìts_ªmove_dülog", 
shìts_ªmove_dülog
);

785 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
shìts_ªmove_dülog
), 
	`_
("Remove"));

786 
	`gtk_wödow_£t_deÁu…_size
 (
	`GTK_WINDOW
 (
shìts_ªmove_dülog
), 316, -1);

787 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
shìts_ªmove_dülog
),

789 
	`gtk_wödow_£t_ªsizabÀ
 (
	`GTK_WINDOW
 (
shìts_ªmove_dülog
), 
TRUE
);

791 
dülog_vbox4
 = 
	`GTK_DIALOG
 (
shìts_ªmove_dülog
)->
vbox
;

792 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "dülog_vbox4", 
dülog_vbox4
);

793 
	`gtk_widgë_show
 (
dülog_vbox4
);

795 
‰ame
 = 
	`gtk_‰ame_√w
 (
	`_
("Type"));

796 
	`gtk_widgë_ªf
 (
‰ame
);

797 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "‰ame", 
‰ame
,

798 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

799 
	`gtk_widgë_show
 (
‰ame
);

800 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
dülog_vbox4
), 
‰ame
, 
TRUE
, TRUE, 0);

801 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
‰ame
), 5);

803 
èbÀ7
 = 
	`gtk_èbÀ_√w
 (3, 2, 
FALSE
);

804 
	`gtk_widgë_ªf
 (
èbÀ7
);

805 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "èbÀ7", 
èbÀ7
,

806 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

807 
	`gtk_widgë_show
 (
èbÀ7
);

808 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame
), 
èbÀ7
);

810 
ødiobuâ⁄_obje˘
 = 
	`gtk_ødio_buâ⁄_√w_wôh_œbñ
 (
èbÀ7_group
, 
	`_
("DiaObject:"));

811 
èbÀ7_group
 = 
	`gtk_ødio_buâ⁄_group
 (
	`GTK_RADIO_BUTTON
 (
ødiobuâ⁄_obje˘
));

812 
	`gtk_widgë_ªf
 (
ødiobuâ⁄_obje˘
);

813 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "ødiobuâ⁄_obje˘", 
ødiobuâ⁄_obje˘
,

814 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

815 
	`gtk_widgë_show
 (
ødiobuâ⁄_obje˘
);

816 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ7
), 
ødiobuâ⁄_obje˘
, 0, 1, 1, 2,

817 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

818 (
GtkAâachO±i⁄s
) (0), 0, 0);

820 
‰ame_obje˘_pixm≠
 = 
	`gtk_‰ame_√w
 (
NULL
);

821 
	`gtk_widgë_ªf
 (
‰ame_obje˘_pixm≠
);

822 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "‰ame_obje˘_pixm≠", 
‰ame_obje˘_pixm≠
,

823 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

824 
	`gtk_widgë_show
 (
‰ame_obje˘_pixm≠
);

825 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ7
), 
‰ame_obje˘_pixm≠
, 0, 1, 0, 1,

826 (
GtkAâachO±i⁄s
) (0),

827 (
GtkAâachO±i⁄s
) (0), 0, 0);

828 
	`gtk_‰ame_£t_shadow_ty≥
 (
	`GTK_FRAME
 (
‰ame_obje˘_pixm≠
), 
GTK_SHADOW_ETCHED_OUT
);

830 
pixm≠_obje˘
 = 
	`¸óã_pixm≠
 (
shìts_ªmove_dülog
, 
NULL
, 
FALSE
);

831 
	`gtk_widgë_ªf
 (
pixm≠_obje˘
);

832 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "pixm≠_obje˘", 
pixm≠_obje˘
,

833 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

834 
	`gtk_widgë_show
 (
pixm≠_obje˘
);

835 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame_obje˘_pixm≠
), 
pixm≠_obje˘
);

837 
ødiobuâ⁄_shìt
 = 
	`gtk_ødio_buâ⁄_√w_wôh_œbñ
 (
èbÀ7_group
, 
	`_
("Sheet:"));

838 
èbÀ7_group
 = 
	`gtk_ødio_buâ⁄_group
 (
	`GTK_RADIO_BUTTON
 (
ødiobuâ⁄_shìt
));

839 
	`gtk_widgë_ªf
 (
ødiobuâ⁄_shìt
);

840 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "ødiobuâ⁄_shìt", 
ødiobuâ⁄_shìt
,

841 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

842 
	`gtk_widgë_show
 (
ødiobuâ⁄_shìt
);

843 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ7
), 
ødiobuâ⁄_shìt
, 0, 1, 2, 3,

844 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

845 (
GtkAâachO±i⁄s
) (0), 0, 0);

847 
íåy_obje˘
 = 
	`gtk_íåy_√w
 ();

848 
	`gtk_widgë_ªf
 (
íåy_obje˘
);

849 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "íåy_obje˘", 
íåy_obje˘
,

850 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

851 
	`gtk_widgë_show
 (
íåy_obje˘
);

852 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ7
), 
íåy_obje˘
, 1, 2, 1, 2,

853 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

854 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
), 0, 0);

855 
	`gtk_íåy_£t_edôabÀ
 (
	`GTK_ENTRY
 (
íåy_obje˘
), 
FALSE
);

857 
íåy_shìt
 = 
	`gtk_íåy_√w
 ();

858 
	`gtk_widgë_ªf
 (
íåy_shìt
);

859 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "íåy_shìt", 
íåy_shìt
,

860 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

861 
	`gtk_widgë_show
 (
íåy_shìt
);

862 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ7
), 
íåy_shìt
, 1, 2, 2, 3,

863 (
GtkAâachO±i⁄s
Ë(
GTK_EXPAND
 | 
GTK_FILL
),

864 (
GtkAâachO±i⁄s
) (0), 0, 0);

865 
	`gtk_íåy_£t_edôabÀ
 (
	`GTK_ENTRY
 (
íåy_shìt
), 
FALSE
);

867 
dülog_a˘i⁄_¨ó4
 = 
	`GTK_DIALOG
 (
shìts_ªmove_dülog
)->
a˘i⁄_¨ó
;

868 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "dülog_a˘i⁄_¨ó4", 
dülog_a˘i⁄_¨ó4
);

869 
	`gtk_widgë_show
 (
dülog_a˘i⁄_¨ó4
);

870 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
dülog_a˘i⁄_¨ó4
), 10);

872 
hbuâ⁄box3
 = 
	`gtk_hbuâ⁄_box_√w
 ();

873 
	`gtk_widgë_ªf
 (
hbuâ⁄box3
);

874 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "hbuâ⁄box3", 
hbuâ⁄box3
,

875 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

876 
	`gtk_widgë_show
 (
hbuâ⁄box3
);

877 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
dülog_a˘i⁄_¨ó4
), 
hbuâ⁄box3
, 
TRUE
, TRUE, 0);

878 
	`gtk_buâ⁄_box_£t_œyout
 (
	`GTK_BUTTON_BOX
 (
hbuâ⁄box3
), 
GTK_BUTTONBOX_END
);

879 
	`gtk_buâ⁄_box_£t_•acög
 (
	`GTK_BUTTON_BOX
 (
hbuâ⁄box3
), 0);

881 
buâ⁄_ok
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_OK
);

882 
	`gtk_widgë_ªf
 (
buâ⁄_ok
);

883 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "buâ⁄_ok", 
buâ⁄_ok
,

884 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

885 
	`gtk_widgë_show
 (
buâ⁄_ok
);

886 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
hbuâ⁄box3
), 
buâ⁄_ok
);

887 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄_ok
, 
GTK_CAN_DEFAULT
);

889 
buâ⁄_ˇn˚l
 = 
	`gtk_buâ⁄_√w_‰om_°ock
(
GTK_STOCK_CANCEL
);

890 
	`gtk_widgë_ªf
 (
buâ⁄_ˇn˚l
);

891 
	`gtk_obje˘_£t_d©a_fuŒ
 (
	`GTK_OBJECT
 (
shìts_ªmove_dülog
), "buâ⁄_ˇn˚l", 
buâ⁄_ˇn˚l
,

892 (
GtkDe°royNŸify
Ë
gtk_widgë_uƒef
);

893 
	`gtk_widgë_show
 (
buâ⁄_ˇn˚l
);

894 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
hbuâ⁄box3
), 
buâ⁄_ˇn˚l
);

895 
	`GTK_WIDGET_SET_FLAGS
 (
buâ⁄_ˇn˚l
, 
GTK_CAN_DEFAULT
);

897 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ødiobuâ⁄_obje˘
), "toggled",

898 
	`G_CALLBACK
 (
⁄_shìts_ªmove_dülog_ødiobuâ⁄_obje˘_toggÀd
),

899 
NULL
);

900 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ødiobuâ⁄_shìt
), "toggled",

901 
	`G_CALLBACK
 (
⁄_shìts_ªmove_dülog_ødiobuâ⁄_shìt_toggÀd
),

902 
NULL
);

903 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_ok
), "clicked",

904 
	`G_CALLBACK
 (
⁄_shìts_ªmove_dülog_buâ⁄_ok_˛icked
),

905 
NULL
);

906 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄_ˇn˚l
), "clicked",

907 
	`G_CALLBACK
 (
⁄_shìts_ªmove_dülog_buâ⁄_ˇn˚l_˛icked
),

908 
NULL
);

910 
	`gtk_widgë_gøb_deÁu…
 (
buâ⁄_ok
);

911  
shìts_ªmove_dülog
;

912 
	}
}

914 
GtkWidgë
*

915 
	$¸óã_shìts_sh≠e£À˘i⁄_dülog
 ()

917 
GtkWidgë
 *
shìts_sh≠e£À˘i⁄_dülog
;

918 
GtkWidgë
 *
ok_buâ⁄
;

919 
GtkWidgë
 *
ˇn˚l_buâ⁄1
;

921 
shìts_sh≠e£À˘i⁄_dülog
 = 
	`gtk_fûe_£À˘i⁄_√w
 (
	`_
("Select SVG Shape File"));

922 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_sh≠e£À˘i⁄_dülog
), "sheets_shapeselection_dialog", sheets_shapeselection_dialog);

923 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
shìts_sh≠e£À˘i⁄_dülog
), 10);

925 
ok_buâ⁄
 = 
	`GTK_FILE_SELECTION
 (
shìts_sh≠e£À˘i⁄_dülog
)->ok_button;

926 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_sh≠e£À˘i⁄_dülog
), "ok_buâ⁄", 
ok_buâ⁄
);

927 
	`gtk_widgë_show
 (
ok_buâ⁄
);

928 
	`GTK_WIDGET_SET_FLAGS
 (
ok_buâ⁄
, 
GTK_CAN_DEFAULT
);

930 
ˇn˚l_buâ⁄1
 = 
	`GTK_FILE_SELECTION
 (
shìts_sh≠e£À˘i⁄_dülog
)->
ˇn˚l_buâ⁄
;

931 
	`gtk_obje˘_£t_d©a
 (
	`GTK_OBJECT
 (
shìts_sh≠e£À˘i⁄_dülog
), "ˇn˚l_buâ⁄1", 
ˇn˚l_buâ⁄1
);

932 
	`gtk_widgë_show
 (
ˇn˚l_buâ⁄1
);

933 
	`GTK_WIDGET_SET_FLAGS
 (
ˇn˚l_buâ⁄1
, 
GTK_CAN_DEFAULT
);

935 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ok_buâ⁄
), "clicked",

936 
	`G_CALLBACK
 (
⁄_shìts_sh≠e£À˘i⁄_dülog_buâ⁄_ok_˛icked
),

937 
NULL
);

938 
	`g_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ˇn˚l_buâ⁄1
), "clicked",

939 
	`G_CALLBACK
 (
⁄_shìts_sh≠e£À˘i⁄_dülog_buâ⁄_ˇn˚l_˛icked
),

940 
NULL
);

942  
shìts_sh≠e£À˘i⁄_dülog
;

943 
	}
}

	@O:\tool\dvs50\app\sheets_dialog.h

5 
GtkWidgë
* 
¸óã_shìts_maö_dülog
 ();

6 
GtkWidgë
* 
¸óã_shìts_√w_dülog
 ();

7 
GtkWidgë
* 
¸óã_shìts_edô_dülog
 ();

8 
GtkWidgë
* 
¸óã_shìts_ªmove_dülog
 ();

9 
GtkWidgë
* 
¸óã_shìts_sh≠e£À˘i⁄_dülog
 ();

	@O:\tool\dvs50\app\sheets_dialog_callbacks.c

24 #ifde‡
HAVE_CONFIG_H


25 
	~<c⁄fig.h
>

28 
	~<î∫o.h
>

29 
	~<°rög.h
>

30 
	~<sys/ty≥s.h
>

31 
	~<sys/°©.h
>

32 #ifde‡
HAVE_UNISTD_H


33 
	~<uni°d.h
>

35 
	~<time.h
>

36 #ifde‡
HAVE_UTIME_H


37 
	~<utime.h
>

40 
	~<sys/utime.h
>

41 #ifde‡
G_OS_WIN32


42 
	#utime
(
n
,
b
Ë
	`_utime
“,b)

	)

43 
	#utim_buf
 
_utimbuf


	)

47 
	~<glib/g°dio.h
>

48 
	~<gmoduÀ.h
>

50 #unde‡
GTK_DISABLE_DEPRECATED


51 #ifde‡
GNOME


52 
	~<gnome.h
>

54 
	~<gtk/gtk.h
>

57 
	~<libxml/åì.h
>

58 
	~<libxml/∑r£r.h
>

59 
	~<libxml/xmlmem‹y.h
>

61 
	~"gtkwøpbox.h
"

63 
	~"dü_dús.h
"

64 
	~"dü_xml_libxml.h
"

65 
	~"∂ug-ös.h
"

66 
	~"obje˘.h
"

68 
	~"öãrÁ˚.h
"

69 
	~"mesßge.h
"

70 
	~"shìts.h
"

71 
	~"shìts_dülog_ˇŒbacks.h
"

72 
	~"shìts_dülog.h
"

74 
	~"pixm≠s/löe_bªak.xpm
"

75 
	~"öé.h
"

77 
GSLi°
 *
	gødio_group
 = 
NULL
;

80 
	$shìts_dülog_hide
()

82 
	`gtk_widgë_hide
(
shìts_dülog
);

83 
	}
}

85 
gboﬁón


86 
	$⁄_shìts_maö_dülog_dñëe_evít
 (
GtkWidgë
 *
widgë
,

87 
GdkEvít
 *
evít
,

88 
gpoöãr
 
u£r_d©a
)

90 
	`shìts_dülog_hide
();

91  
TRUE
;

92 
	}
}

96 
	$shìts_dülog_up_down_£t_£nsôive
(
GLi°
 *
wøpbox_buâ⁄_li°
,

97 
GtkToggÀBuâ⁄
 *
toggÀbuâ⁄
)

99 
GtkWidgë
 *
buâ⁄
;

101 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move_up");

107 i‡(!
wøpbox_buâ⁄_li°


108 || 
	`GTK_TOGGLE_BUTTON
(
	`g_li°_fú°
(
wøpbox_buâ⁄_li°
)->
d©a
Ë=
toggÀbuâ⁄


109 || (!
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
toggÀbuâ⁄
), "sheet_object_mod")

110 && 
	`g_li°_¡h
(
wøpbox_buâ⁄_li°
, 1)

111 && 
	`GTK_TOGGLE_BUTTON
(
	`g_li°_¡h
(
wøpbox_buâ⁄_li°
, 1)->
d©a
)

112 =
toggÀbuâ⁄
))

113 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

115 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
TRUE
);

117 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move_down");

118 i‡(!
wøpbox_buâ⁄_li°


119 || 
	`GTK_TOGGLE_BUTTON
(
	`g_li°_œ°
(
wøpbox_buâ⁄_li°
)->
d©a
Ë=
toggÀbuâ⁄


120 || (!
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
toggÀbuâ⁄
), "sheet_object_mod")

121 && 
	`g_li°_¥evious
(
	`g_li°_œ°
(
wøpbox_buâ⁄_li°
))

122 && 
	`GTK_TOGGLE_BUTTON
(
	`g_li°_¥evious
(
	`g_li°_œ°
(
wøpbox_buâ⁄_li°
))

123 ->
d©a
)

124 =
toggÀbuâ⁄
))

125 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

127 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
TRUE
);

128 
	}
}

131 
	$⁄_shìts_dülog_obje˘_buâ⁄_toggÀd
(
GtkToggÀBuâ⁄
 *
toggÀbuâ⁄
,

132 
gpoöãr
 
ud_wøpbox
)

134 
GLi°
 *
wøpbox_buâ⁄_li°
;

135 
GtkWidgë
 *
buâ⁄
;

136 
GtkWidgë
 *
èbÀ_shìts
;

137 
GtkWidgë
 *
›ti⁄míu_À·
;

138 
GtkWidgë
 *
›ti⁄míu_right
;

139 
gch¨
 *
shìt_À·
;

140 
gch¨
 *
shìt_right
;

142 i‡(
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
toggÀbuâ⁄
)Ë=
FALSE
)

147 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
ud_wøpbox
), "a˘ive_buâ⁄", 
toggÀbuâ⁄
);

151 
èbÀ_shìts
 = 
	`lookup_widgë
(
shìts_dülog
, "table_sheets");

152 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
èbÀ_shìts
), "a˘ive_wøpbox", 
ud_wøpbox
);

154 
›ti⁄míu_À·
 = 
	`lookup_widgë
(
shìts_dülog
, "optionmenu_left");

155 
shìt_À·
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
›ti⁄míu_À·
),

158 
›ti⁄míu_right
 = 
	`lookup_widgë
(
shìts_dülog
, "optionmenu_right");

159 
shìt_right
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
›ti⁄míu_right
),

162 i‡((
gboﬁón
)
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
ud_wøpbox
), "is_À·"Ë==
TRUE
)

164 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
èbÀ_shìts
), "active_optionmenu",

165 
›ti⁄míu_À·
);

166 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_copy");

167 
	`gtk_obje˘_£t
(
	`GTK_OBJECT
(
buâ⁄
), "œbñ", 
	`_
("C›y ->"), 
NULL
);

168 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_copy_all");

169 
	`gtk_obje˘_£t
(
	`GTK_OBJECT
(
buâ⁄
), "œbñ", 
	`_
("C›y AŒ ->"), 
NULL
);

170 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move");

171 
	`gtk_obje˘_£t
(
	`GTK_OBJECT
(
buâ⁄
), "œbñ", 
	`_
("Movê->"), 
NULL
);

172 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move_all");

173 
	`gtk_obje˘_£t
(
	`GTK_OBJECT
(
buâ⁄
), "œbñ", 
	`_
("MovêAŒ ->"), 
NULL
);

177 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
èbÀ_shìts
), "active_optionmenu",

178 
›ti⁄míu_right
);

179 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_copy");

180 
	`gtk_obje˘_£t
(
	`GTK_OBJECT
(
buâ⁄
), "œbñ", 
	`_
("<- C›y"), 
NULL
);

181 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_copy_all");

182 
	`gtk_obje˘_£t
(
	`GTK_OBJECT
(
buâ⁄
), "œbñ", 
	`_
("<- C›y AŒ"), 
NULL
);

183 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move");

184 
	`gtk_obje˘_£t
(
	`GTK_OBJECT
(
buâ⁄
), "œbñ", 
	`_
("<- Move"), 
NULL
);

185 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move_all");

186 
	`gtk_obje˘_£t
(
	`GTK_OBJECT
(
buâ⁄
), "œbñ", 
	`_
("<- MovêAŒ"), 
NULL
);

189 
shìt_À·
 = sheet_left ? sheet_left : "";

191 i‡(!
	`°rcmp
(
shìt_À·
, 
shìt_right
)

192 || 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
toggÀbuâ⁄
), "is_hidden_button")

193 || !
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
toggÀbuâ⁄
), "sheet_object_mod"))

195 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_copy");

196 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

197 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_copy_all");

198 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

199 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move");

200 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

201 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move_all");

202 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

206 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_copy");

207 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
TRUE
);

208 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_copy_all");

209 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
TRUE
);

210 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move");

211 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
TRUE
);

212 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move_all");

213 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
TRUE
);

216 
wøpbox_buâ⁄_li°
 = 
	`gtk_c⁄èöî_chûdªn
(
	`GTK_CONTAINER
(
ud_wøpbox
));

218 i‡(
	`g_li°_Àngth
(
wøpbox_buâ⁄_li°
))

220 
ShìtMod
 *
sm
;

222 
	`shìts_dülog_up_down_£t_£nsôive
(
wøpbox_buâ⁄_li°
, 
toggÀbuâ⁄
);

224 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
toggÀbuâ⁄
), "sheet_mod");

226 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_edit");

227 i‡(!
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
toggÀbuâ⁄
), "sheet_object_mod")

228 && 
sm
->
shìt
.
sc›e
 =
SHEET_SCOPE_SYSTEM
)

229 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

231 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
TRUE
);

233 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_remove");

234 i‡(
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
toggÀbuâ⁄
), "is_hidden_button")

235 && 
sm
->
shìt
.
shadowög
 =
NULL


236 && 
sm
->
shìt
.
sc›e
 =
SHEET_SCOPE_SYSTEM
)

237 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

239 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
TRUE
);

243 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move_up");

244 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

245 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_move_down");

246 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

247 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_edit");

248 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

249 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_remove");

250 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
FALSE
);

252 
	`g_li°_‰ì
(
wøpbox_buâ⁄_li°
);

253 
	}
}

256 
	$shìts_dülog_wøpbox_add_löe_bªak
(
GtkWidgë
 *
wøpbox
)

258 
ShìtMod
 *
sm
;

259 
GtkWidgë
 *
buâ⁄
;

260 
GtkStyÀ
 *
°yÀ
;

261 
GdkPixm≠
 *
pixm≠
, *
mask
;

262 
GtkWidgë
 *
gtkpixm≠
;

264 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
), "sheet_mod");

265 
	`g_as£π
(
sm
);

267 
buâ⁄
 = 
	`gtk_ødio_buâ⁄_√w
(
ødio_group
);

268 
	`gtk_buâ⁄_£t_ªlõf
(
	`GTK_BUTTON
(
buâ⁄
), 
GTK_RELIEF_NONE
);

270 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
buâ⁄
), "shìt_mod", 
sm
);

272 
ødio_group
 = 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(
buâ⁄
));

274 
	`gtk_toggÀ_buâ⁄_£t_mode
(
	`GTK_TOGGLE_BUTTON
(
buâ⁄
), 
FALSE
);

275 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
buâ⁄
), 0);

277 
°yÀ
 = 
	`gtk_widgë_gë_°yÀ
(
wøpbox
);

278 
pixm≠
 =

279 
	`gdk_pixm≠_cﬁ‹m≠_¸óã_‰om_xpm_d
(
NULL
,

280 
	`gtk_widgë_gë_cﬁ‹m≠
(
wøpbox
),

281 &
mask
,

282 &
°yÀ
->
bg
[
GTK_STATE_NORMAL
],

283 
löe_bªak_xpm
);

285 
gtkpixm≠
 = 
	`gtk_pixm≠_√w
(
pixm≠
, 
mask
);

286 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
buâ⁄
), 
gtkpixm≠
);

287 
	`gtk_widgë_show
(
gtkpixm≠
);

289 
	`gtk_wøp_box_∑ck
(
	`GTK_WRAP_BOX
(
wøpbox
), 
buâ⁄
, 
FALSE
, 
TRUE
, FALSE, TRUE);

290 
	`gtk_widgë_show
(
buâ⁄
);

292 
	`gtk_toﬁtùs_£t_tù
(
shìts_dülog_toﬁtùs
, 
buâ⁄
, 
	`_
("LöêBªak"), 
NULL
);

294 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
buâ⁄
), "toggled",

295 
	`G_CALLBACK
(
⁄_shìts_dülog_obje˘_buâ⁄_toggÀd
),

296 
wøpbox
);

297 
	}
}

300 
	$shìts_dülog_obje˘_£t_toﬁtù
(
ShìtObje˘Mod
 *
som
, 
GtkWidgë
 *
buâ⁄
)

302 
gch¨
 *
tù
;

304 
som
->
ty≥
){

305 
OBJECT_TYPE_SVG
:

306 
tù
 = 
	`g_°rdup_¥ötf
(
	`_
("%s\nSh≠e"), 
som
->
shìt_obje˘
.
des¸ùti⁄
);

308 
OBJECT_TYPE_PROGRAMMED
:

309 
tù
 = 
	`g_°rdup_¥ötf
(
	`_
("%s\nObje˘"), 
som
->
shìt_obje˘
.
des¸ùti⁄
);

312 
tù
 = 
	`g_°rdup_¥ötf
(
	`_
("%s\nU«ssig√dÅy≥"), 
som
->
shìt_obje˘
.
des¸ùti⁄
);

316 
	`gtk_toﬁtùs_£t_tù
(
shìts_dülog_toﬁtùs
, 
buâ⁄
, 
tù
, 
NULL
);

317 
	`g_‰ì
(
tù
);

318 
	}
}

320 
GtkWidgë
 *

321 
	$shìts_dülog_¸óã_obje˘_buâ⁄
(
ShìtObje˘Mod
 *
som
, 
ShìtMod
 *
sm
,

322 
GtkWidgë
 *
wøpbox
)

324 
GtkWidgë
 *
buâ⁄
;

325 
GdkPixm≠
 *
pixm≠
, *
mask
;

326 
GtkWidgë
 *
gtkpixm≠
;

328 
buâ⁄
 = 
	`gtk_ødio_buâ⁄_√w
(
ødio_group
);

329 
ødio_group
 = 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(
buâ⁄
));

331 
	`gtk_toggÀ_buâ⁄_£t_mode
(
	`GTK_TOGGLE_BUTTON
(
buâ⁄
), 
FALSE
);

332 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
buâ⁄
), 0);

334 
	`¸óã_obje˘_pixm≠
(&
som
->
shìt_obje˘
, 
wøpbox
, &
pixm≠
, &
mask
);

335 
gtkpixm≠
 = 
	`gtk_pixm≠_√w
(
pixm≠
, 
mask
);

336 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
buâ⁄
), 
gtkpixm≠
);

337 
	`gtk_widgë_show
(
gtkpixm≠
);

339 
	`shìts_dülog_obje˘_£t_toﬁtù
(
som
, 
buâ⁄
);

341 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
buâ⁄
), "shìt_mod", 
sm
);

342 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
buâ⁄
), "shìt_obje˘_mod", 
som
);

344 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
buâ⁄
), "toggled",

345 
	`G_CALLBACK
(
⁄_shìts_dülog_obje˘_buâ⁄_toggÀd
),

346 
wøpbox
);

347  
buâ⁄
;

348 
	}
}

350 
gboﬁón
 
	g›ti⁄míu_a˘iv©e_fú°_∑ss
 = 
TRUE
;

353 
	$⁄_shìts_dülog_›ti⁄míu_a˘iv©e
 (
GtkMíuIãm
 *
míuôem
,

354 
gpoöãr
 
u£r_d©a
)

356 
GtkWidgë
 *
wøpbox
;

357 
Shìt
 *
shìt
;

358 
GtkWidgë
 *
›ti⁄míu
;

359 
GSLi°
 *
obje˘_mod_li°
;

360 
GtkWidgë
 *
hiddí_buâ⁄
;

361 
GLi°
 *
buâ⁄_li°
;

363 
shìt
 = &(((
ShìtMod
 *)(
u£r_d©a
))->sheet);

365 
wøpbox
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
míuôem
), "wrapbox");

366 
	`g_as£π
(
wøpbox
);

371 i‡(
›ti⁄míu_a˘iv©e_fú°_∑ss
)

373 
hiddí_buâ⁄
 = 
	`gtk_ødio_buâ⁄_√w
(
NULL
);

374 
›ti⁄míu_a˘iv©e_fú°_∑ss
 = 
FALSE
;

378 
hiddí_buâ⁄
 = 
	`gtk_ødio_buâ⁄_√w
(
ødio_group
);

379 
ødio_group
 = 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(
hiddí_buâ⁄
));

382 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
hiddí_buâ⁄
), "toggled",

383 
	`G_CALLBACK
(
⁄_shìts_dülog_obje˘_buâ⁄_toggÀd
),

384 
wøpbox
);

385 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
hiddí_buâ⁄
), "is_hidden_button",

386 (
gpoöãr
)
TRUE
);

387 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
wøpbox
), "hiddí_buâ⁄", 
hiddí_buâ⁄
);

388 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
hiddí_buâ⁄
), "shìt_mod", 
u£r_d©a
);

390 i‡(
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
), "is_left"))

391 
›ti⁄míu
 = 
	`lookup_widgë
(
shìts_dülog
, "optionmenu_left");

393 
›ti⁄míu
 = 
	`lookup_widgë
(
shìts_dülog
, "optionmenu_right");

394 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
›ti⁄míu
), "a˘ive_shìt_«me", 
shìt
->
«me
);

396 
	`gtk_c⁄èöî_f‹óch
(
	`GTK_CONTAINER
(
wøpbox
),

397 (
GtkCÆlback
)
gtk_widgë_de°roy
, 
NULL
);

399 
ødio_group
 = 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(
hiddí_buâ⁄
));

401 
	`gtk_wøp_box_£t_a•e˘_øtio
(
	`GTK_WRAP_BOX
(
wøpbox
), 4 * 1.0 / 9);

403 #ifde‡
CHANGE_COLOUR_OF_MODIFIED_SHEETS


405 
GtkRcStyÀ
 *
°yÀ
;

407 
°yÀ
->
fg
[0].
ªd
 = styÀ->
bg
[0].red = 56000;

408 
°yÀ
->
fg
[1].
ªd
 = styÀ->
bg
[1].red = 56000;

409 
°yÀ
->
fg
[2].
ªd
 = styÀ->
bg
[2].red = 56000;

410 
°yÀ
->
fg
[3].
ªd
 = styÀ->
bg
[3].red = 56000;

411 
°yÀ
->
fg
[4].
ªd
 = styÀ->
bg
[4].red = 56000;

412 
°yÀ
->
cﬁ‹_Êags
[0] |= 0x0f;

413 
°yÀ
->
cﬁ‹_Êags
[1] |= 0x0f;

414 
°yÀ
->
cﬁ‹_Êags
[2] |= 0x0f;

415 
°yÀ
->
cﬁ‹_Êags
[3] |= 0x0f;

416 
°yÀ
->
cﬁ‹_Êags
[4] |= 0x0f;

418 
sw
 = 
	`lookup_widgë
(
shìts_dülog
, "scrolledwindow_right");

419 
	`gtk_widgë_modify_°yÀ
(
wøpbox
, 
°yÀ
);

423 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
wøpbox
), "shìt_mod", 
u£r_d©a
);

425 
obje˘_mod_li°
 = 
shìt
->
obje˘s
; object_mod_list;

426 
obje˘_mod_li°
 = 
	`g_¶i°_√xt
(object_mod_list))

428 
GtkWidgë
 *
buâ⁄
;

429 
ShìtObje˘Mod
 *
som
;

431 
som
 = 
obje˘_mod_li°
->
d©a
;

432 i‡(
som
->
mod
 =
SHEET_OBJECT_MOD_DELETED
)

435 i‡(
som
->
shìt_obje˘
.
löe_bªak
 =
TRUE
)

436 
	`shìts_dülog_wøpbox_add_löe_bªak
(
wøpbox
);

438 
buâ⁄
 = 
	`shìts_dülog_¸óã_obje˘_buâ⁄
(
som
, 
u£r_d©a
, 
wøpbox
);

440 
	`gtk_wøp_box_∑ck_wøµed
(
	`GTK_WRAP_BOX
(
wøpbox
), 
buâ⁄
,

441 
FALSE
, 
TRUE
, FALSE, TRUE, 
som
->
shìt_obje˘
.
löe_bªak
);

443 
	`gtk_widgë_show
(
buâ⁄
);

446 
buâ⁄_li°
 = 
	`gtk_c⁄èöî_chûdªn
(
	`GTK_CONTAINER
(
wøpbox
));

448 i‡(
	`g_li°_Àngth
(
buâ⁄_li°
))

450 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
hiddí_buâ⁄
), 
TRUE
);

451 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
buâ⁄_li°
->
d©a
), 
TRUE
);

454 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
hiddí_buâ⁄
), 
TRUE
);

456 
	`g_li°_‰ì
(
buâ⁄_li°
);

457 
	}
}

460 
	$shìts_dülog_≠∂y_ªvît_£t_£nsôive
(
gboﬁón
 
is_£nsôive
)

462 
GtkWidgë
 *
buâ⁄
;

464 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_apply");

465 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
is_£nsôive
);

467 
buâ⁄
 = 
	`lookup_widgë
(
shìts_dülog
, "button_revert");

468 
	`gtk_widgë_£t_£nsôive
(
buâ⁄
, 
is_£nsôive
);

469 
	}
}

473 
	mSHEETS_DIALOG_MOVE_UP
 = -1,

474 
	mSHEETS_DIALOG_MOVE_DOWN
 = +1

476 
	tShìtsDülogMoveDú
;

478 
SHEETS_DIALOG_MOVE_NONE
 
SHEETS_DIALOG_MOVE_UP


481 
	$_gtk_wøp_box_£t_chûd_f‹˚d_bªak
 (
GtkWøpBox
* 
box
, 
GtkWidgë
* 
chûd
,

482 
gboﬁón
 
wøµed
)

484 
gboﬁón
 
hex∑nd
, 
hfûl
, 
vex∑nd
, 
vfûl
, 
dummy
;

486 
	`gtk_wøp_box_quîy_chûd_∑ckög
 (
box
, 
chûd
, &
hex∑nd
, &
hfûl
,

487 &
vex∑nd
, &
vfûl
, &
dummy
);

488 
	`gtk_wøp_box_£t_chûd_∑ckög
 (
box
, 
chûd
, 
hex∑nd
, 
hfûl
,

489 
vex∑nd
, 
vfûl
, 
wøµed
);

490 
	}
}

492 
	$shìts_dülog_n‹mÆize_löe_bªaks
(
GtkWidgë
 *
wøpbox
, 
ShìtsDülogMoveDú
 
dú
)

494 
GLi°
 *
buâ⁄_li°
;

495 
GLi°
 *
ôî_li°
;

496 
gboﬁón
 
is_löe_bªak
;

498 
buâ⁄_li°
 = 
	`gtk_c⁄èöî_chûdªn
(
	`GTK_CONTAINER
(
wøpbox
));

500 
is_löe_bªak
 = 
FALSE
;

501 
ôî_li°
 = 
buâ⁄_li°
; iãr_li°; iãr_li° = 
	`g_li°_√xt
(iter_list))

503 
ShìtMod
 *
sm
;

504 
ShìtObje˘Mod
 *
som
;

506 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
ôî_li°
->
d©a
), "sheet_mod");

507 
som
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
ôî_li°
->
d©a
), "sheet_object_mod");

508 i‡(
som
)

510 i‡(
is_löe_bªak
)

512 i‡(
som
->
shìt_obje˘
.
löe_bªak
 =
FALSE
)

514 i‡(
sm
->
mod
 =
SHEETMOD_MOD_NONE
)

515 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

517 
som
->
mod
 = 
SHEET_OBJECT_MOD_CHANGED
;

520 
som
->
shìt_obje˘
.
löe_bªak
 = 
TRUE
;

521 
	`_gtk_wøp_box_£t_chûd_f‹˚d_bªak
(
	`GTK_WRAP_BOX
(
wøpbox
),

522 
	`GTK_WIDGET
(
ôî_li°
->
d©a
), 
TRUE
);

526 i‡(
som
->
shìt_obje˘
.
löe_bªak
 =
TRUE
)

528 i‡(
sm
->
mod
 =
SHEETMOD_MOD_NONE
)

529 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

530 
som
->
mod
 = 
SHEET_OBJECT_MOD_CHANGED
;

533 
som
->
shìt_obje˘
.
löe_bªak
 = 
FALSE
;

534 
	`_gtk_wøp_box_£t_chûd_f‹˚d_bªak
(
	`GTK_WRAP_BOX
(
wøpbox
),

535 
	`GTK_WIDGET
(
ôî_li°
->
d©a
), 
FALSE
);

537 
is_löe_bªak
 = 
FALSE
;

541 i‡(
is_löe_bªak
)

543 i‡(
dú
 =
SHEETS_DIALOG_MOVE_UP
)

545 
ôî_li°
 = 
	`g_li°_¥evious
(iter_list);

546 
	`gtk_widgë_de°roy
(
	`GTK_WIDGET
(
ôî_li°
->
d©a
));

547 
ôî_li°
 = 
	`g_li°_√xt
(iter_list);

548 
ødio_group
 = 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(
ôî_li°


549 ->
d©a
));

553 
GLi°
 *
tmp_li°
;

555 
tmp_li°
 = 
	`g_li°_¥evious
(
ôî_li°
);

556 
	`gtk_widgë_de°roy
(
	`GTK_WIDGET
(
ôî_li°
->
d©a
));

557 
ødio_group
 = 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(
tmp_li°


558 ->
d©a
));

562 
is_löe_bªak
 = 
TRUE
;

568 
ôî_li°
 = 
	`g_li°_œ°
(
buâ⁄_li°
);

569 i‡(
ôî_li°
 && !
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(ôî_li°->
d©a
),

572 
	`gtk_widgë_de°roy
(
	`GTK_WIDGET
(
ôî_li°
->
d©a
));

573 i‡(
	`g_li°_¥evious
(
ôî_li°
))

575 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`g_li°_¥evious
(
ôî_li°
)->
d©a
, 
TRUE
);

576 
ødio_group
 = 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(

577 
	`g_li°_¥evious
(
ôî_li°
)->
d©a
));

581 
	`g_li°_‰ì
(
buâ⁄_li°
);

582 
	}
}

584 
GtkWidgë
 *

585 
	$shìts_dülog_gë_a˘ive_buâ⁄
(
GtkWidgë
 **
wøpbox
, 
GLi°
 **
buâ⁄_li°
)

587 
GtkWidgë
 *
èbÀ_shìts
;

589 
èbÀ_shìts
 = 
	`lookup_widgë
(
shìts_dülog
, "table_sheets");

590 *
wøpbox
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
èbÀ_shìts
), "active_wrapbox");

591 *
buâ⁄_li°
 = 
	`gtk_c⁄èöî_chûdªn
(
	`GTK_CONTAINER
(*
wøpbox
));

592  
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(*
wøpbox
), "active_button");

593 
	}
}

597 
	$shìts_dülog_move_up_‹_down
(
ShìtsDülogMoveDú
 
dú
)

599 
GtkWidgë
 *
èbÀ_shìts
;

600 
GtkWidgë
 *
wøpbox
;

601 
GLi°
 *
buâ⁄_li°
;

602 
GtkWidgë
 *
a˘ive_buâ⁄
;

603 
göt
 
buâ⁄_pos
;

604 
ShìtObje˘Mod
 *
som
;

605 
ShìtObje˘Mod
 *
som_√xt
;

606 
GLi°
 *
√xt_buâ⁄_li°
;

608 
èbÀ_shìts
 = 
	`lookup_widgë
(
shìts_dülog
, "table_sheets");

609 
wøpbox
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
èbÀ_shìts
), "active_wrapbox");

611 
buâ⁄_li°
 = 
	`gtk_c⁄èöî_chûdªn
(
	`GTK_CONTAINER
(
wøpbox
));

612 
a˘ive_buâ⁄
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
), "active_button");

614 
buâ⁄_pos
 = 
	`g_li°_ödex
(
buâ⁄_li°
, 
a˘ive_buâ⁄
);

615 
	`gtk_wøp_box_ª‹dî_chûd
(
	`GTK_WRAP_BOX
(
wøpbox
),

616 
	`GTK_WIDGET
(
a˘ive_buâ⁄
), 
buâ⁄_pos
 + 
dú
);

617 
	`g_li°_‰ì
(
buâ⁄_li°
);

619 
	`shìts_dülog_n‹mÆize_löe_bªaks
(
wøpbox
, 
dú
);

623 
buâ⁄_li°
 = 
	`gtk_c⁄èöî_chûdªn
(
	`GTK_CONTAINER
(
wøpbox
));

624 
a˘ive_buâ⁄
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
), "active_button");

626 
som
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_object_mod");

628 
√xt_buâ⁄_li°
 = 
	`g_li°_√xt
(
	`g_li°_föd
(
buâ⁄_li°
, 
a˘ive_buâ⁄
));

629 i‡(
√xt_buâ⁄_li°
)

630 
som_√xt
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
√xt_buâ⁄_li°
->
d©a
),

633 
som_√xt
 = 
NULL
;

641 i‡(
som
 && (((
dú
 =
SHEETS_DIALOG_MOVE_DOWN
)

642 && (
som
->
shìt_obje˘
.
löe_bªak
 =
FALSE
))

643 || (((
dú
 =
SHEETS_DIALOG_MOVE_UP
)

644 && 
som_√xt
))))

646 
ShìtMod
 *
sm
;

647 
GSLi°
 *
obje˘_li°
;

648 
göt
 
obje˘_pos
;

650 
som
->
mod
 = 
SHEET_OBJECT_MOD_CHANGED
;

652 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod");

653 i‡(
sm
->
mod
 =
SHEETMOD_MOD_NONE
)

654 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

656 
obje˘_li°
 = 
	`g_¶i°_föd
(
sm
->
shìt
.
obje˘s
, 
som
);

657 
	`g_as£π
(
obje˘_li°
);

659 
obje˘_pos
 = 
	`g_¶i°_posôi⁄
(
sm
->
shìt
.
obje˘s
, 
obje˘_li°
);

660 
sm
->
shìt
.
obje˘s
 = 
	`g_¶i°_ªmove_lök
(sm->shìt.obje˘s, 
obje˘_li°
);

661 
sm
->
shìt
.
obje˘s
 = 
	`g_¶i°_ö£π
(sm->shìt.obje˘s, 
obje˘_li°
->
d©a
,

662 
obje˘_pos
 + 
dú
);

665 
	`shìts_dülog_≠∂y_ªvît_£t_£nsôive
(
TRUE
);

667 
	`shìts_dülog_up_down_£t_£nsôive
(
buâ⁄_li°
,

668 
	`GTK_TOGGLE_BUTTON
(
a˘ive_buâ⁄
));

669 
	`g_li°_‰ì
(
buâ⁄_li°
);

670 
	}
}

673 
	$⁄_shìts_dülog_buâ⁄_move_up_˛icked
(
GtkBuâ⁄
 *
buâ⁄
, 
gpoöãr
 
u£r_d©a
)

675 
	`shìts_dülog_move_up_‹_down
(
SHEETS_DIALOG_MOVE_UP
);

676 
	}
}

679 
	$⁄_shìts_dülog_buâ⁄_move_down_˛icked
(
GtkBuâ⁄
 *
buâ⁄
, 
gpoöãr
 
u£r_d©a
)

681 
	`shìts_dülog_move_up_‹_down
(
SHEETS_DIALOG_MOVE_DOWN
);

682 
	}
}

685 
	$⁄_shìts_dülog_buâ⁄_˛o£_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

686 
gpoöãr
 
u£r_d©a
)

688 
	`shìts_dülog_hide
();

689 
	}
}

691 
GtkWidgë
 *
	gshìts_√w_dülog
;

695 
	mSHEETS_NEW_DIALOG_TYPE_SVG_SHAPE
 = 1,

696 
	mSHEETS_NEW_DIALOG_TYPE_LINE_BREAK
,

697 
	mSHEETS_NEW_DIALOG_TYPE_SHEET


699 
	tShìtsNewDülogTy≥
;

701 
GLi°
 *
	gshìts_√w_dülog_combo_li°
 = 
NULL
;

704 
	$⁄_shìts_dülog_buâ⁄_√w_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

705 
gpoöãr
 
u£r_d©a
)

707 
GtkWidgë
 *
combo
;

708 
GtkWidgë
 *
wøpbox
;

709 
GLi°
 *
buâ⁄_li°
;

710 
GtkWidgë
 *
a˘ive_buâ⁄
;

711 
gboﬁón
 
is_löe_bªak_£nsôive
;

713 
shìts_√w_dülog
 = 
	`¸óã_shìts_√w_dülog
();

715 i‡(
shìts_√w_dülog_combo_li°
)

717 
combo
 = 
	`lookup_widgë
(
shìts_√w_dülog
, "combo_from_file");

718 
	`gtk_combo_£t_p›down_°rögs
(
	`GTK_COMBO
(
combo
),

719 
shìts_√w_dülog_combo_li°
);

724 
a˘ive_buâ⁄
 = 
	`shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

725 
is_löe_bªak_£nsôive
 = 
TRUE
;

726 i‡(
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod"))

728 
buâ⁄_li°
 = 
	`g_li°_√xt
(
	`g_li°_föd
(buâ⁄_li°, 
a˘ive_buâ⁄
));

729 i‡(!
buâ⁄_li°
 || !
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(buâ⁄_li°->
d©a
),

731 
is_löe_bªak_£nsôive
 = 
FALSE
;

732 
	`g_li°_‰ì
(
buâ⁄_li°
);

735 
is_löe_bªak_£nsôive
 = 
FALSE
;

737 
a˘ive_buâ⁄
 = 
	`lookup_widgë
(
shìts_√w_dülog
, "radiobutton_line_break");

738 
	`gtk_widgë_£t_£nsôive
(
a˘ive_buâ⁄
, 
is_löe_bªak_£nsôive
);

742 
a˘ive_buâ⁄
 = 
	`lookup_widgë
(
shìts_√w_dülog
, "button_ok");

743 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "active_type",

744 (
gpoöãr
)
SHEETS_NEW_DIALOG_TYPE_SVG_SHAPE
);

746 
	`gtk_widgë_show
(
shìts_√w_dülog
);

747 
	}
}

750 
	g⁄_shìts_√w_dülog_buâ⁄_ˇn˚l_˛icked


751 (
GtkBuâ⁄
 *
	gbuâ⁄
,

752 
gpoöãr
 
	gu£r_d©a
)

754 
gtk_widgë_de°roy
(
shìts_√w_dülog
);

755 
	gshìts_√w_dülog
 = 
NULL
;

759 
	$⁄_shìts_√w_dülog_buâ⁄_ok_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

760 
gpoöãr
 
u£r_d©a
)

762 
ShìtsNewDülogTy≥
 
a˘ive_ty≥
;

763 
GtkWidgë
 *
èbÀ_shìts
;

764 
GtkWidgë
 *
wøpbox
;

765 
GLi°
 *
buâ⁄_li°
;

766 
GtkWidgë
 *
a˘ive_buâ⁄
;

768 
èbÀ_shìts
 = 
	`lookup_widgë
(
shìts_dülog
, "table_sheets");

769 
wøpbox
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
èbÀ_shìts
), "active_wrapbox");

771 
a˘ive_ty≥
 = (
ShìtsNewDülogTy≥
)
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
buâ⁄
),

773 
	`g_as£π
(
a˘ive_ty≥
);

775 
a˘ive_ty≥
)

777 
GtkWidgë
 *
íåy
;

778 
gch¨
 *
fûe_«me
;

779 
gch¨
 *
p
;

780 
°©
 
°©_buf
;

781 
GLi°
 *
∂ugö_li°
;

782 
DüObje˘Ty≥
 *
Ÿ
;

783 
	`gboﬁón
 (*
	tCu°omObje˘LﬂdFunc
Ë(
	tgch¨
*, 
	tDüObje˘Ty≥
 **);

784 
Cu°omObje˘LﬂdFunc
 
cu°om_obje˘_lﬂd_‚
;

785 
göt
 
pos
;

786 
GtkWidgë
 *
a˘ive_buâ⁄
;

787 
GLi°
 *
buâ⁄_li°
;

788 
ShìtObje˘Mod
 *
som
;

789 
ShìtMod
 *
sm
;

790 
ShìtObje˘
 *
shìt_obj
;

791 
Shìt
 *
shìt
;

792 
GtkWidgë
 *
›ti⁄míu
;

794 
SHEETS_NEW_DIALOG_TYPE_SVG_SHAPE
:

796 
íåy
 = 
	`lookup_widgë
(
shìts_√w_dülog
, "combo_entry_from_file");

798 
fûe_«me
 = 
	`gtk_edôabÀ_gë_ch¨s
(
	`GTK_EDITABLE
(
íåy
), 0, -1);

800 
p
 = 
fûe_«me
 + 
	`°æí
(file_name) - 6;

801 i‡(
	`°rcmp
(
p
, ".shape"))

803 
	`mesßge_îr‹
(
	`_
("Filename mustÉnd with '%s': '%s'"),

804 ".sh≠e", 
	`dü_mesßge_fûíame
(
fûe_«me
));

805 
	`g_‰ì
(
fûe_«me
);

809 i‡(
	`g_°©
(
fûe_«me
, &
°©_buf
) == -1)

811 
	`mesßge_îr‹
(
	`_
("ErrorÉxamining %s: %s"),

812 
	`dü_mesßge_fûíame
(
fûe_«me
), 
	`°ªº‹
(
î∫o
));

813 
	`g_‰ì
(
fûe_«me
);

817 
cu°om_obje˘_lﬂd_‚
 = 
NULL
;

818 
∂ugö_li°
 = 
	`dü_li°_∂ugös
();Ölugö_li° !
NULL
;

819 
∂ugö_li°
 = 
	`g_li°_√xt
(plugin_list))

821 
PlugöInfo
 *
öfo
 = 
∂ugö_li°
->
d©a
;

823 
cu°om_obje˘_lﬂd_‚
 =

824 (
Cu°omObje˘LﬂdFunc
)
	`dü_∂ugö_gë_symbﬁ
 (
öfo
, "custom_object_load");

825 i‡(
cu°om_obje˘_lﬂd_‚
)

828 
	`g_as£π
(
cu°om_obje˘_lﬂd_‚
);

830 i‡(!(*
cu°om_obje˘_lﬂd_‚
)(
fûe_«me
, &
Ÿ
))

832 
xmlDoc
 *
doc
 = 
NULL
;

833 
xmlNode
 *
roŸ_ñemít
 = 
NULL
;

836 
doc
 = 
	`xmlRódFûe
(
fûe_«me
, 
NULL
, 0);

837 if(
doc
 !
NULL
)

839 
roŸ_ñemít
 = 
	`xmlDocGëRoŸEÀmít
(
doc
);

840 if(0 =
	`g_°∫ˇ£cmp
((
gch¨
 *)
roŸ_ñemít
->
«me
, "dia", 3))

841 
	`mesßge_îr‹
(

842 
	`_
("PleaseÉxportÅhe diagramásá shape."));

843 
	`xmlFªeDoc
(
doc
);

845 
	`mesßge_îr‹
(
	`_
("CouldÇot interpret shape file: '%s'"),

846 
	`dü_mesßge_fûíame
(
fûe_«me
));

847 
	`xmlCÀ™upP¨£r
();

848 
	`g_‰ì
(
fûe_«me
);

851 
	`obje˘_ªgi°î_ty≥
(
Ÿ
);

853 
íåy
 = 
	`lookup_widgë
(
shìts_√w_dülog
, "entry_svg_description");

854 
shìt_obj
 = 
	`g_√w0
(
ShìtObje˘
, 1);

855 
shìt_obj
->
obje˘_ty≥
 = 
	`g_°rdup
(
Ÿ
->
«me
);

857 
shìt_obj
->
des¸ùti⁄
 =

858 
	`gtk_edôabÀ_gë_ch¨s
(
	`GTK_EDITABLE
(
íåy
), 0, -1);

860 
shìt_obj
->
pixm≠
 = 
Ÿ
->pixmap;

861 
shìt_obj
->
u£r_d©a
 = 
Ÿ
->
deÁu…_u£r_d©a
;

862 
shìt_obj
->
u£r_d©a_ty≥
 = 
USER_DATA_IS_OTHER
;

863 
shìt_obj
->
löe_bªak
 = 
FALSE
;

864 
shìt_obj
->
pixm≠_fûe
 = 
	`g_°rdup
(
Ÿ
->pixmap_file);

865 
shìt_obj
->
has_ic⁄_⁄_shìt
 = 
FALSE
;

867 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
), "sheet_mod");

868 
som
 = 
	`shìts_≠≥nd_shìt_obje˘_mod
(
shìt_obj
, 
sm
);

869 
som
->
mod
 = 
SHEET_OBJECT_MOD_NEW
;

870 
som
->
svg_fûíame
 = 
	`g_°rdup
(
fûe_«me
);

871 i‡(
sm
->
mod
 =
SHEETMOD_MOD_NONE
)

872 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

874 
a˘ive_buâ⁄
 = 
	`shìts_dülog_¸óã_obje˘_buâ⁄
(
som
, 
sm
, 
wøpbox
);

875 
	`gtk_wøp_box_∑ck
(
	`GTK_WRAP_BOX
(
wøpbox
), 
a˘ive_buâ⁄
,

876 
FALSE
, 
TRUE
, FALSE, TRUE);

877 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
a˘ive_buâ⁄
), 
TRUE
);

878 
	`gtk_widgë_show
(
a˘ive_buâ⁄
);

880 
shìts_√w_dülog_combo_li°
 = 
	`g_li°_≠≥nd
(sheets_new_dialog_combo_list,

881 
fûe_«me
);

884 
SHEETS_NEW_DIALOG_TYPE_LINE_BREAK
:

886 
	`shìts_dülog_wøpbox_add_löe_bªak
(
wøpbox
);

888 
buâ⁄_li°
 = 
	`gtk_c⁄èöî_chûdªn
(
	`GTK_CONTAINER
(
wøpbox
));

889 
a˘ive_buâ⁄
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
), "active_button");

890 
pos
 = 
	`g_li°_ödex
(
buâ⁄_li°
, 
a˘ive_buâ⁄
);

891 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
	`g_li°_œ°
(
buâ⁄_li°
)

892 ->
d©a
), 
TRUE
);

893 
	`gtk_wøp_box_ª‹dî_chûd
(
	`GTK_WRAP_BOX
(
wøpbox
),

894 
	`g_li°_œ°
(
buâ⁄_li°
)->
d©a
, 
pos
 + 1);

896 
	`shìts_dülog_n‹mÆize_löe_bªaks
(
wøpbox
, 
SHEETS_DIALOG_MOVE_NONE
);

898 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
), "sheet_mod");

899 i‡(
sm
->
mod
 =
SHEETMOD_MOD_NONE
)

900 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

902 
	`g_li°_‰ì
(
buâ⁄_li°
);

905 
SHEETS_NEW_DIALOG_TYPE_SHEET
:

907 
gch¨
 *
shìt_«me
;

908 
gch¨
 *
shìt_des¸ù
;

910 
íåy
 = 
	`lookup_widgë
(
shìts_√w_dülog
, "entry_sheet_name");

911 
shìt_«me
 = 
	`gtk_edôabÀ_gë_ch¨s
(
	`GTK_EDITABLE
(
íåy
), 0, -1);

913 
shìt_«me
 = 
	`g_°rchug
(
	`g_°rchomp
(sheet_name));

914 i‡(!*
shìt_«me
)

916 
	`mesßge_îr‹
(
	`_
("Sheet must haveá Name"));

920 
íåy
 = 
	`lookup_widgë
(
shìts_√w_dülog
, "entry_sheet_description");

921 
shìt_des¸ù
 = 
	`gtk_edôabÀ_gë_ch¨s
(
	`GTK_EDITABLE
(
íåy
), 0, -1);

923 
shìt
 = 
	`g_√w0
(
Shìt
, 1);

924 
shìt
->
«me
 = 
shìt_«me
;

925 
shìt
->
fûíame
 = "";

926 
shìt
->
des¸ùti⁄
 = 
shìt_des¸ù
;

927 
shìt
->
sc›e
 = 
SHEET_SCOPE_USER
;

928 
shìt
->
shadowög
 = 
NULL
;

929 
shìt
->
obje˘s
 = 
NULL
;

931 
sm
 = 
	`shìts_≠≥nd_shìt_mods
(
shìt
);

932 
sm
->
mod
 = 
SHEETMOD_MOD_NEW
;

934 
èbÀ_shìts
 = 
	`lookup_widgë
(
shìts_dülog
, "table_sheets");

935 
›ti⁄míu
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
èbÀ_shìts
),

937 
	`g_as£π
(
›ti⁄míu
);

938 
	`shìts_›ti⁄míu_¸óã
(
›ti⁄míu
, 
wøpbox
, 
shìt_«me
);

943 
	`g_as£π_nŸ_ªached
();

946 
	`shìts_dülog_≠∂y_ªvît_£t_£nsôive
(
TRUE
);

948 
buâ⁄_li°
 = 
	`gtk_c⁄èöî_chûdªn
(
	`GTK_CONTAINER
(
wøpbox
));

949 
a˘ive_buâ⁄
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
), "active_button");

950 
	`shìts_dülog_up_down_£t_£nsôive
(
buâ⁄_li°
,

951 
	`GTK_TOGGLE_BUTTON
(
a˘ive_buâ⁄
));

952 
	`g_li°_‰ì
(
buâ⁄_li°
);

954 
	`gtk_widgë_de°roy
(
shìts_√w_dülog
);

955 
shìts_√w_dülog
 = 
NULL
;

956 
	}
}

958 
GtkWidgë
 *
	gshìts_sh≠e£À˘i⁄_dülog
;

961 
	g⁄_shìts_√w_dülog_buâ⁄_brow£_˛icked


962 (
GtkBuâ⁄
 *
	gbuâ⁄
,

963 
gpoöãr
 
	gu£r_d©a
)

965 
	gshìts_sh≠e£À˘i⁄_dülog
 = 
¸óã_shìts_sh≠e£À˘i⁄_dülog
();

966 
gtk_widgë_show
(
shìts_sh≠e£À˘i⁄_dülog
);

970 
	g⁄_shìts_sh≠e£À˘i⁄_dülog_buâ⁄_ˇn˚l_˛icked


971 (
GtkBuâ⁄
 *
	gbuâ⁄
,

972 
gpoöãr
 
	gu£r_d©a
)

974 
gtk_widgë_de°roy
(
shìts_sh≠e£À˘i⁄_dülog
);

975 
	gshìts_sh≠e£À˘i⁄_dülog
 = 
NULL
;

979 
	g⁄_shìts_sh≠e£À˘i⁄_dülog_buâ⁄_ok_˛icked


980 (
GtkBuâ⁄
 *
	gbuâ⁄
,

981 
gpoöãr
 
	gu£r_d©a
)

983 c⁄° 
gch¨
 *
	gfûíame
;

984 
GtkWidgë
 *
	gíåy
;

986 
	gfûíame
 =

987 
gtk_fûe_£À˘i⁄_gë_fûíame
(

988 
GTK_FILE_SELECTION
(
shìts_sh≠e£À˘i⁄_dülog
));

990 
	gíåy
 = 
lookup_widgë
(
shìts_√w_dülog
, "combo_entry_from_file");

992 
gtk_íåy_£t_ãxt
(
GTK_ENTRY
(
íåy
), 
fûíame
);

994 
gtk_widgë_de°roy
(
shìts_sh≠e£À˘i⁄_dülog
);

995 
	gshìts_sh≠e£À˘i⁄_dülog
 = 
NULL
;

998 
GtkWidgë
 *
	gshìts_edô_dülog
;

1001 
	$⁄_shìts_dülog_buâ⁄_edô_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

1002 
gpoöãr
 
u£r_d©a
)

1004 
GtkWidgë
 *
wøpbox
;

1005 
GLi°
 *
buâ⁄_li°
;

1006 
GtkWidgë
 *
a˘ive_buâ⁄
;

1007 
ShìtObje˘Mod
 *
som
;

1008 
gch¨
 *
des¸ù
 = "";

1009 
gch¨
 *
ty≥
 = "";

1010 
GtkWidgë
 *
íåy
;

1011 
ShìtMod
 *
sm
;

1012 
gch¨
 *
«me
 = "";

1014 i‡(
shìts_edô_dülog
 =
NULL
)

1015 
shìts_edô_dülog
 = 
	`¸óã_shìts_edô_dülog
();

1017 
a˘ive_buâ⁄
 = 
	`shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

1018 
som
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_object_mod");

1019 i‡(
som
)

1021 
des¸ù
 = 
som
->
shìt_obje˘
.
des¸ùti⁄
;

1022 
ty≥
 = 
	`shìt_obje˘_mod_gë_ty≥_°rög
(
som
);

1025 
íåy
 = 
	`lookup_widgë
(
shìts_edô_dülog
, "entry_object_description");

1026 i‡(
som
)

1027 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
íåy
), 
des¸ù
);

1029 
	`gtk_widgë_£t_£nsôive
(
íåy
, 
FALSE
);

1031 
íåy
 = 
	`lookup_widgë
(
shìts_edô_dülog
, "entry_object_type");

1032 i‡(
som
)

1033 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
íåy
), 
ty≥
);

1035 
	`gtk_widgë_£t_£nsôive
(
íåy
, 
FALSE
);

1037 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod");

1038 i‡(
sm
)

1040 
«me
 = 
sm
->
shìt
.name;

1041 
des¸ù
 = 
sm
->
shìt
.
des¸ùti⁄
;

1044 
íåy
 = 
	`lookup_widgë
(
shìts_edô_dülog
, "entry_sheet_name");

1045 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
íåy
), 
«me
);

1046 #i‡
CAN_EDIT_SHEET_NAME


1047 i‡(
sm
->
shìt
.
sc›e
 =
SHEET_SCOPE_SYSTEM
)

1049 
	`gtk_widgë_£t_£nsôive
(
íåy
, 
FALSE
);

1051 
íåy
 = 
	`lookup_widgë
(
shìts_edô_dülog
, "entry_sheet_description");

1052 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
íåy
), 
des¸ù
);

1054 
	`gtk_widgë_show
(
shìts_edô_dülog
);

1055 
	}
}

1058 
	g⁄_shìts_edô_dülog_buâ⁄_ˇn˚l_˛icked


1059 (
GtkBuâ⁄
 *
	gbuâ⁄
,

1060 
gpoöãr
 
	gu£r_d©a
)

1062 
gtk_widgë_de°roy
(
shìts_edô_dülog
);

1063 
	gshìts_edô_dülog
 = 
NULL
;

1066 
GtkWidgë
 *
	gshìts_ªmove_dülog
;

1070 
	mSHEETS_REMOVE_DIALOG_TYPE_OBJECT
 = 1,

1071 
	mSHEETS_REMOVE_DIALOG_TYPE_SHEET


1073 
	tShìtsRemoveDülogTy≥
;

1076 
	$⁄_shìts_dülog_buâ⁄_ªmove_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

1077 
gpoöãr
 
u£r_d©a
)

1079 
GtkWidgë
 *
wøpbox
;

1080 
GLi°
 *
buâ⁄_li°
;

1081 
GtkWidgë
 *
a˘ive_buâ⁄
;

1082 
ShìtMod
 *
sm
;

1083 
GtkWidgë
 *
íåy
;

1084 
GtkWidgë
 *
ødio_buâ⁄
;

1086 
shìts_ªmove_dülog
 = 
	`¸óã_shìts_ªmove_dülog
();

1088 
a˘ive_buâ⁄
 = 
	`shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

1089 
	`g_as£π
(
a˘ive_buâ⁄
);

1093 
ødio_buâ⁄
 = 
	`lookup_widgë
(
shìts_ªmove_dülog
, "radiobutton_sheet");

1094 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
ødio_buâ⁄
), 
TRUE
);

1096 
íåy
 = 
	`lookup_widgë
(
shìts_ªmove_dülog
, "entry_object");

1097 i‡(
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "is_hidden_button"))

1099 
ødio_buâ⁄
 = 
	`lookup_widgë
(
shìts_ªmove_dülog
, "radiobutton_object");

1100 
	`gtk_widgë_£t_£nsôive
(
ødio_buâ⁄
, 
FALSE
);

1101 
	`gtk_widgë_£t_£nsôive
(
íåy
, 
FALSE
);

1105 
ShìtObje˘Mod
 *
som
;

1107 
som
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_object_mod");

1108 i‡(!
som
)

1109 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
íåy
), 
	`_
("Line Break"));

1111 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
íåy
), 
som
->
shìt_obje˘
.
des¸ùti⁄
);

1113 
ødio_buâ⁄
 = 
	`lookup_widgë
(
shìts_ªmove_dülog
, "radiobutton_object");

1114 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
ødio_buâ⁄
), 
TRUE
);

1117 
íåy
 = 
	`lookup_widgë
(
shìts_ªmove_dülog
, "entry_sheet");

1118 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod");

1127 i‡(
sm
->
shìt
.
shadowög
 =
NULL
 && sm->shìt.
sc›e
 =
SHEET_SCOPE_SYSTEM
)

1129 
GtkWidgë
 *
ødio_buâ⁄
;

1131 
ødio_buâ⁄
 = 
	`lookup_widgë
(
shìts_ªmove_dülog
, "radiobutton_sheet");

1132 
	`gtk_widgë_£t_£nsôive
(
ødio_buâ⁄
, 
FALSE
);

1133 
	`gtk_widgë_£t_£nsôive
(
íåy
, 
FALSE
);

1135 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
íåy
), 
sm
->
shìt
.
«me
);

1137 
	`gtk_widgë_show
(
shìts_ªmove_dülog
);

1138 
	}
}

1141 
	g⁄_shìts_ªmove_dülog_buâ⁄_ˇn˚l_˛icked


1142 (
GtkBuâ⁄
 *
	gbuâ⁄
,

1143 
gpoöãr
 
	gu£r_d©a
)

1145 
gtk_widgë_de°roy
(
shìts_ªmove_dülog
);

1146 
	gshìts_ªmove_dülog
 = 
NULL
;

1150 
	$shìts_dülog_toggÀbuâ⁄_£t_£nsôive
(
GtkToggÀBuâ⁄
 *
toggÀbuâ⁄
,

1151 
GtkWidgë
 *
dülog
,

1152 
gch¨
 *
widgë_«mes
[], 
göt
 
ty≥
)

1154 
gboﬁón
 
is_£nsôive
;

1155 
guöt
 
i
;

1156 
GtkWidgë
 *
tmp
;

1158 
is_£nsôive
 = 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
toggÀbuâ⁄
));

1159 i‡(
is_£nsôive
)

1161 
tmp
 = 
	`lookup_widgë
(
dülog
, "button_ok");

1162 
	`gtk_obje˘_£t_d©a
(
	`GTK_OBJECT
(
tmp
), "a˘ive_ty≥", (
gpoöãr
)
ty≥
);

1165 
i
 = 0; 
widgë_«mes
[i]; i++)

1167 
tmp
 = 
	`lookup_widgë
(
dülog
, 
widgë_«mes
[
i
]);

1168 
	`gtk_widgë_£t_£nsôive
(
tmp
, 
is_£nsôive
);

1170 
	}
}

1173 
	g⁄_shìts_√w_dülog_ødiobuâ⁄_svg_sh≠e_toggÀd


1174 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

1175 
gpoöãr
 
	gu£r_d©a
)

1177 
gch¨
 *
	gwidgë_«mes
[] =

1183 
NULL


1186 
shìts_dülog_toggÀbuâ⁄_£t_£nsôive
(
toggÀbuâ⁄
, 
shìts_√w_dülog
,

1187 
widgë_«mes
,

1188 
SHEETS_NEW_DIALOG_TYPE_SVG_SHAPE
);

1192 
	g⁄_shìts_√w_dülog_ødiobuâ⁄_shìt_toggÀd


1193 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

1194 
gpoöãr
 
	gu£r_d©a
)

1196 
gch¨
 *
	gwidgë_«mes
[] =

1201 
NULL


1204 
shìts_dülog_toggÀbuâ⁄_£t_£nsôive
(
toggÀbuâ⁄
, 
shìts_√w_dülog
,

1205 
widgë_«mes
,

1206 
SHEETS_NEW_DIALOG_TYPE_SHEET
);

1210 
	g⁄_shìts_√w_dülog_ødiobuâ⁄_löe_bªak_toggÀd


1211 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

1212 
gpoöãr
 
	gu£r_d©a
)

1214 
gch¨
 *
	gwidgë_«mes
[] =

1216 
NULL


1219 
shìts_dülog_toggÀbuâ⁄_£t_£nsôive
(
toggÀbuâ⁄
, 
shìts_√w_dülog
,

1220 
widgë_«mes
,

1221 
SHEETS_NEW_DIALOG_TYPE_LINE_BREAK
);

1225 
	g⁄_shìts_ªmove_dülog_ødiobuâ⁄_obje˘_toggÀd


1226 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

1227 
gpoöãr
 
	gu£r_d©a
)

1229 
gch¨
 *
	gwidgë_«mes
[] =

1233 
NULL


1236 
shìts_dülog_toggÀbuâ⁄_£t_£nsôive
(
toggÀbuâ⁄
, 
shìts_ªmove_dülog
,

1237 
widgë_«mes
,

1238 
SHEETS_REMOVE_DIALOG_TYPE_OBJECT
);

1242 
	g⁄_shìts_ªmove_dülog_ødiobuâ⁄_shìt_toggÀd


1243 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

1244 
gpoöãr
 
	gu£r_d©a
)

1246 
gch¨
 *
	gwidgë_«mes
[] =

1249 
NULL


1252 
shìts_dülog_toggÀbuâ⁄_£t_£nsôive
(
toggÀbuâ⁄
, 
shìts_ªmove_dülog
,

1253 
widgë_«mes
,

1254 
SHEETS_REMOVE_DIALOG_TYPE_SHEET
);

1257 
GtkWidgë
 *

1258 
	$shìts_dülog_£t_√w_a˘ive_buâ⁄
()

1260 
GtkWidgë
 *
a˘ive_buâ⁄
;

1261 
GtkWidgë
 *
wøpbox
;

1262 
GLi°
 *
buâ⁄_li°
;

1263 
GLi°
 *
a˘ive_buâ⁄_li°
;

1264 
GtkWidgë
 *
√w_a˘ive_buâ⁄
;

1266 
a˘ive_buâ⁄
 = 
	`shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

1268 
a˘ive_buâ⁄_li°
 = 
	`g_li°_föd
(
buâ⁄_li°
, 
a˘ive_buâ⁄
);

1269 
	`g_as£π
(
a˘ive_buâ⁄_li°
);

1270 i‡(
	`g_li°_√xt
(
a˘ive_buâ⁄_li°
))

1271 
√w_a˘ive_buâ⁄
 = 
	`g_li°_√xt
(
a˘ive_buâ⁄_li°
)->
d©a
;

1274 i‡(
	`g_li°_¥evious
(
a˘ive_buâ⁄_li°
))

1275 
√w_a˘ive_buâ⁄
 = 
	`g_li°_¥evious
(
a˘ive_buâ⁄_li°
)->
d©a
;

1277 
√w_a˘ive_buâ⁄
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
),

1280 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
√w_a˘ive_buâ⁄
), 
TRUE
);

1282  
√w_a˘ive_buâ⁄
;

1283 
	}
}

1286 
	g⁄_shìts_ªmove_dülog_buâ⁄_ok_˛icked


1287 (
GtkBuâ⁄
 *
	gbuâ⁄
,

1288 
gpoöãr
 
	gu£r_d©a
)

1290 
ShìtsRemoveDülogTy≥
 
	gty≥
;

1291 
GtkWidgë
 *
	gwøpbox
;

1292 
GLi°
 *
	gbuâ⁄_li°
;

1293 
GtkWidgë
 *
	ga˘ive_buâ⁄
;

1295 
	gty≥
 = (
ShìtsRemoveDülogTy≥
)
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
buâ⁄
),

1298 
	ga˘ive_buâ⁄
 = 
shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

1300 
	gty≥
)

1302 
ShìtObje˘Mod
 *
	gsom
;

1303 
GtkWidgë
 *
	g√w_a˘ive_buâ⁄
;

1304 
ShìtMod
 *
	gsm
;

1305 
GtkWidgë
 *
	gèbÀ_shìts
;

1306 
GtkWidgë
 *
	g›ti⁄míu
;

1308 
	gSHEETS_REMOVE_DIALOG_TYPE_OBJECT
:

1310 
som
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_object_mod");

1311 i‡(
	gsom
)

1313 
	gsm
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod");

1314 
	gsm
->
	gmod
 = 
SHEETMOD_MOD_CHANGED
;

1315 
	gsom
->
	gmod
 = 
SHEET_OBJECT_MOD_DELETED
;

1317 
	g√w_a˘ive_buâ⁄
 = 
shìts_dülog_£t_√w_a˘ive_buâ⁄
();

1319 
gtk_widgë_de°roy
(
a˘ive_buâ⁄
);

1320 
	gødio_group
 = 
gtk_ødio_buâ⁄_group
(
GTK_RADIO_BUTTON
(
√w_a˘ive_buâ⁄
));

1322 
shìts_dülog_n‹mÆize_löe_bªaks
(
wøpbox
, 
SHEETS_DIALOG_MOVE_NONE
);

1325 
	gSHEETS_REMOVE_DIALOG_TYPE_SHEET
:

1327 
sm
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod");

1328 
	gsm
->
	gmod
 = 
SHEETMOD_MOD_DELETED
;

1330 i‡(
	gsm
->
	gshìt
.
	gshadowög
 && sm->shìt.
	gsc›e
 =
SHEET_SCOPE_USER
)

1331 
shìts_≠≥nd_shìt_mods
(
sm
->
shìt
.
shadowög
);

1333 
	gèbÀ_shìts
 = 
lookup_widgë
(
shìts_dülog
, "table_sheets");

1334 
	g›ti⁄míu
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
èbÀ_shìts
),

1336 
g_as£π
(
›ti⁄míu
);

1337 
shìts_›ti⁄míu_¸óã
(
›ti⁄míu
, 
wøpbox
, 
NULL
);

1342 
g_as£π_nŸ_ªached
();

1345 
g_li°_‰ì
(
buâ⁄_li°
);

1347 
shìts_dülog_≠∂y_ªvît_£t_£nsôive
(
TRUE
);

1348 
gtk_widgë_de°roy
(
shìts_ªmove_dülog
);

1349 
	gshìts_ªmove_dülog
 = 
NULL
;

1353 
	g⁄_shìts_edô_dülog_buâ⁄_ok_˛icked


1354 (
GtkBuâ⁄
 *
	gbuâ⁄
,

1355 
gpoöãr
 
	gu£r_d©a
)

1357 
GtkWidgë
 *
	ga˘ive_buâ⁄
;

1358 
GtkWidgë
 *
	gwøpbox
;

1359 
GLi°
 *
	gbuâ⁄_li°
;

1360 
GtkWidgë
 *
	gíåy
;

1361 
gboﬁón
 
	gsomëhög_ch™ged
 = 
FALSE
;

1363 
	ga˘ive_buâ⁄
 = 
shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

1364 
g_as£π
(
a˘ive_buâ⁄
);

1366 
	gíåy
 = 
lookup_widgë
(
shìts_edô_dülog
, "entry_object_description");

1367 i‡((
	ggboﬁón
)
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
íåy
), "ch™ged"Ë=
TRUE
)

1369 
ShìtMod
 *
sm
;

1370 
ShìtObje˘Mod
 *
	gsom
;

1372 
	gsom
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_object_mod");

1373 
	gsom
->
	gshìt_obje˘
.
	gdes¸ùti⁄
 =

1374 
gtk_edôabÀ_gë_ch¨s
(
GTK_EDITABLE
(
íåy
), 0, -1);

1375 
shìts_dülog_obje˘_£t_toﬁtù
(
som
, 
a˘ive_buâ⁄
);

1377 
	gsom
->
	gmod
 = 
SHEET_OBJECT_MOD_CHANGED
;

1379 
	gsm
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod");

1380 i‡(
	gsm
->
	gmod
 =
SHEETMOD_MOD_NONE
)

1381 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1383 
	gsomëhög_ch™ged
 = 
TRUE
;

1386 
	gíåy
 = 
lookup_widgë
(
shìts_edô_dülog
, "entry_sheet_description");

1387 i‡((
	ggboﬁón
)
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
íåy
), "ch™ged"Ë=
TRUE
)

1389 
ShìtMod
 *
sm
;

1391 
	gsm
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod");

1392 
	gsm
->
	gshìt
.
	gdes¸ùti⁄
 =

1393 
gtk_edôabÀ_gë_ch¨s
(
GTK_EDITABLE
(
íåy
), 0, -1);

1395 i‡(
	gsm
->
	gmod
 =
SHEETMOD_MOD_NONE
)

1396 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1397 
	gsomëhög_ch™ged
 = 
TRUE
;

1400 #ifde‡
CAN_EDIT_SHEET_NAME


1403 
	gíåy
 = 
lookup_widgë
(
shìts_edô_dülog
, "entry_sheet_name");

1404 i‡((
	ggboﬁón
)
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
íåy
), "ch™ged"Ë=
TRUE
)

1406 
ShìtMod
 *
sm
;

1407 
GtkWidgë
 *
	gèbÀ_shìts
;

1408 
GtkWidgë
 *
	g›ti⁄míu
;

1410 
	gsm
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod");

1411 
	gsm
->
	gshìt
.
	g«me
 = 
gtk_edôabÀ_gë_ch¨s
(
GTK_EDITABLE
(
íåy
), 0, -1);

1412 i‡(
	gsm
->
	gmod
 =
SHEETMOD_MOD_NONE
)

1413 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1415 
	gèbÀ_shìts
 = 
lookup_widgë
(
shìts_dülog
, "table_sheets");

1416 
	g›ti⁄míu
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
èbÀ_shìts
),

1418 
shìts_›ti⁄míu_¸óã
(
›ti⁄míu
, 
wøpbox
, 
NULL
);

1420 
	gsomëhög_ch™ged
 = 
TRUE
;

1423 i‡(
	gsomëhög_ch™ged
 =
TRUE
)

1424 
shìts_dülog_≠∂y_ªvît_£t_£nsôive
(
TRUE
);

1426 
gtk_widgë_de°roy
(
shìts_edô_dülog
);

1427 
	gshìts_edô_dülog
 = 
NULL
;

1431 
	g⁄_shìts_edô_dülog_íåy_obje˘_des¸ùti⁄_ch™ged


1432 (
GtkEdôabÀ
 *
	gedôabÀ
,

1433 
gpoöãr
 
	gu£r_d©a
)

1435 
gtk_obje˘_£t_d©a
(
GTK_OBJECT
(
edôabÀ
), "ch™ged", (
gpoöãr
)
TRUE
);

1440 
	g⁄_shìts_edô_dülog_íåy_shìt_des¸ùti⁄_ch™ged


1441 (
GtkEdôabÀ
 *
	gedôabÀ
,

1442 
gpoöãr
 
	gu£r_d©a
)

1444 
gtk_obje˘_£t_d©a
(
GTK_OBJECT
(
edôabÀ
), "ch™ged", (
gpoöãr
)
TRUE
);

1448 
	g⁄_shìts_edô_dülog_íåy_shìt_«me_ch™ged


1449 (
GtkEdôabÀ
 *
	gedôabÀ
,

1450 
gpoöãr
 
	gu£r_d©a
)

1452 
gtk_obje˘_£t_d©a
(
GTK_OBJECT
(
edôabÀ
), "ch™ged", (
gpoöãr
)
TRUE
);

1455 
GtkWidgë
 *

1456 
	$shìts_dülog_gë_èrgë_wøpbox
(
GtkWidgë
 *
wøpbox
)

1458 i‡(
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
wøpbox
), "is_left"))

1459  
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
shìts_dülog
), "wrapbox_right");

1461  
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
shìts_dülog
), "wrapbox_left");

1462 
	}
}

1465 
	$shìts_dülog_c›y_obje˘
(
GtkWidgë
 *
a˘ive_buâ⁄
, GtkWidgë *
èrgë_wøpbox
)

1467 
GtkWidgë
 *
buâ⁄
;

1468 
ShìtMod
 *
sm
;

1469 
ShìtObje˘Mod
 *
som
;

1470 
ShìtObje˘Mod
 *
som_√w
;

1472 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
èrgë_wøpbox
), "sheet_mod");

1473 
som
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_object_mod");

1475 i‡(!
som
)

1479 
som_√w
 = 
	`g_√w0
(
ShìtObje˘Mod
, 1);

1481 
ShìtObje˘
 *
so
 = &
som_√w
->
shìt_obje˘
;

1483 
so
->
obje˘_ty≥
 = 
	`g_°rdup
(
som
->
shìt_obje˘
.object_type);

1484 
so
->
des¸ùti⁄
 = 
	`g_°rdup
(
som
->
shìt_obje˘
.description);

1485 
so
->
pixm≠
 = 
som
->
shìt_obje˘
.pixmap;

1486 
so
->
u£r_d©a
 = 
som
->
shìt_obje˘
.user_data;

1487 
so
->
u£r_d©a_ty≥
 = 
som
->
shìt_obje˘
.user_data_type;

1488 
so
->
löe_bªak
 = 
FALSE
;

1489 
so
->
pixm≠_fûe
 = 
	`g_°rdup
(
som
->
shìt_obje˘
.pixmap_file);

1490 
so
->
has_ic⁄_⁄_shìt
 = 
som
->
shìt_obje˘
.has_icon_on_sheet;

1493 
som_√w
->
ty≥
 = 
som
->type;

1494 
som_√w
->
mod
 = 
SHEET_OBJECT_MOD_NONE
;

1496 
sm
->
shìt
.
obje˘s
 = 
	`g_¶i°_≠≥nd
(sm->shìt.obje˘s, 
som_√w
);

1497 i‡(
sm
->
mod
 =
SHEETMOD_MOD_NONE
)

1498 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1500 
buâ⁄
 = 
	`shìts_dülog_¸óã_obje˘_buâ⁄
(
som_√w
, 
sm
, 
èrgë_wøpbox
);

1501 
	`gtk_wøp_box_∑ck
(
	`GTK_WRAP_BOX
(
èrgë_wøpbox
), 
buâ⁄
,

1502 
FALSE
, 
TRUE
, FALSE, TRUE);

1503 
	`gtk_widgë_show
(
buâ⁄
);

1505 
	`shìts_dülog_≠∂y_ªvît_£t_£nsôive
(
TRUE
);

1506 
	}
}

1509 
	$⁄_shìts_dülog_buâ⁄_c›y_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

1510 
gpoöãr
 
u£r_d©a
)

1512 
GtkWidgë
 *
a˘ive_buâ⁄
;

1513 
GtkWidgë
 *
wøpbox
;

1514 
GLi°
 *
buâ⁄_li°
;

1515 
GtkWidgë
 *
èrgë_wøpbox
;

1517 
a˘ive_buâ⁄
 = 
	`shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

1519 
èrgë_wøpbox
 = 
	`shìts_dülog_gë_èrgë_wøpbox
(
wøpbox
);

1521 
	`shìts_dülog_c›y_obje˘
(
a˘ive_buâ⁄
, 
èrgë_wøpbox
);

1522 
	}
}

1525 
	g⁄_shìts_dülog_buâ⁄_c›y_Æl_˛icked


1526 (
GtkBuâ⁄
 *
	gbuâ⁄
,

1527 
gpoöãr
 
	gu£r_d©a
)

1529 
GtkWidgë
 *
	ga˘ive_buâ⁄
;

1530 
GtkWidgë
 *
	gwøpbox
;

1531 
GLi°
 *
	gbuâ⁄_li°
, *
	gôî_li°
;

1532 
GtkWidgë
 *
	gèrgë_wøpbox
;

1534 
	ga˘ive_buâ⁄
 = 
shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

1536 
	gèrgë_wøpbox
 = 
shìts_dülog_gë_èrgë_wøpbox
(
wøpbox
);

1538 
	gôî_li°
 = 
buâ⁄_li°
; iãr_li°; iãr_li° = 
g_li°_√xt
(
ôî_li°
))

1539 
shìts_dülog_c›y_obje˘
(
ôî_li°
->
d©a
, 
èrgë_wøpbox
);

1543 
	$⁄_shìts_dülog_buâ⁄_move_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

1544 
gpoöãr
 
u£r_d©a
)

1546 
GtkWidgë
 *
a˘ive_buâ⁄
;

1547 
GtkWidgë
 *
wøpbox
;

1548 
GLi°
 *
buâ⁄_li°
;

1549 
GtkWidgë
 *
èrgë_wøpbox
;

1550 
ShìtObje˘Mod
 *
som
;

1551 
GtkWidgë
 *
√w_a˘ive_buâ⁄
;

1553 
a˘ive_buâ⁄
 = 
	`shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

1555 
èrgë_wøpbox
 = 
	`shìts_dülog_gë_èrgë_wøpbox
(
wøpbox
);

1557 
	`shìts_dülog_c›y_obje˘
(
a˘ive_buâ⁄
, 
èrgë_wøpbox
);

1559 
som
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_object_mod");

1560 i‡(
som
) {

1561 
ShìtMod
 *
sm
;

1563 
som
->
mod
 = 
SHEET_OBJECT_MOD_DELETED
;

1565 
sm
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
a˘ive_buâ⁄
), "sheet_mod");

1566 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1569 
√w_a˘ive_buâ⁄
 = 
	`shìts_dülog_£t_√w_a˘ive_buâ⁄
();

1571 
	`gtk_widgë_de°roy
(
a˘ive_buâ⁄
);

1572 
ødio_group
 = 
	`gtk_ødio_buâ⁄_group
(
	`GTK_RADIO_BUTTON
(
√w_a˘ive_buâ⁄
));

1574 
	`shìts_dülog_n‹mÆize_löe_bªaks
(
wøpbox
, 
SHEETS_DIALOG_MOVE_NONE
);

1575 
	}
}

1578 
	g⁄_shìts_dülog_buâ⁄_move_Æl_˛icked


1579 (
GtkBuâ⁄
 *
	gbuâ⁄
,

1580 
gpoöãr
 
	gu£r_d©a
)

1582 
GtkWidgë
 *
	ga˘ive_buâ⁄
;

1583 
GtkWidgë
 *
	gwøpbox
;

1584 
GLi°
 *
	gbuâ⁄_li°
;

1585 
GLi°
 *
	gôî_li°
;

1586 
GtkWidgë
 *
	gèrgë_wøpbox
;

1587 
ShìtObje˘Mod
 *
	gsom
;

1589 
	ga˘ive_buâ⁄
 = 
shìts_dülog_gë_a˘ive_buâ⁄
(&
wøpbox
, &
buâ⁄_li°
);

1591 
	gèrgë_wøpbox
 = 
shìts_dülog_gë_èrgë_wøpbox
(
wøpbox
);

1593 
	gôî_li°
 = 
buâ⁄_li°
; iãr_li°; iãr_li° = 
g_li°_√xt
(
ôî_li°
))

1595 
shìts_dülog_c›y_obje˘
(
ôî_li°
->
d©a
, 
èrgë_wøpbox
);

1597 
	gsom
 = 
gtk_obje˘_gë_d©a
(
GTK_OBJECT
(
ôî_li°
->
d©a
), "sheet_object_mod");

1598 i‡(
	gsom
)

1599 
	gsom
->
	gmod
 = 
SHEET_OBJECT_MOD_DELETED
;

1601 
gtk_widgë_de°roy
(
ôî_li°
->
d©a
);

1608 
	gbuâ⁄_li°
 = 
gtk_c⁄èöî_chûdªn
(
GTK_CONTAINER
(
èrgë_wøpbox
));

1609 
gtk_toggÀ_buâ⁄_£t_a˘ive
(
GTK_TOGGLE_BUTTON
(
buâ⁄_li°
->
d©a
), 
TRUE
);

1612 
gboﬁón


1613 
	$c›y_fûe
(
gch¨
 *
§c
, gch¨ *
d°
)

1615 
FILE
 *
Â_§c
;

1616 
FILE
 *
Â_d°
;

1617 
c
;

1619 i‡((
Â_§c
 = 
	`g_f›í
(
§c
, "rb")Ë=
NULL
)

1621 
	`mesßge_îr‹
(
	`_
("Couldn't open '%s': %s"),

1622 
	`dü_mesßge_fûíame
(
§c
), 
	`°ªº‹
(
î∫o
));

1623  
FALSE
;

1626 i‡((
Â_d°
 = 
	`g_f›í
(
d°
, "wb")Ë=
NULL
)

1628 
	`mesßge_îr‹
(
	`_
("Couldn't open '%s': %s"),

1629 
	`dü_mesßge_fûíame
(
d°
), 
	`°ªº‹
(
î∫o
));

1630  
FALSE
;

1633 (
c
 = 
	`fgëc
(
Â_§c
)Ë!
EOF
)

1634 
	`Âutc
(
c
, 
Â_d°
);

1636 
	`f˛o£
(
Â_§c
);

1637 
	`f˛o£
(
Â_d°
);

1639  
TRUE
;

1640 
	}
}

1643 
gboﬁón


1644 
	$wrôe_u£r_shìt
(
Shìt
 *
shìt
)

1646 
FILE
 *
fûe
;

1647 
xmlDocPå
 
doc
;

1648 
xmlNodePå
 
roŸ
;

1649 
xmlNodePå
 
node
;

1650 
xmlNodePå
 
obje˘_node
;

1651 
xmlNodePå
 
desc_node
;

1652 
xmlNodePå
 
ic⁄_node
;

1653 
gch¨
 
buf
[512];

1654 
time_t
 
time_now
;

1655 c⁄° *
u£∫ame
;

1656 
gch¨
 *
dú_u£r_shìts
;

1657 
gch¨
 *
fûíame
;

1658 
ShìtObje˘
 *
shìtobje˘
;

1659 
GSLi°
 *
shìt_obje˘s
;

1661 
dú_u£r_shìts
 = 
	`dü_c⁄fig_fûíame
("sheets");

1662 i‡(!*(
shìt
->
fûíame
))

1664 
gch¨
 *
ba£«me
;

1666 
ba£«me
 = 
	`g_°rdup
(
shìt
->
«me
);

1667 
ba£«me
 = 
	`g_°rdñimô
(ba£«me, 
G_STR_DELIMITERS
 
G_DIR_SEPARATOR_S
, '_');

1668 
fûíame
 = 
	`g_°rdup_¥ötf
("%s%s%s.shìt", 
dú_u£r_shìts
,

1669 
G_DIR_SEPARATOR_S
, 
ba£«me
);

1670 
	`g_‰ì
(
ba£«me
);

1673 
fûíame
 = 
	`g_°rdup_¥ötf
("%s%s%s", 
dú_u£r_shìts
,

1674 
G_DIR_SEPARATOR_S
, 
	`g_ba£«me
(
shìt
->
fûíame
));

1676 
fûe
 = 
	`g_f›í
(
fûíame
, "w");

1678 i‡(
fûe
==
NULL
)

1680 
	`mesßge_îr‹
(
	`_
("Couldn't open: '%s' for writing"),

1681 
	`dü_mesßge_fûíame
(
fûíame
));

1682 
	`g_‰ì
(
fûíame
);

1683  
FALSE
;

1685 
	`f˛o£
(
fûe
);

1687 
time_now
 = 
	`time
(
NULL
);

1688 
u£∫ame
 = 
	`g_gë_u£r_«me
();

1689 i‡(
u£∫ame
==
NULL
)

1690 
u£∫ame
 = 
	`_
("a user");

1692 
doc
 = 
	`xmlNewDoc
((c⁄° 
xmlCh¨
 *)"1.0");

1693 
doc
->
ícodög
 = 
	`xmlSådup
((c⁄° 
xmlCh¨
 *)"UTF-8");

1694 
doc
->
°™dÆ⁄e
 = 
FALSE
;

1695 
roŸ
 = 
	`xmlNewDocNode
(
doc
, 
NULL
, (c⁄° 
xmlCh¨
 *)"sheet", NULL);

1696 
doc
->
xmlRoŸNode
 = 
roŸ
;

1697 
	`xmlSëPr›
(
roŸ
, (c⁄° 
xmlCh¨
 *)"xm s", (c⁄° xmlCh¨ *Ë
DIA_XML_NAME_SPACE_BASE
 "dia-sheet-ns");

1700 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1701 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewCommít
((c⁄° 
xmlCh¨
 *)"Dü-Vîsi⁄: "
VERSION
));

1702 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1703 
	`g_¢¥ötf
(
buf
, (buf), 
	`_
("Fûe: %s"), 
fûíame
);

1704 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewCommít
((
xmlCh¨
 *)
buf
));

1705 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1706 
	`g_¢¥ötf
(
buf
, (buf), 
	`_
("D©e: %s"), 
	`˘ime
(&
time_now
));

1707 
buf
[
	`°æí
(buf)-1] = '\0';

1708 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewCommít
((
xmlCh¨
 *)
buf
));

1709 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1710 
	`g_¢¥ötf
(
buf
, (buf), 
	`_
("F‹: %s"), 
u£∫ame
);

1711 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewCommít
((
xmlCh¨
 *)
buf
));

1712 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n\n"));

1715 
node
 = 
	`xmlNewChûd
(
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"name", NULL);

1716 
	`xmlAddChûd
(
node
, 
	`xmlNewText
((
xmlCh¨
 *)
shìt
->
«me
));

1717 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1720 
node
 = 
	`xmlNewChûd
(
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"description", NULL);

1721 
	`xmlAddChûd
(
node
, 
	`xmlNewText
((
xmlCh¨
 *)
shìt
->
des¸ùti⁄
));

1722 
	`xmlAddChûd
(
roŸ
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1725 
node
 = 
	`xmlNewChûd
(
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"contents", NULL);

1726 
	`xmlAddChûd
(
node
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1727 
	`xmlAddChûd
(
node
, 
	`xmlNewCommít
((c⁄° 
xmlCh¨
 *Ë
	`_
("add shapes here")));

1728 
	`xmlAddChûd
(
node
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1731 
shìt_obje˘s
 = 
shìt
->
obje˘s
; sheet_objects;

1732 
shìt_obje˘s
 = 
	`g_¶i°_√xt
(sheet_objects))

1734 
ShìtObje˘Mod
 *
som
;

1736 
som
 = 
shìt_obje˘s
->
d©a
;

1738 i‡(
som
->
mod
 =
SHEET_OBJECT_MOD_DELETED
)

1744 i‡(
som
->
mod
 =
SHEET_OBJECT_MOD_NEW
)

1746 
gch¨
 *
dü_u£r_sh≠es
;

1747 
gch¨
 *
de°
;

1749 
dü_u£r_sh≠es
 = 
	`dü_c⁄fig_fûíame
("shapes");

1751 
de°
 = 
	`g_°rdup_¥ötf
("%s%s%s", 
dü_u£r_sh≠es
, 
G_DIR_SEPARATOR_S
,

1752 
	`g_ba£«me
(
som
->
svg_fûíame
));

1753 
	`c›y_fûe
(
som
->
svg_fûíame
, 
de°
);

1754 
	`g_‰ì
(
de°
);

1756 
de°
 = 
	`g_°rdup_¥ötf
("%s%s%s", 
dü_u£r_sh≠es
, 
G_DIR_SEPARATOR_S
,

1757 
	`g_ba£«me
(
som
->
shìt_obje˘
.
pixm≠_fûe
));

1758 
	`c›y_fûe
(
som
->
shìt_obje˘
.
pixm≠_fûe
, 
de°
);

1759 
	`g_‰ì
(
de°
);

1762 
shìtobje˘
 = &
som
->
shìt_obje˘
;

1763 
obje˘_node
 = 
	`xmlNewChûd
(
node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"object", NULL);

1765 
	`xmlSëPr›
(
obje˘_node
, (c⁄° 
xmlCh¨
 *)"«me", (xmlCh¨ *)
shìtobje˘
->
obje˘_ty≥
);

1767 i‡(
shìtobje˘
->
u£r_d©a_ty≥
 =
USER_DATA_IS_INTDATA
)

1769 
gch¨
 *
u£r_d©a
;

1771 
u£r_d©a
 = 
	`g_°rdup_¥ötf
("%u", (
guöt
)(
shìtobje˘
->user_data));

1772 
	`xmlSëPr›
(
obje˘_node
, (c⁄° 
xmlCh¨
 *)"ötd©a", (xmlCh¨ *Ë
u£r_d©a
);

1773 
	`g_‰ì
(
u£r_d©a
);

1776 
	`xmlAddChûd
(
obje˘_node
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1777 
desc_node
 = 
	`xmlNewChûd
(
obje˘_node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"description", NULL);

1778 
	`xmlAddChûd
(
desc_node
, 
	`xmlNewText
((
xmlCh¨
 *Ë
shìtobje˘
->
des¸ùti⁄
));

1781 i‡(
shìtobje˘
->
has_ic⁄_⁄_shìt
 =
TRUE
)

1783 
gch¨
 *
ˇn⁄iˇl_ic⁄
;

1784 
gch¨
 *
ˇn⁄iˇl_u£r_shìts
;

1785 
gch¨
 *
ˇn⁄iˇl_shìts
;

1786 
gch¨
 *
ic⁄
;

1788 
	`xmlAddChûd
(
obje˘_node
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1789 
ic⁄_node
 = 
	`xmlNewChûd
(
obje˘_node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"icon", NULL);

1790 
ˇn⁄iˇl_ic⁄
 = 
	`dü_gë_ˇn⁄iˇl_∑th
(
shìtobje˘
->
pixm≠_fûe
);

1791 
ic⁄
 = 
ˇn⁄iˇl_ic⁄
;

1792 
ˇn⁄iˇl_u£r_shìts
 = 
	`dü_gë_ˇn⁄iˇl_∑th
(
dú_u£r_shìts
);

1793 
ˇn⁄iˇl_shìts
 = 
	`dü_gë_ˇn⁄iˇl_∑th
(
	`dü_gë_d©a_dúe˘‹y
("sheets"));

1794 if(
	`g_°r_has_¥efix
(
ic⁄
, 
ˇn⁄iˇl_u£r_shìts
))

1795 
ic⁄
 +
	`°æí
(
ˇn⁄iˇl_u£r_shìts
) + 1;

1796 if(
	`g_°r_has_¥efix
(
ic⁄
, 
ˇn⁄iˇl_shìts
))

1797 
ic⁄
 +
	`°æí
(
ˇn⁄iˇl_shìts
) + 1;

1798 
	`xmlAddChûd
(
ic⁄_node
, 
	`xmlNewText
((
xmlCh¨
 *Ë
ic⁄
));

1799 
	`xmlAddChûd
(
obje˘_node
, 
	`xmlNewText
((c⁄° 
xmlCh¨
 *)"\n"));

1800 
	`g_‰ì
(
ˇn⁄iˇl_ic⁄
);

1801 
	`g_‰ì
(
ˇn⁄iˇl_u£r_shìts
);

1802 
	`g_‰ì
(
ˇn⁄iˇl_shìts
);

1805 
	`xmlSëDocCom¥essMode
(
doc
, 0);

1806 
	`xmlDüSaveFûe
(
fûíame
, 
doc
);

1807 
	`xmlFªeDoc
(
doc
);

1808  
TRUE
;

1809 
	}
}

1812 
	$touch_fûe
(
gch¨
 *
fûíame
)

1814 
°©
 
°©_buf
;

1815 
utimbuf
 
utim_buf
;

1817 
	`g_°©
(
fûíame
, &
°©_buf
);

1818 
utim_buf
.
a˘ime
 = 
°©_buf
.
°_©ime
;

1819 
utim_buf
.
modtime
 = 
	`time
(
NULL
);

1820 
	`utime
(
fûíame
, &
utim_buf
);

1821 
	}
}

1823 
göt


1824 
	$shìts_föd_shìt
(
gc⁄°poöãr
 
a
, gc⁄°poöã∏
b
)

1826 i‡(!
	`°rcmp
(((
Shìt
 *)
a
)->
«me
, ((Shìà*)
b
)->name))

1830 
	}
}

1832 
GSLi°
 *
shìts_mods_li°
;

1835 
	$⁄_shìts_dülog_buâ⁄_≠∂y_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

1836 
gpoöãr
 
u£r_d©a
)

1838 
GSLi°
 *
ôî_li°
;

1840 
ôî_li°
 = 
shìts_mods_li°
; iter_list;

1841 
ôî_li°
 = 
	`g_¶i°_√xt
(iter_list))

1843 
ShìtMod
 *
sm
;

1844 
GSLi°
 *
shìts_li°
;

1845 
GSLi°
 *
föd_li°
;

1847 
sm
 = 
ôî_li°
->
d©a
;

1848 
sm
->
mod
)

1850 
GSLi°
 *
shìt_obje˘_mods_li°
;

1851 
GSLi°
 *
li°
;

1852 
Shìt
 *
√w_shìt
 = 
NULL
;

1854 
SHEETMOD_MOD_NEW
:

1855 
	`wrôe_u£r_shìt
(&
sm
->
shìt
);

1857 
shìt_obje˘_mods_li°
 = 
sm
->
shìt
.
obje˘s
;

1858 
sm
->
shìt
.
obje˘s
 = 
NULL
;

1860 
√w_shìt
 = 
	`g_√w0
 (
Shìt
, 1);

1861 *
√w_shìt
 = 
sm
->
shìt
;

1862 
	`ªgi°î_shìt
(
√w_shìt
);

1864 
li°
 = 
shìt_obje˘_mods_li°
;Üi°;Üi° = 
	`g_¶i°_√xt
(list))

1866 
ShìtObje˘Mod
 *
som
;

1867 
ShìtObje˘
 *
√w_obje˘
;

1869 
som
 = 
li°
->
d©a
;

1870 i‡(
som
->
mod
 =
SHEET_OBJECT_MOD_DELETED
)

1873 
√w_obje˘
 = 
	`g_√w0
(
ShìtObje˘
, 1);

1874 *
√w_obje˘
 = 
som
->
shìt_obje˘
;

1875 
	`shìt_≠≥nd_shìt_obj
(
√w_shìt
, 
√w_obje˘
);

1878 
	`dü_s‹t_shìts
();

1879 
	`fûl_shìt_míu
();

1882 
SHEETMOD_MOD_CHANGED
:

1883 
	`wrôe_u£r_shìt
(&
sm
->
shìt
);

1885 
shìt_obje˘_mods_li°
 = 
sm
->
shìt
.
obje˘s
;

1886 
shìts_li°
 = 
	`gë_shìts_li°
();

1888 
shìts_li°
 = 
	`g_¶i°_föd_cu°om
(shìts_li°, &
sm
->
shìt
,

1889 
shìts_föd_shìt
);

1890 
	`g_as£π
(
shìts_li°
);

1891 ((
Shìt
 *)(
shìts_li°
->
d©a
))->
obje˘s
 = 
NULL
;

1893 
li°
 = 
shìt_obje˘_mods_li°
;Üi°;Üi° = 
	`g_¶i°_√xt
(list))

1895 
ShìtObje˘Mod
 *
som
;

1896 
ShìtObje˘
 *
√w_obje˘
;

1898 
som
 = 
li°
->
d©a
;

1899 i‡(
som
->
mod
 =
SHEET_OBJECT_MOD_DELETED
)

1902 
√w_obje˘
 = 
	`g_√w0
(
ShìtObje˘
, 1);

1903 *
√w_obje˘
 = 
som
->
shìt_obje˘
;

1904 
	`shìt_≠≥nd_shìt_obj
(
shìts_li°
->
d©a
, 
√w_obje˘
);

1906 
	`fûl_shìt_míu
();

1909 
SHEETMOD_MOD_DELETED
:

1910 i‡(
sm
->
shìt
.
sc›e
 =
SHEET_SCOPE_SYSTEM
)

1911 
	`touch_fûe
(
sm
->
shìt
.
shadowög
->
fûíame
);

1913 
	`g_u∆ök
(
sm
->
shìt
.
fûíame
);

1915 
shìts_li°
 = 
	`gë_shìts_li°
();

1916 
föd_li°
 = 
	`g_¶i°_föd_cu°om
(
shìts_li°
, &
sm
->
shìt
,

1917 
shìts_föd_shìt
);

1918 
	`g_as£π
(
shìts_li°
);

1919 i‡(!
	`g_¶i°_ªmove_lök
(
shìts_li°
, 
föd_li°
))

1920 
	`g_w¨nög
 ("No sheetsÜeft?");

1922 
	`dü_s‹t_shìts
();

1923 
	`fûl_shìt_míu
();

1926 
SHEETMOD_MOD_NONE
:

1930 
	`g_as£π_nŸ_ªached
();

1934 
›ti⁄míu_a˘iv©e_fú°_∑ss
 = 
TRUE
;

1936 
	`shìts_dülog_≠∂y_ªvît_£t_£nsôive
(
FALSE
);

1937 
	`shìts_dülog_¸óã
();

1939 
	}
}

1942 
	$⁄_shìts_dülog_buâ⁄_ªvît_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

1943 
gpoöãr
 
u£r_d©a
)

1945 
›ti⁄míu_a˘iv©e_fú°_∑ss
 = 
TRUE
;

1947 
	`shìts_dülog_≠∂y_ªvît_£t_£nsôive
(
FALSE
);

1948 
	`shìts_dülog_¸óã
();

1949 
	}
}

	@O:\tool\dvs50\app\sheets_dialog_callbacks.h

23 #ifde‡
GNOME


24 
	~<gnome.h
>

26 
	~<gtk/gtk.h
>

29 
gboﬁón


30 
⁄_shìts_maö_dülog_dñëe_evít
 (
GtkWidgë
 *
widgë
,

31 
GdkEvít
 *
evít
,

32 
gpoöãr
 
u£r_d©a
);

35 
⁄_shìts_dülog_›ti⁄míu_a˘iv©e
 (
GtkMíuIãm
 *
míuôem
,

36 
gpoöãr
 
u£r_d©a
);

40 
	g⁄_shìts_dülog_buâ⁄_move_up_˛icked


41 (
GtkBuâ⁄
 *
	gbuâ⁄
,

42 
gpoöãr
 
	gu£r_d©a
);

45 
	g⁄_shìts_dülog_buâ⁄_move_up_˛icked


46 (
GtkBuâ⁄
 *
	gbuâ⁄
,

47 
gpoöãr
 
	gu£r_d©a
);

50 
⁄_shìts_dülog_buâ⁄_√w_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

51 
gpoöãr
 
u£r_d©a
);

54 
⁄_shìts_dülog_buâ⁄_√w_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

55 
gpoöãr
 
u£r_d©a
);

58 
⁄_shìts_dülog_buâ⁄_˛o£_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

59 
gpoöãr
 
u£r_d©a
);

62 
⁄_shìts_dülog_buâ⁄_˛o£_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

63 
gpoöãr
 
u£r_d©a
);

66 
	g⁄_shìts_√w_dülog_buâ⁄_brow£_˛icked


67 (
GtkBuâ⁄
 *
	gbuâ⁄
,

68 
gpoöãr
 
	gu£r_d©a
);

71 
	g⁄_shìts_sh≠e£À˘i⁄_dülog_ˇn˚l_buâ⁄1_˛icked


72 (
GtkBuâ⁄
 *
	gbuâ⁄
,

73 
gpoöãr
 
	gu£r_d©a
);

76 
	g⁄_shìts_√w_dülog_buâ⁄_ˇn˚l_˛icked


77 (
GtkBuâ⁄
 *
	gbuâ⁄
,

78 
gpoöãr
 
	gu£r_d©a
);

81 
⁄_shìts_dülog_buâ⁄_edô_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

82 
gpoöãr
 
u£r_d©a
);

85 
	g⁄_shìts_edô_dülog_buâ⁄_ˇn˚l_˛icked


86 (
GtkBuâ⁄
 *
	gbuâ⁄
,

87 
gpoöãr
 
	gu£r_d©a
);

90 
⁄_shìts_dülog_buâ⁄_ªmove_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

91 
gpoöãr
 
u£r_d©a
);

94 
⁄_shìts_dülog_buâ⁄_ªmove_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

95 
gpoöãr
 
u£r_d©a
);

98 
	g⁄_shìts_ªmove_dülog_buâ⁄_ˇn˚l_˛icked


99 (
GtkBuâ⁄
 *
	gbuâ⁄
,

100 
gpoöãr
 
	gu£r_d©a
);

103 
	g⁄_shìts_√w_dülog_ødiobuâ⁄_shìt_«me_toggÀd


104 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

105 
gpoöãr
 
	gu£r_d©a
);

108 
	g⁄_shìts_√w_dülog_ødiobuâ⁄_svg_sh≠e_toggÀd


109 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

110 
gpoöãr
 
	gu£r_d©a
);

113 
	g⁄_shìts_√w_dülog_ødiobuâ⁄_löe_bªak_toggÀd


114 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

115 
gpoöãr
 
	gu£r_d©a
);

118 
	g⁄_shìts_√w_dülog_ødiobuâ⁄_shìt_toggÀd


119 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

120 
gpoöãr
 
	gu£r_d©a
);

123 
	g⁄_shìts_ªmove_dülog_ødiobuâ⁄_obje˘_toggÀd


124 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

125 
gpoöãr
 
	gu£r_d©a
);

128 
	g⁄_shìts_ªmove_dülog_ødiobuâ⁄_shìt_toggÀd


129 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

130 
gpoöãr
 
	gu£r_d©a
);

133 
	g⁄_shìts_dülog_buâ⁄_move_down_˛icked


134 (
GtkBuâ⁄
 *
	gbuâ⁄
,

135 
gpoöãr
 
	gu£r_d©a
);

138 
⁄_shìts_√w_dülog_buâ⁄_ok_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

139 
gpoöãr
 
u£r_d©a
);

142 
	g⁄_shìts_√w_dülog_ødiobuâ⁄_löe_bªak_toggÀd


143 (
GtkToggÀBuâ⁄
 *
	gtoggÀbuâ⁄
,

144 
gpoöãr
 
	gu£r_d©a
);

147 
	g⁄_shìts_ªmove_dülog_ok_buâ⁄_˛icked


148 (
GtkBuâ⁄
 *
	gbuâ⁄
,

149 
gpoöãr
 
	gu£r_d©a
);

152 
	g⁄_shìts_ªmove_dülog_buâ⁄_ok_˛icked


153 (
GtkBuâ⁄
 *
	gbuâ⁄
,

154 
gpoöãr
 
	gu£r_d©a
);

157 
	g⁄_shìts_edô_dülog_buâ⁄_ok_˛icked


158 (
GtkBuâ⁄
 *
	gbuâ⁄
,

159 
gpoöãr
 
	gu£r_d©a
);

162 
	g⁄_shìts_edô_dülog_íåy_obje˘_des¸ùti⁄_ch™ged


163 (
GtkEdôabÀ
 *
	gedôabÀ
,

164 
gpoöãr
 
	gu£r_d©a
);

167 
	g⁄_shìts_edô_dülog_íåy_shìt_des¸ùti⁄_ch™ged


168 (
GtkEdôabÀ
 *
	gedôabÀ
,

169 
gpoöãr
 
	gu£r_d©a
);

172 
	g⁄_shìts_edô_dülog_íåy_shìt_«me_ch™ged


173 (
GtkEdôabÀ
 *
	gedôabÀ
,

174 
gpoöãr
 
	gu£r_d©a
);

177 
⁄_shìts_dülog_buâ⁄_c›y_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

178 
gpoöãr
 
u£r_d©a
);

181 
	g⁄_shìts_dülog_buâ⁄_c›y_Æl_˛icked


182 (
GtkBuâ⁄
 *
	gbuâ⁄
,

183 
gpoöãr
 
	gu£r_d©a
);

186 
⁄_shìts_dülog_buâ⁄_move_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

187 
gpoöãr
 
u£r_d©a
);

190 
	g⁄_shìts_dülog_buâ⁄_move_Æl_˛icked


191 (
GtkBuâ⁄
 *
	gbuâ⁄
,

192 
gpoöãr
 
	gu£r_d©a
);

195 
⁄_shìts_dülog_buâ⁄_≠∂y_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

196 
gpoöãr
 
u£r_d©a
);

199 
⁄_shìts_dülog_buâ⁄_ªvît_˛icked
 (
GtkBuâ⁄
 *
buâ⁄
,

200 
gpoöãr
 
u£r_d©a
);

203 
	g⁄_shìts_sh≠e£À˘i⁄_dülog_buâ⁄_ok_˛icked


204 (
GtkBuâ⁄
 *
	gbuâ⁄
,

205 
gpoöãr
 
	gu£r_d©a
);

208 
	g⁄_shìts_sh≠e£À˘i⁄_dülog_buâ⁄_ˇn˚l_˛icked


209 (
GtkBuâ⁄
 *
	gbuâ⁄
,

210 
gpoöãr
 
	gu£r_d©a
);

212 
GtkWidgë
 *

213 
shìts_dülog_gë_a˘ive_buâ⁄
(
GtkWidgë
 **
wøpbox
, 
GLi°
 **
buâ⁄_li°
);

	@O:\tool\dvs50\app\splash.c

1 
	~<c⁄fig.h
>

3 #unde‡
GTK_DISABLE_DEPRECATED


4 
	~<gtk/gtk.h
>

5 
	~<gdk-pixbuf/gdk-pixbuf.h
>

7 
	~"öé.h
"

8 
	~"dü_dús.h
"

9 
	~"≠p_¥ocs.h
"

11 
GtkWidgë
*

12 
	$gë_logo_pixm≠
 ()

14 
GdkPixbuf
 *
logo
 = 
NULL
;

15 
GtkWidgë
* 
gpixm≠
 = 
NULL
;

16 
gch¨
 
°r
[512];

18 
gch¨
* 
d©adú
 = 
	`dü_gë_d©a_dúe˘‹y
("");

19 
	`g_¢¥ötf
(
°r
, (°r), "%s/dü-•œsh.≤g", 
d©adú
);

20 
logo
 = 
	`gdk_pixbuf_√w_‰om_fûe
(
°r
, 
NULL
);

21 
	`g_‰ì
(
d©adú
);

23 i‡(
logo
) {

24 
GdkPixm≠
 *
pixm≠
;

25 
GdkBôm≠
 *
bôm≠
;

27 
	`gdk_pixbuf_ªndî_pixm≠_™d_mask
(
logo
, &
pixm≠
, &
bôm≠
, 128);

28 
gpixm≠
 = 
	`gtk_pixm≠_√w
(
pixm≠
, 
bôm≠
);

29 
	`gdk_pixm≠_uƒef
(
pixm≠
);

30 i‡(
bôm≠
Ë
	`gdk_bôm≠_uƒef
(bitmap);

31 
	`g_obje˘_uƒef
 (
logo
);

33  
gpixm≠
;

34 
	}
}

36 
GtkWidgë
* 
	g•œsh
 = 
NULL
;

39 
	$•œsh_expo£
 (
GtkWidgë
 *
widgë
, 
GdkEvítExpo£
 *
evít
)

42 
	`gtk_maö_quô
();

43 
	}
}

46 
	$≠p_•œsh_öô
 (c⁄° 
gch¨
* 
‚ame
)

48 
GtkWidgë
 *
vbox
;

49 
GtkWidgë
* 
gpixm≠
;

50 
GtkWidgë
 *
œbñ
;

51 
GtkWidgë
 *
‰ame
;

52 
gch¨
 
°r
[256];

53 
gul⁄g
 
sig«l_id
;

55 
•œsh
 = 
	`gtk_wödow_√w
 (
GTK_WINDOW_TOPLEVEL
);

56 
	`gtk_wödow_£t_rﬁe
 (
	`GTK_WINDOW
 (
•œsh
), "start_dialog");

57 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
 (
•œsh
), 
	`_
("Loading ..."));

58 
	`gtk_wödow_£t_ªsizabÀ
 (
	`GTK_WINDOW
 (
•œsh
), 
FALSE
);

59 
	`gtk_wödow_£t_posôi⁄
 (
	`GTK_WINDOW
 (
•œsh
), 
GTK_WIN_POS_CENTER
);

61 
vbox
 = 
	`gtk_vbox_√w
 (
FALSE
, 2);

62 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox
), 5);

63 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
(
•œsh
), 
vbox
);

65 
gpixm≠
 = 
	`gë_logo_pixm≠
();

67 
‰ame
 = 
	`gtk_‰ame_√w
 (
NULL
);

68 
	`gtk_‰ame_£t_shadow_ty≥
 (
	`GTK_FRAME
 (
‰ame
), 
GTK_SHADOW_IN
);

69 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
‰ame
), 1);

70 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
vbox
), 
‰ame
, 
FALSE
, 
TRUE
, 1);

72 i‡(
gpixm≠
)

73 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
(
‰ame
), 
gpixm≠
);

75 
	`g_¢¥ötf
(
°r
, (°r), 
	`_
("Dü v %s"), 
VERSION
);

76 
œbñ
 = 
	`gtk_œbñ_√w
 (
°r
);

77 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
vbox
), 
œbñ
, 
FALSE
, 
TRUE
, 1);

79 
	`gtk_widgë_show_Æl
 (
•œsh
);

81 
sig«l_id
 = 
	`g_sig«l_c⁄√˘_a·î
(
	`GTK_OBJECT
(
•œsh
), "expose_event",

82 
	`GTK_SIGNAL_FUNC
(
•œsh_expo£
), 
NULL
);

85 
	`gtk_maö
();

86 
	`g_sig«l_h™dÀr_disc⁄√˘
(
	`GTK_OBJECT
(
•œsh
), 
sig«l_id
);

87 
	}
}

90 
	$≠p_•œsh_d⁄e
 ()

92 i‡(
•œsh
)

94 
	`gtk_widgë_de°roy
 (
•œsh
);

95 
•œsh
 = 
NULL
;

97 
	}
}

	@O:\tool\dvs50\app\textedit.c

35 
	~<c⁄fig.h
>

37 
	~"obje˘.h
"

38 
	~"focus.h
"

39 
	~"di•œy.h
"

40 
	~"highlight.h
"

41 
	~"ãxãdô.h
"

42 
	~"obje˘_›s.h
"

43 
	~"ãxt.h
"

45 
	sTextEdôCh™ge
 {

46 
Ch™ge
 
	mobj_ch™ge
;

49 
gch¨
 *
	m‹ig_ãxt
;

51 
gch¨
 *
	m√w_ãxt
;

54 
Text
 *
	mãxt
;

55 } 
	tTextEdôCh™ge
;

57 
Ch™ge
 *
ãxt_edô_¸óã_ch™ge
(
Text
 *
ãxt
);

58 
ãxt_edô_upd©e
(
TextEdôCh™ge
 *
ch™ge
);

59 
ãxt_edô_≠∂y
(
Ch™ge
 *
ch™ge
, 
Dügøm
 *
dü
);

60 
ãxãdô_íd_edô
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
);

63 
gboﬁón


64 
	$ãxãdô_mode
(
DDi•œy
 *
ddi•
)

66  
	`ddi•œy_a˘ive_focus
(
ddi•
Ë!
NULL
;

67 
	}
}

77 
	$ãxãdô_di•œy_ch™ge
(
DDi•œy
 *
ddi•
)

79 
	}
}

87 
	$ãxãdô_íãr
(
DDi•œy
 *
ddi•
)

89 i‡(
	`ãxãdô_mode
(
ddi•
)) {

94 
	`ãxãdô_di•œy_ch™ge
(
ddi•
);

95 
	}
}

104 
	$ãxãdô_exô
(
DDi•œy
 *
ddi•
)

106 i‡(!
	`ãxãdô_mode
(
ddi•
)) {

109 i‡(
	`ddi•œy_a˘ive_focus
(
ddi•
Ë!
NULL
) {

110 
	`ãxãdô_íd_edô
(
ddi•
, 
	`ddi•œy_a˘ive_focus
(ddisp));

114 
	`ãxãdô_di•œy_ch™ge
(
ddi•
);

115 
	}
}

125 
	$ãxãdô_begö_edô
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
)

127 
Cﬁ‹
 *
focus_cﬁ
 = 
	`cﬁ‹_√w_rgb
(1.0, 1.0, 0.0);

129 
	`g_as£π
(
	`dü_obje˘_is_£À˘ed
(
	`focus_gë_obje˘
(
focus
)));

130 i‡(!
	`ãxãdô_mode
(
ddi•
)) {

131 
	`ãxãdô_íãr
(
ddi•
);

133 
	`ddi•œy_£t_a˘ive_focus
(
ddi•
, 
focus
);

134 
	`highlight_obje˘
(
focus
->
obj
, 
focus_cﬁ
, 
ddi•
->
dügøm
);

135 
	`obje˘_add_upd©es
(
focus
->
obj
, 
ddi•
->
dügøm
);

139 
	}
}

148 
	$ãxãdô_íd_edô
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
)

150 
TextEdôCh™ge
 *
ch™ge
;

152 i‡(!
ddi•
)

155 
	`g_as£π
(
	`ãxãdô_mode
(
ddi•
));

160 
	`highlight_obje˘_off
(
focus
->
obj
, 
ddi•
->
dügøm
);

161 
	`obje˘_add_upd©es
(
focus
->
obj
, 
ddi•
->
dügøm
);

169 
	`ddi•œy_£t_a˘ive_focus
(
ddi•
, 
NULL
);

170 
	}
}

173 
Focus
 *

174 
	$ãxãdô_move_focus
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
, 
gboﬁón
 
f‹w¨ds
)

176 i‡(
focus
 !
NULL
) {

177 
	`ãxãdô_íd_edô
(
ddi•
, 
focus
);

179 i‡(
f‹w¨ds
) {

180 
Focus
 *
√w_focus
 = 
	`focus_√xt_⁄_dügøm
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

181 i‡(
√w_focus
 !
NULL
Ë
	`give_focus
(new_focus);

183 
Focus
 *
√w_focus
 = 
	`focus_¥evious_⁄_dügøm
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

184 i‡(
√w_focus
 !
NULL
Ë
	`give_focus
(new_focus);

186 
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

188 i‡(
focus
 !
NULL
) {

189 
	`ãxãdô_begö_edô
(
ddi•
, 
focus
);

191 
	`dügøm_Êush
(
ddi•
->
dügøm
);

192  
focus
;

193 
	}
}

199 
	$ãxãdô_a˘iv©e_focus
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
, 
Poöt
 *
˛icked
)

201 
Focus
 *
ﬁd_focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

202 i‡(
ﬁd_focus
 !
NULL
) {

203 
	`ãxãdô_íd_edô
(
ddi•
, 
ﬁd_focus
);

205 i‡(
˛icked
) {

206 
	`ãxt_£t_curs‹
((
Text
*)
focus
->
u£r_d©a
, 
˛icked
, 
ddi•
->
ªndîî
);

208 
	`ãxãdô_begö_edô
(
ddi•
, 
focus
);

209 
	`give_focus
(
focus
);

210 
	`dügøm_Êush
(
ddi•
->
dügøm
);

211 
	}
}

219 
gboﬁón


220 
	$ãxãdô_a˘iv©e_obje˘
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
)

222 
Focus
 *
√w_focus
;

224 
√w_focus
 = 
	`focus_gë_fú°_⁄_obje˘
(
obj
);

225 i‡(
√w_focus
 !
NULL
) {

226 
Focus
 *
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

227 i‡(
focus
 !
NULL
) {

228 
	`ãxãdô_íd_edô
(
ddi•
, 
focus
);

230 
	`give_focus
(
√w_focus
);

231 i‡(
˛icked
) {

232 
	`ãxt_£t_curs‹
((
Text
*)
√w_focus
->
u£r_d©a
, 
˛icked
, 
ddi•
->
ªndîî
);

234 
	`ãxãdô_begö_edô
(
ddi•
, 
√w_focus
);

235 
	`dügøm_Êush
(
ddi•
->
dügøm
);

236  
TRUE
;

238 
	`ãxãdô_exô
(
ddi•
);

239  
FALSE
;

241 
	}
}

249 
	$ãxãdô_a˘iv©e_fú°
(
DDi•œy
 *
ddi•
)

251 
Focus
 *
√w_focus
 = 
NULL
;

252 
GLi°
 *
tmp
, *
£À˘ed
 = 
	`dügøm_gë_s‹ãd_£À˘ed
(
ddi•
->
dügøm
);

253 
Focus
 *
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
ddi•
->
dügøm
);

255 i‡(
focus
 !
NULL
) {

256 
	`ãxãdô_íd_edô
(
ddi•
, 
focus
);

258 
tmp
 = 
£À˘ed
;

259 
√w_focus
 =
NULL
 && 
tmp
 != NULL) {

260 
DüObje˘
 *
obj
 = (DüObje˘*Ë
£À˘ed
->
d©a
;

261 
√w_focus
 = 
	`focus_gë_fú°_⁄_obje˘
(
obj
);

262 
tmp
 = 
	`g_li°_√xt
(tmp);

264 
	`g_li°_‰ì
 (
£À˘ed
);

265 i‡(
√w_focus
 !
NULL
) {

266 
	`give_focus
(
√w_focus
);

267 
	`ãxãdô_begö_edô
(
ddi•
, 
√w_focus
);

268 
	`dügøm_Êush
(
ddi•
->
dügøm
);

270 
	`ãxãdô_exô
(
ddi•
);

272 
	}
}

282 
	$ãxãdô_dó˘iv©e_focus
()

284 i‡(
	`ddi•œy_a˘ive
(Ë!
NULL
) {

285 
DügømD©a
 *
dü
 = (DügømD©®*Ë
	`ddi•œy_a˘ive
()->
dügøm
;

286 
Focus
 *
focus
 = 
	`gë_a˘ive_focus
(
dü
);

287 i‡(
focus
 !
NULL
) {

288 
	`ªmove_focus_⁄_dügøm
(
dü
);

291 
	`ãxãdô_exô
(
	`ddi•œy_a˘ive
());

293 
	}
}

299 
	$ãxãdô_ªmove_focus
(
DüObje˘
 *
obj
, 
Dügøm
 *
dügøm
)

301 
Focus
 *
ﬁd_focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
dügøm
);

302 i‡(
	`ªmove_focus_obje˘
(
obj
)) {

306 i‡(
	`ddi•œy_a˘ive
(Ë!
NULL
) {

307 
	`ãxãdô_exô
(
	`ddi•œy_a˘ive
());

309 
	}
}

315 
	$ãxãdô_ªmove_focus_Æl
(
Dügøm
 *
dügøm
)

317 
Focus
 *
focus
 = 
	`gë_a˘ive_focus
((
DügømD©a
 *Ë
dügøm
);

318 i‡(
focus
 !
NULL
) {

321 
	`ª£t_foci_⁄_dügøm
((
DügømD©a
 *Ë
dügøm
);

323 i‡(
	`ddi•œy_a˘ive
(Ë!
NULL
) {

324 
	`ãxãdô_exô
(
	`ddi•œy_a˘ive
());

326 
	}
}

339 
	$ãxt_edô_≠∂y
(
Ch™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

341 
TextEdôCh™ge
 *
ã_ch™ge
 = (TextEdôCh™gê*Ë
ch™ge
;

342 
	`ãxt_£t_°rög
(
ã_ch™ge
->
ãxt
,Åe_ch™ge->
√w_ãxt
);

343 
	}
}

346 
	$ãxt_edô_ªvît
(
TextEdôCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

348 i‡(
	`ãxãdô_mode
(
	`ddi•œy_a˘ive
())) {

349 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

350 
	`ãxãdô_exô
(
ddi•
);

352 
	`ãxt_£t_°rög
(
ch™ge
->
ãxt
, ch™ge->
‹ig_ãxt
);

353 
	}
}

356 
	$ãxt_edô_‰ì
(
TextEdôCh™ge
 *
ch™ge
)

358 
	`g_‰ì
(
ch™ge
->
‹ig_ãxt
);

359 i‡(
ch™ge
->
√w_ãxt
) {

360 
	`g_‰ì
(
ch™ge
->
√w_ãxt
);

362 
	}
}

367 
Ch™ge
 *

368 
	$ãxt_edô_¸óã_ch™ge
(
Text
 *
ãxt
)

370 
TextEdôCh™ge
 *
ch™ge
;

372 
ch™ge
 = 
	`g_√w0
(
TextEdôCh™ge
, 1);

374 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
UndoAµlyFunc
Ë
ãxt_edô_≠∂y
;

375 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
UndoRevîtFunc
Ë
ãxt_edô_ªvît
;

376 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
UndoFªeFunc
Ë
ãxt_edô_‰ì
;

378 
ch™ge
->
ãxt
 =Åext;

379 i‡(
	`ãxt_is_em±y
(
ãxt
)) {

380 
ch™ge
->
‹ig_ãxt
 = 
	`g_°rdup
("");

382 
ch™ge
->
‹ig_ãxt
 = 
	`ãxt_gë_°rög_c›y
(
ãxt
);

386  (
Ch™ge
 *)
ch™ge
;

387 
	}
}

392 
	$ãxt_edô_upd©e
(
TextEdôCh™ge
 *
ch™ge
)

394 
ch™ge
->
√w_ãxt
 = 
	`ãxt_gë_°rög_c›y
(ch™ge->
ãxt
);

395 
	}
}

	@O:\tool\dvs50\app\textedit.h

19 #i‚de‡
TEXTEDIT_H


20 
	#TEXTEDIT_H


	)

21 
	~<sys/ty≥s.h
>

22 
	~<glib.h
>

24 
	~"düty≥s.h
"

25 
	~"di•œy.h
"

27 
Focus
 *
ãxãdô_move_focus
(
DDi•œy
 *
ddi•
, Focu†*
focus
, 
gboﬁón
 
f‹w¨ds
);

29 
gboﬁón
 
ãxãdô_mode
(
DDi•œy
 *
ddi•
);

30 
ãxãdô_a˘iv©e_focus
(
DDi•œy
 *
ddi•
, 
Focus
 *
focus
, 
Poöt
 *
˛icked
);

31 
gboﬁón
 
ãxãdô_a˘iv©e_obje˘
(
DDi•œy
 *
ddi•
, 
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
);

32 
ãxãdô_a˘iv©e_fú°
(
DDi•œy
 *
ddi•
);

33 
ãxãdô_dó˘iv©e_focus
();

34 
ãxãdô_ªmove_focus
(
DüObje˘
 *
obj
, 
Dügøm
 *
dügøm
);

35 
ãxãdô_ªmove_focus_Æl
(
Dügøm
 *
dügøm
);

	@O:\tool\dvs50\app\textedit_tool.c

18 
	~<c⁄fig.h
>

20 
	~"ãxãdô_toﬁ.h
"

22 
	~"dügøm.h
"

23 
	~"ãxãdô.h
"

24 
	~"curs‹.h
"

25 
	~"obje˘_›s.h
"

33 
DüObje˘
 *

34 
	$˛ick_£À˘_obje˘
(
DDi•œy
 *
ddi•
, 
Poöt
 *
˛ickedpoöt
,

35 
GdkEvítBuâ⁄
 *
evít
)

37 
ªÆ
 
˛ick_di°™˚
 = 
	`ddi•œy_u¡ønsf‹m_Àngth
(
ddi•
, 3.0);

38 
Dügøm
 *
dügøm
 = 
ddi•
->diagram;

39 
DüObje˘
 *
obj
;

41 
	`ddi•œy_u¡ønsf‹m_co‹ds
(
ddi•
,

42 ()
evít
->
x
, (Îvít->
y
,

43 &
˛ickedpoöt
->
x
, &˛ickedpoöt->
y
);

45 
obj
 = 
	`dügøm_föd_˛icked_obje˘
 (
dügøm
, 
˛ickedpoöt
, 
˛ick_di°™˚
);

47 i‡(
obj
) {

49 
GLi°
 *
Æªady
;

52 
Æªady
 = 
	`g_li°_föd
(
dügøm
->
d©a
->
£À˘ed
, 
obj
);

53 i‡(
Æªady
 =
NULL
) {

54 i‡(!(
evít
->
°©e
 & 
GDK_SHIFT_MASK
)) {

56 
	`dügøm_ªmove_Æl_£À˘ed
(
dügøm
, 
TRUE
);

58 
	`dügøm_£À˘
(
dügøm
, 
obj
);

60 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

61 
	`obje˘_add_upd©es_li°
(
dügøm
->
d©a
->
£À˘ed
, diagram);

62 
	`dügøm_Êush
(
dügøm
);

64  
obj
;

67  
obj
;

68 
	}
}

71 
	$ãxãdô_buâ⁄_¥ess
(
TexãdôToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

72 
DDi•œy
 *
ddi•
)

74 
Poöt
 
˛ickedpoöt
;

75 
Dügøm
 *
dügøm
 = 
ddi•
->diagram;

76 
DüObje˘
 *
obj
 = 
	`˛ick_£À˘_obje˘
 (
ddi•
, &
˛ickedpoöt
, 
evít
);

78 i‡(
obj
) {

79 i‡(
obj
 !
toﬁ
->
obje˘
)

80 
	`ãxãdô_dó˘iv©e_focus
 ();

83 i‡(
	`ãxãdô_a˘iv©e_obje˘
(
ddi•
, 
obj
, &
˛ickedpoöt
)) {

84 
toﬁ
->
obje˘
 = 
obj
;

85 
toﬁ
->
°¨t_©
 = 
˛ickedpoöt
;

86 
toﬁ
->
°©e
 = 
STATE_TEXT_SELECT
;

89 
	`toﬁ_ª£t
();

92 
	`ãxãdô_dó˘iv©e_focus
 ();

93 
	`dügøm_ªmove_Æl_£À˘ed
(
dügøm
, 
TRUE
);

94 
	`toﬁ_ª£t
();

96 
	}
}

99 
	$ãxãdô_buâ⁄_ªÀa£
(
TexãdôToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

100 
DDi•œy
 *
ddi•
)

102 
Poöt
 
˛ickedpoöt
;

103 
Dügøm
 *
dügøm
 = 
ddi•
->diagram;

104 
DüObje˘
 *
obj
 = 
	`˛ick_£À˘_obje˘
 (
ddi•
, &
˛ickedpoöt
, 
evít
);

106 i‡(
obj
) {

107 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

109 
toﬁ
->
°©e
 = 
STATE_TEXT_EDIT
;

113 
	`ãxãdô_dó˘iv©e_focus
();

114 
	`toﬁ_ª£t
 ();

116 
	}
}

119 
	$ãxãdô_mŸi⁄
(
TexãdôToﬁ
 *
toﬁ
, 
GdkEvítMŸi⁄
 *
evít
,

120 
DDi•œy
 *
ddi•
)

123 
	}
}

126 
	$ãxãdô_doubÀ_˛ick
(
TexãdôToﬁ
 *
toﬁ
, 
GdkEvítBuâ⁄
 *
evít
,

127 
DDi•œy
 *
ddi•
)

130 
	}
}

132 
Toﬁ
 *

133 
	$¸óã_ãxãdô_toﬁ
()

135 
TexãdôToﬁ
 *
toﬁ
;

136 
DDi•œy
 *
ddi•
;

138 
toﬁ
 = 
	`g_√w0
(
TexãdôToﬁ
, 1);

139 
toﬁ
->toﬁ.
ty≥
 = 
TEXTEDIT_TOOL
;

140 
toﬁ
->toﬁ.
buâ⁄_¥ess_func
 = (
Buâ⁄PªssFunc
Ë&
ãxãdô_buâ⁄_¥ess
;

141 
toﬁ
->toﬁ.
buâ⁄_ªÀa£_func
 = (
Buâ⁄Rñó£Func
Ë&
ãxãdô_buâ⁄_ªÀa£
;

142 
toﬁ
->toﬁ.
mŸi⁄_func
 = (
MŸi⁄Func
Ë&
ãxãdô_mŸi⁄
;

143 
toﬁ
->toﬁ.
doubÀ_˛ick_func
 = (
DoubÀClickFunc
Ë&
ãxãdô_doubÀ_˛ick
;

145 
	`ddi•œy_£t_Æl_curs‹
(
	`gë_curs‹
(
CURSOR_XTERM
));

147 
ddi•
 = 
	`ddi•œy_a˘ive
();

148 i‡(
ddi•
) {

149 
	`ãxãdô_a˘iv©e_fú°
 (
ddi•
);

150 
	`ddi•œy_Êush
(
ddi•
);

152 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
ddi•
);

155  (
Toﬁ
 *)
toﬁ
;

156 
	}
}

159 
	$‰ì_ãxãdô_toﬁ
 (
Toﬁ
 *
toﬁ
)

161 
DDi•œy
 *
ddi•
 = 
	`ddi•œy_a˘ive
();

162 i‡(
ddi•
) {

163 
	`ãxãdô_dó˘iv©e_focus
 ();

164 
	`ddi•œy_Êush
(
ddi•
);

166 
	`ddi•œy_£t_Æl_curs‹
(
deÁu…_curs‹
);

168 
	`g_‰ì
 (
toﬁ
);

169 
	}
}

	@O:\tool\dvs50\app\textedit_tool.h

18 #i‚de‡
TEXTEDIT_TOOL_H


19 
	#TEXTEDIT_TOOL_H


	)

21 
	~"toﬁ.h
"

22 
	~"düty≥s.h
"

24 
	eTexãdôToﬁSèã
 {

25 
	mSTATE_TEXT_SELECT
,

26 
	mSTATE_TEXT_EDIT


29 
_TexãdôToﬁ
 
	tTexãdôToﬁ
;

31 
	s_TexãdôToﬁ
 {

32 
Toﬁ
 
	mtoﬁ
;

34 
TexãdôToﬁSèã
 
	m°©e
;

35 
DüObje˘
 *
	mobje˘
;

36 
Poöt
 
	m°¨t_©
;

39 
Toﬁ
 *
¸óã_ãxãdô_toﬁ
();

40 
‰ì_ãxãdô_toﬁ
(
Toﬁ
 *
toﬁ
);

	@O:\tool\dvs50\app\tool.c

18 
	~<c⁄fig.h
>

20 
	~"toﬁ.h
"

21 
	~"¸óã_obje˘.h
"

22 
	~"magnify.h
"

23 
	~"modify_toﬁ.h
"

24 
	~"s¸ﬁl_toﬁ.h
"

25 
	~"ãxãdô_toﬁ.h
"

26 
	~"öãrÁ˚.h
"

27 
	~"deÁu…s.h
"

29 
Toﬁ
 *
	ga˘ive_toﬁ
 = 
NULL
;

30 
Toﬁ
 *
	gå™sõ¡_toﬁ
 = 
NULL
;

31 
GtkWidgë
 *
	ga˘ive_buâ⁄
 = 
NULL
;

32 
GtkWidgë
 *
	gf‹mî_buâ⁄
 = 
NULL
;

35 
	$toﬁ_£À˘_f‹mî
()

37 i‡(
f‹mî_buâ⁄
) {

38 
	`g_sig«l_emô_by_«me
(
	`GTK_OBJECT
(
f‹mî_buâ⁄
), "clicked",

39 
	`GTK_BUTTON
(
f‹mî_buâ⁄
), 
NULL
);

41 
	}
}

44 
	$toﬁ_ª£t
()

46 
	`g_sig«l_emô_by_«me
(
	`GTK_OBJECT
(
modify_toﬁ_buâ⁄
), "clicked",

47 
	`GTK_BUTTON
(
modify_toﬁ_buâ⁄
), 
NULL
);

48 
	}
}

51 
	$toﬁ_gë
(
ToﬁSèã
 *
°©e
)

53 
°©e
->
ty≥
 = 
a˘ive_toﬁ
->type;

54 
°©e
->
buâ⁄
 = 
a˘ive_buâ⁄
;

55 i‡(
°©e
->
ty≥
 =
CREATE_OBJECT_TOOL
) {

56 
°©e
->
u£r_d©a
 = ((
Cª©eObje˘Toﬁ
 *)
a˘ive_toﬁ
)->user_data;

57 
°©e
->
exåa_d©a
 = ((
Cª©eObje˘Toﬁ
 *)
a˘ive_toﬁ
)->
objty≥
->
«me
;

58 
°©e
->
övît_≥rsi°í˚
 = ((
Cª©eObje˘Toﬁ
 *)
a˘ive_toﬁ
)->invert_persistence;

62 
°©e
->
u£r_d©a
 = 
NULL
;

63 
°©e
->
exåa_d©a
 = 
NULL
;

64 
°©e
->
övît_≥rsi°í˚
 = 0;

66 
	}
}

69 
	$toﬁ_ª°‹e
(c⁄° 
ToﬁSèã
 *
°©e
)

71 
	`toﬁ_£À˘
(
°©e
->
ty≥
, sèã->
exåa_d©a
, sèã->
u£r_d©a
, sèã->
buâ⁄
,

72 
°©e
->
övît_≥rsi°í˚
);

73 
	}
}

76 
	$toﬁ_‰ì
(
Toﬁ
 *
toﬁ
)

78 
toﬁ
->
ty≥
) {

79 
MODIFY_TOOL
:

80 
	`‰ì_modify_toﬁ
(
toﬁ
);

82 
CREATE_OBJECT_TOOL
:

83 
	`‰ì_¸óã_obje˘_toﬁ
(
toﬁ
);

85 
MAGNIFY_TOOL
:

86 
	`‰ì_magnify_toﬁ
(
toﬁ
);

88 
SCROLL_TOOL
:

89 
	`‰ì_s¸ﬁl_toﬁ
(
toﬁ
);

91 
TEXTEDIT_TOOL
 :

92 
	`‰ì_ãxãdô_toﬁ
(
toﬁ
);

95 
	`g_as£π
(0);

97 
	}
}

100 
	$toﬁ_£À˘
(
ToﬁTy≥
 
ty≥
, 
gpoöãr
 
exåa_d©a
,

101 
gpoöãr
 
u£r_d©a
, 
GtkWidgë
 *
buâ⁄
,

102 
övît_≥rsi°í˚
)

104 i‡(
buâ⁄
)

105 
f‹mî_buâ⁄
 = 
a˘ive_buâ⁄
;

107 
	`toﬁ_‰ì
(
a˘ive_toﬁ
);

108 
ty≥
) {

109 
MODIFY_TOOL
:

110 
a˘ive_toﬁ
 = 
	`¸óã_modify_toﬁ
();

112 
CREATE_OBJECT_TOOL
:

113 
a˘ive_toﬁ
 =

114 
	`¸óã_¸óã_obje˘_toﬁ
(
	`obje˘_gë_ty≥
((*)
exåa_d©a
),

115 (*Ë
u£r_d©a
, 
övît_≥rsi°í˚
);

117 
MAGNIFY_TOOL
:

118 
a˘ive_toﬁ
 = 
	`¸óã_magnify_toﬁ
();

120 
SCROLL_TOOL
:

121 
a˘ive_toﬁ
 = 
	`¸óã_s¸ﬁl_toﬁ
();

123 
TEXTEDIT_TOOL
 :

124 
a˘ive_toﬁ
 = 
	`¸óã_ãxãdô_toﬁ
();

127 
	`g_as£π
(0);

129 i‡(
buâ⁄
)

130 
a˘ive_buâ⁄
 = 
buâ⁄
;

131 
	}
}

134 
	$toﬁ_›ti⁄s_dülog_show
(
ToﬁTy≥
 
ty≥
, 
gpoöãr
 
exåa_d©a
,

135 
gpoöãr
 
u£r_d©a
, 
GtkWidgë
 *
buâ⁄
,

136 
övît_≥rsi°í˚
)

138 
DüObje˘Ty≥
 *
objty≥
;

140 i‡(
a˘ive_toﬁ
->
ty≥
 !=Åype)

141 
	`toﬁ_£À˘
(
ty≥
,
exåa_d©a
,
u£r_d©a
,
buâ⁄
,
övît_≥rsi°í˚
);

143 
ty≥
) {

144 
MODIFY_TOOL
:

146 
CREATE_OBJECT_TOOL
:

147 
objty≥
 = 
	`obje˘_gë_ty≥
((*)
exåa_d©a
);

148 
	`deÁu…s_show
(
objty≥
, 
u£r_d©a
);

150 
MAGNIFY_TOOL
:

152 
SCROLL_TOOL
:

154 
TEXTEDIT_TOOL
 :

157 
	}
}

	@O:\tool\dvs50\app\tool.h

18 #i‚de‡
TOOL_H


19 
	#TOOL_H


	)

21 
	~<gdk/gdk.h
>

23 
_Toﬁ
 
	tToﬁ
;

24 
_ToﬁSèã
 
	tToﬁSèã
;

26 
_ToﬁTy≥
 
	tToﬁTy≥
;

28 
	~"di•œy.h
"

30 (* 
	tBuâ⁄PªssFunc
Ë(
	tToﬁ
 *, 
	tGdkEvítBuâ⁄
 *, 
	tDDi•œy
 *
	tddi•
);

31 (* 
	tBuâ⁄HﬁdFunc
Ë(
	tToﬁ
 *, 
	tGdkEvítBuâ⁄
 *, 
	tDDi•œy
 *
	tddi•
);

32 (* 
	tDoubÀClickFunc
Ë(
	tToﬁ
 *, 
	tGdkEvítBuâ⁄
 *, 
	tDDi•œy
 *
	tddi•
);

33 (* 
	tBuâ⁄Rñó£Func
Ë(
	tToﬁ
 *, 
	tGdkEvítBuâ⁄
 *, 
	tDDi•œy
 *
	tddi•
);

34 (* 
	tMŸi⁄Func
Ë(
	tToﬁ
 *, 
	tGdkEvítMŸi⁄
 *, 
	tDDi•œy
 *
	tddi•
);

36 
	e_ToﬁTy≥
 {

37 
CREATE_OBJECT_TOOL
,

38 
MAGNIFY_TOOL
,

39 
MODIFY_TOOL
,

40 
SCROLL_TOOL
,

41 
TEXTEDIT_TOOL


44 
	s_Toﬁ
 {

45 
ToﬁTy≥
 
ty≥
;

48 
Buâ⁄PªssFunc
 
buâ⁄_¥ess_func
;

49 
Buâ⁄HﬁdFunc
 
buâ⁄_hﬁd_func
;

50 
Buâ⁄Rñó£Func
 
buâ⁄_ªÀa£_func
;

51 
MŸi⁄Func
 
mŸi⁄_func
;

52 
DoubÀClickFunc
 
doubÀ_˛ick_func
;

55 
	s_ToﬁSèã
 {

56 
ToﬁTy≥
 
ty≥
;

57 
gpoöãr
 
exåa_d©a
;

58 
gpoöãr
 
u£r_d©a
;

59 
GtkWidgë
 *
buâ⁄
;

60 
övît_≥rsi°í˚
;

63 
Toﬁ
 *
a˘ive_toﬁ
, *
å™sõ¡_toﬁ
;

65 
	`toﬁ_gë
(
ToﬁSèã
 *
°©e
);

66 
	`toﬁ_ª°‹e
(c⁄° 
ToﬁSèã
 *
°©e
);

67 
	`toﬁ_‰ì
(
Toﬁ
 *
toﬁ
);

68 
	`toﬁ_£À˘
(
ToﬁTy≥
 
ty≥
, 
gpoöãr
 
exåa_d©a
, gpoöã∏
u£r_d©e
,

69 
GtkWidgë
 *
buâ⁄
, 
övît_≥rsi°í˚
);

70 
	`toﬁ_£À˘_f‹mî
();

71 
	`toﬁ_ª£t
();

72 
	`toﬁ_›ti⁄s_dülog_show
(
ToﬁTy≥
 
ty≥
, 
gpoöãr
 
exåa_d©a
,

73 
gpoöãr
 
u£r_d©a
,
GtkWidgë
 *
buâ⁄
,

74 
övît_≥rsi°í˚
);

	@O:\tool\dvs50\app\undo.c

19 
	~<c⁄fig.h
>

21 
	~"undo.h
"

22 
	~"obje˘_›s.h
"

23 
	~"¥›îtõs-dülog.h
"

24 
	~"c⁄√˘i⁄poöt_›s.h
"

25 
	~"focus.h
"

26 
	~"group.h
"

27 
	~"¥e„ªn˚s.h
"

28 
	~"dügøm_åì_wödow.h
"

29 
	~"ãxãdô.h
"

30 
	~"∑ª¡.h
"

33 
	#DEBUG_PRINTF
(
¨gs
Ë
¥ötf
 
	)
args

35 
	#DEBUG_PRINTF
(
¨gs
)

	)

38 
undo_upd©e_míus
(
UndoSèck
 *
°ack
);

41 
	$å™ß˘i⁄_poöt_poöãr
(
Ch™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

44 
	}
}

47 
	$is_å™ß˘i⁄poöt
(
Ch™ge
 *
ch™ge
)

49  
ch™ge
->
≠∂y
 =
å™ß˘i⁄_poöt_poöãr
;

50 
	}
}

52 
Ch™ge
 *

53 
	$√w_å™ß˘i⁄poöt
()

55 
Ch™ge
 *
å™ß˘i⁄
 = 
	`g_√w0
(Change, 1);

57 i‡(
å™ß˘i⁄
) {

58 
å™ß˘i⁄
->
≠∂y
 = 
å™ß˘i⁄_poöt_poöãr
;

59 
å™ß˘i⁄
->
ªvît
 = 
å™ß˘i⁄_poöt_poöãr
;

60 
å™ß˘i⁄
->
‰ì
 = 
NULL
;

63  
å™ß˘i⁄
;

64 
	}
}

66 
UndoSèck
 *

67 
	$√w_undo_°ack
(
Dügøm
 *
dü
)

69 
UndoSèck
 *
°ack
;

70 
Ch™ge
 *
å™ß˘i⁄
;

72 
°ack
 = 
	`g_√w
(
UndoSèck
, 1);

73 i‡(
°ack
!=
NULL
){

74 
°ack
->
dü
 = dia;

75 
å™ß˘i⁄
 = 
	`√w_å™ß˘i⁄poöt
();

76 
å™ß˘i⁄
->
√xt
 =Åønß˘i⁄->
¥ev
 = 
NULL
;

77 
°ack
->
œ°_ch™ge
 = 
å™ß˘i⁄
;

78 
°ack
->
cuºít_ch™ge
 = 
å™ß˘i⁄
;

79 
°ack
->
œ°_ßve
 = 
å™ß˘i⁄
;

80 
°ack
->
dïth
 = 0;

82  
°ack
;

83 
	}
}

86 
	$undo_de°roy
(
UndoSèck
 *
°ack
)

88 
	`undo_˛ór
(
°ack
);

89 
	`g_‰ì
(
°ack
->
cuºít_ch™ge
);

90 
	`g_‰ì
(
°ack
);

91 
	}
}

94 
	$undo_ªmove_ªdo_öfo
(
UndoSèck
 *
°ack
)

96 
Ch™ge
 *
ch™ge
;

97 
Ch™ge
 *
√xt_ch™ge
;

99 
	`DEBUG_PRINTF
(("UNDO: RemovingÑedo info\n"));

101 
ch™ge
 = 
°ack
->
cuºít_ch™ge
->
√xt
;

102 
°ack
->
cuºít_ch™ge
->
√xt
 = 
NULL
;

103 
°ack
->
œ°_ch™ge
 = sèck->
cuºít_ch™ge
;

105 
ch™ge
 !
NULL
) {

106 
√xt_ch™ge
 = 
ch™ge
->
√xt
;

107 i‡(
ch™ge
->
‰ì
)

108 (
ch™ge
->
‰ì
)(change);

109 
	`g_‰ì
(
ch™ge
);

110 
ch™ge
 = 
√xt_ch™ge
;

112 
	`undo_upd©e_míus
(
°ack
);

113 
	}
}

116 
	$undo_push_ch™ge
(
UndoSèck
 *
°ack
, 
Ch™ge
 *
ch™ge
)

118 i‡(
°ack
->
cuºít_ch™ge
 !°ack->
œ°_ch™ge
)

119 
	`undo_ªmove_ªdo_öfo
(
°ack
);

121 
	`DEBUG_PRINTF
(("UNDO: PushÇew ch™gê© %d\n", 
	`dïth
(
°ack
)));

123 
ch™ge
->
¥ev
 = 
°ack
->
œ°_ch™ge
;

124 
ch™ge
->
√xt
 = 
NULL
;

125 
°ack
->
œ°_ch™ge
->
√xt
 = 
ch™ge
;

126 
°ack
->
œ°_ch™ge
 = 
ch™ge
;

127 
°ack
->
cuºít_ch™ge
 = 
ch™ge
;

128 
	`undo_upd©e_míus
(
°ack
);

129 
	}
}

132 
	$undo_dñëe_lowe°_å™ß˘i⁄
(
UndoSèck
 *
°ack
)

134 
Ch™ge
 *
ch™ge
;

135 
Ch™ge
 *
√xt_ch™ge
;

138 
ch™ge
 = 
°ack
->
cuºít_ch™ge
;

139 
ch™ge
->
¥ev
 !
NULL
) {

140 
ch™ge
 = ch™ge->
¥ev
;

148 i‡–(
ch™ge
 =
NULL
Ë|| (ch™gê=
°ack
->
cuºít_ch™ge
))

151 
√xt_ch™ge
 = 
ch™ge
->
√xt
;

152 
	`DEBUG_PRINTF
(("freeing one change fromÅhe bottom.\n"));

153 i‡(
ch™ge
->
‰ì
)

154 (
ch™ge
->
‰ì
)(change);

155 
	`g_‰ì
(
ch™ge
);

156 
ch™ge
 = 
√xt_ch™ge
;

157 } !
	`is_å™ß˘i⁄poöt
(
ch™ge
));

159 i‡(
	`is_å™ß˘i⁄poöt
(
ch™ge
)) {

160 
°ack
->
dïth
--;

161 
	`DEBUG_PRINTF
(("De¸ósög sèck dïthÅo: %d\n", 
°ack
->
dïth
));

163 
ch™ge
->
¥ev
 = 
NULL
;

164 
	}
}

167 
	$undo_£t_å™ß˘i⁄poöt
(
UndoSèck
 *
°ack
)

169 
Ch™ge
 *
å™ß˘i⁄
;

171 i‡(
	`is_å™ß˘i⁄poöt
(
°ack
->
cuºít_ch™ge
))

174 
	`DEBUG_PRINTF
(("UNDO: PushÇewÅønß˘i⁄poöà© %d\n", 
	`dïth
(
°ack
)));

176 
å™ß˘i⁄
 = 
	`√w_å™ß˘i⁄poöt
();

178 
	`undo_push_ch™ge
(
°ack
, 
å™ß˘i⁄
);

179 
°ack
->
dïth
++;

180 
	`DEBUG_PRINTF
(("In¸ósög sèck dïthÅo: %d\n", 
°ack
->
dïth
));

182 i‡(
¥efs
.
undo_dïth
 > 0) {

183 
°ack
->
dïth
 > 
¥efs
.
undo_dïth
){

184 
	`undo_dñëe_lowe°_å™ß˘i⁄
(
°ack
);

187 
	}
}

190 
	$undo_ªvît_to_œ°_ç
(
UndoSèck
 *
°ack
)

192 
Ch™ge
 *
ch™ge
;

193 
Ch™ge
 *
¥ev_ch™ge
;

195 i‡(
°ack
->
cuºít_ch™ge
->
¥ev
 =
NULL
)

198 
ch™ge
 = 
°ack
->
cuºít_ch™ge
;

200 
¥ev_ch™ge
 = 
ch™ge
->
¥ev
;

201 (
ch™ge
->
ªvît
)(ch™ge, 
°ack
->
dü
);

202 
ch™ge
 = 
¥ev_ch™ge
;

203 } !
	`is_å™ß˘i⁄poöt
(
ch™ge
));

204 
°ack
->
cuºít_ch™ge
 = 
ch™ge
;

205 
°ack
->
dïth
--;

206 
	`undo_upd©e_míus
(
°ack
);

207 
	`DEBUG_PRINTF
(("De¸ósög sèck dïthÅo: %d\n", 
°ack
->
dïth
));

208 
	}
}

211 
	$undo_≠∂y_to_√xt_ç
(
UndoSèck
 *
°ack
)

213 
Ch™ge
 *
ch™ge
;

214 
Ch™ge
 *
√xt_ch™ge
;

216 
ch™ge
 = 
°ack
->
cuºít_ch™ge
;

218 i‡(
ch™ge
->
√xt
 =
NULL
)

222 
√xt_ch™ge
 = 
ch™ge
->
√xt
;

223 (
ch™ge
->
≠∂y
)(ch™ge, 
°ack
->
dü
);

224 
ch™ge
 = 
√xt_ch™ge
;

225 }  (
ch™ge
 !
NULL
) &&

226 (!
	`is_å™ß˘i⁄poöt
(
ch™ge
)) );

227 i‡(
ch™ge
 =
NULL
)

228 
ch™ge
 = 
°ack
->
œ°_ch™ge
;

229 
°ack
->
cuºít_ch™ge
 = 
ch™ge
;

230 
°ack
->
dïth
++;

231 
	`undo_upd©e_míus
(
°ack
);

232 
	`DEBUG_PRINTF
(("In¸ósög sèck dïthÅo: %d\n", 
°ack
->
dïth
));

233 
	}
}

237 
	$undo_˛ór
(
UndoSèck
 *
°ack
)

239 
Ch™ge
 *
ch™ge
;

241 
	`DEBUG_PRINTF
(("undo_clear()\n"));

243 
ch™ge
 = 
°ack
->
cuºít_ch™ge
;

245 
ch™ge
->
¥ev
 !
NULL
) {

246 
ch™ge
 = ch™ge->
¥ev
;

249 
°ack
->
cuºít_ch™ge
 = 
ch™ge
;

250 
°ack
->
dïth
 = 0;

251 
	`undo_ªmove_ªdo_öfo
(
°ack
);

252 
	`undo_upd©e_míus
(
°ack
);

253 
	}
}

260 
	$undo_upd©e_míus
(
UndoSèck
 *
°ack
)

262 
	`ddi•œy_do_upd©e_míu_£nsôivôy
(
	`ddi•œy_a˘ive
());

263 
	}
}

268 
	$undo_m¨k_ßve
(
UndoSèck
 *
°ack
)

270 
°ack
->
œ°_ßve
 = sèck->
cuºít_ch™ge
;

271 
	}
}

276 
gboﬁón


277 
	$undo_is_ßved
(
UndoSèck
 *
°ack
)

279  
°ack
->
œ°_ßve
 =°ack->
cuºít_ch™ge
;

280 
	}
}

286 
gboﬁón


287 
	$undo_avaûabÀ
(
UndoSèck
 *
°ack
, 
gboﬁón
 
undo
)

289 i‡(
undo
) {

290  
°ack
->
cuºít_ch™ge
 !
NULL
;

292  
°ack
->
cuºít_ch™ge
 !
NULL
 && sèck->cuºít_ch™ge->
√xt
 != NULL;

294 
	}
}

306 
Ch™ge
*

307 
	$undo_ªmove_to
(
UndoSèck
 *
°ack
, 
UndoAµlyFunc
 *
ty≥
)

309 
Ch™ge
 *
cuºít_ch™ge
 = 
°ack
->current_change;

310 i‡(
cuºít_ch™ge
 =
NULL
)

311  
NULL
;

312 
cuºít_ch™ge
 && cuºít_ch™ge->
≠∂y
 !*
ty≥
) {

313 
cuºít_ch™ge
 = cuºít_ch™ge->
¥ev
;

315 i‡(
cuºít_ch™ge
 !
NULL
) {

316 
°ack
->
cuºít_ch™ge
 = current_change;

317 
	`undo_ªmove_ªdo_öfo
(
°ack
);

318  
cuºít_ch™ge
;

320 
	`undo_˛ór
(
°ack
);

321  
NULL
;

323 
	}
}

336 
	sMoveObje˘sCh™ge
 {

337 
Ch™ge
 
	mch™ge
;

339 
Poöt
 *
	m‹ig_pos
;

340 
Poöt
 *
	mde°_pos
;

341 
GLi°
 *
	mobj_li°
;

345 
	$move_obje˘s_≠∂y
(
MoveObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

347 
GLi°
 *
li°
;

348 
i
;

349 
DüObje˘
 *
obj
;

351 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

353 
li°
 = 
ch™ge
->
obj_li°
;

354 
i
=0;

355 
li°
 !
NULL
) {

356 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

358 
obj
->
›s
->
	`move
(obj, &
ch™ge
->
de°_pos
[
i
]);

360 
li°
 = 
	`g_li°_√xt
÷i°); 
i
++;

363 
li°
 = 
ch™ge
->
obj_li°
;

364 
li°
!=
NULL
) {

365 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

367 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
, 
obj
, 
TRUE
);

369 
li°
 = 
	`g_li°_√xt
(list);

372 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

373 
	}
}

376 
	$move_obje˘s_ªvît
(
MoveObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

378 
GLi°
 *
li°
;

379 
i
;

380 
DüObje˘
 *
obj
;

382 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

384 
li°
 = 
ch™ge
->
obj_li°
;

385 
i
=0;

386 
li°
 !
NULL
) {

387 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

389 
obj
->
›s
->
	`move
(obj, &
ch™ge
->
‹ig_pos
[
i
]);

391 
li°
 = 
	`g_li°_√xt
÷i°); 
i
++;

394 
li°
 = 
ch™ge
->
obj_li°
;

395 
li°
!=
NULL
) {

396 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

398 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
, 
obj
, 
TRUE
);

400 
li°
 = 
	`g_li°_√xt
(list);

403 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

404 
	}
}

407 
	$move_obje˘s_‰ì
(
MoveObje˘sCh™ge
 *
ch™ge
)

409 
	`g_‰ì
(
ch™ge
->
‹ig_pos
);

410 
	`g_‰ì
(
ch™ge
->
de°_pos
);

411 
	`g_li°_‰ì
(
ch™ge
->
obj_li°
);

412 
	}
}

414 
Ch™ge
 *

415 
	$undo_move_obje˘s
(
Dügøm
 *
dü
, 
Poöt
 *
‹ig_pos
, Poöà*
de°_pos
,

416 
GLi°
 *
obj_li°
)

418 
MoveObje˘sCh™ge
 *
ch™ge
;

420 
ch™ge
 = 
	`g_√w0
(
MoveObje˘sCh™ge
, 1);

422 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
move_obje˘s_≠∂y
;

423 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
move_obje˘s_ªvît
;

424 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
move_obje˘s_‰ì
;

426 
ch™ge
->
‹ig_pos
 = orig_pos;

427 
ch™ge
->
de°_pos
 = dest_pos;

428 
ch™ge
->
obj_li°
 = obj_list;

430 
	`DEBUG_PRINTF
(("UNDO: PushÇew movêobje˘†© %d\n", 
	`dïth
(
dü
->
undo
)));

431 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

432  (
Ch™ge
 *)
ch™ge
;

433 
	}
}

437 
	sMoveH™dÀCh™ge
 {

438 
Ch™ge
 
ch™ge
;

440 
Poöt
 
‹ig_pos
;

441 
Poöt
 
de°_pos
;

442 
H™dÀ
 *
h™dÀ
;

443 
DüObje˘
 *
obj
;

447 
	$move_h™dÀ_≠∂y
(
MoveH™dÀCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

449 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

450 
ch™ge
->
obj
->
›s
->
	`move_h™dÀ
(ch™ge->obj, ch™ge->
h™dÀ
,

451 &
ch™ge
->
de°_pos
, 
NULL
,

452 
HANDLE_MOVE_USER_FINAL
, 0);

453 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

454 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
, 
ch™ge
->
obj
, 
TRUE
);

455 
	}
}

458 
	$move_h™dÀ_ªvît
(
MoveH™dÀCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

460 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

461 
ch™ge
->
obj
->
›s
->
	`move_h™dÀ
(ch™ge->obj, ch™ge->
h™dÀ
,

462 &
ch™ge
->
‹ig_pos
, 
NULL
,

463 
HANDLE_MOVE_USER_FINAL
, 0);

464 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

465 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
, 
ch™ge
->
obj
, 
TRUE
);

466 
	}
}

469 
	$move_h™dÀ_‰ì
(
MoveH™dÀCh™ge
 *
ch™ge
)

471 
	}
}

474 
Ch™ge
 *

475 
	$undo_move_h™dÀ
(
Dügøm
 *
dü
,

476 
H™dÀ
 *
h™dÀ
, 
DüObje˘
 *
obj
,

477 
Poöt
 
‹ig_pos
, Poöà
de°_pos
)

479 
MoveH™dÀCh™ge
 *
ch™ge
;

481 
ch™ge
 = 
	`g_√w0
(
MoveH™dÀCh™ge
, 1);

483 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
move_h™dÀ_≠∂y
;

484 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
move_h™dÀ_ªvît
;

485 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
move_h™dÀ_‰ì
;

487 
ch™ge
->
‹ig_pos
 = orig_pos;

488 
ch™ge
->
de°_pos
 = dest_pos;

489 
ch™ge
->
h™dÀ
 = handle;

490 
ch™ge
->
obj
 = obj;

492 
	`DEBUG_PRINTF
(("UNDO: PushÇew movêh™dÀáà%d\n", 
	`dïth
(
dü
->
undo
)));

494 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

495  (
Ch™ge
 *)
ch™ge
;

496 
	}
}

500 
	sC⁄√˘Ch™ge
 {

501 
Ch™ge
 
	mch™ge
;

503 
DüObje˘
 *
	mobj
;

504 
H™dÀ
 *
	mh™dÀ
;

505 
C⁄√˘i⁄Poöt
 *
	mc⁄√˘i⁄poöt
;

506 
Poöt
 
	mh™dÀ_pos
;

510 
	$c⁄√˘_≠∂y
(
C⁄√˘Ch™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

512 
	`obje˘_c⁄√˘
(
ch™ge
->
obj
, ch™ge->
h™dÀ
, ch™ge->
c⁄√˘i⁄poöt
);

514 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

515 
ch™ge
->
obj
->
›s
->
	`move_h™dÀ
(ch™ge->obj, ch™ge->
h™dÀ
 ,

516 &
ch™ge
->
c⁄√˘i⁄poöt
->
pos
,

517 
ch™ge
->
c⁄√˘i⁄poöt
,

518 
HANDLE_MOVE_CONNECTED
, 0);

520 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

521 
	}
}

524 
	$c⁄√˘_ªvît
(
C⁄√˘Ch™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

526 
	`obje˘_unc⁄√˘
(
ch™ge
->
obj
, ch™ge->
h™dÀ
);

528 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

529 
ch™ge
->
obj
->
›s
->
	`move_h™dÀ
(ch™ge->obj, ch™ge->
h™dÀ
 ,

530 &
ch™ge
->
h™dÀ_pos
, 
NULL
,

531 
HANDLE_MOVE_CONNECTED
, 0);

533 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

534 
	}
}

537 
	$c⁄√˘_‰ì
(
C⁄√˘Ch™ge
 *
ch™ge
)

539 
	}
}

541 
Ch™ge
 *

542 
	$undo_c⁄√˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
,

543 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
)

545 
C⁄√˘Ch™ge
 *
ch™ge
;

547 
ch™ge
 = 
	`g_√w0
(
C⁄√˘Ch™ge
, 1);

549 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
c⁄√˘_≠∂y
;

550 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
c⁄√˘_ªvît
;

551 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
c⁄√˘_‰ì
;

553 
ch™ge
->
obj
 = obj;

554 
ch™ge
->
h™dÀ
 = handle;

555 
ch™ge
->
h™dÀ_pos
 = 
h™dÀ
->
pos
;

556 
ch™ge
->
c⁄√˘i⁄poöt
 = connectionpoint;

558 
	`DEBUG_PRINTF
(("UNDO: PushÇew c⁄√˘áà%d\n", 
	`dïth
(
dü
->
undo
)));

559 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

560  (
Ch™ge
 *)
ch™ge
;

561 
	}
}

565 
	sUnc⁄√˘Ch™ge
 {

566 
Ch™ge
 
ch™ge
;

568 
DüObje˘
 *
obj
;

569 
H™dÀ
 *
h™dÀ
;

570 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
;

574 
	$unc⁄√˘_≠∂y
(
Unc⁄√˘Ch™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

576 
	`obje˘_unc⁄√˘
(
ch™ge
->
obj
, ch™ge->
h™dÀ
);

578 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

579 
	}
}

582 
	$unc⁄√˘_ªvît
(
Unc⁄√˘Ch™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

584 
	`obje˘_c⁄√˘
(
ch™ge
->
obj
, ch™ge->
h™dÀ
, ch™ge->
c⁄√˘i⁄poöt
);

586 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

587 
	}
}

590 
	$unc⁄√˘_‰ì
(
Unc⁄√˘Ch™ge
 *
ch™ge
)

592 
	}
}

594 
Ch™ge
 *

595 
	$undo_unc⁄√˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
)

597 
Unc⁄√˘Ch™ge
 *
ch™ge
;

599 
ch™ge
 = 
	`g_√w0
(
Unc⁄√˘Ch™ge
, 1);

601 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
unc⁄√˘_≠∂y
;

602 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
unc⁄√˘_ªvît
;

603 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
unc⁄√˘_‰ì
;

605 
ch™ge
->
obj
 = obj;

606 
ch™ge
->
h™dÀ
 = handle;

607 
ch™ge
->
c⁄√˘i⁄poöt
 = 
h™dÀ
->
c⁄√˘ed_to
;

609 
	`DEBUG_PRINTF
(("UNDO: PushÇew unc⁄√˘áà%d\n", 
	`dïth
(
dü
->
undo
)));

610 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

611  (
Ch™ge
 *)
ch™ge
;

612 
	}
}

617 
	sDñëeObje˘sCh™ge
 {

618 
Ch™ge
 
ch™ge
;

620 
Layî
 *
œyî
;

621 
GLi°
 *
obj_li°
;

622 
GLi°
 *
‹igöÆ_obje˘s
;

623 
≠∂õd
;

627 
	$dñëe_obje˘s_≠∂y
(
DñëeObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

629 
GLi°
 *
li°
;

631 
	`DEBUG_PRINTF
(("delete_objects_apply()\n"));

632 
ch™ge
->
≠∂õd
 = 1;

633 
	`dügøm_un£À˘_obje˘s
(
dü
, 
ch™ge
->
obj_li°
);

634 
	`œyî_ªmove_obje˘s
(
ch™ge
->
œyî
, ch™ge->
obj_li°
);

635 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

637 
li°
 = 
ch™ge
->
obj_li°
;

638 
li°
 !
NULL
) {

639 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

643 
	`¥›îtõs_hide_if_shown
(
dü
, 
obj
);

645 i‡(
obj
->
∑ª¡
)

646 
obj
->
∑ª¡
->
chûdªn
 = 
	`g_li°_ªmove
(obj->parent->children, obj);

648 
li°
 = 
	`g_li°_√xt
(list);

651 
	`dügøm_åì_ªmove_obje˘s
(
	`dügøm_åì
(), 
ch™ge
->
obj_li°
);

652 
	}
}

655 
	$dñëe_obje˘s_ªvît
(
DñëeObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

657 
GLi°
 *
li°
;

658 
	`DEBUG_PRINTF
(("delete_objects_revert()\n"));

659 
ch™ge
->
≠∂õd
 = 0;

660 
	`œyî_£t_obje˘_li°
(
ch™ge
->
œyî
,

661 
	`g_li°_c›y
(
ch™ge
->
‹igöÆ_obje˘s
));

662 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

664 
li°
 = 
ch™ge
->
obj_li°
;

665 
li°
)

667 
DüObje˘
 *
obj
 = (DüObje˘ *Ë
li°
->
d©a
;

668 i‡(
obj
->
∑ª¡
)

669 
obj
->
∑ª¡
->
chûdªn
 = 
	`g_li°_≠≥nd
(obj->parent->children, obj);

672 
	`d©a_emô
(
	`œyî_gë_∑ª¡_dügøm
(
ch™ge
->
œyî
),ch™ge->œyî,
obj
,"object_add");

674 
li°
 = 
	`g_li°_√xt
(list);

677 
	`dügøm_åì_add_obje˘s
(
	`dügøm_åì
(), 
dü
, 
ch™ge
->
obj_li°
);

678 
	}
}

681 
	$dñëe_obje˘s_‰ì
(
DñëeObje˘sCh™ge
 *
ch™ge
)

683 
	`DEBUG_PRINTF
(("delete_objects_free()\n"));

684 i‡(
ch™ge
->
≠∂õd
)

685 
	`de°roy_obje˘_li°
(
ch™ge
->
obj_li°
);

687 
	`g_li°_‰ì
(
ch™ge
->
obj_li°
);

688 
	`g_li°_‰ì
(
ch™ge
->
‹igöÆ_obje˘s
);

689 
	}
}

696 
Ch™ge
 *

697 
	$undo_dñëe_obje˘s_chûdªn
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
)

699  
	`undo_dñëe_obje˘s
(
dü
, 
	`∑ª¡_li°_af„˘ed
(
obj_li°
));

700 
	}
}

702 
Ch™ge
 *

703 
	$undo_dñëe_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
)

705 
DñëeObje˘sCh™ge
 *
ch™ge
;

707 
ch™ge
 = 
	`g_√w0
(
DñëeObje˘sCh™ge
, 1);

709 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
dñëe_obje˘s_≠∂y
;

710 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
dñëe_obje˘s_ªvît
;

711 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
dñëe_obje˘s_‰ì
;

713 
ch™ge
->
œyî
 = 
dü
->
d©a
->
a˘ive_œyî
;

714 
ch™ge
->
obj_li°
 = obj_list;

715 
ch™ge
->
‹igöÆ_obje˘s
 = 
	`g_li°_c›y
(
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
);

716 
ch™ge
->
≠∂õd
 = 0;

718 
	`DEBUG_PRINTF
(("UNDO: PushÇew dñëêobje˘†© %d\n", 
	`dïth
(
dü
->
undo
)));

719 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

720  (
Ch™ge
 *)
ch™ge
;

721 
	}
}

725 
	sIn£πObje˘sCh™ge
 {

726 
Ch™ge
 
	mch™ge
;

728 
Layî
 *
	mœyî
;

729 
GLi°
 *
	mobj_li°
;

730 
	m≠∂õd
;

734 
	$ö£π_obje˘s_≠∂y
(
In£πObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

736 
	`DEBUG_PRINTF
(("insert_objects_apply()\n"));

737 
ch™ge
->
≠∂õd
 = 1;

738 
	`œyî_add_obje˘s
(
ch™ge
->
œyî
, 
	`g_li°_c›y
(ch™ge->
obj_li°
));

739 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

740 
	`dügøm_åì_add_obje˘s
(
	`dügøm_åì
(), 
dü
, 
ch™ge
->
obj_li°
);

741 
	}
}

744 
	$ö£π_obje˘s_ªvît
(
In£πObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

746 
GLi°
 *
li°
;

748 
	`DEBUG_PRINTF
(("insert_objects_revert()\n"));

749 
ch™ge
->
≠∂õd
 = 0;

750 
	`dügøm_un£À˘_obje˘s
(
dü
, 
ch™ge
->
obj_li°
);

751 
	`œyî_ªmove_obje˘s
(
ch™ge
->
œyî
, ch™ge->
obj_li°
);

752 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

754 
li°
 = 
ch™ge
->
obj_li°
;

755 
li°
 !
NULL
) {

756 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

760 
	`¥›îtõs_hide_if_shown
(
dü
, 
obj
);

762 
li°
 = 
	`g_li°_√xt
(list);

765 
	`dügøm_åì_ªmove_obje˘s
(
	`dügøm_åì
(), 
ch™ge
->
obj_li°
);

766 
	}
}

769 
	$ö£π_obje˘s_‰ì
(
In£πObje˘sCh™ge
 *
ch™ge
)

771 
	`DEBUG_PRINTF
(("insert_objects_free()\n"));

772 i‡(!
ch™ge
->
≠∂õd
)

773 
	`de°roy_obje˘_li°
(
ch™ge
->
obj_li°
);

775 
	`g_li°_‰ì
(
ch™ge
->
obj_li°
);

776 
	}
}

778 
Ch™ge
 *

779 
	$undo_ö£π_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
, 
≠∂õd
)

781 
In£πObje˘sCh™ge
 *
ch™ge
;

783 
ch™ge
 = 
	`g_√w0
(
In£πObje˘sCh™ge
, 1);

785 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
ö£π_obje˘s_≠∂y
;

786 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
ö£π_obje˘s_ªvît
;

787 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
ö£π_obje˘s_‰ì
;

789 
ch™ge
->
œyî
 = 
dü
->
d©a
->
a˘ive_œyî
;

790 
ch™ge
->
obj_li°
 = obj_list;

791 
ch™ge
->
≠∂õd
 =ápplied;

793 
	`DEBUG_PRINTF
(("UNDO: PushÇew in£π obje˘†© %d\n", 
	`dïth
(
dü
->
undo
)));

794 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

795  (
Ch™ge
 *)
ch™ge
;

796 
	}
}

800 
	sRe‹dîObje˘sCh™ge
 {

801 
Ch™ge
 
	mch™ge
;

803 
Layî
 *
	mœyî
;

804 
GLi°
 *
	mch™ged_li°
;

805 
GLi°
 *
	m‹igöÆ_obje˘s
;

806 
GLi°
 *
	mª‹dîed_obje˘s
;

810 
	$ª‹dî_obje˘s_≠∂y
(
Re‹dîObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

812 
	`DEBUG_PRINTF
(("reorder_objects_apply()\n"));

813 
	`œyî_£t_obje˘_li°
(
ch™ge
->
œyî
,

814 
	`g_li°_c›y
(
ch™ge
->
ª‹dîed_obje˘s
));

815 
	`obje˘_add_upd©es_li°
(
ch™ge
->
ch™ged_li°
, 
dü
);

816 
	}
}

819 
	$ª‹dî_obje˘s_ªvît
(
Re‹dîObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

821 
	`DEBUG_PRINTF
(("reorder_objects_revert()\n"));

822 
	`œyî_£t_obje˘_li°
(
ch™ge
->
œyî
,

823 
	`g_li°_c›y
(
ch™ge
->
‹igöÆ_obje˘s
));

824 
	`obje˘_add_upd©es_li°
(
ch™ge
->
ch™ged_li°
, 
dü
);

825 
	}
}

828 
	$ª‹dî_obje˘s_‰ì
(
Re‹dîObje˘sCh™ge
 *
ch™ge
)

830 
	`DEBUG_PRINTF
(("reorder_objects_free()\n"));

831 
	`g_li°_‰ì
(
ch™ge
->
ch™ged_li°
);

832 
	`g_li°_‰ì
(
ch™ge
->
‹igöÆ_obje˘s
);

833 
	`g_li°_‰ì
(
ch™ge
->
ª‹dîed_obje˘s
);

834 
	}
}

836 
Ch™ge
 *

837 
	$undo_ª‹dî_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
ch™ged_li°
, GLi° *
‹ig_li°
)

839 
Re‹dîObje˘sCh™ge
 *
ch™ge
;

841 
ch™ge
 = 
	`g_√w0
(
Re‹dîObje˘sCh™ge
, 1);

843 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
ª‹dî_obje˘s_≠∂y
;

844 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
ª‹dî_obje˘s_ªvît
;

845 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
ª‹dî_obje˘s_‰ì
;

847 
ch™ge
->
œyî
 = 
dü
->
d©a
->
a˘ive_œyî
;

848 
ch™ge
->
ch™ged_li°
 = changed_list;

849 
ch™ge
->
‹igöÆ_obje˘s
 = 
‹ig_li°
;

850 
ch™ge
->
ª‹dîed_obje˘s
 = 
	`g_li°_c›y
(
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
);

852 
	`DEBUG_PRINTF
(("UNDO: PushÇewÑe‹dî obje˘†© %d\n", 
	`dïth
(
dü
->
undo
)));

853 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

854  (
Ch™ge
 *)
ch™ge
;

855 
	}
}

859 
	sObje˘Ch™geCh™ge
 {

860 
Ch™ge
 
	mch™ge
;

862 
DüObje˘
 *
	mobj
;

863 
Obje˘Ch™ge
 *
	mobj_ch™ge
;

868 
	$obje˘_ch™ge_≠∂y
(
Obje˘Ch™geCh™ge
 *
ch™ge
,

869 
Dügøm
 *
dü
)

871 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

872 
ch™ge
->
obj_ch™ge
->
	`≠∂y
(ch™ge->obj_ch™ge, ch™ge->
obj
);

874 
Poöt
 
p
 = 
ch™ge
->
obj
->
posôi⁄
;

875 (
ch™ge
->
obj
->
›s
->
move
)(ch™ge->obj,&
p
);

877 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

879 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
, 
ch™ge
->
obj
, 
TRUE
);

881 
	`¥›îtõs_upd©e_if_shown
(
dü
, 
ch™ge
->
obj
);

882 
	}
}

885 
	$obje˘_ch™ge_ªvît
(
Obje˘Ch™geCh™ge
 *
ch™ge
,

886 
Dügøm
 *
dü
)

888 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

889 
ch™ge
->
obj_ch™ge
->
	`ªvît
(ch™ge->obj_ch™ge, ch™ge->
obj
);

891 
Poöt
 
p
 = 
ch™ge
->
obj
->
posôi⁄
;

892 (
ch™ge
->
obj
->
›s
->
move
)(ch™ge->obj,&
p
);

894 
	`obje˘_add_upd©es
(
ch™ge
->
obj
, 
dü
);

896 
	`dügøm_upd©e_c⁄√˘i⁄s_obje˘
(
dü
, 
ch™ge
->
obj
, 
TRUE
);

898 
	`¥›îtõs_upd©e_if_shown
(
dü
, 
ch™ge
->
obj
);

899 
	}
}

902 
	$obje˘_ch™ge_‰ì
(
Obje˘Ch™geCh™ge
 *
ch™ge
)

904 
	`DEBUG_PRINTF
(("state_change_free()\n"));

905 i‡(
ch™ge
->
obj_ch™ge
->
‰ì
)

906 (*
ch™ge
->
obj_ch™ge
->
‰ì
)(change->obj_change);

907 
	`g_‰ì
(
ch™ge
->
obj_ch™ge
);

908 
	}
}

910 
Ch™ge
 *

911 
	$undo_obje˘_ch™ge
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
,

912 
Obje˘Ch™ge
 *
obj_ch™ge
)

914 
Obje˘Ch™geCh™ge
 *
ch™ge
;

916 
ch™ge
 = 
	`g_√w0
(
Obje˘Ch™geCh™ge
, 1);

918 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
obje˘_ch™ge_≠∂y
;

919 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
obje˘_ch™ge_ªvît
;

920 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
obje˘_ch™ge_‰ì
;

922 
ch™ge
->
obj
 = obj;

923 
ch™ge
->
obj_ch™ge
 = obj_change;

925 
	`DEBUG_PRINTF
(("UNDO: PushÇew obj_ch™gê© %d\n", 
	`dïth
(
dü
->
undo
)));

926 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

927  (
Ch™ge
 *)
ch™ge
;

928 
	}
}

938 
	sGroupObje˘sCh™ge
 {

939 
Ch™ge
 
	mch™ge
;

941 
Layî
 *
	mœyî
;

942 
DüObje˘
 *
	mgroup
;

943 
GLi°
 *
	mobj_li°
;

945 
GLi°
 *
	m‹ig_li°
;

948 
	m≠∂õd
;

952 
	$group_obje˘s_≠∂y
(
GroupObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

954 
GLi°
 *
li°
;

956 
	`DEBUG_PRINTF
(("group_objects_apply()\n"));

958 
ch™ge
->
≠∂õd
 = 1;

960 
	`dügøm_un£À˘_obje˘s
(
dü
, 
ch™ge
->
obj_li°
);

961 
	`œyî_ªmove_obje˘s
(
ch™ge
->
œyî
, ch™ge->
obj_li°
);

962 
	`œyî_add_obje˘
(
ch™ge
->
œyî
, ch™ge->
group
);

963 
	`obje˘_add_upd©es
(
ch™ge
->
group
, 
dü
);

965 
li°
 = 
ch™ge
->
obj_li°
;

966 
li°
 !
NULL
) {

967 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

971 
	`¥›îtõs_hide_if_shown
(
dü
, 
obj
);

973 
	`obje˘_add_upd©es
(
obj
, 
dü
);

975 
li°
 = 
	`g_li°_√xt
(list);

978 
	`dügøm_åì_add_obje˘
(
	`dügøm_åì
(), 
dü
, 
ch™ge
->
group
);

979 
	`dügøm_åì_ªmove_obje˘s
(
	`dügøm_åì
(), 
ch™ge
->
obj_li°
);

980 
	}
}

983 
	$group_obje˘s_ªvît
(
GroupObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

985 
	`DEBUG_PRINTF
(("group_objects_revert()\n"));

986 
ch™ge
->
≠∂õd
 = 0;

988 
	`dügøm_un£À˘_obje˘
(
dü
, 
ch™ge
->
group
);

989 
	`obje˘_add_upd©es
(
ch™ge
->
group
, 
dü
);

991 
	`œyî_£t_obje˘_li°
(
ch™ge
->
œyî
, 
	`g_li°_c›y
(ch™ge->
‹ig_li°
));

993 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

995 
	`¥›îtõs_hide_if_shown
(
dü
, 
ch™ge
->
group
);

997 
	`dügøm_åì_add_obje˘s
(
	`dügøm_åì
(), 
dü
, 
ch™ge
->
obj_li°
);

998 
	`dügøm_åì_ªmove_obje˘
(
	`dügøm_åì
(), 
ch™ge
->
group
);

999 
	}
}

1002 
	$group_obje˘s_‰ì
(
GroupObje˘sCh™ge
 *
ch™ge
)

1004 
	`DEBUG_PRINTF
(("group_objects_free()\n"));

1005 i‡(!
ch™ge
->
≠∂õd
) {

1006 
	`group_de°roy_shÆlow
(
ch™ge
->
group
);

1007 
ch™ge
->
group
 = 
NULL
;

1008 
ch™ge
->
obj_li°
 = 
NULL
;

1011 
	`g_li°_‰ì
(
ch™ge
->
‹ig_li°
);

1012 
	}
}

1014 
Ch™ge
 *

1015 
	$undo_group_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
, 
DüObje˘
 *
group
,

1016 
GLi°
 *
‹ig_li°
)

1018 
GroupObje˘sCh™ge
 *
ch™ge
;

1020 
ch™ge
 = 
	`g_√w0
(
GroupObje˘sCh™ge
, 1);

1022 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
group_obje˘s_≠∂y
;

1023 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
group_obje˘s_ªvît
;

1024 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
group_obje˘s_‰ì
;

1026 
ch™ge
->
œyî
 = 
dü
->
d©a
->
a˘ive_œyî
;

1027 
ch™ge
->
group
 = group;

1028 
ch™ge
->
obj_li°
 = obj_list;

1029 
ch™ge
->
‹ig_li°
 = orig_list;

1030 
ch™ge
->
≠∂õd
 = 1;

1032 
	`DEBUG_PRINTF
(("UNDO: PushÇew grou∞obje˘†© %d\n", 
	`dïth
(
dü
->
undo
)));

1033 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

1034  (
Ch™ge
 *)
ch™ge
;

1035 
	}
}

1039 
	sUngroupObje˘sCh™ge
 {

1040 
Ch™ge
 
	mch™ge
;

1042 
Layî
 *
	mœyî
;

1043 
DüObje˘
 *
	mgroup
;

1044 
GLi°
 *
	mobj_li°
;

1045 
	mgroup_ödex
;

1046 
	m≠∂õd
;

1050 
	$ungroup_obje˘s_≠∂y
(
UngroupObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

1052 
	`DEBUG_PRINTF
(("ungroup_objects_apply()\n"));

1054 
ch™ge
->
≠∂õd
 = 1;

1056 
	`dügøm_un£À˘_obje˘
(
dü
, 
ch™ge
->
group
);

1057 
	`obje˘_add_upd©es
(
ch™ge
->
group
, 
dü
);

1058 
	`œyî_ª∂a˚_obje˘_wôh_li°
(
ch™ge
->
œyî
, ch™ge->
group
,

1059 
	`g_li°_c›y
(
ch™ge
->
obj_li°
));

1060 
	`obje˘_add_upd©es_li°
(
ch™ge
->
obj_li°
, 
dü
);

1062 
	`¥›îtõs_hide_if_shown
(
dü
, 
ch™ge
->
group
);

1064 
	`dügøm_åì_add_obje˘s
(
	`dügøm_åì
(), 
dü
, 
ch™ge
->
obj_li°
);

1065 
	`dügøm_åì_ªmove_obje˘
(
	`dügøm_åì
(), 
ch™ge
->
group
);

1066 
	}
}

1069 
	$ungroup_obje˘s_ªvît
(
UngroupObje˘sCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

1071 
GLi°
 *
li°
;

1073 
	`DEBUG_PRINTF
(("ungroup_objects_revert()\n"));

1074 
ch™ge
->
≠∂õd
 = 0;

1077 
	`dügøm_un£À˘_obje˘s
(
dü
, 
ch™ge
->
obj_li°
);

1078 
	`œyî_ªmove_obje˘s
(
ch™ge
->
œyî
, ch™ge->
obj_li°
);

1079 
	`œyî_add_obje˘_©
(
ch™ge
->
œyî
, ch™ge->
group
, ch™ge->
group_ödex
);

1080 
	`obje˘_add_upd©es
(
ch™ge
->
group
, 
dü
);

1082 
li°
 = 
ch™ge
->
obj_li°
;

1083 
li°
 !
NULL
) {

1084 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

1088 
	`¥›îtõs_hide_if_shown
(
dü
, 
obj
);

1090 
li°
 = 
	`g_li°_√xt
(list);

1093 
	`dügøm_åì_add_obje˘
(
	`dügøm_åì
(), 
dü
, 
ch™ge
->
group
);

1094 
	`dügøm_åì_ªmove_obje˘s
(
	`dügøm_åì
(), 
ch™ge
->
obj_li°
);

1095 
	}
}

1098 
	$ungroup_obje˘s_‰ì
(
UngroupObje˘sCh™ge
 *
ch™ge
)

1100 
	`DEBUG_PRINTF
(("ungroup_objects_free()\n"));

1101 i‡(
ch™ge
->
≠∂õd
) {

1102 
	`group_de°roy_shÆlow
(
ch™ge
->
group
);

1103 
ch™ge
->
group
 = 
NULL
;

1104 
ch™ge
->
obj_li°
 = 
NULL
;

1106 
	}
}

1108 
Ch™ge
 *

1109 
	$undo_ungroup_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
, 
DüObje˘
 *
group
,

1110 
group_ödex
)

1112 
UngroupObje˘sCh™ge
 *
ch™ge
;

1114 
ch™ge
 = 
	`g_√w0
(
UngroupObje˘sCh™ge
, 1);

1116 
ch™ge
->ch™ge.
≠∂y
 = (
UndoAµlyFunc
Ë
ungroup_obje˘s_≠∂y
;

1117 
ch™ge
->ch™ge.
ªvît
 = (
UndoRevîtFunc
Ë
ungroup_obje˘s_ªvît
;

1118 
ch™ge
->ch™ge.
‰ì
 = (
UndoFªeFunc
Ë
ungroup_obje˘s_‰ì
;

1120 
ch™ge
->
œyî
 = 
dü
->
d©a
->
a˘ive_œyî
;

1121 
ch™ge
->
group
 = group;

1122 
ch™ge
->
obj_li°
 = obj_list;

1123 
ch™ge
->
group_ödex
 = group_index;

1124 
ch™ge
->
≠∂õd
 = 1;

1126 
	`DEBUG_PRINTF
(("UNDO: PushÇew ungrou∞obje˘†© %d\n", 
	`dïth
(
dü
->
undo
)));

1127 
	`undo_push_ch™ge
(
dü
->
undo
, (
Ch™ge
 *Ë
ch™ge
);

1128  (
Ch™ge
 *)
ch™ge
;

1129 
	}
}

1133 
	sP¨ítCh™ge
 {

1134 
Ch™ge
 
	mch™ge
;

1135 
DüObje˘
 *
	m∑ª¡obj
, *
	mchûdobj
;

1136 
gboﬁón
 
	m∑ª¡
;

1142 
	$∑ª¡_obje˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
∑ª¡
, DüObje˘ *
chûd
)

1144 
chûd
->
∑ª¡
 =Öarent;

1145 
∑ª¡
->
chûdªn
 = 
	`g_li°_¥ïíd
’¨ít->chûdªn, 
chûd
);

1146 
	}
}

1151 
	$u≈¨ít_obje˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
∑ª¡
, DüObje˘ *
chûd
)

1153 
chûd
->
∑ª¡
 = 
NULL
;

1154 
∑ª¡
->
chûdªn
 = 
	`g_li°_ªmove
’¨ít->chûdªn, 
chûd
);

1155 
	}
}

1159 
	$∑ª¡_ch™ge_≠∂y
(
Ch™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

1161 
P¨ítCh™ge
 *
∑ª¡ch™ge
 = (P¨ítCh™ge*)
ch™ge
;

1162 i‡(
∑ª¡ch™ge
->
∑ª¡
) {

1163 
	`∑ª¡_obje˘
(
dü
, 
∑ª¡ch™ge
->
∑ª¡obj
,Ö¨ítch™ge->
chûdobj
);

1165 
	`u≈¨ít_obje˘
(
dü
, 
∑ª¡ch™ge
->
∑ª¡obj
,Ö¨ítch™ge->
chûdobj
);

1167 
	}
}

1171 
	$∑ª¡_ch™ge_ªvît
(
Ch™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

1173 
P¨ítCh™ge
 *
∑ª¡ch™ge
 = (P¨ítCh™ge*)
ch™ge
;

1174 i‡(!
∑ª¡ch™ge
->
∑ª¡
) {

1175 
	`∑ª¡_obje˘
(
dü
, 
∑ª¡ch™ge
->
∑ª¡obj
,Ö¨ítch™ge->
chûdobj
);

1177 
	`u≈¨ít_obje˘
(
dü
, 
∑ª¡ch™ge
->
∑ª¡obj
,Ö¨ítch™ge->
chûdobj
);

1179 
	}
}

1183 
	$∑ª¡_ch™ge_‰ì
(
Ch™ge
 *
ch™ge
)

1185 
	}
}

1191 
Ch™ge
 *

1192 
	$undo_∑ª¡ög
(
Dügøm
 *
dü
, 
DüObje˘
* 
∑ª¡obj
, DüObje˘* 
chûdobj
,

1193 
gboﬁón
 
∑ª¡
)

1195 
P¨ítCh™ge
 *
∑ª¡ch™ge
 = 
	`g_√w0
(ParentChange, 1);

1196 
Ch™ge
 *
ch™ge
 = (Ch™ge*)
∑ª¡ch™ge
;

1197 
ch™ge
->
≠∂y
 = 
∑ª¡_ch™ge_≠∂y
;

1198 
ch™ge
->
ªvît
 = 
∑ª¡_ch™ge_ªvît
;

1199 
ch™ge
->
‰ì
 = 
∑ª¡_ch™ge_‰ì
;

1201 
∑ª¡ch™ge
->
∑ª¡obj
 =Öarentobj;

1202 
∑ª¡ch™ge
->
chûdobj
 = childobj;

1203 
∑ª¡ch™ge
->
∑ª¡
 =Öarent;

1205 
	`DEBUG_PRINTF
(("UNDO: PushÇew obj_ch™gê© %d\n", 
	`dïth
(
dü
->
undo
)));

1206 
	`undo_push_ch™ge
(
dü
->
undo
, 
ch™ge
);

1207  
ch™ge
;

1208 
	}
}

1211 
	s_MoveObje˘ToLayîCh™ge
 {

1212 
Ch™ge
 
	mch™ge
;

1214 
GLi°
 *
	mobje˘s
;

1216 
GLi°
 *
	m‹ig_li°
;

1218 
Layî
 *
	m‹ig_œyî
;

1219 
gboﬁón
 
	mmovög_up
;

1220 } 
	tMoveObje˘ToLayîCh™ge
;

1227 
	$move_obje˘_œyî_ªœtive
(
Dügøm
 *
dü
, 
GLi°
 *
obje˘s
, 
göt
 
di°
)

1230 
Layî
 *
a˘ive
, *
èrgë
;

1231 
guöt
 
pos
;

1233 
	`g_ªtu∫_if_Áû
(
dü
->
d©a
->
a˘ive_œyî
);

1235 
a˘ive
 = 
dü
->
d©a
->
a˘ive_œyî
;

1236 
pos
 = 0;Öo†< 
dü
->
d©a
->
œyîs
->
Àn
; ++pos)

1237 i‡(
a˘ive
 =
	`g_±r_¨øy_ödex
(
dü
->
d©a
->
œyîs
, 
pos
))

1240 
pos
 = (po†+ 
dü
->
d©a
->
œyîs
->
Àn
 + 
di°
) % dia->data->layers->len;

1241 
èrgë
 = 
	`g_±r_¨øy_ödex
(
dü
->
d©a
->
œyîs
, 
pos
);

1242 
	`obje˘_add_upd©es_li°
(
obje˘s
, 
dü
);

1243 
	`œyî_ªmove_obje˘s
(
a˘ive
, 
obje˘s
);

1244 
	`dügøm_åì_add_obje˘s
(
	`dügøm_åì
(), 
dü
, 
obje˘s
);

1245 
	`œyî_add_obje˘s
(
èrgë
, 
	`g_li°_c›y
(
obje˘s
));

1246 
	`d©a_£t_a˘ive_œyî
(
dü
->
d©a
, 
èrgë
);

1247 
	`dügøm_åì_add_obje˘s
(
	`dügøm_åì
(), 
dü
, 
obje˘s
);

1248 
	}
}

1251 
	$move_obje˘_to_œyî_≠∂y
(
MoveObje˘ToLayîCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

1253 i‡(
ch™ge
->
movög_up
) {

1254 
	`move_obje˘_œyî_ªœtive
(
dü
, 
ch™ge
->
obje˘s
, 1);

1256 
	`move_obje˘_œyî_ªœtive
(
dü
, 
ch™ge
->
obje˘s
, -1);

1258 
	}
}

1261 
	$move_obje˘_to_œyî_ªvît
(
MoveObje˘ToLayîCh™ge
 *
ch™ge
, 
Dügøm
 *
dü
)

1263 i‡(
ch™ge
->
movög_up
) {

1264 
	`move_obje˘_œyî_ªœtive
(
dü
, 
ch™ge
->
obje˘s
, -1);

1266 
	`dügøm_un£À˘_obje˘s
(
dü
, 
ch™ge
->
obje˘s
);

1267 
	`move_obje˘_œyî_ªœtive
(
dü
, 
ch™ge
->
obje˘s
, 1);

1269 
	`œyî_£t_obje˘_li°
(
ch™ge
->
‹ig_œyî
, 
	`g_li°_c›y
(ch™ge->
‹ig_li°
));

1270 
	`obje˘_add_upd©es_li°
(
ch™ge
->
‹ig_li°
, 
dü
);

1272 
	}
}

1275 
	$move_obje˘_to_œyî_‰ì
(
MoveObje˘ToLayîCh™ge
 *
ch™ge
)

1277 
	`g_li°_‰ì
(
ch™ge
->
obje˘s
);

1278 
	`g_li°_‰ì
(
ch™ge
->
‹ig_li°
);

1279 
ch™ge
->
obje˘s
 = 
NULL
;

1280 
ch™ge
->
‹ig_li°
 = 
NULL
;

1281 
	}
}

1283 
Ch™ge
 *

1284 
	$undo_move_obje˘_Ÿhî_œyî
(
Dügøm
 *
dü
, 
GLi°
 *
£À˘ed_li°
,

1285 
gboﬁón
 
movög_up
)

1287 
MoveObje˘ToLayîCh™ge
 *
movëﬁayîch™ge


1288 
	`g_√w0
(
MoveObje˘ToLayîCh™ge
, 1);

1289 
Ch™ge
 *
ch™ge
 = (Ch™ge*)
movëﬁayîch™ge
;

1290 
ch™ge
->
≠∂y
 = (
UndoAµlyFunc
Ë
move_obje˘_to_œyî_≠∂y
;

1291 
ch™ge
->
ªvît
 = (
UndoRevîtFunc
Ë
move_obje˘_to_œyî_ªvît
;

1292 
ch™ge
->
‰ì
 = (
UndoFªeFunc
Ë
move_obje˘_to_œyî_‰ì
;

1294 
movëﬁayîch™ge
->
‹ig_œyî
 = 
dü
->
d©a
->
a˘ive_œyî
;

1295 
movëﬁayîch™ge
->
‹ig_li°
 = 
	`g_li°_c›y
(
dü
->
d©a
->
a˘ive_œyî
->
obje˘s
);

1296 
movëﬁayîch™ge
->
obje˘s
 = 
	`g_li°_c›y
(
£À˘ed_li°
);

1297 
movëﬁayîch™ge
->
movög_up
 = moving_up;

1299 
	`DEBUG_PRINTF
(("UNDO: PushÇew obj_œyî_ch™gê© %d\n", 
	`dïth
(
dü
->
undo
)));

1300 
	`undo_push_ch™ge
(
dü
->
undo
, 
ch™ge
);

1301  
ch™ge
;

1302 
	}
}

	@O:\tool\dvs50\app\undo.h

18 #i‚de‡
UNDO_H


19 
	#UNDO_H


	)

22 
_UndoSèck
 
	tUndoSèck
;

23 
_Ch™ge
 
	tCh™ge
;

25 
	~"dügøm.h
"

26 
	~"objch™ge.h
"

28 (*
	tUndoAµlyFunc
)(
	tCh™ge
 *
	tch™ge
, 
	tDügøm
 *
	tdü
);

29 (*
	tUndoRevîtFunc
)(
	tCh™ge
 *
	tch™ge
, 
	tDügøm
 *
	tdü
);

30 (*
	tUndoFªeFunc
)(
	tCh™ge
 *
	tch™ge
);

32 
	s_Ch™ge
 {

35 
UndoAµlyFunc
 
≠∂y
;

36 
UndoRevîtFunc
 
ªvît
;

37 
UndoFªeFunc
 
‰ì
;

38 
Ch™ge
 *
¥ev
, *
√xt
;

41 
	s_UndoSèck
 {

42 
Dügøm
 *
dü
;

43 
Ch™ge
 *
œ°_ch™ge
;

44 
Ch™ge
 *
cuºít_ch™ge
;

45 
Ch™ge
 *
œ°_ßve
;

46 
dïth
;

49 
UndoSèck
 *
	`√w_undo_°ack
(
Dügøm
 *
dü
);

50 
	`undo_de°roy
(
UndoSèck
 *
°ack
);

51 
	`undo_push_ch™ge
(
UndoSèck
 *
°ack
, 
Ch™ge
 *
ch™ge
);

52 
	`undo_£t_å™ß˘i⁄poöt
(
UndoSèck
 *
°ack
);

53 
	`undo_ªvît_to_œ°_ç
(
UndoSèck
 *
°ack
);

54 
	`undo_≠∂y_to_√xt_ç
(
UndoSèck
 *
°ack
);

55 
	`undo_˛ór
(
UndoSèck
 *
°ack
);

56 
	`undo_m¨k_ßve
(
UndoSèck
 *
°ack
);

57 
gboﬁón
 
	`undo_is_ßved
(
UndoSèck
 *
°ack
);

58 
gboﬁón
 
	`undo_avaûabÀ
(
UndoSèck
 *
°ack
, gboﬁó¿
undo
);

59 
Ch™ge
* 
	`undo_ªmove_to
(
UndoSèck
 *
°ack
, 
UndoAµlyFunc
 *
ty≥
);

63 
Ch™ge
 *
	`undo_move_obje˘s
(
Dügøm
 *
dü
, 
Poöt
 *
‹ig_pos
,

64 
Poöt
 *
de°_pos
, 
GLi°
 *
obj_li°
);

65 
Ch™ge
 *
	`undo_move_h™dÀ
(
Dügøm
 *
dü
,

66 
H™dÀ
 *
h™dÀ
, 
DüObje˘
 *
obj
,

67 
Poöt
 
‹ig_pos
, Poöà
de°_pos
);

68 
Ch™ge
 *
	`undo_c⁄√˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
,

69 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
);

70 
Ch™ge
 *
	`undo_unc⁄√˘
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
);

71 
Ch™ge
 *
	`undo_dñëe_obje˘s_chûdªn
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
);

72 
Ch™ge
 *
	`undo_dñëe_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
);

73 
Ch™ge
 *
	`undo_ö£π_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
,

74 
≠∂õd
);

75 
Ch™ge
 *
	`undo_ª‹dî_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
ch™ged_li°
,

76 
GLi°
 *
‹ig_li°
);

77 
Ch™ge
 *
	`undo_obje˘_ch™ge
(
Dügøm
 *
dü
, 
DüObje˘
 *
obj
,

78 
Obje˘Ch™ge
 *
obj_ch™ge
);

79 
Ch™ge
 *
	`undo_group_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
,

80 
DüObje˘
 *
group
, 
GLi°
 *
‹ig_li°
);

81 
Ch™ge
 *
	`undo_ungroup_obje˘s
(
Dügøm
 *
dü
, 
GLi°
 *
obj_li°
,

82 
DüObje˘
 *
group
, 
group_ödex
);

83 
Ch™ge
 *
	`undo_∑ª¡ög
(
Dügøm
 *
dü
, 
DüObje˘
 *
∑ª¡obj
, DüObje˘ *
chûdobj
,

84 
gboﬁón
 
∑ª¡
);

85 
Ch™ge
 *
	`undo_move_obje˘_Ÿhî_œyî
(
Dügøm
 *
dügøm
, 
GLi°
 *
£À˘ed_li°
,

86 
gboﬁón
 
movög_up
);

	@O:\tool\dvs50\app\winmain.c

1 
	~<c⁄fig.h
>

3 
	~<°dlib.h
>

4 
	~<glib.h
>

5 
	~<gtk/gtk.h
>

7 #ifde‡
G_OS_WIN32


8 
	#Re˘™gÀ
 
Wö32Re˘™gÀ


	)

9 
	#WIN32_LEAN_AND_MEAN


	)

10 
	~<wödows.h
>

11 #unde‡
Re˘™gÀ


13 
	~"≠p_¥ocs.h
"

14 
	~"öãrÁ˚.h
"

18 #ifde‡
__GNUC__


19 #i‚de‡
_°dˇŒ


20 
	#_°dˇŒ
 
	`__©åibuã__
((
°dˇŒ
))

	)

24 
_°dˇŒ


25 
	$WöMaö
 (
HINSTANCE__
 *
hIn°™˚
,

26 
HINSTANCE__
 *
hPªvIn°™˚
,

27 *
ÕszCmdLöe
,

28 
nCmdShow
)

30 
	`dü_ªdúe˘_c⁄sﬁe
 ();

32 
	`≠p_öô
 (
__¨gc
, 
__¨gv
);

34 i‡(!
	`≠p_is_öãø˘ive
())

37 
	`toﬁbox_show
();

39 
	`≠p_•œsh_d⁄e
();

41 
	`gtk_maö
 ();

44 
	}
}

47 
	$dü_log_func
 (c⁄° 
gch¨
 *
log_domaö
,

48 
GLogLevñFœgs
 
Êags
,

49 c⁄° 
gch¨
 *
mesßge
,

50 
gpoöãr
 
d©a
)

52 
HANDLE
 
fûe
 = (HANDLE)
d©a
;

53 c⁄° * 
Àvñ
;

54 * 
œ°_mesßge
 = 
NULL
;

55 
guöt32
 
dwWrôãn
;

58 i‡(
œ°_mesßge
 && (0 =
	`°rcmp
 (œ°_mesßge, 
mesßge
)))

61 i‡(
œ°_mesßge
)

62 
	`‰ì
 (
œ°_mesßge
);

63 
œ°_mesßge
 = 
	`°rdup
 (
mesßge
);

65 
	`WrôeFûe
 (
fûe
, 
log_domaö
 ?Üog_domaö : "?",Üog_domaö ? 
	`°æí
÷og_domaöË: 1, &
dwWrôãn
, 0);

66 
	`WrôeFûe
 (
fûe
, "-", 1, &
dwWrôãn
, 0);

67 
Àvñ
 = 
Êags
 & 
G_LOG_LEVEL_ERROR
 ? "Error" :

68 
Êags
 & 
G_LOG_LEVEL_CRITICAL
 ? "Critical" :

69 
Êags
 & 
G_LOG_LEVEL_WARNING
 ? "Warning" :

70 
Êags
 & 
G_LOG_LEVEL_INFO
 ? "Info" :

71 
Êags
 & 
G_LOG_LEVEL_DEBUG
 ? "Debug" :

72 
Êags
 & 
G_LOG_LEVEL_MESSAGE
 ? "Message" : "?";

73 
	`WrôeFûe
 (
fûe
, 
Àvñ
, 
	`°æí
÷evñ), &
dwWrôãn
, 0);

74 
	`WrôeFûe
 (
fûe
, ": ", 2, &
dwWrôãn
, 0);

75 
	`WrôeFûe
 (
fûe
, 
mesßge
, 
	`°æí
(mesßge), &
dwWrôãn
, 0);

76 
	`WrôeFûe
 (
fûe
, "\r\n", 2, &
dwWrôãn
, 0);

77 
	`FlushFûeBuf„rs
 (
fûe
);

79 i‡(
Êags
 & 
G_LOG_FATAL_MASK
)

83 
	}
}

86 
	$dü_¥öt_func
 (c⁄° * 
°rög
)

89 
	}
}

92 
	$dü_ªdúe˘_c⁄sﬁe
 ()

94 c⁄° 
gch¨
 *
log_domaös
[] =

100 
NULL
,

102 
MAX_TRIES
 = 16;

103 
i
 = 0;

104 
HANDLE
 
fûe
 = 
INVALID_HANDLE_VALUE
;

105 
log«me
[] = "dü--" 
VERSION
 ".log";

106 * 
ªdúe˘ed
;

107 
gboﬁón
 
vîbo£
 = 
TRUE
;

108 
BY_HANDLE_FILE_INFORMATION
 
fi
 = { 0, };

110 i‡––((
fûe
 = 
	`GëStdH™dÀ
 (
STD_OUTPUT_HANDLE
)Ë!
INVALID_HANDLE_VALUE
)

111 || ((
fûe
 = 
	`GëStdH™dÀ
 (
STD_ERROR_HANDLE
)Ë!
INVALID_HANDLE_VALUE
))

112 && (
	`GëFûeInf‹m©i⁄ByH™dÀ
 (
fûe
, &
fi
Ë&& (fi.
dwFûeAâribuãs
 != 0)))

113 
vîbo£
 = 
FALSE
;

117 
ªdúe˘ed
 = 
	`g_buûd_fûíame
 (
	`g_gë_tmp_dú
 (), 
log«me
, 
NULL
);

121 
fûe
 = 
	`Cª©eFûe
 (
ªdúe˘ed
, 
GENERIC_WRITE
, 
FILE_SHARE_READ
, 
NULL
, 
CREATE_ALWAYS
, 
FILE_FLAG_WRITE_THROUGH
, 0);

122 i‡(
fûe
 =
INVALID_HANDLE_VALUE
)

124 
i
++;

125 
	`g_‰ì
 (
ªdúe˘ed
);

126 
log«me
[3] = '0' + 
i
;

128 } 
fûe
 =
INVALID_HANDLE_VALUE
 && 
i
 < 
MAX_TRIES
);

130 i‡(
fûe
 !
INVALID_HANDLE_VALUE
)

132 * 
log2
 = 
	`g_°rjoöv
("\r\n", 
_ívú⁄
);

133 * 
log
 = 
	`g_°rdup_¥ötf
 ("Dia (%s) instance %d started "

135 
VERSION
, 
i
 + 1,

136 
gtk_maj‹_vîsi⁄
, 
gtk_mö‹_vîsi⁄
, 
gtk_mi¸o_vîsi⁄
, 
gtk_bö¨y_age
,

137 
log2
);

138 
guöt32
 
dwWrôãn
;

139 
	`g_‰ì
 (
log2
);

141 i‡(!
vîbo£
 || 
	`WrôeFûe
 (
fûe
, 
log
, 
	`°æí
÷og), &
dwWrôãn
, 0))

143 
i
 = 0; i < 
	`G_N_ELEMENTS
 (
log_domaös
); i++)

144 
	`g_log_£t_h™dÀr
 (
log_domaös
[
i
],

145 
G_LOG_LEVEL_MESSAGE
 | 
G_LOG_LEVEL_INFO
 | 
G_LOG_LEVEL_WARNING
 | 
G_LOG_LEVEL_CRITICAL
 | 
G_LOG_LEVEL_ERROR
,

146 
dü_log_func
,

147 
fûe
);

149 
	`g_£t_¥öt_h™dÀr
 (
dü_¥öt_func
);

153 * 
emsg
 = 
	`g_wö32_îr‹_mesßge
 (
	`GëLa°Eº‹
 ());

154 
	`g_¥öãº
 ("Logfûê%†wrôög faûed: %s", 
ªdúe˘ed
, 
emsg
);

155 
	`g_‰ì
 (
emsg
);

157 
	`g_‰ì
 (
log
);

159 
	}
}

	@O:\tool\dvs50\config.h

5 
	#ENABLE_NLS
 1

	)

7 
	#LIBDIA_COMPILATION
 1

	)

9 
	#GETTEXT_PACKAGE
 "dü"

	)

18 
	#HAVE_BIND_TEXTDOMAIN_CODESET
 1

	)

21 
	#HAVE_CAIRO
 1

	)

24 
	#HAVE_DCGETTEXT
 1

	)

27 
	#HAVE_DLFCN_H
 1

	)

31 
	#HAVE_FCNTL_H
 1

	)

34 
	#HAVE_FREETYPE
 1

	)

37 
	#HAVE_GETTEXT
 1

	)

43 
	#HAVE_INTTYPES_H
 1

	)

46 
	#HAVE_ISINF
 1

	)

49 
	#HAVE_LC_MESSAGES
 1

	)

58 
	#HAVE_LIBPNG


	)

61 
	#HAVE_LIBZ


	)

64 
	#HAVE_LOCALE_H
 1

	)

67 
	#HAVE_MATH_H
 1

	)

70 
	#HAVE_MEMORY_H
 1

	)

73 
	#HAVE_PANGOCAIRO_H
 1

	)

76 
	#HAVE_SELECT
 1

	)

79 
	#HAVE_STDDEF_H
 1

	)

82 
	#HAVE_STDINT_H
 1

	)

85 
	#HAVE_STDLIB_H
 1

	)

88 
	#HAVE_STRCSPN
 1

	)

91 
	#HAVE_STRDUP
 1

	)

94 
	#HAVE_STRINGS_H
 1

	)

97 
	#HAVE_STRING_H
 1

	)

100 
	#HAVE_STRTOL
 1

	)

103 
	#HAVE_SYS_STAT_H
 1

	)

106 
	#HAVE_SYS_TYPES_H
 1

	)

109 
	#HAVE_UNISTD_H
 1

	)

112 
	#HAVE_UTIME_H
 1

	)

115 
	#HAVE_ZLIB_H
 1

	)

118 
	#LIBXSLT_PREFIX
 "/u§/lib"

	)

125 
	#PACKAGE
 "dü"

	)

128 
	#PACKAGE_BUGREPORT
 "hâp://bugzûœ.gnome.‹g/íãr_bug.cgi?¥odu˘=dü"

	)

131 
	#PACKAGE_NAME
 "dü"

	)

134 
	#PACKAGE_STRING
 "dü 0.97.2"

	)

137 
	#PACKAGE_TARNAME
 "dü"

	)

140 
	#PACKAGE_URL
 ""

	)

143 
	#PACKAGE_VERSION
 "0.97.2"

	)

146 
	#STDC_HEADERS
 1

	)

149 
	#VERSION
 "0.97.2"

	)

	@O:\tool\dvs50\lib\arrows.c

19 
	~<c⁄fig.h
>

21 
	#_BSD_SOURCE
 1

	)

22 
	~<m©h.h
>

23 
	~<°dio.h
>

24 
	~<°rög.h
>

26 
	~<glib.h
>

27 
	~"mesßge.h
"

28 
	~"boundögbox.h
"

30 #ifde‡
G_OS_WIN32


31 
	~<Êﬂt.h
>

32 
	#föôe
(
d
Ë
	`_föôe
(d)

	)

35 #ifde‡
__EMX__


36 
	#föôe
(
d
Ë
	`isföôe
(d)

	)

39 
	~"¨rows.h
"

40 
	~"düªndîî.h
"

41 
	~"©åibuãs.h
"

42 
	~"widgës.h
"

43 
	~"öé.h
"

47 
døw_em±y_ñlù£
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

48 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

49 
Cﬁ‹
 *
fg_cﬁ‹
);

51 
ˇlcuœã_doubÀ_¨row
(
Poöt
 *
£c⁄d_to
, Poöà*
£c⁄d_‰om
,

52 c⁄° 
Poöt
 *
to
, c⁄° Poöà*
‰om
, 
ªÆ
 
Àngth
);

55 
døw_¸ow_foŸ
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

56 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

57 
Cﬁ‹
 *
fg_cﬁ‹
,Cﬁ‹ *
bg_cﬁ‹
);

59 
ˇlcuœã_düm⁄d
(
Poöt
 *
pﬁy
 , c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

60 
ªÆ
 
Àngth
,Ñó»
width
);

77 
	$ˇlcuœã_¨row_poöt
(c⁄° 
Aºow
 *
¨row
, c⁄° 
Poöt
 *
to
, c⁄° Poöà*
‰om
,

78 
Poöt
 *
move_¨row
, Poöà*
move_löe
,

79 
ªÆ
 
löewidth
)

81 
ªÆ
 
add_Àn
;

82 
ªÆ
 
™gÀ
;

83 
Poöt
 
tmp
;

84 
AºowTy≥
 
¨row_ty≥
 = 
¨row
->
ty≥
;

88 i‡(
löewidth
 == 0.0)

89 
löewidth
 = 0.0001;

94 i‡(
¨row
->
Àngth
 < 
MIN_ARROW_DIMENSION
 ||

95 
¨row
->
width
 < 
MIN_ARROW_DIMENSION
) {

96 
¨row_ty≥
 = 
ARROW_NONE
;

104 
¨row_ty≥
) {

105 
ARROW_LINES
:

106 
ARROW_HOLLOW_TRIANGLE
:

107 
ARROW_UNFILLED_TRIANGLE
:

108 
ARROW_FILLED_CONCAVE
:

109 
ARROW_BLANKED_CONCAVE
:

110 
ARROW_DOUBLE_HOLLOW_TRIANGLE
:

111 i‡(
¨row
->
width
 < 0.0000001) ;

112 
™gÀ
 = 
	`©™
(
¨row
->
Àngth
/◊ºow->
width
/2));

113 i‡(
™gÀ
 < 75*2*
G_PI
/360.0) {

114 
add_Àn
 = .5*
löewidth
/
	`cos
(
™gÀ
);

116 
add_Àn
 = 0;

119 *
move_¨row
 = *
to
;

120 
	`poöt_sub
(
move_¨row
, 
‰om
);

121 
	`poöt_n‹mÆize
(
move_¨row
);

122 
	`poöt_sˇÀ
(
move_¨row
, 
add_Àn
);

124 
ARROW_HALF_HEAD
:

125 i‡(
¨row
->
width
 < 0.0000001) ;

126 
™gÀ
 = 
	`©™
(
¨row
->
Àngth
/◊ºow->
width
/2));

127 i‡(
™gÀ
 < 60*2*
G_PI
/360.0) {

128 
add_Àn
 = 
löewidth
/
	`cos
(
™gÀ
);

130 
add_Àn
 = 0;

133 *
move_¨row
 = *
to
;

134 
	`poöt_sub
(
move_¨row
, 
‰om
);

135 
	`poöt_n‹mÆize
(
move_¨row
);

136 
	`poöt_sˇÀ
(
move_¨row
, 
add_Àn
);

138 
ARROW_FILLED_TRIANGLE
:

139 
ARROW_HOLLOW_ELLIPSE
:

140 
ARROW_ROUNDED
:

141 
ARROW_DIMENSION_ORIGIN
:

142 
ARROW_BLANKED_DOT
:

143 
ARROW_BLANKED_BOX
:

144 
add_Àn
 = .5*
löewidth
;

146 *
move_¨row
 = *
to
;

147 
	`poöt_sub
(
move_¨row
, 
‰om
);

148 
	`poöt_n‹mÆize
(
move_¨row
);

149 
	`poöt_sˇÀ
(
move_¨row
, 
add_Àn
);

151 
ARROW_ONE_EXACTLY
:

152 
ARROW_ONE_OR_NONE
:

153 
ARROW_ONE_OR_MANY
:

154 
ARROW_NONE_OR_MANY
:

156 
move_¨row
->
x
 = 0.0;

157 
move_¨row
->
y
 = 0.0;

162 
¨row_ty≥
) {

163 
ARROW_LINES
:

164 
ARROW_HALF_HEAD
:

165 *
move_löe
 = *
move_¨row
;

166 
	`poöt_sˇÀ
(
move_löe
, 2.0);

168 
ARROW_HOLLOW_TRIANGLE
:

169 
ARROW_UNFILLED_TRIANGLE
:

170 
ARROW_FILLED_TRIANGLE
:

171 
ARROW_FILLED_ELLIPSE
:

172 
ARROW_HOLLOW_ELLIPSE
:

173 
ARROW_ROUNDED
:

174 *
move_löe
 = *
move_¨row
;

175 
	`poöt_n‹mÆize
(
move_löe
);

176 
	`poöt_sˇÀ
(
move_löe
, 
¨row
->
Àngth
);

177 
	`poöt_add
(
move_löe
, 
move_¨row
);

179 
ARROW_HALF_DIAMOND
:

180 
ARROW_OPEN_ROUNDED
:

182 *
move_löe
 = *
to
;

183 
	`poöt_sub
(
move_löe
, 
‰om
);

184 
	`poöt_n‹mÆize
(
move_löe
);

185 
	`poöt_sˇÀ
(
move_löe
, 
¨row
->
Àngth
);

186 
	`poöt_add
(
move_löe
, 
move_¨row
);

188 
ARROW_HOLLOW_DIAMOND
:

189 
ARROW_FILLED_DIAMOND
:

191 *
move_löe
 = *
to
;

192 
	`poöt_sub
(
move_löe
, 
‰om
);

193 
	`poöt_n‹mÆize
(
move_löe
);

196 
tmp
 = *
move_löe
;

197 
	`poöt_sˇÀ
(
move_löe
, 
¨row
->
Àngth
);

198 
	`poöt_sˇÀ
(&
tmp
, 
G_SQRT2
*
löewidth
);

199 
	`poöt_sub
(
move_löe
, &
tmp
);

201 
ARROW_DIMENSION_ORIGIN
:

202 
ARROW_BLANKED_DOT
:

203 
ARROW_BLANKED_BOX
:

204 *
move_löe
 = *
move_¨row
;

205 
	`poöt_n‹mÆize
(
move_löe
);

206 
	`poöt_sˇÀ
(
move_löe
, .5*
¨row
->
Àngth
);

208 
ARROW_FILLED_DOT
:

209 
ARROW_FILLED_BOX
:

210 *
move_löe
 = *
to
;

211 
	`poöt_sub
(
move_löe
, 
‰om
);

212 
	`poöt_n‹mÆize
(
move_löe
);

213 
	`poöt_sˇÀ
(
move_löe
, .5*
¨row
->
Àngth
);

215 
ARROW_FILLED_CONCAVE
:

216 
ARROW_BLANKED_CONCAVE
:

217 *
move_löe
 = *
move_¨row
;

218 
	`poöt_n‹mÆize
(
move_löe
);

219 
	`poöt_sˇÀ
(
move_löe
, .75*
¨row
->
Àngth
);

220 
	`poöt_add
(
move_löe
, 
move_¨row
);

222 
ARROW_DOUBLE_HOLLOW_TRIANGLE
:

223 *
move_löe
 = *
move_¨row
;

224 
	`poöt_n‹mÆize
(
move_löe
);

225 
tmp
 = *
move_löe
;

226 
	`poöt_sˇÀ
(
move_löe
, 2.0*
¨row
->
Àngth
);

227 
	`poöt_add
(
move_löe
, 
move_¨row
);

228 
	`poöt_sˇÀ
(&
tmp
, 
löewidth
);

229 
	`poöt_add
(
move_löe
, &
tmp
);

231 
ARROW_DOUBLE_FILLED_TRIANGLE
:

232 *
move_löe
 = *
to
;

233 
	`poöt_sub
(
move_löe
, 
‰om
);

234 
	`poöt_n‹mÆize
(
move_löe
);

235 
	`poöt_sˇÀ
(
move_löe
, 2*
¨row
->
Àngth
);

237 
ARROW_FILLED_DOT_N_TRIANGLE
:

238 *
move_löe
 = *
to
;

239 
	`poöt_sub
(
move_löe
, 
‰om
);

240 
	`poöt_n‹mÆize
(
move_löe
);

241 
	`poöt_sˇÀ
(
move_löe
, 
¨row
->
Àngth
 +áºow->
width
);

243 
ARROW_THREE_DOTS
:

244 *
move_löe
 = *
to
;

245 
	`poöt_sub
(
move_löe
, 
‰om
);

246 
add_Àn
 = 
	`poöt_Àn
(
move_löe
);

247 
	`poöt_n‹mÆize
(
move_löe
);

248 i‡(
add_Àn
 > 4*
¨row
->
Àngth
)

249 
	`poöt_sˇÀ
(
move_löe
, 2*
¨row
->
Àngth
);

251 
	`poöt_sˇÀ
(
move_löe
, 
¨row
->
Àngth
);

253 
ARROW_SLASH_ARROW
:

254 
ARROW_INTEGRAL_SYMBOL
:

255 *
move_löe
 = *
to
;

256 
	`poöt_sub
(
move_löe
, 
‰om
);

257 
add_Àn
 = 
	`poöt_Àn
(
move_löe
);

258 
	`poöt_n‹mÆize
(
move_löe
);

259 
	`poöt_sˇÀ
(
move_löe
, 
¨row
->
Àngth
 / 2);

261 
ARROW_ONE_EXACTLY
:

262 
ARROW_ONE_OR_NONE
:

263 
ARROW_ONE_OR_MANY
:

264 
ARROW_NONE_OR_MANY
:

266 
move_¨row
->
x
 = 0.0;

267 
move_¨row
->
y
 = 0.0;

268 
move_löe
->
x
 = 0.0;

269 
move_löe
->
y
 = 0.0;

272 
	}
}

285 
	$ˇlcuœã_¨row
(
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

286 
ªÆ
 
Àngth
,Ñó»
width
)

288 
Poöt
 
dñè
;

289 
Poöt
 
‹th_dñè
;

290 
ªÆ
 
Àn
;

292 
dñè
 = *
to
;

293 
	`poöt_sub
(&
dñè
, 
‰om
);

294 
Àn
 = 
	`poöt_Àn
(&
dñè
);

295 i‡(
Àn
 <= 0.0001) {

296 
dñè
.
x
=1.0;

297 
dñè
.
y
=0.0;

299 
dñè
.
x
/=
Àn
;

300 
dñè
.
y
/=
Àn
;

303 
‹th_dñè
.
x
 = 
dñè
.
y
;

304 
‹th_dñè
.
y
 = -
dñè
.
x
;

306 
	`poöt_sˇÀ
(&
dñè
, 
Àngth
);

307 
	`poöt_sˇÀ
(&
‹th_dñè
, 
width
/2.0);

309 
pﬁy
[0] = *
to
;

310 
	`poöt_sub
(&
pﬁy
[0], &
dñè
);

311 
	`poöt_sub
(&
pﬁy
[0], &
‹th_dñè
);

312 
pﬁy
[1] = *
to
;

313 
pﬁy
[2] = *
to
;

314 
	`poöt_sub
(&
pﬁy
[2], &
dñè
);

315 
	`poöt_add
(&
pﬁy
[2], &
‹th_dñè
);

318 
	}
}

330 
	$ˇlcuœã_¸ow
(
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

331 
ªÆ
 
Àngth
,Ñó»
width
)

333 
Poöt
 
dñè
;

334 
Poöt
 
‹th_dñè
;

335 
ªÆ
 
Àn
;

337 
dñè
 = *
to
;

338 
	`poöt_sub
(&
dñè
, 
‰om
);

339 
Àn
 = 
	`poöt_Àn
(&
dñè
);

340 i‡(
Àn
 <= 0.0001) {

341 
dñè
.
x
=1.0;

342 
dñè
.
y
=0.0;

344 
dñè
.
x
/=
Àn
;

345 
dñè
.
y
/=
Àn
;

348 
‹th_dñè
.
x
 = 
dñè
.
y
;

349 
‹th_dñè
.
y
 = -
dñè
.
x
;

351 
	`poöt_sˇÀ
(&
dñè
, 
Àngth
);

352 
	`poöt_sˇÀ
(&
‹th_dñè
, 
width
/2.0);

354 
pﬁy
[0] = *
to
;

355 
	`poöt_sub
(&
pﬁy
[0], &
dñè
);

356 
pﬁy
[1] = *
to
;

357 
	`poöt_sub
(&
pﬁy
[1], &
‹th_dñè
);

358 
pﬁy
[2] = *
to
;

359 
	`poöt_add
(&
pﬁy
[2], &
‹th_dñè
);

362 
	}
}

377 
	$døw_n⁄e_‹_m™y
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

378 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

379 
Cﬁ‹
 *
fg_cﬁ‹
,Cﬁ‹ *
bg_cﬁ‹
)

381 
Poöt
 
£c⁄d_‰om
, 
£c⁄d_to
;

383 
	`døw_¸ow_foŸ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
,

384 
löewidth
, 
fg_cﬁ‹
, 
bg_cﬁ‹
);

386 
	`ˇlcuœã_doubÀ_¨row
(&
£c⁄d_to
, &
£c⁄d_‰om
, 
to
, 
‰om
, 
Àngth
);

389 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

390 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

391 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

392 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

394 
	`døw_em±y_ñlù£
(
ªndîî
, &
£c⁄d_to
, &
£c⁄d_‰om
, 
Àngth
/2,

395 
width
, 
löewidth
, 
fg_cﬁ‹
);

396 
	}
}

410 
	$døw_⁄e_exa˘ly
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

411 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

412 
Cﬁ‹
 *
fg_cﬁ‹
,Cﬁ‹ *
bg_cﬁ‹
)

414 
Poöt
 
vl
,
vt
;

415 
Poöt
 
bs
,
be
;

418 
	`poöt_c›y
(&
vl
,
‰om
); 
	`poöt_sub
(&vl,
to
);

419 i‡(
	`poöt_Àn
(&
vl
) > 0)

420 
	`poöt_n‹mÆize
(&
vl
);

422 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

424 i‡(!
	`föôe
(
vl
.
x
)) {

425 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

427 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

428 
	`poöt_c›y_add_sˇÀd
(&
bs
,
to
,&
vl
,
Àngth
/2);

429 
	`poöt_c›y_add_sˇÀd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

430 
	`poöt_add_sˇÀd
(&
bs
,&
vt
,
width
/2.0);

432 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî,&
bs
,&
be
,
fg_cﬁ‹
);

434 
	`poöt_c›y_add_sˇÀd
(&
bs
,
to
,&
vl
,
Àngth
);

436 
	`poöt_c›y_add_sˇÀd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

437 
	`poöt_add_sˇÀd
(&
bs
,&
vt
,
width
/2.0);

439 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî,&
bs
,&
be
,
fg_cﬁ‹
);

440 
	}
}

454 
	$døw_⁄e_‹_m™y
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

455 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

456 
Cﬁ‹
 *
fg_cﬁ‹
,Cﬁ‹ *
bg_cﬁ‹
)

459 
Poöt
 
pﬁy
[6];

461 
	`døw_¸ow_foŸ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
,

462 
löewidth
, 
fg_cﬁ‹
, 
bg_cﬁ‹
);

464 
	`ˇlcuœã_¨row
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

466 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

467 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

468 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

469 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

471 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
pﬁy
[0],&pﬁy[2], 
fg_cﬁ‹
);

472 
	}
}

486 
	$døw_⁄e_‹_n⁄e
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

487 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

488 
Cﬁ‹
 *
fg_cﬁ‹
,Cﬁ‹ *
bg_cﬁ‹
)

490 
Poöt
 
vl
,
vt
;

491 
Poöt
 
bs
,
be
;

492 
Poöt
 
£c⁄d_‰om
, 
£c⁄d_to
;

495 
	`poöt_c›y
(&
vl
,
‰om
); 
	`poöt_sub
(&vl,
to
);

496 i‡(
	`poöt_Àn
(&
vl
) > 0)

497 
	`poöt_n‹mÆize
(&
vl
);

499 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

501 i‡(!
	`föôe
(
vl
.
x
)) {

502 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

504 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

505 
	`poöt_c›y_add_sˇÀd
(&
bs
,
to
,&
vl
,
Àngth
/2);

506 
	`poöt_c›y_add_sˇÀd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

507 
	`poöt_add_sˇÀd
(&
bs
,&
vt
,
width
/2.0);

509 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî,&
bs
,&
be
,
fg_cﬁ‹
);

511 
	`ˇlcuœã_doubÀ_¨row
(&
£c⁄d_to
, &
£c⁄d_‰om
, 
to
, 
‰om
, 
Àngth
);

512 
	`døw_em±y_ñlù£
(
ªndîî
, &
£c⁄d_to
, &
£c⁄d_‰om
, 
Àngth
/2, 
width
, 
löewidth
, 
fg_cﬁ‹
);

513 
	}
}

526 
	$døw_¸ow_foŸ
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

527 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

528 
Cﬁ‹
 *
fg_cﬁ‹
,Cﬁ‹ *
bg_cﬁ‹
)

531 
Poöt
 
pﬁy
[3];

533 
	`ˇlcuœã_¸ow
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

535 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

536 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

537 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

539 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî,&
pﬁy
[0],&pﬁy[1],
fg_cﬁ‹
);

540 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî,&
pﬁy
[0],&pﬁy[2],
fg_cﬁ‹
);

541 
	}
}

553 
	$døw_löes
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

554 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

555 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

557 
Poöt
 
pﬁy
[3];

559 
	`ˇlcuœã_¨row
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

561 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

562 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

563 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

564 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

566 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁylöe
‘ídîî, 
pﬁy
, 3, 
fg_cﬁ‹
);

567 
	}
}

570 
	$ˇlcuœã_ñlù£
 (
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

571 
ªÆ
 
Àngth
,Ñó»
width
)

573  
	`ˇlcuœã_düm⁄d
 (
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

574 
	}
}

589 
	$døw_fûl_ñlù£
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

590 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

591 
Cﬁ‹
 *
fg_cﬁ‹
,Cﬁ‹ *
bg_cﬁ‹
)

593 
BezPoöt
 
bp
[5];

594 
Poöt
 
vl
,
vt
;

596 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

597 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

598 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

599 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

601 i‡(!
bg_cﬁ‹
) {

604 
Àngth
 +
löewidth
;

605 
width
 +
löewidth
;

607 
	`poöt_c›y
(&
vl
,
‰om
); 
	`poöt_sub
(&vl,
to
);

608 i‡(
	`poöt_Àn
(&
vl
) > 0)

609 
	`poöt_n‹mÆize
(&
vl
);

611 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

613 i‡(!
	`föôe
(
vl
.
x
)) {

614 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

616 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

620 
bp
[0].
ty≥
 = 
BEZ_MOVE_TO
;

621 
	`poöt_c›y
(&
bp
[0].
p1
,
to
);

622 
bp
[1].
ty≥
 = bp[2].ty≥ = bp[3].ty≥ = bp[4].ty≥ = 
BEZ_CURVE_TO
;

623 
	`poöt_c›y
(&
bp
[4].
p3
,&bp[0].
p1
);

625 
	`poöt_c›y_add_sˇÀd
(&
bp
[2].
p3
,&bp[0].
p1
,&
vl
,
Àngth
);

626 
	`poöt_c›y_add_sˇÀd
(&
bp
[2].
p2
,&bp[2].
p3
,&
vt
,-
width
 / 4.0);

627 
	`poöt_c›y_add_sˇÀd
(&
bp
[3].
p1
,&bp[2].
p3
,&
vt
,
width
 / 4.0);

628 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p1
,&bp[0].p1,&
vt
,-
width
 / 4.0);

629 
	`poöt_c›y_add_sˇÀd
(&
bp
[4].
p2
,&bp[0].
p1
,&
vt
,
width
 / 4.0);

630 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p3
,&bp[0].
p1
,&
vl
,
Àngth
 / 2.0);

631 
	`poöt_c›y_add_sˇÀd
(&
bp
[3].
p3
,&bp[1].p3,&
vt
,
width
 / 2.0);

632 
	`poöt_add_sˇÀd
(&
bp
[1].
p3
,&
vt
,-
width
 / 2.0);

633 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p2
,&bp[1].
p3
,&
vl
,-
Àngth
 / 4.0);

634 
	`poöt_c›y_add_sˇÀd
(&
bp
[4].
p1
,&bp[3].
p3
,&
vl
,-
Àngth
 / 4.0);

635 
	`poöt_c›y_add_sˇÀd
(&
bp
[2].
p1
,&bp[1].
p3
,&
vl
,
Àngth
 / 4.0);

636 
	`poöt_c›y_add_sˇÀd
(&
bp
[3].
p2
,&bp[3].
p3
,&
vl
,
Àngth
 / 4.0);

637 i‡(
bg_cﬁ‹
) {

638 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_bezõr
‘ídîî,
bp
,(bp)/(bp[0]),
bg_cﬁ‹
);

639 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_bezõr
‘ídîî,
bp
,(bp)/(bp[0]),
fg_cﬁ‹
);

641 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_bezõr
‘ídîî,
bp
,(bp)/(bp[0]),
fg_cﬁ‹
);

643 
	}
}

655 
	$døw_em±y_ñlù£
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

656 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

657 
Cﬁ‹
 *
fg_cﬁ‹
)

659 
BezPoöt
 
bp
[5];

660 
Poöt
 
vl
,
vt
;

661 
Poöt
 
di•
;

663 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

664 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

665 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

666 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

668 
	`poöt_c›y
(&
vl
,
‰om
);

669 
	`poöt_sub
(&
vl
,
to
);

670 i‡(
	`poöt_Àn
(&
vl
) > 0)

671 
	`poöt_n‹mÆize
(&
vl
);

673 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

675 i‡(!
	`föôe
(
vl
.
x
)) {

676 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

679 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

681 
	`poöt_c›y
(&
di•
, &
vl
);

682 
di•
.
x
 *
Àngth
/2;

683 
di•
.
y
 *
Àngth
/2;

686 
bp
[0].
ty≥
 = 
BEZ_MOVE_TO
;

687 
	`poöt_c›y
(&
bp
[0].
p1
,
to
);

688 
	`poöt_add
(&
bp
[0].
p1
,&
di•
);

689 
bp
[1].
ty≥
 = bp[2].ty≥ = bp[3].ty≥ = bp[4].ty≥ = 
BEZ_CURVE_TO
;

690 
	`poöt_c›y
(&
bp
[4].
p3
,&bp[0].
p1
);

692 
	`poöt_c›y_add_sˇÀd
(&
bp
[2].
p3
,&bp[0].
p1
,&
vl
,
Àngth
);

693 
	`poöt_c›y_add_sˇÀd
(&
bp
[2].
p2
,&bp[2].
p3
,&
vt
,-
width
 / 4.0);

694 
	`poöt_c›y_add_sˇÀd
(&
bp
[3].
p1
,&bp[2].
p3
,&
vt
,
width
 / 4.0);

695 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p1
,&bp[0].p1,&
vt
,-
width
 / 4.0);

696 
	`poöt_c›y_add_sˇÀd
(&
bp
[4].
p2
,&bp[0].
p1
,&
vt
,
width
 / 4.0);

697 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p3
,&bp[0].
p1
,&
vl
,
Àngth
 / 2.0);

698 
	`poöt_c›y_add_sˇÀd
(&
bp
[3].
p3
,&bp[1].p3,&
vt
,
width
 / 2.0);

699 
	`poöt_add_sˇÀd
(&
bp
[1].
p3
,&
vt
,-
width
 / 2.0);

700 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p2
,&bp[1].
p3
,&
vl
,-
Àngth
 / 4.0);

701 
	`poöt_c›y_add_sˇÀd
(&
bp
[4].
p1
,&bp[3].
p3
,&
vl
,-
Àngth
 / 4.0);

702 
	`poöt_c›y_add_sˇÀd
(&
bp
[2].
p1
,&bp[1].
p3
,&
vl
,
Àngth
 / 4.0);

703 
	`poöt_c›y_add_sˇÀd
(&
bp
[3].
p2
,&bp[3].
p3
,&
vl
,
Àngth
 / 4.0);

705 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_bezõr
‘ídîî,
bp
,(bp)/(bp[0]),
fg_cﬁ‹
);

706 
	}
}

709 
	$ˇlcuœã_box
 (
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

710 
ªÆ
 
Àngth
,Ñó»
width
)

712 
Poöt
 
vl
, 
vt
;

713 
Poöt
 
bs
, 
be
;

715 
	`poöt_c›y
(&
vl
,
‰om
); 
	`poöt_sub
(&vl,
to
);

716 i‡(
	`poöt_Àn
(&
vl
) > 0)

717 
	`poöt_n‹mÆize
(&
vl
);

719 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

721 i‡(!
	`föôe
(
vl
.
x
)) {

722 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

724 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

726 
	`poöt_c›y_add_sˇÀd
(&
bs
,
to
,&
vl
,
Àngth
/4);

727 
	`poöt_c›y_add_sˇÀd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

728 
	`poöt_add_sˇÀd
(&
bs
,&
vt
,
width
/2.0);

730 
	`poöt_c›y
(&
pﬁy
[0],
to
);

731 
	`poöt_c›y
(&
pﬁy
[1],&poly[0]);

732 
	`poöt_add_sˇÀd
(&
pﬁy
[0],&
vt
,
width
/4.0);

733 
	`poöt_add_sˇÀd
(&
pﬁy
[1],&
vt
,-
width
/4.0);

734 
	`poöt_c›y_add_sˇÀd
(&
pﬁy
[2],&pﬁy[1],&
vl
,
Àngth
/2.0);

735 
	`poöt_c›y_add_sˇÀd
(&
pﬁy
[3],&pﬁy[0],&
vl
,
Àngth
/2.0);

737 
pﬁy
[4] = 
bs
;

738 
pﬁy
[5] = 
be
;

741 
	}
}

755 
	$døw_fûl_box
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

756 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

757 
Cﬁ‹
 *
fg_cﬁ‹
,Cﬁ‹ *
bg_cﬁ‹
)

759 
Poöt
 
pﬁy
[6];

760 
ªÆ
 
lw_Á˘‹
,
˛ígth
,
cwidth
;

762 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

763 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

764 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

765 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

767 i‡(
fg_cﬁ‹
 =
bg_cﬁ‹
) {

769 
lw_Á˘‹
 = 
löewidth
;

772 
lw_Á˘‹
 = 0.0;

774 
˛ígth
 = 
Àngth
 + 
lw_Á˘‹
;

775 
cwidth
 = 
width
 + 
lw_Á˘‹
;

777 
	`ˇlcuœã_box
 (
pﬁy
, 
to
, 
‰om
, 
˛ígth
, 
cwidth
);

779 i‡(
fg_cﬁ‹
 =
bg_cﬁ‹
) {

780 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_pﬁyg⁄
‘ídîî, 
pﬁy
, 4, 
fg_cﬁ‹
);

782 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_pﬁyg⁄
‘ídîî, 
pﬁy
, 4, 
bg_cﬁ‹
);

783 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁyg⁄
‘ídîî, 
pﬁy
, 4, 
fg_cﬁ‹
);

785 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî,&
pﬁy
[4],&pﬁy[5],
fg_cﬁ‹
);

786 
	}
}

788 
	$ˇlcuœã_dŸ
 (
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

789 
ªÆ
 
Àngth
,Ñó»
width
)

791  
	`ˇlcuœã_düm⁄d
 (
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

792 
	}
}

805 
	$døw_fûl_dŸ
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

806 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

807 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

809 
BezPoöt
 
bp
[5];

810 
Poöt
 
vl
,
vt
;

811 
Poöt
 
bs
,
be
;

812 
ªÆ
 
lw_Á˘‹
,
˛ígth
,
cwidth
;

814 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

815 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

816 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

817 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

819 i‡(
fg_cﬁ‹
 =
bg_cﬁ‹
) {

821 
lw_Á˘‹
 = 
löewidth
;

824 
lw_Á˘‹
 = 0.0;

826 
˛ígth
 = 
Àngth
 + 
lw_Á˘‹
;

827 
cwidth
 = 
width
 + 
lw_Á˘‹
;

829 
	`poöt_c›y
(&
vl
,
‰om
); 
	`poöt_sub
(&vl,
to
);

830 i‡(
	`poöt_Àn
(&
vl
) > 0)

831 
	`poöt_n‹mÆize
(&
vl
);

833 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

835 i‡(!
	`föôe
(
vl
.
x
)) {

836 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

838 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

840 
	`poöt_c›y_add_sˇÀd
(&
bs
,
to
,&
vl
,
Àngth
/4);

841 
	`poöt_c›y_add_sˇÀd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

842 
	`poöt_add_sˇÀd
(&
bs
,&
vt
,
width
/2.0);

845 
bp
[0].
ty≥
 = 
BEZ_MOVE_TO
;

846 
	`poöt_c›y
(&
bp
[0].
p1
,
to
);

847 
bp
[1].
ty≥
 = bp[2].ty≥ = bp[3].ty≥ = bp[4].ty≥ = 
BEZ_CURVE_TO
;

848 
	`poöt_c›y
(&
bp
[4].
p3
,&bp[0].
p1
);

850 
	`poöt_c›y_add_sˇÀd
(&
bp
[2].
p3
,&bp[0].
p1
,&
vl
,
˛ígth
/2);

851 
	`poöt_c›y_add_sˇÀd
(&
bp
[2].
p2
,&bp[2].
p3
,&
vt
,-
cwidth
 / 8.0);

852 
	`poöt_c›y_add_sˇÀd
(&
bp
[3].
p1
,&bp[2].
p3
,&
vt
,
cwidth
 / 8.0);

853 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p1
,&bp[0].p1,&
vt
,-
cwidth
 / 8.0);

854 
	`poöt_c›y_add_sˇÀd
(&
bp
[4].
p2
,&bp[0].
p1
,&
vt
,
cwidth
 / 8.0);

855 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p3
,&bp[0].
p1
,&
vl
,
˛ígth
 / 4.0);

856 
	`poöt_c›y_add_sˇÀd
(&
bp
[3].
p3
,&bp[1].p3,&
vt
,
cwidth
 / 4.0);

857 
	`poöt_add_sˇÀd
(&
bp
[1].
p3
,&
vt
,-
cwidth
 / 4.0);

858 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p2
,&bp[1].
p3
,&
vl
,-
˛ígth
 / 8.0);

859 
	`poöt_c›y_add_sˇÀd
(&
bp
[4].
p1
,&bp[3].
p3
,&
vl
,-
˛ígth
 / 8.0);

860 
	`poöt_c›y_add_sˇÀd
(&
bp
[2].
p1
,&bp[1].
p3
,&
vl
,
˛ígth
 / 8.0);

861 
	`poöt_c›y_add_sˇÀd
(&
bp
[3].
p2
,&bp[3].
p3
,&
vl
,
˛ígth
 / 8.0);

863 i‡(!
bg_cﬁ‹
) {

865 
Poöt
 
dos
,
d€
;

867 
	`poöt_c›y_add_sˇÀd
(&
d€
,
to
,&
vl
,
Àngth
);

868 
	`poöt_c›y_add_sˇÀd
(&
dos
,
to
,&
vl
,
Àngth
/2);

870 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî,&
dos
,&
d€
,
fg_cﬁ‹
);

872 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_bezõr
‘ídîî,
bp
,(bp)/(bp[0]),
bg_cﬁ‹
);

874 i‡(
fg_cﬁ‹
 !
bg_cﬁ‹
) {

875 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_bezõr
‘ídîî,
bp
,(bp)/(bp[0]),
fg_cﬁ‹
);

877 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî,&
bs
,&
be
,
fg_cﬁ‹
);

878 
	}
}

893 
	$døw_öãgøl
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

894 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

895 
Cﬁ‹
 *
fg_cﬁ‹
)

897 
BezPoöt
 
bp
[2];

898 
Poöt
 
vl
,
vt
;

899 
Poöt
 
bs
,
be
, 
bs2
,
be2
;

900 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

901 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

902 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

903 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

905 
	`poöt_c›y
(&
vl
,
‰om
); 
	`poöt_sub
(&vl,
to
);

906 i‡(
	`poöt_Àn
(&
vl
) > 0)

907 
	`poöt_n‹mÆize
(&
vl
);

909 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

911 i‡(!
	`föôe
(
vl
.
x
)) {

912 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

914 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

916 
	`poöt_c›y_add_sˇÀd
(&
bs
,
to
,&
vl
,
Àngth
/2);

917 
	`poöt_c›y_add_sˇÀd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

918 
	`poöt_add_sˇÀd
(&
bs
,&
vt
,
width
/2.0);

920 
	`poöt_c›y_add_sˇÀd
(&
bs2
,
to
,&
vl
,
Àngth
/2);

921 
	`poöt_c›y_add_sˇÀd
(&
be2
,&
bs2
,&
vl
,
Àngth
/2);

923 
bp
[0].
ty≥
 = 
BEZ_MOVE_TO
;

924 
bp
[1].
ty≥
 = 
BEZ_CURVE_TO
;

925 
	`poöt_c›y_add_sˇÀd
(&
bp
[0].
p1
,
to
,&
vl
,.1*
Àngth
);

926 
	`poöt_add_sˇÀd
(&
bp
[0].
p1
,&
vt
,.4*
width
);

927 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p3
,
to
,&
vl
,.9*
Àngth
);

928 
	`poöt_add_sˇÀd
(&
bp
[1].
p3
,&
vt
,-.4*
width
);

929 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p1
,&bp[0].p1,&
vl
,.35*
Àngth
);

930 
	`poöt_c›y_add_sˇÀd
(&
bp
[1].
p2
,&bp[1].
p3
,&
vl
,-.35*
Àngth
);

932 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
bs2
, &
be2
, 
fg_cﬁ‹
);

933 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
bs
, &
be
, 
fg_cﬁ‹
);

934 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_bezõr
‘ídîî,
bp
,(bp)/(bp[0]),
fg_cﬁ‹
);

935 
	}
}

937 
	$ˇlcuœã_¶ashed
 (
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

938 
ªÆ
 
Àngth
,Ñó»
width
)

940 
Poöt
 
vl
,
vt
;

942 
	`poöt_c›y
(&
vl
,
‰om
);

943 
	`poöt_sub
(&
vl
,
to
);

944 i‡(
	`poöt_Àn
(&
vl
) > 0)

945 
	`poöt_n‹mÆize
(&
vl
);

947 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

949 i‡(!
	`föôe
(
vl
.
x
)) {

950 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

952 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

954 
	`poöt_c›y_add_sˇÀd
(&
pﬁy
[2],
to
,&
vl
,
Àngth
/2);

955 
	`poöt_c›y_add_sˇÀd
(&
pﬁy
[3],&pﬁy[2],&
vt
,-
width
/2.0);

956 
	`poöt_add_sˇÀd
(&
pﬁy
[2],&
vt
,
width
/2.0);

958 
	`poöt_c›y_add_sˇÀd
(&
pﬁy
[0],
to
,&
vl
,
Àngth
/2);

959 
	`poöt_c›y_add_sˇÀd
(&
pﬁy
[1],&pﬁy[0],&
vl
,
Àngth
/2);

961 
	`poöt_c›y_add_sˇÀd
(&
pﬁy
[4],
to
,&
vl
,.1*
Àngth
);

962 
	`poöt_add_sˇÀd
(&
pﬁy
[4],&
vt
,.4*
width
);

963 
	`poöt_c›y_add_sˇÀd
(&
pﬁy
[5],
to
,&
vl
,.9*
Àngth
);

964 
	`poöt_add_sˇÀd
(&
pﬁy
[5],&
vt
,-.4*
width
);

967 
	}
}

982 
	$døw_¶ashed
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

983 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

984 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

986 
Poöt
 
pﬁy
[6];

988 
	`ˇlcuœã_¶ashed
 (
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

990 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

991 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

992 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

993 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

995 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
pﬁy
[0], &pﬁy[1], 
fg_cﬁ‹
);

996 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
pﬁy
[2], &pﬁy[3], 
fg_cﬁ‹
);

997 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
pﬁy
[4], &pﬁy[5], 
fg_cﬁ‹
);

998 
	}
}

1010 
	$ˇlcuœã_hÆfhód
(
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

1011 
ªÆ
 
Àngth
,Ñó»
width
)

1013 
Poöt
 
dñè
;

1014 
Poöt
 
‹th_dñè
;

1015 
ªÆ
 
Àn
;

1016 
ªÆ
 
™gÀ
;

1018 i‡(
width
 > 0.0000001) {

1019 
™gÀ
 = 
	`©™
(
Àngth
/(
width
/2));

1021 
™gÀ
 = 0;

1024 
dñè
 = *
to
;

1025 
	`poöt_sub
(&
dñè
, 
‰om
);

1026 
Àn
 = 
	`poöt_Àn
(&
dñè
);

1027 i‡(
Àn
 <= 0.0001) {

1028 
dñè
.
x
=1.0;

1029 
dñè
.
y
=0.0;

1031 
dñè
.
x
/=
Àn
;

1032 
dñè
.
y
/=
Àn
;

1035 
‹th_dñè
.
x
 = 
dñè
.
y
;

1036 
‹th_dñè
.
y
 = -
dñè
.
x
;

1038 
	`poöt_sˇÀ
(&
dñè
, 
Àngth
);

1039 
	`poöt_sˇÀ
(&
‹th_dñè
, 
width
/2.0);

1041 
pﬁy
[0] = *
to
;

1042 
	`poöt_sub
(&
pﬁy
[0], &
dñè
);

1043 
	`poöt_sub
(&
pﬁy
[0], &
‹th_dñè
);

1044 
pﬁy
[1] = *
to
;

1045 
pﬁy
[2] = *
to
;

1046 
	`poöt_n‹mÆize
(&
dñè
);

1047 
	`poöt_sˇÀ
(&
dñè
, 0);

1048 
	`poöt_sub
(&
pﬁy
[2], &
dñè
);

1051 
	}
}

1063 
	$døw_hÆfhód
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1064 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1065 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1067 
Poöt
 
pﬁy
[3];

1069 
	`ˇlcuœã_hÆfhód
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1071 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1072 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1073 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1074 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1076 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁylöe
‘ídîî, 
pﬁy
, 3, 
fg_cﬁ‹
);

1077 
	}
}

1089 
	$døw_åüngÀ
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1090 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1091 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1093 
Poöt
 
pﬁy
[3];

1095 
	`ˇlcuœã_¨row
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1097 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1098 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1099 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1101 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁyg⁄
‘ídîî, 
pﬁy
, 3, 
fg_cﬁ‹
);

1102 
	}
}

1114 
	$fûl_åüngÀ
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1115 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1116 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1118 
Poöt
 
pﬁy
[3];

1120 
	`ˇlcuœã_¨row
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1122 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_fûl°yÀ
‘ídîî, 
FILLSTYLE_SOLID
);

1123 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1125 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_pﬁyg⁄
‘ídîî, 
pﬁy
, 3, 
bg_cﬁ‹
);

1126 
	}
}

1140 
	$ˇlcuœã_düm⁄d
(
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

1141 
ªÆ
 
Àngth
,Ñó»
width
)

1143 
Poöt
 
dñè
;

1144 
Poöt
 
‹th_dñè
;

1145 
ªÆ
 
Àn
;

1147 
dñè
 = *
to
;

1148 
	`poöt_sub
(&
dñè
, 
‰om
);

1149 
Àn
 = 
	`sqπ
(
	`poöt_dŸ
(&
dñè
, &delta));

1150 i‡(
Àn
 <= 0.0001) {

1151 
dñè
.
x
=1.0;

1152 
dñè
.
y
=0.0;

1154 
dñè
.
x
/=
Àn
;

1155 
dñè
.
y
/=
Àn
;

1158 
‹th_dñè
.
x
 = 
dñè
.
y
;

1159 
‹th_dñè
.
y
 = -
dñè
.
x
;

1161 
	`poöt_sˇÀ
(&
dñè
, 
Àngth
/2.0);

1162 
	`poöt_sˇÀ
(&
‹th_dñè
, 
width
/2.0);

1164 
pﬁy
[0] = *
to
;

1165 
pﬁy
[1] = *
to
;

1166 
	`poöt_sub
(&
pﬁy
[1], &
dñè
);

1167 
	`poöt_sub
(&
pﬁy
[1], &
‹th_dñè
);

1168 
pﬁy
[2] = *
to
;

1169 
	`poöt_sub
(&
pﬁy
[2], &
dñè
);

1170 
	`poöt_sub
(&
pﬁy
[2], &
dñè
);

1171 
pﬁy
[3] = *
to
;

1172 
	`poöt_sub
(&
pﬁy
[3], &
dñè
);

1173 
	`poöt_add
(&
pﬁy
[3], &
‹th_dñè
);

1176 
	}
}

1188 
	$døw_düm⁄d
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1189 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1190 
Cﬁ‹
 *
cﬁ‹
)

1192 
Poöt
 
pﬁy
[4];

1194 
	`ˇlcuœã_düm⁄d
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1196 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1197 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1198 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1199 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1201 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁyg⁄
‘ídîî, 
pﬁy
, 4, 
cﬁ‹
);

1202 
	}
}

1214 
	$døw_hÆf_düm⁄d
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1215 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1216 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1218 
Poöt
 
pﬁy
[4];

1220 
	`ˇlcuœã_düm⁄d
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1222 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1223 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1224 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1225 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1227 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁylöe
‘ídîî, 
pﬁy
+1, 3, 
fg_cﬁ‹
);

1228 
	}
}

1239 
	$fûl_düm⁄d
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1240 
ªÆ
 
Àngth
,Ñó»
width
,

1241 
Cﬁ‹
 *
cﬁ‹
)

1243 
Poöt
 
pﬁy
[4];

1245 
	`ˇlcuœã_düm⁄d
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1247 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1248 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1249 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1251 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_pﬁyg⁄
‘ídîî, 
pﬁy
, 4, 
cﬁ‹
);

1252 
	}
}

1263 
	$ˇlcuœã_¶ashed_¸oss
(
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

1264 
ªÆ
 
Àngth
,Ñó»
width
)

1266 
Poöt
 
dñè
;

1267 
Poöt
 
‹th_dñè
;

1268 
ªÆ
 
Àn
;

1269 
i
;

1271 
dñè
 = *
to
;

1272 
	`poöt_sub
(&
dñè
, 
‰om
);

1273 
Àn
 = 
	`sqπ
(
	`poöt_dŸ
(&
dñè
, &delta));

1274 i‡(
Àn
 <= 0.0001) {

1275 
dñè
.
x
=1.0;

1276 
dñè
.
y
=0.0;

1278 
dñè
.
x
/=
Àn
;

1279 
dñè
.
y
/=
Àn
;

1282 
‹th_dñè
.
x
 = 
dñè
.
y
;

1283 
‹th_dñè
.
y
 = -
dñè
.
x
;

1285 
	`poöt_sˇÀ
(&
dñè
, 
Àngth
/2.0);

1286 
	`poöt_sˇÀ
(&
‹th_dñè
, 
width
/2.0);

1288 
i
=0; i<6;i++)
pﬁy
[i] = *
to
;

1290 
	`poöt_add
(&
pﬁy
[1], &
dñè
);

1292 
	`poöt_add
(&
pﬁy
[2], &
dñè
);

1293 
	`poöt_add
(&
pﬁy
[2], &
‹th_dñè
);

1295 
	`poöt_sub
(&
pﬁy
[3], &
dñè
);

1296 
	`poöt_sub
(&
pﬁy
[3], &
‹th_dñè
);

1298 
	`poöt_add
(&
pﬁy
[4], &
‹th_dñè
);

1299 
	`poöt_sub
(&
pﬁy
[5], &
‹th_dñè
);

1302 
	}
}

1314 
	$døw_¶ashed_¸oss
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1315 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1316 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1318 
Poöt
 
pﬁy
[6];

1320 
	`ˇlcuœã_¶ashed_¸oss
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1322 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1323 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1324 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1325 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1327 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
pﬁy
[0],&pﬁy[1], 
fg_cﬁ‹
);

1328 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
pﬁy
[2],&pﬁy[3], 
fg_cﬁ‹
);

1329 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
pﬁy
[4],&pﬁy[5], 
fg_cﬁ‹
);

1330 
	}
}

1332 
	$ˇlcuœã_back¶ash
 (
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

1333 
ªÆ
 
Àngth
,Ñó»
width
)

1335 
Poöt
 
dñè
;

1336 
Poöt
 
‹th_dñè
;

1337 
ªÆ
 
Àn
;

1339 
dñè
 = *
to
;

1340 
	`poöt_sub
(&
dñè
, 
‰om
);

1341 
Àn
 = 
	`sqπ
(
	`poöt_dŸ
(&
dñè
, &delta));

1342 i‡(
Àn
 <= 0.0001) {

1343 
dñè
.
x
=1.0;

1344 
dñè
.
y
=0.0;

1346 
dñè
.
x
/=
Àn
;

1347 
dñè
.
y
/=
Àn
;

1350 
‹th_dñè
.
x
 = 
dñè
.
y
;

1351 
‹th_dñè
.
y
 = -
dñè
.
x
;

1353 
	`poöt_sˇÀ
(&
dñè
, 
Àngth
/2.0);

1354 
	`poöt_sˇÀ
(&
‹th_dñè
, 
width
/2.0);

1356 
pﬁy
[0] = *
to
;

1357 
	`poöt_sub
(&
pﬁy
[0], &
dñè
);

1358 
	`poöt_sub
(&
pﬁy
[0], &
dñè
);

1359 
	`poöt_sub
(&
pﬁy
[0], &
dñè
);

1360 
	`poöt_add
(&
pﬁy
[0], &
‹th_dñè
);

1362 
pﬁy
[1] = *
to
;

1363 
	`poöt_sub
(&
pﬁy
[1], &
dñè
);

1364 
	`poöt_sub
(&
pﬁy
[1], &
‹th_dñè
);

1367 
	}
}

1378 
	$døw_back¶ash
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1379 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1380 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1382 
Poöt
 
pﬁy
[2];

1384 
	`ˇlcuœã_back¶ash
 (
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1386 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1387 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1388 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1389 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1391 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
pﬁy
[0], &pﬁy[1], 
fg_cﬁ‹
);

1392 
	}
}

1404 
	$døw_¸oss
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1405 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1406 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1408 
Poöt
 
pﬁy
[6];

1410 
	`ˇlcuœã_¨row
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1412 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1413 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1414 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1415 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1417 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
pﬁy
[0],&pﬁy[2], 
fg_cﬁ‹
);

1419 
	}
}

1431 
	$ˇlcuœã_doubÀ_¨row
(
Poöt
 *
£c⁄d_to
, Poöà*
£c⁄d_‰om
,

1432 c⁄° 
Poöt
 *
to
, c⁄° Poöà*
‰om
, 
ªÆ
 
Àngth
)

1434 
Poöt
 
dñè
;

1435 
ªÆ
 
Àn
;

1437 
dñè
 = *
to
;

1438 
	`poöt_sub
(&
dñè
, 
‰om
);

1439 
Àn
 = 
	`sqπ
(
	`poöt_dŸ
(&
dñè
, &delta));

1440 i‡(
Àn
 <= 0.0001) {

1441 
dñè
.
x
=1.0;

1442 
dñè
.
y
=0.0;

1444 
dñè
.
x
/=
Àn
;

1445 
dñè
.
y
/=
Àn
;

1448 
	`poöt_sˇÀ
(&
dñè
, 
Àngth
/2);

1450 *
£c⁄d_to
 = *
to
;

1451 
	`poöt_sub
(
£c⁄d_to
, &
dñè
);

1452 
	`poöt_sub
(
£c⁄d_to
, &
dñè
);

1453 *
£c⁄d_‰om
 = *
‰om
;

1454 
	`poöt_add
(
£c⁄d_‰om
, &
dñè
);

1455 
	`poöt_add
(
£c⁄d_‰om
, &
dñè
);

1456 
	}
}

1468 
	$døw_doubÀ_åüngÀ
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1469 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1470 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1472 
Poöt
 
£c⁄d_‰om
, 
£c⁄d_to
;

1474 
	`døw_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
, 
bg_cﬁ‹
);

1475 
	`ˇlcuœã_doubÀ_¨row
(&
£c⁄d_to
, &
£c⁄d_‰om
, 
to
, 
‰om
, 
Àngth
+
löewidth
);

1476 
	`døw_åüngÀ
(
ªndîî
, &
£c⁄d_to
, &
£c⁄d_‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
, 
bg_cﬁ‹
);

1477 
	}
}

1489 
	$fûl_doubÀ_åüngÀ
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1490 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1491 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1493 
Poöt
 
£c⁄d_‰om
, 
£c⁄d_to
;

1495 
	`fûl_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
NULL
, 
bg_cﬁ‹
);

1496 
	`ˇlcuœã_doubÀ_¨row
(&
£c⁄d_to
, &
£c⁄d_‰om
, 
to
, 
‰om
, 
Àngth
);

1497 
	`fûl_åüngÀ
(
ªndîî
, &
£c⁄d_to
, &
£c⁄d_‰om
, 
Àngth
, 
width
, 
löewidth
, 
NULL
, 
bg_cﬁ‹
);

1498 
	}
}

1512 
	$ˇlcuœã_c⁄ˇve
(
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

1513 
ªÆ
 
Àngth
,Ñó»
width
)

1515 
Poöt
 
dñè
;

1516 
Poöt
 
‹th_dñè
;

1517 
ªÆ
 
Àn
;

1519 
dñè
 = *
to
;

1520 
	`poöt_sub
(&
dñè
, 
‰om
);

1521 
Àn
 = 
	`sqπ
(
	`poöt_dŸ
(&
dñè
, &delta));

1522 i‡(
Àn
 <= 0.0001) {

1523 
dñè
.
x
=1.0;

1524 
dñè
.
y
=0.0;

1526 
dñè
.
x
/=
Àn
;

1527 
dñè
.
y
/=
Àn
;

1530 
‹th_dñè
.
x
 = 
dñè
.
y
;

1531 
‹th_dñè
.
y
 = -
dñè
.
x
;

1533 
	`poöt_sˇÀ
(&
dñè
, 
Àngth
/4.0);

1534 
	`poöt_sˇÀ
(&
‹th_dñè
, 
width
/2.0);

1536 
pﬁy
[0] = *
to
;

1537 
pﬁy
[1] = *
to
;

1538 
	`poöt_sub
(&
pﬁy
[1], &
dñè
);

1539 
	`poöt_sub
(&
pﬁy
[1], &
dñè
);

1540 
	`poöt_sub
(&
pﬁy
[1], &
dñè
);

1541 
	`poöt_sub
(&
pﬁy
[1], &
dñè
);

1542 
	`poöt_sub
(&
pﬁy
[1], &
‹th_dñè
);

1543 
pﬁy
[2] = *
to
;

1544 
	`poöt_sub
(&
pﬁy
[2], &
dñè
);

1545 
	`poöt_sub
(&
pﬁy
[2], &
dñè
);

1546 
	`poöt_sub
(&
pﬁy
[2], &
dñè
);

1547 
pﬁy
[3] = *
to
;

1548 
	`poöt_add
(&
pﬁy
[3], &
‹th_dñè
);

1549 
	`poöt_sub
(&
pﬁy
[3], &
dñè
);

1550 
	`poöt_sub
(&
pﬁy
[3], &
dñè
);

1551 
	`poöt_sub
(&
pﬁy
[3], &
dñè
);

1552 
	`poöt_sub
(&
pﬁy
[3], &
dñè
);

1555 
	}
}

1568 
	$døw_c⁄ˇve_åüngÀ
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1569 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1570 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1572 
Poöt
 
pﬁy
[4];

1574 
	`ˇlcuœã_c⁄ˇve
(
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1576 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1577 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1578 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1580 i‡(
fg_cﬁ‹
 =
bg_cﬁ‹
)

1581 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_pﬁyg⁄
‘ídîî, 
pﬁy
, 4, 
bg_cﬁ‹
);

1582 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁyg⁄
‘ídîî, 
pﬁy
, 4, 
fg_cﬁ‹
);

1583 
	}
}

1596 
	$døw_rounded
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1597 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1598 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1600 
Poöt
 
p
 = *
to
;

1601 
Poöt
 
dñè
;

1602 
ªÆ
 
Àn
, 
øy⁄
;

1603 
ªÆ
 
øµ‹t
;

1604 
ªÆ
 
™gÀ_°¨t
;

1606 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1607 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1608 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1609 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1611 
dñè
 = *
‰om
;

1613 
	`poöt_sub
(&
dñè
, 
to
);

1615 
Àn
 = 
	`sqπ
(
	`poöt_dŸ
(&
dñè
, &delta));

1616 
øy⁄
 = (
Àngth
 / 2.0);

1617 i‡(
Àn
 > 0.0) {

1619 
øµ‹t
 = 
øy⁄
 / 
Àn
;

1621 
p
.
x
 +
dñè
.x * 
øµ‹t
;

1622 
p
.
y
 +
dñè
.y * 
øµ‹t
;

1624 
™gÀ_°¨t
 = 90.0 - 
	`asö
((
p
.
y
 - 
to
->yË/ 
øy⁄
) * (180.0 / 3.14);

1625 i‡(
p
.
x
 - 
to
->x < 0Ë{ 
™gÀ_°¨t
 = 360.0 -ángle_start; }

1627 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_¨c
‘ídîî, &
p
, 
width
, 
Àngth
, 
™gÀ_°¨t
,ángÀ_°¨à- 180.0, 
fg_cﬁ‹
);

1629 i‡(
Àn
 > 0.0) {

1630 
p
.
x
 +
dñè
.x * 
øµ‹t
;

1631 
p
.
y
 +
dñè
.y * 
øµ‹t
;

1633 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
p
, 
to
, 
fg_cﬁ‹
);

1634 
	}
}

1648 
	$døw_›í_rounded
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1649 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1650 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1652 
Poöt
 
p
 = *
to
;

1653 
Poöt
 
dñè
;

1654 
ªÆ
 
Àn
, 
øy⁄
;

1655 
ªÆ
 
øµ‹t
;

1656 
ªÆ
 
™gÀ_°¨t
;

1657 
Poöt
 
p_löe
;

1659 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1660 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1661 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1663 
dñè
 = *
‰om
;

1665 
	`poöt_sub
(&
dñè
, 
to
);

1667 
Àn
 = 
	`sqπ
(
	`poöt_dŸ
(&
dñè
, &delta));

1668 
øy⁄
 = (
Àngth
 / 2.0);

1669 i‡(
Àn
 > 0.0) {

1671 
øµ‹t
 = 
øy⁄
 / 
Àn
;

1673 
p
.
x
 +
dñè
.x * 
øµ‹t
;

1674 
p
.
y
 +
dñè
.y * 
øµ‹t
;

1676 
™gÀ_°¨t
 = 90.0 - 
	`asö
((
p
.
y
 - 
to
->yË/ 
øy⁄
) * (180.0 / 3.14);

1677 i‡(
p
.
x
 - 
to
->x < 0Ë{ 
™gÀ_°¨t
 = 360.0 -ángle_start; }

1679 
p_löe
 = 
p
;

1680 i‡(
Àn
 > 0.0) {

1681 
p_löe
.
x
 +
dñè
.x * 
øµ‹t
;

1682 
p_löe
.
y
 +
dñè
.y * 
øµ‹t
;

1688 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1689 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_¨c
‘ídîî, &
p
, 
width
, 
Àngth
, 
™gÀ_°¨t
 - 180.0,ángÀ_°¨t, 
fg_cﬁ‹
);

1690 
	}
}

1703 
	$døw_fûÀd_dŸ_n_åüngÀ
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1704 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1705 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1707 
Poöt
 
p_dŸ
 = *
to
, 
p_åi
 = *to, 
dñè
;

1708 
ªÆ
 
Àn
, 
øy⁄
;

1709 
ªÆ
 
øµ‹t
;

1710 
Poöt
 
pﬁy
[3];

1712 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

1713 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

1714 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1715 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1717 
dñè
 = *
‰om
;

1719 
	`poöt_sub
(&
dñè
, 
to
);

1721 
Àn
 = 
	`sqπ
(
	`poöt_dŸ
(&
dñè
, &delta));

1724 
øy⁄
 = (
width
 / 2.0);

1726 i‡(
Àn
 > 0.0) {

1728 
øµ‹t
 = 
øy⁄
 / 
Àn
;

1729 
p_dŸ
.
x
 +
dñè
.x * 
øµ‹t
;

1730 
p_dŸ
.
y
 +
dñè
.y * 
øµ‹t
;

1732 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_ñlù£
‘ídîî, &
p_dŸ
,

1733 
width
, width, 
fg_cﬁ‹
);

1735 i‡(
Àn
 > 0.0) {

1736 
øµ‹t
 = 
width
 / 
Àn
;

1737 
p_åi
.
x
 +
dñè
.x * 
øµ‹t
;

1738 
p_åi
.
y
 +
dñè
.y * 
øµ‹t
;

1740 
	`ˇlcuœã_¨row
(
pﬁy
, &
p_åi
, 
‰om
, 
Àngth
, 
width
);

1741 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_pﬁyg⁄
‘ídîî, 
pﬁy
, 3, 
fg_cﬁ‹
);

1742 
	}
}

1754 
	$døw_thªe_dŸs
(
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1755 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
, 
Cﬁ‹
 *
fg_cﬁ‹
)

1758 
gdoubÀ
 
dŸ_width
;

1759 
gdoubÀ
 
hﬁe_width
;

1760 
gdoubÀ
 
Àn
;

1761 
göt
 
i
;

1762 
Poöt
 
dñè
, 
dŸ_‰om
, 
dŸ_to
;

1764 
dñè
 = *
to
;

1765 
	`poöt_sub
(&
dñè
, 
‰om
);

1766 
Àn
 = 
	`poöt_Àn
(&
dñè
);

1767 
	`poöt_n‹mÆize
(&
dñè
);

1769 i‡(
Àn
 > 4 * 
width
)

1770 
width
 *= 2;

1771 
dŸ_width
 = 
width
 * 0.2;

1772 
hﬁe_width
 = 
width
 / 3 - 
dŸ_width
;

1774 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
löewidth
);

1775 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

1777 
i
 = 0; i < 3; i++) {

1778 
dŸ_‰om
.
x
 = 
to
->x - 
i
 * (
dŸ_width
 + 
hﬁe_width
Ë* 
dñè
.x;

1779 
dŸ_‰om
.
y
 = 
to
->y - 
i
 * (
dŸ_width
 + 
hﬁe_width
Ë* 
dñè
.y;

1780 
dŸ_to
.
x
 = 
to
->x - ((
i
 + 1Ë* 
dŸ_width
 + i * 
hﬁe_width
Ë* 
dñè
.x;

1781 
dŸ_to
.
y
 = 
to
->y - ((
i
 + 1Ë* 
dŸ_width
 + i * 
hﬁe_width
Ë* 
dñè
.y;

1782 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
dŸ_‰om
, &
dŸ_to
, 
fg_cﬁ‹
);

1784 
	}
}

1787 
	$døw_hﬁlow_åüngÀ
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1788 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1789 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1791 
	`fûl_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
NULL
, 
bg_cﬁ‹
);

1792 
	`døw_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
, 
NULL
);

1793 
	}
}

1795 
	$døw_fûÀd_åüngÀ
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1796 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1797 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1799 
	`fûl_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
NULL
, 
fg_cﬁ‹
);

1800 
	`døw_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
, 
NULL
);

1801 
	}
}

1803 
	$døw_unfûÀd_åüngÀ
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1804 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1805 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1807 
	`døw_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
, 
bg_cﬁ‹
);

1808 
	}
}

1810 
	$døw_hﬁlow_düm⁄d
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1811 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1812 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1814 
	`fûl_düm⁄d
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
bg_cﬁ‹
);

1815 
	`døw_düm⁄d
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
);

1816 
	}
}

1818 
	$døw_fûÀd_düm⁄d
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1819 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1820 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1822 
	`fûl_düm⁄d
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
fg_cﬁ‹
);

1823 
	`døw_düm⁄d
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
);

1824 
	}
}

1826 
	$døw_fûÀd_ñlù£
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1827 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1828 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1830 
	`døw_fûl_ñlù£
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
,fg_color);

1831 
	}
}

1833 
	$døw_fûÀd_dŸ
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1834 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1835 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1837 
	`døw_fûl_dŸ
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
,fg_color);

1838 
	}
}

1840 
	$døw_fûÀd_box
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1841 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1842 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1844 
	`døw_fûl_box
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
,fg_color);

1845 
	}
}

1847 
	$døw_fûÀd_c⁄ˇve
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1848 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1849 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1851 
	`døw_c⁄ˇve_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
, fg_color);

1852 
	}
}

1854 
	$ˇlcuœã_doubÀ_åüngÀ
 (
Poöt
 *
pﬁy
, c⁄° Poöà*
to
, c⁄° Poöà*
‰om
,

1855 
ªÆ
 
Àngth
,Ñó»
width
)

1857 
Poöt
 
£c⁄d_‰om
, 
£c⁄d_to
;

1859 
	`ˇlcuœã_¨row
 (
pﬁy
, 
to
, 
‰om
, 
Àngth
, 
width
);

1860 
	`ˇlcuœã_doubÀ_¨row
(&
£c⁄d_to
, &
£c⁄d_‰om
, 
to
, 
‰om
, 
Àngth
);

1861 
	`ˇlcuœã_¨row
 (
pﬁy
+3, &
£c⁄d_to
, &
£c⁄d_‰om
, 
Àngth
, 
width
);

1863 
	}
}

1865 
	$døw_doubÀ_hﬁlow_åüngÀ
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1866 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1867 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1869 
	`fûl_doubÀ_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
+(
löewidth
/2), 
width
,Üöewidth, 
fg_cﬁ‹
, 
bg_cﬁ‹
);

1870 
	`døw_doubÀ_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
, 
bg_cﬁ‹
);

1871 
	}
}

1873 
	$døw_doubÀ_fûÀd_åüngÀ
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
to
, Poöà*
‰om
,

1874 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1875 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1877 
	`fûl_doubÀ_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
, fg_color);

1878 
	}
}

1879 
	sAºowDesc
 {

1880 c⁄° *
	m«me
;

1881 
AºowTy≥
 
	míum_vÆue
;

1883 (*
	mˇlcuœã
Ë(
Poöt
 *
	mpﬁy
,

1884 c⁄° 
Poöt
 *
	mto
,

1885 c⁄° 
Poöt
 *
	m‰om
,

1886 
ªÆ
 
	mÀngth
,

1887 
ªÆ
 
	mwidth
);

1889 (*
	mdøw
Ë(
DüRídîî
 *
	mªndîî
,

1890 
Poöt
 *
	mto
,

1891 
Poöt
 *
	m‰om
,

1892 
ªÆ
 
	mÀngth
,

1893 
ªÆ
 
	mwidth
,

1894 
ªÆ
 
	mlöewidth
,

1895 
Cﬁ‹
 *
	mfg_cﬁ‹
,

1896 
Cﬁ‹
 *
	mbg_cﬁ‹
);

1897 } 
	g¨row_ty≥s
[] =

1898 {{
N_
("N⁄e"),
ARROW_NONE
},

1899 {
N_
("Löes"),
ARROW_LINES
, 
ˇlcuœã_¨row
, 
døw_löes
},

1900 {
N_
("Hﬁlow TrüngÀ"), 
ARROW_HOLLOW_TRIANGLE
, 
ˇlcuœã_¨row
, 
døw_hﬁlow_åüngÀ
},

1901 {
N_
("FûÀd TrüngÀ"), 
ARROW_FILLED_TRIANGLE
, 
ˇlcuœã_¨row
, 
døw_fûÀd_åüngÀ
},

1902 {
N_
("UnfûÀd TrüngÀ"), 
ARROW_UNFILLED_TRIANGLE
, 
ˇlcuœã_¨row
, 
døw_unfûÀd_åüngÀ
},

1903 {
N_
("Hﬁlow Düm⁄d"),
ARROW_HOLLOW_DIAMOND
, 
ˇlcuœã_düm⁄d
, 
døw_hﬁlow_düm⁄d
},

1904 {
N_
("FûÀd Düm⁄d"),
ARROW_FILLED_DIAMOND
, 
ˇlcuœã_düm⁄d
, 
døw_fûÀd_düm⁄d
},

1905 {
N_
("HÆ‡Düm⁄d"), 
ARROW_HALF_DIAMOND
, 
ˇlcuœã_düm⁄d
, 
døw_hÆf_düm⁄d
},

1906 {
N_
("HÆ‡Hód"), 
ARROW_HALF_HEAD
, 
ˇlcuœã_hÆfhód
, 
døw_hÆfhód
},

1907 {
N_
("Sœshed Cross"), 
ARROW_SLASHED_CROSS
, 
ˇlcuœã_¶ashed_¸oss
, 
døw_¶ashed_¸oss
},

1908 {
N_
("FûÀd EŒù£"), 
ARROW_FILLED_ELLIPSE
, 
ˇlcuœã_ñlù£
, 
døw_fûÀd_ñlù£
},

1909 {
N_
("Hﬁlow EŒù£"), 
ARROW_HOLLOW_ELLIPSE
, 
ˇlcuœã_ñlù£
, 
døw_fûl_ñlù£
},

1910 {
N_
("FûÀd DŸ"), 
ARROW_FILLED_DOT
, 
ˇlcuœã_dŸ
, 
døw_fûÀd_dŸ
},

1911 {
N_
("Dimísi⁄ Origö"),
ARROW_DIMENSION_ORIGIN
},

1912 {
N_
("Bœnked DŸ"),
ARROW_BLANKED_DOT
, 
ˇlcuœã_dŸ
, 
døw_fûl_dŸ
},

1913 {
N_
("DoubÀ Hﬁlow TrüngÀ"),
ARROW_DOUBLE_HOLLOW_TRIANGLE
, 
ˇlcuœã_doubÀ_åüngÀ
, 
døw_doubÀ_hﬁlow_åüngÀ
},

1914 {
N_
("DoubÀ FûÀd TrüngÀ"),
ARROW_DOUBLE_FILLED_TRIANGLE
, 
ˇlcuœã_doubÀ_åüngÀ
, 
døw_doubÀ_fûÀd_åüngÀ
},

1915 {
N_
("FûÀd DŸánd TrüngÀ"), 
ARROW_FILLED_DOT_N_TRIANGLE
},

1916 {
N_
("FûÀd Box"), 
ARROW_FILLED_BOX
, 
ˇlcuœã_box
, 
døw_fûÀd_box
},

1917 {
N_
("Bœnked Box"),
ARROW_BLANKED_BOX
, 
ˇlcuœã_box
, 
døw_fûl_box
},

1918 {
N_
("Sœshed"), 
ARROW_SLASH_ARROW
, 
ˇlcuœã_¶ashed
, 
døw_¶ashed
},

1919 {
N_
("I¡egø»Symbﬁ"),
ARROW_INTEGRAL_SYMBOL
},

1920 {
N_
("Crow FoŸ"), 
ARROW_CROW_FOOT
, 
ˇlcuœã_¸ow
, 
døw_¸ow_foŸ
},

1921 {
N_
("Cross"),
ARROW_CROSS
, 
ˇlcuœã_¨row
, 
døw_¸oss
},

1922 {
N_
("1-‹-m™y"),
ARROW_ONE_OR_MANY
},

1923 {
N_
("0-‹-m™y"),
ARROW_NONE_OR_MANY
},

1924 {
N_
("1-‹-0"),
ARROW_ONE_OR_NONE
},

1925 {
N_
("1Éxa˘ly"),
ARROW_ONE_EXACTLY
},

1926 {
N_
("FûÀd C⁄ˇve"),
ARROW_FILLED_CONCAVE
, 
ˇlcuœã_c⁄ˇve
, 
døw_fûÀd_c⁄ˇve
},

1927 {
N_
("Bœnked C⁄ˇve"),
ARROW_BLANKED_CONCAVE
, 
ˇlcuœã_c⁄ˇve
, 
døw_c⁄ˇve_åüngÀ
},

1928 {
N_
("Round"), 
ARROW_ROUNDED
},

1929 {
N_
("O≥¿Round"), 
ARROW_OPEN_ROUNDED
},

1930 {
N_
("Back¶ash"), 
ARROW_BACKSLASH
, 
ˇlcuœã_back¶ash
, 
døw_back¶ash
},

1931 {
N_
("InföôêLöe"),
ARROW_THREE_DOTS
},

1932 {
NULL
,0}

1944 
	$¨row_bbox
 (c⁄° 
Aºow
 *
¨row
, 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
to
, c⁄° Poöà*
‰om
,

1945 
Re˘™gÀ
 *
ª˘
)

1947 
Poöt
 
pﬁy
[6];

1948 
PﬁyBBExåas
 
≥xåa
;

1949 
n_poöts
 = 0;

1950 
idx
 = 
	`¨row_ödex_‰om_ty≥
(
¨row
->
ty≥
);

1952 i‡(
ARROW_NONE
 =
¨row
->
ty≥
)

1956 i‡(
¨row_ty≥s
[
idx
].
ˇlcuœã
)

1957 
n_poöts
 = 
¨row_ty≥s
[
idx
].
	`ˇlcuœã
 (
pﬁy
, 
to
, 
‰om
, 
¨row
->
Àngth
,áºow->
width
);

1959 
n_poöts
 = 
	`ˇlcuœã_¨row
(
pﬁy
, 
to
, 
‰om
, 
¨row
->
Àngth
,áºow->
width
);

1960 
	`g_as£π
 (
n_poöts
 > 0 &&Ç_poöt†<(
pﬁy
)/(
Poöt
));

1962 
≥xåa
.
°¨t_å™s
 =Öexåa.
íd_å™s
 =

1963 
≥xåa
.
°¨t_l⁄g
 =Öexåa.
íd_l⁄g
 =

1964 
≥xåa
.
middÀ_å™s
 = 
löe_width
/2.0;

1966 
	`pﬁylöe_bbox
 (
pﬁy
, 
n_poöts
, &
≥xåa
, 
TRUE
, 
ª˘
);

1967 
	}
}

1981 
	$¨row_døw
(
DüRídîî
 *
ªndîî
, 
AºowTy≥
 
ty≥
,

1982 
Poöt
 *
to
, Poöà*
‰om
,

1983 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

1984 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
)

1986 
ty≥
) {

1987 
ARROW_NONE
:

1989 
ARROW_DIMENSION_ORIGIN
:

1990 
	`døw_fûl_dŸ
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
,
NULL
);

1992 
ARROW_INTEGRAL_SYMBOL
:

1993 
	`døw_öãgøl
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
);

1995 
ARROW_ONE_OR_MANY
:

1996 
	`døw_⁄e_‹_m™y
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
,
bg_cﬁ‹
);

1998 
ARROW_NONE_OR_MANY
:

1999 
	`døw_n⁄e_‹_m™y
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
,
bg_cﬁ‹
);

2001 
ARROW_ONE_EXACTLY
:

2002 
	`døw_⁄e_exa˘ly
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
,
bg_cﬁ‹
);

2004 
ARROW_ONE_OR_NONE
:

2005 
	`døw_⁄e_‹_n⁄e
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
,
bg_cﬁ‹
);

2007 
ARROW_ROUNDED
:

2008 
	`døw_rounded
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
, 
fg_cﬁ‹
, 
bg_cﬁ‹
);

2010 
ARROW_OPEN_ROUNDED
:

2011 
	`døw_›í_rounded
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
,

2012 
fg_cﬁ‹
, 
bg_cﬁ‹
);

2014 
ARROW_FILLED_DOT_N_TRIANGLE
:

2015 
	`døw_fûÀd_dŸ_n_åüngÀ
(
ªndîî
, 
to
, 
‰om
, 
Àngth
, 
width
, 
löewidth
,

2016 
fg_cﬁ‹
, 
bg_cﬁ‹
);

2018 
ARROW_THREE_DOTS
:

2019 
	`døw_thªe_dŸs
(
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
);

2021 
MAX_ARROW_TYPE
:

2025 
idx
 = 
	`¨row_ödex_‰om_ty≥
(
ty≥
);

2026 
	`g_ªtu∫_if_Áû
 (
¨row_ty≥s
[
idx
].
døw
 !
NULL
);

2027 
¨row_ty≥s
[
idx
].
	`døw
 (
ªndîî
,
to
,
‰om
,
Àngth
,
width
,
löewidth
,
fg_cﬁ‹
,
bg_cﬁ‹
);

2031 i‡((
ty≥
 !
ARROW_NONE
Ë&& (
ªndî_boundög_boxes
Ë&& (
ªndîî
->
is_öãø˘ive
)) {

2032 
Aºow
 
¨row
 = {
ty≥
, 
Àngth
, 
width
};

2033 
Re˘™gÀ
 
bbox
 = {0, };

2034 
Poöt
 
p1
, 
p2
;

2035 
Cﬁ‹
 
cﬁ
 = {1.0, 0.0, 1.0};

2037 
	`¨row_bbox
 (&
¨row
, 
löewidth
, 
to
, 
‰om
, &
bbox
);

2039 
p1
.
x
 = 
bbox
.
À·
;

2040 
p1
.
y
 = 
bbox
.
t›
;

2041 
p2
.
x
 = 
bbox
.
right
;

2042 
p2
.
y
 = 
bbox
.
bŸtom
;

2044 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
(renderer,0.01);

2045 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_ª˘
‘ídîî, &
p1
, &
p2
, &
cﬁ
);

2047 
	}
}

2056 
	$ßnôize_¨row
(
Aºow
 *
¨row
)

2058 i‡(
¨row
->
ty≥
 < 0 ||áºow->ty≥ > 
MAX_ARROW_TYPE
) {

2059 
	`mesßge_w¨nög
(
	`_
("Arrow head of unknownÅype"));

2060 
¨row
->
ty≥
 = 
ARROW_NONE
;

2061 
¨row
->
width
 = 
DEFAULT_ARROW_WIDTH
;

2062 
¨row
->
Àngth
 = 
DEFAULT_ARROW_LENGTH
;

2065 i‡(
¨row
->
Àngth
 < 
MIN_ARROW_DIMENSION
 ||

2066 
¨row
->
width
 < 
MIN_ARROW_DIMENSION
) {

2067 
	`mesßge_w¨nög
(
	`_
("Arrow head ofÅype %s hasÅoo small dimensions,Ñemoving.\n"),

2068 
	`¨row_gë_«me_‰om_ty≥
(
¨row
->
ty≥
));

2069 
¨row
->
ty≥
 = 
ARROW_NONE
;

2070 
¨row
->
width
 = 
DEFAULT_ARROW_WIDTH
;

2071 
¨row
->
Àngth
 = 
DEFAULT_ARROW_LENGTH
;

2073 
	}
}

2083 
	$ßve_¨row
(
Obje˘Node
 
obj_node
, 
Aºow
 *
¨row
, 
gch¨
 *
ty≥_©åibuã
,

2084 
gch¨
 *
Àngth_©åibuã
, gch¨ *
width_©åibuã
)

2086 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, 
ty≥_©åibuã
),

2087 
¨row
->
ty≥
);

2088 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
Àngth_©åibuã
),

2089 
¨row
->
Àngth
);

2090 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
width_©åibuã
),

2091 
¨row
->
width
);

2092 
	}
}

2102 
	$lﬂd_¨row
(
Obje˘Node
 
obj_node
, 
Aºow
 *
¨row
, 
gch¨
 *
ty≥_©åibuã
,

2103 
gch¨
 *
Àngth_©åibuã
, gch¨ *
width_©åibuã
)

2105 
AâribuãNode
 
©å
;

2107 
¨row
->
ty≥
 = 
ARROW_NONE
;

2108 
¨row
->
Àngth
 = 
DEFAULT_ARROW_LENGTH
;

2109 
¨row
->
width
 = 
DEFAULT_ARROW_WIDTH
;

2110 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
ty≥_©åibuã
);

2111 i‡(
©å
 !
NULL
)

2112 
¨row
->
ty≥
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

2113 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
Àngth_©åibuã
);

2114 i‡(
©å
 !
NULL
)

2115 
¨row
->
Àngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

2116 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
width_©åibuã
);

2117 i‡(
©å
 !
NULL
)

2118 
¨row
->
width
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

2120 
	`ßnôize_¨row
(
¨row
);

2121 
	}
}

2128 
AºowTy≥


2129 
	$¨row_ty≥_‰om_«me
(c⁄° 
gch¨
 *
«me
)

2131 
i
;

2132 
i
 = 0; 
¨row_ty≥s
[i].
«me
 !
NULL
; i++) {

2133 i‡(!
	`°rcmp
(
¨row_ty≥s
[
i
].
«me
,Çame)) {

2134  
¨row_ty≥s
[
i
].
íum_vÆue
;

2137 
	`¥ötf
("Unknow¿¨rowÅy≥ %s\n", 
«me
);

2139 
	}
}

2146 
göt


2147 
	$¨row_ödex_‰om_ty≥
(
AºowTy≥
 
©y≥
)

2149 
i
 = 0;

2151 
i
 = 0; 
¨row_ty≥s
[i].
«me
 !
NULL
; i++) {

2152 i‡(
¨row_ty≥s
[
i
].
íum_vÆue
 =
©y≥
) {

2153  
i
;

2156 
	`¥ötf
("C™'àfödáºow index f‹Åy≥ %d\n", 
©y≥
);

2158 
	}
}

2163 
AºowTy≥


2164 
	$¨row_ty≥_‰om_ödex
 (
göt
 
ödex
)

2166 i‡(
ödex
 >0 && index < 
MAX_ARROW_TYPE
) {

2167  
¨row_ty≥s
[
ödex
].
íum_vÆue
;

2169  
MAX_ARROW_TYPE
;

2170 
	}
}

2176 
GLi°
 *

2177 
	$gë_¨row_«mes
()

2179 
i
 = 0;

2180 
GLi°
 *
¨rows
 = 
NULL
;

2182 
i
 = 0; 
¨row_ty≥s
[i].
«me
 !
NULL
; i++) {

2183 
¨rows
 = 
	`g_li°_≠≥nd
◊ºows, (*)
¨row_ty≥s
[
i
].
«me
);

2185  
¨rows
;

2186 
	}
}

2194 c⁄° 
gch¨
 *

2195 
	$¨row_gë_«me_‰om_ty≥
(
AºowTy≥
 
ty≥
)

2197 i‡(
ty≥
 >0 &&Åy≥ < 
MAX_ARROW_TYPE
) {

2198  
¨row_ty≥s
[
	`¨row_ödex_‰om_ty≥
(
ty≥
)].
«me
;

2200  
	`_
("unknownárrow");

2201 
	}
}

	@O:\tool\dvs50\lib\arrows.h

18 #i‚de‡
ARROWS_H


19 
	#ARROWS_H


	)

21 
	~"düty≥s.h
"

22 
	~"geomëry.h
"

23 
	~"cﬁ‹.h
"

24 
	~"dü_xml.h
"

32 
	mARROW_NONE
 = 0,

33 
	mARROW_LINES
,

34 
	mARROW_HOLLOW_TRIANGLE
,

35 
	mARROW_FILLED_TRIANGLE
,

36 
	mARROW_HOLLOW_DIAMOND
,

37 
	mARROW_FILLED_DIAMOND
,

38 
	mARROW_HALF_HEAD
,

39 
	mARROW_SLASHED_CROSS
,

40 
	mARROW_FILLED_ELLIPSE
,

41 
	mARROW_HOLLOW_ELLIPSE
,

42 
	mARROW_DOUBLE_HOLLOW_TRIANGLE
,

43 
	mARROW_DOUBLE_FILLED_TRIANGLE
,

44 
	mARROW_UNFILLED_TRIANGLE
,

45 
	mARROW_FILLED_DOT
,

46 
	mARROW_DIMENSION_ORIGIN
,

47 
	mARROW_BLANKED_DOT
,

48 
	mARROW_FILLED_BOX
,

49 
	mARROW_BLANKED_BOX
,

50 
	mARROW_SLASH_ARROW
,

51 
	mARROW_INTEGRAL_SYMBOL
,

52 
	mARROW_CROW_FOOT
,

53 
	mARROW_CROSS
,

54 
	mARROW_FILLED_CONCAVE
,

55 
	mARROW_BLANKED_CONCAVE
,

56 
	mARROW_ROUNDED
,

57 
	mARROW_HALF_DIAMOND
,

58 
	mARROW_OPEN_ROUNDED
,

59 
	mARROW_FILLED_DOT_N_TRIANGLE
,

60 
	mARROW_ONE_OR_MANY
,

61 
	mARROW_NONE_OR_MANY
,

62 
	mARROW_ONE_OR_NONE
,

63 
	mARROW_ONE_EXACTLY
,

64 
	mARROW_BACKSLASH
,

65 
	mARROW_THREE_DOTS
,

67 
	mMAX_ARROW_TYPE


68 } 
	tAºowTy≥
;

76 
	#DEFAULT_ARROW_SIZE
 0.5

	)

81 
	#MIN_ARROW_DIMENSION
 0.001

	)

83 
	s_Aºow
 {

84 
AºowTy≥
 
	mty≥
;

85 
ªÆ
 
	mÀngth
;

86 
ªÆ
 
	mwidth
;

90 
	$__de˛•ec
(
dŒexp‹t
Ë
	`¨row_døw
(
DüRídîî
 *
ªndîî
, 
AºowTy≥
 
ty≥
,

91 
Poöt
 *
to
, Poöà*
‰om
,

92 
ªÆ
 
Àngth
,Ñó»
width
,Ñó»
löewidth
,

93 
Cﬁ‹
 *
fg_cﬁ‹
, Cﬁ‹ *
bg_cﬁ‹
);

97 
	$__de˛•ec
(
dŒexp‹t
Ë
	`¨row_bbox
 (c⁄° 
Aºow
 *
¨row
, 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
to
, c⁄° Poöà*
‰om
,

98 
Re˘™gÀ
 *
ª˘
);

100 
	$__de˛•ec
(
dŒexp‹t
) 

101 
	`ˇlcuœã_¨row_poöt
(c⁄° 
Aºow
 *
¨row
, c⁄° 
Poöt
 *
to
, c⁄° Poöà*
‰om
,

102 
Poöt
 *
move_¨row
, Poöà*
move_löe
,

103 
ªÆ
 
löewidth
);

105 
DIAVAR
 
	`ßve_¨row
(
Obje˘Node
 
obj_node
, 
Aºow
 *
¨row
, 
gch¨
 *
ty≥_©åibuã
,

106 
gch¨
 *
Àngth_©åibuã
, gch¨ *
width_©åibuã
);

107 
DIAVAR
 
	`lﬂd_¨row
(
Obje˘Node
 
obj_node
, 
Aºow
 *
¨row
, 
gch¨
 *
ty≥_©åibuã
,

108 
gch¨
 *
Àngth_©åibuã
, gch¨ *
width_©åibuã
);

111 
DIAVAR
 
AºowTy≥
 
	`¨row_ty≥_‰om_«me
(c⁄° 
gch¨
 *
«me
);

113 
göt
 
	`¨row_ödex_‰om_ty≥
(
AºowTy≥
 
ty≥
);

114 
AºowTy≥
 
	`¨row_ty≥_‰om_ödex
(
göt
 
ödex
);

115 
DIAVAR
 c⁄° 
gch¨
 *
	`¨row_gë_«me_‰om_ty≥
(
AºowTy≥
 
ty≥
);

116 
DIAVAR
 
GLi°
 *
	`gë_¨row_«mes
();

	@O:\tool\dvs50\lib\attributes.c

18 
	~<c⁄fig.h
>

20 
	~"©åibuãs.h
"

21 
	~"öé.h
"

22 
	~"≥rsi°í˚.h
"

24 
Cﬁ‹
 
	g©åibuãs_f‹eground
 = { 0.0f, 0.0f, 0.0f };

25 
Cﬁ‹
 
	g©åibuãs_background
 = { 1.0f, 1.0f, 1.0f };

27 
ªÆ
 
	g©åibuãs_deÁu…_löewidth
 = 0.1;

29 
Aºow
 
	g©åibuãs_°¨t_¨row
 = { 
ARROW_NONE
,

30 
DEFAULT_ARROW_SIZE
,

31 
DEFAULT_ARROW_SIZE
 };

32 
Aºow
 
	g©åibuãs_íd_¨row
 = { 
ARROW_NONE
,

33 
DEFAULT_ARROW_SIZE
,

34 
DEFAULT_ARROW_SIZE
 };

36 
LöeStyÀ
 
	g©åibuãs_löe°yÀ
 = 
LINESTYLE_SOLID
;

37 
ªÆ
 
	g©åibuãs_dash_Àngth
 = 1.0;

39 
DüF⁄t
 *
	g©åibuãs_f⁄t
 = 
NULL
;

40 
ªÆ
 
	g©åibuãs_f⁄t_height
 = 0.8;

45 
Cﬁ‹


46 
	$©åibuãs_gë_f‹eground
()

48  
©åibuãs_f‹eground
;

49 
	}
}

54 
Cﬁ‹


55 
	$©åibuãs_gë_background
()

57  
©åibuãs_background
;

58 
	}
}

65 
	$©åibuãs_£t_f‹eground
(
Cﬁ‹
 *
cﬁ‹
)

67 
©åibuãs_f‹eground
 = *
cﬁ‹
;

68 
	`≥rsi°í˚_£t_cﬁ‹
("fg_cﬁ‹", 
cﬁ‹
);

69 
	}
}

76 
	$©åibuãs_£t_background
(
Cﬁ‹
 *
cﬁ‹
)

78 
©åibuãs_background
 = *
cﬁ‹
;

79 
	`≥rsi°í˚_£t_cﬁ‹
("bg_cﬁ‹", 
cﬁ‹
);

80 
	}
}

85 
	$©åibuãs_sw≠_fgbg
()

87 
Cﬁ‹
 
ãmp
;

88 
ãmp
 = 
©åibuãs_f‹eground
;

89 
	`©åibuãs_£t_f‹eground
(&
©åibuãs_background
);

90 
	`©åibuãs_£t_background
(&
ãmp
);

91 
	}
}

96 
	$©åibuãs_deÁu…_fgbg
()

98 
	`©åibuãs_£t_f‹eground
(&
cﬁ‹_bœck
);

99 
	`©åibuãs_£t_background
(&
cﬁ‹_whôe
);

100 
	}
}

106 
ªÆ


107 
	$©åibuãs_gë_deÁu…_löewidth
()

109  
©åibuãs_deÁu…_löewidth
;

110 
	}
}

116 
	$©åibuãs_£t_deÁu…_löewidth
(
ªÆ
 
width
)

118 
©åibuãs_deÁu…_löewidth
 = 
width
;

119 
	`≥rsi°í˚_£t_ªÆ
("löewidth", 
width
);

120 
	}
}

125 
Aºow


126 
	$©åibuãs_gë_deÁu…_°¨t_¨row
()

128  
©åibuãs_°¨t_¨row
;

129 
	}
}

135 
	$©åibuãs_£t_deÁu…_°¨t_¨row
(
Aºow
 
¨row
)

137 
©åibuãs_°¨t_¨row
 = 
¨row
;

138 
	`≥rsi°í˚_£t_°rög
("start-arrow-type",

139 
	`¨row_gë_«me_‰om_ty≥
(
¨row
.
ty≥
));

140 
	`≥rsi°í˚_£t_ªÆ
("°¨t-¨row-width", 
¨row
.
width
);

141 
	`≥rsi°í˚_£t_ªÆ
("°¨t-¨row-Àngth", 
¨row
.
Àngth
);

142 
	}
}

147 
Aºow


148 
	$©åibuãs_gë_deÁu…_íd_¨row
()

150  
©åibuãs_íd_¨row
;

151 
	}
}

157 
	$©åibuãs_£t_deÁu…_íd_¨row
(
Aºow
 
¨row
)

159 
©åibuãs_íd_¨row
 = 
¨row
;

160 
	`≥rsi°í˚_£t_°rög
("end-arrow-type",

161 
	`¨row_gë_«me_‰om_ty≥
(
¨row
.
ty≥
));

162 
	`≥rsi°í˚_£t_ªÆ
("íd-¨row-width", 
¨row
.
width
);

163 
	`≥rsi°í˚_£t_ªÆ
("íd-¨row-Àngth", 
¨row
.
Àngth
);

164 
	}
}

173 
	$©åibuãs_gë_deÁu…_löe_°yÀ
(
LöeStyÀ
 *
°yÀ
, 
ªÆ
 *
dash_Àngth
)

175 i‡(
°yÀ
)

176 *
°yÀ
 = 
©åibuãs_löe°yÀ
;

177 i‡(
dash_Àngth
)

178 *
dash_Àngth
 = 
©åibuãs_dash_Àngth
;

179 
	}
}

187 
	$©åibuãs_£t_deÁu…_löe_°yÀ
(
LöeStyÀ
 
°yÀ
, 
ªÆ
 
dash_Àngth
)

189 
©åibuãs_löe°yÀ
 = 
°yÀ
;

190 
©åibuãs_dash_Àngth
 = 
dash_Àngth
;

191 
	`≥rsi°í˚_£t_öãgî
("löe-°yÀ", 
°yÀ
);

192 
	`≥rsi°í˚_£t_ªÆ
("dash-Àngth", 
dash_Àngth
);

193 
	}
}

201 
	$©åibuãs_gë_deÁu…_f⁄t
(
DüF⁄t
 **
f⁄t
, 
ªÆ
 *
f⁄t_height
)

203 i‡(!
©åibuãs_f⁄t
) {

204 
©åibuãs_f⁄t
 = 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_SANS
,

205 
©åibuãs_f⁄t_height
);

207 i‡(
f⁄t
)

208 *
f⁄t
 = 
	`dü_f⁄t_ªf
(
©åibuãs_f⁄t
);

209 i‡(
f⁄t_height
)

210 *
f⁄t_height
 = 
©åibuãs_f⁄t_height
;

211 
	}
}

220 
	$©åibuãs_£t_deÁu…_f⁄t
(
DüF⁄t
 *
f⁄t
, 
ªÆ
 
f⁄t_height
)

222 i‡(
©åibuãs_f⁄t
 !
NULL
)

223 
	`dü_f⁄t_uƒef
(
©åibuãs_f⁄t
);

224 
©åibuãs_f⁄t
 = 
	`dü_f⁄t_ªf
(
f⁄t
);

225 
©åibuãs_f⁄t_height
 = 
f⁄t_height
;

226 
	}
}

	@O:\tool\dvs50\lib\attributes.h

18 #i‚de‡
ATTRIBUTES_H


19 
	#ATTRIBUTES_H


	)

21 
	~"dü-íums.h
"

22 
	~"geomëry.h
"

23 
	~"cﬁ‹.h
"

24 
	~"¨rows.h
"

25 
	~"f⁄t.h
"

27 
DIAVAR
 
Cﬁ‹
 
©åibuãs_gë_f‹eground
();

28 
DIAVAR
 
Cﬁ‹
 
©åibuãs_gë_background
();

29 
DIAVAR
 
©åibuãs_£t_f‹eground
(
Cﬁ‹
 *
cﬁ‹
);

30 
DIAVAR
 
©åibuãs_£t_background
(
Cﬁ‹
 *
cﬁ‹
);

31 
DIAVAR
 
©åibuãs_sw≠_fgbg
();

32 
DIAVAR
 
©åibuãs_deÁu…_fgbg
();

33 
DIAVAR
 
ªÆ
 
©åibuãs_gë_deÁu…_löewidth
();

34 
DIAVAR
 
©åibuãs_£t_deÁu…_löewidth
(
ªÆ
 
width
);

36 
DIAVAR
 
Aºow
 
©åibuãs_gë_deÁu…_°¨t_¨row
();

37 
DIAVAR
 
©åibuãs_£t_deÁu…_°¨t_¨row
(
Aºow
 
¨row
);

39 
DIAVAR
 
Aºow
 
©åibuãs_gë_deÁu…_íd_¨row
();

40 
DIAVAR
 
©åibuãs_£t_deÁu…_íd_¨row
(
Aºow
 
¨row
);

42 
DIAVAR
 
©åibuãs_gë_deÁu…_löe_°yÀ
(
LöeStyÀ
 *
°yÀ
, 
ªÆ
 *
dash_Àngth
);

43 
DIAVAR
 
©åibuãs_£t_deÁu…_löe_°yÀ
(
LöeStyÀ
 
°yÀ
, 
ªÆ
 
dash_Àngth
);

45 
DIAVAR
 
©åibuãs_gë_deÁu…_f⁄t
(
DüF⁄t
 **
f⁄t
, 
ªÆ
 *
f⁄t_height
);

46 
DIAVAR
 
©åibuãs_£t_deÁu…_f⁄t
(
DüF⁄t
 *
f⁄t
, 
ªÆ
 
f⁄t_height
);

	@O:\tool\dvs50\lib\autoroute.c

22 
	~"c⁄fig.h
"

24 
	~"obje˘.h
"

25 
	~"c⁄√˘i⁄poöt.h
"

26 
	~"‹th_c⁄n.h
"

27 
	~"aut‹ouã.h
"

29 
	#MAX_BADNESS
 10000.0

	)

31 
	#MIN_DIST
 1.0

	)

33 
	#MAX_SMALL_BADNESS
 10.0

	)

35 
	#EXTRA_SEGMENT_BADNESS
 10.0

	)

37 
ªÆ
 
ˇlcuœã_bad√ss
(
Poöt
 *
ps
, 
guöt
 
num_poöts
);

39 
ªÆ
 
aut‹ouã_œyout_∑øŒñ
(
Poöt
 *
to
,

40 
guöt
 *
num_poöts
, 
Poöt
 **
poöts
);

41 
ªÆ
 
aut‹ouã_œyout_‹thog⁄Æ
(
Poöt
 *
to
,

42 
íddú
,

43 
guöt
 *
num_poöts
, 
Poöt
 **
poöts
);

44 
ªÆ
 
aut‹ouã_œyout_›posôe
(
Poöt
 *
to
,

45 
guöt
 *
num_poöts
, 
Poöt
 **
poöts
);

46 
Poöt
 
autﬁayout_adju°_f‹_g≠
(Poöà*
pos
, 
dú
, 
C⁄√˘i⁄Poöt
 *
˝
);

47 
autﬁayout_adju°_f‹_¨row
(
Poöt
 *
pos
, 
dú
, 
ªÆ
 
adju°
);

48 
guöt
 
autﬁayout_n‹mÆize_poöts
(guöà
°¨tdú
, guöà
íddú
,

49 
Poöt
 
°¨t
, Poöà
íd
,

50 
Poöt
 *
√wíd
);

51 
Poöt
 *
autﬁayout_u¬‹mÆize_poöts
(
guöt
 
dú
,

52 
Poöt
 
°¨t
,

53 
Poöt
 *
poöts
,

54 
guöt
 
num_poöts
);

68 
gboﬁón


69 
	$aut‹ouã_œyout_‹thc⁄n
(
OπhC⁄n
 *
c⁄n
,

70 
C⁄√˘i⁄Poöt
 *
°¨tc⁄n
, C⁄√˘i⁄Poöà*
ídc⁄n
)

72 
ªÆ
 
mö_bad√ss
 = 
MAX_BADNESS
;

73 
Poöt
 *
be°_œyout
 = 
NULL
;

74 
guöt
 
be°_num_poöts
 = 0;

75 
°¨tdú
, 
íddú
;

77 
‰omdú
, 
todú
;

78 
Poöt
 
‰ompos
, 
t›os
;

80 
‰ompos
 = 
c⁄n
->
poöts
[0];

81 
t›os
 = 
c⁄n
->
poöts
[c⁄n->
numpoöts
-1];

82 i‡(
°¨tc⁄n
 !
NULL
) {

83 
‰omdú
 = 
°¨tc⁄n
->
dúe˘i⁄s
;

84 
‰ompos
 = 
°¨tc⁄n
->
pos
;

86 
‰omdú
 = 
DIR_NORTH
|
DIR_EAST
|
DIR_SOUTH
|
DIR_WEST
;

87 i‡(
ídc⁄n
 !
NULL
) {

88 
todú
 = 
ídc⁄n
->
dúe˘i⁄s
;

89 
t›os
 = 
ídc⁄n
->
pos
;

91 
todú
 = 
DIR_NORTH
|
DIR_EAST
|
DIR_SOUTH
|
DIR_WEST
;

93 
°¨tdú
 = 
DIR_NORTH
; sèπdú <
DIR_WEST
; startdir *= 2) {

94 
íddú
 = 
DIR_NORTH
;Énddú <
DIR_WEST
;Énddir *= 2) {

95 i‡((
‰omdú
 & 
°¨tdú
) &&

96 (
todú
 & 
íddú
)) {

97 
ªÆ
 
this_bad√ss
;

98 
Poöt
 *
this_œyout
 = 
NULL
;

99 
guöt
 
this_num_poöts
;

100 
guöt
 
n‹mÆ_íddú
;

101 
Poöt
 
°¨çoöt
, 
ídpoöt
;

102 
Poöt
 
Ÿhîpoöt
;

103 
°¨çoöt
 = 
	`autﬁayout_adju°_f‹_g≠
(&
‰ompos
, 
°¨tdú
, 
°¨tc⁄n
);

104 
	`autﬁayout_adju°_f‹_¨row
(&
°¨çoöt
, 
°¨tdú
, 
c⁄n
->
exåa_•acög
.
°¨t_å™s
);

105 
ídpoöt
 = 
	`autﬁayout_adju°_f‹_g≠
(&
t›os
, 
íddú
, 
ídc⁄n
);

106 
	`autﬁayout_adju°_f‹_¨row
(&
ídpoöt
, 
íddú
, 
c⁄n
->
exåa_•acög
.
íd_å™s
);

115 
n‹mÆ_íddú
 = 
	`autﬁayout_n‹mÆize_poöts
(
°¨tdú
, 
íddú
,

116 
°¨çoöt
, 
ídpoöt
,

117 &
Ÿhîpoöt
);

118 i‡(
n‹mÆ_íddú
 =
DIR_NORTH
 ) {

119 
this_bad√ss
 = 
	`aut‹ouã_œyout_∑øŒñ
(&
Ÿhîpoöt
,

120 &
this_num_poöts
,

121 &
this_œyout
);

122 } i‡(
n‹mÆ_íddú
 =
DIR_SOUTH
) {

123 
this_bad√ss
 = 
	`aut‹ouã_œyout_›posôe
(&
Ÿhîpoöt
,

124 &
this_num_poöts
,

125 &
this_œyout
);

127 
this_bad√ss
 = 
	`aut‹ouã_œyout_‹thog⁄Æ
(&
Ÿhîpoöt
,

128 
n‹mÆ_íddú
,

129 &
this_num_poöts
,

130 &
this_œyout
);

132 i‡(
this_œyout
 !
NULL
) {

133 i‡(
this_bad√ss
-
mö_bad√ss
 < -0.00001) {

138 
mö_bad√ss
 = 
this_bad√ss
;

139 i‡(
be°_œyout
 !
NULL
Ë
	`g_‰ì
(best_layout);

140 
be°_œyout
 = 
	`autﬁayout_u¬‹mÆize_poöts
(
°¨tdú
, 
°¨çoöt
,

141 
this_œyout
,

142 
this_num_poöts
);

143 
be°_num_poöts
 = 
this_num_poöts
;

145 
	`autﬁayout_adju°_f‹_¨row
(&
be°_œyout
[0], 
°¨tdú
,

146 -
c⁄n
->
exåa_•acög
.
°¨t_å™s
);

147 
	`autﬁayout_adju°_f‹_¨row
(&
be°_œyout
[
be°_num_poöts
-1], 
íddú
,

148 -
c⁄n
->
exåa_•acög
.
íd_å™s
);

150 
	`g_‰ì
(
this_œyout
);

157 i‡(
mö_bad√ss
 < 
MAX_BADNESS
) {

158 
	`‹thc⁄n_£t_poöts
(
c⁄n
, 
be°_num_poöts
, 
be°_œyout
);

159 
	`g_‰ì
(
be°_œyout
);

160  
TRUE
;

162 
	`g_‰ì
(
be°_œyout
);

163  
FALSE
;

165 
	}
}

172 
ªÆ


173 
	$Àngth_bad√ss
(
ªÆ
 
Àn
)

175 i‡(
Àn
 < 
MIN_DIST
) {

177  2*
MAX_SMALL_BADNESS
/(1.0+
Àn
/
MIN_DIST
) - MAX_SMALL_BADNESS;

179  
Àn
-
MIN_DIST
;

181 
	}
}

190 
ªÆ


191 
	$ˇlcuœã_bad√ss
(
Poöt
 *
ps
, 
guöt
 
num_poöts
)

193 
ªÆ
 
bad√ss
;

194 
guöt
 
i
;

195 
bad√ss
 = (
num_poöts
-1)*
EXTRA_SEGMENT_BADNESS
;

196 
i
 = 0; i < 
num_poöts
-1; i++) {

197 
ªÆ
 
this_bad√ss
;

198 
ªÆ
 
Àn
 = 
	`di°™˚_poöt_poöt_m™h©èn
(&
ps
[
i
], &ps[i+1]);

199 
this_bad√ss
 = 
	`Àngth_bad√ss
(
Àn
);

200 
bad√ss
 +
this_bad√ss
;

202  
bad√ss
;

203 
	}
}

212 
Poöt


213 
	$autﬁayout_adju°_f‹_g≠
(
Poöt
 *
pos
, 
dú
, 
C⁄√˘i⁄Poöt
 *
˝
)

215 
DüObje˘
 *
obje˘
;

216 
Poöt
 
dú_Ÿhî
;

219 i‡(!
	`c⁄≈oöt_is_autog≠
(
˝
)) {

220  *
pos
;

223 
obje˘
 = 
˝
->object;

225 
dú_Ÿhî
.
x
 = 
pos
->x;

226 
dú_Ÿhî
.
y
 = 
pos
->y;

227 
dú
) {

228 
DIR_NORTH
:

229 
dú_Ÿhî
.
y
 +2 * (
obje˘
->
boundög_box
.
t›
 - 
pos
->y);

231 
DIR_SOUTH
:

232 
dú_Ÿhî
.
y
 +2 * (
obje˘
->
boundög_box
.
bŸtom
 - 
pos
->y);

234 
DIR_EAST
:

235 
dú_Ÿhî
.
x
 +2 * (
obje˘
->
boundög_box
.
right
 - 
pos
->x);

237 
DIR_WEST
:

238 
dú_Ÿhî
.
x
 +2 * (
obje˘
->
boundög_box
.
À·
 - 
pos
->x);

241 
	`g_w¨nög
("ImpossibÀ dúe˘i⁄ %d\n", 
dú
);

243  
	`ˇlcuœã_obje˘_edge
(
pos
, &
dú_Ÿhî
, 
obje˘
);

244 
	}
}

255 
	$autﬁayout_adju°_f‹_¨row
(
Poöt
 *
pos
, 
dú
, 
ªÆ
 
adju°
)

257 
dú
) {

258 
DIR_NORTH
:

259 
pos
->
y
 -
adju°
;

261 
DIR_EAST
:

262 
pos
->
x
 +
adju°
;

264 
DIR_SOUTH
:

265 
pos
->
y
 +
adju°
;

267 
DIR_WEST
:

268 
pos
->
x
 -
adju°
;

271 
	}
}

282 
ªÆ


283 
	$aut‹ouã_œyout_∑øŒñ
(
Poöt
 *
to
, 
guöt
 *
num_poöts
, Poöà**
poöts
)

285 
Poöt
 *
ps
 = 
NULL
;

286 i‡(
	`Ábs
(
to
->
x
Ë> 
MIN_DIST
) {

287 
ªÆ
 
t›
 = 
	`MIN
(-
MIN_DIST
, 
to
->
y
-MIN_DIST);

291 *
num_poöts
 = 4;

292 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

294 
ps
[1].
y
 = 
t›
;

295 
ps
[2].
x
 = 
to
->x;

296 
ps
[2].
y
 = 
t›
;

297 
ps
[3] = *
to
;

298 } i‡(
to
->
y
 > 0) {

299 
ªÆ
 
t›
 = -
MIN_DIST
;

300 
ªÆ
 
off
 = 
to
->
x
+
MIN_DIST
*(to->x>0?1.0:-1.0);

301 
ªÆ
 
bŸtom
 = 
to
->
y
-
MIN_DIST
;

305 *
num_poöts
 = 6;

306 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

308 
ps
[1].
y
 = 
t›
;

309 
ps
[2].
x
 = 
off
;

310 
ps
[2].
y
 = 
t›
;

311 
ps
[3].
x
 = 
off
;

312 
ps
[3].
y
 = 
bŸtom
;

313 
ps
[4].
x
 = 
to
->x;

314 
ps
[4].
y
 = 
bŸtom
;

315 
ps
[5] = *
to
;

317 
ªÆ
 
t›
 = 
to
->
y
-
MIN_DIST
;

318 
ªÆ
 
off
 = 
MIN_DIST
*(
to
->
x
>0?-1.0:1.0);

319 
ªÆ
 
bŸtom
 = -
MIN_DIST
;

323 *
num_poöts
 = 6;

324 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

326 
ps
[1].
y
 = 
bŸtom
;

327 
ps
[2].
x
 = 
off
;

328 
ps
[2].
y
 = 
bŸtom
;

329 
ps
[3].
x
 = 
off
;

330 
ps
[3].
y
 = 
t›
;

331 
ps
[4].
x
 = 
to
->x;

332 
ps
[4].
y
 = 
t›
;

333 
ps
[5] = *
to
;

335 *
poöts
 = 
ps
;

336  
	`ˇlcuœã_bad√ss
(
ps
, *
num_poöts
);

337 
	}
}

349 
ªÆ


350 
	$aut‹ouã_œyout_‹thog⁄Æ
(
Poöt
 *
to
, 
íddú
,

351 
guöt
 *
num_poöts
, 
Poöt
 **
poöts
)

354 
Poöt
 *
ps
 = 
NULL
;

355 
ªÆ
 
dúmu…
 = (
íddú
==
DIR_WEST
?1.0:-1.0);

356 i‡(
to
->
y
 < -
MIN_DIST
) {

357 i‡(
dúmu…
*
to
->
x
 > 
MIN_DIST
) {

361 *
num_poöts
 = 3;

362 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

364 
ps
[1].
y
 = 
to
->y;

365 
ps
[2] = *
to
;

367 
ªÆ
 
off
;

368 i‡(
dúmu…
*
to
->
x
 > 0Ë
off
 = -dúmu…*
MIN_DIST
;

369 
off
 = -
dúmu…
*(
MIN_DIST
+
	`Ábs
(
to
->
x
));

370 *
num_poöts
 = 5;

371 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

372 
ps
[1].
y
 = -
MIN_DIST
;

373 
ps
[2].
x
 = 
off
;

374 
ps
[2].
y
 = -
MIN_DIST
;

375 
ps
[3].
x
 = 
off
;

376 
ps
[3].
y
 = 
to
->y;

377 
ps
[4] = *
to
;

380 i‡(
dúmu…
*
to
->
x
 > 2*
MIN_DIST
) {

381 
ªÆ
 
mid
 = 
to
->
x
/2;

382 *
num_poöts
 = 5;

383 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

384 
ps
[1].
y
 = -
MIN_DIST
;

385 
ps
[2].
x
 = 
mid
;

386 
ps
[2].
y
 = -
MIN_DIST
;

387 
ps
[3].
x
 = 
mid
;

388 
ps
[3].
y
 = 
to
->y;

389 
ps
[4] = *
to
;

391 
ªÆ
 
off
;

392 i‡(
dúmu…
*
to
->
x
 > 0Ë
off
 = -dúmu…*
MIN_DIST
;

393 
off
 = -
dúmu…
*(
MIN_DIST
+
	`Ábs
(
to
->
x
));

394 *
num_poöts
 = 5;

395 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

396 
ps
[1].
y
 = -
MIN_DIST
;

397 
ps
[2].
x
 = 
off
;

398 
ps
[2].
y
 = -
MIN_DIST
;

399 
ps
[3].
x
 = 
off
;

400 
ps
[3].
y
 = 
to
->y;

401 
ps
[4] = *
to
;

407 *
poöts
 = 
ps
;

408  
	`ˇlcuœã_bad√ss
(
ps
, *
num_poöts
);

409 
	}
}

420 
ªÆ


421 
	$aut‹ouã_œyout_›posôe
(
Poöt
 *
to
, 
guöt
 *
num_poöts
, Poöà**
poöts
)

423 
Poöt
 *
ps
 = 
NULL
;

424 i‡(
to
->
y
 < -
MIN_DIST
) {

425 *
num_poöts
 = 4;

426 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

427 i‡(
	`Ábs
(
to
->
x
) < 0.00000001) {

428 
ps
[2] =Ös[3] = *
to
;

429 *
poöts
 = 
ps
;

430  
	`Àngth_bad√ss
(
	`Ábs
(
to
->
y
))+2*
EXTRA_SEGMENT_BADNESS
;

432 
ªÆ
 
mid
 = 
to
->
y
/2;

437 
ps
[1].
y
 = 
mid
;

438 
ps
[2].
x
 = 
to
->x;

439 
ps
[2].
y
 = 
mid
;

440 
ps
[3] = *
to
;

441 *
poöts
 = 
ps
;

442  2*
	`Àngth_bad√ss
(
	`Ábs
(
mid
))+2*
EXTRA_SEGMENT_BADNESS
;

444 } i‡(
	`Ábs
(
to
->
x
Ë> 2*
MIN_DIST
) {

445 
ªÆ
 
mid
 = 
to
->
x
/2;

449 *
num_poöts
 = 6;

450 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

452 
ps
[1].
y
 = -
MIN_DIST
;

453 
ps
[2].
x
 = 
mid
;

454 
ps
[2].
y
 = -
MIN_DIST
;

455 
ps
[3].
x
 = 
mid
;

456 
ps
[3].
y
 = 
to
->y+
MIN_DIST
;

457 
ps
[4].
x
 = 
to
->x;

458 
ps
[4].
y
 = 
to
->y+
MIN_DIST
;

459 
ps
[5] = *
to
;

461 
ªÆ
 
off
 = 
MIN_DIST
*(
to
->
x
>0?-1.0:1.0);

465 *
num_poöts
 = 6;

466 
ps
 = 
	`g_√w0
(
Poöt
, *
num_poöts
);

467 
ps
[1].
y
 = -
MIN_DIST
;

468 
ps
[2].
x
 = 
off
;

469 
ps
[2].
y
 = -
MIN_DIST
;

470 
ps
[3].
x
 = 
off
;

471 
ps
[3].
y
 = 
to
->y+
MIN_DIST
;

472 
ps
[4].
x
 = 
to
->x;

473 
ps
[4].
y
 = 
to
->y+
MIN_DIST
;

474 
ps
[5] = *
to
;

476 *
poöts
 = 
ps
;

477  
	`ˇlcuœã_bad√ss
(
ps
, *
num_poöts
);

478 
	}
}

484 
	$poöt_rŸ©e_cw
(
Poöt
 *
p
)

486 
ªÆ
 
tmp
 = 
p
->
x
;

487 
p
->
x
 = -p->
y
;

488 
p
->
y
 = 
tmp
;

489 
	}
}

495 
	$poöt_rŸ©e_ccw
(
Poöt
 *
p
)

497 
ªÆ
 
tmp
 = 
p
->
x
;

498 
p
->
x
 =Ö->
y
;

499 
p
->
y
 = -
tmp
;

500 
	}
}

506 
	$poöt_rŸ©e_180
(
Poöt
 *
p
)

508 
p
->
x
 = -p->x;

509 
p
->
y
 = -p->y;

510 
	}
}

521 
guöt


522 
	$autﬁayout_n‹mÆize_poöts
(
guöt
 
°¨tdú
, guöà
íddú
,

523 
Poöt
 
°¨t
, Poöà
íd
, Poöà*
√wíd
)

525 
√wíd
->
x
 = 
íd
.x-
°¨t
.x;

526 
√wíd
->
y
 = 
íd
.y-
°¨t
.y;

527 i‡(
°¨tdú
 =
DIR_NORTH
) {

528  
íddú
;

529 } i‡(
°¨tdú
 =
DIR_EAST
) {

530 
	`poöt_rŸ©e_ccw
(
√wíd
);

531 i‡(
íddú
 =
DIR_NORTH
Ë 
DIR_WEST
;

532  
íddú
/2;

533 } i‡(
°¨tdú
 =
DIR_WEST
) {

534 
	`poöt_rŸ©e_cw
(
√wíd
);

535 i‡(
íddú
 =
DIR_WEST
Ë 
DIR_NORTH
;

536  
íddú
*2;

538 
	`poöt_rŸ©e_180
(
√wíd
);

539 i‡(
íddú
 < 
DIR_SOUTH
) Énddir*4;

540  
íddú
/4;

543  
íddú
;

544 
	}
}

557 
Poöt
 *

558 
	$autﬁayout_u¬‹mÆize_poöts
(
guöt
 
°¨tdú
,

559 
Poöt
 
°¨t
,

560 
Poöt
 *
poöts
,

561 
guöt
 
num_poöts
)

563 
Poöt
 *
√wpoöts
 = 
	`g_√w
(Poöt, 
num_poöts
);

564 
guöt
 
i
;

565 i‡(
°¨tdú
 =
DIR_NORTH
) {

566 
i
 = 0; i < 
num_poöts
; i++) {

567 
√wpoöts
[
i
] = 
poöts
[i];

568 
	`poöt_add
(&
√wpoöts
[
i
], &
°¨t
);

570 } i‡(
°¨tdú
 =
DIR_WEST
) {

571 
i
 = 0; i < 
num_poöts
; i++) {

572 
√wpoöts
[
i
] = 
poöts
[i];

573 
	`poöt_rŸ©e_ccw
(&
√wpoöts
[
i
]);

574 
	`poöt_add
(&
√wpoöts
[
i
], &
°¨t
);

576 } i‡(
°¨tdú
 =
DIR_SOUTH
) {

577 
i
 = 0; i < 
num_poöts
; i++) {

578 
√wpoöts
[
i
] = 
poöts
[i];

579 
	`poöt_rŸ©e_180
(&
√wpoöts
[
i
]);

580 
	`poöt_add
(&
√wpoöts
[
i
], &
°¨t
);

582 } i‡(
°¨tdú
 =
DIR_EAST
) {

583 
i
 = 0; i < 
num_poöts
; i++) {

584 
√wpoöts
[
i
] = 
poöts
[i];

585 
	`poöt_rŸ©e_cw
(&
√wpoöts
[
i
]);

586 
	`poöt_add
(&
√wpoöts
[
i
], &
°¨t
);

589 
	`g_‰ì
(
poöts
);

590  
√wpoöts
;

591 
	}
}

	@O:\tool\dvs50\lib\autoroute.h

21 #i‚de‡
AUTOROUTE_H


22 
	#AUTOROUTE_H


	)

24 
	~"düty≥s.h
"

25 
	~<gdk/gdk.h
>

27 
gboﬁón
 
aut‹ouã_œyout_‹thc⁄n
(
OπhC⁄n
 *
c⁄n
,

28 
C⁄√˘i⁄Poöt
 *
°¨tc⁄n
, C⁄√˘i⁄Poöà*
ídc⁄n
);

	@O:\tool\dvs50\lib\bezier_conn.c

23 
	~<c⁄fig.h
>

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<m©h.h
>

28 
	~<°rög.h
>

30 
	~"bezõr_c⁄n.h
"

31 
	~"öé.h
"

32 
	~"mesßge.h
"

33 
	~"düªndîî.h
"

35 
	#HANDLE_BEZMAJOR
 (
HANDLE_CUSTOM1
)

	)

36 
	#HANDLE_LEFTCTRL
 (
HANDLE_CUSTOM2
)

	)

37 
	#HANDLE_RIGHTCTRL
 (
HANDLE_CUSTOM3
)

	)

39 
	ech™ge_ty≥
 {

40 
	mTYPE_ADD_POINT
,

41 
	mTYPE_REMOVE_POINT


44 
	sPoötCh™ge
 {

45 
Obje˘Ch™ge
 
	mobj_ch™ge
;

47 
ch™ge_ty≥
 
	mty≥
;

48 
	m≠∂õd
;

50 
BezPoöt
 
	mpoöt
;

51 
BezC‹√rTy≥
 
	mc‹√r_ty≥
;

52 
	mpos
;

55 
H™dÀ
 *
	mh™dÀ1
, *
	mh™dÀ2
, *
	mh™dÀ3
;

57 
C⁄√˘i⁄Poöt
 *
	mc⁄√˘ed_to1
, *
	mc⁄√˘ed_to2
, *
	mc⁄√˘ed_to3
;

60 
	sC‹√rCh™ge
 {

61 
Obje˘Ch™ge
 
	mobj_ch™ge
;

63 
	m≠∂õd
;

65 
H™dÀ
 *
	mh™dÀ
;

67 
Poöt
 
	mpoöt_À·
, 
	mpoöt_right
;

68 
BezC‹√rTy≥
 
	mﬁd_ty≥
, 
	m√w_ty≥
;

71 
Obje˘Ch™ge
 *

72 
bezõrc⁄n_¸óã_poöt_ch™ge
(
BezõrC⁄n
 *
bez
, 
ch™ge_ty≥
 
ty≥
,

73 
BezPoöt
 *
poöt
, 
BezC‹√rTy≥
 
c‹√r_ty≥
,

74 
£gmít
,

75 
H™dÀ
 *
h™dÀ1
, 
C⁄√˘i⁄Poöt
 *
c⁄√˘ed_to1
,

76 
H™dÀ
 *
h™dÀ2
, 
C⁄√˘i⁄Poöt
 *
c⁄√˘ed_to2
,

77 
H™dÀ
 *
h™dÀ3
, 
C⁄√˘i⁄Poöt
 *
c⁄√˘ed_to3
);

78 
Obje˘Ch™ge
 *

79 
bezõrc⁄n_¸óã_c‹√r_ch™ge
(
BezõrC⁄n
 *
bez
, 
H™dÀ
 *
h™dÀ
,

80 
Poöt
 *
poöt_À·
, Poöà*
poöt_right
,

81 
BezC‹√rTy≥
 
ﬁd_c‹√r_ty≥
,

82 
BezC‹√rTy≥
 
√w_c‹√r_ty≥
);

89 
	$£tup_h™dÀ
(
H™dÀ
 *
h™dÀ
, 
H™dÀId
 
id
)

91 
h™dÀ
->
id
 = id;

92 
h™dÀ
->
ty≥
 = 
HANDLE_MINOR_CONTROL
;

93 
h™dÀ
->
c⁄√˘_ty≥
 = (
id
 =
HANDLE_BEZMAJOR
) ?

94 
HANDLE_CONNECTABLE
 : 
HANDLE_NONCONNECTABLE
;

95 
h™dÀ
->
c⁄√˘ed_to
 = 
NULL
;

96 
	}
}

105 
	$gë_h™dÀ_ƒ
(
BezõrC⁄n
 *
bez
, 
H™dÀ
 *
h™dÀ
)

107 
i
 = 0;

108 
i
=0;i<
bez
->
obje˘
.
num_h™dÀs
;i++) {

109 i‡(
bez
->
obje˘
.
h™dÀs
[
i
] =
h™dÀ
)

110  
i
;

113 
	}
}

115 
√w_h™dÀs
(
BezõrC⁄n
 *
bez
, 
num_poöts
);

117 
	#gë_comp_ƒ
(
hnum
Ë((()(hnum)+2)/3)

	)

118 
	#gë_maj‹_ƒ
(
hnum
Ë((()(hnum)+1)/3)

	)

132 
Obje˘Ch™ge
*

133 
	$bezõrc⁄n_move_h™dÀ
(
BezõrC⁄n
 *
bez
, 
H™dÀ
 *
h™dÀ
,

134 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

135 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

137 
h™dÀ_ƒ
, 
comp_ƒ
;

138 
Poöt
 
dñè
, 
±
;

140 
dñè
 = *
to
;

141 
	`poöt_sub
(&
dñè
, &
h™dÀ
->
pos
);

143 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
bez
, 
h™dÀ
);

144 
comp_ƒ
 = 
	`gë_comp_ƒ
(
h™dÀ_ƒ
);

145 
h™dÀ
->
id
) {

146 
HANDLE_MOVE_STARTPOINT
:

147 
bez
->
poöts
[0].
p1
 = *
to
;

149 
	`poöt_add
(&
bez
->
poöts
[1].
p1
, &
dñè
);

151 
HANDLE_MOVE_ENDPOINT
:

152 
bez
->
poöts
[bez->
numpoöts
-1].
p3
 = *
to
;

154 
	`poöt_add
(&
bez
->
poöts
[bez->
numpoöts
-1].
p2
, &
dñè
);

156 
HANDLE_BEZMAJOR
:

157 
bez
->
poöts
[
comp_ƒ
].
p3
 = *
to
;

159 
	`poöt_add
(&
bez
->
poöts
[
comp_ƒ
].
p2
, &
dñè
);

160 
	`poöt_add
(&
bez
->
poöts
[
comp_ƒ
+1].
p1
, &
dñè
);

162 
HANDLE_LEFTCTRL
:

163 
bez
->
poöts
[
comp_ƒ
].
p2
 = *
to
;

164 i‡(
comp_ƒ
 < 
bez
->
numpoöts
 - 1) {

165 
bez
->
c‹√r_ty≥s
[
comp_ƒ
]) {

166 
BEZ_CORNER_SYMMETRIC
:

167 
±
 = 
bez
->
poöts
[
comp_ƒ
].
p3
;

168 
	`poöt_sub
(&
±
, &
bez
->
poöts
[
comp_ƒ
].
p2
);

169 
	`poöt_add
(&
±
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

170 
bez
->
poöts
[
comp_ƒ
+1].
p1
 = 
±
;

172 
BEZ_CORNER_SMOOTH
: {

173 
ªÆ
 
Àn
;

174 
±
 = 
bez
->
poöts
[
comp_ƒ
+1].
p1
;

175 
	`poöt_sub
(&
±
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

176 
Àn
 = 
	`poöt_Àn
(&
±
);

177 
±
 = 
bez
->
poöts
[
comp_ƒ
].
p2
;

178 
	`poöt_sub
(&
±
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

179 i‡(
	`poöt_Àn
(&
±
) > 0)

180 
	`poöt_n‹mÆize
(&
±
);

181 { 
±
.
x
 = 1.0;Öt.
y
 = 0.0; }

182 
	`poöt_sˇÀ
(&
±
, -
Àn
);

183 
	`poöt_add
(&
±
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

184 
bez
->
poöts
[
comp_ƒ
+1].
p1
 = 
±
;

187 
BEZ_CORNER_CUSP
:

193 
HANDLE_RIGHTCTRL
:

194 
bez
->
poöts
[
comp_ƒ
].
p1
 = *
to
;

195 i‡(
comp_ƒ
 > 1) {

196 
bez
->
c‹√r_ty≥s
[
comp_ƒ
-1]) {

197 
BEZ_CORNER_SYMMETRIC
:

198 
±
 = 
bez
->
poöts
[
comp_ƒ
 - 1].
p3
;

199 
	`poöt_sub
(&
±
, &
bez
->
poöts
[
comp_ƒ
].
p1
);

200 
	`poöt_add
(&
±
, &
bez
->
poöts
[
comp_ƒ
 - 1].
p3
);

201 
bez
->
poöts
[
comp_ƒ
-1].
p2
 = 
±
;

203 
BEZ_CORNER_SMOOTH
: {

204 
ªÆ
 
Àn
;

205 
±
 = 
bez
->
poöts
[
comp_ƒ
-1].
p2
;

206 
	`poöt_sub
(&
±
, &
bez
->
poöts
[
comp_ƒ
-1].
p3
);

207 
Àn
 = 
	`poöt_Àn
(&
±
);

208 
±
 = 
bez
->
poöts
[
comp_ƒ
].
p1
;

209 
	`poöt_sub
(&
±
, &
bez
->
poöts
[
comp_ƒ
-1].
p3
);

210 i‡(
	`poöt_Àn
(&
±
) > 0)

211 
	`poöt_n‹mÆize
(&
±
);

212 { 
±
.
x
 = 1.0;Öt.
y
 = 0.0; }

213 
	`poöt_sˇÀ
(&
±
, -
Àn
);

214 
	`poöt_add
(&
±
, &
bez
->
poöts
[
comp_ƒ
-1].
p3
);

215 
bez
->
poöts
[
comp_ƒ
-1].
p2
 = 
±
;

218 
BEZ_CORNER_CUSP
:

225 
	`mesßge_îr‹
("InternalÉrror in bezierconn_move_handle.\n");

228  
NULL
;

229 
	}
}

238 
Obje˘Ch™ge
*

239 
	$bezõrc⁄n_move
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
to
)

241 
Poöt
 
p
;

242 
i
;

244 
p
 = *
to
;

245 
	`poöt_sub
(&
p
, &
bez
->
poöts
[0].
p1
);

247 
bez
->
poöts
[0].
p1
 = *
to
;

248 
i
 = 1; i < 
bez
->
numpoöts
; i++) {

249 
	`poöt_add
(&
bez
->
poöts
[
i
].
p1
, &
p
);

250 
	`poöt_add
(&
bez
->
poöts
[
i
].
p2
, &
p
);

251 
	`poöt_add
(&
bez
->
poöts
[
i
].
p3
, &
p
);

253  
NULL
;

254 
	}
}

264 
	$bezõrc⁄n_˛o£°_£gmít
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

266 
Poöt
 
œ°
;

267 
i
;

268 
ªÆ
 
di°
 = 
G_MAXDOUBLE
;

269 
˛o£°
;

271 
˛o£°
 = 0;

272 
œ°
 = 
bez
->
poöts
[0].
p1
;

273 
i
 = 0; i < 
bez
->
numpoöts
 - 1; i++) {

274 
ªÆ
 
√w_di°
 = 
	`di°™˚_bez_£g_poöt
(&
œ°
, &
bez
->
poöts
[
i
+1].
p1
,

275 &
bez
->
poöts
[
i
+1].
p2
, &bez->poöts[i+1].
p3
,

276 
löe_width
, 
poöt
);

277 i‡(
√w_di°
 < 
di°
) {

278 
di°
 = 
√w_di°
;

279 
˛o£°
 = 
i
;

281 
œ°
 = 
bez
->
poöts
[
i
+1].
p3
;

283  
˛o£°
;

284 
	}
}

292 
H™dÀ
 *

293 
	$bezõrc⁄n_˛o£°_h™dÀ
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
poöt
)

295 
i
, 
hn
;

296 
ªÆ
 
di°
;

297 
H™dÀ
 *
˛o£°
;

299 
˛o£°
 = 
bez
->
obje˘
.
h™dÀs
[0];

300 
di°
 = 
	`di°™˚_poöt_poöt
–
poöt
, &
˛o£°
->
pos
);

301 
i
 = 1, 
hn
 = 1; i < 
bez
->
numpoöts
; i++, hn++) {

302 
ªÆ
 
√w_di°
;

304 
√w_di°
 = 
	`di°™˚_poöt_poöt
(
poöt
, &
bez
->
poöts
[
i
].
p1
);

305 i‡(
√w_di°
 < 
di°
) {

306 
di°
 = 
√w_di°
;

307 
˛o£°
 = 
bez
->
obje˘
.
h™dÀs
[
hn
];

309 
hn
++;

311 
√w_di°
 = 
	`di°™˚_poöt_poöt
(
poöt
, &
bez
->
poöts
[
i
].
p2
);

312 i‡(
√w_di°
 < 
di°
) {

313 
di°
 = 
√w_di°
;

314 
˛o£°
 = 
bez
->
obje˘
.
h™dÀs
[
hn
];

316 
hn
++;

318 
√w_di°
 = 
	`di°™˚_poöt_poöt
(
poöt
, &
bez
->
poöts
[
i
].
p3
);

319 i‡(
√w_di°
 < 
di°
) {

320 
di°
 = 
√w_di°
;

321 
˛o£°
 = 
bez
->
obje˘
.
h™dÀs
[
hn
];

324  
˛o£°
;

325 
	}
}

338 
H™dÀ
 *

339 
	$bezõrc⁄n_˛o£°_maj‹_h™dÀ
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
poöt
)

341 
H™dÀ
 *
˛o£°
 = 
	`bezõrc⁄n_˛o£°_h™dÀ
(
bez
, 
poöt
);

343  
bez
->
obje˘
.
h™dÀs
[3*
	`gë_maj‹_ƒ
(
	`gë_h™dÀ_ƒ
(bez, 
˛o£°
))];

344 
	}
}

352 
ªÆ


353 
	$bezõrc⁄n_di°™˚_‰om
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

355  
	`di°™˚_bez_löe_poöt
(
bez
->
poöts
, bez->
numpoöts
,

356 
löe_width
, 
poöt
);

357 
	}
}

371 
	$add_h™dÀs
(
BezõrC⁄n
 *
bez
, 
pos
, 
BezPoöt
 *
poöt
,

372 
BezC‹√rTy≥
 
c‹√r_ty≥
, 
H™dÀ
 *
h™dÀ1
,

373 
H™dÀ
 *
h™dÀ2
, H™dÀ *
h™dÀ3
)

375 
i
;

376 
DüObje˘
 *
obj
;

378 
	`g_as£π
(
pos
 > 0);

380 
obj
 = (
DüObje˘
 *)
bez
;

381 
bez
->
numpoöts
++;

382 
bez
->
poöts
 = 
	`g_ªÆloc
(bez->poöts, bez->
numpoöts
*(
BezPoöt
));

383 
bez
->
c‹√r_ty≥s
 = 
	`g_ªÆloc
(bez->corner_types,

384 
bez
->
numpoöts
 * (
BezC‹√rTy≥
));

386 
i
 = 
bez
->
numpoöts
-1; i > 
pos
; i--) {

387 
bez
->
poöts
[
i
] = bez->points[i-1];

388 
bez
->
c‹√r_ty≥s
[
i
] = bez->corner_types[i-1];

390 
bez
->
poöts
[
pos
] = *
poöt
;

391 
bez
->
poöts
[
pos
].
p1
 = bez->points[pos+1].p1;

392 
bez
->
poöts
[
pos
+1].
p1
 = 
poöt
->p1;

393 
bez
->
c‹√r_ty≥s
[
pos
] = 
c‹√r_ty≥
;

394 
	`obje˘_add_h™dÀ_©
(
obj
, 
h™dÀ1
, 3*
pos
-2);

395 
	`obje˘_add_h™dÀ_©
(
obj
, 
h™dÀ2
, 3*
pos
-1);

396 
	`obje˘_add_h™dÀ_©
(
obj
, 
h™dÀ3
, 3*
pos
);

398 i‡(
pos
==
bez
->
numpoöts
-1) {

399 
obj
->
h™dÀs
[obj->
num_h™dÀs
-4]->
ty≥
 = 
HANDLE_MINOR_CONTROL
;

400 
obj
->
h™dÀs
[obj->
num_h™dÀs
-4]->
id
 = 
HANDLE_BEZMAJOR
;

402 
	}
}

410 
	$ªmove_h™dÀs
(
BezõrC⁄n
 *
bez
, 
pos
)

412 
i
;

413 
DüObje˘
 *
obj
;

414 
H™dÀ
 *
ﬁd_h™dÀ1
, *
ﬁd_h™dÀ2
, *
ﬁd_h™dÀ3
;

415 
Poöt
 
tmµoöt
;

417 
	`g_as£π
(
pos
 > 0);

419 
obj
 = (
DüObje˘
 *)
bez
;

421 i‡(
pos
==
obj
->
num_h™dÀs
-1) {

422 
obj
->
h™dÀs
[obj->
num_h™dÀs
-4]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

423 
obj
->
h™dÀs
[obj->
num_h™dÀs
-4]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

427 
bez
->
numpoöts
--;

428 
tmµoöt
 = 
bez
->
poöts
[
pos
].
p1
;

429 
i
 = 
pos
; i < 
bez
->
numpoöts
; i++) {

430 
bez
->
poöts
[
i
] = bez->points[i+1];

431 
bez
->
c‹√r_ty≥s
[
i
] = bez->corner_types[i+1];

433 
bez
->
poöts
[
pos
].
p1
 = 
tmµoöt
;

434 
bez
->
poöts
 = 
	`g_ªÆloc
(bez->poöts, bez->
numpoöts
*(
BezPoöt
));

435 
bez
->
c‹√r_ty≥s
 = 
	`g_ªÆloc
(bez->corner_types,

436 
bez
->
numpoöts
 * (
BezC‹√rTy≥
));

438 
ﬁd_h™dÀ1
 = 
obj
->
h™dÀs
[3*
pos
-2];

439 
ﬁd_h™dÀ2
 = 
obj
->
h™dÀs
[3*
pos
-1];

440 
ﬁd_h™dÀ3
 = 
obj
->
h™dÀs
[3*
pos
];

441 
	`obje˘_ªmove_h™dÀ
(&
bez
->
obje˘
, 
ﬁd_h™dÀ1
);

442 
	`obje˘_ªmove_h™dÀ
(&
bez
->
obje˘
, 
ﬁd_h™dÀ2
);

443 
	`obje˘_ªmove_h™dÀ
(&
bez
->
obje˘
, 
ﬁd_h™dÀ3
);

444 
	}
}

455 
Obje˘Ch™ge
 *

456 
	$bezõrc⁄n_add_£gmít
(
BezõrC⁄n
 *
bez
, 
£gmít
, 
Poöt
 *
poöt
)

458 
BezPoöt
 
ªÆpoöt
;

459 
BezC‹√rTy≥
 
c‹√r_ty≥
 = 
BEZ_CORNER_SYMMETRIC
;

460 
H™dÀ
 *
√w_h™dÀ1
, *
√w_h™dÀ2
, *
√w_h™dÀ3
;

461 
Poöt
 
°¨çoöt
;

463 i‡(
£gmít
 == 0)

464 
°¨çoöt
 = 
bez
->
poöts
[0].
p1
;

466 
°¨çoöt
 = 
bez
->
poöts
[
£gmít
].
p3
;

468 i‡(
poöt
 =
NULL
) {

469 
ªÆpoöt
.
p1
.
x
 = (
°¨çoöt
.x + 
bez
->
poöts
[
£gmít
+1].
p3
.x) / 6;

470 
ªÆpoöt
.
p1
.
y
 = (
°¨çoöt
.y + 
bez
->
poöts
[
£gmít
+1].
p3
.y) / 6;

471 
ªÆpoöt
.
p2
.
x
 = (
°¨çoöt
.x + 
bez
->
poöts
[
£gmít
+1].
p3
.x) / 3;

472 
ªÆpoöt
.
p2
.
y
 = (
°¨çoöt
.y + 
bez
->
poöts
[
£gmít
+1].
p3
.y) / 3;

473 
ªÆpoöt
.
p3
.
x
 = (
°¨çoöt
.x + 
bez
->
poöts
[
£gmít
+1].p3.x) / 2;

474 
ªÆpoöt
.
p3
.
y
 = (
°¨çoöt
.y + 
bez
->
poöts
[
£gmít
+1].p3.y) / 2;

476 
ªÆpoöt
.
p2
.
x
 = 
poöt
->x+(
°¨çoöt
.x - 
bez
->
poöts
[
£gmít
+1].
p3
.x)/6;

477 
ªÆpoöt
.
p2
.
y
 = 
poöt
->y+(
°¨çoöt
.y - 
bez
->
poöts
[
£gmít
+1].
p3
.y)/6;

478 
ªÆpoöt
.
p3
 = *
poöt
;

480 
ªÆpoöt
.
p1
.
x
 = 
poöt
->x-(
°¨çoöt
.x - 
bez
->
poöts
[
£gmít
+1].
p3
.x)/6;

481 
ªÆpoöt
.
p1
.
y
 = 
poöt
->y-(
°¨çoöt
.y - 
bez
->
poöts
[
£gmít
+1].
p3
.y)/6;

483 
ªÆpoöt
.
ty≥
 = 
BEZ_CURVE_TO
;

485 
√w_h™dÀ1
 = 
	`g_√w0
(
H™dÀ
,1);

486 
√w_h™dÀ2
 = 
	`g_√w0
(
H™dÀ
,1);

487 
√w_h™dÀ3
 = 
	`g_√w0
(
H™dÀ
,1);

488 
	`£tup_h™dÀ
(
√w_h™dÀ1
, 
HANDLE_RIGHTCTRL
);

489 
	`£tup_h™dÀ
(
√w_h™dÀ2
, 
HANDLE_LEFTCTRL
);

490 
	`£tup_h™dÀ
(
√w_h™dÀ3
, 
HANDLE_BEZMAJOR
);

491 
	`add_h™dÀs
(
bez
, 
£gmít
+1, &
ªÆpoöt
, 
c‹√r_ty≥
,

492 
√w_h™dÀ1
, 
√w_h™dÀ2
, 
√w_h™dÀ3
);

493  
	`bezõrc⁄n_¸óã_poöt_ch™ge
(
bez
, 
TYPE_ADD_POINT
,

494 &
ªÆpoöt
, 
c‹√r_ty≥
, 
£gmít
+1,

495 
√w_h™dÀ1
, 
NULL
,

496 
√w_h™dÀ2
, 
NULL
,

497 
√w_h™dÀ3
, 
NULL
);

498 
	}
}

505 
Obje˘Ch™ge
 *

506 
	$bezõrc⁄n_ªmove_£gmít
(
BezõrC⁄n
 *
bez
, 
pos
)

508 
H™dÀ
 *
ﬁd_h™dÀ1
, *
ﬁd_h™dÀ2
, *
ﬁd_h™dÀ3
;

509 
C⁄√˘i⁄Poöt
 *
˝t1
, *
˝t2
, *
˝t3
;

510 
BezPoöt
 
ﬁd_poöt
;

511 
BezC‹√rTy≥
 
ﬁd_˘y≥
;

513 
	`g_as£π
(
pos
 > 0);

514 
	`g_as£π
(
bez
->
numpoöts
 > 2);

516 i‡(
pos
 =
bez
->
numpoöts
-1)Öos--;

518 
ﬁd_h™dÀ1
 = 
bez
->
obje˘
.
h™dÀs
[3*
pos
-2];

519 
ﬁd_h™dÀ2
 = 
bez
->
obje˘
.
h™dÀs
[3*
pos
-1];

520 
ﬁd_h™dÀ3
 = 
bez
->
obje˘
.
h™dÀs
[3*
pos
];

521 
ﬁd_poöt
 = 
bez
->
poöts
[
pos
];

522 
ﬁd_˘y≥
 = 
bez
->
c‹√r_ty≥s
[
pos
];

524 
˝t1
 = 
ﬁd_h™dÀ1
->
c⁄√˘ed_to
;

525 
˝t2
 = 
ﬁd_h™dÀ2
->
c⁄√˘ed_to
;

526 
˝t3
 = 
ﬁd_h™dÀ3
->
c⁄√˘ed_to
;

528 
	`obje˘_unc⁄√˘
((
DüObje˘
 *)
bez
, 
ﬁd_h™dÀ1
);

529 
	`obje˘_unc⁄√˘
((
DüObje˘
 *)
bez
, 
ﬁd_h™dÀ2
);

530 
	`obje˘_unc⁄√˘
((
DüObje˘
 *)
bez
, 
ﬁd_h™dÀ3
);

532 
	`ªmove_h™dÀs
(
bez
, 
pos
);

534 
	`bezõrc⁄n_upd©e_d©a
(
bez
);

536  
	`bezõrc⁄n_¸óã_poöt_ch™ge
(
bez
, 
TYPE_REMOVE_POINT
,

537 &
ﬁd_poöt
, 
ﬁd_˘y≥
, 
pos
,

538 
ﬁd_h™dÀ1
, 
˝t1
,

539 
ﬁd_h™dÀ2
, 
˝t2
,

540 
ﬁd_h™dÀ3
, 
˝t3
);

541 
	}
}

551 
	$bezõrc⁄n_°øighãn_c‹√r
(
BezõrC⁄n
 *
bez
, 
comp_ƒ
)

556 
bez
->
c‹√r_ty≥s
[
comp_ƒ
]) {

557 
BEZ_CORNER_SYMMETRIC
: {

558 
Poöt
 
±1
, 
±2
;

559 
±1
 = 
bez
->
poöts
[
comp_ƒ
].
p3
;

560 
	`poöt_sub
(&
±1
, &
bez
->
poöts
[
comp_ƒ
].
p2
);

561 
±2
 = 
bez
->
poöts
[
comp_ƒ
].
p3
;

562 
	`poöt_sub
(&
±2
, &
bez
->
poöts
[
comp_ƒ
+1].
p1
);

563 
	`poöt_sˇÀ
(&
±2
, -1.0);

564 
	`poöt_add
(&
±1
, &
±2
);

565 
	`poöt_sˇÀ
(&
±1
, 0.5);

566 
±2
 = 
±1
;

567 
	`poöt_sˇÀ
(&
±1
, -1.0);

568 
	`poöt_add
(&
±1
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

569 
	`poöt_add
(&
±2
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

570 
bez
->
poöts
[
comp_ƒ
].
p2
 = 
±1
;

571 
bez
->
poöts
[
comp_ƒ
+1].
p1
 = 
±2
;

572 
	`bezõrc⁄n_upd©e_d©a
(
bez
);

575 
BEZ_CORNER_SMOOTH
: {

576 
Poöt
 
±1
, 
±2
;

577 
ªÆ
 
Àn1
, 
Àn2
;

578 
±1
 = 
bez
->
poöts
[
comp_ƒ
].
p3
;

579 
	`poöt_sub
(&
±1
, &
bez
->
poöts
[
comp_ƒ
].
p2
);

580 
±2
 = 
bez
->
poöts
[
comp_ƒ
].
p3
;

581 
	`poöt_sub
(&
±2
, &
bez
->
poöts
[
comp_ƒ
+1].
p1
);

582 
Àn1
 = 
	`poöt_Àn
(&
±1
);

583 
Àn2
 = 
	`poöt_Àn
(&
±2
);

584 
	`poöt_sˇÀ
(&
±2
, -1.0);

585 i‡(
Àn1
 > 0)

586 
	`poöt_n‹mÆize
(&
±1
);

587 i‡(
Àn2
 > 0)

588 
	`poöt_n‹mÆize
(&
±2
);

589 
	`poöt_add
(&
±1
, &
±2
);

590 
	`poöt_sˇÀ
(&
±1
, 0.5);

591 
±2
 = 
±1
;

592 
	`poöt_sˇÀ
(&
±1
, -
Àn1
);

593 
	`poöt_add
(&
±1
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

594 
	`poöt_sˇÀ
(&
±2
, 
Àn2
);

595 
	`poöt_add
(&
±2
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

596 
bez
->
poöts
[
comp_ƒ
].
p2
 = 
±1
;

597 
bez
->
poöts
[
comp_ƒ
+1].
p1
 = 
±2
;

598 
	`bezõrc⁄n_upd©e_d©a
(
bez
);

601 
BEZ_CORNER_CUSP
:

604 
	}
}

612 
Obje˘Ch™ge
 *

613 
	$bezõrc⁄n_£t_c‹√r_ty≥
(
BezõrC⁄n
 *
bez
, 
H™dÀ
 *
h™dÀ
,

614 
BezC‹√rTy≥
 
c‹√r_ty≥
)

616 
H™dÀ
 *
mid_h™dÀ
;

617 
Poöt
 
ﬁd_À·
, 
ﬁd_right
;

618 
ﬁd_ty≥
;

619 
h™dÀ_ƒ
, 
comp_ƒ
;

621 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
bez
, 
h™dÀ
);

623 
h™dÀ
->
id
) {

624 
HANDLE_BEZMAJOR
:

625 
mid_h™dÀ
 = 
h™dÀ
;

627 
HANDLE_LEFTCTRL
:

628 
h™dÀ_ƒ
++;

629 
mid_h™dÀ
 = 
bez
->
obje˘
.
h™dÀs
[
h™dÀ_ƒ
];

631 
HANDLE_RIGHTCTRL
:

632 
h™dÀ_ƒ
--;

633 
mid_h™dÀ
 = 
bez
->
obje˘
.
h™dÀs
[
h™dÀ_ƒ
];

636 
	`mesßge_w¨nög
(
	`_
("InternalÉrror: Setting cornerÅype ofÉndpoint of bezier"));

637  
NULL
;

640 
comp_ƒ
 = 
	`gë_maj‹_ƒ
(
h™dÀ_ƒ
);

642 
ﬁd_ty≥
 = 
bez
->
c‹√r_ty≥s
[
comp_ƒ
];

643 
ﬁd_À·
 = 
bez
->
poöts
[
comp_ƒ
].
p2
;

644 
ﬁd_right
 = 
bez
->
poöts
[
comp_ƒ
+1].
p1
;

646 
bez
->
c‹√r_ty≥s
[
comp_ƒ
] = 
c‹√r_ty≥
;

648 
	`bezõrc⁄n_°øighãn_c‹√r
(
bez
, 
comp_ƒ
);

650  
	`bezõrc⁄n_¸óã_c‹√r_ch™ge
(
bez
, 
mid_h™dÀ
, &
ﬁd_À·
, &
ﬁd_right
,

651 
ﬁd_ty≥
, 
c‹√r_ty≥
);

652 
	}
}

658 
	$bezõrc⁄n_upd©e_d©a
(
BezõrC⁄n
 *
bez
)

660 
i
;

661 
DüObje˘
 *
obj
 = &
bez
->
obje˘
;

664 i‡(3*
bez
->
numpoöts
-2 !
obj
->
num_h™dÀs
) {

665 
	`g_as£π
(0 =
obj
->
num_c⁄√˘i⁄s
);

667 
i
 = 0; i < 
obj
->
num_h™dÀs
; i++)

668 
	`g_‰ì
(
obj
->
h™dÀs
[
i
]);

669 
	`g_‰ì
(
obj
->
h™dÀs
);

671 
obj
->
num_h™dÀs
 = 3*
bez
->
numpoöts
-2;

672 
obj
->
h™dÀs
 = 
	`g_√w
(
H™dÀ
*, obj->
num_h™dÀs
);

674 
	`√w_h™dÀs
(
bez
, bez->
numpoöts
);

678 
bez
->
obje˘
.
h™dÀs
[0]->
pos
 = bez->
poöts
[0].
p1
;

679 
i
 = 1; i < 
bez
->
numpoöts
; i++) {

680 
bez
->
obje˘
.
h™dÀs
[3*
i
-2]->
pos
 = bez->
poöts
[i].
p1
;

681 
bez
->
obje˘
.
h™dÀs
[3*
i
-1]->
pos
 = bez->
poöts
[i].
p2
;

682 
bez
->
obje˘
.
h™dÀs
[3*
i
]->
pos
 = bez->
poöts
[i].
p3
;

684 
	}
}

690 
	$bezõrc⁄n_upd©e_boundögbox
(
BezõrC⁄n
 *
bez
)

692 
	`g_as£π
(
bez
 !
NULL
);

694 
	`pﬁybezõr_bbox
(&
bez
->
poöts
[0],

695 
bez
->
numpoöts
,

696 &
bez
->
exåa_•acög
, 
FALSE
,

697 &
bez
->
obje˘
.
boundög_box
);

698 
	}
}

708 
	$bezõrc⁄n_sim∂e_døw
(
BezõrC⁄n
 *
bez
, 
DüRídîî
 *
ªndîî
, 
ªÆ
 
width
)

710 
BezPoöt
 *
poöts
;

712 
	`g_as£π
(
bez
 !
NULL
);

713 
	`g_as£π
(
ªndîî
 !
NULL
);

715 
poöts
 = &
bez
->points[0];

717 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
width
);

718 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

719 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_ROUND
);

720 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

722 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_bezõr
‘ídîî, 
poöts
, 
bez
->
numpoöts
, &
cﬁ‹_bœck
);

723 
	}
}

731 
	$bezõrc⁄n_døw_c⁄åﬁ_löes
(
BezõrC⁄n
 *
bez
, 
DüRídîî
 *
ªndîî
)

733 
Cﬁ‹
 
löe_cﬁour
 = {0.0, 0.0, 0.6};

734 
Poöt
 
°¨çoöt
;

735 
i
;

738 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
(renderer, 0);

739 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_DOTTED
);

740 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_dashÀngth
(renderer, 1);

741 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

742 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

744 
°¨çoöt
 = 
bez
->
poöts
[0].
p1
;

745 
i
 = 1; i < 
bez
->
numpoöts
; i++) {

746 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
°¨çoöt
, &
bez
->
poöts
[
i
].
p1
,

747 &
löe_cﬁour
);

748 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
bez
->
poöts
[
i
].
p2
, &bez->poöts[i].
p3
,

749 &
löe_cﬁour
);

750 
°¨çoöt
 = 
bez
->
poöts
[
i
].
p3
;

752 
	}
}

760 
	$√w_h™dÀs
(
BezõrC⁄n
 *
bez
, 
num_poöts
)

762 
DüObje˘
 *
obj
;

763 
i
;

765 
obj
 = &
bez
->
obje˘
;

767 
obj
->
h™dÀs
[0] = 
	`g_√w0
(
H™dÀ
,1);

768 
obj
->
h™dÀs
[0]->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

769 
obj
->
h™dÀs
[0]->
c⁄√˘ed_to
 = 
NULL
;

770 
obj
->
h™dÀs
[0]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

771 
obj
->
h™dÀs
[0]->
id
 = 
HANDLE_MOVE_STARTPOINT
;

773 
i
 = 1; i < 
num_poöts
; i++) {

774 
obj
->
h™dÀs
[3*
i
-2] = 
	`g_√w0
(
H™dÀ
,1);

775 
obj
->
h™dÀs
[3*
i
-1] = 
	`g_√w0
(
H™dÀ
,1);

776 
obj
->
h™dÀs
[3*
i
] = 
	`g_√w0
(
H™dÀ
,1);

778 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[3*
i
-2], 
HANDLE_RIGHTCTRL
);

779 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[3*
i
-1], 
HANDLE_LEFTCTRL
);

781 
obj
->
h™dÀs
[3*
i
]->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

782 
obj
->
h™dÀs
[3*
i
]->
c⁄√˘ed_to
 = 
NULL
;

783 
obj
->
h™dÀs
[3*
i
]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

784 
obj
->
h™dÀs
[3*
i
]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

786 
	}
}

796 
	$bezõrc⁄n_öô
(
BezõrC⁄n
 *
bez
, 
num_poöts
)

798 
DüObje˘
 *
obj
;

799 
i
;

801 
obj
 = &
bez
->
obje˘
;

803 
	`obje˘_öô
(
obj
, 3*
num_poöts
-2, 0);

805 
bez
->
numpoöts
 = 
num_poöts
;

807 
bez
->
poöts
 = 
	`g_√w
(
BezPoöt
, 
num_poöts
);

808 
bez
->
c‹√r_ty≥s
 = 
	`g_√w
(
BezC‹√rTy≥
, 
num_poöts
);

809 
bez
->
poöts
[0].
ty≥
 = 
BEZ_MOVE_TO
;

810 
bez
->
c‹√r_ty≥s
[0] = 
BEZ_CORNER_SYMMETRIC
;

811 
i
 = 1; i < 
num_poöts
; i++) {

812 
bez
->
poöts
[
i
].
ty≥
 = 
BEZ_CURVE_TO
;

813 
bez
->
c‹√r_ty≥s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

816 
	`√w_h™dÀs
(
bez
, 
num_poöts
);

818 
	`bezõrc⁄n_upd©e_d©a
(
bez
);

819 
	}
}

828 
	$bezõrc⁄n_£t_poöts
(
BezõrC⁄n
 *
bez
, 
num_poöts
, 
BezPoöt
 *
poöts
)

830 
i
;

832 
bez
->
numpoöts
 = 
num_poöts
;

834 i‡(
bez
->
poöts
)

835 
	`g_‰ì
(
bez
->
poöts
);

837 
bez
->
poöts
 = 
	`g_mÆloc
((bez->
numpoöts
)*(
BezPoöt
));

839 
i
=0;i<
bez
->
numpoöts
;i++) {

840 
bez
->
poöts
[
i
] =Öoints[i];

842 
	}
}

850 
	$bezõrc⁄n_c›y
(
BezõrC⁄n
 *
‰om
, BezõrC⁄¿*
to
)

852 
i
;

853 
DüObje˘
 *
toobj
, *
‰omobj
;

855 
toobj
 = &
to
->
obje˘
;

856 
‰omobj
 = &
‰om
->
obje˘
;

858 
	`obje˘_c›y
(
‰omobj
, 
toobj
);

860 
to
->
numpoöts
 = 
‰om
->numpoints;

862 
to
->
poöts
 = 
	`g_√w
(
BezPoöt
,Åo->
numpoöts
);

863 
to
->
c‹√r_ty≥s
 = 
	`g_√w
(
BezC‹√rTy≥
,Åo->
numpoöts
);

865 
i
 = 0; i < 
to
->
numpoöts
; i++) {

866 
to
->
poöts
[
i
] = 
‰om
->points[i];

867 
to
->
c‹√r_ty≥s
[
i
] = 
‰om
->corner_types[i];

870 
to
->
obje˘
.
h™dÀs
[0] = 
	`g_√w0
(
H™dÀ
,1);

871 *
to
->
obje˘
.
h™dÀs
[0] = *
‰om
->object.handles[0];

872 
i
 = 1; i < 
to
->
obje˘
.
num_h™dÀs
 - 1; i++) {

873 
to
->
obje˘
.
h™dÀs
[
i
] = 
	`g_√w0
(
H™dÀ
,1);

874 
	`£tup_h™dÀ
(
to
->
obje˘
.
h™dÀs
[
i
], 
‰om
->obje˘.h™dÀs[i]->
id
);

876 
to
->
obje˘
.
h™dÀs
[to->obje˘.
num_h™dÀs
-1] = 
	`g_√w0
(
H™dÀ
,1);

877 *
to
->
obje˘
.
h™dÀs
[to->obje˘.
num_h™dÀs
-1] =

878 *
‰om
->
obje˘
.
h™dÀs
[
to
->obje˘.
num_h™dÀs
-1];

880 
	`mem˝y
(&
to
->
exåa_•acög
,&
‰om
->extra_spacing,(to->extra_spacing));

881 
	`bezõrc⁄n_upd©e_d©a
(
to
);

882 
	}
}

889 
	$bezõrc⁄n_de°roy
(
BezõrC⁄n
 *
bez
)

891 
i
, 
nh
;

892 
H™dÀ
 **
ãmp_h™dÀs
;

896 
nh
 = 
bez
->
obje˘
.
num_h™dÀs
;

897 
ãmp_h™dÀs
 = 
	`g_√w
(
H™dÀ
 *, 
nh
);

898 
i
 = 0; i < 
nh
; i++)

899 
ãmp_h™dÀs
[
i
] = 
bez
->
obje˘
.
h™dÀs
[i];

901 
	`obje˘_de°roy
(&
bez
->
obje˘
);

903 
i
 = 0; i < 
nh
; i++)

904 
	`g_‰ì
(
ãmp_h™dÀs
[
i
]);

905 
	`g_‰ì
(
ãmp_h™dÀs
);

907 
	`g_‰ì
(
bez
->
poöts
);

908 
	`g_‰ì
(
bez
->
c‹√r_ty≥s
);

909 
	}
}

918 
	$bezõrc⁄n_ßve
(
BezõrC⁄n
 *
bez
, 
Obje˘Node
 
obj_node
)

920 
i
;

921 
AâribuãNode
 
©å
;

923 
	`obje˘_ßve
(&
bez
->
obje˘
, 
obj_node
);

925 
©å
 = 
	`√w_©åibuã
(
obj_node
, "bez_points");

927 
	`d©a_add_poöt
(
©å
, &
bez
->
poöts
[0].
p1
);

928 
i
 = 1; i < 
bez
->
numpoöts
; i++) {

929 
	`d©a_add_poöt
(
©å
, &
bez
->
poöts
[
i
].
p1
);

930 
	`d©a_add_poöt
(
©å
, &
bez
->
poöts
[
i
].
p2
);

931 
	`d©a_add_poöt
(
©å
, &
bez
->
poöts
[
i
].
p3
);

934 
©å
 = 
	`√w_©åibuã
(
obj_node
, "corner_types");

935 
i
 = 0; i < 
bez
->
numpoöts
; i++)

936 
	`d©a_add_íum
(
©å
, 
bez
->
c‹√r_ty≥s
[
i
]);

937 
	}
}

947 
	$bezõrc⁄n_lﬂd
(
BezõrC⁄n
 *
bez
, 
Obje˘Node
 
obj_node
)

949 
i
;

950 
AâribuãNode
 
©å
;

951 
D©aNode
 
d©a
;

953 
DüObje˘
 *
obj
 = &
bez
->
obje˘
;

955 
	`obje˘_lﬂd
(
obj
, 
obj_node
);

957 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "bez_points");

959 i‡(
©å
 !
NULL
)

960 
bez
->
numpoöts
 = (
	`©åibuã_num_d©a
(
©å
) + 2)/3;

962 
bez
->
numpoöts
 = 0;

964 
	`obje˘_öô
(
obj
, 3 * 
bez
->
numpoöts
 - 2, 0);

966 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

967 i‡(
bez
->
numpoöts
 != 0) {

968 
bez
->
poöts
 = 
	`g_√w
(
BezPoöt
, bez->
numpoöts
);

969 
bez
->
poöts
[0].
ty≥
 = 
BEZ_MOVE_TO
;

970 
	`d©a_poöt
(
d©a
, &
bez
->
poöts
[0].
p1
);

971 
d©a
 = 
	`d©a_√xt
(data);

973 
i
 = 1; i < 
bez
->
numpoöts
; i++) {

974 
bez
->
poöts
[
i
].
ty≥
 = 
BEZ_CURVE_TO
;

975 
	`d©a_poöt
(
d©a
, &
bez
->
poöts
[
i
].
p1
);

976 
d©a
 = 
	`d©a_√xt
(data);

977 
	`d©a_poöt
(
d©a
, &
bez
->
poöts
[
i
].
p2
);

978 
d©a
 = 
	`d©a_√xt
(data);

979 
	`d©a_poöt
(
d©a
, &
bez
->
poöts
[
i
].
p3
);

980 
d©a
 = 
	`d©a_√xt
(data);

984 
bez
->
c‹√r_ty≥s
 = 
	`g_√w
(
BezC‹√rTy≥
, bez->
numpoöts
);

986 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "corner_types");

988 i‡(!
©å
 || 
	`©åibuã_num_d©a
◊ârË!
bez
->
numpoöts
) {

989 
i
 = 0; i < 
bez
->
numpoöts
; i++) {

990 
bez
->
c‹√r_ty≥s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

993 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

994 
i
 = 0; i < 
bez
->
numpoöts
; i++) {

995 
bez
->
c‹√r_ty≥s
[
i
] = 
	`d©a_íum
(
d©a
);

996 
d©a
 = 
	`d©a_√xt
(data);

1000 
obj
->
h™dÀs
[0] = 
	`g_√w0
(
H™dÀ
,1);

1001 
obj
->
h™dÀs
[0]->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

1002 
obj
->
h™dÀs
[0]->
c⁄√˘ed_to
 = 
NULL
;

1003 
obj
->
h™dÀs
[0]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

1004 
obj
->
h™dÀs
[0]->
id
 = 
HANDLE_MOVE_STARTPOINT
;

1006 
i
 = 1; i < 
bez
->
numpoöts
; i++) {

1007 
obj
->
h™dÀs
[3*
i
-2] = 
	`g_√w0
(
H™dÀ
,1);

1008 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[3*
i
-2], 
HANDLE_RIGHTCTRL
);

1009 
obj
->
h™dÀs
[3*
i
-1] = 
	`g_√w0
(
H™dÀ
,1);

1010 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[3*
i
-1], 
HANDLE_LEFTCTRL
);

1011 
obj
->
h™dÀs
[3*
i
] = 
	`g_√w0
(
H™dÀ
,1);

1012 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[3*
i
], 
HANDLE_BEZMAJOR
);

1015 
obj
->
h™dÀs
[obj->
num_h™dÀs
-1]->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

1016 
obj
->
h™dÀs
[obj->
num_h™dÀs
-1]->
c⁄√˘ed_to
 = 
NULL
;

1017 
obj
->
h™dÀs
[obj->
num_h™dÀs
-1]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

1018 
obj
->
h™dÀs
[obj->
num_h™dÀs
-1]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

1020 
	`bezõrc⁄n_upd©e_d©a
(
bez
);

1021 
	}
}

1029 
	$bezõrc⁄n_poöt_ch™ge_‰ì
(
PoötCh™ge
 *
ch™ge
)

1031 i‡–(
ch™ge
->
ty≥
==
TYPE_ADD_POINT
 && !ch™ge->
≠∂õd
) ||

1032 (
ch™ge
->
ty≥
==
TYPE_REMOVE_POINT
 && ch™ge->
≠∂õd
) ){

1033 
	`g_‰ì
(
ch™ge
->
h™dÀ1
);

1034 
	`g_‰ì
(
ch™ge
->
h™dÀ2
);

1035 
	`g_‰ì
(
ch™ge
->
h™dÀ3
);

1036 
ch™ge
->
h™dÀ1
 = 
NULL
;

1037 
ch™ge
->
h™dÀ2
 = 
NULL
;

1038 
ch™ge
->
h™dÀ3
 = 
NULL
;

1040 
	}
}

1047 
	$bezõrc⁄n_poöt_ch™ge_≠∂y
(
PoötCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1049 
ch™ge
->
≠∂õd
 = 1;

1050 
ch™ge
->
ty≥
) {

1051 
TYPE_ADD_POINT
:

1052 
	`add_h™dÀs
((
BezõrC⁄n
 *)
obj
, 
ch™ge
->
pos
, &ch™ge->
poöt
,

1053 
ch™ge
->
c‹√r_ty≥
,

1054 
ch™ge
->
h™dÀ1
, ch™ge->
h™dÀ2
, ch™ge->
h™dÀ3
);

1056 
TYPE_REMOVE_POINT
:

1057 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ1
);

1058 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ2
);

1059 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ3
);

1060 
	`ªmove_h™dÀs
((
BezõrC⁄n
 *)
obj
, 
ch™ge
->
pos
);

1063 
	}
}

1070 
	$bezõrc⁄n_poöt_ch™ge_ªvît
(
PoötCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1072 
ch™ge
->
ty≥
) {

1073 
TYPE_ADD_POINT
:

1074 
	`ªmove_h™dÀs
((
BezõrC⁄n
 *)
obj
, 
ch™ge
->
pos
);

1076 
TYPE_REMOVE_POINT
:

1077 
	`add_h™dÀs
((
BezõrC⁄n
 *)
obj
, 
ch™ge
->
pos
, &ch™ge->
poöt
,

1078 
ch™ge
->
c‹√r_ty≥
,

1079 
ch™ge
->
h™dÀ1
, ch™ge->
h™dÀ2
, ch™ge->
h™dÀ3
);

1081 i‡(
ch™ge
->
c⁄√˘ed_to1
)

1082 
	`obje˘_c⁄√˘
(
obj
, 
ch™ge
->
h™dÀ1
, ch™ge->
c⁄√˘ed_to1
);

1083 i‡(
ch™ge
->
c⁄√˘ed_to2
)

1084 
	`obje˘_c⁄√˘
(
obj
, 
ch™ge
->
h™dÀ2
, ch™ge->
c⁄√˘ed_to2
);

1085 i‡(
ch™ge
->
c⁄√˘ed_to3
)

1086 
	`obje˘_c⁄√˘
(
obj
, 
ch™ge
->
h™dÀ3
, ch™ge->
c⁄√˘ed_to3
);

1090 
ch™ge
->
≠∂õd
 = 0;

1091 
	}
}

1109 
Obje˘Ch™ge
 *

1110 
	$bezõrc⁄n_¸óã_poöt_ch™ge
(
BezõrC⁄n
 *
bez
, 
ch™ge_ty≥
 
ty≥
,

1111 
BezPoöt
 *
poöt
, 
BezC‹√rTy≥
 
c‹√r_ty≥
,

1112 
pos
,

1113 
H™dÀ
 *
h™dÀ1
, 
C⁄√˘i⁄Poöt
 *
c⁄√˘ed_to1
,

1114 
H™dÀ
 *
h™dÀ2
, 
C⁄√˘i⁄Poöt
 *
c⁄√˘ed_to2
,

1115 
H™dÀ
 *
h™dÀ3
, 
C⁄√˘i⁄Poöt
 *
c⁄√˘ed_to3
)

1117 
PoötCh™ge
 *
ch™ge
;

1119 
ch™ge
 = 
	`g_√w
(
PoötCh™ge
, 1);

1121 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
bezõrc⁄n_poöt_ch™ge_≠∂y
;

1122 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
bezõrc⁄n_poöt_ch™ge_ªvît
;

1123 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
bezõrc⁄n_poöt_ch™ge_‰ì
;

1125 
ch™ge
->
ty≥
 =Åype;

1126 
ch™ge
->
≠∂õd
 = 1;

1127 
ch™ge
->
poöt
 = *point;

1128 
ch™ge
->
c‹√r_ty≥
 = corner_type;

1129 
ch™ge
->
pos
 =Öos;

1130 
ch™ge
->
h™dÀ1
 = handle1;

1131 
ch™ge
->
c⁄√˘ed_to1
 = connected_to1;

1132 
ch™ge
->
h™dÀ2
 = handle2;

1133 
ch™ge
->
c⁄√˘ed_to2
 = connected_to2;

1134 
ch™ge
->
h™dÀ3
 = handle3;

1135 
ch™ge
->
c⁄√˘ed_to3
 = connected_to3;

1137  (
Obje˘Ch™ge
 *)
ch™ge
;

1138 
	}
}

1146 
	$bezõrc⁄n_c‹√r_ch™ge_≠∂y
(
C‹√rCh™ge
 *
ch™ge
,

1147 
DüObje˘
 *
obj
)

1149 
BezõrC⁄n
 *
bez
 = (BezõrC⁄¿*)
obj
;

1150 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
bez
, 
ch™ge
->
h™dÀ
);

1151 
comp_ƒ
 = 
	`gë_maj‹_ƒ
(
h™dÀ_ƒ
);

1153 
	`bezõrc⁄n_°øighãn_c‹√r
(
bez
, 
comp_ƒ
);

1155 
bez
->
c‹√r_ty≥s
[
comp_ƒ
] = 
ch™ge
->
√w_ty≥
;

1157 
ch™ge
->
≠∂õd
 = 1;

1158 
	}
}

1166 
	$bezõrc⁄n_c‹√r_ch™ge_ªvît
(
C‹√rCh™ge
 *
ch™ge
,

1167 
DüObje˘
 *
obj
)

1169 
BezõrC⁄n
 *
bez
 = (BezõrC⁄¿*)
obj
;

1170 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
bez
, 
ch™ge
->
h™dÀ
);

1171 
comp_ƒ
 = 
	`gë_maj‹_ƒ
(
h™dÀ_ƒ
);

1173 
bez
->
poöts
[
comp_ƒ
].
p2
 = 
ch™ge
->
poöt_À·
;

1174 
bez
->
poöts
[
comp_ƒ
+1].
p1
 = 
ch™ge
->
poöt_right
;

1175 
bez
->
c‹√r_ty≥s
[
comp_ƒ
] = 
ch™ge
->
ﬁd_ty≥
;

1177 
ch™ge
->
≠∂õd
 = 0;

1178 
	}
}

1191 
Obje˘Ch™ge
 *

1192 
	$bezõrc⁄n_¸óã_c‹√r_ch™ge
(
BezõrC⁄n
 *
bez
, 
H™dÀ
 *
h™dÀ
,

1193 
Poöt
 *
poöt_À·
, Poöà*
poöt_right
,

1194 
BezC‹√rTy≥
 
ﬁd_c‹√r_ty≥
,

1195 
BezC‹√rTy≥
 
√w_c‹√r_ty≥
)

1197 
C‹√rCh™ge
 *
ch™ge
;

1199 
ch™ge
 = 
	`g_√w
(
C‹√rCh™ge
, 1);

1201 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
bezõrc⁄n_c‹√r_ch™ge_≠∂y
;

1202 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
bezõrc⁄n_c‹√r_ch™ge_ªvît
;

1203 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
NULL
;

1205 
ch™ge
->
ﬁd_ty≥
 = 
ﬁd_c‹√r_ty≥
;

1206 
ch™ge
->
√w_ty≥
 = 
√w_c‹√r_ty≥
;

1207 
ch™ge
->
≠∂õd
 = 1;

1209 
ch™ge
->
h™dÀ
 = handle;

1210 
ch™ge
->
poöt_À·
 = *point_left;

1211 
ch™ge
->
poöt_right
 = *point_right;

1213  (
Obje˘Ch™ge
 *)
ch™ge
;

1214 
	}
}

	@O:\tool\dvs50\lib\bezier_conn.h

23 #i‚de‡
BEZIER_CONN_H


24 
	#BEZIER_CONN_H


	)

26 
	~"düty≥s.h
"

27 
	~"obje˘.h
"

28 
	~"boundögbox.h
"

31 
	mBEZ_CORNER_SYMMETRIC
,

32 
	mBEZ_CORNER_SMOOTH
,

33 
	mBEZ_CORNER_CUSP


34 } 
	tBezC‹√rTy≥
;

39 
	s_BezõrC⁄n
 {

40 
DüObje˘
 
	mobje˘
;

42 
	mnumpoöts
;

43 
BezPoöt
 *
	mpoöts
;

44 
BezC‹√rTy≥
 *
	mc‹√r_ty≥s
;

45 
PﬁyBBExåas
 
	mexåa_•acög
;

48 
DIAVAR
 
bezõrc⁄n_upd©e_d©a
(
BezõrC⁄n
 *
bez
);

49 
DIAVAR
 
bezõrc⁄n_upd©e_boundögbox
(
BezõrC⁄n
 *
bez
);

50 
bezõrc⁄n_sim∂e_døw
(
BezõrC⁄n
 *
bez
, 
DüRídîî
 *
ªndîî
,

51 
ªÆ
 
width
);

52 
DIAVAR
 
bezõrc⁄n_døw_c⁄åﬁ_löes
(
BezõrC⁄n
 *
bez
, 
DüRídîî
 *
ªndîî
);

53 
DIAVAR
 
bezõrc⁄n_öô
(
BezõrC⁄n
 *
bez
, 
num_poöts
);

54 
DIAVAR
 
bezõrc⁄n_£t_poöts
(
BezõrC⁄n
 *
pﬁy
, 
num_poöts
, 
BezPoöt
 *
poöts
);

55 
DIAVAR
 
bezõrc⁄n_de°roy
(
BezõrC⁄n
 *
bez
);

56 
DIAVAR
 
bezõrc⁄n_c›y
(
BezõrC⁄n
 *
‰om
, BezõrC⁄¿*
to
);

57 
DIAVAR
 
bezõrc⁄n_ßve
(
BezõrC⁄n
 *
bez
, 
Obje˘Node
 
obj_node
);

58 
DIAVAR
 
bezõrc⁄n_lﬂd
(
BezõrC⁄n
 *
bez
, 
Obje˘Node
 
obj_node
);

59 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrc⁄n_add_£gmít
(
BezõrC⁄n
 *
bez
, 
£gmít
, 
Poöt
 *
poöt
);

60 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrc⁄n_ªmove_£gmít
(
BezõrC⁄n
 *
bez
, 
poöt
);

61 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrc⁄n_£t_c‹√r_ty≥
(
BezõrC⁄n
 *
bez
,

62 
H™dÀ
 *
h™dÀ
,

63 
BezC‹√rTy≥
 
°yÀ
);

64 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrc⁄n_move_h™dÀ
(
BezõrC⁄n
 *
bez
, 
H™dÀ
 *
id
,

65 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

66 
H™dÀMoveRós⁄
 
ªas⁄
,

67 
ModifõrKeys
 
modifõrs
);

68 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrc⁄n_move
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
to
);

69 
DIAVAR
 
ªÆ
 
bezõrc⁄n_di°™˚_‰om
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
poöt
,

70 
ªÆ
 
löe_width
);

71 
DIAVAR
 
H™dÀ
 *
bezõrc⁄n_˛o£°_h™dÀ
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
poöt
);

72 
DIAVAR
 
H™dÀ
 *
bezõrc⁄n_˛o£°_maj‹_h™dÀ
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
poöt
);

73 
DIAVAR
 
bezõrc⁄n_˛o£°_£gmít
(
BezõrC⁄n
 *
bez
, 
Poöt
 *
poöt
,

74 
ªÆ
 
löe_width
);

76 
	#BEZCONN_COMMON_PROPERTIES
 \

77 
OBJECT_COMMON_PROPERTIES
, \

78 { "bez_poöts", 
PROP_TYPE_BEZPOINTARRAY
, 0, "bezõrc⁄¿poöts", 
NULL
} \

79 

	)

80 
	#BEZCONN_COMMON_PROPERTIES_OFFSETS
 \

81 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

82 { "bez_poöts", 
PROP_TYPE_BEZPOINTARRAY
, \

83 
	`off£tof
(
BezõrC⁄n
,
poöts
), off£tof(BezõrC⁄n,
numpoöts
)} \

84 

	)

	@O:\tool\dvs50\lib\beziershape.c

22 
	~<c⁄fig.h
>

24 
	~<°dio.h
>

25 
	~<°dlib.h
>

26 
	~<m©h.h
>

27 
	~<°rög.h
>

29 
	~"bezõrsh≠e.h
"

30 
	~"mesßge.h
"

31 
	~"düªndîî.h
"

33 
	#HANDLE_BEZMAJOR
 (
HANDLE_CUSTOM1
)

	)

34 
	#HANDLE_LEFTCTRL
 (
HANDLE_CUSTOM2
)

	)

35 
	#HANDLE_RIGHTCTRL
 (
HANDLE_CUSTOM3
)

	)

37 
	ech™ge_ty≥
 {

38 
	mTYPE_ADD_POINT
,

39 
	mTYPE_REMOVE_POINT


47 
	sBezPoötCh™ge
 {

48 
Obje˘Ch™ge
 
	mobj_ch™ge
;

50 
ch™ge_ty≥
 
	mty≥
;

51 
	m≠∂õd
;

53 
BezPoöt
 
	mpoöt
;

54 
BezC‹√rTy≥
 
	mc‹√r_ty≥
;

55 
	mpos
;

59 
H™dÀ
 *
	mh™dÀ1
, *
	mh™dÀ2
, *
	mh™dÀ3
;

60 
C⁄√˘i⁄Poöt
 *
	m˝1
, *
	m˝2
;

63 
	sC‹√rCh™ge
 {

64 
Obje˘Ch™ge
 
	mobj_ch™ge
;

66 
	m≠∂õd
;

68 
H™dÀ
 *
	mh™dÀ
;

70 
Poöt
 
	mpoöt_À·
, 
	mpoöt_right
;

71 
BezC‹√rTy≥
 
	mﬁd_ty≥
, 
	m√w_ty≥
;

74 
Obje˘Ch™ge
 *

75 
bezõrsh≠e_¸óã_poöt_ch™ge
(
BezõrSh≠e
 *
bezõr
, 
ch™ge_ty≥
 
ty≥
,

76 
BezPoöt
 *
poöt
, 
BezC‹√rTy≥
 
c‹√r_ty≥
,

77 
£gmít
,

78 
H™dÀ
 *
h™dÀ1
, H™dÀ *
h™dÀ2
, H™dÀ *
h™dÀ3
,

79 
C⁄√˘i⁄Poöt
 *
˝1
, C⁄√˘i⁄Poöà*
˝2
);

80 
Obje˘Ch™ge
 *

81 
bezõrsh≠e_¸óã_c‹√r_ch™ge
(
BezõrSh≠e
 *
bezõr
, 
H™dÀ
 *
h™dÀ
,

82 
Poöt
 *
poöt_À·
, Poöà*
poöt_right
,

83 
BezC‹√rTy≥
 
ﬁd_c‹√r_ty≥
,

84 
BezC‹√rTy≥
 
√w_c‹√r_ty≥
);

86 
√w_h™dÀs_™d_c⁄√˘i⁄s
(
BezõrSh≠e
 *
bezõr
, 
num_poöts
);

88 
	$£tup_h™dÀ
(
H™dÀ
 *
h™dÀ
, 
h™dÀ_id
)

90 
h™dÀ
->
id
 = 
h™dÀ_id
;

91 
h™dÀ
->
ty≥
 =

92 (
h™dÀ_id
 =
HANDLE_BEZMAJOR
) ?

93 
HANDLE_MAJOR_CONTROL
 :

94 
HANDLE_MINOR_CONTROL
;

95 
h™dÀ
->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

96 
h™dÀ
->
c⁄√˘ed_to
 = 
NULL
;

97 
	}
}

100 
	$gë_h™dÀ_ƒ
(
BezõrSh≠e
 *
bezõr
, 
H™dÀ
 *
h™dÀ
)

102 
i
 = 0;

103 
i
 = 0; i < 
bezõr
->
obje˘
.
num_h™dÀs
; i++) {

104 i‡(
bezõr
->
obje˘
.
h™dÀs
[
i
] =
h™dÀ
)

105  
i
;

108 
	}
}

110 
	#gë_comp_ƒ
(
hnum
Ë(()(hnum)/3+1)

	)

111 
	#gë_maj‹_ƒ
(
hnum
Ë((()(hnum)+2)/3)

	)

113 
Obje˘Ch™ge
 *

114 
	$bezõrsh≠e_move_h™dÀ
(
BezõrSh≠e
 *
bezõr
, 
H™dÀ
 *
h™dÀ
,

115 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

116 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

118 
h™dÀ_ƒ
, 
comp_ƒ
, 
√xt_ƒ
, 
¥ev_ƒ
;

119 
Poöt
 
dñè
, 
±
;

121 
dñè
 = *
to
;

122 
	`poöt_sub
(&
dñè
, &
h™dÀ
->
pos
);

124 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
bezõr
, 
h™dÀ
);

125 
comp_ƒ
 = 
	`gë_comp_ƒ
(
h™dÀ_ƒ
);

126 
√xt_ƒ
 = 
comp_ƒ
 + 1;

127 
¥ev_ƒ
 = 
comp_ƒ
 - 1;

128 i‡(
comp_ƒ
 =
bezõr
->
numpoöts
 - 1)

129 
√xt_ƒ
 = 1;

130 i‡(
comp_ƒ
 == 1)

131 
¥ev_ƒ
 = 
bezõr
->
numpoöts
 - 1;

133 
h™dÀ
->
id
) {

134 
HANDLE_BEZMAJOR
:

135 i‡(
comp_ƒ
 =
bezõr
->
numpoöts
 - 1) {

136 
bezõr
->
poöts
[
comp_ƒ
].
p3
 = *
to
;

137 
bezõr
->
poöts
[0].
p1
 = bezõr->poöts[0].
p3
 = *
to
;

138 
	`poöt_add
(&
bezõr
->
poöts
[
comp_ƒ
].
p2
, &
dñè
);

139 
	`poöt_add
(&
bezõr
->
poöts
[1].
p1
, &
dñè
);

141 
bezõr
->
poöts
[
comp_ƒ
].
p3
 = *
to
;

142 
	`poöt_add
(&
bezõr
->
poöts
[
comp_ƒ
].
p2
, &
dñè
);

143 
	`poöt_add
(&
bezõr
->
poöts
[
comp_ƒ
+1].
p1
, &
dñè
);

146 
HANDLE_LEFTCTRL
:

147 
bezõr
->
poöts
[
comp_ƒ
].
p2
 = *
to
;

148 
bezõr
->
c‹√r_ty≥s
[
comp_ƒ
]) {

149 
BEZ_CORNER_SYMMETRIC
:

150 
±
 = 
bezõr
->
poöts
[
comp_ƒ
].
p3
;

151 
	`poöt_sub
(&
±
, &
bezõr
->
poöts
[
comp_ƒ
].
p2
);

152 
	`poöt_add
(&
±
, &
bezõr
->
poöts
[
comp_ƒ
].
p3
);

153 
bezõr
->
poöts
[
√xt_ƒ
].
p1
 = 
±
;

155 
BEZ_CORNER_SMOOTH
: {

156 
ªÆ
 
Àn
;

158 
±
 = 
bezõr
->
poöts
[
√xt_ƒ
].
p1
;

159 
	`poöt_sub
(&
±
, &
bezõr
->
poöts
[
comp_ƒ
].
p3
);

160 
Àn
 = 
	`poöt_Àn
(&
±
);

162 
±
 = 
bezõr
->
poöts
[
comp_ƒ
].
p3
;

163 
	`poöt_sub
(&
±
, &
bezõr
->
poöts
[
comp_ƒ
].
p2
);

164 i‡(
	`poöt_Àn
(&
±
) > 0)

165 
	`poöt_n‹mÆize
(&
±
);

167 
±
.
x
 = 1.0;Öt.
y
 = 0.0;

169 
	`poöt_sˇÀ
(&
±
, 
Àn
);

170 
	`poöt_add
(&
±
, &
bezõr
->
poöts
[
comp_ƒ
].
p3
);

171 
bezõr
->
poöts
[
√xt_ƒ
].
p1
 = 
±
;

174 
BEZ_CORNER_CUSP
:

179 
HANDLE_RIGHTCTRL
:

180 
bezõr
->
poöts
[
comp_ƒ
].
p1
 = *
to
;

181 
bezõr
->
c‹√r_ty≥s
[
¥ev_ƒ
]) {

182 
BEZ_CORNER_SYMMETRIC
:

183 
±
 = 
bezõr
->
poöts
[
¥ev_ƒ
].
p3
;

184 
	`poöt_sub
(&
±
, &
bezõr
->
poöts
[
comp_ƒ
].
p1
);

185 
	`poöt_add
(&
±
, &
bezõr
->
poöts
[
¥ev_ƒ
].
p3
);

186 
bezõr
->
poöts
[
¥ev_ƒ
].
p2
 = 
±
;

188 
BEZ_CORNER_SMOOTH
: {

189 
ªÆ
 
Àn
;

191 
±
 = 
bezõr
->
poöts
[
¥ev_ƒ
].
p2
;

192 
	`poöt_sub
(&
±
, &
bezõr
->
poöts
[
¥ev_ƒ
].
p3
);

193 
Àn
 = 
	`poöt_Àn
(&
±
);

195 
±
 = 
bezõr
->
poöts
[
¥ev_ƒ
].
p3
;

196 
	`poöt_sub
(&
±
, &
bezõr
->
poöts
[
comp_ƒ
].
p1
);

197 i‡(
	`poöt_Àn
(&
±
) > 0)

198 
	`poöt_n‹mÆize
(&
±
);

200 
±
.
x
 = 1.0;Öt.
y
 = 0.0;

202 
	`poöt_sˇÀ
(&
±
, 
Àn
);

203 
	`poöt_add
(&
±
, &
bezõr
->
poöts
[
¥ev_ƒ
].
p3
);

204 
bezõr
->
poöts
[
¥ev_ƒ
].
p2
 = 
±
;

207 
BEZ_CORNER_CUSP
:

213 
	`mesßge_îr‹
("InternalÉrror in beziershape_move_handle.");

216  
NULL
;

217 
	}
}

219 
Obje˘Ch™ge
*

220 
	$bezõrsh≠e_move
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
to
)

222 
Poöt
 
p
;

223 
i
;

225 
p
 = *
to
;

226 
	`poöt_sub
(&
p
, &
bezõr
->
poöts
[0].
p1
);

228 
bezõr
->
poöts
[0].
p1
 = bezõr->poöts[0].
p3
 = *
to
;

229 
i
 = 1; i < 
bezõr
->
numpoöts
; i++) {

230 
	`poöt_add
(&
bezõr
->
poöts
[
i
].
p1
, &
p
);

231 
	`poöt_add
(&
bezõr
->
poöts
[
i
].
p2
, &
p
);

232 
	`poöt_add
(&
bezõr
->
poöts
[
i
].
p3
, &
p
);

235  
NULL
;

236 
	}
}

239 
	$bezõrsh≠e_˛o£°_£gmít
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

241 
Poöt
 
œ°
;

242 
i
;

243 
ªÆ
 
di°
 = 
G_MAXDOUBLE
;

244 
˛o£°
;

246 
˛o£°
 = 0;

247 
œ°
 = 
bezõr
->
poöts
[0].
p1
;

249 
i
 = 1; i < 
bezõr
->
numpoöts
; i++) {

250 
ªÆ
 
√w_di°
 = 
	`di°™˚_bez_£g_poöt
(&
œ°
, &
bezõr
->
poöts
[
i
].
p1
,

251 &
bezõr
->
poöts
[
i
].
p2
, &bezõr->poöts[i].
p3
,

252 
löe_width
, 
poöt
);

253 i‡(
√w_di°
 < 
di°
) {

254 
di°
 = 
√w_di°
;

255 
˛o£°
 = 
i
;

257 
œ°
 = 
bezõr
->
poöts
[
i
].
p3
;

259  
˛o£°
;

260 
	}
}

262 
H™dÀ
 *

263 
	$bezõrsh≠e_˛o£°_h™dÀ
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
poöt
)

265 
i
, 
hn
;

266 
ªÆ
 
di°
 = 
G_MAXDOUBLE
;

267 
H™dÀ
 *
˛o£°
 = 
NULL
;

269 
i
 = 1, 
hn
 = 0; i < 
bezõr
->
numpoöts
; i++, hn++) {

270 
ªÆ
 
√w_di°
;

272 
√w_di°
 = 
	`di°™˚_poöt_poöt
–
poöt
, &
bezõr
->
poöts
[
i
].
p1
);

273 i‡(
√w_di°
 < 
di°
) {

274 
di°
 = 
√w_di°
;

275 
˛o£°
 = 
bezõr
->
obje˘
.
h™dÀs
[
hn
];

277 
hn
++;

279 
√w_di°
 = 
	`di°™˚_poöt_poöt
–
poöt
, &
bezõr
->
poöts
[
i
].
p2
);

280 i‡(
√w_di°
 < 
di°
) {

281 
di°
 = 
√w_di°
;

282 
˛o£°
 = 
bezõr
->
obje˘
.
h™dÀs
[
hn
];

285 
hn
++;

286 
√w_di°
 = 
	`di°™˚_poöt_poöt
–
poöt
, &
bezõr
->
poöts
[
i
].
p3
);

287 i‡(
√w_di°
 < 
di°
) {

288 
di°
 = 
√w_di°
;

289 
˛o£°
 = 
bezõr
->
obje˘
.
h™dÀs
[
hn
];

292  
˛o£°
;

293 
	}
}

295 
H™dÀ
 *

296 
	$bezõrsh≠e_˛o£°_maj‹_h™dÀ
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
poöt
)

298 
H™dÀ
 *
˛o£°
 = 
	`bezõrsh≠e_˛o£°_h™dÀ
(
bezõr
, 
poöt
);

299 
pos
 = 
	`gë_maj‹_ƒ
(
	`gë_h™dÀ_ƒ
(
bezõr
, 
˛o£°
));

301 i‡(
pos
 == 0)

302 
pos
 = 
bezõr
->
numpoöts
 - 1;

303  
bezõr
->
obje˘
.
h™dÀs
[3*
pos
 - 1];

304 
	}
}

306 
ªÆ


307 
	$bezõrsh≠e_di°™˚_‰om
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

309  
	`di°™˚_bez_sh≠e_poöt
(
bezõr
->
poöts
, bezõr->
numpoöts
,

310 
löe_width
, 
poöt
);

311 
	}
}

314 
	$add_h™dÀs
(
BezõrSh≠e
 *
bezõr
, 
pos
, 
BezPoöt
 *
poöt
,

315 
BezC‹√rTy≥
 
c‹√r_ty≥
, 
H™dÀ
 *
h™dÀ1
,

316 
H™dÀ
 *
h™dÀ2
, H™dÀ *
h™dÀ3
,

317 
C⁄√˘i⁄Poöt
 *
˝1
, C⁄√˘i⁄Poöà*
˝2
)

319 
i
, 
√xt
;

320 
DüObje˘
 *
obj
;

322 
	`g_as£π
(
pos
 >= 1);

323 
	`g_as£π
(
pos
 <
bezõr
->
numpoöts
);

325 
obj
 = (
DüObje˘
 *)
bezõr
;

326 
bezõr
->
numpoöts
++;

327 
√xt
 = 
pos
 + 1;

328 i‡(
pos
 =
bezõr
->
numpoöts
 - 1)

329 
√xt
 = 1;

330 
bezõr
->
poöts
 = 
	`g_ªÆloc
(bezier->points,

331 
bezõr
->
numpoöts
 * (
BezPoöt
));

332 
bezõr
->
c‹√r_ty≥s
 = 
	`g_ªÆloc
(bezier->corner_types,

333 
bezõr
->
numpoöts
 * (
BezC‹√rTy≥
));

335 
i
 = 
bezõr
->
numpoöts
 - 1; i > 
pos
; i--) {

336 
bezõr
->
poöts
[
i
] = bezier->points[i-1];

337 
bezõr
->
c‹√r_ty≥s
[
i
] =bezier->corner_types[i-1];

339 
bezõr
->
poöts
[
pos
] = *
poöt
;

340 
bezõr
->
poöts
[
pos
].
p1
 = bezõr->poöts[
√xt
].p1;

341 
bezõr
->
poöts
[
√xt
].
p1
 = 
poöt
->p1;

342 i‡(
pos
 =
bezõr
->
numpoöts
 - 1)

343 
bezõr
->
poöts
[0].
p1
 = bezõr->poöts[0].
p3
 = bezõr->poöts[
pos
].p3;

344 
bezõr
->
c‹√r_ty≥s
[
pos
] = 
c‹√r_ty≥
;

345 
	`obje˘_add_h™dÀ_©
((
DüObje˘
*)
bezõr
, 
h™dÀ1
, 3*
pos
-3);

346 
	`obje˘_add_h™dÀ_©
((
DüObje˘
*)
bezõr
, 
h™dÀ2
, 3*
pos
-2);

347 
	`obje˘_add_h™dÀ_©
((
DüObje˘
*)
bezõr
, 
h™dÀ3
, 3*
pos
-1);

348 
	`obje˘_add_c⁄√˘i⁄poöt_©
((
DüObje˘
 *)
bezõr
, 
˝1
, 2*
pos
-2);

349 
	`obje˘_add_c⁄√˘i⁄poöt_©
((
DüObje˘
 *)
bezõr
, 
˝2
, 2*
pos
-1);

350 
	}
}

353 
	$ªmove_h™dÀs
(
BezõrSh≠e
 *
bezõr
, 
pos
)

355 
i
;

356 
DüObje˘
 *
obj
;

357 
H™dÀ
 *
ﬁd_h™dÀ1
, *
ﬁd_h™dÀ2
, *
ﬁd_h™dÀ3
;

358 
C⁄√˘i⁄Poöt
 *
ﬁd_˝1
, *
ﬁd_˝2
;

359 
Poöt
 
tmµoöt
;

360 
Poöt
 
c⁄åﬁve˘‹
;

361 
c⁄åﬁve˘‹
.
x
=0;

362 
c⁄åﬁve˘‹
.
y
=0;

364 
	`g_as£π
(
pos
 > 0);

365 
	`g_as£π
(
pos
 < 
bezõr
->
numpoöts
);

367 
obj
 = (
DüObje˘
 *)
bezõr
;

370 
bezõr
->
numpoöts
--;

371 
tmµoöt
 = 
bezõr
->
poöts
[
pos
].
p1
;

372 i‡(
pos
 =
bezõr
->
numpoöts
) {

373 
c⁄åﬁve˘‹
 = 
bezõr
->
poöts
[
pos
-1].
p3
;

374 
	`poöt_sub
(&
c⁄åﬁve˘‹
, &
bezõr
->
poöts
[
pos
].
p1
);

376 
i
 = 
pos
; i < 
bezõr
->
numpoöts
; i++) {

377 
bezõr
->
poöts
[
i
] = bezier->points[i+1];

378 
bezõr
->
c‹√r_ty≥s
[
i
] = bezier->corner_types[i+1];

380 
bezõr
->
poöts
[
pos
].
p1
 = 
tmµoöt
;

381 i‡(
pos
 =
bezõr
->
numpoöts
) {

384 
bezõr
->
poöts
[0].
p1
 = bezõr->poöts[bezõr->
numpoöts
-1].
p3
;

385 
bezõr
->
poöts
[1].
p1
 = bezier->points[0].p1;

386 
	`poöt_sub
(&
bezõr
->
poöts
[1].
p1
, &
c⁄åﬁve˘‹
);

388 
bezõr
->
poöts
 = 
	`g_ªÆloc
(bezier->points,

389 
bezõr
->
numpoöts
 * (
BezPoöt
));

390 
bezõr
->
c‹√r_ty≥s
 = 
	`g_ªÆloc
(bezier->corner_types,

391 
bezõr
->
numpoöts
 * (
BezC‹√rTy≥
));

393 
ﬁd_h™dÀ1
 = 
obj
->
h™dÀs
[3*
pos
-3];

394 
ﬁd_h™dÀ2
 = 
obj
->
h™dÀs
[3*
pos
-2];

395 
ﬁd_h™dÀ3
 = 
obj
->
h™dÀs
[3*
pos
-1];

396 
	`obje˘_ªmove_h™dÀ
(&
bezõr
->
obje˘
, 
ﬁd_h™dÀ1
);

397 
	`obje˘_ªmove_h™dÀ
(&
bezõr
->
obje˘
, 
ﬁd_h™dÀ2
);

398 
	`obje˘_ªmove_h™dÀ
(&
bezõr
->
obje˘
, 
ﬁd_h™dÀ3
);

399 
ﬁd_˝1
 = 
obj
->
c⁄√˘i⁄s
[2*
pos
-2];

400 
ﬁd_˝2
 = 
obj
->
c⁄√˘i⁄s
[2*
pos
-1];

401 
	`obje˘_ªmove_c⁄√˘i⁄poöt
(&
bezõr
->
obje˘
, 
ﬁd_˝1
);

402 
	`obje˘_ªmove_c⁄√˘i⁄poöt
(&
bezõr
->
obje˘
, 
ﬁd_˝2
);

403 
	}
}

408 
Obje˘Ch™ge
 *

409 
	$bezõrsh≠e_add_£gmít
(
BezõrSh≠e
 *
bezõr
, 
£gmít
, 
Poöt
 *
poöt
)

411 
BezPoöt
 
ªÆpoöt
;

412 
BezC‹√rTy≥
 
c‹√r_ty≥
 = 
BEZ_CORNER_SYMMETRIC
;

413 
H™dÀ
 *
√w_h™dÀ1
, *
√w_h™dÀ2
, *
√w_h™dÀ3
;

414 
C⁄√˘i⁄Poöt
 *
√w_˝1
, *
√w_˝2
;

415 
Poöt
 
°¨çoöt
;

416 
Poöt
 
Ÿhî
;

418 i‡(
£gmít
 != 1)

419 
°¨çoöt
 = 
bezõr
->
poöts
[
£gmít
-1].
p3
;

421 
°¨çoöt
 = 
bezõr
->
poöts
[0].
p1
;

422 
Ÿhî
 = 
bezõr
->
poöts
[
£gmít
].
p3
;

423 i‡(
poöt
 =
NULL
) {

424 
ªÆpoöt
.
p1
.
x
 = (
°¨çoöt
.x + 
Ÿhî
.x)/6;

425 
ªÆpoöt
.
p1
.
y
 = (
°¨çoöt
.y + 
Ÿhî
.y)/6;

426 
ªÆpoöt
.
p2
.
x
 = (
°¨çoöt
.x + 
Ÿhî
.x)/3;

427 
ªÆpoöt
.
p2
.
y
 = (
°¨çoöt
.y + 
Ÿhî
.y)/3;

428 
ªÆpoöt
.
p3
.
x
 = (
°¨çoöt
.x + 
Ÿhî
.x)/2;

429 
ªÆpoöt
.
p3
.
y
 = (
°¨çoöt
.y + 
Ÿhî
.y)/2;

431 
ªÆpoöt
.
p2
.
x
 = 
poöt
->x+(
°¨çoöt
.x-
Ÿhî
.x)/6;

432 
ªÆpoöt
.
p2
.
y
 = 
poöt
->y+(
°¨çoöt
.y-
Ÿhî
.y)/6;

434 
ªÆpoöt
.
p3
 = *
poöt
;

436 
ªÆpoöt
.
p1
.
x
 = 
poöt
->x-(
°¨çoöt
.x-
Ÿhî
.x)/6;

437 
ªÆpoöt
.
p1
.
y
 = 
poöt
->y-(
°¨çoöt
.y-
Ÿhî
.y)/6;

439 
ªÆpoöt
.
ty≥
 = 
BEZ_CURVE_TO
;

441 
√w_h™dÀ1
 = 
	`g_√w0
(
H™dÀ
,1);

442 
√w_h™dÀ2
 = 
	`g_√w0
(
H™dÀ
,1);

443 
√w_h™dÀ3
 = 
	`g_√w0
(
H™dÀ
,1);

444 
	`£tup_h™dÀ
(
√w_h™dÀ1
, 
HANDLE_RIGHTCTRL
);

445 
	`£tup_h™dÀ
(
√w_h™dÀ2
, 
HANDLE_LEFTCTRL
);

446 
	`£tup_h™dÀ
(
√w_h™dÀ3
, 
HANDLE_BEZMAJOR
);

447 
√w_˝1
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

448 
√w_˝2
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

449 
√w_˝1
->
obje˘
 = &
bezõr
->object;

450 
√w_˝2
->
obje˘
 = &
bezõr
->object;

451 
	`add_h™dÀs
(
bezõr
, 
£gmít
, &
ªÆpoöt
, 
c‹√r_ty≥
,

452 
√w_h™dÀ1
, 
√w_h™dÀ2
, 
√w_h™dÀ3
, 
√w_˝1
, 
√w_˝2
);

453  
	`bezõrsh≠e_¸óã_poöt_ch™ge
(
bezõr
, 
TYPE_ADD_POINT
,

454 &
ªÆpoöt
, 
c‹√r_ty≥
, 
£gmít
,

455 
√w_h™dÀ1
, 
√w_h™dÀ2
, 
√w_h™dÀ3
,

456 
√w_˝1
, 
√w_˝2
);

457 
	}
}

459 
Obje˘Ch™ge
 *

460 
	$bezõrsh≠e_ªmove_£gmít
(
BezõrSh≠e
 *
bezõr
, 
pos
)

462 
H™dÀ
 *
ﬁd_h™dÀ1
, *
ﬁd_h™dÀ2
, *
ﬁd_h™dÀ3
;

463 
C⁄√˘i⁄Poöt
 *
ﬁd_˝1
, *
ﬁd_˝2
;

464 
BezPoöt
 
ﬁd_poöt
;

465 
BezC‹√rTy≥
 
ﬁd_˘y≥
;

466 
√xt
 = 
pos
+1;

468 
	`g_as£π
(
pos
 > 0);

469 
	`g_as£π
(
bezõr
->
numpoöts
 > 2);

470 
	`g_as£π
(
pos
 < 
bezõr
->
numpoöts
);

472 i‡(
pos
 =
bezõr
->
numpoöts
 - 1)

473 
√xt
 = 1;

475 
ﬁd_h™dÀ1
 = 
bezõr
->
obje˘
.
h™dÀs
[3*
pos
-3];

476 
ﬁd_h™dÀ2
 = 
bezõr
->
obje˘
.
h™dÀs
[3*
pos
-2];

477 
ﬁd_h™dÀ3
 = 
bezõr
->
obje˘
.
h™dÀs
[3*
pos
-1];

478 
ﬁd_poöt
 = 
bezõr
->
poöts
[
pos
];

480 
ﬁd_poöt
.
p1
 = 
bezõr
->
poöts
[
√xt
].p1;

481 
ﬁd_˘y≥
 = 
bezõr
->
c‹√r_ty≥s
[
pos
];

483 
ﬁd_˝1
 = 
bezõr
->
obje˘
.
c⁄√˘i⁄s
[2*
pos
-2];

484 
ﬁd_˝2
 = 
bezõr
->
obje˘
.
c⁄√˘i⁄s
[2*
pos
-1];

486 
	`obje˘_unc⁄√˘
((
DüObje˘
 *)
bezõr
, 
ﬁd_h™dÀ1
);

487 
	`obje˘_unc⁄√˘
((
DüObje˘
 *)
bezõr
, 
ﬁd_h™dÀ2
);

488 
	`obje˘_unc⁄√˘
((
DüObje˘
 *)
bezõr
, 
ﬁd_h™dÀ3
);

490 
	`ªmove_h™dÀs
(
bezõr
, 
pos
);

492 
	`bezõrsh≠e_upd©e_d©a
(
bezõr
);

494  
	`bezõrsh≠e_¸óã_poöt_ch™ge
(
bezõr
, 
TYPE_REMOVE_POINT
,

495 &
ﬁd_poöt
, 
ﬁd_˘y≥
, 
pos
,

496 
ﬁd_h™dÀ1
, 
ﬁd_h™dÀ2
, 
ﬁd_h™dÀ3
,

497 
ﬁd_˝1
, 
ﬁd_˝2
);

498 
	}
}

501 
	$bezõrsh≠e_°øighãn_c‹√r
(
BezõrSh≠e
 *
bez
, 
comp_ƒ
) {

502 
√xt_ƒ
;

504 i‡(
comp_ƒ
 =0Ëcomp_ƒ = 
bez
->
numpoöts
 - 1;

505 
√xt_ƒ
 = 
comp_ƒ
 + 1;

506 i‡(
comp_ƒ
 =
bez
->
numpoöts
 - 1)

507 
√xt_ƒ
 = 1;

511 
bez
->
poöts
[0].
p3
 = bez->poöts[0].
p1
;

512 
bez
->
c‹√r_ty≥s
[
comp_ƒ
]) {

513 
BEZ_CORNER_SYMMETRIC
: {

514 
Poöt
 
±1
, 
±2
;

516 
±1
 = 
bez
->
poöts
[
comp_ƒ
].
p3
;

517 
	`poöt_sub
(&
±1
, &
bez
->
poöts
[
comp_ƒ
].
p2
);

518 
±2
 = 
bez
->
poöts
[
comp_ƒ
].
p3
;

519 
	`poöt_sub
(&
±2
, &
bez
->
poöts
[
√xt_ƒ
].
p1
);

520 
	`poöt_sˇÀ
(&
±2
, -1.0);

521 
	`poöt_add
(&
±1
, &
±2
);

522 
	`poöt_sˇÀ
(&
±1
, 0.5);

523 
±2
 = 
±1
;

524 
	`poöt_sˇÀ
(&
±1
, -1.0);

525 
	`poöt_add
(&
±1
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

526 
	`poöt_add
(&
±2
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

527 
bez
->
poöts
[
comp_ƒ
].
p2
 = 
±1
;

528 
bez
->
poöts
[
√xt_ƒ
].
p1
 = 
±2
;

529 
	`bezõrsh≠e_upd©e_d©a
(
bez
);

532 
BEZ_CORNER_SMOOTH
: {

533 
Poöt
 
±1
, 
±2
;

534 
ªÆ
 
Àn1
, 
Àn2
;

535 
±1
 = 
bez
->
poöts
[
comp_ƒ
].
p3
;

536 
	`poöt_sub
(&
±1
, &
bez
->
poöts
[
comp_ƒ
].
p2
);

537 
±2
 = 
bez
->
poöts
[
comp_ƒ
].
p3
;

538 
	`poöt_sub
(&
±2
, &
bez
->
poöts
[
√xt_ƒ
].
p1
);

539 
Àn1
 = 
	`poöt_Àn
(&
±1
);

540 
Àn2
 = 
	`poöt_Àn
(&
±2
);

541 
	`poöt_sˇÀ
(&
±2
, -1.0);

542 i‡(
Àn1
 > 0)

543 
	`poöt_n‹mÆize
(&
±1
);

544 i‡(
Àn2
 > 0)

545 
	`poöt_n‹mÆize
(&
±2
);

546 
	`poöt_add
(&
±1
, &
±2
);

547 
	`poöt_sˇÀ
(&
±1
, 0.5);

548 
±2
 = 
±1
;

549 
	`poöt_sˇÀ
(&
±1
, -
Àn1
);

550 
	`poöt_add
(&
±1
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

551 
	`poöt_sˇÀ
(&
±2
, 
Àn2
);

552 
	`poöt_add
(&
±2
, &
bez
->
poöts
[
comp_ƒ
].
p3
);

553 
bez
->
poöts
[
comp_ƒ
].
p2
 = 
±1
;

554 
bez
->
poöts
[
√xt_ƒ
].
p1
 = 
±2
;

555 
	`bezõrsh≠e_upd©e_d©a
(
bez
);

558 
BEZ_CORNER_CUSP
:

561 
bez
->
poöts
[0].
p1
 = bez->poöts[0].
p3
;

562 
	}
}

564 
Obje˘Ch™ge
 *

565 
	$bezõrsh≠e_£t_c‹√r_ty≥
(
BezõrSh≠e
 *
bez
, 
H™dÀ
 *
h™dÀ
,

566 
BezC‹√rTy≥
 
c‹√r_ty≥
)

568 
H™dÀ
 *
mid_h™dÀ
 = 
NULL
;

569 
Poöt
 
ﬁd_À·
, 
ﬁd_right
;

570 
ﬁd_ty≥
;

571 
h™dÀ_ƒ
, 
comp_ƒ
;

573 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
bez
, 
h™dÀ
);

575 
h™dÀ
->
id
) {

576 
HANDLE_BEZMAJOR
:

577 
mid_h™dÀ
 = 
h™dÀ
;

579 
HANDLE_LEFTCTRL
:

580 
h™dÀ_ƒ
++;

581 i‡(
h™dÀ_ƒ
 =
bez
->
obje˘
.
num_h™dÀs
) handle_nr = 0;

582 
mid_h™dÀ
 = 
bez
->
obje˘
.
h™dÀs
[
h™dÀ_ƒ
];

584 
HANDLE_RIGHTCTRL
:

585 
h™dÀ_ƒ
--;

586 i‡(
h™dÀ_ƒ
 < 0Ëh™dÀ_ƒ = 
bez
->
obje˘
.
num_h™dÀs
 - 1;

587 
mid_h™dÀ
 = 
bez
->
obje˘
.
h™dÀs
[
h™dÀ_ƒ
];

590 
	`g_as£π_nŸ_ªached
();

594 
comp_ƒ
 = 
	`gë_maj‹_ƒ
(
h™dÀ_ƒ
);

596 
ﬁd_ty≥
 = 
bez
->
c‹√r_ty≥s
[
comp_ƒ
];

597 
ﬁd_À·
 = 
bez
->
poöts
[
comp_ƒ
].
p2
;

598 i‡(
comp_ƒ
 =
bez
->
numpoöts
 - 1)

599 
ﬁd_right
 = 
bez
->
poöts
[1].
p1
;

601 
ﬁd_right
 = 
bez
->
poöts
[
comp_ƒ
+1].
p1
;

604 
	`g_mesßge
("Sëtög c‹√∏ty≥ o¿£gmíà%dÅÿ%s", 
comp_ƒ
,

605 
c‹√r_ty≥
 =
BEZ_CORNER_SYMMETRIC
 ? "symmetric" :

606 
c‹√r_ty≥
 =
BEZ_CORNER_SMOOTH
 ? "smooth" : "cusp");

608 
bez
->
c‹√r_ty≥s
[
comp_ƒ
] = 
c‹√r_ty≥
;

609 i‡(
comp_ƒ
 == 0)

610 
bez
->
c‹√r_ty≥s
[bez->
numpoöts
-1] = 
c‹√r_ty≥
;

611 i‡(
comp_ƒ
 =
bez
->
numpoöts
 - 1)

612 
bez
->
c‹√r_ty≥s
[0] = 
c‹√r_ty≥
;

614 
	`bezõrsh≠e_°øighãn_c‹√r
(
bez
, 
comp_ƒ
);

616  
	`bezõrsh≠e_¸óã_c‹√r_ch™ge
(
bez
, 
mid_h™dÀ
, &
ﬁd_À·
,

617 &
ﬁd_right
, 
ﬁd_ty≥
, 
c‹√r_ty≥
);

618 
	}
}

621 
	$bezõrsh≠e_upd©e_d©a
(
BezõrSh≠e
 *
bezõr
)

623 
i
;

624 
Poöt
 
œ°
;

625 
Poöt
 
möp
, 
maxp
;

627 
DüObje˘
 *
obj
 = &
bezõr
->
obje˘
;

630 i‡(3*(
bezõr
->
numpoöts
-1Ë!
obj
->
num_h™dÀs
 ||

631 2*(
bezõr
->
numpoöts
-1Ë+ 1 !
obj
->
num_c⁄√˘i⁄s
) {

632 
	`obje˘_unc⁄√˘_Æl
(
obj
);

635 
i
 = 0; i < 
obj
->
num_h™dÀs
; i++)

636 
	`g_‰ì
(
obj
->
h™dÀs
[
i
]);

637 
	`g_‰ì
(
obj
->
h™dÀs
);

638 
i
 = 0; i < 
obj
->
num_c⁄√˘i⁄s
; i++)

639 
	`g_‰ì
(
obj
->
c⁄√˘i⁄s
[
i
]);

640 
	`g_‰ì
(
obj
->
c⁄√˘i⁄s
);

642 
obj
->
num_h™dÀs
 = 3*(
bezõr
->
numpoöts
-1);

643 
obj
->
h™dÀs
 = 
	`g_√w
(
H™dÀ
*, obj->
num_h™dÀs
);

644 
obj
->
num_c⁄√˘i⁄s
 = 2*(
bezõr
->
numpoöts
-1) + 1;

645 
obj
->
c⁄√˘i⁄s
 = 
	`g_√w
(
C⁄√˘i⁄Poöt
 *, obj->
num_c⁄√˘i⁄s
);

647 
	`√w_h™dÀs_™d_c⁄√˘i⁄s
(
bezõr
, bezõr->
numpoöts
);

649 
bezõr
->
c‹√r_ty≥s
 = 
	`g_ªÆloc
(bezõr->c‹√r_ty≥s, bezõr->
numpoöts
*(
BezC‹√rTy≥
));

650 
i
 = 0; i < 
bezõr
->
numpoöts
; i++)

651 
bezõr
->
c‹√r_ty≥s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

655 
bezõr
->
poöts
[0].
p3
 = bezõr->poöts[0].
p1
;

656 
i
 = 1; i < 
bezõr
->
numpoöts
; i++) {

657 
obj
->
h™dÀs
[3*
i
-3]->
pos
 = 
bezõr
->
poöts
[i].
p1
;

658 
obj
->
h™dÀs
[3*
i
-2]->
pos
 = 
bezõr
->
poöts
[i].
p2
;

659 
obj
->
h™dÀs
[3*
i
-1]->
pos
 = 
bezõr
->
poöts
[i].
p3
;

663 
œ°
 = 
bezõr
->
poöts
[0].
p1
;

664 
i
 = 1; i < 
bezõr
->
numpoöts
; i++) {

665 
Poöt
 
¶›ïoöt1
, 
¶›ïoöt2
;

666 
¶›ïoöt1
 = 
bezõr
->
poöts
[
i
].
p1
;

667 
	`poöt_sub
(&
¶›ïoöt1
, &
œ°
);

668 
	`poöt_sˇÀ
(&
¶›ïoöt1
, .5);

669 
	`poöt_add
(&
¶›ïoöt1
, &
œ°
);

670 
¶›ïoöt2
 = 
bezõr
->
poöts
[
i
].
p2
;

671 
	`poöt_sub
(&
¶›ïoöt2
, &
bezõr
->
poöts
[
i
].
p3
);

672 
	`poöt_sˇÀ
(&
¶›ïoöt2
, .5);

673 
	`poöt_add
(&
¶›ïoöt2
, &
bezõr
->
poöts
[
i
].
p3
);

675 
obj
->
c⁄√˘i⁄s
[2*
i
-2]->
pos
 = 
œ°
;

676 
obj
->
c⁄√˘i⁄s
[2*
i
-2]->
dúe˘i⁄s
 =

677 
	`föd_¶›e_dúe˘i⁄s
(
œ°
, 
bezõr
->
poöts
[
i
].
p1
);

678 
obj
->
c⁄√˘i⁄s
[2*
i
-1]->
pos
.
x
 =

679 (
œ°
.
x
 + 3*
bezõr
->
poöts
[
i
].
p1
.x + 3*bezõr->poöts[i].
p2
.x +

680 
bezõr
->
poöts
[
i
].
p3
.
x
)/8;

681 
obj
->
c⁄√˘i⁄s
[2*
i
-1]->
pos
.
y
 =

682 (
œ°
.
y
 + 3*
bezõr
->
poöts
[
i
].
p1
.y + 3*bezõr->poöts[i].
p2
.y +

683 
bezõr
->
poöts
[
i
].
p3
.
y
)/8;

684 
obj
->
c⁄√˘i⁄s
[2*
i
-1]->
dúe˘i⁄s
 =

685 
	`föd_¶›e_dúe˘i⁄s
(
¶›ïoöt1
, 
¶›ïoöt2
);

686 
œ°
 = 
bezõr
->
poöts
[
i
].
p3
;

690 
möp
 = 
maxp
 = 
bezõr
->
poöts
[0].
p1
;

691 
i
 = 1; i < 
bezõr
->
numpoöts
; i++) {

692 
Poöt
 
p
 = 
bezõr
->
poöts
[
i
].
p3
;

693 i‡(
p
.
x
 < 
möp
.x) minp.x =Ö.x;

694 i‡(
p
.
x
 > 
maxp
.x) maxp.x =Ö.x;

695 i‡(
p
.
y
 < 
möp
.y) minp.y =Ö.y;

696 i‡(
p
.
y
 > 
maxp
.y) maxp.y =Ö.y;

698 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1]->
pos
.
x
 = (
möp
.x + 
maxp
.x) / 2;

699 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1]->
pos
.
y
 = (
möp
.y + 
maxp
.y) / 2;

700 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1]->
dúe˘i⁄s
 = 
DIR_ALL
;

701 
	}
}

704 
	$bezõrsh≠e_upd©e_boundögbox
(
BezõrSh≠e
 *
bezõr
)

706 
EÀmítBBExåas
 *
exåa
;

707 
PﬁyBBExåas
 
≥xåa
;

709 
	`g_as£π
(
bezõr
 !
NULL
);

711 
exåa
 = &
bezõr
->
exåa_•acög
;

712 
≥xåa
.
°¨t_å™s
 =Öexåa.
íd_å™s
 =

713 
≥xåa
.
°¨t_l⁄g
 =Öexåa.
íd_l⁄g
 = 0;

714 
≥xåa
.
middÀ_å™s
 = 
exåa
->
b‹dî_å™s
;

716 
	`pﬁybezõr_bbox
(&
bezõr
->
poöts
[0],

717 
bezõr
->
numpoöts
,

718 &
≥xåa
, 
TRUE
,

719 &
bezõr
->
obje˘
.
boundög_box
);

720 
	}
}

723 
	$bezõrsh≠e_sim∂e_døw
(
BezõrSh≠e
 *
bezõr
, 
DüRídîî
 *
ªndîî
, 
ªÆ
 
width
)

725 
BezPoöt
 *
poöts
;

727 
	`g_as£π
(
bezõr
 !
NULL
);

728 
	`g_as£π
(
ªndîî
 !
NULL
);

730 
poöts
 = &
bezõr
->points[0];

732 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
width
);

733 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

734 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_ROUND
);

735 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

737 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`fûl_bezõr
‘ídîî, 
poöts
, 
bezõr
->
numpoöts
,&
cﬁ‹_whôe
);

738 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_bezõr
‘ídîî, 
poöts
, 
bezõr
->
numpoöts
,&
cﬁ‹_bœck
);

739 
	}
}

742 
	$bezõrsh≠e_døw_c⁄åﬁ_löes
(
BezõrSh≠e
 *
bez
, 
DüRídîî
 *
ªndîî
)

744 
Cﬁ‹
 
löe_cﬁour
 = {0.0, 0.0, 0.6};

745 
Poöt
 
°¨çoöt
;

746 
i
;

749 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
(renderer, 0);

750 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_DOTTED
);

751 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_dashÀngth
(renderer, 1);

752 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

753 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

755 
°¨çoöt
 = 
bez
->
poöts
[0].
p1
;

756 
i
 = 1; i < 
bez
->
numpoöts
; i++) {

757 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
°¨çoöt
, &
bez
->
poöts
[
i
].
p1
,

758 &
löe_cﬁour
);

759 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
bez
->
poöts
[
i
].
p2
, &bez->poöts[i].
p3
,

760 &
löe_cﬁour
);

761 
°¨çoöt
 = 
bez
->
poöts
[
i
].
p3
;

763 
	}
}

766 
	$√w_h™dÀs_™d_c⁄√˘i⁄s
(
BezõrSh≠e
 *
bezõr
, 
num_poöts
)

768 
DüObje˘
 *
obj
;

769 
i
;

771 
obj
 = &
bezõr
->
obje˘
;

773 
i
 = 0; i < 
num_poöts
-1; i++) {

774 
obj
->
h™dÀs
[3*
i
] = 
	`g_√w0
(
H™dÀ
,1);

775 
obj
->
h™dÀs
[3*
i
+1] = 
	`g_√w0
(
H™dÀ
,1);

776 
obj
->
h™dÀs
[3*
i
+2] = 
	`g_√w0
(
H™dÀ
,1);

778 
obj
->
h™dÀs
[3*
i
]->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

779 
obj
->
h™dÀs
[3*
i
]->
c⁄√˘ed_to
 = 
NULL
;

780 
obj
->
h™dÀs
[3*
i
]->
ty≥
 = 
HANDLE_MINOR_CONTROL
;

781 
obj
->
h™dÀs
[3*
i
]->
id
 = 
HANDLE_RIGHTCTRL
;

783 
obj
->
h™dÀs
[3*
i
+1]->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

784 
obj
->
h™dÀs
[3*
i
+1]->
c⁄√˘ed_to
 = 
NULL
;

785 
obj
->
h™dÀs
[3*
i
+1]->
ty≥
 = 
HANDLE_MINOR_CONTROL
;

786 
obj
->
h™dÀs
[3*
i
+1]->
id
 = 
HANDLE_LEFTCTRL
;

788 
obj
->
h™dÀs
[3*
i
+2]->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

789 
obj
->
h™dÀs
[3*
i
+2]->
c⁄√˘ed_to
 = 
NULL
;

790 
obj
->
h™dÀs
[3*
i
+2]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

791 
obj
->
h™dÀs
[3*
i
+2]->
id
 = 
HANDLE_BEZMAJOR
;

793 
obj
->
c⁄√˘i⁄s
[2*
i
] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

794 
obj
->
c⁄√˘i⁄s
[2*
i
+1] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

795 
obj
->
c⁄√˘i⁄s
[2*
i
]->
obje˘
 = obj;

796 
obj
->
c⁄√˘i⁄s
[2*
i
+1]->
obje˘
 = obj;

797 
obj
->
c⁄√˘i⁄s
[2*
i
]->
Êags
 = 0;

798 
obj
->
c⁄√˘i⁄s
[2*
i
+1]->
Êags
 = 0;

802 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

803 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1]->
obje˘
 = obj;

804 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1]->
Êags
 = 
CP_FLAGS_MAIN
;

805 
	}
}

808 
	$bezõrsh≠e_öô
(
BezõrSh≠e
 *
bezõr
, 
num_poöts
)

810 
DüObje˘
 *
obj
;

811 
i
;

813 
obj
 = &
bezõr
->
obje˘
;

815 
	`obje˘_öô
(
obj
, 3*(
num_poöts
-1), 2*(num_points-1) + 1);

817 
bezõr
->
numpoöts
 = 
num_poöts
;

819 
bezõr
->
poöts
 = 
	`g_√w
(
BezPoöt
, 
num_poöts
);

820 
bezõr
->
poöts
[0].
ty≥
 = 
BEZ_MOVE_TO
;

821 
bezõr
->
c‹√r_ty≥s
 = 
	`g_√w
(
BezC‹√rTy≥
, 
num_poöts
);

822 
i
 = 1; i < 
num_poöts
; i++) {

823 
bezõr
->
poöts
[
i
].
ty≥
 = 
BEZ_CURVE_TO
;

824 
bezõr
->
c‹√r_ty≥s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

827 
	`√w_h™dÀs_™d_c⁄√˘i⁄s
(
bezõr
, 
num_poöts
);

832 
	}
}

837 
	$bezõrsh≠e_£t_poöts
(
BezõrSh≠e
 *
bez
, 
num_poöts
, 
BezPoöt
 *
poöts
)

839 
i
;

841 
bez
->
numpoöts
 = 
num_poöts
;

843 i‡(
bez
->
poöts
)

844 
	`g_‰ì
(
bez
->
poöts
);

846 
bez
->
poöts
 = 
	`g_mÆloc
((bez->
numpoöts
)*(
BezPoöt
));

848 
i
=0;i<
bez
->
numpoöts
;i++) {

849 
bez
->
poöts
[
i
] =Öoints[i];

851 
	}
}

854 
	$bezõrsh≠e_c›y
(
BezõrSh≠e
 *
‰om
, BezõrSh≠ê*
to
)

856 
i
;

857 
DüObje˘
 *
toobj
, *
‰omobj
;

859 
toobj
 = &
to
->
obje˘
;

860 
‰omobj
 = &
‰om
->
obje˘
;

862 
	`obje˘_c›y
(
‰omobj
, 
toobj
);

864 
to
->
numpoöts
 = 
‰om
->numpoints;

866 
to
->
poöts
 = 
	`g_√w
(
BezPoöt
,Åo->
numpoöts
);

867 
to
->
c‹√r_ty≥s
 = 
	`g_√w
(
BezC‹√rTy≥
,Åo->
numpoöts
);

869 
i
 = 0; i < 
to
->
numpoöts
; i++) {

870 
to
->
poöts
[
i
] = 
‰om
->points[i];

871 
to
->
c‹√r_ty≥s
[
i
] = 
‰om
->corner_types[i];

874 
i
 = 0; i < 
toobj
->
num_h™dÀs
; i++) {

875 
toobj
->
h™dÀs
[
i
] = 
	`g_√w0
(
H™dÀ
,1);

876 
	`£tup_h™dÀ
(
toobj
->
h™dÀs
[
i
], 
‰omobj
->h™dÀs[i]->
id
);

878 
i
 = 0; i < 
toobj
->
num_c⁄√˘i⁄s
; i++) {

879 
toobj
->
c⁄√˘i⁄s
[
i
] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

880 
toobj
->
c⁄√˘i⁄s
[
i
]->
obje˘
 = &
to
->object;

881 
toobj
->
c⁄√˘i⁄s
[
i
]->
Êags
 = 
‰omobj
->connections[i]->flags;

884 
	`mem˝y
(&
to
->
exåa_•acög
,&
‰om
->extra_spacing,(to->extra_spacing));

885 
	`bezõrsh≠e_upd©e_d©a
(
to
);

886 
	}
}

889 
	$bezõrsh≠e_de°roy
(
BezõrSh≠e
 *
bezõr
)

891 
i
;

892 
H™dÀ
 **
ãmp_h™dÀs
;

893 
C⁄√˘i⁄Poöt
 **
ãmp_˝s
;

897 
ãmp_h™dÀs
 = 
	`g_√w
(
H™dÀ
 *, 
bezõr
->
obje˘
.
num_h™dÀs
);

898 
i
 = 0; i < 
bezõr
->
obje˘
.
num_h™dÀs
; i++)

899 
ãmp_h™dÀs
[
i
] = 
bezõr
->
obje˘
.
h™dÀs
[i];

901 
ãmp_˝s
 = 
	`g_√w
(
C⁄√˘i⁄Poöt
 *, 
bezõr
->
obje˘
.
num_c⁄√˘i⁄s
);

902 
i
 = 0; i < 
bezõr
->
obje˘
.
num_c⁄√˘i⁄s
; i++)

903 
ãmp_˝s
[
i
] = 
bezõr
->
obje˘
.
c⁄√˘i⁄s
[i];

905 
	`obje˘_de°roy
(&
bezõr
->
obje˘
);

907 
i
 = 0; i < 
bezõr
->
obje˘
.
num_h™dÀs
; i++)

908 
	`g_‰ì
(
ãmp_h™dÀs
[
i
]);

909 
	`g_‰ì
(
ãmp_h™dÀs
);

911 
i
 = 0; i < 
bezõr
->
obje˘
.
num_c⁄√˘i⁄s
; i++)

912 
	`g_‰ì
(
ãmp_˝s
[
i
]);

913 
	`g_‰ì
(
ãmp_˝s
);

915 
	`g_‰ì
(
bezõr
->
poöts
);

916 
	`g_‰ì
(
bezõr
->
c‹√r_ty≥s
);

917 
	}
}

921 
	$bezõrsh≠e_ßve
(
BezõrSh≠e
 *
bezõr
, 
Obje˘Node
 
obj_node
)

923 
i
;

924 
AâribuãNode
 
©å
;

926 
	`obje˘_ßve
(&
bezõr
->
obje˘
, 
obj_node
);

928 
©å
 = 
	`√w_©åibuã
(
obj_node
, "bez_points");

930 
	`d©a_add_poöt
(
©å
, &
bezõr
->
poöts
[0].
p1
);

931 
i
 = 1; i < 
bezõr
->
numpoöts
; i++) {

932 
	`d©a_add_poöt
(
©å
, &
bezõr
->
poöts
[
i
].
p1
);

933 
	`d©a_add_poöt
(
©å
, &
bezõr
->
poöts
[
i
].
p2
);

934 i‡(
i
 < 
bezõr
->
numpoöts
 - 1)

935 
	`d©a_add_poöt
(
©å
, &
bezõr
->
poöts
[
i
].
p3
);

938 
©å
 = 
	`√w_©åibuã
(
obj_node
, "corner_types");

939 
i
 = 0; i < 
bezõr
->
numpoöts
; i++)

940 
	`d©a_add_íum
(
©å
, 
bezõr
->
c‹√r_ty≥s
[
i
]);

941 
	}
}

944 
	$bezõrsh≠e_lﬂd
(
BezõrSh≠e
 *
bezõr
, 
Obje˘Node
 
obj_node
)

946 
i
;

947 
AâribuãNode
 
©å
;

948 
D©aNode
 
d©a
;

950 
DüObje˘
 *
obj
 = &
bezõr
->
obje˘
;

952 
	`obje˘_lﬂd
(
obj
, 
obj_node
);

954 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "bez_points");

956 i‡(
©å
 !
NULL
)

957 
bezõr
->
numpoöts
 = 
	`©åibuã_num_d©a
(
©å
) / 3 + 1;

959 
bezõr
->
numpoöts
 = 0;

961 
	`obje˘_öô
(
obj
, 3 * (
bezõr
->
numpoöts
 - 1),

962 2 * (
bezõr
->
numpoöts
 - 1) + 1);

964 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

965 i‡(
bezõr
->
numpoöts
 != 0) {

966 
bezõr
->
poöts
 = 
	`g_√w
(
BezPoöt
, bezõr->
numpoöts
);

967 
bezõr
->
poöts
[0].
ty≥
 = 
BEZ_MOVE_TO
;

968 
	`d©a_poöt
(
d©a
, &
bezõr
->
poöts
[0].
p1
);

969 
bezõr
->
poöts
[0].
p3
 = bezõr->poöts[0].
p1
;

970 
d©a
 = 
	`d©a_√xt
(data);

972 
i
 = 1; i < 
bezõr
->
numpoöts
; i++) {

973 
bezõr
->
poöts
[
i
].
ty≥
 = 
BEZ_CURVE_TO
;

974 
	`d©a_poöt
(
d©a
, &
bezõr
->
poöts
[
i
].
p1
);

975 
d©a
 = 
	`d©a_√xt
(data);

976 
	`d©a_poöt
(
d©a
, &
bezõr
->
poöts
[
i
].
p2
);

977 
d©a
 = 
	`d©a_√xt
(data);

978 i‡(
i
 < 
bezõr
->
numpoöts
 - 1) {

979 
	`d©a_poöt
(
d©a
, &
bezõr
->
poöts
[
i
].
p3
);

980 
d©a
 = 
	`d©a_√xt
(data);

982 
bezõr
->
poöts
[
i
].
p3
 = bezõr->poöts[0].
p1
;

986 
bezõr
->
c‹√r_ty≥s
 = 
	`g_√w
(
BezC‹√rTy≥
, bezõr->
numpoöts
);

987 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "corner_types");

988 i‡(!
©å
 || 
	`©åibuã_num_d©a
◊ârË!
bezõr
->
numpoöts
) {

989 
i
 = 0; i < 
bezõr
->
numpoöts
; i++)

990 
bezõr
->
c‹√r_ty≥s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

992 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

993 
i
 = 0; i < 
bezõr
->
numpoöts
; i++) {

994 
bezõr
->
c‹√r_ty≥s
[
i
] = 
	`d©a_íum
(
d©a
);

995 
d©a
 = 
	`d©a_√xt
(data);

999 
i
 = 0; i < 
bezõr
->
numpoöts
 - 1; i++) {

1000 
obj
->
h™dÀs
[3*
i
] = 
	`g_√w0
(
H™dÀ
,1);

1001 
obj
->
h™dÀs
[3*
i
+1] = 
	`g_√w0
(
H™dÀ
,1);

1002 
obj
->
h™dÀs
[3*
i
+2] = 
	`g_√w0
(
H™dÀ
,1);

1004 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[3*
i
], 
HANDLE_RIGHTCTRL
);

1005 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[3*
i
+1], 
HANDLE_LEFTCTRL
);

1006 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[3*
i
+2], 
HANDLE_BEZMAJOR
);

1008 
i
 = 0; i < 
obj
->
num_c⁄√˘i⁄s
; i++) {

1009 
obj
->
c⁄√˘i⁄s
[
i
] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

1010 
obj
->
c⁄√˘i⁄s
[
i
]->
obje˘
 = obj;

1012 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1]->
Êags
 = 
CP_FLAGS_MAIN
;

1014 
	`bezõrsh≠e_upd©e_d©a
(
bezõr
);

1015 
	}
}

1018 
	$bezõrsh≠e_poöt_ch™ge_‰ì
(
BezPoötCh™ge
 *
ch™ge
)

1020 i‡–(
ch™ge
->
ty≥
==
TYPE_ADD_POINT
 && !ch™ge->
≠∂õd
) ||

1021 (
ch™ge
->
ty≥
==
TYPE_REMOVE_POINT
 && ch™ge->
≠∂õd
) ){

1022 
	`g_‰ì
(
ch™ge
->
h™dÀ1
);

1023 
	`g_‰ì
(
ch™ge
->
h™dÀ2
);

1024 
	`g_‰ì
(
ch™ge
->
h™dÀ3
);

1025 
	`g_‰ì
(
ch™ge
->
˝1
);

1026 
	`g_‰ì
(
ch™ge
->
˝2
);

1027 
ch™ge
->
h™dÀ1
 = 
NULL
;

1028 
ch™ge
->
h™dÀ2
 = 
NULL
;

1029 
ch™ge
->
h™dÀ3
 = 
NULL
;

1030 
ch™ge
->
˝1
 = 
NULL
;

1031 
ch™ge
->
˝2
 = 
NULL
;

1033 
	}
}

1036 
	$bezõrsh≠e_poöt_ch™ge_≠∂y
(
BezPoötCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1038 
ch™ge
->
≠∂õd
 = 1;

1039 
ch™ge
->
ty≥
) {

1040 
TYPE_ADD_POINT
:

1041 
	`add_h™dÀs
((
BezõrSh≠e
 *)
obj
, 
ch™ge
->
pos
, &ch™ge->
poöt
,

1042 
ch™ge
->
c‹√r_ty≥
,

1043 
ch™ge
->
h™dÀ1
, ch™ge->
h™dÀ2
, ch™ge->
h™dÀ3
,

1044 
ch™ge
->
˝1
, ch™ge->
˝2
);

1046 
TYPE_REMOVE_POINT
:

1047 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ1
);

1048 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ2
);

1049 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ3
);

1050 
	`ªmove_h™dÀs
((
BezõrSh≠e
 *)
obj
, 
ch™ge
->
pos
);

1053 
	}
}

1056 
	$bezõrsh≠e_poöt_ch™ge_ªvît
(
BezPoötCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1058 
ch™ge
->
ty≥
) {

1059 
TYPE_ADD_POINT
:

1060 
	`ªmove_h™dÀs
((
BezõrSh≠e
 *)
obj
, 
ch™ge
->
pos
);

1062 
TYPE_REMOVE_POINT
:

1063 
	`add_h™dÀs
((
BezõrSh≠e
 *)
obj
, 
ch™ge
->
pos
, &ch™ge->
poöt
,

1064 
ch™ge
->
c‹√r_ty≥
,

1065 
ch™ge
->
h™dÀ1
, ch™ge->
h™dÀ2
, ch™ge->
h™dÀ3
,

1066 
ch™ge
->
˝1
, ch™ge->
˝2
);

1069 
ch™ge
->
≠∂õd
 = 0;

1070 
	}
}

1072 
Obje˘Ch™ge
 *

1073 
	$bezõrsh≠e_¸óã_poöt_ch™ge
(
BezõrSh≠e
 *
bezõr
, 
ch™ge_ty≥
 
ty≥
,

1074 
BezPoöt
 *
poöt
, 
BezC‹√rTy≥
 
c‹√r_ty≥
,

1075 
pos
,

1076 
H™dÀ
 *
h™dÀ1
, H™dÀ *
h™dÀ2
,

1077 
H™dÀ
 *
h™dÀ3
,

1078 
C⁄√˘i⁄Poöt
 *
˝1
, C⁄√˘i⁄Poöà*
˝2
)

1080 
BezPoötCh™ge
 *
ch™ge
;

1082 
ch™ge
 = 
	`g_√w
(
BezPoötCh™ge
, 1);

1084 
ch™ge
->
obj_ch™ge
.
≠∂y
 =

1085 (
Obje˘Ch™geAµlyFunc
)
bezõrsh≠e_poöt_ch™ge_≠∂y
;

1086 
ch™ge
->
obj_ch™ge
.
ªvît
 =

1087 (
Obje˘Ch™geRevîtFunc
)
bezõrsh≠e_poöt_ch™ge_ªvît
;

1088 
ch™ge
->
obj_ch™ge
.
‰ì
 =

1089 (
Obje˘Ch™geFªeFunc
)
bezõrsh≠e_poöt_ch™ge_‰ì
;

1091 
ch™ge
->
ty≥
 =Åype;

1092 
ch™ge
->
≠∂õd
 = 1;

1093 
ch™ge
->
poöt
 = *point;

1094 
ch™ge
->
c‹√r_ty≥
 = corner_type;

1095 
ch™ge
->
pos
 =Öos;

1096 
ch™ge
->
h™dÀ1
 = handle1;

1097 
ch™ge
->
h™dÀ2
 = handle2;

1098 
ch™ge
->
h™dÀ3
 = handle3;

1099 
ch™ge
->
˝1
 = cp1;

1100 
ch™ge
->
˝2
 = cp2;

1102  (
Obje˘Ch™ge
 *)
ch™ge
;

1103 
	}
}

1106 
	$bezõrsh≠e_c‹√r_ch™ge_≠∂y
(
C‹√rCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1108 
BezõrSh≠e
 *
bez
 = (BezõrSh≠ê*)
obj
;

1109 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
bez
, 
ch™ge
->
h™dÀ
);

1110 
comp_ƒ
 = 
	`gë_maj‹_ƒ
(
h™dÀ_ƒ
);

1112 
	`bezõrsh≠e_°øighãn_c‹√r
(
bez
, 
comp_ƒ
);

1114 
bez
->
c‹√r_ty≥s
[
comp_ƒ
] = 
ch™ge
->
√w_ty≥
;

1115 i‡(
comp_ƒ
 == 0)

1116 
bez
->
c‹√r_ty≥s
[bez->
numpoöts
-1] = 
ch™ge
->
√w_ty≥
;

1117 i‡(
comp_ƒ
 =
bez
->
numpoöts
 - 1)

1118 
bez
->
c‹√r_ty≥s
[0] = 
ch™ge
->
√w_ty≥
;

1120 
ch™ge
->
≠∂õd
 = 1;

1121 
	}
}

1124 
	$bezõrsh≠e_c‹√r_ch™ge_ªvît
(
C‹√rCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1126 
BezõrSh≠e
 *
bez
 = (BezõrSh≠ê*)
obj
;

1127 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
bez
, 
ch™ge
->
h™dÀ
);

1128 
comp_ƒ
 = 
	`gë_maj‹_ƒ
(
h™dÀ_ƒ
);

1130 
bez
->
poöts
[
comp_ƒ
].
p2
 = 
ch™ge
->
poöt_À·
;

1131 i‡(
comp_ƒ
 =
bez
->
numpoöts
 - 1)

1132 
bez
->
poöts
[1].
p1
 = 
ch™ge
->
poöt_right
;

1134 
bez
->
poöts
[
comp_ƒ
+1].
p1
 = 
ch™ge
->
poöt_right
;

1135 
bez
->
c‹√r_ty≥s
[
comp_ƒ
] = 
ch™ge
->
ﬁd_ty≥
;

1136 i‡(
comp_ƒ
 == 0)

1137 
bez
->
c‹√r_ty≥s
[bez->
numpoöts
-1] = 
ch™ge
->
√w_ty≥
;

1138 i‡(
comp_ƒ
 =
bez
->
numpoöts
 - 1)

1139 
bez
->
c‹√r_ty≥s
[0] = 
ch™ge
->
√w_ty≥
;

1141 
ch™ge
->
≠∂õd
 = 0;

1142 
	}
}

1144 
Obje˘Ch™ge
 *

1145 
	$bezõrsh≠e_¸óã_c‹√r_ch™ge
(
BezõrSh≠e
 *
bez
, 
H™dÀ
 *
h™dÀ
,

1146 
Poöt
 *
poöt_À·
, Poöà*
poöt_right
,

1147 
BezC‹√rTy≥
 
ﬁd_c‹√r_ty≥
,

1148 
BezC‹√rTy≥
 
√w_c‹√r_ty≥
)

1150 
C‹√rCh™ge
 *
ch™ge
;

1152 
ch™ge
 = 
	`g_√w
(
C‹√rCh™ge
, 1);

1154 
ch™ge
->
obj_ch™ge
.
≠∂y
 =

1155 (
Obje˘Ch™geAµlyFunc
)
bezõrsh≠e_c‹√r_ch™ge_≠∂y
;

1156 
ch™ge
->
obj_ch™ge
.
ªvît
 =

1157 (
Obje˘Ch™geRevîtFunc
)
bezõrsh≠e_c‹√r_ch™ge_ªvît
;

1158 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
)
NULL
;

1160 
ch™ge
->
ﬁd_ty≥
 = 
ﬁd_c‹√r_ty≥
;

1161 
ch™ge
->
√w_ty≥
 = 
√w_c‹√r_ty≥
;

1162 
ch™ge
->
≠∂õd
 = 1;

1164 
ch™ge
->
h™dÀ
 = handle;

1165 
ch™ge
->
poöt_À·
 = *point_left;

1166 
ch™ge
->
poöt_right
 = *point_right;

1168  (
Obje˘Ch™ge
 *)
ch™ge
;

1169 
	}
}

	@O:\tool\dvs50\lib\beziershape.h

24 #i‚de‡
BEZIERSHAPE_H


25 
	#BEZIERSHAPE_H


	)

27 
	~"düty≥s.h
"

28 
	~"obje˘.h
"

30 
	~"bezõr_c⁄n.h
"

32 
	#HANDLE_CORNER
 (
HANDLE_CUSTOM1
)

	)

37 
	s_BezõrSh≠e
 {

39 
DüObje˘
 
	mobje˘
;

41 
	mnumpoöts
;

42 
BezPoöt
 *
	mpoöts
;

43 
BezC‹√rTy≥
 *
	mc‹√r_ty≥s
;

44 
EÀmítBBExåas
 
	mexåa_•acög
;

47 
DIAVAR
 
bezõrsh≠e_upd©e_d©a
(
BezõrSh≠e
 *
bezõr
);

48 
DIAVAR
 
bezõrsh≠e_upd©e_boundögbox
(
BezõrSh≠e
 *
bezõr
);

49 
bezõrsh≠e_sim∂e_døw
(
BezõrSh≠e
 *
bezõr
, 
DüRídîî
 *
ªndîî
,

50 
ªÆ
 
width
);

51 
DIAVAR
 
bezõrsh≠e_öô
(
BezõrSh≠e
 *
bezõr
, 
num_poöts
);

52 
DIAVAR
 
bezõrsh≠e_£t_poöts
(
BezõrSh≠e
 *
bezõr
, 
num_poöts
, 
BezPoöt
 *
poöts
);

53 
DIAVAR
 
bezõrsh≠e_de°roy
(
BezõrSh≠e
 *
bezõr
);

54 
DIAVAR
 
bezõrsh≠e_c›y
(
BezõrSh≠e
 *
‰om
, BezõrSh≠ê*
to
);

55 
DIAVAR
 
bezõrsh≠e_ßve
(
BezõrSh≠e
 *
bezõr
, 
Obje˘Node
 
obj_node
);

57 
DIAVAR
 
bezõrsh≠e_lﬂd
(
BezõrSh≠e
 *
bezõr
, 
Obje˘Node
 
obj_node
);

58 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrsh≠e_add_£gmít
(
BezõrSh≠e
 *
bezõr
, 
£gmít
,

59 
Poöt
 *
poöt
);

60 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrsh≠e_ªmove_£gmít
(
BezõrSh≠e
 *
bezõr
, 
poöt
);

61 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrsh≠e_£t_c‹√r_ty≥
(
BezõrSh≠e
 *
bez
, 
H™dÀ
 *
h™dÀ
,

62 
BezC‹√rTy≥
 
c‹√r_ty≥
);

63 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrsh≠e_move_h™dÀ
(
BezõrSh≠e
 *
bezõr
, 
H™dÀ
 *
id
,

64 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

65 
H™dÀMoveRós⁄
 
ªas⁄
,

66 
ModifõrKeys
 
modifõrs
);

67 
DIAVAR
 
Obje˘Ch™ge
 *
bezõrsh≠e_move
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
to
);

68 
DIAVAR
 
ªÆ
 
bezõrsh≠e_di°™˚_‰om
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
poöt
,

69 
ªÆ
 
löe_width
);

70 
DIAVAR
 
H™dÀ
 *
bezõrsh≠e_˛o£°_h™dÀ
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
poöt
);

71 
DIAVAR
 
H™dÀ
 *
bezõrsh≠e_˛o£°_maj‹_h™dÀ
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
poöt
);

72 
DIAVAR
 
bezõrsh≠e_˛o£°_£gmít
(
BezõrSh≠e
 *
bezõr
, 
Poöt
 *
poöt
,

73 
ªÆ
 
löe_width
);

74 
DIAVAR
 
bezõrsh≠e_døw_c⁄åﬁ_löes
(
BezõrSh≠e
 *
bez
, 
DüRídîî
 *
ªndîî
);

76 
	#BEZSHAPE_COMMON_PROPERTIES
 \

77 
OBJECT_COMMON_PROPERTIES
, \

78 { "bez_poöts", 
PROP_TYPE_BEZPOINTARRAY
, 0, "bezõrsh≠êpoöts", 
NULL
} \

79 

	)

80 
	#BEZSHAPE_COMMON_PROPERTIES_OFFSETS
 \

81 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

82 { "bez_poöts", 
PROP_TYPE_BEZPOINTARRAY
, \

83 
	`off£tof
(
BezõrSh≠e
,
poöts
), off£tof(BezõrSh≠e,
numpoöts
)} \

84 

	)

	@O:\tool\dvs50\lib\boundingbox.c

22 
	~<c⁄fig.h
>

24 
	#_BSD_SOURCE
 1

	)

25 
	~<m©h.h
>

26 
	~<°rög.h
>

28 
	~<glib.h
>

30 
	~"geomëry.h
"

31 
	~"boundögbox.h
"

43 
	$bîn°eö_devñ›
(c⁄° 
ªÆ
 
p
[4],Ñó»*
A
,Ñó»*
B
,Ñó»*
C
,Ñó»*
D
)

45 *
A
 = -
p
[0]+3*p[1]-3*p[2]+p[3];

46 *
B
 = 3*
p
[0]-6*p[1]+3*p[2];

47 *
C
 = -3*
p
[0]+3*p[1];

48 *
D
 = 
p
[0];

51 
	}
}

58 
ªÆ


59 
	$bezõr_evÆ
(c⁄° 
ªÆ
 
p
[4],Ñó»
u
)

61 
ªÆ
 
A
,
B
,
C
,
D
;

62 
	`bîn°eö_devñ›
(
p
,&
A
,&
B
,&
C
,&
D
);

63  
A
*
u
*u*u+
B
*u*u+
C
*u+
D
;

64 
	}
}

71 
ªÆ


72 
	$bezõr_evÆ_èngít
(c⁄° 
ªÆ
 
p
[4],Ñó»
u
)

74 
ªÆ
 
A
,
B
,
C
,
D
;

75 
	`bîn°eö_devñ›
(
p
,&
A
,&
B
,&
C
,&
D
);

76  3*
A
*
u
*u+2*
B
*u+
C
;

77 
	}
}

86 
	$bicubicbezõr_exåema
(c⁄° 
ªÆ
 
p
[4],ªÆ 
u
[2])

88 
ªÆ
 
A
,
B
,
C
,
D
,
dñè
;

90 
	`bîn°eö_devñ›
(
p
,&
A
,&
B
,&
C
,&
D
);

91 
dñè
 = 4*
B
*B - 12*
A
*
C
;

93 
u
[0] = u[1] = 0.0;

94 i‡(
dñè
<0)  0;

97 i‡(
	`Ábs
(
A
) < 1e-6) {

98 
u
[0] = -
C
/(2*
B
);

102 
u
[0] = (-2*
B
 + 
	`sqπ
(
dñè
)Ë/ (6*
A
);

103 i‡(
dñè
==0)  1;

104 
u
[1] = (-2*
B
 - 
	`sqπ
(
dñè
)Ë/ (6*
A
);

106 
	}
}

118 
	$add_¨row_ª˘™gÀ
(
Re˘™gÀ
 *
ª˘
,

119 c⁄° 
Poöt
 *
vîãx
,

120 c⁄° 
Poöt
 *
n‹med_dú
,

121 
ªÆ
 
exåa_l⁄g
,ªÆ 
exåa_å™s
)

123 
Poöt
 
vl
,
vt
,
±
;

124 
vl
 = *
n‹med_dú
;

126 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

127 
	`poöt_c›y_add_sˇÀd
(&
±
,
vîãx
,&
vl
,
exåa_l⁄g
);

128 
	`poöt_add_sˇÀd
(&
±
,&
vt
,
exåa_å™s
);

129 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
±
);

130 
	`poöt_add_sˇÀd
(&
±
,&
vt
,-2.0 * 
exåa_å™s
);

131 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
±
);

132 
	`poöt_add_sˇÀd
(&
±
,&
vl
,-2.0 * 
exåa_l⁄g
);

133 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
±
);

134 
	`poöt_add_sˇÀd
(&
±
,&
vt
,2.0 * 
exåa_å™s
);

135 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
±
);

136 
	}
}

147 
	$bicubicbezõr2D_bbox
(c⁄° 
Poöt
 *
p0
,c⁄° Poöà*
p1
,

148 c⁄° 
Poöt
 *
p2
,c⁄° Poöà*
p3
,

149 c⁄° 
PﬁyBBExåas
 *
exåa
,

150 
Re˘™gÀ
 *
ª˘
)

152 
ªÆ
 
x
[4],
y
[4];

153 
Poöt
 
vl
,
vt
,
p
,
â
;

154 
ªÆ
 *
xy
;

155 
i
,
exå
;

156 
ªÆ
 
u
[2];

158 
ª˘
->
À·
 =Ñe˘->
right
 = 
p0
->
x
;

159 
ª˘
->
t›
 =Ñe˘->
bŸtom
 = 
p0
->
y
;

161 
	`ª˘™gÀ_add_poöt
(
ª˘
,
p3
);

163 
	`poöt_c›y_add_sˇÀd
(&
vl
,
p0
,
p1
,-1);

164 
	`poöt_n‹mÆize
(&
vl
);

165 
	`add_¨row_ª˘™gÀ
(
ª˘
,
p0
,&
vl
,
exåa
->
°¨t_l⁄g
,
	`MAX
”xåa->
°¨t_å™s
,

166 
exåa
->
middÀ_å™s
));

169 
	`poöt_c›y_add_sˇÀd
(&
vl
,
p3
,
p2
,-1);

170 
	`poöt_n‹mÆize
(&
vl
);

171 
	`add_¨row_ª˘™gÀ
(
ª˘
,
p3
,&
vl
,
exåa
->
íd_l⁄g
,
	`MAX
”xåa->
íd_å™s
,

172 
exåa
->
middÀ_å™s
));

175 
x
[0] = 
p0
->x; x[1] = 
p1
->x; x[2] = 
p2
->x; x[3] = 
p3
->x;

176 
y
[0] = 
p0
->y; y[1] = 
p1
->y; y[2] = 
p2
->y; y[3] = 
p3
->y;

178 
xy
 = 
x
; xy ; xy=(xy==x?
y
:
NULL
) ) {

179 
exå
 = 
	`bicubicbezõr_exåema
(
xy
,
u
);

180 
i
=0;i<
exå
;i++) {

181 i‡((
u
[
i
]<0) || (u[i]>1)) ;

182 
p
.
x
 = 
	`bezõr_evÆ
(x,
u
[
i
]);

183 
vl
.
x
 = 
	`bezõr_evÆ_èngít
(x,
u
[
i
]);

184 
p
.
y
 = 
	`bezõr_evÆ
(y,
u
[
i
]);

185 
vl
.
y
 = 
	`bezõr_evÆ_èngít
(y,
u
[
i
]);

186 
	`poöt_n‹mÆize
(&
vl
);

187 
	`poöt_gë_≥Ω
(&
vt
,&
vl
);

189 
	`poöt_c›y_add_sˇÀd
(&
â
,&
p
,&
vt
,
exåa
->
middÀ_å™s
);

190 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
â
);

191 
	`poöt_c›y_add_sˇÀd
(&
â
,&
p
,&
vt
,-
exåa
->
middÀ_å™s
);

192 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
â
);

195 
	}
}

204 
	$löe_bbox
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
,

205 c⁄° 
LöeBBExåas
 *
exåa
,

206 
Re˘™gÀ
 *
ª˘
)

208 
Poöt
 
vl
;

210 
ª˘
->
À·
 =Ñe˘->
right
 = 
p1
->
x
;

211 
ª˘
->
t›
 =Ñe˘->
bŸtom
 = 
p1
->
y
;

213 
	`ª˘™gÀ_add_poöt
(
ª˘
,
p2
);

215 
	`poöt_c›y_add_sˇÀd
(&
vl
,
p1
,
p2
,-1);

216 
	`poöt_n‹mÆize
(&
vl
);

217 
	`add_¨row_ª˘™gÀ
(
ª˘
,
p1
,&
vl
,
exåa
->
°¨t_l⁄g
,exåa->
°¨t_å™s
);

218 
	`poöt_sˇÀ
(&
vl
,-1);

219 
	`add_¨row_ª˘™gÀ
(
ª˘
,
p2
,&
vl
,
exåa
->
íd_l⁄g
,exåa->
íd_å™s
);

220 
	}
}

231 
	$ñlù£_bbox
(c⁄° 
Poöt
 *
˚¡ª
, 
ªÆ
 
width
,Ñó»
height
,

232 c⁄° 
EÀmítBBExåas
 *
exåa
,

233 
Re˘™gÀ
 *
ª˘
)

235 
Re˘™gÀ
 
rö
;

236 
rö
.
À·
 = 
˚¡ª
->
x
 - 
width
/2;

237 
rö
.
right
 = 
˚¡ª
->
x
 + 
width
/2;

238 
rö
.
t›
 = 
˚¡ª
->
y
 - 
height
/2;

239 
rö
.
bŸtom
 = 
˚¡ª
->
y
 + 
height
/2;

241 
	`ª˘™gÀ_bbox
(&
rö
,
exåa
,
ª˘
);

242 
	}
}

250 
BezPoöt
 *

251 
	$Æloc_pﬁybezõr_•a˚
(
numpoöts
)

253 
Æloc_≈
 = 0;

254 
BezPoöt
 *
Ælo˚d
 = 
NULL
;

256 i‡(
Æloc_≈
 < 
numpoöts
) {

257 
	`g_‰ì
(
Ælo˚d
);

258 
Æloc_≈
 = 
numpoöts
;

259 
Ælo˚d
 = 
	`g_√w0
(
BezPoöt
,
numpoöts
);

261  
Ælo˚d
;

262 
	}
}

270 
	$‰ì_pﬁybezõr_•a˚
(
BezPoöt
 *
poöts
)

271 { 
	}
}

283 
	$pﬁylöe_bbox
(c⁄° 
Poöt
 *
±s
, 
numpoöts
,

284 c⁄° 
PﬁyBBExåas
 *
exåa
, 
gboﬁón
 
˛o£d
,

285 
Re˘™gÀ
 *
ª˘
)

288 
i
;

289 
BezPoöt
 *
b±s
 = 
	`Æloc_pﬁybezõr_•a˚
(
numpoöts
 + 1);

291 
b±s
[0].
ty≥
 = 
BEZ_MOVE_TO
;

292 
b±s
[0].
p1
 = 
±s
[0];

294 
i
=1;i<
numpoöts
;i++) {

295 
b±s
[
i
].
ty≥
 = 
BEZ_LINE_TO
;

296 
b±s
[
i
].
p1
 = 
±s
[i];

299 
b±s
[
numpoöts
].
ty≥
 = 
BEZ_LINE_TO
;

300 
b±s
[
numpoöts
].
p1
 = 
±s
[0];

302 
	`pﬁybezõr_bbox
(
b±s
,
numpoöts
 + (
˛o£d
?1:0),
exåa
,˛o£d,
ª˘
);

303 
	`‰ì_pﬁybezõr_•a˚
(
b±s
);

304 
	}
}

315 
	$pﬁybezõr_bbox
(c⁄° 
BezPoöt
 *
±s
, 
numpoöts
,

316 c⁄° 
PﬁyBBExåas
 *
exåa
, 
gboﬁón
 
˛o£d
,

317 
Re˘™gÀ
 *
ª˘
)

319 
Poöt
 
vx
,
vn
,
vsc
,
vp
;

320 
i
,
¥ev
,
√xt
;

321 
Re˘™gÀ
 
π
;

322 
PﬁyBBExåas
 
bexåa
,
°¨t_bexåa
,
íd_bexåa
;

323 
LöeBBExåas
 
Àxåa
,
°¨t_Àxåa
,
íd_Àxåa
,
fuŒ_Àxåa
;

324 
gboﬁón
 
°¨t
,
íd
;

326 
vp
.
x
=0;

327 
vp
.
y
=0;

329 
	`g_as£π
(
±s
[0].
ty≥
 =
BEZ_MOVE_TO
);

331 
ª˘
->
À·
 =Ñe˘->
right
 = 
±s
[0].
p1
.
x
;

332 
ª˘
->
t›
 =Ñe˘->
bŸtom
 = 
±s
[0].
p1
.
y
;

336 i‡(!
˛o£d
) {

337 
°¨t_Àxåa
.
°¨t_l⁄g
 = 
exåa
->start_long;

338 
°¨t_Àxåa
.
°¨t_å™s
 = 
	`MAX
(
exåa
->°¨t_å™s,exåa->
middÀ_å™s
);

339 
°¨t_Àxåa
.
íd_l⁄g
 = 0;

340 
°¨t_Àxåa
.
íd_å™s
 = 
exåa
->
middÀ_å™s
;

342 
íd_Àxåa
.
°¨t_l⁄g
 = 0;

343 
íd_Àxåa
.
°¨t_å™s
 = 
exåa
->
middÀ_å™s
;

344 
íd_Àxåa
.
íd_l⁄g
 = 
exåa
->end_long;

345 
íd_Àxåa
.
íd_å™s
 = 
	`MAX
(
exåa
->íd_å™s,exåa->
middÀ_å™s
);

348 
fuŒ_Àxåa
.
°¨t_l⁄g
 = 
exåa
->start_long;

349 
fuŒ_Àxåa
.
°¨t_å™s
 = 
	`MAX
(
exåa
->°¨t_å™s,exåa->
middÀ_å™s
);

350 
fuŒ_Àxåa
.
íd_l⁄g
 = 
exåa
->end_long;

351 
fuŒ_Àxåa
.
íd_å™s
 = 
	`MAX
(
exåa
->íd_å™s,exåa->
middÀ_å™s
);

353 i‡(!
˛o£d
) {

354 
Àxåa
.
°¨t_l⁄g
 = 0;

355 
Àxåa
.
°¨t_å™s
 = 
exåa
->
middÀ_å™s
;

356 
Àxåa
.
íd_l⁄g
 = 0;

357 
Àxåa
.
íd_å™s
 = 
exåa
->
middÀ_å™s
;

359 
°¨t_bexåa
.
°¨t_l⁄g
 = 
exåa
->start_long;

360 
°¨t_bexåa
.
°¨t_å™s
 = 
exåa
->start_trans;

361 
°¨t_bexåa
.
middÀ_å™s
 = 
exåa
->middle_trans;

362 
°¨t_bexåa
.
íd_l⁄g
 = 0;

363 
°¨t_bexåa
.
íd_å™s
 = 
exåa
->
middÀ_å™s
;

365 
íd_bexåa
.
°¨t_l⁄g
 = 0;

366 
íd_bexåa
.
°¨t_å™s
 = 
exåa
->
middÀ_å™s
;

367 
íd_bexåa
.
middÀ_å™s
 = 
exåa
->middle_trans;

368 
íd_bexåa
.
íd_l⁄g
 = 
exåa
->end_long;

369 
íd_bexåa
.
íd_å™s
 = 
exåa
->end_trans;

372 
bexåa
.
°¨t_l⁄g
 = 0;

373 
bexåa
.
°¨t_å™s
 = 
exåa
->
middÀ_å™s
;

374 
bexåa
.
middÀ_å™s
 = 
exåa
->middle_trans;

375 
bexåa
.
íd_l⁄g
 = 0;

376 
bexåa
.
íd_å™s
 = 
exåa
->
middÀ_å™s
;

379 
i
=1;i<
numpoöts
;i++) {

380 
√xt
 = (
i
+1Ë% 
numpoöts
;

381 
¥ev
 = (
i
-1Ë% 
numpoöts
;

382 i‡(
˛o£d
 && (
√xt
 == 0))Çext=1;

383 i‡(
˛o£d
 && (
¥ev
 =0)Ë¥ev=
numpoöts
-1;

399 i‡(
±s
[
i
].
ty≥
 =
BEZ_MOVE_TO
) {

403 
±s
[
i
].
ty≥
) {

404 
BEZ_MOVE_TO
:

405 
	`g_as£π_nŸ_ªached
();

407 
BEZ_LINE_TO
:

408 
	`poöt_c›y
(&
vx
,&
±s
[
i
].
p1
);

409 
±s
[
¥ev
].
ty≥
) {

410 
BEZ_MOVE_TO
:

411 
BEZ_LINE_TO
:

412 
	`poöt_c›y
(&
vsc
,&
±s
[
¥ev
].
p1
);

413 
	`poöt_c›y
(&
vp
,&
±s
[
¥ev
].
p1
);

415 
BEZ_CURVE_TO
:

416 
	`poöt_c›y
(&
vsc
,&
±s
[
¥ev
].
p3
);

417 
	`poöt_c›y
(&
vp
,&
±s
[
¥ev
].
p3
);

421 
BEZ_CURVE_TO
:

422 
	`poöt_c›y
(&
vx
,&
±s
[
i
].
p3
);

423 
	`poöt_c›y
(&
vp
,&
±s
[
i
].
p2
);

424 
±s
[
¥ev
].
ty≥
) {

425 
BEZ_MOVE_TO
:

426 
BEZ_LINE_TO
:

427 
	`poöt_c›y
(&
vsc
,&
±s
[
¥ev
].
p1
);

429 
BEZ_CURVE_TO
:

430 
	`poöt_c›y
(&
vsc
,&
±s
[
¥ev
].
p3
);

436 
°¨t
 = (
±s
[
¥ev
].
ty≥
 =
BEZ_MOVE_TO
);

437 
íd
 = (
±s
[
√xt
].
ty≥
 =
BEZ_MOVE_TO
);

438 
	`poöt_c›y
(&
vn
,&
±s
[
√xt
].
p1
);

443 i‡(
˛o£d
) {

444 i‡(
±s
[
i
].
ty≥
 =
BEZ_LINE_TO
) {

445 
	`löe_bbox
(&
vsc
,&
vx
,&
fuŒ_Àxåa
,&
π
);

447 
	`bicubicbezõr2D_bbox
(&
vsc
,

448 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

449 &
bexåa
,

450 &
π
);

452 } i‡(
°¨t
) {

453 i‡(
±s
[
i
].
ty≥
 =
BEZ_LINE_TO
) {

454 i‡(
íd
) {

455 
	`löe_bbox
(&
vsc
,&
vx
,&
fuŒ_Àxåa
,&
π
);

457 
	`löe_bbox
(&
vsc
,&
vx
,&
°¨t_Àxåa
,&
π
);

460 i‡(
íd
) {

461 
	`bicubicbezõr2D_bbox
(&
vsc
,

462 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

463 
exåa
,

464 &
π
);

466 
	`bicubicbezõr2D_bbox
(&
vsc
,

467 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

468 &
°¨t_bexåa
,

469 &
π
);

472 } i‡(
íd
) {

473 i‡(
±s
[
i
].
ty≥
 =
BEZ_LINE_TO
) {

474 
	`löe_bbox
(&
vsc
,&
vx
,&
íd_Àxåa
,&
π
);

476 
	`bicubicbezõr2D_bbox
(&
vsc
,

477 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

478 &
íd_bexåa
,

479 &
π
);

482 i‡(
±s
[
i
].
ty≥
 =
BEZ_LINE_TO
) {

483 
	`löe_bbox
(&
vsc
,&
vx
,&
Àxåa
,&
π
);

485 
	`bicubicbezõr2D_bbox
(&
vsc
,

486 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

487 &
bexåa
,

488 &
π
);

491 
	`ª˘™gÀ_uni⁄
(
ª˘
,&
π
);

497 i‡((!
°¨t
Ë&& (!
íd
)) {

498 
Poöt
 
vpx
,
vxn
;

499 
ªÆ
 
co
,
Æpha
;

501 
	`poöt_c›y_add_sˇÀd
(&
vpx
,&
vx
,&
vp
,-1);

502 
	`poöt_n‹mÆize
(&
vpx
);

503 
	`poöt_c›y_add_sˇÀd
(&
vxn
,&
vn
,&
vx
,-1);

504 
	`poöt_n‹mÆize
(&
vxn
);

506 
co
 = 
	`poöt_dŸ
(&
vpx
,&
vxn
);

507 
Æpha
 = 
	`acos
(-
co
);

508 i‡(
co
 > -0.9816) {

510 
ªÆ
 
ovîshoŸ
;

511 
Poöt
 
vovs
,
±o
;

513 i‡(
	`föôe
(
Æpha
))

514 
ovîshoŸ
 = 
exåa
->
middÀ_å™s
 / 
	`sö
(
Æpha
/2.0);

516 
ovîshoŸ
 = 
exåa
->
middÀ_å™s
;

518 
	`poöt_c›y_add_sˇÀd
(&
vovs
,&
vpx
,&
vxn
,-1);

519 
	`poöt_n‹mÆize
(&
vovs
);

520 
	`poöt_c›y_add_sˇÀd
(&
±o
,&
vx
,&
vovs
,
ovîshoŸ
);

522 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
±o
);

525 
Poöt
 
vpxt
,
vx¡
,
tmp
;

527 
	`poöt_gë_≥Ω
(&
vpxt
,&
vpx
);

528 
	`poöt_gë_≥Ω
(&
vx¡
,&
vxn
);

530 
	`poöt_c›y_add_sˇÀd
(&
tmp
,&
vx
,&
vpxt
,1);

531 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
tmp
);

532 
	`poöt_c›y_add_sˇÀd
(&
tmp
,&
vx
,&
vpxt
,-1);

533 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
tmp
);

534 
	`poöt_c›y_add_sˇÀd
(&
tmp
,&
vx
,&
vx¡
,1);

535 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
tmp
);

536 
	`poöt_c›y_add_sˇÀd
(&
tmp
,&
vx
,&
vx¡
,-1);

537 
	`ª˘™gÀ_add_poöt
(
ª˘
,&
tmp
);

541 
	}
}

550 
	$ª˘™gÀ_bbox
(c⁄° 
Re˘™gÀ
 *
rö
,

551 c⁄° 
EÀmítBBExåas
 *
exåa
,

552 
Re˘™gÀ
 *
rout
)

554 
rout
->
À·
 = 
rö
->À· - 
exåa
->
b‹dî_å™s
;

555 
rout
->
t›
 = 
rö
->t› - 
exåa
->
b‹dî_å™s
;

556 
rout
->
right
 = 
rö
->righà+ 
exåa
->
b‹dî_å™s
;

557 
rout
->
bŸtom
 = 
rö
->bŸtom + 
exåa
->
b‹dî_å™s
;

558 
	}
}

	@O:\tool\dvs50\lib\boundingbox.h

22 #i‚de‡
BOUNDINGBOX_H


23 
	#BOUNDINGBOX_H


	)

25 
	~"düty≥s.h
"

26 
	~"geomëry.h
"

28 
	s_PﬁyBBExåas
 {

29 
ªÆ
 
	m°¨t_l⁄g
, 
	m°¨t_å™s
;

30 
ªÆ
 
	mmiddÀ_å™s
;

31 
ªÆ
 
	míd_l⁄g
, 
	míd_å™s
;

34 
	s_LöeBBExåas
 {

35 
ªÆ
 
	m°¨t_l⁄g
, 
	m°¨t_å™s
;

36 
ªÆ
 
	míd_l⁄g
, 
	míd_å™s
;

39 
	s_EÀmítBBExåas
 {

40 
ªÆ
 
	mb‹dî_å™s
;

43 
bicubicbezõr2D_bbox
(c⁄° 
Poöt
 *
p0
,c⁄° Poöà*
p1
,

44 c⁄° 
Poöt
 *
p2
,c⁄° Poöà*
p3
,

45 c⁄° 
PﬁyBBExåas
 *
exåa
,

46 
Re˘™gÀ
 *
ª˘
);

48 
DIAVAR
 
löe_bbox
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
,

49 c⁄° 
LöeBBExåas
 *
exåa
,

50 
Re˘™gÀ
 *
ª˘
);

52 
DIAVAR
 
ª˘™gÀ_bbox
(c⁄° 
Re˘™gÀ
 *
rö
,

53 c⁄° 
EÀmítBBExåas
 *
exåa
,

54 
Re˘™gÀ
 *
rout
);

56 
DIAVAR
 
cú˛e_bbox
(c⁄° 
Poöt
 *
˚¡ª
, 
ªÆ
 
ødius
,

57 
Re˘™gÀ
 *
ª˘
);

59 
DIAVAR
 
ñlù£_bbox
(c⁄° 
Poöt
 *
˚¡ª
, 
ªÆ
 
width
,Ñó»
height
,

60 c⁄° 
EÀmítBBExåas
 *
exåa
,

61 
Re˘™gÀ
 *
ª˘
);

62 
DIAVAR
 
pﬁylöe_bbox
(c⁄° 
Poöt
 *
±s
, 
numpoöts
,

63 c⁄° 
PﬁyBBExåas
 *
exåa
, 
gboﬁón
 
˛o£d
,

64 
Re˘™gÀ
 *
ª˘
);

65 
DIAVAR
 
pﬁybezõr_bbox
(c⁄° 
BezPoöt
 *
±s
, 
numpoöts
,

66 c⁄° 
PﬁyBBExåas
 *
exåa
, 
gboﬁón
 
˛o£d
,

67 
Re˘™gÀ
 *
ª˘
);

70 
DIAVAR
 
bîn°eö_devñ›
(c⁄° 
ªÆ
 
p
[4],ªÆ *
A
,ªÆ *
B
,ªÆ *
C
,ªÆ *
D
);

71 
DIAVAR
 
ªÆ
 
bezõr_evÆ
(c⁄°Ñó»
p
[4],ªÆ 
u
);

72 
DIAVAR
 
ªÆ
 
bezõr_evÆ_èngít
(c⁄°Ñó»
p
[4],ªÆ 
u
);

	@O:\tool\dvs50\lib\color.c

21 
	~<c⁄fig.h
>

23 
	~<°dio.h
>

24 
	~<gtk/gtk.h
>

25 
	~<gdk/gdk.h
>

27 
	~"cﬁ‹.h
"

29 
GdkCﬁ‹m≠
 *
	gcﬁ‹m≠
 = 
NULL
;

31 #i‚de‡
G_OS_WIN32


32 
Cﬁ‹
 
	gcﬁ‹_bœck
 = { 0.0f, 0.0f, 0.0f };

33 
Cﬁ‹
 
	gcﬁ‹_whôe
 = { 1.0f, 1.0f, 1.0f };

36 
GdkCﬁ‹
 
	gcﬁ‹_gdk_bœck
, 
	gcﬁ‹_gdk_whôe
;

38 
gboﬁón
 
	g_cﬁ‹_öôülized
 = 
FALSE
;

43 
	$cﬁ‹_öô
()

45 i‡(!
_cﬁ‹_öôülized
) {

46 
GdkVisuÆ
 *
visuÆ
 = 
	`gtk_widgë_gë_deÁu…_visuÆ
();

47 
cﬁ‹m≠
 = 
	`gdk_cﬁ‹m≠_√w
 (
visuÆ
, 
FALSE
);

49 
_cﬁ‹_öôülized
 = 
TRUE
;

51 
	`cﬁ‹_c⁄vît
(&
cﬁ‹_bœck
, &
cﬁ‹_gdk_bœck
);

52 
	`cﬁ‹_c⁄vît
(&
cﬁ‹_whôe
, &
cﬁ‹_gdk_whôe
);

54 
	}
}

62 
Cﬁ‹
 *

63 
	$cﬁ‹_√w_rgb
(
r
, 
g
, 
b
)

65 
Cﬁ‹
 *
cﬁ
 = 
	`g_√w
(Color, 1);

66 
cﬁ
->
ªd
 = 
r
;

67 
cﬁ
->
gªí
 = 
g
;

68 
cﬁ
->
blue
 = 
b
;

69  
cﬁ
;

70 
	}
}

77 
	$cﬁ‹_c⁄vît
(
Cﬁ‹
 *
cﬁ‹
, 
GdkCﬁ‹
 *
gdkcﬁ‹
)

79 
gdkcﬁ‹
->
ªd
 = (
guöt16
)(
cﬁ‹
->red*65535);

80 
gdkcﬁ‹
->
gªí
 = (
guöt16
)(
cﬁ‹
->green*65535);

81 
gdkcﬁ‹
->
blue
 = (
guöt16
)(
cﬁ‹
->blue*65535);

83 i‡(
_cﬁ‹_öôülized
) {

84 i‡(!
	`gdk_cﬁ‹m≠_Æloc_cﬁ‹
 (
cﬁ‹m≠
, 
gdkcﬁ‹
, 
TRUE
, TRUE))

85 
	`g_w¨nög
 ("color_convert failed.");

87 
	`g_w¨nög
("Can't color_convert inÇon-interactiveápp (w/o color_init())");

89 
	}
}

96 
gboﬁón


97 
	$cﬁ‹_equÆs
(
Cﬁ‹
 *
cﬁ‹1
, Cﬁ‹ *
cﬁ‹2
)

99  (
cﬁ‹1
->
ªd
 =
cﬁ‹2
->red) &&

100 (
cﬁ‹1
->
gªí
 =
cﬁ‹2
->green) &&

101 (
cﬁ‹1
->
blue
 =
cﬁ‹2
->blue);

102 
	}
}

	@O:\tool\dvs50\lib\color.h

21 #i‚de‡
COLOR_H


22 
	#COLOR_H


	)

24 
	~"düty≥s.h
"

25 
	~<gdk/gdk.h
>

26 
	~"düv¨.h
"

28 
	s_Cﬁ‹
 {

29 
	mªd
;

30 
	mgªí
;

31 
	mblue
;

34 
DIAVAR
 
cﬁ‹_öô
();

35 
DIAVAR
 
Cﬁ‹
 *
cﬁ‹_√w_rgb
(
r
, 
g
, 
b
);

36 
DIAVAR
 
cﬁ‹_c⁄vît
(
Cﬁ‹
 *
cﬁ‹
, 
GdkCﬁ‹
 *
gdkcﬁ‹
);

37 
DIAVAR
 
gboﬁón
 
cﬁ‹_equÆs
(
Cﬁ‹
 *
cﬁ‹1
, Cﬁ‹ *
cﬁ‹2
);

39 #ifde‡
G_OS_WIN32


40 
Cﬁ‹
 
	gcﬁ‹_bœck
 = { 0.0f, 0.0f, 0.0f };

41 
Cﬁ‹
 
	gcﬁ‹_whôe
 = { 1.0f, 1.0f, 1.0f };

43 
DIAVAR
 
Cﬁ‹
 
	gcﬁ‹_bœck
, 
	gcﬁ‹_whôe
;

45 
DIAVAR
 
GdkCﬁ‹
 
	gcﬁ‹_gdk_bœck
, 
	gcﬁ‹_gdk_whôe
;

47 
	#DIA_COLOR_TO_GDK
(
‰om
, 
to
) \

48 (
to
).
pixñ
 = 0; \

49 (
to
).
ªd
 = (
‰om
).red*65535; \

50 (
to
).
gªí
 = (
‰om
).green*65535; \

51 (
to
).
blue
 = (
‰om
).blue*65535;

	)

52 
	#GDK_COLOR_TO_DIA
(
‰om
, 
to
) \

53 (
to
).
ªd
 = (
‰om
).red/65535.0; \

54 (
to
).
gªí
 = (
‰om
).green/65535.0; \

55 (
to
).
blue
 = (
‰om
).blue/65535.0;

	)

	@O:\tool\dvs50\lib\connection.c

20 
	~<c⁄fig.h
>

22 
	~<°dio.h
>

23 
	~<°rög.h
>

24 
	~<as£π.h
>

26 
	~"c⁄√˘i⁄.h
"

27 
	~"mesßge.h
"

34 
	$c⁄√˘i⁄_adju°_f‹_autog≠
(
C⁄√˘i⁄
 *
c⁄√˘i⁄
)

36 
Poöt
 
ídpoöts
[2];

37 
C⁄√˘i⁄Poöt
 *
°¨t_˝
, *
íd_˝
;

39 
°¨t_˝
 = 
c⁄√˘i⁄
->
ídpoöt_h™dÀs
[0].
c⁄√˘ed_to
;

40 
íd_˝
 = 
c⁄√˘i⁄
->
ídpoöt_h™dÀs
[1].
c⁄√˘ed_to
;

42 
ídpoöts
[0] = 
c⁄√˘i⁄
->endpoints[0];

43 
ídpoöts
[1] = 
c⁄√˘i⁄
->endpoints[1];

45 i‡(
	`c⁄≈oöt_is_autog≠
(
°¨t_˝
)) {

46 
ídpoöts
[0] = 
°¨t_˝
->
pos
;

48 i‡(
	`c⁄≈oöt_is_autog≠
(
íd_˝
)) {

49 
ídpoöts
[1] = 
íd_˝
->
pos
;

52 i‡(
	`c⁄≈oöt_is_autog≠
(
°¨t_˝
)) {

53 
c⁄√˘i⁄
->
ídpoöts
[0] = 
	`ˇlcuœã_obje˘_edge
(&endpoints[0],

54 &
ídpoöts
[1],

55 
°¨t_˝
->
obje˘
);

57 i‡(
	`c⁄≈oöt_is_autog≠
(
íd_˝
)) {

58 
c⁄√˘i⁄
->
ídpoöts
[1] = 
	`ˇlcuœã_obje˘_edge
(&endpoints[1],

59 &
ídpoöts
[0],

60 
íd_˝
->
obje˘
);

62 
	}
}

87 
Obje˘Ch™ge
*

88 
	$c⁄√˘i⁄_move_h™dÀ
(
C⁄√˘i⁄
 *
c⁄n
, 
H™dÀId
 
id
,

89 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

90 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

92 
id
) {

93 
HANDLE_MOVE_STARTPOINT
:

94 
c⁄n
->
ídpoöts
[0] = *
to
;

96 
HANDLE_MOVE_ENDPOINT
:

97 
c⁄n
->
ídpoöts
[1] = *
to
;

100 
	`mesßge_îr‹
("InternalÉrror in connection_move_handle.\n");

103  
NULL
;

104 
	}
}

111 
	$c⁄√˘i⁄_upd©e_h™dÀs
(
C⁄√˘i⁄
 *
c⁄n
)

113 
c⁄n
->
ídpoöt_h™dÀs
[0].
id
 = 
HANDLE_MOVE_STARTPOINT
;

114 
c⁄n
->
ídpoöt_h™dÀs
[0].
pos
 = c⁄n->
ídpoöts
[0];

116 
c⁄n
->
ídpoöt_h™dÀs
[1].
id
 = 
HANDLE_MOVE_ENDPOINT
;

117 
c⁄n
->
ídpoöt_h™dÀs
[1].
pos
 = c⁄n->
ídpoöts
[1];

118 
	}
}

124 
	$c⁄√˘i⁄_upd©e_boundögbox
(
C⁄√˘i⁄
 *
c⁄n
)

126 
	`as£π
(
c⁄n
 !
NULL
);

128 
	`löe_bbox
(&
c⁄n
->
ídpoöts
[0],&conn->endpoints[1],

129 &
c⁄n
->
exåa_•acög
,&c⁄n->
obje˘
.
boundög_box
);

130 
	}
}

139 
	$c⁄√˘i⁄_öô
(
C⁄√˘i⁄
 *
c⁄n
, 
num_h™dÀs
, 
num_c⁄√˘i⁄s
)

141 
DüObje˘
 *
obj
;

142 
i
;

144 
obj
 = &
c⁄n
->
obje˘
;

146 
	`as£π
(
num_h™dÀs
>=2);

148 
	`obje˘_öô
(
obj
, 
num_h™dÀs
, 
num_c⁄√˘i⁄s
);

150 
	`as£π
(
obj
->
h™dÀs
!=
NULL
);

152 
i
=0;i<2;i++) {

153 
obj
->
h™dÀs
[
i
] = &
c⁄n
->
ídpoöt_h™dÀs
[i];

154 
obj
->
h™dÀs
[
i
]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

155 
obj
->
h™dÀs
[
i
]->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

156 
obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 = 
NULL
;

158 
	}
}

165 
	$c⁄√˘i⁄_c›y
(
C⁄√˘i⁄
 *
‰om
, C⁄√˘i⁄ *
to
)

167 
i
;

168 
DüObje˘
 *
toobj
;

169 
DüObje˘
 *
‰omobj
;

171 
toobj
 = &
to
->
obje˘
;

172 
‰omobj
 = &
‰om
->
obje˘
;

174 
	`obje˘_c›y
(
‰omobj
, 
toobj
);

176 
i
=0;i<2;i++) {

177 
to
->
ídpoöts
[
i
] = 
‰om
->endpoints[i];

180 
i
=0;i<2;i++) {

182 
to
->
ídpoöt_h™dÀs
[
i
] = 
‰om
->endpoint_handles[i];

183 
to
->
ídpoöt_h™dÀs
[
i
].
c⁄√˘ed_to
 = 
NULL
;

184 
toobj
->
h™dÀs
[
i
] = &
to
->
ídpoöt_h™dÀs
[i];

186 
	`mem˝y
(&
to
->
exåa_•acög
,&
‰om
->extra_spacing,(to->extra_spacing));

187 
	}
}

198 
	$c⁄√˘i⁄_de°roy
(
C⁄√˘i⁄
 *
c⁄n
)

200 
	`obje˘_de°roy
(&
c⁄n
->
obje˘
);

201 
	}
}

208 
	$c⁄√˘i⁄_ßve
(
C⁄√˘i⁄
 *
c⁄n
, 
Obje˘Node
 
obj_node
)

210 
AâribuãNode
 
©å
;

212 
	`obje˘_ßve
(&
c⁄n
->
obje˘
, 
obj_node
);

214 
©å
 = 
	`√w_©åibuã
(
obj_node
, "conn_endpoints");

215 
	`d©a_add_poöt
(
©å
, &
c⁄n
->
ídpoöts
[0]);

216 
	`d©a_add_poöt
(
©å
, &
c⁄n
->
ídpoöts
[1]);

217 
	}
}

224 
	$c⁄√˘i⁄_lﬂd
(
C⁄√˘i⁄
 *
c⁄n
, 
Obje˘Node
 
obj_node
)

226 
AâribuãNode
 
©å
;

227 
D©aNode
 
d©a
;

229 
	`obje˘_lﬂd
(&
c⁄n
->
obje˘
, 
obj_node
);

231 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "conn_endpoints");

232 i‡(
©å
 !
NULL
) {

233 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

234 
	`d©a_poöt
–
d©a
 , &
c⁄n
->
ídpoöts
[0] );

235 
d©a
 = 
	`d©a_√xt
(data);

236 
	`d©a_poöt
–
d©a
 , &
c⁄n
->
ídpoöts
[1] );

238 
	}
}

	@O:\tool\dvs50\lib\connection.h

20 #i‚de‡
CONNECTION_H


21 
	#CONNECTION_H


	)

23 
	~"düty≥s.h
"

24 
	~"obje˘.h
"

25 
	~"boundögbox.h
"

33 
	s_C⁄√˘i⁄
 {

34 
DüObje˘
 
	mobje˘
;

36 
Poöt
 
	mídpoöts
[2];

37 
H™dÀ
 
	mídpoöt_h™dÀs
[2];

38 
LöeBBExåas
 
	mexåa_•acög
;

41 
DIAVAR
 
c⁄√˘i⁄_upd©e_h™dÀs
(
C⁄√˘i⁄
 *
c⁄n
);

42 
DIAVAR
 
c⁄√˘i⁄_upd©e_boundögbox
(
C⁄√˘i⁄
 *
c⁄n
);

43 
DIAVAR
 
c⁄√˘i⁄_öô
(
C⁄√˘i⁄
 *
c⁄n
,

44 
num_h™dÀs
, 
num_c⁄√˘i⁄s
);

45 
DIAVAR
 
c⁄√˘i⁄_de°roy
(
C⁄√˘i⁄
 *
c⁄n
);

46 
DIAVAR
 
c⁄√˘i⁄_c›y
(
C⁄√˘i⁄
 *
‰om
, C⁄√˘i⁄ *
to
);

47 
DIAVAR
 
c⁄√˘i⁄_ßve
(
C⁄√˘i⁄
 *
c⁄n
, 
Obje˘Node
 
obj_node
);

48 
DIAVAR
 
c⁄√˘i⁄_lﬂd
(
C⁄√˘i⁄
 *
c⁄n
, 
Obje˘Node
 
obj_node
);

49 
DIAVAR
 
Obje˘Ch™ge
* 
c⁄√˘i⁄_move_h™dÀ
(
C⁄√˘i⁄
 *
c⁄n
, 
H™dÀId
 
id
,

50 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
* 
˝
,

51 
H™dÀMoveRós⁄
 
ªas⁄
,

52 
ModifõrKeys
 
modifõrs
);

54 
DIAVAR
 
c⁄√˘i⁄_adju°_f‹_autog≠
(
C⁄√˘i⁄
 *
c⁄n
);

57 
	#CONNECTION_COMMON_PROPERTIES
 \

58 
OBJECT_COMMON_PROPERTIES
, \

59 { "c⁄n_ídpoöts", 
PROP_TYPE_ENDPOINTS
, 0, "C⁄√˘i⁄Éndpoöts", 
NULL
}

	)

61 
	#CONNECTION_COMMON_PROPERTIES_OFFSETS
 \

62 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

63 { "c⁄n_ídpoöts", 
PROP_TYPE_ENDPOINTS
, 
	`off£tof
(
C⁄√˘i⁄
,
ídpoöts
)}

	)

	@O:\tool\dvs50\lib\connectionpoint.c

21 
	~"c⁄fig.h
"

22 
	~"c⁄√˘i⁄poöt.h
"

32 
göt


33 
	$föd_¶›e_dúe˘i⁄s
(
Poöt
 
‰om
, Poöà
to
)

35 
göt
 
dús
;

36 
göt
 
¶›e
;

38 i‡(
	`Ábs
(
‰om
.
y
-
to
.y) < 0.0000001)

39  (
‰om
.
x
 > 
to
.x?
DIR_SOUTH
:
DIR_NORTH
);

40 i‡(
	`Ábs
(
‰om
.
x
-
to
.x) < 0.0000001)

41  (
‰om
.
y
 > 
to
.y?
DIR_WEST
:
DIR_EAST
);

43 
	`poöt_sub
(&
to
, &
‰om
);

44 
¶›e
 = 
	`Ábs
(
to
.
y
/to.
x
);

46 
dús
 = 0;

47 i‡(
¶›e
 < 2) {

48 i‡(
to
.
x
 > 0) {

49 
dús
 |
DIR_NORTH
;

51 
dús
 |
DIR_SOUTH
;

54 i‡(
¶›e
 > .5) {

55 i‡(
to
.
y
 > 0) {

56 
dús
 |
DIR_EAST
;

58 
dús
 |
DIR_WEST
;

61  
dús
;

62 
	}
}

72 
	$c⁄≈oöt_upd©e
(
C⁄√˘i⁄Poöt
 *
p
, 
ªÆ
 
x
,Ñó»
y
, 
göt
 
dús
)

74 
p
->
pos
.
x
 = x;

75 
p
->
pos
.
y
 = y;

76 
p
->
dúe˘i⁄s
 = 
dús
;

77 
	}
}

85 
gboﬁón


86 
	$c⁄≈oöt_is_autog≠
(
C⁄√˘i⁄Poöt
 *
˝
)

88  
˝
 !
NULL
 && (˝->
Êags
 & 
CP_FLAG_AUTOGAP
Ë&& (˝->
c⁄√˘ed
 != NULL);

89 
	}
}

	@O:\tool\dvs50\lib\connectionpoint.h

19 #i‚de‡
CONNECTIONPOINT_H


20 
	#CONNECTIONPOINT_H


	)

22 
	~"düty≥s.h
"

23 
	~<glib.h
>

24 
	~"geomëry.h
"

26 
	#CONNECTIONPOINT_SIZE
 5

	)

27 
	#CHANGED_TRESHOLD
 0.001

	)

33 
	mDIR_NONE
 = 0,

34 
	mDIR_NORTH
 = (1<<0),

35 
	mDIR_EAST
 = (1<<1),

36 
	mDIR_SOUTH
 = (1<<2),

37 
	mDIR_WEST
 = (1<<3),

39 
	mDIR_NORTHEAST
 = (
DIR_NORTH
|
DIR_EAST
),

40 
	mDIR_SOUTHEAST
 = (
DIR_SOUTH
|
DIR_EAST
),

41 
	mDIR_NORTHWEST
 = (
DIR_NORTH
|
DIR_WEST
),

42 
	mDIR_SOUTHWEST
 = (
DIR_SOUTH
|
DIR_WEST
),

43 
	mDIR_ALL
 = (
DIR_NORTH
|
DIR_SOUTH
|
DIR_EAST
|
DIR_WEST
)

44 } 
	tC⁄√˘i⁄PoötDúe˘i⁄
;

48 
	mCP_FLAG_ANYPLACE
 = (1<<0),

51 
	mCP_FLAG_AUTOGAP
 = (1<<1),

55 
	mCP_FLAGS_MAIN
 = (
CP_FLAG_ANYPLACE
|
CP_FLAG_AUTOGAP
)

58 } 
	tC⁄√˘i⁄PoötFœgs
;

63 
	s_C⁄√˘i⁄Poöt
 {

64 
Poöt
 
	mpos
;

65 
Poöt
 
	mœ°_pos
;

66 
DüObje˘
 *
	mobje˘
;

67 
GLi°
 *
	mc⁄√˘ed
;

68 
gch¨
 
	mdúe˘i⁄s
;

69 
gch¨
 *
	m«me
;

70 
guöt8
 
	mÊags
;

78 
DIAVAR
 
göt
 
föd_¶›e_dúe˘i⁄s
(
Poöt
 
‰om
, Poöà
to
);

85 
DIAVAR
 
c⁄≈oöt_upd©e
(
C⁄√˘i⁄Poöt
 *
p
, 
ªÆ
 
x
,Ñó»
y
, 
göt
 
dús
);

87 
DIAVAR
 
gboﬁón
 
c⁄≈oöt_is_autog≠
(
C⁄√˘i⁄Poöt
 *
˝
);

	@O:\tool\dvs50\lib\connpoint_line.c

20 
	~<c⁄fig.h
>

22 
	~<°rög.h
>

23 
	~"c⁄≈oöt_löe.h
"

24 
	~"c⁄√˘i⁄poöt.h
"

25 
	~"dü_xml.h
"

27 
	#DEBUG_PARENT
 0

	)

28 
	#DEBUG_ORDER
 0

	)

30 
˝l_ª‹dî_c⁄√˘i⁄s
(
C⁄nPoötLöe
 *
˝l
);

32 
ölöe
 
C⁄√˘i⁄Poöt
 *
	$√w_c⁄≈oöt
(
DüObje˘
 *
obj
)

34 
C⁄√˘i⁄Poöt
 *
˝
 = 
	`g_√w0
(ConnectionPoint,1);

35 
˝
->
obje˘
 = 
obj
;

36  
˝
;

37 
	}
}

39 
ölöe
 
	$dñ_c⁄≈oöt
(
C⁄√˘i⁄Poöt
 *
˝
)

41 
	`g_‰ì
(
˝
);

42 
	}
}

44 
C⁄√˘i⁄Poöt
 *

45 
	$˝l_ªmove_c⁄≈oöt
(
C⁄nPoötLöe
 *
˝l
,
pos
)

47 
C⁄√˘i⁄Poöt
 *
˝
;

49 
	`g_as£π
 (
˝l
->
num_c⁄√˘i⁄s
 > 0);

51 i‡(
pos
 >
˝l
->
num_c⁄√˘i⁄s
) {

52 
pos
 = 
˝l
->
num_c⁄√˘i⁄s
 - 1;

54 
pos
 < 0Ëpo†+
˝l
->
num_c⁄√˘i⁄s
;

57 
˝
 = (
C⁄√˘i⁄Poöt
 *)(
	`g_¶i°_¡h
(
˝l
->
c⁄√˘i⁄s
,
pos
)->
d©a
);

58 
	`g_as£π
(
˝
);

60 
˝l
->
c⁄√˘i⁄s
 = 
	`g_¶i°_ªmove
(˝l->c⁄√˘i⁄s,(
gpoöãr
)
˝
);

61 
	`obje˘_ªmove_c⁄√˘i⁄poöt
(
˝l
->
∑ª¡
,
˝
);

63 
˝l
->
num_c⁄√˘i⁄s
--;

67  
˝
;

68 
	}
}

71 
	$˝l_add_c⁄√˘i⁄poöt_©
(
C⁄nPoötLöe
 *
˝l
, 
pos
,
C⁄√˘i⁄Poöt
 *
˝
)

73 i‡(
pos
 == 0) {

76 
Âos
,
i
;

77 
C⁄√˘i⁄Poöt
 *
f˝
;

78 
	`g_as£π
(
˝l
->
c⁄√˘i⁄s
);

79 
Âos
 = -1;

80 
f˝
 = (
C⁄√˘i⁄Poöt
 *)(
˝l
->
c⁄√˘i⁄s
->
d©a
);

81 
	`g_as£π
(
f˝
);

82 
i
=0; i<
˝l
->
∑ª¡
->
num_c⁄√˘i⁄s
; i++) {

83 i‡(
˝l
->
∑ª¡
->
c⁄√˘i⁄s
[
i
] =
f˝
) {

84 
Âos
 = 
i
;

88 
	`g_as£π
(
Âos
 >= 0);

89 
	`obje˘_add_c⁄√˘i⁄poöt_©
(
˝l
->
∑ª¡
,
˝
,
Âos
);

93 
	`obje˘_add_c⁄√˘i⁄poöt
(
˝l
->
∑ª¡
,
˝
);

95 i‡(
pos
 < 0) {

96 
˝l
->
c⁄√˘i⁄s
 = 
	`g_¶i°_≠≥nd
(˝l->c⁄√˘i⁄s,(
gpoöãr
)
˝
);

99 
˝l
->
c⁄√˘i⁄s
 = 
	`g_¶i°_ö£π
(˝l->c⁄√˘i⁄s,(
gpoöãr
)
˝
,
pos
);

101 
˝l
->
num_c⁄√˘i⁄s
++;

107 
	}
}

109 
ölöe
 

110 
	$˝l_add_c⁄√˘i⁄poöt
(
C⁄nPoötLöe
 *
˝l
,
C⁄√˘i⁄Poöt
 *
˝
)

112 
	`˝l_add_c⁄√˘i⁄poöt_©
(
˝l
,-1,
˝
);

113 
	}
}

115 
C⁄nPoötLöe
 *

116 
	$c⁄≈oöéöe_¸óã
(
DüObje˘
 *
∑ª¡
, 
num_c⁄√˘i⁄s
)

118 
C⁄nPoötLöe
 *
˝l
;

119 
i
;

121 
˝l
 = 
	`g_√w0
(
C⁄nPoötLöe
,1);

122 
˝l
->
∑ª¡
 =Öarent;

124 
˝l
->
c⁄√˘i⁄s
 = 
NULL
;

125 
i
=0; i<
num_c⁄√˘i⁄s
; i++) {

126 
	`˝l_add_c⁄√˘i⁄poöt
(
˝l
,
	`√w_c⁄≈oöt
(˝l->
∑ª¡
));

128 
	`˝l_ª‹dî_c⁄√˘i⁄s
(
˝l
);

129  
˝l
;

130 
	}
}

133 
	$c⁄≈oöéöe_de°roy
(
C⁄nPoötLöe
 *
˝l
)

135 
˝l
->
num_c⁄√˘i⁄s
 > 0Ë
	`dñ_c⁄≈oöt
(
	`˝l_ªmove_c⁄≈oöt
(cpl,0));

136 
	`g_‰ì
(
˝l
);

137 
	}
}

139 
C⁄nPoötLöe
 *

140 
	$˝l_ö∂a˚¸óã
(
DüObje˘
 *
obj
, 
nc
, *
ªÆc⁄ncou¡
)

142 
i
;

143 
C⁄nPoötLöe
 *
√w˝l
;

144 
C⁄√˘i⁄Poöt
 *
˝
;

148 
√w˝l
 = 
	`g_√w0
(
C⁄nPoötLöe
,1);

149 
√w˝l
->
∑ª¡
 = 
obj
;

151 
i
=0; i < 
nc
; i++,(*
ªÆc⁄ncou¡
)++) {

152 
˝
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
,1);

153 
˝
->
obje˘
 = 
√w˝l
->
∑ª¡
;

154 
obj
->
c⁄√˘i⁄s
[*
ªÆc⁄ncou¡
] = 
˝
;

155 
√w˝l
->
c⁄√˘i⁄s
 = 
	`g_¶i°_≠≥nd
“ew˝l->c⁄√˘i⁄s,
˝
);

157 
√w˝l
->
num_c⁄√˘i⁄s
 = 
nc
;

158  
√w˝l
;

159 
	}
}

161 
C⁄nPoötLöe
 *

162 
	$c⁄≈oöéöe_lﬂd
(
DüObje˘
 *
obj
,
Obje˘Node
 
obj_node
,

163 c⁄° 
gch¨
 *
«me
, 
deÁu…_nc
,*
ªÆc⁄ncou¡
)

165 
C⁄nPoötLöe
 *
˝l
;

166 
nc
 = 
deÁu…_nc
;

167 
AâribuãNode
 
©å
;

169 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
«me
);

170 i‡(
©å
 !
NULL
)

171 
nc
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

172 
˝l
 = 
	`c⁄≈oöéöe_¸óã
(
obj
,
nc
);

174 i‡(
ªÆc⁄ncou¡
Ë(*ªÆc⁄ncou¡Ë+
˝l
->
num_c⁄√˘i⁄s
;

175  
˝l
;

181 
	}
}

184 
	$c⁄≈oöéöe_ßve
(
C⁄nPoötLöe
 *
˝l
,
Obje˘Node
 
obj_node
,

185 c⁄° 
gch¨
 *
«me
)

187 
	`d©a_add_öt
(
	`√w_©åibuã
(
obj_node
, 
«me
),
˝l
->
num_c⁄√˘i⁄s
);

188 
	}
}

190 
C⁄nPoötLöe
 *

191 
	$c⁄≈oöéöe_c›y
(
DüObje˘
 *
√wobj
,
C⁄nPoötLöe
 *
˝l
, *
ªÆc⁄ncou¡
)

193 
	`g_as£π
(
ªÆc⁄ncou¡
);

194  
	`˝l_ö∂a˚¸óã
(
√wobj
,
˝l
->
num_c⁄√˘i⁄s
,
ªÆc⁄ncou¡
);

195 
	}
}

197 
	$c⁄≈oöéöe_upd©e
(
C⁄nPoötLöe
 *
˝l
)

200 
	}
}

203 
	$c⁄≈oöéöe_put⁄Æöe
(
C⁄nPoötLöe
 *
˝l
,
Poöt
 *
°¨t
,Poöà*
íd
)

205 
Poöt
 
£_ve˘‹
;

206 
ªÆ
 
£_Àn
,
p£ud›oöts
;

207 
i
;

208 
GSLi°
 *
ñem
;

209 
göt
 
dús
;

211 
	`poöt_c›y
(&
£_ve˘‹
, 
íd
);

212 
	`poöt_sub
(&
£_ve˘‹
, 
°¨t
);

214 
£_Àn
 = 
	`poöt_Àn
(&
£_ve˘‹
);

216 i‡(
£_Àn
 > 0)

217 
	`poöt_n‹mÆize
(&
£_ve˘‹
);

219 
˝l
->
°¨t
 = *start;

220 
˝l
->
íd
 = *end;

222 i‡(
	`Ábs
(
£_ve˘‹
.
x
Ë> fabs(£_ve˘‹.
y
))

223 
dús
 = 
DIR_NORTH
|
DIR_SOUTH
;

225 
dús
 = 
DIR_EAST
|
DIR_WEST
;

227 
p£ud›oöts
 = 
˝l
->
num_c⁄√˘i⁄s
 + 1;

229 
i
=0, 
ñem
=
˝l
->
c⁄√˘i⁄s
;

230 
i
<
˝l
->
num_c⁄√˘i⁄s
;

231 
i
++,
ñem
=
	`g_¶i°_√xt
(elem)) {

232 
C⁄√˘i⁄Poöt
 *
˝
 = (C⁄√˘i⁄Poöà*)(
ñem
->
d©a
);

233 
˝
->
pos
 = 
£_ve˘‹
;

234 
˝
->
dúe˘i⁄s
 = 
dús
;

235 
	`poöt_sˇÀ
(&
˝
->
pos
,
£_Àn
 * (
i
+1.0)/
p£ud›oöts
);

236 
	`poöt_add
(&
˝
->
pos
,
°¨t
);

238 
	}
}

244 
	$obje˘_move_c⁄√˘i⁄
(
DüObje˘
 *
obj
,
sour˚pos
,
de°pos
)

246 
C⁄√˘i⁄Poöt
 *
˝
;

247 
	`g_as£π
(
de°pos
 < 
sour˚pos
);

248 
˝
 = 
obj
->
c⁄√˘i⁄s
[
sour˚pos
];

250 
	`memmove
(&(
obj
->
c⁄√˘i⁄s
[
de°pos
+1]),&(obj->connections[destpos]),

251 (
C⁄√˘i⁄Poöt
 *)*(
sour˚pos
-
de°pos
));

252 
obj
->
c⁄√˘i⁄s
[
de°pos
] = 
˝
;

253 
	}
}

256 
	$obje˘_föd_c⁄√˘i⁄
(
DüObje˘
 *
obj
, 
C⁄√˘i⁄Poöt
 *
˝
, 
°¨ços
)

258 
i
;

259 
i
 = 
°¨ços
; i < 
obj
->
num_c⁄√˘i⁄s
; i++) {

260 i‡(
obj
->
c⁄√˘i⁄s
[
i
] =
˝
)  i;

263 
	}
}

266 #i‡
DEBUG_ORDER


267 
	$obj_föd_c⁄√˘i⁄
(
DüObje˘
 *
obj
,
C⁄√˘i⁄Poöt
 *
˝
)

269 
i
;

270 
i
=0;i<
obj
->
num_c⁄√˘i⁄s
;i++)

271 i‡(
˝
 =
obj
->
c⁄√˘i⁄s
[
i
])  i;

273 
	}
}

276 
	$˝l_dump_c⁄√˘i⁄s
(
C⁄nPoötLöe
 *
˝l
)

278 
DüObje˘
 *
obj
 = 
˝l
->
∑ª¡
;

279 
i
;

280 
GSLi°
 *
ñem
;

281 
C⁄√˘i⁄Poöt
 *
˝
;

283 
	`g_mesßge
("CPL order dump");

284 
i
=0,
ñem
 = 
˝l
->
c⁄√˘i⁄s
;

285 
i
<
˝l
->
num_c⁄√˘i⁄s
;

286 
i
++,
ñem
 = 
	`g_¶i°_√xt
(elem)) {

287 
˝
 = (
C⁄√˘i⁄Poöt
 *)(
ñem
->
d©a
);

288 
	`g_mesßge
("connection %p %d@CPL %d@OBJ",

289 
˝
,
i
,
	`obj_föd_c⁄√˘i⁄
(
obj
,cp));

291 
	}
}

295 
	$˝l_ª‹dî_c⁄√˘i⁄s
(
C⁄nPoötLöe
 *
˝l
)

310 
i
,
j
,
fú°
;

311 
C⁄√˘i⁄Poöt
 *
˝
;

312 
GSLi°
 *
ñem
;

313 
DüObje˘
 *
obj
;

315 i‡(!
˝l
->
c⁄√˘i⁄s
) ;

316 #i‡
DEBUG_ORDER


317 
	`g_mesßge
("before cpl_reorder");

318 
	`˝l_dump_c⁄√˘i⁄s
(
˝l
);

321 
fú°
 = -1;

322 
˝
 = (
C⁄√˘i⁄Poöt
 *)(
˝l
->
c⁄√˘i⁄s
->
d©a
);

323 
obj
 = 
˝l
->
∑ª¡
;

324 
i
=0; i<
obj
->
num_c⁄√˘i⁄s
; i++){

325 i‡(
obj
->
c⁄√˘i⁄s
[
i
] =
˝
) {

326 
fú°
 = 
i
;

330 
	`g_as£π
(
fú°
 >= 0);

331 
i
=0,
j
=
fú°
,
ñem
=
˝l
->
c⁄√˘i⁄s
;

332 
i
<
˝l
->
num_c⁄√˘i⁄s
;

333 
ñem
=
	`g_¶i°_√xt
”Àm),
i
++,
j
++) {

334 
˝
 = (
C⁄√˘i⁄Poöt
 *)(
ñem
->
d©a
);

335 i‡–
˝
 !
obj
->
c⁄√˘i⁄s
[
j
]) {

337 
	`obje˘_move_c⁄√˘i⁄
(
obj
,
	`obje˘_föd_c⁄√˘i⁄
(obj,
˝
,
j
),j);

340 #i‡
DEBUG_ORDER


341 
	`g_mesßge
("after cpl_reorder");

342 
	`˝l_dump_c⁄√˘i⁄s
(
˝l
);

344 #i‡
DEBUG_PARENT


345 
j
 = 0;

346 
i
=0; i<
˝l
->
∑ª¡
->
num_c⁄√˘i⁄s
;i++)

347 i‡(!
˝l
->
∑ª¡
->
c⁄√˘i⁄s
[
i
]Ë
j
++;

349 i‡(
j
Ë
	`g_w¨nög
("in cpl_reorder_connectionsÅhereáre %d holes inÅheÖarent's ConnectionPointÜist !",j);

351 
	}
}

356 
	$c⁄≈oöéöe_ˇn_add_poöt
(
C⁄nPoötLöe
 *
˝l
, 
Poöt
 *
˛icked
)

359 
	}
}

362 
	$c⁄≈oöéöe_ˇn_ªmove_poöt
(
C⁄nPoötLöe
 *
˝l
, 
Poöt
 *
˛icked
)

364 i‡(
˝l
->
num_c⁄√˘i⁄s
 <= 1)

368 
	}
}

371 
	$˝l_gë_poötbef‹e
(
C⁄nPoötLöe
 *
˝l
, 
Poöt
 *
˛ickedpoöt
)

373 
i
, 
pos
 = -1;

374 
GSLi°
 *
ñem
;

375 
C⁄√˘i⁄Poöt
 *
˝
;

376 
ªÆ
 
di°
 = 65536.0;

377 
ªÆ
 
tmpdi°
;

379 i‡(!
˛ickedpoöt
)  0;

381 
i
=0,
ñem
=
˝l
->
c⁄√˘i⁄s
;

382 
i
<
˝l
->
num_c⁄√˘i⁄s
;

383 
i
++,
ñem
=
	`g_¶i°_√xt
(elem)) {

384 
˝
 = (
C⁄√˘i⁄Poöt
 *)(
ñem
->
d©a
);

386 
tmpdi°
 = 
	`di°™˚_poöt_poöt
(&
˝
->
pos
,
˛ickedpoöt
);

387 i‡(
tmpdi°
 < 
di°
) {

388 
di°
 = 
tmpdi°
;

389 
pos
 = 
i
;

392 
tmpdi°
 = 
	`di°™˚_poöt_poöt
(&
˝l
->
íd
,
˛ickedpoöt
);

393 i‡(
tmpdi°
 < 
di°
) {

395 
pos
 = -1;

397  
pos
;

398 
	}
}

401 
Obje˘Ch™ge
 
	mobj_ch™ge
;

403 
	madd
;

404 
	m≠∂õd
;

406 
C⁄nPoötLöe
 *
	m˝l
;

407 
	mpos
;

408 
C⁄√˘i⁄Poöt
 **
	m˝
;

409 } 
	tCPLCh™ge
;

412 
	$˝l_ch™ge_addªmove
(
CPLCh™ge
 *
ch™ge
, 
C⁄nPoötLöe
 *
˝l
,

413 
a˘i⁄
, 
ªsu…ög≠∂õd
)

415 i‡(
a˘i⁄
 != 0) {

416 i‡(
a˘i⁄
 > 0) {

417 
a˘i⁄
--) {

418 
	`˝l_add_c⁄√˘i⁄poöt_©
(
˝l
,
ch™ge
->
pos
,ch™ge->
˝
[
a˘i⁄
]);

419 
ch™ge
->
˝
[
a˘i⁄
] = 
NULL
;

421 
	`˝l_ª‹dî_c⁄√˘i⁄s
(
˝l
);

423 
a˘i⁄
++) {

424 
ch™ge
->
˝
[-
a˘i⁄
] = 
	`˝l_ªmove_c⁄≈oöt
(
˝l
,ch™ge->
pos
);

428 
	`g_w¨nög
("cpl_change_addremove():Çulláction !");

430 
ch™ge
->
≠∂õd
 = 
ªsu…ög≠∂õd
;

431 
	}
}

434 
	$˝l_ch™ge_≠∂y
(
CPLCh™ge
 *
ch™ge
, 
C⁄nPoötLöe
 *
¥obablynŸ˝l
)

436 
	`˝l_ch™ge_addªmove
(
ch™ge
,ch™ge->
˝l
,ch™ge->
add
,1);

437 
	}
}

440 
	$˝l_ch™ge_ªvît
(
CPLCh™ge
 *
ch™ge
, 
C⁄nPoötLöe
 *
¥obablynŸ˝l
)

442 
	`˝l_ch™ge_addªmove
(
ch™ge
,ch™ge->
˝l
,-(ch™ge->
add
),0);

443 
	}
}

445 
	$˝l_ch™ge_‰ì
(
CPLCh™ge
 *
ch™ge
)

447 
i
 = 
	`ABS
(
ch™ge
->
add
);

449 
i
--) {

450 i‡(
ch™ge
->
˝
[
i
]) {

451 
	`dñ_c⁄≈oöt
(
ch™ge
->
˝
[
i
]);

454 
	`g_‰ì
(
ch™ge
->
˝
); ch™ge->˝ = (
C⁄√˘i⁄Poöt
 **)(0xDEADBEEF);

455 
	}
}

457 
Obje˘Ch™ge
 *

458 
	$˝l_¸óã_ch™ge
(
C⁄nPoötLöe
 *
˝l
, 
pos
, 
add
)

460 
CPLCh™ge
 *
ch™ge
;

462 
ch™ge
 = 
	`g_√w0
(
CPLCh™ge
,1);

464 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
˝l_ch™ge_≠∂y
;

465 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
˝l_ch™ge_ªvît
;

466 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
˝l_ch™ge_‰ì
;

468 
ch™ge
->
˝l
 = cpl;

469 
ch™ge
->
≠∂õd
 = 0;

470 
ch™ge
->
add
 =ádd;

471 
ch™ge
->
pos
 =Öos;

473 
ch™ge
->
˝
 = 
	`g_mÆloc0
((
C⁄√˘i⁄Poöt
 *Ë* 
	`ABS
(
add
));

474 
add
-- > 0) {

475 
ch™ge
->
˝
[
add
] = 
	`√w_c⁄≈oöt
(
˝l
->
∑ª¡
);

478  (
Obje˘Ch™ge
 *)
ch™ge
;

479 
	}
}

481 
Obje˘Ch™ge
 *

482 
	$c⁄≈oöéöe_add_poöts
(
C⁄nPoötLöe
 *
˝l
,

483 
Poöt
 *
˛ickedpoöt
, 
cou¡
)

485 
pos
;

486 
Obje˘Ch™ge
 *
ch™ge
;

488 
pos
 = 
	`˝l_gë_poötbef‹e
(
˝l
,
˛ickedpoöt
);

489 
ch™ge
 = 
	`˝l_¸óã_ch™ge
(
˝l
,
pos
,
cou¡
);

491 
ch™ge
->
	`≠∂y
(ch™ge, (
DüObje˘
 *)
˝l
);

492  
ch™ge
;

493 
	}
}

496 
Obje˘Ch™ge
 *

497 
	$c⁄≈oöéöe_ªmove_poöts
(
C⁄nPoötLöe
 *
˝l
,

498 
Poöt
 *
˛ickedpoöt
, 
cou¡
)

500 
pos
;

501 
Obje˘Ch™ge
 *
ch™ge
;

503 
pos
 = 
	`˝l_gë_poötbef‹e
(
˝l
,
˛ickedpoöt
);

504 
ch™ge
 = 
	`˝l_¸óã_ch™ge
(
˝l
,
pos
,-
cou¡
);

506 
ch™ge
->
	`≠∂y
(ch™ge, (
DüObje˘
 *)
˝l
);

507  
ch™ge
;

508 
	}
}

511 
	$c⁄≈oöéöe_adju°_cou¡
(
C⁄nPoötLöe
 *
˝l
,

512 
√wcou¡
, 
Poöt
 *
whîe
)

514 
ﬁdcou¡
,
dñè
;

516 
ﬁdcou¡
 = 
˝l
->
num_c⁄√˘i⁄s
;

518 i‡(
√wcou¡
 < 0)Çewcount = 0;

520 
dñè
 = 
√wcou¡
 - 
ﬁdcou¡
;

521 i‡(
dñè
 != 0) {

522 
Obje˘Ch™ge
 *
ch™ge
;

525 i‡(
dñè
 > 0) {

526 
ch™ge
 = 
	`c⁄≈oöéöe_add_poöts
(
˝l
, 
whîe
, 
dñè
);

528 
ch™ge
 = 
	`c⁄≈oöéöe_ªmove_poöts
(
˝l
, 
whîe
, -
dñè
);

530 i‡(
ch™ge
->
‰ì
Ëch™ge->
	`‰ì
(change);

531 
	`g_‰ì
(
ch™ge
);

535  
ﬁdcou¡
;

536 
	}
}

	@O:\tool\dvs50\lib\connpoint_line.h

24 #i‚de‡
__CONNPOINT_LINE_H


25 
	#__CONNPOINT_LINE_H


	)

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<as£π.h
>

30 
	~<m©h.h
>

31 
	~<glib.h
>

33 
	~"geomëry.h
"

34 
	~"c⁄√˘i⁄poöt.h
"

35 
	~"obje˘.h
"

36 
	~"dü_xml.h
"

39 
Poöt
 
	m°¨t
,
	míd
;

40 
DüObje˘
 *
	m∑ª¡
;

42 
	mnum_c⁄√˘i⁄s
;

43 
GSLi°
 *
	mc⁄√˘i⁄s
;

44 } 
	tC⁄nPoötLöe
;

47 
DIAVAR
 
C⁄nPoötLöe
 *
c⁄≈oöéöe_¸óã
(
DüObje˘
 *
∑ª¡
,

48 
num_c⁄√˘i⁄s
);

49 
DIAVAR
 
c⁄≈oöéöe_de°roy
(
C⁄nPoötLöe
 *
˝l
);

50 
DIAVAR
 
c⁄≈oöéöe_upd©e
(
C⁄nPoötLöe
 *
˝l
);

51 
DIAVAR
 
c⁄≈oöéöe_put⁄Æöe
(
C⁄nPoötLöe
 *
˝l
,
Poöt
 *
°¨t
,Poöà*
íd
);

52 
DIAVAR
 
c⁄≈oöéöe_ˇn_add_poöt
(
C⁄nPoötLöe
 *
˝l
,

53 
Poöt
 *
˛icked
);

54 
DIAVAR
 
c⁄≈oöéöe_ˇn_ªmove_poöt
(
C⁄nPoötLöe
 *
˝l
,

55 
Poöt
 *
˛icked
);

57 
DIAVAR
 
Obje˘Ch™ge
 *
c⁄≈oöéöe_add_poöts
(
C⁄nPoötLöe
 *
˝l
,

58 
Poöt
 *
˛ickedpoöt
,

59 
cou¡
);

60 
DIAVAR
 
Obje˘Ch™ge
 *
c⁄≈oöéöe_ªmove_poöts
(
C⁄nPoötLöe
 *
˝l
,

61 
Poöt
 *
˛ickedpoöt
,

62 
cou¡
);

63 
DIAVAR
 
C⁄nPoötLöe
 *
c⁄≈oöéöe_lﬂd
(
DüObje˘
 *
obj
,
Obje˘Node
 
obj_node
,

64 c⁄° 
gch¨
 *
«me
, 
deÁu…_nc
,

65 *
ªÆc⁄ncou¡
);

66 
DIAVAR
 
c⁄≈oöéöe_ßve
(
C⁄nPoötLöe
 *
˝l
,
Obje˘Node
 
obj_node
,

67 c⁄° 
gch¨
 *
«me
);

68 
DIAVAR
 
C⁄nPoötLöe
 *
c⁄≈oöéöe_c›y
(
DüObje˘
 *
√wobj
,C⁄nPoötLöê*
˝l
,

69 *
ªÆc⁄ncou¡
);

71 
	#c⁄≈oöéöe_add_poöt
(
˝l
, 
˛ickedpoöt
) \

72 
	`c⁄≈oöéöe_add_poöts
(
˝l
, 
˛ickedpoöt
, 1)

	)

73 
	#c⁄≈oöéöe_ªmove_poöt
(
˝l
, 
˛ickedpoöt
) \

74 
	`c⁄≈oöéöe_ªmove_poöts
(
˝l
, 
˛ickedpoöt
, 1)

	)

76 
DIAVAR
 
c⁄≈oöéöe_adju°_cou¡
(
C⁄nPoötLöe
 *
˝l
,

77 
√wcou¡
, 
Poöt
 *
whîe
);

	@O:\tool\dvs50\lib\create.c

23 #ifde‡
HAVE_CONFIG_H


24 
	~<c⁄fig.h
>

27 
	~<°rög.h
>

28 
	~<m©h.h
>

29 
	~<glib.h
>

30 
	~<°dlib.h
>

32 
	~"öé.h
"

33 
	~"mesßge.h
"

34 
	~"geomëry.h
"

35 
	~"fûãr.h
"

36 
	~"obje˘.h
"

37 
	~"¥›îtõs.h
"

38 
	~"¥›öã∫Æs.h
"

39 
	~"group.h
"

40 
	~"¸óã.h
"

42 
DüObje˘
 *

43 
	$¸óã_°™d¨d_ãxt
(
ªÆ
 
xpos
,Ñó»
ypos
) {

44 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Text");

45 
DüObje˘
 *
√w_obj
;

46 
H™dÀ
 *
h1
, *
h2
;

47 
Poöt
 
poöt
;

49 i‡(
Ÿy≥
 =
NULL
){

50 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

51  
NULL
;

54 
poöt
.
x
 = 
xpos
;

55 
poöt
.
y
 = 
ypos
;

57 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(&
poöt
, oty≥->
deÁu…_u£r_d©a
,

58 &
h1
, &
h2
);

60  
√w_obj
;

61 
	}
}

63 
Pr›Des¸ùti⁄
 
	g¸óã_ñemít_¥›_descs
[] = {

64 { "ñem_c‹√r", 
PROP_TYPE_POINT
 },

65 { "ñem_width", 
PROP_TYPE_REAL
 },

66 { "ñem_height", 
PROP_TYPE_REAL
 },

67 
PROP_DESC_END
};

69 
GPåAºay
 *
	$make_ñemít_¥›s
(
ªÆ
 
xpos
,Ñó»
ypos
,

70 
ªÆ
 
width
,Ñó»
height
)

72 
GPåAºay
 *
¥›s
;

73 
PoötPr›îty
 *
µr›
;

74 
RólPr›îty
 *
Ωr›
;

76 
¥›s
 = 
	`¥›_li°_‰om_descs
(
¸óã_ñemít_¥›_descs
,
pdçp_åue
);

77 
	`g_as£π
(
¥›s
->
Àn
 == 3);

79 
µr›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,0);

80 
µr›
->
poöt_d©a
.
x
 = 
xpos
;

81 
µr›
->
poöt_d©a
.
y
 = 
ypos
;

82 
Ωr›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,1);

83 
Ωr›
->
ªÆ_d©a
 = 
width
;

84 
Ωr›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,2);

85 
Ωr›
->
ªÆ_d©a
 = 
height
;

87  
¥›s
;

88 
	}
}

90 
DüObje˘
 *

91 
	$¸óã_°™d¨d_ñlù£
(
ªÆ
 
xpos
,Ñó»
ypos
,Ñó»
width
,Ñó»
height
) {

92 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Ellipse");

93 
DüObje˘
 *
√w_obj
;

94 
H™dÀ
 *
h1
, *
h2
;

96 
GPåAºay
 *
¥›s
;

97 
Poöt
 
poöt
;

99 i‡(
Ÿy≥
 =
NULL
){

100 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

101  
NULL
;

104 
poöt
.
x
 = 
xpos
;

105 
poöt
.
y
 = 
ypos
;

107 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(&
poöt
, oty≥->
deÁu…_u£r_d©a
,

108 &
h1
, &
h2
);

110 
¥›s
 = 
	`make_ñemít_¥›s
(
xpos
,
ypos
,
width
,
height
);

111 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

112 
	`¥›_li°_‰ì
(
¥›s
);

114  
√w_obj
;

115 
	}
}

118 
DüObje˘
 *

119 
	$¸óã_°™d¨d_box
(
ªÆ
 
xpos
,Ñó»
ypos
,Ñó»
width
,Ñó»
height
) {

120 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Box");

121 
DüObje˘
 *
√w_obj
;

122 
H™dÀ
 *
h1
, *
h2
;

123 
Poöt
 
poöt
;

124 
GPåAºay
 *
¥›s
;

126 i‡(
Ÿy≥
 =
NULL
){

127 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

128  
NULL
;

131 
poöt
.
x
 = 
xpos
;

132 
poöt
.
y
 = 
ypos
;

134 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(&
poöt
, oty≥->
deÁu…_u£r_d©a
,

135 &
h1
, &
h2
);

137 
¥›s
 = 
	`make_ñemít_¥›s
(
xpos
,
ypos
,
width
,
height
);

138 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

139 
	`¥›_li°_‰ì
(
¥›s
);

141  
√w_obj
;

142 
	}
}

144 
Pr›Des¸ùti⁄
 
	g¸óã_löe_¥›_descs
[] = {

145 
PROP_STD_START_ARROW
,

146 
PROP_STD_END_ARROW
,

147 
PROP_DESC_END
};

149 
DüObje˘
 *

150 
	$¸óã_°™d¨d_pﬁylöe
(
num_poöts
,

151 
Poöt
 *
poöts
,

152 
Aºow
 *
íd_¨row
,

153 
Aºow
 *
°¨t_¨row
) {

154 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - PolyLine");

155 
DüObje˘
 *
√w_obj
;

156 
H™dÀ
 *
h1
, *
h2
;

157 
Mu…ùoötCª©eD©a
 *
pcd
;

158 
GPåAºay
 *
¥›s
;

160 i‡(
Ÿy≥
 =
NULL
){

161 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

162  
NULL
;

165 
pcd
 = 
	`g_√w
(
Mu…ùoötCª©eD©a
, 1);

166 
pcd
->
num_poöts
 =Çum_points;

167 
pcd
->
poöts
 =Öoints;

169 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(
NULL
, 
pcd
,

170 &
h1
, &
h2
);

172 
	`g_‰ì
(
pcd
);

174 
¥›s
 = 
	`¥›_li°_‰om_descs
(
¸óã_löe_¥›_descs
,
pdçp_åue
);

175 
	`g_as£π
(
¥›s
->
Àn
 == 2);

177 i‡(
°¨t_¨row
 !
NULL
)

178 ((
AºowPr›îty
 *)
	`g_±r_¨øy_ödex
(
¥›s
, 0))->
¨row_d©a
 = *
°¨t_¨row
;

179 i‡(
íd_¨row
 !
NULL
)

180 ((
AºowPr›îty
 *)
	`g_±r_¨øy_ödex
(
¥›s
, 1))->
¨row_d©a
 = *
íd_¨row
;

182 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

183 
	`¥›_li°_‰ì
(
¥›s
);

185  
√w_obj
;

186 
	}
}

188 
DüObje˘
 *

189 
	$¸óã_°™d¨d_pﬁyg⁄
(
num_poöts
,

190 
Poöt
 *
poöts
) {

191 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Polygon");

192 
DüObje˘
 *
√w_obj
;

193 
H™dÀ
 *
h1
, *
h2
;

194 
Mu…ùoötCª©eD©a
 *
pcd
;

196 i‡(
Ÿy≥
 =
NULL
){

197 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

198  
NULL
;

201 
pcd
 = 
	`g_√w
(
Mu…ùoötCª©eD©a
, 1);

202 
pcd
->
num_poöts
 =Çum_points;

203 
pcd
->
poöts
 =Öoints;

205 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(
NULL
, 
pcd
, &
h1
, &
h2
);

207 
	`g_‰ì
(
pcd
);

209  
√w_obj
;

210 
	}
}

212 
DüObje˘
 *

213 
	$¸óã_°™d¨d_bezõæöe
(
num_poöts
,

214 
BezPoöt
 *
poöts
,

215 
Aºow
 *
íd_¨row
,

216 
Aºow
 *
°¨t_¨row
) {

217 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - BezierLine");

218 
DüObje˘
 *
√w_obj
;

219 
H™dÀ
 *
h1
, *
h2
;

220 
BezõrCª©eD©a
 *
bcd
;

221 
GPåAºay
 *
¥›s
;

223 i‡(
Ÿy≥
 =
NULL
){

224 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

225  
NULL
;

228 
bcd
 = 
	`g_√w
(
BezõrCª©eD©a
, 1);

229 
bcd
->
num_poöts
 =Çum_points;

230 
bcd
->
poöts
 =Öoints;

232 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(
NULL
, 
bcd
,

233 &
h1
, &
h2
);

235 
	`g_‰ì
(
bcd
);

237 
¥›s
 = 
	`¥›_li°_‰om_descs
(
¸óã_löe_¥›_descs
,
pdçp_åue
);

238 
	`g_as£π
(
¥›s
->
Àn
 == 2);

240 i‡(
°¨t_¨row
 !
NULL
)

241 ((
AºowPr›îty
 *)
	`g_±r_¨øy_ödex
(
¥›s
, 0))->
¨row_d©a
 = *
°¨t_¨row
;

242 i‡(
íd_¨row
 !
NULL
)

243 ((
AºowPr›îty
 *)
	`g_±r_¨øy_ödex
(
¥›s
, 1))->
¨row_d©a
 = *
íd_¨row
;

245 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

246 
	`¥›_li°_‰ì
(
¥›s
);

248  
√w_obj
;

249 
	}
}

251 
DüObje˘
 *

252 
	$¸óã_°™d¨d_bezõrg⁄
(
num_poöts
,

253 
BezPoöt
 *
poöts
) {

254 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Beziergon");

255 
DüObje˘
 *
√w_obj
;

256 
H™dÀ
 *
h1
, *
h2
;

257 
BezõrCª©eD©a
 *
bcd
;

259 i‡(
Ÿy≥
 =
NULL
){

260 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

261  
NULL
;

264 
bcd
 = 
	`g_√w
(
BezõrCª©eD©a
, 1);

265 
bcd
->
num_poöts
 =Çum_points;

266 
bcd
->
poöts
 =Öoints;

268 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(
NULL
, 
bcd
,

269 &
h1
, &
h2
);

271 
	`g_‰ì
(
bcd
);

273  
√w_obj
;

274 
	}
}

277 
Pr›Des¸ùti⁄
 
	g¸óã_¨c_¥›_descs
[] = {

278 { "curve_di°™˚", 
PROP_TYPE_REAL
 },

279 
PROP_STD_START_ARROW
,

280 
PROP_STD_END_ARROW
,

281 
PROP_DESC_END
};

283 
DüObje˘
 *

284 
	$¸óã_°™d¨d_¨c
(
ªÆ
 
x1
,Ñó»
y1
,Ñó»
x2
,Ñó»
y2
,

285 
ªÆ
 
di°™˚
,

286 
Aºow
 *
íd_¨row
,

287 
Aºow
 *
°¨t_¨row
) {

288 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Arc");

289 
DüObje˘
 *
√w_obj
;

290 
H™dÀ
 *
h1
, *
h2
;

291 
Poöt
 
p1
, 
p2
;

292 
GPåAºay
 *
¥›s
;

294 i‡(
Ÿy≥
 =
NULL
){

295 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

296  
NULL
;

299 
p1
.
x
 = 
x1
;

300 
p1
.
y
 = 
y1
;

301 
p2
.
x
 = 
x2
;

302 
p2
.
y
 = 
y2
;

305 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(&
p1
, oty≥->
deÁu…_u£r_d©a
,

306 &
h1
, &
h2
);

307 
√w_obj
->
›s
->
	`move_h™dÀ
“ew_obj, 
h2
, &
p2
, 
NULL
, 
HANDLE_MOVE_USER_FINAL
,0);

308 
¥›s
 = 
	`¥›_li°_‰om_descs
(
¸óã_¨c_¥›_descs
,
pdçp_åue
);

309 
	`g_as£π
(
¥›s
->
Àn
 == 3);

311 ((
RólPr›îty
 *)
	`g_±r_¨øy_ödex
(
¥›s
,0))->
ªÆ_d©a
 = 
di°™˚
;

312 i‡(
°¨t_¨row
 !
NULL
)

313 ((
AºowPr›îty
 *)
	`g_±r_¨øy_ödex
(
¥›s
, 1))->
¨row_d©a
 = *
°¨t_¨row
;

314 i‡(
íd_¨row
 !
NULL
)

315 ((
AºowPr›îty
 *)
	`g_±r_¨øy_ödex
(
¥›s
, 2))->
¨row_d©a
 = *
íd_¨row
;

317 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

318 
	`¥›_li°_‰ì
(
¥›s
);

320  
√w_obj
;

321 
	}
}

323 
Pr›Des¸ùti⁄
 
	g¸óã_fûe_¥›_descs
[] = {

324 { "image_fûe", 
PROP_TYPE_FILE
 },

325 
PROP_DESC_END
};

327 
DüObje˘
 *

328 
	$¸óã_°™d¨d_image
(
ªÆ
 
xpos
,Ñó»
ypos
,Ñó»
width
,Ñó»
height
,

329 *
fûe
) {

330 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Image");

331 
DüObje˘
 *
√w_obj
;

332 
H™dÀ
 *
h1
, *
h2
;

333 
Poöt
 
poöt
;

334 
GPåAºay
 *
¥›s
;

335 
SåögPr›îty
 *
•r›
;

337 i‡(
Ÿy≥
 =
NULL
){

338 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

339  
NULL
;

342 
poöt
.
x
 = 
xpos
;

343 
poöt
.
y
 = 
ypos
;

345 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(&
poöt
, oty≥->
deÁu…_u£r_d©a
,

346 &
h1
, &
h2
);

348 
¥›s
 = 
	`make_ñemít_¥›s
(
xpos
,
ypos
,
width
,
height
);

349 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

350 
	`¥›_li°_‰ì
(
¥›s
);

353 
¥›s
 = 
	`¥›_li°_‰om_descs
(
¸óã_fûe_¥›_descs
,
pdçp_åue
);

354 
	`g_as£π
(
¥›s
->
Àn
 == 1);

355 
•r›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,0);

356 
	`g_‰ì
(
•r›
->
°rög_d©a
);

357 
•r›
->
°rög_d©a
 = 
	`g_°rdup
(
fûe
);

358 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

359 
	`¥›_li°_‰ì
(
¥›s
);

361  
√w_obj
;

362 
	}
}

364 
DüObje˘
 *

365 
	$¸óã_°™d¨d_group
(
GLi°
 *
ôems
) {

366 
DüObje˘
 *
√w_obj
;

368 
√w_obj
 = 
	`group_¸óã
((
GLi°
*)
ôems
);

370  
√w_obj
;

371 
	}
}

	@O:\tool\dvs50\lib\create.h

23 #i‚de‡
STANDARD_OBJECT_CREATE_H


24 
	#STANDARD_OBJECT_CREATE_H


	)

26 
	~"düty≥s.h
"

29 
	s_Mu…ùoötCª©eD©a
 {

30 
	mnum_poöts
;

31 
Poöt
 *
	mpoöts
;

35 
	s_BezõrCª©eD©a
 {

36 
	mnum_poöts
;

37 
BezPoöt
 *
	mpoöts
;

45 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_ãxt
(
ªÆ
 
xpos
,Ñó»
ypos
);

46 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_ñlù£
(
ªÆ
 
xpos
,Ñó»
ypos
,Ñó»
width
,Ñó»
height
);

47 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_box
(
ªÆ
 
xpos
,Ñó»
ypos
,Ñó»
width
,Ñó»
height
);

48 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_pﬁylöe
(
num_poöts
, 
Poöt
 *
poöts
,

49 
Aºow
 *
íd_¨row
, Aºow *
°¨t_¨row
);

50 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_pﬁyg⁄
(
num_poöts
, 
Poöt
 *
poöts
);

51 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_bezõæöe
(
num_poöts
, 
BezPoöt
 *
poöts
,

52 
Aºow
 *
íd_¨row
, Aºow *
°¨t_¨row
);

53 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_bezõrg⁄
(
num_poöts
, 
BezPoöt
 *
poöts
);

54 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_¨c
(
ªÆ
 
x1
,Ñó»
y1
,Ñó»
x2
,Ñó»
y2
,

55 
ªÆ
 
curve_di°™˚
,

56 
Aºow
 *
íd_¨row
, Aºow *
°¨t_¨row
);

57 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_image
(
ªÆ
 
xpos
,Ñó»
ypos
,Ñó»
width
,Ñó»
height
,

58 *
fûe
);

59 
DIAVAR
 
DüObje˘
 * 
¸óã_°™d¨d_group
(
GLi°
 *
ôems
);

	@O:\tool\dvs50\lib\debug.c

21 
	~<c⁄fig.h
>

23 
	~<°dio.h
>

24 
	~<glib/g¥ötf.h
>

25 
	~<°d¨g.h
>

27 
	~"debug.h
"

34 
gboﬁón


35 
	$dü_as£π_åue
(
gboﬁón
 
vÆ
, 
gch¨
 *
f‹m©
, ...) {

36 
va_li°
 
¨gs
;

37 i‡(!
vÆ
) {

38 
	`va_°¨t
(
¨gs
, 
f‹m©
);

39 
	`g_v¥ötf
(
f‹m©
, 
¨gs
);

40 
	`va_íd
(
¨gs
);

42  
vÆ
;

43 
	}
}

	@O:\tool\dvs50\lib\debug.h

21 #i‚de‡
DEBUG_H


22 
	#DEBUG_H


	)

24 
	~<c⁄fig.h
>

26 
	~<°dio.h
>

27 
	~<gtk/gtk.h
>

28 
	~<°d¨g.h
>

29 
	~"düv¨.h
"

31 
DIAVAR
 
gboﬁón
 
dü_as£π_åue
(gboﬁó¿
vÆ
, 
gch¨
 *
f‹m©
, ...);

	@O:\tool\dvs50\lib\dia-enums.h

1 #i‚de‡
DIA_ENUMS_H


2 
	#DIA_ENUMS_H


	)

5 
	mLINECAPS_BUTT
,

6 
	mLINECAPS_ROUND
,

7 
	mLINECAPS_PROJECTING


8 } 
	tLöeC≠s
;

11 
	mLINEJOIN_MITER
,

12 
	mLINEJOIN_ROUND
,

13 
	mLINEJOIN_BEVEL


14 } 
	tLöeJoö
;

17 
	mLINESTYLE_SOLID
,

18 
	mLINESTYLE_DASHED
,

19 
	mLINESTYLE_DASH_DOT
,

20 
	mLINESTYLE_DASH_DOT_DOT
,

21 
	mLINESTYLE_DOTTED


22 } 
	tLöeStyÀ
;

25 
	mFILLSTYLE_SOLID


26 } 
	tFûlStyÀ
;

29 
	mALIGN_LEFT
,

30 
	mALIGN_CENTER
,

31 
	mALIGN_RIGHT


32 } 
	tAlignmít
;

	@O:\tool\dvs50\lib\dia-lib-icons.h

3 #ifde‡
__SUNPRO_C


4 #¥agm®
Æign
 4 (
dü_brokí_ic⁄
)

6 #ifde‡
__GNUC__


7 c⁄° 
guöt8
 
	gdü_brokí_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

9 c⁄° 
guöt8
 
dü_brokí_ic⁄
[] =

365 #ifde‡
__SUNPRO_C


366 #¥agm®
Æign
 4 (
dü_brokí_chaö_ic⁄
)

368 #ifde‡
__GNUC__


369 c⁄° 
guöt8
 
	gdü_brokí_chaö_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

371 c⁄° 
guöt8
 
dü_brokí_chaö_ic⁄
[] =

415 #ifde‡
__SUNPRO_C


416 #¥agm®
Æign
 4 (
dü_unbrokí_chaö_ic⁄
)

418 #ifde‡
__GNUC__


419 c⁄° 
guöt8
 
	gdü_unbrokí_chaö_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

421 c⁄° 
guöt8
 
dü_unbrokí_chaö_ic⁄
[] =

	@O:\tool\dvs50\lib\dia_dirs.c

19 
	~<c⁄fig.h
>

21 
	~<°rög.h
>

23 
	~"dü_dús.h
"

24 
	~"öé.h
"

25 
	~"mesßge.h
"

26 #ifde‡
G_OS_WIN32


27 
	#WIN32_LEAN_AND_MEAN


	)

28 
	~<wödows.h
>

30 
	~<sys/°©.h
>

31 
	~<sys/ty≥s.h
>

33 
	~<glib/g°dio.h
>

41 
gch¨
 *

42 
	$dü_gë_d©a_dúe˘‹y
(c⁄° 
gch¨
* 
subdú
)

44 #ifde‡
G_OS_WIN32


48 
gch¨
 
sLoc
 [
MAX_PATH
+1];

49 
HINSTANCE
 
hIn°
 = 
	`GëModuÀH™dÀ
(
NULL
);

51 i‡(0 !
	`GëModuÀFûeName
(
hIn°
, 
sLoc
, 
MAX_PATH
))

54 i‡(
	`°ºchr
(
sLoc
, 
G_DIR_SEPARATOR
))

55 
	`°ºchr
(
sLoc
, 
G_DIR_SEPARATOR
)[0] = 0;

57 i‡(
	`°ºchr
(
sLoc
, 
G_DIR_SEPARATOR
))

58 
	`°ºchr
(
sLoc
, 
G_DIR_SEPARATOR
)[1] = 0;

60  
	`g_°rc⁄ˇt
 (
sLoc
 , 
subdú
, 
NULL
);

63 i‡(
	`°æí
 (
subdú
) == 0)

64  
	`g_°rc⁄ˇt
 (
DATADIR
, 
NULL
);

66  
	`g_°rc⁄ˇt
 (
DATADIR
, 
G_DIR_SEPARATOR_S
, 
subdú
, 
NULL
);

68 
	}
}

76 
gch¨
*

77 
	$dü_gë_lib_dúe˘‹y
(c⁄° 
gch¨
* 
subdú
)

79 #ifde‡
G_OS_WIN32


83 
gch¨
 
sLoc
 [
MAX_PATH
+1];

84 
HINSTANCE
 
hIn°
 = 
	`GëModuÀH™dÀ
(
NULL
);

86 i‡(0 !
	`GëModuÀFûeName
(
hIn°
, 
sLoc
, 
MAX_PATH
))

89 i‡(
	`°ºchr
(
sLoc
, 
G_DIR_SEPARATOR
))

90 
	`°ºchr
(
sLoc
, 
G_DIR_SEPARATOR
)[0] = 0;

92 i‡(
	`°ºchr
(
sLoc
, 
G_DIR_SEPARATOR
))

93 
	`°ºchr
(
sLoc
, 
G_DIR_SEPARATOR
)[1] = 0;

95  
	`g_°rc⁄ˇt
 (
sLoc
 , 
subdú
, 
NULL
);

98  
	`g_°rc⁄ˇt
 (
LIBDIR
, 
G_DIR_SEPARATOR_S
, 
subdú
, 
NULL
);

100 
	}
}

108 
gch¨
 *

109 
	$dü_c⁄fig_fûíame
(c⁄° 
gch¨
 *
subfûe
)

111 c⁄° 
gch¨
 *
homedú
;

113 
homedú
 = 
	`g_gë_home_dú
();

114 i‡(!
homedú
) {

115 
homedú
 = 
	`g_gë_tmp_dú
();

118  
	`g_°rc⁄ˇt
(
homedú
, 
G_DIR_SEPARATOR_S
 ".dia" G_DIR_SEPARATOR_S,

119 
subfûe
, 
NULL
);

120 
	}
}

127 
gboﬁón


128 
	$dü_c⁄fig_ísuª_dú
(c⁄° 
gch¨
 *
fûíame
)

130 
gch¨
 *
dú
 = 
	`g_∑th_gë_dú«me
(
fûíame
);

131 
gboﬁón
 
exi°s
;

132 i‡(
dú
 =
NULL
Ë 
FALSE
;

133 i‡(
	`°rcmp
(
dú
, ".")) {

134 i‡(
	`g_fûe_ã°
(
dú
, 
G_FILE_TEST_IS_DIR
)) {

135 
exi°s
 = 
TRUE
;

137 i‡(
	`dü_c⁄fig_ísuª_dú
(
dú
)) {

138 
exi°s
 = (
	`g_mkdú
(
dú
, 0755) == 0);

140 
exi°s
 = 
FALSE
;

144 
exi°s
 = 
FALSE
;

146 
	`g_‰ì
(
dú
);

147  
exi°s
;

148 
	}
}

155 
gch¨
 *

156 
	$dü_gë_ˇn⁄iˇl_∑th
(c⁄° 
gch¨
 *
∑th
)

158 
gch¨
 *
ªt
 = 
NULL
;

159 
gch¨
 **
li°
;

160 
i
 = 0, 
n
 = 0;

163 i‡(!
	`°r°r
(
∑th
, ".."Ë&& !°r°r’©h, "." 
G_DIR_SEPARATOR_S
))

164  
	`g_°rdup
(
∑th
);

166 
li°
 = 
	`g_°r•lô
 (
∑th
, 
G_DIR_SEPARATOR_S
, -1);

167 
li°
[
i
] !
NULL
) {

168 i‡(0 =
	`°rcmp
 (
li°
[
i
], ".")) {

170 
	`g_‰ì
 (
li°
[
i
]);

171 
li°
[
i
] = 
	`g_°rdup
 ("");

173 i‡(0 =
	`°rcmp
 (
li°
[
i
], "..")) {

175 
n
 = 
i
;

176 
	`g_‰ì
 (
li°
[
i
]);

177 
li°
[
i
] = 
	`g_°rdup
 ("");

178 
n
 >= 0) {

179 i‡(0 !
	`°æí
(
li°
[
n
])) {

181 
	`g_‰ì
 (
li°
[
n
]);

182 
li°
[
n
] = 
	`g_°rdup
 ("");

185 
n
--;

188 i‡(
n
 < 0)

191 
i
++;

193 i‡(
n
 >= 0) {

195 
GSåög
 *
°r
 = 
	`g_°rög_√w
 (
NULL
);

197 
i
 = 0;

198 
li°
[
i
] !
NULL
) {

199 i‡(
	`°æí
(
li°
[
i
]) > 0) {

204 i‡(
i
 !0 || 
li°
[i][1] != ':')

205 
	`g_°rög_≠≥nd
 (
°r
, 
G_DIR_SEPARATOR_S
);

206 
	`g_°rög_≠≥nd
 (
°r
, 
li°
[
i
]);

208 
i
++;

210 
ªt
 = 
	`g_°rög_‰ì
 (
°r
, 
FALSE
);

213 
	`g_°r‰ìv
(
li°
);

215  
ªt
;

216 
	}
}

226 c⁄° 
gch¨
 *

227 
	$dü_mesßge_fûíame
(c⁄° 
gch¨
 *
fûíame
)

229 
gch¨
 *
tmp
;

230 
GQu¨k
 
msg_qu¨k
;

232 #i‡
	`GLIB_CHECK_VERSION
(2,6,0)

233 
tmp
 = 
	`g_fûíame_di•œy_«me
(
fûíame
);

235 
gsize
 
num_ªad
;

236 
tmp
 = 
	`g_fûíame_to_utf8
(
fûíame
, -1, &
num_ªad
, 
NULL
, NULL);

237 i‡(
tmp
 =
NULL
) {

238 
gch¨
 *
ñlùsis
;

240 
	`g_utf8_vÆid©e
(
fûíame
, -1, &
ñlùsis
);

241 
tmp
 = 
	`g_fûíame_to_utf8
(
fûíame
, 
ñlùsis
-fûíame, 
NULL
, NULL, NULL);

242 
ñlùsis
 = 
	`g_°rdup_¥ötf
(
	`_
("%s<ûÀgÆ ch¨a˘îs>..."), 
tmp
);

243 
	`g_‰ì
(
tmp
);

244 
tmp
 = 
ñlùsis
;

249 
msg_qu¨k
 = 
	`g_qu¨k_‰om_°rög
 (
tmp
);

250 
	`g_‰ì
 (
tmp
);

251 
tmp
 = (
gch¨
 *Ë
	`g_qu¨k_to_°rög
 (
msg_qu¨k
);

252  
tmp
;

253 
	}
}

259 
gch¨
 *

260 
	$dü_gë_absﬁuã_fûíame
 (c⁄° 
gch¨
 *
fûíame
)

262 
gch¨
 *
cuºít_dú
;

263 
gch¨
 *
fuŒ«me
;

264 
gch¨
 *
ˇn⁄iˇl
;

265 i‡(
fûíame
 =
NULL
)  NULL;

266 i‡(
	`g_∑th_is_absﬁuã
(
fûíame
)Ë 
	`dü_gë_ˇn⁄iˇl_∑th
(filename);

267 
cuºít_dú
 = 
	`g_gë_cuºít_dú
();

268 
fuŒ«me
 = 
	`g_buûd_fûíame
(
cuºít_dú
, 
fûíame
, 
NULL
);

269 
	`g_‰ì
(
cuºít_dú
);

270 i‡(
	`°rchr
(
fuŒ«me
, '.'Ë=
NULL
)  fullname;

271 
ˇn⁄iˇl
 = 
	`dü_gë_ˇn⁄iˇl_∑th
(
fuŒ«me
);

272 i‡(
ˇn⁄iˇl
 =
NULL
) {

273 
	`mesßge_w¨nög
(
	`_
("Too many ..'s in filename %s\n"),

274 
	`dü_mesßge_fûíame
(
fûíame
));

275  
	`g_°rdup
(
fûíame
);

277 
	`g_‰ì
(
fuŒ«me
);

278  
ˇn⁄iˇl
;

279 
	}
}

	@O:\tool\dvs50\lib\dia_dirs.h

19 #i‚de‡
DIA_DIRS_H


20 
	#DIA_DIRS_H


	)

22 
	~<glib.h
>

23 
	~"düv¨.h
"

24 #ifde‡
G_OS_WIN32


25 
	#DIA_SHEETDIR
 "shìts"

	)

26 
	#DIA_SHAPEDIR
 "sh≠es"

	)

27 
	#DIA_INT_SHAPEDIR
 
DIA_SHEETDIR
 
G_DIR_SEPARATOR_S
 "öt"

	)

30 
DIAVAR
 
gch¨
 *
dü_gë_d©a_dúe˘‹y
 (c⁄° gch¨* 
subdú
);

31 
DIAVAR
 
gch¨
 *
dü_gë_lib_dúe˘‹y
 (c⁄° gch¨* 
subdú
);

32 
DIAVAR
 
gch¨
 *
dü_c⁄fig_fûíame
 (c⁄° gch¨* 
fûe
);

33 
gboﬁón
 
dü_c⁄fig_ísuª_dú
 (c⁄° 
gch¨
* 
fûíame
);

34 
DIAVAR
 
gch¨
 *
dü_gë_absﬁuã_fûíame
 (c⁄° gch¨ *
fûíame
);

35 
DIAVAR
 
gch¨
 *
dü_gë_ˇn⁄iˇl_∑th
 (c⁄° gch¨ *
∑th
);

36 
DIAVAR
 c⁄° 
gch¨
 *
dü_mesßge_fûíame
 (c⁄° gch¨ *
fûíame
);

	@O:\tool\dvs50\lib\dia_image.c

19 
	~<c⁄fig.h
>

20 
	~<°rög.h
>

22 
	~"geomëry.h
"

23 
	~"dü_image.h
"

24 
	~"mesßge.h
"

25 
	~<gtk/gtkwidgë.h
>

26 
	~<gdk-pixbuf/gdk-pixbuf.h
>

28 
	~"dü-lib-ic⁄s.h
"

30 
	#SCALING_CACHE


	)

32 
GTy≥
 
dü_image_gë_ty≥
 ();

33 
	#DIA_TYPE_IMAGE
 (
	`dü_image_gë_ty≥
())

	)

34 
	#DIA_IMAGE
(
obje˘
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
((obje˘), 
DIA_TYPE_IMAGE
, 
DüImage
))

	)

35 
	#DIA_IMAGE_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_IMAGE
, 
DüImageCœss
))

	)

37 
_DüImageCœss
 
	tDüImageCœss
;

38 
	s_DüImageCœss
 {

39 
GObje˘Cœss
 
	m∑ª¡_˛ass
;

42 
	s_DüImage
 {

43 
GObje˘
 
	m∑ª¡_ö°™˚
;

44 
GdkPixbuf
 *
	mimage
;

45 
gch¨
 *
	mfûíame
;

46 #ifde‡
SCALING_CACHE


47 
GdkPixbuf
 *
	msˇÀd
;

48 
	msˇÀd_width
, 
	msˇÀd_height
;

52 
dü_image_˛ass_öô
(
DüImageCœss
* 
˛ass
);

53 
dü_image_föÆize
(
GObje˘
* 
obje˘
);

54 
dü_image_öô_ö°™˚
(
DüImage
*);

56 
GTy≥


57 
	$dü_image_gë_ty≥
 ()

59 
GTy≥
 
obje˘_ty≥
 = 0;

61 i‡(!
obje˘_ty≥
) {

62 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

64  (
DüImageCœss
),

65 (
GBa£InôFunc
Ë
NULL
,

66 (
GBa£FöÆizeFunc
Ë
NULL
,

67 (
GCœssInôFunc
Ë
dü_image_˛ass_öô
,

68 
NULL
,

69 
NULL
,

70  (
DüImage
),

72 (
GIn°™˚InôFunc
)
dü_image_öô_ö°™˚


74 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
G_TYPE_OBJECT
,

76 &
obje˘_öfo
, 0);

78  
obje˘_ty≥
;

79 
	}
}

81 
gpoöãr
 
	g∑ª¡_˛ass
;

84 
	$dü_image_˛ass_öô
(
DüImageCœss
* 
kœss
)

86 
GObje˘Cœss
* 
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
(
kœss
);

87 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
(
kœss
);

88 
obje˘_˛ass
->
föÆize
 = 
dü_image_föÆize
;

89 
	}
}

92 
	$dü_image_öô_ö°™˚
(
DüImage
 *
image
)

96 
	}
}

99 
	$dü_image_föÆize
(
GObje˘
* 
obje˘
)

101 
DüImage
 *
image
 = 
	`DIA_IMAGE
(
obje˘
);

102 i‡(
image
->image)

103 
	`gdk_pixbuf_uƒef
 (
image
->image);

104 
image
->imagê
NULL
;

105 
	`g_‰ì
 (
image
->
fûíame
);

106 
image
->
fûíame
 = 
NULL
;

107 
	}
}

109 
gboﬁón
 
	g_dü_image_öôülized
 = 
FALSE
;

115 
	$dü_image_öô
()

117 i‡(!
_dü_image_öôülized
) {

118 
	`gtk_widgë_£t_deÁu…_cﬁ‹m≠
(
	`gdk_rgb_gë_cm≠
());

119 
_dü_image_öôülized
 = 
TRUE
;

121 
	}
}

126 
DüImage
 *

127 
	$dü_image_gë_brokí
()

129 
GdkPixbuf
 *
brokí
 = 
NULL
;

130 
DüImage
 *
image
;

132 
image
 = 
	`DIA_IMAGE
(
	`g_obje˘_√w
(
DIA_TYPE_IMAGE
, 
NULL
));

133 i‡(
brokí
 =
NULL
) {

135 
brokí
 = 
	`gdk_pixbuf_√w_‰om_ölöe
(-1, 
dü_brokí_ic⁄
, 
FALSE
, 
NULL
);

137 
image
->imagê
	`g_obje˘_ªf
 (
brokí
);

139 
image
->
fûíame
 = 
	`g_°rdup
("<broken>");

140 #ifde‡
SCALING_CACHE


141 
image
->
sˇÀd
 = 
NULL
;

143  
image
;

144 
	}
}

151 
DüImage
 *

152 
	$dü_image_lﬂd
(c⁄° 
gch¨
 *
fûíame
)

154 
DüImage
 *
dü_img
;

155 
GdkPixbuf
 *
image
;

156 
GEº‹
 *
îr‹
 = 
NULL
;

158 
image
 = 
	`gdk_pixbuf_√w_‰om_fûe
(
fûíame
, &
îr‹
);

159 i‡(
image
 =
NULL
) {

164 i‡(
	`g_fûe_ã°
(
fûíame
, 
G_FILE_TEST_EXISTS
))

165 
	`mesßge_w¨nög
 ("%s", 
îr‹
->
mesßge
);

166 
	`g_îr‹_‰ì
 (
îr‹
);

167  
NULL
;

170 
dü_img
 = 
	`DIA_IMAGE
(
	`g_obje˘_√w
(
DIA_TYPE_IMAGE
, 
NULL
));

171 
dü_img
->
image
 = image;

173 
dü_img
->
fûíame
 = 
	`g_°rdup
(filename);

174 #ifde‡
SCALING_CACHE


175 
dü_img
->
sˇÀd
 = 
NULL
;

177  
dü_img
;

178 
	}
}

184 
	$dü_image_add_ªf
(
DüImage
 *
image
)

186 
	`g_obje˘_ªf
(
image
);

187 
	}
}

193 
	$dü_image_uƒef
(
DüImage
 *
image
)

195 
	`g_obje˘_uƒef
(
image
);

196 
	}
}

207 
	$dü_image_døw
(
DüImage
 *
image
, 
GdkWödow
 *
wödow
, 
GdkGC
 *
gc
,

208 
x
, 
y
, 
width
, 
height
)

210 
GdkPixbuf
 *
sˇÀd
;

212 i‡(
width
 < 1 || 
height
 < 1)

214 i‡(
	`gdk_pixbuf_gë_width
(
image
->imageË!
width
 ||

215 
	`gdk_pixbuf_gë_height
(
image
->imageË!
height
) {

217 #ifde‡
SCALING_CACHE


218 i‡(
image
->
sˇÀd
 =
NULL
 ||

219 
image
->
sˇÀd_width
 !
width
 || image->
sˇÀd_height
 !
height
) {

220 i‡(
image
->
sˇÀd
)

221 
	`gdk_pixbuf_uƒef
(
image
->
sˇÀd
);

222 
image
->
sˇÀd
 = 
	`gdk_pixbuf_sˇÀ_sim∂e
(image->image, 
width
, 
height
,

223 
GDK_INTERP_TILES
);

224 
image
->
sˇÀd_width
 = 
width
;

225 
image
->
sˇÀd_height
 = 
height
;

227 
sˇÀd
 = 
image
->scaled;

229 
sˇÀd
 = 
	`gdk_pixbuf_sˇÀ_sim∂e
(
image
->image, 
width
, 
height
,

230 
GDK_INTERP_TILES
);

233 
sˇÀd
 = 
image
->image;

237 
	`gdk_døw_pixbuf
(
wödow
, 
gc
, 
sˇÀd
,

238 0, 0, 
x
, 
y
, 
width
, 
height
,

239 
GDK_RGB_DITHER_NORMAL
, 0, 0);

241 #i‚de‡
SCALING_CACHE


242 
	`gdk_pixbuf_uƒef
(
sˇÀd
);

244 
	}
}

251 
	$dü_image_width
(c⁄° 
DüImage
 *
image
)

253  
	`gdk_pixbuf_gë_width
(
image
->image);

254 
	}
}

261 
	$dü_image_height
(c⁄° 
DüImage
 *
image
)

263  
	`gdk_pixbuf_gë_height
(
image
->image);

264 
	}
}

271 
	$dü_image_row°ride
(c⁄° 
DüImage
 *
image
)

273  
	`gdk_pixbuf_gë_row°ride
(
image
->image);

274 
	}
}

279 c⁄° 
GdkPixbuf
*

280 
	$dü_image_pixbuf
 (c⁄° 
DüImage
 *
image
)

282  
image
->image;

283 
	}
}

290 
guöt8
 *

291 
	$dü_image_rgb_d©a
(c⁄° 
DüImage
 *
image
)

293 
width
 = 
	`dü_image_width
(
image
);

294 
height
 = 
	`dü_image_height
(
image
);

295 
row°ride
 = 
	`dü_image_row°ride
(
image
);

296 
size
 = 
height
*
row°ride
;

297 
guöt8
 *
rgb_pixñs
 = 
	`g_mÆloc
(
size
);

299 i‡(
	`gdk_pixbuf_gë_has_Æpha
(
image
->image)) {

300 
guöt8
 *
pixñs
 = 
	`gdk_pixbuf_gë_pixñs
(
image
->image);

301 
i
, 
j
;

302 
i
 = 0; i < 
height
; i++) {

303 
j
 = 0; j < 
width
; j++) {

304 
rgb_pixñs
[
i
*
row°ride
+
j
*3] = 
pixñs
[i*rowstride+j*4];

305 
rgb_pixñs
[
i
*
row°ride
+
j
*3+1] = 
pixñs
[i*rowstride+j*4+1];

306 
rgb_pixñs
[
i
*
row°ride
+
j
*3+2] = 
pixñs
[i*rowstride+j*4+2];

309  
rgb_pixñs
;

311 
guöt8
 *
pixñs
 = 
	`gdk_pixbuf_gë_pixñs
(
image
->image);

313 
	`g_memmove
(
rgb_pixñs
, 
pixñs
, 
height
*
row°ride
);

314  
rgb_pixñs
;

316 
	}
}

323 
guöt8
 *

324 
	$dü_image_mask_d©a
(c⁄° 
DüImage
 *
image
)

326 
guöt8
 *
pixñs
;

327 
guöt8
 *
mask
;

328 
i
, 
size
;

330 i‡(!
	`gdk_pixbuf_gë_has_Æpha
(
image
->image)) {

331  
NULL
;

334 
pixñs
 = 
	`gdk_pixbuf_gë_pixñs
(
image
->image);

336 
size
 = 
	`gdk_pixbuf_gë_width
(
image
->image)*

337 
	`gdk_pixbuf_gë_height
(
image
->image);

339 
mask
 = 
	`g_mÆloc
(
size
);

342 
i
 = 0; i < 
size
; i++)

343 
mask
[
i
] = 
pixñs
[i*4+3];

345  
mask
;

346 
	}
}

353 c⁄° 
guöt8
 *

354 
	$dü_image_rgba_d©a
(c⁄° 
DüImage
 *
image
)

356 i‡(
	`gdk_pixbuf_gë_has_Æpha
(
image
->image)) {

357 c⁄° 
guöt8
 *
pixñs
 = 
	`gdk_pixbuf_gë_pixñs
(
image
->image);

359  
pixñs
;

361  
NULL
;

363 
	}
}

371 
	$dü_image_fûíame
(c⁄° 
DüImage
 *
image
)

373 i‡(!
image
->
fûíame
)

375  
image
->
fûíame
;

376 
	}
}

	@O:\tool\dvs50\lib\dia_image.h

18 #i‚de‡
DIA_IMAGE_H


19 
	#DIA_IMAGE_H


	)

21 
	~"düty≥s.h
"

22 
	~<gdk/gdkty≥s.h
>

23 
	~<gdk-pixbuf/gdk-pixbuf.h
>

25 
	~"geomëry.h
"

27 
G_BEGIN_DECLS


29 
dü_image_öô
();

31 
DIAVAR
 
DüImage
 *
dü_image_gë_brokí
();

33 
DIAVAR
 
DüImage
 *
dü_image_lﬂd
(c⁄° 
gch¨
 *
fûíame
);

34 
DIAVAR
 
dü_image_add_ªf
(
DüImage
 *
image
);

35 
DIAVAR
 
dü_image_uƒef
(
DüImage
 *
image
);

36 
DIAVAR
 
dü_image_døw
(
DüImage
 *
image
, 
GdkWödow
 *
wödow
, 
GdkGC
 *
gc
,

37 
x
, 
y
, 
width
, 
height
);

39 
DIAVAR
 
dü_image_width
(c⁄° 
DüImage
 *
image
);

40 
DIAVAR
 
dü_image_row°ride
(c⁄° 
DüImage
 *
image
);

41 
DIAVAR
 
dü_image_height
(c⁄° 
DüImage
 *
image
);

46 
DIAVAR
 
guöt8
 *
dü_image_rgb_d©a
(c⁄° 
DüImage
 *
image
);

51 
DIAVAR
 
guöt8
 *
dü_image_mask_d©a
(c⁄° 
DüImage
 *
image
);

55 
DIAVAR
 c⁄° 
guöt8
 *
dü_image_rgba_d©a
(c⁄° 
DüImage
 *
image
);

56 
DIAVAR
 c⁄° *
dü_image_fûíame
(c⁄° 
DüImage
 *
image
);

57 c⁄° 
GdkPixbuf
* 
dü_image_pixbuf
 (c⁄° 
DüImage
 *
image
);

59 
	gG_END_DECLS


	@O:\tool\dvs50\lib\dia_svg.c

24 
	~"c⁄fig.h
"

26 
	~<°rög.h
>

27 
	~<°dlib.h
>

29 
	~<∑ngo/∑ngo-©åibuãs.h
>

31 
	~"dü_svg.h
"

39 
	$dü_svg_°yÀ_öô
(
DüSvgStyÀ
 *
gs
, DüSvgStyÀ *
∑ª¡_°yÀ
)

41 
	`g_ªtu∫_if_Áû
 (
gs
);

42 
gs
->
°roke
 = 
∑ª¡_°yÀ
 ?Ö¨ít_°yÀ->°rokê: 
DIA_SVG_COLOUR_NONE
;

43 
gs
->
löe_width
 = 
∑ª¡_°yÀ
 ?Öarent_style->line_width : 0.0;

44 
gs
->
löe°yÀ
 = 
∑ª¡_°yÀ
 ?Ö¨ít_°yÀ->löe°yÀ : 
LINESTYLE_SOLID
;

45 
gs
->
dashÀngth
 = 
∑ª¡_°yÀ
 ?Öarent_style->dashlength : 1;

46 
gs
->
fûl
 = 
∑ª¡_°yÀ
 ?Ö¨ít_°yÀ->fû»: 
DIA_SVG_COLOUR_NONE
;

47 
gs
->
löeˇp
 = 
∑ª¡_°yÀ
 ?Ö¨ít_°yÀ->löeˇ∞: 
DIA_SVG_LINECAPS_DEFAULT
;

48 
gs
->
löejoö
 = 
∑ª¡_°yÀ
 ?Ö¨ít_°yÀ->löejoö : 
DIA_SVG_LINEJOIN_DEFAULT
;

49 
gs
->
löe°yÀ
 = 
∑ª¡_°yÀ
 ?Ö¨ít_°yÀ->löe°yÀ : 
DIA_SVG_LINESTYLE_DEFAULT
;

50 
gs
->
f⁄t
 = (
∑ª¡_°yÀ
 &&Ö¨ít_°yÀ->f⁄tË? 
	`dü_f⁄t_ªf
’¨ít_°yÀ->f⁄tË: 
NULL
;

51 
gs
->
f⁄t_height
 = 
∑ª¡_°yÀ
 ?Öarent_style->font_height : 0.8;

52 
gs
->
Æignmít
 = 
∑ª¡_°yÀ
 ?Ö¨ít_°yÀ->Æignmíà: 
ALIGN_LEFT
;

53 
	}
}

60 
	$dü_svg_°yÀ_c›y
(
DüSvgStyÀ
 *
de°
, DüSvgStyÀ *
§c
)

62 
	`g_ªtu∫_if_Áû
 (
de°
 && 
§c
);

64 
de°
->
°roke
 = 
§c
->stroke;

65 
de°
->
löe_width
 = 
§c
->line_width;

66 
de°
->
löe°yÀ
 = 
§c
->linestyle;

67 
de°
->
dashÀngth
 = 
§c
->dashlength;

68 
de°
->
fûl
 = 
§c
->fill;

69 i‡(
de°
->
f⁄t
)

70 
	`dü_f⁄t_uƒef
 (
de°
->
f⁄t
);

71 
de°
->
f⁄t
 = 
§c
->f⁄à? 
	`dü_f⁄t_ªf
(§c->f⁄tË: 
NULL
;

72 
de°
->
f⁄t_height
 = 
§c
->font_height;

73 
de°
->
Æignmít
 = 
§c
->alignment;

74 
	}
}

86 
gboﬁón


87 
	$_∑r£_cﬁ‹
(
göt32
 *
cﬁ‹
, c⁄° *
°r
)

89 i‡(
°r
[0] == '#')

90 *
cﬁ‹
 = 
	`°πﬁ
(
°r
+1, 
NULL
, 16) & 0xffffff;

91 i‡(0 =
	`°∫cmp
(
°r
, "none", 4))

92 *
cﬁ‹
 = 
DIA_SVG_COLOUR_NONE
;

93 i‡(0 =
	`°∫cmp
(
°r
, "foreground", 10) || 0 == strncmp(str, "fg", 2) ||

94 0 =
	`°∫cmp
(
°r
, "inverse", 7))

95 *
cﬁ‹
 = 
DIA_SVG_COLOUR_FOREGROUND
;

96 i‡(0 =
	`°∫cmp
(
°r
, "background", 10) || 0 == strncmp(str, "bg", 2) ||

97 0 =
	`°∫cmp
(
°r
, "default", 7))

98 *
cﬁ‹
 = 
DIA_SVG_COLOUR_BACKGROUND
;

99 i‡(0 =
	`°rcmp
(
°r
, "text"))

100 *
cﬁ‹
 = 
DIA_SVG_COLOUR_TEXT
;

101 i‡(0 =
	`°∫cmp
(
°r
, "rgb(", 4)) {

102 
r
 = 0, 
g
 = 0, 
b
 = 0;

103 i‡(3 =
	`ssˇnf
 (
°r
+4, "%d,%d,%d", &
r
, &
g
, &
b
))

104 *
cﬁ‹
 = ((
r
<<16Ë& 0xFF0000Ë| ((
g
<<8Ë& 0xFF00Ë| (
b
 & 0xFF);

106  
FALSE
;

109 
P™goCﬁ‹
 
pc
;

110 * 
£
 = 
	`°rchr
 (
°r
, ';');

112 i‡(!
£
) {

113 i‡(
	`∑ngo_cﬁ‹_∑r£
 (&
pc
, 
°r
))

114 *
cﬁ‹
 = ((
pc
.
ªd
 >> 8Ë<< 16Ë| (’c.
gªí
 >> 8Ë<< 8Ë| (pc.
blue
 >> 8);

116  
FALSE
;

118 
gch¨
* 
sz
 = 
	`g_°∫dup
 (
°r
, 
£
 - str);

119 
gboﬁón
 
ªt
 = 
	`∑ngo_cﬁ‹_∑r£
 (&
pc
, 
°r
);

121 i‡(
ªt
)

122 *
cﬁ‹
 = ((
pc
.
ªd
 >> 8Ë<< 16Ë| (’c.
gªí
 >> 8Ë<< 8Ë| (pc.
blue
 >> 8);

123 
	`g_‰ì
 (
sz
);

124  
ªt
;

127  
TRUE
;

128 
	}
}

132 
	mFONT_NAME_LENGTH_MAX
 = 40

144 
	$dü_svg_∑r£_°yÀ
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
s
, 
ªÆ
 
u£r_sˇÀ
)

146 
xmlCh¨
 *
°r
;

147 
gch¨
 
ãmp
[
FONT_NAME_LENGTH_MAX
+1];

148 
i
 = 0;

149 
gboﬁón
 
ovî
 = 
FALSE
;

150 *
Ámûy
 = 
NULL
, *
°yÀ
 = NULL, *
weight
 = NULL;

152 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"style");

154 i‡(
°r
) {

155 
gch¨
 *
±r
 = (gch¨ *)
°r
;

156 
±r
[0] != '\0') {

158 
±r
[0] !'\0' && 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

159 i‡(
±r
[0] == '\0') ;

161 i‡(!
	`°∫cmp
("f⁄t-Ámûy:", 
±r
, 12)) {

162 
±r
 += 12;

163 (
±r
[0] !'\0'Ë&& 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

164 
i
 = 0; 
ovî
 = 
FALSE
;

165 
±r
[0] !'\0' &&Öå[0] !';' && !
ovî
) {

166 i‡(
i
 < 
FONT_NAME_LENGTH_MAX
) {

167 
ãmp
[
i
] = 
±r
[0];

168 } 
ovî
 = 
TRUE
;

169 
i
++;

170 
±r
++;

172 
ãmp
[
i
] = '\0';

174 i‡(!
ovî
) {

175 i‡(
	`°rcmp
 (
ãmp
, "sanserif") == 0 || strcmp (temp, "sans-serif") == 0)

176 
Ámûy
 = 
	`g_°rdup
 ("sans");

178 
Ámûy
 = 
	`g_°rdup
(
ãmp
);

180 } i‡(!
	`°∫cmp
("f⁄t-weight:", 
±r
, 12)) {

181 
±r
 += 12;

182 (
±r
[0] !'\0'Ë&& 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

183 
i
 = 0; 
ovî
 = 
FALSE
;

184 
±r
[0] !'\0' &&Öå[0] !';' && !
ovî
) {

185 i‡(
i
 < 
FONT_NAME_LENGTH_MAX
) {

186 
ãmp
[
i
] = 
±r
[0];

187 } 
ovî
 = 
TRUE
;

188 
i
++;

189 
±r
++;

191 
ãmp
[
i
] = '\0';

193 i‡(!
ovî
Ë
weight
 = 
	`g_°rdup
(
ãmp
);

194 } i‡(!
	`°∫cmp
("f⁄t-°yÀ:", 
±r
, 11)) {

195 
±r
 += 11;

196 (
±r
[0] !'\0'Ë&& 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

197 
i
 = 0; 
ovî
 = 
FALSE
;

198 
±r
[0] !'\0' &&Öå[0] !';' && !
ovî
) {

199 i‡(
i
 < 
FONT_NAME_LENGTH_MAX
) {

200 
ãmp
[
i
] = 
±r
[0];

201 } 
ovî
 = 
TRUE
;

202 
i
++;

203 
±r
++;

205 
ãmp
[
i
] = '\0';

207 i‡(!
ovî
Ë
°yÀ
 = 
	`g_°rdup
(
ãmp
);

208 } i‡(!
	`°∫cmp
("f⁄t-size:", 
±r
, 10)) {

209 
±r
 += 10;

210 (
±r
[0] !'\0'Ë&& 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

211 
i
 = 0; 
ovî
 = 
FALSE
;

212 
±r
[0] !'\0' &&Öå[0] !';' && !
ovî
) {

213 i‡(
i
 < 
FONT_NAME_LENGTH_MAX
) {

214 
ãmp
[
i
] = 
±r
[0];

215 } 
ovî
 = 
TRUE
;

216 
i
++;

217 
±r
++;

219 
ãmp
[
i
] = '\0';

221 i‡(!
ovî
) {

222 
s
->
f⁄t_height
 = 
	`g_ascii_°πod
(
ãmp
, 
NULL
);

223 i‡(
u£r_sˇÀ
 > 0)

224 
s
->
f⁄t_height
 /
u£r_sˇÀ
;

226 } i‡(!
	`°∫cmp
("ãxt-™ch‹:", 
±r
, 12)) {

227 
±r
 += 12;

228 (
±r
[0] !'\0'Ë&& 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

229 i‡(!
	`°∫cmp
(
±r
, "start", 5))

230 
s
->
Æignmít
 = 
ALIGN_LEFT
;

231 i‡(!
	`°∫cmp
(
±r
, "end", 3))

232 
s
->
Æignmít
 = 
ALIGN_RIGHT
;

233 i‡(!
	`°∫cmp
(
±r
, "middle", 6))

234 
s
->
Æignmít
 = 
ALIGN_CENTER
;

236 } i‡(!
	`°∫cmp
("°roke-width:", 
±r
, 13)) {

237 
±r
 += 13;

238 
s
->
löe_width
 = 
	`g_ascii_°πod
(
±r
, &ptr);

239 i‡(
u£r_sˇÀ
 > 0)

240 
s
->
löe_width
 /
u£r_sˇÀ
;

241 } i‡(!
	`°∫cmp
("°roke:", 
±r
, 7)) {

242 
±r
 += 7;

243 (
±r
[0] !'\0'Ë&& 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

244 i‡(
±r
[0] == '\0') ;

246 
	`_∑r£_cﬁ‹
 (&
s
->
°roke
, 
±r
);

247 } i‡(!
	`°∫cmp
("fûl:", 
±r
, 5)) {

248 
±r
 += 5;

249 
±r
[0] !'\0' && 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

250 i‡(
±r
[0] == '\0') ;

252 
	`_∑r£_cﬁ‹
 (&
s
->
fûl
, 
±r
);

253 } i‡(!
	`°∫cmp
("°roke-löeˇp:", 
±r
, 15)) {

254 
±r
 += 15;

255 
±r
[0] !'\0' && 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

256 i‡(
±r
[0] == '\0') ;

258 i‡(!
	`°∫cmp
(
±r
, "butt", 4))

259 
s
->
löeˇp
 = 
LINECAPS_BUTT
;

260 i‡(!
	`°∫cmp
(
±r
, "round", 5))

261 
s
->
löeˇp
 = 
LINECAPS_ROUND
;

262 i‡(!
	`°∫cmp
(
±r
, "square", 6) || !strncmp(ptr, "projecting", 10))

263 
s
->
löeˇp
 = 
LINECAPS_PROJECTING
;

264 i‡(!
	`°∫cmp
(
±r
, "default", 7))

265 
s
->
löeˇp
 = 
DIA_SVG_LINECAPS_DEFAULT
;

266 } i‡(!
	`°∫cmp
("°roke-löejoö:", 
±r
, 16)) {

267 
±r
 += 16;

268 
±r
[0] !'\0' && 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

269 i‡(
±r
[0] == '\0') ;

271 i‡(!
	`°∫cmp
(
±r
, "miter", 5))

272 
s
->
löejoö
 = 
LINEJOIN_MITER
;

273 i‡(!
	`°∫cmp
(
±r
, "round", 5))

274 
s
->
löejoö
 = 
LINEJOIN_ROUND
;

275 i‡(!
	`°∫cmp
(
±r
, "bevel", 5))

276 
s
->
löejoö
 = 
LINEJOIN_BEVEL
;

277 i‡(!
	`°∫cmp
(
±r
, "default", 7))

278 
s
->
löejoö
 = 
DIA_SVG_LINEJOIN_DEFAULT
;

279 } i‡(!
	`°∫cmp
("°roke-∑âîn:", 
±r
, 15)) {

280 
±r
 += 15;

281 
±r
[0] !'\0' && 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

282 i‡(
±r
[0] == '\0') ;

284 i‡(!
	`°∫cmp
(
±r
, "solid", 5))

285 
s
->
löe°yÀ
 = 
LINESTYLE_SOLID
;

286 i‡(!
	`°∫cmp
(
±r
, "dashed", 6))

287 
s
->
löe°yÀ
 = 
LINESTYLE_DASHED
;

288 i‡(!
	`°∫cmp
(
±r
, "dash-dot", 8))

289 
s
->
löe°yÀ
 = 
LINESTYLE_DASH_DOT
;

290 i‡(!
	`°∫cmp
(
±r
, "dash-dot-dot", 12))

291 
s
->
löe°yÀ
 = 
LINESTYLE_DASH_DOT_DOT
;

292 i‡(!
	`°∫cmp
(
±r
, "dotted", 6))

293 
s
->
löe°yÀ
 = 
LINESTYLE_DOTTED
;

294 i‡(!
	`°∫cmp
(
±r
, "default", 7))

295 
s
->
löe°yÀ
 = 
DIA_SVG_LINESTYLE_DEFAULT
;

297 } i‡(!
	`°∫cmp
("°roke-dashÀngth:", 
±r
, 18)) {

298 
±r
 += 18;

299 
±r
[0] !'\0' && 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

300 i‡(
±r
[0] == '\0') ;

302 i‡(!
	`°∫cmp
(
±r
, "default", 7))

303 
s
->
dashÀngth
 = 1.0;

305 
s
->
dashÀngth
 = 
	`g_ascii_°πod
(
±r
, &ptr);

306 i‡(
u£r_sˇÀ
 > 0)

307 
s
->
dashÀngth
 /
u£r_sˇÀ
;

309 } i‡(!
	`°∫cmp
("°roke-dash¨øy:", 
±r
, 17)) {

314 
s
->
löe°yÀ
 = 
LINESTYLE_DASHED
;

315 
±r
 += 17;

316 
±r
[0] !'\0' && 
	`g_ascii_is•a˚
(ptr[0]))Ötr++;

317 i‡(
±r
[0] == '\0') ;

319 i‡(!
	`°∫cmp
(
±r
, "default", 7))

320 
s
->
dashÀngth
 = 1.0;

322 
s
->
dashÀngth
 = 
	`g_ascii_°πod
(
±r
, &ptr);

323 i‡(
u£r_sˇÀ
 > 0)

324 
s
->
dashÀngth
 /
u£r_sˇÀ
;

329 
±r
[0] != '\0' &&Ötr[0] != ';' &&Ötr[0] != '\n')Ötr++;

330 i‡(
±r
[0] != '\0')Ötr++;

332 
	`xmlFªe
(
°r
);

338 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"fill");

339 i‡(
°r
) {

340 
	`_∑r£_cﬁ‹
 (&
s
->
fûl
, (*Ë
°r
);

341 
	`xmlFªe
(
°r
);

343 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"stroke");

344 i‡(
°r
) {

345 
	`_∑r£_cﬁ‹
 (&
s
->
°roke
, (*Ë
°r
);

346 
	`xmlFªe
(
°r
);

348 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"stroke-width");

349 i‡(
°r
) {

350 
s
->
löe_width
 = 
	`g_ascii_°πod
((*Ë
°r
, 
NULL
);

351 
	`xmlFªe
(
°r
);

352 i‡(
u£r_sˇÀ
 > 0)

353 
s
->
löe_width
 /
u£r_sˇÀ
;

356 i‡(
Ámûy
 || 
°yÀ
 || 
weight
) {

357 i‡(
s
->
f⁄t
)

358 
	`dü_f⁄t_uƒef
 (
s
->
f⁄t
);

359 
s
->
f⁄t
 = 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_SANS
,s->
f⁄t_height
 );

360 i‡(
Ámûy
) {

361 
	`dü_f⁄t_£t_™y_Ámûy
(
s
->
f⁄t
,
Ámûy
);

362 
	`g_‰ì
(
Ámûy
);

364 i‡(
°yÀ
) {

365 
	`dü_f⁄t_£t_¶™t_‰om_°rög
(
s
->
f⁄t
,
°yÀ
);

366 
	`g_‰ì
(
°yÀ
);

368 i‡(
weight
) {

369 
	`dü_f⁄t_£t_weight_‰om_°rög
(
s
->
f⁄t
,
weight
);

370 
	`g_‰ì
(
weight
);

373 
	}
}

391 
	$_∑th_¨c_£gmít
(
GAºay
* 
poöts
,

392 
ªÆ
 
xc
,Ñó»
yc
,

393 
ªÆ
 
th0
,Ñó»
th1
,

394 
ªÆ
 
rx
,Ñó»
ry
,

395 
ªÆ
 
x_axis_rŸ©i⁄
,

396 
Poöt
 *
œ°_p2
)

398 
BezPoöt
 
bez
;

399 
ªÆ
 
sö_th
, 
cos_th
;

400 
ªÆ
 
a00
, 
a01
, 
a10
, 
a11
;

401 
ªÆ
 
x1
, 
y1
, 
x2
, 
y2
, 
x3
, 
y3
;

402 
ªÆ
 
t
;

403 
ªÆ
 
th_hÆf
;

405 
sö_th
 = 
	`sö
 (
x_axis_rŸ©i⁄
 * (
M_PI
 / 180.0));

406 
cos_th
 = 
	`cos
 (
x_axis_rŸ©i⁄
 * (
M_PI
 / 180.0));

408 
a00
 = 
cos_th
 * 
rx
;

409 
a01
 = -
sö_th
 * 
ry
;

410 
a10
 = 
sö_th
 * 
rx
;

411 
a11
 = 
cos_th
 * 
ry
;

413 
th_hÆf
 = 0.5 * (
th1
 - 
th0
);

414 
t
 = (8.0 / 3.0Ë* 
	`sö
(
th_hÆf
 * 0.5) * sin(th_half * 0.5) / sin(th_half);

415 
x1
 = 
xc
 + 
	`cos
 (
th0
Ë- 
t
 * 
	`sö
 (th0);

416 
y1
 = 
yc
 + 
	`sö
 (
th0
Ë+ 
t
 * 
	`cos
 (th0);

417 
x3
 = 
xc
 + 
	`cos
 (
th1
);

418 
y3
 = 
yc
 + 
	`sö
 (
th1
);

419 
x2
 = 
x3
 + 
t
 * 
	`sö
 (
th1
);

420 
y2
 = 
y3
 - 
t
 * 
	`cos
 (
th1
);

422 
bez
.
ty≥
 = 
BEZ_CURVE_TO
;

423 
bez
.
p1
.
x
 = 
a00
 * 
x1
 + 
a01
 * 
y1
;

424 
bez
.
p1
.
y
 = 
a10
 * 
x1
 + 
a11
 * 
y1
;

425 
bez
.
p2
.
x
 = 
a00
 * 
x2
 + 
a01
 * 
y2
;

426 
bez
.
p2
.
y
 = 
a10
 * 
x2
 + 
a11
 * 
y2
;

427 
bez
.
p3
.
x
 = 
a00
 * 
x3
 + 
a01
 * 
y3
;

428 
bez
.
p3
.
y
 = 
a10
 * 
x3
 + 
a11
 * 
y3
;

430 *
œ°_p2
 = 
bez
.
p2
;

432 
	`g_¨øy_≠≥nd_vÆ
(
poöts
, 
bez
);

433 
	}
}

450 
	$_∑th_¨c
(
GAºay
 *
poöts
, 
˝x
, 
˝y
,

451 
rx
, 
ry
, 
x_axis_rŸ©i⁄
,

452 
œrge_¨c_Êag
, 
swìp_Êag
,

453 
x
, 
y
,

454 
Poöt
 *
œ°_p2
)

456 
sö_th
, 
cos_th
;

457 
a00
, 
a01
, 
a10
, 
a11
;

458 
x0
, 
y0
, 
x1
, 
y1
, 
xc
, 
yc
;

459 
d
, 
sÁ˘‹
, 
sÁ˘‹_sq
;

460 
th0
, 
th1
, 
th_¨c
;

461 
px
, 
py
, 
∂
;

462 
i
, 
n_£gs
;

464 
sö_th
 = 
	`sö
 (
x_axis_rŸ©i⁄
 * (
M_PI
 / 180.0));

465 
cos_th
 = 
	`cos
 (
x_axis_rŸ©i⁄
 * (
M_PI
 / 180.0));

474 if(
rx
 < 0.0)Ñx = -rx;

475 if(
ry
 < 0.0)Ñy = -ry;

477 
px
 = 
cos_th
 * (
˝x
 - 
x
Ë* 0.5 + 
sö_th
 * (
˝y
 - 
y
) * 0.5;

478 
py
 = 
cos_th
 * (
˝y
 - 
y
Ë* 0.5 - 
sö_th
 * (
˝x
 - 
x
) * 0.5;

479 
∂
 = (
px
 *ÖxË/ (
rx
 *ÑxË+ (
py
 *ÖyË/ (
ry
 *Ñy);

481 if(
∂
 > 1.0)

483 
∂
 = 
	`sqπ
(pl);

484 
rx
 *
∂
;

485 
ry
 *
∂
;

490 
a00
 = 
cos_th
 / 
rx
;

491 
a01
 = 
sö_th
 / 
rx
;

492 
a10
 = -
sö_th
 / 
ry
;

493 
a11
 = 
cos_th
 / 
ry
;

494 
x0
 = 
a00
 * 
˝x
 + 
a01
 * 
˝y
;

495 
y0
 = 
a10
 * 
˝x
 + 
a11
 * 
˝y
;

496 
x1
 = 
a00
 * 
x
 + 
a01
 * 
y
;

497 
y1
 = 
a10
 * 
x
 + 
a11
 * 
y
;

503 
d
 = (
x1
 - 
x0
Ë* (x1 - x0Ë+ (
y1
 - 
y0
) * (y1 - y0);

504 
sÁ˘‹_sq
 = 1.0 / 
d
 - 0.25;

505 i‡(
sÁ˘‹_sq
 < 0) sfactor_sq = 0;

506 
sÁ˘‹
 = 
	`sqπ
 (
sÁ˘‹_sq
);

507 i‡(
swìp_Êag
 =
œrge_¨c_Êag
Ë
sÁ˘‹
 = -sfactor;

508 
xc
 = 0.5 * (
x0
 + 
x1
Ë- 
sÁ˘‹
 * (
y1
 - 
y0
);

509 
yc
 = 0.5 * (
y0
 + 
y1
Ë+ 
sÁ˘‹
 * (
x1
 - 
x0
);

512 
th0
 = 
	`©™2
 (
y0
 - 
yc
, 
x0
 - 
xc
);

513 
th1
 = 
	`©™2
 (
y1
 - 
yc
, 
x1
 - 
xc
);

515 
th_¨c
 = 
th1
 - 
th0
;

516 i‡(
th_¨c
 < 0 && 
swìp_Êag
)

517 
th_¨c
 +2 * 
M_PI
;

518 i‡(
th_¨c
 > 0 && !
swìp_Êag
)

519 
th_¨c
 -2 * 
M_PI
;

521 
n_£gs
 = (Ë
	`˚û
 (
	`Ábs
 (
th_¨c
 / (
M_PI
 * 0.5 + 0.001)));

523 
i
 = 0; i < 
n_£gs
; i++) {

524 
	`_∑th_¨c_£gmít
(
poöts
, 
xc
, 
yc
,

525 
th0
 + 
i
 * 
th_¨c
 / 
n_£gs
,

526 
th0
 + (
i
 + 1Ë* 
th_¨c
 / 
n_£gs
,

527 
rx
, 
ry
, 
x_axis_rŸ©i⁄
,

528 
œ°_p2
);

530 
	}
}

533 
	#∑th_chomp
(
∑th
Ë∑th[0]!='\0'&&
	`°rchr
(" \t\n\r,",Ö©h[0])Ë∑th++

	)

555 
GAºay
*

556 
	$dü_svg_∑r£_∑th
(c⁄° 
gch¨
 *
∑th_°r
, gch¨ **
u≈¨£d
, 
gboﬁón
 *
˛o£d
)

559 
PATH_MOVE
, 
PATH_LINE
, 
PATH_HLINE
, 
PATH_VLINE
, 
PATH_CURVE
,

560 
PATH_SMOOTHCURVE
, 
PATH_ARC
, 
PATH_CLOSE
 } 
œ°_ty≥
 = 
PATH_MOVE
;

561 
Poöt
 
œ°_›í
 = {0.0, 0.0};

562 
Poöt
 
œ°_poöt
 = {0.0, 0.0};

563 
Poöt
 
œ°_c⁄åﬁ
 = {0.0, 0.0};

564 
gboﬁón
 
œ°_ªœtive
 = 
FALSE
;

565 
GAºay
 *
poöts
;

566 
BezPoöt
 
bez
 = { 0, };

567 
gch¨
 *
∑th
 = (gch¨ *)
∑th_°r
;

568 
gboﬁón
 
√ed_√xt_ñemít
 = 
FALSE
;

570 *
˛o£d
 = 
FALSE
;

571 *
u≈¨£d
 = 
NULL
;

573 
poöts
 = 
	`g_¨øy_√w
(
FALSE
, FALSE, (
BezPoöt
));

574 
	`g_¨øy_£t_size
(
poöts
, 0);

576 
	`∑th_chomp
(
∑th
);

577 
∑th
[0] != '\0') {

578 #ifde‡
DEBUG_CUSTOM


579 
	`g_¥öt
("P©h: %s\n", 
∑th
);

582 
∑th
[0]) {

584 i‡(
poöts
->
Àn
 > 0) {

585 
√ed_√xt_ñemít
 = 
TRUE
;

586 
MORETOPARSE
;

588 
∑th
++;

589 
	`∑th_chomp
(
∑th
);

590 
œ°_ty≥
 = 
PATH_MOVE
;

591 
œ°_ªœtive
 = 
FALSE
;

594 i‡(
poöts
->
Àn
 > 0) {

595 
√ed_√xt_ñemít
 = 
TRUE
;

596 
MORETOPARSE
;

598 
∑th
++;

599 
	`∑th_chomp
(
∑th
);

600 
œ°_ty≥
 = 
PATH_MOVE
;

601 
œ°_ªœtive
 = 
TRUE
;

604 
∑th
++;

605 
	`∑th_chomp
(
∑th
);

606 
œ°_ty≥
 = 
PATH_LINE
;

607 
œ°_ªœtive
 = 
FALSE
;

610 
∑th
++;

611 
	`∑th_chomp
(
∑th
);

612 
œ°_ty≥
 = 
PATH_LINE
;

613 
œ°_ªœtive
 = 
TRUE
;

616 
∑th
++;

617 
	`∑th_chomp
(
∑th
);

618 
œ°_ty≥
 = 
PATH_HLINE
;

619 
œ°_ªœtive
 = 
FALSE
;

622 
∑th
++;

623 
	`∑th_chomp
(
∑th
);

624 
œ°_ty≥
 = 
PATH_HLINE
;

625 
œ°_ªœtive
 = 
TRUE
;

628 
∑th
++;

629 
	`∑th_chomp
(
∑th
);

630 
œ°_ty≥
 = 
PATH_VLINE
;

631 
œ°_ªœtive
 = 
FALSE
;

634 
∑th
++;

635 
	`∑th_chomp
(
∑th
);

636 
œ°_ty≥
 = 
PATH_VLINE
;

637 
œ°_ªœtive
 = 
TRUE
;

640 
∑th
++;

641 
	`∑th_chomp
(
∑th
);

642 
œ°_ty≥
 = 
PATH_CURVE
;

643 
œ°_ªœtive
 = 
FALSE
;

646 
∑th
++;

647 
	`∑th_chomp
(
∑th
);

648 
œ°_ty≥
 = 
PATH_CURVE
;

649 
œ°_ªœtive
 = 
TRUE
;

652 
∑th
++;

653 
	`∑th_chomp
(
∑th
);

654 
œ°_ty≥
 = 
PATH_SMOOTHCURVE
;

655 
œ°_ªœtive
 = 
FALSE
;

658 
∑th
++;

659 
	`∑th_chomp
(
∑th
);

660 
œ°_ty≥
 = 
PATH_SMOOTHCURVE
;

661 
œ°_ªœtive
 = 
TRUE
;

665 
∑th
++;

666 
	`∑th_chomp
(
∑th
);

667 
œ°_ty≥
 = 
PATH_CLOSE
;

668 
œ°_ªœtive
 = 
FALSE
;

671 
∑th
++;

672 
	`∑th_chomp
(
∑th
);

673 
œ°_ty≥
 = 
PATH_ARC
;

674 
œ°_ªœtive
 = 
FALSE
;

677 
∑th
++;

678 
	`∑th_chomp
(
∑th
);

679 
œ°_ty≥
 = 
PATH_ARC
;

680 
œ°_ªœtive
 = 
TRUE
;

695 i‡(
œ°_ty≥
 =
PATH_CLOSE
) {

696 
	`g_w¨nög
("parse_path:árgument given for implicite closeÖath");

698 
∑th
 !'\0' && 
	`°rchr
("0123456789.+-",Öath[0]))Öath++;

699 
	`∑th_chomp
(
∑th
);

700 *
˛o£d
 = 
TRUE
;

701 
√ed_√xt_ñemít
 = 
TRUE
;

702 
MORETOPARSE
;

706 
	`g_w¨nög
("unsuµ‹ãdÖ©h codê'%c'", 
∑th
[0]);

707 
∑th
++;

708 
	`∑th_chomp
(
∑th
);

713 
œ°_ty≥
) {

714 
PATH_MOVE
:

715 
bez
.
ty≥
 = 
BEZ_MOVE_TO
;

716 
bez
.
p1
.
x
 = 
	`g_ascii_°πod
(
∑th
, &path);

717 
	`∑th_chomp
(
∑th
);

718 
bez
.
p1
.
y
 = 
	`g_ascii_°πod
(
∑th
, &path);

719 
	`∑th_chomp
(
∑th
);

720 i‡(
œ°_ªœtive
) {

721 
bez
.
p1
.
x
 +
œ°_poöt
.x;

722 
bez
.
p1
.
y
 +
œ°_poöt
.y;

724 
œ°_poöt
 = 
bez
.
p1
;

725 
œ°_c⁄åﬁ
 = 
bez
.
p1
;

726 
œ°_›í
 = 
bez
.
p1
;

727 
	`g_¨øy_≠≥nd_vÆ
(
poöts
, 
bez
);

729 
PATH_LINE
:

730 
bez
.
ty≥
 = 
BEZ_LINE_TO
;

731 
bez
.
p1
.
x
 = 
	`g_ascii_°πod
(
∑th
, &path);

732 
	`∑th_chomp
(
∑th
);

733 
bez
.
p1
.
y
 = 
	`g_ascii_°πod
(
∑th
, &path);

734 
	`∑th_chomp
(
∑th
);

735 i‡(
œ°_ªœtive
) {

736 
bez
.
p1
.
x
 +
œ°_poöt
.x;

737 
bez
.
p1
.
y
 +
œ°_poöt
.y;

743 
	#INIT_LINE_TO_AS_CURVE_TO
 
bez
.
p3
 = bez.
p1
; bez.
p2
 = 
œ°_poöt


	)

745 
INIT_LINE_TO_AS_CURVE_TO
;

747 
œ°_poöt
 = 
bez
.
p1
;

748 
œ°_c⁄åﬁ
 = 
bez
.
p1
;

750 
	`g_¨øy_≠≥nd_vÆ
(
poöts
, 
bez
);

752 
PATH_HLINE
:

753 
bez
.
ty≥
 = 
BEZ_LINE_TO
;

754 
bez
.
p1
.
x
 = 
	`g_ascii_°πod
(
∑th
, &path);

755 
	`∑th_chomp
(
∑th
);

756 
bez
.
p1
.
y
 = 
œ°_poöt
.y;

757 i‡(
œ°_ªœtive
)

758 
bez
.
p1
.
x
 +
œ°_poöt
.x;

760 
INIT_LINE_TO_AS_CURVE_TO
;

762 
œ°_poöt
 = 
bez
.
p1
;

763 
œ°_c⁄åﬁ
 = 
bez
.
p1
;

765 
	`g_¨øy_≠≥nd_vÆ
(
poöts
, 
bez
);

767 
PATH_VLINE
:

768 
bez
.
ty≥
 = 
BEZ_LINE_TO
;

769 
bez
.
p1
.
x
 = 
œ°_poöt
.x;

770 
bez
.
p1
.
y
 = 
	`g_ascii_°πod
(
∑th
, &path);

771 
	`∑th_chomp
(
∑th
);

772 i‡(
œ°_ªœtive
)

773 
bez
.
p1
.
y
 +
œ°_poöt
.y;

775 
INIT_LINE_TO_AS_CURVE_TO
;

777 #unde‡
INIT_LINE_TO_AS_CURVE_TO


779 
œ°_poöt
 = 
bez
.
p1
;

780 
œ°_c⁄åﬁ
 = 
bez
.
p1
;

782 
	`g_¨øy_≠≥nd_vÆ
(
poöts
, 
bez
);

784 
PATH_CURVE
:

785 
bez
.
ty≥
 = 
BEZ_CURVE_TO
;

786 
bez
.
p1
.
x
 = 
	`g_ascii_°πod
(
∑th
, &path);

787 
	`∑th_chomp
(
∑th
);

788 
bez
.
p1
.
y
 = 
	`g_ascii_°πod
(
∑th
, &path);

789 
	`∑th_chomp
(
∑th
);

790 
bez
.
p2
.
x
 = 
	`g_ascii_°πod
(
∑th
, &path);

791 
	`∑th_chomp
(
∑th
);

792 
bez
.
p2
.
y
 = 
	`g_ascii_°πod
(
∑th
, &path);

793 
	`∑th_chomp
(
∑th
);

794 
bez
.
p3
.
x
 = 
	`g_ascii_°πod
(
∑th
, &path);

795 
	`∑th_chomp
(
∑th
);

796 
bez
.
p3
.
y
 = 
	`g_ascii_°πod
(
∑th
, &path);

797 
	`∑th_chomp
(
∑th
);

798 i‡(
œ°_ªœtive
) {

799 
bez
.
p1
.
x
 +
œ°_poöt
.x;

800 
bez
.
p1
.
y
 +
œ°_poöt
.y;

801 
bez
.
p2
.
x
 +
œ°_poöt
.x;

802 
bez
.
p2
.
y
 +
œ°_poöt
.y;

803 
bez
.
p3
.
x
 +
œ°_poöt
.x;

804 
bez
.
p3
.
y
 +
œ°_poöt
.y;

806 
œ°_poöt
 = 
bez
.
p3
;

807 
œ°_c⁄åﬁ
 = 
bez
.
p2
;

809 
	`g_¨øy_≠≥nd_vÆ
(
poöts
, 
bez
);

811 
PATH_SMOOTHCURVE
:

812 
bez
.
ty≥
 = 
BEZ_CURVE_TO
;

813 
bez
.
p1
.
x
 = 2 * 
œ°_poöt
.x - 
œ°_c⁄åﬁ
.x;

814 
bez
.
p1
.
y
 = 2 * 
œ°_poöt
.y - 
œ°_c⁄åﬁ
.y;

815 
bez
.
p2
.
x
 = 
	`g_ascii_°πod
(
∑th
, &path);

816 
	`∑th_chomp
(
∑th
);

817 
bez
.
p2
.
y
 = 
	`g_ascii_°πod
(
∑th
, &path);

818 
	`∑th_chomp
(
∑th
);

819 
bez
.
p3
.
x
 = 
	`g_ascii_°πod
(
∑th
, &path);

820 
	`∑th_chomp
(
∑th
);

821 
bez
.
p3
.
y
 = 
	`g_ascii_°πod
(
∑th
, &path);

822 
	`∑th_chomp
(
∑th
);

823 i‡(
œ°_ªœtive
) {

824 
bez
.
p2
.
x
 +
œ°_poöt
.x;

825 
bez
.
p2
.
y
 +
œ°_poöt
.y;

826 
bez
.
p3
.
x
 +
œ°_poöt
.x;

827 
bez
.
p3
.
y
 +
œ°_poöt
.y;

829 
œ°_poöt
 = 
bez
.
p3
;

830 
œ°_c⁄åﬁ
 = 
bez
.
p2
;

832 
	`g_¨øy_≠≥nd_vÆ
(
poöts
, 
bez
);

834 
PATH_ARC
 :

836 
ªÆ
 
rx
, 
ry
;

837 
ªÆ
 
xrŸ
;

838 
œrgórc
, 
swìp
;

839 
Poöt
 
de°
, 
de°_c
;

840 
de°_c
.
x
=0;

841 
de°_c
.
y
=0;

843 
rx
 = 
	`g_ascii_°πod
(
∑th
, &path);

844 
	`∑th_chomp
(
∑th
);

845 
ry
 = 
	`g_ascii_°πod
(
∑th
, &path);

846 
	`∑th_chomp
(
∑th
);

847 
xrŸ
 = 
	`g_ascii_°πod
(
∑th
, &path);

848 
	`∑th_chomp
(
∑th
);

850 
œrgórc
 = ()
	`g_ascii_°πod
(
∑th
, &path);

851 
	`∑th_chomp
(
∑th
);

852 
swìp
 = ()
	`g_ascii_°πod
(
∑th
, &path);

853 
	`∑th_chomp
(
∑th
);

855 
de°
.
x
 = 
	`g_ascii_°πod
(
∑th
, &path);

856 
	`∑th_chomp
(
∑th
);

857 
de°
.
y
 = 
	`g_ascii_°πod
(
∑th
, &path);

858 
	`∑th_chomp
(
∑th
);

860 i‡(
œ°_ªœtive
) {

861 
de°
.
x
 +
œ°_poöt
.x;

862 
de°
.
y
 +
œ°_poöt
.y;

865 
	`_∑th_¨c
 (
poöts
, 
œ°_poöt
.
x
,Üa°_poöt.
y
,

866 
rx
, 
ry
, 
xrŸ
, 
œrgórc
, 
swìp
, 
de°
.
x
, de°.
y
,

867 &
de°_c
);

868 
œ°_poöt
 = 
de°
;

869 
œ°_c⁄åﬁ
 = 
de°_c
;

872 
PATH_CLOSE
:

874 i‡(
œ°_›í
.
x
 !
œ°_poöt
.x ||Üa°_›í.
y
 !=Üast_point.y) {

875 
bez
.
ty≥
 = 
BEZ_LINE_TO
;

876 
bez
.
p1
 = 
œ°_›í
;

877 
	`g_¨øy_≠≥nd_vÆ
(
poöts
, 
bez
);

879 *
˛o£d
 = 
TRUE
;

880 
√ed_√xt_ñemít
 = 
TRUE
;

883 
	`∑th_chomp
(
∑th
);

884 
MORETOPARSE
:

885 i‡(
√ed_√xt_ñemít
) {

887 i‡(
∑th
[0] != 0)

888 *
u≈¨£d
 = 
∑th
;

897 i‡(
poöts
->
Àn
 < 2) {

898 
	`g_¨øy_£t_size
(
poöts
, 0);

900  
poöts
;

901 
	}
}

	@O:\tool\dvs50\lib\dia_svg.h

19 #i‚de‡
DIA_SVG_H


20 
	#DIA_SVG_H


	)

22 
	~"dü_xml.h
"

23 
	~"f⁄t.h
"

26 
	eDüSvgCﬁours


28 
	mDIA_SVG_COLOUR_NONE
 = -1,

29 
	mDIA_SVG_COLOUR_FOREGROUND
 = -2,

30 
	mDIA_SVG_COLOUR_BACKGROUND
 = -3,

31 
	mDIA_SVG_COLOUR_TEXT
 = -4

35 
	eDüSvgLöeDeÁu…s


37 
	mDIA_SVG_LINECAPS_DEFAULT
 = 20,

38 
	mDIA_SVG_LINEJOIN_DEFAULT
 = 20,

39 
	mDIA_SVG_LINESTYLE_DEFAULT
 = 20

42 
_DüSvgStyÀ
 
	tDüSvgStyÀ
;

43 
	s_DüSvgStyÀ
 {

44 
ªÆ
 
	mlöe_width
;

45 
göt32
 
	m°roke
;

46 
göt32
 
	mfûl
;

48 
LöeC≠s
 
	mlöeˇp
;

49 
LöeJoö
 
	mlöejoö
;

50 
LöeStyÀ
 
	mlöe°yÀ
;

51 
ªÆ
 
	mdashÀngth
;

53 
DüF⁄t
 *
	mf⁄t
;

54 
ªÆ
 
	mf⁄t_height
;

55 
Alignmít
 
	mÆignmít
;

58 
DIAVAR
 
dü_svg_°yÀ_öô
 (
DüSvgStyÀ
 *
gs
, DüSvgStyÀ *
∑ª¡_°yÀ
);

59 
DIAVAR
 
dü_svg_°yÀ_c›y
 (
DüSvgStyÀ
 *
de°
, DüSvgStyÀ *
§c
);

60 
DIAVAR
 
dü_svg_∑r£_°yÀ
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
s
, 
ªÆ
 
u£r_sˇÀ
);

62 
DIAVAR
 
GAºay
* 
dü_svg_∑r£_∑th
(c⁄° 
gch¨
 *
∑th_°r
, gch¨ **
u≈¨£d
, 
gboﬁón
 *
˛o£d
);

	@O:\tool\dvs50\lib\dia_xml.c

19 
	~<c⁄fig.h
>

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<°rög.h
>

24 
	~<m©h.h
>

25 
	~<f˙é.h
>

27 
	~<glib.h
>

28 
	~<glib/g°dio.h
>

30 
	~<libxml/∑r£r.h
>

31 
	~<libxml/∑r£rI¡î«ls.h
>

32 
	~<libxml/xmlmem‹y.h
>

34 #ifde‡
HAVE_UNISTD_H


35 
	~<uni°d.h
>

38 
	~<zlib.h
>

40 
	~"öé.h
"

41 
	~"utûs.h
"

42 
	~"dü_xml_libxml.h
"

43 
	~"dü_xml.h
"

44 
	~"geomëry.h
"

45 
	~"mesßge.h
"

47 #ifde‡
G_OS_WIN32


48 
	~<io.h
>

51 #ifde‡
G_OS_WIN32


52 
	~<Êﬂt.h
>

53 #i‚de‡
isöf


54 
	#isöf
(
a
Ë(!
	`_föôe
◊))

	)

58 
	#BUFLEN
 1024

	)

65 #i‚de‡
i¢™


66 
	#i¢™
(
x
) \

67 ( (
x
Ë= (Ë? 
	`i¢™_ld
 (x) \

68 :  (
x
Ë= (Ë? 
	`i¢™_d
 (x) \

69 : 
	`i¢™_f
 (
x
))

	)

70 
ölöe
 
	$i¢™_f
 (
x
Ë{  x !x; 
	}
}

71 
ölöe
 
	$i¢™_d
 (
x
Ë{  x !x; 
	}
}

72 
ölöe
 
	$i¢™_ld
 (
x
Ë{  x !x; 
	}
}

75 #i‚de‡
isöf


76 
	#isöf
(
x
) \

77 ( (
x
Ë= (Ë? 
	`isöf_ld
 (x) \

78 :  (
x
Ë= (Ë? 
	`isöf_d
 (x) \

79 : 
	`isöf_f
 (
x
))

	)

80 
ölöe
 
	$isöf_f
 (
x
Ë{  
	`i¢™
 (x - x); 
	}
}

81 
ölöe
 
	$isöf_d
 (
x
Ë{  
	`i¢™
 (x - x); 
	}
}

82 
ölöe
 
	$isöf_ld
 (
x
Ë{  
	`i¢™
 (x - x); 
	}
}

104 c⁄° 
gch¨
 *

105 
	$xml_fûe_check_ícodög
(c⁄° 
gch¨
 *
fûíame
, c⁄° gch¨ *
deÁu…_íc
)

107 
fd
 = 
	`g_›í
 (
fûíame
, 
O_RDONLY
, 0);

108 
gzFûe
 
zf
 = 
	`gzd›í
(
fd
,"rb");

109 
gch¨
 *
buf
;

110 
gch¨
 *
p
,*
pmax
;

111 
Àn
;

112 
gch¨
 *
tmp
,*
ªs
;

113 
uf
;

114 
gboﬁón
 
wñl_f‹med_utf8
;

116 
magic_xml
[] =

119 i‡(!
zf
) {

120 
	`dü_log_mesßge
("%†ˇ¿nŸ bê›íed f‹Éncodög check (%s)", 
fûíame
, 
fd
 > 0 ? "gzdopen" : "g_open");

122  
fûíame
;

124 
p
 = 
buf
 = 
	`g_mÆloc0
(
BUFLEN
);

125 
Àn
 = 
	`gzªad
(
zf
,
buf
,
BUFLEN
);

126 
pmax
 = 
p
 + 
Àn
;

129 i‡((0 !
	`°∫cmp
(
p
,
magic_xml
,5)Ë|| (
Àn
 < 5)) {

130 
	`gz˛o£
(
zf
);

131 
	`g_‰ì
(
buf
);

132  
fûíame
;

135 
p
 += 5;

136 ((*
p
 == 0x20)||(*p == 0x09)||(*p == 0x0d)||(*p == 0x0a))

137 && (
p
<
pmax
))Ö++;

138 i‡(
p
>=
pmax
) {

139 
	`gz˛o£
(
zf
);

140 
	`g_‰ì
(
buf
);

141  
fûíame
;

143 i‡(0 !
	`°∫cmp
(
p
,"version=\"",9)) {

144 
	`gz˛o£
(
zf
);

145 
	`g_‰ì
(
buf
);

146  
fûíame
;

148 
p
 += 9;

150 i‡(
p
>=
pmax
) {

151 
	`gz˛o£
(
zf
);

152 
	`g_‰ì
(
buf
);

153  
fûíame
;

155 (*
p
 !'"'Ë&& (∞< 
pmax
))Ö++;

156 
p
++;

157 ((*
p
 == 0x20)||(*p == 0x09)||(*p == 0x0d)||(*p == 0x0a))

158 && (
p
<
pmax
))Ö++;

159 i‡(
p
>=
pmax
) {

160 
	`gz˛o£
(
zf
);

161 
	`g_‰ì
(
buf
);

162  
fûíame
;

164 i‡(0 =
	`°∫cmp
(
p
,"encoding=\"",10)) {

165 
	`gz˛o£
(
zf
);

166 
	`g_‰ì
(
buf
);

167  
fûíame
;

172 
wñl_f‹med_utf8
 = 
TRUE
;

174 
i
;

175 
i
 = 0; i < 
Àn
; i++)

176 i‡(
buf
[
i
] & 0x80 || buf[i] == '&')

177 
wñl_f‹med_utf8
 = 
FALSE
;

178 
Àn
 = 
	`gzªad
(
zf
,
buf
,
BUFLEN
);

179 } 
Àn
 > 0 && 
wñl_f‹med_utf8
);

180 i‡(
wñl_f‹med_utf8
) {

181 
	`gz˛o£
(
zf
);

182 
	`g_‰ì
(
buf
);

183  
fûíame
;

185 
	`gz˛o£
(
zf
);

186 
fd
 = 
	`g_›í
 (
fûíame
, 
O_RDONLY
, 0);

187 
zf
 = 
	`gzd›í
(
fd
,"rb");

188 
Àn
 = 
	`gzªad
(
zf
,
buf
,
BUFLEN
);

191 i‡(0 !
	`°rcmp
(
deÁu…_íc
,"UTF-8")) {

192 
	`mesßge_w¨nög
(
	`_
("The file %s hasÇoÉncoding specification;\n"

194 
	`dü_mesßge_fûíame
(
fûíame
), 
deÁu…_íc
);

196 
	`gz˛o£
(
zf
);

197 
	`g_‰ì
(
buf
);

198  
fûíame
;

201 
tmp
 = 
	`gëív
("TMP");

202 i‡(!
tmp
Ëtm∞
	`gëív
("TEMP");

203 i‡(!
tmp
)Åmp = "/tmp";

205 
ªs
 = 
	`g_°rc⁄ˇt
(
tmp
,
G_DIR_SEPARATOR_S
,"dü-xml-fix-ícodögXXXXXX",
NULL
);

206 
uf
 = 
	`g_mk°emp
(
ªs
);

207 
	`wrôe
(
uf
,
buf
,
p
-buf);

208 
	`wrôe
(
uf
,"Éncoding=\"",11);

209 
	`wrôe
(
uf
,
deÁu…_íc
,
	`°æí
(default_enc));

210 
	`wrôe
(
uf
,"\" ",2);

211 
	`wrôe
(
uf
,
p
,
pmax
 -Ö);

214 
Àn
 = 
	`gzªad
(
zf
,
buf
,
BUFLEN
);

215 i‡(
Àn
 <= 0) ;

216 
	`wrôe
(
uf
,
buf
,
Àn
);

218 
	`gz˛o£
(
zf
);

219 
	`˛o£
(
uf
);

220 
	`g_‰ì
(
buf
);

221  
ªs
;

222 
	}
}

229 
xmlDocPå


230 
	$xmlDüP¨£Fûe
(c⁄° *
fûíame
)

232 
G_CONST_RETURN
 *
loˇl_ch¨£t
 = 
NULL
;

234 i‡–!
	`g_gë_ch¨£t
(&
loˇl_ch¨£t
)

235 && 
loˇl_ch¨£t
) {

237 c⁄° 
gch¨
 *
‚ame
 = 
	`xml_fûe_check_ícodög
(
fûíame
,
loˇl_ch¨£t
);

238 i‡(
‚ame
 !
fûíame
) {

240 
xmlDocPå
 
ªt
 = 
	`xmlDoP¨£Fûe
(
‚ame
);

241 
	`u∆ök
(
‚ame
);

243 
	`g_‰ì
((*)
‚ame
);

244  
ªt
;

248  
	`xmlDoP¨£Fûe
(
fûíame
);

251  
	`xmlDoP¨£Fûe
(
fûíame
);

253 
	}
}

259 
xmlDocPå


260 
	$xmlDoP¨£Fûe
(c⁄° *
fûíame
)

262  
	`xmlP¨£Fûe
(
fûíame
);

263 
	}
}

272 
AâribuãNode


273 
	$obje˘_föd_©åibuã
(
Obje˘Node
 
obj_node
,

274 c⁄° *
©å«me
)

276 
AâribuãNode
 
©å
;

277 
xmlCh¨
 *
«me
;

279 
obj_node
 && 
	`xmlIsBœnkNode
(obj_node))

280 
obj_node
 = obj_node->
√xt
;

281 i‡(!
obj_node
Ë 
NULL
;

283 
©å
 = 
obj_node
->
xmlChûdªnNode
;

284 
©å
 !
NULL
) {

285 i‡(
	`xmlIsBœnkNode
(
©å
)) {

286 
©å
 =áâr->
√xt
;

290 
«me
 = 
	`xmlGëPr›
(
©å
, (c⁄° 
xmlCh¨
 *)"name");

291 i‡–(
«me
!=
NULL
Ë&& (
	`°rcmp
((*Ë«me, 
©å«me
)==0) ) {

292 
	`xmlFªe
(
«me
);

293  
©å
;

295 i‡(
«me
Ë
	`xmlFªe
(name);

297 
©å
 =áâr->
√xt
;

299  
NULL
;

300 
	}
}

309 
AâribuãNode


310 
	$composôe_föd_©åibuã
(
D©aNode
 
composôe_node
,

311 c⁄° *
©å«me
)

313 
AâribuãNode
 
©å
;

314 
xmlCh¨
 *
«me
;

316 
composôe_node
 && 
	`xmlIsBœnkNode
(composite_node))

317 
composôe_node
 = composôe_node->
√xt
;

318 i‡(!
composôe_node
Ë 
NULL
;

320 
©å
 = 
composôe_node
->
xmlChûdªnNode
;

321 
©å
 !
NULL
) {

322 i‡(
	`xmlIsBœnkNode
(
©å
)) {

323 
©å
 =áâr->
√xt
;

327 
«me
 = 
	`xmlGëPr›
(
©å
, (c⁄° 
xmlCh¨
 *)"name");

328 i‡–(
«me
!=
NULL
Ë&& (
	`°rcmp
((*Ë«me, 
©å«me
)==0) ) {

329 
	`xmlFªe
(
«me
);

330  
©å
;

332 i‡(
«me
Ë
	`xmlFªe
(name);

334 
©å
 =áâr->
√xt
;

336  
NULL
;

337 
	}
}

344 
	$©åibuã_num_d©a
(
AâribuãNode
 
©åibuã
)

346 
xmlNode
 *
d©a
;

347 
ƒ
=0;

349 
d©a
 = 
©åibuã
 ?áâribuã->
xmlChûdªnNode
 : 
NULL
;

350 
d©a
 !
NULL
) {

351 i‡(
	`xmlIsBœnkNode
(
d©a
)) {

352 
d©a
 = d©a->
√xt
;

355 
ƒ
++;

356 
d©a
 = d©a->
√xt
;

358  
ƒ
;

359 
	}
}

365 
D©aNode


366 
	$©åibuã_fú°_d©a
(
AâribuãNode
 
©åibuã
)

368 
xmlNode
 *
d©a
 = 
©åibuã
 ?áâribuã->
xmlChûdªnNode
 : 
NULL
;

369 
d©a
 && 
	`xmlIsBœnkNode
(d©a)Ëd©®d©a->
√xt
;

370  (
D©aNode
Ë
d©a
;

371 
	}
}

377 
D©aNode


378 
	$d©a_√xt
(
D©aNode
 
d©a
)

381 i‡(
d©a
) {

382 
d©a
 = d©a->
√xt
;

383 
d©a
 && 
	`xmlIsBœnkNode
(d©a)Ëd©®d©a->
√xt
;

385  (
D©aNode
Ë
d©a
;

386 
	}
}

397 
D©aTy≥


398 
	$d©a_ty≥
(
D©aNode
 
d©a
)

400 c⁄° *
«me
;

402 
«me
 = 
d©a
 ? (const *)data->name : (const *)"";

403 i‡(
	`°rcmp
(
«me
, "composite")==0) {

404  
DATATYPE_COMPOSITE
;

405 } i‡(
	`°rcmp
(
«me
, "int")==0) {

406  
DATATYPE_INT
;

407 } i‡(
	`°rcmp
(
«me
, "enum")==0) {

408  
DATATYPE_ENUM
;

409 } i‡(
	`°rcmp
(
«me
, "real")==0) {

410  
DATATYPE_REAL
;

411 } i‡(
	`°rcmp
(
«me
, "boolean")==0) {

412  
DATATYPE_BOOLEAN
;

413 } i‡(
	`°rcmp
(
«me
, "color")==0) {

414  
DATATYPE_COLOR
;

415 } i‡(
	`°rcmp
(
«me
, "point")==0) {

416  
DATATYPE_POINT
;

417 } i‡(
	`°rcmp
(
«me
, "rectangle")==0) {

418  
DATATYPE_RECTANGLE
;

419 } i‡(
	`°rcmp
(
«me
, "string")==0) {

420  
DATATYPE_STRING
;

421 } i‡(
	`°rcmp
(
«me
, "font")==0) {

422  
DATATYPE_FONT
;

423 } i‡(
	`°rcmp
(
«me
, "bezpoint")==0) {

424  
DATATYPE_BEZPOINT
;

425 } i‡(
	`°rcmp
(
«me
, "dict")==0) {

426  
DATATYPE_DICT
;

429 
	`mesßge_îr‹
("UnknownÅype of DataNode");

431 
	}
}

439 
	$d©a_öt
(
D©aNode
 
d©a
)

441 
xmlCh¨
 *
vÆ
;

442 
ªs
;

444 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_INT
) {

445 
	`mesßge_îr‹
("Taking int value ofÇon-intÇode.");

449 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"val");

450 
ªs
 = 
	`©oi
((*Ë
vÆ
);

451 i‡(
vÆ
Ë
	`xmlFªe
(val);

453  
ªs
;

454 
	}
}

461 
	$d©a_íum
(
D©aNode
 
d©a
)

463 
xmlCh¨
 *
vÆ
;

464 
ªs
;

466 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_ENUM
) {

467 
	`mesßge_îr‹
("TakingÉnum value ofÇon-enumÇode.");

471 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"val");

472 
ªs
 = 
	`©oi
((*Ë
vÆ
);

473 i‡(
vÆ
Ë
	`xmlFªe
(val);

475  
ªs
;

476 
	}
}

483 
ªÆ


484 
	$d©a_ªÆ
(
D©aNode
 
d©a
)

486 
xmlCh¨
 *
vÆ
;

487 
ªÆ
 
ªs
;

489 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_REAL
) {

490 
	`mesßge_îr‹
("TakingÑeal value ofÇon-realÇode.");

494 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"val");

495 
ªs
 = 
	`g_ascii_°πod
((*Ë
vÆ
, 
NULL
);

496 i‡(
vÆ
Ë
	`xmlFªe
(val);

498  
ªs
;

499 
	}
}

507 
	$d©a_boﬁón
(
D©aNode
 
d©a
)

509 
xmlCh¨
 *
vÆ
;

510 
ªs
;

512 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_BOOLEAN
) {

513 
	`mesßge_îr‹
("Taking boolean value ofÇon-booleanÇode.");

517 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"val");

519 i‡((
vÆ
Ë&& (
	`°rcmp
((*) val, "true")==0))

520 
ªs
 = 
TRUE
;

522 
ªs
 = 
FALSE
;

524 i‡(
vÆ
Ë
	`xmlFªe
(val);

526  
ªs
;

527 
	}
}

535 
	$hex_digô
(
c
)

537 i‡((
c
>='0') && (c<='9'))

538  
c
-'0';

539 i‡((
c
>='a') && (c<='f'))

540  (
c
-'a') + 10;

541 i‡((
c
>='A') && (c<='F'))

542  (
c
-'A') + 10;

543 
	`mesßge_îr‹
("wr⁄g hex digô %c", 
c
);

545 
	}
}

555 
	$d©a_cﬁ‹
(
D©aNode
 
d©a
, 
Cﬁ‹
 *
cﬁ
)

557 
xmlCh¨
 *
vÆ
;

558 
r
=0, 
g
=0, 
b
=0;

560 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_COLOR
) {

561 
	`mesßge_îr‹
("Taking color value ofÇon-colorÇode.");

565 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"val");

570 i‡((
vÆ
Ë&& (
	`xmlSåÀn
(val)>=7)) {

571 
r
 = 
	`hex_digô
(
vÆ
[1])*16 + hex_digit(val[2]);

572 
g
 = 
	`hex_digô
(
vÆ
[3])*16 + hex_digit(val[4]);

573 
b
 = 
	`hex_digô
(
vÆ
[5])*16 + hex_digit(val[6]);

576 i‡(
vÆ
Ë
	`xmlFªe
(val);

578 
cﬁ
->
ªd
 = ()(
r
/255.0);

579 
cﬁ
->
gªí
 = ()(
g
/255.0);

580 
cﬁ
->
blue
 = ()(
b
/255.0);

581 
	}
}

590 
	$d©a_poöt
(
D©aNode
 
d©a
, 
Poöt
 *
poöt
)

592 
xmlCh¨
 *
vÆ
;

593 
gch¨
 *
°r
;

594 
ªÆ
 
ax
,
ay
;

596 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_POINT
) {

597 
	`mesßge_îr‹
(
	`_
("TakingÖoint value ofÇon-pointÇode."));

601 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"val");

602 
poöt
->
x
 = 
	`g_ascii_°πod
((*)
vÆ
, &
°r
);

603 
ax
 = 
	`Ábs
(
poöt
->
x
);

604 i‡((
ax
 > 1e9Ë|| (◊x < 1e-9Ë&& (ax !0.0)Ë|| 
	`i¢™
◊xË|| 
	`isöf
(ax)) {

607 i‡(!(
ax
 < 1e-9))

608 
	`g_w¨nög
(
	`_
("Inc‹ª˘ x PoöàvÆuê\"%s\" %f; disˇrdög it."),
vÆ
,
poöt
->
x
);

609 
poöt
->
x
 = 0.0;

611 (*
°r
 != ',') && (*str!=0))

612 
°r
++;

613 i‡(*
°r
==0){

614 
poöt
->
y
 = 0.0;

615 
	`g_w¨nög
(
	`_
("ErrorÖarsingÖoint."));

616 
	`xmlFªe
(
vÆ
);

619 
poöt
->
y
 = 
	`g_ascii_°πod
(
°r
+1, 
NULL
);

620 
ay
 = 
	`Ábs
(
poöt
->
y
);

621 i‡((
ay
 > 1e9Ë|| (◊y < 1e-9Ë&& (ay !0.0)Ë|| 
	`i¢™
◊yË|| 
	`isöf
(ay)) {

622 i‡(!(
ay
 < 1e-9))

623 
	`g_w¨nög
(
	`_
("Inc‹ª˘ y PoöàvÆuê\"%s\" %f; disˇrdög it."),
°r
+1,
poöt
->
y
);

624 
poöt
->
y
 = 0.0;

626 
	`xmlFªe
(
vÆ
);

627 
	}
}

635 
	$d©a_bezpoöt
(
D©aNode
 
d©a
, 
BezPoöt
 *
poöt
)

637 
xmlCh¨
 *
vÆ
;

638 
gch¨
 *
°r
;

639 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_BEZPOINT
) {

640 
	`mesßge_îr‹
(
	`_
("Taking bezpoint value ofÇon-pointÇode."));

643 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"type");

644 i‡(
vÆ
) {

645 i‡(
	`°rcmp
((*)
vÆ
, "moveto") == 0)

646 
poöt
->
ty≥
 = 
BEZ_MOVE_TO
;

647 i‡(
	`°rcmp
((*)
vÆ
, "lineto") == 0)

648 
poöt
->
ty≥
 = 
BEZ_LINE_TO
;

650 
poöt
->
ty≥
 = 
BEZ_CURVE_TO
;

651 
	`xmlFªe
(
vÆ
);

653 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"p1");

654 i‡(
vÆ
) {

655 
poöt
->
p1
.
x
 = 
	`g_ascii_°πod
((*)
vÆ
, &
°r
);

656 i‡(*
°r
==0) {

657 
poöt
->
p1
.
y
 = 0;

658 
	`g_w¨nög
(
	`_
("ErrorÖarsing bezpointÖ1."));

660 
poöt
->
p1
.
y
 = 
	`g_ascii_°πod
(
°r
+1, 
NULL
);

662 
	`xmlFªe
(
vÆ
);

664 
poöt
->
p1
.
x
 = 0;

665 
poöt
->
p1
.
y
 = 0;

667 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"p2");

668 i‡(
vÆ
) {

669 
poöt
->
p2
.
x
 = 
	`g_ascii_°πod
((*)
vÆ
, &
°r
);

670 i‡(*
°r
==0) {

671 
poöt
->
p2
.
y
 = 0;

672 
	`g_w¨nög
(
	`_
("ErrorÖarsing bezpointÖ2."));

674 
poöt
->
p2
.
y
 = 
	`g_ascii_°πod
(
°r
+1, 
NULL
);

676 
	`xmlFªe
(
vÆ
);

678 
poöt
->
p2
.
x
 = 0;

679 
poöt
->
p2
.
y
 = 0;

681 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"p3");

682 i‡(
vÆ
) {

683 
poöt
->
p3
.
x
 = 
	`g_ascii_°πod
((*)
vÆ
, &
°r
);

684 i‡(*
°r
==0) {

685 
poöt
->
p3
.
y
 = 0;

686 
	`g_w¨nög
(
	`_
("ErrorÖarsing bezpointÖ3."));

688 
poöt
->
p3
.
y
 = 
	`g_ascii_°πod
(
°r
+1, 
NULL
);

690 
	`xmlFªe
(
vÆ
);

692 
poöt
->
p3
.
x
 = 0;

693 
poöt
->
p3
.
y
 = 0;

695 
	}
}

704 
	$d©a_ª˘™gÀ
(
D©aNode
 
d©a
, 
Re˘™gÀ
 *
ª˘
)

706 
xmlCh¨
 *
vÆ
;

707 
gch¨
 *
°r
;

709 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_RECTANGLE
) {

710 
	`mesßge_îr‹
("TakingÑectangle value ofÇon-rectangleÇode.");

714 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"val");

716 
ª˘
->
À·
 = 
	`g_ascii_°πod
((*)
vÆ
, &
°r
);

718 (*
°r
 != ',') && (*str!=0))

719 
°r
++;

721 i‡(*
°r
==0){

722 
	`mesßge_îr‹
("ErrorÖarsingÑectangle.");

723 
	`xmlFªe
(
vÆ
);

727 
ª˘
->
t›
 = 
	`g_ascii_°πod
(
°r
+1, &str);

729 (*
°r
 != ';') && (*str!=0))

730 
°r
++;

732 i‡(*
°r
==0){

733 
	`mesßge_îr‹
("ErrorÖarsingÑectangle.");

734 
	`xmlFªe
(
vÆ
);

738 
ª˘
->
right
 = 
	`g_ascii_°πod
(
°r
+1, &str);

740 (*
°r
 != ',') && (*str!=0))

741 
°r
++;

743 i‡(*
°r
==0){

744 
	`mesßge_îr‹
("ErrorÖarsingÑectangle.");

745 
	`xmlFªe
(
vÆ
);

749 
ª˘
->
bŸtom
 = 
	`g_ascii_°πod
(
°r
+1, 
NULL
);

751 
	`xmlFªe
(
vÆ
);

752 
	}
}

761 
gch¨
 *

762 
	$d©a_°rög
(
D©aNode
 
d©a
)

764 
xmlCh¨
 *
vÆ
;

765 
gch¨
 *
°r
, *
p
,*
°r2
;

766 
Àn
;

768 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_STRING
) {

769 
	`mesßge_îr‹
("Taking string value ofÇon-stringÇode.");

770  
NULL
;

773 
vÆ
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"val");

774 i‡(
vÆ
 !
NULL
) {

775 
°r
 = 
	`g_mÆloc
(4 * (()*(
	`xmlSåÀn
(
vÆ
)+1)));

777 
p
 = 
°r
;

778 *
vÆ
) {

779 i‡(*
vÆ
 == '\\') {

780 
vÆ
++;

781 *
vÆ
) {

786 *
p
++ = '\n';

789 *
p
++ = '\t';

792 *
p
++ = '\\';

795 
	`mesßge_îr‹
("Error in stringÅag.");

798 *
p
++ = *
vÆ
;

800 
vÆ
++;

802 *
p
 = 0;

803 
	`xmlFªe
(
vÆ
);

804 
°r2
 = 
	`g_°rdup
(
°r
);

805 
	`g_‰ì
(
°r
);

806  
°r2
;

809 i‡(
d©a
->
xmlChûdªnNode
!=
NULL
) {

810 
p
 = (*)
	`xmlNodeLi°GëSåög
(
d©a
->
doc
, d©a->
xmlChûdªnNode
, 
TRUE
);

812 i‡(*
p
!='#')

813 
	`mesßge_îr‹
("Error in file, stringÇot starting with #\n");

815 
Àn
 = 
	`°æí
(
p
)-1;

817 
°r
 = 
	`g_mÆloc
(
Àn
+1);

819 
	`°∫˝y
(
°r
, 
p
+1, 
Àn
);

820 
°r
[
Àn
]=0;

822 
°r
[
	`°æí
(str)-1] = 0;

823 
	`xmlFªe
(
p
);

824  
°r
;

827  
NULL
;

828 
	}
}

839 
	$d©a_fûíame
(
D©aNode
 
d©a
)

841 *
utf8
 = 
	`d©a_°rög
(
d©a
);

842 *
fûíame
 = 
	`g_fûíame_‰om_utf8
(
utf8
, -1, 
NULL
, NULL, NULL);

843 
	`g_‰ì
(
utf8
);

844  
fûíame
;

845 
	}
}

854 
DüF⁄t
 *

855 
	$d©a_f⁄t
(
D©aNode
 
d©a
)

857 
xmlCh¨
 *
Ámûy
;

858 
DüF⁄t
 *
f⁄t
;

860 i‡(
	`d©a_ty≥
(
d©a
)!=
DATATYPE_FONT
) {

861 
	`mesßge_îr‹
("Taking font value ofÇon-fontÇode.");

862  
NULL
;

865 
Ámûy
 = 
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"family");

867 i‡(
Ámûy
) {

868 
DüF⁄tStyÀ
 
°yÀ
;

869 * 
°yÀ_«me
 = (*Ë
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"style");

870 
°yÀ
 = 
°yÀ_«me
 ? 
	`©oi
(style_name) : 0;

872 
f⁄t
 = 
	`dü_f⁄t_√w
 ((*)
Ámûy
, 
°yÀ
, 1.0);

873 i‡(
Ámûy
Ë
	`‰ì
(family);

874 i‡(
°yÀ_«me
Ë
	`xmlFªe
(style_name);

877 *
«me
 = (*)
	`xmlGëPr›
(
d©a
, (c⁄° 
xmlCh¨
 *)"name");

878 
f⁄t
 = 
	`dü_f⁄t_√w_‰om_Àgacy_«me
(
«me
);

879 
	`‰ì
(
«me
);

881  
f⁄t
;

882 
	}
}

893 
AâribuãNode


894 
	$√w_©åibuã
(
Obje˘Node
 
obj_node
,

895 c⁄° *
©å«me
)

897 
AâribuãNode
 
©å
;

898 
©å
 = 
	`xmlNewChûd
(
obj_node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"attribute", NULL);

899 
	`xmlSëPr›
(
©å
, (c⁄° 
xmlCh¨
 *)"«me", (xmlCh¨ *)
©å«me
);

901  
©å
;

902 
	}
}

910 
AâribuãNode


911 
	$composôe_add_©åibuã
(
D©aNode
 
composôe_node
,

912 c⁄° *
©å«me
)

914 
AâribuãNode
 
©å
;

915 
©å
 = 
	`xmlNewChûd
(
composôe_node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"attribute", NULL);

916 
	`xmlSëPr›
(
©å
, (c⁄° 
xmlCh¨
 *)"«me", (xmlCh¨ *)
©å«me
);

918  
©å
;

919 
	}
}

926 
	$d©a_add_öt
(
AâribuãNode
 
©å
, 
d©a
)

928 
D©aNode
 
d©a_node
;

929 
buf„r
[20+1];

931 
	`g_¢¥ötf
(
buf„r
, 20, "%d", 
d©a
);

933 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"int", NULL);

934 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"vÆ", (xmlCh¨ *)
buf„r
);

935 
	}
}

942 
	$d©a_add_íum
(
AâribuãNode
 
©å
, 
d©a
)

944 
D©aNode
 
d©a_node
;

945 
buf„r
[20+1];

947 
	`g_¢¥ötf
(
buf„r
, 20, "%d", 
d©a
);

949 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"enum", NULL);

950 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"vÆ", (xmlCh¨ *)
buf„r
);

951 
	}
}

958 
	$d©a_add_ªÆ
(
AâribuãNode
 
©å
, 
ªÆ
 
d©a
)

960 
D©aNode
 
d©a_node
;

961 
buf„r
[
G_ASCII_DTOSTR_BUF_SIZE
];

963 
	`g_ascii_dto°r
(
buf„r
, 
G_ASCII_DTOSTR_BUF_SIZE
, 
d©a
);

965 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"real", NULL);

966 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"vÆ", (xmlCh¨ *)
buf„r
);

967 
	}
}

974 
	$d©a_add_boﬁón
(
AâribuãNode
 
©å
, 
d©a
)

976 
D©aNode
 
d©a_node
;

978 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"boolean", NULL);

979 i‡(
d©a
)

980 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"val", (const xmlChar *)"true");

982 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"val", (const xmlChar *)"false");

983 
	}
}

994 
	$c⁄vît_to_hex
(
x
, *
°r
)

996 c⁄° 
hex_digô
[] = "0123456789abcdef";

997 
vÆ
;

999 
vÆ
 = 
x
 * 255.0;

1000 i‡(
vÆ
>255)

1001 
vÆ
 = 255;

1002 i‡(
vÆ
<0)

1003 
vÆ
 = 0;

1005 
°r
[0] = 
hex_digô
[
vÆ
/16];

1006 
°r
[1] = 
hex_digô
[
vÆ
%16];

1007 
	}
}

1014 
	$d©a_add_cﬁ‹
(
AâribuãNode
 
©å
, c⁄° 
Cﬁ‹
 *
cﬁ
)

1016 
buf„r
[1+6+1];

1017 
D©aNode
 
d©a_node
;

1019 
buf„r
[0] = '#';

1020 
	`c⁄vît_to_hex
(
cﬁ
->
ªd
, &
buf„r
[1]);

1021 
	`c⁄vît_to_hex
(
cﬁ
->
gªí
, &
buf„r
[3]);

1022 
	`c⁄vît_to_hex
(
cﬁ
->
blue
, &
buf„r
[5]);

1023 
buf„r
[7] = 0;

1025 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"color", NULL);

1026 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"vÆ", (xmlCh¨ *)
buf„r
);

1027 
	}
}

1029 
gch¨
 *

1030 
	$_°r_poöt
 (c⁄° 
Poöt
 *
poöt
)

1032 
gch¨
 *
buf„r
;

1033 
gch¨
 
px_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1034 
gch¨
 
py_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1036 
	`g_ascii_f‹m©d
(
px_buf
, ’x_buf), "%g", 
poöt
->
x
);

1037 
	`g_ascii_f‹m©d
(
py_buf
, ’y_buf), "%g", 
poöt
->
y
);

1038 
buf„r
 = 
	`g_°rc⁄ˇt
(
px_buf
, ",", 
py_buf
, 
NULL
);

1040  
buf„r
;

1041 
	}
}

1048 
	$d©a_add_poöt
(
AâribuãNode
 
©å
, c⁄° 
Poöt
 *
poöt
)

1050 
D©aNode
 
d©a_node
;

1051 
gch¨
 *
buf„r
 = 
	`_°r_poöt
 (
poöt
);

1053 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"point", NULL);

1054 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"vÆ", (xmlCh¨ *)
buf„r
);

1055 
	`g_‰ì
(
buf„r
);

1056 
	}
}

1059 
	$d©a_add_bezpoöt
(
AâribuãNode
 
©å
, c⁄° 
BezPoöt
 *
poöt
)

1061 
D©aNode
 
d©a_node
;

1062 
gch¨
 *
buf„r
;

1064 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"bezpoint", NULL);

1065 
poöt
->
ty≥
) {

1066 
BEZ_MOVE_TO
 :

1067 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"type", (const xmlChar *)"moveto");

1069 
BEZ_LINE_TO
 :

1070 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"type", (const xmlChar *)"lineto");

1072 
BEZ_CURVE_TO
 :

1073 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"type", (const xmlChar *)"curveto");

1076 
	`g_as£π_nŸ_ªached
();

1079 
buf„r
 = 
	`_°r_poöt
 (&
poöt
->
p1
);

1080 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"p1", (xmlCh¨ *)
buf„r
);

1081 
	`g_‰ì
 (
buf„r
);

1082 i‡(
poöt
->
ty≥
 =
BEZ_CURVE_TO
) {

1083 
buf„r
 = 
	`_°r_poöt
 (&
poöt
->
p2
);

1084 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"p2", (xmlCh¨ *)
buf„r
);

1085 
	`g_‰ì
 (
buf„r
);

1086 
buf„r
 = 
	`_°r_poöt
 (&
poöt
->
p3
);

1087 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"p3", (xmlCh¨ *)
buf„r
);

1088 
	`g_‰ì
 (
buf„r
);

1090 
	}
}

1097 
	$d©a_add_ª˘™gÀ
(
AâribuãNode
 
©å
, c⁄° 
Re˘™gÀ
 *
ª˘
)

1099 
D©aNode
 
d©a_node
;

1100 
gch¨
 *
buf„r
;

1101 
gch¨
 
æ_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1102 
gch¨
 
º_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1103 
gch¨
 
π_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1104 
gch¨
 
rb_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1106 
	`g_ascii_f‹m©d
(
æ_buf
, ‘l_buf), "%g", 
ª˘
->
À·
);

1107 
	`g_ascii_f‹m©d
(
º_buf
, ‘r_buf), "%g", 
ª˘
->
right
);

1108 
	`g_ascii_f‹m©d
(
π_buf
, ‘t_buf), "%g", 
ª˘
->
t›
);

1109 
	`g_ascii_f‹m©d
(
rb_buf
, ‘b_buf), "%g", 
ª˘
->
bŸtom
);

1111 
buf„r
 = 
	`g_°rc⁄ˇt
(
æ_buf
, ",", 
π_buf
, ";", 
º_buf
, ",", 
rb_buf
, 
NULL
);

1113 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"rectangle", NULL);

1114 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"vÆ", (xmlCh¨ *)
buf„r
);

1116 
	`g_‰ì
(
buf„r
);

1117 
	}
}

1124 
	$d©a_add_°rög
(
AâribuãNode
 
©å
, c⁄° *
°r
)

1126 
D©aNode
 
d©a_node
;

1127 
xmlCh¨
 *
esˇ≥d_°r
;

1128 
xmlCh¨
 *
sh¨≥d_°r
;

1130 i‡(
°r
==
NULL
) {

1131 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"string", (const xmlChar *)"##");

1135 
esˇ≥d_°r
 = 
	`xmlEncodeE¡ôõsRì¡ø¡
(
©å
->
doc
, (
xmlCh¨
 *Ë
°r
);

1137 
sh¨≥d_°r
 = (
xmlCh¨
 *Ë
	`g_°rc⁄ˇt
("#", (*Ë
esˇ≥d_°r
, "#", 
NULL
);

1139 
	`xmlFªe
(
esˇ≥d_°r
);

1141 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"°rög", (xmlCh¨ *Ë
sh¨≥d_°r
);

1143 
	`g_‰ì
(
sh¨≥d_°r
);

1144 
	}
}

1152 
	$d©a_add_fûíame
(
D©aNode
 
d©a
, c⁄° *
°r
)

1154 *
utf8
 = 
	`g_fûíame_to_utf8
(
°r
, -1, 
NULL
, NULL, NULL);

1156 
	`d©a_add_°rög
(
d©a
, 
utf8
);

1158 
	`g_‰ì
(
utf8
);

1159 
	}
}

1166 
	$d©a_add_f⁄t
(
AâribuãNode
 
©å
, c⁄° 
DüF⁄t
 *
f⁄t
)

1168 
D©aNode
 
d©a_node
;

1169 
DüF⁄tStyÀ
 
°yÀ
;

1170 
buf„r
[20+1];

1172 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"font", NULL);

1173 
°yÀ
 = 
	`dü_f⁄t_gë_°yÀ
 (
f⁄t
);

1174 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"Ámûy", (xmlCh¨ *Ë
	`dü_f⁄t_gë_Ámûy
(
f⁄t
));

1175 
	`g_¢¥ötf
(
buf„r
, 20, "%d", 
	`dü_f⁄t_gë_°yÀ
(
f⁄t
));

1177 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
buf„r
);

1179 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"«me", (xmlCh¨ *Ë
	`dü_f⁄t_gë_Àgacy_«me
(
f⁄t
));

1180 
	}
}

1187 
D©aNode


1188 
	$d©a_add_composôe
(
AâribuãNode
 
©å
, c⁄° *
ty≥
)

1191 
D©aNode
 
d©a_node
;

1193 
d©a_node
 = 
	`xmlNewChûd
(
©å
, 
NULL
, (c⁄° 
xmlCh¨
 *)"composite", NULL);

1194 i‡(
ty≥
 !
NULL
)

1195 
	`xmlSëPr›
(
d©a_node
, (c⁄° 
xmlCh¨
 *)"ty≥", (xmlCh¨ *)
ty≥
);

1197  
d©a_node
;

1198 
	}
}

1200 
	#BUFSIZE
 2048

	)

1201 
	#OVERRUN_SAFETY
 16

	)

1204 
	g¥ëty_f‹m©ed_xml
 = 
TRUE
;

1213 
	$xmlDüSaveFûe
(c⁄° *
fûíame
,

1214 
xmlDocPå
 
cur
)

1216 
ﬁd
 = 0, 
ªt
;

1218 i‡(
¥ëty_f‹m©ed_xml
)

1219 
ﬁd
 = 
	`xmlKìpBœnksDeÁu…
 (0);

1220 
ªt
 = 
	`xmlSaveF‹m©FûeEnc
 (
fûíame
,
cur
, "UTF-8", 
¥ëty_f‹m©ed_xml
 ? 1 : 0);

1221 i‡(
¥ëty_f‹m©ed_xml
)

1222 
	`xmlKìpBœnksDeÁu…
 (
ﬁd
);

1223  
ªt
;

1224 
	}
}

	@O:\tool\dvs50\lib\dia_xml.h

18 #i‚de‡
DIA_XML_H


19 
	#DIA_XML_H


	)

21 
	~<glib.h
>

22 
	~"geomëry.h
"

23 
	~"cﬁ‹.h
"

24 
	~"f⁄t.h
"

25 
	~"düv¨.h
"

26 
	~<libxml/åì.h
>

39 
	#DIA_XML_NAME_SPACE_BASE
 "hâp://www.lyßt‹.liu.£/~Æœ/dü/"

	)

41 
DIAVAR
 
	g¥ëty_f‹m©ed_xml
;

43 
xmlNodePå
 
	tXML_NODE
;

45 
XML_NODE
 
	tObje˘Node
;

46 
XML_NODE
 
	tAâribuãNode
;

47 
XML_NODE
 
	tD©aNode
;

50 
	mDATATYPE_COMPOSITE
,

51 
	mDATATYPE_INT
,

52 
	mDATATYPE_ENUM
,

53 
	mDATATYPE_REAL
,

54 
	mDATATYPE_BOOLEAN
,

55 
	mDATATYPE_COLOR
,

56 
	mDATATYPE_POINT
,

57 
	mDATATYPE_RECTANGLE
,

58 
	mDATATYPE_STRING
,

59 
	mDATATYPE_FONT
,

60 
	mDATATYPE_BEZPOINT
,

61 
	mDATATYPE_DICT


62 } 
	tD©aTy≥
;

64 
DIAVAR
 
AâribuãNode
 
obje˘_föd_©åibuã
(
Obje˘Node
 
obj_node
,

65 c⁄° *
©å«me
);

66 
DIAVAR
 
AâribuãNode
 
composôe_föd_©åibuã
(
D©aNode
 
composôe_node
,

67 c⁄° *
©å«me
);

68 
DIAVAR
 
©åibuã_num_d©a
(
AâribuãNode
 
©åibuã
);

69 
DIAVAR
 
D©aNode
 
©åibuã_fú°_d©a
(
AâribuãNode
 
©åibuã
);

70 
DIAVAR
 
D©aNode
 
d©a_√xt
(D©aNodê
d©a
);

71 
D©aTy≥
 
d©a_ty≥
(
D©aNode
 
d©a
);

72 
DIAVAR
 
d©a_öt
(
D©aNode
 
d©a
);

73 
DIAVAR
 
d©a_íum
(
D©aNode
 
d©a
);

74 
DIAVAR
 
ªÆ
 
d©a_ªÆ
(
D©aNode
 
d©a
);

75 
DIAVAR
 
d©a_boﬁón
(
D©aNode
 
d©a
);

76 
DIAVAR
 
d©a_cﬁ‹
(
D©aNode
 
d©a
, 
Cﬁ‹
 *
cﬁ
);

77 
DIAVAR
 
d©a_poöt
(
D©aNode
 
d©a
, 
Poöt
 *
poöt
);

78 
DIAVAR
 
d©a_bezpoöt
(
D©aNode
 
d©a
, 
BezPoöt
 *
poöt
);

79 
d©a_ª˘™gÀ
(
D©aNode
 
d©a
, 
Re˘™gÀ
 *
ª˘
);

80 
DIAVAR
 *
d©a_°rög
(
D©aNode
 
d©a
);

81 
DIAVAR
 *
d©a_fûíame
(
D©aNode
 
d©a
);

82 
DIAVAR
 
DüF⁄t
 *
d©a_f⁄t
(
D©aNode
 
d©a
);

84 
DIAVAR
 
AâribuãNode
 
√w_©åibuã
(
Obje˘Node
 
obj_node
, c⁄° *
©å«me
);

85 
DIAVAR
 
AâribuãNode
 
composôe_add_©åibuã
(
D©aNode
 
composôe_node
,

86 c⁄° *
©å«me
);

87 
DIAVAR
 
d©a_add_öt
(
AâribuãNode
 
©å
, 
d©a
);

88 
DIAVAR
 
d©a_add_íum
(
AâribuãNode
 
©å
, 
d©a
);

89 
DIAVAR
 
d©a_add_ªÆ
(
AâribuãNode
 
©å
, 
ªÆ
 
d©a
);

90 
DIAVAR
 
d©a_add_boﬁón
(
AâribuãNode
 
©å
, 
d©a
);

91 
DIAVAR
 
d©a_add_cﬁ‹
(
AâribuãNode
 
©å
, c⁄° 
Cﬁ‹
 *
cﬁ
);

92 
DIAVAR
 
d©a_add_poöt
(
AâribuãNode
 
©å
, c⁄° 
Poöt
 *
poöt
);

93 
DIAVAR
 
d©a_add_bezpoöt
(
AâribuãNode
 
©å
, c⁄° 
BezPoöt
 *
poöt
);

94 
d©a_add_ª˘™gÀ
(
AâribuãNode
 
©å
, c⁄° 
Re˘™gÀ
 *
ª˘
);

95 
DIAVAR
 
d©a_add_°rög
(
AâribuãNode
 
©å
, c⁄° *
°r
);

96 
DIAVAR
 
d©a_add_fûíame
(
AâribuãNode
 
©å
, c⁄° *
°r
);

97 
DIAVAR
 
d©a_add_f⁄t
(
AâribuãNode
 
©å
, c⁄° 
DüF⁄t
 *
f⁄t
);

98 
DIAVAR
 
D©aNode
 
d©a_add_composôe
(
AâribuãNode
 
©å
,

99 c⁄° *
ty≥
);

101 
GHashTabÀ
 *
d©a_di˘
 (
D©aNode
 
d©a
);

102 
d©a_add_di˘
 (
AâribuãNode
 
©å
, 
GHashTabÀ
 *
d©a
);

	@O:\tool\dvs50\lib\dia_xml_libxml.h

21 #i‚de‡
DIA_XML_LIBXML_H


22 
	#DIA_XML_LIBXML_H


	)

24 
	~<libxml/åì.h
>

25 
	~<libxml/∑r£r.h
>

26 
	~"düv¨.h
"

29 
DIAVAR
 
xmlDocPå
 
xmlDüP¨£Fûe
(c⁄° *
fûíame
);

32 
DIAVAR
 
xmlDocPå
 
xmlDoP¨£Fûe
(c⁄° *
fûíame
);

36 
DIAVAR
 
xmlDüSaveFûe
(c⁄° *
fûíame
,

37 
xmlDocPå
 
doc
);

	@O:\tool\dvs50\lib\diaarrowchooser.c

25 #unde‡
GTK_DISABLE_DEPRECATED


27 
	~<gtk/gtk.h
>

28 
	~<c⁄fig.h
>

29 
	~"öé.h
"

30 
	~"widgës.h
"

31 
	~"dü¨rowchoo£r.h
"

32 
	~"ªndî_pixm≠.h
"

34 c⁄° *
	gbuâ⁄_míu_key
 = "dia-button-menu";

35 c⁄° *
	gmíuôem_íum_key
 = "dia-menuitem-value";

37 
gch¨
*

38 
	$_dü_å™¶©e
 (c⁄° 
gch¨
* 
ãrm
, 
gpoöãr
 
d©a
)

40 c⁄° 
gch¨
* 
å™s
 = 
ãrm
;

42 i‡(
ãrm
 && *term) {

44 
å™s
 = 
	`dgëãxt
 (
GETTEXT_PACKAGE
, 
ãrm
);

46 i‡(
ãrm
 =
å™s
)

47 
å™s
 = 
	`dgëãxt
 ("gtk20", 
ãrm
);

50 i‡(
ãrm
 =
å™s
) {

51 
gch¨
* 
kludge
 = 
	`g_°rdup_¥ötf
 ("/%s", 
ãrm
);

52 
å™s
 = 
	`dgëãxt
 (
GETTEXT_PACKAGE
, 
kludge
);

53 i‡(
kludge
 =
å™s
)

54 
å™s
 = 
ãrm
;

56 ++
å™s
;

57 
	`g_‰ì
 (
kludge
);

59 i‡(
ãrm
 =
å™s
)

60 
å™s
 = 
	`g_°rdup_¥ötf
 ("XXX: %s", 
ãrm
);

63  
å™s
;

64 
	}
}

67 
dü_¨row_¥evõw_£t
(
DüAºowPªvõw
 *
¨row
,

68 
AºowTy≥
 
©y≥
, 
gboﬁón
 
À·
);

70 
dü_¨row_¥evõw_˛ass_öô
 (
DüAºowPªvõwCœss
 *
kœss
);

71 
dü_¨row_¥evõw_öô
 (
DüAºowPªvõw
 *
¨row
);

72 
göt
 
dü_¨row_¥evõw_expo£
 (
GtkWidgë
 *
widgë
,

73 
GdkEvítExpo£
 *
evít
);

78 
GTy≥


79 
	$dü_¨row_¥evõw_gë_ty≥
()

81 
GTy≥
 
ty≥
 = 0;

83 i‡(!
ty≥
) {

84 c⁄° 
GTy≥Info
 
öfo
 = {

85  (
DüAºowPªvõwCœss
),

86 (
GBa£InôFunc
Ë
NULL
,

87 (
GBa£FöÆizeFunc
Ë
NULL
,

88 (
GCœssInôFunc
Ë
dü_¨row_¥evõw_˛ass_öô
,

89 (
GCœssFöÆizeFunc
Ë
NULL
,

90 
NULL
,

91  (
DüAºowPªvõw
),

93 (
GIn°™˚InôFunc
Ë
dü_¨row_¥evõw_öô


96 
ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
(
GTK_TYPE_MISC
, "DüAºowPªvõw", &
öfo
, 0);

99  
ty≥
;

100 
	}
}

106 
	$dü_¨row_¥evõw_˛ass_öô
(
DüAºowPªvõwCœss
 *
˛ass
)

108 
GtkWidgëCœss
 *
widgë_˛ass
;

110 
widgë_˛ass
 = 
	`GTK_WIDGET_CLASS
 (
˛ass
);

111 
widgë_˛ass
->
expo£_evít
 = 
dü_¨row_¥evõw_expo£
;

112 
	}
}

118 
	$dü_¨row_¥evõw_öô
(
DüAºowPªvõw
 *
¨row
)

120 
	`GTK_WIDGET_SET_FLAGS
 (
¨row
, 
GTK_NO_WINDOW
);

122 
	`GTK_WIDGET
 (
¨row
)->
ªquisôi⁄
.
width
 = 40 + 
	`GTK_MISC
 (¨row)->
x∑d
 * 2;

123 
	`GTK_WIDGET
 (
¨row
)->
ªquisôi⁄
.
height
 = 20 + 
	`GTK_MISC
 (¨row)->
y∑d
 * 2;

125 
¨row
->
©y≥
 = 
ARROW_NONE
;

126 
¨row
->
À·
 = 
TRUE
;

127 
	}
}

134 
GtkWidgë
 *

135 
	$dü_¨row_¥evõw_√w
(
AºowTy≥
 
©y≥
, 
gboﬁón
 
À·
)

137 
DüAºowPªvõw
 *
¨row
 = 
	`g_obje˘_√w
(
DIA_TYPE_ARROW_PREVIEW
, 
NULL
);

139 
¨row
->
©y≥
 =átype;

140 
¨row
->
À·
 =Üeft;

141  
	`GTK_WIDGET
(
¨row
);

142 
	}
}

150 
	$dü_¨row_¥evõw_£t
(
DüAºowPªvõw
 *
¨row
, 
AºowTy≥
 
©y≥
, 
gboﬁón
 
À·
)

152 i‡(
¨row
->
©y≥
 !©y≥ ||áºow->
À·
 !=Üeft) {

153 
¨row
->
©y≥
 =átype;

154 
¨row
->
À·
 =Üeft;

155 i‡(
	`GTK_WIDGET_DRAWABLE
(
¨row
))

156 
	`gtk_widgë_queue_døw
(
	`GTK_WIDGET
(
¨row
));

158 
	}
}

166 
göt


167 
	$dü_¨row_¥evõw_expo£
(
GtkWidgë
 *
widgë
, 
GdkEvítExpo£
 *
evít
)

169 i‡(
	`GTK_WIDGET_DRAWABLE
(
widgë
)) {

170 
Poöt
 
‰om
, 
to
;

171 
Poöt
 
move_¨row
, 
move_löe
, 
¨row_hód
;

172 
DüRídîî
 *
ªndîî
;

173 
DüAºowPªvõw
 *
¨row
 = 
	`DIA_ARROW_PREVIEW
(
widgë
);

174 
Aºow
 
¨row_ty≥
;

175 
GtkMisc
 *
misc
 = 
	`GTK_MISC
(
widgë
);

176 
göt
 
width
, 
height
;

177 
göt
 
x
, 
y
;

178 
GdkWödow
 *
wö
;

179 
löewidth
 = 2;

180 
DüRídîîCœss
 *
ªndîî_›s
;

182 
width
 = 
widgë
->
Æloˇti⁄
.width - 
misc
->
x∑d
 * 2;

183 
height
 = 
widgë
->
Æloˇti⁄
.heighà- 
misc
->
y∑d
 * 2;

184 
x
 = (
widgë
->
Æloˇti⁄
.x + 
misc
->
x∑d
);

185 
y
 = (
widgë
->
Æloˇti⁄
.y + 
misc
->
y∑d
);

187 
wö
 = 
widgë
->
wödow
;

189 
to
.
y
 = 
‰om
.y = 
height
/2;

190 i‡(
¨row
->
À·
) {

191 
‰om
.
x
 = 
width
-
löewidth
;

192 
to
.
x
 = 0;

194 
‰om
.
x
 = 0;

195 
to
.
x
 = 
width
-
löewidth
;

201 
¨row_ty≥
.
ty≥
 = 
¨row
->
©y≥
;

202 
¨row_ty≥
.
Àngth
 = .75*((
ªÆ
)
height
-
löewidth
);

203 
¨row_ty≥
.
width
 = .75*((
ªÆ
)
height
-
löewidth
);

206 
	`ˇlcuœã_¨row_poöt
(&
¨row_ty≥
, &
‰om
, &
to
,

207 &
move_¨row
, &
move_löe
,

208 
löewidth
);

209 
¨row_hód
 = 
to
;

210 
	`poöt_add
(&
¨row_hód
, &
move_¨row
);

211 
	`poöt_add
(&
to
, &
move_löe
);

213 
ªndîî
 = 
	`√w_pixm≠_ªndîî
(
wö
, 
width
, 
height
);

214 
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

215 
	`ªndîî_pixm≠_£t_pixm≠
(
ªndîî
, 
wö
, 
x
, 
y
, 
width
, 
height
);

216 
ªndîî_›s
->
	`begö_ªndî
(
ªndîî
);

217 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
löewidth
);

219 
Cﬁ‹
 
cﬁ‹_bg
, 
cﬁ‹_fg
;

221 
GdkCﬁ‹
 
bg
 = 
widgë
->
°yÀ
->
ba£
[
	`GTK_WIDGET_STATE
(widget)];

222 
GdkCﬁ‹
 
fg
 = 
widgë
->
°yÀ
->
ãxt
[
	`GTK_WIDGET_STATE
(widget)];

224 
	`GDK_COLOR_TO_DIA
(
bg
, 
cﬁ‹_bg
);

225 
	`GDK_COLOR_TO_DIA
(
fg
, 
cﬁ‹_fg
);

226 
ªndîî_›s
->
	`døw_löe
(
ªndîî
, &
‰om
, &
to
, &
cﬁ‹_fg
);

227 
	`¨row_døw
 (
ªndîî
, 
¨row_ty≥
.
ty≥
,

228 &
¨row_hód
, &
‰om
,

229 
¨row_ty≥
.
Àngth
,

230 
¨row_ty≥
.
width
,

231 
löewidth
, &
cﬁ‹_fg
, &
cﬁ‹_bg
);

233 
ªndîî_›s
->
	`íd_ªndî
(
ªndîî
);

234 
	`g_obje˘_uƒef
(
ªndîî
);

237  
TRUE
;

238 
	}
}

243 
dü_¨row_choo£r_˛ass_öô
 (
DüAºowChoo£rCœss
 *
kœss
);

244 
dü_¨row_choo£r_öô
 (
DüAºowChoo£r
 *
¨row
);

249 
GTy≥


250 
	$dü_¨row_choo£r_gë_ty≥
()

252 
GTy≥
 
ty≥
 = 0;

254 i‡(!
ty≥
) {

255 c⁄° 
GTy≥Info
 
öfo
 = {

256  (
DüAºowChoo£rCœss
),

257 (
GBa£InôFunc
Ë
NULL
,

258 (
GBa£FöÆizeFunc
Ë
NULL
,

259 (
GCœssInôFunc
Ë
dü_¨row_choo£r_˛ass_öô
,

260 (
GCœssFöÆizeFunc
Ë
NULL
,

261 
NULL
,

262  (
DüAºowChoo£r
),

264 (
GIn°™˚InôFunc
Ë
dü_¨row_choo£r_öô


267 
ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
(
GTK_TYPE_BUTTON
, "DüAºowChoo£r", &
öfo
, 0);

270  
ty≥
;

271 
	}
}

279 
göt


280 
	$dü_¨row_choo£r_evít
(
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
)

282 i‡(
evít
->
ty≥
 =
GDK_BUTTON_PRESS
 &&Évít->
buâ⁄
.button == 1) {

283 
GtkMíu
 *
míu
 = 
	`gtk_obje˘_gë_d©a
(
	`GTK_OBJECT
(
widgë
), 
buâ⁄_míu_key
);

284 
	`gtk_míu_p›up
(
míu
, 
NULL
, NULL, NULL, NULL,

285 
evít
->
buâ⁄
.buâ⁄,Évít->buâ⁄.
time
);

286  
TRUE
;

289  
FALSE
;

290 
	}
}

296 
	$dü_¨row_choo£r_˛ass_öô
(
DüAºowChoo£rCœss
 *
˛ass
)

298 
GtkWidgëCœss
 *
widgë_˛ass
;

300 
widgë_˛ass
 = 
	`GTK_WIDGET_CLASS
(
˛ass
);

301 
widgë_˛ass
->
evít
 = 
dü_¨row_choo£r_evít
;

302 
	}
}

308 
	$dü_¨row_choo£r_öô
(
DüAºowChoo£r
 *
¨row
)

310 
GtkWidgë
 *
wid
;

312 
¨row
->
À·
 = 
FALSE
;

313 
¨row
->¨row.
ty≥
 = 
ARROW_NONE
;

314 
¨row
->¨row.
Àngth
 = 
DEFAULT_ARROW_LENGTH
;

315 
¨row
->¨row.
width
 = 
DEFAULT_ARROW_WIDTH
;

317 
wid
 = 
	`dü_¨row_¥evõw_√w
(
ARROW_NONE
, 
¨row
->
À·
);

318 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
¨row
), 
wid
);

319 
	`gtk_widgë_show
(
wid
);

320 
¨row
->
¥evõw
 = 
	`DIA_ARROW_PREVIEW
(
wid
);

322 
¨row
->
dülog
 = 
NULL
;

323 
	}
}

331 
	$dü_¨row_choo£r_dülog_ª•⁄£
(
GtkWidgë
 *
dülog
,

332 
göt
 
ª•⁄£_id
,

333 
DüAºowChoo£r
 *
choo£r
)

335 i‡(
ª•⁄£_id
 =
GTK_RESPONSE_OK
) {

336 
Aºow
 
√w_¨row
 = 
	`dü_¨row_£À˘‹_gë_¨row
(
choo£r
->
£À˘‹
);

338 i‡(
√w_¨row
.
ty≥
 !
choo£r
->
¨row
.type ||

339 
√w_¨row
.
Àngth
 !
choo£r
->
¨row
.length ||

340 
√w_¨row
.
width
 !
choo£r
->
¨row
.width) {

341 
choo£r
->
¨row
 = 
√w_¨row
;

342 
	`dü_¨row_¥evõw_£t
(
choo£r
->
¥evõw
, 
√w_¨row
.
ty≥
, choo£r->
À·
);

343 i‡(
choo£r
->
ˇŒback
)

344 (* 
choo£r
->
ˇŒback
)(choo£r->
¨row
, choo£r->
u£r_d©a
);

347 
	`dü_¨row_£À˘‹_£t_¨row
(
choo£r
->
£À˘‹
, choo£r->
¨row
);

349 
	`gtk_widgë_hide
(
choo£r
->
dülog
);

350 
	}
}

357 
	$dü_¨row_choo£r_dülog_√w
(
DüAºowChoo£r
 *
choo£r
)

359 
GtkWidgë
 *
wid
;

361 
choo£r
->
dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
(
	`_
("Arrow Properties"),

362 
NULL
,

363 
GTK_DIALOG_NO_SEPARATOR
,

364 
GTK_STOCK_CANCEL
,

365 
GTK_RESPONSE_CANCEL
,

366 
GTK_STOCK_OK
,

367 
GTK_RESPONSE_OK
,

368 
NULL
);

369 
	`gtk_dülog_£t_deÁu…_ª•⁄£
(
	`GTK_DIALOG
(
choo£r
->
dülog
),

370 
GTK_RESPONSE_OK
);

371 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
choo£r
->
dülog
), "response",

372 
	`G_CALLBACK
(
dü_¨row_choo£r_dülog_ª•⁄£
), 
choo£r
);

373 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
choo£r
->
dülog
), "destroy",

374 
	`G_CALLBACK
(
gtk_widgë_de°royed
), &
choo£r
->
dülog
);

376 
wid
 = 
	`dü_¨row_£À˘‹_√w
();

377 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
wid
), 5);

378 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
	`GTK_DIALOG
(
choo£r
->
dülog
)->
vbox
), 
wid
,

379 
TRUE
, TRUE, 0);

380 
	`gtk_widgë_show
(
wid
);

381 
choo£r
->
£À˘‹
 = 
	`DIA_ARROW_SELECTOR
(
wid
);

382 
	}
}

390 
	$dü_¨row_choo£r_dülog_show
(
GtkWidgë
 *
widgë
, 
DüAºowChoo£r
 *
choo£r
)

392 i‡(
choo£r
->
dülog
) {

393 
	`gtk_wödow_¥e£¡
(
	`GTK_WINDOW
(
choo£r
->
dülog
));

397 
	`dü_¨row_choo£r_dülog_√w
(
choo£r
);

398 
	`dü_¨row_£À˘‹_£t_¨row
(
choo£r
->
£À˘‹
, choo£r->
¨row
);

399 
	`gtk_widgë_show
(
choo£r
->
dülog
);

400 
	}
}

407 
	$dü_¨row_choo£r_ch™ge_¨row_ty≥
(
GtkMíuIãm
 *
mi
, 
DüAºowChoo£r
 *
choo£r
)

409 
AºowTy≥
 
©y≥
 = 
	`GPOINTER_TO_INT
(
	`g_obje˘_gë_d©a
(
	`G_OBJECT
(
mi
),

410 
míuôem_íum_key
));

411 
Aºow
 
¨row
;

412 
¨row
.
width
 = 
choo£r
->arrow.width;

413 
¨row
.
Àngth
 = 
choo£r
->arrow.length;

414 
¨row
.
ty≥
 = 
©y≥
;

415 
	`dü_¨row_choo£r_£t_¨row
(
choo£r
, &
¨row
);

416 
	}
}

426 
GtkWidgë
 *

427 
	$dü_¨row_choo£r_√w
(
gboﬁón
 
À·
, 
DüCh™geAºowCÆlback
 
ˇŒback
,

428 
gpoöãr
 
u£r_d©a
, 
GtkToﬁtùs
 *
toﬁ_tùs
)

430 
DüAºowChoo£r
 *
choo£r
 = 
	`g_obje˘_√w
(
DIA_TYPE_ARROW_CHOOSER
, 
NULL
);

431 
GtkWidgë
 *
míu
, *
mi
, *
¨
;

432 
göt
 
i
;

434 
choo£r
->
À·
 =Üeft;

435 
	`dü_¨row_¥evõw_£t
(
choo£r
->
¥evõw
, choo£r->¥evõw->
©y≥
, 
À·
);

436 
choo£r
->
ˇŒback
 = callback;

437 
choo£r
->
u£r_d©a
 = user_data;

439 
míu
 = 
	`gtk_míu_√w
();

440 
	`g_obje˘_ªf
(
	`G_OBJECT
(
míu
));

441 
	`gtk_obje˘_sök
(
	`GTK_OBJECT
(
míu
));

442 
	`g_obje˘_£t_d©a_fuŒ
(
	`G_OBJECT
(
choo£r
), 
buâ⁄_míu_key
, 
míu
,

443 (
GtkDe°royNŸify
)
gtk_widgë_uƒef
);

445 
i
 = 
ARROW_NONE
; i < 
MAX_ARROW_TYPE
; ++i) {

446 
AºowTy≥
 
¨row_ty≥
 = 
	`¨row_ty≥_‰om_ödex
(
i
);

447 
mi
 = 
	`gtk_míu_ôem_√w
();

448 
	`g_obje˘_£t_d©a
(
	`G_OBJECT
(
mi
), 
míuôem_íum_key
,

449 
	`GINT_TO_POINTER
(
¨row_ty≥
));

450 i‡(
toﬁ_tùs
) {

451 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
, 
mi
, 
	`_dü_å™¶©e
(
	`¨row_gë_«me_‰om_ty≥
(
¨row_ty≥
), 
NULL
), NULL);

453 
¨
 = 
	`dü_¨row_¥evõw_√w
(
¨row_ty≥
, 
À·
);

455 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
mi
), 
¨
);

456 
	`gtk_widgë_show
(
¨
);

457 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
mi
), "activate",

458 
	`G_CALLBACK
(
dü_¨row_choo£r_ch™ge_¨row_ty≥
), 
choo£r
);

459 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
mi
);

460 
	`gtk_widgë_show
(
mi
);

462 
mi
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`_dü_å™¶©e
("Dëaûs...", 
NULL
));

463 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
mi
), "activate",

464 
	`G_CALLBACK
(
dü_¨row_choo£r_dülog_show
), 
choo£r
);

465 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
mi
);

466 
	`gtk_widgë_show
(
mi
);

468  
	`GTK_WIDGET
(
choo£r
);

469 
	}
}

478 
	$dü_¨row_choo£r_£t_¨row
(
DüAºowChoo£r
 *
choo£r
, 
Aºow
 *
¨row
)

480 i‡(
choo£r
->
¨row
.
ty≥
 !=árrow->type) {

481 
	`dü_¨row_¥evõw_£t
(
choo£r
->
¥evõw
, 
¨row
->
ty≥
, choo£r->
À·
);

482 
choo£r
->
¨row
.
ty≥
 =árrow->type;

483 i‡(
choo£r
->
dülog
 !
NULL
)

484 
	`dü_¨row_£À˘‹_£t_¨row
(
choo£r
->
£À˘‹
, choo£r->
¨row
);

485 i‡(
choo£r
->
ˇŒback
)

486 (* 
choo£r
->
ˇŒback
)(choo£r->
¨row
, choo£r->
u£r_d©a
);

488 
choo£r
->
¨row
.
width
 =árrow->width;

489 
choo£r
->
¨row
.
Àngth
 =árrow->length;

490 
	}
}

496 
AºowTy≥


497 
	$dü_¨row_choo£r_gë_¨row_ty≥
(
DüAºowChoo£r
 *
¨row
)

499  
¨row
->¨row.
ty≥
;

500 
	}
}

	@O:\tool\dvs50\lib\diaarrowchooser.h

22 #i‚de‡
_DIAARROWCHOOSER_H_


23 
	#_DIAARROWCHOOSER_H_


	)

25 
	~<gtk/gtk.h
>

27 
	~"¨rows.h
"

28 
	~"düty≥s.h
"

32 
GTy≥
 
dü_¨row_¥evõw_gë_ty≥
 ();

34 
	#DIA_TYPE_ARROW_PREVIEW
 (
	`dü_¨row_¥evõw_gë_ty≥
 ())

	)

35 
	#DIA_ARROW_PREVIEW
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_ARROW_PREVIEW
, 
DüAºowPªvõw
))

	)

36 
	#DIA_ARROW_PREVIEW_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_ARROW_PREVIEW
, 
DüAºowPªvõwCœss
))

	)

37 
	#DIA_IS_ARROW_PREVIEW
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_ARROW_PREVIEW
))

	)

38 
	#DIA_IS_ARROW_PREVIEW_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kœss), 
DIA_TYPE_ARROW_PREVIEW
))

	)

39 
	#DIA_ARROW_PREVIEW_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_ARROW_PREVIEW
, 
DüAºowPªvõwCœss
))

	)

41 
_DüAºowPªvõw
 
	tDüAºowPªvõw
;

42 
_DüAºowPªvõwCœss
 
	tDüAºowPªvõwCœss
;

44 
	s_DüAºowPªvõw


46 
GtkMisc
 
	mmisc
;

47 
AºowTy≥
 
	m©y≥
;

48 
gboﬁón
 
	mÀ·
;

51 
	s_DüAºowPªvõwCœss


53 
GtkMiscCœss
 
	m∑ª¡_˛ass
;

56 
GtkWidgë
 *
dü_¨row_¥evõw_√w
 (
AºowTy≥
 
©y≥
, 
gboﬁón
 
À·
);

60 
DIAVAR
 
GTy≥
 
dü_¨row_choo£r_gë_ty≥
 ();

62 
	#DIA_TYPE_ARROW_CHOOSER
 (
	`dü_¨row_choo£r_gë_ty≥
 ())

	)

63 
	#DIA_ARROW_CHOOSER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_ARROW_CHOOSER
, 
DüAºowChoo£r
))

	)

64 
	#DIA_ARROW_CHOOSER_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_ARROW_CHOOSER
, 
DüAºowChoo£rCœss
))

	)

65 
	#DIA_IS_ARROW_CHOOSER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_ARROW_CHOOSER
))

	)

66 
	#DIA_IS_ARROW_CHOOSER_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kœss), 
DIA_TYPE_ARROW_CHOOSER
))

	)

67 
	#DIA_ARROW_CHOOSER_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_ARROW_CHOOSER
, 
DüAºowChoo£rCœss
))

	)

69 
_DüAºowChoo£r
 
	tDüAºowChoo£r
;

70 
_DüAºowChoo£rCœss
 
	tDüAºowChoo£rCœss
;

72 (*
	tDüCh™geAºowCÆlback
Ë(
	tAºow
 
	t©y≥
, 
	tgpoöãr
 
	tu£r_d©a
);

74 
	s_DüAºowChoo£r


76 
GtkBuâ⁄
 
buâ⁄
;

77 
DüAºowPªvõw
 *
¥evõw
;

78 
Aºow
 
¨row
;

79 
gboﬁón
 
À·
;

81 
DüCh™geAºowCÆlback
 
ˇŒback
;

82 
gpoöãr
 
u£r_d©a
;

84 
GtkWidgë
 *
dülog
;

85 
DüAºowSñe˘‹
 *
£À˘‹
;

88 
	s_DüAºowChoo£rCœss


90 
GtkBuâ⁄Cœss
 
∑ª¡_˛ass
;

93 
DIAVAR
 
GtkWidgë
 *
	`dü_¨row_choo£r_√w
 (
gboﬁón
 
À·
,

94 
DüCh™geAºowCÆlback
 
ˇŒback
,

95 
gpoöãr
 
u£r_d©a
,

96 #i‚de‡
GTK_DISABLE_DEPRECATED


97 
GtkToﬁtùs
 *
toﬁ_tùs


99 
gpoöãr
 
toﬁ_tùs


102 
DIAVAR
 
	`dü_¨row_choo£r_£t_¨row
(
DüAºowChoo£r
 *
choo£r
, 
Aºow
 *
¨row
);

103 
DIAVAR
 
AºowTy≥
 
	`dü_¨row_choo£r_gë_¨row_ty≥
(
DüAºowChoo£r
 *
choo£r
);

	@O:\tool\dvs50\lib\diacellrendererproperty.c

26 
	~<c⁄fig.h
>

28 
	~<gtk/gtk.h
>

30 
	~"dü˚Œªndîî¥›îty.h
"

32 
	~"düªndîî.h
"

33 
	~"düm¨shÆ.h
"

34 
	~"mesßge.h
"

38 
	mCLICKED
,

39 
	mLAST_SIGNAL


44 
	mPROP_0
,

45 
	mPROP_RENDERER
,

46 
	mPROP_PROPERTY


49 
dü_˚Œ_ªndîî_¥›îty_föÆize
 (
GObje˘
 *
obje˘
);

50 
dü_˚Œ_ªndîî_¥›îty_gë_¥›îty
 (
GObje˘
 *
obje˘
,

51 
guöt
 
∑øm_id
,

52 
GVÆue
 *
vÆue
,

53 
GP¨amS≥c
 *
p•ec
);

54 
dü_˚Œ_ªndîî_¥›îty_£t_¥›îty
 (
GObje˘
 *
obje˘
,

55 
guöt
 
∑øm_id
,

56 c⁄° 
GVÆue
 *
vÆue
,

57 
GP¨amS≥c
 *
p•ec
);

58 
dü_˚Œ_ªndîî_¥›îty_gë_size
 (
GtkCñlRídîî
 *
˚Œ
,

59 
GtkWidgë
 *
widgë
,

60 
GdkRe˘™gÀ
 *
ª˘™gÀ
,

61 
göt
 *
x_off£t
,

62 
göt
 *
y_off£t
,

63 
göt
 *
width
,

64 
göt
 *
height
);

65 
dü_˚Œ_ªndîî_¥›îty_ªndî
 (
GtkCñlRídîî
 *
˚Œ
,

66 
GdkWödow
 *
wödow
,

67 
GtkWidgë
 *
widgë
,

68 
GdkRe˘™gÀ
 *
background_¨ó
,

69 
GdkRe˘™gÀ
 *
˚Œ_¨ó
,

70 
GdkRe˘™gÀ
 *
expo£_¨ó
,

71 
GtkCñlRídîîSèã
 
Êags
);

72 
gboﬁón
 
dü_˚Œ_ªndîî_¥›îty_a˘iv©e
 (
GtkCñlRídîî
 *
˚Œ
,

73 
GdkEvít
 *
evít
,

74 
GtkWidgë
 *
widgë
,

75 c⁄° 
gch¨
 *
∑th
,

76 
GdkRe˘™gÀ
 *
background_¨ó
,

77 
GdkRe˘™gÀ
 *
˚Œ_¨ó
,

78 
GtkCñlRídîîSèã
 
Êags
);

81 
	$G_DEFINE_TYPE
 (
DüCñlRídîîPr›îty
, 
dü_˚Œ_ªndîî_¥›îty
, 
GTK_TYPE_CELL_RENDERER
)

83 
	#∑ª¡_˛ass
 
dü_˚Œ_ªndîî_¥›îty_∑ª¡_˛ass


	)

85 
guöt
 
¥›îty_˚Œ_sig«ls
[
LAST_SIGNAL
] = { 0 
	}
};

89 
	$dü_˚Œ_ªndîî_¥›îty_˛ass_öô
 (
DüCñlRídîîPr›îtyCœss
 *
kœss
)

91 
GObje˘Cœss
 *
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
kœss
);

92 
GtkCñlRídîîCœss
 *
˚Œ_˛ass
 = 
	`GTK_CELL_RENDERER_CLASS
 (
kœss
);

94 
¥›îty_˚Œ_sig«ls
[
CLICKED
] =

95 
	`g_sig«l_√w
 ("clicked",

96 
	`G_OBJECT_CLASS_TYPE
 (
obje˘_˛ass
),

97 
G_SIGNAL_RUN_LAST
,

98 
	`G_STRUCT_OFFSET
 (
DüCñlRídîîPr›îtyCœss
, 
˛icked
),

99 
NULL
, NULL,

100 
dü_m¨shÆ_VOID__STRING_FLAGS
,

101 
G_TYPE_NONE
, 2,

102 
G_TYPE_STRING
,

103 
GDK_TYPE_MODIFIER_TYPE
);

105 
obje˘_˛ass
->
föÆize
 = 
dü_˚Œ_ªndîî_¥›îty_föÆize
;

106 
obje˘_˛ass
->
gë_¥›îty
 = 
dü_˚Œ_ªndîî_¥›îty_gë_¥›îty
;

107 
obje˘_˛ass
->
£t_¥›îty
 = 
dü_˚Œ_ªndîî_¥›îty_£t_¥›îty
;

109 
˚Œ_˛ass
->
gë_size
 = 
dü_˚Œ_ªndîî_¥›îty_gë_size
;

110 
˚Œ_˛ass
->
ªndî
 = 
dü_˚Œ_ªndîî_¥›îty_ªndî
;

111 
˚Œ_˛ass
->
a˘iv©e
 = 
dü_˚Œ_ªndîî_¥›îty_a˘iv©e
;

113 
kœss
->
˛icked
 = 
NULL
;

115 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
, 
PROP_RENDERER
,

116 
	`g_∑øm_•ec_obje˘
 ("renderer",

117 
NULL
, NULL,

118 
DIA_TYPE_RENDERER
,

119 
G_PARAM_READWRITE
));

120 
	`g_obje˘_˛ass_ö°Æl_¥›îty
 (
obje˘_˛ass
, 
PROP_PROPERTY
,

121 
	`g_∑øm_•ec_obje˘
 ("property",

122 
NULL
, NULL,

123 
DIA_TYPE_RENDERER
,

124 
G_PARAM_READWRITE
));

125 
	}
}

128 
	$dü_˚Œ_ªndîî_¥›îty_öô
 (
DüCñlRídîîPr›îty
 *
˚Œ¥›îty
)

130 
	`GTK_CELL_RENDERER
 (
˚Œ¥›îty
)->
mode
 = 
GTK_CELL_RENDERER_MODE_ACTIVATABLE
;

131 
	}
}

134 
	$dü_˚Œ_ªndîî_¥›îty_föÆize
 (
GObje˘
 *
obje˘
)

136 
DüCñlRídîîPr›îty
 *
˚Œ
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
obje˘
);

138 i‡(
˚Œ
->
ªndîî
)

140 
	`g_obje˘_uƒef
 (
˚Œ
->
ªndîî
);

141 
˚Œ
->
ªndîî
 = 
NULL
;

144 
	`G_OBJECT_CLASS
 (
∑ª¡_˛ass
)->
	`föÆize
 (
obje˘
);

145 
	}
}

148 
	$dü_˚Œ_ªndîî_¥›îty_gë_¥›îty
 (
GObje˘
 *
obje˘
,

149 
guöt
 
∑øm_id
,

150 
GVÆue
 *
vÆue
,

151 
GP¨amS≥c
 *
p•ec
)

153 
DüCñlRídîîPr›îty
 *
˚Œ
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
obje˘
);

155 
∑øm_id
)

157 
PROP_RENDERER
:

158 
	`g_vÆue_£t_obje˘
 (
vÆue
, 
˚Œ
->
ªndîî
);

162 
	`G_OBJECT_WARN_INVALID_PROPERTY_ID
 (
obje˘
, 
∑øm_id
, 
p•ec
);

165 
	}
}

168 
	$dü_˚Œ_ªndîî_¥›îty_£t_¥›îty
 (
GObje˘
 *
obje˘
,

169 
guöt
 
∑øm_id
,

170 c⁄° 
GVÆue
 *
vÆue
,

171 
GP¨amS≥c
 *
p•ec
)

173 
DüCñlRídîîPr›îty
 *
˚Œ
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
obje˘
);

175 
∑øm_id
)

177 
PROP_RENDERER
:

179 
DüRídîî
 *
ªndîî
;

181 
ªndîî
 = (
DüRídîî
 *Ë
	`g_vÆue_dup_obje˘
 (
vÆue
);

182 i‡(
˚Œ
->
ªndîî
)

183 
	`g_obje˘_uƒef
 (
˚Œ
->
ªndîî
);

184 
˚Œ
->
ªndîî
 =Ñenderer;

189 
	`G_OBJECT_WARN_INVALID_PROPERTY_ID
 (
obje˘
, 
∑øm_id
, 
p•ec
);

192 
	}
}

195 
	$dü_˚Œ_ªndîî_¥›îty_gë_size
 (
GtkCñlRídîî
 *
˚Œ
,

196 
GtkWidgë
 *
widgë
,

197 
GdkRe˘™gÀ
 *
˚Œ_¨ó
,

198 
göt
 *
x_off£t
,

199 
göt
 *
y_off£t
,

200 
göt
 *
width
,

201 
göt
 *
height
)

203 
DüCñlRídîîPr›îty
 *
˚Œ¥›îty
;

204 
göt
 
võw_width
 = 0;

205 
göt
 
võw_height
 = 0;

206 
göt
 
ˇlc_width
;

207 
göt
 
ˇlc_height
;

210 
˚Œ¥›îty
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
˚Œ
);

212 i‡(
˚Œ¥›îty
->
ªndîî
)

214 
võw_width
 = (
˚Œ¥›îty
->
ªndîî
->
width
 +

215 2 * 
˚Œ¥›îty
->
ªndîî
->
b‹dî_width
);

216 
võw_height
 = (
˚Œ¥›îty
->
ªndîî
->
height
 +

217 2 * 
˚Œ¥›îty
->
ªndîî
->
b‹dî_width
);

221 
võw_width
 = 120;

222 
võw_height
 = 30;

225 
ˇlc_width
 = (
göt
Ë
˚Œ
->
x∑d
 * 2 + 
võw_width
;

226 
ˇlc_height
 = (
göt
Ë
˚Œ
->
y∑d
 * 2 + 
võw_height
;

228 i‡(
x_off£t
) *x_offset = 0;

229 i‡(
y_off£t
) *y_offset = 0;

231 i‡(
˚Œ_¨ó
 && 
võw_width
 > 0 && 
võw_height
 > 0)

233 i‡(
x_off£t
)

235 *
x_off£t
 = (((
	`gtk_widgë_gë_dúe˘i⁄
 (
widgë
Ë=
GTK_TEXT_DIR_RTL
) ?

236 1.0 - 
˚Œ
->
xÆign
 : cell->xalign) *

237 (
˚Œ_¨ó
->
width
 - 
ˇlc_width
 - 2 * 
˚Œ
->
x∑d
));

238 *
x_off£t
 = (
	`MAX
 (*x_off£t, 0Ë+ 
˚Œ
->
x∑d
);

240 i‡(
y_off£t
)

242 *
y_off£t
 = (
˚Œ
->
yÆign
 *

243 (
˚Œ_¨ó
->
height
 - 
ˇlc_height
 - 2 * 
˚Œ
->
y∑d
));

244 *
y_off£t
 = (
	`MAX
 (*y_off£t, 0Ë+ 
˚Œ
->
y∑d
);

248 i‡(
width
Ë*width = 
ˇlc_width
;

249 i‡(
height
Ë*heighà
ˇlc_height
;

250 
	}
}

253 
	$dü_˚Œ_ªndîî_¥›îty_ªndî
 (
GtkCñlRídîî
 *
˚Œ
,

254 
GdkWödow
 *
wödow
,

255 
GtkWidgë
 *
widgë
,

256 
GdkRe˘™gÀ
 *
background_¨ó
,

257 
GdkRe˘™gÀ
 *
˚Œ_¨ó
,

258 
GdkRe˘™gÀ
 *
expo£_¨ó
,

259 
GtkCñlRídîîSèã
 
Êags
)

261 
DüCñlRídîîPr›îty
 *
˚Œ¥›îty
;

263 
˚Œ¥›îty
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
˚Œ
);

265 i‡(
˚Œ¥›îty
->
ªndîî
)

267 i‡(! (
Êags
 & 
GTK_CELL_RENDERER_SELECTED
))

270 
	`dü_võw_ªndîî_ªmove_idÀ
 (
˚Œ¥›îty
->
ªndîî
);

274 
	`dü_võw_ªndîî_døw
 (
˚Œ¥›îty
->
ªndîî
, 
wödow
, 
widgë
,

275 
˚Œ_¨ó
, 
expo£_¨ó
);

278 
	}
}

280 
gboﬁón


281 
	$dü_˚Œ_ªndîî_¥›îty_a˘iv©e
 (
GtkCñlRídîî
 *
˚Œ
,

282 
GdkEvít
 *
evít
,

283 
GtkWidgë
 *
widgë
,

284 c⁄° 
gch¨
 *
∑th
,

285 
GdkRe˘™gÀ
 *
background_¨ó
,

286 
GdkRe˘™gÀ
 *
˚Œ_¨ó
,

287 
GtkCñlRídîîSèã
 
Êags
)

289 
DüCñlRídîîPr›îty
 *
˚Œ¥›îty
;

291 
˚Œ¥›îty
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
˚Œ
);

293 i‡(
˚Œ¥›îty
->
ªndîî
)

295 
GdkModifõrTy≥
 
°©e
 = 0;

297 i‡(
evít
 && ((
GdkEvítAny
 *Ëevít)->
ty≥
 =
GDK_BUTTON_PRESS
)

298 
°©e
 = ((
GdkEvítBuâ⁄
 *Ë
evít
)->state;

300 i‡(! 
evít
 ||

301 (((
GdkEvítAny
 *Ë
evít
)->
ty≥
 =
GDK_BUTTON_PRESS
 &&

302 ((
GdkEvítBuâ⁄
 *Ë
evít
)->
buâ⁄
 == 1))

304 
	`dü_˚Œ_ªndîî_¥›îty_˛icked
 (
˚Œ¥›îty
, 
∑th
, 
°©e
);

306  
TRUE
;

310  
FALSE
;

311 
	}
}

313 
GtkCñlRídîî
 *

314 
	$dü_˚Œ_ªndîî_¥›îty_√w
 ()

316  
	`g_obje˘_√w
 (
DIA_TYPE_CELL_RENDERER_PROPERTY
, 
NULL
);

317 
	}
}

320 
	$dü_˚Œ_ªndîî_¥›îty_˛icked
 (
DüCñlRídîîPr›îty
 *
˚Œ
,

321 c⁄° 
gch¨
 *
∑th
,

322 
GdkModifõrTy≥
 
°©e
)

324 
GdkEvít
 *
evít
;

326 
	`g_ªtu∫_if_Áû
 (
	`DIA_IS_CELL_RENDERER_PROPERTY
 (
˚Œ
));

327 
	`g_ªtu∫_if_Áû
 (
∑th
 !
NULL
);

329 
	`g_sig«l_emô
 (
˚Œ
, 
¥›îty_˚Œ_sig«ls
[
CLICKED
], 0, 
∑th
, 
°©e
);

331 
evít
 = 
	`gtk_gë_cuºít_evít
 ();

333 i‡(
evít
)

335 
GdkEvítBuâ⁄
 *
bevít
 = (GdkEvítBuâ⁄ *Ë
evít
;

337 i‡(
bevít
->
ty≥
 =
GDK_BUTTON_PRESS
 &&

338 (
bevít
->
buâ⁄
 == 1 || bevent->button == 2))

341 
	`dü_võw_p›up_show
 (
	`gtk_gë_evít_widgë
 (
evít
),

342 
bevít
,

343 
˚Œ
->
ªndîî
->
c⁄ãxt
,

344 
˚Œ
->
ªndîî
->
¥›îty
,

345 
˚Œ
->
ªndîî
->
width
,

346 
˚Œ
->
ªndîî
->
height
,

347 
˚Œ
->
ªndîî
->
dŸ_f‹_dŸ
);

350 
	`mesßge_w¨nög
 ("Clicked!");

354 
	`gdk_evít_‰ì
 (
evít
);

356 
	}
}

	@O:\tool\dvs50\lib\diacellrendererproperty.h

25 #i‚de‡
__DIA_CELL_RENDERER_PROPERTY_H__


26 
	#__DIA_CELL_RENDERER_PROPERTY_H__


	)

29 
	~<gtk/gtk˚Œªndîî.h
>

30 
	~"düty≥s.h
"

32 
	#DIA_TYPE_CELL_RENDERER_PROPERTY
 (
	`dü_˚Œ_ªndîî_¥›îty_gë_ty≥
 ())

	)

33 
	#DIA_CELL_RENDERER_PROPERTY
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_CELL_RENDERER_PROPERTY
, 
DüCñlRídîîPr›îty
))

	)

34 
	#DIA_CELL_RENDERER_PROPERTY_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_CELL_RENDERER_PROPERTY
, 
DüCñlRídîîPr›îtyCœss
))

	)

35 
	#DIA_IS_CELL_RENDERER_PROPERTY
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_CELL_RENDERER_PROPERTY
))

	)

36 
	#DIA_IS_CELL_RENDERER_PROPERTY_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kœss), 
DIA_TYPE_CELL_RENDERER_PROPERTY
))

	)

37 
	#DIA_CELL_RENDERER_PROPERTY_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_CELL_RENDERER_PROPERTY
, 
DüCñlRídîîPr›îtyCœss
))

	)

40 
_DüCñlRídîîPr›îtyCœss
 
	tDüCñlRídîîPr›îtyCœss
;

42 
	s_DüCñlRídîîPr›îty


44 
GtkCñlRídîî
 
	m∑ª¡_ö°™˚
;

47 
DüRídîî
 *
	mªndîî
;

50 
	s_DüCñlRídîîPr›îtyCœss


52 
GtkCñlRídîîCœss
 
	m∑ª¡_˛ass
;

54 (* 
	m˛icked
Ë(
DüCñlRídîîPr›îty
 *
	m˚Œ
,

55 c⁄° 
gch¨
 *
	m∑th
,

56 
GdkModifõrTy≥
 
	m°©e
);

60 
GTy≥
 
	$dü_˚Œ_ªndîî_¥›îty_gë_ty≥
 (Ë
G_GNUC_CONST
;

62 
GtkCñlRídîî
 * 
	`dü_˚Œ_ªndîî_¥›îty_√w
 ();

64 
	`dü_˚Œ_ªndîî_¥›îty_˛icked
 (
DüCñlRídîîPr›îty
 *
˚Œ
,

65 c⁄° 
gch¨
 *
∑th
,

66 
GdkModifõrTy≥
 
°©e
);

	@O:\tool\dvs50\lib\diaerror.c

19 
	~"düîr‹.h
"

26 
GQu¨k


27 
	$dü_îr‹_qu¨k
()

29 
GQu¨k
 
q
 = 0;

30 i‡(!
q
)

31 
q
 = 
	`g_qu¨k_‰om_°©ic_°rög
("dia-error-quark");

32  
q
;

33 
	}
}

	@O:\tool\dvs50\lib\diaerror.h

19 #i‚de‡
DIA_ERROR_H


20 
	#DIA_ERROR_H


	)

22 
	~<glib.h
>

23 
	~<gmoduÀ.h
>

24 
	~"düv¨.h
"

28 
	#DIA_ERROR
 
	`dü_îr‹_qu¨k
 ()

	)

33 
	mDIA_ERROR_FORMAT
,

34 
	mDIA_ERROR_FILE
,

35 
	mDIA_ERROR_DIRECTORY
,

36 } 
	tDüEº‹
;

38 
	$__de˛•ec
(
dŒexp‹t
Ë
GQu¨k
 
	`dü_îr‹_qu¨k
 ();

	@O:\tool\dvs50\lib\diagdkrenderer.c

22 
	~<c⁄fig.h
>

24 
	~<m©h.h
>

25 
	~<°dlib.h
>

26 
	~<°rög.h
>

27 
	~<gdk/gdk.h
>

29 
	#PANGO_ENABLE_ENGINE


	)

30 
	~<∑ngo/∑ngo-ígöe.h
>

31 
	~<∑ngo/∑ngo.h
>

33 
	~"dügdkªndîî.h
"

34 
	~"dü_image.h
"

35 
	~"mesßge.h
"

36 
	~"cﬁ‹.h
"

37 
	~"f⁄t.h
"

38 
	~"ãxt.h
"

39 
	~"obje˘.h
"

40 
	~"ãxéöe.h
"

42 
	~"time.h
"

44 #ifde‡
HAVE_FREETYPE


45 
	~<∑ngo/∑ngo.h
>

46 
	~<∑ngo/∑ngo·2.h
>

49 
gë_width_pixñs
 (
DüRídîî
 *);

50 
gë_height_pixñs
 (
DüRídîî
 *);

52 
begö_ªndî
 (
DüRídîî
 *);

53 
íd_ªndî
 (
DüRídîî
 *);

55 
£t_löewidth
 (
DüRídîî
 *
ªndîî
, 
ªÆ
 
löewidth
);

56 
£t_löeˇps
 (
DüRídîî
 *
ªndîî
, 
LöeC≠s
 
mode
);

57 
£t_löejoö
 (
DüRídîî
 *
ªndîî
, 
LöeJoö
 
mode
);

58 
£t_löe°yÀ
 (
DüRídîî
 *
ªndîî
, 
LöeStyÀ
 
mode
);

59 
£t_dashÀngth
 (
DüRídîî
 *
ªndîî
, 
ªÆ
 
Àngth
);

60 
£t_fûl°yÀ
 (
DüRídîî
 *
ªndîî
, 
FûlStyÀ
 
mode
);

62 
døw_löe
 (
DüRídîî
 *
ªndîî
,

63 
Poöt
 *
°¨t
, Poöà*
íd
,

64 
Cﬁ‹
 *
cﬁ‹
);

65 
fûl_pﬁyg⁄
 (
DüRídîî
 *
ªndîî
,

66 
Poöt
 *
poöts
, 
num_poöts
,

67 
Cﬁ‹
 *
cﬁ‹
);

68 
døw_¨c
 (
DüRídîî
 *
ªndîî
,

69 
Poöt
 *
˚¡î
,

70 
ªÆ
 
width
,Ñó»
height
,

71 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

72 
Cﬁ‹
 *
cﬁ‹
);

73 
fûl_¨c
 (
DüRídîî
 *
ªndîî
,

74 
Poöt
 *
˚¡î
,

75 
ªÆ
 
width
,Ñó»
height
,

76 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

77 
Cﬁ‹
 *
cﬁ‹
);

78 
døw_ñlù£
 (
DüRídîî
 *
ªndîî
,

79 
Poöt
 *
˚¡î
,

80 
ªÆ
 
width
,Ñó»
height
,

81 
Cﬁ‹
 *
cﬁ‹
);

82 
fûl_ñlù£
 (
DüRídîî
 *
ªndîî
,

83 
Poöt
 *
˚¡î
,

84 
ªÆ
 
width
,Ñó»
height
,

85 
Cﬁ‹
 *
cﬁ‹
);

86 
døw_°rög
 (
DüRídîî
 *
ªndîî
,

87 c⁄° 
gch¨
 *
ãxt
,

88 
Poöt
 *
pos
,

89 
Alignmít
 
Æignmít
,

90 
Cﬁ‹
 *
cﬁ‹
);

91 
døw_ãxt_löe
 (
DüRídîî
 *
ªndîî
,

92 
TextLöe
 *
ãxt
,

93 
Poöt
 *
pos
,

94 
Alignmít
 
Æignmít
,

95 
Cﬁ‹
 *
cﬁ‹
);

96 
døw_image
 (
DüRídîî
 *
ªndîî
,

97 
Poöt
 *
poöt
,

98 
ªÆ
 
width
,Ñó»
height
,

99 
DüImage
 *
image
);

101 
døw_ª˘
 (
DüRídîî
 *
ªndîî
,

102 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

103 
Cﬁ‹
 *
cﬁ‹
);

104 
fûl_ª˘
 (
DüRídîî
 *
ªndîî
,

105 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

106 
Cﬁ‹
 *
cﬁ‹
);

107 
døw_fûl_ª˘
 (
DüGdkRídîî
 *
ªndîî
,

108 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

109 
Cﬁ‹
 *
cﬁ‹
, 
gboﬁón
 
fûl
);

110 
døw_pﬁylöe
 (
DüRídîî
 *
ªndîî
,

111 
Poöt
 *
poöts
, 
num_poöts
,

112 
Cﬁ‹
 *
cﬁ‹
);

113 
døw_pﬁyg⁄
 (
DüRídîî
 *
ªndîî
,

114 
Poöt
 *
poöts
, 
num_poöts
,

115 
Cﬁ‹
 *
cﬁ‹
);

116 
døw_rounded_ª˘
 (
DüRídîî
 *
ªndîî
,

117 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

118 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
);

119 
fûl_rounded_ª˘
 (
DüRídîî
 *
ªndîî
,

120 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

121 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
);

122 
døw_obje˘
 (
DüRídîî
 *
ªndîî
, 
DüObje˘
 *
obje˘
);

124 
ªÆ
 
gë_ãxt_width
 (
DüRídîî
 *
ªndîî
,

125 c⁄° 
gch¨
 *
ãxt
, 
Àngth
);

127 
dü_gdk_ªndîî_˛ass_öô
 (
DüGdkRídîîCœss
 *
kœss
);

128 
ªndîî_öô
 (
DüGdkRídîî
 *
ªndîî
, *);

130 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

135 
GTy≥


136 
	$dü_gdk_ªndîî_gë_ty≥
()

138 
GTy≥
 
obje˘_ty≥
 = 0;

140 i‡(!
obje˘_ty≥
)

142 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

144  (
DüGdkRídîîCœss
),

145 (
GBa£InôFunc
Ë
NULL
,

146 (
GBa£FöÆizeFunc
Ë
NULL
,

147 (
GCœssInôFunc
Ë
dü_gdk_ªndîî_˛ass_öô
,

148 
NULL
,

149 
NULL
,

150  (
DüGdkRídîî
),

152 (
GIn°™˚InôFunc
)
ªndîî_öô


155 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
DIA_TYPE_RENDERER
,

157 &
obje˘_öfo
, 0);

160  
obje˘_ty≥
;

161 
	}
}

168 
	$ªndîî_öô
(
DüGdkRídîî
 *
ªndîî
, * 
p
)

170 
ªndîî
->
löe_width
 = 1;

171 
ªndîî
->
löe_°yÀ
 = 
GDK_LINE_SOLID
;

172 
ªndîî
->
ˇp_°yÀ
 = 
GDK_CAP_BUTT
;

173 
ªndîî
->
joö_°yÀ
 = 
GDK_JOIN_ROUND
;

175 
ªndîî
->
ßved_löe_°yÀ
 = 
LINESTYLE_SOLID
;

176 
ªndîî
->
dash_Àngth
 = 10;

177 
ªndîî
->
dŸ_Àngth
 = 2;

179 
ªndîî
->
highlight_cﬁ‹
 = 
NULL
;

180 
	}
}

186 
	$ªndîî_föÆize
(
GObje˘
 *
obje˘
)

188 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

190 i‡(
ªndîî
->
pixm≠
 !
NULL
)

191 
	`gdk_pixm≠_uƒef
(
ªndîî
->
pixm≠
);

193 i‡(
ªndîî
->
gc
 !
NULL
)

194 
	`gdk_gc_uƒef
(
ªndîî
->
gc
);

196 i‡(
ªndîî
->
˛ù_ªgi⁄
 !
NULL
)

197 
	`gdk_ªgi⁄_de°roy
(
ªndîî
->
˛ù_ªgi⁄
);

199 i‡(
ªndîî
->
å™sf‹m
)

200 
	`g_obje˘_uƒef
 (
ªndîî
->
å™sf‹m
);

202 
	`G_OBJECT_CLASS
 (
∑ª¡_˛ass
)->
	`föÆize
 (
obje˘
);

203 
	}
}

210 
	$dü_gdk_ªndîî_˛ass_öô
(
DüGdkRídîîCœss
 *
kœss
)

212 
GObje˘Cœss
 *
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
kœss
);

213 
DüRídîîCœss
 *
ªndîî_˛ass
 = 
	`DIA_RENDERER_CLASS
 (
kœss
);

215 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
kœss
);

217 
obje˘_˛ass
->
föÆize
 = 
ªndîî_föÆize
;

219 
ªndîî_˛ass
->
gë_width_pixñs
 = get_width_pixels;

220 
ªndîî_˛ass
->
gë_height_pixñs
 = get_height_pixels;

222 
ªndîî_˛ass
->
begö_ªndî
 = begin_render;

223 
ªndîî_˛ass
->
íd_ªndî
 =Énd_render;

225 
ªndîî_˛ass
->
£t_löewidth
 = set_linewidth;

226 
ªndîî_˛ass
->
£t_löeˇps
 = set_linecaps;

227 
ªndîî_˛ass
->
£t_löejoö
 = set_linejoin;

228 
ªndîî_˛ass
->
£t_löe°yÀ
 = set_linestyle;

229 
ªndîî_˛ass
->
£t_dashÀngth
 = set_dashlength;

230 
ªndîî_˛ass
->
£t_fûl°yÀ
 = set_fillstyle;

232 
ªndîî_˛ass
->
døw_löe
 = draw_line;

233 
ªndîî_˛ass
->
fûl_pﬁyg⁄
 = fill_polygon;

234 
ªndîî_˛ass
->
døw_ª˘
 = draw_rect;

235 
ªndîî_˛ass
->
fûl_ª˘
 = fill_rect;

236 
ªndîî_˛ass
->
døw_¨c
 = draw_arc;

237 
ªndîî_˛ass
->
fûl_¨c
 = fill_arc;

238 
ªndîî_˛ass
->
døw_ñlù£
 = draw_ellipse;

239 
ªndîî_˛ass
->
fûl_ñlù£
 = fill_ellipse;

243 
ªndîî_˛ass
->
døw_°rög
 = draw_string;

244 
ªndîî_˛ass
->
døw_ãxt_löe
 = draw_text_line;

245 
ªndîî_˛ass
->
døw_image
 = draw_image;

248 
ªndîî_˛ass
->
døw_ª˘
 = draw_rect;

249 
ªndîî_˛ass
->
døw_pﬁylöe
 = draw_polyline;

250 
ªndîî_˛ass
->
døw_pﬁyg⁄
 = draw_polygon;

251 
ªndîî_˛ass
->
døw_obje˘
 = draw_object;

254 
ªndîî_˛ass
->
døw_rounded_ª˘
 = draw_rounded_rect;

255 
ªndîî_˛ass
->
fûl_rounded_ª˘
 = fill_rounded_rect;

258 
ªndîî_˛ass
->
gë_ãxt_width
 = get_text_width;

259 
	}
}

269 
	$ªndîî_cﬁ‹_c⁄vît
(
DüGdkRídîî
 *
ªndîî
,

270 
Cﬁ‹
 *
cﬁ
, 
GdkCﬁ‹
 *
gdk_cﬁ
)

272 i‡(
ªndîî
->
highlight_cﬁ‹
 !
NULL
) {

273 
	`cﬁ‹_c⁄vît
(
ªndîî
->
highlight_cﬁ‹
, 
gdk_cﬁ
);

275 
	`cﬁ‹_c⁄vît
(
cﬁ
, 
gdk_cﬁ
);

277 
	}
}

280 
	$begö_ªndî
 (
DüRídîî
 *
obje˘
)

282 
	}
}

285 
	$íd_ªndî
 (
DüRídîî
 *
obje˘
)

287 
	}
}

290 
	$£t_löewidth
 (
DüRídîî
 *
obje˘
, 
ªÆ
 
löewidth
)

292 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

294 i‡(
ªndîî
->
highlight_cﬁ‹
 !
NULL
) {

296 
ªÆ
 
b‹dî
 = 
	`dü_u¡ønsf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 6);

297 
löewidth
 +
b‹dî
;

301 
ªndîî
->
löe_width
 =

302 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 
löewidth
);

304 i‡(
ªndîî
->
löe_width
<=0)

305 
ªndîî
->
löe_width
 = 1;

307 
	`gdk_gc_£t_löe_©åibuãs
(
ªndîî
->
gc
,

308 
ªndîî
->
löe_width
,

309 
ªndîî
->
löe_°yÀ
,

310 
ªndîî
->
ˇp_°yÀ
,

311 
ªndîî
->
joö_°yÀ
);

312 
	}
}

315 
	$£t_löeˇps
 (
DüRídîî
 *
obje˘
, 
LöeC≠s
 
mode
)

317 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

319 i‡(
ªndîî
->
highlight_cﬁ‹
 !
NULL
) {

320 
ªndîî
->
ˇp_°yÀ
 = 
GDK_CAP_ROUND
;

322 
mode
) {

323 
LINECAPS_BUTT
:

324 
ªndîî
->
ˇp_°yÀ
 = 
GDK_CAP_BUTT
;

326 
LINECAPS_ROUND
:

327 
ªndîî
->
ˇp_°yÀ
 = 
GDK_CAP_ROUND
;

329 
LINECAPS_PROJECTING
:

330 
ªndîî
->
ˇp_°yÀ
 = 
GDK_CAP_PROJECTING
;

335 
	`gdk_gc_£t_löe_©åibuãs
(
ªndîî
->
gc
,

336 
ªndîî
->
löe_width
,

337 
ªndîî
->
löe_°yÀ
,

338 
ªndîî
->
ˇp_°yÀ
,

339 
ªndîî
->
joö_°yÀ
);

340 
	}
}

343 
	$£t_löejoö
 (
DüRídîî
 *
obje˘
, 
LöeJoö
 
mode
)

345 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

347 i‡(
ªndîî
->
highlight_cﬁ‹
 !
NULL
) {

348 
ªndîî
->
joö_°yÀ
 = 
GDK_JOIN_ROUND
;

350 
mode
) {

351 
LINEJOIN_MITER
:

352 
ªndîî
->
joö_°yÀ
 = 
GDK_JOIN_MITER
;

354 
LINEJOIN_ROUND
:

355 
ªndîî
->
joö_°yÀ
 = 
GDK_JOIN_ROUND
;

357 
LINEJOIN_BEVEL
:

358 
ªndîî
->
joö_°yÀ
 = 
GDK_JOIN_BEVEL
;

362 
ªndîî
->
joö_°yÀ
 = 
GDK_JOIN_ROUND
;

367 
	`gdk_gc_£t_löe_©åibuãs
(
ªndîî
->
gc
,

368 
ªndîî
->
löe_width
,

369 
ªndîî
->
löe_°yÀ
,

370 
ªndîî
->
ˇp_°yÀ
,

371 
ªndîî
->
joö_°yÀ
);

372 
	}
}

379 
	$dü_gdk_ªndîî_£t_dashes
(
DüGdkRídîî
 *
ªndîî
, 
off£t
)

381 
göt8
 
dash_li°
[6];

382 
hﬁe_width
;

383 
∑âîn_Àngth
;

385 
ªndîî
->
ßved_löe_°yÀ
) {

386 
LINESTYLE_SOLID
:

388 
LINESTYLE_DASHED
:

389 
dash_li°
[0] = 
ªndîî
->
dash_Àngth
;

390 
dash_li°
[1] = 
ªndîî
->
dash_Àngth
;

391 
∑âîn_Àngth
 = 
ªndîî
->
dash_Àngth
*2;

392 
	`gdk_gc_£t_dashes
(
ªndîî
->
gc
, 
off£t
, 
dash_li°
, 2);

394 
LINESTYLE_DASH_DOT
:

395 
hﬁe_width
 = (
ªndîî
->
dash_Àngth
 -Ñídîî->
dŸ_Àngth
) / 2;

396 i‡(
hﬁe_width
==0)

397 
hﬁe_width
 = 1;

398 
dash_li°
[0] = 
ªndîî
->
dash_Àngth
;

399 
dash_li°
[1] = 
hﬁe_width
;

400 
dash_li°
[2] = 
ªndîî
->
dŸ_Àngth
;

401 
dash_li°
[3] = 
hﬁe_width
;

402 
∑âîn_Àngth
 = 
ªndîî
->
dash_Àngth
+ªndîî->
dŸ_Àngth
+2*
hﬁe_width
;

403 
	`gdk_gc_£t_dashes
(
ªndîî
->
gc
, 
off£t
, 
dash_li°
, 4);

405 
LINESTYLE_DASH_DOT_DOT
:

406 
hﬁe_width
 = (
ªndîî
->
dash_Àngth
 - 2*ªndîî->
dŸ_Àngth
) / 3;

407 i‡(
hﬁe_width
==0)

408 
hﬁe_width
 = 1;

409 
dash_li°
[0] = 
ªndîî
->
dash_Àngth
;

410 
dash_li°
[1] = 
hﬁe_width
;

411 
dash_li°
[2] = 
ªndîî
->
dŸ_Àngth
;

412 
dash_li°
[3] = 
hﬁe_width
;

413 
dash_li°
[4] = 
ªndîî
->
dŸ_Àngth
;

414 
dash_li°
[5] = 
hﬁe_width
;

415 
∑âîn_Àngth
 = 
ªndîî
->
dash_Àngth
+2*ªndîî->
dŸ_Àngth
+3*
hﬁe_width
;

416 
	`gdk_gc_£t_dashes
(
ªndîî
->
gc
, 
off£t
, 
dash_li°
, 6);

418 
LINESTYLE_DOTTED
:

419 
dash_li°
[0] = 
ªndîî
->
dŸ_Àngth
;

420 
dash_li°
[1] = 
ªndîî
->
dŸ_Àngth
;

421 
∑âîn_Àngth
 = 
ªndîî
->
dŸ_Àngth
;

422 
	`gdk_gc_£t_dashes
(
ªndîî
->
gc
, 
off£t
, 
dash_li°
, 2);

426 
	}
}

429 
	$£t_löe°yÀ
 (
DüRídîî
 *
obje˘
, 
LöeStyÀ
 
mode
)

431 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

433 
ªndîî
->
ßved_löe_°yÀ
 = 
mode
;

434 
mode
) {

435 
LINESTYLE_SOLID
:

436 
ªndîî
->
löe_°yÀ
 = 
GDK_LINE_SOLID
;

438 
LINESTYLE_DASHED
:

439 
ªndîî
->
löe_°yÀ
 = 
GDK_LINE_ON_OFF_DASH
;

440 
	`dü_gdk_ªndîî_£t_dashes
(
ªndîî
, 0);

442 
LINESTYLE_DASH_DOT
:

443 
ªndîî
->
löe_°yÀ
 = 
GDK_LINE_ON_OFF_DASH
;

444 
	`dü_gdk_ªndîî_£t_dashes
(
ªndîî
, 0);

446 
LINESTYLE_DASH_DOT_DOT
:

447 
ªndîî
->
löe_°yÀ
 = 
GDK_LINE_ON_OFF_DASH
;

448 
	`dü_gdk_ªndîî_£t_dashes
(
ªndîî
, 0);

450 
LINESTYLE_DOTTED
:

451 
ªndîî
->
löe_°yÀ
 = 
GDK_LINE_ON_OFF_DASH
;

452 
	`dü_gdk_ªndîî_£t_dashes
(
ªndîî
, 0);

455 
	`gdk_gc_£t_löe_©åibuãs
(
ªndîî
->
gc
,

456 
ªndîî
->
löe_width
,

457 
ªndîî
->
löe_°yÀ
,

458 
ªndîî
->
ˇp_°yÀ
,

459 
ªndîî
->
joö_°yÀ
);

460 
	}
}

463 
	$£t_dashÀngth
 (
DüRídîî
 *
obje˘
, 
ªÆ
 
Àngth
)

465 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

467 
ªÆ
 
ddi•_Àn
;

469 
ddi•_Àn
 =

470 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 
Àngth
);

472 
ªndîî
->
dash_Àngth
 = ()
	`Êo‹
(
ddi•_Àn
+0.5);

473 
ªndîî
->
dŸ_Àngth
 = ()
	`Êo‹
(
ddi•_Àn
*0.1+0.5);

475 i‡(
ªndîî
->
dash_Àngth
<=0)

476 
ªndîî
->
dash_Àngth
 = 1;

477 i‡(
ªndîî
->
dash_Àngth
>255)

478 
ªndîî
->
dash_Àngth
 = 255;

479 i‡(
ªndîî
->
dŸ_Àngth
<=0)

480 
ªndîî
->
dŸ_Àngth
 = 1;

481 i‡(
ªndîî
->
dŸ_Àngth
>255)

482 
ªndîî
->
dŸ_Àngth
 = 255;

483 
	`£t_löe°yÀ
(
obje˘
, 
ªndîî
->
ßved_löe_°yÀ
);

484 
	}
}

487 
	$£t_fûl°yÀ
 (
DüRídîî
 *
obje˘
, 
FûlStyÀ
 
mode
)

489 
mode
) {

490 
FILLSTYLE_SOLID
:

493 
	`mesßge_îr‹
("gdk_renderer: Unsupported fill mode specified!\n");

495 
	}
}

498 
	$døw_löe
 (
DüRídîî
 *
obje˘
, 
Poöt
 *
°¨t
, Poöà*
íd
, 
Cﬁ‹
 *
löe_cﬁ‹
)

500 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

502 
GdkGC
 *
gc
 = 
ªndîî
->gc;

503 
GdkCﬁ‹
 
cﬁ‹
;

504 
x1
,
y1
,
x2
,
y2
;

506 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
, 
°¨t
->
x
, sèπ->
y
, &
x1
, &
y1
);

507 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
, 
íd
->
x
,Énd->
y
, &
x2
, &
y2
);

509 
	`ªndîî_cﬁ‹_c⁄vît
(
ªndîî
, 
löe_cﬁ‹
, &
cﬁ‹
);

510 
	`gdk_gc_£t_f‹eground
(
gc
, &
cﬁ‹
);

512 
	`gdk_døw_löe
(
ªndîî
->
pixm≠
, 
gc
,

513 
x1
, 
y1
, 
x2
, 
y2
);

514 
	}
}

517 
	$fûl_pﬁyg⁄
 (
DüRídîî
 *
obje˘
, 
Poöt
 *
poöts
, 
num_poöts
, 
Cﬁ‹
 *
löe_cﬁ‹
)

519 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

520 
GdkGC
 *
gc
 = 
ªndîî
->gc;

521 
GdkCﬁ‹
 
cﬁ‹
;

522 
GdkPoöt
 *
gdk_poöts
;

523 
i
,
x
,
y
;

525 
gdk_poöts
 = 
	`g_√w
(
GdkPoöt
, 
num_poöts
);

527 
i
=0;i<
num_poöts
;i++) {

528 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
, 
poöts
[
i
].
x
,Öoöts[i].
y
, &x, &y);

529 
gdk_poöts
[
i
].
x
 = x;

530 
gdk_poöts
[
i
].
y
 = y;

533 
	`ªndîî_cﬁ‹_c⁄vît
(
ªndîî
, 
löe_cﬁ‹
, &
cﬁ‹
);

534 
	`gdk_gc_£t_f‹eground
(
gc
, &
cﬁ‹
);

536 
	`gdk_døw_pﬁyg⁄
(
ªndîî
->
pixm≠
, 
gc
, 
TRUE
, 
gdk_poöts
, 
num_poöts
);

537 
	`g_‰ì
(
gdk_poöts
);

538 
	}
}

541 
	$døw_fûl_¨c
 (
DüRídîî
 *
obje˘
,

542 
Poöt
 *
˚¡î
,

543 
ªÆ
 
width
,Ñó»
height
,

544 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

545 
Cﬁ‹
 *
cﬁ‹
,

546 
gboﬁón
 
fûl
)

548 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

549 
GdkGC
 *
gc
 = 
ªndîî
->gc;

550 
GdkCﬁ‹
 
gdkcﬁ‹
;

551 
göt
 
t›
, 
À·
, 
bŸtom
, 
right
;

552 
ªÆ
 
d™gÀ
;

554 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
,

555 
˚¡î
->
x
 - 
width
/2, cíãr->
y
 - 
height
/2,

556 &
À·
, &
t›
);

557 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
,

558 
˚¡î
->
x
 + 
width
/2, cíãr->
y
 + 
height
/2,

559 &
right
, &
bŸtom
);

561 i‡((
À·
>
right
Ë|| (
t›
>
bŸtom
))

564 
	`ªndîî_cﬁ‹_c⁄vît
(
ªndîî
, 
cﬁ‹
, &
gdkcﬁ‹
);

565 
	`gdk_gc_£t_f‹eground
(
gc
, &
gdkcﬁ‹
);

567 
d™gÀ
 = 
™gÀ2
-
™gÀ1
;

568 i‡(
d™gÀ
<0)

569 
d™gÀ
 += 360.0;

571 
	`gdk_døw_¨c
(
ªndîî
->
pixm≠
,

572 
gc
, 
fûl
,

573 
À·
, 
t›
, 
right
-À·, 
bŸtom
-top,

574 (Ë(
™gÀ1
*64.0), (Ë(
d™gÀ
*64.0));

575 
	}
}

577 
	$døw_¨c
 (
DüRídîî
 *
obje˘
,

578 
Poöt
 *
˚¡î
,

579 
ªÆ
 
width
,Ñó»
height
,

580 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

581 
Cﬁ‹
 *
cﬁ‹
)

583 
	`døw_fûl_¨c
 (
obje˘
, 
˚¡î
, 
width
, 
height
, 
™gÀ1
, 
™gÀ2
, 
cﬁ‹
, 
FALSE
);

584 
	}
}

587 
	$fûl_¨c
 (
DüRídîî
 *
obje˘
, 
Poöt
 *
˚¡î
,

588 
ªÆ
 
width
,Ñó»
height
,Ñó»
™gÀ1
,Ñó»
™gÀ2
,

589 
Cﬁ‹
 *
cﬁ‹
)

591 
	`døw_fûl_¨c
 (
obje˘
, 
˚¡î
, 
width
, 
height
, 
™gÀ1
, 
™gÀ2
, 
cﬁ‹
, 
TRUE
);

592 
	}
}

595 
	$døw_ñlù£
 (
DüRídîî
 *
obje˘
, 
Poöt
 *
˚¡î
,

596 
ªÆ
 
width
,Ñó»
height
,

597 
Cﬁ‹
 *
cﬁ‹
)

599 
	`døw_¨c
(
obje˘
, 
˚¡î
, 
width
, 
height
, 0.0, 360.0, 
cﬁ‹
);

600 
	}
}

603 
	$fûl_ñlù£
 (
DüRídîî
 *
obje˘
, 
Poöt
 *
˚¡î
,

604 
ªÆ
 
width
,Ñó»
height
, 
Cﬁ‹
 *
cﬁ‹
)

606 
	`fûl_¨c
(
obje˘
, 
˚¡î
, 
width
, 
height
, 0.0, 360.0, 
cﬁ‹
);

607 
	}
}

612 
	$døw_highlighãd_°rög
(
DüGdkRídîî
 *
ªndîî
,

613 
P™goLayout
 *
œyout
,

614 
x
, 
y
,

615 
GdkCﬁ‹
 *
cﬁ‹
)

617 
göt
 
width
, 
height
;

619 
	`∑ngo_œyout_gë_pixñ_size
(
œyout
, &
width
, &
height
);

621 
	`gdk_gc_£t_f‹eground
(
ªndîî
->
gc
, 
cﬁ‹
);

623 
	`gdk_døw_ª˘™gÀ
 (
ªndîî
->
pixm≠
,

624 
ªndîî
->
gc
, 
TRUE
,

625 
x
-3, 
y
-3,

626 
width
+6, 
height
+6);

627 
	}
}

630 
	$døw_°rög
 (
DüRídîî
 *
obje˘
,

631 c⁄° 
gch¨
 *
ãxt
, 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
,

632 
Cﬁ‹
 *
cﬁ‹
)

634 
TextLöe
 *
ãxt_löe
 = 
	`ãxt_löe_√w
(
ãxt
, 
obje˘
->
f⁄t
, obje˘->
f⁄t_height
);

635 
	`døw_ãxt_löe
(
obje˘
, 
ãxt_löe
, 
pos
, 
Æignmít
, 
cﬁ‹
);

636 
	`ãxt_löe_de°roy
(
ãxt_löe
);

637 
	}
}

639 #ifde‡
HAVE_FREETYPE


641 
	$öôülize_·_bôm≠
(
FT_Bôm≠
 *
·bôm≠
, 
width
, 
height
)

643 
row°ride
 = 32*((
width
+31)/31);

644 
guöt8
 *
gøybôm≠
 = (guöt8*)
	`g_√w0
(guöt8, 
height
*
row°ride
);

646 
·bôm≠
->
rows
 = 
height
;

647 
·bôm≠
->
width
 = width;

648 
·bôm≠
->
pôch
 = 
row°ride
;

649 
·bôm≠
->
buf„r
 = 
gøybôm≠
;

650 
·bôm≠
->
num_gøys
 = 256;

651 
·bôm≠
->
pixñ_mode
 = 
·_pixñ_mode_gøys
;

652 
·bôm≠
->
∑Àâe_mode
 = 0;

653 
·bôm≠
->
∑Àâe
 = 0;

654 
	}
}

664 
	$døw_ãxt_löe
 (
DüRídîî
 *
obje˘
, 
TextLöe
 *
ãxt_löe
,

665 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
, 
Cﬁ‹
 *
cﬁ‹
)

667 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

668 
GdkCﬁ‹
 
gdkcﬁ‹
;

669 
x
,
y
;

670 
Poöt
 
°¨t_pos
;

671 
P™goLayout
* 
œyout
 = 
NULL
;

672 c⁄° 
gch¨
 *
ãxt
 = 
	`ãxt_löe_gë_°rög
(
ãxt_löe
);

673 
height_pixñs
;

674 
ªÆ
 
f⁄t_height
 = 
	`ãxt_löe_gë_height
(
ãxt_löe
);

675 
ªÆ
 
sˇÀ
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 1.0);

677 i‡(
ãxt
 =
NULL
 || *text == '\0') ;

679 
	`poöt_c›y
(&
°¨t_pos
,
pos
);

681 
	`ªndîî_cﬁ‹_c⁄vît
(
ªndîî
, 
cﬁ‹
, &
gdkcﬁ‹
);

683 
height_pixñs
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 
f⁄t_height
);

684 i‡(
height_pixñs
 < 2) {

685 
width_pixñs
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
,

686 
	`ãxt_löe_gë_width
(
ãxt_löe
));

687 
	`gdk_gc_£t_f‹eground
(
ªndîî
->
gc
, &
gdkcﬁ‹
);

688 
	`gdk_gc_£t_dashes
(
ªndîî
->
gc
, 0, (
guöt8
*)"\1\2", 2);

689 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
, 
°¨t_pos
.
x
, sèπ_pos.
y
, &x, &y);

690 
	`gdk_døw_löe
(
ªndîî
->
pixm≠
,Ñídîî->
gc
, 
x
, 
y
, x + 
width_pixñs
, y);

693 
°¨t_pos
.
y
 -
	`ãxt_löe_gë_as˚¡
(
ãxt_löe
);

694 
°¨t_pos
.
x
 -
	`ãxt_löe_gë_Æignmít_adju°mít
 (
ãxt_löe
, 
Æignmít
);

696 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
,

697 
°¨t_pos
.
x
, sèπ_pos.
y
, &x, &y);

699 
œyout
 = 
	`dü_f⁄t_buûd_œyout
(
ãxt
, 
ãxt_löe
->
f⁄t
,

700 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 
ãxt_löe
->
height
)/20.0);

701 #i‡
	`deföed
(
PANGO_VERSION_ENCODE
)

702 #i‡(
PANGO_VERSION
 >
	`PANGO_VERSION_ENCODE
(1,16,0))

704 
	#HAVE_∑ngo_œyout_gë_löe_ªad⁄ly


	)

707 
	`ãxt_löe_adju°_œyout_löe
 (
ãxt_löe
,

708 #i‡
	`deföed
(
HAVE_∑ngo_œyout_gë_löe_ªad⁄ly
)

709 
	`∑ngo_œyout_gë_löe_ªad⁄ly
(
œyout
, 0),

711 
	`∑ngo_œyout_gë_löe
(
œyout
, 0),

713 
sˇÀ
/20.0);

715 i‡(
ªndîî
->
highlight_cﬁ‹
 !
NULL
) {

716 
	`døw_highlighãd_°rög
(
ªndîî
, 
œyout
, 
x
, 
y
, &
gdkcﬁ‹
);

718 #i‡
deföed
 
HAVE_FREETYPE


720 
FT_Bôm≠
 
·bôm≠
;

721 
width
, 
height
;

722 
GdkPixbuf
 *
rgba
 = 
NULL
;

724 
width
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
,

725 
	`ãxt_löe_gë_width
(
ãxt_löe
));

726 
height
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
,

727 
	`ãxt_löe_gë_height
(
ãxt_löe
));

729 i‡(
width
 > 0) {

730 
°ride
;

731 
guch¨
* 
pixñs
;

732 
i
,
j
;

733 
guöt8
 *
gøybôm≠
;

735 
	`öôülize_·_bôm≠
(&
·bôm≠
, 
width
, 
height
);

736 
	`∑ngo_·2_ªndî_œyout
(&
·bôm≠
, 
œyout
, 0, 0);

738 
gøybôm≠
 = 
·bôm≠
.
buf„r
;

740 
rgba
 = 
	`gdk_pixbuf_√w
(
GDK_COLORSPACE_RGB
, 
TRUE
, 8, 
width
, 
height
);

741 
°ride
 = 
	`gdk_pixbuf_gë_row°ride
(
rgba
);

742 
pixñs
 = 
	`gdk_pixbuf_gë_pixñs
(
rgba
);

743 
i
 = 0; i < 
height
; i++) {

744 
j
 = 0; j < 
width
; j++) {

745 
pixñs
[
i
*
°ride
+
j
*4] = 
gdkcﬁ‹
.
ªd
>>8;

746 
pixñs
[
i
*
°ride
+
j
*4+1] = 
gdkcﬁ‹
.
gªí
>>8;

747 
pixñs
[
i
*
°ride
+
j
*4+2] = 
gdkcﬁ‹
.
blue
>>8;

748 
pixñs
[
i
*
°ride
+
j
*4+3] = 
gøybôm≠
[i*
·bôm≠
.
pôch
+j];

751 
	`g_‰ì
(
gøybôm≠
);

753 
	`gdk_døw_pixbuf
(
ªndîî
->
pixm≠
,Ñídîî->
gc
, 
rgba
, 0, 0, 
x
, 
y
, 
width
, 
height
, 
GDK_RGB_DITHER_NONE
, 0, 0);

755 
	`g_obje˘_uƒef
(
	`G_OBJECT
(
rgba
));

759 
	`gdk_gc_£t_f‹eground
(
ªndîî
->
gc
, &
gdkcﬁ‹
);

761 
	`gdk_døw_œyout
(
ªndîî
->
pixm≠
,Ñídîî->
gc
, 
x
, 
y
, 
œyout
);

764 
	`g_obje˘_uƒef
(
	`G_OBJECT
(
œyout
));

766 
	}
}

769 
ªÆ


770 
	$gë_ãxt_width
(
DüRídîî
 *
obje˘
,

771 c⁄° 
gch¨
 *
ãxt
, 
Àngth
)

773 
ªÆ
 
ªsu…
;

774 
TextLöe
 *
ãxt_löe
;

776 i‡(
Àngth
 !
	`g_utf8_°æí
(
ãxt
, -1)) {

777 *
Ÿhîtx
;

778 
uÀn
;

780 
uÀn
 = 
	`g_utf8_off£t_to_poöãr
(
ãxt
, 
Àngth
)-text;

781 i‡(!
	`g_utf8_vÆid©e
(
ãxt
, 
uÀn
, 
NULL
)) {

782 
	`g_w¨nög
 ("Texà© ch¨ %dÇŸ vÆid\n", 
Àngth
);

784 
Ÿhîtx
 = 
	`g_°∫dup
(
ãxt
, 
uÀn
);

785 
ãxt_löe
 = 
	`ãxt_löe_√w
(
Ÿhîtx
, 
obje˘
->
f⁄t
, obje˘->
f⁄t_height
);

787 
ãxt_löe
 = 
	`ãxt_löe_√w
(
ãxt
, 
obje˘
->
f⁄t
, obje˘->
f⁄t_height
);

789 
ªsu…
 = 
	`ãxt_löe_gë_width
(
ãxt_löe
);

790 
	`ãxt_löe_de°roy
(
ãxt_löe
);

791  
ªsu…
;

792 
	}
}

795 
	$døw_image
 (
DüRídîî
 *
obje˘
,

796 
Poöt
 *
poöt
,

797 
ªÆ
 
width
,Ñó»
height
,

798 
DüImage
 *
image
)

800 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

801 i‡(
ªndîî
->
highlight_cﬁ‹
 !
NULL
) {

802 
Poöt
 
Ã
;

803 
DüRídîîCœss
 *
£lf_˛ass
 = 
	`DIA_RENDERER_GET_CLASS
 (
obje˘
);

805 
Ã
 = *
poöt
;

806 
Ã
.
x
 +
width
;

807 
Ã
.
y
 +
height
;

808 
£lf_˛ass
->
	`fûl_ª˘
(
obje˘
, 
poöt
, &
Ã
, 
ªndîî
->
highlight_cﬁ‹
);

810 
ªÆ_width
, 
ªÆ_height
, 
ªÆ_x
, 
ªÆ_y
;

811 c⁄° 
GdkPixbuf
 *
‹g
 = 
	`dü_image_pixbuf
 (
image
);

812 
‹g_width
 = 
	`gdk_pixbuf_gë_width
(
‹g
);

813 
‹g_height
 = 
	`gdk_pixbuf_gë_height
(
‹g
);

815 
ªÆ_width
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 
width
);

816 
ªÆ_height
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 
height
);

817 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
, 
poöt
->
x
,Öoöt->
y
,

818 &
ªÆ_x
, &
ªÆ_y
);

820 i‡(
ªÆ_width
 =
‹g_width
 && 
ªÆ_height
 =
‹g_height
) {

821 
	`gdk_døw_pixbuf
(
ªndîî
->
pixm≠
,Ñídîî->
gc
, (
GdkPixbuf
 *)
‹g
,

822 0, 0, 
ªÆ_x
, 
ªÆ_y
, 
ªÆ_width
, 
ªÆ_height
,

823 
GDK_RGB_DITHER_NORMAL
, 0, 0);

824 } i‡(
ªÆ_width
 > 
‹g_width
 || 
ªÆ_height
 > 
‹g_height
) {

826 
sub_width
 = 
ªÆ_width
 - (
ªÆ_x
 >= 0 ? 0 : -real_x);

827 
sub_height
 = 
ªÆ_height
 - (
ªÆ_y
 >= 0 ? 0 : -real_y);

830 i‡(
	`gë_width_pixñs
 (
obje˘
Ë< 
sub_width
)

831 
sub_width
 = 
	`gë_width_pixñs
 (
obje˘
);

832 i‡(
	`gë_height_pixñs
 (
obje˘
Ë< 
sub_height
)

833 
sub_height
 = 
	`gë_height_pixñs
 (
obje˘
);

835 i‡(
sub_height
 > 0 && 
sub_width
 > 0) {

836 
GdkPixbuf
 *
sˇÀd
 = 
	`gdk_pixbuf_√w
 (
	`gdk_pixbuf_gë_cﬁ‹•a˚
 (
‹g
),

837 
	`gdk_pixbuf_gë_has_Æpha
 (
‹g
),

838 
	`gdk_pixbuf_gë_bôs_≥r_ßm∂e
 (
‹g
),

839 
sub_width
, 
sub_height
);

840 
sˇÀ_x
 = ()
ªÆ_width
/
‹g_width
;

841 
sˇÀ_y
 = ()
ªÆ_height
/
‹g_height
;

842 
	`gdk_pixbuf_sˇÀ
 (
‹g
, 
sˇÀd
,

843 0, 0, 
sub_width
, 
sub_height
,

844 
ªÆ_x
 >0 ? 0 :Ñól_x, 
ªÆ_y
 >= 0 ? 0 :Ñeal_y,

845 
sˇÀ_x
, 
sˇÀ_y
, 
GDK_INTERP_TILES
);

846 
	`gdk_døw_pixbuf
(
ªndîî
->
pixm≠
,Ñídîî->
gc
, 
sˇÀd
,

847 0, 0, 
ªÆ_x
 >0 ?Ñól_x : 0, 
ªÆ_y
 >= 0 ?Ñeal_y : 0,

848 
sub_width
, 
sub_height
, 
GDK_RGB_DITHER_NORMAL
, 0, 0);

849 
	`g_obje˘_uƒef
 (
sˇÀd
);

853 
	`dü_image_døw
(
image
, 
ªndîî
->
pixm≠
,Ñídîî->
gc
, 
ªÆ_x
, 
ªÆ_y
,

854 
ªÆ_width
, 
ªÆ_height
);

857 
	}
}

863 
	$døw_fûl_ª˘
 (
DüGdkRídîî
 *
ªndîî
,

864 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

865 
Cﬁ‹
 *
cﬁ‹
, 
gboﬁón
 
fûl
)

867 
GdkGC
 *
gc
 = 
ªndîî
->gc;

868 
GdkCﬁ‹
 
gdkcﬁ‹
;

869 
göt
 
t›
, 
bŸtom
, 
À·
, 
right
;

871 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
,

872 
ul_c‹√r
->
x
, ul_c‹√r->
y
, &
À·
, &
t›
);

873 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
,

874 
Ã_c‹√r
->
x
,Ür_c‹√r->
y
, &
right
, &
bŸtom
);

876 i‡((
À·
>
right
Ë|| (
t›
>
bŸtom
))

879 
	`ªndîî_cﬁ‹_c⁄vît
(
ªndîî
, 
cﬁ‹
, &
gdkcﬁ‹
);

880 
	`gdk_gc_£t_f‹eground
(
gc
, &
gdkcﬁ‹
);

882 
	`gdk_døw_ª˘™gÀ
 (
ªndîî
->
pixm≠
,

883 
gc
, 
fûl
,

884 
À·
, 
t›
,

885 
right
-
À·
,

886 
bŸtom
-
t›
);

887 
	}
}

890 
	$døw_ª˘
 (
DüRídîî
 *
obje˘
,

891 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

892 
Cﬁ‹
 *
cﬁ‹
)

894 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

896 
	`døw_fûl_ª˘
 (
ªndîî
, 
ul_c‹√r
, 
Ã_c‹√r
, 
cﬁ‹
, 
FALSE
);

897 
	}
}

900 
	$fûl_ª˘
 (
DüRídîî
 *
obje˘
,

901 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

902 
Cﬁ‹
 *
cﬁ‹
)

904 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

906 
	`døw_fûl_ª˘
 (
ªndîî
, 
ul_c‹√r
, 
Ã_c‹√r
, 
cﬁ‹
, 
TRUE
);

907 
	}
}

910 
	$døw_pﬁylöe
 (
DüRídîî
 *
£lf
,

911 
Poöt
 *
poöts
, 
num_poöts
,

912 
Cﬁ‹
 *
löe_cﬁ‹
)

914 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

915 
GdkGC
 *
gc
 = 
ªndîî
->gc;

916 
GdkCﬁ‹
 
cﬁ‹
;

917 
GdkPoöt
 *
gdk_poöts
;

918 
i
,
x
,
y
;

920 
gdk_poöts
 = 
	`g_√w
(
GdkPoöt
, 
num_poöts
);

922 
i
=0;i<
num_poöts
;i++) {

923 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
, 
poöts
[
i
].
x
,Öoöts[i].
y
, &x, &y);

924 
gdk_poöts
[
i
].
x
 = x;

925 
gdk_poöts
[
i
].
y
 = y;

928 
	`ªndîî_cﬁ‹_c⁄vît
(
ªndîî
, 
löe_cﬁ‹
, &
cﬁ‹
);

929 
	`gdk_gc_£t_f‹eground
(
gc
, &
cﬁ‹
);

931 
	`gdk_døw_löes
(
ªndîî
->
pixm≠
, 
gc
, 
gdk_poöts
, 
num_poöts
);

932 
	`g_‰ì
(
gdk_poöts
);

933 
	}
}

936 
	$døw_pﬁyg⁄
 (
DüRídîî
 *
£lf
,

937 
Poöt
 *
poöts
, 
num_poöts
,

938 
Cﬁ‹
 *
löe_cﬁ‹
)

940 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

941 
GdkGC
 *
gc
 = 
ªndîî
->gc;

942 
GdkCﬁ‹
 
cﬁ‹
;

943 
GdkPoöt
 *
gdk_poöts
;

944 
i
,
x
,
y
;

946 
gdk_poöts
 = 
	`g_√w
(
GdkPoöt
, 
num_poöts
);

948 
i
=0;i<
num_poöts
;i++) {

949 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
, 
poöts
[
i
].
x
,Öoöts[i].
y
, &x, &y);

950 
gdk_poöts
[
i
].
x
 = x;

951 
gdk_poöts
[
i
].
y
 = y;

954 
	`ªndîî_cﬁ‹_c⁄vît
(
ªndîî
, 
löe_cﬁ‹
, &
cﬁ‹
);

955 
	`gdk_gc_£t_f‹eground
(
gc
, &
cﬁ‹
);

957 
	`gdk_døw_pﬁyg⁄
(
ªndîî
->
pixm≠
, 
gc
, 
FALSE
, 
gdk_poöts
, 
num_poöts
);

958 
	`g_‰ì
(
gdk_poöts
);

959 
	}
}

966 
	$døw_fûl_rounded_ª˘
 (
DüRídîî
 *
£lf
,

967 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

968 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
,

969 
gboﬁón
 
fûl
)

971 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

972 
GdkGC
 *
gc
 = 
ªndîî
->gc;

973 
GdkCﬁ‹
 
gdkcﬁ‹
;

974 
göt
 
t›
, 
bŸtom
, 
À·
, 
right
, 
r
, 
d
;

975 
göt
 
off£t
 = 0;

977 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
,

978 
ul_c‹√r
->
x
, ul_c‹√r->
y
, &
À·
, &
t›
);

979 
	`dü_å™sf‹m_co‹ds
(
ªndîî
->
å™sf‹m
,

980 
Ã_c‹√r
->
x
,Ür_c‹√r->
y
, &
right
, &
bŸtom
);

981 
r
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 
ødius
);

983 i‡((
À·
>
right
Ë|| (
t›
>
bŸtom
))

986 i‡(
r
>(
right
-
À·
)/2)

987 
r
 = (
right
-
À·
)/2;

988 i‡(
r
>(
bŸtom
-
t›
)/2)

989 
r
 = (
bŸtom
-
t›
)/2;

991 
d
 = 
r
<<1;

993 i‡(
ªndîî
->
löe_width
 > 
d
)

994 
off£t
 = (
ªndîî
->
löe_width
 + 1) / 2;

996 
	`ªndîî_cﬁ‹_c⁄vît
(
ªndîî
, 
cﬁ‹
, &
gdkcﬁ‹
);

997 
	`gdk_gc_£t_f‹eground
(
gc
, &
gdkcﬁ‹
);

999 i‡(
d
 > 0) {

1000 i‡(
off£t
 > 0) {

1002 
	`gdk_gc_£t_löe_©åibuãs
(
ªndîî
->
gc
,

1003 
r
, 
ªndîî
->
löe_°yÀ
,

1004 
ªndîî
->
ˇp_°yÀ
,Ñídîî->
joö_°yÀ
);

1005 
	`gdk_døw_¨c
(
ªndîî
->
pixm≠
, 
gc
, 
TRUE
, 
À·
-
off£t
, 
t›
-off£t, 
d
, d, 90<<6, 90<<6);

1006 
	`gdk_døw_¨c
(
ªndîî
->
pixm≠
, 
gc
, 
TRUE
, 
right
-
d
+
off£t
, 
t›
-offset, d, d, 0<<6, 90<<6);

1007 
	`gdk_døw_¨c
(
ªndîî
->
pixm≠
, 
gc
, 
TRUE
, 
right
-
d
+
off£t
, 
bŸtom
-d+offset, d, d, 270<<6, 90<<6);

1008 
	`gdk_døw_¨c
(
ªndîî
->
pixm≠
, 
gc
, 
TRUE
, 
À·
-
off£t
, 
bŸtom
-
d
+offset, d, d, 180<<6, 90<<6);

1009 
	`gdk_gc_£t_löe_©åibuãs
(
ªndîî
->
gc
,

1010 
ªndîî
->
löe_width
,Ñídîî->
löe_°yÀ
,

1011 
ªndîî
->
ˇp_°yÀ
,Ñídîî->
joö_°yÀ
);

1013 
	`gdk_døw_¨c
(
ªndîî
->
pixm≠
, 
gc
, 
fûl
, 
À·
, 
t›
, 
d
, d, 90<<6, 90<<6);

1014 
	`gdk_døw_¨c
(
ªndîî
->
pixm≠
, 
gc
, 
fûl
, 
right
-
d
, 
t›
, d, d, 0<<6, 90<<6);

1015 
	`gdk_døw_¨c
(
ªndîî
->
pixm≠
, 
gc
, 
fûl
, 
right
-
d
, 
bŸtom
-d, d, d, 270<<6, 90<<6);

1016 
	`gdk_døw_¨c
(
ªndîî
->
pixm≠
, 
gc
, 
fûl
, 
À·
, 
bŸtom
-
d
, d, d, 180<<6, 90<<6);

1020 i‡(
fûl
) {

1021 
	`gdk_døw_ª˘™gÀ
 (
ªndîî
->
pixm≠
,Ñídîî->
gc
, 
TRUE
,

1022 
À·
+
r
-
off£t
, 
t›
, 
right
-À·-
d
+off£t, 
bŸtom
-top);

1023 
	`gdk_døw_ª˘™gÀ
 (
ªndîî
->
pixm≠
,Ñídîî->
gc
, 
TRUE
,

1024 
À·
, 
t›
+
r
-
off£t
, 
right
-À·, 
bŸtom
-t›-
d
+offset);

1026 
	`gdk_døw_löe
(
ªndîî
->
pixm≠
, 
gc
, 
À·
+
r
-
off£t
, 
t›
, 
right
-r+offset,Åop);

1027 
	`gdk_døw_löe
(
ªndîî
->
pixm≠
, 
gc
, 
right
, 
t›
+
r
-
off£t
,Ñight, 
bŸtom
-r+offset);

1028 
	`gdk_døw_löe
(
ªndîî
->
pixm≠
, 
gc
, 
right
-
r
+
off£t
, 
bŸtom
, 
À·
+r-1-offset, bottom);

1029 
	`gdk_døw_löe
(
ªndîî
->
pixm≠
, 
gc
, 
À·
, 
bŸtom
-
r
+
off£t
,Üe·, 
t›
+r-1-offset);

1031 
	}
}

1033 
	$døw_rounded_ª˘
 (
DüRídîî
 *
£lf
,

1034 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

1035 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
)

1037 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

1038 
göt
 
r
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 
ødius
);

1040 i‡(
r
 > 0)

1041 
	`døw_fûl_rounded_ª˘
 (
£lf
, 
ul_c‹√r
, 
Ã_c‹√r
, 
cﬁ‹
, 
ødius
, 
FALSE
);

1043 
	`døw_ª˘
 (
£lf
, 
ul_c‹√r
, 
Ã_c‹√r
, 
cﬁ‹
);

1044 
	}
}

1046 
	$fûl_rounded_ª˘
 (
DüRídîî
 *
£lf
,

1047 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

1048 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
)

1050 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

1051 
göt
 
r
 = 
	`dü_å™sf‹m_Àngth
(
ªndîî
->
å™sf‹m
, 
ødius
);

1053 i‡(
r
 > 0)

1054 
	`døw_fûl_rounded_ª˘
 (
£lf
, 
ul_c‹√r
, 
Ã_c‹√r
, 
cﬁ‹
, 
ødius
, 
TRUE
);

1056 
	`fûl_ª˘
 (
£lf
, 
ul_c‹√r
, 
Ã_c‹√r
, 
cﬁ‹
);

1057 
	}
}

1060 
	$døw_obje˘
 (
DüRídîî
 *
ªndîî
, 
DüObje˘
 *
obje˘
)

1062 i‡(
ªndîî
->
is_öãø˘ive
 &&

1063 
obje˘
->
highlight_cﬁ‹
 !
NULL
) {

1064 
DüGdkRídîî
 *
gdk_ªnd
 = 
	`DIA_GDK_RENDERER
(
ªndîî
);

1065 
gdk_ªnd
->
highlight_cﬁ‹
 = 
obje˘
->highlight_color;

1066 
obje˘
->
›s
->
	`døw
(obje˘, 
ªndîî
);

1067 
gdk_ªnd
->
highlight_cﬁ‹
 = 
NULL
;

1069 
obje˘
->
›s
->
	`døw
(obje˘, 
ªndîî
);

1070 
	}
}

1073 
	$gë_width_pixñs
 (
DüRídîî
 *
obje˘
)

1075 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

1076 
width
 = 0;

1078 i‡(
ªndîî
->
pixm≠
)

1079 
	`gdk_døwabÀ_gë_size
 (
	`GDK_DRAWABLE
 (
ªndîî
->
pixm≠
), &
width
, 
NULL
);

1081  
width
;

1082 
	}
}

1085 
	$gë_height_pixñs
 (
DüRídîî
 *
obje˘
)

1087 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
obje˘
);

1088 
height
 = 0;

1090 i‡(
ªndîî
->
pixm≠
)

1091 
	`gdk_døwabÀ_gë_size
 (
	`GDK_DRAWABLE
 (
ªndîî
->
pixm≠
), 
NULL
, &
height
);

1093  
height
;

1094 
	}
}

	@O:\tool\dvs50\lib\diagdkrenderer.h

1 #i‚de‡
DIA_GDK_RENDERER_H


2 
	#DIA_GDK_RENDERER_H


	)

4 
	~"düty≥s.h
"

5 
	~<gdk/gdk.h
>

6 
	~"düªndîî.h
"

7 
	~"düå™sf‹m.h
"

9 
	gG_BEGIN_DECLS


11 
	#DIA_TYPE_GDK_RENDERER
 (
	`dü_gdk_ªndîî_gë_ty≥
 ())

	)

12 
	#DIA_GDK_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_GDK_RENDERER
, 
DüGdkRídîî
))

	)

13 
	#DIA_GDK_RENDERER_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_GDK_RENDERER
, 
DüGdkRídîîCœss
))

	)

14 
	#DIA_IS_GDK_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_GDK_RENDERER
))

	)

15 
	#DIA_GDK_RENDERER_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_GDK_RENDERER
, 
DüGdkRídîîCœss
))

	)

17 
DIAVAR
 
GTy≥
 
	$dü_gdk_ªndîî_gë_ty≥
 (Ë
G_GNUC_CONST
;

18 
DIAVAR
 
	`dü_gdk_ªndîî_£t_dashes
(
DüGdkRídîî
 *
ªndîî
, 
off£t
);

20 
	s_DüGdkRídîî


22 
DüRídîî
 
∑ª¡_ö°™˚
;

25 
DüTønsf‹m
 *
å™sf‹m
;

26 
GdkPixm≠
 *
pixm≠
;

27 
guöt32
 
width
;

28 
guöt32
 
height
;

29 
GdkGC
 *
gc
;

30 
GdkRegi⁄
 *
˛ù_ªgi⁄
;

33 
löe_width
;

34 
GdkLöeStyÀ
 
löe_°yÀ
;

35 
GdkC≠StyÀ
 
ˇp_°yÀ
;

36 
GdkJoöStyÀ
 
joö_°yÀ
;

38 
LöeStyÀ
 
ßved_löe_°yÀ
;

39 
dash_Àngth
;

40 
dŸ_Àngth
;

43 
Cﬁ‹
 *
highlight_cﬁ‹
;

46 
	s_DüGdkRídîîCœss


48 
DüRídîîCœss
 
∑ª¡_˛ass
;

51 
G_END_DECLS


	@O:\tool\dvs50\lib\diagramdata.c

23 #ifde‡
HAVE_CONFIG_H


24 
	~<c⁄fig.h
>

27 
	~"öé.h
"

28 
	~"dügømd©a.h
"

29 
	~"düªndîî.h
"

30 
	~"∑≥r.h
"

31 
	~"≥rsi°í˚.h
"

33 
	~"dy«mic_obj.h
"

34 
	~"düm¨shÆ.h
"

37 c⁄° 
Re˘™gÀ
 
	gövÆid_exã¡s
 = { -1.0,-1.0,-1.0,-1.0 };

39 
dügøm_d©a_˛ass_öô
 (
DügømD©aCœss
 *
kœss
);

40 
dügøm_d©a_öô
 (
DügømD©a
 *
obje˘
);

43 
	mOBJECT_ADD
,

44 
	mOBJECT_REMOVE
,

45 
	mLAST_SIGNAL


48 
guöt
 
	gdügøm_d©a_sig«ls
[
LAST_SIGNAL
] = { 0, };

50 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

54 
GTy≥


55 
	$dügøm_d©a_gë_ty≥
()

57 
GTy≥
 
obje˘_ty≥
 = 0;

59 i‡(!
obje˘_ty≥
)

61 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

63  (
DügømD©aCœss
),

64 (
GBa£InôFunc
Ë
NULL
,

65 (
GBa£FöÆizeFunc
Ë
NULL
,

66 (
GCœssInôFunc
Ë
dügøm_d©a_˛ass_öô
,

67 
NULL
,

68 
NULL
,

69  (
DügømD©a
),

71 (
GIn°™˚InôFunc
)
dügøm_d©a_öô


74 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
G_TYPE_OBJECT
,

76 &
obje˘_öfo
, 0);

79  
obje˘_ty≥
;

80 
	}
}

84 
	$_dügøm_d©a_obje˘_add
 (
DügømD©a
* 
dü
,
Layî
* 
œyî
,
DüObje˘
* 
obj
)

86 
	}
}

89 
	$_dügøm_d©a_obje˘_ªmove
 (
DügømD©a
* 
dü
,
Layî
* 
œyî
,
DüObje˘
* 
obj
)

91 
	}
}

97 
	$dügøm_d©a_öô
(
DügømD©a
 *
d©a
)

99 
Cﬁ‹
* 
cﬁ‹
 = 
	`≥rsi°í˚_ªgi°î_cﬁ‹
 ("√w_dügøm_bgcﬁour", &
cﬁ‹_whôe
);

100 
gboﬁón
 
com¥ess
 = 
	`≥rsi°í˚_ªgi°î_boﬁón
 ("com¥ess_ßve", 
TRUE
);

101 
Layî
 *
fú°_œyî
;

103 
d©a
->
exã¡s
.
À·
 = 0.0;

104 
d©a
->
exã¡s
.
right
 = 10.0;

105 
d©a
->
exã¡s
.
t›
 = 0.0;

106 
d©a
->
exã¡s
.
bŸtom
 = 10.0;

108 
d©a
->
bg_cﬁ‹
 = *
cﬁ‹
;

110 
	`gë_∑≥r_öfo
 (&
d©a
->
∑≥r
, -1, 
NULL
);

112 
fú°_œyî
 = 
	`√w_œyî
(
	`g_°rdup
(
	`_
("Background")),
d©a
);

114 
d©a
->
œyîs
 = 
	`g_±r_¨øy_√w
 ();

115 
	`g_±r_¨øy_add
 (
d©a
->
œyîs
, 
fú°_œyî
);

116 
d©a
->
a˘ive_œyî
 = 
fú°_œyî
;

118 
d©a
->
£À˘ed_cou¡_¥iv©e
 = 0;

119 
d©a
->
£À˘ed
 = 
NULL
;

121 
d©a
->
is_com¥es£d
 = 
com¥ess
;

123 
d©a
->
ãxt_edôs
 = 
NULL
;

124 
d©a
->
a˘ive_ãxt_edô
 = 
NULL
;

125 
	}
}

131 
	$dügøm_d©a_föÆize
(
GObje˘
 *
obje˘
)

133 
DügømD©a
 *
d©a
 = 
	`DIA_DIAGRAM_DATA
(
obje˘
);

135 
guöt
 
i
;

137 
	`g_‰ì
(
d©a
->
∑≥r
.
«me
);

139 
i
=0;i<
d©a
->
œyîs
->
Àn
;i++) {

140 
	`œyî_de°roy
(
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
));

142 
	`g_±r_¨øy_‰ì
(
d©a
->
œyîs
, 
TRUE
);

143 
d©a
->
a˘ive_œyî
 = 
NULL
;

145 
	`g_li°_‰ì
(
d©a
->
£À˘ed
);

146 
d©a
->
£À˘ed
 = 
NULL
;

147 
d©a
->
£À˘ed_cou¡_¥iv©e
 = 0;

148 
	}
}

154 
	$dügøm_d©a_˛ass_öô
(
DügømD©aCœss
 *
kœss
)

156 
GObje˘Cœss
 *
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
kœss
);

158 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
kœss
);

160 
dügøm_d©a_sig«ls
[
OBJECT_ADD
] =

161 
	`g_sig«l_√w
 ("object_add",

162 
	`G_TYPE_FROM_CLASS
 (
kœss
),

163 
G_SIGNAL_RUN_FIRST
,

164 
	`G_STRUCT_OFFSET
 (
DügømD©aCœss
, 
obje˘_add
),

165 
NULL
, NULL,

166 
dü_m¨shÆ_VOID__POINTER_POINTER
,

167 
G_TYPE_NONE
,

169 
G_TYPE_POINTER
,

170 
G_TYPE_POINTER
);

172 
dügøm_d©a_sig«ls
[
OBJECT_REMOVE
] =

173 
	`g_sig«l_√w
 ("object_remove",

174 
	`G_TYPE_FROM_CLASS
 (
kœss
),

175 
G_SIGNAL_RUN_FIRST
,

176 
	`G_STRUCT_OFFSET
 (
DügømD©aCœss
, 
obje˘_ªmove
),

177 
NULL
, NULL,

178 
dü_m¨shÆ_VOID__POINTER_POINTER
,

179 
G_TYPE_NONE
,

181 
G_TYPE_POINTER
,

182 
G_TYPE_POINTER
);

184 
obje˘_˛ass
->
föÆize
 = 
dügøm_d©a_föÆize
;

185 
kœss
->
obje˘_add
 = 
_dügøm_d©a_obje˘_add
;

186 
kœss
->
obje˘_ªmove
 = 
_dügøm_d©a_obje˘_ªmove
;

187 
	}
}

198 
Layî
 *

199 
	$√w_œyî
(
gch¨
 *
«me
, 
DügømD©a
 *
∑ª¡
)

201 
Layî
 *
œyî
;

203 
œyî
 = 
	`g_√w
(
Layî
, 1);

205 
œyî
->
«me
 =Çame;

207 
œyî
->
∑ª¡_dügøm
 = 
∑ª¡
;

208 
œyî
->
visibÀ
 = 
TRUE
;

209 
œyî
->
c⁄√˘abÀ
 = 
TRUE
;

211 
œyî
->
obje˘s
 = 
NULL
;

213 
œyî
->
exã¡s
.
À·
 = 0.0;

214 
œyî
->
exã¡s
.
right
 = 10.0;

215 
œyî
->
exã¡s
.
t›
 = 0.0;

216 
œyî
->
exã¡s
.
bŸtom
 = 10.0;

218  
œyî
;

219 
	}
}

226 
	$œyî_de°roy
(
Layî
 *
œyî
)

228 
	`g_‰ì
(
œyî
->
«me
);

229 
	`de°roy_obje˘_li°
(
œyî
->
obje˘s
);

230 
	`g_‰ì
(
œyî
);

231 
	}
}

239 
	$d©a_øi£_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
)

241 
guöt
 
i
;

242 
guöt
 
œyî_ƒ
 = 0;

243 
Layî
 *
tmp
;

245 
i
=0;i<
d©a
->
œyîs
->
Àn
;i++) {

246 i‡(
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
)==
œyî
)

247 
œyî_ƒ
 = 
i
;

250 i‡(
œyî_ƒ
 < 
d©a
->
œyîs
->
Àn
-1) {

251 
tmp
 = 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
œyî_ƒ
+1);

252 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
œyî_ƒ
+1) =

253 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
œyî_ƒ
);

254 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
œyî_ƒ
Ë
tmp
;

256 
	}
}

264 
	$d©a_lowî_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
)

266 
guöt
 
i
;

267 
œyî_ƒ
 = -1;

268 
Layî
 *
tmp
;

270 
i
=0;i<
d©a
->
œyîs
->
Àn
;i++) {

271 i‡(
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
)==
œyî
)

272 
œyî_ƒ
 = 
i
;

275 
	`g_as£π
(
œyî_ƒ
>=0);

277 i‡(
œyî_ƒ
 > 0) {

278 
tmp
 = 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
œyî_ƒ
-1);

279 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
œyî_ƒ
-1) =

280 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
œyî_ƒ
);

281 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
œyî_ƒ
Ë
tmp
;

283 
	}
}

290 
	$d©a_add_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
)

292 
	`g_±r_¨øy_add
(
d©a
->
œyîs
, 
œyî
);

293 
œyî
->
∑ª¡_dügøm
 = 
d©a
;

294 
	`œyî_upd©e_exã¡s
(
œyî
);

295 
	`d©a_upd©e_exã¡s
(
d©a
);

296 
	}
}

299 
	$d©a_add_œyî_©
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
, 
pos
)

301 
Àn
;

302 
i
;

304 
	`g_±r_¨øy_add
(
d©a
->
œyîs
, 
œyî
);

305 
Àn
 = 
d©a
->
œyîs
->len;

307 i‡–(
pos
>=0Ë&& (po†< 
Àn
)) {

308 
i
=
Àn
-1;i>
pos
;i--) {

309 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
) = g_ptr_array_index(data->layers, i-1);

311 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
pos
Ë
œyî
;

314 
œyî
->
∑ª¡_dügøm
 = 
d©a
;

315 
	`œyî_upd©e_exã¡s
(
œyî
);

316 
	`d©a_upd©e_exã¡s
(
d©a
);

317 
	}
}

320 
	$d©a_œyî_gë_ödex
 (c⁄° 
DügømD©a
 *
d©a
, c⁄° 
Layî
 *
œyî
)

322 
Àn
;

323 
i
;

325 
Àn
 = 
d©a
->
œyîs
->len;

326 
i
=0;i<
Àn
;++i) {

327 i‡(
œyî
 =
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
))

328  
i
;

331 
	}
}

339 
	$d©a_£t_a˘ive_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
)

341 
d©a
->
a˘ive_œyî
 = 
œyî
;

342 
	}
}

350 
	$d©a_dñëe_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
)

352 i‡(
d©a
->
œyîs
->
Àn
<=1)

355 i‡(
d©a
->
a˘ive_œyî
 =
œyî
) {

356 
	`d©a_ªmove_Æl_£À˘ed
(
d©a
);

358 
œyî
->
∑ª¡_dügøm
 = 
NULL
;

359 
	`g_±r_¨øy_ªmove
(
d©a
->
œyîs
, 
œyî
);

361 i‡(
d©a
->
a˘ive_œyî
 =
œyî
) {

362 
d©a
->
a˘ive_œyî
 = 
	`g_±r_¨øy_ödex
(d©a->
œyîs
, 0);

364 
	}
}

374 
	$d©a_£À˘
(
DügømD©a
 *
d©a
, 
DüObje˘
 *
obj
)

376 i‡(
	`g_li°_föd
 (
d©a
->
£À˘ed
, 
obj
))

378 
d©a
->
£À˘ed
 = 
	`g_li°_¥ïíd
(d©a->£À˘ed, 
obj
);

379 
d©a
->
£À˘ed_cou¡_¥iv©e
++;

380 
	}
}

390 
	$d©a_un£À˘
(
DügømD©a
 *
d©a
, 
DüObje˘
 *
obj
)

392 i‡(!
	`g_li°_föd
 (
d©a
->
£À˘ed
, 
obj
))

394 
d©a
->
£À˘ed
 = 
	`g_li°_ªmove
(d©a->£À˘ed, 
obj
);

395 
d©a
->
£À˘ed_cou¡_¥iv©e
--;

396 
	}
}

403 
	$d©a_ªmove_Æl_£À˘ed
(
DügømD©a
 *
d©a
)

405 
	`g_li°_‰ì
(
d©a
->
£À˘ed
);

406 
d©a
->
£À˘ed
 = 
NULL
;

407 
d©a
->
£À˘ed_cou¡_¥iv©e
 = 0;

408 
	}
}

414 
gboﬁón


415 
	$d©a_has_visibÀ_œyîs
(
DügømD©a
 *
d©a
)

417 
guöt
 
i
;

418 
i
 = 0; i < 
d©a
->
œyîs
->
Àn
; i++) {

419 
Layî
 *
œyî
 = 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
);

420 i‡(
œyî
->
visibÀ
Ë 
TRUE
;

422  
FALSE
;

423 
	}
}

429 
	$d©a_gë_œyîs_exã¡s_uni⁄
(
DügømD©a
 *
d©a
)

431 
guöt
 
i
;

432 
gboﬁón
 
fú°
 = 
TRUE
;

433 
Re˘™gÀ
 
√w_exã¡s
;

435  
i
 = 0 ; i<
d©a
->
œyîs
->
Àn
; i++) {

436 
Layî
 *
œyî
 = 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
);

437 i‡(!
œyî
->
visibÀ
) ;

439 
	`œyî_upd©e_exã¡s
(
œyî
);

441 i‡(
fú°
) {

442 
√w_exã¡s
 = 
œyî
->
exã¡s
;

443 
fú°
 = 
	`ª˘™gÀ_equÆs
(&
√w_exã¡s
,&
övÆid_exã¡s
);

445 i‡(!
	`ª˘™gÀ_equÆs
(&
œyî
->
exã¡s
,&
övÆid_exã¡s
)) {

446 
	`ª˘™gÀ_uni⁄
(&
√w_exã¡s
, &
œyî
->
exã¡s
);

451 
d©a
->
exã¡s
 = 
√w_exã¡s
;

452 
	}
}

460 
	$d©a_ad≠t_sˇlög_to_exã¡s
(
DügømD©a
 *
d©a
)

462 
gdoubÀ
 
pwidth
 = 
d©a
->
∑≥r
.
width
 * d©a->∑≥r.
sˇlög
;

463 
gdoubÀ
 
pheight
 = 
d©a
->
∑≥r
.
height
 * d©a->∑≥r.
sˇlög
;

465 
gdoubÀ
 
xsˇÀ
 = 
d©a
->
∑≥r
.
fôwidth
 * 
pwidth
 /

466 (
d©a
->
exã¡s
.
right
 - d©a->exã¡s.
À·
);

467 
gdoubÀ
 
ysˇÀ
 = 
d©a
->
∑≥r
.
fôheight
 * 
pheight
 /

468 (
d©a
->
exã¡s
.
bŸtom
 - d©a->exã¡s.
t›
);

470 
d©a
->
∑≥r
.
sˇlög
 = ()
	`MIN
(
xsˇÀ
, 
ysˇÀ
);

471 
d©a
->
∑≥r
.
width
 = ()(
pwidth
 / d©a->∑≥r.
sˇlög
);

472 
d©a
->
∑≥r
.
height
 = ()(
pheight
 / d©a->∑≥r.
sˇlög
);

473 
	}
}

479 
gboﬁón


480 
	$d©a_compuã_exã¡s
(
DügømD©a
 *
d©a
)

482 
Re˘™gÀ
 
ﬁd_exã¡s
 = 
d©a
->
exã¡s
;

484 i‡(!
	`d©a_has_visibÀ_œyîs
(
d©a
)) {

485 i‡(
d©a
->
œyîs
->
Àn
 > 0) {

486 
Layî
 *
œyî
 = 
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 0);

487 
	`œyî_upd©e_exã¡s
(
œyî
);

489 
d©a
->
exã¡s
 = 
œyî
->extents;

491 
d©a
->
exã¡s
 = 
övÆid_exã¡s
;

494 
	`d©a_gë_œyîs_exã¡s_uni⁄
(
d©a
);

497 i‡(
	`ª˘™gÀ_equÆs
(&
d©a
->
exã¡s
,&
övÆid_exã¡s
)) {

498 
d©a
->
exã¡s
.
À·
 = 0.0;

499 
d©a
->
exã¡s
.
right
 = 10.0;

500 
d©a
->
exã¡s
.
t›
 = 0.0;

501 
d©a
->
exã¡s
.
bŸtom
 = 10.0;

503  (!
	`ª˘™gÀ_equÆs
(&
d©a
->
exã¡s
,&
ﬁd_exã¡s
));

504 
	}
}

510 
gboﬁón


511 
	$d©a_upd©e_exã¡s
(
DügømD©a
 *
d©a
)

514 
gboﬁón
 
ch™ged
;

516 
ch™ged
 = 
	`d©a_compuã_exã¡s
(
d©a
);

517 i‡(
ch™ged
 && 
d©a
->
∑≥r
.
fôto
Ë
	`d©a_ad≠t_sˇlög_to_exã¡s
(data);

519  
ch™ged
;

520 
	}
}

528 
GLi°
 *

529 
	$d©a_gë_s‹ãd_£À˘ed
(
DügømD©a
 *
d©a
)

531 
GLi°
 *
li°
;

532 
GLi°
 *
s‹ãd_li°
;

533 
GLi°
 *
found
;

534 
DüObje˘
 *
obj
;

536 
	`g_as£π
 (
	`g_li°_Àngth
 (
d©a
->
£À˘ed
Ë=d©a->
£À˘ed_cou¡_¥iv©e
);

537 i‡(
d©a
->
£À˘ed_cou¡_¥iv©e
 == 0)

538  
NULL
;

540 
s‹ãd_li°
 = 
NULL
;

541 
li°
 = 
	`g_li°_œ°
(
d©a
->
a˘ive_œyî
->
obje˘s
);

542 
li°
 !
NULL
) {

543 
found
 = 
	`g_li°_föd
(
d©a
->
£À˘ed
, 
li°
->data);

544 i‡(
found
) {

545 
obj
 = (
DüObje˘
 *)
found
->
d©a
;

546 
s‹ãd_li°
 = 
	`g_li°_¥ïíd
(s‹ãd_li°, 
obj
);

548 
li°
 = 
	`g_li°_¥evious
(list);

551  
s‹ãd_li°
;

552 
	}
}

561 
GLi°
 *

562 
	$d©a_gë_s‹ãd_£À˘ed_ªmove
(
DügømD©a
 *
d©a
)

564 
GLi°
 *
li°
,*
tmp
;

565 
GLi°
 *
s‹ãd_li°
;

566 
GLi°
 *
found
;

567 
DüObje˘
 *
obj
;

569 
	`g_as£π
 (
	`g_li°_Àngth
 (
d©a
->
£À˘ed
Ë=d©a->
£À˘ed_cou¡_¥iv©e
);

570 i‡(
d©a
->
£À˘ed_cou¡_¥iv©e
 == 0)

571  
NULL
;

573 
s‹ãd_li°
 = 
NULL
;

574 
li°
 = 
	`g_li°_œ°
(
d©a
->
a˘ive_œyî
->
obje˘s
);

575 
li°
 !
NULL
) {

576 
found
 = 
	`g_li°_föd
(
d©a
->
£À˘ed
, 
li°
->data);

577 i‡(
found
) {

578 
obj
 = (
DüObje˘
 *)
found
->
d©a
;

579 
s‹ãd_li°
 = 
	`g_li°_¥ïíd
(s‹ãd_li°, 
obj
);

581 
tmp
 = 
li°
;

582 
li°
 = 
	`g_li°_¥evious
(list);

583 
d©a
->
a˘ive_œyî
->
obje˘s
 =

584 
	`g_li°_ªmove_lök
(
d©a
->
a˘ive_œyî
->
obje˘s
, 
tmp
);

586 
li°
 = 
	`g_li°_¥evious
(list);

590  
s‹ãd_li°
;

591 
	}
}

601 
	$d©a_emô
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
, 
DüObje˘
* 
obj
,

602 c⁄° *
sig«l_«me
)

605 i‡(
	`°rcmp
("obje˘_add",
sig«l_«me
) == 0)

606 
	`g_sig«l_emô
(
d©a
, 
dügøm_d©a_sig«ls
[
OBJECT_ADD
], 0, 
œyî
, 
obj
);

608 i‡(
	`°rcmp
("obje˘_ªmove",
sig«l_«me
) == 0)

609 
	`g_sig«l_emô
(
d©a
, 
dügøm_d©a_sig«ls
[
OBJECT_REMOVE
], 0, 
œyî
, 
obj
);

611 
	}
}

623 
	$d©a_ªndî
(
DügømD©a
 *
d©a
, 
DüRídîî
 *
ªndîî
, 
Re˘™gÀ
 *
upd©e
,

624 
Obje˘Rídîî
 
obj_ªndîî
,

625 
gpoöãr
 
gd©a
)

627 
Layî
 *
œyî
;

628 
guöt
 
i
, 
a˘ive_œyî
;

630 i‡(!
ªndîî
->
is_öãø˘ive
)

631 (
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
begö_ªndî
)(renderer);

633 
i
=0; i<
d©a
->
œyîs
->
Àn
; i++) {

634 
œyî
 = (
Layî
 *Ë
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
);

635 
a˘ive_œyî
 = (
œyî
 =
d©a
->active_layer);

636 i‡(
œyî
->
visibÀ
)

637 
	`œyî_ªndî
(
œyî
, 
ªndîî
, 
upd©e
, 
obj_ªndîî
, 
gd©a
, 
a˘ive_œyî
);

640 i‡(!
ªndîî
->
is_öãø˘ive
)

641 (
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
íd_ªndî
)(renderer);

642 
	}
}

645 
	$d©a_f‹óch_obje˘
 (
DügømD©a
 *
d©a
, 
GFunc
 
func
, 
gpoöãr
 
u£r_d©a
)

647 
Layî
 *
œyî
;

648 
guöt
 
i
;

649 
i
=0; i<
d©a
->
œyîs
->
Àn
; i++) {

650 
œyî
 = (
Layî
 *Ë
	`g_±r_¨øy_ödex
(
d©a
->
œyîs
, 
i
);

651 
	`g_li°_f‹óch
 (
œyî
->
obje˘s
, 
func
, 
u£r_d©a
);

653 
	}
}

	@O:\tool\dvs50\lib\diagramdata.h

19 #i‚de‡
DIAGRAMDATA_H


20 
	#DIAGRAMDATA_H


	)

22 
	~<glib.h
>

23 
	~<°rög.h
>

25 
	~"düty≥s.h
"

26 
	~"cﬁ‹.h
"

27 
	~"geomëry.h
"

28 
	~"düv¨.h
"

29 
	~"∑≥r.h
"

31 
G_BEGIN_DECLS


36 
	s_NewDügømD©a
 {

37 
gch¨
 *
	m∑≥πy≥
;

38 
gÊﬂt
 
	mtm¨gö
, 
	mbm¨gö
, 
	mlm¨gö
, 
	mrm¨gö
;

39 
gboﬁón
 
	mis_p‹åaô
;

40 
gÊﬂt
 
	msˇlög
;

41 
gboﬁón
 
	mfôto
;

42 
göt
 
	mfôwidth
, 
	mfôheight
;

43 
Cﬁ‹
 
	mbg_cﬁ‹
, 
	m∑gebªak_cﬁ‹
, 
	mgrid_cﬁ‹
;

44 
	mcom¥ess_ßve
;

45 
gch¨
 *
	munô
, *
	mf⁄t_unô
;

48 
DIAVAR
 
GTy≥
 
	$dügøm_d©a_gë_ty≥
 (Ë
G_GNUC_CONST
;

50 
	#DIA_TYPE_DIAGRAM_DATA
 (
	`dügøm_d©a_gë_ty≥
 ())

	)

51 
	#DIA_DIAGRAM_DATA
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_DIAGRAM_DATA
, 
DügømD©a
))

	)

52 
	#DIA_DIAGRAM_DATA_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_DIAGRAM_DATA
, 
DügømD©aCœss
))

	)

53 
	#DIA_IS_DIAGRAM_DATA
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_DIAGRAM_DATA
))

	)

54 
	#DIA_DIAGRAM_DATA_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_DIAGRAM_DATA
, 
DügømD©aCœss
))

	)

59 
	s_DügømD©a
 {

60 
GObje˘
 
∑ª¡_ö°™˚
;

62 
Re˘™gÀ
 
exã¡s
;

64 
Cﬁ‹
 
bg_cﬁ‹
;

66 
P≠îInfo
 
∑≥r
;

67 
gboﬁón
 
is_com¥es£d
;

70 
GPåAºay
 *
œyîs
;

71 
Layî
 *
a˘ive_œyî
;

73 
guöt
 
£À˘ed_cou¡_¥iv©e
;

74 
GLi°
 *
£À˘ed
;

79 
GLi°
 *
ãxt_edôs
;

81 
gch¨
 *
unô
, *
f⁄t_unô
;

84 
Focus
 *
a˘ive_ãxt_edô
;

90 
	s_DügømD©aCœss
 {

91 
GObje˘Cœss
 
∑ª¡_˛ass
;

94 (* 
obje˘_add
Ë(
DügømD©a
*, 
Layî
*, 
DüObje˘
*);

95 (* 
obje˘_ªmove
Ë(
DügømD©a
*, 
Layî
*, 
DüObje˘
*);

97 } 
	tDügømD©aCœss
;

104 
	s_Layî
 {

105 *
«me
;

106 
Re˘™gÀ
 
exã¡s
;

108 
GLi°
 *
obje˘s
;

113 
gboﬁón
 
visibÀ
;

114 
gboﬁón
 
c⁄√˘abÀ
;

117 
DügømD©a
 *
∑ª¡_dügøm
;

123 
DIAVAR
 
Layî
 *
	`√w_œyî
 (*
«me
, 
DügømD©a
 *
∑ª¡
);

124 
DIAVAR
 
	`œyî_de°roy
(
Layî
 *
œyî
);

126 
DIAVAR
 
	`d©a_øi£_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
);

127 
DIAVAR
 
	`d©a_lowî_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
);

129 
DIAVAR
 
	`d©a_add_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
);

130 
DIAVAR
 
	`d©a_add_œyî_©
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
, 
pos
);

131 
DIAVAR
 
	`d©a_£t_a˘ive_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
);

132 
DIAVAR
 
	`d©a_dñëe_œyî
(
DügømD©a
 *
d©a
, 
Layî
 *
œyî
);

133 
DIAVAR
 
	`d©a_œyî_gë_ödex
 (c⁄° 
DügømD©a
 *
d©a
, c⁄° 
Layî
 *
œyî
);

135 
DIAVAR
 
	`d©a_£À˘
(
DügømD©a
 *
d©a
, 
DüObje˘
 *
obj
);

136 
DIAVAR
 
	`d©a_un£À˘
(
DügømD©a
 *
d©a
, 
DüObje˘
 *
obj
);

137 
DIAVAR
 
	`d©a_ªmove_Æl_£À˘ed
(
DügømD©a
 *
d©a
);

138 
DIAVAR
 
gboﬁón
 
	`d©a_upd©e_exã¡s
(
DügømD©a
 *
d©a
);

139 
DIAVAR
 
GLi°
 *
	`d©a_gë_s‹ãd_£À˘ed
(
DügømD©a
 *
d©a
);

140 
DIAVAR
 
GLi°
 *
	`d©a_gë_s‹ãd_£À˘ed_ªmove
(
DügømD©a
 *
d©a
);

141 
DIAVAR
 
	`d©a_£t_unô
(
DügømD©a
 *
d©a
, 
gch¨
 *
unô
);

142 
DIAVAR
 
gch¨
 *
	`d©a_gë_unô
(
DügømD©a
 *
d©a
);

143 
DIAVAR
 
	`d©a_gë_unô_mu…ùlõr
(
DügømD©a
 *
d©a
);

144 
DIAVAR
 
	`d©a_£t_f⁄t_unô
(
DügømD©a
 *
d©a
, 
gch¨
 *
unô
);

145 
DIAVAR
 
gch¨
 *
	`d©a_gë_f⁄t_unô
(
DügømD©a
 *
d©a
);

146 
DIAVAR
 
	`d©a_gë_f⁄t_unô_mu…ùlõr
(
DügømD©a
 *
d©a
);

147 
DIAVAR
 
	`d©a_emô
(
DügømD©a
 *
d©a
,
Layî
 *
œyî
,
DüObje˘
* 
obj
,c⁄° *
sig«l_«me
);

149 
DIAVAR
 
	`d©a_f‹óch_obje˘
 (
DügømD©a
 *
d©a
, 
GFunc
 
func
, 
gpoöãr
 
u£r_d©a
);

152 (*
	tObje˘Rídîî
)(
	tDüObje˘
 *
	tobj
, 
	tDüRídîî
 *
	tªndîî
,

153 
	ta˘ive_œyî
,

154 
	tgpoöãr
 
	td©a
);

155 
DIAVAR
 
	`d©a_ªndî
(
DügømD©a
 *
d©a
, 
DüRídîî
 *
ªndîî
, 
Re˘™gÀ
 *
upd©e
,

156 
Obje˘Rídîî
 
obj_ªndîî
 ,

157 
gpoöãr
 
gd©a
);

158 
DIAVAR
 
	`œyî_ªndî
(
Layî
 *
œyî
, 
DüRídîî
 *
ªndîî
, 
Re˘™gÀ
 *
upd©e
,

159 
Obje˘Rídîî
 
obj_ªndîî
 ,

160 
gpoöãr
 
d©a
,

161 
a˘ive_œyî
);

163 
DIAVAR
 
	`œyî_obje˘_ödex
(
Layî
 *
œyî
, 
DüObje˘
 *
obj
);

164 
DIAVAR
 
	`œyî_add_obje˘
(
Layî
 *
œyî
, 
DüObje˘
 *
obj
);

165 
DIAVAR
 
	`œyî_add_obje˘_©
(
Layî
 *
œyî
, 
DüObje˘
 *
obj
, 
pos
);

166 
DIAVAR
 
	`œyî_add_obje˘s
(
Layî
 *
œyî
, 
GLi°
 *
obj_li°
);

167 
DIAVAR
 
	`œyî_add_obje˘s_fú°
(
Layî
 *
œyî
, 
GLi°
 *
obj_li°
);

168 
DIAVAR
 
	`œyî_ªmove_obje˘
(
Layî
 *
œyî
, 
DüObje˘
 *
obj
);

169 
DIAVAR
 
	`œyî_ªmove_obje˘s
(
Layî
 *
œyî
, 
GLi°
 *
obj_li°
);

170 
DIAVAR
 
GLi°
 *
	`œyî_föd_obje˘s_öãr£˘ög_ª˘™gÀ
(
Layî
 *
œyî
, 
Re˘™gÀ
*
ª˘
);

171 
DIAVAR
 
GLi°
 *
	`œyî_föd_obje˘s_ö_ª˘™gÀ
(
Layî
 *
œyî
, 
Re˘™gÀ
 *
ª˘
);

172 
DIAVAR
 
GLi°
 *
	`œyî_föd_obje˘s_c⁄èöög_ª˘™gÀ
(
Layî
 *
œyî
, 
Re˘™gÀ
 *
ª˘
);

173 
DIAVAR
 
DüObje˘
 *
	`œyî_föd_˛o£°_obje˘
(
Layî
 *
œyî
, 
Poöt
 *
pos
, 
ªÆ
 
maxdi°
);

174 
DIAVAR
 
DüObje˘
 *
	`œyî_föd_˛o£°_obje˘_ex˚±
(
Layî
 *
œyî
, 
Poöt
 *
pos
,

175 
ªÆ
 
maxdi°
, 
GLi°
 *
avoid
);

176 
DIAVAR
 
ªÆ
 
	`œyî_föd_˛o£°_c⁄√˘i⁄poöt
(
Layî
 *
œyî
,

177 
C⁄√˘i⁄Poöt
 **
˛o£°
,

178 
Poöt
 *
pos
,

179 
DüObje˘
 *
nŸthis
);

180 
DIAVAR
 
	`œyî_upd©e_exã¡s
(
Layî
 *
œyî
);

181 
DIAVAR
 
	`œyî_ª∂a˚_obje˘_wôh_li°
(
Layî
 *
œyî
, 
DüObje˘
 *
obj
,

182 
GLi°
 *
li°
);

183 
DIAVAR
 
	`œyî_£t_obje˘_li°
(
Layî
 *
œyî
, 
GLi°
 *
li°
);

184 
DIAVAR
 
DügømD©a
 *
	`œyî_gë_∑ª¡_dügøm
(
Layî
 *
œyî
);

188 
G_END_DECLS


	@O:\tool\dvs50\lib\diainteractiverenderer.c

23 
	~"düªndîî.h
"

26 
	$dü_öãø˘ive_ªndîî_iÁ˚_öô
 (
DüI¡îa˘iveRídîîI¡îÁ˚
 *
iÁ˚
)

29 
iÁ˚
->
˛ù_ªgi⁄_˛ór
 = 
NULL
;

30 
iÁ˚
->
˛ù_ªgi⁄_add_ª˘
 = 
NULL
;

31 
iÁ˚
->
døw_pixñ_löe
 = 
NULL
;

32 
iÁ˚
->
døw_pixñ_ª˘
 = 
NULL
;

33 
iÁ˚
->
fûl_pixñ_ª˘
 = 
NULL
;

34 
iÁ˚
->
c›y_to_wödow
 = 
NULL
;

35 
iÁ˚
->
£t_size
 = 
NULL
;

36 
	}
}

38 
GTy≥


39 
	$dü_öãø˘ive_ªndîî_öãrÁ˚_gë_ty≥
 ()

41 
GTy≥
 
iÁ˚_ty≥
 = 0;

43 i‡(!
iÁ˚_ty≥
)

45 c⁄° 
GTy≥Info
 
iÁ˚_öfo
 =

47  (
DüI¡îa˘iveRídîîI¡îÁ˚
),

48 (
GBa£InôFunc
Ë
dü_öãø˘ive_ªndîî_iÁ˚_öô
,

49 (
GBa£FöÆizeFunc
Ë
NULL
,

52 
iÁ˚_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
G_TYPE_INTERFACE
,

54 &
iÁ˚_öfo
,

57 
	`g_ty≥_öãrÁ˚_add_¥îequisôe
 (
iÁ˚_ty≥
,

58 
DIA_TYPE_RENDERER
);

61  
iÁ˚_ty≥
;

62 
	}
}

68 
	$dü_ªndîî_£t_size
 (
DüRídîî
* 
ªndîî
, 
gpoöãr
 
wödow
,

69 
width
, 
height
)

71 
DüI¡îa˘iveRídîîI¡îÁ˚
 *
úídîî
 =

72 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ªndîî
);

74 
	`g_ªtu∫_if_Áû
 (
úídîî
 !
NULL
);

75 
	`g_ªtu∫_if_Áû
 (
úídîî
->
£t_size
 !
NULL
);

77 
úídîî
->
	`£t_size
 (
ªndîî
, 
wödow
, 
width
, 
height
);

78 
	}
}

	@O:\tool\dvs50\lib\dialib.c

19 
	~<c⁄fig.h
>

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<°rög.h
>

24 
	~<glib.h
>

25 
	~<gtk/gtk.h
>

27 
	~<libxml/xmÀº‹.h
>

29 
	~"dülib.h
"

30 
	~"mesßge.h
"

31 
	~"utûs.h
"

32 
	~"dü_image.h
"

33 
	~"cﬁ‹.h
"

34 
	~"obje˘.h
"

35 
	~"dü_dús.h
"

38 
	$°dîr_mesßge_öã∫Æ
(c⁄° *
tôÀ
, 
ShowAgaöStyÀ
 
showAgaö
,

39 c⁄° *
fmt
, 
va_li°
 *
¨gs
, va_li° *
¨gs2
)

41 
gch¨
 *
buf
 = 
NULL
;

42 
göt
 
Æloc
 = 0;

43 
göt
 
Àn
;

45 
Àn
 = 
	`f‹m©_°rög_Àngth_uµî_bound
 (
fmt
, 
¨gs
);

47 i‡(
Àn
 >
Æloc
) {

48 i‡(
buf
)

49 
	`g_‰ì
 (
buf
);

51 
Æloc
 = 
	`√¨e°_pow
 (
	`MAX
(
Àn
 + 1, 1024));

53 
buf
 = 
	`g_√w
 (, 
Æloc
);

56 
	`v•rötf
 (
buf
, 
fmt
, *
¨gs2
);

58 
	`Ârötf
(
°dîr
,

60 
tôÀ
,
buf
);

61 
	}
}

63 #ifde‡
G_OS_WIN32


65 
	$myXmlEº‹Rï‹tög
 (*
˘x
, c⁄° * 
msg
, ...)

67 
va_li°
 
¨gs
;

68 
gch¨
 *
°rög
;

70 
	`va_°¨t
(
¨gs
, 
msg
);

71 
°rög
 = 
	`g_°rdup_v¥ötf
 (
msg
, 
¨gs
);

72 
	`g_¥öt
 ("%s", 
°rög
 ? string : "xmlÉrror (null)?");

73 
	`va_íd
(
¨gs
);

75 
	`g_‰ì
(
°rög
);

76 
	}
}

86 
	$libdü_öô
 (
guöt
 
Êags
)

88 
gboﬁón
 
öôülized
 = 
FALSE
;

90 i‡(
öôülized
)

93 i‡(
Êags
 & 
DIA_MESSAGE_STDERR
)

94 
	`£t_mesßge_func
(
°dîr_mesßge_öã∫Æ
);

95 
LIBXML_TEST_VERSION
;

97 #ifde‡
G_OS_WIN32


98 
	`xmlSëGíîicEº‹Func
(
NULL
, 
myXmlEº‹Rï‹tög
);

101 i‡(
Êags
 & 
DIA_VERBOSE
) {

102 
	`dü_log_mesßge_íabÀ
 (
TRUE
);

103 
	`dü_log_mesßge
 ("initializingÜibdia");

105 
	`°d¥›s_öô
();

107 i‡(
Êags
 & 
DIA_INTERACTIVE
) {

108 *
dügtkrc
;

110 
	`dü_image_öô
();

112 
	`gdk_rgb_öô
();

114 
dügtkrc
 = 
	`dü_c⁄fig_fûíame
("diagtkrc");

115 
	`dü_log_mesßge
 ("C⁄fig from %s", 
dügtkrc
);

116 
	`gtk_rc_∑r£
(
dügtkrc
);

117 
	`g_‰ì
(
dügtkrc
);

119 
	`cﬁ‹_öô
();

121 
öôülized
 = 
TRUE
;

123 
	`obje˘_ªgi°ry_öô
();

124 
	}
}

	@O:\tool\dvs50\lib\dialib.h

1 #i‚de‡
LIBDIA_H


2 
	#LIBDIA_H


	)

4 
	~<glib.h
>

5 
	~"düv¨.h
"

7 
G_BEGIN_DECLS


9 
	eDüInôFœgs


11 
	mDIA_INTERACTIVE
 = (1<<0),

12 
	mDIA_MESSAGE_STDERR
 = (1<<1),

13 
	mDIA_VERBOSE
 = (1<<2)

16 
DIAVAR
 
libdü_öô
 (
guöt
 
Êags
);

18 
	gG_END_DECLS


	@O:\tool\dvs50\lib\dialinechooser.c

22 #ifde‡
HAVE_CONFIG_H


23 
	~<c⁄fig.h
>

26 
	~"öé.h
"

27 
	~"widgës.h
"

28 
	~"dülöechoo£r.h
"

30 c⁄° *
	gbuâ⁄_míu_key
 = "dia-button-menu";

31 c⁄° *
	gmíuôem_íum_key
 = "dia-menuitem-value";

36 
dü_löe_¥evõw_£t
(
DüLöePªvõw
 *
löe
, 
LöeStyÀ
 
l°yÀ
);

38 
dü_löe_¥evõw_˛ass_öô
 (
DüLöePªvõwCœss
 *
kœss
);

39 
dü_löe_¥evõw_öô
 (
DüLöePªvõw
 *
¨row
);

40 
göt
 
dü_löe_¥evõw_expo£
 (
GtkWidgë
 *
widgë
,

41 
GdkEvítExpo£
 *
evít
);

43 
GTy≥


44 
	$dü_löe_¥evõw_gë_ty≥
 ()

46 
GTy≥
 
ty≥
 = 0;

48 i‡(!
ty≥
) {

49 c⁄° 
GTy≥Info
 
öfo
 = {

50  (
DüLöePªvõwCœss
),

51 (
GBa£InôFunc
Ë
NULL
,

52 (
GBa£FöÆizeFunc
Ë
NULL
,

53 (
GCœssInôFunc
Ë
dü_löe_¥evõw_˛ass_öô
,

54 (
GCœssFöÆizeFunc
Ë
NULL
,

55 
NULL
,

56  (
DüLöePªvõw
),

58 (
GIn°™˚InôFunc
Ë
dü_löe_¥evõw_öô


61 
ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
GTK_TYPE_MISC
, "DüLöePªvõw", &
öfo
, 0);

64  
ty≥
;

65 
	}
}

68 
	$dü_löe_¥evõw_˛ass_öô
 (
DüLöePªvõwCœss
 *
˛ass
)

70 
GtkWidgëCœss
 *
widgë_˛ass
;

72 
widgë_˛ass
 = 
	`GTK_WIDGET_CLASS
(
˛ass
);

73 
widgë_˛ass
->
expo£_evít
 = 
dü_löe_¥evõw_expo£
;

74 
	}
}

77 
	$dü_löe_¥evõw_öô
 (
DüLöePªvõw
 *
löe
)

79 
	`GTK_WIDGET_SET_FLAGS
 (
löe
, 
GTK_NO_WINDOW
);

81 
	`GTK_WIDGET
 (
löe
)->
ªquisôi⁄
.
width
 = 30 + 
	`GTK_MISC
 (löe)->
x∑d
 * 2;

82 
	`GTK_WIDGET
 (
löe
)->
ªquisôi⁄
.
height
 = 15 + 
	`GTK_MISC
 (löe)->
y∑d
 * 2;

84 
löe
->
l°yÀ
 = 
LINESTYLE_SOLID
;

85 
	}
}

87 
GtkWidgë
 *

88 
	$dü_löe_¥evõw_√w
 (
LöeStyÀ
 
l°yÀ
)

90 
DüLöePªvõw
 *
löe
 = 
	`g_obje˘_√w
(
DIA_TYPE_LINE_PREVIEW
, 
NULL
);

92 
löe
->
l°yÀ
 =Üstyle;

93  
	`GTK_WIDGET
(
löe
);

94 
	}
}

97 
	$dü_löe_¥evõw_£t
(
DüLöePªvõw
 *
löe
, 
LöeStyÀ
 
l°yÀ
)

99 i‡(
löe
->
l°yÀ
 !=Üstyle) {

100 
löe
->
l°yÀ
 =Üstyle;

101 i‡(
	`GTK_WIDGET_DRAWABLE
(
löe
))

102 
	`gtk_widgë_queue_døw
(
	`GTK_WIDGET
(
löe
));

104 
	}
}

106 
göt


107 
	$dü_löe_¥evõw_expo£
(
GtkWidgë
 *
widgë
, 
GdkEvítExpo£
 *
evít
)

109 
DüLöePªvõw
 *
löe
 = 
	`DIA_LINE_PREVIEW
(
widgë
);

110 
GtkMisc
 *
misc
 = 
	`GTK_MISC
(
widgë
);

111 
göt
 
width
, 
height
;

112 
göt
 
x
, 
y
;

113 
göt
 
exã¡
;

114 
GdkWödow
 *
wö
;

115 
GdkGC
 *
gc
;

116 
GdkGCVÆues
 
gcvÆues
;

117 
göt8
 
dash_li°
[6];

118 
löe_width
 = 2;

120 i‡(
	`GTK_WIDGET_DRAWABLE
(
widgë
)) {

121 
width
 = 
widgë
->
Æloˇti⁄
.width - 
misc
->
x∑d
 * 2;

122 
height
 = 
widgë
->
Æloˇti⁄
.heighà- 
misc
->
y∑d
 * 2;

123 
exã¡
 = 
	`MIN
(
width
, 
height
);

124 
x
 = (
widgë
->
Æloˇti⁄
.x + 
misc
->
x∑d
);

125 
y
 = (
widgë
->
Æloˇti⁄
.y + 
misc
->
y∑d
);

127 
wö
 = 
widgë
->
wödow
;

128 
gc
 = 
widgë
->
°yÀ
->
fg_gc
[widgë->
°©e
];

131 
	`gdk_gc_gë_vÆues
(
gc
, &
gcvÆues
);

132 
löe
->
l°yÀ
) {

133 
LINESTYLE_SOLID
:

134 
	`gdk_gc_£t_löe_©åibuãs
(
gc
, 
löe_width
, 
GDK_LINE_SOLID
,

135 
gcvÆues
.
ˇp_°yÀ
, gcvÆues.
joö_°yÀ
);

137 
LINESTYLE_DASHED
:

138 
	`gdk_gc_£t_löe_©åibuãs
(
gc
, 
löe_width
, 
GDK_LINE_ON_OFF_DASH
,

139 
gcvÆues
.
ˇp_°yÀ
, gcvÆues.
joö_°yÀ
);

140 
dash_li°
[0] = 10;

141 
dash_li°
[1] = 10;

142 
	`gdk_gc_£t_dashes
(
gc
, 0, 
dash_li°
, 2);

144 
LINESTYLE_DASH_DOT
:

145 
	`gdk_gc_£t_löe_©åibuãs
(
gc
, 
löe_width
, 
GDK_LINE_ON_OFF_DASH
,

146 
gcvÆues
.
ˇp_°yÀ
, gcvÆues.
joö_°yÀ
);

147 
dash_li°
[0] = 10;

148 
dash_li°
[1] = 4;

149 
dash_li°
[2] = 2;

150 
dash_li°
[3] = 4;

151 
	`gdk_gc_£t_dashes
(
gc
, 0, 
dash_li°
, 4);

153 
LINESTYLE_DASH_DOT_DOT
:

154 
	`gdk_gc_£t_löe_©åibuãs
(
gc
, 
löe_width
, 
GDK_LINE_ON_OFF_DASH
,

155 
gcvÆues
.
ˇp_°yÀ
, gcvÆues.
joö_°yÀ
);

156 
dash_li°
[0] = 10;

157 
dash_li°
[1] = 2;

158 
dash_li°
[2] = 2;

159 
dash_li°
[3] = 2;

160 
dash_li°
[4] = 2;

161 
dash_li°
[5] = 2;

162 
	`gdk_gc_£t_dashes
(
gc
, 0, 
dash_li°
, 6);

164 
LINESTYLE_DOTTED
:

165 
	`gdk_gc_£t_löe_©åibuãs
(
gc
, 
löe_width
, 
GDK_LINE_ON_OFF_DASH
,

166 
gcvÆues
.
ˇp_°yÀ
, gcvÆues.
joö_°yÀ
);

167 
dash_li°
[0] = 2;

168 
dash_li°
[1] = 2;

169 
	`gdk_gc_£t_dashes
(
gc
, 0, 
dash_li°
, 2);

172 
	`gdk_døw_löe
(
wö
, 
gc
, 
x
, 
y
+
height
/2, x+
width
, y+height/2);

173 
	`gdk_gc_£t_löe_©åibuãs
(
gc
, 
gcvÆues
.
löe_width
, gcvÆues.
löe_°yÀ
,

174 
gcvÆues
.
ˇp_°yÀ
, gcvÆues.
joö_°yÀ
);

176  
TRUE
;

177 
	}
}

182 
dü_löe_choo£r_˛ass_öô
 (
DüLöeChoo£rCœss
 *
kœss
);

183 
dü_löe_choo£r_öô
 (
DüLöeChoo£r
 *
¨row
);

185 
GTy≥


186 
	$dü_löe_choo£r_gë_ty≥
 ()

188 
GTy≥
 
ty≥
 = 0;

190 i‡(!
ty≥
) {

191 c⁄° 
GTy≥Info
 
öfo
 = {

192  (
DüLöeChoo£rCœss
),

193 (
GBa£InôFunc
Ë
NULL
,

194 (
GBa£FöÆizeFunc
Ë
NULL
,

195 (
GCœssInôFunc
Ë
dü_löe_choo£r_˛ass_öô
,

196 (
GCœssFöÆizeFunc
Ë
NULL
,

197 
NULL
,

198  (
DüLöeChoo£r
),

200 (
GIn°™˚InôFunc
Ë
dü_löe_choo£r_öô


203 
ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
GTK_TYPE_BUTTON
, "DüLöeChoo£r", &
öfo
, 0);

206  
ty≥
;

207 
	}
}

209 
göt


210 
	$dü_löe_choo£r_evít
(
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
)

212 i‡(
evít
->
ty≥
 =
GDK_BUTTON_PRESS
 &&Évít->
buâ⁄
.button == 1) {

213 
GtkMíu
 *
míu
 = 
	`g_obje˘_gë_d©a
(
	`G_OBJECT
(
widgë
), 
buâ⁄_míu_key
);

214 
	`gtk_míu_p›up
(
míu
, 
NULL
, NULL, NULL, NULL,

215 
evít
->
buâ⁄
.buâ⁄,Évít->buâ⁄.
time
);

216  
TRUE
;

218  
FALSE
;

219 
	}
}

222 
	$dü_löe_choo£r_˛ass_öô
 (
DüLöeChoo£rCœss
 *
˛ass
)

224 
GtkWidgëCœss
 *
widgë_˛ass
;

226 
widgë_˛ass
 = 
	`GTK_WIDGET_CLASS
(
˛ass
);

227 
widgë_˛ass
->
evít
 = 
dü_löe_choo£r_evít
;

228 
	}
}

231 
	$dü_löe_choo£r_dülog_ª•⁄£
 (
GtkWidgë
 *
dülog
,

232 
göt
 
ª•⁄£_id
,

233 
DüLöeChoo£r
 *
lchoo£r
)

235 
LöeStyÀ
 
√w_°yÀ
;

236 
ªÆ
 
√w_dash
;

238 i‡(
ª•⁄£_id
 =
GTK_RESPONSE_OK
) {

239 
	`dü_löe_°yÀ_£À˘‹_gë_löe°yÀ
(
lchoo£r
->
£À˘‹
,

240 &
√w_°yÀ
, &
√w_dash
);

241 i‡(
√w_°yÀ
 !
lchoo£r
->
l°yÀ
 || 
√w_dash
 !lchoo£r->
dash_Àngth
) {

242 
lchoo£r
->
l°yÀ
 = 
√w_°yÀ
;

243 
lchoo£r
->
dash_Àngth
 = 
√w_dash
;

244 
	`dü_löe_¥evõw_£t
(
lchoo£r
->
¥evõw
, 
√w_°yÀ
);

245 i‡(
lchoo£r
->
ˇŒback
)

246 (* 
lchoo£r
->
ˇŒback
)(
√w_°yÀ
, 
√w_dash
,Üchoo£r->
u£r_d©a
);

249 
	`dü_löe_°yÀ_£À˘‹_£t_löe°yÀ
(
lchoo£r
->
£À˘‹
,

250 
lchoo£r
->
l°yÀ
,

251 
lchoo£r
->
dash_Àngth
);

253 
	`gtk_widgë_hide
(
lchoo£r
->
dülog
);

254 
	}
}

257 
	$dü_löe_choo£r_ch™ge_löe_°yÀ
(
GtkMíuIãm
 *
mi
, 
DüLöeChoo£r
 *
lchoo£r
)

259 
LöeStyÀ
 
l°yÀ
 = 
	`GPOINTER_TO_INT
(
	`g_obje˘_gë_d©a
(
	`G_OBJECT
(
mi
),

260 
míuôem_íum_key
));

262 
	`dü_löe_choo£r_£t_löe_°yÀ
(
lchoo£r
, 
l°yÀ
,Üchoo£r->
dash_Àngth
);

263 
	}
}

266 
	$dü_löe_choo£r_£t_löe_°yÀ
(
DüLöeChoo£r
 *
lchoo£r
,

267 
LöeStyÀ
 
l°yÀ
,

268 
ªÆ
 
dashÀngth
)

270 i‡(
l°yÀ
 !
lchoo£r
->lstyle) {

271 
	`dü_löe_¥evõw_£t
(
lchoo£r
->
¥evõw
, 
l°yÀ
);

272 
lchoo£r
->
l°yÀ
 =Üstyle;

273 
	`dü_löe_°yÀ_£À˘‹_£t_löe°yÀ
(
lchoo£r
->
£À˘‹
,Üchoo£r->
l°yÀ
,

274 
lchoo£r
->
dash_Àngth
);

276 
lchoo£r
->
dash_Àngth
 = 
dashÀngth
;

277 i‡(
lchoo£r
->
ˇŒback
)

278 (* 
lchoo£r
->
ˇŒback
)÷choo£r->
l°yÀ
,Üchoo£r->
dash_Àngth
,

279 
lchoo£r
->
u£r_d©a
);

280 
	}
}

283 
	$dü_löe_choo£r_öô
 (
DüLöeChoo£r
 *
lchoo£r
)

285 
GtkWidgë
 *
wid
;

286 
GtkWidgë
 *
míu
, *
mi
, *
 
;

287 
göt
 
i
;

289 
lchoo£r
->
l°yÀ
 = 
LINESTYLE_SOLID
;

290 
lchoo£r
->
dash_Àngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

292 
wid
 = 
	`dü_löe_¥evõw_√w
(
LINESTYLE_SOLID
);

293 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
lchoo£r
), 
wid
);

294 
	`gtk_widgë_show
(
wid
);

295 
lchoo£r
->
¥evõw
 = 
	`DIA_LINE_PREVIEW
(
wid
);

297 
lchoo£r
->
dülog
 = 
	`gtk_dülog_√w_wôh_buâ⁄s
(
	`_
("Line Style Properties"),

298 
NULL
,

299 
GTK_DIALOG_NO_SEPARATOR
,

300 
GTK_STOCK_CANCEL
,

301 
GTK_RESPONSE_CANCEL
,

302 
GTK_STOCK_OK
,

303 
GTK_RESPONSE_OK
,

304 
NULL
);

305 
	`gtk_dülog_£t_deÁu…_ª•⁄£
(
	`GTK_DIALOG
(
lchoo£r
->
dülog
),

306 
GTK_RESPONSE_OK
);

307 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
lchoo£r
->
dülog
), "response",

308 
	`G_CALLBACK
(
dü_löe_choo£r_dülog_ª•⁄£
), 
lchoo£r
);

310 
wid
 = 
	`dü_löe_°yÀ_£À˘‹_√w
();

311 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
wid
), 5);

312 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
	`GTK_DIALOG
(
lchoo£r
->
dülog
)->
vbox
), 
wid
,

313 
TRUE
, TRUE, 0);

314 
	`gtk_widgë_show
(
wid
);

315 
lchoo£r
->
£À˘‹
 = 
	`DIALINESTYLESELECTOR
(
wid
);

317 
míu
 = 
	`gtk_míu_√w
();

318 #i‡
	`GLIB_CHECK_VERSION
(2,10,0)

319 
	`g_obje˘_ªf_sök
(
	`GTK_OBJECT
(
míu
));

320 
	`g_obje˘_£t_d©a_fuŒ
(
	`G_OBJECT
(
lchoo£r
), 
buâ⁄_míu_key
, 
míu
,

321 (
GDe°royNŸify
)
g_obje˘_uƒef
);

323 
	`g_obje˘_ªf
(
	`G_OBJECT
(
míu
));

324 
	`gtk_obje˘_sök
(
	`GTK_OBJECT
(
míu
));

325 
	`g_obje˘_£t_d©a_fuŒ
(
	`G_OBJECT
(
lchoo£r
), 
buâ⁄_míu_key
, 
míu
,

326 (
GDe°royNŸify
)
gtk_widgë_uƒef
);

328 
i
 = 0; i <
LINESTYLE_DOTTED
; i++) {

329 
mi
 = 
	`gtk_míu_ôem_√w
();

330 
	`g_obje˘_£t_d©a
(
	`G_OBJECT
(
mi
), 
míuôem_íum_key
, 
	`GINT_TO_POINTER
(
i
));

331 
 
 = 
	`dü_löe_¥evõw_√w
(
i
);

332 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
mi
), 
 
);

333 
	`gtk_widgë_show
(
 
);

334 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
mi
), "activate",

335 
	`G_CALLBACK
(
dü_löe_choo£r_ch™ge_löe_°yÀ
), 
lchoo£r
);

336 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
mi
);

337 
	`gtk_widgë_show
 (
mi
);

339 
mi
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`_
("Details..."));

340 
	`g_sig«l_c⁄√˘_sw≠≥d
(
	`G_OBJECT
(
mi
), "activate",

341 
	`G_CALLBACK
(
gtk_widgë_show
), 
lchoo£r
->
dülog
);

342 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
mi
);

343 
	`gtk_widgë_show
 (
mi
);

344 
	}
}

346 
GtkWidgë
 *

347 
	$dü_löe_choo£r_√w
(
DüCh™geLöeCÆlback
 
ˇŒback
,

348 
gpoöãr
 
u£r_d©a
)

350 
DüLöeChoo£r
 *
choo£r
 = 
	`g_obje˘_√w
(
DIA_TYPE_LINE_CHOOSER
, 
NULL
);

352 
choo£r
->
ˇŒback
 = callback;

353 
choo£r
->
u£r_d©a
 = user_data;

355  
	`GTK_WIDGET
(
choo£r
);

356 
	}
}

	@O:\tool\dvs50\lib\dialinechooser.h

22 #i‚de‡
DIALINECHOOSER_H


23 
	#DIALINECHOOSER_H


	)

25 
	~"¨rows.h
"

27 
	~<gtk/gtk.h
>

30 
GTy≥
 
dü_löe_¥evõw_gë_ty≥
 ();

32 
	#DIA_TYPE_LINE_PREVIEW
 (
	`dü_löe_¥evõw_gë_ty≥
 ())

	)

33 
	#DIA_LINE_PREVIEW
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_LINE_PREVIEW
, 
DüLöePªvõw
))

	)

34 
	#DIA_LINE_PREVIEW_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_LINE_PREVIEW
, 
DüLöePªvõwCœss
))

	)

35 
	#DIA_IS_LINE_PREVIEW
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_LINE_PREVIEW
))

	)

36 
	#DIA_IS_LINE_PREVIEW_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kœss), 
DIA_TYPE_LINE_PREVIEW
))

	)

37 
	#DIA_LINE_PREVIEW_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_LINE_PREVIEW
, 
DüLöePªvõwCœss
))

	)

39 
_DüLöePªvõw
 
	tDüLöePªvõw
;

40 
_DüLöePªvõwCœss
 
	tDüLöePªvõwCœss
;

42 
	s_DüLöePªvõw


44 
GtkMisc
 
	mmisc
;

45 
LöeStyÀ
 
	ml°yÀ
;

48 
	s_DüLöePªvõwCœss


50 
GtkMiscCœss
 
	m∑ª¡_˛ass
;

53 
GtkWidgë
 *
dü_löe_¥evõw_√w
 (
LöeStyÀ
 
l°yÀ
);

57 
DIAVAR
 
GTy≥
 
dü_löe_choo£r_gë_ty≥
 ();

59 
	#DIA_TYPE_LINE_CHOOSER
 (
	`dü_löe_choo£r_gë_ty≥
 ())

	)

60 
	#DIA_LINE_CHOOSER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_LINE_CHOOSER
, 
DüLöeChoo£r
))

	)

61 
	#DIA_LINE_CHOOSER_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_LINE_CHOOSER
, 
DüLöeChoo£rCœss
))

	)

62 
	#DIA_IS_LINE_CHOOSER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_LINE_CHOOSER
))

	)

63 
	#DIA_IS_LINE_CHOOSER_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kœss), 
DIA_TYPE_LINE_CHOOSER
))

	)

64 
	#DIA_LINE_CHOOSER_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_LINE_CHOOSER
, 
DüLöeChoo£rCœss
))

	)

66 
_DüLöeChoo£r
 
	tDüLöeChoo£r
;

67 
_DüLöeChoo£rCœss
 
	tDüLöeChoo£rCœss
;

69 (*
	tDüCh™geLöeCÆlback
Ë(
	tLöeStyÀ
 
	tl°yÀ
, 
	tªÆ
 
	tdash_Àngth
,

70 
	tgpoöãr
 
	tu£r_d©a
);

72 
	s_DüLöeChoo£r


74 
GtkBuâ⁄
 
buâ⁄
;

75 
DüLöePªvõw
 *
¥evõw
;

76 
LöeStyÀ
 
l°yÀ
;

77 
ªÆ
 
dash_Àngth
;

79 
DüCh™geLöeCÆlback
 
ˇŒback
;

80 
gpoöãr
 
u£r_d©a
;

82 
GtkWidgë
 *
dülog
;

83 
DüLöeStyÀSñe˘‹
 *
£À˘‹
;

86 
	s_DüLöeChoo£rCœss


88 
GtkBuâ⁄Cœss
 
∑ª¡_˛ass
;

91 
DIAVAR
 
	`dü_löe_choo£r_£t_löe_°yÀ
(
DüLöeChoo£r
 *
lchoo£r
,

92 
LöeStyÀ
 
°yÀ
,

93 
ªÆ
 
dashÀngth
);

94 
DIAVAR
 
GtkWidgë
 *
	`dü_löe_choo£r_√w
 (
DüCh™geLöeCÆlback
 
ˇŒback
,

95 
gpoöãr
 
u£r_d©a
);

	@O:\tool\dvs50\lib\dialogs.c

22 #ifde‡
HAVE_CONFIG_H


23 
	~<c⁄fig.h
>

26 
	~"öé.h
"

27 
	~<gtk/gtk.h
>

28 
	~"geomëry.h
"

29 
	~"dülogs.h
"

43 
GtkWidgë
 *

44 
	$dülog_make
(*
tôÀ
, *
okay_ãxt
, *
ˇn˚l_ãxt
,

45 
GtkWidgë
 **
okay_buâ⁄
, GtkWidgë **
ˇn˚l_buâ⁄
) {

46 
GtkWidgë
 *
dülog
 = 
	`gtk_dülog_√w
();

47 
GtkWidgë
 *
œbñ
 = 
	`gtk_œbñ_√w
(
tôÀ
);

49 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dülog
)->
vbox
), 
œbñ
);

51 *
okay_buâ⁄
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
((
okay_ãxt
!=
NULL
?okay_ãxt:
	`_
("Ok")));

52 *
ˇn˚l_buâ⁄
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
((
ˇn˚l_ãxt
!=
NULL
?ˇn˚l_ãxt:
	`_
("Cancel")));

54 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dülog
)->
a˘i⁄_¨ó
),

55 *
okay_buâ⁄
);

56 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dülog
)->
a˘i⁄_¨ó
),

57 *
ˇn˚l_buâ⁄
);

59  
dülog
;

60 
	}
}

65 
GtkSpöBuâ⁄
 *

66 
	$dülog_add_•öbuâ⁄
(
GtkWidgë
 *
dülog
, *
tôÀ
,

67 
ªÆ
 
mö
,Ñó»
max
,Ñó»
decimÆs
) {

68 
GtkAdju°mít
 *
limôs
 =

69 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(10.0, 
mö
, 
max
, 1.0, 10.0, 0));

70 
GtkWidgë
 *
box
 = 
	`gtk_hbox_√w
(
FALSE
, 10);

71 
GtkWidgë
 *
œbñ
 = 
	`gtk_œbñ_√w
(
tôÀ
);

72 
GtkWidgë
 *
íåy
 = 
	`gtk_•ö_buâ⁄_√w
(
limôs
, 10.0, 
decimÆs
);

74 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
(
box
), 
œbñ
, 
TRUE
, TRUE, 0);

75 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
(
box
), 
íåy
, 
TRUE
, TRUE, 0);

76 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dülog
)->
vbox
), 
box
);

78  
	`GTK_SPIN_BUTTON
(
íåy
);

79 
	}
}

	@O:\tool\dvs50\lib\dialogs.h

21 
	~<gtk/gtkwidgë.h
>

22 
	~<gtk/gtk•öbuâ⁄.h
>

24 
DIAVAR
 
GtkWidgë
 *
dülog_make
(*
tôÀ
, *
okay_ãxt
, *
ˇn˚l_ãxt
,

25 
GtkWidgë
 **
okay_buâ⁄
, GtkWidgë **
ˇn˚l_buâ⁄
);

26 
DIAVAR
 
GtkSpöBuâ⁄
 *
dülog_add_•öbuâ⁄
(
GtkWidgë
 *
dülog
, *
tôÀ
,

27 
ªÆ
 
mö
,Ñó»
max
,Ñó»
decimÆs
);

	@O:\tool\dvs50\lib\diamarshal.c

1 
	~"düm¨shÆ.h
"

3 
	~<glib-obje˘.h
>

6 #ifde‡
G_ENABLE_DEBUG


7 
	#g_m¨shÆ_vÆue_≥ek_boﬁón
(
v
Ë
	`g_vÆue_gë_boﬁón
 (v)

	)

8 
	#g_m¨shÆ_vÆue_≥ek_ch¨
(
v
Ë
	`g_vÆue_gë_ch¨
 (v)

	)

9 
	#g_m¨shÆ_vÆue_≥ek_uch¨
(
v
Ë
	`g_vÆue_gë_uch¨
 (v)

	)

10 
	#g_m¨shÆ_vÆue_≥ek_öt
(
v
Ë
	`g_vÆue_gë_öt
 (v)

	)

11 
	#g_m¨shÆ_vÆue_≥ek_uöt
(
v
Ë
	`g_vÆue_gë_uöt
 (v)

	)

12 
	#g_m¨shÆ_vÆue_≥ek_l⁄g
(
v
Ë
	`g_vÆue_gë_l⁄g
 (v)

	)

13 
	#g_m¨shÆ_vÆue_≥ek_ul⁄g
(
v
Ë
	`g_vÆue_gë_ul⁄g
 (v)

	)

14 
	#g_m¨shÆ_vÆue_≥ek_öt64
(
v
Ë
	`g_vÆue_gë_öt64
 (v)

	)

15 
	#g_m¨shÆ_vÆue_≥ek_uöt64
(
v
Ë
	`g_vÆue_gë_uöt64
 (v)

	)

16 
	#g_m¨shÆ_vÆue_≥ek_íum
(
v
Ë
	`g_vÆue_gë_íum
 (v)

	)

17 
	#g_m¨shÆ_vÆue_≥ek_Êags
(
v
Ë
	`g_vÆue_gë_Êags
 (v)

	)

18 
	#g_m¨shÆ_vÆue_≥ek_Êﬂt
(
v
Ë
	`g_vÆue_gë_Êﬂt
 (v)

	)

19 
	#g_m¨shÆ_vÆue_≥ek_doubÀ
(
v
Ë
	`g_vÆue_gë_doubÀ
 (v)

	)

20 
	#g_m¨shÆ_vÆue_≥ek_°rög
(
v
Ë(*Ë
	`g_vÆue_gë_°rög
 (v)

	)

21 
	#g_m¨shÆ_vÆue_≥ek_∑øm
(
v
Ë
	`g_vÆue_gë_∑øm
 (v)

	)

22 
	#g_m¨shÆ_vÆue_≥ek_boxed
(
v
Ë
	`g_vÆue_gë_boxed
 (v)

	)

23 
	#g_m¨shÆ_vÆue_≥ek_poöãr
(
v
Ë
	`g_vÆue_gë_poöãr
 (v)

	)

24 
	#g_m¨shÆ_vÆue_≥ek_obje˘
(
v
Ë
	`g_vÆue_gë_obje˘
 (v)

	)

25 
	#g_m¨shÆ_vÆue_≥ek_v¨ü¡
(
v
Ë
	`g_vÆue_gë_v¨ü¡
 (v)

	)

31 
	#g_m¨shÆ_vÆue_≥ek_boﬁón
(
v
Ë(v)->
d©a
[0].
v_öt


	)

32 
	#g_m¨shÆ_vÆue_≥ek_ch¨
(
v
Ë(v)->
d©a
[0].
v_öt


	)

33 
	#g_m¨shÆ_vÆue_≥ek_uch¨
(
v
Ë(v)->
d©a
[0].
v_uöt


	)

34 
	#g_m¨shÆ_vÆue_≥ek_öt
(
v
Ë(v)->
d©a
[0].
v_öt


	)

35 
	#g_m¨shÆ_vÆue_≥ek_uöt
(
v
Ë(v)->
d©a
[0].
v_uöt


	)

36 
	#g_m¨shÆ_vÆue_≥ek_l⁄g
(
v
Ë(v)->
d©a
[0].
v_l⁄g


	)

37 
	#g_m¨shÆ_vÆue_≥ek_ul⁄g
(
v
Ë(v)->
d©a
[0].
v_ul⁄g


	)

38 
	#g_m¨shÆ_vÆue_≥ek_öt64
(
v
Ë(v)->
d©a
[0].
v_öt64


	)

39 
	#g_m¨shÆ_vÆue_≥ek_uöt64
(
v
Ë(v)->
d©a
[0].
v_uöt64


	)

40 
	#g_m¨shÆ_vÆue_≥ek_íum
(
v
Ë(v)->
d©a
[0].
v_l⁄g


	)

41 
	#g_m¨shÆ_vÆue_≥ek_Êags
(
v
Ë(v)->
d©a
[0].
v_ul⁄g


	)

42 
	#g_m¨shÆ_vÆue_≥ek_Êﬂt
(
v
Ë(v)->
d©a
[0].
v_Êﬂt


	)

43 
	#g_m¨shÆ_vÆue_≥ek_doubÀ
(
v
Ë(v)->
d©a
[0].
v_doubÀ


	)

44 
	#g_m¨shÆ_vÆue_≥ek_°rög
(
v
Ë(v)->
d©a
[0].
v_poöãr


	)

45 
	#g_m¨shÆ_vÆue_≥ek_∑øm
(
v
Ë(v)->
d©a
[0].
v_poöãr


	)

46 
	#g_m¨shÆ_vÆue_≥ek_boxed
(
v
Ë(v)->
d©a
[0].
v_poöãr


	)

47 
	#g_m¨shÆ_vÆue_≥ek_poöãr
(
v
Ë(v)->
d©a
[0].
v_poöãr


	)

48 
	#g_m¨shÆ_vÆue_≥ek_obje˘
(
v
Ë(v)->
d©a
[0].
v_poöãr


	)

49 
	#g_m¨shÆ_vÆue_≥ek_v¨ü¡
(
v
Ë(v)->
d©a
[0].
v_poöãr


	)

61 
	$dü_m¨shÆ_VOID__POINTER_POINTER
 (
GClosuª
 *
˛osuª
,

62 
GVÆue
 *
ªtu∫_vÆue
 
G_GNUC_UNUSED
,

63 
guöt
 
n_∑øm_vÆues
,

64 c⁄° 
GVÆue
 *
∑øm_vÆues
,

65 
gpoöãr
 
övoˇti⁄_höt
 
G_GNUC_UNUSED
,

66 
gpoöãr
 
m¨shÆ_d©a
)

68 (*
	tGM¨shÆFunc_VOID__POINTER_POINTER
Ë(
	tgpoöãr
 
	td©a1
,

69 
	tgpoöãr
 
	t¨g_1
,

70 
	tgpoöãr
 
	t¨g_2
,

71 
	tgpoöãr
 
	td©a2
);

72 
GM¨shÆFunc_VOID__POINTER_POINTER
 
ˇŒback
;

73 
GCClosuª
 *
cc
 = (GCClosuª*Ë
˛osuª
;

74 
gpoöãr
 
d©a1
, 
d©a2
;

76 
	`g_ªtu∫_if_Áû
 (
n_∑øm_vÆues
 == 3);

78 i‡(
	`G_CCLOSURE_SWAP_DATA
 (
˛osuª
))

80 
d©a1
 = 
˛osuª
->
d©a
;

81 
d©a2
 = 
	`g_vÆue_≥ek_poöãr
 (
∑øm_vÆues
 + 0);

85 
d©a1
 = 
	`g_vÆue_≥ek_poöãr
 (
∑øm_vÆues
 + 0);

86 
d©a2
 = 
˛osuª
->
d©a
;

88 
ˇŒback
 = (
GM¨shÆFunc_VOID__POINTER_POINTER
Ë(
m¨shÆ_d©a
 ? m¨shÆ_d©®: 
cc
->callback);

90 
	`ˇŒback
 (
d©a1
,

91 
	`g_m¨shÆ_vÆue_≥ek_poöãr
 (
∑øm_vÆues
 + 1),

92 
	`g_m¨shÆ_vÆue_≥ek_poöãr
 (
∑øm_vÆues
 + 2),

93 
d©a2
);

94 
	}
}

98 
	$dü_m¨shÆ_VOID__STRING_FLAGS
 (
GClosuª
 *
˛osuª
,

99 
GVÆue
 *
ªtu∫_vÆue
 
G_GNUC_UNUSED
,

100 
guöt
 
n_∑øm_vÆues
,

101 c⁄° 
GVÆue
 *
∑øm_vÆues
,

102 
gpoöãr
 
övoˇti⁄_höt
 
G_GNUC_UNUSED
,

103 
gpoöãr
 
m¨shÆ_d©a
)

105 (*
	tGM¨shÆFunc_VOID__STRING_FLAGS
Ë(
	tgpoöãr
 
	td©a1
,

106 
	tgpoöãr
 
	t¨g_1
,

107 
	tguöt
 
	t¨g_2
,

108 
	tgpoöãr
 
	td©a2
);

109 
GM¨shÆFunc_VOID__STRING_FLAGS
 
ˇŒback
;

110 
GCClosuª
 *
cc
 = (GCClosuª*Ë
˛osuª
;

111 
gpoöãr
 
d©a1
, 
d©a2
;

113 
	`g_ªtu∫_if_Áû
 (
n_∑øm_vÆues
 == 3);

115 i‡(
	`G_CCLOSURE_SWAP_DATA
 (
˛osuª
))

117 
d©a1
 = 
˛osuª
->
d©a
;

118 
d©a2
 = 
	`g_vÆue_≥ek_poöãr
 (
∑øm_vÆues
 + 0);

122 
d©a1
 = 
	`g_vÆue_≥ek_poöãr
 (
∑øm_vÆues
 + 0);

123 
d©a2
 = 
˛osuª
->
d©a
;

125 
ˇŒback
 = (
GM¨shÆFunc_VOID__STRING_FLAGS
Ë(
m¨shÆ_d©a
 ? m¨shÆ_d©®: 
cc
->callback);

127 
	`ˇŒback
 (
d©a1
,

128 
	`g_m¨shÆ_vÆue_≥ek_°rög
 (
∑øm_vÆues
 + 1),

129 
	`g_m¨shÆ_vÆue_≥ek_Êags
 (
∑øm_vÆues
 + 2),

130 
d©a2
);

131 
	}
}

	@O:\tool\dvs50\lib\diamarshal.h

2 #i‚de‡
__dü_m¨shÆ_MARSHAL_H__


3 
	#__dü_m¨shÆ_MARSHAL_H__


	)

5 
	~<glib-obje˘.h
>

6 
	~"düv¨.h
"

7 
	gG_BEGIN_DECLS


10 
	#dü_m¨shÆ_VOID__VOID
 
g_c˛osuª_m¨shÆ_VOID__VOID


	)

13 
	#dü_m¨shÆ_VOID__OBJECT
 
g_c˛osuª_m¨shÆ_VOID__OBJECT


	)

16 
	#dü_m¨shÆ_VOID__INT
 
g_c˛osuª_m¨shÆ_VOID__INT


	)

19 
dü_m¨shÆ_VOID__POINTER_POINTER
 (
GClosuª
 *
˛osuª
,

20 
GVÆue
 *
ªtu∫_vÆue
,

21 
guöt
 
n_∑øm_vÆues
,

22 c⁄° 
GVÆue
 *
∑øm_vÆues
,

23 
gpoöãr
 
övoˇti⁄_höt
,

24 
gpoöãr
 
m¨shÆ_d©a
);

27 
dü_m¨shÆ_VOID__STRING_FLAGS
 (
GClosuª
 *
˛osuª
,

28 
GVÆue
 *
ªtu∫_vÆue
,

29 
guöt
 
n_∑øm_vÆues
,

30 c⁄° 
GVÆue
 *
∑øm_vÆues
,

31 
gpoöãr
 
övoˇti⁄_höt
,

32 
gpoöãr
 
m¨shÆ_d©a
);

34 
	gG_END_DECLS


	@O:\tool\dvs50\lib\diamenu.h

18 #i‚de‡
DIAMENU_H


19 
	#DIAMENU_H


	)

21 
	~"düty≥s.h
"

24 
	#DIAMENU_ACTIVE
 (1<<0)

	)

25 
	#DIAMENU_TOGGLE
 (1<<1)

	)

26 
	#DIAMENU_TOGGLE_ON
 (1<<2)

	)

29 
	gObje˘Ch™ge
 *(*
	tDüMíuCÆlback
)(
	tDüObje˘
 *
	tobj
, 
	tPoöt
 *
	tpos
, 
	tgpoöãr
 
	td©a
);

31 
	s_DüMíuIãm
 {

32 *
	mãxt
;

33 
DüMíuCÆlback
 
	mˇŒback
;

34 
gpoöãr
 
	mˇŒback_d©a
;

35 
	ma˘ive
;

37 *
	m≠p_d©a
;

40 (*
	tDüMíuAµD©aFªe
Ë(
	tDüMíu
 *
	tmíu
);

42 
	s_DüMíu
 {

43 *
tôÀ
;

44 
num_ôems
;

45 
DüMíuIãm
 *
ôems
;

47 *
≠p_d©a
;

48 
DüMíuAµD©aFªe
 
≠p_d©a_‰ì
;

	@O:\tool\dvs50\lib\diarenderer.c

24 
	~"düªndîî.h
"

25 
	~"obje˘.h
"

26 
	~"ãxt.h
"

27 
	~"ãxéöe.h
"

34 #i‚de‡
i¢™


35 
	#i¢™
(
x
) \

36 ( (
x
Ë= (Ë? 
	`i¢™_ld
 (x) \

37 :  (
x
Ë= (Ë? 
	`i¢™_d
 (x) \

38 : 
	`i¢™_f
 (
x
))

	)

39 
ölöe
 
	$i¢™_f
 (
x
Ë{  x !x; 
	}
}

40 
ölöe
 
	$i¢™_d
 (
x
Ë{  x !x; 
	}
}

41 
ölöe
 
	$i¢™_ld
 (
x
Ë{  x !x; 
	}
}

44 
	s_BezõrAµrox
 {

45 
Poöt
 *
	mpoöts
;

46 
	mnumpoöts
;

47 
	mcuºpoöt
;

50 
dü_ªndîî_˛ass_öô
 (
DüRídîîCœss
 *
kœss
);

52 
gë_width_pixñs
 (
DüRídîî
 *);

53 
gë_height_pixñs
 (
DüRídîî
 *);

55 
begö_ªndî
 (
DüRídîî
 *);

56 
íd_ªndî
 (
DüRídîî
 *);

58 
£t_löewidth
 (
DüRídîî
 *
ªndîî
, 
ªÆ
 
löewidth
);

59 
£t_löeˇps
 (
DüRídîî
 *
ªndîî
, 
LöeC≠s
 
mode
);

60 
£t_löejoö
 (
DüRídîî
 *
ªndîî
, 
LöeJoö
 
mode
);

61 
£t_löe°yÀ
 (
DüRídîî
 *
ªndîî
, 
LöeStyÀ
 
mode
);

62 
£t_dashÀngth
 (
DüRídîî
 *
ªndîî
, 
ªÆ
 
Àngth
);

63 
£t_fûl°yÀ
 (
DüRídîî
 *
ªndîî
, 
FûlStyÀ
 
mode
);

64 
£t_f⁄t
 (
DüRídîî
 *
ªndîî
, 
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
);

66 
døw_löe
 (
DüRídîî
 *
ªndîî
,

67 
Poöt
 *
°¨t
, Poöà*
íd
,

68 
Cﬁ‹
 *
cﬁ‹
);

69 
fûl_ª˘
 (
DüRídîî
 *
ªndîî
,

70 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

71 
Cﬁ‹
 *
cﬁ‹
);

72 
fûl_pﬁyg⁄
 (
DüRídîî
 *
ªndîî
,

73 
Poöt
 *
poöts
, 
num_poöts
,

74 
Cﬁ‹
 *
cﬁ‹
);

75 
døw_¨c
 (
DüRídîî
 *
ªndîî
,

76 
Poöt
 *
˚¡î
,

77 
ªÆ
 
width
,Ñó»
height
,

78 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

79 
Cﬁ‹
 *
cﬁ‹
);

80 
fûl_¨c
 (
DüRídîî
 *
ªndîî
,

81 
Poöt
 *
˚¡î
,

82 
ªÆ
 
width
,Ñó»
height
,

83 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

84 
Cﬁ‹
 *
cﬁ‹
);

85 
døw_ñlù£
 (
DüRídîî
 *
ªndîî
,

86 
Poöt
 *
˚¡î
,

87 
ªÆ
 
width
,Ñó»
height
,

88 
Cﬁ‹
 *
cﬁ‹
);

89 
fûl_ñlù£
 (
DüRídîî
 *
ªndîî
,

90 
Poöt
 *
˚¡î
,

91 
ªÆ
 
width
,Ñó»
height
,

92 
Cﬁ‹
 *
cﬁ‹
);

93 
døw_bezõr
 (
DüRídîî
 *
ªndîî
,

94 
BezPoöt
 *
poöts
,

95 
numpoöts
,

96 
Cﬁ‹
 *
cﬁ‹
);

97 
fûl_bezõr
 (
DüRídîî
 *
ªndîî
,

98 
BezPoöt
 *
poöts
,

99 
numpoöts
,

100 
Cﬁ‹
 *
cﬁ‹
);

101 
døw_°rög
 (
DüRídîî
 *
ªndîî
,

102 c⁄° 
gch¨
 *
ãxt
,

103 
Poöt
 *
pos
,

104 
Alignmít
 
Æignmít
,

105 
Cﬁ‹
 *
cﬁ‹
);

106 
døw_image
 (
DüRídîî
 *
ªndîî
,

107 
Poöt
 *
poöt
,

108 
ªÆ
 
width
,Ñó»
height
,

109 
DüImage
 *
image
);

110 
døw_ãxt
 (
DüRídîî
 *
ªndîî
,

111 
Text
 *
ãxt
);

112 
døw_ãxt_löe
 (
DüRídîî
 *
ªndîî
,

113 
TextLöe
 *
ãxt_löe
, 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
, 
Cﬁ‹
 *
cﬁ‹
);

115 
døw_ª˘
 (
DüRídîî
 *
ªndîî
,

116 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

117 
Cﬁ‹
 *
cﬁ‹
);

118 
døw_pﬁylöe
 (
DüRídîî
 *
ªndîî
,

119 
Poöt
 *
poöts
, 
num_poöts
,

120 
Cﬁ‹
 *
cﬁ‹
);

121 
døw_rounded_pﬁylöe
 (
DüRídîî
 *
ªndîî
,

122 
Poöt
 *
poöts
, 
num_poöts
,

123 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
);

124 
døw_pﬁyg⁄
 (
DüRídîî
 *
ªndîî
,

125 
Poöt
 *
poöts
, 
num_poöts
,

126 
Cﬁ‹
 *
cﬁ‹
);

128 
ªÆ
 
gë_ãxt_width
 (
DüRídîî
 *
ªndîî
,

129 c⁄° 
gch¨
 *
ãxt
, 
Àngth
);

131 
døw_rounded_ª˘
 (
DüRídîî
 *
ªndîî
,

132 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

133 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
);

134 
fûl_rounded_ª˘
 (
DüRídîî
 *
ªndîî
,

135 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

136 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
);

137 
døw_löe_wôh_¨rows
 (
DüRídîî
 *
ªndîî
,

138 
Poöt
 *
°¨t
, Poöà*
íd
,

139 
ªÆ
 
löe_width
,

140 
Cﬁ‹
 *
löe_cﬁ‹
,

141 
Aºow
 *
°¨t_¨row
,

142 
Aºow
 *
íd_¨row
);

143 
døw_¨c_wôh_¨rows
 (
DüRídîî
 *
ªndîî
,

144 
Poöt
 *
°¨t
,

145 
Poöt
 *
íd
,

146 
Poöt
 *
midpoöt
,

147 
ªÆ
 
löe_width
,

148 
Cﬁ‹
 *
cﬁ‹
,

149 
Aºow
 *
°¨t_¨row
,

150 
Aºow
 *
íd_¨row
);

151 
døw_pﬁylöe_wôh_¨rows
 (
DüRídîî
 *
ªndîî
,

152 
Poöt
 *
poöts
, 
num_poöts
,

153 
ªÆ
 
löe_width
,

154 
Cﬁ‹
 *
cﬁ‹
,

155 
Aºow
 *
°¨t_¨row
,

156 
Aºow
 *
íd_¨row
);

157 
døw_rounded_pﬁylöe_wôh_¨rows
 (
DüRídîî
 *
ªndîî
,

158 
Poöt
 *
poöts
, 
num_poöts
,

159 
ªÆ
 
löe_width
,

160 
Cﬁ‹
 *
cﬁ‹
,

161 
Aºow
 *
°¨t_¨row
,

162 
Aºow
 *
íd_¨row
,

163 
ªÆ
 
ødius
);

165 
døw_bezõr_wôh_¨rows
 (
DüRídîî
 *
ªndîî
,

166 
BezPoöt
 *
poöts
,

167 
num_poöts
,

168 
ªÆ
 
löe_width
,

169 
Cﬁ‹
 *
cﬁ‹
,

170 
Aºow
 *
°¨t_¨row
,

171 
Aºow
 *
íd_¨row
);

173 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

175 
GTy≥


176 
	$dü_ªndîî_gë_ty≥
 ()

178 
GTy≥
 
obje˘_ty≥
 = 0;

180 i‡(!
obje˘_ty≥
)

182 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

184  (
DüRídîîCœss
),

185 (
GBa£InôFunc
Ë
NULL
,

186 (
GBa£FöÆizeFunc
Ë
NULL
,

187 (
GCœssInôFunc
Ë
dü_ªndîî_˛ass_öô
,

188 
NULL
,

189 
NULL
,

190  (
DüRídîî
),

192 
NULL


195 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
G_TYPE_OBJECT
,

197 &
obje˘_öfo
, 0);

200  
obje˘_ty≥
;

201 
	}
}

204 
	$døw_obje˘
 (
DüRídîî
 *
ªndîî
,

205 
DüObje˘
 *
obje˘
)

207 
obje˘
->
›s
->
	`døw
(obje˘, 
ªndîî
);

208 
	}
}

211 
	$ªndîî_föÆize
 (
GObje˘
 *
obje˘
)

213 
DüRídîî
 *
ªndîî
 = 
	`DIA_RENDERER
 (
obje˘
);

215 i‡(
ªndîî
->
f⁄t
)

216 
	`dü_f⁄t_uƒef
 (
ªndîî
->
f⁄t
);

218 i‡(
ªndîî
->
bezõr
)

220 i‡(
ªndîî
->
bezõr
->
poöts
)

221 
	`g_‰ì
 (
ªndîî
->
bezõr
->
poöts
);

222 
	`g_‰ì
 (
ªndîî
->
bezõr
);

225 
	`G_OBJECT_CLASS
 (
∑ª¡_˛ass
)->
	`föÆize
 (
obje˘
);

226 
	}
}

229 
	$dü_ªndîî_˛ass_öô
 (
DüRídîîCœss
 *
kœss
)

231 
GObje˘Cœss
 *
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
kœss
);

232 
DüRídîîCœss
 *
ªndîî_˛ass
 = 
	`DIA_RENDERER_CLASS
 (
kœss
);

234 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
kœss
);

236 
obje˘_˛ass
->
föÆize
 = 
ªndîî_föÆize
;

238 
ªndîî_˛ass
->
gë_width_pixñs
 = get_width_pixels;

239 
ªndîî_˛ass
->
gë_height_pixñs
 = get_height_pixels;

240 
ªndîî_˛ass
->
døw_obje˘
 = draw_object;

241 
ªndîî_˛ass
->
gë_ãxt_width
 = get_text_width;

243 
ªndîî_˛ass
->
begö_ªndî
 = begin_render;

244 
ªndîî_˛ass
->
íd_ªndî
 =Énd_render;

246 
ªndîî_˛ass
->
£t_löewidth
 = set_linewidth;

247 
ªndîî_˛ass
->
£t_löeˇps
 = set_linecaps;

248 
ªndîî_˛ass
->
£t_löejoö
 = set_linejoin;

249 
ªndîî_˛ass
->
£t_löe°yÀ
 = set_linestyle;

250 
ªndîî_˛ass
->
£t_dashÀngth
 = set_dashlength;

251 
ªndîî_˛ass
->
£t_fûl°yÀ
 = set_fillstyle;

252 
ªndîî_˛ass
->
£t_f⁄t
 = set_font;

254 
ªndîî_˛ass
->
døw_löe
 = draw_line;

255 
ªndîî_˛ass
->
fûl_ª˘
 = fill_rect;

256 
ªndîî_˛ass
->
fûl_pﬁyg⁄
 = fill_polygon;

257 
ªndîî_˛ass
->
døw_¨c
 = draw_arc;

258 
ªndîî_˛ass
->
fûl_¨c
 = fill_arc;

259 
ªndîî_˛ass
->
døw_ñlù£
 = draw_ellipse;

260 
ªndîî_˛ass
->
fûl_ñlù£
 = fill_ellipse;

261 
ªndîî_˛ass
->
døw_°rög
 = draw_string;

262 
ªndîî_˛ass
->
døw_image
 = draw_image;

265 
ªndîî_˛ass
->
døw_bezõr
 = draw_bezier;

266 
ªndîî_˛ass
->
fûl_bezõr
 = fill_bezier;

267 
ªndîî_˛ass
->
døw_ª˘
 = draw_rect;

268 
ªndîî_˛ass
->
døw_rounded_pﬁylöe
 = draw_rounded_polyline;

269 
ªndîî_˛ass
->
døw_pﬁylöe
 = draw_polyline;

270 
ªndîî_˛ass
->
døw_pﬁyg⁄
 = draw_polygon;

271 
ªndîî_˛ass
->
døw_ãxt
 = draw_text;

272 
ªndîî_˛ass
->
døw_ãxt_löe
 = draw_text_line;

275 
ªndîî_˛ass
->
døw_rounded_ª˘
 = draw_rounded_rect;

276 
ªndîî_˛ass
->
fûl_rounded_ª˘
 = fill_rounded_rect;

277 
ªndîî_˛ass
->
døw_löe_wôh_¨rows
 = draw_line_with_arrows;

278 
ªndîî_˛ass
->
døw_¨c_wôh_¨rows
 = draw_arc_with_arrows;

279 
ªndîî_˛ass
->
døw_pﬁylöe_wôh_¨rows
 = draw_polyline_with_arrows;

280 
ªndîî_˛ass
->
døw_rounded_pﬁylöe_wôh_¨rows
 = draw_rounded_polyline_with_arrows;

281 
ªndîî_˛ass
->
døw_bezõr_wôh_¨rows
 = draw_bezier_with_arrows;

282 
	}
}

285 
	$begö_ªndî
 (
DüRídîî
 *
obje˘
)

287 
	`g_w¨nög
 ("%s::begin_renderÇot implemented!",

288 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
obje˘
)));

289 
	}
}

292 
	$íd_ªndî
 (
DüRídîî
 *
obje˘
)

294 
	`g_w¨nög
 ("%s::end_renderÇot implemented!",

295 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
obje˘
)));

296 
	}
}

299 
	$£t_löewidth
 (
DüRídîî
 *
obje˘
, 
ªÆ
 
löewidth
)

301 
	`g_w¨nög
 ("%s::set_line_widthÇot implemented!",

302 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
obje˘
)));

303 
	}
}

306 
	$£t_löeˇps
 (
DüRídîî
 *
obje˘
, 
LöeC≠s
 
mode
)

308 
	`g_w¨nög
 ("%s::set_line_capsÇot implemented!",

309 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
obje˘
)));

310 
	}
}

313 
	$£t_löejoö
 (
DüRídîî
 *
ªndîî
, 
LöeJoö
 
mode
)

315 
	`g_w¨nög
 ("%s::set_line_joinÇot implemented!",

316 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

317 
	}
}

320 
	$£t_löe°yÀ
 (
DüRídîî
 *
ªndîî
, 
LöeStyÀ
 
mode
)

322 
	`g_w¨nög
 ("%s::set_line_styleÇot implemented!",

323 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

324 
	}
}

327 
	$£t_dashÀngth
 (
DüRídîî
 *
ªndîî
, 
ªÆ
 
Àngth
)

329 
	`g_w¨nög
 ("%s::set_dash_lengthÇot implemented!",

330 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

331 
	}
}

334 
	$£t_fûl°yÀ
 (
DüRídîî
 *
ªndîî
, 
FûlStyÀ
 
mode
)

336 
	`g_w¨nög
 ("%s::set_fill_styleÇot implemented!",

337 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

338 
	}
}

341 
	$£t_f⁄t
 (
DüRídîî
 *
ªndîî
, 
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
)

344 
	`dü_f⁄t_ªf
 (
f⁄t
);

345 i‡(
ªndîî
->
f⁄t
)

346 
	`dü_f⁄t_uƒef
 (
ªndîî
->
f⁄t
);

347 
ªndîî
->
f⁄t
 = font;

348 
ªndîî
->
f⁄t_height
 = 
height
;

349 
	}
}

353 
	$døw_löe
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
°¨t
, Poöà*
íd
, 
Cﬁ‹
 *
cﬁ‹
)

355 
	`g_w¨nög
 ("%s::draw_lineÇot implemented!",

356 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

357 
	}
}

360 
	$fûl_pﬁyg⁄
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
poöts
, 
num_poöts
, 
Cﬁ‹
 *
cﬁ‹
)

362 
	`g_w¨nög
 ("%s::fill_polygonÇot implemented!",

363 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

364 
	}
}

367 
	$døw_¨c
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
˚¡î
,

368 
ªÆ
 
width
,Ñó»
height
,Ñó»
™gÀ1
,Ñó»
™gÀ2
,

369 
Cﬁ‹
 *
cﬁ‹
)

371 
	`g_w¨nög
 ("%s::draw_arcÇot implemented!",

372 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

373 
	}
}

376 
	$fûl_ª˘
 (
DüRídîî
 *
ªndîî
,

377 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

378 
Cﬁ‹
 *
cﬁ‹
)

380 
	`g_w¨nög
 ("%s::fill_rectÇot implemented!",

381 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

382 
	}
}

385 
	$fûl_¨c
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
˚¡î
,

386 
ªÆ
 
width
,Ñó»
height
,Ñó»
™gÀ1
,Ñó»
™gÀ2
,

387 
Cﬁ‹
 *
cﬁ‹
)

389 
	`g_w¨nög
 ("%s::fill_arcÇot implemented!",

390 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

391 
	}
}

394 
	$døw_ñlù£
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
˚¡î
,

395 
ªÆ
 
width
,Ñó»
height
,

396 
Cﬁ‹
 *
cﬁ‹
)

398 
	`g_w¨nög
 ("%s::draw_ellipseÇot implemented!",

399 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

400 
	}
}

403 
	$fûl_ñlù£
 (
DüRídîî
 *
ªndîî
, 
Poöt
 *
˚¡î
,

404 
ªÆ
 
width
,Ñó»
height
, 
Cﬁ‹
 *
cﬁ‹
)

406 
	`g_w¨nög
 ("%s::fill_ellipseÇot implemented!",

407 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

408 
	}
}

411 
	$døw_°rög
 (
DüRídîî
 *
ªndîî
,

412 c⁄° 
gch¨
 *
ãxt
, 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
,

413 
Cﬁ‹
 *
cﬁ‹
)

415 
	`g_w¨nög
 ("%s::draw_stringÇot implemented!",

416 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

417 
	}
}

421 
	$døw_ãxt
 (
DüRídîî
 *
ªndîî
,

422 
Text
 *
ãxt
)

424 
Poöt
 
pos
;

425 
i
;

427 
pos
 = 
ãxt
->
posôi⁄
;

429 
i
=0;i<
ãxt
->
numlöes
;i++) {

430 
TextLöe
 *
ãxt_löe
 = 
ãxt
->
löes
[
i
];

432 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_ãxt_löe
(renderer,

433 
ãxt_löe
,

434 &
pos
,

435 
ãxt
->
Æignmít
,

436 &
ãxt
->
cﬁ‹
);

437 
pos
.
y
 +
ãxt
->
height
;

439 
	}
}

443 
	$døw_ãxt_löe
 (
DüRídîî
 *
ªndîî
,

444 
TextLöe
 *
ãxt_löe
, 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
, 
Cﬁ‹
 *
cﬁ‹
)

446 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_f⁄t
(renderer,

447 
	`ãxt_löe_gë_f⁄t
(
ãxt_löe
),

448 
	`ãxt_löe_gë_height
(
ãxt_löe
));

450 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_°rög
(renderer,

451 
	`ãxt_löe_gë_°rög
(
ãxt_löe
),

452 
pos
, 
Æignmít
,

453 
cﬁ‹
);

454 
	}
}

457 
	$døw_image
 (
DüRídîî
 *
ªndîî
,

458 
Poöt
 *
poöt
, 
ªÆ
 
width
,Ñó»
height
,

459 
DüImage
 *
image
)

461 
	`g_w¨nög
 ("%s::draw_imageÇot implemented!",

462 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

463 
	}
}

477 
	#BEZIER_SUBDIVIDE_LIMIT
 0.01

	)

478 
	#BEZIER_SUBDIVIDE_LIMIT_SQ
 (
BEZIER_SUBDIVIDE_LIMIT
*BEZIER_SUBDIVIDE_LIMIT)

	)

481 
	$bezõr_add_poöt
(
BezõrAµrox
 *
bezõr
,

482 
Poöt
 *
poöt
)

485 i‡(
bezõr
->
cuºpoöt
 =bezõr->
numpoöts
) {

486 
bezõr
->
numpoöts
 += 40;

487 
bezõr
->
poöts
 = 
	`g_ªÆloc
(bezier->points,

488 
bezõr
->
numpoöts
*(
Poöt
));

491 
bezõr
->
poöts
[bezõr->
cuºpoöt
] = *
poöt
;

493 
bezõr
->
cuºpoöt
++;

494 
	}
}

497 
	$bezõr_add_löes
(
BezõrAµrox
 *
bezõr
,

498 
Poöt
 
poöts
[4])

500 
Poöt
 
u
, 
v
, 
x
, 
y
;

501 
Poöt
 
r
[4];

502 
Poöt
 
s
[4];

503 
Poöt
 
middÀ
;

504 
co‹d
 
dñè
;

505 
ªÆ
 
v_Àn_sq
;

508 
u
 = 
poöts
[1];

509 
	`poöt_sub
(&
u
, &
poöts
[0]);

510 
v
 = 
poöts
[3];

511 
	`poöt_sub
(&
v
, &
poöts
[0]);

512 
y
 = 
v
;

513 
v_Àn_sq
 = 
	`poöt_dŸ
(&
v
,&v);

514 i‡(
	`i¢™
(
v_Àn_sq
)) {

515 
	`g_w¨nög
("v_len_sq is NaN while calculating bezier curve!");

518 i‡(
v_Àn_sq
 < 0.000001)

519 
v_Àn_sq
 = 0.000001;

520 
	`poöt_sˇÀ
(&
y
, 
	`poöt_dŸ
(&
u
,&
v
)/
v_Àn_sq
);

521 
x
 = 
u
;

522 
	`poöt_sub
(&
x
,&
y
);

523 
dñè
 = 
	`poöt_dŸ
(&
x
,&x);

524 i‡(
dñè
 < 
BEZIER_SUBDIVIDE_LIMIT_SQ
) {

525 
u
 = 
poöts
[2];

526 
	`poöt_sub
(&
u
, &
poöts
[3]);

527 
v
 = 
poöts
[0];

528 
	`poöt_sub
(&
v
, &
poöts
[3]);

529 
y
 = 
v
;

530 
v_Àn_sq
 = 
	`poöt_dŸ
(&
v
,&v);

531 i‡(
v_Àn_sq
 < 0.000001)

532 
v_Àn_sq
 = 0.000001;

533 
	`poöt_sˇÀ
(&
y
, 
	`poöt_dŸ
(&
u
,&
v
)/
v_Àn_sq
);

534 
x
 = 
u
;

535 
	`poöt_sub
(&
x
,&
y
);

536 
dñè
 = 
	`poöt_dŸ
(&
x
,&x);

537 i‡(
dñè
 < 
BEZIER_SUBDIVIDE_LIMIT_SQ
) {

538 
	`bezõr_add_poöt
(
bezõr
, &
poöts
[3]);

544 
middÀ
 = 
poöts
[1];

545 
	`poöt_add
(&
middÀ
, &
poöts
[2]);

546 
	`poöt_sˇÀ
(&
middÀ
, 0.5);

548 
r
[0] = 
poöts
[0];

550 
r
[1] = 
poöts
[0];

551 
	`poöt_add
(&
r
[1], &
poöts
[1]);

552 
	`poöt_sˇÀ
(&
r
[1], 0.5);

554 
r
[2] =Ñ[1];

555 
	`poöt_add
(&
r
[2], &
middÀ
);

556 
	`poöt_sˇÀ
(&
r
[2], 0.5);

558 
s
[3] = 
poöts
[3];

560 
s
[2] = 
poöts
[2];

561 
	`poöt_add
(&
s
[2], &
poöts
[3]);

562 
	`poöt_sˇÀ
(&
s
[2], 0.5);

564 
s
[1] = s[2];

565 
	`poöt_add
(&
s
[1], &
middÀ
);

566 
	`poöt_sˇÀ
(&
s
[1], 0.5);

568 
r
[3] =Ñ[2];

569 
	`poöt_add
(&
r
[3], &
s
[1]);

570 
	`poöt_sˇÀ
(&
r
[3], 0.5);

572 
s
[0] = 
r
[3];

574 
	`bezõr_add_löes
(
bezõr
, 
r
);

575 
	`bezõr_add_löes
(
bezõr
, 
s
);

576 
	}
}

579 
	$bezõr_add_curve
(
BezõrAµrox
 *
bezõr
,

580 
Poöt
 
poöts
[4])

583 i‡–(
	`di°™˚_poöt_poöt
(&
poöts
[0], &points[1]) < 0.00001) &&

584 (
	`di°™˚_poöt_poöt
(&
poöts
[2], &points[3]) < 0.00001) &&

585 (
	`di°™˚_poöt_poöt
(&
poöts
[0], &points[3]) < 0.00001)) {

586 
	`bezõr_add_poöt
(
bezõr
, &
poöts
[3]);

589 
	`bezõr_add_löes
(
bezõr
, 
poöts
);

590 
	}
}

593 
	$≠¥oxim©e_bezõr
 (
BezõrAµrox
 *
bezõr
,

594 
BezPoöt
 *
poöts
, 
numpoöts
)

596 
Poöt
 
curve
[4];

597 
i
;

599 i‡(
poöts
[0].
ty≥
 !
BEZ_MOVE_TO
)

600 
	`g_w¨nög
("first BezPoint must beá BEZ_MOVE_TO");

601 
curve
[3] = 
poöts
[0].
p1
;

602 
	`bezõr_add_poöt
(
bezõr
, &
poöts
[0].
p1
);

603 
i
 = 1; i < 
numpoöts
; i++)

604 
poöts
[
i
].
ty≥
) {

605 
BEZ_MOVE_TO
:

606 
	`g_w¨nög
("only first BezPoint can beá BEZ_MOVE_TO");

607 
curve
[3] = 
poöts
[
i
].
p1
;

609 
BEZ_LINE_TO
:

610 
	`bezõr_add_poöt
(
bezõr
, &
poöts
[
i
].
p1
);

611 
curve
[3] = 
poöts
[
i
].
p1
;

613 
BEZ_CURVE_TO
:

614 
curve
[0] = curve[3];

615 
curve
[1] = 
poöts
[
i
].
p1
;

616 
curve
[2] = 
poöts
[
i
].
p2
;

617 
curve
[3] = 
poöts
[
i
].
p3
;

618 
	`bezõr_add_curve
(
bezõr
, 
curve
);

621 
	}
}

625 
	$døw_bezõr
 (
DüRídîî
 *
ªndîî
,

626 
BezPoöt
 *
poöts
, 
numpoöts
,

627 
Cﬁ‹
 *
cﬁ‹
)

629 
BezõrAµrox
 *
bezõr
;

631 i‡(
ªndîî
->
bezõr
)

632 
bezõr
 = 
ªndîî
->bezier;

634 
ªndîî
->
bezõr
 = bezõ∏
	`g_√w0
 (
BezõrAµrox
, 1);

636 i‡(
bezõr
->
poöts
 =
NULL
) {

637 
bezõr
->
numpoöts
 = 30;

638 
bezõr
->
poöts
 = 
	`g_mÆloc
(bezõr->
numpoöts
*(
Poöt
));

641 
bezõr
->
cuºpoöt
 = 0;

642 
	`≠¥oxim©e_bezõr
 (
bezõr
, 
poöts
, 
numpoöts
);

644 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`døw_pﬁylöe
 (renderer,

645 
bezõr
->
poöts
,

646 
bezõr
->
cuºpoöt
,

647 
cﬁ‹
);

648 
	}
}

651 
	$fûl_bezõr
 (
DüRídîî
 *
ªndîî
,

652 
BezPoöt
 *
poöts
, 
numpoöts
,

653 
Cﬁ‹
 *
cﬁ‹
)

655 
BezõrAµrox
 *
bezõr
;

657 i‡(
ªndîî
->
bezõr
)

658 
bezõr
 = 
ªndîî
->bezier;

660 
ªndîî
->
bezõr
 = bezõ∏
	`g_√w0
 (
BezõrAµrox
, 1);

662 i‡(
bezõr
->
poöts
 =
NULL
) {

663 
bezõr
->
numpoöts
 = 30;

664 
bezõr
->
poöts
 = 
	`g_mÆloc
(bezõr->
numpoöts
*(
Poöt
));

667 
bezõr
->
cuºpoöt
 = 0;

668 
	`≠¥oxim©e_bezõr
 (
bezõr
, 
poöts
, 
numpoöts
);

670 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`fûl_pﬁyg⁄
 (renderer,

671 
bezõr
->
poöts
,

672 
bezõr
->
cuºpoöt
,

673 
cﬁ‹
);

674 
	}
}

677 
	$døw_ª˘
 (
DüRídîî
 *
ªndîî
,

678 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

679 
Cﬁ‹
 *
cﬁ‹
)

681 
DüRídîîCœss
 *
kœss
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

682 
Poöt
 
ur
, 
Œ
;

684 
ur
.
x
 = 
Ã_c‹√r
->x;

685 
ur
.
y
 = 
ul_c‹√r
->y;

686 
Œ
.
x
 = 
ul_c‹√r
->x;

687 
Œ
.
y
 = 
Ã_c‹√r
->y;

689 
kœss
->
	`døw_löe
 (
ªndîî
, 
ul_c‹√r
, &
ur
, 
cﬁ‹
);

690 
kœss
->
	`døw_löe
 (
ªndîî
, &
ur
, 
Ã_c‹√r
, 
cﬁ‹
);

691 
kœss
->
	`døw_löe
 (
ªndîî
, 
Ã_c‹√r
, &
Œ
, 
cﬁ‹
);

692 
kœss
->
	`døw_löe
 (
ªndîî
, &
Œ
, 
ul_c‹√r
, 
cﬁ‹
);

693 
	}
}

696 
	$døw_pﬁylöe
 (
DüRídîî
 *
ªndîî
,

697 
Poöt
 *
poöts
, 
num_poöts
,

698 
Cﬁ‹
 *
cﬁ‹
)

700 
DüRídîîCœss
 *
kœss
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

701 
i
;

703 
i
 = 0; i < 
num_poöts
 - 1; i++)

704 
kœss
->
	`døw_löe
 (
ªndîî
, &
poöts
[
i
+0], &poöts[i+1], 
cﬁ‹
);

705 
	}
}

716 
ªÆ


717 
	$ˇlcuœã_mö_ødius
–
Poöt
 *
p1
, Poöà*
p2
, Poöà*
p3
 )

719 
ªÆ
 
c
;

720 
ªÆ
 
a
;

721 
Poöt
 
v1
,
v2
;

723 
c
 = 
	`MIN
(
	`di°™˚_poöt_poöt
(
p1
,
p2
)/2,di°™˚_poöt_poöt’2,
p3
)/2);

724 
v1
.
x
 = 
p1
->x-
p2
->x; v1.
y
 =Ö1->y-p2->y;

725 
v2
.
x
 = 
p3
->x-
p2
->x; v2.
y
 =Ö3->y-p2->y;

726 
a
 = 
	`dŸ2
(&
v1
,&
v2
);

727  (
c
*
	`sö
(
a
/2));

728 
	}
}

735 
	$døw_rounded_pﬁylöe
 (
DüRídîî
 *
ªndîî
,

736 
Poöt
 *
poöts
, 
num_poöts
,

737 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
)

739 
DüRídîîCœss
 *
kœss
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

740 
i
 = 0;

741 
Poöt
 
p1
,
p2
,
p3
,
p4
 ;

742 
Poöt
 *
p
;

743 
p
 = 
poöts
;

745 i‡(
ødius
 < 0.00001) {

746 
kœss
->
	`døw_pﬁylöe
(
ªndîî
, 
poöts
, 
num_poöts
, 
cﬁ‹
);

751 i‡–
num_poöts
 <= 2 ) {

752 
i
 = 0;

753 
p1
.
x
 = 
p
[
i
].x;Ö1.
y
 =Ö[i].y;

754 
p2
.
x
 = 
p
[
i
+1].x;Ö2.
y
 =Ö[i+1].y;

755 
kœss
->
	`døw_löe
(
ªndîî
,&
p1
,&
p2
,
cﬁ‹
);

759 
i
 = 0;

761 
p1
.
x
 = 
p
[
i
].x;Ö1.
y
 =Ö[i].y;

762 
p2
.
x
 = 
p
[
i
+1].x;Ö2.
y
 =Ö[i+1].y;

763 
i
 = 0; i <
num_poöts
 - 3; i++) {

764 
Poöt
 
c
;

765 
ªÆ
 
°¨t_™gÀ
, 
°›_™gÀ
;

766 
ªÆ
 
mö_ødius
;

767 
p3
.
x
 = 
p
[
i
+1].x;Ö3.
y
 =Ö[i+1].y;

768 
p4
.
x
 = 
p
[
i
+2].x;Ö4.
y
 =Ö[i+2].y;

771 
mö_ødius
 = 
	`MIN
(
ødius
, 
	`ˇlcuœã_mö_ødius
(&
p1
,&
p2
,&
p4
));

772 
	`fûÀt
(&
p1
,&
p2
,&
p3
,&
p4
, 
mö_ødius
, &
c
, &
°¨t_™gÀ
, &
°›_™gÀ
);

773 
kœss
->
	`døw_¨c
(
ªndîî
, &
c
, 
mö_ødius
*2, min_radius*2,

774 
°¨t_™gÀ
,

775 
°›_™gÀ
, 
cﬁ‹
);

776 
kœss
->
	`døw_löe
(
ªndîî
, &
p1
, &
p2
, 
cﬁ‹
);

777 
p1
.
x
 = 
p3
.x;Ö1.
y
 =Ö3.y;

778 
p2
.
x
 = 
p4
.x;Ö2.
y
 =Ö4.y;

780 
kœss
->
	`døw_löe
(
ªndîî
, &
p3
, &
p4
, 
cﬁ‹
);

781 
	}
}

784 
	$døw_pﬁyg⁄
 (
DüRídîî
 *
ªndîî
,

785 
Poöt
 *
poöts
, 
num_poöts
,

786 
Cﬁ‹
 *
cﬁ‹
)

788 
DüRídîîCœss
 *
kœss
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

789 
i
;

791 
	`g_ªtu∫_if_Áû
 (
num_poöts
 > 1);

793 
i
 = 0; i < 
num_poöts
 - 1; i++)

794 
kœss
->
	`døw_löe
 (
ªndîî
, &
poöts
[
i
+0], &poöts[i+1], 
cﬁ‹
);

796 i‡–(
poöts
[0].
x
 !poöts[
num_poöts
-1].x)

797 || (
poöts
[0].
y
 !poöts[
num_poöts
-1].y))

798 
kœss
->
	`døw_löe
 (
ªndîî
, &
poöts
[
num_poöts
-1], &poöts[0], 
cﬁ‹
);

799 
	}
}

802 
	$døw_rounded_ª˘
 (
DüRídîî
 *
ªndîî
,

803 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

804 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
)

806 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

807 
Poöt
 
°¨t
, 
íd
, 
˚¡î
;

809 
ødius
 = 
	`MIN
‘adius, (
Ã_c‹√r
->
x
-
ul_c‹√r
->x)/2);

810 
ødius
 = 
	`MIN
‘adius, (
Ã_c‹√r
->
y
-
ul_c‹√r
->y)/2);

812 i‡(
ødius
 < 0.00001) {

813 
ªndîî_›s
->
	`døw_ª˘
(
ªndîî
, 
ul_c‹√r
, 
Ã_c‹√r
, 
cﬁ‹
);

817 
°¨t
.
x
 = 
˚¡î
.x = 
ul_c‹√r
->x+
ødius
;

818 
íd
.
x
 = 
Ã_c‹√r
->x-
ødius
;

819 
°¨t
.
y
 = 
íd
.y = 
ul_c‹√r
->y;

820 
ªndîî_›s
->
	`døw_löe
(
ªndîî
, &
°¨t
, &
íd
, 
cﬁ‹
);

821 
°¨t
.
y
 = 
íd
.y = 
Ã_c‹√r
->y;

822 
ªndîî_›s
->
	`døw_löe
(
ªndîî
, &
°¨t
, &
íd
, 
cﬁ‹
);

824 
˚¡î
.
y
 = 
ul_c‹√r
->y+
ødius
;

825 
ªndîî_›s
->
	`døw_¨c
(
ªndîî
, &
˚¡î
,

826 2.0*
ødius
, 2.0*radius,

827 90.0, 180.0, 
cﬁ‹
);

828 
˚¡î
.
x
 = 
íd
.x;

829 
ªndîî_›s
->
	`døw_¨c
(
ªndîî
, &
˚¡î
,

830 2.0*
ødius
, 2.0*radius,

831 0.0, 90.0, 
cﬁ‹
);

833 
°¨t
.
y
 = 
ul_c‹√r
->y+
ødius
;

834 
°¨t
.
x
 = 
íd
.x = 
ul_c‹√r
->x;

835 
íd
.
y
 = 
˚¡î
.y = 
Ã_c‹√r
->y-
ødius
;

836 
ªndîî_›s
->
	`døw_löe
(
ªndîî
, &
°¨t
, &
íd
, 
cﬁ‹
);

837 
°¨t
.
x
 = 
íd
.x = 
Ã_c‹√r
->x;

838 
ªndîî_›s
->
	`døw_löe
(
ªndîî
, &
°¨t
, &
íd
, 
cﬁ‹
);

840 
˚¡î
.
y
 = 
Ã_c‹√r
->y-
ødius
;

841 
˚¡î
.
x
 = 
ul_c‹√r
->x+
ødius
;

842 
ªndîî_›s
->
	`døw_¨c
(
ªndîî
, &
˚¡î
,

843 2.0*
ødius
, 2.0*radius,

844 180.0, 270.0, 
cﬁ‹
);

845 
˚¡î
.
x
 = 
Ã_c‹√r
->x-
ødius
;

846 
ªndîî_›s
->
	`døw_¨c
(
ªndîî
, &
˚¡î
,

847 2.0*
ødius
, 2.0*radius,

848 270.0, 360.0, 
cﬁ‹
);

849 
	}
}

852 
	$fûl_rounded_ª˘
(
DüRídîî
 *
ªndîî
,

853 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

854 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
)

856 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

857 
Poöt
 
°¨t
, 
íd
, 
˚¡î
;

859 
ødius
 = 
	`MIN
‘adius, (
Ã_c‹√r
->
x
-
ul_c‹√r
->x)/2);

860 
ødius
 = 
	`MIN
‘adius, (
Ã_c‹√r
->
y
-
ul_c‹√r
->y)/2);

862 i‡(
ødius
 < 0.00001) {

863 
ªndîî_›s
->
	`fûl_ª˘
(
ªndîî
, 
ul_c‹√r
, 
Ã_c‹√r
, 
cﬁ‹
);

867 
°¨t
.
x
 = 
˚¡î
.x = 
ul_c‹√r
->x+
ødius
;

868 
íd
.
x
 = 
Ã_c‹√r
->x-
ødius
;

869 
°¨t
.
y
 = 
ul_c‹√r
->y;

870 
íd
.
y
 = 
Ã_c‹√r
->y;

871 
ªndîî_›s
->
	`fûl_ª˘
(
ªndîî
, &
°¨t
, &
íd
, 
cﬁ‹
);

873 
˚¡î
.
y
 = 
ul_c‹√r
->y+
ødius
;

874 
ªndîî_›s
->
	`fûl_¨c
(
ªndîî
, &
˚¡î
,

875 2.0*
ødius
, 2.0*radius,

876 90.0, 180.0, 
cﬁ‹
);

877 
˚¡î
.
x
 = 
íd
.x;

878 
ªndîî_›s
->
	`fûl_¨c
(
ªndîî
, &
˚¡î
,

879 2.0*
ødius
, 2.0*radius,

880 0.0, 90.0, 
cﬁ‹
);

883 
°¨t
.
x
 = 
ul_c‹√r
->x;

884 
°¨t
.
y
 = 
ul_c‹√r
->y+
ødius
;

885 
íd
.
x
 = 
Ã_c‹√r
->x;

886 
íd
.
y
 = 
˚¡î
.y = 
Ã_c‹√r
->y-
ødius
;

887 
ªndîî_›s
->
	`fûl_ª˘
(
ªndîî
, &
°¨t
, &
íd
, 
cﬁ‹
);

889 
˚¡î
.
y
 = 
Ã_c‹√r
->y-
ødius
;

890 
˚¡î
.
x
 = 
ul_c‹√r
->x+
ødius
;

891 
ªndîî_›s
->
	`fûl_¨c
(
ªndîî
, &
˚¡î
,

892 2.0*
ødius
, 2.0*radius,

893 180.0, 270.0, 
cﬁ‹
);

894 
˚¡î
.
x
 = 
Ã_c‹√r
->x-
ødius
;

895 
ªndîî_›s
->
	`fûl_¨c
(
ªndîî
, &
˚¡î
,

896 2.0*
ødius
, 2.0*radius,

897 270.0, 360.0, 
cﬁ‹
);

898 
	}
}

901 
	$døw_löe_wôh_¨rows
(
DüRídîî
 *
ªndîî
,

902 
Poöt
 *
°¨çoöt
,

903 
Poöt
 *
ídpoöt
,

904 
ªÆ
 
löe_width
,

905 
Cﬁ‹
 *
cﬁ‹
,

906 
Aºow
 *
°¨t_¨row
,

907 
Aºow
 *
íd_¨row
)

909 
Poöt
 
ﬁd°¨t
 = *
°¨çoöt
;

910 
Poöt
 
ﬁdíd
 = *
ídpoöt
;

911 
Poöt
 
°¨t_¨row_hód
;

912 
Poöt
 
íd_¨row_hód
;

915 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
) {

916 
Poöt
 
move_¨row
, 
move_löe
;

917 
	`ˇlcuœã_¨row_poöt
(
°¨t_¨row
, 
°¨çoöt
, 
ídpoöt
,

918 &
move_¨row
, &
move_löe
,

919 
löe_width
);

920 
°¨t_¨row_hód
 = *
°¨çoöt
;

921 
	`poöt_sub
(&
°¨t_¨row_hód
, &
move_¨row
);

922 
	`poöt_sub
(
°¨çoöt
, &
move_löe
);

924 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
) {

925 
Poöt
 
move_¨row
, 
move_löe
;

926 
	`ˇlcuœã_¨row_poöt
(
íd_¨row
, 
ídpoöt
, 
°¨çoöt
,

927 &
move_¨row
, &
move_löe
,

928 
löe_width
);

929 
íd_¨row_hód
 = *
ídpoöt
;

930 
	`poöt_sub
(&
íd_¨row_hód
, &
move_¨row
);

931 
	`poöt_sub
(
ídpoöt
, &
move_löe
);

934 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, 
°¨çoöt
, 
ídpoöt
, 
cﬁ‹
);

937 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
)

938 
	`¨row_døw
(
ªndîî
, 
°¨t_¨row
->
ty≥
,

939 &
°¨t_¨row_hód
, 
ídpoöt
,

940 
°¨t_¨row
->
Àngth
, sèπ_¨row->
width
,

941 
löe_width
,

942 
cﬁ‹
, &
cﬁ‹_whôe
);

943 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
)

944 
	`¨row_døw
(
ªndîî
, 
íd_¨row
->
ty≥
,

945 &
íd_¨row_hód
, 
°¨çoöt
,

946 
íd_¨row
->
Àngth
,Énd_¨row->
width
,

947 
löe_width
,

948 
cﬁ‹
, &
cﬁ‹_whôe
);

950 *
°¨çoöt
 = 
ﬁd°¨t
;

951 *
ídpoöt
 = 
ﬁdíd
;

952 
	}
}

955 
	$døw_pﬁylöe_wôh_¨rows
(
DüRídîî
 *
ªndîî
,

956 
Poöt
 *
poöts
, 
num_poöts
,

957 
ªÆ
 
löe_width
,

958 
Cﬁ‹
 *
cﬁ‹
,

959 
Aºow
 *
°¨t_¨row
,

960 
Aºow
 *
íd_¨row
)

963 
fú°löe
 = 0;

964 
œ°löe
 = 
num_poöts
;

965 
Poöt
 
ﬁd°¨t
 = 
poöts
[
fú°löe
];

966 
Poöt
 
ﬁdíd
 = 
poöts
[
œ°löe
-1];

967 
Poöt
 
°¨t_¨row_hód
;

968 
Poöt
 
íd_¨row_hód
;

970 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
) {

971 
Poöt
 
move_¨row
, 
move_löe
;

972 
fú°löe
 < 
num_poöts
-1 &&

973 
	`di°™˚_poöt_poöt
(&
poöts
[
fú°löe
],

974 &
poöts
[
fú°löe
+1]) < 0.0000001)

975 
fú°löe
++;

976 i‡(
fú°löe
 =
num_poöts
-1)

977 
fú°löe
 = 0;

978 
ﬁd°¨t
 = 
poöts
[
fú°löe
];

979 
	`ˇlcuœã_¨row_poöt
(
°¨t_¨row
,

980 &
poöts
[
fú°löe
], &points[firstline+1],

981 &
move_¨row
, &
move_löe
,

982 
löe_width
);

983 
°¨t_¨row_hód
 = 
poöts
[
fú°löe
];

984 
	`poöt_sub
(&
°¨t_¨row_hód
, &
move_¨row
);

985 
	`poöt_sub
(&
poöts
[
fú°löe
], &
move_löe
);

987 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
) {

988 
Poöt
 
move_¨row
, 
move_löe
;

989 
œ°löe
 > 0 &&

990 
	`di°™˚_poöt_poöt
(&
poöts
[
œ°löe
-1],

991 &
poöts
[
œ°löe
-2]) < 0.0000001)

992 
œ°löe
--;

993 i‡(
œ°löe
 == 0)

994 
fú°löe
 = 
num_poöts
;

995 
ﬁdíd
 = 
poöts
[
œ°löe
-1];

996 
	`ˇlcuœã_¨row_poöt
(
íd_¨row
, &
poöts
[
œ°löe
-1],

997 &
poöts
[
œ°löe
-2],

998 &
move_¨row
, &
move_löe
,

999 
löe_width
);

1000 
íd_¨row_hód
 = 
poöts
[
œ°löe
-1];

1001 
	`poöt_sub
(&
íd_¨row_hód
, &
move_¨row
);

1002 
	`poöt_sub
(&
poöts
[
œ°löe
-1], &
move_löe
);

1005 i‡(
œ°löe
-
fú°löe
 > 1)

1007 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁylöe
‘ídîî, &
poöts
[
fú°löe
],

1008 
œ°löe
-
fú°löe
, 
cﬁ‹
);

1009 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
)

1010 
	`¨row_døw
(
ªndîî
, 
°¨t_¨row
->
ty≥
,

1011 &
°¨t_¨row_hód
, &
poöts
[
fú°löe
+1],

1012 
°¨t_¨row
->
Àngth
, sèπ_¨row->
width
,

1013 
löe_width
,

1014 
cﬁ‹
, &
cﬁ‹_whôe
);

1015 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
)

1016 
	`¨row_døw
(
ªndîî
, 
íd_¨row
->
ty≥
,

1017 &
íd_¨row_hód
, &
poöts
[
œ°löe
-2],

1018 
íd_¨row
->
Àngth
,Énd_¨row->
width
,

1019 
löe_width
,

1020 
cﬁ‹
, &
cﬁ‹_whôe
);

1022 
poöts
[
fú°löe
] = 
ﬁd°¨t
;

1023 
poöts
[
œ°löe
-1] = 
ﬁdíd
;

1024 
	}
}

1027 
	$døw_rounded_pﬁylöe_wôh_¨rows
(
DüRídîî
 *
ªndîî
,

1028 
Poöt
 *
poöts
, 
num_poöts
,

1029 
ªÆ
 
löe_width
,

1030 
Cﬁ‹
 *
cﬁ‹
,

1031 
Aºow
 *
°¨t_¨row
,

1032 
Aºow
 *
íd_¨row
,

1033 
ªÆ
 
ødius
)

1036 
fú°löe
 = 0;

1037 
œ°löe
 = 
num_poöts
;

1038 
Poöt
 
ﬁd°¨t
 = 
poöts
[
fú°löe
];

1039 
Poöt
 
ﬁdíd
 = 
poöts
[
œ°löe
-1];

1040 
Poöt
 
°¨t_¨row_hód
;

1041 
Poöt
 
íd_¨row_hód
;

1043 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
) {

1044 
Poöt
 
move_¨row
, 
move_löe
;

1045 
fú°löe
 < 
num_poöts
-1 &&

1046 
	`di°™˚_poöt_poöt
(&
poöts
[
fú°löe
],

1047 &
poöts
[
fú°löe
+1]) < 0.0000001)

1048 
fú°löe
++;

1049 i‡(
fú°löe
 =
num_poöts
-1)

1050 
fú°löe
 = 0;

1051 
ﬁd°¨t
 = 
poöts
[
fú°löe
];

1052 
	`ˇlcuœã_¨row_poöt
(
°¨t_¨row
,

1053 &
poöts
[
fú°löe
], &points[firstline+1],

1054 &
move_¨row
, &
move_löe
,

1055 
löe_width
);

1056 
°¨t_¨row_hód
 = 
poöts
[
fú°löe
];

1057 
	`poöt_sub
(&
°¨t_¨row_hód
, &
move_¨row
);

1058 
	`poöt_sub
(&
poöts
[
fú°löe
], &
move_löe
);

1060 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
) {

1061 
Poöt
 
move_¨row
, 
move_löe
;

1062 
œ°löe
 > 0 &&

1063 
	`di°™˚_poöt_poöt
(&
poöts
[
œ°löe
-1],

1064 &
poöts
[
œ°löe
-2]) < 0.0000001)

1065 
œ°löe
--;

1066 i‡(
œ°löe
 == 0)

1067 
fú°löe
 = 
num_poöts
;

1068 
ﬁdíd
 = 
poöts
[
œ°löe
-1];

1069 
	`ˇlcuœã_¨row_poöt
(
íd_¨row
, &
poöts
[
œ°löe
-1],

1070 &
poöts
[
œ°löe
-2],

1071 &
move_¨row
, &
move_löe
,

1072 
löe_width
);

1073 
íd_¨row_hód
 = 
poöts
[
œ°löe
-1];

1074 
	`poöt_sub
(&
íd_¨row_hód
, &
move_¨row
);

1075 
	`poöt_sub
(&
poöts
[
œ°löe
-1], &
move_löe
);

1078 i‡(
œ°löe
-
fú°löe
 > 1)

1079 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_rounded_pﬁylöe
(renderer,

1080 &
poöts
[
fú°löe
],

1081 
œ°löe
-
fú°löe
,

1082 
cﬁ‹
, 
ødius
);

1083 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
)

1084 
	`¨row_døw
(
ªndîî
, 
°¨t_¨row
->
ty≥
,

1085 &
°¨t_¨row_hód
, &
poöts
[
fú°löe
+1],

1086 
°¨t_¨row
->
Àngth
, sèπ_¨row->
width
,

1087 
löe_width
,

1088 
cﬁ‹
, &
cﬁ‹_whôe
);

1089 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
)

1090 
	`¨row_døw
(
ªndîî
, 
íd_¨row
->
ty≥
,

1091 &
íd_¨row_hód
, &
poöts
[
œ°löe
-2],

1092 
íd_¨row
->
Àngth
,Énd_¨row->
width
,

1093 
löe_width
,

1094 
cﬁ‹
, &
cﬁ‹_whôe
);

1096 
poöts
[
fú°löe
] = 
ﬁd°¨t
;

1097 
poöts
[
œ°löe
-1] = 
ﬁdíd
;

1098 
	}
}

1103 
gboﬁón


1104 
	$poöts_to_löe
(
ªÆ
 *
a
,Ñó»*
b
, 
Poöt
 *
p1
, Poöà*
p2
)

1106 i‡(
	`Ábs
(
p1
->
x
 - 
p2
->x) < 0.000000001)

1107  
FALSE
;

1108 *
a
 = (
p2
->
y
-
p1
->y)/’2->
x
-p1->x);

1109 *
b
 = 
p1
->
y
-(*
a
)*p1->
x
;

1110  
TRUE
;

1111 
	}
}

1116 
gboﬁón


1117 
	$öãr£˘i⁄_löe_löe
(
Poöt
 *
¸oss
,

1118 
Poöt
 *
p1a
, Poöà*
p1b
,

1119 
Poöt
 *
p2a
, Poöà*
p2b
)

1121 
ªÆ
 
a1
, 
b1
, 
a2
, 
b2
;

1124 i‡(!(
	`poöts_to_löe
(&
a1
, &
b1
, 
p1a
, 
p1b
))) {

1125 i‡(!(
	`poöts_to_löe
(&
a2
, &
b2
, 
p2a
, 
p2b
))) {

1126 i‡(
	`Ábs
(
p1a
->
x
-
p2a
->x) < 0.00000001) {

1127 *
¸oss
 = *
p1a
;

1128  
TRUE
;

1129 }  
FALSE
;

1131 
¸oss
->
x
 = 
p1a
->x;

1132 
¸oss
->
y
 = 
a2
*(
p1a
->
x
)+
b2
;

1133  
TRUE
;

1135 i‡(!(
	`poöts_to_löe
(&
a2
, &
b2
, 
p2a
, 
p2b
))) {

1136 
¸oss
->
x
 = 
p2a
->x;

1137 
¸oss
->
y
 = 
a1
*(
p2a
->
x
)+
b1
;

1138  
TRUE
;

1141 i‡(
	`Ábs
(
a1
-
a2
) < 0.000000001) {

1142 i‡(
	`Ábs
(
b1
-
b2
) < 0.000000001) {

1143 *
¸oss
 = *
p1a
;

1144  
TRUE
;

1146  
FALSE
;

1156 
¸oss
->
x
 = (
b2
-
b1
)/(
a1
-
a2
);

1157 
¸oss
->
y
 = 
a1
*¸oss->
x
+
b1
;

1158  
TRUE
;

1160 
	}
}

1167 
gboﬁón


1168 
	$föd_˚¡î_poöt
(
Poöt
 *
˚¡î
, c⁄° Poöà*
p1
, c⁄° Poöà*
p2
, c⁄° Poöà*
p3
)

1170 
Poöt
 
mid1
;

1171 
Poöt
 
mid2
;

1172 
Poöt
 
‹th1
;

1173 
Poöt
 
‹th2
;

1174 
ªÆ
 
tmp
;

1177 
mid1
 = *
p1
;

1178 
	`poöt_sub
(&
mid1
, 
p2
);

1179 
	`poöt_sˇÀ
(&
mid1
, 0.5);

1180 
‹th1
 = 
mid1
;

1181 
	`poöt_add
(&
mid1
, 
p2
);

1182 
tmp
 = 
‹th1
.
x
;

1183 
‹th1
.
x
 = oπh1.
y
;

1184 
‹th1
.
y
 = -
tmp
;

1185 
	`poöt_add
(&
‹th1
, &
mid1
);

1189 
mid2
 = *
p2
;

1190 
	`poöt_sub
(&
mid2
, 
p3
);

1191 
	`poöt_sˇÀ
(&
mid2
, 0.5);

1192 
‹th2
 = 
mid2
;

1193 
	`poöt_add
(&
mid2
, 
p3
);

1194 
tmp
 = 
‹th2
.
x
;

1195 
‹th2
.
x
 = oπh2.
y
;

1196 
‹th2
.
y
 = -
tmp
;

1197 
	`poöt_add
(&
‹th2
, &
mid2
);

1200 i‡(!
	`öãr£˘i⁄_löe_löe
(
˚¡î
, &
mid1
, &
‹th1
, &
mid2
, &
‹th2
)) {

1203 i‡(
	`Ábs
((
p1
->
x
 + 
p2
->x + 
p3
->x)/3 -Ö1->x) < 0.0000001 &&

1204 
	`Ábs
((
p1
->
y
 + 
p2
->y + 
p3
->y)/3 -Ö1->y) < 0.0000001) {

1205  
FALSE
;

1210 i‡(
	`di°™˚_poöt_poöt_m™h©èn
(
p1
, 
p2
) < 0.0000001) {

1211 *
˚¡î
 = 
mid2
;

1212  
TRUE
;

1213 } i‡(
	`di°™˚_poöt_poöt_m™h©èn
(
p1
, 
p3
) < 0.0000001 ||

1214 
	`di°™˚_poöt_poöt_m™h©èn
(
p2
, 
p3
) < 0.0000001) {

1215 *
˚¡î
 = 
mid1
;

1216  
TRUE
;

1219  
FALSE
;

1221  
TRUE
;

1222 
	}
}

1224 
gboﬁón


1225 
	$is_right_h™d
 (c⁄° 
Poöt
 *
a
, c⁄° Poöà*
b
, c⁄° Poöà*
c
)

1227 
Poöt
 
dŸ1
, 
dŸ2
;

1229 
dŸ1
 = *
a
;

1230 
	`poöt_sub
(&
dŸ1
, 
c
);

1231 
	`poöt_n‹mÆize
(&
dŸ1
);

1232 
dŸ2
 = *
b
;

1233 
	`poöt_sub
(&
dŸ2
, 
c
);

1234 
	`poöt_n‹mÆize
(&
dŸ2
);

1235  
	`poöt_¸oss
(&
dŸ1
, &
dŸ2
) > 0;

1236 
	}
}

1239 
	$døw_¨c_wôh_¨rows
 (
DüRídîî
 *
ªndîî
,

1240 
Poöt
 *
°¨çoöt
,

1241 
Poöt
 *
ídpoöt
,

1242 
Poöt
 *
midpoöt
,

1243 
ªÆ
 
löe_width
,

1244 
Cﬁ‹
 *
cﬁ‹
,

1245 
Aºow
 *
°¨t_¨row
,

1246 
Aºow
 *
íd_¨row
)

1248 
Poöt
 
√w_°¨çoöt
 = *
°¨çoöt
;

1249 
Poöt
 
√w_ídpoöt
 = *
ídpoöt
;

1250 
Poöt
 
˚¡î
;

1251 
ªÆ
 
width
, 
™gÀ1
, 
™gÀ2
;

1252 
gboﬁón
 
righth™d
;

1253 
Poöt
 
°¨t_¨row_hód
;

1254 
Poöt
 
°¨t_¨row_íd
;

1255 
Poöt
 
íd_¨row_hód
;

1256 
Poöt
 
íd_¨row_íd
;

1258 i‡(!
	`föd_˚¡î_poöt
(&
˚¡î
, 
°¨çoöt
, 
ídpoöt
, 
midpoöt
)) {

1260 
	`¥ötf
("Degenerate\n");

1263 
righth™d
 = 
	`is_right_h™d
 (
°¨çoöt
, 
midpoöt
, 
ídpoöt
);

1265 
width
 = 2*
	`di°™˚_poöt_poöt
(&
˚¡î
, 
°¨çoöt
);

1267 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
) {

1268 
Poöt
 
move_¨row
, 
move_löe
;

1269 
ªÆ
 
tmp
;

1271 
°¨t_¨row_íd
 = *
°¨çoöt
;

1272 
	`poöt_sub
(&
°¨t_¨row_íd
, &
˚¡î
);

1273 
tmp
 = 
°¨t_¨row_íd
.
x
;

1274 i‡(
righth™d
) {

1275 
°¨t_¨row_íd
.
x
 = -°¨t_¨row_íd.
y
;

1276 
°¨t_¨row_íd
.
y
 = 
tmp
;

1278 
°¨t_¨row_íd
.
x
 = sèπ_¨row_íd.
y
;

1279 
°¨t_¨row_íd
.
y
 = -
tmp
;

1281 
	`poöt_add
(&
°¨t_¨row_íd
, 
°¨çoöt
);

1283 
	`ˇlcuœã_¨row_poöt
(
°¨t_¨row
, 
°¨çoöt
, &
°¨t_¨row_íd
,

1284 &
move_¨row
, &
move_löe
,

1285 
löe_width
);

1286 
°¨t_¨row_hód
 = *
°¨çoöt
;

1287 
	`poöt_sub
(&
°¨t_¨row_hód
, &
move_¨row
);

1288 
	`poöt_sub
(&
√w_°¨çoöt
, &
move_löe
);

1290 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
) {

1291 
Poöt
 
move_¨row
, 
move_löe
;

1292 
ªÆ
 
tmp
;

1294 
íd_¨row_íd
 = *
ídpoöt
;

1295 
	`poöt_sub
(&
íd_¨row_íd
, &
˚¡î
);

1296 
tmp
 = 
íd_¨row_íd
.
x
;

1297 i‡(
righth™d
) {

1298 
íd_¨row_íd
.
x
 =Énd_¨row_íd.
y
;

1299 
íd_¨row_íd
.
y
 = -
tmp
;

1301 
íd_¨row_íd
.
x
 = -íd_¨row_íd.
y
;

1302 
íd_¨row_íd
.
y
 = 
tmp
;

1304 
	`poöt_add
(&
íd_¨row_íd
, 
ídpoöt
);

1306 
	`ˇlcuœã_¨row_poöt
(
íd_¨row
, 
ídpoöt
, &
íd_¨row_íd
,

1307 &
move_¨row
, &
move_löe
,

1308 
löe_width
);

1309 
íd_¨row_hód
 = *
ídpoöt
;

1310 
	`poöt_sub
(&
íd_¨row_hód
, &
move_¨row
);

1311 
	`poöt_sub
(&
√w_ídpoöt
, &
move_löe
);

1324 
™gÀ1
 = -
	`©™2
(
√w_°¨çoöt
.
y
 - 
˚¡î
.y,Çew_°¨çoöt.
x
 - cíãr.x)*180.0/
G_PI
;

1325 
™gÀ1
 < 0.0)ángle1 += 360.0;

1326 
™gÀ2
 = -
	`©™2
(
√w_ídpoöt
.
y
 - 
˚¡î
.y,Çew_ídpoöt.
x
 - cíãr.x)*180.0/
G_PI
;

1327 
™gÀ2
 < 0.0)ángle2 += 360.0;

1328 i‡(
righth™d
) {

1329 
ªÆ
 
tmp
 = 
™gÀ1
;

1330 
™gÀ1
 = 
™gÀ2
;

1331 
™gÀ2
 = 
tmp
;

1334 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
) {

1335 
√w_°¨çoöt
.
x
 = 
	`cos
 (
G_PI
 * 
™gÀ1
 / 180.0Ë* 
width
 / 2.0 + 
˚¡î
.x;

1336 
√w_°¨çoöt
.
y
 = 
	`sö
 (
G_PI
 * 
™gÀ1
 / 180.0Ë* 
width
 / 2.0 + 
˚¡î
.y;

1338 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
) {

1339 
√w_ídpoöt
.
x
 = 
	`cos
 (
G_PI
 * 
™gÀ1
 / 180.0Ë* 
width
 / 2.0 + 
˚¡î
.x;

1340 
√w_ídpoöt
.
y
 = 
	`sö
 (
G_PI
 * 
™gÀ1
 / 180.0Ë* 
width
 / 2.0 + 
˚¡î
.y;

1343 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_¨c
‘ídîî, &
˚¡î
, 
width
, width,

1344 
™gÀ1
, 
™gÀ2
, 
cﬁ‹
);

1346 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
)

1347 
	`¨row_døw
(
ªndîî
, 
°¨t_¨row
->
ty≥
,

1348 &
°¨t_¨row_hód
, &
°¨t_¨row_íd
,

1349 
°¨t_¨row
->
Àngth
, sèπ_¨row->
width
,

1350 
löe_width
,

1351 
cﬁ‹
, &
cﬁ‹_whôe
);

1352 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
)

1353 
	`¨row_døw
(
ªndîî
, 
íd_¨row
->
ty≥
,

1354 &
íd_¨row_hód
, &
íd_¨row_íd
,

1355 
íd_¨row
->
Àngth
,Énd_¨row->
width
,

1356 
löe_width
,

1357 
cﬁ‹
, &
cﬁ‹_whôe
);

1358 
	}
}

1361 
	$døw_bezõr_wôh_¨rows
(
DüRídîî
 *
ªndîî
,

1362 
BezPoöt
 *
poöts
,

1363 
num_poöts
,

1364 
ªÆ
 
löe_width
,

1365 
Cﬁ‹
 *
cﬁ‹
,

1366 
Aºow
 *
°¨t_¨row
,

1367 
Aºow
 *
íd_¨row
)

1369 
Poöt
 
°¨çoöt
, 
ídpoöt
;

1370 
Poöt
 
°¨t_¨row_hód
;

1371 
Poöt
 
íd_¨row_hód
;

1373 
°¨çoöt
 = 
poöts
[0].
p1
;

1374 
ídpoöt
 = 
poöts
[
num_poöts
-1].
p3
;

1376 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
) {

1377 
Poöt
 
move_¨row
;

1378 
Poöt
 
move_löe
;

1379 
	`ˇlcuœã_¨row_poöt
(
°¨t_¨row
, &
poöts
[0].
p1
, &points[1].p1,

1380 &
move_¨row
, &
move_löe
,

1381 
löe_width
);

1382 
°¨t_¨row_hód
 = 
poöts
[0].
p1
;

1383 
	`poöt_sub
(&
°¨t_¨row_hód
, &
move_¨row
);

1384 
	`poöt_sub
(&
poöts
[0].
p1
, &
move_löe
);

1386 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
) {

1387 
Poöt
 
move_¨row
;

1388 
Poöt
 
move_löe
;

1389 
	`ˇlcuœã_¨row_poöt
(
íd_¨row
,

1390 &
poöts
[
num_poöts
-1].
p3
, &poöts[num_poöts-1].
p2
,

1391 &
move_¨row
, &
move_löe
,

1392 
löe_width
);

1393 
íd_¨row_hód
 = 
poöts
[
num_poöts
-1].
p3
;

1394 
	`poöt_sub
(&
íd_¨row_hód
, &
move_¨row
);

1395 
	`poöt_sub
(&
poöts
[
num_poöts
-1].
p3
, &
move_löe
);

1397 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_bezõr
‘ídîî, 
poöts
, 
num_poöts
, 
cﬁ‹
);

1398 i‡(
°¨t_¨row
 !
NULL
 && sèπ_¨row->
ty≥
 !
ARROW_NONE
)

1399 
	`¨row_døw
(
ªndîî
, 
°¨t_¨row
->
ty≥
,

1400 &
°¨t_¨row_hód
, &
poöts
[1].
p1
,

1401 
°¨t_¨row
->
Àngth
, sèπ_¨row->
width
,

1402 
löe_width
,

1403 
cﬁ‹
, &
cﬁ‹_whôe
);

1404 i‡(
íd_¨row
 !
NULL
 &&Énd_¨row->
ty≥
 !
ARROW_NONE
)

1405 
	`¨row_døw
(
ªndîî
, 
íd_¨row
->
ty≥
,

1406 &
íd_¨row_hód
, &
poöts
[
num_poöts
-1].
p2
,

1407 
íd_¨row
->
Àngth
,Énd_¨row->
width
,

1408 
löe_width
,

1409 
cﬁ‹
, &
cﬁ‹_whôe
);

1411 
poöts
[0].
p1
 = 
°¨çoöt
;

1412 
poöts
[
num_poöts
-1].
p3
 = 
ídpoöt
;

1414 
	}
}

1420 
ªÆ


1421 
	$gë_ãxt_width
 (
DüRídîî
 *
ªndîî
,

1422 c⁄° 
gch¨
 *
ãxt
, 
Àngth
)

1424 
ªÆ
 
ªt
 = 0;

1426 i‡(
ªndîî
->
f⁄t
) {

1427 *
°r
 = 
	`g_°∫dup
 (
ãxt
, 
Àngth
);

1429 
ªt
 = 
	`dü_f⁄t_°rög_width
 (
°r
,

1430 
ªndîî
->
f⁄t
,

1431 
ªndîî
->
f⁄t_height
);

1432 
	`g_‰ì
 (
°r
);

1434 
	`g_w¨nög
 ("%s::get_text_widthÇot implemented (andÑenderer->font==NULL)!",

1435 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
ªndîî
)));

1438  
ªt
;

1439 
	}
}

1442 
	$gë_width_pixñs
 (
DüRídîî
 *
ªndîî
)

1444 
	`g_ªtu∫_vÆ_if_Áû
 (
ªndîî
->
is_öãø˘ive
, 0);

1446 
	}
}

1449 
	$gë_height_pixñs
 (
DüRídîî
 *
ªndîî
)

1451 
	`g_ªtu∫_vÆ_if_Áû
 (
ªndîî
->
is_öãø˘ive
, 0);

1453 
	}
}

1460 
	$dü_ªndîî_gë_width_pixñs
 (
DüRídîî
 *
ªndîî
)

1462  
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`gë_width_pixñs
 (renderer);

1463 
	}
}

1466 
	$dü_ªndîî_gë_height_pixñs
 (
DüRídîî
 *
ªndîî
)

1468  
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`gë_height_pixñs
 (renderer);

1469 
	}
}

	@O:\tool\dvs50\lib\diarenderer.h

20 #i‚de‡
DIA_RENDERER_H


21 
	#DIA_RENDERER_H


	)

23 
	~"düty≥s.h
"

24 
	~<glib-obje˘.h
>

26 
	~"dü-íums.h
"

27 
	~"geomëry.h
"

28 
	~"f⁄t.h
"

30 
	gG_BEGIN_DECLS


33 
	#DIA_TYPE_RENDERER
 (
	`dü_ªndîî_gë_ty≥
 ())

	)

35 
	#DIA_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_RENDERER
, 
DüRídîî
))

	)

37 
	#DIA_RENDERER_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_RENDERER
, 
DüRídîîCœss
))

	)

39 
	#DIA_IS_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_RENDERER
))

	)

41 
	#DIA_RENDERER_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_RENDERER
, 
DüRídîîCœss
))

	)

43 
	$__de˛•ec
(
dŒexp‹t
Ë
GTy≥
 
	$dü_ªndîî_gë_ty≥
 (Ë
G_GNUC_CONST
;

46 
	s_DüRídîî


48 
GObje˘
 
∑ª¡_ö°™˚
;

49 
gboﬁón
 
is_öãø˘ive
;

51 
DüF⁄t
 *
f⁄t
;

52 
ªÆ
 
f⁄t_height
;

56 
BezõrAµrox
 *
bezõr
;

67 
	s_DüRídîîCœss


69 
GObje˘Cœss
 
∑ª¡_˛ass
;

72 (*
gë_width_pixñs
Ë(
DüRídîî
*);

74 (*
gë_height_pixñs
Ë(
DüRídîî
*);

76 (*
døw_obje˘
Ë(
DüRídîî
*, 
DüObje˘
*);

82 
	`ªÆ
 (*
gë_ãxt_width
Ë(
DüRídîî
 *
ªndîî
,

83 c⁄° 
gch¨
 *
ãxt
, 
Àngth
);

91 (*
begö_ªndî
Ë(
DüRídîî
 *);

94 (*
íd_ªndî
Ë(
DüRídîî
 *);

98 (*
£t_löewidth
Ë(
DüRídîî
 *
ªndîî
, 
ªÆ
 
löewidth
);

100 (*
£t_löeˇps
Ë(
DüRídîî
 *
ªndîî
, 
LöeC≠s
 
mode
);

102 (*
£t_löejoö
Ë(
DüRídîî
 *
ªndîî
, 
LöeJoö
 
mode
);

104 (*
£t_löe°yÀ
Ë(
DüRídîî
 *
ªndîî
, 
LöeStyÀ
 
mode
);

107 (*
£t_dashÀngth
Ë(
DüRídîî
 *
ªndîî
, 
ªÆ
 
Àngth
);

109 (*
£t_fûl°yÀ
Ë(
DüRídîî
 *
ªndîî
, 
FûlStyÀ
 
mode
);

111 (*
£t_f⁄t
Ë(
DüRídîî
 *
ªndîî
, 
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
);

114 (*
døw_löe
Ë(
DüRídîî
 *
ªndîî
,

115 
Poöt
 *
°¨t
, Poöà*
íd
,

116 
Cﬁ‹
 *
cﬁ‹
);

118 (*
fûl_ª˘
Ë(
DüRídîî
 *
ªndîî
,

119 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

120 
Cﬁ‹
 *
cﬁ‹
);

122 (*
fûl_pﬁyg⁄
Ë(
DüRídîî
 *
ªndîî
,

123 
Poöt
 *
poöts
, 
num_poöts
,

124 
Cﬁ‹
 *
cﬁ‹
);

127 (*
døw_¨c
Ë(
DüRídîî
 *
ªndîî
,

128 
Poöt
 *
˚¡î
,

129 
ªÆ
 
width
,Ñó»
height
,

130 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

131 
Cﬁ‹
 *
cﬁ‹
);

133 (*
fûl_¨c
Ë(
DüRídîî
 *
ªndîî
,

134 
Poöt
 *
˚¡î
,

135 
ªÆ
 
width
,Ñó»
height
,

136 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

137 
Cﬁ‹
 *
cﬁ‹
);

139 (*
døw_ñlù£
Ë(
DüRídîî
 *
ªndîî
,

140 
Poöt
 *
˚¡î
,

141 
ªÆ
 
width
,Ñó»
height
,

142 
Cﬁ‹
 *
cﬁ‹
);

144 (*
fûl_ñlù£
Ë(
DüRídîî
 *
ªndîî
,

145 
Poöt
 *
˚¡î
,

146 
ªÆ
 
width
,Ñó»
height
,

147 
Cﬁ‹
 *
cﬁ‹
);

149 (*
døw_°rög
Ë(
DüRídîî
 *
ªndîî
,

150 c⁄° 
gch¨
 *
ãxt
,

151 
Poöt
 *
pos
,

152 
Alignmít
 
Æignmít
,

153 
Cﬁ‹
 *
cﬁ‹
);

155 (*
døw_image
Ë(
DüRídîî
 *
ªndîî
,

156 
Poöt
 *
poöt
,

157 
ªÆ
 
width
,Ñó»
height
,

158 
DüImage
 *
image
);

166 (*
døw_bezõr
Ë(
DüRídîî
 *
ªndîî
,

167 
BezPoöt
 *
poöts
,

168 
numpoöts
,

169 
Cﬁ‹
 *
cﬁ‹
);

172 (*
fûl_bezõr
Ë(
DüRídîî
 *
ªndîî
,

173 
BezPoöt
 *
poöts
,

174 
numpoöts
,

175 
Cﬁ‹
 *
cﬁ‹
);

178 (*
døw_pﬁylöe
Ë(
DüRídîî
 *
ªndîî
,

179 
Poöt
 *
poöts
, 
num_poöts
,

180 
Cﬁ‹
 *
cﬁ‹
);

184 (*
døw_pﬁyg⁄
Ë(
DüRídîî
 *
ªndîî
,

185 
Poöt
 *
poöts
, 
num_poöts
,

186 
Cﬁ‹
 *
cﬁ‹
);

188 (*
døw_ãxt
Ë(
DüRídîî
 *
ªndîî
,

189 
Text
 *
ãxt
);

191 (*
døw_ãxt_löe
Ë(
DüRídîî
 *
ªndîî
,

192 
TextLöe
 *
ãxt_löe
, 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
, 
Cﬁ‹
 *
cﬁ‹
);

194 (*
døw_ª˘
Ë(
DüRídîî
 *
ªndîî
,

195 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

196 
Cﬁ‹
 *
cﬁ‹
);

203 (*
døw_rounded_ª˘
Ë(
DüRídîî
 *
ªndîî
,

204 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

205 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
);

208 (*
fûl_rounded_ª˘
Ë(
DüRídîî
 *
ªndîî
,

209 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

210 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
);

213 (*
døw_rounded_pﬁylöe
Ë(
DüRídîî
 *
ªndîî
,

214 
Poöt
 *
poöts
, 
num_poöts
,

215 
Cﬁ‹
 *
cﬁ‹
, 
ªÆ
 
ødius
 );

218 (*
døw_löe_wôh_¨rows
Ë(
DüRídîî
 *
ªndîî
,

219 
Poöt
 *
°¨t
, Poöà*
íd
,

220 
ªÆ
 
löe_width
,

221 
Cﬁ‹
 *
löe_cﬁ‹
,

222 
Aºow
 *
°¨t_¨row
,

223 
Aºow
 *
íd_¨row
);

225 (*
døw_¨c_wôh_¨rows
Ë(
DüRídîî
 *
ªndîî
,

226 
Poöt
 *
°¨t
, Poöà*
íd
,

227 
Poöt
 *
midpoöt
,

228 
ªÆ
 
löe_width
,

229 
Cﬁ‹
 *
cﬁ‹
,

230 
Aºow
 *
°¨t_¨row
,

231 
Aºow
 *
íd_¨row
);

233 (*
døw_pﬁylöe_wôh_¨rows
Ë(
DüRídîî
 *
ªndîî
,

234 
Poöt
 *
poöts
, 
num_poöts
,

235 
ªÆ
 
löe_width
,

236 
Cﬁ‹
 *
cﬁ‹
,

237 
Aºow
 *
°¨t_¨row
,

238 
Aºow
 *
íd_¨row
);

239 (*
døw_rounded_pﬁylöe_wôh_¨rows
Ë(
DüRídîî
 *
ªndîî
,

240 
Poöt
 *
poöts
, 
num_poöts
,

241 
ªÆ
 
löe_width
,

242 
Cﬁ‹
 *
cﬁ‹
,

243 
Aºow
 *
°¨t_¨row
,

244 
Aºow
 *
íd_¨row
,

245 
ªÆ
 
ødius
);

247 (*
døw_bezõr_wôh_¨rows
Ë(
DüRídîî
 *
ªndîî
,

248 
BezPoöt
 *
poöts
,

249 
num_poöts
,

250 
ªÆ
 
löe_width
,

251 
Cﬁ‹
 *
cﬁ‹
,

252 
Aºow
 *
°¨t_¨row
,

253 
Aºow
 *
íd_¨row
);

260 
	#DIA_TYPE_INTERACTIVE_RENDERER_INTERFACE
 (
	`dü_öãø˘ive_ªndîî_öãrÁ˚_gë_ty≥
 ())

	)

261 
	#DIA_GET_INTERACTIVE_RENDERER_INTERFACE
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_INTERFACE
 ((obj), 
DIA_TYPE_INTERACTIVE_RENDERER_INTERFACE
, 
DüI¡îa˘iveRídîîI¡îÁ˚
))

	)

263 
	s_DüI¡îa˘iveRídîîI¡îÁ˚


265 
GTy≥I¡îÁ˚
 
ba£_iÁ˚
;

268 (*
£t_size
Ë(
DüRídîî
 *
ªndîî
, 
gpoöãr
, , );

271 (*
˛ù_ªgi⁄_˛ór
Ë(
DüRídîî
 *
ªndîî
);

274 (*
˛ù_ªgi⁄_add_ª˘
Ë(
DüRídîî
 *
ªndîî
, 
Re˘™gÀ
 *
ª˘
);

277 (*
døw_pixñ_löe
Ë(
DüRídîî
 *
ªndîî
,

278 
x1
, 
y1
, 
x2
, 
y2
,

279 
Cﬁ‹
 *
cﬁ‹
);

281 (*
døw_pixñ_ª˘
Ë(
DüRídîî
 *
ªndîî
,

282 
x
, 
y
, 
width
, 
height
,

283 
Cﬁ‹
 *
cﬁ‹
);

285 (*
fûl_pixñ_ª˘
Ë(
DüRídîî
 *
ªndîî
,

286 
x
, 
y
, 
width
, 
height
,

287 
Cﬁ‹
 *
cﬁ‹
);

289 (*
c›y_to_wödow
Ë(
DüRídîî
 *
ªndîî
,

290 
gpoöãr
 
wödow
,

291 
x
, 
y
, 
width
, 
height
);

294 
	$__de˛•ec
(
dŒexp‹t
Ë
GTy≥
 
	$dü_öãø˘ive_ªndîî_öãrÁ˚_gë_ty≥
 (Ë
G_GNUC_CONST
;

296 
DIAVAR
 
	`dü_ªndîî_£t_size
 (
DüRídîî
*, 
gpoöãr
 
wödow
, , );

297 
DIAVAR
 
	`dü_ªndîî_gë_width_pixñs
 (
DüRídîî
*);

298 
DIAVAR
 
	`dü_ªndîî_gë_height_pixñs
 (
DüRídîî
*);

300 
G_END_DECLS


	@O:\tool\dvs50\lib\diasvgrenderer.c

27 
	~<c⁄fig.h
>

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

31 
	~<time.h
>

32 
	~<m©h.h
>

33 
	~<glib.h
>

34 #ifde‡
HAVE_UNISTD_H


35 
	~<uni°d.h
>

38 
	~<libxml/ítôõs.h
>

39 
	~<libxml/åì.h
>

40 
	~<libxml/xmlmem‹y.h
>

42 
	~"geomëry.h
"

43 
	~"öé.h
"

44 
	~"mesßge.h
"

45 
	~"dü_xml_libxml.h
"

46 
	~"dü_image.h
"

48 
	~"düsvgªndîî.h
"

49 
	~"ãxéöe.h
"

51 
	#DTOSTR_BUF_SIZE
 
G_ASCII_DTOSTR_BUF_SIZE


	)

52 
	#dü_svg_dto°r
(
buf
,
d
) \

53 
	`g_ascii_f‹m©d
(
buf
,(buf),"%g",(
d
)*
ªndîî
->
sˇÀ
)

	)

55 
døw_ãxt_löe
(
DüRídîî
 *
£lf
, 
TextLöe
 *
ãxt_löe
,

56 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
, 
Cﬁ‹
 *
cﬁour
);

60 
	$begö_ªndî
(
DüRídîî
 *
£lf
)

62 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

64 
ªndîî
->
löewidth
 = 0;

65 
ªndîî
->
löeˇp
 = "butt";

66 
ªndîî
->
löejoö
 = "miter";

67 
ªndîî
->
löe°yÀ
 = 
NULL
;

68 
	}
}

71 
	$íd_ªndî
(
DüRídîî
 *
£lf
)

73 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

74 
	`g_‰ì
(
ªndîî
->
löe°yÀ
);

76 
	`xmlSëDocCom¥essMode
(
ªndîî
->
doc
, 0);

77 
	`xmlDüSaveFûe
(
ªndîî
->
fûíame
,Ñídîî->
doc
);

78 
	`g_‰ì
(
ªndîî
->
fûíame
);

79 
	`xmlFªeDoc
(
ªndîî
->
doc
);

80 
	}
}

83 
	$£t_löewidth
(
DüRídîî
 *
£lf
, 
ªÆ
 
löewidth
)

85 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

87 i‡(
löewidth
 == 0)

88 
ªndîî
->
löewidth
 = 0.001;

90 
ªndîî
->
löewidth
 =Üinewidth;

91 
	}
}

94 
	$£t_löeˇps
(
DüRídîî
 *
£lf
, 
LöeC≠s
 
mode
)

96 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

98 
mode
) {

99 
LINECAPS_BUTT
:

100 
ªndîî
->
löeˇp
 = "butt";

102 
LINECAPS_ROUND
:

103 
ªndîî
->
löeˇp
 = "round";

105 
LINECAPS_PROJECTING
:

106 
ªndîî
->
löeˇp
 = "square";

109 
ªndîî
->
löeˇp
 = "butt";

111 
	}
}

114 
	$£t_löejoö
(
DüRídîî
 *
£lf
, 
LöeJoö
 
mode
)

116 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

118 
mode
) {

119 
LINEJOIN_MITER
:

120 
ªndîî
->
löejoö
 = "miter";

122 
LINEJOIN_ROUND
:

123 
ªndîî
->
löejoö
 = "round";

125 
LINEJOIN_BEVEL
:

126 
ªndîî
->
löejoö
 = "bevel";

129 
ªndîî
->
löejoö
 = "miter";

131 
	}
}

134 
	$£t_löe°yÀ
(
DüRídîî
 *
£lf
, 
LöeStyÀ
 
mode
)

136 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

137 
ªÆ
 
hﬁe_width
;

138 
gch¨
 
dash_Àngth_buf
[
DTOSTR_BUF_SIZE
];

139 
gch¨
 
dŸ_Àngth_buf
[
DTOSTR_BUF_SIZE
];

140 
gch¨
 
hﬁe_width_buf
[
DTOSTR_BUF_SIZE
];

142 
ªndîî
->
ßved_löe_°yÀ
 = 
mode
;

144 
	`g_‰ì
(
ªndîî
->
löe°yÀ
);

145 
mode
) {

146 
LINESTYLE_SOLID
:

147 
ªndîî
->
löe°yÀ
 = 
NULL
;

149 
LINESTYLE_DASHED
:

150 
	`dü_svg_dto°r
(
dash_Àngth_buf
, 
ªndîî
->
dash_Àngth
);

151 
ªndîî
->
löe°yÀ
 = 
	`g_°rdup_¥ötf
("%s", 
dash_Àngth_buf
);

153 
LINESTYLE_DASH_DOT
:

154 
hﬁe_width
 = (
ªndîî
->
dash_Àngth
 -Ñídîî->
dŸ_Àngth
) / 2.0;

156 
	`dü_svg_dto°r
(
dash_Àngth_buf
, 
ªndîî
->
dash_Àngth
);

157 
	`dü_svg_dto°r
(
dŸ_Àngth_buf
, 
ªndîî
->
dŸ_Àngth
);

158 
	`dü_svg_dto°r
(
hﬁe_width_buf
, 
hﬁe_width
);

160 
ªndîî
->
löe°yÀ
 = 
	`g_°rdup_¥ötf
("%s %s %s %s",

161 
dash_Àngth_buf
,

162 
hﬁe_width_buf
,

163 
dŸ_Àngth_buf
,

164 
hﬁe_width_buf
 );

166 
LINESTYLE_DASH_DOT_DOT
:

167 
hﬁe_width
 = (
ªndîî
->
dash_Àngth
 - 2.0*ªndîî->
dŸ_Àngth
) / 3.0;

169 
	`dü_svg_dto°r
(
dash_Àngth_buf
, 
ªndîî
->
dash_Àngth
);

170 
	`dü_svg_dto°r
(
dŸ_Àngth_buf
, 
ªndîî
->
dŸ_Àngth
);

171 
	`dü_svg_dto°r
(
hﬁe_width_buf
, 
hﬁe_width
);

173 
ªndîî
->
löe°yÀ
 = 
	`g_°rdup_¥ötf
("%s %s %s %s %s %s",

174 
dash_Àngth_buf
,

175 
hﬁe_width_buf
,

176 
dŸ_Àngth_buf
,

177 
hﬁe_width_buf
,

178 
dŸ_Àngth_buf
,

179 
hﬁe_width_buf
 );

181 
LINESTYLE_DOTTED
:

183 
	`dü_svg_dto°r
(
dŸ_Àngth_buf
, 
ªndîî
->
dŸ_Àngth
);

185 
ªndîî
->
löe°yÀ
 = 
	`g_°rdup_¥ötf
("%s", 
dŸ_Àngth_buf
);

188 
ªndîî
->
löe°yÀ
 = 
NULL
;

190 
	}
}

193 
	$£t_dashÀngth
(
DüRídîî
 *
£lf
, 
ªÆ
 
Àngth
)

195 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

197 i‡(
Àngth
<0.001)

198 
Àngth
 = 0.001;

200 
ªndîî
->
dash_Àngth
 = 
Àngth
;

201 
ªndîî
->
dŸ_Àngth
 = 
Àngth
*0.2;

203 
	`£t_löe°yÀ
(
£lf
, 
ªndîî
->
ßved_löe_°yÀ
);

204 
	}
}

207 
	$£t_fûl°yÀ
(
DüRídîî
 *
£lf
, 
FûlStyÀ
 
mode
)

209 
mode
) {

210 
FILLSTYLE_SOLID
:

213 
	`mesßge_îr‹
("svg_renderer: Unsupported fill mode specified!\n");

215 
	}
}

218 c⁄° 
gch¨
 *

219 
	$gë_døw_°yÀ
(
DüSvgRídîî
 *
ªndîî
,

220 
Cﬁ‹
 *
cﬁour
)

222 
GSåög
 *
°r
 = 
NULL
;

223 
gch¨
 
löewidth_buf
[
DTOSTR_BUF_SIZE
];

225 i‡(!
°r
Ë°∏
	`g_°rög_√w
(
NULL
);

226 
	`g_°rög_åunˇã
(
°r
, 0);

229 
	`g_°rög_¥ötf
(
°r
, "fûl:Ç⁄e; fûl-›acôy:0; såoke-width: %s", 
	`dü_svg_dto°r
(
löewidth_buf
, 
ªndîî
->
löewidth
) );

230 i‡(
	`°rcmp
(
ªndîî
->
löeˇp
, "butt"))

231 
	`g_°rög_≠≥nd_¥ötf
(
°r
, "; såoke-löeˇp: %s", 
ªndîî
->
löeˇp
);

232 i‡(
	`°rcmp
(
ªndîî
->
löejoö
, "miter"))

233 
	`g_°rög_≠≥nd_¥ötf
(
°r
, "; såoke-löejoö: %s", 
ªndîî
->
löejoö
);

234 i‡(
ªndîî
->
löe°yÀ
)

235 
	`g_°rög_≠≥nd_¥ötf
(
°r
, "; såoke-dash¨øy: %s", 
ªndîî
->
löe°yÀ
);

237 i‡(
cﬁour
)

238 
	`g_°rög_≠≥nd_¥ötf
(
°r
, "; stroke: #%02x%02x%02x",

239 ()(255*
cﬁour
->
ªd
),

240 ()(255*
cﬁour
->
gªí
),

241 ()(255*
cﬁour
->
blue
));

243  
°r
->str;

244 
	}
}

247 c⁄° 
gch¨
 *

248 
	$gë_fûl_°yÀ
(
DüSvgRídîî
 *
ªndîî
,

249 
Cﬁ‹
 *
cﬁour
)

251 
GSåög
 *
°r
 = 
NULL
;

253 i‡(!
°r
Ë°∏
	`g_°rög_√w
(
NULL
);

255 
	`g_°rög_¥ötf
(
°r
, "fill: #%02x%02x%02x",

256 ()(255*
cﬁour
->
ªd
),

257 ()(255*
cﬁour
->
gªí
),

258 ()(255*
cﬁour
->
blue
));

260  
°r
->str;

261 
	}
}

264 
	$døw_löe
(
DüRídîî
 *
£lf
,

265 
Poöt
 *
°¨t
, Poöà*
íd
,

266 
Cﬁ‹
 *
löe_cﬁour
)

268 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

269 
xmlNodePå
 
node
;

270 
gch¨
 
d_buf
[
DTOSTR_BUF_SIZE
];

272 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"löe", 
NULL
);

274 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_døw_°yÀ
(
ªndîî
, 
löe_cﬁour
));

276 
	`dü_svg_dto°r
(
d_buf
, 
°¨t
->
x
);

277 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x1", (xmlCh¨ *Ë
d_buf
);

278 
	`dü_svg_dto°r
(
d_buf
, 
°¨t
->
y
);

279 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y1", (xmlCh¨ *Ë
d_buf
);

280 
	`dü_svg_dto°r
(
d_buf
, 
íd
->
x
);

281 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x2", (xmlCh¨ *Ë
d_buf
);

282 
	`dü_svg_dto°r
(
d_buf
, 
íd
->
y
);

283 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y2", (xmlCh¨ *Ë
d_buf
);

284 
	}
}

287 
	$døw_pﬁylöe
(
DüRídîî
 *
£lf
,

288 
Poöt
 *
poöts
, 
num_poöts
,

289 
Cﬁ‹
 *
löe_cﬁour
)

291 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

292 
i
;

293 
xmlNodePå
 
node
;

294 
GSåög
 *
°r
;

295 
gch¨
 
px_buf
[
DTOSTR_BUF_SIZE
];

296 
gch¨
 
py_buf
[
DTOSTR_BUF_SIZE
];

298 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"pﬁylöe", 
NULL
);

300 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_døw_°yÀ
(
ªndîî
, 
löe_cﬁour
));

302 
°r
 = 
	`g_°rög_√w
(
NULL
);

303 
i
 = 0; i < 
num_poöts
; i++)

304 
	`g_°rög_≠≥nd_¥ötf
(
°r
, "%s,%s ",

305 
	`dü_svg_dto°r
(
px_buf
, 
poöts
[
i
].
x
),

306 
	`dü_svg_dto°r
(
py_buf
, 
poöts
[
i
].
y
) );

307 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"poöts", (xmlCh¨ *Ë
°r
->str);

308 
	`g_°rög_‰ì
(
°r
, 
TRUE
);

309 
	}
}

312 
	$døw_pﬁyg⁄
(
DüRídîî
 *
£lf
,

313 
Poöt
 *
poöts
, 
num_poöts
,

314 
Cﬁ‹
 *
löe_cﬁour
)

316 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

317 
i
;

318 
xmlNodePå
 
node
;

319 
GSåög
 *
°r
;

320 
gch¨
 
px_buf
[
DTOSTR_BUF_SIZE
];

321 
gch¨
 
py_buf
[
DTOSTR_BUF_SIZE
];

323 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"pﬁyg⁄", 
NULL
);

325 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_døw_°yÀ
(
ªndîî
, 
löe_cﬁour
));

327 
°r
 = 
	`g_°rög_√w
(
NULL
);

328 
i
 = 0; i < 
num_poöts
; i++)

329 
	`g_°rög_≠≥nd_¥ötf
(
°r
, "%s,%s ",

330 
	`dü_svg_dto°r
(
px_buf
, 
poöts
[
i
].
x
),

331 
	`dü_svg_dto°r
(
py_buf
, 
poöts
[
i
].
y
) );

332 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"poöts", (xmlCh¨ *Ë
°r
->str);

333 
	`g_°rög_‰ì
(
°r
, 
TRUE
);

334 
	}
}

337 
	$fûl_pﬁyg⁄
(
DüRídîî
 *
£lf
,

338 
Poöt
 *
poöts
, 
num_poöts
,

339 
Cﬁ‹
 *
cﬁour
)

341 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

342 
i
;

343 
xmlNodePå
 
node
;

344 
GSåög
 *
°r
;

345 
gch¨
 
px_buf
[
DTOSTR_BUF_SIZE
];

346 
gch¨
 
py_buf
[
DTOSTR_BUF_SIZE
];

348 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"pﬁyg⁄", 
NULL
);

350 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_fûl_°yÀ
(
ªndîî
, 
cﬁour
));

352 
°r
 = 
	`g_°rög_√w
(
NULL
);

353 
i
 = 0; i < 
num_poöts
; i++)

354 
	`g_°rög_≠≥nd_¥ötf
(
°r
, "%s,%s ",

355 
	`dü_svg_dto°r
(
px_buf
, 
poöts
[
i
].
x
),

356 
	`dü_svg_dto°r
(
py_buf
, 
poöts
[
i
].
y
) );

357 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"poöts", (xmlCh¨ *)
°r
->str);

358 
	`g_°rög_‰ì
(
°r
, 
TRUE
);

359 
	}
}

362 
	$døw_ª˘
(
DüRídîî
 *
£lf
,

363 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

364 
Cﬁ‹
 *
cﬁour
)

366 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

367 
xmlNodePå
 
node
;

368 
gch¨
 
d_buf
[
DTOSTR_BUF_SIZE
];

370 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"rect", NULL);

372 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *)
	`gë_døw_°yÀ
(
ªndîî
, 
cﬁour
));

374 
	`dü_svg_dto°r
(
d_buf
, 
ul_c‹√r
->
x
);

375 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *Ë
d_buf
);

376 
	`dü_svg_dto°r
(
d_buf
, 
ul_c‹√r
->
y
);

377 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *Ë
d_buf
);

378 
	`dü_svg_dto°r
(
d_buf
, 
Ã_c‹√r
->
x
 - 
ul_c‹√r
->x);

379 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"width", (xmlCh¨ *Ë
d_buf
);

380 
	`dü_svg_dto°r
(
d_buf
, 
Ã_c‹√r
->
y
 - 
ul_c‹√r
->y);

381 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"height", (xmlCh¨ *Ë
d_buf
);

382 
	}
}

385 
	$fûl_ª˘
(
DüRídîî
 *
£lf
,

386 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

387 
Cﬁ‹
 *
cﬁour
)

389 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

390 
xmlNodePå
 
node
;

391 
gch¨
 
d_buf
[
DTOSTR_BUF_SIZE
];

393 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"ª˘", 
NULL
);

395 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_fûl_°yÀ
(
ªndîî
, 
cﬁour
));

397 
	`dü_svg_dto°r
(
d_buf
, 
ul_c‹√r
->
x
);

398 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *)
d_buf
);

399 
	`dü_svg_dto°r
(
d_buf
, 
ul_c‹√r
->
y
);

400 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *)
d_buf
);

401 
	`dü_svg_dto°r
(
d_buf
, 
Ã_c‹√r
->
x
 - 
ul_c‹√r
->x);

402 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"width", (xmlCh¨ *)
d_buf
);

403 
	`dü_svg_dto°r
(
d_buf
, 
Ã_c‹√r
->
y
 - 
ul_c‹√r
->y);

404 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"height", (xmlCh¨ *)
d_buf
);

405 
	}
}

408 
	$døw_¨c
(
DüRídîî
 *
£lf
,

409 
Poöt
 *
˚¡î
,

410 
ªÆ
 
width
,Ñó»
height
,

411 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

412 
Cﬁ‹
 *
cﬁour
)

414 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

415 
xmlNodePå
 
node
;

416 
buf
[512];

417 
ªÆ
 
rx
 = 
width
 / 2, 
ry
 = 
height
 / 2;

418 
ªÆ
 
sx
=
˚¡î
->
x
 + 
rx
*
	`cos
(
™gÀ1
*
G_PI
/180);

419 
ªÆ
 
sy
=
˚¡î
->
y
 - 
ry
*
	`sö
(
™gÀ1
*
G_PI
/180);

420 
ªÆ
 
ex
=
˚¡î
->
x
 + 
rx
*
	`cos
(
™gÀ2
*
G_PI
/180);

421 
ªÆ
 
ey
=
˚¡î
->
y
 - 
ry
*
	`sö
(
™gÀ2
*
G_PI
/180);

422 
swp
 = 0;

423 
œrge_¨c
;

424 
gch¨
 
sx_buf
[
DTOSTR_BUF_SIZE
];

425 
gch¨
 
sy_buf
[
DTOSTR_BUF_SIZE
];

426 
gch¨
 
rx_buf
[
DTOSTR_BUF_SIZE
];

427 
gch¨
 
ry_buf
[
DTOSTR_BUF_SIZE
];

428 
gch¨
 
ex_buf
[
DTOSTR_BUF_SIZE
];

429 
gch¨
 
ey_buf
[
DTOSTR_BUF_SIZE
];

431 i‡(
™gÀ1
 > 
™gÀ2
)

432 
™gÀ2
 += 360;

433 
œrge_¨c
 = (
™gÀ2
 - 
™gÀ1
 >= 180);

435 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"∑th", 
NULL
);

437 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_døw_°yÀ
(
ªndîî
, 
cﬁour
));

439 
	`g_¢¥ötf
(
buf
, (buf), "M %s,%s A %s,%s 0 %d %d %s,%s",

440 
	`dü_svg_dto°r
(
sx_buf
, 
sx
), dü_svg_dto°r(
sy_buf
, 
sy
),

441 
	`dü_svg_dto°r
(
rx_buf
, 
rx
), dü_svg_dto°r(
ry_buf
, 
ry
),

442 
œrge_¨c
, 
swp
,

443 
	`dü_svg_dto°r
(
ex_buf
, 
ex
), dü_svg_dto°r(
ey_buf
, 
ey
) );

445 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"d", (xmlCh¨ *Ë
buf
);

446 
	}
}

449 
	$fûl_¨c
(
DüRídîî
 *
£lf
,

450 
Poöt
 *
˚¡î
,

451 
ªÆ
 
width
,Ñó»
height
,

452 
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
,

453 
Cﬁ‹
 *
cﬁour
)

455 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

456 
xmlNodePå
 
node
;

457 
buf
[512];

458 
ªÆ
 
rx
 = 
width
 / 2, 
ry
 = 
height
 / 2;

459 
ªÆ
 
sx
=
˚¡î
->
x
 + 
rx
*
	`cos
(
™gÀ1
*
G_PI
/180);

460 
ªÆ
 
sy
=
˚¡î
->
y
 - 
ry
*
	`sö
(
™gÀ1
*
G_PI
/180);

461 
ªÆ
 
ex
=
˚¡î
->
x
 + 
rx
*
	`cos
(
™gÀ2
*
G_PI
/180);

462 
ªÆ
 
ey
=
˚¡î
->
y
 - 
ry
*
	`sö
(
™gÀ2
*
G_PI
/180);

463 
swp
 = 0;

464 
œrge_¨c
 = (
™gÀ2
 - 
™gÀ1
 >= 180);

465 
gch¨
 
sx_buf
[
DTOSTR_BUF_SIZE
];

466 
gch¨
 
sy_buf
[
DTOSTR_BUF_SIZE
];

467 
gch¨
 
rx_buf
[
DTOSTR_BUF_SIZE
];

468 
gch¨
 
ry_buf
[
DTOSTR_BUF_SIZE
];

469 
gch¨
 
ex_buf
[
DTOSTR_BUF_SIZE
];

470 
gch¨
 
ey_buf
[
DTOSTR_BUF_SIZE
];

471 
gch¨
 
cx_buf
[
DTOSTR_BUF_SIZE
];

472 
gch¨
 
cy_buf
[
DTOSTR_BUF_SIZE
];

474 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"path", NULL);

476 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *)
	`gë_fûl_°yÀ
(
ªndîî
, 
cﬁour
));

478 
	`g_¢¥ötf
(
buf
, (buf), "M %s,%s A %s,%s 0 %d %d %s,%s L %s,%s z",

479 
	`dü_svg_dto°r
(
sx_buf
, 
sx
), dü_svg_dto°r(
sy_buf
, 
sy
),

480 
	`dü_svg_dto°r
(
rx_buf
, 
rx
), dü_svg_dto°r(
ry_buf
, 
ry
),

481 
œrge_¨c
, 
swp
,

482 
	`dü_svg_dto°r
(
ex_buf
, 
ex
), dü_svg_dto°r(
ey_buf
, 
ey
),

483 
	`dü_svg_dto°r
(
cx_buf
, 
˚¡î
->
x
),

484 
	`dü_svg_dto°r
(
cy_buf
, 
˚¡î
->
y
) );

486 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"d", (xmlCh¨ *Ë
buf
);

487 
	}
}

490 
	$døw_ñlù£
(
DüRídîî
 *
£lf
,

491 
Poöt
 *
˚¡î
,

492 
ªÆ
 
width
,Ñó»
height
,

493 
Cﬁ‹
 *
cﬁour
)

495 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

496 
xmlNodePå
 
node
;

497 
gch¨
 
d_buf
[
DTOSTR_BUF_SIZE
];

499 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"ñlù£", 
NULL
);

501 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_døw_°yÀ
(
ªndîî
, 
cﬁour
));

503 
	`dü_svg_dto°r
(
d_buf
, 
˚¡î
->
x
);

504 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"cx", (xmlCh¨ *Ë
d_buf
);

505 
	`dü_svg_dto°r
(
d_buf
, 
˚¡î
->
y
);

506 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"cy", (xmlCh¨ *Ë
d_buf
);

507 
	`dü_svg_dto°r
(
d_buf
, 
width
 / 2);

508 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"rx", (xmlCh¨ *Ë
d_buf
);

509 
	`dü_svg_dto°r
(
d_buf
, 
height
 / 2);

510 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"ry", (xmlCh¨ *Ë
d_buf
);

511 
	}
}

514 
	$fûl_ñlù£
(
DüRídîî
 *
£lf
,

515 
Poöt
 *
˚¡î
,

516 
ªÆ
 
width
,Ñó»
height
,

517 
Cﬁ‹
 *
cﬁour
)

519 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

520 
xmlNodePå
 
node
;

521 
gch¨
 
d_buf
[
DTOSTR_BUF_SIZE
];

523 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"ñlù£", 
NULL
);

525 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_fûl_°yÀ
(
ªndîî
, 
cﬁour
));

527 
	`dü_svg_dto°r
(
d_buf
, 
˚¡î
->
x
);

528 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"cx", (xmlCh¨ *Ë
d_buf
);

529 
	`dü_svg_dto°r
(
d_buf
, 
˚¡î
->
y
);

530 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"cy", (xmlCh¨ *Ë
d_buf
);

531 
	`dü_svg_dto°r
(
d_buf
, 
width
 / 2);

532 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"rx", (xmlCh¨ *Ë
d_buf
);

533 
	`dü_svg_dto°r
(
d_buf
, 
height
 / 2);

534 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"ry", (xmlCh¨ *Ë
d_buf
);

535 
	}
}

538 
	$døw_bezõr
(
DüRídîî
 *
£lf
,

539 
BezPoöt
 *
poöts
,

540 
numpoöts
,

541 
Cﬁ‹
 *
cﬁour
)

543 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

544 
i
;

545 
xmlNodePå
 
node
;

546 
GSåög
 *
°r
;

547 
gch¨
 
p1x_buf
[
DTOSTR_BUF_SIZE
];

548 
gch¨
 
p1y_buf
[
DTOSTR_BUF_SIZE
];

549 
gch¨
 
p2x_buf
[
DTOSTR_BUF_SIZE
];

550 
gch¨
 
p2y_buf
[
DTOSTR_BUF_SIZE
];

551 
gch¨
 
p3x_buf
[
DTOSTR_BUF_SIZE
];

552 
gch¨
 
p3y_buf
[
DTOSTR_BUF_SIZE
];

554 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"∑th", 
NULL
);

556 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_døw_°yÀ
(
ªndîî
, 
cﬁour
));

558 
°r
 = 
	`g_°rög_√w
(
NULL
);

560 i‡(
poöts
[0].
ty≥
 !
BEZ_MOVE_TO
)

561 
	`g_w¨nög
("first BezPoint must beá BEZ_MOVE_TO");

563 
	`g_°rög_¥ötf
(
°r
, "M %s %s",

564 
	`dü_svg_dto°r
(
p1x_buf
, (
gdoubÀ
Ë
poöts
[0].
p1
.
x
),

565 
	`dü_svg_dto°r
(
p1y_buf
, (
gdoubÀ
Ë
poöts
[0].
p1
.
y
) );

567 
i
 = 1; i < 
numpoöts
; i++)

568 
poöts
[
i
].
ty≥
) {

569 
BEZ_MOVE_TO
:

570 
	`g_w¨nög
("only first BezPoint shoul beá BEZ_MOVE_TO");

571 
	`g_°rög_¥ötf
(
°r
, "M %s %s",

572 
	`dü_svg_dto°r
(
p1x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
x
),

573 
	`dü_svg_dto°r
(
p1y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
y
) );

575 
BEZ_LINE_TO
:

576 
	`g_°rög_≠≥nd_¥ötf
(
°r
, " L %s,%s",

577 
	`dü_svg_dto°r
(
p1x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
x
),

578 
	`dü_svg_dto°r
(
p1y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
y
) );

580 
BEZ_CURVE_TO
:

581 
	`g_°rög_≠≥nd_¥ötf
(
°r
, " C %s,%s %s,%s %s,%s",

582 
	`dü_svg_dto°r
(
p1x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
x
),

583 
	`dü_svg_dto°r
(
p1y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
y
),

584 
	`dü_svg_dto°r
(
p2x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p2
.
x
),

585 
	`dü_svg_dto°r
(
p2y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p2
.
y
),

586 
	`dü_svg_dto°r
(
p3x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p3
.
x
),

587 
	`dü_svg_dto°r
(
p3y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p3
.
y
) );

590 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"d", (xmlCh¨ *Ë
°r
->str);

591 
	`g_°rög_‰ì
(
°r
, 
TRUE
);

592 
	}
}

595 
	$fûl_bezõr
(
DüRídîî
 *
£lf
,

596 
BezPoöt
 *
poöts
,

597 
numpoöts
,

598 
Cﬁ‹
 *
cﬁour
)

600 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

601 
i
;

602 
xmlNodePå
 
node
;

603 
GSåög
 *
°r
;

604 
gch¨
 
p1x_buf
[
DTOSTR_BUF_SIZE
];

605 
gch¨
 
p1y_buf
[
DTOSTR_BUF_SIZE
];

606 
gch¨
 
p2x_buf
[
DTOSTR_BUF_SIZE
];

607 
gch¨
 
p2y_buf
[
DTOSTR_BUF_SIZE
];

608 
gch¨
 
p3x_buf
[
DTOSTR_BUF_SIZE
];

609 
gch¨
 
p3y_buf
[
DTOSTR_BUF_SIZE
];

611 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"∑th", 
NULL
);

613 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
	`gë_fûl_°yÀ
(
ªndîî
, 
cﬁour
));

615 
°r
 = 
	`g_°rög_√w
(
NULL
);

617 i‡(
poöts
[0].
ty≥
 !
BEZ_MOVE_TO
)

618 
	`g_w¨nög
("first BezPoint must beá BEZ_MOVE_TO");

620 
	`g_°rög_¥ötf
(
°r
, "M %s %s",

621 
	`dü_svg_dto°r
(
p1x_buf
, (
gdoubÀ
Ë
poöts
[0].
p1
.
x
),

622 
	`dü_svg_dto°r
(
p1y_buf
, (
gdoubÀ
Ë
poöts
[0].
p1
.
y
) );

624 
i
 = 1; i < 
numpoöts
; i++)

625 
poöts
[
i
].
ty≥
) {

626 
BEZ_MOVE_TO
:

627 
	`g_w¨nög
("only first BezPoint should beá BEZ_MOVE_TO");

628 
	`g_°rög_¥ötf
(
°r
, "M %s %s",

629 
	`dü_svg_dto°r
(
p1x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
x
),

630 
	`dü_svg_dto°r
(
p1y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
y
) );

632 
BEZ_LINE_TO
:

633 
	`g_°rög_≠≥nd_¥ötf
(
°r
, " L %s,%s",

634 
	`dü_svg_dto°r
(
p1x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
x
),

635 
	`dü_svg_dto°r
(
p1y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
y
) );

637 
BEZ_CURVE_TO
:

638 
	`g_°rög_≠≥nd_¥ötf
(
°r
, " C %s,%s %s,%s %s,%s",

639 
	`dü_svg_dto°r
(
p1x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
x
),

640 
	`dü_svg_dto°r
(
p1y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p1
.
y
),

641 
	`dü_svg_dto°r
(
p2x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p2
.
x
),

642 
	`dü_svg_dto°r
(
p2y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p2
.
y
),

643 
	`dü_svg_dto°r
(
p3x_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p3
.
x
),

644 
	`dü_svg_dto°r
(
p3y_buf
, (
gdoubÀ
Ë
poöts
[
i
].
p3
.
y
) );

647 
	`g_°rög_≠≥nd
(
°r
, "z");

648 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"d", (xmlCh¨ *Ë
°r
->str);

649 
	`g_°rög_‰ì
(
°r
, 
TRUE
);

650 
	}
}

653 
	$døw_°rög
(
DüRídîî
 *
£lf
,

654 c⁄° *
ãxt
,

655 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
,

656 
Cﬁ‹
 *
cﬁour
)

658 
TextLöe
 *
ãxt_löe
 = 
	`ãxt_löe_√w
(
ãxt
, 
£lf
->
f⁄t
, sñf->
f⁄t_height
);

659 
	`døw_ãxt_löe
(
£lf
, 
ãxt_löe
, 
pos
, 
Æignmít
, 
cﬁour
);

660 
	`ãxt_löe_de°roy
(
ãxt_löe
);

661 
	}
}

665 
	$døw_ãxt_löe
(
DüRídîî
 *
£lf
, 
TextLöe
 *
ãxt_löe
,

666 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
, 
Cﬁ‹
 *
cﬁour
)

668 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

669 
xmlNodePå
 
node
;

670 *
°yÀ
, *
tmp
;

671 
ªÆ
 
ßved_width
;

672 
gch¨
 
d_buf
[
DTOSTR_BUF_SIZE
];

673 
DüF⁄t
 *
f⁄t
;

675 
node
 = 
	`xmlNewTextChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"text",

676 (
xmlCh¨
 *Ë
	`ãxt_löe_gë_°rög
(
ãxt_löe
));

678 
ßved_width
 = 
ªndîî
->
löewidth
;

679 
ªndîî
->
löewidth
 = 0.001;

680 
°yÀ
 = (*)
	`gë_fûl_°yÀ
(
ªndîî
, 
cﬁour
);

682 
ªndîî
->
löewidth
 = 
ßved_width
;

684 
tmp
 = 
	`g_°rdup_¥ötf
("%s; f⁄t-size: %s", 
°yÀ
,

685 
	`dü_svg_dto°r
(
d_buf
, 
	`ãxt_löe_gë_height
(
ãxt_löe
)));

686 
°yÀ
 = 
tmp
;

690 
Æignmít
) {

691 
ALIGN_LEFT
:

692 
tmp
 = 
	`g_°rc⁄ˇt
(
°yÀ
, ";Åext-™ch‹:°¨t", 
NULL
);

694 
ALIGN_CENTER
:

695 
tmp
 = 
	`g_°rc⁄ˇt
(
°yÀ
, ";Åext-™ch‹:middÀ", 
NULL
);

697 
ALIGN_RIGHT
:

698 
tmp
 = 
	`g_°rc⁄ˇt
(
°yÀ
, ";Åext-™ch‹:íd", 
NULL
);

701 
	`g_‰ì
 (
°yÀ
);

702 
°yÀ
 = 
tmp
;

704 
f⁄t
 = 
	`ãxt_löe_gë_f⁄t
(
ãxt_löe
);

705 
tmp
 = 
	`g_°rdup_¥ötf
("%s; font-family: %s; font-style: %s; "

706 "f⁄t-weight: %s",
°yÀ
,

707 
	`dü_f⁄t_gë_Ámûy
(
f⁄t
),

708 
	`dü_f⁄t_gë_¶™t_°rög
(
f⁄t
),

709 
	`dü_f⁄t_gë_weight_°rög
(
f⁄t
));

710 
	`g_‰ì
(
°yÀ
);

711 
°yÀ
 = 
tmp
;

715 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"°yÀ", (xmlCh¨ *Ë
°yÀ
);

716 
	`g_‰ì
(
°yÀ
);

718 
	`dü_svg_dto°r
(
d_buf
, 
pos
->
x
);

719 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *Ë
d_buf
);

720 
	`dü_svg_dto°r
(
d_buf
, 
pos
->
y
);

721 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *Ë
d_buf
);

724 
	`dü_svg_dto°r
(
d_buf
, 
	`ãxt_löe_gë_height
(
ãxt_löe
));

725 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"f⁄t-size", (xmlCh¨ *Ë
d_buf
);

727 
	`dü_svg_dto°r
(
d_buf
, 
	`ãxt_löe_gë_width
(
ãxt_löe
));

728 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
*)"ãxtLígth", (xmlCh¨ *Ë
d_buf
);

729 
	}
}

732 
	$døw_image
(
DüRídîî
 *
£lf
,

733 
Poöt
 *
poöt
,

734 
ªÆ
 
width
,Ñó»
height
,

735 
DüImage
 *
image
)

737 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

738 
xmlNodePå
 
node
;

739 
gch¨
 
d_buf
[
DTOSTR_BUF_SIZE
];

740 
gch¨
 *
uri
;

742 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"image", NULL);

744 
	`dü_svg_dto°r
(
d_buf
, 
poöt
->
x
);

745 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *Ë
d_buf
);

746 
	`dü_svg_dto°r
(
d_buf
, 
poöt
->
y
);

747 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *Ë
d_buf
);

748 
	`dü_svg_dto°r
(
d_buf
, 
width
);

749 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"width", (xmlCh¨ *Ë
d_buf
);

750 
	`dü_svg_dto°r
(
d_buf
, 
height
);

751 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"height", (xmlCh¨ *Ë
d_buf
);

753 
uri
 = 
	`g_fûíame_to_uri
(
	`dü_image_fûíame
(
image
), 
NULL
, NULL);

754 i‡(
uri
)

755 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"xlök:hªf", (xmlCh¨ *Ë
uri
);

757 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"xlök:hªf", (xmlCh¨ *Ë
	`dü_image_fûíame
(
image
));

758 
	`g_‰ì
 (
uri
);

759 
	}
}

763 
	$dü_svg_ªndîî_öô
 (
GTy≥In°™˚
 *
£lf
, 
gpoöãr
 
g_˛ass
)

765 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

767 
ªndîî
->
sˇÀ
 = 1.0;

769 
	}
}

771 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

775 
	$dü_svg_ªndîî_föÆize
 (
GObje˘
 *
obje˘
)

777 
	`G_OBJECT_CLASS
 (
∑ª¡_˛ass
)->
	`föÆize
 (
obje˘
);

778 
	}
}

781 
dü_svg_ªndîî_˛ass_öô
 (
DüSvgRídîîCœss
 *
kœss
);

783 
GTy≥


784 
	$dü_svg_ªndîî_gë_ty≥
 ()

786 
GTy≥
 
obje˘_ty≥
 = 0;

788 i‡(!
obje˘_ty≥
)

790 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

792  (
DüSvgRídîîCœss
),

793 (
GBa£InôFunc
Ë
NULL
,

794 (
GBa£FöÆizeFunc
Ë
NULL
,

795 (
GCœssInôFunc
Ë
dü_svg_ªndîî_˛ass_öô
,

796 
NULL
,

797 
NULL
,

798  (
DüSvgRídîî
),

800 
dü_svg_ªndîî_öô


803 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
DIA_TYPE_RENDERER
,

805 &
obje˘_öfo
, 0);

808  
obje˘_ty≥
;

809 
	}
}

812 
	$dü_svg_ªndîî_˛ass_öô
 (
DüSvgRídîîCœss
 *
kœss
)

814 
GObje˘Cœss
 *
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
kœss
);

815 
DüRídîîCœss
 *
ªndîî_˛ass
 = 
	`DIA_RENDERER_CLASS
 (
kœss
);

816 
DüSvgRídîîCœss
 *
svg_ªndîî_˛ass
 = 
	`DIA_SVG_RENDERER_CLASS
 (
kœss
);

818 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
kœss
);

820 
obje˘_˛ass
->
föÆize
 = 
dü_svg_ªndîî_föÆize
;

823 
ªndîî_˛ass
->
begö_ªndî
 = begin_render;

824 
ªndîî_˛ass
->
íd_ªndî
 =Énd_render;

826 
ªndîî_˛ass
->
£t_löewidth
 = set_linewidth;

827 
ªndîî_˛ass
->
£t_löeˇps
 = set_linecaps;

828 
ªndîî_˛ass
->
£t_löejoö
 = set_linejoin;

829 
ªndîî_˛ass
->
£t_löe°yÀ
 = set_linestyle;

830 
ªndîî_˛ass
->
£t_dashÀngth
 = set_dashlength;

831 
ªndîî_˛ass
->
£t_fûl°yÀ
 = set_fillstyle;

833 
ªndîî_˛ass
->
døw_löe
 = draw_line;

834 
ªndîî_˛ass
->
fûl_pﬁyg⁄
 = fill_polygon;

835 
ªndîî_˛ass
->
døw_ª˘
 = draw_rect;

836 
ªndîî_˛ass
->
fûl_ª˘
 = fill_rect;

837 
ªndîî_˛ass
->
døw_¨c
 = draw_arc;

838 
ªndîî_˛ass
->
fûl_¨c
 = fill_arc;

839 
ªndîî_˛ass
->
døw_ñlù£
 = draw_ellipse;

840 
ªndîî_˛ass
->
fûl_ñlù£
 = fill_ellipse;

842 
ªndîî_˛ass
->
døw_°rög
 = draw_string;

843 
ªndîî_˛ass
->
døw_image
 = draw_image;

846 
ªndîî_˛ass
->
døw_ª˘
 = draw_rect;

847 
ªndîî_˛ass
->
døw_pﬁylöe
 = draw_polyline;

848 
ªndîî_˛ass
->
døw_pﬁyg⁄
 = draw_polygon;

850 
ªndîî_˛ass
->
døw_bezõr
 = draw_bezier;

851 
ªndîî_˛ass
->
fûl_bezõr
 = fill_bezier;

852 
ªndîî_˛ass
->
døw_ãxt_löe
 = draw_text_line;

855 
svg_ªndîî_˛ass
->
gë_døw_°yÀ
 = get_draw_style;

856 
svg_ªndîî_˛ass
->
gë_fûl_°yÀ
 = get_fill_style;

857 
	}
}

	@O:\tool\dvs50\lib\diasvgrenderer.h

1 #i‚de‡
DIA_SVG_RENDERER_H


2 
	#DIA_SVG_RENDERER_H


	)

4 
	~"düty≥s.h
"

5 
	~"düªndîî.h
"

7 
	gG_BEGIN_DECLS


9 
	#DIA_TYPE_SVG_RENDERER
 (
	`dü_svg_ªndîî_gë_ty≥
 ())

	)

10 
	#DIA_SVG_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_SVG_RENDERER
, 
DüSvgRídîî
))

	)

11 
	#DIA_SVG_RENDERER_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_SVG_RENDERER
, 
DüSvgRídîîCœss
))

	)

12 
	#DIA_IS_SVG_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_SVG_RENDERER
))

	)

13 
	#DIA_SVG_RENDERER_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_SVG_RENDERER
, 
DüSvgRídîîCœss
))

	)

15 
DIAVAR
 
GTy≥
 
	$dü_svg_ªndîî_gë_ty≥
 (Ë
G_GNUC_CONST
;

17 
	s_DüSvgRídîî


19 
DüRídîî
 
∑ª¡_ö°™˚
;

22 *
fûíame
;

24 
xmlDocPå
 
doc
;

25 
xmlNodePå
 
roŸ
;

26 
xmlNsPå
 
svg_«me_•a˚
;

28 
LöeStyÀ
 
ßved_löe_°yÀ
;

29 
ªÆ
 
dash_Àngth
;

30 
ªÆ
 
dŸ_Àngth
;

32 
ªÆ
 
löewidth
;

33 c⁄° *
löeˇp
;

34 c⁄° *
löejoö
;

35 *
löe°yÀ
;

36 
ªÆ
 
sˇÀ
;

39 
	s_DüSvgRídîîCœss


41 
DüRídîîCœss
 
∑ª¡_˛ass
;

43 c⁄° 
gch¨
* (*
gë_døw_°yÀ
Ë(
DüSvgRídîî
*, 
Cﬁ‹
*);

44 c⁄° 
gch¨
* (*
gë_fûl_°yÀ
Ë(
DüSvgRídîî
*, 
Cﬁ‹
*);

47 
G_END_DECLS


	@O:\tool\dvs50\lib\diatransform.c

23 
	~"düå™sf‹m.h
"

25 
_DüTønsf‹mCœss
 
	tDüTønsf‹mCœss
;

27 
	s_DüTønsf‹m


29 
GObje˘
 
	m∑ª¡_ö°™˚
;

31 
Re˘™gÀ
 *
	mvisibÀ
;

32 
ªÆ
 *
	mÁ˘‹
;

35 
	s_DüTønsf‹mCœss


37 
GObje˘Cœss
 
	m∑ª¡_˛ass
;

40 
dü_å™sf‹m_˛ass_öô
 (
DüTønsf‹mCœss
 *
kœss
);

42 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

44 
GTy≥


45 
	$dü_å™sf‹m_gë_ty≥
 ()

47 
GTy≥
 
obje˘_ty≥
 = 0;

49 i‡(!
obje˘_ty≥
)

51 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

53  (
DüTønsf‹mCœss
),

54 (
GBa£InôFunc
Ë
NULL
,

55 (
GBa£FöÆizeFunc
Ë
NULL
,

56 (
GCœssInôFunc
Ë
dü_å™sf‹m_˛ass_öô
,

57 
NULL
,

58 
NULL
,

59  (
DüTønsf‹m
),

61 
NULL


64 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
G_TYPE_OBJECT
,

66 &
obje˘_öfo
, 0);

69  
obje˘_ty≥
;

70 
	}
}

73 
	$dü_å™sf‹m_föÆize
 (
GObje˘
 *
obje˘
)

77 
	`G_OBJECT_CLASS
 (
∑ª¡_˛ass
)->
	`föÆize
 (
obje˘
);

78 
	}
}

81 
	$dü_å™sf‹m_˛ass_öô
 (
DüTønsf‹mCœss
 *
kœss
)

83 
GObje˘Cœss
 *
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
kœss
);

85 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
kœss
);

87 
obje˘_˛ass
->
föÆize
 = 
dü_å™sf‹m_föÆize
;

89 
	}
}

91 
DüTønsf‹m
 *

92 
	$dü_å™sf‹m_√w
 (
Re˘™gÀ
 *
ª˘
, 
ªÆ
* 
zoom
)

94 
DüTønsf‹m
 *
t
 = 
	`g_obje˘_√w
 (
DIA_TYPE_TRANSFORM
, 
NULL
);

95 
t
->
visibÀ
 = 
ª˘
;

96 
t
->
Á˘‹
 = 
zoom
;

98  
t
;

99 
	}
}

101 
ªÆ


102 
	$dü_å™sf‹m_Àngth
 (
DüTønsf‹m
 *
t
, 
ªÆ
 
Àn
)

104 
	`g_ªtu∫_vÆ_if_Áû
 (
	`DIA_IS_TRANSFORM
 (
t
), 
Àn
);

105 
	`g_ªtu∫_vÆ_if_Áû
 (
t
 !
NULL
 && *t->
Á˘‹
 !0.0, 
Àn
);

107  (
Àn
 * *(
t
->
Á˘‹
));

108 
	}
}

111 
ªÆ


112 
	$dü_u¡ønsf‹m_Àngth
(
DüTønsf‹m
 *
t
, 
ªÆ
 
Àn
)

114 
	`g_ªtu∫_vÆ_if_Áû
 (
	`DIA_IS_TRANSFORM
 (
t
), 
Àn
);

115 
	`g_ªtu∫_vÆ_if_Áû
 (
t
 !
NULL
 && *t->
Á˘‹
 !0.0, 
Àn
);

117  
Àn
 / *(
t
->
Á˘‹
);

118 
	}
}

121 
	$dü_å™sf‹m_co‹ds
 (
DüTønsf‹m
 *
t
,

122 
co‹d
 
x
, co‹d 
y
,

123 *
xi
, *
yi
)

125 
	`g_ªtu∫_if_Áû
 (
	`DIA_IS_TRANSFORM
 (
t
));

126 
	`g_ªtu∫_if_Áû
 (
t
 !
NULL
 &&Å->
Á˘‹
 != NULL);

128 *
xi
 = 
	`ROUND
 ( (
x
 - 
t
->
visibÀ
->
À·
Ë* *—->
Á˘‹
));

129 *
yi
 = 
	`ROUND
 ( (
y
 - 
t
->
visibÀ
->
t›
Ë* *—->
Á˘‹
));

130 
	}
}

133 
	$dü_å™sf‹m_co‹ds_doubÀ
 (
DüTønsf‹m
 *
t
,

134 
co‹d
 
x
, co‹d 
y
,

135 *
xd
, *
yd
)

137 
	`g_ªtu∫_if_Áû
 (
	`DIA_IS_TRANSFORM
 (
t
));

138 
	`g_ªtu∫_if_Áû
 (
t
 !
NULL
 &&Å->
Á˘‹
 != NULL);

140 *
xd
 = ((
x
 - 
t
->
visibÀ
->
À·
Ë* *—->
Á˘‹
));

141 *
yd
 = ((
y
 - 
t
->
visibÀ
->
t›
Ë* *—->
Á˘‹
));

142 
	}
}

	@O:\tool\dvs50\lib\diatransform.h

1 #i‚de‡
DIA_TRANSFORM_H


2 
	#DIA_TRANSFORM_H


	)

4 
	~"düty≥s.h
"

5 
	~<glib-obje˘.h
>

6 
	~"geomëry.h
"

8 
	gG_BEGIN_DECLS


10 
	#DIA_TYPE_TRANSFORM
 (
	`dü_å™sf‹m_gë_ty≥
 ())

	)

11 
	#DIA_TRANSFORM
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_TRANSFORM
, 
DüTønsf‹m
))

	)

12 
	#DIA_TRANSFORM_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
DIA_TYPE_TRANSFORM
, 
DüTønsf‹mCœss
))

	)

13 
	#DIA_IS_TRANSFORM
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_TRANSFORM
))

	)

14 
	#DIA_TRANSFORM_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_TRANSFORM
, 
DüTønsf‹mCœss
))

	)

16 
GTy≥
 
	$dü_å™sf‹m_gë_ty≥
 (Ë
G_GNUC_CONST
;

18 
DIAVAR
 
DüTønsf‹m
 *
	`dü_å™sf‹m_√w
 (
Re˘™gÀ
 *
ª˘
, 
ªÆ
* 
zoom
);

19 
DIAVAR
 
ªÆ
 
	`dü_å™sf‹m_Àngth
 (
DüTønsf‹m
 *
å™sf‹m
,Ñó»
Àn
);

20 
DIAVAR
 
	`dü_å™sf‹m_co‹ds
 (
DüTønsf‹m
 *
å™sf‹m
, 
co‹d
 
x
, co‹d 
y
, *
xi
, *
yi
);

21 
DIAVAR
 
	`dü_å™sf‹m_co‹ds_doubÀ
 (
DüTønsf‹m
 *
å™sf‹m
, 
co‹d
 
x
, co‹d 
y
, *
xd
, *
yd
);

22 
DIAVAR
 
ªÆ
 
	`dü_u¡ønsf‹m_Àngth
(
DüTønsf‹m
 *
t
,Ñó»
Àn
);

24 
G_END_DECLS


	@O:\tool\dvs50\lib\diatypes.h

21 #i‚de‡
TYPES_H


22 
	#TYPES_H


	)

23 
	~"düv¨.h
"

28 
_DügømD©a
 
	tDügømD©a
;

29 
_Layî
 
	tLayî
;

30 
_NewDügømD©a
 
	tNewDügømD©a
;

33 
_Aºow
 
	tAºow
;

36 
_BezõrC⁄n
 
	tBezõrC⁄n
;

39 
_BezõrSh≠e
 
	tBezõrSh≠e
;

42 
_PﬁyBBExåas
 
	tPﬁyBBExåas
;

43 
_LöeBBExåas
 
	tLöeBBExåas
;

44 
_EÀmítBBExåas
 
	tEÀmítBBExåas
;

47 
_Cﬁ‹
 
	tCﬁ‹
;

50 
_C⁄√˘i⁄
 
	tC⁄√˘i⁄
;

53 
_C⁄√˘i⁄Poöt
 
	tC⁄√˘i⁄Poöt
;

56 
_Mu…ùoötCª©eD©a
 
	tMu…ùoötCª©eD©a
;

57 
_BezõrCª©eD©a
 
	tBezõrCª©eD©a
;

60 
_DüImage
 
	tDüImage
;

63 
_DüGdkRídîî
 
	tDüGdkRídîî
;

64 
_DüGdkRídîîCœss
 
	tDüGdkRídîîCœss
;

65 
_DDi•
 
	tDDi•
;

68 
_DüLib¨tRídîî
 
	tDüLib¨tRídîî
;

69 
_DüLib¨tRídîîCœss
 
	tDüLib¨tRídîîCœss
;

72 
_DüMíuIãm
 
	tDüMíuIãm
;

73 
_DüMíu
 
	tDüMíu
;

76 
_BezõrAµrox
 
	tBezõrAµrox
;

77 
_DüRídîî
 
	tDüRídîî
;

78 
_DüRídîîCœss
 
	tDüRídîîCœss
;

79 
_DüI¡îa˘iveRídîîI¡îÁ˚
 
	tDüI¡îa˘iveRídîîI¡îÁ˚
;

82 
_DüCñlRídîîPr›îty
 
	tDüCñlRídîîPr›îty
;

85 
_DüSvgRídîî
 
	tDüSvgRídîî
;

86 
_DüSvgRídîîCœss
 
	tDüSvgRídîîCœss
;

89 
_DüTønsf‹m
 
	tDüTønsf‹m
;

92 
_EÀmít
 
	tEÀmít
;

95 
_DüExp‹tFûãr
 
	tDüExp‹tFûãr
;

96 
_DüImp‹tFûãr
 
	tDüImp‹tFûãr
;

97 
_DüCÆlbackFûãr
 
	tDüCÆlbackFûãr
;

100 
_Focus
 
	tFocus
;

103 
_DüF⁄t
 
	tDüF⁄t
;

104 
_DüF⁄tCœss
 
	tDüF⁄tCœss
;

107 
_Poöt
 
	tPoöt
;

108 
_Re˘™gÀ
 
	tRe˘™gÀ
;

109 
_I¡Re˘™gÀ
 
	tI¡Re˘™gÀ
;

110 
_BezPoöt
 
	tBezPoöt
;

113 
_Group
 
	tGroup
;

116 
_H™dÀ
 
	tH™dÀ
;

119 
_NewOπhC⁄n
 
	tNewOπhC⁄n
;

122 
_Obje˘Sèã
 
	tObje˘Sèã
;

123 
_Obje˘Ch™ge
 
	tObje˘Ch™ge
;

126 
_DüObje˘
 
	tDüObje˘
;

127 
_Obje˘Ops
 
	tObje˘Ops
;

128 
_DüObje˘Ty≥
 
	tDüObje˘Ty≥
;

129 
_Obje˘Ty≥Ops
 
	tObje˘Ty≥Ops
;

132 
_OπhC⁄n
 
	tOπhC⁄n
;

135 
_P≠îInfo
 
	tP≠îInfo
;

138 
_PlugöInfo
 
	tPlugöInfo
;

141 
_PﬁyC⁄n
 
	tPﬁyC⁄n
;

144 
_PﬁySh≠e
 
	tPﬁySh≠e
;

147 
_Pr›Des¸ùti⁄
 
	tPr›Des¸ùti⁄
;

148 
_Pr›îty
 
	tPr›îty
;

149 
_Pr›EvítD©a
 
	tPr›EvítD©a
;

150 
_Pr›Dülog
 
	tPr›Dülog
;

151 
_Pr›EvítH™dÀrChaö
 
	tPr›EvítH™dÀrChaö
;

152 
_Pr›WidgëAssoc
 
	tPr›WidgëAssoc
;

153 
_Pr›îtyOps
 
	tPr›îtyOps
;

154 
_Pr›NumD©a
 
	tPr›NumD©a
;

155 
_Pr›EnumD©a
 
	tPr›EnumD©a
;

156 
_Pr›DescComm⁄AºayExåa
 
	tPr›DescComm⁄AºayExåa
;

157 
_Pr›DescDAºayExåa
 
	tPr›DescDAºayExåa
;

158 
_Pr›DescSAºayExåa
 
	tPr›DescSAºayExåa
;

159 
_Pr›Off£t
 
	tPr›Off£t
;

162 
_PSF⁄tDes¸ùt‹
 
	tPSF⁄tDes¸ùt‹
;

163 
_PSEncodögPage
 
	tPSEncodögPage
;

164 
_PSUnicodî
 
	tPSUnicodî
;

165 
_PSUnicodîCÆlbacks
 
	tPSUnicodîCÆlbacks
;

168 
_Shìt
 
	tShìt
;

169 
_ShìtObje˘
 
	tShìtObje˘
;

172 
_Text
 
	tText
;

175 
_TextLöe
 
	tTextLöe
;

178 
_TextAâribuãs
 
	tTextAâribuãs
;

181 
_DüSizeSñe˘‹
 
	tDüSizeSñe˘‹
;

182 
_DüSizeSñe˘‹Cœss
 
	tDüSizeSñe˘‹Cœss
;

183 
_DüF⁄tSñe˘‹
 
	tDüF⁄tSñe˘‹
;

184 
_DüF⁄tSñe˘‹Cœss
 
	tDüF⁄tSñe˘‹Cœss
;

185 
_DüAlignmítSñe˘‹
 
	tDüAlignmítSñe˘‹
;

186 
_DüAlignmítSñe˘‹Cœss
 
	tDüAlignmítSñe˘‹Cœss
;

187 
_DüLöeStyÀSñe˘‹
 
	tDüLöeStyÀSñe˘‹
;

188 
_DüLöeStyÀSñe˘‹Cœss
 
	tDüLöeStyÀSñe˘‹Cœss
;

189 
_DüCﬁ‹Sñe˘‹
 
	tDüCﬁ‹Sñe˘‹
;

190 
_DüCﬁ‹Sñe˘‹Cœss
 
	tDüCﬁ‹Sñe˘‹Cœss
;

191 
_DüAºowSñe˘‹
 
	tDüAºowSñe˘‹
;

192 
_DüAºowSñe˘‹Cœss
 
	tDüAºowSñe˘‹Cœss
;

193 
_DüFûeSñe˘‹
 
	tDüFûeSñe˘‹
;

194 
_DüFûeSñe˘‹Cœss
 
	tDüFûeSñe˘‹Cœss
;

197 
_Fa˘‹ySåu˘Iãm
 
	tFa˘‹ySåu˘Iãm
;

198 
_Fa˘‹ySåu˘Enum
 
	tFa˘‹ySåu˘Enum
;

199 
_Fa˘‹ySåu˘EnumLi°
 
	tFa˘‹ySåu˘EnumLi°
;

200 
_Fa˘‹ySåu˘IãmLi°
 
	tFa˘‹ySåu˘IãmLi°
;

201 
	s_Fa˘‹ySåu˘IãmLi°
{

202 
gch¨
 *
	m«me
;

203 
GLi°
 *
	mli°
;

204 
	mnumbî
;

207 
_Fa˘‹ySåu˘IãmAŒ
 
	tFa˘‹ySåu˘IãmAŒ
;

208 
	s_Fa˘‹ySåu˘IãmAŒ
{

209 
GLi°
 *
	míumLi°
;

210 
GLi°
 *
	m°ru˘Li°
;

	@O:\tool\dvs50\lib\diavar.h

1 #i‚de‡
DIAVAR_H


2 
	#DIAVAR_H


	)

4 
	~<glib.h
>

15 
	#DIAVAR
 
	`__de˛•ec
(
dŒexp‹t
)

	)

17 
DIAVAR
 
ªndî_boundög_boxes
;

	@O:\tool\dvs50\lib\dummy_dep.h

18 
	~<glib.h
>

19 
	~"c⁄√˘i⁄.h
"

20 
	~"ñemít.h
"

21 
	~"f⁄t.h
"

22 
	~"ãxt.h
"

23 
	~"‹th_c⁄n.h
"

24 
	~"√w‹th_c⁄n.h
"

25 
	~"¨rows.h
"

26 
	~"utûs.h
"

27 
	~"pﬁy_c⁄n.h
"

28 
	~"pﬁysh≠e.h
"

29 
	~"bezõr_c⁄n.h
"

30 
	~"bezõrsh≠e.h
"

31 
	~"widgës.h
"

32 
	~"öé.h
"

33 
	~"c⁄≈oöt_löe.h
"

34 
	~"¥›îtõs.h
"

35 
	~"dy«mic_obj.h
"

36 
	~"c⁄√˘i⁄poöt.h
"

42 #i‚de‡
__sgi


45 *
	gdummy_dï
[] 
	gG_GNUC_UNUSED
 = {

46 
c⁄√˘i⁄_move_h™dÀ
,

47 
ñemít_upd©e_boundögbox
,

48 
‹thc⁄n_upd©e_d©a
,

49 
pﬁyc⁄n_öô
,

50 
pﬁysh≠e_öô
,

51 
bezõrc⁄n_öô
,

52 
bezõrsh≠e_öô
,

53 
√w_ãxt
,

54 
dü_f⁄t_√w_‰om_°yÀ
,

55 
√¨e°_pow
,

56 
¨row_døw
,

57 
dü_f⁄t_£À˘‹_√w
,

58 
√w_obje˘_°©e_ch™ge
,

59 
öé_sc‹e_loˇÀ
,

60 
c⁄≈oöéöe_¸óã
,

61 
√w‹thc⁄n_upd©e_d©a
,

62 
obje˘_¸óã_¥›s_dülog
,

63 
dynobj_li°_gë_dynobj_øã
,

64 
c⁄≈oöt_upd©e
,

	@O:\tool\dvs50\lib\dynamic_obj.c

22 
	~<glib.h
>

23 
	~<dy«mic_obj.h
>

26 
DüObje˘
* 
	mobj
;

27 
guöt
 
	mtimeout
;

28 } 
	tDynobjRec
;

30 
GLi°
* 
	gdyn_obj_li°
 = 
NULL
;

32 
	$dynobj_li°_add_obje˘
(
DüObje˘
* 
obj
, 
guöt
 
timeout
) {

33 
DynobjRec
 *
d‹
 = 
	`g_√w
(DynobjRec,1);

34 
d‹
->
obj
 = obj;

35 
d‹
->
timeout
 =Åimeout;

37 
dyn_obj_li°
 = 
	`g_li°_≠≥nd
(dyn_obj_li°,
d‹
);

38 
	}
}

40 
göt
 
	$d‹_found
(
gc⁄°poöãr
 
d©a
, gc⁄°poöã∏
u£r_d©a
) {

41 c⁄° 
DynobjRec
* 
d‹
 = (c⁄° DynobjRec*)
d©a
;

42 c⁄° 
DüObje˘
* 
obj
 = (c⁄° DüObje˘*)
u£r_d©a
;

44 i‡((!
d‹
Ë|| (!
obj
))  1;

45 i‡(
d‹
->
obj
 != obj)  1;

47 
	}
}

49 
	$dynobj_li°_ªmove_obje˘
(
DüObje˘
* 
obj
) {

50 
GLi°
* 
ôem
 = 
	`g_li°_föd_cu°om
(
dyn_obj_li°
,
obj
,
d‹_found
);

52 i‡(
ôem
) {

53 
DynobjRec
* 
d‹
 = 
ôem
->
d©a
;

54 
dyn_obj_li°
 = 
	`g_li°_ªmove
(dyn_obj_li°,
d‹
);

55 
	`g_‰ì
(
d‹
);

57 
	}
}

60 
Obje˘DynobjFunc
 
	modf
;

61 
gpoöãr
 
	md©a
;

62 } 
	tTømpﬁöeD©a
;

64 
	$f‹óch_åampﬁöe
(
gpoöãr
 
d©a
, gpoöã∏
u£r_d©a
) {

65 
TømpﬁöeD©a
* 
td
 = (TømpﬁöeD©a*)
u£r_d©a
;

66 
DynobjRec
* 
d‹
 = (DynobjRec*)
d©a
;

68 
td
->
	`odf
(
d‹
->
obj
,td->
d©a
);

69 
	}
}

71 
	$dynobj_li°_f‹óch
(
Obje˘DynobjFunc
 
odf
, 
gpoöãr
 
d©a
) {

72 
TømpﬁöeD©a
 
td
;

73 
td
.
odf
 = odf;

74 
td
.
d©a
 = data;

75 
	`g_li°_f‹óch
(
dyn_obj_li°
,
f‹óch_åampﬁöe
,&
td
);

76 
	}
}

78 
	$accum_timeout
(
gpoöãr
 
d©a
, gpoöã∏
u£r_d©a
) {

79 
guöt
* 
accum
 = (guöt*)
u£r_d©a
;

80 
DynobjRec
* 
d‹
 = (DynobjRec*)
d©a
;

82 i‡(!
d‹
) ;

84 *
accum
 = 
	`MAX
(*accum,
d‹
->
timeout
);

85 
	}
}

87 
guöt
 
	$dynobj_li°_gë_dynobj_øã
() {

88 
guöt
 
timeout
 = 250;

90 i‡(
dyn_obj_li°
)

91 
	`g_li°_f‹óch
(
dyn_obj_li°
,
accum_timeout
,&
timeout
);

93 
timeout
 = 0;

95  
timeout
;

96 
	}
}

	@O:\tool\dvs50\lib\dynamic_obj.h

22 #i‚de‡
DYNAMIC_OBJ_H


23 
	#DYNAMIC_OBJ_H


	)

25 
	~<glib.h
>

26 
	~"obje˘.h
"

33 
DIAVAR
 
dynobj_li°_add_obje˘
(
DüObje˘
 *
obj
, 
guöt
 
timeout
);

41 
DIAVAR
 
dynobj_li°_ªmove_obje˘
(
DüObje˘
 *
obj
);

44 (*
	tObje˘DynobjFunc
Ë(
	tDüObje˘
 *
	tobj
, 
	tgpoöãr
 
	td©a
);

50 
	$__de˛•ec
(
dŒexp‹t
Ë
	`dynobj_li°_f‹óch
(
Obje˘DynobjFunc
 
‹f
, 
gpoöãr
 
d©a
);

55 
	$__de˛•ec
(
dŒexp‹t
Ë
guöt
 
	`dynobj_li°_gë_dynobj_øã
();

	@O:\tool\dvs50\lib\element.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<as£π.h
>

29 
	~<m©h.h
>

30 
	~<°rög.h
>

32 
	~"ñemít.h
"

33 
	~"mesßge.h
"

39 
	$ñemít_upd©e_boundögbox
(
EÀmít
 *
ñem
) {

40 
Re˘™gÀ
 
bb
;

41 
Poöt
 *
c‹√r
;

42 
EÀmítBBExåas
 *
exåa
 = &
ñem
->
exåa_•acög
;

44 
	`as£π
(
ñem
 !
NULL
);

46 
c‹√r
 = &
ñem
->corner;

47 
bb
.
À·
 = 
c‹√r
->
x
;

48 
bb
.
right
 = 
c‹√r
->
x
 + 
ñem
->
width
;

49 
bb
.
t›
 = 
c‹√r
->
y
;

50 
bb
.
bŸtom
 = 
c‹√r
->
y
 + 
ñem
->
height
;

52 
	`ª˘™gÀ_bbox
(&
bb
,
exåa
,&
ñem
->
obje˘
.
boundög_box
);

53 
	}
}

66 
	$ñemít_upd©e_c⁄√˘i⁄s_ª˘™gÀ
(
EÀmít
 *
ñem
,

67 
C⁄√˘i⁄Poöt
* 
˝s
)

69 
˝s
[0].
pos
 = 
ñem
->
c‹√r
;

70 
˝s
[1].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

71 
˝s
[1].
pos
.
y
 = 
ñem
->
c‹√r
.y;

72 
˝s
[2].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

73 
˝s
[2].
pos
.
y
 = 
ñem
->
c‹√r
.y;

74 
˝s
[3].
pos
.
x
 = 
ñem
->
c‹√r
.x;

75 
˝s
[3].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

76 
˝s
[4].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

77 
˝s
[4].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

78 
˝s
[5].
pos
.
x
 = 
ñem
->
c‹√r
.x;

79 
˝s
[5].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

80 
˝s
[6].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

81 
˝s
[6].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

82 
˝s
[7].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

83 
˝s
[7].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

84 
	`g_as£π
(
ñem
->
obje˘
.
num_c⁄√˘i⁄s
 >= 9);

85 
˝s
[8].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

86 
˝s
[8].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

88 
˝s
[0].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_WEST
;

89 
˝s
[1].
dúe˘i⁄s
 = 
DIR_NORTH
;

90 
˝s
[2].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_EAST
;

91 
˝s
[3].
dúe˘i⁄s
 = 
DIR_WEST
;

92 
˝s
[4].
dúe˘i⁄s
 = 
DIR_EAST
;

93 
˝s
[5].
dúe˘i⁄s
 = 
DIR_SOUTH
|
DIR_WEST
;

94 
˝s
[6].
dúe˘i⁄s
 = 
DIR_SOUTH
;

95 
˝s
[7].
dúe˘i⁄s
 = 
DIR_SOUTH
|
DIR_EAST
;

96 
˝s
[8].
dúe˘i⁄s
 = 
DIR_ALL
;

97 
	}
}

104 
	$ñemít_upd©e_h™dÀs
(
EÀmít
 *
ñem
)

106 
Poöt
 *
c‹√r
 = &
ñem
->corner;

108 
ñem
->
ªsize_h™dÀs
[0].
id
 = 
HANDLE_RESIZE_NW
;

109 
ñem
->
ªsize_h™dÀs
[0].
pos
.
x
 = 
c‹√r
->x;

110 
ñem
->
ªsize_h™dÀs
[0].
pos
.
y
 = 
c‹√r
->y;

112 
ñem
->
ªsize_h™dÀs
[1].
id
 = 
HANDLE_RESIZE_N
;

113 
ñem
->
ªsize_h™dÀs
[1].
pos
.
x
 = 
c‹√r
->x +ÉÀm->
width
/2.0;

114 
ñem
->
ªsize_h™dÀs
[1].
pos
.
y
 = 
c‹√r
->y;

116 
ñem
->
ªsize_h™dÀs
[2].
id
 = 
HANDLE_RESIZE_NE
;

117 
ñem
->
ªsize_h™dÀs
[2].
pos
.
x
 = 
c‹√r
->x +ÉÀm->
width
;

118 
ñem
->
ªsize_h™dÀs
[2].
pos
.
y
 = 
c‹√r
->y;

120 
ñem
->
ªsize_h™dÀs
[3].
id
 = 
HANDLE_RESIZE_W
;

121 
ñem
->
ªsize_h™dÀs
[3].
pos
.
x
 = 
c‹√r
->x;

122 
ñem
->
ªsize_h™dÀs
[3].
pos
.
y
 = 
c‹√r
->y +ÉÀm->
height
/2.0;

124 
ñem
->
ªsize_h™dÀs
[4].
id
 = 
HANDLE_RESIZE_E
;

125 
ñem
->
ªsize_h™dÀs
[4].
pos
.
x
 = 
c‹√r
->x +ÉÀm->
width
;

126 
ñem
->
ªsize_h™dÀs
[4].
pos
.
y
 = 
c‹√r
->y +ÉÀm->
height
/2.0;

128 
ñem
->
ªsize_h™dÀs
[5].
id
 = 
HANDLE_RESIZE_SW
;

129 
ñem
->
ªsize_h™dÀs
[5].
pos
.
x
 = 
c‹√r
->x;

130 
ñem
->
ªsize_h™dÀs
[5].
pos
.
y
 = 
c‹√r
->y +ÉÀm->
height
;

132 
ñem
->
ªsize_h™dÀs
[6].
id
 = 
HANDLE_RESIZE_S
;

133 
ñem
->
ªsize_h™dÀs
[6].
pos
.
x
 = 
c‹√r
->x +ÉÀm->
width
/2.0;

134 
ñem
->
ªsize_h™dÀs
[6].
pos
.
y
 = 
c‹√r
->y +ÉÀm->
height
;

136 
ñem
->
ªsize_h™dÀs
[7].
id
 = 
HANDLE_RESIZE_SE
;

137 
ñem
->
ªsize_h™dÀs
[7].
pos
.
x
 = 
c‹√r
->x +ÉÀm->
width
;

138 
ñem
->
ªsize_h™dÀs
[7].
pos
.
y
 = 
c‹√r
->y +ÉÀm->
height
;

139 
	}
}

152 
Obje˘Ch™ge
*

153 
	$ñemít_move_h™dÀ
(
EÀmít
 *
ñem
, 
H™dÀId
 
id
,

154 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

155 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

157 
Poöt
 
p
;

158 
Poöt
 *
c‹√r
;

160 
	`as£π
(
id
>=
HANDLE_RESIZE_NW
);

161 
	`as£π
(
id
<=
HANDLE_RESIZE_SE
);

163 
c‹√r
 = &
ñem
->corner;

165 
p
 = *
to
;

166 
	`poöt_sub
(&
p
, &
ñem
->
c‹√r
);

168 
id
) {

169 
HANDLE_RESIZE_NW
:

170 i‡–
to
->
x
 < (
c‹√r
->x+
ñem
->
width
)) {

171 
c‹√r
->
x
 +
p
.x;

172 
ñem
->
width
 -
p
.
x
;

174 i‡–
to
->
y
 < (
c‹√r
->y+
ñem
->
height
)) {

175 
c‹√r
->
y
 +
p
.y;

176 
ñem
->
height
 -
p
.
y
;

179 
HANDLE_RESIZE_N
:

180 i‡–
to
->
y
 < (
c‹√r
->y+
ñem
->
height
)) {

181 
c‹√r
->
y
 +
p
.y;

182 
ñem
->
height
 -
p
.
y
;

185 
HANDLE_RESIZE_NE
:

186 i‡(
p
.
x
>0.0)

187 
ñem
->
width
 = 
p
.
x
;

188 i‡–
to
->
y
 < (
c‹√r
->y+
ñem
->
height
)) {

189 
c‹√r
->
y
 +
p
.y;

190 
ñem
->
height
 -
p
.
y
;

193 
HANDLE_RESIZE_W
:

194 i‡–
to
->
x
 < (
c‹√r
->x+
ñem
->
width
)) {

195 
c‹√r
->
x
 +
p
.x;

196 
ñem
->
width
 -
p
.
x
;

199 
HANDLE_RESIZE_E
:

200 i‡(
p
.
x
>0.0)

201 
ñem
->
width
 = 
p
.
x
;

203 
HANDLE_RESIZE_SW
:

204 i‡–
to
->
x
 < (
c‹√r
->x+
ñem
->
width
)) {

205 
c‹√r
->
x
 +
p
.x;

206 
ñem
->
width
 -
p
.
x
;

208 i‡(
p
.
y
>0.0)

209 
ñem
->
height
 = 
p
.
y
;

211 
HANDLE_RESIZE_S
:

212 i‡(
p
.
y
>0.0)

213 
ñem
->
height
 = 
p
.
y
;

215 
HANDLE_RESIZE_SE
:

216 i‡(
p
.
x
>0.0)

217 
ñem
->
width
 = 
p
.
x
;

218 i‡(
p
.
y
>0.0)

219 
ñem
->
height
 = 
p
.
y
;

222 
	`mesßge_îr‹
("Error, calledÉlement_move_handle() with wrong handle-id\n");

224  
NULL
;

225 
	}
}

235 
	$ñemít_move_h™dÀ_a•e˘
(
EÀmít
 *
ñem
, 
H™dÀId
 
id
,

236 
Poöt
 *
to
, 
ªÆ
 
a•e˘_øtio
)

238 
Poöt
 
p
;

239 
Poöt
 *
c‹√r
;

240 
ªÆ
 
width
, 
height
;

241 
ªÆ
 
√w_width
, 
√w_height
;

242 
ªÆ
 
move_x
=0;

243 
ªÆ
 
move_y
=0;

245 
	`as£π
(
id
>=
HANDLE_RESIZE_NW
);

246 
	`as£π
(
id
<=
HANDLE_RESIZE_SE
);

248 
c‹√r
 = &
ñem
->corner;

250 
p
 = *
to
;

251 
	`poöt_sub
(&
p
, &
ñem
->
c‹√r
);

253 
width
 = 
ñem
->width;

254 
height
 = 
ñem
->height;

256 
√w_width
 = 0.0;

257 
√w_height
 = 0.0;

260 
id
) {

261 
HANDLE_RESIZE_NW
:

262 
√w_width
 = 
width
 - 
p
.
x
;

263 
√w_height
 = 
height
 - 
p
.
y
;

264 
move_x
 = 1.0;

265 
move_y
 = 1.0;

267 
HANDLE_RESIZE_N
:

268 
√w_height
 = 
height
 - 
p
.
y
;

269 
move_y
 = 1.0;

270 
move_x
 = 0.5;

272 
HANDLE_RESIZE_NE
:

273 
√w_width
 = 
p
.
x
;

274 
√w_height
 = 
height
 - 
p
.
y
;

275 
move_x
 = 0.0;

276 
move_y
 = 1.0;

278 
HANDLE_RESIZE_W
:

279 
√w_width
 = 
width
 - 
p
.
x
;

280 
move_x
 = 1.0;

281 
move_y
 = 0.5;

283 
HANDLE_RESIZE_E
:

284 
√w_width
 = 
p
.
x
;

285 
move_x
 = 0.0;

286 
move_y
 = 0.5;

288 
HANDLE_RESIZE_SW
:

289 
√w_width
 = 
width
 - 
p
.
x
;

290 
√w_height
 = 
p
.
y
;

291 
move_x
 = 1.0;

292 
move_y
 = 0.0;

294 
HANDLE_RESIZE_S
:

295 
√w_height
 = 
p
.
y
;

296 
move_x
 = 0.5;

297 
move_y
 = 0.0;

299 
HANDLE_RESIZE_SE
:

300 
√w_width
 = 
p
.
x
;

301 
√w_height
 = 
p
.
y
;

302 
move_x
 = 0.0;

303 
move_y
 = 0.0;

306 
	`mesßge_îr‹
("Error, calledÉlement_move_handle() with wrong handle-id\n");

310 i‡(
√w_width
 > 
√w_height
*
a•e˘_øtio
) {

311 
√w_height
 = 
√w_width
/
a•e˘_øtio
;

313 
√w_width
 = 
√w_height
*
a•e˘_øtio
;

316 i‡–(
√w_width
<0.0Ë|| (
√w_height
<0.0)) {

317 
√w_width
 = 0.0;

318 
√w_height
 = 0.0;

321 
c‹√r
->
x
 -(
√w_width
 - 
width
)*
move_x
;

322 
c‹√r
->
y
 -(
√w_height
 - 
height
)*
move_y
;

324 
ñem
->
width
 = 
√w_width
;

325 
ñem
->
height
 = 
√w_height
;

326 
	}
}

339 
	$ñemít_öô
(
EÀmít
 *
ñem
, 
num_h™dÀs
, 
num_c⁄√˘i⁄s
)

341 
DüObje˘
 *
obj
;

342 
i
;

344 
obj
 = &
ñem
->
obje˘
;

346 
	`as£π
(
num_h™dÀs
>=8);

348 
	`obje˘_öô
(
obj
, 
num_h™dÀs
, 
num_c⁄√˘i⁄s
);

350 
i
=0;i<8;i++) {

351 
obj
->
h™dÀs
[
i
] = &
ñem
->
ªsize_h™dÀs
[i];

352 
obj
->
h™dÀs
[
i
]->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

353 
obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 = 
NULL
;

354 
obj
->
h™dÀs
[
i
]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

356 
	}
}

364 
	$ñemít_c›y
(
EÀmít
 *
‰om
, EÀmíà*
to
)

366 
DüObje˘
 *
toobj
, *
‰omobj
;

367 
i
;

369 
‰omobj
 = &
‰om
->
obje˘
;

370 
toobj
 = &
to
->
obje˘
;

372 
	`obje˘_c›y
(
‰omobj
, 
toobj
);

374 
to
->
c‹√r
 = 
‰om
->corner;

375 
to
->
width
 = 
‰om
->width;

376 
to
->
height
 = 
‰om
->height;

378 
i
=0;i<8;i++) {

379 
to
->
ªsize_h™dÀs
[
i
] = 
‰om
->resize_handles[i];

380 
to
->
ªsize_h™dÀs
[
i
].
c⁄√˘ed_to
 = 
NULL
;

381 
toobj
->
h™dÀs
[
i
] = &
to
->
ªsize_h™dÀs
[i];

383 
	`mem˝y
(&
to
->
exåa_•acög
,&
‰om
->extra_spacing,(to->extra_spacing));

384 
	}
}

392 
	$ñemít_de°roy
(
EÀmít
 *
ñem
)

394 
	`obje˘_de°roy
(&
ñem
->
obje˘
);

395 
	}
}

402 
	$ñemít_ßve
(
EÀmít
 *
ñem
, 
Obje˘Node
 
obj_node
)

404 
	`obje˘_ßve
(&
ñem
->
obje˘
, 
obj_node
);

406 
	`d©a_add_poöt
(
	`√w_©åibuã
(
obj_node
, "elem_corner"),

407 &
ñem
->
c‹√r
);

408 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "elem_width"),

409 
ñem
->
width
);

410 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "elem_height"),

411 
ñem
->
height
);

412 
	}
}

414 
	$ñemít_lﬂd
(
EÀmít
 *
ñem
, 
Obje˘Node
 
obj_node
)

416 
AâribuãNode
 
©å
;

418 
	`obje˘_lﬂd
(&
ñem
->
obje˘
, 
obj_node
);

420 
ñem
->
c‹√r
.
x
 = 0.0;

421 
ñem
->
c‹√r
.
y
 = 0.0;

422 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "elem_corner");

423 i‡(
©å
 !
NULL
)

424 
	`d©a_poöt
–
	`©åibuã_fú°_d©a
(
©å
), &
ñem
->
c‹√r
 );

426 
ñem
->
width
 = 1.0;

427 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "elem_width");

428 i‡(
©å
 !
NULL
)

429 
ñem
->
width
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
));

431 
ñem
->
height
 = 1.0;

432 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "elem_height");

433 i‡(
©å
 !
NULL
)

434 
ñem
->
height
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
));

436 
	}
}

	@O:\tool\dvs50\lib\element.h

20 #i‚de‡
ELEMENT_H


21 
	#ELEMENT_H


	)

23 
	~"düty≥s.h
"

24 
	~"obje˘.h
"

25 
	~"h™dÀ.h
"

26 
	~"c⁄√˘i⁄poöt.h
"

27 
	~"boundögbox.h
"

36 
	s_EÀmít
 {

37 
DüObje˘
 
	mobje˘
;

39 
H™dÀ
 
	mªsize_h™dÀs
[8];

41 
Poöt
 
	mc‹√r
;

42 
ªÆ
 
	mwidth
;

43 
ªÆ
 
	mheight
;

45 
EÀmítBBExåas
 
	mexåa_•acög
;

48 
DIAVAR
 
ñemít_upd©e_h™dÀs
(
EÀmít
 *
ñem
);

49 
DIAVAR
 
ñemít_upd©e_c⁄√˘i⁄s_ª˘™gÀ
(
EÀmít
 *
ñem
,

50 
C⁄√˘i⁄Poöt
* 
˝s
);

51 
DIAVAR
 
ñemít_upd©e_boundögbox
(
EÀmít
 *
ñem
);

52 
DIAVAR
 
ñemít_öô
(
EÀmít
 *
ñem
, 
num_h™dÀs
, 
num_c⁄√˘i⁄s
);

53 
DIAVAR
 
ñemít_de°roy
(
EÀmít
 *
ñem
);

54 
DIAVAR
 
ñemít_c›y
(
EÀmít
 *
‰om
, EÀmíà*
to
);

55 
DIAVAR
 
Obje˘Ch™ge
* 
ñemít_move_h™dÀ
(
EÀmít
 *
ñem
, 
H™dÀId
 
id
,

56 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

57 
H™dÀMoveRós⁄
 
ªas⁄
,

58 
ModifõrKeys
 
modifõrs
);

59 
ñemít_move_h™dÀ_a•e˘
(
EÀmít
 *
ñem
, 
H™dÀId
 
id
,

60 
Poöt
 *
to
, 
ªÆ
 
a•e˘_øtio
);

62 
DIAVAR
 
ñemít_ßve
(
EÀmít
 *
ñem
, 
Obje˘Node
 
obj_node
);

63 
DIAVAR
 
ñemít_lﬂd
(
EÀmít
 *
ñem
, 
Obje˘Node
 
obj_node
);

66 
Pr›NumD©a
 
	gwidth_ønge
 = { -
G_MAXFLOAT
, G_MAXFLOAT, 0.1};

68 
	#ELEMENT_COMMON_PROPERTIES
 \

69 
OBJECT_COMMON_PROPERTIES
, \

70 { "ñem_c‹√r", 
PROP_TYPE_POINT
, 
PROP_FLAG_NO_DEFAULTS
, \

72 { "ñem_width", 
PROP_TYPE_REAL
, 
PROP_FLAG_DONT_MERGE
 | 
PROP_FLAG_NO_DEFAULTS
 | 
PROP_FLAG_OPTIONAL
, \

73 "EÀmíàwidth", "Thêwidth o‡thêñemít", &
width_ønge
}, \

74 { "ñem_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_DONT_MERGE
 | 
PROP_FLAG_NO_DEFAULTS
 | 
PROP_FLAG_OPTIONAL
, \

75 "EÀmíàheight", "Thêheighào‡thêñemít", &
width_ønge
}

	)

93 
	#ELEMENT_COMMON_PROPERTIES_OFFSETS
 \

94 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

95 { "ñem_c‹√r", 
PROP_TYPE_POINT
, 
	`off£tof
(
EÀmít
, 
c‹√r
) }, \

96 { "ñem_width", 
PROP_TYPE_REAL
, 
	`off£tof
(
EÀmít
, 
width
) }, \

97 { "ñem_height", 
PROP_TYPE_REAL
, 
	`off£tof
(
EÀmít
, 
height
Ë}

	)

	@O:\tool\dvs50\lib\filter.c

22 #ifde‡
HAVE_CONFIG_H


23 
	~<c⁄fig.h
>

26 
	~"fûãr.h
"

27 
	~"öé.h
"

28 
	~<°rög.h
>

30 
GLi°
 *
	gexp‹t_fûãrs
 = 
NULL
;

31 
GLi°
 *
	gimp‹t_fûãrs
 = 
NULL
;

32 
GLi°
 *
	gˇŒback_fûãrs
 = 
NULL
;

34 
göt


35 
	$exp‹t_fûãr_com∑ª
(
gc⁄°poöãr
 
a
, gc⁄°poöã∏
b
)

37 c⁄° 
DüExp‹tFûãr
 *
Á
 = 
a
, *
fb
 = 
b
;

39  
	`g_ascii_°rˇ£cmp
(
	`_
(
Á
->
des¸ùti⁄
), _(
fb
->description));

40 
	}
}

43 
	$fûãr_ªgi°î_exp‹t
(
DüExp‹tFûãr
 *
efûãr
)

45 i‡(
efûãr
->
des¸ùti⁄
 =
NULL
) {

48 
exp‹t_fûãrs
 = 
	`g_li°_ö£π_s‹ãd
”xp‹t_fûãrs, 
efûãr
,

49 
exp‹t_fûãr_com∑ª
);

50 
	}
}

53 
	$fûãr_uƒegi°î_exp‹t
(
DüExp‹tFûãr
 *
efûãr
)

55 
exp‹t_fûãrs
 = 
	`g_li°_ªmove
”xp‹t_fûãrs, 
efûãr
);

56 
	}
}

59 
GLi°
 *

60 
	$fûãr_gë_exp‹t_fûãrs
()

62  
exp‹t_fûãrs
;

63 
	}
}

66 
gch¨
 *

67 
	$fûãr_gë_exp‹t_fûãr_œbñ
(
DüExp‹tFûãr
 *
efûãr
)

69 
GSåög
 *
°r
 = 
	`g_°rög_√w
(
	`_
(
efûãr
->
des¸ùti⁄
));

70 
göt
 
ext
 = 0;

71 
gch¨
 *
ªt
;

73 
ext
 = 0; 
efûãr
->
exãnsi⁄s
[ext] !
NULL
;Éxt++) {

74 i‡(
ext
 == 0)

75 
	`g_°rög_≠≥nd
(
°r
, " (*.");

77 
	`g_°rög_≠≥nd
(
°r
, ", *.");

78 
	`g_°rög_≠≥nd
(
°r
, 
efûãr
->
exãnsi⁄s
[
ext
]);

80 i‡(
ext
 > 0)

81 
	`g_°rög_≠≥nd
(
°r
, ")");

82 
ªt
 = 
°r
->str;

83 
	`g_°rög_‰ì
(
°r
, 
FALSE
);

84  
ªt
;

85 
	}
}

88 
GLi°
 *

89 
	$fûãr_gë_unique_exp‹t_«mes
(c⁄° *
ext
)

91 
GLi°
 *
tmp
, *
ªs
 = 
NULL
;

93 
tmp
 = 
exp‹t_fûãrs
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

94 
DüExp‹tFûãr
 *
ef
 = 
tmp
->
d©a
;

95 
göt
 
i
;

97 
i
 = 0; 
ef
->
exãnsi⁄s
[i] !
NULL
; i++) {

98 i‡(!
	`g_ascii_°rˇ£cmp
(
ef
->
exãnsi⁄s
[
i
], 
ext
Ë&&Éf->
unique_«me
)

99 
ªs
 = 
	`g_li°_≠≥nd
 (ªs, (*)
ef
->
unique_«me
);

102  
ªs
;

103 
	}
}

105 
GHashTabÀ
 *
	g_Áv‹ed_hash
 = 
NULL
;

109 
	$fûãr_£t_Áv‹ed_exp‹t
(c⁄° *
ext
, c⁄° *
«me
)

111 i‡(!
_Áv‹ed_hash
)

112 
_Áv‹ed_hash
 = 
	`g_hash_èbÀ_√w_fuŒ
 (
g_°r_hash
, 
g_°r_equÆ
, 
g_‰ì
, g_free);

114 
	`g_hash_èbÀ_ö£π
(
_Áv‹ed_hash
, 
	`g_ascii_°rdown
(
ext
, -1), 
	`g_°rdup
(
«me
));

115 
	}
}

123 
DüExp‹tFûãr
 *

124 
	$fûãr_guess_exp‹t_fûãr
(c⁄° 
gch¨
 *
fûíame
)

126 
GLi°
 *
tmp
;

127 
gch¨
 *
ext
;

128 
göt
 
no_guess
 = 0;

129 
DüExp‹tFûãr
 *
d⁄t_guess
 = 
NULL
;

130 c⁄° 
gch¨
 *
unique_«me
;

132 
ext
 = 
	`°ºchr
(
fûíame
, '.');

133 i‡(
ext
)

134 
ext
++;

136 
ext
 = "";

139 
unique_«me
 = 
_Áv‹ed_hash
 ? 
	`g_hash_èbÀ_lookup
(_Áv‹ed_hash, 
ext
Ë: 
NULL
;

140 i‡(
unique_«me
) {

141 
DüExp‹tFûãr
 *
ef
 = 
	`fûãr_gë_by_«me
(
unique_«me
);

142 i‡(
ef
)

143  
ef
;

146 
tmp
 = 
exp‹t_fûãrs
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

147 
DüExp‹tFûãr
 *
ef
 = 
tmp
->
d©a
;

148 
göt
 
i
;

150 
i
 = 0; 
ef
->
exãnsi⁄s
[i] !
NULL
; i++) {

151 i‡(!
	`g_ascii_°rˇ£cmp
(
ef
->
exãnsi⁄s
[
i
], 
ext
)) {

152 i‡(
ef
->
höts
 & 
FILTER_DONT_GUESS
) {

153 
d⁄t_guess
 = 
ef
;

154 ++
no_guess
;

157  
ef
;

161  (
no_guess
 =1Ë? 
d⁄t_guess
 : 
NULL
;

162 
	}
}

166 
DüExp‹tFûãr
 *

167 
	$fûãr_gë_by_«me
(c⁄° 
gch¨
 *
«me
)

169 
GLi°
 *
tmp
;

170 
DüExp‹tFûãr
 *
fûãr
 = 
NULL
;

172 
tmp
 = 
exp‹t_fûãrs
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

173 
DüExp‹tFûãr
 *
ef
 = 
tmp
->
d©a
;

174 i‡(
ef
->
unique_«me
 !
NULL
) {

175 i‡(!
	`g_ascii_°rˇ£cmp
(
ef
->
unique_«me
, 
«me
)) {

176 i‡(
fûãr
)

177 
	`g_w¨nög
(
	`_
("Mu…ùÀÉxp‹àfûãr†wôh uniquê«mê%s"), 
«me
);

178 
fûãr
 = 
ef
;

182  
fûãr
;

183 
	}
}

185 
göt


186 
	$imp‹t_fûãr_com∑ª
(
gc⁄°poöãr
 
a
, gc⁄°poöã∏
b
)

188 c⁄° 
DüImp‹tFûãr
 *
Á
 = 
a
, *
fb
 = 
b
;

190  
	`g_ascii_°rˇ£cmp
(
	`_
(
Á
->
des¸ùti⁄
), _(
fb
->description));

191 
	}
}

194 
	$fûãr_ªgi°î_imp‹t
(
DüImp‹tFûãr
 *
ifûãr
)

196 i‡(
ifûãr
->
des¸ùti⁄
 =
NULL
) {

199 
imp‹t_fûãrs
 = 
	`g_li°_ö£π_s‹ãd
(imp‹t_fûãrs, 
ifûãr
,

200 
imp‹t_fûãr_com∑ª
);

201 
	}
}

204 
	$fûãr_uƒegi°î_imp‹t
(
DüImp‹tFûãr
 *
ifûãr
)

206 
imp‹t_fûãrs
 = 
	`g_li°_ªmove
(imp‹t_fûãrs, 
ifûãr
);

207 
	}
}

210 
GLi°
 *

211 
	$fûãr_gë_imp‹t_fûãrs
()

213  
imp‹t_fûãrs
;

214 
	}
}

217 
gch¨
 *

218 
	$fûãr_gë_imp‹t_fûãr_œbñ
(
DüImp‹tFûãr
 *
ifûãr
)

220 
GSåög
 *
°r
 = 
	`g_°rög_√w
(
	`_
(
ifûãr
->
des¸ùti⁄
));

221 
göt
 
ext
 = 0;

222 
gch¨
 *
ªt
;

224 
ext
 = 0; 
ifûãr
->
exãnsi⁄s
[ext] !
NULL
;Éxt++) {

225 i‡(
ext
 == 0)

226 
	`g_°rög_≠≥nd
(
°r
, " (*.");

228 
	`g_°rög_≠≥nd
(
°r
, ", *.");

229 
	`g_°rög_≠≥nd
(
°r
, 
ifûãr
->
exãnsi⁄s
[
ext
]);

231 i‡(
ext
 > 0)

232 
	`g_°rög_≠≥nd
(
°r
, ")");

233 
ªt
 = 
°r
->str;

234 
	`g_°rög_‰ì
(
°r
, 
FALSE
);

235  
ªt
;

236 
	}
}

242 
DüImp‹tFûãr
 *

243 
	$fûãr_guess_imp‹t_fûãr
(c⁄° 
gch¨
 *
fûíame
)

245 
GLi°
 *
tmp
;

246 
gch¨
 *
ext
;

247 
no_guess
 = 0;

248 
DüImp‹tFûãr
 *
d⁄t_guess
 = 
NULL
;

250 
ext
 = 
	`°ºchr
(
fûíame
, '.');

251 i‡(
ext
)

252 
ext
++;

254 
ext
 = "";

256 
tmp
 = 
imp‹t_fûãrs
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

257 
DüImp‹tFûãr
 *
ifûãr
 = 
tmp
->
d©a
;

258 
göt
 
i
;

260 
i
 = 0; 
ifûãr
->
exãnsi⁄s
[i] !
NULL
; i++) {

261 i‡(!
	`g_ascii_°rˇ£cmp
(
ifûãr
->
exãnsi⁄s
[
i
], 
ext
)) {

262 i‡(
ifûãr
->
höts
 & 
FILTER_DONT_GUESS
) {

263 
d⁄t_guess
 = 
ifûãr
;

264 ++
no_guess
;

267  
ifûãr
;

271  (
no_guess
 =1Ë? 
d⁄t_guess
 : 
NULL
;

272 
	}
}

276 
	$fûãr_ªgi°î_ˇŒback
(
DüCÆlbackFûãr
 *
cbfûãr
)

279 
	`g_ªtu∫_if_Áû
 (
cbfûãr
 !
NULL
);

280 
	`g_ªtu∫_if_Áû
 (
cbfûãr
->
ˇŒback
 !
NULL
);

281 
	`g_ªtu∫_if_Áû
 (
cbfûãr
->
míu∑th
 !
NULL
);

282 
	`g_ªtu∫_if_Áû
 (
cbfûãr
->
des¸ùti⁄
 !
NULL
);

283 
	`g_ªtu∫_if_Áû
 (
cbfûãr
->
a˘i⁄
 !
NULL
);

286 
ˇŒback_fûãrs
 = 
	`g_li°_≠≥nd
 (ˇŒback_fûãrs, (
gpoöãr
)
cbfûãr
);

287 
	}
}

290 
GLi°
 *

291 
	$fûãr_gë_ˇŒbacks
()

293  
	`g_li°_fú°
 (
ˇŒback_fûãrs
);

294 
	}
}

	@O:\tool\dvs50\lib\filter.h

21 #i‚de‡
FILTER_H


22 
	#FILTER_H


	)

24 
	~"düty≥s.h
"

25 
	~<glib.h
>

26 
	~<dügømd©a.h
>

28 
G_BEGIN_DECLS


30 
	eFûãrFœgs
 {

31 
	mFILTER_DONT_GUESS
 = (1<<0)

34 (* 
	tDüExp‹tFunc
Ë(
	tDügømD©a
 *
	tdü
, c⁄° 
	tgch¨
 *
	tfûíame
,

35 c⁄° 
	tgch¨
 *
	tdüfûíame
, * 
	tu£r_d©a
);

37 
	s_DüExp‹tFûãr
 {

38 c⁄° 
gch¨
 *
des¸ùti⁄
;

41 c⁄° 
gch¨
 **
exãnsi⁄s
;

42 
DüExp‹tFunc
 
exp‹t_func
;

43 * 
u£r_d©a
;

49 c⁄° 
gch¨
 *
unique_«me
;

51 
guöt
 
höts
;

53 
GTy≥
 
ªndîî_ty≥
;

57 
	$gboﬁón
 (* 
	tDüImp‹tFunc
Ë(c⁄° 
	tgch¨
 *
	tfûíame
, 
	tDügømD©a
 *
	tdü
,

58 * 
	tu£r_d©a
);

60 
	s_DüImp‹tFûãr
 {

61 c⁄° 
gch¨
 *
des¸ùti⁄
;

64 c⁄° 
gch¨
 **
exãnsi⁄s
;

65 
DüImp‹tFunc
 
imp‹t_func
;

66 * 
u£r_d©a
;

72 c⁄° 
gch¨
 *
unique_«me
;

74 
guöt
 
höts
;

78 (* 
	tDüCÆlbackFunc
Ë(
	tDügømD©a
 *
	tdü
,

79 c⁄° 
	tgch¨
 *
	tfûíame
,

80 
	tguöt
 
	tÊags
,

81 * 
	tu£r_d©a
);

83 
	s_DüCÆlbackFûãr
 {

84 c⁄° 
gch¨
 *
a˘i⁄
;

85 c⁄° 
gch¨
 *
des¸ùti⁄
;

86 c⁄° 
gch¨
 *
míu∑th
;

87 
DüCÆlbackFunc
 
ˇŒback
;

88 * 
u£r_d©a
;

93 
DIAVAR
 
	`fûãr_ªgi°î_exp‹t
(
DüExp‹tFûãr
 *
efûãr
);

95 
DIAVAR
 
	`fûãr_uƒegi°î_exp‹t
(
DüExp‹tFûãr
 *
efûãr
);

98 
DIAVAR
 
GLi°
 *
	`fûãr_gë_exp‹t_fûãrs
();

101 
DIAVAR
 
gch¨
 *
	`fûãr_gë_exp‹t_fûãr_œbñ
(
DüExp‹tFûãr
 *
efûãr
);

104 
DIAVAR
 
DüExp‹tFûãr
 *
	`fûãr_guess_exp‹t_fûãr
(c⁄° 
gch¨
 *
fûíame
);

106 
DIAVAR
 
DüExp‹tFûãr
 *
	`fûãr_gë_by_«me
(c⁄° 
gch¨
 *
«me
);

108 
DIAVAR
 
GLi°
 *
	`fûãr_gë_unique_exp‹t_«mes
(c⁄° *
exãnsi⁄
);

110 
DIAVAR
 
	`fûãr_£t_Áv‹ed_exp‹t
(c⁄° *
exãnsi⁄
, c⁄° *
«me
);

112 
DIAVAR
 
	`fûãr_ªgi°î_imp‹t
(
DüImp‹tFûãr
 *
ifûãr
);

113 
DIAVAR
 
	`fûãr_uƒegi°î_imp‹t
(
DüImp‹tFûãr
 *
ifûãr
);

114 
DIAVAR
 
GLi°
 *
	`fûãr_gë_imp‹t_fûãrs
();

115 
DIAVAR
 
gch¨
 *
	`fûãr_gë_imp‹t_fûãr_œbñ
(
DüImp‹tFûãr
 *
ifûãr
);

116 
DIAVAR
 
DüImp‹tFûãr
 *
	`fûãr_guess_imp‹t_fûãr
(c⁄° 
gch¨
 *
fûíame
);

118 
DIAVAR
 
	`fûãr_ªgi°î_ˇŒback
(
DüCÆlbackFûãr
 *
cbfûãr
);

120 
DIAVAR
 
GLi°
 *
	`fûãr_gë_ˇŒbacks
();

122 
G_END_DECLS


	@O:\tool\dvs50\lib\focus.c

27 
	~<c⁄fig.h
>

28 
	~"ãxt.h
"

29 
	~"focus.h
"

30 
	~"dügømd©a.h
"

31 
	~"obje˘.h
"

34 
GLi°
 *

35 
	$gë_ãxt_foci
(
DügømD©a
 *
dü
)

37  
dü
->
ãxt_edôs
;

38 
	}
}

41 
Focus
 *

42 
	$gë_a˘ive_focus
(
DügømD©a
 *
dü
)

44  
dü
->
a˘ive_ãxt_edô
;

45 
	}
}

53 
	$£t_a˘ive_focus
(
DügømD©a
 *
dü
, 
Focus
 *
focus
)

55 i‡(
dü
->
a˘ive_ãxt_edô
 !
NULL
) {

56 
dü
->
a˘ive_ãxt_edô
->
has_focus
 = 
FALSE
;

58 
dü
->
a˘ive_ãxt_edô
 = 
focus
;

59 i‡(
focus
 !
NULL
) {

60 
focus
->
has_focus
 = 
TRUE
;

62 
	}
}

67 
	$add_ãxt_focus
(
DügømD©a
 *
dü
, 
Focus
 *
focus
)

69 
dü
->
ãxt_edôs
 = 
	`g_li°_≠≥nd
(dü->ãxt_edôs, 
focus
);

70 
	}
}

75 
GLi°
 *

76 
	$£t_ãxt_foci
(
DügømD©a
 *
dü
, 
GLi°
 *
foci
)

78 
GLi°
 *
ﬁd_foci
 = 
	`gë_ãxt_foci
(
dü
);

79 
dü
->
ãxt_edôs
 = 
NULL
;

80  
ﬁd_foci
;

81 
	}
}

87 
	$ªque°_focus
(
Focus
 *
focus
)

89 
DügømD©a
 *
dü
 = 
focus
->
obj
->
∑ª¡_œyî
->
∑ª¡_dügøm
;

90 
GLi°
 *
ãxt_foci
 = 
	`gë_ãxt_foci
(
dü
);

92 i‡(!
	`g_li°_föd
(
ãxt_foci
, 
focus
)) {

93 
	`add_ãxt_focus
(
dü
, 
focus
);

96 
	}
}

99 
	$give_focus
(
Focus
 *
focus
)

101 
DügømD©a
 *
dü
 = 
focus
->
obj
->
∑ª¡_œyî
->
∑ª¡_dügøm
;

103 i‡(
	`gë_a˘ive_focus
(
dü
Ë!
NULL
) {

104 
	`gë_a˘ive_focus
(
dü
)->
has_focus
 = 
FALSE
;

106 
	`£t_a˘ive_focus
(
dü
, 
focus
);

107 
focus
->
has_focus
 = 
TRUE
;

108 
	}
}

112 
Focus
 *

113 
	$focus_gë_fú°_⁄_obje˘
(
DüObje˘
 *
obj
)

115 
GLi°
 *
tm∂i°
 = 
	`gë_ãxt_foci
(
obj
->
∑ª¡_œyî
->
∑ª¡_dügøm
);

117 ; 
tm∂i°
 !
NULL
;Åm∂i° = 
	`g_li°_√xt
(tmplist) ) {

118 
Focus
 *
focus
 = (Focus*)
tm∂i°
->
d©a
;

119 i‡(
	`focus_gë_obje˘
(
focus
Ë=
obj
) {

120  
focus
;

123  
NULL
;

124 
	}
}

130 
DüObje˘
*

131 
	$focus_gë_obje˘
(
Focus
 *
focus
)

133  
focus
->
obj
;

134 
	}
}

136 
Focus
 *

137 
	$focus_√xt_⁄_dügøm
(
DügømD©a
 *
dü
)

139 i‡(
	`gë_ãxt_foci
(
dü
Ë!
NULL
 && 
	`gë_a˘ive_focus
(dia) != NULL) {

140 
GLi°
 *
li°ñem
 = 
	`g_li°_föd
(
	`gë_ãxt_foci
(
dü
), 
	`gë_a˘ive_focus
(dia));

141 
li°ñem
 = 
	`g_li°_√xt
(listelem);

142 i‡(
li°ñem
 =
NULL
Ëli°ñem = 
	`gë_ãxt_foci
(
dü
);

143  ((
Focus
*)
li°ñem
->
d©a
);

145  
NULL
;

146 
	}
}

149 
Focus
 *

150 
	$focus_¥evious_⁄_dügøm
(
DügømD©a
 *
dü
)

152 
GLi°
 *
ãxt_foci
 = 
	`gë_ãxt_foci
(
dü
);

153 i‡(
ãxt_foci
 !
NULL
 && 
	`gë_a˘ive_focus
(
dü
) != NULL) {

154 
GLi°
 *
li°ñem
 = 
	`g_li°_föd
(
ãxt_foci
, 
	`gë_a˘ive_focus
(
dü
));

155 
li°ñem
 = 
	`g_li°_¥evious
(listelem);

156 i‡(
li°ñem
 =
NULL
)

157 
li°ñem
 = 
	`g_li°_œ°
(
ãxt_foci
);

158  (
Focus
 *)
li°ñem
->
d©a
;

160  
NULL
;

161 
	}
}

164 
	$ªmove_focus_⁄_dügøm
(
DügømD©a
 *
dü
)

166 i‡(
	`gë_a˘ive_focus
(
dü
Ë!
NULL
) {

167 
	`£t_a˘ive_focus
(
dü
, 
NULL
);

169 
	}
}

172 
	$ª£t_foci_⁄_dügøm
(
DügømD©a
 *
dü
)

174 
GLi°
 *
ﬁd_foci
;

175 
	`ªmove_focus_⁄_dügøm
(
dü
);

176 
ﬁd_foci
 = 
	`£t_ãxt_foci
(
dü
, 
NULL
);

177 
	`g_li°_‰ì
(
ﬁd_foci
);

178 
	}
}

183 
gboﬁón


184 
	$ªmove_focus_obje˘
(
DüObje˘
 *
obj
)

186 
DügømD©a
 *
dü
 = 
obj
->
∑ª¡_œyî
->
∑ª¡_dügøm
;

187 
GLi°
 *
tm∂i°
 = 
	`gë_ãxt_foci
(
dü
);

188 
gboﬁón
 
a˘ive
 = 
FALSE
;

189 
Focus
 *
√xt_focus
 = 
NULL
;

190 
Focus
 *
a˘ive_focus
 = 
	`gë_a˘ive_focus
(
dü
);

192 ; 
tm∂i°
 !
NULL
; ) {

193 
Focus
 *
focus
 = (Focus*)
tm∂i°
->
d©a
;

194 
GLi°
 *
lök
 = 
tm∂i°
;

195 
tm∂i°
 = 
	`g_li°_√xt
(tmplist);

196 i‡(
	`focus_gë_obje˘
(
focus
Ë=
obj
) {

197 i‡(
focus
 =
a˘ive_focus
) {

198 
√xt_focus
 = 
	`focus_√xt_⁄_dügøm
(
dü
);

199 
a˘ive
 = 
TRUE
;

201 
	`£t_ãxt_foci
(
dü
, 
	`g_li°_dñëe_lök
(
	`gë_ãxt_foci
(dü), 
lök
));

204 i‡(
√xt_focus
 !
NULL
 && 
	`gë_ãxt_foci
(
dü
) != NULL) {

205 
	`give_focus
(
√xt_focus
);

207 i‡(
	`gë_ãxt_foci
(
dü
Ë=
NULL
) {

208 
	`£t_a˘ive_focus
(
dü
, 
NULL
);

211  
a˘ive
;

212 
	}
}

	@O:\tool\dvs50\lib\focus.h

18 #i‚de‡
FOCUS_H


19 
	#FOCUS_H


	)

21 
	~"düty≥s.h
"

23 
	s_Focus
 {

24 
DüObje˘
 *
	mobj
;

25 
Text
 *
	mãxt
;

26 
	mhas_focus
;

27 *
	mu£r_d©a
;

31 (*
	mkey_evít
)(
Focus
 *
	mfocus
, 
guöt
 
	mkeysym
, c⁄° 
gch¨
 *
	m°r
, 
	m°æí
,

32 
Obje˘Ch™ge
 **
	mch™ge
);

35 
ªque°_focus
(
Focus
 *
focus
);

36 
DIAVAR
 
Focus
 *
gë_a˘ive_focus
(
DügømD©a
 *
dü
);

37 
DIAVAR
 
give_focus
(
Focus
 *
focus
);

38 
DIAVAR
 
Focus
 *
focus_gë_fú°_⁄_obje˘
(
DüObje˘
 *
obj
);

39 
DIAVAR
 
Focus
 *
focus_√xt_⁄_dügøm
(
DügømD©a
 *
dü
);

40 
DIAVAR
 
Focus
 *
focus_¥evious_⁄_dügøm
(
DügømD©a
 *
dü
);

41 
DIAVAR
 
ªmove_focus_⁄_dügøm
(
DügømD©a
 *
dü
);

42 
DIAVAR
 
gboﬁón
 
ªmove_focus_obje˘
(
DüObje˘
 *
obj
);

43 
DIAVAR
 
ª£t_foci_⁄_dügøm
(
DügømD©a
 *
dü
);

44 
DIAVAR
 
DüObje˘
* 
focus_gë_obje˘
(
Focus
 *
focus
);

	@O:\tool\dvs50\lib\font.c

21 #ifde‡
HAVE_CONFIG_H


22 
	~<c⁄fig.h
>

25 
	~<°dio.h
>

26 
	~<°dlib.h
>

27 
	~<°rög.h
>

28 
	~<time.h
>

30 
	~<∑ngo/∑ngo.h
>

31 #ifde‡
HAVE_FREETYPE


32 
	~<∑ngo/∑ngo·2.h
>

34 
	~<gdk/gdk.h
>

35 
	~<gtk/gtk.h
>

36 #ifde‡
GDK_WINDOWING_WIN32


38 
	#Re˘™gÀ
 
Wö32Re˘™gÀ


	)

39 
	#WIN32_LEAN_AND_MEAN


	)

40 
	~<∑ngo/∑ngowö32.h
>

41 #unde‡
Re˘™gÀ


43 
	~"f⁄t.h
"

44 
	~"mesßge.h
"

45 
	~"öé.h
"

46 
	~"ãxéöe.h
"

48 
P™goC⁄ãxt
* 
	g∑ngo_c⁄ãxt
 = 
NULL
;

50 
	s_DüF⁄t


52 
GObje˘
 
	m∑ª¡_ö°™˚
;

54 
P™goF⁄tDes¸ùti⁄
* 
	mpfd
;

55  * 
	mÀgacy_«me
;

61 
ªÆ
 
	mheight
;

63 
P™goF⁄t
 *
	mlﬂded
;

64 
P™goF⁄tMërics
 *
	mmërics
;

72 
ªÆ
 
	gglobÆ_zoom_Á˘‹
 = 20.0;

75 
	$dü_f⁄t_check_f‹_f⁄t
(
f⁄t
)

77 
DüF⁄t
 *
check
;

78 
P™goF⁄t
 *
lﬂded
;

79 
ªÆ
 
height
 = 1.0;

81 
check
 = 
	`dü_f⁄t_√w_‰om_°yÀ
(
f⁄t
, 
height
);

82 
lﬂded
 = 
	`∑ngo_c⁄ãxt_lﬂd_f⁄t
(
	`dü_f⁄t_gë_c⁄ãxt
(), 
check
->
pfd
);

83 i‡(!
lﬂded
) {

84 
	`mesßge_îr‹
(
	`_
("C™'àlﬂd f⁄à%s.\n"), 
	`dü_f⁄t_gë_Ámûy
(
check
));

86 
	`g_obje˘_uƒef
(
lﬂded
);

88 
	`dü_f⁄t_uƒef
(
check
);

89 
	}
}

92 
	$dü_f⁄t_öô
(
P™goC⁄ãxt
* 
pc⁄ãxt
)

94 
∑ngo_c⁄ãxt
 = 
pc⁄ãxt
;

96 
	`dü_f⁄t_check_f‹_f⁄t
(
DIA_FONT_SANS
);

97 
	`dü_f⁄t_check_f‹_f⁄t
(
DIA_FONT_SERIF
);

98 
	`dü_f⁄t_check_f‹_f⁄t
(
DIA_FONT_MONOSPACE
);

99 
	}
}

102 
GLi°
 *
	g∑ngo_c⁄ãxts
 = 
NULL
;

106 
	$dü_f⁄t_push_c⁄ãxt
(
P™goC⁄ãxt
 *
pc⁄ãxt
)

108 
∑ngo_c⁄ãxts
 = 
	`g_li°_¥ïíd
’™go_c⁄ãxts, 
∑ngo_c⁄ãxt
);

109 
∑ngo_c⁄ãxt
 = 
pc⁄ãxt
;

110 
	`∑ngo_c⁄ãxt_£t_œnguage
 (
∑ngo_c⁄ãxt
, 
	`gtk_gë_deÁu…_œnguage
 ());

111 
	`g_obje˘_ªf
(
pc⁄ãxt
);

112 
	}
}

116 
	$dü_f⁄t_p›_c⁄ãxt
() {

117 
	`g_obje˘_uƒef
(
∑ngo_c⁄ãxt
);

118 
∑ngo_c⁄ãxt
 = (
P™goC⁄ãxt
*)
∑ngo_c⁄ãxts
->
d©a
;

119 
	`∑ngo_c⁄ãxt_£t_œnguage
 (
∑ngo_c⁄ãxt
, 
	`gtk_gë_deÁu…_œnguage
 ());

120 
∑ngo_c⁄ãxts
 = 
	`g_li°_√xt
(pango_contexts);

121 
	}
}

123 
P™goC⁄ãxt
 *

124 
	$dü_f⁄t_gë_c⁄ãxt
()

126 i‡(
∑ngo_c⁄ãxt
 =
NULL
) {

132 #ifde‡
HAVE_FREETYPE


140 
	`dü_f⁄t_push_c⁄ãxt
(
	`∑ngo_·2_gë_c⁄ãxt
(75,75));

142 i‡(
	`gdk_di•œy_gë_deÁu…
 ())

143 
	`dü_f⁄t_push_c⁄ãxt
(
	`gdk_∑ngo_c⁄ãxt_gë
());

145 #ifde‡
GDK_WINDOWING_WIN32


146 
	`dü_f⁄t_push_c⁄ãxt
(
	`∑ngo_wö32_gë_c⁄ãxt
 ());

148 
	`g_w¨nög
 ("dia_font_get_context() :Çot font context w/o display. Crashing soon.");

153  
∑ngo_c⁄ãxt
;

154 
	}
}

157 
göt


158 
	$dcm_to_pdu
(
ªÆ
 
dcm
Ë{  dcm * 
globÆ_zoom_Á˘‹
 * 
PANGO_SCALE
; 
	}
}

160 
ªÆ


161 
	$pdu_to_dcm
(
göt
 
pdu
Ë{  (
ªÆ
Ìdu / (
globÆ_zoom_Á˘‹
 * 
PANGO_SCALE
); 
	}
}

163 
dü_f⁄t_˛ass_öô
(
DüF⁄tCœss
* 
˛ass
);

164 
dü_f⁄t_föÆize
(
GObje˘
* 
obje˘
);

165 
dü_f⁄t_öô_ö°™˚
(
DüF⁄t
*);

167 
GTy≥


168 
	$dü_f⁄t_gë_ty≥
 ()

170 
GTy≥
 
obje˘_ty≥
 = 0;

172 i‡(!
obje˘_ty≥
) {

173 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

175  (
DüF⁄tCœss
),

176 (
GBa£InôFunc
Ë
NULL
,

177 (
GBa£FöÆizeFunc
Ë
NULL
,

178 (
GCœssInôFunc
Ë
dü_f⁄t_˛ass_öô
,

179 
NULL
,

180 
NULL
,

181  (
DüF⁄t
),

183 (
GIn°™˚InôFunc
)
dü_f⁄t_öô_ö°™˚


185 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
G_TYPE_OBJECT
,

187 &
obje˘_öfo
, 0);

189  
obje˘_ty≥
;

190 
	}
}

191 
gpoöãr
 
	g∑ª¡_˛ass
;

194 
	$dü_f⁄t_˛ass_öô
(
DüF⁄tCœss
* 
kœss
)

196 
GObje˘Cœss
* 
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
(
kœss
);

197 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
(
kœss
);

198 
obje˘_˛ass
->
föÆize
 = 
dü_f⁄t_föÆize
;

199 
	}
}

202 
	$dü_f⁄t_öô_ö°™˚
(
DüF⁄t
* 
f⁄t
)

205 
	}
}

208 
	$dü_pfd_£t_height
(
P™goF⁄tDes¸ùti⁄
* 
pfd
, 
ªÆ
 
height
)

211 
	`∑ngo_f⁄t_des¸ùti⁄_£t_absﬁuã_size
(
pfd
, 
	`dcm_to_pdu
(
height
) * 0.8);

212 
	}
}

222 
	$_dü_f⁄t_adju°_size
 (
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
, 
gboﬁón
 
ªˇlc_Æwways
)

225 i‡(
f⁄t
->
height
 !heighà|| !f⁄t->
mërics
 || 
ªˇlc_Æwways
) {

226 
P™goF⁄t
 *
lﬂded
;

228 
	`dü_pfd_£t_height
 (
f⁄t
->
pfd
, 
height
);

230 
lﬂded
 = 
f⁄t
->loaded;

231 
f⁄t
->
lﬂded
 = 
	`∑ngo_c⁄ãxt_lﬂd_f⁄t
(
	`dü_f⁄t_gë_c⁄ãxt
(), f⁄t->
pfd
);

232 i‡(
lﬂded
)

233 
	`g_obje˘_uƒef
 (
lﬂded
);

234 i‡(
f⁄t
->
mërics
)

235 
	`∑ngo_f⁄t_mërics_uƒef
 (
f⁄t
->
mërics
);

238 
f⁄t
->
mërics
 = 
	`∑ngo_f⁄t_gë_mërics
 (f⁄t->
lﬂded
, 
NULL
);

239 
f⁄t
->
height
 = height;

241 
	}
}

242 
DüF⁄t
*

243 
	$dü_f⁄t_√w
(c⁄° *
Ámûy
, 
DüF⁄tStyÀ
 
°yÀ
, 
ªÆ
 
height
)

245 
DüF⁄t
* 
f⁄t
 = 
	`dü_f⁄t_√w_‰om_°yÀ
(
°yÀ
, 
height
);

246 
gboﬁón
 
ch™ged
;

248 
ch™ged
 = 
Ámûy
 !
NULL
 && 
	`°rcmp
 (
	`∑ngo_f⁄t_des¸ùti⁄_gë_Ámûy
(
f⁄t
->
pfd
), family) != 0;

249 
	`∑ngo_f⁄t_des¸ùti⁄_£t_Ámûy
(
f⁄t
->
pfd
, 
Ámûy
);

251 i‡(
ch™ged
)

252 
	`_dü_f⁄t_adju°_size
 (
f⁄t
, f⁄t->
height
, 
TRUE
);

254  
f⁄t
;

255 
	}
}

258 
	$dü_pfd_£t_Ámûy
(
P™goF⁄tDes¸ùti⁄
* 
pfd
, 
DüF⁄tFamûy
 
Ám
)

260 
Ám
) {

261 
DIA_FONT_SANS
 :

262 
	`∑ngo_f⁄t_des¸ùti⁄_£t_Ámûy
(
pfd
, "sans");

264 
DIA_FONT_SERIF
 :

265 
	`∑ngo_f⁄t_des¸ùti⁄_£t_Ámûy
(
pfd
, "serif");

267 
DIA_FONT_MONOSPACE
 :

268 
	`∑ngo_f⁄t_des¸ùti⁄_£t_Ámûy
(
pfd
, "monospace");

272 
	`∑ngo_f⁄t_des¸ùti⁄_£t_Ámûy
(
pfd
, "sans");

275 
	}
}

278 
	$dü_pfd_£t_weight
(
P™goF⁄tDes¸ùti⁄
* 
pfd
, 
DüF⁄tWeight
 
fw
)

280 
fw
) {

281 
DIA_FONT_ULTRALIGHT
 :

282 
	`∑ngo_f⁄t_des¸ùti⁄_£t_weight
(
pfd
, 
PANGO_WEIGHT_ULTRALIGHT
);

284 
DIA_FONT_LIGHT
 :

285 
	`∑ngo_f⁄t_des¸ùti⁄_£t_weight
(
pfd
, 
PANGO_WEIGHT_LIGHT
);

287 
DIA_FONT_WEIGHT_NORMAL
 :

288 
	`∑ngo_f⁄t_des¸ùti⁄_£t_weight
(
pfd
, 
PANGO_WEIGHT_NORMAL
);

290 
DIA_FONT_MEDIUM
 :

292 
	`∑ngo_f⁄t_des¸ùti⁄_£t_weight
(
pfd
, 500);

294 
DIA_FONT_DEMIBOLD
 :

295 
	`∑ngo_f⁄t_des¸ùti⁄_£t_weight
(
pfd
, 600);

297 
DIA_FONT_BOLD
 :

298 
	`∑ngo_f⁄t_des¸ùti⁄_£t_weight
(
pfd
, 
PANGO_WEIGHT_BOLD
);

300 
DIA_FONT_ULTRABOLD
 :

301 
	`∑ngo_f⁄t_des¸ùti⁄_£t_weight
(
pfd
, 
PANGO_WEIGHT_ULTRABOLD
);

303 
DIA_FONT_HEAVY
 :

304 
	`∑ngo_f⁄t_des¸ùti⁄_£t_weight
(
pfd
, 
PANGO_WEIGHT_HEAVY
);

307 
	`g_as£π_nŸ_ªached
();

309 
	}
}

312 
	$dü_pfd_£t_¶™t
(
P™goF⁄tDes¸ùti⁄
* 
pfd
, 
DüF⁄tSœ¡
 
fo
)

314 
fo
) {

315 
DIA_FONT_NORMAL
 :

316 
	`∑ngo_f⁄t_des¸ùti⁄_£t_°yÀ
(
pfd
,
PANGO_STYLE_NORMAL
);

318 
DIA_FONT_OBLIQUE
 :

319 
	`∑ngo_f⁄t_des¸ùti⁄_£t_°yÀ
(
pfd
,
PANGO_STYLE_OBLIQUE
);

321 
DIA_FONT_ITALIC
 :

322 
	`∑ngo_f⁄t_des¸ùti⁄_£t_°yÀ
(
pfd
,
PANGO_STYLE_ITALIC
);

325 
	`g_as£π_nŸ_ªached
();

327 
	}
}

329 
DüF⁄t
*

330 
	$dü_f⁄t_√w_‰om_°yÀ
(
DüF⁄tStyÀ
 
°yÀ
, 
ªÆ
 
height
)

332 
DüF⁄t
* 
ªtvÆ
;

337 
P™goF⁄tDes¸ùti⁄
* 
pfd
 = 
	`∑ngo_f⁄t_des¸ùti⁄_√w
();

338 
	`dü_pfd_£t_Ámûy
(
pfd
,
	`DIA_FONT_STYLE_GET_FAMILY
(
°yÀ
));

339 
	`dü_pfd_£t_weight
(
pfd
,
	`DIA_FONT_STYLE_GET_WEIGHT
(
°yÀ
));

340 
	`dü_pfd_£t_¶™t
(
pfd
,
	`DIA_FONT_STYLE_GET_SLANT
(
°yÀ
));

341 
	`dü_pfd_£t_height
(
pfd
,
height
);

343 
ªtvÆ
 = 
	`DIA_FONT
(
	`g_obje˘_√w
(
DIA_TYPE_FONT
, 
NULL
));

344 
ªtvÆ
->
pfd
 =Öfd;

345 
	`_dü_f⁄t_adju°_size
 (
ªtvÆ
, 
height
, 
FALSE
);

346 
ªtvÆ
->
Àgacy_«me
 = 
NULL
;

347  
ªtvÆ
;

348 
	}
}

350 
DüF⁄t
* 
	$dü_f⁄t_c›y
(c⁄° 
DüF⁄t
* 
f⁄t
)

352 i‡(!
f⁄t
)

353  
NULL
;

354  
	`dü_f⁄t_√w
(
	`dü_f⁄t_gë_Ámûy
(
f⁄t
),

355 
	`dü_f⁄t_gë_°yÀ
(
f⁄t
),

356 
	`dü_f⁄t_gë_height
(
f⁄t
));

357 
	}
}

360 
	$dü_f⁄t_föÆize
(
GObje˘
* 
obje˘
)

362 
DüF⁄t
* 
f⁄t
 = 
	`DIA_FONT
(
obje˘
);

364 i‡(
f⁄t
->
pfd
)

365 
	`∑ngo_f⁄t_des¸ùti⁄_‰ì
(
f⁄t
->
pfd
);

366 
f⁄t
->
pfd
 = 
NULL
;

367 i‡(
f⁄t
->
mërics
)

368 
	`∑ngo_f⁄t_mërics_uƒef
(
f⁄t
->
mërics
);

369 
f⁄t
->
mërics
 = 
NULL
;

370 i‡(
f⁄t
->
lﬂded
)

371 
	`g_obje˘_uƒef
(
f⁄t
->
lﬂded
);

372 
f⁄t
->
lﬂded
 = 
NULL
;

373 
	`G_OBJECT_CLASS
(
∑ª¡_˛ass
)->
	`föÆize
(
obje˘
);

374 
	}
}

376 
DüF⁄t
 *

377 
	$dü_f⁄t_ªf
(
DüF⁄t
* 
f⁄t
)

379 
	`g_obje˘_ªf
(
	`G_OBJECT
(
f⁄t
));

380  
f⁄t
;

381 
	}
}

384 
	$dü_f⁄t_uƒef
(
DüF⁄t
* 
f⁄t
)

386 
	`g_obje˘_uƒef
(
	`G_OBJECT
(
f⁄t
));

387 
	}
}

389 
DüF⁄tStyÀ


390 
	$dü_f⁄t_gë_°yÀ
(c⁄° 
DüF⁄t
* 
f⁄t
)

392 
guöt
 
°yÀ
;

394 
weight_m≠
[] = {

395 
DIA_FONT_ULTRALIGHT
, 
DIA_FONT_LIGHT
,

396 
DIA_FONT_WEIGHT_NORMAL
,

397 
DIA_FONT_MEDIUM
, 
DIA_FONT_DEMIBOLD
,

398 
DIA_FONT_BOLD
, 
DIA_FONT_ULTRABOLD
, 
DIA_FONT_HEAVY


401 
P™goStyÀ
 
∑ngo_°yÀ
 = 
	`∑ngo_f⁄t_des¸ùti⁄_gë_°yÀ
(
f⁄t
->
pfd
);

402 
P™goWeight
 
∑ngo_weight
 = 
	`∑ngo_f⁄t_des¸ùti⁄_gë_weight
(
f⁄t
->
pfd
);

404 
	`g_as£π
(
PANGO_WEIGHT_ULTRALIGHT
 <
∑ngo_weight
 &&Ö™go_weighà<
PANGO_WEIGHT_HEAVY
);

405 
	`g_as£π
(
PANGO_WEIGHT_ULTRALIGHT
 == 200);

406 
	`g_as£π
(
PANGO_WEIGHT_NORMAL
 == 400);

407 
	`g_as£π
(
PANGO_WEIGHT_BOLD
 == 700);

409 
°yÀ
 = 
weight_m≠
[(
∑ngo_weight
 - 
PANGO_WEIGHT_ULTRALIGHT
) / 100];

410 
°yÀ
 |(
∑ngo_°yÀ
 << 2);

412  
°yÀ
;

413 
	}
}

415 
G_CONST_RETURN
 *

416 
	$dü_f⁄t_gë_Ámûy
(c⁄° 
DüF⁄t
* 
f⁄t
)

418  
	`∑ngo_f⁄t_des¸ùti⁄_gë_Ámûy
(
f⁄t
->
pfd
);

419 
	}
}

421 
G_CONST_RETURN
 
P™goF⁄tDes¸ùti⁄
 *

422 
	$dü_f⁄t_gë_des¸ùti⁄
(c⁄° 
DüF⁄t
* 
f⁄t
)

424  
f⁄t
->
pfd
;

425 
	}
}

427 
ªÆ


428 
	$dü_f⁄t_gë_height
(c⁄° 
DüF⁄t
* 
f⁄t
)

430  
f⁄t
->
height
;

431 
	}
}

433 
ªÆ


434 
	$dü_f⁄t_gë_size
(c⁄° 
DüF⁄t
* 
f⁄t
)

436 i‡(!
	`∑ngo_f⁄t_des¸ùti⁄_gë_size_is_absﬁuã
 (
f⁄t
->
pfd
))

437 
	`g_w¨nög
 ("dia_font_get_size() :Çoábsolute size");

438  
	`pdu_to_dcm
(
	`∑ngo_f⁄t_des¸ùti⁄_gë_size
(
f⁄t
->
pfd
));

439 
	}
}

442 
	$dü_f⁄t_£t_height
(
DüF⁄t
* 
f⁄t
, 
ªÆ
 
height
)

444 
	`_dü_f⁄t_adju°_size
 (
f⁄t
, 
height
, 
FALSE
);

445 
	}
}

448 
G_CONST_RETURN
 *

449 
	$dü_f⁄t_gë_psf⁄äame
(c⁄° 
DüF⁄t
 *
f⁄t
)

454 c⁄° *
f⁄äame
 = 
	`dü_f⁄t_gë_Àgacy_«me
(
f⁄t
);

456 i‡(!
f⁄äame
)

457  
NULL
;

459 i‡(
	`°rcmp
(
f⁄äame
, "NewCenturySchoolbook-Roman") == 0)

461 i‡(
	`°rcmp
(
f⁄äame
, "NewCenturySchoolbook-Italic") == 0)

463 i‡(
	`°rcmp
(
f⁄äame
, "NewCenturySchoolbook-Bold") == 0)

465 i‡(
	`°rcmp
(
f⁄äame
, "NewCenturySchoolbook-BoldItalic") == 0)

468  
f⁄äame
;

469 
	}
}

472 
	$dü_f⁄t_£t_™y_Ámûy
(
DüF⁄t
* 
f⁄t
, c⁄° * 
Ámûy
)

474 
gboﬁón
 
ch™ged
;

476 
	`g_ªtu∫_if_Áû
(
f⁄t
 !
NULL
);

478 
ch™ged
 = 
	`°rcmp
 (
	`∑ngo_f⁄t_des¸ùti⁄_gë_Ámûy
(
f⁄t
->
pfd
), 
Ámûy
) != 0;

479 
	`∑ngo_f⁄t_des¸ùti⁄_£t_Ámûy
(
f⁄t
->
pfd
, 
Ámûy
);

480 i‡(
ch™ged
)

481 
	`_dü_f⁄t_adju°_size
 (
f⁄t
, f⁄t->
height
, 
TRUE
);

482 i‡(
f⁄t
->
Àgacy_«me
) {

483 
	`g_‰ì
(
f⁄t
->
Àgacy_«me
);

484 
f⁄t
->
Àgacy_«me
 = 
NULL
;

486 
	}
}

489 
	$dü_f⁄t_£t_Ámûy
(
DüF⁄t
* 
f⁄t
, 
DüF⁄tFamûy
 
Ámûy
)

491 
	`g_ªtu∫_if_Áû
(
f⁄t
 !
NULL
);

493 
	`dü_pfd_£t_Ámûy
(
f⁄t
->
pfd
,
Ámûy
);

494 i‡(
f⁄t
->
Àgacy_«me
) {

495 
	`g_‰ì
(
f⁄t
->
Àgacy_«me
);

496 
f⁄t
->
Àgacy_«me
 = 
NULL
;

498 
	}
}

501 
	$dü_f⁄t_£t_weight
(
DüF⁄t
* 
f⁄t
, 
DüF⁄tWeight
 
weight
)

503 
DüF⁄tWeight
 
ﬁd_weight
 = 
	`DIA_FONT_STYLE_GET_WEIGHT
(
	`dü_f⁄t_gë_°yÀ
(
f⁄t
));

504 
	`g_ªtu∫_if_Áû
(
f⁄t
 !
NULL
);

505 
	`dü_pfd_£t_weight
(
f⁄t
->
pfd
,
weight
);

506 i‡(
ﬁd_weight
 !
weight
)

507 
	`_dü_f⁄t_adju°_size
 (
f⁄t
, f⁄t->
height
, 
TRUE
);

508 
	}
}

511 
	$dü_f⁄t_£t_¶™t
(
DüF⁄t
* 
f⁄t
, 
DüF⁄tSœ¡
 
¶™t
)

513 
DüF⁄tSœ¡
 
ﬁd_¶™t
 = 
	`DIA_FONT_STYLE_GET_SLANT
(
	`dü_f⁄t_gë_°yÀ
(
f⁄t
));

514 
	`g_ªtu∫_if_Áû
(
f⁄t
 !
NULL
);

515 
	`dü_pfd_£t_¶™t
(
f⁄t
->
pfd
,
¶™t
);

516 i‡(
¶™t
 !
ﬁd_¶™t
)

517 
	`_dü_f⁄t_adju°_size
 (
f⁄t
, f⁄t->
height
, 
TRUE
);

518 
	}
}

521 
	s_WeightName
 {

522 
DüF⁄tWeight
 
	mfw
;

523 c⁄° *
	m«me
;

524 } 
	tWeightName
;

525 c⁄° 
WeightName
 
	gweight_«mes
[] = {

526 {
DIA_FONT_ULTRALIGHT
, "200"},

527 {
DIA_FONT_LIGHT
,"300"},

528 {
DIA_FONT_WEIGHT_NORMAL
,"normal"},

529 {
DIA_FONT_WEIGHT_NORMAL
,"400"},

530 {
DIA_FONT_MEDIUM
, "500"},

531 {
DIA_FONT_DEMIBOLD
, "600"},

532 {
DIA_FONT_BOLD
, "700"},

533 {
DIA_FONT_ULTRABOLD
, "800"},

534 {
DIA_FONT_HEAVY
, "900"},

535 {0,
NULL
}

538 
G_CONST_RETURN
 *

539 
	$dü_f⁄t_gë_weight_°rög
(c⁄° 
DüF⁄t
* 
f⁄t
)

541 c⁄° 
WeightName
* 
p
;

542 
DüF⁄tWeight
 
fw
 = 
	`DIA_FONT_STYLE_GET_WEIGHT
(
	`dü_f⁄t_gë_°yÀ
(
f⁄t
));

544 
p
 = 
weight_«mes
;Ö->
«me
 !
NULL
; ++p) {

545 i‡(
p
->
fw
 =fwËÖ->
«me
;

548 
	}
}

551 
	$dü_f⁄t_£t_weight_‰om_°rög
(
DüF⁄t
* 
f⁄t
, c⁄° * 
weight
)

553 
DüF⁄tWeight
 
fw
 = 
DIA_FONT_WEIGHT_NORMAL
;

554 c⁄° 
WeightName
* 
p
;

556 
p
 = 
weight_«mes
;Ö->
«me
 !
NULL
; ++p) {

557 i‡(0 =
	`°∫cmp
(
weight
,
p
->
«me
,8)) {

558 
fw
 = 
p
->fw;

563 
	`dü_f⁄t_£t_weight
(
f⁄t
,
fw
);

564 
	}
}

567 
	s_Sœ¡Name
 {

568 
DüF⁄tSœ¡
 
	mfo
;

569 c⁄° *
	m«me
;

570 } 
	tSœ¡Name
;

571 c⁄° 
Sœ¡Name
 
	g¶™t_«mes
[] = {

572 { 
DIA_FONT_NORMAL
, "normal" },

573 { 
DIA_FONT_OBLIQUE
, "oblique" },

574 { 
DIA_FONT_ITALIC
, "italic" },

575 { 0, 
NULL
}

578 
G_CONST_RETURN
 *

579 
	$dü_f⁄t_gë_¶™t_°rög
(c⁄° 
DüF⁄t
* 
f⁄t
)

581 c⁄° 
Sœ¡Name
* 
p
;

582 
DüF⁄tSœ¡
 
fo
 =

583 
	`DIA_FONT_STYLE_GET_SLANT
(
	`dü_f⁄t_gë_°yÀ
(
f⁄t
));

585 
p
 = 
¶™t_«mes
;Ö->
«me
 !
NULL
; ++p) {

586 i‡(
p
->
fo
 == fo)

587  
p
->
«me
;

590 
	}
}

593 
	$dü_f⁄t_£t_¶™t_‰om_°rög
(
DüF⁄t
* 
f⁄t
, c⁄° * 
obli
)

595 
DüF⁄tSœ¡
 
fo
 = 
DIA_FONT_NORMAL
;

596 c⁄° 
Sœ¡Name
* 
p
;

598 
DüF⁄tStyÀ
 
ﬁd_°yÀ
;

599 
DüF⁄tSœ¡
 
ﬁd_fo
;

600 
ﬁd_°yÀ
 = 
	`dü_f⁄t_gë_°yÀ
(
f⁄t
);

601 
ﬁd_fo
 = 
	`DIA_FONT_STYLE_GET_SLANT
(
ﬁd_°yÀ
);

603 
p
 = 
¶™t_«mes
;Ö->
«me
 !
NULL
; ++p) {

604 i‡(0 =
	`°∫cmp
(
obli
,
p
->
«me
,8)) {

605 
fo
 = 
p
->fo;

609 
	`dü_f⁄t_£t_¶™t
(
f⁄t
,
fo
);

610 
	}
}

617 
ªÆ


618 
	$dü_f⁄t_°rög_width
(c⁄° * 
°rög
, 
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
)

620 
ªÆ
 
ªsu…
 = 0;

621 i‡(
°rög
 && *string) {

622 
TextLöe
 *
ãxt_löe
 = 
	`ãxt_löe_√w
(
°rög
, 
f⁄t
, 
height
);

623 
ªsu…
 = 
	`ãxt_löe_gë_width
(
ãxt_löe
);

624 
	`ãxt_löe_de°roy
(
ãxt_löe
);

626  
ªsu…
;

627 
	}
}

629 
ªÆ


630 
	$dü_f⁄t_as˚¡
(c⁄° * 
°rög
, 
DüF⁄t
* 
f⁄t
, 
ªÆ
 
height
)

632 i‡(
f⁄t
->
mërics
) {

633 
ªÆ
 
as˚¡
 = 
	`pdu_to_dcm
(
	`∑ngo_f⁄t_mërics_gë_as˚¡
 (
f⁄t
->
mërics
));

634  
as˚¡
 * (
height
 / 
f⁄t
->height);

637 
TextLöe
 *
ãxt_löe
 = 
	`ãxt_löe_√w
(
°rög
, 
f⁄t
, 
height
);

638 
ªÆ
 
ªsu…
 = 
	`ãxt_löe_gë_as˚¡
(
ãxt_löe
);

639 
	`ãxt_löe_de°roy
(
ãxt_löe
);

640  
ªsu…
;

642 
	}
}

644 
ªÆ


645 
	$dü_f⁄t_des˚¡
(c⁄° * 
°rög
, 
DüF⁄t
* 
f⁄t
, 
ªÆ
 
height
)

647 i‡(
f⁄t
->
mërics
) {

648 
ªÆ
 
des˚¡
 = 
	`pdu_to_dcm
(
	`∑ngo_f⁄t_mërics_gë_des˚¡
 (
f⁄t
->
mërics
));

649  
des˚¡
 * (
height
 / 
f⁄t
->height);

652 
TextLöe
 *
ãxt_löe
 = 
	`ãxt_löe_√w
(
°rög
, 
f⁄t
, 
height
);

653 
ªÆ
 
ªsu…
 = 
	`ãxt_löe_gë_des˚¡
(
ãxt_löe
);

654 
	`ãxt_löe_de°roy
(
ãxt_löe
);

655  
ªsu…
;

657 
	}
}

660 
P™goLayout
*

661 
	$dü_f⁄t_buûd_œyout
(c⁄° * 
°rög
, 
DüF⁄t
* 
f⁄t
, 
ªÆ
 
height
)

663 
P™goLayout
* 
œyout
;

664 
P™goAârLi°
* 
li°
;

665 
P™goAâribuã
* 
©å
;

666 
guöt
 
Àngth
;

667 
P™goF⁄tDes¸ùti⁄
 *
pfd
;

668 
ªÆ
 
Á˘‹
;

670 
œyout
 = 
	`∑ngo_œyout_√w
(
	`dü_f⁄t_gë_c⁄ãxt
());

672 
Àngth
 = 
°rög
 ? 
	`°æí
(string) : 0;

673 
	`∑ngo_œyout_£t_ãxt
(
œyout
, 
°rög
, 
Àngth
);

675 
li°
 = 
	`∑ngo_©å_li°_√w
();

677 
pfd
 = 
	`∑ngo_f⁄t_des¸ùti⁄_c›y
 (
f⁄t
->pfd);

679 
Á˘‹
 = 
	`dü_f⁄t_gë_size
(
f⁄t
Ë/ 
	`dü_f⁄t_gë_height
 (font);

680 
	`∑ngo_f⁄t_des¸ùti⁄_£t_absﬁuã_size
 (
pfd
, 
	`dcm_to_pdu
 (
height
Ë* 
Á˘‹
);

681 
©å
 = 
	`∑ngo_©å_f⁄t_desc_√w
(
pfd
);

682 
	`∑ngo_f⁄t_des¸ùti⁄_‰ì
 (
pfd
);

684 
©å
->
°¨t_ödex
 = 0;

685 
©å
->
íd_ödex
 = 
Àngth
;

686 
	`∑ngo_©å_li°_ö£π
(
li°
,
©å
);

688 
	`∑ngo_œyout_£t_©åibuãs
(
œyout
,
li°
);

689 
	`∑ngo_©å_li°_uƒef
(
li°
);

691 
	`∑ngo_œyout_£t_ödít
(
œyout
,0);

692 
	`∑ngo_œyout_£t_ju°ify
(
œyout
,
FALSE
);

693 
	`∑ngo_œyout_£t_Æignmít
(
œyout
,
PANGO_ALIGN_LEFT
);

695  
œyout
;

696 
	}
}

706 
	$gë_°rög_off£ts
(
P™goLayoutIãr
 *
ôî
, 
ªÆ
** 
off£ts
, * 
n_off£ts
)

708 
i
;

709 
P™goLayoutLöe
* 
löe
 = 
	`∑ngo_œyout_ôî_gë_löe
(
ôî
);

710 
P™goGlyphIãm
* 
ôem
;

711 
P™goGlyphSåög
* 
°rög
;

713 if(0 =
löe
->
Àngth
)

715 *
n_off£ts
 = 0;

718 
ôem
 = (
P™goGlyphIãm
*)
löe
->
runs
->
d©a
;

719 
°rög
 = 
ôem
->
glyphs
;

721 *
n_off£ts
 = 
°rög
->
num_glyphs
;

722 *
off£ts
 = 
	`g_√w
(
ªÆ
, *
n_off£ts
);

724 
i
 = 0; i < 
°rög
->
num_glyphs
; i++) {

725 
P™goGlyphGeomëry
 
geom
 = 
°rög
->
glyphs
[
i
].
geomëry
;

727 (*
off£ts
)[
i
] = 
	`pdu_to_dcm
(
geom
.
width
Ë/ 
globÆ_zoom_Á˘‹
;

729 
	}
}

734 
	$gë_œyout_off£ts
(
P™goLayoutLöe
 *
löe
, P™goLayoutLöê**
œyout_löe
)

737 
GSLi°
 *
œyout_runs
 = 
NULL
;

738 
GSLi°
 *
runs
 = 
löe
->runs;

740 *
œyout_löe
 = 
	`g_√w0
(
P™goLayoutLöe
, 1);

748 ; 
runs
 !
NULL
;Ñun†
	`g_¶i°_√xt
(runs)) {

749 
P™goGlyphIãm
 *
run
 = (P™goGlyphIãm *Ë
runs
->
d©a
;

750 
P™goGlyphIãm
 *
œyout_run
 = 
	`g_√w0
(PangoGlyphItem, 1);

751 
j
;

753 
P™goGlyphSåög
 *
glyph_°rög
 = 
run
->
glyphs
;

754 
P™goGlyphSåög
 *
œyout_glyph_°rög
;

756 
œyout_run
->
glyphs
 = 
	`g_√w0
(
P™goGlyphSåög
, 1);

757 
œyout_glyph_°rög
 = 
œyout_run
->
glyphs
;

759 
œyout_glyph_°rög
->
num_glyphs
 = 
glyph_°rög
->num_glyphs;

760 
œyout_glyph_°rög
->
glyphs
 =

761 
	`g_√w0
(
P™goGlyphInfo
, 
glyph_°rög
->
num_glyphs
);

762 
j
 = 0; j < 
œyout_glyph_°rög
->
num_glyphs
; j++) {

763 
P™goGlyphInfo
 *
öfo
 = &
glyph_°rög
->
glyphs
[
j
];

764 
P™goGlyphInfo
 *
œyout_öfo
 = &
œyout_glyph_°rög
->
glyphs
[
j
];

765 
œyout_öfo
->
geomëry
.
width
 = 
öfo
->geometry.width;

766 
œyout_öfo
->
geomëry
.
x_off£t
 = 
öfo
->geometry.x_offset;

767 
œyout_öfo
->
geomëry
.
y_off£t
 = 
öfo
->geometry.y_offset;

769 
œyout_runs
 = 
	`g_¶i°_≠≥nd
÷ayout_runs, 
œyout_run
);

771 (*
œyout_löe
)->
runs
 = 
œyout_runs
;

772 
	}
}

778 
ªÆ
*

779 
	$dü_f⁄t_gë_sizes
(c⁄° * 
°rög
, 
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
,

780 
ªÆ
 *
width
,Ñó»*
as˚¡
,Ñó»*
des˚¡
, *
n_off£ts
,

781 
P™goLayoutLöe
 **
œyout_off£ts
)

783 
P™goLayout
* 
œyout
;

784 
P™goLayoutIãr
* 
ôî
;

785 
ªÆ
 
t›
, 
blöe
, 
bŸtom
;

786 c⁄° 
gch¨
* 
n⁄_em±y_°rög
;

787 
P™goRe˘™gÀ
 
ök_ª˘
,
logiˇl_ª˘
;

788 
ªÆ
* 
off£ts
 = 
NULL
;

791 i‡(
°rög
 =
NULL
 || string[0] == '\0') {

792 
n⁄_em±y_°rög
 = "XjgM149";

794 
n⁄_em±y_°rög
 = 
°rög
;

796 
œyout
 = 
	`dü_f⁄t_buûd_œyout
(
n⁄_em±y_°rög
, 
f⁄t
, 
height
 * 
globÆ_zoom_Á˘‹
);

799 
ôî
 = 
	`∑ngo_œyout_gë_ôî
(
œyout
);

801 
	`∑ngo_œyout_ôî_gë_löe_exã¡s
(
ôî
, &
ök_ª˘
, &
logiˇl_ª˘
);

803 
t›
 = 
	`pdu_to_dcm
(
logiˇl_ª˘
.
y
Ë/ 
globÆ_zoom_Á˘‹
;

804 
bŸtom
 = 
	`pdu_to_dcm
(
logiˇl_ª˘
.
y
 +Üogiˇl_ª˘.
height
Ë/ 
globÆ_zoom_Á˘‹
;

805 
blöe
 = 
	`pdu_to_dcm
(
	`∑ngo_œyout_ôî_gë_ba£löe
(
ôî
)Ë/ 
globÆ_zoom_Á˘‹
;

807 
	`gë_°rög_off£ts
(
ôî
, &
off£ts
, 
n_off£ts
);

808 
	`gë_œyout_off£ts
(
	`∑ngo_œyout_gë_löe
(
œyout
, 0), 
œyout_off£ts
);

812 
	`∑ngo_œyout_ôî_√xt_löe
 (
ôî
)) {

813 
P™goRe˘™gÀ
 
m‹e_ök_ª˘
, 
m‹e_logiˇl_ª˘
;

815 
	`∑ngo_œyout_ôî_gë_löe_exã¡s
(
ôî
, &
m‹e_ök_ª˘
, &
m‹e_logiˇl_ª˘
);

816 i‡(
m‹e_logiˇl_ª˘
.
width
 > 
logiˇl_ª˘
.width)

817 
logiˇl_ª˘
.
width
 = 
m‹e_logiˇl_ª˘
.width;

819 i‡(
m‹e_ök_ª˘
.
width
 > 
ök_ª˘
.width)

820 
ök_ª˘
.
width
 = 
m‹e_ök_ª˘
.width;

823 
	`∑ngo_œyout_ôî_‰ì
(
ôî
);

824 
	`g_obje˘_uƒef
(
	`G_OBJECT
(
œyout
));

826 *
as˚¡
 = 
blöe
-
t›
;

827 *
des˚¡
 = 
bŸtom
-
blöe
;

828 i‡(
n⁄_em±y_°rög
 !
°rög
) {

829 *
width
 = 0.0;

832 *
width
 = 
	`pdu_to_dcm
(
logiˇl_ª˘
.width > 
ök_ª˘
.width ?Üogiˇl_ª˘.width : ink_ª˘.widthË/ 
globÆ_zoom_Á˘‹
;

834  
off£ts
;

835 
	}
}

855 
	s_Àgacy_f⁄t
 {

856 
gch¨
* 
	mﬁd«me
;

857 
gch¨
* 
	m√w«me
;

858 
DüF⁄tStyÀ
 
	m°yÀ
;

859 } 
	gÀgacy_f⁄ts
[] = {

860 { "Av™tG¨de-Book", "Av™tG¨de", 
DIA_FONT_SERIF
 },

861 { "Av™tG¨de-BookOblique", "Av™tG¨de", 
DIA_FONT_SERIF
 | 
DIA_FONT_OBLIQUE
 },

862 { "Av™tG¨de-Demi", "Av™tG¨de", 
DIA_FONT_SERIF
 | 
DIA_FONT_DEMIBOLD
 },

863 { "Av™tG¨de-DemiOblique", "Av™tG¨de", 
DIA_FONT_SERIF
 | 
DIA_FONT_OBLIQUE
 | 
DIA_FONT_DEMIBOLD
 },

864 { "B©™g", "B©™g", 
DIA_FONT_FAMILY_ANY
 },

865 { "Bookm™-Demi", "Bookm™ Old StyÀ", 
DIA_FONT_SERIF
 | 
DIA_FONT_DEMIBOLD
 },

866 { "Bookm™-DemiIèlic", "Bookm™ Old StyÀ", 
DIA_FONT_SERIF
 | 
DIA_FONT_DEMIBOLD
 | 
DIA_FONT_ITALIC
 },

867 { "Bookm™-Light", "Bookm™ Old StyÀ", 
DIA_FONT_SERIF
 | 
DIA_FONT_LIGHT
 },

868 { "Bookm™-LightIèlic", "Bookm™ Old StyÀ", 
DIA_FONT_SERIF
 | 
DIA_FONT_LIGHT
 | 
DIA_FONT_ITALIC
 },

869 { "BousungEG-Light-GB", "BousungEG-Light-GB", 
DIA_FONT_FAMILY_ANY
 },

870 { "Courõr", "m⁄o•a˚", 
DIA_FONT_MONOSPACE
 },

871 { "Courõr", "Courõ∏New", 
DIA_FONT_MONOSPACE
 },

872 { "Courõr-Bﬁd", "m⁄o•a˚", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_BOLD
 },

873 { "Courõr-Bﬁd", "Courõ∏New", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_BOLD
 },

874 { "Courõr-BﬁdOblique", "m⁄o•a˚", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
 | 
DIA_FONT_BOLD
 },

875 { "Courõr-BﬁdOblique", "Courõ∏New", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
 | 
DIA_FONT_BOLD
 },

876 { "Courõr-Oblique", "m⁄o•a˚", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
},

877 { "Courõr-Oblique", "Courõ∏New", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
 },

878 { "DŸum", "DŸum", 
DIA_FONT_FAMILY_ANY
 },

879 { "GBZíKai-Medium", "GBZíKai-Medium", 
DIA_FONT_FAMILY_ANY
 },

880 { "GŸhicBBB-Medium", "GŸhicBBB-Medium", 
DIA_FONT_FAMILY_ANY
 },

881 { "Gulim", "Gulim", 
DIA_FONT_FAMILY_ANY
 },

882 { "Hódlöe", "Hódlöe", 
DIA_FONT_FAMILY_ANY
 },

883 { "Hñvëiˇ", "ßns", 
DIA_FONT_SANS
 },

884 { "Hñvëiˇ", "Arül", 
DIA_FONT_SANS
 },

885 { "Hñvëiˇ-Bﬁd", "ßns", 
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
 },

886 { "Hñvëiˇ-Bﬁd", "Arül", 
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
 },

887 { "Hñvëiˇ-BﬁdOblique", "ßns", 
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
 | 
DIA_FONT_ITALIC
 },

888 { "Hñvëiˇ-BﬁdOblique", "Arül", 
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
 | 
DIA_FONT_ITALIC
 },

889 { "Hñvëiˇ-N¨row", "Arü»N¨row", 
DIA_FONT_SANS
 | 
DIA_FONT_MEDIUM
 },

890 { "Hñvëiˇ-N¨row-Bﬁd", "Arü»N¨row", 
DIA_FONT_SANS
 | 
DIA_FONT_DEMIBOLD
 },

891 { "Hñvëiˇ-N¨row-BﬁdOblique", "Arü»N¨row", 
DIA_FONT_SANS
 | 
DIA_FONT_MEDIUM
 | 
DIA_FONT_OBLIQUE
 },

892 { "Hñvëiˇ-N¨row-Oblique", "Arü»N¨row", 
DIA_FONT_SANS
 | 
DIA_FONT_MEDIUM
 | 
DIA_FONT_OBLIQUE
 },

893 { "Hñvëiˇ-Oblique", "ßns", 
DIA_FONT_SANS
 | 
DIA_FONT_ITALIC
 },

894 { "Hñvëiˇ-Oblique", "Arül", 
DIA_FONT_SANS
 | 
DIA_FONT_ITALIC
 },

895 { "MOESung-Medium", "MOESung-Medium", 
DIA_FONT_FAMILY_ANY
 },

896 { "NewCíturySchoﬁbook-Bﬁd", "Cítury Schoﬁbook SWA", 
DIA_FONT_SERIF
 | 
DIA_FONT_BOLD
 },

897 { "NewCíturySchoﬁbook-BﬁdIèlic", "Cítury Schoﬁbook SWA", 
DIA_FONT_SERIF
 | 
DIA_FONT_BOLD
 | 
DIA_FONT_ITALIC
 },

898 { "NewCíturySchoﬁbook-Ièlic", "Cítury Schoﬁbook SWA", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 },

899 { "NewCíturySchoﬁbook-Rom™", "Cítury Schoﬁbook SWA", 
DIA_FONT_SERIF
 },

900 { "PÆ©öo-Bﬁd", "PÆ©öo", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_BOLD
 },

901 { "PÆ©öo-BﬁdIèlic", "PÆ©öo", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_BOLD
 | 
DIA_FONT_ITALIC
 },

902 { "PÆ©öo-Ièlic", "PÆ©öo", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_ITALIC
 },

903 { "PÆ©öo-Rom™", "PÆ©öo", 
DIA_FONT_FAMILY_ANY
 },

904 { "Ryumö-Light", "Ryumö", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_LIGHT
 },

905 { "Sh™HeiSun-Light", "Sh™HeiSun", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_LIGHT
 },

906 { "S⁄g-Medium", "S⁄g-Medium", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_MEDIUM
 },

907 { "Symbﬁ", "Symbﬁ", 
DIA_FONT_SANS
 | 
DIA_FONT_MEDIUM
 },

908 { "Times-Bﬁd", "£rif", 
DIA_FONT_SERIF
 | 
DIA_FONT_BOLD
 },

909 { "Times-Bﬁd", "Time†New Rom™", 
DIA_FONT_SERIF
 | 
DIA_FONT_BOLD
 },

910 { "Times-BﬁdIèlic", "£rif", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 | 
DIA_FONT_BOLD
 },

911 { "Times-BﬁdIèlic", "Time†New Rom™", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 | 
DIA_FONT_BOLD
 },

912 { "Times-Ièlic", "£rif", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 },

913 { "Times-Ièlic", "Time†New Rom™", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 },

914 { "Times-Rom™", "£rif", 
DIA_FONT_SERIF
 },

915 { "Times-Rom™", "Time†New Rom™", 
DIA_FONT_SERIF
 },

916 { "Z≠fCh™˚ry-MediumIèlic", "Z≠‡CÆligøphi¯801 SWA", 
DIA_FONT_SERIF
 | 
DIA_FONT_MEDIUM
 },

917 { "Z≠fDögb©s", "Z≠‡CÆligøphi¯801 SWA", 
DIA_FONT_SERIF
 },

918 { "ZíKai-Medium", "ZíKai", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_MEDIUM
 },

926 
DüF⁄t
*

927 
	$dü_f⁄t_√w_‰om_Àgacy_«me
(c⁄° * 
«me
)

930 
DüF⁄t
* 
ªtvÆ
;

931 
_Àgacy_f⁄t
* 
found
 = 
NULL
;

932 
ªÆ
 
height
 = 1.0;

933 
i
;

935 
i
 = 0; i < 
	`G_N_ELEMENTS
(
Àgacy_f⁄ts
); i++) {

936 i‡(!
	`°rcmp
(
«me
, 
Àgacy_f⁄ts
[
i
].
ﬁd«me
)) {

937 
found
 = &
Àgacy_f⁄ts
[
i
];

941 i‡(
found
) {

942 
ªtvÆ
 = 
	`dü_f⁄t_√w
 (
found
->
√w«me
, found->
°yÀ
, 
height
);

943 
ªtvÆ
->
Àgacy_«me
 = 
found
->
ﬁd«me
;

946 
ªtvÆ
 = 
	`dü_f⁄t_√w
 (
«me
, 
DIA_FONT_WEIGHT_NORMAL
, 
height
);

947 
ªtvÆ
->
Àgacy_«me
 = 
NULL
;

950  
ªtvÆ
;

951 
	}
}

953 
G_CONST_RETURN
 *

954 
	$dü_f⁄t_gë_Àgacy_«me
(c⁄° 
DüF⁄t
 *
f⁄t
)

956 c⁄° * 
m©ched_«me
 = 
NULL
;

957 c⁄° * 
Ámûy
;

958 
DüF⁄tStyÀ
 
°yÀ
;

959 
i
;

962 i‡(
f⁄t
->
Àgacy_«me
)

963  
f⁄t
->
Àgacy_«me
;

965 
Ámûy
 = 
	`dü_f⁄t_gë_Ámûy
 (
f⁄t
);

966 
°yÀ
 = 
	`dü_f⁄t_gë_°yÀ
 (
f⁄t
);

967 
i
 = 0; i < 
	`G_N_ELEMENTS
(
Àgacy_f⁄ts
); i++) {

968 i‡(0 =
	`g_ascii_°rˇ£cmp
 (
Àgacy_f⁄ts
[
i
].
√w«me
, 
Ámûy
)) {

970 
DüF⁄tStyÀ
 
°
 = 
Àgacy_f⁄ts
[
i
].
°yÀ
;

971 i‡((
	`DIA_FONT_STYLE_GET_SLANT
(
°yÀ
Ë| 
	`DIA_FONT_STYLE_GET_WEIGHT
(style))

972 =(
	`DIA_FONT_STYLE_GET_SLANT
(
°
Ë| 
	`DIA_FONT_STYLE_GET_WEIGHT
(st))) {

973  
Àgacy_f⁄ts
[
i
].
ﬁd«me
;

974 } i‡(0 =(
	`DIA_FONT_STYLE_GET_SLANT
(
°
Ë| 
	`DIA_FONT_STYLE_GET_WEIGHT
(st))) {

975 
m©ched_«me
 = 
Àgacy_f⁄ts
[
i
].
ﬁd«me
;

980  
m©ched_«me
 ? matched_name : "Courier";

981 
	}
}

	@O:\tool\dvs50\lib\font.h

18 #i‚de‡
FONT_H


19 
	#FONT_H


	)

21 
	~"düty≥s.h
"

22 
	~<glib.h
>

23 
	~<glib-obje˘.h
>

24 
	~<∑ngo/∑ngo.h
>

25 
	~"dü-íums.h
"

26 
	~"geomëry.h
"

28 
	gG_BEGIN_DECLS


32 
	#BASIC_SANS_FONT
 "¨ül, hñvëiˇ, hñv, s™s"

	)

33 
	#BASIC_SERIF_FONT
 "time†√wÑom™,Åimes, sîif"

	)

34 
	#BASIC_MONOSPACE_FONT
 "courõ∏√w, courõr, m⁄o•a˚, fixed"

	)

54 
guöt
 
	tDüF⁄tStyÀ
;

58 
	mDIA_FONT_FAMILY_ANY
 = 0,

59 
	mDIA_FONT_SANS
 = 1,

60 
	mDIA_FONT_SERIF
 = 2,

61 
	mDIA_FONT_MONOSPACE
 = 3

62 } 
	tDüF⁄tFamûy
;

66 
	mDIA_FONT_NORMAL
 = (0<<2),

67 
	mDIA_FONT_OBLIQUE
 = (1<<2),

68 
	mDIA_FONT_ITALIC
 = (2<<2)

69 } 
	tDüF⁄tSœ¡
;

73 
	mDIA_FONT_ULTRALIGHT
 = (1<<4),

74 
	mDIA_FONT_LIGHT
 = (2<<4),

75 
	mDIA_FONT_WEIGHT_NORMAL
 = (0<<4),

76 
	mDIA_FONT_MEDIUM
 = (3<<4),

77 
	mDIA_FONT_DEMIBOLD
 = (4<<4),

78 
	mDIA_FONT_BOLD
 = (5<<4),

79 
	mDIA_FONT_ULTRABOLD
 = (6<<4),

80 
	mDIA_FONT_HEAVY
 = (7<<4)

81 } 
	tDüF⁄tWeight
;

84 
	#DIA_FONT_STYLE_GET_FAMILY
(
°
Ë((°Ë& (0x3))

	)

85 
	#DIA_FONT_STYLE_GET_SLANT
(
°
Ë((°Ë& (0x3<<2))

	)

86 
	#DIA_FONT_STYLE_GET_WEIGHT
(
°
Ë((°Ë& (0x7<<4))

	)

88 
GTy≥
 
	$dü_f⁄t_gë_ty≥
(Ë
G_GNUC_CONST
;

90 
	#DIA_TYPE_FONT
 (
	`dü_f⁄t_gë_ty≥
())

	)

92 
	#DIA_FONT
(
obje˘
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((object), \

93 
DIA_TYPE_FONT
, \

94 
DüF⁄t
))

	)

95 
	#DIA_FONT_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((klass), \

96 
DIA_TYPE_FONT
, \

97 
DüF⁄tCœss
))

	)

99 
	s_DüF⁄tCœss
 {

100 
GObje˘Cœss
 
∑ª¡_˛ass
;

105 
DIAVAR
 
	`dü_f⁄t_öô
(
P™goC⁄ãxt
* 
pc⁄ãxt
);

107 
DIAVAR
 
	`dü_f⁄t_push_c⁄ãxt
(
P™goC⁄ãxt
 *
pc⁄ãxt
);

109 
DIAVAR
 
	`dü_f⁄t_p›_c⁄ãxt
();

111 
DIAVAR
 
P™goC⁄ãxt
 *
	`dü_f⁄t_gë_c⁄ãxt
();

115 
DIAVAR
 
DüF⁄t
* 
	`dü_f⁄t_√w
(c⁄° *
Ámûy
, 
DüF⁄tStyÀ
 
°yÀ
,

116 
ªÆ
 
height
);

120 
DIAVAR
 
DüF⁄t
* 
	`dü_f⁄t_√w_‰om_°yÀ
(
DüF⁄tStyÀ
 
°yÀ
, 
ªÆ
 
height
);

123 
DIAVAR
 
DüF⁄t
* 
	`dü_f⁄t_√w_‰om_Àgacy_«me
(c⁄° *
«me
);

127 
DIAVAR
 
G_CONST_RETURN
 * 
	`dü_f⁄t_gë_Àgacy_«me
(c⁄° 
DüF⁄t
* 
f⁄t
);

130 
DIAVAR
 
DüF⁄t
 *
	`dü_f⁄t_c›y
(c⁄° DüF⁄t* 
f⁄t
);

132 
	$__de˛•ec
(
dŒexp‹t
Ë
DüF⁄t
* 
	`dü_f⁄t_ªf
(DüF⁄t* 
f⁄t
);

133 
	$__de˛•ec
(
dŒexp‹t
Ë
	`dü_f⁄t_uƒef
(
DüF⁄t
* 
f⁄t
);

136 
DIAVAR
 
DüF⁄tStyÀ
 
	`dü_f⁄t_gë_°yÀ
(c⁄° 
DüF⁄t
* 
f⁄t
);

139 
DIAVAR
 
G_CONST_RETURN
 * 
	`dü_f⁄t_gë_Ámûy
(c⁄° 
DüF⁄t
* 
f⁄t
);

141 
DIAVAR
 
G_CONST_RETURN
 
P™goF⁄tDes¸ùti⁄
 *
	`dü_f⁄t_gë_des¸ùti⁄
 (c⁄° 
DüF⁄t
* 
f⁄t
);

144 
DIAVAR
 
ªÆ
 
	`dü_f⁄t_gë_height
(c⁄° 
DüF⁄t
* 
f⁄t
);

146 
DIAVAR
 
	`dü_f⁄t_£t_height
(
DüF⁄t
* 
f⁄t
, 
ªÆ
 
height
);

148 
DIAVAR
 
ªÆ
 
	`dü_f⁄t_gë_size
(c⁄° 
DüF⁄t
* 
f⁄t
);

151 
DIAVAR
 
	`dü_f⁄t_£t_¶™t
(
DüF⁄t
* 
f⁄t
, 
DüF⁄tSœ¡
 
¶™t
);

153 
DIAVAR
 
	`dü_f⁄t_£t_weight
(
DüF⁄t
* 
f⁄t
, 
DüF⁄tWeight
 
weight
);

156 
	`dü_f⁄t_£t_Ámûy
(
DüF⁄t
* 
f⁄t
, 
DüF⁄tFamûy
 
Ámûy
);

159 
DIAVAR
 
	`dü_f⁄t_£t_™y_Ámûy
(
DüF⁄t
* 
f⁄t
, c⁄° * 
Ámûy
);

163 
DIAVAR
 
G_CONST_RETURN
 *
	`dü_f⁄t_gë_psf⁄äame
(c⁄° 
DüF⁄t
 *
f⁄t
);

166 
DIAVAR
 
G_CONST_RETURN
 *
	`dü_f⁄t_gë_weight_°rög
(c⁄° 
DüF⁄t
* 
f⁄t
);

169 
DIAVAR
 
G_CONST_RETURN
 *
	`dü_f⁄t_gë_¶™t_°rög
(c⁄° 
DüF⁄t
* 
f⁄t
);

172 
DIAVAR
 
	`dü_f⁄t_£t_weight_‰om_°rög
(
DüF⁄t
* 
f⁄t
, c⁄° * 
weight
);

175 
DIAVAR
 
	`dü_f⁄t_£t_¶™t_‰om_°rög
(
DüF⁄t
* 
f⁄t
, c⁄° * 
¶™t
);

181 
	$__de˛•ec
(
dŒexp‹t
Ë
ªÆ
 
	`dü_f⁄t_°rög_width
(c⁄° * 
°rög
, 
DüF⁄t
* 
f⁄t
,

182 
ªÆ
 
height
);

184 
DIAVAR
 
ªÆ
 
	`dü_f⁄t_as˚¡
(c⁄° * 
°rög
, 
DüF⁄t
* 
f⁄t
,Ñó»
height
);

186 
DIAVAR
 
ªÆ
 
	`dü_f⁄t_des˚¡
(c⁄° * 
°rög
, 
DüF⁄t
* 
f⁄t
,Ñó»
height
);

189 
DIAVAR
 
P™goLayout
* 
	`dü_f⁄t_buûd_œyout
(c⁄° * 
°rög
, 
DüF⁄t
* 
f⁄t
,

190 
ªÆ
 
height
);

192 
DIAVAR
 
P™goLayout
* 
	`dü_f⁄t_buûd_œyout_wôh_m©rix
(c⁄° * 
°rög
,

193 
DüF⁄t
* 
f⁄t
,

194 
ªÆ
 
height
,

195 
P™goM©rix
 *
m©rix
);

197 
ªÆ
* 
	`dü_f⁄t_gë_sizes
(c⁄° * 
°rög
, 
DüF⁄t
 *
f⁄t
,Ñó»
height
,

198 
ªÆ
* 
width
,Ñól* 
as˚¡
,Ñól* 
des˚¡
,

199 *
n_off£ts
, 
P™goLayoutLöe
 **
œyout_off£ts
);

204 
G_END_DECLS


	@O:\tool\dvs50\lib\geometry.c

23 
	~<c⁄fig.h
>

25 
	~<glib.h
>

27 #unde‡
G_INLINE_FUNC


28 
	#G_INLINE_FUNC
 
DIAVAR


	)

29 
	#G_CAN_INLINE
 1

	)

30 
	~"geomëry.h
"

32 
	~"obje˘.h
"

33 
	~"unôs.h
"

36 
	$ª˘™gÀ_uni⁄
(
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
)

38 
r1
->
t›
 = 
	`MIN
–r1->t›, 
r2
->top );

39 
r1
->
bŸtom
 = 
	`MAX
–r1->bŸtom, 
r2
->bottom );

40 
r1
->
À·
 = 
	`MIN
–r1->À·, 
r2
->left );

41 
r1
->
right
 = 
	`MAX
–r1->right, 
r2
->right );

42 
	}
}

45 
	$öt_ª˘™gÀ_uni⁄
(
I¡Re˘™gÀ
 *
r1
, c⁄° I¡Re˘™gÀ *
r2
)

47 
r1
->
t›
 = 
	`MIN
–r1->t›, 
r2
->top );

48 
r1
->
bŸtom
 = 
	`MAX
–r1->bŸtom, 
r2
->bottom );

49 
r1
->
À·
 = 
	`MIN
–r1->À·, 
r2
->left );

50 
r1
->
right
 = 
	`MAX
–r1->right, 
r2
->right );

51 
	}
}

54 
	$ª˘™gÀ_öãr£˘i⁄
(
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
)

56 
r1
->
t›
 = 
	`MAX
–r1->t›, 
r2
->top );

57 
r1
->
bŸtom
 = 
	`MIN
–r1->bŸtom, 
r2
->bottom );

58 
r1
->
À·
 = 
	`MAX
–r1->À·, 
r2
->left );

59 
r1
->
right
 = 
	`MIN
–r1->right, 
r2
->right );

62 i‡–(
r1
->
t›
 >r1->
bŸtom
) ||

63 (
r1
->
À·
 >r1->
right
) ) {

64 
r1
->
t›
 =Ñ1->
bŸtom
 =Ñ1->
À·
 =Ñ1->
right
 = 0.0;

66 
	}
}

69 
	$ª˘™gÀ_öãr£˘s
(c⁄° 
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
)

71 i‡–(
r1
->
right
 < 
r2
->
À·
) ||

72 (
r1
->
À·
 > 
r2
->
right
) ||

73 (
r1
->
t›
 > 
r2
->
bŸtom
) ||

74 (
r1
->
bŸtom
 < 
r2
->
t›
) )

75  
FALSE
;

77  
TRUE
;

78 
	}
}

81 
	$poöt_ö_ª˘™gÀ
(c⁄° 
Re˘™gÀ
* 
r
, c⁄° 
Poöt
 *
p
)

83 i‡–(
p
->
x
 < 
r
->
À·
) ||

84 (
p
->
x
 > 
r
->
right
) ||

85 (
p
->
y
 > 
r
->
bŸtom
) ||

86 (
p
->
y
 < 
r
->
t›
) )

87  
FALSE
;

89  
TRUE
;

90 
	}
}

93 
	$ª˘™gÀ_ö_ª˘™gÀ
(c⁄° 
Re˘™gÀ
* 
ouãr
, c⁄° Re˘™gÀ *
ö√r
)

95 i‡–(
ö√r
->
À·
 < 
ouãr
->left) ||

96 (
ö√r
->
right
 > 
ouãr
->right) ||

97 (
ö√r
->
t›
 < 
ouãr
->top) ||

98 (
ö√r
->
bŸtom
 > 
ouãr
->bottom))

99  
FALSE
;

101  
TRUE
;

102 
	}
}

105 
	$ª˘™gÀ_add_poöt
(
Re˘™gÀ
 *
r
, c⁄° 
Poöt
 *
p
)

107 i‡(
p
->
x
 < 
r
->
À·
)

108 
r
->
À·
 = 
p
->
x
;

109 i‡(
p
->
x
 > 
r
->
right
)

110 
r
->
right
 = 
p
->
x
;

112 i‡(
p
->
y
 < 
r
->
t›
)

113 
r
->
t›
 = 
p
->
y
;

114 i‡(
p
->
y
 > 
r
->
bŸtom
)

115 
r
->
bŸtom
 = 
p
->
y
;

116 
	}
}

125 
ªÆ


126 
	$di°™˚_ª˘™gÀ_poöt
(c⁄° 
Re˘™gÀ
 *
ª˘
, c⁄° 
Poöt
 *
poöt
)

128 
ªÆ
 
dx
 = 0.0;

129 
ªÆ
 
dy
 = 0.0;

131 i‡(
poöt
->
x
 < 
ª˘
->
À·
 ) {

132 
dx
 = 
ª˘
->
À·
 - 
poöt
->
x
;

133 } i‡(
poöt
->
x
 > 
ª˘
->
right
 ) {

134 
dx
 = 
poöt
->
x
 - 
ª˘
->
right
;

137 i‡(
poöt
->
y
 < 
ª˘
->
t›
 ) {

138 
dy
 = 
ª˘
->
t›
 - 
poöt
->
y
;

139 } i‡(
poöt
->
y
 > 
ª˘
->
bŸtom
 ) {

140 
dy
 = 
poöt
->
y
 - 
ª˘
->
bŸtom
;

143  
dx
 + 
dy
;

144 
	}
}

155 
ªÆ


156 
	$di°™˚_löe_poöt
(c⁄° 
Poöt
 *
löe_°¨t
, c⁄° Poöà*
löe_íd
,

157 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
)

159 
Poöt
 
v1
, 
v2
;

160 
ªÆ
 
v1_Ànsq
;

161 
ªÆ
 
¥ojÀn
;

162 
ªÆ
 
≥Ω_di°
;

164 
v1
 = *
löe_íd
;

165 
	`poöt_sub
(&
v1
,
löe_°¨t
);

167 
v2
 = *
poöt
;

168 
	`poöt_sub
(&
v2
, 
löe_°¨t
);

170 
v1_Ànsq
 = 
	`poöt_dŸ
(&
v1
,&v1);

172 i‡(
v1_Ànsq
<0.000001) {

173  
	`sqπ
(
	`poöt_dŸ
(&
v2
,&v2));

176 
¥ojÀn
 = 
	`poöt_dŸ
(&
v1
,&
v2
Ë/ 
v1_Ànsq
;

178 i‡(
¥ojÀn
<0.0) {

179  
	`sqπ
(
	`poöt_dŸ
(&
v2
,&v2));

182 i‡(
¥ojÀn
>1.0) {

183 
Poöt
 
v3
 = *
poöt
;

184 
	`poöt_sub
(&
v3
,
löe_íd
);

185  
	`sqπ
(
	`poöt_dŸ
(&
v3
,&v3));

188 
	`poöt_sˇÀ
(&
v1
, 
¥ojÀn
);

189 
	`poöt_sub
(&
v1
, &
v2
);

191 
≥Ω_di°
 = 
	`sqπ
(
	`poöt_dŸ
(&
v1
,&v1));

193 
≥Ω_di°
 -
löe_width
 / 2.0;

194 i‡(
≥Ω_di°
 < 0.0) {

195 
≥Ω_di°
 = 0.0;

198  
≥Ω_di°
;

199 
	}
}

203 
	$löe_¸os£s_øy
(c⁄° 
Poöt
 *
löe_°¨t
,

204 c⁄° 
Poöt
 *
löe_íd
, c⁄° Poöà*
øyíd
)

206 i‡((
löe_°¨t
->
y
 <
øyíd
->y && 
löe_íd
->y >Ñayend->y) ||

207 (
löe_°¨t
->
y
 > 
øyíd
->y && 
löe_íd
->y <=Ñayend->y)) {

208 
ªÆ
 
vt
 = (
øyíd
->
y
 - 
löe_°¨t
->yË/ (
löe_íd
->y -Üine_start->y);

209 i‡(
øyíd
->
x
 < 
löe_°¨t
->x + 
vt
 * (
löe_íd
->x -Üine_start->x))

213 
	}
}

215 
ªÆ


216 
	$di°™˚_pﬁyg⁄_poöt
(c⁄° 
Poöt
 *
pﬁy
, 
guöt
 
≈oöts
, 
ªÆ
 
löe_width
,

217 c⁄° 
Poöt
 *
poöt
)

219 
guöt
 
i
, 
œ°
 = 
≈oöts
 - 1;

220 
ªÆ
 
löe_di°
 = 
G_MAXFLOAT
;

221 
guöt
 
¸ossögs
 = 0;

224 
i
 = 0; i < 
≈oöts
; i++) {

225 
ªÆ
 
di°
;

227 
¸ossögs
 +
	`löe_¸os£s_øy
(&
pﬁy
[
œ°
], &pﬁy[
i
], 
poöt
);

228 
di°
 = 
	`di°™˚_löe_poöt
(&
pﬁy
[
œ°
], &pﬁy[
i
], 
löe_width
, 
poöt
);

229 
löe_di°
 = 
	`MIN
÷öe_di°, 
di°
);

230 
œ°
 = 
i
;

234 i‡(
¸ossögs
 % 2 == 1)

237  
löe_di°
;

238 
	}
}

241 
	#NBEZ_SEGS
 10

	)

244 
ªÆ


245 
	$bez_poöt_di°™˚_™d_øy_¸os£s
(c⁄° 
Poöt
 *
b1
,

246 c⁄° 
Poöt
 *
b2
, c⁄° Poöà*
b3
,

247 c⁄° 
Poöt
 *
b4
,

248 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
,

249 
guöt
 *
¸oss
)

251 
gboﬁón
 
ˇlcuœãd_c€ff
 = 
FALSE
;

252 
ªÆ
 
c€ff
[
NBEZ_SEGS
+1][4];

253 
i
;

254 
ªÆ
 
löe_di°
 = 
G_MAXFLOAT
;

255 
Poöt
 
¥ev
, 
±
;

257 i‡(!
ˇlcuœãd_c€ff
) {

258 
i
 = 0; i <
NBEZ_SEGS
; i++) {

259 
ªÆ
 
t1
 = (‘ól)
i
)/
NBEZ_SEGS
, 
t2
 =Å1*t1, 
t3
 =Å1*t2;

260 
ªÆ
 
ô1
 = 1-
t1
, 
ô2
 = it1*ô1, 
ô3
 = it1*it2;

262 
c€ff
[
i
][0] = 
ô3
;

263 
c€ff
[
i
][1] = 3 * 
t1
 * 
ô2
;

264 
c€ff
[
i
][2] = 3 * 
t2
 * 
ô1
;

265 
c€ff
[
i
][3] = 
t3
;

268 
ˇlcuœãd_c€ff
 = 
TRUE
;

270 
¥ev
.
x
 = 
c€ff
[0][0] * 
b1
->x + c€ff[0][1] * 
b2
->x +

271 
c€ff
[0][2] * 
b3
->
x
 + c€ff[0][3] * 
b4
->x;

272 
¥ev
.
y
 = 
c€ff
[0][0] * 
b1
->y + c€ff[0][1] * 
b2
->y +

273 
c€ff
[0][2] * 
b3
->
y
 + c€ff[0][3] * 
b4
->y;

274 
i
 = 1; i <
NBEZ_SEGS
; i++) {

275 
ªÆ
 
di°
;

277 
±
.
x
 = 
c€ff
[
i
][0] * 
b1
->x + c€ff[i][1] * 
b2
->x +

278 
c€ff
[
i
][2] * 
b3
->
x
 + c€ff[i][3] * 
b4
->x;

279 
±
.
y
 = 
c€ff
[
i
][0] * 
b1
->y + c€ff[i][1] * 
b2
->y +

280 
c€ff
[
i
][2] * 
b3
->
y
 + c€ff[i][3] * 
b4
->y;

282 
di°
 = 
	`di°™˚_löe_poöt
(&
¥ev
, &
±
, 
löe_width
, 
poöt
);

283 
löe_di°
 = 
	`MIN
÷öe_di°, 
di°
);

284 i‡(
¸oss
)

285 *
¸oss
 +
	`löe_¸os£s_øy
(&
¥ev
, &
±
, 
poöt
);

287 
¥ev
 = 
±
;

289  
löe_di°
;

290 
	}
}

292 
ªÆ


293 
	$di°™˚_bez_£g_poöt
(c⁄° 
Poöt
 *
b1
, c⁄° Poöà*
b2
,

294 c⁄° 
Poöt
 *
b3
, c⁄° Poöà*
b4
,

295 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
)

297  
	`bez_poöt_di°™˚_™d_øy_¸os£s
(
b1
, 
b2
, 
b3
, 
b4
,

298 
löe_width
, 
poöt
, 
NULL
);

299 
	}
}

301 
ªÆ


302 
	$di°™˚_bez_löe_poöt
(c⁄° 
BezPoöt
 *
b
, 
guöt
 
≈oöts
,

303 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
)

305 
Poöt
 
œ°
;

306 
guöt
 
i
;

307 
ªÆ
 
löe_di°
 = 
G_MAXFLOAT
;

309 
	`g_ªtu∫_vÆ_if_Áû
(
b
[0].
ty≥
 =
BEZ_MOVE_TO
, -1);

311 
œ°
 = 
b
[0].
p1
;

313 
i
 = 1; i < 
≈oöts
; i++) {

314 
ªÆ
 
di°
;

316 
b
[
i
].
ty≥
) {

317 
BEZ_MOVE_TO
:

319 
	`g_w¨nög
("BEZ_MOVE_TO found half wayÅhroughá bezierÜine");

321 
BEZ_LINE_TO
:

322 
di°
 = 
	`di°™˚_löe_poöt
(&
œ°
, &
b
[
i
].
p1
, 
löe_width
, 
poöt
);

323 
löe_di°
 = 
	`MIN
÷öe_di°, 
di°
);

324 
œ°
 = 
b
[
i
].
p1
;

326 
BEZ_CURVE_TO
:

327 
di°
 = 
	`bez_poöt_di°™˚_™d_øy_¸os£s
(&
œ°
, &
b
[
i
].
p1
, &b[i].
p2
,

328 &
b
[
i
].
p3
, 
löe_width
, 
poöt
,

329 
NULL
);

330 
löe_di°
 = 
	`MIN
÷öe_di°, 
di°
);

331 
œ°
 = 
b
[
i
].
p3
;

335  
löe_di°
;

336 
	}
}

338 
ªÆ


339 
	$di°™˚_bez_sh≠e_poöt
(c⁄° 
BezPoöt
 *
b
, 
guöt
 
≈oöts
,

340 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
)

342 
Poöt
 
œ°
;

343 
guöt
 
i
;

344 
ªÆ
 
löe_di°
 = 
G_MAXFLOAT
;

345 
guöt
 
¸ossögs
 = 0;

347 
	`g_ªtu∫_vÆ_if_Áû
(
b
[0].
ty≥
 =
BEZ_MOVE_TO
, -1);

349 
œ°
 = 
b
[0].
p1
;

351 
i
 = 1; i < 
≈oöts
; i++) {

352 
ªÆ
 
di°
;

354 
b
[
i
].
ty≥
) {

355 
BEZ_MOVE_TO
:

357 
	`g_w¨nög
("BEZ_MOVE_TO found half wayÅhroughá bezier shape");

359 
BEZ_LINE_TO
:

360 
di°
 = 
	`di°™˚_löe_poöt
(&
œ°
, &
b
[
i
].
p1
, 
löe_width
, 
poöt
);

361 
¸ossögs
 +
	`löe_¸os£s_øy
(&
œ°
, &
b
[
i
].
p1
, 
poöt
);

362 
löe_di°
 = 
	`MIN
÷öe_di°, 
di°
);

363 
œ°
 = 
b
[
i
].
p1
;

365 
BEZ_CURVE_TO
:

366 
di°
 = 
	`bez_poöt_di°™˚_™d_øy_¸os£s
(&
œ°
, &
b
[
i
].
p1
, &b[i].
p2
,

367 &
b
[
i
].
p3
, 
löe_width
, 
poöt
,

368 &
¸ossögs
);

369 
löe_di°
 = 
	`MIN
÷öe_di°, 
di°
);

370 
œ°
 = 
b
[
i
].
p3
;

376 i‡(
¸ossögs
 % 2 == 1)

379  
löe_di°
;

380 
	}
}

382 
ªÆ


383 
	$di°™˚_ñlù£_poöt
(c⁄° 
Poöt
 *
˚¡ª
, 
ªÆ
 
width
,Ñó»
height
,

384 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
)

390 
ªÆ
 
w2
 = 
width
*width, 
h2
 = 
height
*height;

391 
ªÆ
 
sˇÀ
, 
ød
, 
di°
;

392 
Poöt
 
±
;

400 
±
 = *
poöt
;

401 
	`poöt_sub
(&
±
, 
˚¡ª
);

402 
±
.
x
 *=Öt.x;

403 
±
.
y
 *=Öt.y;

405 
sˇÀ
 = 
w2
 * 
h2
 / (4*h2*
±
.
x
 + 4*w2*±.
y
);

406 
ød
 = 
	`sqπ
((
±
.
x
 +Öt.
y
)*
sˇÀ
Ë+ 
löe_width
/2;

408 
di°
 = 
	`sqπ
(
±
.
x
 +Öt.
y
);

410 i‡(
di°
 <
ød
)

413  
di°
 - 
ød
;

414 
	}
}

418 
	$å™sf‹m_poöt
 (
M©rix
 
m
, 
Poöt
 *
§c
, Poöà*
de°
)

420 
ªÆ
 
xx
, 
yy
, 
ww
;

422 
xx
 = 
m
[0][0] * 
§c
->
x
 + m[0][1] * src->
y
 + m[0][2];

423 
yy
 = 
m
[1][0] * 
§c
->
x
 + m[1][1] * src->
y
 + m[1][2];

424 
ww
 = 
m
[2][0] * 
§c
->
x
 + m[2][1] * src->
y
 + m[2][2];

426 i‡(!
ww
)

427 
ww
 = 1.0;

429 
de°
->
x
 = 
xx
 / 
ww
;

430 
de°
->
y
 = 
yy
 / 
ww
;

431 
	}
}

434 
	$mu…_m©rix
 (
M©rix
 
m1
, M©rix 
m2
)

436 
M©rix
 
ªsu…
;

437 
i
, 
j
, 
k
;

439 
i
 = 0; i < 3; i++)

440 
j
 = 0; j < 3; j++)

442 
ªsu…
 [
i
][
j
] = 0.0;

443 
k
 = 0; k < 3; k++)

444 
ªsu…
 [
i
][
j
] +
m1
 [i][
k
] * 
m2
[k][j];

448 
i
 = 0; i < 3; i++)

449 
j
 = 0; j < 3; j++)

450 
m2
 [
i
][
j
] = 
ªsu…
 [i][j];

451 
	}
}

454 
	$idítôy_m©rix
 (
M©rix
 
m
)

456 
i
, 
j
;

458 
i
 = 0; i < 3; i++)

459 
j
 = 0; j < 3; j++)

460 
m
[
i
][
j
] = (i == j) ? 1 : 0;

462 
	}
}

465 
	$å™¶©e_m©rix
 (
M©rix
 
m
, 
ªÆ
 
x
,Ñó»
y
)

467 
M©rix
 
å™s
;

469 
	`idítôy_m©rix
 (
å™s
);

470 
å™s
[0][2] = 
x
;

471 
å™s
[1][2] = 
y
;

472 
	`mu…_m©rix
 (
å™s
, 
m
);

473 
	}
}

476 
	$sˇÀ_m©rix
 (
M©rix
 
m
, 
ªÆ
 
x
,Ñó»
y
)

478 
M©rix
 
sˇÀ
;

480 
	`idítôy_m©rix
 (
sˇÀ
);

481 
sˇÀ
[0][0] = 
x
;

482 
sˇÀ
[1][1] = 
y
;

483 
	`mu…_m©rix
 (
sˇÀ
, 
m
);

484 
	}
}

487 
	$rŸ©e_m©rix
 (
M©rix
 
m
, 
ªÆ
 
thëa
)

489 
M©rix
 
rŸ©e
;

490 
ªÆ
 
cos_thëa
, 
sö_thëa
;

492 
cos_thëa
 = 
	`cos
 (
thëa
);

493 
sö_thëa
 = 
	`sö
 (
thëa
);

495 
	`idítôy_m©rix
 (
rŸ©e
);

496 
rŸ©e
[0][0] = 
cos_thëa
;

497 
rŸ©e
[0][1] = -
sö_thëa
;

498 
rŸ©e
[1][0] = 
sö_thëa
;

499 
rŸ©e
[1][1] = 
cos_thëa
;

500 
	`mu…_m©rix
 (
rŸ©e
, 
m
);

501 
	}
}

504 
	$xshór_m©rix
 (
M©rix
 
m
, 
ªÆ
 
shór
)

506 
M©rix
 
shór_m
;

508 
	`idítôy_m©rix
 (
shór_m
);

509 
shór_m
[0][1] = 
shór
;

510 
	`mu…_m©rix
 (
shór_m
, 
m
);

511 
	}
}

514 
	$yshór_m©rix
 (
M©rix
 
m
, 
ªÆ
 
shór
)

516 
M©rix
 
shór_m
;

518 
	`idítôy_m©rix
 (
shór_m
);

519 
shór_m
[1][0] = 
shór
;

520 
	`mu…_m©rix
 (
shór_m
, 
m
);

521 
	}
}

524 
ªÆ


525 
	$dëîmö©e
 (
M©rix
 
m
)

527 
i
;

528 
dë
 = 0;

530 
i
 = 0; i < 3; i ++)

532 
dë
 +
m
[0][
i
] * m[1][(i+1)%3] * m[2][(i+2)%3];

533 
dë
 -
m
[2][
i
] * m[1][(i+1)%3] * m[0][(i+2)%3];

536  
dë
;

537 
	}
}

542 
	$poöt_c⁄vex
(
Poöt
 *
d°
, c⁄° Poöà*
§c1
, c⁄° Poöà*
§c2
, 
ªÆ
 
Æpha
)

547 
	`poöt_c›y
(
d°
,
§c1
);

548 
	`poöt_sˇÀ
(
d°
,
Æpha
);

549 
	`poöt_add_sˇÀd
(
d°
,
§c2
,1.0 - 
Æpha
);

550 
	}
}

560 
ªÆ
 
	$dŸ2
(
Poöt
 *
p1
, Poöà*
p2
)

562 
ªÆ
 
d
, 
t
;

563 
d
 = 
	`sqπ
(((
p1
->
x
*p1->x)+’1->
y
*p1->y)) *

564 ((
p2
->
x
*p2->x)+’2->
y
*p2->y)));

565 i‡–
d
 != 0.0 )

567 
t
 = (
p1
->
x
*
p2
->x+p1->
y
*p2->y)/
d
;

568  (
	`acos
(
t
));

574 
	}
}

577 
	$löe_c€f
(
ªÆ
 *
a
,Ñó»*
b
,Ñó»*
c
, 
Poöt
 *
p1
, Poöà*
p2
)

579 *
c
 = ( 
p2
->
x
 * 
p1
->
y
 ) - (Ö1->x *Ö2->y );

580 *
a
 = 
p2
->
y
 - 
p1
->y;

581 *
b
 = 
p1
->
x
 - 
p2
->x;

582 
	}
}

586 
ªÆ
 
	$löe_to_poöt
(
ªÆ
 
a
,Ñó»
b
 ,Ñó»
c
, 
Poöt
 *
p
) {

587 
ªÆ
 
d
, 
Õ
;

588 
d
 = 
	`sqπ
((
a
*a)+(
b
*b));

589 i‡–
d
 == 0.0 ) {

590 
Õ
 = 0.0;

592 
Õ
 = (
a
*
p
->
x
+
b
*p->
y
+
c
)/
d
;

594  (
Õ
);

595 
	}
}

599 
	$poöt_≥Ω
(
Poöt
 *
p
, 
ªÆ
 
a
,Ñó»
b
,Ñó»
c
, Poöà*
≥Ω
) {

600 
ªÆ
 
d
, 
˝
;

601 
≥Ω
->
x
 = 0.0;

602 
≥Ω
->
y
 = 0.0;

603 
d
 = 
a
*®+ 
b
*b;

604 
˝
 = 
a
*
p
->
y
-
b
*p->
x
;

605 i‡–
d
 != 0.0 ) {

606 
≥Ω
->
x
 = (-
a
*
c
-
b
*
˝
)/
d
;

607 
≥Ω
->
y
 = (
a
*
˝
-
b
*
c
)/
d
;

610 
	}
}

618 
	$fûÀt
(
Poöt
 *
p1
, Poöà*
p2
, Poöà*
p3
, Poöà*
p4
,

619 
ªÆ
 
r
, 
Poöt
 *
c
,Ñó»*
∑
,Ñó»*
Ø
) {

620 
ªÆ
 
a1
, 
b1
, 
c1
;

621 
ªÆ
 
a2
, 
b2
, 
c2
;

622 
ªÆ
 
d
, 
d1
, 
d2
;

623 
ªÆ
 
c1p
, 
c2p
;

624 
ªÆ
 
º
;

625 
ªÆ
 
°¨t_™gÀ
, 
°›_™gÀ
;

626 
Poöt
 
mp
,
gv1
,
gv2
;

627 
gboﬁón
 
righth™d
 = 
FALSE
;

629 
	`löe_c€f
(&
a1
,&
b1
,&
c1
,
p1
,
p2
);

630 
	`löe_c€f
(&
a2
,&
b2
,&
c2
,
p3
,
p4
);

632 i‡–(
a1
*
b2
Ë=(
a2
*
b1
) )

637 
mp
.
x
 = (
p3
->x + 
p4
->x) / 2.0;

638 
mp
.
y
 = (
p3
->y + 
p4
->y) / 2.0;

639 
d1
 = 
	`löe_to_poöt
(
a1
, 
b1
, 
c1
, &
mp
);

641 i‡–
d1
 == 0.0 ) ;

643 
mp
.
x
 = (
p1
->x + 
p2
->x) / 2.0;

644 
mp
.
y
 = (
p1
->y + 
p2
->y) / 2.0;

645 
d2
 = 
	`löe_to_poöt
(
a2
, 
b2
, 
c2
, &
mp
);

647 i‡–
d2
 == 0.0 ) ;

649 
º
 = 
r
;

650 i‡–
d1
 <0.0 ) 
º
 = -rr;

652 
c1p
 = 
c1
-
º
*
	`sqπ
((
a1
*a1)+(
b1
*b1));

653 
º
 = 
r
;

655 i‡–
d2
 <0.0 ) 
º
 = -rr;

656 
c2p
 = 
c2
-
º
*
	`sqπ
((
a2
*a2)+(
b2
*b2));

657 
d
 = 
a1
*
b2
-
a2
*
b1
;

659 
c
->
x
 = ( 
c2p
*
b1
-
c1p
*
b2
 ) / 
d
;

660 
c
->
y
 = ( 
c1p
*
a2
-
c2p
*
a1
 ) / 
d
;

662 
	`poöt_≥Ω
(
c
,
a1
,
b1
,
c1
,
p2
);

663 
	`poöt_≥Ω
(
c
,
a2
,
b2
,
c2
,
p3
);

666 
gv1
.
x
 = 
p2
->x-
c
->x; gv1.
y
 = -(p2->y-c->y);

667 
gv2
.
x
 = 
p3
->x-
c
->x; gv2.
y
 = -(p3->y-c->y);

669 
°¨t_™gÀ
 = 
	`©™2
(
gv1
.
y
,gv1.
x
);

670 
°›_™gÀ
 = 
	`dŸ2
(&
gv1
,&
gv2
);

671 i‡–
	`poöt_¸oss
(&
gv1
,&
gv2
) < 0.0 ) {

672 
°›_™gÀ
 = -stop_angle;

674 
righth™d
 = 
TRUE
;

678 
°¨t_™gÀ
 = sèπ_™gÀ*180.0/
G_PI
;

679 
°›_™gÀ
 = 
°¨t_™gÀ
 + st›_™gÀ*180.0/
G_PI
;

680 
°¨t_™gÀ
 < 0.0) start_angle += 360.0;

681 
°›_™gÀ
 < 0.0) stop_angle += 360.0;

683 i‡–
righth™d
 ) {

684 
ªÆ
 
tmp
 = 
°¨t_™gÀ
;

685 
°¨t_™gÀ
 = 
°›_™gÀ
;

686 
°›_™gÀ
 = 
tmp
;

688 *
∑
 = 
°¨t_™gÀ
;

689 *
Ø
 = 
°›_™gÀ
;

690 
	}
}

693 
	$thªe_poöt_cú˛e
 (c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
, c⁄° Poöà*
p3
,

694 
Poöt
* 
˚¡î
, 
ªÆ
* 
ødius
)

696 c⁄° 
ªÆ
 
ïsû⁄
 = 1e-4;

697 
ªÆ
 
x1
 = 
p1
->
x
;

698 
ªÆ
 
y1
 = 
p1
->
y
;

699 
ªÆ
 
x2
 = 
p2
->
x
;

700 
ªÆ
 
y2
 = 
p2
->
y
;

701 
ªÆ
 
x3
 = 
p3
->
x
;

702 
ªÆ
 
y3
 = 
p3
->
y
;

703 
ªÆ
 
ma
, 
mb
;

704 i‡(
	`Ábs
(
x2
 - 
x1
Ë< 
ïsû⁄
)

706 i‡(
	`Ábs
(
x3
 - 
x2
Ë< 
ïsû⁄
)

708 
ma
 = (
y2
 - 
y1
Ë/ (
x2
 - 
x1
);

709 
mb
 = (
y3
 - 
y2
Ë/ (
x3
 - 
x2
);

710 i‡(
	`Ábs
 (
mb
 - 
ma
Ë< 
ïsû⁄
)

712 
˚¡î
->
x
 = (
ma
*
mb
*(
y1
-
y3
)+mb*(
x1
+
x2
)-ma*(x2+
x3
))/(2*(mb-ma));

713 i‡(
	`Ábs
(
ma
)>
ïsû⁄
)

714 
˚¡î
->
y
 = -1/
ma
*(˚¡î->
x
 - (
x1
+
x2
)/2.0Ë+ (
y1
+
y2
)/2.0;

715 i‡(
	`Ábs
(
mb
)>
ïsû⁄
)

716 
˚¡î
->
y
 = -1/
mb
*(˚¡î->
x
 - (
x2
+
x3
)/2.0Ë+ (
y2
+
y3
)/2.0;

719 *
ødius
 = 
	`di°™˚_poöt_poöt
(
˚¡î
, 
p1
);

721 
	}
}

725 
ªÆ


726 
	$poöt_¸oss
(
Poöt
 *
p1
, Poöà*
p2
)

728  
p1
->
x
 * 
p2
->
y
 -Ö2->x *Ö1->y;

729 
	}
}

734 
Poöt


735 
	$ˇlcuœã_obje˘_edge
(
Poöt
 *
objmid
, Poöà*
íd
, 
DüObje˘
 *
obj
)

737 
	#MAXITER
 25

	)

738 #ifde‡
TRACE_DIST


739 
Poöt
 
åa˚
[
MAXITER
];

740 
ªÆ
 
di°åa˚
[
MAXITER
];

742 
Poöt
 
mid1
, 
mid2
, 
mid3
;

743 
ªÆ
 
di°
;

744 
i
 = 0;

746 
mid1
 = *
objmid
;

747 
mid2
.
x
 = (
objmid
->x+
íd
->x)/2;

748 
mid2
.
y
 = (
objmid
->y+
íd
->y)/2;

749 
mid3
 = *
íd
;

752 
di°
 = 
obj
->
›s
->
	`di°™˚_‰om
(obj, &
mid3
);

753 i‡(
di°
 < 0.001Ë 
mid1
;

757 
di°
 = 
obj
->
›s
->
	`di°™˚_‰om
(obj, &
mid2
);

758 i‡(
di°
 < 0.0000001) {

759 
mid1
 = 
mid2
;

761 
mid3
 = 
mid2
;

763 
mid2
.
x
 = (
mid1
.x + 
mid3
.x)/2;

764 
mid2
.
y
 = (
mid1
.y + 
mid3
.y)/2;

765 #ifde‡
TRACE_DIST


766 
åa˚
[
i
] = 
mid2
;

767 
di°åa˚
[
i
] = 
di°
;

769 
i
++;

770 } 
i
 < 
MAXITER
 && (
di°
 < 0.0000001 || dist > 0.001));

772 #ifde‡
TRACE_DIST


773 i‡(
i
 =
MAXITER
) {

774 
i
 = 0; i < 
MAXITER
; i++) {

775 
	`¥ötf
("%d: %f, %f: %f\n", 
i
, 
åa˚
[i].
x
,Åø˚[i].
y
, 
di°åa˚
[i]);

777 
	`¥ötf
("ò%d, di° = %f\n", 
i
, 
di°
);

781  
mid2
;

782 
	}
}

	@O:\tool\dvs50\lib\geometry.h

20 #i‚de‡
GEOMETRY_H


21 
	#GEOMETRY_H


	)

23 #ifde‡
HAVE_CONFIG_H


24 
	~<c⁄fig.h
>

27 
	~"düty≥s.h
"

29 
	~<glib.h
>

30 
	~<m©h.h
>

36 #ifde‡
HAVE_IEEEFP_H


37 
	~<õìÂ.h
>

39 #i‚de‡
HAVE_ISINF


40 
	#isöf
(
a
Ë(!
	`föôe
◊))

	)

43 #ifde‡
_MSC_VER


46 
	~<Êﬂt.h
>

47 
	#föôe
(
a
Ë
	`_föôe
◊)

	)

48 
	#i¢™
(
a
Ë
	`_i¢™
◊)

	)

50 #ifde‡
G_OS_WIN32


51 
	#M_PI
 3.14159265358979323846

	)

52 
	#M_SQRT2
 1.41421356237309504880

	)

53 
	#M_SQRT1_2
 0.70710678118654752440

	)

57 #i‚de‡
M_PI


58 
	#M_PI
 
G_PI


	)

60 #i‚de‡
M_SQRT2


61 
	#M_SQRT2
 
G_SQRT2


	)

63 #i‚de‡
M_SQRT1_2


64 
	#M_SQRT1_2
 (1.0/
G_SQRT2
)

	)

67 
G_BEGIN_DECLS


78 
	tªÆ
;

79 
ªÆ
 
	tco‹d
;

82 
	s_Poöt
 {

83 
co‹d
 
	mx
;

84 
co‹d
 
	my
;

88 
	s_Re˘™gÀ
 {

89 
co‹d
 
	mÀ·
;

90 
co‹d
 
	mt›
;

91 
co‹d
 
	mright
;

92 
co‹d
 
	mbŸtom
;

96 
	s_I¡Re˘™gÀ
 {

97 
	mÀ·
;

98 
	mt›
;

99 
	mright
;

100 
	mbŸtom
;

106 
	s_BezPoöt
 {

108 
	mBEZ_MOVE_TO
,

109 
	mBEZ_LINE_TO
,

110 
	mBEZ_CURVE_TO


111 } 
	mty≥
;

112 
Poöt
 
	mp1
;

113 
Poöt
 
	mp2
;

114 
Poöt
 
	mp3
;

118 
	#ROUND
(
x
Ë((Ë
	`Êo‹
((x)+0.5))

	)

122 
G_INLINE_FUNC
 
poöt_add
(
Poöt
 *
p1
, c⁄° Poöà*
p2
);

123 #ifde‡
G_CAN_INLINE


124 
G_INLINE_FUNC
 

125 
	$poöt_add
(
Poöt
 *
p1
, c⁄° Poöà*
p2
)

127 
p1
->
x
 +
p2
->x;

128 
p1
->
y
 +
p2
->y;

129 
	}
}

132 
G_INLINE_FUNC
 
poöt_sub
(
Poöt
 *
p1
, c⁄° Poöà*
p2
);

133 #ifde‡
G_CAN_INLINE


134 
G_INLINE_FUNC
 

135 
	$poöt_sub
(
Poöt
 *
p1
, c⁄° Poöà*
p2
)

137 
p1
->
x
 -
p2
->x;

138 
p1
->
y
 -
p2
->y;

139 
	}
}

142 
G_INLINE_FUNC
 
ªÆ
 
poöt_dŸ
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
);

143 #ifde‡
G_CAN_INLINE


144 
G_INLINE_FUNC
 
ªÆ


145 
	$poöt_dŸ
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
)

147  
p1
->
x
*
p2
->x +Ö1->
y
*p2->y;

148 
	}
}

151 
G_INLINE_FUNC
 
ªÆ
 
poöt_Àn
(c⁄° 
Poöt
 *
p
);

152 #ifde‡
G_CAN_INLINE


153 
G_INLINE_FUNC
 
ªÆ


154 
	$poöt_Àn
(c⁄° 
Poöt
 *
p
)

156  
	`sqπ
(
p
->
x
*p->x +Ö->
y
*p->y);

157 
	}
}

160 
G_INLINE_FUNC
 
poöt_sˇÀ
(
Poöt
 *
p
, 
ªÆ
 
Æpha
);

161 #ifde‡
G_CAN_INLINE


162 
G_INLINE_FUNC
 

163 
	$poöt_sˇÀ
(
Poöt
 *
p
, 
ªÆ
 
Æpha
)

165 
p
->
x
 *
Æpha
;

166 
p
->
y
 *
Æpha
;

167 
	}
}

170 
G_INLINE_FUNC
 
poöt_n‹mÆize
(
Poöt
 *
p
);

171 #ifde‡
G_CAN_INLINE


172 
G_INLINE_FUNC
 

173 
	$poöt_n‹mÆize
(
Poöt
 *
p
)

175 
ªÆ
 
Àn
;

177 
Àn
 = 
	`sqπ
(
p
->
x
*p->x +Ö->
y
*p->y);

184 i‡(
Àn
 > 0.0) {

185 
p
->
x
 /
Àn
;

186 
p
->
y
 /
Àn
;

188 
p
->
x
 = 0.0;

189 
p
->
y
 = 0.0;

192 
	}
}

195 
G_INLINE_FUNC
 
poöt_rŸ©e
(
Poöt
 *
p1
, c⁄° Poöà*
p2
);

196 #ifde‡
G_CAN_INLINE


197 
G_INLINE_FUNC
 

198 
	$poöt_rŸ©e
(
Poöt
 *
p1
, c⁄° Poöà*
p2
)

200 
p1
->
x
 =Ö1->x*
p2
->x -Ö1->
y
*p2->y;

201 
p1
->
y
 =Ö1->
x
*
p2
->y +Ö1->y*p2->x;

202 
	}
}

205 
G_INLINE_FUNC
 
poöt_gë_n‹med
(
Poöt
 *
d°
, c⁄° Poöà*
§c
);

206 #ifde‡
G_CAN_INLINE


207 
G_INLINE_FUNC
 

208 
	$poöt_gë_n‹med
(
Poöt
 *
d°
, c⁄° Poöà*
§c
)

210 
ªÆ
 
Àn
;

212 
Àn
 = 
	`sqπ
(
§c
->
x
*§c->x + src->
y
*src->y);

214 
d°
->
x
 = 
§c
->x / 
Àn
;

215 
d°
->
y
 = 
§c
->y / 
Àn
;

216 
	}
}

219 
G_INLINE_FUNC
 
poöt_gë_≥Ω
(
Poöt
 *
d°
, c⁄° Poöà*
§c
);

220 #ifde‡
G_CAN_INLINE


221 
G_INLINE_FUNC
 

222 
	$poöt_gë_≥Ω
(
Poöt
 *
d°
, c⁄° Poöà*
§c
)

226 
d°
->
y
 = 
§c
->
x
;

227 
d°
->
x
 = -
§c
->
y
;

228 
	}
}

231 
G_INLINE_FUNC
 
poöt_c›y
(
Poöt
 *
d°
, c⁄° Poöà*
§c
);

232 #ifde‡
G_CAN_INLINE


233 
G_INLINE_FUNC
 

234 
	$poöt_c›y
(
Poöt
 *
d°
, c⁄° Poöà*
§c
)

241 
d°
->
x
 = 
§c
->x;

242 
d°
->
y
 = 
§c
->y;

243 
	}
}

246 
G_INLINE_FUNC
 
poöt_add_sˇÀd
(
Poöt
 *
d°
, c⁄° Poöà*
§c
, 
ªÆ
 
Æpha
);

247 #ifde‡
G_CAN_INLINE


248 
G_INLINE_FUNC
 

249 
	$poöt_add_sˇÀd
(
Poöt
 *
d°
, c⁄° Poöà*
§c
, 
ªÆ
 
Æpha
)

252 
d°
->
x
 +
Æpha
 * 
§c
->x;

253 
d°
->
y
 +
Æpha
 * 
§c
->y;

254 
	}
}

257 
G_INLINE_FUNC
 
poöt_c›y_add_sˇÀd
(
Poöt
 *
d°
, c⁄° Poöà*
§c
,

258 c⁄° 
Poöt
 *
v˘
,

259 
ªÆ
 
Æpha
);

260 #ifde‡
G_CAN_INLINE


261 
G_INLINE_FUNC
 

262 
	$poöt_c›y_add_sˇÀd
(
Poöt
 *
d°
, c⁄° Poöà*
§c
,

263 c⁄° 
Poöt
 *
v˘
, 
ªÆ
 
Æpha
)

266 
d°
->
x
 = 
§c
->x + (
Æpha
 * 
v˘
->x);

267 
d°
->
y
 = 
§c
->y + (
Æpha
 * 
v˘
->y);

268 
	}
}

271 
DIAVAR
 
poöt_c⁄vex
(
Poöt
 *
d°
, c⁄° Poöà*
§c1
, c⁄° Poöà*
§c2
, 
ªÆ
 
Æpha
);

273 
DIAVAR
 
ª˘™gÀ_uni⁄
(
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
);

274 
DIAVAR
 
öt_ª˘™gÀ_uni⁄
(
I¡Re˘™gÀ
 *
r1
, c⁄° I¡Re˘™gÀ *
r2
);

275 
DIAVAR
 
ª˘™gÀ_öãr£˘i⁄
(
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
);

276 
DIAVAR
 
ª˘™gÀ_öãr£˘s
(c⁄° 
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
);

277 
poöt_ö_ª˘™gÀ
(c⁄° 
Re˘™gÀ
* 
r
, c⁄° 
Poöt
 *
p
);

278 
DIAVAR
 
ª˘™gÀ_ö_ª˘™gÀ
(c⁄° 
Re˘™gÀ
* 
ouãr
, c⁄° Re˘™gÀ *
ö√r
);

279 
DIAVAR
 
ª˘™gÀ_add_poöt
(
Re˘™gÀ
 *
r
, c⁄° 
Poöt
 *
p
);

281 
G_INLINE_FUNC
 
gboﬁón
 
ª˘™gÀ_equÆs
(c⁄° 
Re˘™gÀ
 *
ﬁd_exã¡s
,

282 c⁄° 
Re˘™gÀ
 *
√w_exã¡s
);

283 #ifde‡
G_CAN_INLINE


284 
G_INLINE_FUNC
 
gboﬁón


285 
	$ª˘™gÀ_equÆs
(c⁄° 
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
)

287  ( (
r2
->
À·
 =
r1
->left) &&

288 (
r2
->
right
 =
r1
->right) &&

289 (
r2
->
t›
 =
r1
->top) &&

290 (
r2
->
bŸtom
 =
r1
->bottom) );

291 
	}
}

294 
G_INLINE_FUNC
 
ªÆ
 
di°™˚_poöt_poöt
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
);

295 #ifde‡
G_CAN_INLINE


296 
G_INLINE_FUNC
 
ªÆ


297 
	$di°™˚_poöt_poöt
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
)

299 
ªÆ
 
dx
 = 
p1
->
x
 - 
p2
->x;

300 
ªÆ
 
dy
 = 
p1
->
y
 - 
p2
->y;

301  
	`sqπ
(
dx
*dx + 
dy
*dy);

302 
	}
}

305 
G_INLINE_FUNC
 c⁄° 
Poöt
 *
˛o£°_to
(c⁄° Poöà*
to
, c⁄° Poöà*
p1
, c⁄° Poöà*
p2
);

306 #ifde‡
G_CAN_INLINE


307 
G_INLINE_FUNC
 c⁄° 
Poöt
 *

308 
	$˛o£°_to
(c⁄° 
Poöt
 *
to
, c⁄° Poöà*
p1
, c⁄° Poöà*
p2
)

310 i‡(
	`di°™˚_poöt_poöt
(
to
,
p1
Ë< di°™˚_poöt_poöt—o,
p2
))

311  
p1
;

312  
p2
;

313 
	}
}

316 
G_INLINE_FUNC
 
ªÆ
 
di°™˚_poöt_poöt_m™h©èn
(c⁄° 
Poöt
 *
p1
,

317 c⁄° 
Poöt
 *
p2
);

318 #ifde‡
G_CAN_INLINE


319 
G_INLINE_FUNC
 
ªÆ


320 
	$di°™˚_poöt_poöt_m™h©èn
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
)

322 
ªÆ
 
dx
 = 
p1
->
x
 - 
p2
->x;

323 
ªÆ
 
dy
 = 
p1
->
y
 - 
p2
->y;

324  
	`ABS
(
dx
Ë+ ABS(
dy
);

325 
	}
}

328 
DIAVAR
 
ªÆ
 
di°™˚_ª˘™gÀ_poöt
(c⁄° 
Re˘™gÀ
 *
ª˘
, c⁄° 
Poöt
 *
poöt
);

329 
DIAVAR
 
ªÆ
 
di°™˚_löe_poöt
(c⁄° 
Poöt
 *
löe_°¨t
, c⁄° Poöà*
löe_íd
,

330 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

332 
DIAVAR
 
ªÆ
 
di°™˚_pﬁyg⁄_poöt
(c⁄° 
Poöt
 *
pﬁy
, 
guöt
 
≈oöts
,

333 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

336 
DIAVAR
 
ªÆ
 
di°™˚_bez_£g_poöt
(c⁄° 
Poöt
 *
b1
, c⁄° Poöà*
b2
,

337 c⁄° 
Poöt
 *
b3
, c⁄° Poöà*
b4
,

338 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

339 
DIAVAR
 
ªÆ
 
di°™˚_bez_löe_poöt
(c⁄° 
BezPoöt
 *
b
, 
guöt
 
≈oöts
,

340 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

341 
DIAVAR
 
ªÆ
 
di°™˚_bez_sh≠e_poöt
(c⁄° 
BezPoöt
 *
b
, 
guöt
 
≈oöts
,

342 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

344 
DIAVAR
 
ªÆ
 
di°™˚_ñlù£_poöt
(c⁄° 
Poöt
 *
˚¡ª
,Ñó»
width
,Ñó»
height
,

345 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

347 
ªÆ
 
	tVe˘‹
[3];

348 
Ve˘‹
 
	tM©rix
[3];

350 
DIAVAR
 
å™sf‹m_poöt
 (
M©rix
, 
Poöt
 *, Point *);

351 
mu…_m©rix
 (
M©rix
, Matrix);

352 
DIAVAR
 
idítôy_m©rix
 (
M©rix
);

353 
å™¶©e_m©rix
 (
M©rix
, 
ªÆ
,Ñeal);

354 
sˇÀ_m©rix
 (
M©rix
, 
ªÆ
,Ñeal);

355 
DIAVAR
 
rŸ©e_m©rix
 (
M©rix
, 
ªÆ
);

356 
xshór_m©rix
 (
M©rix
, 
ªÆ
);

357 
yshór_m©rix
 (
M©rix
, 
ªÆ
);

359 
ªÆ
 
dŸ2
(
Poöt
 *
p1
, Poöà*
p2
);

360 
löe_c€f
(
ªÆ
 *
a
,Ñó»*
b
,Ñó»*
c
, 
Poöt
 *
p1
, Poöà*
p2
);

361 
ªÆ
 
löe_to_poöt
‘ó»
a
,Ñó»
b
 ,Ñó»
c
, 
Poöt
 *
p
);

362 
poöt_≥Ω
(
Poöt
 *
p
, 
ªÆ
 
a
,Ñó»
b
,Ñó»
c
, Poöà*
≥Ω
);

363 
fûÀt
(
Poöt
 *
p1
, Poöà*
p2
, Poöà*
p3
, Poöà*
p4
,

364 
ªÆ
 
r
, 
Poöt
 *
c
,Ñó»*
∑
,Ñó»*
Ø
);

365 
DIAVAR
 
thªe_poöt_cú˛e
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
, c⁄° Poöà*
p3
,

366 
Poöt
* 
˚¡î
, 
ªÆ
* 
ødius
);

367 
DIAVAR
 
ªÆ
 
poöt_¸oss
(
Poöt
 *
p1
, Poöà*
p2
);

368 
DIAVAR
 
Poöt
 
ˇlcuœã_obje˘_edge
(Poöà*
objmid
, Poöà*
íd
, 
DüObje˘
 *
obj
);

370 
	gG_END_DECLS


	@O:\tool\dvs50\lib\group.c

18 
	~<c⁄fig.h
>

20 
	~<as£π.h
>

21 
	~<gtk/gtk.h
>

22 
	~<m©h.h
>

24 
	~"obje˘.h
"

25 
	~"c⁄√˘i⁄poöt.h
"

26 
	~"group.h
"

27 
	~"¥›îtõs.h
"

28 
	~"düªndîî.h
"

30 
	s_Group
 {

32 
DüObje˘
 
	mobje˘
;

34 
H™dÀ
 
	mªsize_h™dÀs
[8];

36 
GLi°
 *
	mobje˘s
;

38 c⁄° 
Pr›Des¸ùti⁄
 *
	mpdesc
;

41 
_GroupPr›Ch™ge
 
	tGroupPr›Ch™ge
;

42 
	s_GroupPr›Ch™ge
 {

43 
Obje˘Ch™ge
 
	mobj_ch™ge
;

44 
Group
 *
	mgroup
;

45 
GLi°
 *
	mch™ges_≥r_obje˘
;

48 
GroupPr›Ch™ge
* 
group_≠∂y_¥›îtõs_li°
(
Group
 *
group
, 
GPåAºay
 *
¥›s
);

49 
group_¥›_ch™ge_≠∂y
(
GroupPr›Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
);

50 
group_¥›_ch™ge_ªvît
(
GroupPr›Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
);

51 
group_¥›_ch™ge_‰ì
(
GroupPr›Ch™ge
 *
ch™ge
);

53 
ªÆ
 
group_di°™˚_‰om
(
Group
 *
group
, 
Poöt
 *
poöt
);

54 
group_£À˘
(
Group
 *
group
);

55 
Obje˘Ch™ge
* 
group_move_h™dÀ
(
Group
 *
group
, 
H™dÀ
 *
h™dÀ
, 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

56 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

57 
Obje˘Ch™ge
* 
group_move
(
Group
 *
group
, 
Poöt
 *
to
);

58 
group_døw
(
Group
 *
group
, 
DüRídîî
 *
ªndîî
);

59 
group_upd©e_d©a
(
Group
 *
group
);

60 
group_upd©e_h™dÀs
(
Group
 *
group
);

61 
group_de°roy
(
Group
 *
group
);

62 
DüObje˘
 *
group_c›y
(
Group
 *
group
);

63 c⁄° 
Pr›Des¸ùti⁄
 *
group_des¸ibe_¥›s
(
Group
 *
group
);

64 
group_gë_¥›s
(
Group
 *
group
, 
GPåAºay
 *
¥›s
);

65 
group_£t_¥›s
(
Group
 *
group
, 
GPåAºay
 *
¥›s
);

67 
Obje˘Ops
 
	ggroup_›s
 = {

68 (
De°royFunc
Ë
group_de°roy
,

69 (
DøwFunc
Ë
group_døw
,

70 (
Di°™˚Func
Ë
group_di°™˚_‰om
,

71 (
Sñe˘Func
Ë
group_£À˘
,

72 (
C›yFunc
Ë
group_c›y
,

73 (
MoveFunc
Ë
group_move
,

74 (
MoveH™dÀFunc
Ë
group_move_h™dÀ
,

75 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

76 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

77 (
Obje˘MíuFunc
Ë
NULL
,

78 (
Des¸ibePr›sFunc
Ë
group_des¸ibe_¥›s
,

79 (
GëPr›sFunc
Ë
group_gë_¥›s
,

80 (
SëPr›sFunc
Ë
group_£t_¥›s
,

81 (
TextEdôFunc
) 0,

82 (
AµlyPr›îtõsLi°Func
Ë
group_≠∂y_¥›îtõs_li°
,

85 
DüObje˘Ty≥
 
	ggroup_ty≥
 = {

88 
NULL


91 
ªÆ


92 
	$group_di°™˚_‰om
(
Group
 *
group
, 
Poöt
 *
poöt
)

94 
ªÆ
 
di°
;

95 
GLi°
 *
li°
;

96 
DüObje˘
 *
obj
;

98 
di°
 = 100000.0;

100 
li°
 = 
group
->
obje˘s
;

101 
li°
 !
NULL
) {

102 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

104 
di°
 = 
	`MIN
(di°, 
obj
->
›s
->
	`di°™˚_‰om
(obj, 
poöt
));

106 
li°
 = 
	`g_li°_√xt
(list);

109  
di°
;

110 
	}
}

113 
	$group_£À˘
(
Group
 *
group
)

115 
	`group_upd©e_h™dÀs
(
group
);

116 
	}
}

119 
	$group_upd©e_h™dÀs
(
Group
 *
group
)

121 
Re˘™gÀ
 *
bb
 = &
group
->
obje˘
.
boundög_box
;

123 
group
->
ªsize_h™dÀs
[0].
id
 = 
HANDLE_RESIZE_NW
;

124 
group
->
ªsize_h™dÀs
[0].
pos
.
x
 = 
bb
->
À·
;

125 
group
->
ªsize_h™dÀs
[0].
pos
.
y
 = 
bb
->
t›
;

127 
group
->
ªsize_h™dÀs
[1].
id
 = 
HANDLE_RESIZE_N
;

128 
group
->
ªsize_h™dÀs
[1].
pos
.
x
 = (
bb
->
À·
 + bb->
right
) / 2.0;

129 
group
->
ªsize_h™dÀs
[1].
pos
.
y
 = 
bb
->
t›
;

131 
group
->
ªsize_h™dÀs
[2].
id
 = 
HANDLE_RESIZE_NE
;

132 
group
->
ªsize_h™dÀs
[2].
pos
.
x
 = 
bb
->
right
;

133 
group
->
ªsize_h™dÀs
[2].
pos
.
y
 = 
bb
->
t›
;

135 
group
->
ªsize_h™dÀs
[3].
id
 = 
HANDLE_RESIZE_W
;

136 
group
->
ªsize_h™dÀs
[3].
pos
.
x
 = 
bb
->
À·
;

137 
group
->
ªsize_h™dÀs
[3].
pos
.
y
 = (
bb
->
t›
 + bb->
bŸtom
) / 2.0;

139 
group
->
ªsize_h™dÀs
[4].
id
 = 
HANDLE_RESIZE_E
;

140 
group
->
ªsize_h™dÀs
[4].
pos
.
x
 = 
bb
->
right
;

141 
group
->
ªsize_h™dÀs
[4].
pos
.
y
 = (
bb
->
t›
 + bb->
bŸtom
) / 2.0;

143 
group
->
ªsize_h™dÀs
[5].
id
 = 
HANDLE_RESIZE_SW
;

144 
group
->
ªsize_h™dÀs
[5].
pos
.
x
 = 
bb
->
À·
;

145 
group
->
ªsize_h™dÀs
[5].
pos
.
y
 = 
bb
->
bŸtom
;

147 
group
->
ªsize_h™dÀs
[6].
id
 = 
HANDLE_RESIZE_S
;

148 
group
->
ªsize_h™dÀs
[6].
pos
.
x
 = (
bb
->
À·
 + bb->
right
) / 2.0;

149 
group
->
ªsize_h™dÀs
[6].
pos
.
y
 = 
bb
->
bŸtom
;

151 
group
->
ªsize_h™dÀs
[7].
id
 = 
HANDLE_RESIZE_SE
;

152 
group
->
ªsize_h™dÀs
[7].
pos
.
x
 = 
bb
->
right
;

153 
group
->
ªsize_h™dÀs
[7].
pos
.
y
 = 
bb
->
bŸtom
;

154 
	}
}

156 
Obje˘Ch™ge
*

157 
	$group_move_h™dÀ
(
Group
 *
group
, 
H™dÀ
 *
h™dÀ
, 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

158 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

161  
NULL
;

162 
	}
}

164 
Obje˘Ch™ge
*

165 
	$group_move
(
Group
 *
group
, 
Poöt
 *
to
)

167 
Poöt
 
dñè
,
pos
;

169 
dñè
 = *
to
;

170 
pos
 = 
group
->
obje˘
.
posôi⁄
;

171 
	`poöt_sub
(&
dñè
, &
pos
);

173 
	`obje˘_li°_move_dñè
(
group
->
obje˘s
, &
dñè
);

175 
	`group_upd©e_d©a
(
group
);

177  
NULL
;

178 
	}
}

181 
	$group_døw
(
Group
 *
group
, 
DüRídîî
 *
ªndîî
)

183 
GLi°
 *
li°
;

184 
DüObje˘
 *
obj
;

186 
li°
 = 
group
->
obje˘s
;

187 
li°
 !
NULL
) {

188 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

190 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_obje˘
‘ídîî, 
obj
);

192 
li°
 = 
	`g_li°_√xt
(list);

194 
	}
}

197 
	$group_de°roy_shÆlow
(
DüObje˘
 *
obj
)

199 
Group
 *
group
 = (Grou∞*)
obj
;

200 i‡(
obj
->
h™dÀs
)

201 
	`g_‰ì
(
obj
->
h™dÀs
);

203 i‡(
obj
->
c⁄√˘i⁄s
)

204 
	`g_‰ì
(
obj
->
c⁄√˘i⁄s
);

206 
	`g_li°_‰ì
(
group
->
obje˘s
);

208 
	`¥›_desc_li°_‰ì_h™dÀr_chaö
((
Pr›Des¸ùti⁄
 *)
group
->
pdesc
);

209 
	`g_‰ì
((
Pr›Des¸ùti⁄
 *)
group
->
pdesc
);

211 
	`g_‰ì
(
group
);

212 
	}
}

215 
	$group_de°roy
(
Group
 *
group
)

217 
DüObje˘
 *
obj
 = &
group
->
obje˘
;

219 
	`de°roy_obje˘_li°
(
group
->
obje˘s
);

223 
obj
->
num_c⁄√˘i⁄s
 = 0;

225 
	`¥›_desc_li°_‰ì_h™dÀr_chaö
((
Pr›Des¸ùti⁄
 *)
group
->
pdesc
);

226 
	`g_‰ì
((
Pr›Des¸ùti⁄
 *)
group
->
pdesc
);

228 
	`obje˘_de°roy
(
obj
);

229 
	}
}

231 
DüObje˘
 *

232 
	$group_c›y
(
Group
 *
group
)

234 
Group
 *
√wgroup
;

235 
DüObje˘
 *
√wobj
, *
obj
;

236 
DüObje˘
 *
li°obj
;

237 
GLi°
 *
li°
;

238 
num_c⁄n
, 
i
;

240 
obj
 = &
group
->
obje˘
;

242 
√wgroup
 = 
	`g_√w0
(
Group
,1);

243 
√wobj
 = &
√wgroup
->
obje˘
;

245 
	`obje˘_c›y
(
obj
, 
√wobj
);

247 
i
=0;i<8;i++) {

248 
√wobj
->
h™dÀs
[
i
] = &
√wgroup
->
ªsize_h™dÀs
[i];

249 
√wgroup
->
ªsize_h™dÀs
[
i
] = 
group
->resize_handles[i];

252 
√wgroup
->
obje˘s
 = 
	`obje˘_c›y_li°
(
group
->objects);

255 
num_c⁄n
 = 0;

256 
li°
 = 
√wgroup
->
obje˘s
;

257 
li°
 !
NULL
) {

258 
li°obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

260 
i
=0;i<
li°obj
->
num_c⁄√˘i⁄s
;i++) {

262 
√wobj
->
c⁄√˘i⁄s
[
num_c⁄n
++] = 
li°obj
->c⁄√˘i⁄s[
i
];

265 
li°
 = 
	`g_li°_√xt
(list);

269 
√wgroup
->
pdesc
 = 
NULL
;

271  (
DüObje˘
 *)
√wgroup
;

272 
	}
}

276 
	$group_upd©e_d©a
(
Group
 *
group
)

278 
GLi°
 *
li°
;

279 
DüObje˘
 *
obj
;

281 i‡(
group
->
obje˘s
 !
NULL
) {

282 
li°
 = 
group
->
obje˘s
;

283 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

284 
group
->
obje˘
.
boundög_box
 = 
obj
->bounding_box;

286 
li°
 = 
	`g_li°_√xt
(list);

287 
li°
 !
NULL
) {

288 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

290 
	`ª˘™gÀ_uni⁄
(&
group
->
obje˘
.
boundög_box
, &
obj
->bounding_box);

292 
li°
 = 
	`g_li°_√xt
(list);

295 
obj
 = (
DüObje˘
 *Ë
group
->
obje˘s
->
d©a
;

299 
group
->
obje˘
.
posôi⁄
 = 
obj
->position;

301 
	`group_upd©e_h™dÀs
(
group
);

303 
	}
}

308 
DüObje˘
 *

309 
	$group_¸óã
(
GLi°
 *
obje˘s
)

311 
Group
 *
group
;

312 
DüObje˘
 *
obj
, *
∑π_obj
;

313 
i
;

314 
GLi°
 *
li°
;

315 
num_c⁄n
;

317 
group
 = 
	`g_√w0
(
Group
,1);

318 
obj
 = &
group
->
obje˘
;

320 
obj
->
ty≥
 = &
group_ty≥
;

322 
obj
->
›s
 = &
group_›s
;

324 
group
->
obje˘s
 = objects;

326 
group
->
pdesc
 = 
NULL
;

329 
num_c⁄n
 = 0;

330 
li°
 = 
obje˘s
;

331 
li°
 !
NULL
) {

332 
∑π_obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

334 
num_c⁄n
 +
∑π_obj
->
num_c⁄√˘i⁄s
;

336 
li°
 = 
	`g_li°_√xt
(list);

339 
	`obje˘_öô
(
obj
, 8, 
num_c⁄n
);

342 
num_c⁄n
 = 0;

343 
li°
 = 
obje˘s
;

344 
li°
 !
NULL
) {

345 
∑π_obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

347 
i
=0;i<
∑π_obj
->
num_c⁄√˘i⁄s
;i++) {

348 
obj
->
c⁄√˘i⁄s
[
num_c⁄n
++] = 
∑π_obj
->c⁄√˘i⁄s[
i
];

351 
li°
 = 
	`g_li°_√xt
(list);

354 
i
=0;i<8;i++) {

355 
obj
->
h™dÀs
[
i
] = &
group
->
ªsize_h™dÀs
[i];

356 
obj
->
h™dÀs
[
i
]->
ty≥
 = 
HANDLE_NON_MOVABLE
;

357 
obj
->
h™dÀs
[
i
]->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

358 
obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 = 
NULL
;

361 
	`group_upd©e_d©a
(
group
);

362  (
DüObje˘
 *)
group
;

363 
	}
}

365 
GLi°
 *

366 
	$group_obje˘s
(
DüObje˘
 *
group
)

368 
Group
 *
g
;

369 
g
 = (
Group
 *)
group
;

371  
g
->
obje˘s
;

372 
	}
}

374 
gboﬁón


375 
	$group_¥›_evít_dñivî
(
Group
 *
group
, 
Pr›îty
 *
¥›
)

377 
GLi°
 *
tmp
;

378 
tmp
 = 
group
->
obje˘s
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

379 
DüObje˘
 *
obj
 = 
tmp
->
d©a
;

381 i‡(
obj
->
›s
->
des¸ibe_¥›s
) {

382 c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,*
∂i°
;

385 
∂i°
 = 
obj
->
›s
->
	`des¸ibe_¥›s
(obj);

386 
pdesc
 = 
	`¥›_desc_li°_föd_¥›
(
∂i°
,
¥›
->
«me
);

387 i‡(
pdesc
 &&Ödesc->
evít_h™dÀr
) {

389 
Pr›EvítH™dÀr
 
hdl
 = 
	`¥›_desc_föd_ªÆ_h™dÀr
(
pdesc
);

390 i‡(
hdl
) {

391  
	`hdl
(
obj
,
¥›
);

393 
	`g_w¨nög
("dropped groupÉvent onÖrop %s, "

394 "föÆ h™dÀ∏wa†NULL",
¥›
->
«me
);

395  
FALSE
;

400 
	`g_w¨nög
("undñivîed grou∞¥›îtyÉvíàf‹Ör› %s",
¥›
->
«me
);

401  
FALSE
;

402 
	}
}

404 c⁄° 
Pr›Des¸ùti⁄
 *

405 
	$group_des¸ibe_¥›s
(
Group
 *
group
)

407 
i
;

408 i‡(
group
->
pdesc
 =
NULL
) {

412 
group
->
pdesc
 = 
	`obje˘_li°_gë_¥›_des¸ùti⁄s
(group->
obje˘s
, 
PROP_UNION
);

414 i‡(
group
->
pdesc
 !
NULL
) {

416 
i
=0; 
group
->
pdesc
[i].
«me
 !
NULL
; i++) {

417 i‡(
group
->
pdesc
[
i
].
evít_h™dÀr
)

418 
	`¥›_desc_ö£π_h™dÀr
((
Pr›Des¸ùti⁄
 *)&
group
->
pdesc
[
i
],

419 (
Pr›EvítH™dÀr
)
group_¥›_evít_dñivî
);

424  
group
->
pdesc
;

425 
	}
}

428 
	$group_gë_¥›s
(
Group
 *
group
, 
GPåAºay
 *
¥›s
)

430 
GLi°
 *
tmp
;

432 
tmp
 = 
group
->
obje˘s
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

433 
DüObje˘
 *
obj
 = 
tmp
->
d©a
;

435 i‡(
obj
->
›s
->
gë_¥›s
) {

436 
obj
->
›s
->
	`gë_¥›s
(obj, 
¥›s
);

439 
	}
}

442 
	$group_£t_¥›s
(
Group
 *
group
, 
GPåAºay
 *
¥›s
)

444 
GLi°
 *
tmp
;

446 
tmp
 = 
group
->
obje˘s
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

447 
DüObje˘
 *
obj
 = 
tmp
->
d©a
;

449 i‡(
obj
->
›s
->
£t_¥›s
) {

450 
obj
->
›s
->
	`£t_¥›s
(obj, 
¥›s
);

453 
	}
}

455 
GroupPr›Ch™ge
 *

456 
	$group_≠∂y_¥›îtõs_li°
(
Group
 *
group
, 
GPåAºay
 *
¥›s
)

458 
GLi°
 *
tmp
 = 
NULL
;

459 
GLi°
 *
˛i°
 = 
NULL
;

460 
GroupPr›Ch™ge
 *
ch™ge
 = 
NULL
;

461 
ch™ge
 = 
	`g_√w0
(
GroupPr›Ch™ge
, 1);

464 
ch™ge
->
obj_ch™ge
.
≠∂y
 =

465 (
Obje˘Ch™geAµlyFunc
Ë
group_¥›_ch™ge_≠∂y
;

466 
ch™ge
->
obj_ch™ge
.
ªvît
 =

467 (
Obje˘Ch™geRevîtFunc
Ë
group_¥›_ch™ge_ªvît
;

468 
ch™ge
->
obj_ch™ge
.
‰ì
 =

469 (
Obje˘Ch™geFªeFunc
Ë
group_¥›_ch™ge_‰ì
;

471 
ch™ge
->
group
 = group;

473 
tmp
 = 
group
->
obje˘s
;Åm∞!
NULL
;Åm∞
	`g_li°_√xt
(tmp)) {

474 
DüObje˘
 *
obj
 = (DüObje˘*)
tmp
->
d©a
;

475 
Obje˘Ch™ge
 *
objch™ge
 = 
NULL
;

477 
objch™ge
 = 
obj
->
›s
->
	`≠∂y_¥›îtõs_li°
(obj, 
¥›s
);

478 
˛i°
 = 
	`g_li°_≠≥nd
(˛i°, 
objch™ge
);

481 
ch™ge
->
ch™ges_≥r_obje˘
 = 
˛i°
;

483  
ch™ge
;

484 
	}
}

487 
	$group_¥›_ch™ge_≠∂y
(
GroupPr›Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

489 
GLi°
 *
tmp
;

491 
tmp
 = 
ch™ge
->
ch™ges_≥r_obje˘
;Åm∞!
NULL
;

492 
tmp
 = 
	`g_li°_√xt
(tmp)) {

493 
Obje˘Ch™ge
 *
obj_ch™ge
 = (Obje˘Ch™ge*)
tmp
->
d©a
;

503 
obj_ch™ge
->
	`≠∂y
(obj_ch™ge, 
NULL
);

505 
	}
}

508 
	$group_¥›_ch™ge_ªvît
(
GroupPr›Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

510 
GLi°
 *
tmp
;

512 
tmp
 = 
ch™ge
->
ch™ges_≥r_obje˘
;Åm∞!
NULL
;

513 
tmp
 = 
	`g_li°_√xt
(tmp)) {

514 
Obje˘Ch™ge
 *
obj_ch™ge
 = (Obje˘Ch™ge*)
tmp
->
d©a
;

524 
obj_ch™ge
->
	`ªvît
(obj_ch™ge, 
NULL
);

526 
	}
}

528 
	$group_¥›_ch™ge_‰ì
(
GroupPr›Ch™ge
 *
ch™ge
)

530 
GLi°
 *
tmp
;

531 
tmp
 = 
ch™ge
->
ch™ges_≥r_obje˘
;Åm∞!
NULL
;

532 
tmp
 = 
	`g_li°_√xt
(tmp)) {

533 
Obje˘Ch™ge
 *
obj_ch™ge
 = (Obje˘Ch™ge*)
tmp
->
d©a
;

534 
obj_ch™ge
->
	`‰ì
(obj_change);

535 
	`g_‰ì
(
obj_ch™ge
);

537 
	`g_li°_‰ì
(
ch™ge
->
ch™ges_≥r_obje˘
);

538 
	}
}

	@O:\tool\dvs50\lib\group.h

18 #i‚de‡
GROUP_H


19 
	#GROUP_H


	)

21 
	~"düv¨.h
"

22 
	~"obje˘.h
"

24 
DIAVAR
 
DüObje˘Ty≥
 
	ggroup_ty≥
;

29 
DIAVAR
 
DüObje˘
 *
group_¸óã
(
GLi°
 *
obje˘s
);

30 
DIAVAR
 
GLi°
 *
group_obje˘s
(
DüObje˘
 *
group
);

32 
DIAVAR
 
group_de°roy_shÆlow
(
DüObje˘
 *
group
);

34 
	#IS_GROUP
(
obj
Ë((obj)->
ty≥
 =&
group_ty≥
)

	)

	@O:\tool\dvs50\lib\handle.h

20 #i‚de‡
HANDLE_H


21 
	#HANDLE_H


	)

23 
	~"düty≥s.h
"

24 
	~"geomëry.h
"

28 
	mHANDLE_RESIZE_NW
,

29 
	mHANDLE_RESIZE_N
,

30 
	mHANDLE_RESIZE_NE
,

31 
	mHANDLE_RESIZE_W
,

32 
	mHANDLE_RESIZE_E
,

33 
	mHANDLE_RESIZE_SW
,

34 
	mHANDLE_RESIZE_S
,

35 
	mHANDLE_RESIZE_SE
,

36 
	mHANDLE_MOVE_STARTPOINT
,

37 
	mHANDLE_MOVE_ENDPOINT
,

40 
	mHANDLE_CUSTOM1
=200,

41 
	mHANDLE_CUSTOM2
,

42 
	mHANDLE_CUSTOM3
,

43 
	mHANDLE_CUSTOM4
,

44 
	mHANDLE_CUSTOM5
,

45 
	mHANDLE_CUSTOM6
,

46 
	mHANDLE_CUSTOM7
,

47 
	mHANDLE_CUSTOM8
,

48 
	mHANDLE_CUSTOM9


49 } 
	tH™dÀId
;

53 
	mHANDLE_NON_MOVABLE
,

54 
	mHANDLE_MAJOR_CONTROL
,

55 
	mHANDLE_MINOR_CONTROL
,

57 
	mNUM_HANDLE_TYPES


58 } 
	tH™dÀTy≥
;

62 
	mHANDLE_MOVE_USER
,

63 
	mHANDLE_MOVE_USER_FINAL
,

64 
	mHANDLE_MOVE_CONNECTED
,

65 
	mHANDLE_MOVE_CREATE
,

66 
	mHANDLE_MOVE_CREATE_FINAL


67 } 
	tH™dÀMoveRós⁄
;

71 
	mHANDLE_NONCONNECTABLE
,

72 
	mHANDLE_CONNECTABLE
,

73 
	mHANDLE_CONNECTABLE_NOBREAK


74 } 
	tH™dÀC⁄√˘Ty≥
;

79 
	s_H™dÀ
 {

80 
H™dÀId
 
	mid
;

81 
H™dÀTy≥
 
	mty≥
;

82 
Poöt
 
	mpos
;

84 
H™dÀC⁄√˘Ty≥
 
	mc⁄√˘_ty≥
;

85 
C⁄√˘i⁄Poöt
 *
	mc⁄√˘ed_to
;

	@O:\tool\dvs50\lib\intl.c

1 
	~<c⁄fig.h
>

3 
	~"öé.h
"

5 
	~<°dio.h
>

6 
	~<°dlib.h
>

7 
	~<°rög.h
>

9 #i‚de‡
GNOME


13 
GHashTabÀ
 *
	gÆüs_èbÀ
 = 
NULL
;

17 
	$ªad_Æü£s
 (*
fûe
)

19 
FILE
 *
Â
;

20 
buf
[256];

22 i‡(!
Æüs_èbÀ
)

23 
Æüs_èbÀ
 = 
	`g_hash_èbÀ_√w_fuŒ
 (
g_°r_hash
, 
g_°r_equÆ
,

24 
g_‰ì
, g_free);

25 
Â
 = 
	`f›í
 (
fûe
,"r");

26 i‡(!
Â
)

28 
	`fgës
 (
buf
,256,
Â
)) {

29 *
p
;

30 
	`g_°r°rù
(
buf
);

31 if(
buf
[0]=='#' || buf[0]=='\0')

33 
p
 = 
	`°πok
(
buf
,"\t ");

34 if(!
p
) ;

35 
p
 = 
	`°πok
(
NULL
,"\t ");

36 if(!
p
) ;

37 
	`g_hash_èbÀ_ö£π
 (
Æüs_èbÀ
, 
	`g_°rdup
(
buf
), g_°rdup(
p
));

39 
	`f˛o£
 (
Â
);

40 
	}
}

43 
	$‰ì_Æüs_èbÀ
()

45 i‡(!
Æüs_èbÀ
)

47 
	`g_hash_èbÀ_de°roy
(
Æüs_èbÀ
);

48 
Æüs_èbÀ
 = 
NULL
;

49 
	}
}

53 
	$u«lüs_œng
 (*
œng
)

55 *
p
;

57 if(!
Æüs_èbÀ
) {

58 
	`ªad_Æü£s
 ("/usr/share/locale/locale.alias");

59 
	`ªad_Æü£s
 ("/usr/local/share/locale/locale.alias");

60 
	`ªad_Æü£s
 ("/usr/lib/X11/locale/locale.alias");

61 
	`ªad_Æü£s
 ("/usr/openwin/lib/locale/locale.alias");

63 (
p
=
	`g_hash_èbÀ_lookup
(
Æüs_èbÀ
,
œng
)Ë&& 
	`°rcmp
(p,Üang))

64 
œng
 = 
p
;

65  
œng
;

66 
	}
}

73 
	mCOMPONENT_CODESET
 = 1 << 0,

74 
	mCOMPONENT_TERRITORY
 = 1 << 1,

75 
	mCOMPONENT_MODIFIER
 = 1 << 2

80 
guöt


81 
	$ex∂ode_loˇÀ
 (c⁄° 
gch¨
 *
loˇÀ
,

82 
gch¨
 **
œnguage
,

83 
gch¨
 **
ãºô‹y
,

84 
gch¨
 **
code£t
,

85 
gch¨
 **
modifõr
)

87 c⁄° 
gch¨
 *
usc‹e_pos
;

88 c⁄° 
gch¨
 *
©_pos
;

89 c⁄° 
gch¨
 *
dŸ_pos
;

91 
guöt
 
mask
 = 0;

93 
usc‹e_pos
 = 
	`°rchr
 (
loˇÀ
, '_');

94 
dŸ_pos
 = 
	`°rchr
 (
usc‹e_pos
 ? usc‹e_po†: 
loˇÀ
, '.');

95 
©_pos
 = 
	`°rchr
 (
dŸ_pos
 ? dŸ_po†: (
usc‹e_pos
 ? usc‹e_po†: 
loˇÀ
), '@');

97 i‡(
©_pos
) {

98 
mask
 |
COMPONENT_MODIFIER
;

99 *
modifõr
 = 
	`g_°rdup
 (
©_pos
);

101 
©_pos
 = 
loˇÀ
 + 
	`°æí
 (locale);

103 i‡(
dŸ_pos
) {

104 
mask
 |
COMPONENT_CODESET
;

105 *
code£t
 = 
	`g_√w
 (
gch¨
, 1 + 
©_pos
 - 
dŸ_pos
);

106 
	`°∫˝y
 (*
code£t
, 
dŸ_pos
, 
©_pos
 - dot_pos);

107 (*
code£t
)[
©_pos
 - 
dŸ_pos
] = '\0';

109 
dŸ_pos
 = 
©_pos
;

111 i‡(
usc‹e_pos
) {

112 
mask
 |
COMPONENT_TERRITORY
;

113 *
ãºô‹y
 = 
	`g_√w
 (
gch¨
, 1 + 
dŸ_pos
 - 
usc‹e_pos
);

114 
	`°∫˝y
 (*
ãºô‹y
, 
usc‹e_pos
, 
dŸ_pos
 - uscore_pos);

115 (*
ãºô‹y
)[
dŸ_pos
 - 
usc‹e_pos
] = '\0';

117 
usc‹e_pos
 = 
dŸ_pos
;

119 *
œnguage
 = 
	`g_√w
 (
gch¨
, 1 + 
usc‹e_pos
 - 
loˇÀ
);

120 
	`°∫˝y
 (*
œnguage
, 
loˇÀ
, 
usc‹e_pos
 -Üocale);

121 (*
œnguage
)[
usc‹e_pos
 - 
loˇÀ
] = '\0';

123  
mask
;

124 
	}
}

138 
GLi°
 *

139 
	$compuã_loˇÀ_v¨ü¡s
 (c⁄° 
gch¨
 *
loˇÀ
)

141 
GLi°
 *
ªtvÆ
 = 
NULL
;

143 
gch¨
 *
œnguage
;

144 
gch¨
 *
ãºô‹y
=
NULL
;

145 
gch¨
 *
code£t
=
NULL
;

146 
gch¨
 *
modifõr
=
NULL
;

148 
guöt
 
mask
;

149 
guöt
 
i
;

151 
	`g_ªtu∫_vÆ_if_Áû
 (
loˇÀ
 !
NULL
, NULL);

153 
mask
 = 
	`ex∂ode_loˇÀ
 (
loˇÀ
, &
œnguage
, &
ãºô‹y
, &
code£t
, &
modifõr
);

158 
i
=0; i<=
mask
; i++)

159 i‡((
i
 & ~
mask
) == 0)

161 
gch¨
 *
vÆ
 = 
	`g_°rc⁄ˇt
(
œnguage
,

162 (
i
 & 
COMPONENT_TERRITORY
Ë? 
ãºô‹y
 : "",

163 (
i
 & 
COMPONENT_CODESET
Ë? 
code£t
 : "",

164 (
i
 & 
COMPONENT_MODIFIER
Ë? 
modifõr
 : "",

165 
NULL
);

166 
ªtvÆ
 = 
	`g_li°_¥ïíd
 (ªtvÆ, 
vÆ
);

169 
	`g_‰ì
 (
œnguage
);

170 i‡(
mask
 & 
COMPONENT_CODESET
)

171 
	`g_‰ì
 (
code£t
);

172 i‡(
mask
 & 
COMPONENT_TERRITORY
)

173 
	`g_‰ì
 (
ãºô‹y
);

174 i‡(
mask
 & 
COMPONENT_MODIFIER
)

175 
	`g_‰ì
 (
modifõr
);

177  
ªtvÆ
;

178 
	}
}

183 c⁄° 
gch¨
 *

184 
	$guess_ˇãg‹y_vÆue
 (c⁄° 
gch¨
 *
ˇãg‹y«me
)

186 c⁄° 
gch¨
 *
ªtvÆ
;

190 
ªtvÆ
 = 
	`gëív
 ("LANGUAGE");

191 i‡(
ªtvÆ
 !
NULL
 &&Ñetval[0] != '\0')

192  
ªtvÆ
;

199 
ªtvÆ
 = 
	`gëív
 ("LC_ALL");

200 i‡(
ªtvÆ
 !
NULL
 &&Ñetval[0] != '\0')

201  
ªtvÆ
;

204 
ªtvÆ
 = 
	`gëív
 (
ˇãg‹y«me
);

205 i‡(
ªtvÆ
 !
NULL
 &&Ñetval[0] != '\0')

206  
ªtvÆ
;

209 
ªtvÆ
 = 
	`gëív
 ("LANG");

210 i‡(
ªtvÆ
 !
NULL
 &&Ñetval[0] != '\0')

211  
ªtvÆ
;

213  
NULL
;

214 
	}
}

216 
GLi°
 *

217 
	$gë_œnguage_li°
(c⁄° 
gch¨
 *
ˇãg‹y_«me
)

219 
GLi°
 *
li°
 = 
NULL
;

220 
göt
 
c_loˇÀ_deföed

FALSE
;

222 c⁄° 
gch¨
 *
ˇãg‹y_vÆue
;

223 
gch¨
 *
ˇãg‹y_mem‹y
, *
‹ig_ˇãg‹y_mem‹y
;

225 i‡(!
ˇãg‹y_«me
)

226 
ˇãg‹y_«me
= "LC_ALL";

228 
ˇãg‹y_vÆue
 = 
	`guess_ˇãg‹y_vÆue
 (
ˇãg‹y_«me
);

229 i‡(! 
ˇãg‹y_vÆue
)

230 
ˇãg‹y_vÆue
 = "C";

231 
‹ig_ˇãg‹y_mem‹y
 = 
ˇãg‹y_mem‹y
 =

232 
	`g_mÆloc
 (
	`°æí
 (
ˇãg‹y_vÆue
)+1);

234 
ˇãg‹y_vÆue
[0] != '\0') {

235 
ˇãg‹y_vÆue
[0] != '\0' && category_value[0] == ':')

236 ++
ˇãg‹y_vÆue
;

238 i‡(
ˇãg‹y_vÆue
[0] != '\0') {

239 *
˝

ˇãg‹y_mem‹y
;

241 
ˇãg‹y_vÆue
[0] != '\0' && category_value[0] != ':')

242 *
ˇãg‹y_mem‹y
++*
ˇãg‹y_vÆue
++;

244 
ˇãg‹y_mem‹y
[0]= '\0';

245 
ˇãg‹y_mem‹y
++;

247 
˝
 = 
	`u«lüs_œng
(cp);

249 i‡(
	`°rcmp
 (
˝
, "C") == 0)

250 
c_loˇÀ_deföed

TRUE
;

252 
li°

	`g_li°_c⁄ˇt
 (li°, 
	`compuã_loˇÀ_v¨ü¡s
 (
˝
));

256 
	`g_‰ì
 (
‹ig_ˇãg‹y_mem‹y
);

258 i‡(!
c_loˇÀ_deföed
)

259 
li°

	`g_li°_≠≥nd
 (list, "C");

261  
li°
;

262 
	}
}

266 c⁄° 
GLi°
 *

267 
	$öé_gë_œnguage_li°
()

269 c⁄° 
GLi°
 *
li°
 = 
NULL
;

271 i‡(!
li°
) {

272 #ifde‡
GNOME


273 
li°
 = 
	`gnome_i18n_gë_œnguage_li°
("LC_MESSAGES");

275 
li°
 = 
	`gë_œnguage_li°
("LC_MESSAGES");

276 
	`‰ì_Æüs_èbÀ
();

279  
li°
;

280 
	}
}

284 
	$öé_sc‹e_loˇÀ
(c⁄° 
gch¨
 *
loˇÀ
)

286 c⁄° 
GLi°
 *
li°
 = 
	`öé_gë_œnguage_li°
();

287 c⁄° 
GLi°
 *
tmp
;

288 
i
;

291 i‡(!
loˇÀ
)

292  
	`g_li°_Àngth
((
GLi°
*)
li°
) - 1;

293 
tmp
 = 
li°
, 
i
 = 0;Åmp;Åm∞tmp->
√xt
, i++)

294 i‡(!
	`°rcmp
((c⁄° *)
tmp
->
d©a
, 
loˇÀ
))

296 i‡(!
tmp
)

297 
i
 = 
G_MAXINT
;

298  
i
;

299 
	}
}

	@O:\tool\dvs50\lib\intl.h

1 #i‚de‡
INTL_H


2 
	#INTL_H


	)

4 
	~<glib.h
>

5 
	~"düv¨.h
"

6 #ifde‡
GNOME


7 
	~<libgnome/gnome-i18n.h
>

9 #ifde‡
ENABLE_NLS


10 
	~<liböé.h
>

11 
	#_
(
Såög
Ë
	`gëãxt
(Såög)

	)

12 #ifde‡
gëãxt_no›


13 
	#N_
(
Såög
Ë
	`gëãxt_no›
(Såög)

	)

15 
	#N_
(
Såög
Ë(Såög)

	)

18 
	#_
(
Såög
Ë(Såög)

	)

19 
	#N_
(
Såög
Ë(Såög)

	)

20 
	#gëãxt
(
Såög
Ë(Såög)

	)

21 
	#ãxtdomaö
(
Domaö
)

	)

22 
	#bödãxtdomaö
(
Package
, 
Dúe˘‹y
)

	)

26 c⁄° 
GLi°
 *
öé_gë_œnguage_li°
 ();

27 
DIAVAR
 
öé_sc‹e_loˇÀ
 (c⁄° 
gch¨
 *
loˇÀ
);

	@O:\tool\dvs50\lib\layer.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~"öé.h
"

24 
	~"dügømd©a.h
"

25 
	~"düªndîî.h
"

26 
	~"dy«mic_obj.h
"

28 c⁄° 
Re˘™gÀ
 
	gövÆid_exã¡s
 = { -1.0,-1.0,-1.0,-1.0 };

38 
	$n‹mÆ_ªndî
(
DüObje˘
 *
obj
, 
DüRídîî
 *
ªndîî
,

39 
a˘ive_œyî
,

40 
gpoöãr
 
d©a
)

42 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_obje˘
‘ídîî, 
obj
);

43 
	}
}

46 
	gªndî_boundög_boxes
 = 
FALSE
;

59 
	$œyî_ªndî
(
Layî
 *
œyî
, 
DüRídîî
 *
ªndîî
, 
Re˘™gÀ
 *
upd©e
,

60 
Obje˘Rídîî
 
obj_ªndîî
,

61 
gpoöãr
 
d©a
,

62 
a˘ive_œyî
)

64 
GLi°
 *
li°
;

65 
DüObje˘
 *
obj
;

67 i‡(
obj_ªndîî
 =
NULL
)

68 
obj_ªndîî
 = 
n‹mÆ_ªndî
;

71 
li°
 = 
œyî
->
obje˘s
;

72 
li°
!=
NULL
) {

73 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

75 i‡(
upd©e
==
NULL
 || 
	`ª˘™gÀ_öãr£˘s
(upd©e, &
obj
->
boundög_box
)) {

76 i‡((
ªndî_boundög_boxes
Ë&& (
ªndîî
->
is_öãø˘ive
)) {

77 
Poöt
 
p1
, 
p2
;

78 
Cﬁ‹
 
cﬁ
;

79 
p1
.
x
 = 
obj
->
boundög_box
.
À·
;

80 
p1
.
y
 = 
obj
->
boundög_box
.
t›
;

81 
p2
.
x
 = 
obj
->
boundög_box
.
right
;

82 
p2
.
y
 = 
obj
->
boundög_box
.
bŸtom
;

83 
cﬁ
.
ªd
 = 1.0;

84 
cﬁ
.
gªí
 = 0.0;

85 
cﬁ
.
blue
 = 1.0;

87 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
(renderer,0.01);

88 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_ª˘
‘ídîî, &
p1
, &
p2
, &
cﬁ
);

90 (*
obj_ªndîî
)(
obj
, 
ªndîî
, 
a˘ive_œyî
, 
d©a
);

93 
li°
 = 
	`g_li°_√xt
(list);

95 
	}
}

102 
	$£t_∑ª¡_œyî
(
gpoöãr
 
ñemít
, gpoöã∏
u£r_d©a
)

104 ((
DüObje˘
*)
ñemít
)->
∑ª¡_œyî
 = (
Layî
*)
u£r_d©a
;

109 
	}
}

122 
	$œyî_obje˘_ödex
(
Layî
 *
œyî
, 
DüObje˘
 *
obj
)

124  ()
	`g_li°_ödex
(
œyî
->
obje˘s
, (
gpoöãr
Ë
obj
);

125 
	}
}

135 
	$œyî_add_obje˘
(
Layî
 *
œyî
, 
DüObje˘
 *
obj
)

137 
œyî
->
obje˘s
 = 
	`g_li°_≠≥nd
÷ayî->obje˘s, (
gpoöãr
Ë
obj
);

138 
	`£t_∑ª¡_œyî
(
obj
, 
œyî
);

141 
	`d©a_emô
 (
	`œyî_gë_∑ª¡_dügøm
(
œyî
),Üayî, 
obj
, "object_add");

142 
	}
}

151 
	$œyî_add_obje˘_©
(
Layî
 *
œyî
, 
DüObje˘
 *
obj
, 
pos
)

153 
œyî
->
obje˘s
 = 
	`g_li°_ö£π
÷ayî->obje˘s, (
gpoöãr
Ë
obj
, 
pos
);

154 
	`£t_∑ª¡_œyî
(
obj
, 
œyî
);

157 
	`d©a_emô
 (
	`œyî_gë_∑ª¡_dügøm
(
œyî
),Üayî, 
obj
, "object_add");

158 
	}
}

167 
	$œyî_add_obje˘s
(
Layî
 *
œyî
, 
GLi°
 *
obj_li°
)

169 
GLi°
 *
li°
 = 
obj_li°
;

171 
œyî
->
obje˘s
 = 
	`g_li°_c⁄ˇt
÷ayî->obje˘s, 
obj_li°
);

172 
	`g_li°_f‹óch
(
obj_li°
, 
£t_∑ª¡_œyî
, 
œyî
);

174 
li°
 !
NULL
)

176 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

178 
	`d©a_emô
 (
	`œyî_gë_∑ª¡_dügøm
(
œyî
),Üayî, 
obj
, "object_add");

180 
li°
 = 
	`g_li°_√xt
(list);

182 
	}
}

191 
	$œyî_add_obje˘s_fú°
(
Layî
 *
œyî
, 
GLi°
 *
obj_li°
)

193 
GLi°
 *
li°
 = 
obj_li°
;

195 
œyî
->
obje˘s
 = 
	`g_li°_c⁄ˇt
(
obj_li°
,Üayer->objects);

196 
	`g_li°_f‹óch
(
obj_li°
, 
£t_∑ª¡_œyî
, 
œyî
);

199 
li°
 !
NULL
)

201 
DüObje˘
 *
obj
 = (DüObje˘ *)
li°
->
d©a
;

203 
	`d©a_emô
 (
	`œyî_gë_∑ª¡_dügøm
(
œyî
),Üayî, 
obj
, "object_add");

205 
li°
 = 
	`g_li°_√xt
(list);

208 
	}
}

216 
	$œyî_ªmove_obje˘
(
Layî
 *
œyî
, 
DüObje˘
 *
obj
)

218 
œyî
->
obje˘s
 = 
	`g_li°_ªmove
÷ayî->obje˘s, 
obj
);

219 
	`dynobj_li°_ªmove_obje˘
(
obj
);

220 
	`£t_∑ª¡_œyî
(
obj
, 
NULL
);

223 
	`d©a_emô
 (
	`œyî_gë_∑ª¡_dügøm
(
œyî
),Üayî, 
obj
, "object_remove");

224 
	}
}

232 
	$œyî_ªmove_obje˘s
(
Layî
 *
œyî
, 
GLi°
 *
obj_li°
)

234 
DüObje˘
 *
obj
;

235 
obj_li°
 !
NULL
) {

236 
obj
 = (
DüObje˘
 *Ë
obj_li°
->
d©a
;

238 
œyî
->
obje˘s
 = 
	`g_li°_ªmove
÷ayî->obje˘s, 
obj
);

240 
obj_li°
 = 
	`g_li°_√xt
(obj_list);

241 
	`dynobj_li°_ªmove_obje˘
(
obj
);

242 
	`£t_∑ª¡_œyî
(
obj
, 
NULL
);

244 
	`d©a_emô
 (
	`œyî_gë_∑ª¡_dügøm
(
œyî
),Üayî, 
obj
, "object_remove");

246 
	}
}

254 
GLi°
 *

255 
	$œyî_föd_obje˘s_öãr£˘ög_ª˘™gÀ
(
Layî
 *
œyî
, 
Re˘™gÀ
 *
ª˘
)

257 
GLi°
 *
li°
;

258 
GLi°
 *
£À˘ed_li°
;

259 
DüObje˘
 *
obj
;

261 
£À˘ed_li°
 = 
NULL
;

262 
li°
 = 
œyî
->
obje˘s
;

263 
li°
 !
NULL
) {

264 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

266 i‡(
	`ª˘™gÀ_öãr£˘s
(
ª˘
, &
obj
->
boundög_box
)) {

267 i‡(
	`dü_obje˘_is_£À˘abÀ
(
obj
)) {

268 
£À˘ed_li°
 = 
	`g_li°_¥ïíd
(£À˘ed_li°, 
obj
);

275 
li°
 = 
	`g_li°_√xt
(list);

278  
£À˘ed_li°
;

279 
	}
}

287 
GLi°
 *

288 
	$œyî_föd_obje˘s_ö_ª˘™gÀ
(
Layî
 *
œyî
, 
Re˘™gÀ
 *
ª˘
)

290 
GLi°
 *
li°
;

291 
GLi°
 *
£À˘ed_li°
;

292 
DüObje˘
 *
obj
;

294 
£À˘ed_li°
 = 
NULL
;

295 
li°
 = 
œyî
->
obje˘s
;

296 
li°
 !
NULL
) {

297 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

299 i‡(
	`ª˘™gÀ_ö_ª˘™gÀ
(
ª˘
, &
obj
->
boundög_box
)) {

300 i‡(
	`dü_obje˘_is_£À˘abÀ
(
obj
)) {

301 
£À˘ed_li°
 = 
	`g_li°_¥ïíd
(£À˘ed_li°, 
obj
);

305 
li°
 = 
	`g_li°_√xt
(list);

308  
£À˘ed_li°
;

309 
	}
}

317 
GLi°
 *

318 
	$œyî_föd_obje˘s_c⁄èöög_ª˘™gÀ
(
Layî
 *
œyî
, 
Re˘™gÀ
 *
ª˘
)

320 
GLi°
 *
li°
;

321 
GLi°
 *
£À˘ed_li°
;

322 
DüObje˘
 *
obj
;

324 
£À˘ed_li°
 = 
NULL
;

325 
li°
 = 
œyî
->
obje˘s
;

326 
li°
 !
NULL
) {

327 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

329 i‡(
	`ª˘™gÀ_ö_ª˘™gÀ
(&
obj
->
boundög_box
, 
ª˘
)) {

330 i‡(
	`dü_obje˘_is_£À˘abÀ
(
obj
)) {

331 
£À˘ed_li°
 = 
	`g_li°_¥ïíd
(£À˘ed_li°, 
obj
);

335 
li°
 = 
	`g_li°_√xt
(list);

338  
£À˘ed_li°
;

339 
	}
}

352 
DüObje˘
 *

353 
	$œyî_föd_˛o£°_obje˘_ex˚±
(
Layî
 *
œyî
, 
Poöt
 *
pos
,

354 
ªÆ
 
maxdi°
, 
GLi°
 *
avoid
)

356 
GLi°
 *
l
;

357 
DüObje˘
 *
˛o£°
;

358 
DüObje˘
 *
obj
;

359 
ªÆ
 
di°
;

360 
GLi°
 *
avoid_tmp
;

362 
˛o£°
 = 
NULL
;

364 
l
 = 
œyî
->
obje˘s
;Ü!=
NULL
;Ü = 
	`g_li°_√xt
(l)) {

365 
obj
 = (
DüObje˘
 *Ë
l
->
d©a
;

368 
di°
 = 
obj
->
›s
->
	`di°™˚_‰om
(obj, 
pos
);

370 i‡(
maxdi°
-
di°
 > 0.00000001) {

371 
avoid_tmp
 = 
avoid
;ávoid_tm∞!
NULL
;ávoid_tm∞avoid_tmp->
√xt
) {

372 i‡(
avoid_tmp
->
d©a
 =
obj
) {

373 
NEXTOBJECT
;

376 
˛o£°
 = 
obj
;

378 
NEXTOBJECT
:

383 
˛o£°
 = 
	`dü_obje˘_gë_∑ª¡_wôh_Êags
(closest,

384 
DIA_OBJECT_GRABS_CHILD_INPUT
);

386  
˛o£°
;

387 
	}
}

397 
DüObje˘
 *

398 
	$œyî_föd_˛o£°_obje˘
(
Layî
 *
œyî
, 
Poöt
 *
pos
, 
ªÆ
 
maxdi°
)

400  
	`œyî_föd_˛o£°_obje˘_ex˚±
(
œyî
, 
pos
, 
maxdi°
, 
NULL
);

401 
	}
}

411 
ªÆ


412 
	$œyî_föd_˛o£°_c⁄√˘i⁄poöt
(
Layî
 *
œyî
,

413 
C⁄√˘i⁄Poöt
 **
˛o£°
,

414 
Poöt
 *
pos
,

415 
DüObje˘
 *
nŸthis
)

417 
GLi°
 *
l
;

418 
DüObje˘
 *
obj
;

419 
C⁄√˘i⁄Poöt
 *
˝
;

420 
ªÆ
 
mödi°
, 
di°
;

421 
i
;

423 
mödi°
 = 1000000.0;

425 *
˛o£°
 = 
NULL
;

427 
l
 = 
œyî
->
obje˘s
;Ü!=
NULL
;Ü = 
	`g_li°_√xt
(l) ) {

428 
obj
 = (
DüObje˘
 *Ë
l
->
d©a
;

430 i‡(
obj
 =
nŸthis
) ;

431 i‡(
obj
 !
	`dü_obje˘_gë_∑ª¡_wôh_Êags
(obj, 
DIA_OBJECT_GRABS_CHILD_INPUT
))

433 
i
=0;i<
obj
->
num_c⁄√˘i⁄s
;i++) {

434 
˝
 = 
obj
->
c⁄√˘i⁄s
[
i
];

436 
di°
 = 
	`di°™˚_poöt_poöt_m™h©èn
(
pos
, &
˝
->pos);

437 i‡(
di°
<
mödi°
) {

438 
mödi°
 = 
di°
;

439 *
˛o£°
 = 
˝
;

445  
mödi°
;

446 
	}
}

449 
	$œyî_upd©e_exã¡s
(
Layî
 *
œyî
)

451 
GLi°
 *
l
;

452 
DüObje˘
 *
obj
;

453 
Re˘™gÀ
 
√w_exã¡s
;

455 
l
 = 
œyî
->
obje˘s
;

456 i‡(
l
!=
NULL
) {

457 
obj
 = (
DüObje˘
 *Ë
l
->
d©a
;

458 
√w_exã¡s
 = 
obj
->
boundög_box
;

459 
l
 = 
	`g_li°_√xt
(l);

461 
l
!=
NULL
) {

462 c⁄° 
Re˘™gÀ
 *
bbox
;

463 
obj
 = (
DüObje˘
 *Ë
l
->
d©a
;

465 
bbox
 = &
obj
->
boundög_box
;

466 i‡(
bbox
->
right
 > bbox->
À·
 && bbox->
bŸtom
 > bbox->
t›
)

467 
	`ª˘™gÀ_uni⁄
(&
√w_exã¡s
, &
obj
->
boundög_box
);

468 
l
 = 
	`g_li°_√xt
(l);

471 
√w_exã¡s
 = 
övÆid_exã¡s
;

474 i‡(
	`ª˘™gÀ_equÆs
(&
√w_exã¡s
,&
œyî
->
exã¡s
)Ë 
FALSE
;

476 
œyî
->
exã¡s
 = 
√w_exã¡s
;

477  
TRUE
;

478 
	}
}

481 
	$œyî_ª∂a˚_obje˘_wôh_li°
(
Layî
 *
œyî
, 
DüObje˘
 *
ªmove_obj
,

482 
GLi°
 *
ö£π_li°
)

484 
GLi°
 *
li°
;

486 
li°
 = 
	`g_li°_föd
(
œyî
->
obje˘s
, 
ªmove_obj
);

488 
	`g_as£π
(
li°
!=
NULL
);

489 
	`£t_∑ª¡_œyî
(
ªmove_obj
, 
NULL
);

490 
	`dynobj_li°_ªmove_obje˘
(
ªmove_obj
);

491 
	`g_li°_f‹óch
(
ö£π_li°
, 
£t_∑ª¡_œyî
, 
œyî
);

493 i‡(
li°
->
¥ev
 =
NULL
) {

494 
œyî
->
obje˘s
 = 
ö£π_li°
;

496 
li°
->
¥ev
->
√xt
 = 
ö£π_li°
;

497 
ö£π_li°
->
¥ev
 = 
li°
->prev;

499 i‡(
li°
->
√xt
 !
NULL
) {

500 
GLi°
 *
œ°
;

501 
œ°
 = 
	`g_li°_œ°
(
ö£π_li°
);

502 
œ°
->
√xt
 = 
li°
->next;

503 
li°
->
√xt
->
¥ev
 = 
œ°
;

505 
	`g_li°_‰ì_1
(
li°
);

506 
	}
}

509 
	$œyî_ªmove_dynobj
(
gpoöãr
 
obj
, gpoöã∏
u£rd©a
)

511 
	`dynobj_li°_ªmove_obje˘
((
DüObje˘
*)
obj
);

512 
	}
}

514 
	$œyî_£t_obje˘_li°
(
Layî
 *
œyî
, 
GLi°
 *
li°
)

516 
	`g_li°_f‹óch
(
œyî
->
obje˘s
, 
£t_∑ª¡_œyî
, 
NULL
);

517 
	`g_li°_f‹óch
(
œyî
->
obje˘s
, 
œyî_ªmove_dynobj
, 
NULL
);

518 
	`g_li°_‰ì
(
œyî
->
obje˘s
);

519 
œyî
->
obje˘s
 = 
li°
;

520 
	`g_li°_f‹óch
(
œyî
->
obje˘s
, 
£t_∑ª¡_œyî
,Üayer);

521 
	}
}

523 
DügømD©a
 *

524 
	$œyî_gë_∑ª¡_dügøm
(
Layî
 *
œyî
)

526  
œyî
->
∑ª¡_dügøm
;

527 
	}
}

	@O:\tool\dvs50\lib\message.c

19 
	~<c⁄fig.h
>

21 
	~<°dio.h
>

22 
	~<°rög.h
>

23 
	~<°d¨g.h
>

24 
	#G_LOG_DOMAIN
 "Dü"

	)

25 
	~<gtk/gtk.h
>

26 
	~<glib.h
>

28 
	~"öé.h
"

29 
	~"utûs.h
"

30 
	~"mesßge.h
"

31 
	~"≥rsi°í˚.h
"

33 
GHashTabÀ
 *
	gmesßge_hash_èbÀ
;

36 c⁄° 
gch¨
 *
	mtôÀ
;

37 
GtkWidgë
 *
	mdülog
;

38 
GtkWidgë
 *
	mª≥©_œbñ
;

39 
GLi°
 *
	mª≥©s
;

40 
GtkWidgë
 *
	mª≥©_võw
;

41 
GtkWidgë
 *
	mshow_ª≥©s
;

42 
GtkWidgë
 *
	mno_show_agaö
;

43 } 
	tDüMesßgeInfo
;

46 
	$gtk_mesßge_toggÀ_ª≥©s
(
GtkWidgë
 *
buâ⁄
, 
gpoöãr
 *
u£rd©a
) {

47 
DüMesßgeInfo
 *
msgöfo
 = (DüMesßgeInfo*)
u£rd©a
;

48 i‡(
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
buâ⁄
)))

49 
	`gtk_widgë_show
(
msgöfo
->
ª≥©_võw
);

51 
	`gtk_widgë_hide
(
msgöfo
->
ª≥©_võw
);

52 
	`gtk_c⁄èöî_check_ªsize
(
	`GTK_CONTAINER
(
msgöfo
->
dülog
));

54 
	}
}

57 
	$gtk_mesßge_toggÀ_show_agaö
(
GtkWidgë
 *
buâ⁄
, 
gpoöãr
 *
u£rd©a
)

59 
DüMesßgeInfo
 *
msgöfo
 = (DüMesßgeInfo*)
u£rd©a
;

60 
	`≥rsi°í˚_£t_boﬁón
(
msgöfo
->
tôÀ
,

61 
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
buâ⁄
)));

62 
	}
}

65 
	$mesßge_dülog_de°royed
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
u£rd©a
)

67 
DüMesßgeInfo
 *
msgöfo
 = (DüMesßgeInfÿ*)
u£rd©a
;

69 
msgöfo
->
tôÀ
 = 
NULL
;

70 
msgöfo
->
dülog
 = 
NULL
;

71 
msgöfo
->
ª≥©_œbñ
 = 
NULL
;

72 
msgöfo
->
ª≥©_võw
 = 
NULL
;

73 
msgöfo
->
show_ª≥©s
 = 
NULL
;

74 
msgöfo
->
no_show_agaö
 = 
NULL
;

75 
	}
}

81 
	$mesßge_¸óã_dülog
(c⁄° 
gch¨
 *
tôÀ
, 
DüMesßgeInfo
 *
msgöfo
, gch¨ *
buf
)

83 
GtkWidgë
 *
dülog
 = 
NULL
;

84 
GtkTextBuf„r
 *
ãxtbuf„r
;

85 
GtkMesßgeTy≥
 
ty≥
 = 
GTK_MESSAGE_INFO
;

86 
GLi°
 *
ª≥©s
;

89 i‡(
tôÀ
) {

90 i‡(0 =
	`°rcmp
 (
tôÀ
, 
	`_
("Error")))

91 
ty≥
 = 
GTK_MESSAGE_ERROR
;

92 i‡(0 =
	`°rcmp
 (
tôÀ
, 
	`_
("Warning")))

93 
ty≥
 = 
GTK_MESSAGE_WARNING
;

95 i‡(
msgöfo
->
ª≥©s
 !
NULL
)

96 
buf
 = (
gch¨
 *)
msgöfo
->
ª≥©s
->
d©a
;

97 
dülog
 = 
	`gtk_mesßge_dülog_√w
 (
NULL
,

99 
ty≥
,

100 
GTK_BUTTONS_CLOSE
,

101 "%s", 
buf
);

102 i‡(
tôÀ
) {

103 
gch¨
 *
ªÆ_tôÀ
;

105 
msgöfo
->
tôÀ
 =Åitle;

106 
ªÆ_tôÀ
 = 
	`g_°rdup_¥ötf
 ("Dü: %s", 
tôÀ
);

107 
	`gtk_wödow_£t_tôÀ
 (
	`GTK_WINDOW
(
dülog
), 
ªÆ_tôÀ
);

108 
	`g_‰ì
 (
ªÆ_tôÀ
);

110 
	`gtk_widgë_show
 (
dülog
);

111 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
dülog
), "response",

112 
	`G_CALLBACK
 (
gtk_widgë_hide
),

113 
NULL
);

114 
msgöfo
->
dülog
 = dialog;

115 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
dülog
), "destroy",

116 
	`G_CALLBACK
 (
mesßge_dülog_de°royed
),

117 
msgöfo
);

119 
msgöfo
->
ª≥©_œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("There is one similar message."));

120 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
msgöfo
->
dülog
)->
vbox
),

121 
msgöfo
->
ª≥©_œbñ
);

123 
msgöfo
->
show_ª≥©s
 =

124 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("ShowÑepeated messages"));

125 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
msgöfo
->
dülog
)->
vbox
),

126 
msgöfo
->
show_ª≥©s
);

127 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
msgöfo
->
show_ª≥©s
), "toggled",

128 
	`G_CALLBACK
(
gtk_mesßge_toggÀ_ª≥©s
), 
msgöfo
);

130 
msgöfo
->
ª≥©_võw
 = 
	`gtk_ãxt_võw_√w
();

131 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
msgöfo
->
dülog
)->
vbox
),

132 
msgöfo
->
ª≥©_võw
);

133 
	`gtk_ãxt_võw_£t_edôabÀ
(
	`GTK_TEXT_VIEW
(
msgöfo
->
ª≥©_võw
), 
FALSE
);

135 
ãxtbuf„r
 = 
	`gtk_ãxt_võw_gë_buf„r
(
	`GTK_TEXT_VIEW
(
msgöfo
->
ª≥©_võw
));

136 i‡(
msgöfo
->
ª≥©s
 !
NULL
) {

137 
ª≥©s
 = 
msgöfo
->repeats;

138 
ª≥©s
 =Ñïóts->
√xt
;

139 ; 
ª≥©s
 !
NULL
;Ñïót†ª≥©s->
√xt
) {

140 
	`gtk_ãxt_buf„r_ö£π_©_curs‹
(
ãxtbuf„r
, (
gch¨
*)
ª≥©s
->
d©a
, -1);

144 
msgöfo
->
no_show_agaö
 =

145 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Don't showÅhis messageágain"));

146 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
msgöfo
->
dülog
)->
vbox
),

147 
msgöfo
->
no_show_agaö
);

148 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
msgöfo
->
no_show_agaö
), "toggled",

149 
	`G_CALLBACK
(
gtk_mesßge_toggÀ_show_agaö
), 
msgöfo
);

150 
	}
}

153 
	$gtk_mesßge_öã∫Æ
(c⁄° * 
tôÀ
, 
ShowAgaöStyÀ
 
showAgaö
,

154 c⁄° *
fmt
,

155 
va_li°
 *
¨gs
, va_li° *
¨gs2
)

157 
gch¨
 *
buf
 = 
NULL
;

158 
göt
 
Æloc
 = 0;

159 
göt
 
Àn
;

160 
DüMesßgeInfo
 *
msgöfo
;

161 
GtkTextBuf„r
 *
ãxtbuf„r
;

162 
gboﬁón
 
askF‹ShowAgaö
 = 
FALSE
;

164 i‡(
showAgaö
 !
ALWAYS_SHOW
) {

167 
	`≥rsi°í˚_ªgi°î_boﬁón
((
gch¨
 *)
tôÀ
, 
FALSE
);

168 i‡(
	`≥rsi°í˚_gë_boﬁón
((
gch¨
 *)
tôÀ
)) {

172 
askF‹ShowAgaö
 = 
TRUE
;

175 i‡(
mesßge_hash_èbÀ
 =
NULL
) {

176 
mesßge_hash_èbÀ
 = 
	`g_hash_èbÀ_√w
(
g_°r_hash
, 
g_°r_equÆ
);

179 
Àn
 = 
	`f‹m©_°rög_Àngth_uµî_bound
 (
fmt
, 
¨gs
);

181 i‡(
Àn
 >
Æloc
) {

182 i‡(
buf
)

183 
	`g_‰ì
 (
buf
);

185 
Æloc
 = 
	`√¨e°_pow
 (
	`MAX
(
Àn
 + 1, 1024));

187 
buf
 = 
	`g_√w
 (, 
Æloc
);

190 
	`v•rötf
 (
buf
, 
fmt
, *
¨gs2
);

192 
msgöfo
 = (
DüMesßgeInfo
*)
	`g_hash_èbÀ_lookup
(
mesßge_hash_èbÀ
, 
fmt
);

193 i‡(
msgöfo
 =
NULL
) {

194 
msgöfo
 = 
	`g_√w0
(
DüMesßgeInfo
, 1);

195 
	`g_hash_èbÀ_ö£π
(
mesßge_hash_èbÀ
, (*)
fmt
, 
msgöfo
);

197 i‡(
msgöfo
->
dülog
 =
NULL
)

198 
	`mesßge_¸óã_dülog
(
tôÀ
, 
msgöfo
, 
buf
);

200 i‡(
msgöfo
->
ª≥©s
 !
NULL
) {

201 i‡(
	`g_li°_Àngth
(
msgöfo
->
ª≥©s
) > 1) {

202 *
√wœbñ
;

203 
√wœbñ
 = 
	`g_°rdup_¥ötf
(
	`_
("Thereáre %d similar messages."),

204 
	`g_li°_Àngth
(
msgöfo
->
ª≥©s
));

205 
	`gtk_œbñ_£t_ãxt
(
	`GTK_LABEL
(
msgöfo
->
ª≥©_œbñ
), 
√wœbñ
);

207 
	`gtk_widgë_show
(
msgöfo
->
ª≥©_œbñ
);

208 
	`gtk_widgë_show
(
msgöfo
->
show_ª≥©s
);

212 i‡(
msgöfo
->
ª≥©s
 !
NULL
) {

213 
ãxtbuf„r
 = 
	`gtk_ãxt_võw_gë_buf„r
(
	`GTK_TEXT_VIEW
(
msgöfo
->
ª≥©_võw
));

214 
	`gtk_ãxt_buf„r_ö£π_©_curs‹
(
ãxtbuf„r
, 
buf
, -1);

217 
msgöfo
->
ª≥©s
 = 
	`g_li°_≠≥nd
(msgöfo->ª≥©s, 
	`g_°rdup
(
buf
));

219 i‡(
askF‹ShowAgaö
) {

220 
	`gtk_widgë_show
(
msgöfo
->
no_show_agaö
);

221 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
msgöfo
->
no_show_agaö
),

222 
showAgaö
 =
SUGGEST_NO_SHOW_AGAIN
);

224 
	`gtk_widgë_hide
(
msgöfo
->
no_show_agaö
);

227 
	`gtk_widgë_show
 (
msgöfo
->
dülog
);

228 
	}
}

230 
MesßgeI¡î«l
 
	gmesßge_öã∫Æ
 = 
gtk_mesßge_öã∫Æ
;

233 
	$£t_mesßge_func
(
MesßgeI¡î«l
 
func
)

235 
	`g_as£π
(
func
);

236 
mesßge_öã∫Æ
 = 
func
;

237 
	}
}

240 
	$mesßge
(c⁄° *
tôÀ
, c⁄° *
f‹m©
, ...)

242 
va_li°
 
¨gs
, 
¨gs2
;

244 
	`va_°¨t
 (
¨gs
, 
f‹m©
);

245 
	`va_°¨t
 (
¨gs2
, 
f‹m©
);

246 
	`mesßge_öã∫Æ
(
tôÀ
, 
ALWAYS_SHOW
, 
f‹m©
, &
¨gs
, &
¨gs2
);

247 
	`va_íd
 (
¨gs
);

248 
	`va_íd
 (
¨gs2
);

249 
	}
}

256 
	$mesßge_nŸi˚
(c⁄° *
f‹m©
, ...)

258 
va_li°
 
¨gs
, 
¨gs2
;

260 
	`va_°¨t
 (
¨gs
, 
f‹m©
);

261 
	`va_°¨t
 (
¨gs2
, 
f‹m©
);

262 
	`mesßge_öã∫Æ
(
	`_
("NŸi˚"), 
SUGGEST_NO_SHOW_AGAIN
, 
f‹m©
, &
¨gs
, &
¨gs2
);

263 
	`va_íd
 (
¨gs
);

264 
	`va_íd
 (
¨gs2
);

265 
	}
}

272 
	$mesßge_w¨nög
(c⁄° *
f‹m©
, ...)

274 
va_li°
 
¨gs
, 
¨gs2
;

276 
	`va_°¨t
 (
¨gs
, 
f‹m©
);

277 
	`va_°¨t
 (
¨gs2
, 
f‹m©
);

278 
	`mesßge_öã∫Æ
(
	`_
("W¨nög"), 
SUGGEST_SHOW_AGAIN
, 
f‹m©
, &
¨gs
, &
¨gs2
);

279 
	`va_íd
 (
¨gs
);

280 
	`va_íd
 (
¨gs2
);

281 
	}
}

287 
	$mesßge_îr‹
(c⁄° *
f‹m©
, ...)

289 
va_li°
 
¨gs
, 
¨gs2
;

291 
	`va_°¨t
 (
¨gs
, 
f‹m©
);

292 
	`va_°¨t
 (
¨gs2
, 
f‹m©
);

293 
	`mesßge_öã∫Æ
(
	`_
("Eº‹"), 
ALWAYS_SHOW
, 
f‹m©
, &
¨gs
, &
¨gs2
);

294 
	`va_íd
 (
¨gs
);

295 
	`va_íd
 (
¨gs2
);

296 
	}
}

298 
gboﬁón
 
	glog_íabÀd
 = 
FALSE
;

300 
	$dü_log_mesßge_íabÀ
 (
gboﬁón
 
yes
)

302 
log_íabÀd
 = 
yes
;

303 
	}
}

306 
	$dü_log_mesßge
 (c⁄° *
f‹m©
, ...)

308 
GTimî
 *
timî
 = 
NULL
;

309 *
log
;

310 
va_li°
 
¨gs
;

312 i‡(!
log_íabÀd
)

315 i‡(!
timî
)

316 
timî
 = 
	`g_timî_√w
 ();

318 
	`va_°¨t
 (
¨gs
, 
f‹m©
);

319 
log
 = 
	`g_°rdup_v¥ötf
 (
f‹m©
, 
¨gs
);

320 
	`va_íd
 (
¨gs
);

322 
	`g_mesßge
 ("t=%.03‡- %s", 
	`g_timî_ñ≠£d
 (
timî
, 
NULL
), 
log
);

323 
	`g_‰ì
 (
log
);

324 
	}
}

	@O:\tool\dvs50\lib\message.h

18 #i‚de‡
MESSAGE_H


19 
	#MESSAGE_H


	)

21 
	~<°d¨g.h
>

22 
	~"düv¨.h
"

23 
G_BEGIN_DECLS


25 
	eShowAgaöStyÀ
 {

26 
	mALWAYS_SHOW
,

27 
	mSUGGEST_SHOW_AGAIN
,

28 
	mSUGGEST_NO_SHOW_AGAIN


31 (*
	tMesßgeI¡î«l
)(c⁄° *
	ttôÀ
, 
	tShowAgaöStyÀ
 
	tshowAgaö
,

32 c⁄° *
	tfmt
,

33 
	tva_li°
 *
	t¨gs
, va_li° *
	t¨gs2
);

35 
DIAVAR
 
	`£t_mesßge_func
(
MesßgeI¡î«l
 
func
);

36 
	`mesßge
(c⁄° *
tôÀ
, c⁄° *
f‹m©
, ...);

37 
DIAVAR
 
	`mesßge_nŸi˚
(c⁄° *
f‹m©
, ...);

38 
DIAVAR
 
	`mesßge_w¨nög
(c⁄° *
f‹m©
, ...);

39 
DIAVAR
 
	`mesßge_îr‹
(c⁄° *
f‹m©
, ...);

41 
DIAVAR
 
	`dü_log_mesßge
(c⁄° *
f‹m©
, ...);

42 
	`dü_log_mesßge_íabÀ
 (
gboﬁón
 
yes
);

44 
DIAVAR
 c⁄° 
gch¨
 *
	`dü_mesßge_fûíame
 (c⁄° gch¨ *
fûíame
);

46 
G_END_DECLS


	@O:\tool\dvs50\lib\newgroup.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<as£π.h
>

24 
	~<m©h.h
>

26 
	~"öé.h
"

27 
	~"obje˘.h
"

28 
	~"ñemít.h
"

29 
	~"c⁄√˘i⁄poöt.h
"

30 
	~"düªndîî.h
"

31 
	~"©åibuãs.h
"

32 
	~"widgës.h
"

33 
	~"mesßge.h
"

34 
	~"¥›îtõs.h
"

35 
	~"dügømd©a.h
"

36 
	~"∑ª¡.h
"

37 
	~"√wgroup.h
"

39 
	~"../obje˘s/Misc/pixm≠s/√wgroup.xpm
"

41 
	#NUM_CONNECTIONS
 9

	)

43 
	#DEFAULT_WIDTH
 2

	)

44 
	#DEFAULT_HEIGHT
 2

	)

46 
_Group
 
	tNewGroup
;

48 
	s_Group
 {

49 
EÀmít
 
	mñemít
;

51 
gboﬁón
 
	mis_›í
;

52 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[
NUM_CONNECTIONS
];

55 
ªÆ
 
√wgroup_di°™˚_‰om
(
NewGroup
 *
group
, 
Poöt
 *
poöt
);

56 
√wgroup_£À˘
(
NewGroup
 *
group
, 
Poöt
 *
˛icked_poöt
,

57 
DüRídîî
 *
öãø˘ive_ªndîî
);

58 
Obje˘Ch™ge
* 
√wgroup_move_h™dÀ
(
NewGroup
 *
group
, 
H™dÀ
 *
h™dÀ
,

59 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

60 
H™dÀMoveRós⁄
 
ªas⁄
,

61 
ModifõrKeys
 
modifõrs
);

62 
Obje˘Ch™ge
* 
√wgroup_move
(
NewGroup
 *
group
, 
Poöt
 *
to
);

63 
√wgroup_døw
(
NewGroup
 *
group
, 
DüRídîî
 *
ªndîî
);

64 
√wgroup_upd©e_d©a
(
NewGroup
 *
group
);

65 
DüObje˘
 *
√wgroup_¸óã
(
Poöt
 *
°¨çoöt
,

66 *
u£r_d©a
,

67 
H™dÀ
 **
h™dÀ1
,

68 
H™dÀ
 **
h™dÀ2
);

69 
√wgroup_de°roy
(
NewGroup
 *
group
);

70 
DüObje˘
 *
√wgroup_c›y
(
NewGroup
 *
group
);

72 
Pr›Des¸ùti⁄
 *
√wgroup_des¸ibe_¥›s
(
NewGroup
 *
group
);

73 
√wgroup_gë_¥›s
(
NewGroup
 *
group
, 
GPåAºay
 *
¥›s
);

74 
√wgroup_£t_¥›s
(
NewGroup
 *
group
, 
GPåAºay
 *
¥›s
);

76 
√wgroup_ßve
(
NewGroup
 *
group
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
);

77 
DüObje˘
 *
√wgroup_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
);

79 
Obje˘Ty≥Ops
 
	g√wgroup_ty≥_›s
 =

81 (
Cª©eFunc
Ë
√wgroup_¸óã
,

82 (
LﬂdFunc
Ë
√wgroup_lﬂd
,

83 (
SaveFunc
Ë
√wgroup_ßve
,

84 (
GëDeÁu…sFunc
Ë
NULL
,

85 (
AµlyDeÁu…sFunc
Ë
NULL


88 
DüObje˘Ty≥
 
	g√wgroup_ty≥
 =

92 (**Ë
√wgroup_ic⁄
,

94 &
√wgroup_ty≥_›s


97 
DüObje˘Ty≥
 *
	g_√wgroup_ty≥
 = (DüObje˘Ty≥ *Ë&
√wgroup_ty≥
;

99 
Obje˘Ops
 
	g√wgroup_›s
 = {

100 (
De°royFunc
Ë
√wgroup_de°roy
,

101 (
DøwFunc
Ë
√wgroup_døw
,

102 (
Di°™˚Func
Ë
√wgroup_di°™˚_‰om
,

103 (
Sñe˘Func
Ë
√wgroup_£À˘
,

104 (
C›yFunc
Ë
√wgroup_c›y
,

105 (
MoveFunc
Ë
√wgroup_move
,

106 (
MoveH™dÀFunc
Ë
√wgroup_move_h™dÀ
,

107 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

108 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

109 (
Obje˘MíuFunc
Ë
NULL
,

110 (
Des¸ibePr›sFunc
Ë
√wgroup_des¸ibe_¥›s
,

111 (
GëPr›sFunc
Ë
√wgroup_gë_¥›s
,

112 (
SëPr›sFunc
Ë
√wgroup_£t_¥›s
,

113 (
TextEdôFunc
) 0,

114 #ifde‡
__GNUC__


115 #w¨nög 
NewGroup
 
ªquúes
 
a
 
fun˘i⁄
 
ö
 
the
 
vèbÀ
 
to
 
≠∂y
 
¥›s


117 #¥agm®
mesßge
("warning: NewGroupÑequiresá function inÅhe vtableÅoápplyÖrops")

121 
Pr›Des¸ùti⁄
 
	g√wgroup_¥›s
[] = {

122 
ELEMENT_COMMON_PROPERTIES
,

123 { "›í", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
,

124 
N_
("O≥¿group"), 
NULL
, NULL},

126 
PROP_DESC_END


129 
Pr›Des¸ùti⁄
 *

130 
	$√wgroup_des¸ibe_¥›s
(
NewGroup
 *
group
)

132 i‡(
√wgroup_¥›s
[0].
qu¨k
 == 0)

133 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
√wgroup_¥›s
);

134  
√wgroup_¥›s
;

135 
	}
}

137 
Pr›Off£t
 
	g√wgroup_off£ts
[] = {

138 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

139 { "›í", 
PROP_TYPE_BOOL
, 
off£tof
(
NewGroup
, 
is_›í
) },

140 { 
NULL
, 0, 0 }

144 
	$√wgroup_gë_¥›s
(
NewGroup
 *
group
, 
GPåAºay
 *
¥›s
)

146 
	`obje˘_gë_¥›s_‰om_off£ts
(&
group
->
ñemít
.
obje˘
,

147 
√wgroup_off£ts
, 
¥›s
);

148 
	}
}

151 
	$√wgroup_£t_¥›s
(
NewGroup
 *
group
, 
GPåAºay
 *
¥›s
)

153 
	`obje˘_£t_¥›s_‰om_off£ts
(&
group
->
ñemít
.
obje˘
,

154 
√wgroup_off£ts
, 
¥›s
);

155 
	`√wgroup_upd©e_d©a
(
group
);

156 
	}
}

158 
ªÆ


159 
	$√wgroup_di°™˚_‰om
(
NewGroup
 *
group
, 
Poöt
 *
poöt
)

161 
EÀmít
 *
ñem
 = &
group
->
ñemít
;

162 
Re˘™gÀ
 
ª˘
;

164 
ª˘
.
À·
 = 
ñem
->
c‹√r
.
x
;

165 
ª˘
.
right
 = 
ñem
->
c‹√r
.
x
 +ÉÀm->
width
;

166 
ª˘
.
t›
 = 
ñem
->
c‹√r
.
y
;

167 
ª˘
.
bŸtom
 = 
ñem
->
c‹√r
.
y
 +ÉÀm->
height
;

168  
	`di°™˚_ª˘™gÀ_poöt
(&
ª˘
, 
poöt
);

169 
	}
}

172 
	$√wgroup_£À˘
(
NewGroup
 *
group
, 
Poöt
 *
˛icked_poöt
,

173 
DüRídîî
 *
öãø˘ive_ªndîî
)

175 
	`ñemít_upd©e_h™dÀs
(&
group
->
ñemít
);

176 
	}
}

178 
Obje˘Ch™ge
*

179 
	$√wgroup_move_h™dÀ
(
NewGroup
 *
group
, 
H™dÀ
 *
h™dÀ
,

180 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

181 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

183 
	`as£π
(
group
!=
NULL
);

184 
	`as£π
(
h™dÀ
!=
NULL
);

185 
	`as£π
(
to
!=
NULL
);

187 
	`ñemít_move_h™dÀ
(&
group
->
ñemít
, 
h™dÀ
->
id
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

189 
	`√wgroup_upd©e_d©a
(
group
);

191  
NULL
;

192 
	}
}

194 
Obje˘Ch™ge
*

195 
	$√wgroup_move
(
NewGroup
 *
group
, 
Poöt
 *
to
)

197 
group
->
ñemít
.
c‹√r
 = *
to
;

199 
	`√wgroup_upd©e_d©a
(
group
);

201  
NULL
;

202 
	}
}

205 
	$√wgroup_døw
(
NewGroup
 *
group
, 
DüRídîî
 *
ªndîî
)

207 
Poöt
 
Ã_c‹√r
;

208 
EÀmít
 *
ñem
;

209 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

212 
	`as£π
(
group
 !
NULL
);

213 
	`as£π
(
ªndîî
 !
NULL
);

215 
ñem
 = &
group
->
ñemít
;

217 
Ã_c‹√r
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

218 
Ã_c‹√r
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

220 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 0.01);

221 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
LINESTYLE_SOLID
);

222 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_MITER
);

224 
ªndîî_›s
->
	`døw_ª˘
(
ªndîî
,

225 &
ñem
->
c‹√r
,

226 &
Ã_c‹√r
,

227 &
cﬁ‹_bœck
);

228 
	}
}

231 
	$√wgroup_upd©e_d©a
(
NewGroup
 *
group
)

233 
EÀmít
 *
ñem
 = &
group
->
ñemít
;

235 
DüObje˘
 *
obj
 = &
ñem
->
obje˘
;

238 
group
->
c⁄√˘i⁄s
[0].
pos
.
x
 = 
ñem
->
c‹√r
.x;

239 
group
->
c⁄√˘i⁄s
[0].
pos
.
y
 = 
ñem
->
c‹√r
.y;

240 
group
->
c⁄√˘i⁄s
[1].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

241 
group
->
c⁄√˘i⁄s
[1].
pos
.
y
 = 
ñem
->
c‹√r
.y;

242 
group
->
c⁄√˘i⁄s
[2].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

243 
group
->
c⁄√˘i⁄s
[2].
pos
.
y
 = 
ñem
->
c‹√r
.y;

244 
group
->
c⁄√˘i⁄s
[3].
pos
.
x
 = 
ñem
->
c‹√r
.x;

245 
group
->
c⁄√˘i⁄s
[3].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

246 
group
->
c⁄√˘i⁄s
[4].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

247 
group
->
c⁄√˘i⁄s
[4].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

248 
group
->
c⁄√˘i⁄s
[5].
pos
.
x
 = 
ñem
->
c‹√r
.x;

249 
group
->
c⁄√˘i⁄s
[5].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

250 
group
->
c⁄√˘i⁄s
[6].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

251 
group
->
c⁄√˘i⁄s
[6].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

252 
group
->
c⁄√˘i⁄s
[7].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

253 
group
->
c⁄√˘i⁄s
[7].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

254 
group
->
c⁄√˘i⁄s
[8].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

255 
group
->
c⁄√˘i⁄s
[8].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

257 
group
->
c⁄√˘i⁄s
[0].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_WEST
;

258 
group
->
c⁄√˘i⁄s
[1].
dúe˘i⁄s
 = 
DIR_NORTH
;

259 
group
->
c⁄√˘i⁄s
[2].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_EAST
;

260 
group
->
c⁄√˘i⁄s
[3].
dúe˘i⁄s
 = 
DIR_WEST
;

261 
group
->
c⁄√˘i⁄s
[4].
dúe˘i⁄s
 = 
DIR_EAST
;

262 
group
->
c⁄√˘i⁄s
[5].
dúe˘i⁄s
 = 
DIR_SOUTH
|
DIR_WEST
;

263 
group
->
c⁄√˘i⁄s
[6].
dúe˘i⁄s
 = 
DIR_SOUTH
;

264 
group
->
c⁄√˘i⁄s
[7].
dúe˘i⁄s
 = 
DIR_SOUTH
|
DIR_EAST
;

265 
group
->
c⁄√˘i⁄s
[8].
dúe˘i⁄s
 = 
DIR_ALL
;

267 
	`ñemít_upd©e_boundögbox
(
ñem
);

269 
obj
->
posôi⁄
 = 
ñem
->
c‹√r
;

271 
	`ñemít_upd©e_h™dÀs
(
ñem
);

273 i‡(
group
->
is_›í
) {

274 
obj
->
Êags
 &~
DIA_OBJECT_GRABS_CHILD_INPUT
;

276 
gboﬁón
 
√wlySë
 = 
FALSE
;

277 
Layî
 *
œyî
;

278 i‡(!
	`obje˘_Êags_£t
(
obj
, 
DIA_OBJECT_GRABS_CHILD_INPUT
)) {

279 
√wlySë
 = 
TRUE
;

281 
obj
->
Êags
 |
DIA_OBJECT_GRABS_CHILD_INPUT
;

282 i‡(
√wlySë
) {

283 
œyî
 = 
	`dü_obje˘_gë_∑ª¡_œyî
(
obj
);

284 i‡(
œyî
 !
NULL
) {

285 
GLi°
 *
chûdªn
 = 
	`g_li°_¥ïíd
(
NULL
, 
obj
);

286 
chûdªn
 = 
	`∑ª¡_li°_af„˘ed
(children);

289 
chûdªn
 = 
	`g_li°_ªmove_lök
(children, children);

291 
	`dügøm_un£À˘_obje˘s
(
	`œyî_gë_∑ª¡_dügøm
(
œyî
), 
chûdªn
);

293 
	`g_w¨nög
 ("usedÅo call diagram_unselect_objects()");

295 
	`g_li°_‰ì
(
chûdªn
);

299 
	}
}

301 
DüObje˘
 *

302 
	$√wgroup_¸óã
(
Poöt
 *
°¨çoöt
,

303 *
u£r_d©a
,

304 
H™dÀ
 **
h™dÀ1
,

305 
H™dÀ
 **
h™dÀ2
)

307 
NewGroup
 *
group
;

308 
EÀmít
 *
ñem
;

309 
DüObje˘
 *
obj
;

310 
i
;

312 
group
 = 
	`g_mÆloc0
((
NewGroup
));

313 
ñem
 = &
group
->
ñemít
;

314 
obj
 = &
ñem
->
obje˘
;

316 
obj
->
ty≥
 = &
√wgroup_ty≥
;

318 
obj
->
›s
 = &
√wgroup_›s
;

319 
obj
->
Êags
 |
DIA_OBJECT_CAN_PARENT
|
DIA_OBJECT_GRABS_CHILD_INPUT
;

321 
ñem
->
c‹√r
 = *
°¨çoöt
;

322 
ñem
->
width
 = 
DEFAULT_WIDTH
;

323 
ñem
->
height
 = 
DEFAULT_HEIGHT
;

325 
	`ñemít_öô
(
ñem
, 8, 
NUM_CONNECTIONS
);

327 
i
=0;i<
NUM_CONNECTIONS
;i++) {

328 
obj
->
c⁄√˘i⁄s
[
i
] = &
group
->connections[i];

329 
group
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

330 
group
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

332 
group
->
c⁄√˘i⁄s
[8].
Êags
 = 
CP_FLAGS_MAIN
;

334 
	`√wgroup_upd©e_d©a
(
group
);

336 i‡(
h™dÀ1
 !
NULL
) {

337 *
h™dÀ1
 = 
NULL
;

339 i‡(
h™dÀ2
 !
NULL
) {

340 *
h™dÀ2
 = 
obj
->
h™dÀs
[7];

342  &
group
->
ñemít
.
obje˘
;

343 
	}
}

346 
	$√wgroup_de°roy
(
NewGroup
 *
group
)

348 
	`ñemít_de°roy
(&
group
->
ñemít
);

349 
	}
}

351 
DüObje˘
 *

352 
	$√wgroup_c›y
(
NewGroup
 *
group
)

354 
i
;

355 
NewGroup
 *
√wgroup
;

356 
EÀmít
 *
ñem
, *
√wñem
;

357 
DüObje˘
 *
√wobj
;

359 
ñem
 = &
group
->
ñemít
;

361 
√wgroup
 = 
	`g_mÆloc0
((
NewGroup
));

362 
√wñem
 = &
√wgroup
->
ñemít
;

363 
√wobj
 = &
√wñem
->
obje˘
;

365 
	`ñemít_c›y
(
ñem
, 
√wñem
);

367 
i
=0;i<
NUM_CONNECTIONS
;i++) {

368 
√wobj
->
c⁄√˘i⁄s
[
i
] = &
√wgroup
->connections[i];

369 
√wgroup
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
√wobj
;

370 
√wgroup
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

371 
√wgroup
->
c⁄√˘i⁄s
[
i
].
pos
 = 
group
->connections[i].pos;

372 
√wgroup
->
c⁄√˘i⁄s
[
i
].
œ°_pos
 = 
group
->connections[i].last_pos;

373 
√wgroup
->
c⁄√˘i⁄s
[
i
].
Êags
 = 
group
->connections[i].flags;

376  &
√wgroup
->
ñemít
.
obje˘
;

377 
	}
}

380 
	$√wgroup_ßve
(
NewGroup
 *
group
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
)

382 
	`ñemít_ßve
(&
group
->
ñemít
, 
obj_node
);

383 
	}
}

385 
DüObje˘
 *

386 
	$√wgroup_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

388 
NewGroup
 *
group
;

389 
EÀmít
 *
ñem
;

390 
DüObje˘
 *
obj
;

391 
i
;

393 
group
 = 
	`g_mÆloc0
((
NewGroup
));

394 
ñem
 = &
group
->
ñemít
;

395 
obj
 = &
ñem
->
obje˘
;

397 
obj
->
ty≥
 = &
√wgroup_ty≥
;

398 
obj
->
›s
 = &
√wgroup_›s
;

400 
	`ñemít_lﬂd
(
ñem
, 
obj_node
);

401 
	`ñemít_öô
(
ñem
, 8, 
NUM_CONNECTIONS
);

403 
i
=0;i<
NUM_CONNECTIONS
;i++) {

404 
obj
->
c⁄√˘i⁄s
[
i
] = &
group
->connections[i];

405 
group
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

406 
group
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

408 
group
->
c⁄√˘i⁄s
[8].
Êags
 = 
CP_FLAGS_MAIN
;

410 
	`√wgroup_upd©e_d©a
(
group
);

412  &
group
->
ñemít
.
obje˘
;

413 
	}
}

	@O:\tool\dvs50\lib\newgroup.h

19 #i‚de‡
NEWGROUP_H


20 
	#NEWGROUP_H


	)

22 
	~"düv¨.h
"

26 
DIAVAR
 
DüObje˘Ty≥
 
	g√wgroup_ty≥
;

	@O:\tool\dvs50\lib\neworth_conn.c

21 
	~<c⁄fig.h
>

23 
	~<°dio.h
>

24 
	~<°dlib.h
>

25 
	~<as£π.h
>

26 
	~<m©h.h
>

27 
	~<°rög.h
>

29 
	~"√w‹th_c⁄n.h
"

30 
	~"c⁄√˘i⁄poöt.h
"

31 
	~"mesßge.h
"

32 
	~"dümíu.h
"

33 
	~"h™dÀ.h
"

34 
	~"düªndîî.h
"

36 
∂a˚_h™dÀ_by_sw≠pög
(
NewOπhC⁄n
 *
‹th
,

37 
ödex
, 
H™dÀ
 *
h™dÀ
);

39 
	ech™ge_ty≥
 {

40 
	mTYPE_ADD_SEGMENT
,

41 
	mTYPE_REMOVE_SEGMENT


44 
Obje˘Ch™ge
 *

45 
mid£gmít_¸óã_ch™ge
(
NewOπhC⁄n
 *
‹th
, 
ch™ge_ty≥
 
ty≥
,

46 
£gmít
,

47 
Poöt
 *
poöt1
, Poöà*
poöt2
,

48 
H™dÀ
 *
h™dÀ1
, H™dÀ *
h™dÀ2
);

50 
	sMidSegmítCh™ge
 {

51 
Obje˘Ch™ge
 
	mobj_ch™ge
;

60 
ch™ge_ty≥
 
	mty≥
;

61 
	m≠∂õd
;

63 
	m£gmít
;

64 
Poöt
 
	mpoöts
[2];

65 
H™dÀ
 *
	mh™dÀs
[2];

66 
C⁄√˘i⁄Poöt
 *
	mc⁄n
;

67 
Obje˘Ch™ge
 *
	m˝lch™ge
[2];

70 
Obje˘Ch™ge
 *

71 
íd£gmít_¸óã_ch™ge
(
NewOπhC⁄n
 *
‹th
, 
ch™ge_ty≥
 
ty≥
,

72 
£gmít
, 
Poöt
 *
poöt
,

73 
H™dÀ
 *
h™dÀ
);

75 
	sEndSegmítCh™ge
 {

76 
Obje˘Ch™ge
 
	mobj_ch™ge
;

88 
ch™ge_ty≥
 
	mty≥
;

89 
	m≠∂õd
;

91 
	m£gmít
;

92 
Poöt
 
	mpoöt
;

93 
H™dÀ
 *
	mh™dÀ
;

94 
H™dÀ
 *
	mﬁd_íd_h™dÀ
;

95 
C⁄√˘i⁄Poöt
 *
	m˝
;

97 
Obje˘Ch™ge
 *
	m˝lch™ge
;

101 
	$£t_midpoöt
(
Poöt
 *
poöt
, 
NewOπhC⁄n
 *
‹th
, 
£gmít
)

103 
i
 = 
£gmít
;

104 
poöt
->
x
 = 0.5*(
‹th
->
poöts
[
i
].x + orth->points[i+1].x);

105 
poöt
->
y
 = 0.5*(
‹th
->
poöts
[
i
].y + orth->points[i+1].y);

106 
	}
}

108 
	$£tup_midpoöt_h™dÀ
(
H™dÀ
 *
h™dÀ
)

110 
h™dÀ
->
id
 = 
HANDLE_MIDPOINT
;

111 
h™dÀ
->
ty≥
 = 
HANDLE_MINOR_CONTROL
;

112 
h™dÀ
->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

113 
h™dÀ
->
c⁄√˘ed_to
 = 
NULL
;

114 
	}
}

116 
	$£tup_ídpoöt_h™dÀ
(
H™dÀ
 *
h™dÀ
, 
H™dÀId
 
id
 )

118 
h™dÀ
->
id
 = id;

119 
h™dÀ
->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

120 
h™dÀ
->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

121 
h™dÀ
->
c⁄√˘ed_to
 = 
NULL
;

122 
	}
}

124 
	$gë_h™dÀ_ƒ
(
NewOπhC⁄n
 *
‹th
, 
H™dÀ
 *
h™dÀ
)

126 
i
 = 0;

127 
i
=0;i<
‹th
->
numpoöts
-1;i++) {

128 i‡(
‹th
->
h™dÀs
[
i
] =
h™dÀ
)

129  
i
;

132 
	}
}

134 
	$gë_£gmít_ƒ
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
poöt
, 
ªÆ
 
max_di°
)

136 
i
;

137 
£gmít
;

138 
ªÆ
 
di°™˚
, 
tmp_di°
;

140 
£gmít
 = 0;

141 
di°™˚
 = 
	`di°™˚_löe_poöt
(&
‹th
->
poöts
[0], &‹th->poöts[1], 0, 
poöt
);

143 
i
=1;i<
‹th
->
numpoöts
-1;i++) {

144 
tmp_di°
 = 
	`di°™˚_löe_poöt
(&
‹th
->
poöts
[
i
], &‹th->poöts[i+1], 0, 
poöt
);

145 i‡(
tmp_di°
 < 
di°™˚
) {

146 
£gmít
 = 
i
;

147 
di°™˚
 = 
tmp_di°
;

151 i‡(
di°™˚
 < 
max_di°
)

152  
£gmít
;

155 
	}
}

158 
Obje˘Ch™ge
*

159 
	$√w‹thc⁄n_move_h™dÀ
(
NewOπhC⁄n
 *
‹th
, 
H™dÀ
 *
h™dÀ
,

160 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

161 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

163 
n
;

164 
h™dÀ_ƒ
;

166 
h™dÀ
->
id
) {

167 
HANDLE_MOVE_STARTPOINT
:

168 
‹th
->
poöts
[0] = *
to
;

169 
‹th
->
‹õ¡©i⁄
[0]) {

170 
HORIZONTAL
:

171 
‹th
->
poöts
[1].
y
 = 
to
->y;

173 
VERTICAL
:

174 
‹th
->
poöts
[1].
x
 = 
to
->x;

178 
HANDLE_MOVE_ENDPOINT
:

179 
n
 = 
‹th
->
numpoöts
 - 1;

180 
‹th
->
poöts
[
n
] = *
to
;

181 
‹th
->
‹õ¡©i⁄
[
n
-1]) {

182 
HORIZONTAL
:

183 
‹th
->
poöts
[
n
-1].
y
 = 
to
->y;

185 
VERTICAL
:

186 
‹th
->
poöts
[
n
-1].
x
 = 
to
->x;

190 
HANDLE_MIDPOINT
:

191 
n
 = 
‹th
->
numpoöts
 - 1;

192 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
‹th
, 
h™dÀ
);

194 
‹th
->
‹õ¡©i⁄
[
h™dÀ_ƒ
]) {

195 
HORIZONTAL
:

196 
‹th
->
poöts
[
h™dÀ_ƒ
].
y
 = 
to
->y;

197 
‹th
->
poöts
[
h™dÀ_ƒ
+1].
y
 = 
to
->y;

199 
VERTICAL
:

200 
‹th
->
poöts
[
h™dÀ_ƒ
].
x
 = 
to
->x;

201 
‹th
->
poöts
[
h™dÀ_ƒ
+1].
x
 = 
to
->x;

206 
	`mesßge_îr‹
("InternalÉrror inÇeworthconn_move_handle.\n");

210  
NULL
;

211 
	}
}

213 
Obje˘Ch™ge
*

214 
	$√w‹thc⁄n_move
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
to
)

216 
Poöt
 
p
;

217 
i
;

219 
p
 = *
to
;

220 
	`poöt_sub
(&
p
, &
‹th
->
poöts
[0]);

222 
‹th
->
poöts
[0] = *
to
;

223 
i
=1;i<
‹th
->
numpoöts
;i++) {

224 
	`poöt_add
(&
‹th
->
poöts
[
i
], &
p
);

227  
NULL
;

228 
	}
}

230 
ªÆ


231 
	$√w‹thc⁄n_di°™˚_‰om
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

233 
i
;

234 
ªÆ
 
di°
;

236 
di°
 = 
	`di°™˚_löe_poöt
–&
‹th
->
poöts
[0], &orth->points[1],

237 
löe_width
, 
poöt
);

238 
i
=1;i<
‹th
->
numpoöts
-1;i++) {

239 
di°
 = 
	`MIN
(dist,

240 
	`di°™˚_löe_poöt
–&
‹th
->
poöts
[
i
], &orth->points[i+1],

241 
löe_width
, 
poöt
));

243  
di°
;

244 
	}
}

247 
	$√w‹thc⁄n_upd©e_midpoöts
(
NewOπhC⁄n
 *
‹th
)

249 
i
;

250 
GSLi°
 *
ñem
;

252 
ñem
=
‹th
->
midpoöts
->
c⁄√˘i⁄s
;

255 
	`£t_midpoöt
(&((
C⁄√˘i⁄Poöt
 *)(
ñem
->
d©a
))->
pos
,
‹th
,0);

256 
ñem
=
	`g_¶i°_√xt
(elem);

257 
i
=1; i<
‹th
->
numpoöts
-2; i++) {

258 ((
C⁄√˘i⁄Poöt
 *)(
ñem
->
d©a
))->
pos
 = 
‹th
->
h™dÀs
[
i
]->pos;

259 
ñem
 = 
	`g_¶i°_√xt
(elem);

261 
	`£t_midpoöt
(&(((
C⁄√˘i⁄Poöt
 *)(
ñem
->
d©a
))->
pos
),
‹th
,
i
);

262 
	}
}

268 
	$adju°_h™dÀ_cou¡_to
(
NewOπhC⁄n
 *
‹th
, 
guöt
 
cou¡
) {

274 i‡(
‹th
->
numh™dÀs
 =
cou¡
) ;

275 i‡(
‹th
->
numh™dÀs
 < 
cou¡
) {

276 
i
;

277 
‹th
->
h™dÀs
 = 
	`g_ªÆloc
(orth->handles,

278 (
cou¡
)*(
H™dÀ
 *));

279 
‹th
->
h™dÀs
[
cou¡
-1] = oπh->h™dÀs[‹th->
numh™dÀs
-1];

280 
‹th
->
h™dÀs
[‹th->
numh™dÀs
-1] = 
NULL
;

281 
i
=
‹th
->
numh™dÀs
-1; i<
cou¡
-1; i++) {

282 
H™dÀ
 *
h™dÀ
 = 
	`g_√w0
(Handle,1);

283 
	`£tup_midpoöt_h™dÀ
(
h™dÀ
);

284 
	`obje˘_add_h™dÀ
(&
‹th
->
obje˘
,
h™dÀ
);

285 
‹th
->
h™dÀs
[
i
] = 
h™dÀ
;

288 
i
;

289 
i
=
cou¡
-1; i<
‹th
->
numh™dÀs
-1; i++) {

290 
H™dÀ
 *
h™dÀ
 = 
‹th
->
h™dÀs
[
i
];

291 
	`obje˘_ªmove_h™dÀ
(&
‹th
->
obje˘
,
h™dÀ
);

292 
	`g_‰ì
(
h™dÀ
);

293 
‹th
->
h™dÀs
[
i
] = 
NULL
;

295 
‹th
->
h™dÀs
[
cou¡
-1] = oπh->h™dÀs[‹th->
numh™dÀs
-1];

296 
‹th
->
h™dÀs
[‹th->
numh™dÀs
-1] = 
NULL
;

297 
‹th
->
h™dÀs
 = 
	`g_ªÆloc
(orth->handles,

298 (
cou¡
)*(
H™dÀ
 *));

300 
‹th
->
numh™dÀs
 = 
cou¡
;

302 
	}
}

306 
	$√w‹thc⁄n_upd©e_d©a
(
NewOπhC⁄n
 *
‹th
)

308 
i
;

309 
DüObje˘
 *
obj
 = (DüObje˘ *)
‹th
;

310 
Poöt
 *
poöts
;

311 
C⁄√˘i⁄Poöt
 *
°¨t_˝
;

312 
C⁄√˘i⁄Poöt
 *
íd_˝
;

314 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

323 
	`adju°_h™dÀ_cou¡_to
(
‹th
, oπh->
numpoöts
-1);

325 
°¨t_˝
 = 
‹th
->
h™dÀs
[0]->
c⁄√˘ed_to
;

326 
íd_˝
 = 
‹th
->
h™dÀs
[‹th->
numpoöts
-2]->
c⁄√˘ed_to
;

328 i‡(!
‹th
->
poöts
) {

329 
	`g_w¨nög
("This NewOrthConn object is very sick !");

333 
poöts
 = 
‹th
->points;

334 i‡(
	`c⁄≈oöt_is_autog≠
(
°¨t_˝
) ||

335 
	`c⁄≈oöt_is_autog≠
(
íd_˝
)) {

336 
Poöt
* 
√w_poöts
 = 
	`g_√w
(Poöt, 
‹th
->
numpoöts
);

337 
i
 = 0; i < 
‹th
->
numpoöts
; i++) {

338 
√w_poöts
[
i
] = 
poöts
[i];

341 i‡(
	`c⁄≈oöt_is_autog≠
(
°¨t_˝
)) {

342 
√w_poöts
[0] = 
	`ˇlcuœã_obje˘_edge
(&
°¨t_˝
->
pos
, &new_points[1],

343 
°¨t_˝
->
obje˘
);

344 
	`¥ötf
("Moved startÅo %f, %f\n",

345 
√w_poöts
[0].
x
,Çew_poöts[0].
y
);

347 i‡(
	`c⁄≈oöt_is_autog≠
(
íd_˝
)) {

348 
√w_poöts
[
‹th
->
numpoöts
-1] =

349 
	`ˇlcuœã_obje˘_edge
(&
íd_˝
->
pos
, &
√w_poöts
[
‹th
->
numpoöts
-2],

350 
íd_˝
->
obje˘
);

351 
	`¥ötf
("MovedÉndÅo %f, %f\n",

352 
√w_poöts
[
‹th
->
numpoöts
-1].
x
,Çew_poöts[‹th->numpoöts-1].
y
);

354 
	`g_‰ì
(
poöts
);

355 
‹th
->
poöts
 = 
√w_poöts
;

358 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

360 
	`adju°_h™dÀ_cou¡_to
(
‹th
,‹th->
numpoöts
-1);

361 
	`c⁄≈oöéöe_adju°_cou¡
(
‹th
->
midpoöts
,‹th->
numpoöts
-1,
NULL
);

364 
	`∂a˚_h™dÀ_by_sw≠pög
(
‹th
, 0, oπh->
h™dÀs
[0]);

365 
	`∂a˚_h™dÀ_by_sw≠pög
(
‹th
, 1, oπh->
h™dÀs
[‹th->
numpoöts
-2]);

368 
‹th
->
h™dÀs
[0]->
pos
 = oπh->
poöts
[0];

369 
‹th
->
h™dÀs
[‹th->
numpoöts
-2]->
pos
 = oπh->
poöts
[orth->numpoints-1];

371 
i
=1;i<
‹th
->
numpoöts
-2;i++) {

372 
	`£t_midpoöt
(&
‹th
->
h™dÀs
[
i
]->
pos
, orth, i);

374 
	`√w‹thc⁄n_upd©e_midpoöts
(
‹th
);

375 
	}
}

378 
	$√w‹thc⁄n_upd©e_boundögbox
(
NewOπhC⁄n
 *
‹th
)

380 
	`as£π
(
‹th
 !
NULL
);

382 
	`pﬁylöe_bbox
(&
‹th
->
poöts
[0],

383 
‹th
->
numpoöts
,

384 &
‹th
->
exåa_•acög
, 
FALSE
,

385 &
‹th
->
obje˘
.
boundög_box
);

386 
	}
}

389 
	$√w‹thc⁄n_sim∂e_døw
(
NewOπhC⁄n
 *
‹th
, 
DüRídîî
 *
ªndîî
, 
ªÆ
 
width
)

391 
Poöt
 *
poöts
;

393 
	`as£π
(
‹th
 !
NULL
);

394 
	`as£π
(
ªndîî
 !
NULL
);

396 i‡(!
‹th
->
poöts
) {

397 
	`g_w¨nög
("This NewOrthConn object is very sick !");

401 
poöts
 = &
‹th
->points[0];

403 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
width
);

404 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

405 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

406 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

408 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁylöe
‘ídîî, 
poöts
, 
‹th
->
numpoöts
,

409 &
cﬁ‹_bœck
);

410 
	}
}

414 
	$√w‹thc⁄n_ˇn_dñëe_£gmít
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
)

416 
£gmít
;

422 i‡(
‹th
->
numpoöts
==3)

425 
£gmít
 = 
	`gë_£gmít_ƒ
(
‹th
, 
˛ickedpoöt
, 1.0);

427 i‡(
£gmít
<0)

430 i‡–(
£gmít
 !0Ë&& (£gmíà!
‹th
->
numpoöts
-2)) {

432 i‡(
‹th
->
numpoöts
==4)

437 
	}
}

440 
	$√w‹thc⁄n_ˇn_add_£gmít
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
)

442 
£gmít
 = 
	`gë_£gmít_ƒ
(
‹th
, 
˛ickedpoöt
, 1000000.0);

444 i‡(
£gmít
<0)

448 
	}
}

457 
	$√w‹thc⁄n_öô
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
°¨çoöt
)

459 
DüObje˘
 *
obj
;

461 
obj
 = &
‹th
->
obje˘
;

463 
	`obje˘_öô
(
obj
, 3, 0);

465 
‹th
->
numpoöts
 = 4;

466 
‹th
->
num‹õ¡
 = oπh->
numpoöts
 - 1;

467 
‹th
->
numh™dÀs
 = 3;

469 
‹th
->
poöts
 = 
	`g_mÆloc
(4*(
Poöt
));

470 
‹th
->
‹õ¡©i⁄
 = 
	`g_mÆloc
(3*(
Orõ¡©i⁄
));

471 
‹th
->
h™dÀs
 = 
	`g_mÆloc
(3*(
H™dÀ
 *));

473 
‹th
->
h™dÀs
[0] = 
	`g_√w
(
H™dÀ
, 1);

474 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[0], 
HANDLE_MOVE_STARTPOINT
);

475 
obj
->
h™dÀs
[0] = 
‹th
->handles[0];

477 
‹th
->
h™dÀs
[1] = 
	`g_√w
(
H™dÀ
, 1);

478 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[1]);

479 
obj
->
h™dÀs
[1] = 
‹th
->handles[1];

481 
‹th
->
h™dÀs
[2] = 
	`g_√w
(
H™dÀ
, 1);

482 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[2], 
HANDLE_MOVE_ENDPOINT
);

483 
obj
->
h™dÀs
[2] = 
‹th
->handles[2];

486 
‹th
->
poöts
[0] = *
°¨çoöt
;

487 
‹th
->
poöts
[1].
x
 = 
°¨çoöt
->x;

488 
‹th
->
poöts
[1].
y
 = 
°¨çoöt
->y + 1.0;

489 
‹th
->
poöts
[2].
x
 = 
°¨çoöt
->x + 1.0;

490 
‹th
->
poöts
[2].
y
 = 
°¨çoöt
->y + 1.0;

491 
‹th
->
poöts
[3].
x
 = 
°¨çoöt
->x + 2.0;

492 
‹th
->
poöts
[3].
y
 = 
°¨çoöt
->y + 1.0;

494 
‹th
->
‹õ¡©i⁄
[0] = 
VERTICAL
;

495 
‹th
->
‹õ¡©i⁄
[1] = 
HORIZONTAL
;

496 
‹th
->
‹õ¡©i⁄
[2] = 
VERTICAL
;

498 
‹th
->
midpoöts
 = 
	`c⁄≈oöéöe_¸óã
(
obj
,3);

500 
	`√w‹thc⁄n_upd©e_d©a
(
‹th
);

501 
	}
}

504 
	$√w‹thc⁄n_c›y
(
NewOπhC⁄n
 *
‰om
, NewOπhC⁄¿*
to
)

506 
i
,
rcc
;

507 
DüObje˘
 *
toobj
, *
‰omobj
;

509 
toobj
 = &
to
->
obje˘
;

510 
‰omobj
 = &
‰om
->
obje˘
;

512 
	`obje˘_c›y
(
‰omobj
, 
toobj
);

514 
to
->
numpoöts
 = 
‰om
->numpoints;

515 
to
->
num‹õ¡
 = 
‰om
->numorient;

516 
to
->
numh™dÀs
 = 
‰om
->numhandles;

518 
to
->
poöts
 = 
	`g_mÆloc
(—o->
numpoöts
)*(
Poöt
));

520 
i
=0;i<
to
->
numpoöts
;i++) {

521 
to
->
poöts
[
i
] = 
‰om
->points[i];

524 
to
->
‹õ¡©i⁄
 = 
	`g_mÆloc
(—o->
numpoöts
-1)*(
Orõ¡©i⁄
));

525 
to
->
h™dÀs
 = 
	`g_mÆloc
(—o->
numpoöts
-1)*(
H™dÀ
 *));

527 
i
=0;i<
to
->
numpoöts
-1;i++) {

528 
to
->
‹õ¡©i⁄
[
i
] = 
‰om
->orientation[i];

529 
to
->
h™dÀs
[
i
] = 
	`g_√w
(
H™dÀ
,1);

530 *
to
->
h™dÀs
[
i
] = *
‰om
->handles[i];

531 
to
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 = 
NULL
;

532 
toobj
->
h™dÀs
[
i
] = 
to
->handles[i];

534 
rcc
 = 0;

535 
to
->
midpoöts
 = 
	`c⁄≈oöéöe_c›y
(
toobj
,
‰om
->midpoöts,&
rcc
);

536 
	`mem˝y
(&
to
->
exåa_•acög
,&
‰om
->extra_spacing,(to->extra_spacing));

537 
	}
}

541 
	$√w‹thc⁄n_de°roy
(
NewOπhC⁄n
 *
‹th
)

543 
i
;

545 
	`c⁄≈oöéöe_de°roy
(
‹th
->
midpoöts
);

546 
	`obje˘_de°roy
(&
‹th
->
obje˘
);

548 
	`g_‰ì
(
‹th
->
poöts
);

549 
	`g_‰ì
(
‹th
->
‹õ¡©i⁄
);

551 
i
=0;i<
‹th
->
numpoöts
-1;i++) {

552 
	`g_‰ì
(
‹th
->
h™dÀs
[
i
]);

554 
	`g_‰ì
(
‹th
->
h™dÀs
);

555 
	}
}

558 
	$∂a˚_h™dÀ_by_sw≠pög
(
NewOπhC⁄n
 *
‹th
, 
ödex
, 
H™dÀ
 *
h™dÀ
)

560 
DüObje˘
 *
obj
;

561 
H™dÀ
 *
tmp
;

562 
j
;

564 
obj
 = (
DüObje˘
 *)
‹th
;

565 i‡(
obj
->
h™dÀs
[
ödex
] =
h™dÀ
)

568 
j
=0;j<
obj
->
num_h™dÀs
;j++) {

569 i‡(
obj
->
h™dÀs
[
j
] =
h™dÀ
) {

571 
tmp
 = 
obj
->
h™dÀs
[
j
];

572 
obj
->
h™dÀs
[
j
] = obj->h™dÀs[
ödex
];

573 
obj
->
h™dÀs
[
ödex
] = 
tmp
;

578 
	}
}

581 
	$√w‹thc⁄n_ßve
(
NewOπhC⁄n
 *
‹th
, 
Obje˘Node
 
obj_node
)

583 
i
;

584 
AâribuãNode
 
©å
;

587 
	`∂a˚_h™dÀ_by_sw≠pög
(
‹th
, 0, oπh->
h™dÀs
[0]);

588 
	`∂a˚_h™dÀ_by_sw≠pög
(
‹th
, 1, oπh->
h™dÀs
[‹th->
numpoöts
-2]);

590 
	`obje˘_ßve
(&
‹th
->
obje˘
, 
obj_node
);

592 
©å
 = 
	`√w_©åibuã
(
obj_node
, "orth_points");

594 
i
=0;i<
‹th
->
numpoöts
;i++) {

595 
	`d©a_add_poöt
(
©å
, &
‹th
->
poöts
[
i
]);

598 
©å
 = 
	`√w_©åibuã
(
obj_node
, "orth_orient");

599 
i
=0;i<
‹th
->
numpoöts
-1;i++) {

600 
	`d©a_add_íum
(
©å
, 
‹th
->
‹õ¡©i⁄
[
i
]);

602 
	}
}

605 
	$√w‹thc⁄n_lﬂd
(
NewOπhC⁄n
 *
‹th
, 
Obje˘Node
 
obj_node
)

607 
i
;

608 
AâribuãNode
 
©å
;

609 
D©aNode
 
d©a
;

610 
n
;

612 
DüObje˘
 *
obj
 = &
‹th
->
obje˘
;

614 
	`obje˘_lﬂd
(
obj
, 
obj_node
);

616 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "orth_points");

618 i‡(
©å
 !
NULL
)

619 
‹th
->
numpoöts
 = 
	`©åibuã_num_d©a
(
©å
);

621 
‹th
->
numpoöts
 = 0;

623 
	`obje˘_öô
(
obj
, 
‹th
->
numpoöts
-1,0);

625 
‹th
->
num‹õ¡
 = oπh->
numpoöts
 - 1;

627 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

628 
‹th
->
poöts
 = 
	`g_mÆloc
((‹th->
numpoöts
)*(
Poöt
));

629 
i
=0;i<
‹th
->
numpoöts
;i++) {

630 
	`d©a_poöt
(
d©a
, &
‹th
->
poöts
[
i
]);

631 
d©a
 = 
	`d©a_√xt
(data);

634 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "orth_orient");

636 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

637 
‹th
->
‹õ¡©i⁄
 = 
	`g_mÆloc
((‹th->
numpoöts
-1)*(
Orõ¡©i⁄
));

638 
i
=0;i<
‹th
->
numpoöts
-1;i++) {

639 
‹th
->
‹õ¡©i⁄
[
i
] = 
	`d©a_íum
(
d©a
);

640 
d©a
 = 
	`d©a_√xt
(data);

643 
‹th
->
h™dÀs
 = 
	`g_mÆloc
((‹th->
numpoöts
-1)*(
H™dÀ
 *));

645 
‹th
->
h™dÀs
[0] = 
	`g_√w
(
H™dÀ
, 1);

646 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[0], 
HANDLE_MOVE_STARTPOINT
);

647 
‹th
->
h™dÀs
[0]->
pos
 = oπh->
poöts
[0];

648 
obj
->
h™dÀs
[0] = 
‹th
->handles[0];

650 
n
 = 
‹th
->
numpoöts
-2;

651 
‹th
->
h™dÀs
[
n
] = 
	`g_√w
(
H™dÀ
, 1);

652 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[
n
], 
HANDLE_MOVE_ENDPOINT
);

653 
‹th
->
h™dÀs
[
n
]->
pos
 = oπh->
poöts
[‹th->
numpoöts
-1];

654 
obj
->
h™dÀs
[1] = 
‹th
->h™dÀs[
n
];

656 
i
=1; i<
‹th
->
numpoöts
-2; i++) {

657 
‹th
->
h™dÀs
[
i
] = 
	`g_√w
(
H™dÀ
, 1);

658 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[
i
]);

659 
obj
->
h™dÀs
[
i
+1] = 
‹th
->handles[i];

661 
‹th
->
numh™dÀs
 = oπh->
numpoöts
-1;

662 
‹th
->
midpoöts
 = 
	`c⁄≈oöéöe_¸óã
(
obj
,‹th->
numpoöts
-1);

664 
	`√w‹thc⁄n_upd©e_d©a
(
‹th
);

665 
	}
}

667 
H™dÀ
*

668 
	$√w‹thc⁄n_gë_middÀ_h™dÀ
–
NewOπhC⁄n
 *
‹th
 )

670 
n
 = 
‹th
->
numpoöts
 - 1 ;

671  
‹th
->
h™dÀs
[ 
n
/2 ] ;

672 
	}
}

674 
Obje˘Ch™ge
 *

675 
	$√w‹thc⁄n_dñëe_£gmít
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
)

677 
£gmít
;

678 
Obje˘Ch™ge
 *
ch™ge
 = 
NULL
;

680 i‡(
‹th
->
numpoöts
==3)

681  
NULL
;

683 
£gmít
 = 
	`gë_£gmít_ƒ
(
‹th
, 
˛ickedpoöt
, 1.0);

684 i‡(
£gmít
 < 0)

685  
NULL
;

687 i‡(
£gmít
==0) {

688 
ch™ge
 = 
	`íd£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_REMOVE_SEGMENT
, 
£gmít
,

689 &
‹th
->
poöts
[
£gmít
],

690 
‹th
->
h™dÀs
[
£gmít
]);

691 } i‡(
£gmít
 =
‹th
->
numpoöts
-2) {

692 
ch™ge
 = 
	`íd£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_REMOVE_SEGMENT
, 
£gmít
,

693 &
‹th
->
poöts
[
£gmít
+1],

694 
‹th
->
h™dÀs
[
£gmít
]);

695 } i‡(
£gmít
 > 0) {

699 i‡(
£gmít
 =
‹th
->
numpoöts
-3)

700 
£gmít
--;

702 
ch™ge
 = 
	`mid£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_REMOVE_SEGMENT
, 
£gmít
,

703 &
‹th
->
poöts
[
£gmít
],

704 &
‹th
->
poöts
[
£gmít
+1],

705 
‹th
->
h™dÀs
[
£gmít
],

706 
‹th
->
h™dÀs
[
£gmít
+1]);

709 
ch™ge
->
	`≠∂y
(ch™ge, (
DüObje˘
 *)
‹th
);

711  
ch™ge
;

712 
	}
}

714 
Obje˘Ch™ge
 *

715 
	$√w‹thc⁄n_add_£gmít
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
)

717 
H™dÀ
 *
h™dÀ1
, *
h™dÀ2
;

718 
Obje˘Ch™ge
 *
ch™ge
 = 
NULL
;

719 
£gmít
;

720 
Poöt
 
√wpoöt
;

722 
£gmít
 = 
	`gë_£gmít_ƒ
(
‹th
, 
˛ickedpoöt
, 1.0);

723 i‡(
£gmít
 < 0)

724  
NULL
;

726 i‡(
£gmít
==0) {

727 
h™dÀ1
 = 
	`g_√w
(
H™dÀ
, 1);

728 
	`£tup_ídpoöt_h™dÀ
(
h™dÀ1
, 
HANDLE_MOVE_STARTPOINT
);

729 
ch™ge
 = 
	`íd£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_ADD_SEGMENT
,

730 0, &
‹th
->
poöts
[0],

731 
h™dÀ1
);

732 } i‡(
£gmít
 =
‹th
->
numpoöts
-2) {

733 
h™dÀ1
 = 
	`g_√w
(
H™dÀ
, 1);

734 
	`£tup_ídpoöt_h™dÀ
(
h™dÀ1
, 
HANDLE_MOVE_ENDPOINT
);

735 
ch™ge
 = 
	`íd£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_ADD_SEGMENT
,

736 
£gmít
+1, &
‹th
->
poöts
[segment+1],

737 
h™dÀ1
);

738 } i‡(
£gmít
 > 0) {

739 
h™dÀ1
 = 
	`g_√w
(
H™dÀ
, 1);

740 
	`£tup_midpoöt_h™dÀ
(
h™dÀ1
);

741 
h™dÀ2
 = 
	`g_√w
(
H™dÀ
, 1);

742 
	`£tup_midpoöt_h™dÀ
(
h™dÀ2
);

743 
√wpoöt
 = *
˛ickedpoöt
;

744 i‡(
‹th
->
‹õ¡©i⁄
[
£gmít
]==
HORIZONTAL
)

745 
√wpoöt
.
y
 = 
‹th
->
poöts
[
£gmít
].y;

747 
√wpoöt
.
x
 = 
‹th
->
poöts
[
£gmít
].x;

749 
ch™ge
 = 
	`mid£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_ADD_SEGMENT
, 
£gmít
,

750 &
√wpoöt
,

751 &
√wpoöt
,

752 
h™dÀ1
,

753 
h™dÀ2
);

756 
ch™ge
->
	`≠∂y
(ch™ge, (
DüObje˘
 *)
‹th
);

758  
ch™ge
;

759 
	}
}

762 
	$dñëe_poöt
(
NewOπhC⁄n
 *
‹th
, 
pos
)

764 
i
;

766 
‹th
->
numpoöts
--;

767 
‹th
->
num‹õ¡
 = oπh->
numpoöts
 - 1;

769 
i
=
pos
;i<
‹th
->
numpoöts
;i++) {

770 
‹th
->
poöts
[
i
] = orth->points[i+1];

773 
‹th
->
poöts
 = 
	`g_ªÆloc
(‹th->poöts, oπh->
numpoöts
*(
Poöt
));

774 
	}
}

780 
	$ªmove_h™dÀ
(
NewOπhC⁄n
 *
‹th
, 
£gmít
)

782 
i
;

783 
H™dÀ
 *
h™dÀ
;

785 
h™dÀ
 = 
‹th
->
h™dÀs
[
£gmít
];

787 
i
=
£gmít
; i < 
‹th
->
numpoöts
-1; i++) {

788 
‹th
->
h™dÀs
[
i
] = orth->handles[i+1];

789 
‹th
->
‹õ¡©i⁄
[
i
] = orth->orientation[i+1];

792 
‹th
->
‹õ¡©i⁄
 = 
	`g_ªÆloc
(orth->orientation,

793 (
‹th
->
numpoöts
-1)*(
Orõ¡©i⁄
));

794 
‹th
->
h™dÀs
 = 
	`g_ªÆloc
(orth->handles,

795 (
‹th
->
numpoöts
-1)*(
H™dÀ
 *));

797 
	`obje˘_ªmove_h™dÀ
(&
‹th
->
obje˘
, 
h™dÀ
);

798 
‹th
->
numh™dÀs
 = oπh->
numpoöts
-1;

799 
	}
}

803 
	$add_poöt
(
NewOπhC⁄n
 *
‹th
, 
pos
, 
Poöt
 *
poöt
)

805 
i
;

807 
‹th
->
numpoöts
++;

808 
‹th
->
num‹õ¡
 = oπh->
numpoöts
-1;

810 
‹th
->
poöts
 = 
	`g_ªÆloc
(‹th->poöts, oπh->
numpoöts
*(
Poöt
));

811 
i
=
‹th
->
numpoöts
-1;i>
pos
;i--) {

812 
‹th
->
poöts
[
i
] = orth->points[i-1];

814 
‹th
->
poöts
[
pos
] = *
poöt
;

815 
	}
}

821 
	$ö£π_h™dÀ
(
NewOπhC⁄n
 *
‹th
, 
£gmít
,

822 
H™dÀ
 *
h™dÀ
, 
Orõ¡©i⁄
 
‹õ¡
)

824 
i
;

826 
‹th
->
‹õ¡©i⁄
 = 
	`g_ªÆloc
(orth->orientation,

827 (
‹th
->
numpoöts
-1)*(
Orõ¡©i⁄
));

828 
‹th
->
h™dÀs
 = 
	`g_ªÆloc
(orth->handles,

829 (
‹th
->
numpoöts
-1)*(
H™dÀ
 *));

830 
i
=
‹th
->
numpoöts
-2;i>
£gmít
;i--) {

831 
‹th
->
h™dÀs
[
i
] = orth->handles[i-1];

832 
‹th
->
‹õ¡©i⁄
[
i
] = orth->orientation[i-1];

834 
‹th
->
h™dÀs
[
£gmít
] = 
h™dÀ
;

835 
‹th
->
‹õ¡©i⁄
[
£gmít
] = 
‹õ¡
;

837 
	`obje˘_add_h™dÀ
(&
‹th
->
obje˘
, 
h™dÀ
);

838 
‹th
->
numh™dÀs
 = oπh->
numpoöts
-1;

839 
	}
}

844 
	$íd£gmít_ch™ge_‰ì
(
EndSegmítCh™ge
 *
ch™ge
)

846 i‡–(
ch™ge
->
ty≥
==
TYPE_ADD_SEGMENT
 && !ch™ge->
≠∂õd
) ||

847 (
ch™ge
->
ty≥
==
TYPE_REMOVE_SEGMENT
 && ch™ge->
≠∂õd
) ){

848 i‡(
ch™ge
->
h™dÀ
)

849 
	`g_‰ì
(
ch™ge
->
h™dÀ
);

850 
ch™ge
->
h™dÀ
 = 
NULL
;

852 i‡(
ch™ge
->
˝lch™ge
) {

853 i‡(
ch™ge
->
˝lch™ge
->
‰ì
Ëch™ge->˝lch™ge->
	`‰ì
(change->cplchange);

854 
	`g_‰ì
(
ch™ge
->
˝lch™ge
);

855 
ch™ge
->
˝lch™ge
 = 
NULL
;

857 
	}
}

860 
	$íd£gmít_ch™ge_≠∂y
(
EndSegmítCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

862 
NewOπhC⁄n
 *
‹th
 = (NewOπhC⁄¿*)
obj
;

864 
ch™ge
->
≠∂õd
 = 1;

866 
ch™ge
->
ty≥
) {

867 
TYPE_ADD_SEGMENT
:

868 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
ﬁd_íd_h™dÀ
);

869 i‡(
ch™ge
->
£gmít
==0) {

870 
	`add_poöt
(
‹th
, 0, &
ch™ge
->
poöt
);

871 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
,

872 
ch™ge
->
h™dÀ
, 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[0]) );

873 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[1]);

874 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

875 
ch™ge
->
˝lch™ge
 = 
	`c⁄≈oöéöe_add_poöt
(
‹th
->
midpoöts
,

876 &
ch™ge
->
poöt
);

878 
	`add_poöt
(
‹th
, oπh->
numpoöts
, &
ch™ge
->
poöt
);

879 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
, ch™ge->
h™dÀ
,

880 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[‹th->
numpoöts
-3]) );

881 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[‹th->
numpoöts
-3]);

882 
ch™ge
->
˝lch™ge
 = 
	`c⁄≈oöéöe_add_poöt
(
‹th
->
midpoöts
,

883 &
‹th
->
midpoöts
->
íd
);

886 
TYPE_REMOVE_SEGMENT
:

887 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
ﬁd_íd_h™dÀ
);

888 
ch™ge
->
˝lch™ge
 =

889 
	`c⁄≈oöéöe_ªmove_poöt
(
‹th
->
midpoöts
,

890 &
‹th
->
poöts
[
ch™ge
->
£gmít
]);

891 i‡(
ch™ge
->
£gmít
==0) {

892 
	`dñëe_poöt
(
‹th
, 0);

893 
	`ªmove_h™dÀ
(
‹th
, 0);

894 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[0], 
HANDLE_MOVE_STARTPOINT
);

895 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

897 
	`dñëe_poöt
(
‹th
, oπh->
numpoöts
-1);

898 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
);

899 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[‹th->
numpoöts
-2],

900 
HANDLE_MOVE_ENDPOINT
);

904 
	`√w‹thc⁄n_upd©e_midpoöts
(
‹th
);

905 
	}
}

908 
	$íd£gmít_ch™ge_ªvît
(
EndSegmítCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

910 
NewOπhC⁄n
 *
‹th
 = (NewOπhC⁄¿*)
obj
;

912 
ch™ge
->
˝lch™ge
->
	`ªvît
(ch™ge->˝lch™ge,
obj
);

913 
ch™ge
->
ty≥
) {

914 
TYPE_ADD_SEGMENT
:

915 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ
);

916 i‡(
ch™ge
->
£gmít
==0) {

917 
	`dñëe_poöt
(
‹th
, 0);

918 
	`ªmove_h™dÀ
(
‹th
, 0);

919 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[0], 
HANDLE_MOVE_STARTPOINT
);

920 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

922 
	`dñëe_poöt
(
‹th
, oπh->
numpoöts
-1);

923 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
);

924 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[‹th->
numpoöts
-2],

925 
HANDLE_MOVE_ENDPOINT
);

928 
TYPE_REMOVE_SEGMENT
:

929 i‡(
ch™ge
->
£gmít
==0) {

930 
	`add_poöt
(
‹th
, 0, &
ch™ge
->
poöt
);

931 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
,

932 
ch™ge
->
h™dÀ
, 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[0]) );

933 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[1]);

934 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

936 
	`add_poöt
(
‹th
, oπh->
numpoöts
, &
ch™ge
->
poöt
);

937 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
, ch™ge->
h™dÀ
,

938 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[‹th->
numpoöts
-3]) );

939 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[‹th->
numpoöts
-3]);

943 
ch™ge
->
≠∂õd
 = 0;

944 
	`√w‹thc⁄n_upd©e_midpoöts
(
‹th
);

945 
	}
}

947 
Obje˘Ch™ge
 *

948 
	$íd£gmít_¸óã_ch™ge
(
NewOπhC⁄n
 *
‹th
, 
ch™ge_ty≥
 
ty≥
,

949 
£gmít
, 
Poöt
 *
poöt
,

950 
H™dÀ
 *
h™dÀ
)

952 
EndSegmítCh™ge
 *
ch™ge
;

954 
ch™ge
 = 
	`g_√w0
(
EndSegmítCh™ge
, 1);

956 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
íd£gmít_ch™ge_≠∂y
;

957 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
íd£gmít_ch™ge_ªvît
;

958 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
íd£gmít_ch™ge_‰ì
;

960 
ch™ge
->
ty≥
 =Åype;

961 
ch™ge
->
≠∂õd
 = 0;

962 
ch™ge
->
£gmít
 = segment;

963 
ch™ge
->
poöt
 = *point;

964 
ch™ge
->
h™dÀ
 = handle;

965 i‡(
£gmít
 == 0)

966 
ch™ge
->
ﬁd_íd_h™dÀ
 = 
‹th
->
h™dÀs
[0];

968 
ch™ge
->
ﬁd_íd_h™dÀ
 = 
‹th
->
h™dÀs
[‹th->
numpoöts
-2];

969 
ch™ge
->
˝
 = ch™ge->
ﬁd_íd_h™dÀ
->
c⁄√˘ed_to
;

970  (
Obje˘Ch™ge
 *)
ch™ge
;

971 
	}
}

975 
	$mid£gmít_ch™ge_‰ì
(
MidSegmítCh™ge
 *
ch™ge
)

977 i‡–(
ch™ge
->
ty≥
==
TYPE_ADD_SEGMENT
 && !ch™ge->
≠∂õd
) ||

978 (
ch™ge
->
ty≥
==
TYPE_REMOVE_SEGMENT
 && ch™ge->
≠∂õd
) ){

979 i‡(
ch™ge
->
h™dÀs
[0])

980 
	`g_‰ì
(
ch™ge
->
h™dÀs
[0]);

981 
ch™ge
->
h™dÀs
[0] = 
NULL
;

982 i‡(
ch™ge
->
h™dÀs
[1])

983 
	`g_‰ì
(
ch™ge
->
h™dÀs
[1]);

984 
ch™ge
->
h™dÀs
[1] = 
NULL
;

987 i‡(
ch™ge
->
˝lch™ge
[0]) {

988 i‡(
ch™ge
->
˝lch™ge
[0]->
‰ì
)

989 
ch™ge
->
˝lch™ge
[0]->
	`‰ì
(change->cplchange[0]);

990 
	`g_‰ì
(
ch™ge
->
˝lch™ge
[0]);

991 
ch™ge
->
˝lch™ge
[0] = 
NULL
;

993 i‡(
ch™ge
->
˝lch™ge
[1]) {

994 i‡(
ch™ge
->
˝lch™ge
[1]->
‰ì
)

995 
ch™ge
->
˝lch™ge
[1]->
	`‰ì
(change->cplchange[1]);

996 
	`g_‰ì
(
ch™ge
->
˝lch™ge
[1]);

997 
ch™ge
->
˝lch™ge
[1] = 
NULL
;

999 
	}
}

1002 
	$mid£gmít_ch™ge_≠∂y
(
MidSegmítCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1004 
NewOπhC⁄n
 *
‹th
 = (NewOπhC⁄¿*)
obj
;

1005 
£g
;

1007 
ch™ge
->
≠∂õd
 = 1;

1009 
ch™ge
->
ty≥
) {

1010 
TYPE_ADD_SEGMENT
:

1011 
	`add_poöt
(
‹th
, 
ch™ge
->
£gmít
+1, &ch™ge->
poöts
[1]);

1012 
	`add_poöt
(
‹th
, 
ch™ge
->
£gmít
+1, &ch™ge->
poöts
[0]);

1013 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
+1, ch™ge->
h™dÀs
[1],

1014 
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
] );

1015 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
+1, ch™ge->
h™dÀs
[0],

1016 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
]) );

1017 
ch™ge
->
˝lch™ge
[0] =

1018 
	`c⁄≈oöéöe_add_poöt
(
‹th
->
midpoöts
,&
ch™ge
->
poöts
[0]);

1019 
ch™ge
->
˝lch™ge
[1] =

1020 
	`c⁄≈oöéöe_add_poöt
(
‹th
->
midpoöts
,&
ch™ge
->
poöts
[1]);

1022 
TYPE_REMOVE_SEGMENT
:

1023 
£g
 = 
ch™ge
->
£gmít
?change->segment:1;

1024 
ch™ge
->
˝lch™ge
[0] =

1025 
	`c⁄≈oöéöe_ªmove_poöt
(
‹th
->
midpoöts
,

1026 &
‹th
->
poöts
[
£g
-1]);

1027 
ch™ge
->
˝lch™ge
[1] =

1028 
	`c⁄≈oöéöe_ªmove_poöt
(
‹th
->
midpoöts
,

1029 &
‹th
->
poöts
[
£g
]);

1030 
	`dñëe_poöt
(
‹th
, 
ch™ge
->
£gmít
);

1031 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
);

1032 
	`dñëe_poöt
(
‹th
, 
ch™ge
->
£gmít
);

1033 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
);

1034 i‡(
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
]==
HORIZONTAL
) {

1035 
‹th
->
poöts
[
ch™ge
->
£gmít
].
x
 = change->points[0].x;

1037 
‹th
->
poöts
[
ch™ge
->
£gmít
].
y
 = change->points[0].y;

1041 
	`√w‹thc⁄n_upd©e_midpoöts
(
‹th
);

1042 
	}
}

1045 
	$mid£gmít_ch™ge_ªvît
(
MidSegmítCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1047 
NewOπhC⁄n
 *
‹th
 = (NewOπhC⁄¿*)
obj
;

1049 
ch™ge
->
˝lch™ge
[0]->
	`ªvît
(ch™ge->˝lch™ge[0],
obj
);

1050 
ch™ge
->
˝lch™ge
[1]->
	`ªvît
(ch™ge->˝lch™ge[1],
obj
);

1052 
ch™ge
->
ty≥
) {

1053 
TYPE_ADD_SEGMENT
:

1054 
	`dñëe_poöt
(
‹th
, 
ch™ge
->
£gmít
+1);

1055 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
+1);

1056 
	`dñëe_poöt
(
‹th
, 
ch™ge
->
£gmít
+1);

1057 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
+1);

1059 
TYPE_REMOVE_SEGMENT
:

1060 i‡(
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
]==
HORIZONTAL
) {

1061 
‹th
->
poöts
[
ch™ge
->
£gmít
].
x
 = change->points[1].x;

1063 
‹th
->
poöts
[
ch™ge
->
£gmít
].
y
 = change->points[1].y;

1065 
	`add_poöt
(
‹th
, 
ch™ge
->
£gmít
, &ch™ge->
poöts
[1]);

1066 
	`add_poöt
(
‹th
, 
ch™ge
->
£gmít
, &ch™ge->
poöts
[0]);

1067 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
, ch™ge->
h™dÀs
[1],

1068 
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
-1] );

1069 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
, ch™ge->
h™dÀs
[0],

1070 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
-1]) );

1073 
ch™ge
->
≠∂õd
 = 0;

1074 
	}
}

1076 
Obje˘Ch™ge
 *

1077 
	$mid£gmít_¸óã_ch™ge
(
NewOπhC⁄n
 *
‹th
, 
ch™ge_ty≥
 
ty≥
,

1078 
£gmít
,

1079 
Poöt
 *
poöt1
, Poöà*
poöt2
,

1080 
H™dÀ
 *
h™dÀ1
, H™dÀ *
h™dÀ2
)

1082 
MidSegmítCh™ge
 *
ch™ge
;

1084 
ch™ge
 = 
	`g_√w
(
MidSegmítCh™ge
, 1);

1086 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
mid£gmít_ch™ge_≠∂y
;

1087 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
mid£gmít_ch™ge_ªvît
;

1088 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
mid£gmít_ch™ge_‰ì
;

1090 
ch™ge
->
ty≥
 =Åype;

1091 
ch™ge
->
≠∂õd
 = 0;

1092 
ch™ge
->
£gmít
 = segment;

1093 
ch™ge
->
poöts
[0] = *
poöt1
;

1094 
ch™ge
->
poöts
[1] = *
poöt2
;

1095 
ch™ge
->
h™dÀs
[0] = 
h™dÀ1
;

1096 
ch™ge
->
h™dÀs
[1] = 
h™dÀ2
;

1098  (
Obje˘Ch™ge
 *)
ch™ge
;

1099 
	}
}

	@O:\tool\dvs50\lib\neworth_conn.h

18 #i‚de‡
NEWORTH_CONN_H


19 
	#NEWORTH_CONN_H


	)

21 
	~"düty≥s.h
"

22 
	~"obje˘.h
"

23 
	~"c⁄≈oöt_löe.h
"

24 
	~"boundögbox.h
"

25 
	~"‹th_c⁄n.h
"

29 
	mHORIZONTAL
,

30 
	mVERTICAL


31 } 
	tOrõ¡©i⁄
;

33 
	#FLIP_ORIENT
(
x
Ë(((x)==
HORIZONTAL
)?
VERTICAL
:HORIZONTAL)

	)

35 
	#HANDLE_MIDPOINT
 (
HANDLE_CUSTOM1
)

	)

42 
	s_NewOπhC⁄n
 {

44 
DüObje˘
 
	mobje˘
;

46 
	mnumpoöts
;

47 
Poöt
 *
	mpoöts
;

48 
	mnum‹õ¡
;

49 
Orõ¡©i⁄
 *
	m‹õ¡©i⁄
;

50 
	mnumh™dÀs
;

51 
H™dÀ
 **
	mh™dÀs
;

58 
C⁄nPoötLöe
 *
	mmidpoöts
;

59 
PﬁyBBExåas
 
	mexåa_•acög
;

62 
DIAVAR
 
√w‹thc⁄n_upd©e_d©a
(
NewOπhC⁄n
 *
‹th
);

63 
DIAVAR
 
√w‹thc⁄n_upd©e_boundögbox
(
NewOπhC⁄n
 *
‹th
);

64 
√w‹thc⁄n_sim∂e_døw
(
NewOπhC⁄n
 *
‹th
, 
DüRídîî
 *
ªndîî
,

65 
ªÆ
 
width
);

66 
DIAVAR
 
√w‹thc⁄n_öô
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
°¨çoöt
);

67 
DIAVAR
 
√w‹thc⁄n_de°roy
(
NewOπhC⁄n
 *
‹th
);

68 
DIAVAR
 
√w‹thc⁄n_c›y
(
NewOπhC⁄n
 *
‰om
, NewOπhC⁄¿*
to
);

69 
DIAVAR
 
√w‹thc⁄n_ßve
(
NewOπhC⁄n
 *
‹th
, 
Obje˘Node
 
obj_node
);

70 
DIAVAR
 
√w‹thc⁄n_lﬂd
(
NewOπhC⁄n
 *
‹th
, 
Obje˘Node
 
obj_node
);

71 
DIAVAR
 
Obje˘Ch™ge
* 
√w‹thc⁄n_move_h™dÀ
(
NewOπhC⁄n
 *
‹th
, 
H™dÀ
 *
id
,

72 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

73 
H™dÀMoveRós⁄
 
ªas⁄
,

74 
ModifõrKeys
 
modifõrs
);

75 
DIAVAR
 
Obje˘Ch™ge
* 
√w‹thc⁄n_move
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
to
);

76 
DIAVAR
 
ªÆ
 
√w‹thc⁄n_di°™˚_‰om
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
poöt
,

77 
ªÆ
 
löe_width
);

78 
H™dÀ
* 
√w‹thc⁄n_gë_middÀ_h™dÀ
(
NewOπhC⁄n
 *
‹th
);

80 
DIAVAR
 
√w‹thc⁄n_ˇn_dñëe_£gmít
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
);

81 
DIAVAR
 
√w‹thc⁄n_ˇn_add_£gmít
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
);

82 
DIAVAR
 
Obje˘Ch™ge
 *
√w‹thc⁄n_dñëe_£gmít
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
);

83 
DIAVAR
 
Obje˘Ch™ge
 *
√w‹thc⁄n_add_£gmít
(
NewOπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
);

86 
	#NEWORTHCONN_COMMON_PROPERTIES
 \

87 
OBJECT_COMMON_PROPERTIES
, \

88 { "‹th_poöts", 
PROP_TYPE_POINTARRAY
, 0, "‹thc⁄¿poöts", 
NULL
}, \

89 { "‹th_‹õ¡", 
PROP_TYPE_ENUMARRAY
, 0, "‹thc⁄¿‹õ¡©i⁄s", 
NULL
} \

90 

	)

91 
	#NEWORTHCONN_COMMON_PROPERTIES_OFFSETS
 \

92 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

93 { "‹th_poöts", 
PROP_TYPE_POINTARRAY
, \

94 
	`off£tof
(
NewOπhC⁄n
,
poöts
), off£tof(NewOπhC⁄n,
numpoöts
)}, \

95 { "‹th_‹õ¡", 
PROP_TYPE_ENUMARRAY
, \

96 
	`off£tof
(
NewOπhC⁄n
,
‹õ¡©i⁄
), off£tof(NewOπhC⁄n,
num‹õ¡
)} \

97 

	)

	@O:\tool\dvs50\lib\objchange.c

19 
	~<c⁄fig.h
>

21 
	~"obje˘.h
"

25 
_Obje˘SèãCh™ge
 
	tObje˘SèãCh™ge
;

27 
	s_Obje˘SèãCh™ge
 {

28 
Obje˘Ch™ge
 
	mobj_ch™ge
;

30 
GëSèãFunc
 
	mgë_°©e
;

31 
SëSèãFunc
 
	m£t_°©e
;

33 
Obje˘Sèã
 *
	mßved_°©e
;

34 
DüObje˘
 *
	mobj
;

38 
	$obje˘_°©e_ch™ge_≠∂y_ªvît
(
Obje˘SèãCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

40 
Obje˘Sèã
 *
ﬁd_°©e
;

42 
ﬁd_°©e
 = 
ch™ge
->
	`gë_°©e
(ch™ge->
obj
);

44 
ch™ge
->
	`£t_°©e
(ch™ge->
obj
, ch™ge->
ßved_°©e
);

46 
ch™ge
->
ßved_°©e
 = 
ﬁd_°©e
;

47 
	}
}

50 
	$obje˘_°©e_ch™ge_‰ì
(
Obje˘SèãCh™ge
 *
ch™ge
)

52 i‡((
ch™ge
Ë&& (ch™ge->
ßved_°©e
Ë&& (ch™ge->ßved_°©e->
‰ì
))

53 (*
ch™ge
->
ßved_°©e
->
‰ì
)(change->saved_state);

54 
	`g_‰ì
(
ch™ge
->
ßved_°©e
);

55 
	}
}

57 
Obje˘Ch™ge
 *
	$√w_obje˘_°©e_ch™ge
(
DüObje˘
 *
obj
,

58 
Obje˘Sèã
 *
ﬁd_°©e
,

59 
GëSèãFunc
 
gë_°©e
,

60 
SëSèãFunc
 
£t_°©e
 )

62 
Obje˘SèãCh™ge
 *
ch™ge
;

64 
	`g_ªtu∫_vÆ_if_Áû
 (
gë_°©e
 !
NULL
 && 
£t_°©e
 != NULL, NULL);

66 
ch™ge
 = 
	`g_√w
(
Obje˘SèãCh™ge
, 1);

68 
ch™ge
->
obj_ch™ge
.
≠∂y
 =

69 (
Obje˘Ch™geAµlyFunc
Ë
obje˘_°©e_ch™ge_≠∂y_ªvît
;

70 
ch™ge
->
obj_ch™ge
.
ªvît
 =

71 (
Obje˘Ch™geRevîtFunc
Ë
obje˘_°©e_ch™ge_≠∂y_ªvît
;

72 
ch™ge
->
obj_ch™ge
.
‰ì
 =

73 (
Obje˘Ch™geFªeFunc
Ë
obje˘_°©e_ch™ge_‰ì
;

75 
ch™ge
->
gë_°©e
 = get_state;

76 
ch™ge
->
£t_°©e
 = set_state;

78 
ch™ge
->
obj
 = obj;

79 
ch™ge
->
ßved_°©e
 = 
ﬁd_°©e
;

81  (
Obje˘Ch™ge
 *)
ch™ge
;

82 
	}
}

	@O:\tool\dvs50\lib\objchange.h

20 #i‚de‡
OBJCHANGE_H


21 
	#OBJCHANGE_H


	)

23 
	~"düty≥s.h
"

25 (*
	tObje˘Ch™geAµlyFunc
)(
	tObje˘Ch™ge
 *
	tch™ge
, 
	tDüObje˘
 *
	tobj
);

26 (*
	tObje˘Ch™geRevîtFunc
)(
	tObje˘Ch™ge
 *
	tch™ge
, 
	tDüObje˘
 *
	tobj
);

27 (*
	tObje˘Ch™geFªeFunc
)(
	tObje˘Ch™ge
 *
	tch™ge
);

35 
	s_Obje˘Ch™ge
 {

38 
Obje˘Ch™geAµlyFunc
 
≠∂y
;

39 
Obje˘Ch™geRevîtFunc
 
ªvît
;

40 
Obje˘Ch™geFªeFunc
 
‰ì
;

45 
	s_Obje˘Sèã
 {

46 (*
‰ì
)(
Obje˘Sèã
 *
°©e
);

60 
Obje˘Sèã
 * (*
	tGëSèãFunc
Ë(
	tDüObje˘
* 
	tobj
);

70 (*
	tSëSèãFunc
Ë(
	tDüObje˘
* 
	tobj
, 
	tObje˘Sèã
 *
	t°©e
);

73 
DIAVAR
 
Obje˘Ch™ge
 *
	`√w_obje˘_°©e_ch™ge
(
DüObje˘
 *
obj
,

74 
Obje˘Sèã
 *
ﬁd_°©e
,

75 
GëSèãFunc
 
gë_°©e
,

76 
SëSèãFunc
 
£t_°©e
 );

	@O:\tool\dvs50\lib\object.c

20 
	~<c⁄fig.h
>

22 
	~<°dio.h
>

23 
	~<°rög.h
>

25 
	~<gtk/gtk.h
>

27 
	~"obje˘.h
"

28 
	~"dügømd©a.h
"

29 
	~"mesßge.h
"

30 
	~"∑ª¡.h
"

32 
	~"dummy_dï.h
"

34 
	~"debug.h
"

45 
	$obje˘_öô
(
DüObje˘
 *
obj
,

46 
num_h™dÀs
,

47 
num_c⁄√˘i⁄s
)

49 
obj
->
num_h™dÀs
 =Çum_handles;

50 i‡(
num_h™dÀs
>0)

51 
obj
->
h™dÀs
 = 
	`g_mÆloc0
((
H™dÀ
 *Ë* 
num_h™dÀs
);

53 
obj
->
h™dÀs
 = 
NULL
;

55 
obj
->
num_c⁄√˘i⁄s
 =Çum_connections;

56 i‡(
num_c⁄√˘i⁄s
>0)

57 
obj
->
c⁄√˘i⁄s
 = 
	`g_mÆloc0
((
C⁄√˘i⁄Poöt
 *Ë* 
num_c⁄√˘i⁄s
);

59 
obj
->
c⁄√˘i⁄s
 = 
NULL
;

60 
	}
}

68 
	$obje˘_de°roy
(
DüObje˘
 *
obj
)

70 
	`obje˘_unc⁄√˘_Æl
(
obj
);

72 i‡(
obj
->
h™dÀs
)

73 
	`g_‰ì
(
obj
->
h™dÀs
);

74 
obj
->
h™dÀs
 = 
NULL
;

75 i‡(
obj
->
c⁄√˘i⁄s
)

76 
	`g_‰ì
(
obj
->
c⁄√˘i⁄s
);

77 
obj
->
c⁄√˘i⁄s
 = 
NULL
;

78 i‡(
obj
->
mëa
)

79 
	`g_hash_èbÀ_de°roy
 (
obj
->
mëa
);

80 
obj
->
mëa
 = 
NULL
;

81 
	}
}

99 
	$obje˘_c›y
(
DüObje˘
 *
‰om
, DüObje˘ *
to
)

101 
to
->
ty≥
 = 
‰om
->type;

102 
to
->
posôi⁄
 = 
‰om
->position;

103 
to
->
boundög_box
 = 
‰om
->bounding_box;

105 
to
->
num_h™dÀs
 = 
‰om
->num_handles;

106 i‡(
to
->
h™dÀs
 !
NULL
Ë
	`g_‰ì
(to->handles);

107 i‡(
to
->
num_h™dÀs
>0)

108 
to
->
h™dÀs
 = 
	`g_mÆloc
((
H™dÀ
 *)*to->
num_h™dÀs
);

110 
to
->
h™dÀs
 = 
NULL
;

112 
to
->
num_c⁄√˘i⁄s
 = 
‰om
->num_connections;

113 i‡(
to
->
c⁄√˘i⁄s
 !
NULL
Ë
	`g_‰ì
(to->connections);

114 i‡(
to
->
num_c⁄√˘i⁄s
>0)

115 
to
->
c⁄√˘i⁄s
 = 
	`g_mÆloc0
((
C⁄√˘i⁄Poöt
 *Ë*Åo->
num_c⁄√˘i⁄s
);

117 
to
->
c⁄√˘i⁄s
 = 
NULL
;

119 
to
->
›s
 = 
‰om
->ops;

121 
to
->
Êags
 = 
‰om
->flags;

122 
to
->
∑ª¡
 = 
‰om
->parent;

123 
to
->
chûdªn
 = 
	`g_li°_c›y
(
‰om
->children);

124 
	}
}

129 
guöt


130 
	$poöãr_hash
(
gpoöãr
 
some_poöãr
)

132  
	`GPOINTER_TO_UINT
(
some_poöãr
);

133 
	}
}

146 
GLi°
 *

147 
	$obje˘_c›y_li°
(
GLi°
 *
li°_‹ig
)

149 
GLi°
 *
li°_c›y
;

150 
GLi°
 *
li°
;

151 
DüObje˘
 *
obj
;

152 
DüObje˘
 *
obj_c›y
;

153 
GHashTabÀ
 *
hash_èbÀ
;

154 
i
;

156 
hash_èbÀ
 = 
	`g_hash_èbÀ_√w
((
GHashFunc
Ë
poöãr_hash
, 
NULL
);

159 
li°
 = 
li°_‹ig
;

160 
li°_c›y
 = 
NULL
;

161 
li°
 !
NULL
) {

162 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

164 
obj_c›y
 = 
obj
->
›s
->
	`c›y
(obj);

166 
	`g_hash_èbÀ_ö£π
(
hash_èbÀ
, 
obj
, 
obj_c›y
);

168 
li°_c›y
 = 
	`g_li°_≠≥nd
÷i°_c›y, 
obj_c›y
);

170 
li°
 = 
	`g_li°_√xt
(list);

175 
li°
 = 
li°_‹ig
;

176 
li°
 !
NULL
) {

177 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

178 
obj_c›y
 = 
	`g_hash_èbÀ_lookup
(
hash_èbÀ
, 
obj
);

180 i‡(
obj_c›y
->
∑ª¡
)

181 
obj_c›y
->
∑ª¡
 = 
	`g_hash_èbÀ_lookup
(
hash_èbÀ
, obj_copy->parent);

183 i‡(
	`obje˘_Êags_£t
(
obj_c›y
, 
DIA_OBJECT_CAN_PARENT
)

184 && 
obj_c›y
->
chûdªn
)

186 
GLi°
 *
chûd_li°
 = 
obj_c›y
->
chûdªn
;

187 
chûd_li°
)

189 
DüObje˘
 *
chûd_obj
 = (DüObje˘ *Ë
chûd_li°
->
d©a
;

190 
chûd_li°
->
d©a
 = 
	`g_hash_èbÀ_lookup
(
hash_èbÀ
, 
chûd_obj
);

191 
chûd_li°
 = 
	`g_li°_√xt
(child_list);

195 
i
=0;i<
obj
->
num_h™dÀs
;i++) {

196 
C⁄√˘i⁄Poöt
 *
c⁄_poöt
;

197 
c⁄_poöt
 = 
obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
;

199 i‡–
c⁄_poöt
 !
NULL
 ) {

200 
DüObje˘
 *
Ÿhî_obj
;

201 
DüObje˘
 *
Ÿhî_obj_c›y
;

202 
c⁄_poöt_ƒ
;

204 
Ÿhî_obj
 = 
c⁄_poöt
->
obje˘
;

205 
Ÿhî_obj_c›y
 = 
	`g_hash_èbÀ_lookup
(
hash_èbÀ
, 
Ÿhî_obj
);

207 i‡(
Ÿhî_obj_c›y
 =
NULL
) {

218 
obj_c›y
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 = 
NULL
;

222 
c⁄_poöt_ƒ
=0;

223 
Ÿhî_obj
->
c⁄√˘i⁄s
[
c⁄_poöt_ƒ
] !
c⁄_poöt
) {

224 
c⁄_poöt_ƒ
++;

227 
	`obje˘_c⁄√˘
(
obj_c›y
, obj_c›y->
h™dÀs
[
i
],

228 
Ÿhî_obj_c›y
->
c⁄√˘i⁄s
[
c⁄_poöt_ƒ
]);

232 
li°
 = 
	`g_li°_√xt
(list);

235 
	`g_hash_èbÀ_de°roy
(
hash_èbÀ
);

237  
li°_c›y
;

238 
	}
}

253 
Obje˘Ch™ge
*

254 
	$obje˘_li°_move_dñè_r
(
GLi°
 *
obje˘s
, 
Poöt
 *
dñè
, 
gboﬁón
 
af„˘ed
)

256 
GLi°
 *
li°
;

257 
DüObje˘
 *
obj
;

258 
Poöt
 
pos
;

259 
Obje˘Ch™ge
 *
objch™ge
 = 
NULL
;

261 i‡(
dñè
->
x
 =0 && dñè->
y
 == 0)

262  
NULL
;

264 
li°
 = 
obje˘s
;

265 
li°
 !
NULL
) {

266 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

268 
pos
 = 
obj
->
posôi⁄
;

269 
	`poöt_add
(&
pos
, 
dñè
);

271 i‡(
obj
->
∑ª¡
 && 
af„˘ed
)

273 
Re˘™gÀ
 
p_ext
;

274 
Re˘™gÀ
 
c_ext
;

275 
Poöt
 
√w_dñè
;

277 
	`∑ª¡_h™dÀ_exã¡s
(
obj
->
∑ª¡
, &
p_ext
);

278 
	`∑ª¡_h™dÀ_exã¡s
(
obj
, &
c_ext
);

279 
√w_dñè
 = 
	`∑ª¡_move_chûd_dñè
(&
p_ext
, &
c_ext
, 
dñè
);

280 
	`poöt_add
(&
pos
, &
√w_dñè
);

281 
	`poöt_add
(
dñè
, &
√w_dñè
);

283 
objch™ge
 = 
obj
->
›s
->
	`move
(obj, &
pos
);

285 i‡(
	`obje˘_Êags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
Ë&& obj->
chûdªn
)

286 
objch™ge
 = 
	`obje˘_li°_move_dñè_r
(
obj
->
chûdªn
, 
dñè
, 
FALSE
);

288 
li°
 = 
	`g_li°_√xt
(list);

290  
objch™ge
;

291 
	}
}

298 
Obje˘Ch™ge
*

299 
	$obje˘_li°_move_dñè
(
GLi°
 *
obje˘s
, 
Poöt
 *
dñè
)

301 
GLi°
 *
li°
;

302 
DüObje˘
 *
obj
;

303 
GLi°
 *
¥o˚ss
;

304 
Obje˘Ch™ge
 *
objch™ge
 = 
NULL
;

306 
obje˘s
 = 
	`∑ª¡_li°_af„˘ed_hõørchy
(objects);

307 
li°
 = 
obje˘s
;

310 
li°
 !
NULL
)

312 
obj
 = (
DüObje˘
 *Ë
li°
->
d©a
;

314 
¥o˚ss
 = 
NULL
;

315 
¥o˚ss
 = 
	`g_li°_≠≥nd
’ro˚ss, 
obj
);

316 
objch™ge
 = 
	`obje˘_li°_move_dñè_r
(
¥o˚ss
, 
dñè
, (
obj
->
∑ª¡
 !
NULL
) );

317 
	`g_li°_‰ì
(
¥o˚ss
);

319 
li°
 = 
	`g_li°_√xt
(list);

321  
objch™ge
;

322 
	}
}

329 
	$de°roy_obje˘_li°
(
GLi°
 *
li°_to_be_de°royed
)

331 
GLi°
 *
li°
;

332 
DüObje˘
 *
obj
;

334 
li°
 = 
li°_to_be_de°royed
;

335 
li°
 !
NULL
) {

336 
obj
 = (
DüObje˘
 *)
li°
->
d©a
;

338 
obj
->
›s
->
	`de°roy
(obj);

339 
	`g_‰ì
(
obj
);

341 
li°
 = 
	`g_li°_√xt
(list);

344 
	`g_li°_‰ì
(
li°_to_be_de°royed
);

345 
	}
}

355 
	$obje˘_add_h™dÀ
(
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
)

357 
	`obje˘_add_h™dÀ_©
(
obj
, 
h™dÀ
, obj->
num_h™dÀs
);

358 
	}
}

369 
	$obje˘_add_h™dÀ_©
(
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
, 
pos
)

371 
i
;

373 
	`g_as£π
(0 <
pos
 &&Öo†<
obj
->
num_h™dÀs
);

375 
obj
->
num_h™dÀs
++;

377 
obj
->
h™dÀs
 =

378 
	`g_ªÆloc
(
obj
->
h™dÀs
, obj->
num_h™dÀs
*(
H™dÀ
 *));

380 
i
=
obj
->
num_h™dÀs
-1; i > 
pos
; i--) {

381 
obj
->
h™dÀs
[
i
] = obj->handles[i-1];

383 
obj
->
h™dÀs
[
pos
] = 
h™dÀ
;

384 
	}
}

393 
	$obje˘_ªmove_h™dÀ
(
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
)

395 
i
, 
h™dÀ_ƒ
;

397 
h™dÀ_ƒ
 = -1;

398 
i
=0;i<
obj
->
num_h™dÀs
;i++) {

399 i‡(
obj
->
h™dÀs
[
i
] =
h™dÀ
)

400 
h™dÀ_ƒ
 = 
i
;

403 i‡(
h™dÀ_ƒ
 < 0) {

404 
	`mesßge_îr‹
("InternalÉrror, object_remove_handle: Handle doesn'tÉxist");

408 
i
=
h™dÀ_ƒ
;i<(
obj
->
num_h™dÀs
-1);i++) {

409 
obj
->
h™dÀs
[
i
] = obj->handles[i+1];

411 
obj
->
h™dÀs
[obj->
num_h™dÀs
-1] = 
NULL
;

413 
obj
->
num_h™dÀs
--;

415 
obj
->
h™dÀs
 =

416 
	`g_ªÆloc
(
obj
->
h™dÀs
, obj->
num_h™dÀs
*(
H™dÀ
 *));

417 
	}
}

425 
	$obje˘_add_c⁄√˘i⁄poöt
(
DüObje˘
 *
obj
, 
C⁄√˘i⁄Poöt
 *
c⁄poöt
)

427 
	`obje˘_add_c⁄√˘i⁄poöt_©
(
obj
, 
c⁄poöt
, obj->
num_c⁄√˘i⁄s
);

428 
	}
}

437 
	$obje˘_add_c⁄√˘i⁄poöt_©
(
DüObje˘
 *
obj
,

438 
C⁄√˘i⁄Poöt
 *
c⁄poöt
, 
pos
)

440 
i
;

442 
obj
->
num_c⁄√˘i⁄s
++;

444 
obj
->
c⁄√˘i⁄s
 =

445 
	`g_ªÆloc
(
obj
->
c⁄√˘i⁄s
,

446 
obj
->
num_c⁄√˘i⁄s
*(
C⁄√˘i⁄Poöt
 *));

448 
i
=
obj
->
num_c⁄√˘i⁄s
-1; i > 
pos
; i--) {

449 
obj
->
c⁄√˘i⁄s
[
i
] = obj->connections[i-1];

451 
obj
->
c⁄√˘i⁄s
[
pos
] = 
c⁄poöt
;

452 
	}
}

464 
	$obje˘_ªmove_c⁄√˘i⁄poöt
(
DüObje˘
 *
obj
, 
C⁄√˘i⁄Poöt
 *
c⁄poöt
)

466 
i
, 
ƒ
;

468 
ƒ
 = -1;

469 
i
=0;i<
obj
->
num_c⁄√˘i⁄s
;i++) {

470 i‡(
obj
->
c⁄√˘i⁄s
[
i
] =
c⁄poöt
)

471 
ƒ
 = 
i
;

474 i‡(
ƒ
 < 0) {

475 
	`mesßge_îr‹
("InternalÉrror, object_remove_connectionpoint: "

480 
	`obje˘_ªmove_c⁄√˘i⁄s_to
(
c⁄poöt
);

482 
i
=
ƒ
;i<(
obj
->
num_c⁄√˘i⁄s
-1);i++) {

483 
obj
->
c⁄√˘i⁄s
[
i
] = obj->connections[i+1];

485 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1] = 
NULL
;

487 
obj
->
num_c⁄√˘i⁄s
--;

489 
obj
->
c⁄√˘i⁄s
 =

490 
	`g_ªÆloc
(
obj
->
c⁄√˘i⁄s
, obj->
num_c⁄√˘i⁄s
*(
C⁄√˘i⁄Poöt
 *));

491 
	}
}

502 
	$obje˘_c⁄√˘
(
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
,

503 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
)

505 
	`g_ªtu∫_if_Áû
 (
obj
 && obj->
ty≥
 && obj->ty≥->
«me
);

506 
	`g_ªtu∫_if_Áû
 (
c⁄√˘i⁄poöt
 && c⁄√˘i⁄poöt->
obje˘
 &&

507 
c⁄√˘i⁄poöt
->
obje˘
->
ty≥
 && c⁄√˘i⁄poöt->obje˘->ty≥->
«me
);

508 i‡(
h™dÀ
->
c⁄√˘_ty≥
==
HANDLE_NONCONNECTABLE
) {

509 
	`mesßge_îr‹
("Error?ÅryingÅo connectáÇon connectable handle.\n"

512 
obj
->
ty≥
->
«me
,

513 
c⁄√˘i⁄poöt
->
obje˘
->
ty≥
->
«me
);

516 
h™dÀ
->
c⁄√˘ed_to
 = 
c⁄√˘i⁄poöt
;

517 
c⁄√˘i⁄poöt
->
c⁄√˘ed
 =

518 
	`g_li°_¥ïíd
(
c⁄√˘i⁄poöt
->
c⁄√˘ed
, 
obj
);

519 
	}
}

526 
	$obje˘_unc⁄√˘
(
DüObje˘
 *
c⁄√˘ed_obj
, 
H™dÀ
 *
h™dÀ
)

528 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
;

530 
c⁄√˘i⁄poöt
 = 
h™dÀ
->
c⁄√˘ed_to
;

532 i‡(
c⁄√˘i⁄poöt
!=
NULL
) {

533 
c⁄√˘i⁄poöt
->
c⁄√˘ed
 =

534 
	`g_li°_ªmove
(
c⁄√˘i⁄poöt
->
c⁄√˘ed
, 
c⁄√˘ed_obj
);

535 
h™dÀ
->
c⁄√˘ed_to
 = 
NULL
;

537 
	}
}

546 
	$obje˘_ªmove_c⁄√˘i⁄s_to
(
C⁄√˘i⁄Poöt
 *
c⁄poöt
)

548 
GLi°
 *
li°
;

549 
DüObje˘
 *
c⁄√˘ed_obj
;

550 
i
;

552 
li°
 = 
c⁄poöt
->
c⁄√˘ed
;

553 
li°
 !
NULL
) {

554 
c⁄√˘ed_obj
 = (
DüObje˘
 *)
li°
->
d©a
;

556 
i
=0;i<
c⁄√˘ed_obj
->
num_h™dÀs
;i++) {

557 i‡(
c⁄√˘ed_obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 =
c⁄poöt
) {

558 
c⁄√˘ed_obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 = 
NULL
;

561 
li°
 = 
	`g_li°_√xt
(list);

563 
	`g_li°_‰ì
(
c⁄poöt
->
c⁄√˘ed
);

564 
c⁄poöt
->
c⁄√˘ed
 = 
NULL
;

565 
	}
}

571 
	$obje˘_unc⁄√˘_Æl
(
DüObje˘
 *
obj
)

573 
i
;

575 
i
=0;i<
obj
->
num_h™dÀs
;i++) {

576 
	`obje˘_unc⁄√˘
(
obj
, obj->
h™dÀs
[
i
]);

578 
i
=0;i<
obj
->
num_c⁄√˘i⁄s
;i++) {

579 
	`obje˘_ªmove_c⁄√˘i⁄s_to
(
obj
->
c⁄√˘i⁄s
[
i
]);

581 
	}
}

590 
	$obje˘_ßve
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
)

592 
	`d©a_add_poöt
(
	`√w_©åibuã
(
obj_node
, "obj_pos"),

593 &
obj
->
posôi⁄
);

594 
	`d©a_add_ª˘™gÀ
(
	`√w_©åibuã
(
obj_node
, "obj_bb"),

595 &
obj
->
boundög_box
);

596 i‡(
obj
->
mëa
)

597 
	`d©a_add_di˘
 (
	`√w_©åibuã
(
obj_node
, "mëa"), 
obj
->
mëa
);

598 
	}
}

607 
	$obje˘_lﬂd
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
)

609 
AâribuãNode
 
©å
;

611 
obj
->
posôi⁄
.
x
 = 0.0;

612 
obj
->
posôi⁄
.
y
 = 0.0;

613 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "obj_pos");

614 i‡(
©å
 !
NULL
)

615 
	`d©a_poöt
–
	`©åibuã_fú°_d©a
(
©å
), &
obj
->
posôi⁄
 );

617 
obj
->
boundög_box
.
À·
 = obj->boundög_box.
right
 = 0.0;

618 
obj
->
boundög_box
.
t›
 = obj->boundög_box.
bŸtom
 = 0.0;

619 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "obj_bb");

620 i‡(
©å
 !
NULL
)

621 
	`d©a_ª˘™gÀ
–
	`©åibuã_fú°_d©a
(
©å
), &
obj
->
boundög_box
 );

623 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "meta");

624 i‡(
©å
 !
NULL
)

625 
obj
->
mëa
 = 
	`d©a_di˘
 (
	`©åibuã_fú°_d©a
(
©å
));

626 
	}
}

633 
Layî
 *

634 
	$dü_obje˘_gë_∑ª¡_œyî
(
DüObje˘
 *
obj
) {

635  
obj
->
∑ª¡_œyî
;

636 
	}
}

646 
gboﬁón


647 
	$dü_obje˘_is_£À˘ed
 (c⁄° 
DüObje˘
 *
obj
)

649 
Layî
 *
œyî
 = 
obj
->
∑ª¡_œyî
;

650 
DügømD©a
 *
dügøm
 = 
œyî
 ?Üayî->
∑ª¡_dügøm
 : 
NULL
;

651 
GLi°
 * 
£À˘ed
;

659 i‡(!
dügøm
)

660  
FALSE
;

662 
£À˘ed
 = 
dügøm
->selected;

663 ; 
£À˘ed
 !
NULL
; sñe˘ed = 
	`g_li°_√xt
(selected)) {

664 i‡(
£À˘ed
->
d©a
 =
obj
Ë 
TRUE
;

666  
FALSE
;

667 
	}
}

679 
DüObje˘
 *

680 
	$dü_obje˘_gë_∑ª¡_wôh_Êags
(
DüObje˘
 *
obj
, 
guöt
 
Êags
)

682 
DüObje˘
 *
t›
 = 
obj
;

683 i‡(
obj
 =
NULL
) {

684  
NULL
;

686 
obj
->
∑ª¡
 !
NULL
) {

687 
obj
 = obj->
∑ª¡
;

688 i‡((
obj
->
Êags
 & flags) == flags) {

689 
t›
 = 
obj
;

692  
t›
;

693 
	}
}

703 
gboﬁón


704 
	$dü_obje˘_is_£À˘abÀ
(
DüObje˘
 *
obj
)

706 i‡(
obj
->
∑ª¡_œyî
 =
NULL
) {

707  
FALSE
;

709  
obj
->
∑ª¡_œyî
 =obj->∑ª¡_œyî->
∑ª¡_dügøm
->
a˘ive_œyî


710 && 
obj
 =
	`dü_obje˘_gë_∑ª¡_wôh_Êags
(obj, 
DIA_OBJECT_GRABS_CHILD_INPUT
);

711 
	}
}

713 #ifde‡
DEBUG


714 
	$¥ötKey
(
gpoöãr
 
key
,gpoöã∏
vÆue
,gpoöã∏
d©a
)

716 
	`g_¥ötf
("Key i†%s: ",
key
);

717 
	`g_¶i°_f‹óch
((
GLi°
*)
vÆue
,(
GFunc
)
g_¥ötf
,
NULL
);

718 
	`g_¥ötf
("\n");

719 
	}
}

724 
guöt
 
	$hash
(
gpoöãr
 
key
)

726 *
°rög
 = (*)
key
;

727 
sum
;

729 
sum
 = 0;

730 *
°rög
) {

731 
sum
 +(*
°rög
);

732 
°rög
++;

735  
sum
;

736 
	}
}

738 
göt
 
	$com∑ª
(
gpoöãr
 
a
, gpoöã∏
b
)

740  
	`°rcmp
((*)
a
, (*)
b
)==0;

741 
	}
}

743 
GHashTabÀ
 *
obje˘_ty≥_èbÀ
 = 
NULL
;

747 
	$obje˘_ªgi°ry_öô
()

749 
obje˘_ty≥_èbÀ
 = 
	`g_hash_èbÀ_√w
–(
GHashFunc
Ë
hash
, (
GCom∑ªFunc
Ë
com∑ª
 );

750 
	}
}

760 
	$obje˘_ªgi°î_ty≥
(
DüObje˘Ty≥
 *
ty≥
)

762 i‡(
	`g_hash_èbÀ_lookup
(
obje˘_ty≥_èbÀ
, 
ty≥
->
«me
Ë!
NULL
) {

763 
	`mesßge_w¨nög
("Several object-types wereÇamed %s.\n"

766 
ty≥
->
«me
);

769 
	`g_hash_èbÀ_ö£π
(
obje˘_ty≥_èbÀ
, 
ty≥
->
«me
,Åype);

770 
	}
}

778 
	$obje˘_ªgi°ry_f‹óch
 (
GHFunc
 
func
, 
gpoöãr
 
u£r_d©a
)

780 
	`g_hash_èbÀ_f‹óch
 (
obje˘_ty≥_èbÀ
, 
func
, 
u£r_d©a
);

781 
	}
}

790 
DIAVAR
 
DüObje˘Ty≥
 *

791 
	$obje˘_gë_ty≥
(*
«me
)

793  (
DüObje˘Ty≥
 *Ë
	`g_hash_èbÀ_lookup
(
obje˘_ty≥_èbÀ
, 
«me
);

794 
	}
}

801 
gboﬁón


802 
	$obje˘_Êags_£t
(
DüObje˘
 *
obj
, 
göt
 
Êags
)

804  (
obj
->
Êags
 & flags) == flags;

805 
	}
}

818 
DüObje˘
 *

819 
	$obje˘_lﬂd_usög_¥›îtõs
(c⁄° 
DüObje˘Ty≥
 *
ty≥
,

820 
Obje˘Node
 
obj_node
, 
vîsi⁄
,

821 c⁄° *
fûíame
)

823 
DüObje˘
 *
obj
;

824 
Poöt
 
°¨çoöt
 = {0.0,0.0};

825 
H™dÀ
 *
h™dÀ1
,*
h™dÀ2
;

827 
obj
 = 
ty≥
->
›s
->
	`¸óã
(&
°¨çoöt
,
NULL
, &
h™dÀ1
,&
h™dÀ2
);

828 
	`obje˘_lﬂd_¥›s
(
obj
,
obj_node
);

829  
obj
;

830 
	}
}

842 
	$obje˘_ßve_usög_¥›îtõs
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
,

843 
vîsi⁄
, c⁄° *
fûíame
)

845 
	`obje˘_ßve_¥›s
(
obj
,
obj_node
);

846 
	}
}

853 
DüObje˘
 *
	$obje˘_c›y_usög_¥›îtõs
(
DüObje˘
 *
obj
)

855 
Poöt
 
°¨çoöt
 = {0.0,0.0};

856 
H™dÀ
 *
h™dÀ1
,*
h™dÀ2
;

857 
DüObje˘
 *
√wobj
 = 
obj
->
ty≥
->
›s
->
	`¸óã
(&
°¨çoöt
,
NULL
,

858 &
h™dÀ1
,&
h™dÀ2
);

859 
	`obje˘_c›y_¥›s
(
√wobj
,
obj
,
FALSE
);

860  
√wobj
;

861 
	}
}

870 c⁄° 
Re˘™gÀ
 *

871 
	$dü_obje˘_gë_boundög_box
(c⁄° 
DüObje˘
 *
obj
) {

872  &
obj
->
boundög_box
;

873 
	}
}

880 c⁄° 
Re˘™gÀ
 *
	$dü_obje˘_gë_í˛osög_box
(c⁄° 
DüObje˘
 *
obj
) {

884 i‡(
obj
->
í˛osög_box
.
t›
 == 0.0 &&

885 
obj
->
í˛osög_box
.
bŸtom
 == 0.0 &&

886 
obj
->
í˛osög_box
.
À·
 == 0.0 &&

887 
obj
->
í˛osög_box
.
right
 == 0.0) {

888  &
obj
->
boundög_box
;

890 }  &
obj
->
í˛osög_box
;

891 
	}
}

900 
gboﬁón


901 
	$dü_obje˘_ßnôy_check
(c⁄° 
DüObje˘
 *
obj
, c⁄° 
gch¨
 *
msg
) {

902 
i
;

904 
	`dü_as£π_åue
(
obj
->
ty≥
 !
NULL
,

906 
msg
, 
obj
);

907 i‡(
obj
 !
NULL
) {

908 
	`dü_as£π_åue
(
obj
->
ty≥
->
«me
 !
NULL
 &&

909 
	`g_utf8_vÆid©e
(
obj
->
ty≥
->
«me
, -1, 
NULL
),

911 
msg
, 
obj
, obj->
ty≥
->
«me
);

914 
	`dü_as£π_åue
(
obj
->
num_h™dÀs
 >= 0,

916 
msg
, 
obj
, obj->
num_h™dÀs
);

917 i‡(
obj
->
num_h™dÀs
 != 0) {

918 
	`dü_as£π_åue
(
obj
->
h™dÀs
 !
NULL
,

919 "%s: Obje˘ %∞ha†nuŒ h™dÀs\n", 
obj
);

921 
i
 = 0; i < 
obj
->
num_h™dÀs
; i++) {

922 
H™dÀ
 *
h
 = 
obj
->
h™dÀs
[
i
];

923 
	`dü_as£π_åue
(
h
 !
NULL
, "%s: Object %p handle %d isÇull\n",

924 
msg
, 
obj
, 
i
);

925 i‡(
h
 !
NULL
) {

927 
	`dü_as£π_åue
((
h
->
id
 >0 && h->id <
HANDLE_MOVE_ENDPOINT
)

928 || (
h
->
id
 >
HANDLE_CUSTOM1
 && h->id <
HANDLE_CUSTOM9
),

930 
msg
, 
obj
, 
i
, 
h
, h->
id
);

932 
	`dü_as£π_åue
(
h
->
ty≥
 >0 && h->ty≥ <
NUM_HANDLE_TYPES
,

934 
msg
, 
obj
, 
i
, 
h
, h->
ty≥
);

937 
	`dü_as£π_åue
(
h
->
c⁄√˘_ty≥
 >= 0

938 && 
h
->
c⁄√˘_ty≥
 <
HANDLE_CONNECTABLE_NOBREAK
,

940 
msg
, 
obj
, 
i
, 
h
, h->
c⁄√˘_ty≥
);

943 
C⁄√˘i⁄Poöt
 *
˝
 = 
h
->
c⁄√˘ed_to
;

944 i‡(
˝
 !
NULL
) {

945 
gboﬁón
 
found
 = 
FALSE
;

946 
GLi°
 *
c⁄ns
;

947 i‡(!
	`dü_as£π_åue
(
˝
->
obje˘
 !
NULL
,

949 
msg
, 
i
, 
h
, 
obj
, 
˝
)) ;

950 i‡(!
	`dü_as£π_åue
(
˝
->
obje˘
->
ty≥
 !
NULL
,

952 
msg
, 
i
, 
h
, 
obj
, 
˝
, cp->
obje˘
)) ;

953 i‡(!
	`dü_as£π_åue
(
˝
->
obje˘
->
ty≥
->
«me
 !
NULL
 &&

954 
	`g_utf8_vÆid©e
(
˝
->
obje˘
->
ty≥
->
«me
, -1, 
NULL
),

956 
msg
, 
i
, 
h
, 
obj
, 
˝
, cp->
obje˘
)) ;

957 
	`dü_as£π_åue
(
	`Ábs
(
˝
->
pos
.
x
 - 
h
->pos.x) < 0.0000001 &&

958 
	`Ábs
(
˝
->
pos
.
y
 - 
h
->pos.y) < 0.0000001,

960 
msg
, 
i
, 
h
, 
obj
, h->
pos
.
x
, h->pos.
y
,

961 
˝
, cp->
obje˘
, cp->
pos
.
x
, cp->pos.
y
);

962 
c⁄ns
 = 
˝
->
c⁄√˘ed
; c⁄n†!
NULL
; c⁄n†
	`g_li°_√xt
(conns)) {

963 
DüObje˘
 *
obj2
 = (DüObje˘ *)
c⁄ns
->
d©a
;

964 
j
;

966 
j
 = 0; j < 
obj2
->
num_h™dÀs
; j++) {

967 i‡(
obj2
->
h™dÀs
[
j
]->
c⁄√˘ed_to
 =
˝
Ë
found
 = 
TRUE
;

970 
	`dü_as£π_åue
(
found
 =
TRUE
,

972 
msg
, 
i
, 
h
, 
obj
, 
˝
, cp->
obje˘
);

974 } 
FALSE
);

978 
	`dü_as£π_åue
(
obj
->
num_c⁄√˘i⁄s
 >= 0,

980 
msg
, 
obj
, obj->
num_c⁄√˘i⁄s
);

981 i‡(
obj
->
num_c⁄√˘i⁄s
 != 0) {

982 
	`dü_as£π_åue
(
obj
->
c⁄√˘i⁄s
 !
NULL
,

984 
msg
, 
obj
);

986 
i
 = 0; i < 
obj
->
num_c⁄√˘i⁄s
; i++) {

987 
GLi°
 *
c⁄√˘ed
;

988 
C⁄√˘i⁄Poöt
 *
˝
 = 
obj
->
c⁄√˘i⁄s
[
i
];

989 
j
;

990 
	`dü_as£π_åue
(
˝
 !
NULL
, "%s: Obje˘ %∞ha†nuŒ CPáà%d\n", 
msg
, 
obj
, 
i
);

991 i‡(
˝
 !
NULL
) {

992 
	`dü_as£π_åue
(
˝
->
obje˘
 =
obj
,

994 
msg
, 
obj
, 
i
, 
˝
, cp->
obje˘
);

995 
	`dü_as£π_åue
((
˝
->
dúe˘i⁄s
 & (~
DIR_ALL
)) == 0,

997 
msg
, 
obj
, 
i
, 
˝
, cp->
dúe˘i⁄s
);

998 
	`dü_as£π_åue
((
˝
->
Êags
 & 
CP_FLAGS_MAIN
) == cp->flags,

1000 
msg
, 
obj
, 
i
, 
˝
, cp->
Êags
);

1001 
	`dü_as£π_åue
(
˝
->
«me
 =
NULL


1002 || 
	`g_utf8_vÆid©e
(
˝
->
«me
, -1, 
NULL
),

1004 
msg
, 
obj
, 
i
, 
˝
, cp->
«me
);

1005 
j
 = 0;

1006 
c⁄√˘ed
 = 
˝
->c⁄√˘ed; c⁄√˘ed !
NULL
;

1007 
c⁄√˘ed
 = 
	`g_li°_√xt
(connected)) {

1008 
DüObje˘
 *
obj2
;

1009 
obj2
 = 
c⁄√˘ed
->
d©a
;

1010 
	`dü_as£π_åue
(
obj2
 !
NULL
, "%s: Object %p CP %d (%p) has NULL objectát index %d\n",

1011 
msg
, 
obj
, 
i
, 
˝
, 
j
);

1012 i‡(
obj2
 !
NULL
) {

1013 
k
;

1014 
gboﬁón
 
found_h™dÀ
 = 
FALSE
;

1015 
	`dü_as£π_åue
(
obj2
->
ty≥
->
«me
 !
NULL
 &&

1016 
	`g_utf8_vÆid©e
(
obj2
->
ty≥
->
«me
, -1, 
NULL
),

1018 
msg
, 
obj
, 
i
, 
˝
, 
obj2
, obj2->
ty≥
->
«me
, 
j
);

1020 
k
 = 0; k < 
obj2
->
num_h™dÀs
; k++) {

1021 i‡(
obj2
->
h™dÀs
[
k
] !
NULL
 &&

1022 
obj2
->
h™dÀs
[
k
]->
c⁄√˘ed_to
 =
˝
) {

1023 
found_h™dÀ
 = 
TRUE
;

1026 
	`dü_as£π_åue
(
found_h™dÀ
,

1028 
msg
, 
obj
, 
i
, 
˝
, 
obj2
, obj2->
ty≥
->
«me
, 
j
);

1030 
j
++;

1036  
TRUE
;

1037 
	}
}

1040 
	$dü_obje˘_£t_mëa
 (
DüObje˘
 *
obj
, c⁄° 
gch¨
 *
key
, c⁄° gch¨ *
vÆue
)

1042 
	`g_ªtu∫_if_Áû
 (
obj
 !
NULL
 && 
key
 != NULL);

1043 i‡(!
obj
->
mëa
)

1044 
obj
->
mëa
 = 
	`g_hash_èbÀ_√w_fuŒ
 (
g_°r_hash
, 
g_°r_equÆ
, 
g_‰ì
, g_free);

1045 i‡(
vÆue
)

1046 
	`g_hash_èbÀ_ö£π
 (
obj
->
mëa
, 
	`g_°rdup
 (
key
), g_°rdu∞(
vÆue
));

1048 
	`g_hash_èbÀ_ªmove
 (
obj
->
mëa
, 
key
);

1049 
	}
}

1051 
gch¨
 *

1052 
	$dü_obje˘_gë_mëa
 (
DüObje˘
 *
obj
, c⁄° 
gch¨
 *
key
)

1054 
gch¨
 *
vÆ
;

1055 i‡(!
obj
->
mëa
)

1056  
NULL
;

1057 
vÆ
 = 
	`g_hash_èbÀ_lookup
 (
obj
->
mëa
, 
key
);

1058  
	`g_°rdup
 (
vÆ
);

1059 
	}
}

	@O:\tool\dvs50\lib\object.h

22 #i‚de‡
OBJECT_H


23 
	#OBJECT_H


	)

25 
	~"düty≥s.h
"

26 
	~<gtk/gtk.h
>

28 
	~"geomëry.h
"

29 
	~"c⁄√˘i⁄poöt.h
"

30 
	~"h™dÀ.h
"

31 
	~"dümíu.h
"

32 
	~"objch™ge.h
"

33 
	~"dü_xml.h
"

34 
	~"ãxt.h
"

35 
GHashTabÀ
 *
	gglobÆ_TabÀ
;

36 
	gG_BEGIN_DECLS


43 
	#DIA_OBJECT_CAN_PARENT
 1

	)

47 
	#DIA_OBJECT_GRABS_CHILD_INPUT
 2

	)

50 
	#DIA_OBJECT_EXPAND_WITH_CHILDREN
 4

	)

55 
	mMODIFIER_NONE
,

56 
	mMODIFIER_LEFT_SHIFT
,

57 
	mMODIFIER_RIGHT_SHIFT
,

58 
	mMODIFIER_SHIFT
,

59 
	mMODIFIER_LEFT_ALT
 = 4,

60 
	mMODIFIER_RIGHT_ALT
 = 8,

61 
	mMODIFIER_ALT
 = 12,

62 
	mMODIFIER_LEFT_CONTROL
 = 16,

63 
	mMODIFIER_RIGHT_CONTROL
 = 32,

64 
	mMODIFIER_CONTROL
 = 48

65 } 
	tModifõrKeys
;

91 
	gDüObje˘
* (*
	tCª©eFunc
Ë(
	tPoöt
 *
	t°¨çoöt
,

92 *
	tu£r_d©a
,

93 
	tH™dÀ
 **
	th™dÀ1
,

94 
	tH™dÀ
 **
	th™dÀ2
);

109 
	gDüObje˘
* (*
	tLﬂdFunc
Ë(
	tObje˘Node
 
	tobj_node
, 
	tvîsi⁄
,

110 c⁄° *
	tfûíame
);

120 (*
	tSaveFunc
Ë(
	tDüObje˘
* 
	tobj
, 
	tObje˘Node
 
	tobj_node
,

121 c⁄° *
	tfûíame
);

131 
GtkWidgë
 *(*
	tGëDeÁu…sFunc
) ();

137 *(*
	tAµlyDeÁu…sFunc
) ();

149 (*
	tDe°royFunc
Ë(
	tDüObje˘
* 
	tobj
);

159 (*
	tDøwFunc
Ë(
	tDüObje˘
* 
	tobj
, 
	tDüRídîî
* 
	tddi•
);

170 
	$ªÆ
 (*
	tDi°™˚Func
Ë(
	tDüObje˘
* 
	tobj
, 
	tPoöt
* 
	tpoöt
);

185 (*
	tSñe˘Func
Ë(
	tDüObje˘
* 
	tobj
,

186 
	tPoöt
* 
	t˛icked_poöt
,

187 
	tDüRídîî
* 
	töãø˘ive_ªndîî
);

197 
DüObje˘
* (*
	tC›yFunc
Ë(
	tDüObje˘
* 
	tobj
);

210 
Obje˘Ch™ge
* (*
	tMoveFunc
Ë(
	tDüObje˘
* 
	tobj
, 
	tPoöt
 * 
	tpos
);

234 
Obje˘Ch™ge
* (*
	tMoveH™dÀFunc
Ë(
	tDüObje˘
* 
	tobj
,

235 
	tH™dÀ
* 
	th™dÀ
,

236 
	tPoöt
* 
	tpos
,

237 
	tC⁄√˘i⁄Poöt
* 
	t˝
,

238 
	tH™dÀMoveRós⁄
 
	tªas⁄
,

239 
	tModifõrKeys
 
	tmodifõrs
);

260 
GtkWidgë
 *(*
	tGëPr›îtõsFunc
Ë(
	tDüObje˘
* 
	tobj
, 
	tgboﬁón
 
	tis_deÁu…
);

271 
Obje˘Ch™ge
 *(*
	tAµlyPr›îtõsDülogFunc
Ë(
	tDüObje˘
* 
	tobj
, 
	tGtkWidgë
 *
	twidgë
);

282 
Obje˘Ch™ge
 *(*
	tAµlyPr›îtõsLi°Func
Ë(
	tDüObje˘
* 
	tobj
, 
	tGPåAºay
* 
	t¥›s
);

292 c⁄° 
	tPr›Des¸ùti⁄
 *(* 
	tDes¸ibePr›sFunc
Ë(
	tDüObje˘
 *
	tobj
);

305 (* 
	tGëPr›sFunc
Ë(
	tDüObje˘
 *
	tobj
, 
	tGPåAºay
 *
	t¥›s
);

316 (* 
	tSëPr›sFunc
Ë(
	tDüObje˘
 *
	tobj
, 
	tGPåAºay
 *
	t¥›s
);

326 
DüMíu
 *(*
	tObje˘MíuFunc
Ë(
	tDüObje˘
* 
	tobj
, 
	tPoöt
 *
	tposôi⁄
);

342 
	$gboﬁón
 (*
	tTextEdôFunc
Ë(
	tDüObje˘
 *
	tobj
, 
	tText
 *
	tãxt
, 
	tTextEdôSèã
 
	t°©e
, 
	tgch¨
 *
	tãxtch™ge
);

349 
DIAVAR
 
	`obje˘_öô
(
DüObje˘
 *
obj
, 
num_h™dÀs
, 
num_c⁄√˘i⁄s
);

350 
DIAVAR
 
	`obje˘_de°roy
(
DüObje˘
 *
obj
);

352 
DIAVAR
 
	`obje˘_c›y
(
DüObje˘
 *
‰om
, DüObje˘ *
to
);

354 
DIAVAR
 
	`obje˘_ßve
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
);

355 
DIAVAR
 
	`obje˘_lﬂd
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
);

357 
DIAVAR
 
GLi°
 *
	`obje˘_c›y_li°
(GLi° *
li°
);

358 
Obje˘Ch™ge
* 
	`obje˘_li°_move_dñè_r
(
GLi°
 *
obje˘s
, 
Poöt
 *
dñè
, 
gboﬁón
 
af„˘ed
);

359 
DIAVAR
 
Obje˘Ch™ge
* 
	`obje˘_li°_move_dñè
(
GLi°
 *
obje˘s
, 
Poöt
 *
dñè
);

362 
DIAVAR
 
Obje˘Ch™ge
* 
	`obje˘_li°_rŸ©e
(
GLi°
 *
obje˘s
, 
Poöt
 *
˚¡î
, 
ªÆ
 
™gÀ
);

365 
Obje˘Ch™ge
* 
	`obje˘_li°_sˇÀ
(
GLi°
 *
obje˘s
, 
Poöt
 *
˚¡î
, 
ªÆ
 
Á˘‹
);

366 
DIAVAR
 
	`de°roy_obje˘_li°
(
GLi°
 *
li°
);

367 
DIAVAR
 
	`obje˘_add_h™dÀ
(
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
);

368 
	`obje˘_add_h™dÀ_©
(
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
, 
pos
);

369 
DIAVAR
 
	`obje˘_ªmove_h™dÀ
(
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
);

370 
DIAVAR
 
	`obje˘_add_c⁄√˘i⁄poöt
(
DüObje˘
 *
obj
, 
C⁄√˘i⁄Poöt
 *
c⁄poöt
);

371 
DIAVAR
 
	`obje˘_ªmove_c⁄√˘i⁄poöt
(
DüObje˘
 *
obj
,

372 
C⁄√˘i⁄Poöt
 *
c⁄poöt
);

373 
	`obje˘_add_c⁄√˘i⁄poöt_©
(
DüObje˘
 *
obj
,

374 
C⁄√˘i⁄Poöt
 *
c⁄poöt
,

375 
pos
);

376 
DIAVAR
 
	`obje˘_c⁄√˘
(
DüObje˘
 *
obj
, 
H™dÀ
 *
h™dÀ
,

377 
C⁄√˘i⁄Poöt
 *
c⁄poöt
);

378 
DIAVAR
 
	`obje˘_unc⁄√˘
(
DüObje˘
 *
c⁄√˘ed_obj
, 
H™dÀ
 *
h™dÀ
);

379 
DIAVAR
 
	`obje˘_ªmove_c⁄√˘i⁄s_to
(
C⁄√˘i⁄Poöt
 *
c⁄poöt
);

380 
	`obje˘_unc⁄√˘_Æl
(
DüObje˘
 *
c⁄√˘ed_obj
);

381 
	`obje˘_ªgi°ry_öô
();

382 
DIAVAR
 
	`obje˘_ªgi°î_ty≥
(
DüObje˘Ty≥
 *
ty≥
);

383 
DIAVAR
 
	`obje˘_ªgi°ry_f‹óch
(
GHFunc
 
func
, 
gpoöãr
 
u£r_d©a
);

384 
DüObje˘Ty≥
 *
	`obje˘_gë_ty≥
(*
«me
);

385 
DIAVAR
 
gch¨
 *
	`obje˘_gë_di•œy«me
 (
DüObje˘
* 
obj
);

386 
DIAVAR
 
gboﬁón
 
	`obje˘_Êags_£t
(
DüObje˘
* 
obj
, 
göt
 
Êags
);

391 
DIAVAR
 
DüObje˘
 *
	`obje˘_lﬂd_usög_¥›îtõs
(c⁄° 
DüObje˘Ty≥
 *
ty≥
,

392 
Obje˘Node
 
obj_node
, 
vîsi⁄
,

393 c⁄° *
fûíame
);

394 
DIAVAR
 
	`obje˘_ßve_usög_¥›îtõs
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
,

395 
vîsi⁄
, c⁄° *
fûíame
);

396 
DIAVAR
 
DüObje˘
 *
	`obje˘_c›y_usög_¥›îtõs
(DüObje˘ *
obj
);

409 
	s_Afföe
 {

410 
ªÆ
 
rŸ©i⁄
;

411 
ªÆ
 
sˇÀ
;

412 
ªÆ
 
å™¶©i⁄
;

413 } 
	tAfföe
;

422 
	s_Obje˘Ops
 {

423 
De°royFunc
 
de°roy
;

424 
DøwFunc
 
døw
;

425 
Di°™˚Func
 
di°™˚_‰om
;

426 
Sñe˘Func
 
£À˘f
;

427 
C›yFunc
 
c›y
;

428 
MoveFunc
 
move
;

429 
MoveH™dÀFunc
 
move_h™dÀ
;

430 
GëPr›îtõsFunc
 
gë_¥›îtõs
;

431 
AµlyPr›îtõsDülogFunc
 
≠∂y_¥›îtõs_‰om_dülog
;

432 
Obje˘MíuFunc
 
gë_obje˘_míu
;

434 
Des¸ibePr›sFunc
 
des¸ibe_¥›s
;

435 
GëPr›sFunc
 
gë_¥›s
;

436 
SëPr›sFunc
 
£t_¥›s
;

438 
TextEdôFunc
 
edô_ãxt
;

440 
AµlyPr›îtõsLi°Func
 
≠∂y_¥›îtõs_li°
;

448 (*(
unu£d
[4]))(
DüObje˘
 *
obj
,...);

465 
	s_DüObje˘
 {

466 
DüObje˘Ty≥
 *
ty≥
;

467 
Poöt
 
posôi⁄
;

475 
Re˘™gÀ
 
boundög_box
;

476 
Afföe
 
afföe
;

478 
num_h™dÀs
;

479 
H™dÀ
 **
h™dÀs
;

481 
num_c⁄√˘i⁄s
;

482 
C⁄√˘i⁄Poöt
 **
c⁄√˘i⁄s
;

484 
Obje˘Ops
 *
›s
;

486 
Layî
 *
∑ª¡_œyî
;

490 
DüObje˘
 *
∑ª¡
;

491 
GLi°
 *
chûdªn
;

492 
göt
 
Êags
;

494 
Cﬁ‹
 *
highlight_cﬁ‹
;

507 
Re˘™gÀ
 
í˛osög_box
;

509 
GHashTabÀ
 *
mëa
;

516 
	s_Obje˘Ty≥Ops
 {

517 
Cª©eFunc
 
¸óã
;

518 
LﬂdFunc
 
lﬂd
;

519 
SaveFunc
 
ßve
;

520 
GëDeÁu…sFunc
 
gë_deÁu…s
;

521 
AµlyDeÁu…sFunc
 
≠∂y_deÁu…s
;

528 (*(
unu£d
[10]))(
DüObje˘
 *
obj
,...);

537 
	s_DüObje˘Ty≥
 {

539 *
«me
;

540 
vîsi⁄
;

542 **
pixm≠
;

546 
Obje˘Ty≥Ops
 *
›s
;

548 *
pixm≠_fûe
;

549 *
deÁu…_u£r_d©a
;

554 
	#OBJECT_COMMON_PROPERTIES
 \

555 { "obj_pos", 
PROP_TYPE_POINT
, 
PROP_FLAG_OPTIONAL
, \

556 "Obje˘Öosôi⁄", "Whîêthêobje˘ i†loˇãd"
	}
}, \

557 { "obj_bb", 
PROP_TYPE_RECT
, 
PROP_FLAG_OPTIONAL
, \

559 { "mëa", 
PROP_TYPE_DICT
, 
PROP_FLAG_OPTIONAL
, \

560 "Obje˘ më®öfo", "Somêkey/vÆuê∑ús"}

	)

562 
	#OBJECT_COMMON_PROPERTIES_OFFSETS
 \

563 { "obj_pos", 
PROP_TYPE_POINT
, 
	`off£tof
(
DüObje˘
, 
posôi⁄
) }, \

564 { "obj_bb", 
PROP_TYPE_RECT
, 
	`off£tof
(
DüObje˘
, 
boundög_box
) }, \

565 { "mëa", 
PROP_TYPE_DICT
, 
	`off£tof
(
DüObje˘
, 
mëa
Ë}

	)

568 
DIAVAR
 
gboﬁón
 
dü_obje˘_deÁu…s_lﬂd
 (c⁄° 
gch¨
 *
fûíame
,

569 
gboﬁón
 
¸óã_œzy
);

570 
DIAVAR
 
DüObje˘
 *
dü_obje˘_deÁu…_gë
 (c⁄° 
DüObje˘Ty≥
 *
ty≥
, 
gpoöãr
 
u£r_d©a
);

571 
DIAVAR
 
DüObje˘
 *
dü_obje˘_deÁu…_¸óã
 (c⁄° 
DüObje˘Ty≥
 *
ty≥
,

572 
Poöt
 *
°¨çoöt
,

573 *
u£r_d©a
,

574 
H™dÀ
 **
h™dÀ1
,

575 
H™dÀ
 **
h™dÀ2
);

576 
DIAVAR
 
gboﬁón
 
dü_obje˘_deÁu…s_ßve
 (c⁄° 
gch¨
 *
fûíame
);

577 
DIAVAR
 
Layî
 *
dü_obje˘_gë_∑ª¡_œyî
(
DüObje˘
 *
obj
);

578 
DIAVAR
 
gboﬁón
 
dü_obje˘_is_£À˘ed
 (c⁄° 
DüObje˘
 *
obj
);

579 
DIAVAR
 c⁄° 
Re˘™gÀ
 *
dü_obje˘_gë_boundög_box
(c⁄° 
DüObje˘
 *
obj
);

580 
DIAVAR
 c⁄° 
Re˘™gÀ
 *
dü_obje˘_gë_í˛osög_box
(c⁄° 
DüObje˘
 *
obj
);

581 
DüObje˘
 *
dü_obje˘_gë_∑ª¡_wôh_Êags
(DüObje˘ *
obj
, 
guöt
 
Êags
);

582 
DIAVAR
 
gboﬁón
 
dü_obje˘_is_£À˘abÀ
(
DüObje˘
 *
obj
);

584 
DIAVAR
 
gboﬁón
 
dü_obje˘_ßnôy_check
(c⁄° 
DüObje˘
 *
obj
, c⁄° 
gch¨
 *
msg
);

587 (*
	tDüObje˘Func
Ë(c⁄° 
	tDüObje˘
 *
	tobj
);

590 
DIAVAR
 
	`dü_obje˘_£t_mëa
 (
DüObje˘
 *
obj
, c⁄° 
gch¨
 *
key
, c⁄° gch¨ *
vÆue
);

591 
DIAVAR
 
gch¨
 *
	`dü_obje˘_gë_mëa
 (
DüObje˘
 *
obj
, c⁄° gch¨ *
key
);

593 
G_END_DECLS


	@O:\tool\dvs50\lib\object_defaults.c

24 
	~<c⁄fig.h
>

26 
	~<°dlib.h
>

27 
	~<°rög.h
>

29 
	~<glib.h
>

31 
	~"öé.h
"

33 
	~<libxml/åì.h
>

34 
	~"dü_xml_libxml.h
"

35 
	~"dü_xml.h
"

36 
	~"obje˘.h
"

37 
	~"mesßge.h
"

38 
	~"dü_dús.h
"

39 
	~"¥›öã∫Æs.h
"

41 
GHashTabÀ
 *
	gdeÁu…s_hash
 = 
NULL
;

42 
gboﬁón
 
	gobje˘_deÁu…_¸óã_œzy
 = 
FALSE
;

45 
	$_obj_¸óã
 (
gpoöãr
 
key
,

46 
gpoöãr
 
vÆue
,

47 
gpoöãr
 
u£r_d©a
)

49 
gch¨
 *
«me
 = (gch¨ *)
key
;

50 
DüObje˘Ty≥
 *
ty≥
 = (DüObje˘Ty≥ *)
vÆue
;

51 
GHashTabÀ
 *
ht
 = (GHashTabÀ *Ë
u£r_d©a
;

52 
DüObje˘
 *
obj
;

53 
Poöt
 
°¨çoöt
 = {0.0,0.0};

54 
H™dÀ
 *
h™dÀ1
,*
h™dÀ2
;

56 
	`g_as£π
 (
	`g_hash_èbÀ_lookup
 (
ht
, 
«me
Ë=
NULL
);

59 i‡(!
ty≥
->
›s
)

63 
obj
 = 
ty≥
->
›s
->
	`¸óã
(&
°¨çoöt
,Åy≥->
deÁu…_u£r_d©a
, &
h™dÀ1
,&
h™dÀ2
);

64 i‡(!
obj
)

65 
	`g_w¨nög
 ("FaûedÅÿ¸óã deÁu… obje˘ f‹ '%s'", 
«me
);

66 i‡(0 !
	`°rcmp
 (
obj
->
ty≥
->
«me
,Çame))

67 
	`obje˘_de°roy
 (
obj
);

69 
	`g_hash_èbÀ_ö£π
(
ht
, 
obj
->
ty≥
->
«me
, obj);

70 
	}
}

73 
	$_obj_de°roy
 (
gpoöãr
 
vÆ
)

75 
DüObje˘
 *
obj
 = (DüObje˘ *)
vÆ
;

77 
obj
->
›s
->
	`de°roy
 (obj);

78 
	}
}

88 
gboﬁón


89 
	$dü_obje˘_deÁu…s_lﬂd
 (c⁄° 
gch¨
 *
fûíame
, 
gboﬁón
 
¸óã_œzy
)

91 
xmlDocPå
 
doc
;

92 
xmlNsPå
 
«me_•a˚
;

93 
Obje˘Node
 
obj_node
, 
œyî_node
;

95 
obje˘_deÁu…_¸óã_œzy
 = 
¸óã_œzy
;

97 i‡(!
deÁu…s_hash
)

99 
deÁu…s_hash
 = 
	`g_hash_èbÀ_√w_fuŒ
(
g_°r_hash
, 
g_°r_equÆ
,

100 
NULL
, 
_obj_de°roy
);

102 i‡(!
¸óã_œzy
)

103 
	`obje˘_ªgi°ry_f‹óch
 (
_obj_¸óã
, 
deÁu…s_hash
);

108 i‡(!
fûíame
)

110 
gch¨
 *
deÁu…_fûíame
 = 
	`dü_c⁄fig_fûíame
("defaults.dia");

112 i‡(
	`g_fûe_ã°
(
deÁu…_fûíame
, 
G_FILE_TEST_EXISTS
))

113 
doc
 = 
	`xmlDüP¨£Fûe
(
deÁu…_fûíame
);

115 
doc
 = 
NULL
;

116 
	`g_‰ì
 (
deÁu…_fûíame
);

119 
doc
 = 
	`xmlDüP¨£Fûe
(
fûíame
);

121 i‡(!
doc
)

122  
FALSE
;

124 
«me_•a˚
 = 
	`xmlSórchNs
(
doc
, doc->
xmlRoŸNode
, (c⁄° 
xmlCh¨
 *)"dia");

125 i‡(
	`xmlSåcmp
 (
doc
->
xmlRoŸNode
->
«me
, (c⁄° 
xmlCh¨
 *)"diagram")

126 || (
«me_•a˚
 =
NULL
))

128 
	`mesßge_îr‹
(
	`_
("ErrorÜoading defaults '%s'.\n"

130 
	`dü_mesßge_fûíame
(
fûíame
));

131 
	`xmlFªeDoc
 (
doc
);

132  
FALSE
;

135 
œyî_node
 = 
doc
->
xmlRoŸNode
->
xmlChûdªnNode
;

136 
œyî_node
)

138 i‡–!
	`xmlIsBœnkNode
(
œyî_node
)

139 && 0 =
	`xmlSåcmp
(
œyî_node
->
«me
, (c⁄° 
xmlCh¨
 *)"layer"))

141 
obj_node
 = 
œyî_node
->
xmlChûdªnNode
;

142 
obj_node
)

144 i‡(!
	`xmlIsBœnkNode
(
obj_node
)

145 && 0 =
	`xmlSåcmp
(
obj_node
->
«me
, (c⁄° 
xmlCh¨
 *)"object"))

147 *
ty≥°r
 = (*Ë
	`xmlGëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"type");

148 *
vîsi⁄
 = (*Ë
	`xmlGëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"version");

149 i‡(
ty≥°r
)

151 
DüObje˘
 *
obj
 = 
	`g_hash_èbÀ_lookup
 (
deÁu…s_hash
, 
ty≥°r
);

152 i‡(!
obj
)

154 i‡(!
¸óã_œzy
)

155 
	`g_w¨nög
 ("Unknown object '%s' whileÑeading '%s'",

156 
ty≥°r
, 
fûíame
);

159 
DüObje˘Ty≥
 *
ty≥
 = 
	`obje˘_gë_ty≥
 (
ty≥°r
);

160 i‡(
ty≥
)

161 
obj
 = 
ty≥
->
›s
->
	`lﬂd
 (

162 
obj_node
,

163 
vîsi⁄
 ? 
	`©oi
(version) : 0,

164 
fûíame
);

165 i‡(
obj
)

166 
	`g_hash_èbÀ_ö£π
 (
deÁu…s_hash
,

167 
obj
->
ty≥
->
«me
, obj);

173 
	`obje˘_lﬂd_¥›s
(
obj
, 
obj_node
);

175 
DüObje˘
 *
def_obj
;

176 
def_obj
 = 
obj
->
ty≥
->
›s
->
	`lﬂd
 (

177 
obj_node
,

178 
vîsi⁄
 ? 
	`©oi
(version) : 0,

179 
fûíame
);

180 i‡(
def_obj
->
›s
->
£t_¥›s
)

182 
	`obje˘_c›y_¥›s
 (
obj
, 
def_obj
, 
TRUE
);

183 
def_obj
->
›s
->
	`de°roy
 (def_obj);

188 
	`g_hash_èbÀ_ª∂a˚
 (
deÁu…s_hash
,

189 
def_obj
->
ty≥
->
«me
, def_obj);

193 i‡(
vîsi⁄
)

194 
	`xmlFªe
 (
vîsi⁄
);

195 
	`xmlFªe
 (
ty≥°r
);

198 
obj_node
 = obj_node->
√xt
;

201 
œyî_node
 =Üayî_node->
√xt
;

204 
	`xmlFªeDoc
(
doc
);

205  
TRUE
;

206 
	}
}

214 
DüObje˘
 *

215 
	$dü_obje˘_deÁu…_gë
 (c⁄° 
DüObje˘Ty≥
 *
ty≥
, 
gpoöãr
 
u£r_d©a
)

217 
DüObje˘
 *
obj
;

219 
obj
 = 
	`g_hash_èbÀ_lookup
 (
deÁu…s_hash
, 
ty≥
->
«me
);

220 i‡(!
obj
 && 
obje˘_deÁu…_¸óã_œzy
)

222 
Poöt
 
°¨çoöt
 = {0.0,0.0};

223 
H™dÀ
 *
h™dÀ1
,*
h™dÀ2
;

226 i‡(!
ty≥
->
›s
)

227  
NULL
;

230 
obj
 = 
ty≥
->
›s
->
	`¸óã
(&
°¨çoöt
,

231 
ty≥
->
deÁu…_u£r_d©a
,

232 &
h™dÀ1
,&
h™dÀ2
);

233 i‡(
obj
)

234 
	`g_hash_èbÀ_ö£π
 (
deÁu…s_hash
, 
obj
->
ty≥
->
«me
, obj);

237  
obj
;

238 
	}
}

240 
gboﬁón


241 
	$pdçp_°™d¨d_‹_deÁu…s
 (c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

243  ( (
pdesc
->
Êags
 & 
PROP_FLAG_NO_DEFAULTS
) == 0

244 && (
pdesc
->
Êags
 & 
PROP_FLAG_STANDARD
) == 0);

245 
	}
}

259 
DüObje˘
 *

260 
	$dü_obje˘_deÁu…_¸óã
 (c⁄° 
DüObje˘Ty≥
 *
ty≥
,

261 
Poöt
 *
°¨çoöt
,

262 *
u£r_d©a
,

263 
H™dÀ
 **
h™dÀ1
,

264 
H™dÀ
 **
h™dÀ2
)

266 c⁄° 
DüObje˘
 *
def_obj
;

267 
DüObje˘
 *
obj
;

269 
	`g_ªtu∫_vÆ_if_Áû
 (
ty≥
 !
NULL
, NULL);

272 
def_obj
 = 
	`g_hash_èbÀ_lookup
 (
deÁu…s_hash
, 
ty≥
->
«me
);

273 i‡(
def_obj
 && def_obj->
›s
->
des¸ibe_¥›s
)

276 
obj
 = 
ty≥
->
›s
->
	`¸óã
 (
°¨çoöt
, 
u£r_d©a
, 
h™dÀ1
, 
h™dÀ2
);

277 i‡(
obj
)

279 
GPåAºay
 *
¥›s
 = 
	`¥›_li°_‰om_descs
 (

280 
	`obje˘_gë_¥›_des¸ùti⁄s
(
def_obj
), 
pdçp_°™d¨d_‹_deÁu…s
);

281 
def_obj
->
›s
->
	`gë_¥›s
(def_obj, 
¥›s
);

282 
obj
->
›s
->
	`£t_¥›s
(obj, 
¥›s
);

283 
obj
->
›s
->
	`move
 (obj, 
°¨çoöt
);

284 
	`¥›_li°_‰ì
(
¥›s
);

289 
obj
 = 
ty≥
->
›s
->
	`¸óã
 (
°¨çoöt
, 
u£r_d©a
, 
h™dÀ1
, 
h™dÀ2
);

292  
obj
;

293 
	}
}

295 
_MyLayîInfo
 
	tMyLayîInfo
;

296 
	s_MyLayîInfo


298 
Poöt
 
	mpos
;

299 
xmlNodePå
 
	mnode
;

302 
_MyRoŸInfo
 
	tMyRoŸInfo
;

303 
	s_MyRoŸInfo


305 
xmlNodePå
 
	mnode
;

306 
gch¨
 *
	mfûíame
;

307 
GHashTabÀ
 *
	mœyî_hash
;

308 
xmlNs
 *
	m«me_•a˚
;

309 
göt
 
	mobj_ƒ
;

313 
	$_obj_°‹e
 (
gpoöãr
 
key
,

314 
gpoöãr
 
vÆue
,

315 
gpoöãr
 
u£r_d©a
)

317 
gch¨
 *
«me
 = (gch¨ *)
key
;

318 
DüObje˘
 *
obj
 = (DüObje˘ *)
vÆue
;

319 
MyRoŸInfo
 *
ri
 = (MyRoŸInfÿ*)
u£r_d©a
;

320 
Obje˘Node
 
obj_node
;

321 
gch¨
 *
œyî_«me
;

322 
gch¨
 
buf„r
[31];

323 
gch¨
 *
p
;

324 
MyLayîInfo
 *
li
;

328 
	`g_as£π
 (0 =
	`°rcmp
 (
obj
->
ty≥
->
«me
,Çame));

330 
p
 = 
	`°r°r
 (
«me
, " - ");

331 i‡(
p
) {

332 i‡(
p
 > 
«me
)

333 
œyî_«me
 = 
	`g_°∫dup
 (
«me
, 
p
 -Çame);

335 
œyî_«me
 = 
	`g_°rdup
("NULL");

338 
œyî_«me
 = 
	`g_°rdup
 ("default");

340 
li
 = 
	`g_hash_èbÀ_lookup
 (
ri
->
œyî_hash
, 
œyî_«me
);

341 i‡(!
li
)

343 
li
 = 
	`g_√w
 (
MyLayîInfo
, 1);

344 
li
->
node
 = 
	`xmlNewChûd
(
ri
->node,Ñi->
«me_•a˚
, (c⁄° 
xmlCh¨
 *)"œyî", 
NULL
);

345 
	`xmlSëPr›
(
li
->
node
, (c⁄° 
xmlCh¨
 *)"«me", (xmlCh¨ *)
œyî_«me
);

346 
	`xmlSëPr›
(
li
->
node
, (c⁄° 
xmlCh¨
 *)"visible", (const xmlChar *)"false");

347 
li
->
pos
.
x
 =Üi->pos.
y
 = 0.0;

348 
	`g_hash_èbÀ_ö£π
 (
ri
->
œyî_hash
, 
œyî_«me
, 
li
);

351 
	`g_‰ì
 (
œyî_«me
);

353 
obj_node
 = 
	`xmlNewChûd
(
li
->
node
, 
NULL
, (c⁄° 
xmlCh¨
 *)"object", NULL);

354 
	`xmlSëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"ty≥", (xmlCh¨ *Ë
obj
->
ty≥
->
«me
);

356 
	`g_¢¥ötf
(
buf„r
, 30, "%d", 
obj
->
ty≥
->
vîsi⁄
);

357 
	`xmlSëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"vîsi⁄", (xmlCh¨ *)
buf„r
);

359 
	`g_¢¥ötf
(
buf„r
, 30, "O%d", 
ri
->
obj_ƒ
++);

360 
	`xmlSëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"id", (xmlCh¨ *)
buf„r
);

363 i‡–
	`GPOINTER_TO_INT
(
obj
->
ty≥
->
deÁu…_u£r_d©a
) > 0

364 && 
	`GPOINTER_TO_INT
(
obj
->
ty≥
->
deÁu…_u£r_d©a
) < 0xFF) {

365 
	`g_¢¥ötf
(
buf„r
, 30, "%d", 
	`GPOINTER_TO_INT
(
obj
->
ty≥
->
deÁu…_u£r_d©a
));

366 
	`xmlSëPr›
(
obj_node
, (c⁄° 
xmlCh¨
 *)"ötd©a", (xmlCh¨ *)
buf„r
);

369 
obj
->
›s
->
	`move
 (obj,&(
li
->
pos
));

371 
obj
->
ty≥
->
›s
->
	`ßve
 (obj, 
obj_node
, 
ri
->
fûíame
);

374 
li
->
pos
.
y
 +(
obj
->
boundög_box
.
bŸtom
 - obj->boundög_box.
t›
 + 1.0);

375 
	}
}

384 
gboﬁón


385 
	$dü_obje˘_deÁu…s_ßve
 (c⁄° 
gch¨
 *
fûíame
)

387 
MyRoŸInfo
 
ni
;

388 
xmlDocPå
 
doc
;

389 
gboﬁón
 
ªt
;

390 
gch¨
 *
ªÆ_fûíame
;

391 
ﬁd_bœnks_deÁu…
 = 
¥ëty_f‹m©ed_xml
;

396 
¥ëty_f‹m©ed_xml
 = 
TRUE
;

398 i‡(!
fûíame
)

399 
ªÆ_fûíame
 = 
	`dü_c⁄fig_fûíame
("defaults.dia");

401 
ªÆ_fûíame
 = 
	`g_°rdup
 (
fûíame
);

403 
doc
 = 
	`xmlNewDoc
((c⁄° 
xmlCh¨
 *)"1.0");

404 
doc
->
ícodög
 = 
	`xmlSådup
((c⁄° 
xmlCh¨
 *)"UTF-8");

405 
doc
->
xmlRoŸNode
 = 
	`xmlNewDocNode
(doc, 
NULL
, (c⁄° 
xmlCh¨
 *)"diagram", NULL);

407 
ni
.
«me_•a˚
 = 
	`xmlNewNs
(
doc
->
xmlRoŸNode
,

408 (c⁄° 
xmlCh¨
 *)
DIA_XML_NAME_SPACE_BASE
,

409 (c⁄° 
xmlCh¨
 *)"dia");

410 
	`xmlSëNs
(
doc
->
xmlRoŸNode
, 
ni
.
«me_•a˚
);

412 
ni
.
obj_ƒ
 = 0;

413 
ni
.
node
 = 
doc
->
xmlRoŸNode
;

414 
ni
.
fûíame
 = 
ªÆ_fûíame
;

415 
ni
.
œyî_hash
 = 
	`g_hash_èbÀ_√w_fuŒ
 (
g_°r_hash
, 
g_°r_equÆ
,

416 
g_‰ì
, g_free);

418 
	`g_hash_èbÀ_f‹óch
 (
deÁu…s_hash
, 
_obj_°‹e
, &
ni
);

420 
ªt
 = 
	`xmlDüSaveFûe
 (
ªÆ_fûíame
, 
doc
);

421 
	`g_‰ì
 (
ªÆ_fûíame
);

422 
	`xmlFªeDoc
(
doc
);

423 
¥ëty_f‹m©ed_xml
 = 
ﬁd_bœnks_deÁu…
;

425 
	`g_hash_èbÀ_de°roy
 (
ni
.
œyî_hash
);

427  
ªt
;

428 
	}
}

	@O:\tool\dvs50\lib\orth_conn.c

18 
	~<c⁄fig.h
>

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<as£π.h
>

23 
	~<m©h.h
>

24 
	~<°rög.h
>

25 
	~<glib.h
>

27 
	~"‹th_c⁄n.h
"

28 
	~"mesßge.h
"

29 
	~"dümíu.h
"

30 
	~"h™dÀ.h
"

31 
	~"düªndîî.h
"

32 
	~"aut‹ouã.h
"

34 
∂a˚_h™dÀ_by_sw≠pög
(
OπhC⁄n
 *
‹th
,

35 
ödex
, 
H™dÀ
 *
h™dÀ
);

36 
Obje˘Ch™ge
 *
‹thc⁄n_£t_aut‹outög
(
OπhC⁄n
 *
‹th
, 
gboﬁón
 
⁄
);

38 
	ech™ge_ty≥
 {

39 
	mTYPE_ADD_SEGMENT
,

40 
	mTYPE_REMOVE_SEGMENT


43 
Obje˘Ch™ge
 *

44 
mid£gmít_¸óã_ch™ge
(
OπhC⁄n
 *
‹th
, 
ch™ge_ty≥
 
ty≥
,

45 
£gmít
,

46 
Poöt
 *
poöt1
, Poöà*
poöt2
,

47 
H™dÀ
 *
h™dÀ1
, H™dÀ *
h™dÀ2
);

49 
	sMidSegmítCh™ge
 {

50 
Obje˘Ch™ge
 
	mobj_ch™ge
;

59 
ch™ge_ty≥
 
	mty≥
;

60 
	m≠∂õd
;

62 
	m£gmít
;

63 
Poöt
 
	mpoöts
[2];

64 
H™dÀ
 *
	mh™dÀs
[2];

67 
Obje˘Ch™ge
 *

68 
íd£gmít_¸óã_ch™ge
(
OπhC⁄n
 *
‹th
, 
ch™ge_ty≥
 
ty≥
,

69 
£gmít
, 
Poöt
 *
poöt
,

70 
H™dÀ
 *
h™dÀ
);

72 
∂a˚_h™dÀ_by_sw≠pög
(
OπhC⁄n
 *
‹th
, 
ödex
, 
H™dÀ
 *
h™dÀ
);

74 
	sEndSegmítCh™ge
 {

75 
Obje˘Ch™ge
 
	mobj_ch™ge
;

87 
ch™ge_ty≥
 
	mty≥
;

88 
	m≠∂õd
;

90 
	m£gmít
;

91 
Poöt
 
	mpoöt
;

92 
H™dÀ
 *
	mh™dÀ
;

93 
H™dÀ
 *
	mﬁd_íd_h™dÀ
;

94 
C⁄√˘i⁄Poöt
 *
	m˝
;

98 
Obje˘Ch™ge
*

99 
aut‹ouã_¸óã_ch™ge
(
OπhC⁄n
 *
‹th
, 
gboﬁón
 
⁄
);

101 
	sAut‹ouãCh™ge
 {

102 
Obje˘Ch™ge
 
	mobj_ch™ge
;

103 
gboﬁón
 
	m⁄
;

104 
Poöt
 *
	mpoöts
;

107 
	$£t_midpoöt
(
Poöt
 *
poöt
, 
OπhC⁄n
 *
‹th
, 
£gmít
)

109 
i
 = 
£gmít
;

110 
poöt
->
x
 = 0.5*(
‹th
->
poöts
[
i
].x + orth->points[i+1].x);

111 
poöt
->
y
 = 0.5*(
‹th
->
poöts
[
i
].y + orth->points[i+1].y);

112 
	}
}

114 
	$£tup_midpoöt_h™dÀ
(
H™dÀ
 *
h™dÀ
)

116 
h™dÀ
->
id
 = 
HANDLE_MIDPOINT
;

117 
h™dÀ
->
ty≥
 = 
HANDLE_MINOR_CONTROL
;

118 
h™dÀ
->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

119 
h™dÀ
->
c⁄√˘ed_to
 = 
NULL
;

120 
	}
}

122 
	$£tup_ídpoöt_h™dÀ
(
H™dÀ
 *
h™dÀ
, 
H™dÀId
 
id
 )

124 
h™dÀ
->
id
 = id;

125 
h™dÀ
->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

126 
h™dÀ
->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

127 
h™dÀ
->
c⁄√˘ed_to
 = 
NULL
;

128 
	}
}

130 
	$gë_h™dÀ_ƒ
(
OπhC⁄n
 *
‹th
, 
H™dÀ
 *
h™dÀ
)

132 
i
 = 0;

133 
i
=0;i<
‹th
->
numpoöts
-1;i++) {

134 i‡(
‹th
->
h™dÀs
[
i
] =
h™dÀ
)

135  
i
;

138 
	}
}

140 
	$gë_£gmít_ƒ
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
poöt
, 
ªÆ
 
max_di°
)

142 
i
;

143 
£gmít
;

144 
ªÆ
 
di°™˚
, 
tmp_di°
;

146 
£gmít
 = 0;

147 
di°™˚
 = 
	`di°™˚_löe_poöt
(&
‹th
->
poöts
[0], &‹th->poöts[1], 0, 
poöt
);

149 
i
=1;i<
‹th
->
numpoöts
-1;i++) {

150 
tmp_di°
 = 
	`di°™˚_löe_poöt
(&
‹th
->
poöts
[
i
], &‹th->poöts[i+1], 0, 
poöt
);

151 i‡(
tmp_di°
 < 
di°™˚
) {

152 
£gmít
 = 
i
;

153 
di°™˚
 = 
tmp_di°
;

157 i‡(
di°™˚
 < 
max_di°
)

158  
£gmít
;

161 
	}
}

164 
Obje˘Ch™ge
 *

165 
	$‹thc⁄n_move_h™dÀ
(
OπhC⁄n
 *
‹th
, 
H™dÀ
 *
h™dÀ
,

166 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

167 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

169 
n
;

170 
h™dÀ_ƒ
;

171 
DüObje˘
 *
obj
 = (DüObje˘ *)
‹th
;

172 
Obje˘Ch™ge
 *
ch™ge
 = 
NULL
;

174 
h™dÀ
->
id
) {

175 
HANDLE_MOVE_STARTPOINT
:

176 
‹th
->
poöts
[0] = *
to
;

177 i‡(
‹th
->
aut‹outög
 &&

178 
	`aut‹ouã_œyout_‹thc⁄n
(
‹th
, 
˝
,

179 
obj
->
h™dÀs
[1]->
c⁄√˘ed_to
))

181 
‹th
->
‹õ¡©i⁄
[0]) {

182 
HORIZONTAL
:

183 
‹th
->
poöts
[1].
y
 = 
to
->y;

185 
VERTICAL
:

186 
‹th
->
poöts
[1].
x
 = 
to
->x;

190 
HANDLE_MOVE_ENDPOINT
:

191 
n
 = 
‹th
->
numpoöts
 - 1;

192 
‹th
->
poöts
[
n
] = *
to
;

193 i‡(
‹th
->
aut‹outög
 &&

194 
	`aut‹ouã_œyout_‹thc⁄n
(
‹th
, 
obj
->
h™dÀs
[0]->
c⁄√˘ed_to
,

195 
˝
))

197 
‹th
->
‹õ¡©i⁄
[
n
-1]) {

198 
HORIZONTAL
:

199 
‹th
->
poöts
[
n
-1].
y
 = 
to
->y;

201 
VERTICAL
:

202 
‹th
->
poöts
[
n
-1].
x
 = 
to
->x;

206 
HANDLE_MIDPOINT
:

207 
n
 = 
‹th
->
numpoöts
 - 1;

208 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
‹th
, 
h™dÀ
);

209 i‡(
‹th
->
aut‹outög
)

210 
ch™ge
 = 
	`‹thc⁄n_£t_aut‹outög
(
‹th
, 
FALSE
);

211 
‹th
->
‹õ¡©i⁄
[
h™dÀ_ƒ
]) {

212 
HORIZONTAL
:

213 
‹th
->
poöts
[
h™dÀ_ƒ
].
y
 = 
to
->y;

214 
‹th
->
poöts
[
h™dÀ_ƒ
+1].
y
 = 
to
->y;

216 
VERTICAL
:

217 
‹th
->
poöts
[
h™dÀ_ƒ
].
x
 = 
to
->x;

218 
‹th
->
poöts
[
h™dÀ_ƒ
+1].
x
 = 
to
->x;

223 
	`mesßge_îr‹
("InternalÉrror in orthconn_move_handle.\n");

227  
ch™ge
;

228 
	}
}

230 
Obje˘Ch™ge
 *

231 
	$‹thc⁄n_move
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
to
)

233 
Poöt
 
p
;

234 
i
;

236 
p
 = *
to
;

237 
	`poöt_sub
(&
p
, &
‹th
->
poöts
[0]);

239 
‹th
->
poöts
[0] = *
to
;

240 
i
=1;i<
‹th
->
numpoöts
;i++) {

241 
	`poöt_add
(&
‹th
->
poöts
[
i
], &
p
);

243  
NULL
;

244 
	}
}

246 
ªÆ


247 
	$‹thc⁄n_di°™˚_‰om
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

249 
i
;

250 
ªÆ
 
di°
;

252 
di°
 = 
	`di°™˚_löe_poöt
–&
‹th
->
poöts
[0], &orth->points[1],

253 
löe_width
, 
poöt
);

254 
i
=1;i<
‹th
->
numpoöts
-1;i++) {

255 
di°
 = 
	`MIN
(dist,

256 
	`di°™˚_löe_poöt
–&
‹th
->
poöts
[
i
], &orth->points[i+1],

257 
löe_width
, 
poöt
));

259  
di°
;

260 
	}
}

264 
	$adju°_h™dÀ_cou¡_to
(
OπhC⁄n
 *
‹th
, 
guöt
 
cou¡
) {

270 i‡(
‹th
->
numh™dÀs
 =
cou¡
) ;

271 i‡(
‹th
->
numh™dÀs
 < 
cou¡
) {

272 
i
;

273 
‹th
->
h™dÀs
 = 
	`g_ªÆloc
(orth->handles,

274 (
cou¡
)*(
H™dÀ
 *));

275 
‹th
->
h™dÀs
[
cou¡
-1] = oπh->h™dÀs[‹th->
numh™dÀs
-1];

276 
‹th
->
h™dÀs
[‹th->
numh™dÀs
-1] = 
NULL
;

277 
i
=
‹th
->
numh™dÀs
-1; i<
cou¡
-1; i++) {

278 
H™dÀ
 *
h™dÀ
 = 
	`g_√w0
(Handle,1);

279 
	`£tup_midpoöt_h™dÀ
(
h™dÀ
);

280 
	`obje˘_add_h™dÀ
(&
‹th
->
obje˘
,
h™dÀ
);

281 
‹th
->
h™dÀs
[
i
] = 
h™dÀ
;

284 
i
;

285 
i
=
cou¡
-1; i<
‹th
->
numh™dÀs
-1; i++) {

286 
H™dÀ
 *
h™dÀ
 = 
‹th
->
h™dÀs
[
i
];

287 
	`obje˘_ªmove_h™dÀ
(&
‹th
->
obje˘
,
h™dÀ
);

288 
	`g_‰ì
(
h™dÀ
);

289 
‹th
->
h™dÀs
[
i
] = 
NULL
;

291 
‹th
->
h™dÀs
[
cou¡
-1] = oπh->h™dÀs[‹th->
numh™dÀs
-1];

292 
‹th
->
h™dÀs
[‹th->
numh™dÀs
-1] = 
NULL
;

293 
‹th
->
h™dÀs
 = 
	`g_ªÆloc
(orth->handles,

294 (
cou¡
)*(
H™dÀ
 *));

296 
‹th
->
numh™dÀs
 = 
cou¡
;

298 
	}
}

301 
	$‹thc⁄n_upd©e_d©a
(
OπhC⁄n
 *
‹th
)

303 
i
;

304 
DüObje˘
 *
obj
 = (DüObje˘ *)
‹th
;

305 
Poöt
 *
poöts
;

306 
C⁄√˘i⁄Poöt
 *
°¨t_˝
;

307 
C⁄√˘i⁄Poöt
 *
íd_˝
;

309 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

314 
	`adju°_h™dÀ_cou¡_to
(
‹th
, oπh->
numpoöts
-1);

316 
°¨t_˝
 = 
‹th
->
h™dÀs
[0]->
c⁄√˘ed_to
;

317 
íd_˝
 = 
‹th
->
h™dÀs
[‹th->
numpoöts
-2]->
c⁄√˘ed_to
;

319 i‡(!
‹th
->
poöts
) {

320 
	`g_w¨nög
("very sick OrthConn object...");

324 
poöts
 = 
‹th
->points;

325 i‡(!
‹th
->
aut‹outög
 &&

326 (
	`c⁄≈oöt_is_autog≠
(
°¨t_˝
) ||

327 
	`c⁄≈oöt_is_autog≠
(
íd_˝
))) {

328 
Poöt
* 
√w_poöts
 = 
	`g_√w
(Poöt, 
‹th
->
numpoöts
);

329 
i
 = 0; i < 
‹th
->
numpoöts
; i++) {

330 
√w_poöts
[
i
] = 
poöts
[i];

333 i‡(
	`c⁄≈oöt_is_autog≠
(
°¨t_˝
)) {

334 
√w_poöts
[0] = 
	`ˇlcuœã_obje˘_edge
(&
°¨t_˝
->
pos
, &new_points[1],

335 
°¨t_˝
->
obje˘
);

341 i‡(
	`c⁄≈oöt_is_autog≠
(
íd_˝
)) {

342 
√w_poöts
[
‹th
->
numpoöts
-1] =

343 
	`ˇlcuœã_obje˘_edge
(&
íd_˝
->
pos
, &
√w_poöts
[
‹th
->
numpoöts
-2],

344 
íd_˝
->
obje˘
);

350 
	`g_‰ì
(
poöts
);

351 
‹th
->
poöts
 = 
√w_poöts
;

354 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

356 
	`adju°_h™dÀ_cou¡_to
(
‹th
, oπh->
numpoöts
-1);

359 
	`∂a˚_h™dÀ_by_sw≠pög
(
‹th
, 0, oπh->
h™dÀs
[0]);

360 
	`∂a˚_h™dÀ_by_sw≠pög
(
‹th
, 1, oπh->
h™dÀs
[‹th->
numpoöts
-2]);

363 
‹th
->
h™dÀs
[0]->
pos
 = oπh->
poöts
[0];

364 
‹th
->
h™dÀs
[‹th->
numpoöts
-2]->
pos
 = oπh->
poöts
[orth->numpoints-1];

366 
i
=1;i<
‹th
->
numpoöts
-2;i++) {

367 
	`£t_midpoöt
(&
‹th
->
h™dÀs
[
i
]->
pos
, orth, i);

369 
	}
}

372 
	$‹thc⁄n_upd©e_boundögbox
(
OπhC⁄n
 *
‹th
)

374 
	`as£π
(
‹th
 !
NULL
);

375 
	`pﬁylöe_bbox
(&
‹th
->
poöts
[0],

376 
‹th
->
numpoöts
,

377 &
‹th
->
exåa_•acög
, 
FALSE
,

378 &
‹th
->
obje˘
.
boundög_box
);

379 
	}
}

382 
	$‹thc⁄n_sim∂e_døw
(
OπhC⁄n
 *
‹th
, 
DüRídîî
 *
ªndîî
, 
ªÆ
 
width
)

384 
Poöt
 *
poöts
;

386 
	`as£π
(
‹th
 !
NULL
);

387 
	`as£π
(
ªndîî
 !
NULL
);

389 i‡(!
‹th
->
poöts
) {

390 
	`g_w¨nög
("very sick OrthConn object...");

395 
poöts
 = &
‹th
->points[0];

397 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
width
);

398 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

399 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

400 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

402 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁylöe
‘ídîî, 
poöts
,

403 
‹th
->
numpoöts
,

404 &
cﬁ‹_bœck
);

405 
	}
}

409 
	$‹thc⁄n_ˇn_dñëe_£gmít
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
)

411 
£gmít
;

417 i‡(
‹th
->
numpoöts
==3)

420 
£gmít
 = 
	`gë_£gmít_ƒ
(
‹th
, 
˛ickedpoöt
, 1.0);

422 i‡(
£gmít
<0)

425 i‡–(
£gmít
 !0Ë&& (£gmíà!
‹th
->
numpoöts
-2)) {

427 i‡(
‹th
->
numpoöts
==4)

432 
	}
}

435 
	$‹thc⁄n_ˇn_add_£gmít
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
)

437 
£gmít
 = 
	`gë_£gmít_ƒ
(
‹th
, 
˛ickedpoöt
, 1000000.0);

439 i‡(
£gmít
<0)

443 
	}
}

453 
	$‹thc⁄n_öô
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
°¨çoöt
)

455 
DüObje˘
 *
obj
;

457 
obj
 = &
‹th
->
obje˘
;

459 
	`obje˘_öô
(
obj
, 3, 0);

461 
‹th
->
numpoöts
 = 4;

462 
‹th
->
num‹õ¡
 = oπh->
numpoöts
 - 1;

464 
‹th
->
poöts
 = 
	`g_mÆloc0
(4*(
Poöt
));

466 
‹th
->
‹õ¡©i⁄
 = 
	`g_mÆloc0
(3*(
Orõ¡©i⁄
));

468 
‹th
->
numh™dÀs
 = 3;

469 
‹th
->
h™dÀs
 = 
	`g_mÆloc0
(3*(
H™dÀ
 *));

471 
‹th
->
h™dÀs
[0] = 
	`g_√w
(
H™dÀ
, 1);

472 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[0], 
HANDLE_MOVE_STARTPOINT
);

473 
obj
->
h™dÀs
[0] = 
‹th
->handles[0];

475 
‹th
->
h™dÀs
[1] = 
	`g_√w
(
H™dÀ
, 1);

476 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[1]);

477 
obj
->
h™dÀs
[1] = 
‹th
->handles[1];

479 
‹th
->
h™dÀs
[2] = 
	`g_√w
(
H™dÀ
, 1);

480 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[2], 
HANDLE_MOVE_ENDPOINT
);

481 
obj
->
h™dÀs
[2] = 
‹th
->handles[2];

483 
‹th
->
aut‹outög
 = 
TRUE
;

486 
‹th
->
poöts
[0] = *
°¨çoöt
;

487 
‹th
->
poöts
[1].
x
 = 
°¨çoöt
->x;

488 
‹th
->
poöts
[1].
y
 = 
°¨çoöt
->y + 1.0;

489 
‹th
->
poöts
[2].
x
 = 
°¨çoöt
->x + 1.0;

490 
‹th
->
poöts
[2].
y
 = 
°¨çoöt
->y + 1.0;

491 
‹th
->
poöts
[3].
x
 = 
°¨çoöt
->x + 2.0;

492 
‹th
->
poöts
[3].
y
 = 
°¨çoöt
->y + 1.0;

494 
‹th
->
‹õ¡©i⁄
[0] = 
VERTICAL
;

495 
‹th
->
‹õ¡©i⁄
[1] = 
HORIZONTAL
;

496 
‹th
->
‹õ¡©i⁄
[2] = 
VERTICAL
;

498 
	`‹thc⁄n_upd©e_d©a
(
‹th
);

499 
	}
}

503 
	$‹thc⁄n_£t_poöts
(
OπhC⁄n
 *
‹th
, 
num_poöts
, 
Poöt
 *
poöts
)

505 
i
;

506 
gboﬁón
 
h‹iz
;

508 
‹th
->
numpoöts
 = 
num_poöts
;

510 i‡(
‹th
->
poöts
)

511 
	`g_‰ì
(
‹th
->
poöts
);

513 
‹th
->
poöts
 = 
	`g_mÆloc
((‹th->
numpoöts
)*(
Poöt
));

515 
i
=0;i<
‹th
->
numpoöts
;i++) {

516 
‹th
->
poöts
[
i
] =Öoints[i];

521 
‹th
->
num‹õ¡
 = oπh->
numpoöts
-1;

522 i‡(
‹th
->
‹õ¡©i⁄
Ë
	`g_‰ì
(orth->orientation);

523 
‹th
->
‹õ¡©i⁄
 = 
	`g_√w
(
Orõ¡©i⁄
, oπh->
num‹õ¡
);

524 
h‹iz
 = (
	`Ábs
(
‹th
->
poöts
[0].
y
-orth->points[1].y) < 0.00001);

525 
i
 = 0; i < 
‹th
->
num‹õ¡
; i++) {

526 i‡(
h‹iz
Ë
‹th
->
‹õ¡©i⁄
[
i
] = 
HORIZONTAL
;

527 
‹th
->
‹õ¡©i⁄
[
i
] = 
VERTICAL
;

528 
h‹iz
 = !horiz;

530 
	}
}

533 
	$‹thc⁄n_c›y
(
OπhC⁄n
 *
‰om
, OπhC⁄¿*
to
)

535 
i
;

536 
DüObje˘
 *
toobj
, *
‰omobj
;

538 
toobj
 = &
to
->
obje˘
;

539 
‰omobj
 = &
‰om
->
obje˘
;

541 
	`obje˘_c›y
(
‰omobj
, 
toobj
);

543 
to
->
numpoöts
 = 
‰om
->numpoints;

544 
to
->
num‹õ¡
 = 
‰om
->numorient;

546 
to
->
poöts
 = 
	`g_mÆloc0
(—o->
numpoöts
)*(
Poöt
));

548 
i
=0;i<
to
->
numpoöts
;i++) {

549 
to
->
poöts
[
i
] = 
‰om
->points[i];

552 
to
->
aut‹outög
 = 
‰om
->autorouting;

553 
to
->
‹õ¡©i⁄
 = 
	`g_mÆloc0
(—o->
numpoöts
-1)*(
Orõ¡©i⁄
));

554 
to
->
numh™dÀs
 = 
‰om
->numhandles;

555 
to
->
h™dÀs
 = 
	`g_mÆloc0
(—o->
numpoöts
-1)*(
H™dÀ
 *));

557 
i
=0;i<
to
->
numpoöts
-1;i++) {

558 
to
->
‹õ¡©i⁄
[
i
] = 
‰om
->orientation[i];

559 
to
->
h™dÀs
[
i
] = 
	`g_√w
(
H™dÀ
,1);

560 *
to
->
h™dÀs
[
i
] = *
‰om
->handles[i];

561 
to
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 = 
NULL
;

562 
toobj
->
h™dÀs
[
i
] = 
to
->handles[i];

564 
	`mem˝y
(&
to
->
exåa_•acög
,&
‰om
->extra_spacing,(to->extra_spacing));

565 
	}
}

568 
	$‹thc⁄n_de°roy
(
OπhC⁄n
 *
‹th
)

570 
i
;

572 
	`obje˘_de°roy
(&
‹th
->
obje˘
);

574 
	`g_‰ì
(
‹th
->
poöts
);

575 
	`g_‰ì
(
‹th
->
‹õ¡©i⁄
);

577 
i
=0;i<
‹th
->
numpoöts
-1;i++)

578 
	`g_‰ì
(
‹th
->
h™dÀs
[
i
]);

580 
	`g_‰ì
(
‹th
->
h™dÀs
);

581 
	}
}

584 
	$∂a˚_h™dÀ_by_sw≠pög
(
OπhC⁄n
 *
‹th
, 
ödex
, 
H™dÀ
 *
h™dÀ
)

586 
DüObje˘
 *
obj
;

587 
H™dÀ
 *
tmp
;

588 
j
;

590 
obj
 = (
DüObje˘
 *)
‹th
;

591 i‡(
obj
->
h™dÀs
[
ödex
] =
h™dÀ
)

594 
j
=0;j<
obj
->
num_h™dÀs
;j++) {

595 i‡(
obj
->
h™dÀs
[
j
] =
h™dÀ
) {

597 
tmp
 = 
obj
->
h™dÀs
[
j
];

598 
obj
->
h™dÀs
[
j
] = obj->h™dÀs[
ödex
];

599 
obj
->
h™dÀs
[
ödex
] = 
tmp
;

604 
	}
}

607 
	$‹thc⁄n_ßve
(
OπhC⁄n
 *
‹th
, 
Obje˘Node
 
obj_node
)

609 
i
;

610 
AâribuãNode
 
©å
;

613 
	`∂a˚_h™dÀ_by_sw≠pög
(
‹th
, 0, oπh->
h™dÀs
[0]);

614 
	`∂a˚_h™dÀ_by_sw≠pög
(
‹th
, 1, oπh->
h™dÀs
[‹th->
numpoöts
-2]);

616 
	`obje˘_ßve
(&
‹th
->
obje˘
, 
obj_node
);

618 
©å
 = 
	`√w_©åibuã
(
obj_node
, "orth_points");

620 
i
=0;i<
‹th
->
numpoöts
;i++) {

621 
	`d©a_add_poöt
(
©å
, &
‹th
->
poöts
[
i
]);

624 
©å
 = 
	`√w_©åibuã
(
obj_node
, "orth_orient");

625 
i
=0;i<
‹th
->
numpoöts
-1;i++) {

626 
	`d©a_add_íum
(
©å
, 
‹th
->
‹õ¡©i⁄
[
i
]);

629 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "aut‹outög"), 
‹th
->
aut‹outög
);

630 
	}
}

633 
	$‹thc⁄n_lﬂd
(
OπhC⁄n
 *
‹th
, 
Obje˘Node
 
obj_node
)

635 
i
;

636 
AâribuãNode
 
©å
;

637 
D©aNode
 
d©a
;

638 
n
;

639 
vîsi⁄
 = 0;

641 
DüObje˘
 *
obj
 = &
‹th
->
obje˘
;

643 
	`obje˘_lﬂd
(
obj
, 
obj_node
);

645 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "version");

646 i‡(
©å
 !
NULL
)

647 
vîsi⁄
 = 
	`©åibuã_num_d©a
(
©å
);

649 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "orth_points");

651 i‡(
©å
 !
NULL
)

652 
‹th
->
numpoöts
 = 
	`©åibuã_num_d©a
(
©å
);

654 
‹th
->
numpoöts
 = 0;

656 
‹th
->
num‹õ¡
 = oπh->
numpoöts
 - 1;

658 
	`obje˘_öô
(
obj
, 
‹th
->
numpoöts
-1, 0);

660 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

661 
‹th
->
poöts
 = 
	`g_mÆloc0
((‹th->
numpoöts
)*(
Poöt
));

662 
i
=0;i<
‹th
->
numpoöts
;i++) {

663 
	`d©a_poöt
(
d©a
, &
‹th
->
poöts
[
i
]);

664 
d©a
 = 
	`d©a_√xt
(data);

667 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "orth_orient");

669 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

670 
‹th
->
‹õ¡©i⁄
 = 
	`g_mÆloc0
((‹th->
numpoöts
-1)*(
Orõ¡©i⁄
));

671 
i
=0;i<
‹th
->
numpoöts
-1;i++) {

672 
‹th
->
‹õ¡©i⁄
[
i
] = 
	`d©a_íum
(
d©a
);

673 
d©a
 = 
	`d©a_√xt
(data);

676 
‹th
->
aut‹outög
 = 
TRUE
;

677 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "autorouting");

678 i‡(
©å
 !
NULL
)

679 
‹th
->
aut‹outög
 = 
	`d©a_boﬁón
(
	`©åibuã_fú°_d©a
(
©å
));

680 i‡(
vîsi⁄
 == 0) {

682 
‹th
->
aut‹outög
 = 
FALSE
;

685 
‹th
->
h™dÀs
 = 
	`g_mÆloc0
((‹th->
numpoöts
-1)*(
H™dÀ
 *));

687 
‹th
->
h™dÀs
[0] = 
	`g_√w
(
H™dÀ
, 1);

688 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[0], 
HANDLE_MOVE_STARTPOINT
);

689 
‹th
->
h™dÀs
[0]->
pos
 = oπh->
poöts
[0];

690 
obj
->
h™dÀs
[0] = 
‹th
->handles[0];

692 
n
 = 
‹th
->
numpoöts
-2;

693 
‹th
->
h™dÀs
[
n
] = 
	`g_√w
(
H™dÀ
, 1);

694 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[
n
], 
HANDLE_MOVE_ENDPOINT
);

695 
‹th
->
h™dÀs
[
n
]->
pos
 = oπh->
poöts
[‹th->
numpoöts
-1];

696 
obj
->
h™dÀs
[1] = 
‹th
->h™dÀs[
n
];

698 
i
=1; i<
‹th
->
numpoöts
-2; i++) {

699 
‹th
->
h™dÀs
[
i
] = 
	`g_√w
(
H™dÀ
, 1);

700 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[
i
]);

701 
obj
->
h™dÀs
[
i
+1] = 
‹th
->handles[i];

703 
‹th
->
numh™dÀs
 = oπh->
numpoöts
-1;

705 
	`‹thc⁄n_upd©e_d©a
(
‹th
);

706 
	}
}

708 
H™dÀ
*

709 
	$‹thc⁄n_gë_middÀ_h™dÀ
–
OπhC⁄n
 *
‹th
 )

711 
n
 = 
‹th
->
numpoöts
 - 1 ;

712  
‹th
->
h™dÀs
[ 
n
/2 ] ;

713 
	}
}

715 
Obje˘Ch™ge
 *

716 
	$‹thc⁄n_dñëe_£gmít
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
)

718 
£gmít
;

719 
Obje˘Ch™ge
 *
ch™ge
 = 
NULL
;

721 i‡(
‹th
->
numpoöts
==3)

722  
NULL
;

724 
£gmít
 = 
	`gë_£gmít_ƒ
(
‹th
, 
˛ickedpoöt
, 1.0);

725 i‡(
£gmít
 < 0)

726  
NULL
;

728 i‡(
£gmít
==0) {

729 
ch™ge
 = 
	`íd£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_REMOVE_SEGMENT
, 
£gmít
,

730 &
‹th
->
poöts
[
£gmít
],

731 
‹th
->
h™dÀs
[
£gmít
]);

732 } i‡(
£gmít
 =
‹th
->
numpoöts
-2) {

733 
ch™ge
 = 
	`íd£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_REMOVE_SEGMENT
, 
£gmít
,

734 &
‹th
->
poöts
[
£gmít
+1],

735 
‹th
->
h™dÀs
[
£gmít
]);

736 } i‡(
£gmít
 > 0) {

740 i‡(
£gmít
 =
‹th
->
numpoöts
-3)

741 
£gmít
--;

743 
ch™ge
 = 
	`mid£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_REMOVE_SEGMENT
, 
£gmít
,

744 &
‹th
->
poöts
[
£gmít
],

745 &
‹th
->
poöts
[
£gmít
+1],

746 
‹th
->
h™dÀs
[
£gmít
],

747 
‹th
->
h™dÀs
[
£gmít
+1]);

750 
ch™ge
->
	`≠∂y
(ch™ge, (
DüObje˘
 *)
‹th
);

752  
ch™ge
;

753 
	}
}

755 
Obje˘Ch™ge
 *

756 
	$‹thc⁄n_add_£gmít
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
)

758 
H™dÀ
 *
h™dÀ1
, *
h™dÀ2
;

759 
Obje˘Ch™ge
 *
ch™ge
 = 
NULL
;

760 
£gmít
;

761 
Poöt
 
√wpoöt
;

763 
£gmít
 = 
	`gë_£gmít_ƒ
(
‹th
, 
˛ickedpoöt
, 1.0);

764 i‡(
£gmít
 < 0)

765  
NULL
;

767 i‡(
£gmít
==0) {

768 
h™dÀ1
 = 
	`g_√w
(
H™dÀ
, 1);

769 
	`£tup_ídpoöt_h™dÀ
(
h™dÀ1
, 
HANDLE_MOVE_STARTPOINT
);

770 
ch™ge
 = 
	`íd£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_ADD_SEGMENT
,

771 0, &
‹th
->
poöts
[0],

772 
h™dÀ1
);

773 } i‡(
£gmít
 =
‹th
->
numpoöts
-2) {

774 
h™dÀ1
 = 
	`g_√w
(
H™dÀ
, 1);

775 
	`£tup_ídpoöt_h™dÀ
(
h™dÀ1
, 
HANDLE_MOVE_ENDPOINT
);

776 
ch™ge
 = 
	`íd£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_ADD_SEGMENT
,

777 
£gmít
+1, &
‹th
->
poöts
[segment+1],

778 
h™dÀ1
);

779 } i‡(
£gmít
 > 0) {

780 
h™dÀ1
 = 
	`g_√w
(
H™dÀ
, 1);

781 
	`£tup_midpoöt_h™dÀ
(
h™dÀ1
);

782 
h™dÀ2
 = 
	`g_√w
(
H™dÀ
, 1);

783 
	`£tup_midpoöt_h™dÀ
(
h™dÀ2
);

784 
√wpoöt
 = *
˛ickedpoöt
;

785 i‡(
‹th
->
‹õ¡©i⁄
[
£gmít
]==
HORIZONTAL
)

786 
√wpoöt
.
y
 = 
‹th
->
poöts
[
£gmít
].y;

788 
√wpoöt
.
x
 = 
‹th
->
poöts
[
£gmít
].x;

790 
ch™ge
 = 
	`mid£gmít_¸óã_ch™ge
(
‹th
, 
TYPE_ADD_SEGMENT
, 
£gmít
,

791 &
√wpoöt
,

792 &
√wpoöt
,

793 
h™dÀ1
,

794 
h™dÀ2
);

797 
ch™ge
->
	`≠∂y
(ch™ge, (
DüObje˘
 *)
‹th
);

799  
ch™ge
;

800 
	}
}

806 
Obje˘Ch™ge
 *

807 
	$‹thc⁄n_£t_aut‹outög
(
OπhC⁄n
 *
c⁄n
, 
gboﬁón
 
⁄
)

809 
DüObje˘
 *
obj
 = (DüObje˘ *)
c⁄n
;

810 
Obje˘Ch™ge
 *
ch™ge
;

812 
ch™ge
 = 
	`aut‹ouã_¸óã_ch™ge
(
c⁄n
, 
⁄
);

813 
ch™ge
->
	`≠∂y
(ch™ge, 
obj
);

814  
ch™ge
;

815 
	}
}

818 
	$dñëe_poöt
(
OπhC⁄n
 *
‹th
, 
pos
)

820 
i
;

822 
‹th
->
numpoöts
--;

823 
‹th
->
num‹õ¡
 = oπh->
numpoöts
 - 1;

825 
i
=
pos
;i<
‹th
->
numpoöts
;i++) {

826 
‹th
->
poöts
[
i
] = orth->points[i+1];

829 
‹th
->
poöts
 = 
	`g_ªÆloc
(‹th->poöts, oπh->
numpoöts
*(
Poöt
));

830 
	}
}

836 
	$ªmove_h™dÀ
(
OπhC⁄n
 *
‹th
, 
£gmít
)

838 
i
;

839 
H™dÀ
 *
h™dÀ
;

841 
h™dÀ
 = 
‹th
->
h™dÀs
[
£gmít
];

843 
i
=
£gmít
; i < 
‹th
->
numpoöts
-1; i++) {

844 
‹th
->
h™dÀs
[
i
] = orth->handles[i+1];

845 
‹th
->
‹õ¡©i⁄
[
i
] = orth->orientation[i+1];

848 
‹th
->
‹õ¡©i⁄
 = 
	`g_ªÆloc
(orth->orientation,

849 (
‹th
->
numpoöts
-1)*(
Orõ¡©i⁄
));

850 
‹th
->
h™dÀs
 = 
	`g_ªÆloc
(orth->handles,

851 (
‹th
->
numpoöts
-1)*(
H™dÀ
 *));

853 
	`obje˘_ªmove_h™dÀ
(&
‹th
->
obje˘
, 
h™dÀ
);

854 
‹th
->
numh™dÀs
 = oπh->
numpoöts
-1;

855 
	}
}

859 
	$add_poöt
(
OπhC⁄n
 *
‹th
, 
pos
, 
Poöt
 *
poöt
)

861 
i
;

863 
‹th
->
numpoöts
++;

864 
‹th
->
num‹õ¡
 = oπh->
numpoöts
-1;

866 
‹th
->
poöts
 = 
	`g_ªÆloc
(‹th->poöts, oπh->
numpoöts
*(
Poöt
));

867 
i
=
‹th
->
numpoöts
-1;i>
pos
;i--) {

868 
‹th
->
poöts
[
i
] = orth->points[i-1];

870 
‹th
->
poöts
[
pos
] = *
poöt
;

871 
	}
}

877 
	$ö£π_h™dÀ
(
OπhC⁄n
 *
‹th
, 
£gmít
,

878 
H™dÀ
 *
h™dÀ
, 
Orõ¡©i⁄
 
‹õ¡
)

880 
i
;

882 
‹th
->
‹õ¡©i⁄
 = 
	`g_ªÆloc
(orth->orientation,

883 (
‹th
->
numpoöts
-1)*(
Orõ¡©i⁄
));

884 
‹th
->
h™dÀs
 = 
	`g_ªÆloc
(orth->handles,

885 (
‹th
->
numpoöts
-1)*(
H™dÀ
 *));

886 
i
=
‹th
->
numpoöts
-2;i>
£gmít
;i--) {

887 
‹th
->
h™dÀs
[
i
] = orth->handles[i-1];

888 
‹th
->
‹õ¡©i⁄
[
i
] = orth->orientation[i-1];

890 
‹th
->
h™dÀs
[
£gmít
] = 
h™dÀ
;

891 
‹th
->
‹õ¡©i⁄
[
£gmít
] = 
‹õ¡
;

893 
	`obje˘_add_h™dÀ
(&
‹th
->
obje˘
, 
h™dÀ
);

894 
‹th
->
numh™dÀs
 = oπh->
numpoöts
-1;

895 
	}
}

898 
	$íd£gmít_ch™ge_‰ì
(
EndSegmítCh™ge
 *
ch™ge
)

900 i‡–(
ch™ge
->
ty≥
==
TYPE_ADD_SEGMENT
 && !ch™ge->
≠∂õd
) ||

901 (
ch™ge
->
ty≥
==
TYPE_REMOVE_SEGMENT
 && ch™ge->
≠∂õd
) ){

902 i‡(
ch™ge
->
h™dÀ
)

903 
	`g_‰ì
(
ch™ge
->
h™dÀ
);

904 
ch™ge
->
h™dÀ
 = 
NULL
;

906 
	}
}

909 
	$íd£gmít_ch™ge_≠∂y
(
EndSegmítCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

911 
OπhC⁄n
 *
‹th
 = (OπhC⁄¿*)
obj
;

913 
ch™ge
->
≠∂õd
 = 1;

915 
ch™ge
->
ty≥
) {

916 
TYPE_ADD_SEGMENT
:

917 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
ﬁd_íd_h™dÀ
);

918 i‡(
ch™ge
->
£gmít
==0) {

919 
	`add_poöt
(
‹th
, 0, &
ch™ge
->
poöt
);

920 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
,

921 
ch™ge
->
h™dÀ
, 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[0]) );

922 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[1]);

923 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

925 
	`add_poöt
(
‹th
, oπh->
numpoöts
, &
ch™ge
->
poöt
);

926 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
, ch™ge->
h™dÀ
,

927 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[‹th->
numpoöts
-3]) );

928 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[‹th->
numpoöts
-3]);

930 i‡(
ch™ge
->
˝
)

931 
	`obje˘_c⁄√˘
(
obj
, 
ch™ge
->
h™dÀ
, ch™ge->
˝
);

933 
TYPE_REMOVE_SEGMENT
:

934 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
ﬁd_íd_h™dÀ
);

935 i‡(
ch™ge
->
£gmít
==0) {

936 
	`dñëe_poöt
(
‹th
, 0);

937 
	`ªmove_h™dÀ
(
‹th
, 0);

938 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[0], 
HANDLE_MOVE_STARTPOINT
);

939 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

941 
	`dñëe_poöt
(
‹th
, oπh->
numpoöts
-1);

942 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
);

943 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[‹th->
numpoöts
-2],

944 
HANDLE_MOVE_ENDPOINT
);

948 
	}
}

951 
	$íd£gmít_ch™ge_ªvît
(
EndSegmítCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

953 
OπhC⁄n
 *
‹th
 = (OπhC⁄¿*)
obj
;

955 
ch™ge
->
ty≥
) {

956 
TYPE_ADD_SEGMENT
:

957 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ
);

958 i‡(
ch™ge
->
£gmít
==0) {

959 
	`dñëe_poöt
(
‹th
, 0);

960 
	`ªmove_h™dÀ
(
‹th
, 0);

961 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[0], 
HANDLE_MOVE_STARTPOINT
);

962 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

964 
	`dñëe_poöt
(
‹th
, oπh->
numpoöts
-1);

965 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
);

966 
	`£tup_ídpoöt_h™dÀ
(
‹th
->
h™dÀs
[‹th->
numpoöts
-2],

967 
HANDLE_MOVE_ENDPOINT
);

969 i‡(
ch™ge
->
˝
)

970 
	`obje˘_c⁄√˘
(
obj
, 
ch™ge
->
ﬁd_íd_h™dÀ
, ch™ge->
˝
);

972 
TYPE_REMOVE_SEGMENT
:

973 i‡(
ch™ge
->
£gmít
==0) {

974 
	`add_poöt
(
‹th
, 0, &
ch™ge
->
poöt
);

975 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
,

976 
ch™ge
->
h™dÀ
, 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[0]) );

977 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[1]);

978 
obj
->
posôi⁄
 = 
‹th
->
poöts
[0];

980 
	`add_poöt
(
‹th
, oπh->
numpoöts
, &
ch™ge
->
poöt
);

981 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
, ch™ge->
h™dÀ
,

982 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[‹th->
numpoöts
-3]) );

983 
	`£tup_midpoöt_h™dÀ
(
‹th
->
h™dÀs
[‹th->
numpoöts
-3]);

985 i‡(
ch™ge
->
˝
)

986 
	`obje˘_c⁄√˘
(
obj
, 
ch™ge
->
ﬁd_íd_h™dÀ
, ch™ge->
˝
);

989 
ch™ge
->
≠∂õd
 = 0;

990 
	}
}

992 
Obje˘Ch™ge
 *

993 
	$íd£gmít_¸óã_ch™ge
(
OπhC⁄n
 *
‹th
, 
ch™ge_ty≥
 
ty≥
,

994 
£gmít
, 
Poöt
 *
poöt
,

995 
H™dÀ
 *
h™dÀ
)

997 
EndSegmítCh™ge
 *
ch™ge
;

999 
ch™ge
 = 
	`g_√w
(
EndSegmítCh™ge
, 1);

1001 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
íd£gmít_ch™ge_≠∂y
;

1002 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
íd£gmít_ch™ge_ªvît
;

1003 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
íd£gmít_ch™ge_‰ì
;

1005 
ch™ge
->
ty≥
 =Åype;

1006 
ch™ge
->
≠∂õd
 = 0;

1007 
ch™ge
->
£gmít
 = segment;

1008 
ch™ge
->
poöt
 = *point;

1009 
ch™ge
->
h™dÀ
 = handle;

1010 i‡(
£gmít
 == 0)

1011 
ch™ge
->
ﬁd_íd_h™dÀ
 = 
‹th
->
h™dÀs
[0];

1013 
ch™ge
->
ﬁd_íd_h™dÀ
 = 
‹th
->
h™dÀs
[‹th->
numpoöts
-2];

1014 
ch™ge
->
˝
 = ch™ge->
ﬁd_íd_h™dÀ
->
c⁄√˘ed_to
;

1016  (
Obje˘Ch™ge
 *)
ch™ge
;

1017 
	}
}

1021 
	$mid£gmít_ch™ge_‰ì
(
MidSegmítCh™ge
 *
ch™ge
)

1023 i‡–(
ch™ge
->
ty≥
==
TYPE_ADD_SEGMENT
 && !ch™ge->
≠∂õd
) ||

1024 (
ch™ge
->
ty≥
==
TYPE_REMOVE_SEGMENT
 && ch™ge->
≠∂õd
) ){

1025 i‡(
ch™ge
->
h™dÀs
[0])

1026 
	`g_‰ì
(
ch™ge
->
h™dÀs
[0]);

1027 
ch™ge
->
h™dÀs
[0] = 
NULL
;

1028 i‡(
ch™ge
->
h™dÀs
[1])

1029 
	`g_‰ì
(
ch™ge
->
h™dÀs
[1]);

1030 
ch™ge
->
h™dÀs
[1] = 
NULL
;

1032 
	}
}

1035 
	$mid£gmít_ch™ge_≠∂y
(
MidSegmítCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1037 
OπhC⁄n
 *
‹th
 = (OπhC⁄¿*)
obj
;

1038 
ch™ge
->
≠∂õd
 = 1;

1040 
ch™ge
->
ty≥
) {

1041 
TYPE_ADD_SEGMENT
:

1042 
	`add_poöt
(
‹th
, 
ch™ge
->
£gmít
+1, &ch™ge->
poöts
[1]);

1043 
	`add_poöt
(
‹th
, 
ch™ge
->
£gmít
+1, &ch™ge->
poöts
[0]);

1044 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
+1, ch™ge->
h™dÀs
[1],

1045 
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
] );

1046 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
+1, ch™ge->
h™dÀs
[0],

1047 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
]) );

1049 
TYPE_REMOVE_SEGMENT
:

1050 
	`dñëe_poöt
(
‹th
, 
ch™ge
->
£gmít
);

1051 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
);

1052 
	`dñëe_poöt
(
‹th
, 
ch™ge
->
£gmít
);

1053 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
);

1054 i‡(
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
]==
HORIZONTAL
) {

1055 
‹th
->
poöts
[
ch™ge
->
£gmít
].
x
 = change->points[0].x;

1057 
‹th
->
poöts
[
ch™ge
->
£gmít
].
y
 = change->points[0].y;

1061 
	}
}

1064 
	$mid£gmít_ch™ge_ªvît
(
MidSegmítCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1066 
OπhC⁄n
 *
‹th
 = (OπhC⁄¿*)
obj
;

1068 
ch™ge
->
ty≥
) {

1069 
TYPE_ADD_SEGMENT
:

1070 
	`dñëe_poöt
(
‹th
, 
ch™ge
->
£gmít
+1);

1071 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
+1);

1072 
	`dñëe_poöt
(
‹th
, 
ch™ge
->
£gmít
+1);

1073 
	`ªmove_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
+1);

1075 
TYPE_REMOVE_SEGMENT
:

1076 i‡(
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
]==
HORIZONTAL
) {

1077 
‹th
->
poöts
[
ch™ge
->
£gmít
].
x
 = change->points[1].x;

1079 
‹th
->
poöts
[
ch™ge
->
£gmít
].
y
 = change->points[1].y;

1081 
	`add_poöt
(
‹th
, 
ch™ge
->
£gmít
, &ch™ge->
poöts
[1]);

1082 
	`add_poöt
(
‹th
, 
ch™ge
->
£gmít
, &ch™ge->
poöts
[0]);

1083 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
, ch™ge->
h™dÀs
[1],

1084 
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
-1] );

1085 
	`ö£π_h™dÀ
(
‹th
, 
ch™ge
->
£gmít
, ch™ge->
h™dÀs
[0],

1086 
	`FLIP_ORIENT
(
‹th
->
‹õ¡©i⁄
[
ch™ge
->
£gmít
-1]) );

1089 
ch™ge
->
≠∂õd
 = 0;

1090 
	}
}

1092 
Obje˘Ch™ge
 *

1093 
	$mid£gmít_¸óã_ch™ge
(
OπhC⁄n
 *
‹th
, 
ch™ge_ty≥
 
ty≥
,

1094 
£gmít
,

1095 
Poöt
 *
poöt1
, Poöà*
poöt2
,

1096 
H™dÀ
 *
h™dÀ1
, H™dÀ *
h™dÀ2
)

1098 
MidSegmítCh™ge
 *
ch™ge
;

1100 
ch™ge
 = 
	`g_√w
(
MidSegmítCh™ge
, 1);

1102 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
mid£gmít_ch™ge_≠∂y
;

1103 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
mid£gmít_ch™ge_ªvît
;

1104 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
mid£gmít_ch™ge_‰ì
;

1106 
ch™ge
->
ty≥
 =Åype;

1107 
ch™ge
->
≠∂õd
 = 0;

1108 
ch™ge
->
£gmít
 = segment;

1109 
ch™ge
->
poöts
[0] = *
poöt1
;

1110 
ch™ge
->
poöts
[1] = *
poöt2
;

1111 
ch™ge
->
h™dÀs
[0] = 
h™dÀ1
;

1112 
ch™ge
->
h™dÀs
[1] = 
h™dÀ2
;

1114  (
Obje˘Ch™ge
 *)
ch™ge
;

1115 
	}
}

1118 
	$aut‹ouã_ch™ge_‰ì
(
Aut‹ouãCh™ge
 *
ch™ge
)

1120 
	`g_‰ì
(
ch™ge
->
poöts
);

1121 
	}
}

1124 
	$aut‹ouã_ch™ge_≠∂y
(
Aut‹ouãCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1126 
OπhC⁄n
 *
‹th
 = (OπhC⁄n*)
obj
;

1128 i‡(
ch™ge
->
⁄
) {

1129 
‹th
->
aut‹outög
 = 
TRUE
;

1130 
	`aut‹ouã_œyout_‹thc⁄n
(
‹th
, 
obj
->
h™dÀs
[0]->
c⁄√˘ed_to
,

1131 
obj
->
h™dÀs
[1]->
c⁄√˘ed_to
);

1133 
‹th
->
aut‹outög
 = 
FALSE
;

1134 
	`‹thc⁄n_£t_poöts
(
‹th
, oπh->
numpoöts
, 
ch™ge
->
poöts
);

1136 
	}
}

1139 
	$aut‹ouã_ch™ge_ªvît
(
Aut‹ouãCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1141 
OπhC⁄n
 *
‹th
 = (OπhC⁄n*)
obj
;

1143 i‡(
ch™ge
->
⁄
) {

1144 
‹th
->
aut‹outög
 = 
FALSE
;

1145 
	`‹thc⁄n_£t_poöts
(
‹th
, oπh->
numpoöts
, 
ch™ge
->
poöts
);

1147 
‹th
->
aut‹outög
 = 
TRUE
;

1148 
	`aut‹ouã_œyout_‹thc⁄n
(
‹th
, 
obj
->
h™dÀs
[0]->
c⁄√˘ed_to
,

1149 
obj
->
h™dÀs
[1]->
c⁄√˘ed_to
);

1151 
	}
}

1153 
Obje˘Ch™ge
 *

1154 
	$aut‹ouã_¸óã_ch™ge
(
OπhC⁄n
 *
‹th
, 
gboﬁón
 
⁄
)

1156 
Aut‹ouãCh™ge
 *
ch™ge
;

1157 
i
;

1159 
ch™ge
 = 
	`g_√w
(
Aut‹ouãCh™ge
, 1);

1161 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
aut‹ouã_ch™ge_≠∂y
;

1162 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
aut‹ouã_ch™ge_ªvît
;

1163 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
aut‹ouã_ch™ge_‰ì
;

1165 
ch™ge
->
⁄
 = on;

1166 
ch™ge
->
poöts
 = 
	`g_√w
(
Poöt
, 
‹th
->
numpoöts
);

1167 
i
 = 0; i < 
‹th
->
numpoöts
; i++)

1168 
ch™ge
->
poöts
[
i
] = 
‹th
->points[i];

1170  (
Obje˘Ch™ge
 *)
ch™ge
;

1171 
	}
}

1173 
Obje˘Ch™ge
 *

1174 
	$‹thc⁄n_toggÀ_aut‹outög_ˇŒback
(
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

1176 
Obje˘Ch™ge
 *
ch™ge
;

1180 
ch™ge
 = 
	`‹thc⁄n_£t_aut‹outög
((
OπhC⁄n
*)
obj
,

1181 !((
OπhC⁄n
*)
obj
)->
aut‹outög
);

1182 
	`‹thc⁄n_upd©e_d©a
((
OπhC⁄n
 *)
obj
);

1183  
ch™ge
;

1184 
	}
}

1187 
	$‹thc⁄n_upd©e_obje˘_míu
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛icked
,

1188 
DüMíuIãm
 *
obje˘_míu_ôems
)

1190 
obje˘_míu_ôems
[0].
a˘ive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
|

1191 (
‹th
->
aut‹outög
?
DIAMENU_TOGGLE_ON
:0);

1192 
	}
}

	@O:\tool\dvs50\lib\orth_conn.h

18 #i‚de‡
ORTH_CONN_H


19 
	#ORTH_CONN_H


	)

21 
	~"düty≥s.h
"

22 
	~"obje˘.h
"

23 
	~"boundögbox.h
"

26 
	mHORIZONTAL
,

27 
	mVERTICAL


28 } 
	tOrõ¡©i⁄
;

30 
	#FLIP_ORIENT
(
x
Ë(((x)==
HORIZONTAL
)?
VERTICAL
:HORIZONTAL)

	)

32 
	#HANDLE_MIDPOINT
 (
HANDLE_CUSTOM1
)

	)

37 
	s_OπhC⁄n
 {

39 
DüObje˘
 
	mobje˘
;

41 
	mnumpoöts
;

42 
Poöt
 *
	mpoöts
;

44 
	mnum‹õ¡
;

45 
Orõ¡©i⁄
 *
	m‹õ¡©i⁄
;

47 
	mnumh™dÀs
;

48 
H™dÀ
 **
	mh™dÀs
;

55 
PﬁyBBExåas
 
	mexåa_•acög
;

56 
gboﬁón
 
	maut‹outög
;

59 
DIAVAR
 
‹thc⁄n_upd©e_d©a
(
OπhC⁄n
 *
‹th
);

60 
DIAVAR
 
‹thc⁄n_upd©e_boundögbox
(
OπhC⁄n
 *
‹th
);

61 
DIAVAR
 
‹thc⁄n_sim∂e_døw
(
OπhC⁄n
 *
‹th
, 
DüRídîî
 *
ªndîî
,

62 
ªÆ
 
width
);

63 
DIAVAR
 
‹thc⁄n_öô
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
°¨çoöt
);

64 
DIAVAR
 
‹thc⁄n_de°roy
(
OπhC⁄n
 *
‹th
);

65 
DIAVAR
 
‹thc⁄n_£t_poöts
(
OπhC⁄n
 *
‹th
, 
num_poöts
, 
Poöt
 *
poöts
);

66 
DIAVAR
 
‹thc⁄n_c›y
(
OπhC⁄n
 *
‰om
, OπhC⁄¿*
to
);

67 
DIAVAR
 
‹thc⁄n_ßve
(
OπhC⁄n
 *
‹th
, 
Obje˘Node
 
obj_node
);

68 
DIAVAR
 
‹thc⁄n_lﬂd
(
OπhC⁄n
 *
‹th
, 
Obje˘Node
 
obj_node
);

69 
DIAVAR
 
Obje˘Ch™ge
* 
‹thc⁄n_move_h™dÀ
(
OπhC⁄n
 *
‹th
, 
H™dÀ
 *
id
,

70 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

71 
H™dÀMoveRós⁄
 
ªas⁄
,

72 
ModifõrKeys
 
modifõrs
);

73 
DIAVAR
 
Obje˘Ch™ge
* 
‹thc⁄n_move
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
to
);

74 
DIAVAR
 
ªÆ
 
‹thc⁄n_di°™˚_‰om
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
poöt
,

75 
ªÆ
 
löe_width
);

76 
DIAVAR
 
H™dÀ
* 
‹thc⁄n_gë_middÀ_h™dÀ
(
OπhC⁄n
 *
‹th
);

78 
DIAVAR
 
‹thc⁄n_ˇn_dñëe_£gmít
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
);

79 
DIAVAR
 
‹thc⁄n_ˇn_add_£gmít
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
);

80 
DIAVAR
 
Obje˘Ch™ge
 *
‹thc⁄n_dñëe_£gmít
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
);

81 
DIAVAR
 
Obje˘Ch™ge
 *
‹thc⁄n_add_£gmít
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛ickedpoöt
);

82 
DIAVAR
 
Obje˘Ch™ge
 *
‹thc⁄n_toggÀ_aut‹outög_ˇŒback
(
DüObje˘
 *
‹th
,

83 
Poöt
 *
˛icked
,

84 
gpoöãr
 
d©a
);

85 
DIAVAR
 
‹thc⁄n_upd©e_obje˘_míu
(
OπhC⁄n
 *
‹th
, 
Poöt
 *
˛icked
,

86 
DüMíuIãm
 *
obje˘_míu_ôems
);

88 
	#ORTHCONN_COMMON_PROPERTIES
 \

89 
OBJECT_COMMON_PROPERTIES
, \

90 { "‹th_poöts", 
PROP_TYPE_POINTARRAY
, 0, "‹thc⁄¿poöts", 
NULL
}, \

91 { "‹th_‹õ¡", 
PROP_TYPE_ENUMARRAY
, 
PROP_FLAG_OPTIONAL
, "‹thc⁄¿‹õ¡©i⁄s", 
NULL
}, \

92 { "‹th_aut‹ouã", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_OPTIONAL
, 
	`N_
("Aut‹ouã"), 
NULL
} \

93 

	)

94 
	#ORTHCONN_COMMON_PROPERTIES_OFFSETS
 \

95 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

96 { "‹th_poöts", 
PROP_TYPE_POINTARRAY
, \

97 
	`off£tof
(
OπhC⁄n
,
poöts
), off£tof(OπhC⁄n,
numpoöts
)}, \

98 { "‹th_‹õ¡", 
PROP_TYPE_ENUMARRAY
, \

99 
	`off£tof
(
OπhC⁄n
,
‹õ¡©i⁄
), off£tof(OπhC⁄n,
num‹õ¡
)}, \

100 { "‹th_aut‹ouã", 
PROP_TYPE_BOOL
, 
	`off£tof
(
OπhC⁄n
,
aut‹outög
)} \

101 

	)

102 
	#ORTHCONN_COMMON_MENUS
 \

103 { 
	`N_
("Aut‹outög"), 
‹thc⁄n_toggÀ_aut‹outög_ˇŒback
, 
NULL
, \

104 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
}

	)

	@O:\tool\dvs50\lib\paper.c

19 
	~<c⁄fig.h
>

21 
	~<°dio.h
>

22 
	~<°rög.h
>

24 
	~"∑≥r.h
"

29 c⁄° 
	s_dü_∑≥r_mërics
 {

30 
gch¨
 *
	m∑≥r
;

31 
gdoubÀ
 
	mpswidth
, 
	mpsheight
;

32 
gdoubÀ
 
	mlm¨gö
, 
	mtm¨gö
, 
	mrm¨gö
, 
	mbm¨gö
;

33 } 
	g∑≥r_mërics
[] = {

56 { 
NULL
, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 }

60 
	$föd_∑≥r
(c⁄° 
gch¨
 *
«me
)

62 
i
;

64 i‡(
«me
 =
NULL
)  -1;

65 
i
 = 0; 
∑≥r_mërics
[i].
∑≥r
 !
NULL
; i++) {

66 i‡(!
	`g_ascii_°∫ˇ£cmp
(
∑≥r_mërics
[
i
].
∑≥r
, 
«me
,

67 
	`°æí
(
∑≥r_mërics
[
i
].
∑≥r
)))

70 i‡(
∑≥r_mërics
[
i
].
∑≥r
 =
NULL
)

71 
i
 = -1;

73  
i
;

74 
	}
}

77 
	$gë_deÁu…_∑≥r
()

79 
FILE
 *
∑≥rsize
;

80 
gch¨
 
∑≥r
[100];

81 c⁄° 
gch¨
 *
ív
;

82 
göt
 
i
;

84 if((
ív
 = 
	`g_gëív
("PAPERCONF")Ë!
NULL
) {

85 
	`°∫˝y
(
∑≥r
, 
ív
, (paper));

87 if((
∑≥rsize
 = 
	`f›í
("/ëc/∑≥rsize", "r")Ë!
NULL
) {

88 
	`fgës
(
∑≥r
, ’≠î), 
∑≥rsize
))

89 if(
	`g_ascii_iß um
(
∑≥r
[0])) {

92 
	`f˛o£
(
∑≥rsize
);

95 
	`°r˝y
(
∑≥r
, "a4");

97 
i
 = 
	`föd_∑≥r
(
∑≥r
);

98 i‡(
i
 == -1)

99 
i
 = 
	`föd_∑≥r
("a4");

101  
i
;

102 
	}
}

105 
	$gë_∑≥r_öfo
(
P≠îInfo
 *
∑≥r
, 
i
, 
NewDügømD©a
 *
¥efs
)

107 i‡(
i
 =-1 && 
¥efs
 !
NULL
)

108 
i
 = 
	`föd_∑≥r
(
¥efs
->
∑≥πy≥
);

109 i‡(
i
 == -1)

110 
i
 = 
	`gë_deÁu…_∑≥r
();

112 
∑≥r
->
«me
 = 
	`g_°rdup
(
∑≥r_mërics
[
i
].paper);

113 
∑≥r
->
tm¨gö
 = 
∑≥r_mërics
[
i
].tmargin;

114 
∑≥r
->
bm¨gö
 = 
∑≥r_mërics
[
i
].bmargin;

115 
∑≥r
->
lm¨gö
 = 
∑≥r_mërics
[
i
].lmargin;

116 
∑≥r
->
rm¨gö
 = 
∑≥r_mërics
[
i
].rmargin;

117 i‡(
¥efs
 !
NULL
)

118 
∑≥r
->
is_p‹åaô
 = 
¥efs
->is_portrait;

120 
∑≥r
->
is_p‹åaô
 = 
TRUE
;

121 
∑≥r
->
sˇlög
 = 1.0;

122 
∑≥r
->
fôto
 = 
FALSE
;

123 
∑≥r
->
fôwidth
 = 1;

124 
∑≥r
->
fôheight
 = 1;

125 
∑≥r
->
width
 = 
∑≥r_mërics
[
i
].
pswidth
 -

126 
∑≥r_mërics
[
i
].
lm¨gö
 -

127 
∑≥r_mërics
[
i
].
rm¨gö
;

128 
∑≥r
->
height
 = 
∑≥r_mërics
[
i
].
psheight
 -

129 
∑≥r_mërics
[
i
].
tm¨gö
 -

130 
∑≥r_mërics
[
i
].
bm¨gö
;

131 i‡(!
∑≥r
->
is_p‹åaô
) {

132 
tmp
 = 
∑≥r
->
width
;

133 
∑≥r
->
width
 =Ö≠î->
height
;

134 
∑≥r
->
height
 = 
tmp
;

136 
	}
}

138 
GLi°
 *

139 
	$gë_∑≥r_«me_li°
()

141 
i
;

142 
GLi°
 *
«me_li°
 = 
NULL
;

144 i‡(
«me_li°
 =
NULL
) {

145 
i
 = 0; 
∑≥r_mërics
[i].
∑≥r
 !
NULL
; i++) {

146 
«me_li°
 = 
	`g_li°_≠≥nd
“ame_li°, 
∑≥r_mërics
[
i
].
∑≥r
);

150  
«me_li°
;

151 
	}
}

153 c⁄° 
gch¨
 *

154 
	$gë_∑≥r_«me
(
i
)

156  
∑≥r_mërics
[
i
].
∑≥r
;

157 
	}
}

159 
gdoubÀ


160 
	$gë_∑≥r_psheight
(
i
)

162  
∑≥r_mërics
[
i
].
psheight
;

163 
	}
}

165 
gdoubÀ


166 
	$gë_∑≥r_pswidth
(
i
)

168  
∑≥r_mërics
[
i
].
pswidth
;

169 
	}
}

171 
gdoubÀ


172 
	$gë_∑≥r_lm¨gö
(
i
)

174  
∑≥r_mërics
[
i
].
lm¨gö
;

175 
	}
}

177 
gdoubÀ


178 
	$gë_∑≥r_rm¨gö
(
i
)

180  
∑≥r_mërics
[
i
].
rm¨gö
;

181 
	}
}

183 
gdoubÀ


184 
	$gë_∑≥r_tm¨gö
(
i
)

186  
∑≥r_mërics
[
i
].
tm¨gö
;

187 
	}
}

189 
gdoubÀ


190 
	$gë_∑≥r_bm¨gö
(
i
)

192  
∑≥r_mërics
[
i
].
bm¨gö
;

193 
	}
}

	@O:\tool\dvs50\lib\paper.h

19 #i‚de‡
PAPER_H


20 
	#PAPER_H


	)

22 
	~<glib.h
>

23 
	~<düty≥s.h
>

25 
	s_P≠îInfo
 {

26 
gch¨
 *
	m«me
;

27 
gÊﬂt
 
	mtm¨gö
, 
	mbm¨gö
, 
	mlm¨gö
, 
	mrm¨gö
;

28 
gboﬁón
 
	mis_p‹åaô
;

29 
gÊﬂt
 
	msˇlög
;

30 
gboﬁón
 
	mfôto
;

31 
göt
 
	mfôwidth
, 
	mfôheight
;

33 
gÊﬂt
 
	mwidth
, 
	mheight
;

39 
	~<dügømd©a.h
>

41 
DIAVAR
 
föd_∑≥r
(c⁄° 
gch¨
* 
«me
);

42 
DIAVAR
 
gë_deÁu…_∑≥r
();

43 
DIAVAR
 
gë_∑≥r_öfo
(
P≠îInfo
 *
∑≥r
, 
i
, 
NewDügømD©a
 *
d©a
);

45 
DIAVAR
 
GLi°
 *
gë_∑≥r_«me_li°
();

46 
DIAVAR
 c⁄° 
gch¨
 *
gë_∑≥r_«me
(
i
);

47 
DIAVAR
 
gdoubÀ
 
gë_∑≥r_psheight
(
i
);

48 
DIAVAR
 
gdoubÀ
 
gë_∑≥r_pswidth
(
i
);

49 
DIAVAR
 
gdoubÀ
 
gë_∑≥r_lm¨gö
(
i
);

50 
DIAVAR
 
gdoubÀ
 
gë_∑≥r_rm¨gö
(
i
);

51 
DIAVAR
 
gdoubÀ
 
gë_∑≥r_bm¨gö
(
i
);

52 
DIAVAR
 
gdoubÀ
 
gë_∑≥r_tm¨gö
(
i
);

	@O:\tool\dvs50\lib\parent.c

19 
	~<c⁄fig.h
>

21 
	~"geomëry.h
"

22 
	~"obje˘.h
"

23 
	~"∑ª¡.h
"

24 
	~<glib.h
>

32 
gboﬁón
 
	$∑ª¡_li°_ex∑nd
(
GLi°
 *
obj_li°
)

34 
gboﬁón
 
nŸhög_af„˘ed
 = 
FALSE
;

35 
GLi°
 *
li°
 = 
obj_li°
;

36 
li°
)

38 
DüObje˘
 *
obj
 = (DüObje˘ *Ë
li°
->
d©a
;

40 i‡(
	`obje˘_Êags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
Ë&& obj->
chûdªn
)

42 
obj_li°
 = 
	`g_li°_c⁄ˇt
(obj_li°, 
	`g_li°_c›y
(
obj
->
chûdªn
));

43 
nŸhög_af„˘ed
 = 
FALSE
;

46 
li°
 = 
	`g_li°_√xt
(list);

49  
nŸhög_af„˘ed
;

50 
	}
}

62 
GLi°
 *
	$∑ª¡_li°_af„˘ed_hõørchy
(
GLi°
 *
obj_li°
)

64 
GHashTabÀ
 *
obje˘_hash
 = 
	`g_hash_èbÀ_√w
(
g_dúe˘_hash
, 
g_dúe˘_equÆ
);

65 
GLi°
 *
Æl_li°
 = 
	`g_li°_c›y
(
obj_li°
);

66 
GLi°
 *
√w_li°
 = 
NULL
, *
li°
 = 
Æl_li°
;

67 
‹ig_Àngth
 = 
	`g_li°_Àngth
(
obj_li°
);

69 i‡(
	`∑ª¡_li°_ex∑nd
(
Æl_li°
))

70  
	`g_li°_c›y
(
obj_li°
);

73 
li°
 = 
	`g_li°_¡h
(
Æl_li°
, 
‹ig_Àngth
);

74 
li°
)

76 
	`g_hash_èbÀ_ö£π
(
obje˘_hash
, 
li°
->
d©a
, (*) 1);

77 
li°
 = 
	`g_li°_√xt
(list);

80 
li°
 = 
obj_li°
;

81 
li°
)

83 i‡(!
	`g_hash_èbÀ_lookup
(
obje˘_hash
, 
li°
->
d©a
))

84 
√w_li°
 = 
	`g_li°_≠≥nd
“ew_li°, 
li°
->
d©a
);

86 
li°
 = 
	`g_li°_√xt
(list);

89 
	`g_li°_‰ì
(
Æl_li°
);

90 
	`g_hash_èbÀ_de°roy
(
obje˘_hash
);

92  
√w_li°
;

93 
	}
}

106 
GLi°
 *
	$∑ª¡_li°_af„˘ed
(
GLi°
 *
obj_li°
)

108 
GHashTabÀ
 *
obje˘_hash
 = 
	`g_hash_èbÀ_√w
(
g_dúe˘_hash
, 
g_dúe˘_equÆ
);

109 
GLi°
 *
Æl_li°
 = 
	`g_li°_c›y
(
obj_li°
);

110 
GLi°
 *
√w_li°
 = 
NULL
, *
li°
 = 
Æl_li°
;

112 i‡(
	`∑ª¡_li°_ex∑nd
(
Æl_li°
))

113  
	`g_li°_c›y
(
obj_li°
);

116 
li°
 = 
Æl_li°
;

117 
li°
)

119 
DüObje˘
 *
obj
 = (DüObje˘ *Ë
li°
->
d©a
;

120 i‡(!
	`g_hash_èbÀ_lookup
(
obje˘_hash
, 
obj
))

122 
√w_li°
 = 
	`g_li°_≠≥nd
“ew_li°, 
obj
);

123 
	`g_hash_èbÀ_ö£π
(
obje˘_hash
, 
obj
, (*) 1);

126 
li°
 = 
	`g_li°_√xt
(list);

129 
	`g_li°_‰ì
(
Æl_li°
);

131  
√w_li°
;

132 
	}
}

138 
gboﬁón


139 
	$∑ª¡_h™dÀ_move_out_check
(
DüObje˘
 *
obje˘
, 
Poöt
 *
to
)

141 
Re˘™gÀ
 
p_ext
, 
c_ext
;

142 
Poöt
 
√w_dñè
;

144 i‡(!
obje˘
->
∑ª¡
)

145  
FALSE
;

147 
	`∑ª¡_h™dÀ_exã¡s
(
obje˘
->
∑ª¡
, &
p_ext
);

148 
	`∑ª¡_poöt_exã¡s
(
to
, &
c_ext
);

150 
√w_dñè
 = 
	`∑ª¡_move_chûd_dñè
(&
p_ext
, &
c_ext
, 
NULL
);

151 
	`poöt_add
(
to
, &
√w_dñè
);

153 i‡(
√w_dñè
.
x
 ||Çew_dñè.
y
)

154  
TRUE
;

156  
FALSE
;

157 
	}
}

164 
gboﬁón
 
	$∑ª¡_h™dÀ_move_ö_check
(
DüObje˘
 *
obje˘
, 
Poöt
 *
to
, Poöà*
°¨t_©
)

166 
GLi°
 *
li°
 = 
obje˘
->
chûdªn
;

167 
gboﬁón
 
⁄˚
 = 
TRUE
;

168 
Re˘™gÀ
 
comm⁄_ext
;

169 
gboﬁón
 
ª°ri˘ed
 = 
FALSE
;

171 i‡(!
	`obje˘_Êags_£t
(
obje˘
, 
DIA_OBJECT_CAN_PARENT
Ë|| !obje˘->
chûdªn
)

172  
FALSE
;

174 
li°
)

176 i‡(
⁄˚
) {

177 
	`∑ª¡_h™dÀ_exã¡s
(
li°
->
d©a
, &
comm⁄_ext
);

178 
⁄˚
 = 
FALSE
;

180 
Re˘™gÀ
 
c_ext
;

181 
	`∑ª¡_h™dÀ_exã¡s
 (
li°
->
d©a
, &
c_ext
);

182 
	`ª˘™gÀ_uni⁄
(&
comm⁄_ext
, &
c_ext
);

184 
li°
 = 
	`g_li°_√xt
(list);

191 i‡(
°¨t_©
->
y
 >
comm⁄_ext
.
bŸtom
) {

192 i‡(
to
->
y
 < 
comm⁄_ext
.
bŸtom
)

193 
to
->
y
 = 
comm⁄_ext
.
bŸtom
, 
ª°ri˘ed
 = 
TRUE
;

194 } i‡(
°¨t_©
->
y
 <
comm⁄_ext
.
t›
) {

195 i‡(
to
->
y
 > 
comm⁄_ext
.
t›
)

196 
to
->
y
 = 
comm⁄_ext
.
t›
, 
ª°ri˘ed
 = 
TRUE
;

199 i‡(
°¨t_©
->
x
 >
comm⁄_ext
.
right
) {

200 i‡(
to
->
x
 < 
comm⁄_ext
.
right
)

201 
to
->
x
 = 
comm⁄_ext
.
right
, 
ª°ri˘ed
 = 
TRUE
;

202 } i‡(
°¨t_©
->
x
 <
comm⁄_ext
.
À·
) {

203 i‡(
to
->
x
 > 
comm⁄_ext
.
À·
)

204 
to
->
x
 = 
comm⁄_ext
.
À·
, 
ª°ri˘ed
 = 
TRUE
;

207  
ª°ri˘ed
;

208 
	}
}

215 
Poöt
 
	$∑ª¡_move_chûd_dñè
(
Re˘™gÀ
 *
p_ext
, Re˘™gÀ *
c_ext
, 
Poöt
 *
dñè
)

217 
Poöt
 
√w_dñè
 = {0, 0};

218 
gboﬁón
 
‰ì_dñè
 = 
FALSE
;

219 i‡(
dñè
 =
NULL
)

221 
dñè
 = 
	`g_√w0
(
Poöt
, 1);

222 
‰ì_dñè
 = 
TRUE
;

227 i‡(
c_ext
->
À·
 + 
dñè
->
x
 < 
p_ext
->left )

228 
√w_dñè
.
x
 = 
p_ext
->
À·
 - (
c_ext
->À· + 
dñè
->x);

229 i‡(
c_ext
->
À·
 + 
dñè
->
x
 + (c_ext->
right
 - c_ext->À·Ë> 
p_ext
->right)

230 
√w_dñè
.
x
 = 
p_ext
->
right
 - (
c_ext
->
À·
 + 
dñè
->x + (c_ext->right - c_ext->left));

232 i‡(
c_ext
->
t›
 + 
dñè
->
y
 < 
p_ext
->top)

233 
√w_dñè
.
y
 = 
p_ext
->
t›
 - (
c_ext
->t› + 
dñè
->y);

234 i‡(
c_ext
->
t›
 + 
dñè
->
y
 + (c_ext->
bŸtom
 - c_ext->t›Ë> 
p_ext
->bottom)

235 
√w_dñè
.
y
 = 
p_ext
->
bŸtom
 - (
c_ext
->
t›
 + 
dñè
->y + (c_ext->bottom - c_ext->top));

237 i‡(
‰ì_dñè
)

238 
	`g_‰ì
(
dñè
);

240  
√w_dñè
;

241 
	}
}

245 
	$∑ª¡_poöt_exã¡s
(
Poöt
 *
poöt
, 
Re˘™gÀ
 *
exã¡s
)

247 
exã¡s
->
À·
 = 
poöt
->
x
;

248 
exã¡s
->
right
 = 
poöt
->
x
;

249 
exã¡s
->
t›
 = 
poöt
->
y
;

250 
exã¡s
->
bŸtom
 = 
poöt
->
y
;

251 
	}
}

258 
gboﬁón


259 
	$∑ª¡_h™dÀ_exã¡s
(
DüObje˘
 *
obj
, 
Re˘™gÀ
 *
exã¡s
)

261 
idx
;

262 
co‹d
 *
À·_mo°
 = 
NULL
, *
t›_mo°
 = NULL, *
bŸtom_mo°
 = NULL, *
right_mo°
 = NULL;

264 i‡(
obj
->
num_h™dÀs
 == 0)

265  
FALSE
;

267 
idx
 = 0; idx < 
obj
->
num_h™dÀs
; idx++)

269 
H™dÀ
 *
h™dÀ
 = 
obj
->
h™dÀs
[
idx
];

271 i‡(!
À·_mo°
 || *À·_mo° > 
h™dÀ
->
pos
.
x
)

272 
À·_mo°
 = &
h™dÀ
->
pos
.
x
;

273 i‡(!
right_mo°
 || *right_mo° < 
h™dÀ
->
pos
.
x
)

274 
right_mo°
 = &
h™dÀ
->
pos
.
x
;

275 i‡(!
t›_mo°
 || *t›_mo° > 
h™dÀ
->
pos
.
y
)

276 
t›_mo°
 = &
h™dÀ
->
pos
.
y
;

277 i‡(!
bŸtom_mo°
 || *bŸtom_mo° < 
h™dÀ
->
pos
.
y
)

278 
bŸtom_mo°
 = &
h™dÀ
->
pos
.
y
;

281 
exã¡s
->
À·
 = *
À·_mo°
;

282 
exã¡s
->
right
 = *
right_mo°
;

283 
exã¡s
->
t›
 = *
t›_mo°
;

284 
exã¡s
->
bŸtom
 = *
bŸtom_mo°
;

286  
TRUE
;

287 
	}
}

295 
	$∑ª¡_≠∂y_to_chûdªn
(
DüObje˘
 *
obj
, 
DüObje˘Func
 
fun˘i⁄
)

297 
GLi°
 *
chûdªn
;

298 
chûdªn
 = 
obj
->chûdªn; chûdª¿!
NULL
; chûdª¿
	`g_li°_√xt
(children)) {

299 
DüObje˘
 *
chûd
 = 
chûdªn
->
d©a
;

300 (*
fun˘i⁄
)(
chûd
);

301 
	`∑ª¡_≠∂y_to_chûdªn
(
chûd
, 
fun˘i⁄
);

303 
	}
}

	@O:\tool\dvs50\lib\parent.h

19 #i‚de‡
PARENT_H


20 
	#PARENT_H


	)

22 
	~<glib.h
>

23 
	~"geomëry.h
"

25 
DIAVAR
 
GLi°
 *
∑ª¡_li°_af„˘ed
(GLi° *
obj_li°
);

26 
DIAVAR
 
gboﬁón
 
∑ª¡_h™dÀ_exã¡s
(
DüObje˘
 *
obj
, 
Re˘™gÀ
 *
exã¡s
);

27 
DIAVAR
 
Poöt
 
∑ª¡_move_chûd_dñè
(
Re˘™gÀ
 *
p_ext
, Re˘™gÀ *
c_ãxt
, Poöà*
dñè
);

28 
DIAVAR
 
∑ª¡_poöt_exã¡s
(
Poöt
 *
poöt
, 
Re˘™gÀ
 *
exã¡s
);

29 
gboﬁón
 
∑ª¡_li°_ex∑nd
(
GLi°
 *
obj_li°
);

30 
DIAVAR
 
GLi°
 *
∑ª¡_li°_af„˘ed_hõørchy
(GLi° *
obj_li°
);

31 
DIAVAR
 
gboﬁón
 
∑ª¡_h™dÀ_move_out_check
(
DüObje˘
 *
obje˘
, 
Poöt
 *
to
);

32 
DIAVAR
 
gboﬁón
 
∑ª¡_h™dÀ_move_ö_check
(
DüObje˘
 *
obje˘
, 
Poöt
 *
to
, Poöà*
°¨t_©
);

33 
DIAVAR
 
∑ª¡_≠∂y_to_chûdªn
(
DüObje˘
 *
obj
, 
DüObje˘Func
 
func
);

	@O:\tool\dvs50\lib\persistence.c

23 
	~"c⁄fig.h
"

25 
	~<°dio.h
>

26 
	~<°rög.h
>

27 
	~<sys/°©.h
>

28 
	~<sys/ty≥s.h
>

29 #ifde‡
HAVE_UNISTD_H


30 
	~<uni°d.h
>

33 
	~"≥rsi°í˚.h
"

34 
	~"dü_dús.h
"

35 
	~"dü_xml_libxml.h
"

36 
	~"dü_xml.h
"

37 
	~"mesßge.h
"

39 
	~<gtk/gtk.h
>

40 
	~<libxml/åì.h
>

44 
GHashTabÀ
 *
	g≥rsi°ít_wödows
, *
	g≥rsi°ít_íåy°rögs
, *
	g≥rsi°ít_li°s
;

45 
GHashTabÀ
 *
	g≥rsi°ít_öãgîs
, *
	g≥rsi°ít_ªÆs
;

46 
GHashTabÀ
 *
	g≥rsi°ít_boﬁóns
, *
	g≥rsi°ít_°rögs
;

47 
GHashTabÀ
 *
	g≥rsi°ít_cﬁ‹s
;

49 
GHashTabÀ
 *

50 
	$_dü_hash_èbÀ_°r_™y_√w
 ()

53  
	`g_hash_èbÀ_√w_fuŒ
(
g_°r_hash
, 
g_°r_equÆ
, 
NULL
, 
g_‰ì
);

54 
	}
}

58 (*
	tPîsi°í˚LﬂdFunc
)(
	tgch¨
 *
	trﬁe
, 
	txmlNodePå
 
	tnode
);

61 
	$≥rsi°í˚_lﬂd_wödow
(
gch¨
 *
rﬁe
, 
xmlNodePå
 
node
)

63 
AâribuãNode
 
©å
;

64 
Pîsi°ítWödow
 *
wööfo
 = 
	`g_√w0
(PersistentWindow, 1);

66 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "xpos");

67 i‡(
©å
 !
NULL
)

68 
wööfo
->
x
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

69 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "ypos");

70 i‡(
©å
 !
NULL
)

71 
wööfo
->
y
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

72 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "width");

73 i‡(
©å
 !
NULL
)

74 
wööfo
->
width
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

75 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "height");

76 i‡(
©å
 !
NULL
)

77 
wööfo
->
height
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

78 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "isopen");

79 i‡(
©å
 !
NULL
)

80 
wööfo
->
is›í
 = 
	`d©a_boﬁón
(
	`©åibuã_fú°_d©a
(
©å
));

82 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_wödows
, 
rﬁe
, 
wööfo
);

83 
	}
}

87 
	$≥rsi°í˚_lﬂd_íåy°rög
(
gch¨
 *
rﬁe
, 
xmlNodePå
 
node
)

89 
AâribuãNode
 
©å
;

90 
gch¨
 *
°rög
 = 
NULL
;

93 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "stringvalue");

94 i‡(
©å
 !
NULL
)

95 
°rög
 = 
	`d©a_°rög
(
	`©åibuã_fú°_d©a
(
©å
));

99 i‡(
°rög
 !
NULL
)

100 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_íåy°rögs
, 
rﬁe
, 
°rög
);

101 
	}
}

104 
	$≥rsi°í˚_lﬂd_li°
(
gch¨
 *
rﬁe
, 
xmlNodePå
 
node
)

106 
AâribuãNode
 
©å
;

107 
gch¨
 *
°rög
 = 
NULL
;

110 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "listvalue");

111 i‡(
©å
 !
NULL
)

112 
°rög
 = 
	`d©a_°rög
(
	`©åibuã_fú°_d©a
(
©å
));

116 i‡(
°rög
 !
NULL
) {

117 
gch¨
 **
°rögs
 = 
	`g_°r•lô
(
°rög
, "\n", -1);

118 
Pîsi°ítLi°
 *
∂i°
;

119 
GLi°
 *
li°
 = 
NULL
;

120 
i
;

121 
i
 = 0; 
°rögs
[i] !
NULL
; i++) {

122 
li°
 = 
	`g_li°_≠≥nd
÷i°, 
	`g_°rdup
(
°rögs
[
i
]));

125 
	`g_°r‰ìv
(
°rögs
);

127 
	`g_‰ì
 (
°rög
);

128 
∂i°
 = 
	`g_√w
(
Pîsi°ítLi°
, 1);

129 
∂i°
->
gli°
 = 
li°
;

130 
∂i°
->
rﬁe
 =Ñole;

131 
∂i°
->
s‹ãd
 = 
FALSE
;

132 
∂i°
->
max_membîs
 = 
G_MAXINT
;

133 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_li°s
, 
rﬁe
, 
∂i°
);

135 
	}
}

138 
	$≥rsi°í˚_lﬂd_öãgî
(
gch¨
 *
rﬁe
, 
xmlNodePå
 
node
)

140 
AâribuãNode
 
©å
;

143 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "intvalue");

144 i‡(
©å
 !
NULL
) {

145 
göt
 *
öãgî
 = 
	`g_√w
(gint, 1);

146 *
öãgî
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å
));

147 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_öãgîs
, 
rﬁe
, 
öãgî
);

149 
	}
}

152 
	$≥rsi°í˚_lﬂd_ªÆ
(
gch¨
 *
rﬁe
, 
xmlNodePå
 
node
)

154 
AâribuãNode
 
©å
;

157 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "realvalue");

158 i‡(
©å
 !
NULL
) {

159 
ªÆ
 *
ªÆvÆ
 = 
	`g_√w
(real, 1);

160 *
ªÆvÆ
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

161 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_ªÆs
, 
rﬁe
, 
ªÆvÆ
);

163 
	}
}

166 
	$≥rsi°í˚_lﬂd_boﬁón
(
gch¨
 *
rﬁe
, 
xmlNodePå
 
node
)

168 
AâribuãNode
 
©å
;

171 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "booleanvalue");

172 i‡(
©å
 !
NULL
) {

173 
gboﬁón
 *
boﬁónvÆ
 = 
	`g_√w
(gboolean, 1);

174 *
boﬁónvÆ
 = 
	`d©a_boﬁón
(
	`©åibuã_fú°_d©a
(
©å
));

175 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_boﬁóns
, 
rﬁe
, 
boﬁónvÆ
);

177 
	}
}

180 
	$≥rsi°í˚_lﬂd_°rög
(
gch¨
 *
rﬁe
, 
xmlNodePå
 
node
)

182 
AâribuãNode
 
©å
;

185 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "stringvalue");

186 i‡(
©å
 !
NULL
) {

187 
gch¨
 *
°rögvÆ
 = 
	`d©a_°rög
(
	`©åibuã_fú°_d©a
(
©å
));

188 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_°rögs
, 
rﬁe
, 
°rögvÆ
);

190 
	}
}

193 
	$≥rsi°í˚_lﬂd_cﬁ‹
(
gch¨
 *
rﬁe
, 
xmlNodePå
 
node
)

195 
AâribuãNode
 
©å
;

198 
©å
 = 
	`composôe_föd_©åibuã
(
node
, "colorvalue");

199 i‡(
©å
 !
NULL
) {

200 
Cﬁ‹
 *
cﬁ‹vÆ
 = 
	`g_√w
(Color, 1);

201 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), 
cﬁ‹vÆ
);

202 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_cﬁ‹s
, 
rﬁe
, 
cﬁ‹vÆ
);

204 
	}
}

206 
GHashTabÀ
 *
	gty≥_h™dÀrs
;

212 
	$≥rsi°í˚_lﬂd_ty≥
(
xmlNodePå
 
node
)

214 c⁄° 
gch¨
 *
ty≥«me
 = (gch¨ *Ë
node
->
«me
;

215 
gch¨
 *
«me
;

217 
Pîsi°í˚LﬂdFunc
 
func
 =

218 (
Pîsi°í˚LﬂdFunc
)
	`g_hash_èbÀ_lookup
(
ty≥_h™dÀrs
, 
ty≥«me
);

219 i‡(
func
 =
NULL
) {

223 
«me
 = (
gch¨
 *)
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"role");

224 i‡(
«me
 =
NULL
) {

228 (*
func
)(
«me
, 
node
);

229 
node
 =Çode->
√xt
;

230 
	}
}

233 
	$≥rsi°í˚_£t_ty≥_h™dÀr
(
gch¨
 *
«me
, 
Pîsi°í˚LﬂdFunc
 
func
)

235 i‡(
ty≥_h™dÀrs
 =
NULL
)

236 
ty≥_h™dÀrs
 = 
	`g_hash_èbÀ_√w
(
g_°r_hash
,
g_°r_equÆ
);

238 
	`g_hash_èbÀ_ö£π
(
ty≥_h™dÀrs
, 
«me
, (
gpoöãr
)
func
);

239 
	}
}

242 
	$≥rsi°í˚_öô
()

244 
	`≥rsi°í˚_£t_ty≥_h™dÀr
("wödow", 
≥rsi°í˚_lﬂd_wödow
);

245 
	`≥rsi°í˚_£t_ty≥_h™dÀr
("íåy°rög", 
≥rsi°í˚_lﬂd_íåy°rög
);

246 
	`≥rsi°í˚_£t_ty≥_h™dÀr
("li°", 
≥rsi°í˚_lﬂd_li°
);

247 
	`≥rsi°í˚_£t_ty≥_h™dÀr
("öãgî", 
≥rsi°í˚_lﬂd_öãgî
);

248 
	`≥rsi°í˚_£t_ty≥_h™dÀr
("ªÆ", 
≥rsi°í˚_lﬂd_ªÆ
);

249 
	`≥rsi°í˚_£t_ty≥_h™dÀr
("boﬁón", 
≥rsi°í˚_lﬂd_boﬁón
);

250 
	`≥rsi°í˚_£t_ty≥_h™dÀr
("°rög", 
≥rsi°í˚_lﬂd_°rög
);

251 
	`≥rsi°í˚_£t_ty≥_h™dÀr
("cﬁ‹", 
≥rsi°í˚_lﬂd_cﬁ‹
);

253 i‡(
≥rsi°ít_wödows
 =
NULL
) {

254 
≥rsi°ít_wödows
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

256 i‡(
≥rsi°ít_íåy°rögs
 =
NULL
) {

257 
≥rsi°ít_íåy°rögs
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

259 i‡(
≥rsi°ít_li°s
 =
NULL
) {

260 
≥rsi°ít_li°s
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

262 i‡(
≥rsi°ít_öãgîs
 =
NULL
) {

263 
≥rsi°ít_öãgîs
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

265 i‡(
≥rsi°ít_ªÆs
 =
NULL
) {

266 
≥rsi°ít_ªÆs
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

268 i‡(
≥rsi°ít_boﬁóns
 =
NULL
) {

269 
≥rsi°ít_boﬁóns
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

271 i‡(
≥rsi°ít_°rögs
 =
NULL
) {

272 
≥rsi°ít_°rögs
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

274 i‡(
≥rsi°ít_cﬁ‹s
 =
NULL
) {

275 
≥rsi°ít_cﬁ‹s
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

277 
	}
}

281 
	$≥rsi°í˚_lﬂd
()

283 
xmlDocPå
 
doc
;

284 
gch¨
 *
fûíame
 = 
	`dü_c⁄fig_fûíame
("persistence");

286 
	`≥rsi°í˚_öô
();

288 i‡(!
	`g_fûe_ã°
(
fûíame
, 
G_FILE_TEST_IS_REGULAR
)) {

289 
	`g_‰ì
 (
fûíame
);

292 
doc
 = 
	`xmlDüP¨£Fûe
(
fûíame
);

293 i‡(
doc
 !
NULL
) {

294 i‡(
doc
->
xmlRoŸNode
 !
NULL
) {

295 
xmlNsPå
 
«me•a˚
 = 
	`xmlSórchNs
(
doc
, doc->
xmlRoŸNode
, (c⁄° 
xmlCh¨
 *)"dia");

296 i‡(!
	`xmlSåcmp
 (
doc
->
xmlRoŸNode
->
«me
, (c⁄° 
xmlCh¨
 *)"persistence") &&

297 
«me•a˚
 !
NULL
) {

298 
xmlNodePå
 
chûd_node
 = 
doc
->
xmlRoŸNode
->
chûdªn
;

299 ; 
chûd_node
 !
NULL
; chûd_nodêchûd_node->
√xt
) {

300 
	`≥rsi°í˚_lﬂd_ty≥
(
chûd_node
);

304 
	`xmlFªeDoc
(
doc
);

306 
	`g_‰ì
(
fûíame
);

307 
	}
}

313 
	$≥rsi°í˚_ßve_wödow
(
gpoöãr
 
key
, gpoöã∏
vÆue
, gpoöã∏
d©a
)

315 
xmlNodePå
 
åì
 = (xmlNodePå)
d©a
;

316 
Pîsi°ítWödow
 *
wödow_pos
 = (Pîsi°ítWödow *)
vÆue
;

317 
Obje˘Node
 
wödow
;

319 
wödow
 = (
Obje˘Node
)
	`xmlNewChûd
(
åì
, 
NULL
, (c⁄° 
xmlCh¨
 *)"window", NULL);

321 
	`xmlSëPr›
(
wödow
, (c⁄° 
xmlCh¨
 *)"rﬁe", (xmlCh¨ *Ë
key
);

322 
	`d©a_add_öt
(
	`√w_©åibuã
(
wödow
, "xpos"), 
wödow_pos
->
x
);

323 
	`d©a_add_öt
(
	`√w_©åibuã
(
wödow
, "ypos"), 
wödow_pos
->
y
);

324 
	`d©a_add_öt
(
	`√w_©åibuã
(
wödow
, "width"), 
wödow_pos
->
width
);

325 
	`d©a_add_öt
(
	`√w_©åibuã
(
wödow
, "height"), 
wödow_pos
->
height
);

326 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
wödow
, "is›í"), 
wödow_pos
->
is›í
);

328 
	}
}

332 
	$≥rsi°í˚_ßve_li°
(
gpoöãr
 
key
, gpoöã∏
vÆue
, gpoöã∏
d©a
)

334 
xmlNodePå
 
åì
 = (xmlNodePå)
d©a
;

335 
Obje˘Node
 
li°node
;

336 
GSåög
 *
buf
;

337 
GLi°
 *
ôems
;

339 
li°node
 = (
Obje˘Node
)
	`xmlNewChûd
(
åì
, 
NULL
, (c⁄° 
xmlCh¨
 *)"list", NULL);

341 
	`xmlSëPr›
(
li°node
, (c⁄° 
xmlCh¨
 *)"rﬁe", (xmlCh¨ *Ë
key
);

343 
buf
 = 
	`g_°rög_√w
("");

344 
ôems
 = ((
Pîsi°ítLi°
*)
vÆue
)->
gli°
; iãm†!
NULL
;

345 
ôems
 = 
	`g_li°_√xt
(items)) {

346 
	`g_°rög_≠≥nd
(
buf
, (
gch¨
 *)
ôems
->
d©a
);

347 i‡(
	`g_li°_√xt
(
ôems
Ë!
NULL
)

348 
	`g_°rög_≠≥nd
(
buf
, "\n");

351 
	`d©a_add_°rög
(
	`√w_©åibuã
(
li°node
, "li°vÆue"), 
buf
->
°r
);

352 
	`g_°rög_‰ì
(
buf
, 
TRUE
);

353 
	}
}

356 
	$≥rsi°í˚_ßve_öãgî
(
gpoöãr
 
key
, gpoöã∏
vÆue
, gpoöã∏
d©a
)

358 
xmlNodePå
 
åì
 = (xmlNodePå)
d©a
;

359 
Obje˘Node
 
öãgînode
;

361 
öãgînode
 = (
Obje˘Node
)
	`xmlNewChûd
(
åì
, 
NULL
, (c⁄° 
xmlCh¨
 *)"integer", NULL);

363 
	`xmlSëPr›
(
öãgînode
, (c⁄° 
xmlCh¨
 *)"rﬁe", (xmlCh¨ *)
key
);

364 
	`d©a_add_öt
(
	`√w_©åibuã
(
öãgînode
, "ötvÆue"), *(
göt
 *)
vÆue
);

365 
	}
}

368 
	$≥rsi°í˚_ßve_ªÆ
(
gpoöãr
 
key
, gpoöã∏
vÆue
, gpoöã∏
d©a
)

370 
xmlNodePå
 
åì
 = (xmlNodePå)
d©a
;

371 
Obje˘Node
 
ªÆnode
;

373 
ªÆnode
 = (
Obje˘Node
)
	`xmlNewChûd
(
åì
, 
NULL
, (c⁄° 
xmlCh¨
 *)"real", NULL);

375 
	`xmlSëPr›
(
ªÆnode
, (c⁄° 
xmlCh¨
 *)"rﬁe", (xmlCh¨ *)
key
);

376 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
ªÆnode
, "ªÆvÆue"), *(
ªÆ
 *)
vÆue
);

377 
	}
}

380 
	$≥rsi°í˚_ßve_boﬁón
(
gpoöãr
 
key
, gpoöã∏
vÆue
, gpoöã∏
d©a
)

382 
xmlNodePå
 
åì
 = (xmlNodePå)
d©a
;

383 
Obje˘Node
 
boﬁó¬ode
;

385 
boﬁó¬ode
 = (
Obje˘Node
)
	`xmlNewChûd
(
åì
, 
NULL
, (c⁄° 
xmlCh¨
 *)"boolean", NULL);

387 
	`xmlSëPr›
(
boﬁó¬ode
, (c⁄° 
xmlCh¨
 *)"rﬁe", (xmlCh¨ *)
key
);

388 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
boﬁó¬ode
, "boﬁónvÆue"), *(
gboﬁón
 *)
vÆue
);

389 
	}
}

392 
	$≥rsi°í˚_ßve_°rög
(
gpoöãr
 
key
, gpoöã∏
vÆue
, gpoöã∏
d©a
)

394 
xmlNodePå
 
åì
 = (xmlNodePå)
d©a
;

395 
Obje˘Node
 
°rögnode
;

397 
°rögnode
 = (
Obje˘Node
)
	`xmlNewChûd
(
åì
, 
NULL
, (c⁄° 
xmlCh¨
 *)"string", NULL);

399 
	`xmlSëPr›
(
°rögnode
, (c⁄° 
xmlCh¨
 *)"rﬁe", (xmlCh¨ *)
key
);

400 
	`d©a_add_°rög
(
	`√w_©åibuã
(
°rögnode
, "°rögvÆue"), (
gch¨
 *)
vÆue
);

401 
	}
}

404 
	$≥rsi°í˚_ßve_cﬁ‹
(
gpoöãr
 
key
, gpoöã∏
vÆue
, gpoöã∏
d©a
)

406 
xmlNodePå
 
åì
 = (xmlNodePå)
d©a
;

407 
Obje˘Node
 
cﬁ‹node
;

409 
cﬁ‹node
 = (
Obje˘Node
)
	`xmlNewChûd
(
åì
, 
NULL
, (c⁄° 
xmlCh¨
 *)"color", NULL);

411 
	`xmlSëPr›
(
cﬁ‹node
, (c⁄° 
xmlCh¨
 *)"rﬁe", (xmlCh¨ *)
key
);

412 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
cﬁ‹node
, "cﬁ‹vÆue"), (
Cﬁ‹
 *)
vÆue
);

413 
	}
}

417 
	$≥rsi°í˚_ßve_ty≥
(
xmlDocPå
 
doc
, 
GHashTabÀ
 *
íåõs
, 
GHFunc
 
func
)

419 i‡(
íåõs
 !
NULL
 && 
	`g_hash_èbÀ_size
(entries) != 0) {

420 
	`g_hash_èbÀ_f‹óch
(
íåõs
, 
func
, 
doc
->
xmlRoŸNode
);

422 
	}
}

426 
	$≥rsi°í˚_ßve
()

428 
xmlDocPå
 
doc
;

429 
xmlNs
 *
«me_•a˚
;

430 
gch¨
 *
fûíame
 = 
	`dü_c⁄fig_fûíame
("persistence");

432 
doc
 = 
	`xmlNewDoc
((c⁄° 
xmlCh¨
 *)"1.0");

433 
doc
->
ícodög
 = 
	`xmlSådup
((c⁄° 
xmlCh¨
 *)"UTF-8");

434 
doc
->
xmlRoŸNode
 = 
	`xmlNewDocNode
(doc, 
NULL
, (c⁄° 
xmlCh¨
 *)"persistence", NULL);

436 
«me_•a˚
 = 
	`xmlNewNs
(
doc
->
xmlRoŸNode
,

437 (c⁄° 
xmlCh¨
 *Ë
DIA_XML_NAME_SPACE_BASE
,

438 (c⁄° 
xmlCh¨
 *)"dia");

439 
	`xmlSëNs
(
doc
->
xmlRoŸNode
, 
«me_•a˚
);

441 
	`≥rsi°í˚_ßve_ty≥
(
doc
, 
≥rsi°ít_wödows
, 
≥rsi°í˚_ßve_wödow
);

442 
	`≥rsi°í˚_ßve_ty≥
(
doc
, 
≥rsi°ít_íåy°rögs
, 
≥rsi°í˚_ßve_°rög
);

443 
	`≥rsi°í˚_ßve_ty≥
(
doc
, 
≥rsi°ít_li°s
, 
≥rsi°í˚_ßve_li°
);

444 
	`≥rsi°í˚_ßve_ty≥
(
doc
, 
≥rsi°ít_öãgîs
, 
≥rsi°í˚_ßve_öãgî
);

445 
	`≥rsi°í˚_ßve_ty≥
(
doc
, 
≥rsi°ít_ªÆs
, 
≥rsi°í˚_ßve_ªÆ
);

446 
	`≥rsi°í˚_ßve_ty≥
(
doc
, 
≥rsi°ít_boﬁóns
, 
≥rsi°í˚_ßve_boﬁón
);

447 
	`≥rsi°í˚_ßve_ty≥
(
doc
, 
≥rsi°ít_°rögs
, 
≥rsi°í˚_ßve_°rög
);

448 
	`≥rsi°í˚_ßve_ty≥
(
doc
, 
≥rsi°ít_cﬁ‹s
, 
≥rsi°í˚_ßve_cﬁ‹
);

450 
	`xmlDüSaveFûe
(
fûíame
, 
doc
);

451 
	`g_‰ì
(
fûíame
);

452 
	`xmlFªeDoc
(
doc
);

453 
	}
}

461 c⁄° 
gch¨
 *

462 
	$≥rsi°í˚_gë_wödow_«me
(
GtkWödow
 *
wödow
)

464 c⁄° 
gch¨
 *
«me
 = 
	`gtk_wödow_gë_rﬁe
(
wödow
);

465 i‡(
«me
 =
NULL
) {

466 
	`g_w¨nög
("I¡î«l: Wödow %†ha†nÿrﬁe.", 
	`gtk_wödow_gë_tôÀ
(
wödow
));

467  
NULL
;

469  
«me
;

470 
	}
}

473 
	$≥rsi°í˚_°‹e_wödow_öfo
(
GtkWödow
 *
wödow
, 
Pîsi°ítWödow
 *
wööfo
,

474 
gboﬁón
 
is˛o£d
)

477 i‡(!
is˛o£d
) {

478 
	`gtk_wödow_gë_posôi⁄
(
wödow
, &
wööfo
->
x
, &wööfo->
y
);

479 
	`gtk_wödow_gë_size
(
wödow
, &
wööfo
->
width
, &wööfo->
height
);

480 
wööfo
->
is›í
 = 
TRUE
;

482 
wööfo
->
is›í
 = 
FALSE
;

484 
	}
}

493 
	$≥rsi°í˚_upd©e_wödow
(
GtkWödow
 *
wödow
, 
gboﬁón
 
is˛o£d
)

495 c⁄° 
gch¨
 *
«me
 = 
	`≥rsi°í˚_gë_wödow_«me
(
wödow
);

496 
Pîsi°ítWödow
 *
wööfo
;

498 i‡(
«me
 =
NULL
) ;

500 i‡(
≥rsi°ít_wödows
 =
NULL
) {

501 
≥rsi°ít_wödows
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

503 
wööfo
 = (
Pîsi°ítWödow
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_wödows
, 
«me
);

505 i‡(
wööfo
 !
NULL
) {

506 
	`≥rsi°í˚_°‹e_wödow_öfo
(
wödow
, 
wööfo
, 
is˛o£d
);

508 
wööfo
 = 
	`g_√w0
(
Pîsi°ítWödow
, 1);

509 
	`≥rsi°í˚_°‹e_wödow_öfo
(
wödow
, 
wööfo
, 
FALSE
);

510 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_wödows
, (
gch¨
 *)
«me
, 
wööfo
);

512 i‡(
wööfo
->
wödow
 !
NULL
 && wininfo->window != window) {

513 
	`g_obje˘_uƒef
(
wööfo
->
wödow
);

514 
wööfo
->
wödow
 = 
NULL
;

516 i‡(
wööfo
->
wödow
 =
NULL
) {

517 
wööfo
->
wödow
 = window;

518 
	`g_obje˘_ªf
(
wödow
);

521 
wööfo
->
is›í
 = !
is˛o£d
;

522 
	}
}

531 
gboﬁón


532 
	$≥rsi°í˚_wödow_evít_h™dÀr
(
GtkWödow
 *
wödow
, 
GdkEvít
 *
evít
, 
gpoöãr
 
d©a
)

534 
evít
->
ty≥
) {

535 
GDK_UNMAP
 :

536 
	`dü_log_mesßge
 ("unm≠ (%s)", 
	`≥rsi°í˚_gë_wödow_«me
(
wödow
));

538 
GDK_MAP
 :

539 
	`dü_log_mesßge
 ("m≠ (%s)", 
	`≥rsi°í˚_gë_wödow_«me
(
wödow
));

541 
GDK_CONFIGURE
 :

542 
	`dü_log_mesßge
 ("c⁄figuª (%s)", 
	`≥rsi°í˚_gë_wödow_«me
(
wödow
));

545 
	`≥rsi°í˚_upd©e_wödow
(
wödow
, !(
	`GTK_WIDGET_MAPPED
(window)));

547  
FALSE
;

548 
	}
}

555 
gboﬁón


556 
	$≥rsi°í˚_hide_show_wödow
(
GtkWödow
 *
wödow
, 
gpoöãr
 
d©a
)

558 
	`≥rsi°í˚_upd©e_wödow
(
wödow
, !
	`GTK_WIDGET_MAPPED
(window));

559  
FALSE
;

560 
	}
}

567 
gboﬁón


568 
	$wööfo_ö_ønge
 (c⁄° 
Pîsi°ítWödow
 *
wööfo
)

570 
GdkS¸ìn
 *
s¸ìn
 = 
	`gdk_s¸ìn_gë_deÁu…
 ();

571 
göt
 
num_m⁄ô‹s
 = 
	`gdk_s¸ìn_gë_n_m⁄ô‹s
 (
s¸ìn
), 
i
;

572 
GdkRe˘™gÀ
 
rwö
 = {
wööfo
->
x
, wööfo->
y
, wööfo->
width
, wööfo->
height
};

573 
GdkRe˘™gÀ
 
ºes
 = {0, 0, 0, 0};

575 
i
 = 0; i < 
num_m⁄ô‹s
; ++i) {

576 
GdkRe˘™gÀ
 
rm⁄
;

578 
	`gdk_s¸ìn_gë_m⁄ô‹_geomëry
 (
s¸ìn
, 
i
, &
rm⁄
);

580 
	`gdk_ª˘™gÀ_öãr£˘
 (&
rwö
, &
rm⁄
, &
ºes
);

581 i‡(
ºes
.
width
 *Ñªs.
height
 > 0)

585  (
ºes
.
width
 *Ñªs.
height
 > 0);

586 
	}
}

592 
	$≥rsi°í˚_ªgi°î_wödow
(
GtkWödow
 *
wödow
)

594 c⁄° 
gch¨
 *
«me
 = 
	`≥rsi°í˚_gë_wödow_«me
(
wödow
);

595 
Pîsi°ítWödow
 *
wööfo
;

597 i‡(
«me
 =
NULL
) ;

598 i‡(
≥rsi°ít_wödows
 =
NULL
) {

599 
≥rsi°ít_wödows
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

601 
wööfo
 = (
Pîsi°ítWödow
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_wödows
, 
«me
);

602 i‡(
wööfo
 !
NULL
) {

603 i‡(
	`wööfo_ö_ønge
 (
wööfo
)) {

605 
	`gtk_wödow_move
(
wödow
, 
wööfo
->
x
, wööfo->
y
);

606 
	`gtk_wödow_ªsize
(
wödow
, 
wööfo
->
width
, wööfo->
height
);

608 i‡(
wööfo
->
is›í
Ë
	`gtk_widgë_show
(
	`GTK_WIDGET
(
wödow
));

610 
wööfo
 = 
	`g_√w0
(
Pîsi°ítWödow
, 1);

611 
	`gtk_wödow_gë_posôi⁄
(
wödow
, &
wööfo
->
x
, &wööfo->
y
);

612 
	`gtk_wödow_gë_size
(
wödow
, &
wööfo
->
width
, &wööfo->
height
);

614 
wööfo
->
is›í
 = 
	`GTK_WIDGET_DRAWABLE
(
	`GTK_WIDGET
(
wödow
));

615 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_wödows
, (
gch¨
 *)
«me
, 
wööfo
);

617 i‡(
wööfo
->
wödow
 !
NULL
 && wininfo->window != window) {

618 
	`g_obje˘_uƒef
(
wööfo
->
wödow
);

619 
wööfo
->
wödow
 = 
NULL
;

621 i‡(
wööfo
->
wödow
 =
NULL
) {

622 
wööfo
->
wödow
 = window;

623 
	`g_obje˘_ªf
(
wödow
);

626 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
wödow
), "configure-event",

627 
	`G_CALLBACK
(
≥rsi°í˚_wödow_evít_h™dÀr
), 
NULL
);

628 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
wödow
), "map-event",

629 
	`G_CALLBACK
(
≥rsi°í˚_wödow_evít_h™dÀr
), 
NULL
);

630 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
wödow
), "unmap-event",

631 
	`G_CALLBACK
(
≥rsi°í˚_wödow_evít_h™dÀr
), 
NULL
);

633 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
wödow
), "hide",

634 
	`G_CALLBACK
(
≥rsi°í˚_hide_show_wödow
), 
NULL
);

635 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
wödow
), "show",

636 
	`G_CALLBACK
(
≥rsi°í˚_hide_show_wödow
), 
NULL
);

637 
	}
}

649 
	$≥rsi°í˚_ªgi°î_wödow_¸óã
(
gch¨
 *
rﬁe
, 
NuŒ¨yFunc
 *
func
)

651 
Pîsi°ítWödow
 *
wööfo
;

653 i‡(
rﬁe
 =
NULL
) ;

654 i‡(
≥rsi°ít_wödows
 =
NULL
) ;

655 
wööfo
 = (
Pîsi°ítWödow
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_wödows
, 
rﬁe
);

656 i‡(
wööfo
 !
NULL
) {

657 (*
func
)();

659 
	}
}

664 
gboﬁón


665 
	$≥rsi°í˚_upd©e_°rög_íåy
(
GtkWidgë
 *
widgë
, 
GdkEvít
 *
evít
,

666 
gpoöãr
 
u£rd©a
)

668 
gch¨
 *
rﬁe
 = (gch¨*)
u£rd©a
;

670 i‡(
evít
->
ty≥
 =
GDK_FOCUS_CHANGE
) {

671 
gch¨
 *
°rög
 = (gch¨ *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_íåy°rögs
, 
rﬁe
);

672 c⁄° 
gch¨
 *
íåy°rög
 = 
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
widgë
));

673 i‡(
°rög
 =
NULL
 || 
	`°rcmp
(°rög, 
íåy°rög
) != 0) {

674 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_íåy°rögs
, 
rﬁe
, 
	`g_°rdup
(
íåy°rög
));

678  
FALSE
;

679 
	}
}

686 
gboﬁón


687 
	$≥rsi°í˚_ch™ge_°rög_íåy
(
gch¨
 *
rﬁe
, gch¨ *
°rög
,

688 
GtkWidgë
 *
widgë
)

690 
gch¨
 *
ﬁd_°rög
 = (gch¨*)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_íåy°rögs
, 
rﬁe
);

691 i‡(
ﬁd_°rög
 !
NULL
) {

692 i‡(
widgë
 !
NULL
) {

693 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
widgë
), 
°rög
);

695 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_íåy°rögs
, 
rﬁe
, 
	`g_°rdup
(
°rög
));

698  
FALSE
;

699 
	}
}

706 
	$≥rsi°í˚_ªgi°î_°rög_íåy
(
gch¨
 *
rﬁe
, 
GtkWidgë
 *
íåy
)

708 
gch¨
 *
°rög
;

709 i‡(
rﬁe
 =
NULL
) ;

710 i‡(
≥rsi°ít_íåy°rögs
 =
NULL
) {

711 
≥rsi°ít_íåy°rögs
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

713 
°rög
 = (
gch¨
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_íåy°rögs
, 
rﬁe
);

714 i‡(
°rög
 !
NULL
) {

715 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
íåy
), 
°rög
);

717 
°rög
 = 
	`g_°rdup
(
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
íåy
)));

718 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_íåy°rögs
, 
rﬁe
, 
°rög
);

720 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
íåy
), "event",

721 
	`G_CALLBACK
(
≥rsi°í˚_upd©e_°rög_íåy
), 
rﬁe
);

722 
	}
}

731 
Pîsi°ítLi°
 *

732 
	$≥rsi°í˚_ªgi°î_li°
(c⁄° 
gch¨
 *
rﬁe
)

734 
Pîsi°ítLi°
 *
li°
;

735 i‡(
rﬁe
 =
NULL
)  NULL;

736 i‡(
≥rsi°ít_li°s
 =
NULL
) {

737 
≥rsi°ít_li°s
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

739 
li°
 = (
Pîsi°ítLi°
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_li°s
, 
rﬁe
);

740 i‡(
li°
 !
NULL
) {

741  
li°
;

744 
li°
 = 
	`g_√w
(
Pîsi°ítLi°
, 1);

745 
li°
->
rﬁe
 =Ñole;

746 
li°
->
gli°
 = 
NULL
;

747 
li°
->
s‹ãd
 = 
FALSE
;

748 
li°
->
max_membîs
 = 
G_MAXINT
;

749 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_li°s
, (
gch¨
 *)
rﬁe
, 
li°
);

750  
li°
;

751 
	}
}

753 
Pîsi°ítLi°
 *

754 
	$≥rsi°ít_li°_gë
(c⁄° 
gch¨
 *
rﬁe
)

756 
Pîsi°ítLi°
 *
li°
;

757 i‡(
rﬁe
 =
NULL
)  NULL;

758 i‡(
≥rsi°ít_li°s
 !
NULL
) {

759 
li°
 = (
Pîsi°ítLi°
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_li°s
, 
rﬁe
);

760 i‡(
li°
 !
NULL
) {

761  
li°
;

765  
NULL
;

766 
	}
}

768 
GLi°
 *

769 
	$≥rsi°ít_li°_gë_gli°
(c⁄° 
gch¨
 *
rﬁe
)

771 
Pîsi°ítLi°
 *
∂i°
 = 
	`≥rsi°ít_li°_gë
(
rﬁe
);

772 i‡(
∂i°
 =
NULL
)  NULL;

773  
∂i°
->
gli°
;

774 
	}
}

776 
GLi°
 *

777 
	$≥rsi°ít_li°_cut_Àngth
(
GLi°
 *
li°
, 
guöt
 
Àngth
)

779 
	`g_li°_Àngth
(
li°
Ë> 
Àngth
) {

780 
GLi°
 *
œ°
 = 
	`g_li°_œ°
(
li°
);

782 
li°
 = 
	`g_li°_ªmove_lök
÷i°, 
œ°
);

783 
	`g_li°_‰ì
(
œ°
);

785  
li°
;

786 
	}
}

793 
gboﬁón


794 
	$≥rsi°ít_li°_add
(c⁄° 
gch¨
 *
rﬁe
, c⁄° gch¨ *
ôem
)

796 
Pîsi°ítLi°
 *
∂i°
 = 
	`≥rsi°ít_li°_gë
(
rﬁe
);

797 if(
∂i°
 =
NULL
) {

798 
	`g_w¨nög
("C™'àfödÜi° f‹ %†whíáddög %s", 
rﬁe
, 
ôem
);

799  
TRUE
;

801 i‡(
∂i°
->
s‹ãd
) {

803  
TRUE
;

805 
gboﬁón
 
exi°ed
 = 
FALSE
;

806 
GLi°
 *
tm∂i°
 = 
∂i°
->
gli°
;

807 
GLi°
 *
ﬁd_ñem
 = 
	`g_li°_föd_cu°om
(
tm∂i°
, 
ôem
, (
GCom∑ªFunc
)
g_ascii_°rˇ£cmp
);

808 
ﬁd_ñem
 !
NULL
) {

809 
tm∂i°
 = 
	`g_li°_ªmove_lök
—m∂i°, 
ﬁd_ñem
);

815 
	`g_li°_‰ì_1
(
ﬁd_ñem
);

816 
ﬁd_ñem
 = 
	`g_li°_föd_cu°om
(
tm∂i°
, 
ôem
, (
GCom∑ªFunc
)
g_ascii_°rˇ£cmp
);

817 
exi°ed
 = 
TRUE
;

819 
tm∂i°
 = 
	`g_li°_¥ïíd
—m∂i°, 
	`g_°rdup
(
ôem
));

820 
tm∂i°
 = 
	`≥rsi°ít_li°_cut_Àngth
—m∂i°, 
∂i°
->
max_membîs
);

821 
∂i°
->
gli°
 = 
tm∂i°
;

822  
exi°ed
;

824 
	}
}

827 
	$≥rsi°ít_li°_£t_max_Àngth
(c⁄° 
gch¨
 *
rﬁe
, 
göt
 
max
)

829 
Pîsi°ítLi°
 *
∂i°
 = 
	`≥rsi°ít_li°_gë
(
rﬁe
);

830 
∂i°
->
max_membîs
 = 
max
;

831 
∂i°
->
gli°
 = 
	`≥rsi°ít_li°_cut_Àngth
’li°->gli°, 
max
);

832 
	}
}

839 
gboﬁón


840 
	$≥rsi°ít_li°_ªmove
(c⁄° 
gch¨
 *
rﬁe
, c⁄° gch¨ *
ôem
)

842 
Pîsi°ítLi°
 *
∂i°
 = 
	`≥rsi°ít_li°_gë
(
rﬁe
);

844 
GLi°
 *
íåy
 = 
	`g_li°_föd_cu°om
(
∂i°
->
gli°
, 
ôem
, (
GCom∑ªFunc
)
g_ascii_°rˇ£cmp
);

845 i‡(
íåy
 !
NULL
) {

846 
∂i°
->
gli°
 = 
	`g_li°_ªmove_lök
’li°->gli°, 
íåy
);

847 
	`g_‰ì
(
íåy
->
d©a
);

848  
TRUE
;

849 }  
FALSE
;

850 
	}
}

853 
	$≥rsi°ít_li°_ªmove_Æl
(c⁄° 
gch¨
 *
rﬁe
)

855 
Pîsi°ítLi°
 *
∂i°
 = 
	`≥rsi°ít_li°_gë
(
rﬁe
);

856 
	`≥rsi°ít_li°_cut_Àngth
(
∂i°
->
gli°
, 0);

857 
∂i°
->
gli°
 = 
NULL
;

858 
	}
}

861 
Pîsi°í˚CÆlback
 
	mfunc
;

862 
GObje˘
 *
	mw©ch
;

863 
gpoöãr
 
	mu£rd©a
;

864 } 
	tLi°íîD©a
;

874 
	$≥rsi°ít_li°_add_li°íî
(c⁄° 
gch¨
 *
rﬁe
, 
Pîsi°í˚CÆlback
 
func
,

875 
GObje˘
 *
w©ch
, 
gpoöãr
 
u£rd©a
)

877 
Pîsi°ítLi°
 *
∂i°
 = 
	`≥rsi°ít_li°_gë
(
rﬁe
);

878 
Li°íîD©a
 *
li°íî
;

880 i‡(
∂i°
 !
NULL
) {

881 
li°íî
 = 
	`g_√w
(
Li°íîD©a
, 1);

882 
li°íî
->
func
 = func;

883 
li°íî
->
w©ch
 = watch;

884 
	`g_obje˘_add_wók_poöãr
(
w©ch
, (
gpoöãr
)&
li°íî
->watch);

885 
li°íî
->
u£rd©a
 = userdata;

886 
∂i°
->
li°íîs
 = 
	`g_li°_≠≥nd
’li°->li°íîs, 
li°íî
);

888 
	}
}

891 
göt


892 
	$≥rsi°í˚_ªgi°î_öãgî
(
gch¨
 *
rﬁe
, 
deÁu…vÆue
)

894 
göt
 *
öãgî
;

895 i‡(
rﬁe
 =
NULL
)  0;

896 i‡(
≥rsi°ít_öãgîs
 =
NULL
) {

897 
≥rsi°ít_öãgîs
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

899 
öãgî
 = (
göt
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_öãgîs
, 
rﬁe
);

900 i‡(
öãgî
 =
NULL
) {

901 
öãgî
 = 
	`g_√w
(
göt
, 1);

902 *
öãgî
 = 
deÁu…vÆue
;

903 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_öãgîs
, 
rﬁe
, 
öãgî
);

905  *
öãgî
;

906 
	}
}

908 
göt


909 
	$≥rsi°í˚_gë_öãgî
(
gch¨
 *
rﬁe
)

911 
göt
 *
öãgî
;

912 i‡(
≥rsi°ít_öãgîs
 =
NULL
) {

913 
	`g_w¨nög
("Nÿ≥rsi°íàöãgî†tÿgë f‹ %s!", 
rﬁe
);

916 
öãgî
 = (
göt
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_öãgîs
, 
rﬁe
);

917 i‡(
öãgî
 !
NULL
)  *integer;

918 
	`g_w¨nög
("NÿöãgîÅÿgë f‹ %s", 
rﬁe
);

920 
	}
}

923 
	$≥rsi°í˚_£t_öãgî
(
gch¨
 *
rﬁe
, 
göt
 
√wvÆue
)

925 
göt
 *
öãgî
;

926 i‡(
≥rsi°ít_öãgîs
 =
NULL
) {

927 
	`g_w¨nög
("Nÿ≥rsi°íàöãgî†yë f‹ %s!", 
rﬁe
);

930 
öãgî
 = (
göt
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_öãgîs
, 
rﬁe
);

931 i‡(
öãgî
 !
NULL
)

932 *
öãgî
 = 
√wvÆue
;

934 
	`g_w¨nög
("NÿöãgîÅÿ£àf‹ %s", 
rﬁe
);

935 
	}
}

938 
ªÆ


939 
	$≥rsi°í˚_ªgi°î_ªÆ
(
gch¨
 *
rﬁe
, 
ªÆ
 
deÁu…vÆue
)

941 
ªÆ
 *
ªÆvÆ
;

942 i‡(
rﬁe
 =
NULL
)  0;

943 i‡(
≥rsi°ít_ªÆs
 =
NULL
) {

944 
≥rsi°ít_ªÆs
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

946 
ªÆvÆ
 = (
ªÆ
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_ªÆs
, 
rﬁe
);

947 i‡(
ªÆvÆ
 =
NULL
) {

948 
ªÆvÆ
 = 
	`g_√w
(
ªÆ
, 1);

949 *
ªÆvÆ
 = 
deÁu…vÆue
;

950 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_ªÆs
, 
rﬁe
, 
ªÆvÆ
);

952  *
ªÆvÆ
;

953 
	}
}

955 
ªÆ


956 
	$≥rsi°í˚_gë_ªÆ
(
gch¨
 *
rﬁe
)

958 
ªÆ
 *
ªÆvÆ
;

959 i‡(
≥rsi°ít_ªÆs
 =
NULL
) {

960 
	`g_w¨nög
("Nÿ≥rsi°íàªÆ†tÿgë f‹ %s!", 
rﬁe
);

963 
ªÆvÆ
 = (
ªÆ
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_ªÆs
, 
rﬁe
);

964 i‡(
ªÆvÆ
 !
NULL
)  *realval;

965 
	`g_w¨nög
("NÿªÆÅÿgë f‹ %s", 
rﬁe
);

967 
	}
}

970 
	$≥rsi°í˚_£t_ªÆ
(
gch¨
 *
rﬁe
, 
ªÆ
 
√wvÆue
)

972 
ªÆ
 *
ªÆvÆ
;

973 i‡(
≥rsi°ít_ªÆs
 =
NULL
) {

974 
	`g_w¨nög
("Nÿ≥rsi°íàªÆ†yë f‹ %s!", 
rﬁe
);

977 
ªÆvÆ
 = (
ªÆ
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_ªÆs
, 
rﬁe
);

978 i‡(
ªÆvÆ
 !
NULL
)

979 *
ªÆvÆ
 = 
√wvÆue
;

981 
	`g_w¨nög
("NÿªÆÅÿ£àf‹ %s", 
rﬁe
);

982 
	}
}

987 
gboﬁón


988 
	$≥rsi°í˚_boﬁón_is_ªgi°îed
(c⁄° 
gch¨
 *
rﬁe
)

990 
gboﬁón
 *
boﬁónvÆ
;

991 i‡(
rﬁe
 =
NULL
)  0;

992 i‡(
≥rsi°ít_boﬁóns
 =
NULL
) {

993 
≥rsi°ít_boﬁóns
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

995 
boﬁónvÆ
 = (
gboﬁón
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_boﬁóns
, 
rﬁe
);

996  
boﬁónvÆ
 !
NULL
;

997 
	}
}

999 
gboﬁón


1000 
	$≥rsi°í˚_ªgi°î_boﬁón
(c⁄° 
gch¨
 *
rﬁe
, 
gboﬁón
 
deÁu…vÆue
)

1002 
gboﬁón
 *
boﬁónvÆ
;

1003 i‡(
rﬁe
 =
NULL
)  0;

1004 i‡(
≥rsi°ít_boﬁóns
 =
NULL
) {

1005 
≥rsi°ít_boﬁóns
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

1007 
boﬁónvÆ
 = (
gboﬁón
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_boﬁóns
, 
rﬁe
);

1008 i‡(
boﬁónvÆ
 =
NULL
) {

1009 
boﬁónvÆ
 = 
	`g_√w
(
gboﬁón
, 1);

1010 *
boﬁónvÆ
 = 
deÁu…vÆue
;

1011 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_boﬁóns
, 
rﬁe
, 
boﬁónvÆ
);

1013  *
boﬁónvÆ
;

1014 
	}
}

1016 
gboﬁón


1017 
	$≥rsi°í˚_gë_boﬁón
(c⁄° 
gch¨
 *
rﬁe
)

1019 
gboﬁón
 *
boﬁónvÆ
;

1020 i‡(
≥rsi°ít_boﬁóns
 =
NULL
) {

1021 
	`g_w¨nög
("Nÿ≥rsi°íàboﬁón†tÿgë f‹ %s!", 
rﬁe
);

1022  
FALSE
;

1024 
boﬁónvÆ
 = (
gboﬁón
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_boﬁóns
, 
rﬁe
);

1025 i‡(
boﬁónvÆ
 !
NULL
)  *booleanval;

1026 
	`g_w¨nög
("Nÿboﬁó¿tÿgë f‹ %s", 
rﬁe
);

1027  
FALSE
;

1028 
	}
}

1031 
	$≥rsi°í˚_£t_boﬁón
(c⁄° 
gch¨
 *
rﬁe
, 
gboﬁón
 
√wvÆue
)

1033 
gboﬁón
 *
boﬁónvÆ
;

1034 i‡(
≥rsi°ít_boﬁóns
 =
NULL
) {

1035 
	`g_w¨nög
("Nÿ≥rsi°íàboﬁón†yë f‹ %s!", 
rﬁe
);

1038 
boﬁónvÆ
 = (
gboﬁón
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_boﬁóns
, 
rﬁe
);

1039 i‡(
boﬁónvÆ
 !
NULL
)

1040 *
boﬁónvÆ
 = 
√wvÆue
;

1042 
	`g_w¨nög
("Nÿboﬁó¿tÿ£àf‹ %s", 
rﬁe
);

1043 
	}
}

1054 
gch¨
 *

1055 
	$≥rsi°í˚_ªgi°î_°rög
(
gch¨
 *
rﬁe
, gch¨ *
deÁu…vÆue
)

1057 
gch¨
 *
°rögvÆ
;

1058 i‡(
rﬁe
 =
NULL
)  0;

1059 i‡(
≥rsi°ít_°rögs
 =
NULL
) {

1060 
≥rsi°ít_°rögs
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

1062 
°rögvÆ
 = (
gch¨
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_°rögs
, 
rﬁe
);

1063 i‡(
°rögvÆ
 =
NULL
) {

1064 
°rögvÆ
 = 
	`g_°rdup
(
deÁu…vÆue
);

1065 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_°rögs
, 
rﬁe
, 
°rögvÆ
);

1067  
	`g_°rdup
(
°rögvÆ
);

1068 
	}
}

1070 
gch¨
 *

1071 
	$≥rsi°í˚_gë_°rög
(
gch¨
 *
rﬁe
)

1073 
gch¨
 *
°rögvÆ
;

1074 i‡(
≥rsi°ít_°rögs
 =
NULL
) {

1075 
	`g_w¨nög
("Nÿ≥rsi°íà°rög†tÿgë f‹ %s!", 
rﬁe
);

1076  
NULL
;

1078 
°rögvÆ
 = (
gch¨
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_°rögs
, 
rﬁe
);

1079 i‡(
°rögvÆ
 !
NULL
Ë 
	`g_°rdup
(stringval);

1080 
	`g_w¨nög
("Nÿ°rögÅÿgë f‹ %s", 
rﬁe
);

1081  
NULL
;

1082 
	}
}

1085 
	$≥rsi°í˚_£t_°rög
(
gch¨
 *
rﬁe
, c⁄° gch¨ *
√wvÆue
)

1087 
gch¨
 *
°rögvÆ
;

1088 i‡(
≥rsi°ít_°rögs
 =
NULL
) {

1089 
	`g_w¨nög
("Nÿ≥rsi°íà°rög†yë f‹ %s!", 
rﬁe
);

1092 
°rögvÆ
 = (
gch¨
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_°rögs
, 
rﬁe
);

1093 i‡(
°rögvÆ
 !
NULL
) {

1094 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_°rögs
, 
rﬁe
, 
	`g_°rdup
(
√wvÆue
));

1096 
	`g_hash_èbÀ_ªmove
(
≥rsi°ít_°rögs
, 
rﬁe
);

1098 
	}
}

1103 
Cﬁ‹
 *

1104 
	$≥rsi°í˚_ªgi°î_cﬁ‹
(
gch¨
 *
rﬁe
, 
Cﬁ‹
 *
deÁu…vÆue
)

1106 
Cﬁ‹
 *
cﬁ‹vÆ
;

1107 i‡(
rﬁe
 =
NULL
)  0;

1108 i‡(
≥rsi°ít_cﬁ‹s
 =
NULL
) {

1109 
≥rsi°ít_cﬁ‹s
 = 
	`_dü_hash_èbÀ_°r_™y_√w
();

1111 
cﬁ‹vÆ
 = (
Cﬁ‹
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_cﬁ‹s
, 
rﬁe
);

1112 i‡(
cﬁ‹vÆ
 =
NULL
) {

1113 
cﬁ‹vÆ
 = 
	`g_√w
(
Cﬁ‹
, 1);

1114 *
cﬁ‹vÆ
 = *
deÁu…vÆue
;

1115 
	`g_hash_èbÀ_ö£π
(
≥rsi°ít_cﬁ‹s
, 
rﬁe
, 
cﬁ‹vÆ
);

1117  
cﬁ‹vÆ
;

1118 
	}
}

1120 
Cﬁ‹
 *

1121 
	$≥rsi°í˚_gë_cﬁ‹
(
gch¨
 *
rﬁe
)

1123 
Cﬁ‹
 *
cﬁ‹vÆ
;

1124 i‡(
≥rsi°ít_cﬁ‹s
 =
NULL
) {

1125 
	`g_w¨nög
("Nÿ≥rsi°íàcﬁ‹†tÿgë f‹ %s!", 
rﬁe
);

1128 
cﬁ‹vÆ
 = (
Cﬁ‹
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_cﬁ‹s
, 
rﬁe
);

1129 i‡(
cﬁ‹vÆ
 !
NULL
)  colorval;

1130 
	`g_w¨nög
("Nÿcﬁ‹Åÿgë f‹ %s", 
rﬁe
);

1132 
	}
}

1135 
	$≥rsi°í˚_£t_cﬁ‹
(
gch¨
 *
rﬁe
, 
Cﬁ‹
 *
√wvÆue
)

1137 
Cﬁ‹
 *
cﬁ‹vÆ
;

1138 i‡(
≥rsi°ít_cﬁ‹s
 =
NULL
) {

1139 
	`g_w¨nög
("Nÿ≥rsi°íàcﬁ‹†yë f‹ %s!", 
rﬁe
);

1142 
cﬁ‹vÆ
 = (
Cﬁ‹
 *)
	`g_hash_èbÀ_lookup
(
≥rsi°ít_cﬁ‹s
, 
rﬁe
);

1143 i‡(
cﬁ‹vÆ
 !
NULL
)

1144 *
cﬁ‹vÆ
 = *
√wvÆue
;

1146 
	`g_w¨nög
("Nÿcﬁ‹Åÿ£àf‹ %s", 
rﬁe
);

1147 
	}
}

	@O:\tool\dvs50\lib\persistence.h

22 #i‚de‡
PERSISTENCE_H


23 
	#PERSISTENCE_H


	)

24 
	~"c⁄fig.h
"

25 
	~"geomëry.h
"

27 
	~<gtk/gtk.h
>

30 
	mx
, 
	my
;

31 
	mwidth
, 
	mheight
;

32 
gboﬁón
 
	mis›í
;

33 
GtkWödow
 *
	mwödow
;

34 } 
	tPîsi°ítWödow
;

36 (
	gNuŒ¨yFunc
)();

38 
DIAVAR
 
≥rsi°í˚_lﬂd
();

39 
DIAVAR
 
≥rsi°í˚_ßve
();

40 
DIAVAR
 
≥rsi°í˚_ªgi°î_wödow
(
GtkWödow
 *
wödow
);

41 
DIAVAR
 
≥rsi°í˚_ªgi°î_wödow_¸óã
(
gch¨
 *
rﬁe
, 
NuŒ¨yFunc
 *
func
);

42 
DIAVAR
 
≥rsi°í˚_ªgi°î_°rög_íåy
(
gch¨
 *
rﬁe
, 
GtkWidgë
 *
íåy
);

43 
DIAVAR
 
gboﬁón
 
≥rsi°í˚_ch™ge_°rög_íåy
(
gch¨
 *
rﬁe
, gch¨ *
°rög
,

44 
GtkWidgë
 *
widgë
);

53 
	s_Pîsi°ítLi°
 {

54 c⁄° 
gch¨
 *
	mrﬁe
;

55 
gboﬁón
 
	ms‹ãd
;

56 
göt
 
	mmax_membîs
;

57 
GLi°
 *
	mgli°
;

58 
GLi°
 *
	mli°íîs
;

59 } 
	tPîsi°ítLi°
;

61 (*
	tPîsi°í˚CÆlback
)(
	tGObje˘
 *, 
	tgpoöãr
);

63 
DIAVAR
 
Pîsi°ítLi°
 *
	`≥rsi°í˚_ªgi°î_li°
(c⁄° 
gch¨
 *
rﬁe
);

64 
DIAVAR
 
Pîsi°ítLi°
 *
	`≥rsi°ít_li°_gë
(c⁄° 
gch¨
 *
rﬁe
);

65 
DIAVAR
 
GLi°
 *
	`≥rsi°ít_li°_gë_gli°
(c⁄° 
gch¨
 *
rﬁe
);

66 
DIAVAR
 
gboﬁón
 
	`≥rsi°ít_li°_add
(c⁄° 
gch¨
 *
rﬁe
, c⁄° gch¨ *
ôem
);

67 
DIAVAR
 
	`≥rsi°ít_li°_£t_max_Àngth
(c⁄° 
gch¨
 *
rﬁe
, 
göt
 
max
);

68 
DIAVAR
 
gboﬁón
 
	`≥rsi°ít_li°_ªmove
(c⁄° 
gch¨
 *
rﬁe
, c⁄° gch¨ *
ôem
);

69 
DIAVAR
 
	`≥rsi°ít_li°_ªmove_Æl
(c⁄° 
gch¨
 *
rﬁe
);

70 
	`≥rsi°ít_li°_add_li°íî
(c⁄° 
gch¨
 *
rﬁe
, 
Pîsi°í˚CÆlback
 
func
,

71 
GObje˘
 *
w©ch
, 
gpoöãr
 
u£rd©a
);

73 
DIAVAR
 
gboﬁón
 
	`≥rsi°í˚_is_ªgi°îed
(
gch¨
 *
rﬁe
);

75 
DIAVAR
 
göt
 
	`≥rsi°í˚_ªgi°î_öãgî
(
gch¨
 *
rﬁe
, 
deÁu…vÆue
);

76 
DIAVAR
 
göt
 
	`≥rsi°í˚_gë_öãgî
(
gch¨
 *
rﬁe
);

77 
DIAVAR
 
	`≥rsi°í˚_£t_öãgî
(
gch¨
 *
rﬁe
, 
göt
 
√wvÆue
);

79 
DIAVAR
 
ªÆ
 
	`≥rsi°í˚_ªgi°î_ªÆ
(
gch¨
 *
rﬁe
,Ñó»
deÁu…vÆue
);

80 
DIAVAR
 
ªÆ
 
	`≥rsi°í˚_gë_ªÆ
(
gch¨
 *
rﬁe
);

81 
DIAVAR
 
	`≥rsi°í˚_£t_ªÆ
(
gch¨
 *
rﬁe
, 
ªÆ
 
√wvÆue
);

83 
gboﬁón
 
	`≥rsi°í˚_boﬁón_is_ªgi°îed
(c⁄° 
gch¨
 *
rﬁe
);

84 
DIAVAR
 
gboﬁón
 
	`≥rsi°í˚_ªgi°î_boﬁón
(c⁄° 
gch¨
 *
rﬁe
, gboﬁó¿
deÁu…vÆue
);

85 
gboﬁón
 
	`≥rsi°í˚_gë_boﬁón
(c⁄° 
gch¨
 *
rﬁe
);

86 
DIAVAR
 
	`≥rsi°í˚_£t_boﬁón
(c⁄° 
gch¨
 *
rﬁe
, 
gboﬁón
 
√wvÆue
);

88 
DIAVAR
 
gch¨
 *
	`≥rsi°í˚_ªgi°î_°rög
(gch¨ *
rﬁe
, gch¨ *
deÁu…vÆue
);

89 
DIAVAR
 
gch¨
 *
	`≥rsi°í˚_gë_°rög
(gch¨ *
rﬁe
);

90 
DIAVAR
 
	`≥rsi°í˚_£t_°rög
(
gch¨
 *
rﬁe
, c⁄° gch¨ *
√wvÆue
);

92 
DIAVAR
 
Cﬁ‹
 *
	`≥rsi°í˚_ªgi°î_cﬁ‹
(
gch¨
 *
rﬁe
, Cﬁ‹ *
deÁu…vÆue
);

93 
Cﬁ‹
 *
	`≥rsi°í˚_gë_cﬁ‹
(
gch¨
 *
rﬁe
);

94 
DIAVAR
 
	`≥rsi°í˚_£t_cﬁ‹
(
gch¨
 *
rﬁe
, 
Cﬁ‹
 *
√wvÆue
);

	@O:\tool\dvs50\lib\plug-ins.c

22 
	~<c⁄fig.h
>

24 
	~<°dlib.h
>

25 
	~<°rög.h
>

26 
	~<î∫o.h
>

27 
	~<sys/ty≥s.h
>

28 
	~<sys/°©.h
>

29 
	~<f˙é.h
>

30 #ifde‡
HAVE_UNISTD_H


31 
	~<uni°d.h
>

34 
	~<libxml/xmlmem‹y.h
>

35 
	~<libxml/∑r£r.h
>

36 
	~<libxml/åì.h
>

37 
	~"dü_xml_libxml.h
"

38 
	~"dü_xml.h
"

40 
	~"∂ug-ös.h
"

41 
	~"öé.h
"

42 
	~"mesßge.h
"

43 
	~"dü_dús.h
"

44 
	~"obje˘.h
"

46 #ifde‡
G_OS_WIN32


47 
	#Re˘™gÀ
 
Wö32Re˘™gÀ


	)

48 
	#WIN32_LEAN_AND_MEAN


	)

49 
	~<∑ngo/∑ngowö32.h
>

50 #unde‡
Re˘™gÀ


55 
	s_PlugöInfo
 {

56 
GModuÀ
 *
	mmoduÀ
;

57 
gch¨
 *
	mfûíame
;

59 
gboﬁón
 
	mis_lﬂded
;

60 
gboﬁón
 
	möhibô_lﬂd
;

62 
gch¨
 *
	m«me
;

63 
gch¨
 *
	mdes¸ùti⁄
;

65 
PlugöInôFunc
 
	möô_func
;

66 
PlugöC™U∆ﬂdFunc
 
	mˇn_u∆ﬂd_func
;

67 
PlugöU∆ﬂdFunc
 
	mu∆ﬂd_func
;

72 
GLi°
 *
	g∂ugös
 = 
NULL
;

74 
ísuª_∂ugörc
();

75 
‰ì_∂ugörc
();

76 
gboﬁón
 
∂ugö_lﬂd_öhibôed
(c⁄° 
gch¨
 *
fûíame
);

77 
öfo_fûl_‰om_∂ugörc
(
PlugöInfo
 *
öfo
);

79 
gboﬁón


80 
	$dü_∂ugö_öfo_öô
(
PlugöInfo
 *
öfo
, 
gch¨
 *
«me
, gch¨ *
des¸ùti⁄
,

81 
PlugöC™U∆ﬂdFunc
 
ˇn_u∆ﬂd_func
,

82 
PlugöU∆ﬂdFunc
 
u∆ﬂd_func
)

84 
	`g_‰ì
(
öfo
->
«me
);

85 
öfo
->
«me
 = 
	`g_°rdup
(name);

86 
	`g_‰ì
(
öfo
->
des¸ùti⁄
);

87 
öfo
->
des¸ùti⁄
 = 
	`g_°rdup
(description);

88 
öfo
->
ˇn_u∆ﬂd_func
 = can_unload_func;

89 
öfo
->
u∆ﬂd_func
 = unload_func;

90  
TRUE
;

91 
	}
}

93 
gch¨
 *

94 
	$dü_∂ugö_check_vîsi⁄
(
göt
 
vîsi⁄
)

96 i‡(
vîsi⁄
 !
DIA_PLUGIN_API_VERSION
)

99  
NULL
;

100 
	}
}

105 c⁄° 
gch¨
 *

106 
	$dü_∂ugö_gë_fûíame
(
PlugöInfo
 *
öfo
)

108  
öfo
->
fûíame
;

109 
	}
}

111 c⁄° 
gch¨
 *

112 
	$dü_∂ugö_gë_«me
(
PlugöInfo
 *
öfo
)

114  
öfo
->
«me
 ? info->«mê: 
	`_
("???");

115 
	}
}

117 c⁄° 
gch¨
 *

118 
	$dü_∂ugö_gë_des¸ùti⁄
(
PlugöInfo
 *
öfo
)

120  
öfo
->
des¸ùti⁄
;

121 
	}
}

123 c⁄° 
gpoöãr
 *

124 
	$dü_∂ugö_gë_symbﬁ
(
PlugöInfo
 *
öfo
, c⁄° 
gch¨
* 
«me
)

126 
gpoöãr
 
symbﬁ
;

128 i‡(!
öfo
->
moduÀ
)

129  
NULL
;

131 i‡(
	`g_moduÀ_symbﬁ
 (
öfo
->
moduÀ
, 
«me
, &
symbﬁ
))

132  
symbﬁ
;

134  
NULL
;

135 
	}
}

137 
gboﬁón


138 
	$dü_∂ugö_ˇn_u∆ﬂd
(
PlugöInfo
 *
öfo
)

140  (
öfo
->
ˇn_u∆ﬂd_func
 !
NULL
) && (* info->can_unload_func)(info);

141 
	}
}

143 
gboﬁón


144 
	$dü_∂ugö_is_lﬂded
(
PlugöInfo
 *
öfo
)

146  
öfo
->
is_lﬂded
;

147 
	}
}

149 
gboﬁón


150 
	$dü_∂ugö_gë_öhibô_lﬂd
(
PlugöInfo
 *
öfo
)

152  
öfo
->
öhibô_lﬂd
;

153 
	}
}

156 
	$dü_∂ugö_£t_öhibô_lﬂd
(
PlugöInfo
 *
öfo
, 
gboﬁón
 
öhibô_lﬂd
)

158 
öfo
->
öhibô_lﬂd
 = inhibit_load;

159 
	}
}

162 
	$dü_∂ugö_lﬂd
(
PlugöInfo
 *
öfo
)

164 #ifde‡
G_OS_WIN32


165 
guöt
 
îr‹_mode
;

167 
	`g_ªtu∫_if_Áû
(
öfo
 !
NULL
);

168 
	`g_ªtu∫_if_Áû
(
öfo
->
fûíame
 !
NULL
);

170 i‡(
öfo
->
is_lﬂded
)

173 #ifde‡
G_OS_WIN32


175 
îr‹_mode
 = 
	`SëEº‹Mode
 (
SEM_FAILCRITICALERRORS
|
SEM_NOOPENFILEERRORBOX
);

178 
	`dü_log_mesßge
 ("∂ug-ö '%s'", 
öfo
->
fûíame
);

179 
öfo
->
moduÀ
 = 
	`g_moduÀ_›í
(öfo->
fûíame
, 
G_MODULE_BIND_LAZY
);

180 #ifde‡
G_OS_WIN32


181 
	`SëEº‹Mode
 (
îr‹_mode
);

183 i‡(!
öfo
->
moduÀ
) {

184 
gch¨
 *
msg_utf8
 = 
NULL
;

186 i‡(!
	`g_fûe_ã°
(
öfo
->
fûíame
, 
G_FILE_TEST_EXISTS
))

187 
msg_utf8
 = 
	`g_loˇÀ_to_utf8
 (
	`g_moduÀ_îr‹
(), -1, 
NULL
, NULL, NULL);

189 
msg_utf8
 = 
	`g_°rdup_¥ötf
 (
	`_
("Missög dïídícõ†f‹ '%s'?"), 
öfo
->
fûíame
);

191 
öfo
->
des¸ùti⁄
 = 
msg_utf8
;

194 
öfo
->
öô_func
 = 
NULL
;

196 i‡(!
	`g_moduÀ_symbﬁ
(
öfo
->
moduÀ
, "dia_plugin_init",

197 (
gpoöãr
)&
öfo
->
öô_func
)) {

198 
	`g_moduÀ_˛o£
(
öfo
->
moduÀ
);

199 
öfo
->
moduÀ
 = 
NULL
;

200 
öfo
->
des¸ùti⁄
 = 
	`g_°rdup
(
	`_
("Missing symbol 'dia_plugin_init'"));

207 i‡((* 
öfo
->
öô_func
)(öfoË!
DIA_PLUGIN_INIT_OK
) {

209 
	`g_moduÀ_˛o£
(
öfo
->
moduÀ
);

210 
öfo
->
moduÀ
 = 
NULL
;

211 
öfo
->
des¸ùti⁄
 = 
	`g_°rdup
(
	`_
("dia_plugin_init() call failed"));

216 i‡(
öfo
->
des¸ùti⁄
 =
NULL
) {

217 
	`g_moduÀ_˛o£
(
öfo
->
moduÀ
);

218 
öfo
->
moduÀ
 = 
NULL
;

219 
öfo
->
des¸ùti⁄
 = 
	`g_°rdup
(
	`_
("dia_plugin_init() call failed"));

223 
öfo
->
is_lﬂded
 = 
TRUE
;

226 
	}
}

229 
	$dü_∂ugö_u∆ﬂd
(
PlugöInfo
 *
öfo
)

231 
	`g_ªtu∫_if_Áû
(
öfo
 !
NULL
);

232 
	`g_ªtu∫_if_Áû
(
öfo
->
fûíame
 !
NULL
);

234 i‡(!
öfo
->
is_lﬂded
)

237 i‡(!
	`dü_∂ugö_ˇn_u∆ﬂd
(
öfo
)) {

238 
	`mesßge
(
	`_
("%†Plugö couldÇŸ bêu∆ﬂded"), 
öfo
->
«me
);

242 i‡(
öfo
->
u∆ﬂd_func
)

243 (* 
öfo
->
u∆ﬂd_func
)(info);

244 
	`g_moduÀ_˛o£
(
öfo
->
moduÀ
);

245 
öfo
->
moduÀ
 = 
NULL
;

246 
öfo
->
öô_func
 = 
NULL
;

247 
öfo
->
ˇn_u∆ﬂd_func
 = 
NULL
;

248 
öfo
->
u∆ﬂd_func
 = 
NULL
;

250 
öfo
->
is_lﬂded
 = 
FALSE
;

251 
	}
}

254 
	$dü_ªgi°î_∂ugö
(c⁄° 
gch¨
 *
fûíame
)

256 
GLi°
 *
tmp
;

257 
PlugöInfo
 *
öfo
;

260 
tmp
 = 
∂ugös
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

261 
öfo
 = 
tmp
->
d©a
;

262 i‡(!
	`°rcmp
(
öfo
->
fûíame
, filename))

267 i‡(
	`°r°r
(
fûíame
, "libdia.")) {

272 
öfo
 = 
	`g_√w0
(
PlugöInfo
, 1);

273 
öfo
->
fûíame
 = 
	`g_°rdup
(filename);

274 
öfo
->
is_lﬂded
 = 
FALSE
;

275 
öfo
->
öhibô_lﬂd
 = 
FALSE
;

279 i‡(
	`∂ugö_lﬂd_öhibôed
(
fûíame
))

280 
	`öfo_fûl_‰om_∂ugörc
(
öfo
);

282 
	`dü_∂ugö_lﬂd
(
öfo
);

284 
∂ugös
 = 
	`g_li°_¥ïíd
’lugös, 
öfo
);

285 #ifde‡
DEBUG


286 
tmp
 = 
∂ugös
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

287 
öfo
 = 
tmp
->
d©a
;

290 
	}
}

292 
gboﬁón


293 
	$this_is_a_∂ugö
(c⁄° 
gch¨
 *
«me
)

295  
	`g_°r_has_suffix
(
«me
, 
G_MODULE_SUFFIX
);

296 
	}
}

298 (*
	tF‹EachInDúDoFunc
)(c⁄° 
	tgch¨
 *
	t«me
);

299 
	$gboﬁón
 (*
	tF‹EachInDúFûãrFunc
)(c⁄° 
	tgch¨
 *
	t«me
);

302 
	$f‹_óch_ö_dú
(c⁄° 
gch¨
 *
dúe˘‹y
, 
F‹EachInDúDoFunc
 
dofunc
,

303 
F‹EachInDúFûãrFunc
 
fûãr
)

305 
°©
 
°©buf
;

306 c⁄° *
díåy
;

307 
GDú
 *
dp
;

308 
GEº‹
 *
îr‹
 = 
NULL
;

310 i‡–
	`°©
(
dúe˘‹y
, &
°©buf
) < 0)

313 
dp
 = 
	`g_dú_›í
(
dúe˘‹y
, 0, &
îr‹
);

314 i‡(
dp
 =
NULL
) {

315 
	`mesßge_w¨nög
(
	`_
("CouldÇŸ o≥¿`%s'\n`%s'"), 
dúe˘‹y
, 
îr‹
->
mesßge
);

316 
	`g_îr‹_‰ì
 (
îr‹
);

320 (
díåy
 = 
	`g_dú_ªad_«me
(
dp
)Ë!
NULL
) {

321 
gch¨
 *
«me
 = 
	`g_°rc⁄ˇt
(
dúe˘‹y
,
G_DIR_SEPARATOR_S
,
díåy
,
NULL
);

323 i‡(
	`fûãr
(
«me
))

324 
	`dofunc
(
«me
);

325 
	`g_‰ì
(
«me
);

327 
	`g_dú_˛o£
(
dp
);

328 
	}
}

330 
gboﬁón


331 
	$dúe˘‹y_fûãr
(c⁄° 
gch¨
 *
«me
)

333 
guöt
 
Àn
 = 
	`°æí
(
«me
);

335 i‡(0 =
	`°rcmp
(
G_DIR_SEPARATOR_S
 ".",

336 &
«me
[
Àn
-
	`°æí
(
G_DIR_SEPARATOR_S
 ".")])Ë 
FALSE
;

337 i‡(0 =
	`°rcmp
(
G_DIR_SEPARATOR_S
 "..",

338 &
«me
[
Àn
-
	`°æí
(
G_DIR_SEPARATOR_S
 "..")])Ë 
FALSE
;

340 i‡(!
	`g_fûe_ã°
 (
«me
, 
G_FILE_TEST_IS_DIR
))

341  
FALSE
;

343  
TRUE
;

344 
	}
}

346 
gboﬁón


347 
	$dü_∂ugö_fûãr
(c⁄° 
gch¨
 *
«me
)

349 i‡(!
	`g_fûe_ã°
 (
«me
, 
G_FILE_TEST_IS_REGULAR
 | 
G_FILE_TEST_IS_DIR
))

350  
FALSE
;

352  
	`this_is_a_∂ugö
(
«me
);

353 
	}
}

356 
	$wÆk_dús_f‹_∂ugös
(c⁄° 
gch¨
 *
dú«me
)

358 
	`f‹_óch_ö_dú
(
dú«me
,
wÆk_dús_f‹_∂ugös
,
dúe˘‹y_fûãr
);

359 
	`f‹_óch_ö_dú
(
dú«me
,
dü_ªgi°î_∂ugö
,
dü_∂ugö_fûãr
);

360 
	}
}

362 
	#RECURSE
 (
G_DIR_SEPARATOR_S
 G_DIR_SEPARATOR_S)

	)

365 
	$dü_ªgi°î_∂ugös_ö_dú
(c⁄° 
gch¨
 *
dúe˘‹y
)

367 
guöt
 
ª˛í
 = 
	`°æí
(
RECURSE
);

368 
guöt
 
Àn
 = 
	`°æí
(
dúe˘‹y
);

370 i‡((
Àn
 >
ª˛í
) &&

371 (0 =
	`°rcmp
(&
dúe˘‹y
[
Àn
-
ª˛í
],
RECURSE
))) {

372 
gch¨
 *
dúba£
 = 
	`g_°∫dup
(
dúe˘‹y
,
Àn
-
ª˛í
);

373 
	`f‹_óch_ö_dú
(
dúba£
,
wÆk_dús_f‹_∂ugös
,
dúe˘‹y_fûãr
);

374 
	`g_‰ì
(
dúba£
);

377 
	`f‹_óch_ö_dú
(
dúe˘‹y
,
dü_ªgi°î_∂ugö
,
dü_∂ugö_fûãr
);

378 
	}
}

381 
	$dü_ªgi°î_∂ugös
()

383 c⁄° 
gch¨
 *
libøry_∑th
;

389 
libøry_∑th
 = 
NULL
;

399 i‡(
libøry_∑th
 !
NULL
) {

404 c⁄° 
Àn
 = 
	`°æí
(
libøry_∑th
);

405 
ext
[] = "\\dia\0";

406 
gch¨
* 
√wdú
 = 
	`g_√w
(,
Àn
+
	`°æí
(
ext
)+1);

407 
	`°∫˝y
(
√wdú
,
libøry_∑th
,
Àn
);

408 
	`°∫˝y
(&
√wdú
[
Àn
],
ext
,
	`°æí
(ext));

409 
	`dü_ªgi°î_∂ugös_ö_dú
(
√wdú
);

410 
	`g_‰ì
(
√wdú
);

411 
	`g_‰ì
(
libøry_∑th
);

415 
libøry_∑th
 = 
	`dü_gë_lib_dúe˘‹y
("dia");

417 
	`dü_ªgi°î_∂ugös_ö_dú
(
libøry_∑th
);

418 
	`g_‰ì
((*)
libøry_∑th
);

421 
	`‰ì_∂ugörc
();

422 
	}
}

425 
	$dü_ªgi°î_buûtö_∂ugö
(
PlugöInôFunc
 
öô_func
)

427 
PlugöInfo
 *
öfo
;

429 
öfo
 = 
	`g_√w0
(
PlugöInfo
, 1);

430 
öfo
->
fûíame
 = "<builtin>";

431 
öfo
->
is_lﬂded
 = 
TRUE
;

432 
öfo
->
öhibô_lﬂd
 = 
FALSE
;

434 
öfo
->
öô_func
 = init_func;

436 i‡((* 
öô_func
)(
öfo
Ë!
DIA_PLUGIN_INIT_OK
) {

437 
	`g_‰ì
(
öfo
);

440 
∂ugös
 = 
	`g_li°_¥ïíd
’lugös, 
öfo
);

441 
	}
}

444 
GLi°
 *

445 
	$dü_li°_∂ugös
()

447  
∂ugös
;

448 
	}
}

450 
xmlDocPå
 
	g∂ugörc
 = 
NULL
;

462 
	$ísuª_∂ugörc
()

464 
gch¨
 *
fûíame
;

466 i‡(
∂ugörc
)

468 
fûíame
 = 
	`dü_c⁄fig_fûíame
("pluginrc");

469 i‡(
	`g_fûe_ã°
 (
fûíame
, 
G_FILE_TEST_IS_REGULAR
))

470 
∂ugörc
 = 
	`xmlDüP¨£Fûe
(
fûíame
);

472 
∂ugörc
 = 
NULL
;

474 
	`g_‰ì
(
fûíame
);

476 i‡(!
∂ugörc
) {

477 
∂ugörc
 = 
	`xmlNewDoc
((c⁄° 
xmlCh¨
 *)"1.0");

478 
∂ugörc
->
ícodög
 = 
	`xmlSådup
((c⁄° 
xmlCh¨
 *)"UTF-8");

479 
	`xmlDocSëRoŸEÀmít
(
∂ugörc
,

480 
	`xmlNewDocNode
(
∂ugörc
, 
NULL
, (c⁄° 
xmlCh¨
 *)"plugins", NULL));

482 
	}
}

485 
	$‰ì_∂ugörc
()

487 i‡(
∂ugörc
) {

488 
	`xmlFªeDoc
(
∂ugörc
);

489 
∂ugörc
 = 
NULL
;

491 
	}
}

494 
gboﬁón


495 
	$∂ugö_lﬂd_öhibôed
(c⁄° 
gch¨
 *
fûíame
)

497 
xmlNodePå
 
node
;

499 
	`ísuª_∂ugörc
();

500 
node
 = 
∂ugörc
->
xmlRoŸNode
->
xmlChûdªnNode
;

501 
node
 !
NULL
;

502 
node
 =Çode->
√xt
) {

503 
xmlCh¨
 *
node_fûíame
;

505 i‡(
	`xmlIsBœnkNode
(
node
)) ;

507 i‡(
node
->
ty≥
 !
XML_ELEMENT_NODE
 || 
	`xmlSåcmp
“ode->
«me
, (c⁄° 
xmlCh¨
 *)"plugin") != 0)

509 
node_fûíame
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"filename");

510 i‡(
node_fûíame
 && !
	`°rcmp
(
fûíame
, (
gch¨
 *)node_filename)) {

511 
xmlNodePå
 
node2
;

513 
	`xmlFªe
(
node_fûíame
);

514 
node2
 = 
node
->
xmlChûdªnNode
;

515 
node2
 !
NULL
;

516 
node2
 =Çode2->
√xt
) {

517 i‡(
	`xmlIsBœnkNode
(
node2
)) ;

518 i‡(
node2
->
ty≥
 =
XML_ELEMENT_NODE
 &&

519 !
	`xmlSåcmp
(
node2
->
«me
, (c⁄° 
xmlCh¨
 *)"inhibit-load"))

520  
TRUE
;

522  
FALSE
;

524 i‡(
node_fûíame
Ë
	`xmlFªe
(node_filename);

526  
FALSE
;

527 
	}
}

530 
	$öfo_fûl_‰om_∂ugörc
(
PlugöInfo
 *
öfo
)

532 
xmlNodePå
 
node
;

534 
öfo
->
moduÀ
 = 
NULL
;

535 
öfo
->
«me
 = 
NULL
;

536 
öfo
->
des¸ùti⁄
 = 
NULL
;

537 
öfo
->
is_lﬂded
 = 
FALSE
;

538 
öfo
->
öhibô_lﬂd
 = 
TRUE
;

539 
öfo
->
öô_func
 = 
NULL
;

540 
öfo
->
ˇn_u∆ﬂd_func
 = 
NULL
;

541 
öfo
->
u∆ﬂd_func
 = 
NULL
;

543 
	`ísuª_∂ugörc
();

544 
node
 = 
∂ugörc
->
xmlRoŸNode
->
xmlChûdªnNode
;

545 
node
 !
NULL
;

546 
node
 =Çode->
√xt
) {

547 
xmlCh¨
 *
node_fûíame
;

549 i‡(
	`xmlIsBœnkNode
(
node
)) ;

551 i‡(
node
->
ty≥
 !
XML_ELEMENT_NODE
 || 
	`xmlSåcmp
“ode->
«me
, (c⁄° 
xmlCh¨
 *)"plugin") != 0)

553 
node_fûíame
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"filename");

554 i‡(
node_fûíame
 && !
	`°rcmp
(
öfo
->
fûíame
, (*)Çode_filename)) {

555 
xmlNodePå
 
node2
;

557 
	`xmlFªe
(
node_fûíame
);

558 
node2
 = 
node
->
xmlChûdªnNode
;

559 
node2
 !
NULL
;

560 
node2
 =Çode2->
√xt
) {

561 
gch¨
 *
c⁄ã¡
;

563 i‡(
	`xmlIsBœnkNode
(
node2
)) ;

565 i‡(
node2
->
ty≥
 !
XML_ELEMENT_NODE
)

567 
c⁄ã¡
 = (
gch¨
 *)
	`xmlNodeGëC⁄ã¡
(
node2
);

568 i‡(!
	`xmlSåcmp
(
node2
->
«me
, (c⁄° 
xmlCh¨
 *)"name")) {

569 
	`g_‰ì
(
öfo
->
«me
);

570 
öfo
->
«me
 = 
	`g_°rdup
(
c⁄ã¡
);

571 } i‡(!
	`xmlSåcmp
(
node2
->
«me
, (c⁄° 
xmlCh¨
 *)"description")) {

572 
	`g_‰ì
(
öfo
->
des¸ùti⁄
);

573 
öfo
->
des¸ùti⁄
 = 
	`g_°rdup
(
c⁄ã¡
);

575 
	`xmlFªe
(
c⁄ã¡
);

579 i‡(
node_fûíame
Ë
	`xmlFªe
(node_filename);

581 
	}
}

584 
	$dü_∂ugörc_wrôe
()

586 
gch¨
 *
fûíame
;

587 
GLi°
 *
tmp
;

589 
	`ísuª_∂ugörc
();

590 
tmp
 = 
∂ugös
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

591 
PlugöInfo
 *
öfo
 = 
tmp
->
d©a
;

592 
xmlNodePå
 
node
, 
∂ugönode
, 
d©™ode
;

594 i‡(
öfo
 =
NULL
) {

598 
∂ugönode
 = 
	`xmlNewNode
(
NULL
, (c⁄° 
xmlCh¨
 *)"plugin");

599 
d©™ode
 = 
	`xmlNewChûd
(
∂ugönode
, 
NULL
, (c⁄° 
xmlCh¨
 *)"«me", (xmlCh¨ *)
öfo
->
«me
);

602 
xmlCh¨
 *
íc
 = 
	`xmlEncodeE¡ôõsRì¡ø¡
(
∂ugönode
->
doc
,

603 (
xmlCh¨
 *)
öfo
->
des¸ùti⁄
);

604 
d©™ode
 = 
	`xmlNewChûd
(
∂ugönode
, 
NULL
, (c⁄° 
xmlCh¨
 *)"des¸ùti⁄", 
íc
);

605 
	`xmlFªe
(
íc
);

607 i‡(
öfo
->
öhibô_lﬂd
)

608 
d©™ode
 = 
	`xmlNewChûd
(
∂ugönode
, 
NULL
, (c⁄° 
xmlCh¨
 *)"inhibit-load", NULL);

610 
node
 = 
∂ugörc
->
xmlRoŸNode
->
xmlChûdªnNode
;

611 
node
 !
NULL
;

612 
node
 =Çode->
√xt
) {

613 
xmlCh¨
 *
node_fûíame
;

615 i‡(
	`xmlIsBœnkNode
(
node
)) ;

617 i‡(
node
->
ty≥
 !
XML_ELEMENT_NODE
 || 
	`xmlSåcmp
“ode->
«me
, (c⁄° 
xmlCh¨
 *)"plugin") != 0)

619 
node_fûíame
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"filename");

620 i‡(
node_fûíame
 && !
	`°rcmp
(
öfo
->
fûíame
, (*)Çode_filename)) {

621 
	`xmlFªe
(
node_fûíame
);

622 
	`xmlRïœ˚Node
(
node
, 
∂ugönode
);

623 
	`xmlFªeNode
(
node
);

626 i‡(
node_fûíame
Ë
	`xmlFªe
(node_filename);

629 i‡(!
node
)

630 
	`xmlAddChûd
(
∂ugörc
->
xmlRoŸNode
, 
∂ugönode
);

632 
	`xmlSëPr›
(
∂ugönode
, (c⁄° 
xmlCh¨
 *)"fûíame", (xmlCh¨ *)
öfo
->
fûíame
);

635 
fûíame
 = 
	`dü_c⁄fig_fûíame
("pluginrc");

637 
	`xmlDüSaveFûe
(
fûíame
,
∂ugörc
);

639 
	`g_‰ì
(
fûíame
);

640 
	`‰ì_∂ugörc
();

641 
	}
}

	@O:\tool\dvs50\lib\plug-ins.h

22 #i‚de‡
PLUG_INS_H


23 
	#PLUG_INS_H


	)

25 
	~<glib.h
>

26 
	~<gmoduÀ.h
>

27 
	~"düty≥s.h
"

30 
	gG_BEGIN_DECLS


53 
	#DIA_PLUGIN_API_VERSION
 13

	)

56 
	mDIA_PLUGIN_INIT_OK
,

57 
	mDIA_PLUGIN_INIT_ERROR


58 } 
	tPlugöInôResu…
;

60 
	$PlugöInôResu…
 (*
	tPlugöInôFunc
Ë(
	tPlugöInfo
 *
	töfo
);

61 
	$gboﬁón
 (*
	tPlugöC™U∆ﬂdFunc
Ë(
	tPlugöInfo
 *
	töfo
);

62 (*
	tPlugöU∆ﬂdFunc
Ë(
	tPlugöInfo
 *
	töfo
);

66 
DIAVAR
 
gboﬁón
 
	`dü_∂ugö_öfo_öô
(
PlugöInfo
 *
öfo
, 
gch¨
 *
«me
,

67 
gch¨
 *
des¸ùti⁄
,

68 
PlugöC™U∆ﬂdFunc
 
ˇn_u∆ﬂd_func
,

69 
PlugöU∆ﬂdFunc
 
u∆ﬂd_func
);

71 
DIAVAR
 
gch¨
 *
	`dü_∂ugö_check_vîsi⁄
(
göt
 
vîsi⁄
);

75 
DIAVAR
 c⁄° 
gch¨
 *
	`dü_∂ugö_gë_fûíame
 (
PlugöInfo
 *
öfo
);

76 
DIAVAR
 c⁄° 
gch¨
 *
	`dü_∂ugö_gë_«me
 (
PlugöInfo
 *
öfo
);

77 
DIAVAR
 c⁄° 
gch¨
 *
	`dü_∂ugö_gë_des¸ùti⁄
 (
PlugöInfo
 *
öfo
);

78 
DIAVAR
 c⁄° 
gpoöãr
 *
	`dü_∂ugö_gë_symbﬁ
 (
PlugöInfo
 *
öfo
, c⁄° 
gch¨
 *
«me
);

80 
DIAVAR
 
gboﬁón
 
	`dü_∂ugö_ˇn_u∆ﬂd
 (
PlugöInfo
 *
öfo
);

81 
DIAVAR
 
gboﬁón
 
	`dü_∂ugö_is_lﬂded
 (
PlugöInfo
 *
öfo
);

82 
DIAVAR
 
gboﬁón
 
	`dü_∂ugö_gë_öhibô_lﬂd
 (
PlugöInfo
 *
öfo
);

83 
DIAVAR
 
	`dü_∂ugö_£t_öhibô_lﬂd
 (
PlugöInfo
 *
öfo
, 
gboﬁón
 
öhibô_lﬂd
);

85 
DIAVAR
 
	`dü_∂ugö_lﬂd
 (
PlugöInfo
 *
öfo
);

86 
DIAVAR
 
	`dü_∂ugö_u∆ﬂd
 (
PlugöInfo
 *
öfo
);

88 
DIAVAR
 
	`dü_ªgi°î_∂ugö
 (c⁄° 
gch¨
 *
fûíame
);

89 
DIAVAR
 
	`dü_ªgi°î_∂ugös_ö_dú
 (c⁄° 
gch¨
 *
dúe˘‹y
);

90 
DIAVAR
 
	`dü_ªgi°î_∂ugös
 ();

91 
DIAVAR
 
	`dü_ªgi°î_buûtö_∂ugö
 (
PlugöInôFunc
 
öô_func
);

93 
DIAVAR
 
GLi°
 *
	`dü_li°_∂ugös
();

95 
DIAVAR
 
	`dü_∂ugörc_wrôe
();

99 
	#DIA_PLUGIN_CHECK_INIT
 \

100 
G_MODULE_EXPORT
 c⁄° 
gch¨
 *
	`g_moduÀ_check_öô
(
GModuÀ
 *
gmoduÀ
); \

101 c⁄° 
gch¨
 * \

102 
	`g_moduÀ_check_öô
(
GModuÀ
 *
gmoduÀ
) \

104  
	`dü_∂ugö_check_vîsi⁄
(
DIA_PLUGIN_API_VERSION
); \

105 
	}

	)
}

108 
G_MODULE_EXPORT
 
PlugöInôResu…
 
dü_∂ugö_öô
(
PlugöInfo
 *
öfo
);

110 
	gG_END_DECLS


	@O:\tool\dvs50\lib\poly_conn.c

19 
	~<c⁄fig.h
>

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<as£π.h
>

24 
	~<m©h.h
>

25 
	~<°rög.h
>

27 
	~"pﬁy_c⁄n.h
"

28 
	~"mesßge.h
"

29 
	~"düªndîî.h
"

31 
	ech™ge_ty≥
 {

32 
	mTYPE_ADD_POINT
,

33 
	mTYPE_REMOVE_POINT


36 
	sPoötCh™ge
 {

37 
Obje˘Ch™ge
 
	mobj_ch™ge
;

39 
ch™ge_ty≥
 
	mty≥
;

40 
	m≠∂õd
;

42 
Poöt
 
	mpoöt
;

43 
	mpos
;

45 
H™dÀ
 *
	mh™dÀ
;

47 
C⁄√˘i⁄Poöt
 *
	mc⁄√˘ed_to
;

50 
Obje˘Ch™ge
 *

51 
pﬁyc⁄n_¸óã_ch™ge
(
PﬁyC⁄n
 *
pﬁy
, 
ch™ge_ty≥
 
ty≥
,

52 
Poöt
 *
poöt
, 
£gmít
, 
H™dÀ
 *
h™dÀ
,

53 
C⁄√˘i⁄Poöt
 *
c⁄√˘ed_to
);

57 
	mPC_HANDLE_START
,

58 
	mPC_HANDLE_CORNER
,

59 
	mPC_HANDLE_END


60 } 
	tPﬁyC⁄nH™dÀTy≥
;

63 
	$£tup_h™dÀ
(
H™dÀ
 *
h™dÀ
, 
PﬁyC⁄nH™dÀTy≥
 
t
)

65 
h™dÀ
->
id
 = (
PC_HANDLE_CORNER
 =
t
 ? 
HANDLE_CORNER


66 : (
PC_HANDLE_END
 =
t
 ? 
HANDLE_MOVE_ENDPOINT


67 : 
HANDLE_MOVE_STARTPOINT
));

68 
h™dÀ
->
ty≥
 = (
PC_HANDLE_CORNER
 =
t
 ? 
HANDLE_MINOR_CONTROL
 : 
HANDLE_MAJOR_CONTROL
);

69 
h™dÀ
->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

70 
h™dÀ
->
c⁄√˘ed_to
 = 
NULL
;

71 
	}
}

74 
	$gë_h™dÀ_ƒ
(
PﬁyC⁄n
 *
pﬁy
, 
H™dÀ
 *
h™dÀ
)

76 
i
 = 0;

77 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

78 i‡(
pﬁy
->
obje˘
.
h™dÀs
[
i
] =
h™dÀ
)

79  
i
;

82 
	}
}

84 
Obje˘Ch™ge
 *

85 
	$pﬁyc⁄n_move_h™dÀ
(
PﬁyC⁄n
 *
pﬁy
, 
H™dÀ
 *
h™dÀ
,

86 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

87 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

89 
h™dÀ_ƒ
;

91 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
pﬁy
, 
h™dÀ
);

92 
h™dÀ
->
id
) {

93 
HANDLE_MOVE_STARTPOINT
:

94 
pﬁy
->
poöts
[0] = *
to
;

96 
HANDLE_MOVE_ENDPOINT
:

97 
pﬁy
->
poöts
[pﬁy->
numpoöts
-1] = *
to
;

99 
HANDLE_CORNER
:

100 
pﬁy
->
poöts
[
h™dÀ_ƒ
] = *
to
;

103 
	`mesßge_îr‹
("InternalÉrror inÖolyconn_move_handle.\n");

107  
NULL
;

108 
	}
}

110 
Obje˘Ch™ge
*

111 
	$pﬁyc⁄n_move
(
PﬁyC⁄n
 *
pﬁy
, 
Poöt
 *
to
)

113 
Poöt
 
p
;

114 
i
;

116 
p
 = *
to
;

117 
	`poöt_sub
(&
p
, &
pﬁy
->
poöts
[0]);

119 
pﬁy
->
poöts
[0] = *
to
;

120 
i
=1;i<
pﬁy
->
numpoöts
;i++) {

121 
	`poöt_add
(&
pﬁy
->
poöts
[
i
], &
p
);

124  
NULL
;

125 
	}
}

128 
	$pﬁyc⁄n_˛o£°_£gmít
(
PﬁyC⁄n
 *
pﬁy
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

130 
i
;

131 
ªÆ
 
di°
;

132 
˛o£°
;

134 
di°
 = 
	`di°™˚_löe_poöt
–&
pﬁy
->
poöts
[0], &poly->points[1],

135 
löe_width
, 
poöt
);

136 
˛o£°
 = 0;

137 
i
=1;i<
pﬁy
->
numpoöts
-1;i++) {

138 
ªÆ
 
√w_di°
 =

139 
	`di°™˚_löe_poöt
–&
pﬁy
->
poöts
[
i
], &poly->points[i+1],

140 
löe_width
, 
poöt
);

141 i‡(
√w_di°
 < 
di°
) {

142 
di°
 = 
√w_di°
;

143 
˛o£°
 = 
i
;

146  
˛o£°
;

147 
	}
}

149 
H™dÀ
 *

150 
	$pﬁyc⁄n_˛o£°_h™dÀ
(
PﬁyC⁄n
 *
pﬁy
, 
Poöt
 *
poöt
)

152 
i
;

153 
ªÆ
 
di°
;

154 
H™dÀ
 *
˛o£°
;

156 
˛o£°
 = 
pﬁy
->
obje˘
.
h™dÀs
[0];

157 
di°
 = 
	`di°™˚_poöt_poöt
–
poöt
, &
˛o£°
->
pos
);

158 
i
=1;i<
pﬁy
->
numpoöts
;i++) {

159 
ªÆ
 
√w_di°
;

160 
√w_di°
 = 
	`di°™˚_poöt_poöt
–
poöt
, &
pﬁy
->
poöts
[
i
]);

161 i‡(
√w_di°
 < 
di°
) {

162 
di°
 = 
√w_di°
;

163 
˛o£°
 = 
pﬁy
->
obje˘
.
h™dÀs
[
i
];

166  
˛o£°
;

167 
	}
}

169 
ªÆ


170 
	$pﬁyc⁄n_di°™˚_‰om
(
PﬁyC⁄n
 *
pﬁy
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

172 
i
;

173 
ªÆ
 
di°
;

175 
di°
 = 
	`di°™˚_löe_poöt
–&
pﬁy
->
poöts
[0], &poly->points[1],

176 
löe_width
, 
poöt
);

177 
i
=1;i<
pﬁy
->
numpoöts
-1;i++) {

178 
di°
 = 
	`MIN
(dist,

179 
	`di°™˚_löe_poöt
–&
pﬁy
->
poöts
[
i
], &poly->points[i+1],

180 
löe_width
, 
poöt
));

182  
di°
;

183 
	}
}

186 
	$add_h™dÀ
(
PﬁyC⁄n
 *
pﬁy
, 
pos
, 
Poöt
 *
poöt
, 
H™dÀ
 *
h™dÀ
)

188 
i
;

189 
DüObje˘
 *
obj
;

191 
pﬁy
->
numpoöts
++;

192 
pﬁy
->
poöts
 = 
	`g_ªÆloc
’ﬁy->poöts,Öﬁy->
numpoöts
*(
Poöt
));

194 
i
=
pﬁy
->
numpoöts
-1; i > 
pos
; i--) {

195 
pﬁy
->
poöts
[
i
] =Öoly->points[i-1];

197 
pﬁy
->
poöts
[
pos
] = *
poöt
;

198 
	`obje˘_add_h™dÀ_©
((
DüObje˘
*)
pﬁy
, 
h™dÀ
, 
pos
);

200 
obj
 = (
DüObje˘
 *)
pﬁy
;

201 i‡(
pos
==0) {

202 
obj
->
h™dÀs
[1]->
ty≥
 = 
HANDLE_MINOR_CONTROL
;

203 
obj
->
h™dÀs
[1]->
id
 = 
HANDLE_CORNER
;

205 i‡(
pos
==
obj
->
num_h™dÀs
-1) {

206 
obj
->
h™dÀs
[obj->
num_h™dÀs
-2]->
ty≥
 = 
HANDLE_MINOR_CONTROL
;

207 
obj
->
h™dÀs
[obj->
num_h™dÀs
-2]->
id
 = 
HANDLE_CORNER
;

209 
	}
}

212 
	$ªmove_h™dÀ
(
PﬁyC⁄n
 *
pﬁy
, 
pos
)

214 
i
;

215 
DüObje˘
 *
obj
;

216 
H™dÀ
 *
ﬁd_h™dÀ
;

218 
obj
 = (
DüObje˘
 *)
pﬁy
;

220 i‡(
pos
==0) {

221 
obj
->
h™dÀs
[1]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

222 
obj
->
h™dÀs
[1]->
id
 = 
HANDLE_MOVE_STARTPOINT
;

224 i‡(
pos
==
obj
->
num_h™dÀs
-1) {

225 
obj
->
h™dÀs
[obj->
num_h™dÀs
-2]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

226 
obj
->
h™dÀs
[obj->
num_h™dÀs
-2]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

230 
pﬁy
->
numpoöts
--;

231 
i
=
pos
; i < 
pﬁy
->
numpoöts
; i++) {

232 
pﬁy
->
poöts
[
i
] =Öoly->points[i+1];

234 
pﬁy
->
poöts
 = 
	`g_ªÆloc
’ﬁy->poöts,Öﬁy->
numpoöts
*(
Poöt
));

236 
ﬁd_h™dÀ
 = 
obj
->
h™dÀs
[
pos
];

237 
	`obje˘_ªmove_h™dÀ
(&
pﬁy
->
obje˘
, 
ﬁd_h™dÀ
);

238 
	}
}

243 
Obje˘Ch™ge
 *

244 
	$pﬁyc⁄n_add_poöt
(
PﬁyC⁄n
 *
pﬁy
, 
£gmít
, 
Poöt
 *
poöt
)

246 
Poöt
 
ªÆpoöt
;

247 
H™dÀ
 *
√w_h™dÀ
;

249 i‡(
poöt
 =
NULL
) {

250 
ªÆpoöt
.
x
 = (
pﬁy
->
poöts
[
£gmít
].x+poly->points[segment+1].x)/2;

251 
ªÆpoöt
.
y
 = (
pﬁy
->
poöts
[
£gmít
].y+poly->points[segment+1].y)/2;

253 
ªÆpoöt
 = *
poöt
;

256 
√w_h™dÀ
 = 
	`g_mÆloc
((
H™dÀ
));

257 
	`£tup_h™dÀ
(
√w_h™dÀ
, 
PC_HANDLE_CORNER
);

258 
	`add_h™dÀ
(
pﬁy
, 
£gmít
+1, &
ªÆpoöt
, 
√w_h™dÀ
);

259  
	`pﬁyc⁄n_¸óã_ch™ge
(
pﬁy
, 
TYPE_ADD_POINT
,

260 &
ªÆpoöt
, 
£gmít
+1, 
√w_h™dÀ
,

261 
NULL
);

262 
	}
}

264 
Obje˘Ch™ge
 *

265 
	$pﬁyc⁄n_ªmove_poöt
(
PﬁyC⁄n
 *
pﬁy
, 
pos
)

267 
H™dÀ
 *
ﬁd_h™dÀ
;

268 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄poöt
;

269 
Poöt
 
ﬁd_poöt
;

271 
ﬁd_h™dÀ
 = 
pﬁy
->
obje˘
.
h™dÀs
[
pos
];

272 
ﬁd_poöt
 = 
pﬁy
->
poöts
[
pos
];

273 
c⁄√˘i⁄poöt
 = 
ﬁd_h™dÀ
->
c⁄√˘ed_to
;

275 
	`obje˘_unc⁄√˘
((
DüObje˘
 *)
pﬁy
, 
ﬁd_h™dÀ
);

277 
	`ªmove_h™dÀ
(
pﬁy
, 
pos
);

279 
	`pﬁyc⁄n_upd©e_d©a
(
pﬁy
);

281  
	`pﬁyc⁄n_¸óã_ch™ge
(
pﬁy
, 
TYPE_REMOVE_POINT
,

282 &
ﬁd_poöt
, 
pos
, 
ﬁd_h™dÀ
,

283 
c⁄√˘i⁄poöt
);

284 
	}
}

287 
	$pﬁyc⁄n_upd©e_d©a
(
PﬁyC⁄n
 *
pﬁy
)

289 
i
;

290 
DüObje˘
 *
obj
 = &
pﬁy
->
obje˘
;

293 i‡(
pﬁy
->
numpoöts
 !
obj
->
num_h™dÀs
) {

294 
	`g_as£π
(0 =
obj
->
num_c⁄√˘i⁄s
);

296 
obj
->
h™dÀs
 = 
	`g_ªÆloc
(obj->handles,

297 
pﬁy
->
numpoöts
*(
H™dÀ
 *));

298 
obj
->
num_h™dÀs
 = 
pﬁy
->
numpoöts
;

299 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

300 
obj
->
h™dÀs
[
i
] = 
	`g_mÆloc
((
H™dÀ
));

301 i‡(0 =
i
)

302 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[
i
], 
PC_HANDLE_START
);

303 i‡(
i
 =
pﬁy
->
numpoöts
-1)

304 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[
i
], 
PC_HANDLE_END
);

306 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[
i
], 
PC_HANDLE_CORNER
);

311 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

312 
obj
->
h™dÀs
[
i
]->
pos
 = 
pﬁy
->
poöts
[i];

314 
	}
}

317 
	$pﬁyc⁄n_upd©e_boundögbox
(
PﬁyC⁄n
 *
pﬁy
)

319 
	`as£π
(
pﬁy
 !
NULL
);

321 
	`pﬁylöe_bbox
(&
pﬁy
->
poöts
[0],

322 
pﬁy
->
numpoöts
,

323 &
pﬁy
->
exåa_•acög
, 
FALSE
,

324 &
pﬁy
->
obje˘
.
boundög_box
);

325 
	}
}

328 
	$pﬁyc⁄n_sim∂e_døw
(
PﬁyC⁄n
 *
pﬁy
, 
DüRídîî
 *
ªndîî
, 
ªÆ
 
width
)

330 
Poöt
 *
poöts
;

332 
	`as£π
(
pﬁy
 !
NULL
);

333 
	`as£π
(
ªndîî
 !
NULL
);

335 
poöts
 = &
pﬁy
->points[0];

337 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
width
);

338 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

339 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_ROUND
);

340 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

342 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁylöe
‘ídîî, 
poöts
, 
pﬁy
->
numpoöts
,

343 &
cﬁ‹_bœck
);

344 
	}
}

348 
	$pﬁyc⁄n_öô
(
PﬁyC⁄n
 *
pﬁy
, 
num_poöts
)

350 
DüObje˘
 *
obj
;

351 
i
;

353 
obj
 = &
pﬁy
->
obje˘
;

355 
	`obje˘_öô
(
obj
, 
num_poöts
, 0);

357 
pﬁy
->
numpoöts
 = 
num_poöts
;

359 
pﬁy
->
poöts
 = 
	`g_mÆloc
(
num_poöts
*(
Poöt
));

361 
i
=0;i<
num_poöts
;i++) {

362 
obj
->
h™dÀs
[
i
] = 
	`g_mÆloc
((
H™dÀ
));

363 i‡(0 =
i
)

364 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[
i
], 
PC_HANDLE_START
);

365 i‡(
i
 =
num_poöts
-1)

366 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[
i
], 
PC_HANDLE_END
);

368 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[
i
], 
PC_HANDLE_CORNER
);

371 
	`pﬁyc⁄n_upd©e_d©a
(
pﬁy
);

372 
	}
}

376 
	$pﬁyc⁄n_£t_poöts
(
PﬁyC⁄n
 *
pﬁy
, 
num_poöts
, 
Poöt
 *
poöts
)

378 
i
;

380 
pﬁy
->
numpoöts
 = 
num_poöts
;

382 i‡(
pﬁy
->
poöts
)

383 
	`g_‰ì
(
pﬁy
->
poöts
);

385 
pﬁy
->
poöts
 = 
	`g_mÆloc
(’ﬁy->
numpoöts
)*(
Poöt
));

387 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

388 
pﬁy
->
poöts
[
i
] =Öoints[i];

390 
	}
}

393 
	$pﬁyc⁄n_c›y
(
PﬁyC⁄n
 *
‰om
, PﬁyC⁄¿*
to
)

395 
i
;

396 
DüObje˘
 *
toobj
, *
‰omobj
;

398 
toobj
 = &
to
->
obje˘
;

399 
‰omobj
 = &
‰om
->
obje˘
;

401 
	`obje˘_c›y
(
‰omobj
, 
toobj
);

403 
to
->
obje˘
.
h™dÀs
[0] = 
	`g_√w
(
H™dÀ
,1);

404 *
to
->
obje˘
.
h™dÀs
[0] = *
‰om
->object.handles[0];

406 
i
=1;i<
toobj
->
num_h™dÀs
-1;i++) {

407 
to
->
obje˘
.
h™dÀs
[
i
] = 
	`g_mÆloc
((
H™dÀ
));

408 
	`£tup_h™dÀ
(
to
->
obje˘
.
h™dÀs
[
i
], 
PC_HANDLE_CORNER
);

411 
to
->
obje˘
.
h™dÀs
[
toobj
->
num_h™dÀs
-1] = 
	`g_√w
(
H™dÀ
,1);

412 *
to
->
obje˘
.
h™dÀs
[
toobj
->
num_h™dÀs
-1] =

413 *
‰om
->
obje˘
.
h™dÀs
[
toobj
->
num_h™dÀs
-1];

414 
	`pﬁyc⁄n_£t_poöts
(
to
, 
‰om
->
numpoöts
, from->
poöts
);

416 
	`mem˝y
(&
to
->
exåa_•acög
,&
‰om
->extra_spacing,(to->extra_spacing));

417 
	`pﬁyc⁄n_upd©e_d©a
(
to
);

418 
	}
}

421 
	$pﬁyc⁄n_de°roy
(
PﬁyC⁄n
 *
pﬁy
)

423 
i
;

424 
H™dÀ
 **
ãmp_h™dÀs
;

428 
ãmp_h™dÀs
 = 
	`g_√w
(
H™dÀ
 *, 
pﬁy
->
numpoöts
);

429 
i
=0;i<
pﬁy
->
numpoöts
;i++)

430 
ãmp_h™dÀs
[
i
] = 
pﬁy
->
obje˘
.
h™dÀs
[i];

432 
	`obje˘_de°roy
(&
pﬁy
->
obje˘
);

434 
i
=0;i<
pﬁy
->
numpoöts
;i++)

435 
	`g_‰ì
(
ãmp_h™dÀs
[
i
]);

436 
	`g_‰ì
(
ãmp_h™dÀs
);

438 
	`g_‰ì
(
pﬁy
->
poöts
);

439 
	}
}

443 
	$pﬁyc⁄n_ßve
(
PﬁyC⁄n
 *
pﬁy
, 
Obje˘Node
 
obj_node
)

445 
i
;

446 
AâribuãNode
 
©å
;

448 
	`obje˘_ßve
(&
pﬁy
->
obje˘
, 
obj_node
);

450 
©å
 = 
	`√w_©åibuã
(
obj_node
, "poly_points");

452 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

453 
	`d©a_add_poöt
(
©å
, &
pﬁy
->
poöts
[
i
]);

455 
	}
}

458 
	$pﬁyc⁄n_lﬂd
(
PﬁyC⁄n
 *
pﬁy
, 
Obje˘Node
 
obj_node
)

460 
i
;

461 
AâribuãNode
 
©å
;

462 
D©aNode
 
d©a
;

464 
DüObje˘
 *
obj
 = &
pﬁy
->
obje˘
;

466 
	`obje˘_lﬂd
(
obj
, 
obj_node
);

468 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "poly_points");

470 i‡(
©å
 !
NULL
)

471 
pﬁy
->
numpoöts
 = 
	`©åibuã_num_d©a
(
©å
);

473 
pﬁy
->
numpoöts
 = 0;

475 
	`obje˘_öô
(
obj
, 
pﬁy
->
numpoöts
, 0);

477 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

478 
pﬁy
->
poöts
 = 
	`g_mÆloc
’ﬁy->
numpoöts
*(
Poöt
));

479 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

480 
	`d©a_poöt
(
d©a
, &
pﬁy
->
poöts
[
i
]);

481 
d©a
 = 
	`d©a_√xt
(data);

484 
obj
->
h™dÀs
[0] = 
	`g_mÆloc
((
H™dÀ
));

485 
obj
->
h™dÀs
[0]->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

486 
obj
->
h™dÀs
[0]->
c⁄√˘ed_to
 = 
NULL
;

487 
obj
->
h™dÀs
[0]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

488 
obj
->
h™dÀs
[0]->
id
 = 
HANDLE_MOVE_STARTPOINT
;

490 
obj
->
h™dÀs
[
pﬁy
->
numpoöts
-1] = 
	`g_mÆloc
((
H™dÀ
));

491 
obj
->
h™dÀs
[
pﬁy
->
numpoöts
-1]->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

492 
obj
->
h™dÀs
[
pﬁy
->
numpoöts
-1]->
c⁄√˘ed_to
 = 
NULL
;

493 
obj
->
h™dÀs
[
pﬁy
->
numpoöts
-1]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

494 
obj
->
h™dÀs
[
pﬁy
->
numpoöts
-1]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

496 
i
=1;i<
pﬁy
->
numpoöts
-1;i++) {

497 
obj
->
h™dÀs
[
i
] = 
	`g_mÆloc
((
H™dÀ
));

498 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[
i
], 
PC_HANDLE_CORNER
);

501 
	`pﬁyc⁄n_upd©e_d©a
(
pﬁy
);

502 
	}
}

505 
	$pﬁyc⁄n_ch™ge_‰ì
(
PoötCh™ge
 *
ch™ge
)

507 i‡–(
ch™ge
->
ty≥
==
TYPE_ADD_POINT
 && !ch™ge->
≠∂õd
) ||

508 (
ch™ge
->
ty≥
==
TYPE_REMOVE_POINT
 && ch™ge->
≠∂õd
) ){

509 i‡(
ch™ge
->
h™dÀ
)

510 
	`g_‰ì
(
ch™ge
->
h™dÀ
);

511 
ch™ge
->
h™dÀ
 = 
NULL
;

513 
	}
}

516 
	$pﬁyc⁄n_ch™ge_≠∂y
(
PoötCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

518 
ch™ge
->
≠∂õd
 = 1;

519 
ch™ge
->
ty≥
) {

520 
TYPE_ADD_POINT
:

521 
	`add_h™dÀ
((
PﬁyC⁄n
 *)
obj
, 
ch™ge
->
pos
, &ch™ge->
poöt
,

522 
ch™ge
->
h™dÀ
);

524 
TYPE_REMOVE_POINT
:

525 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ
);

526 
	`ªmove_h™dÀ
((
PﬁyC⁄n
 *)
obj
, 
ch™ge
->
pos
);

529 
	}
}

532 
	$pﬁyc⁄n_ch™ge_ªvît
(
PoötCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

534 
ch™ge
->
ty≥
) {

535 
TYPE_ADD_POINT
:

536 
	`ªmove_h™dÀ
((
PﬁyC⁄n
 *)
obj
, 
ch™ge
->
pos
);

538 
TYPE_REMOVE_POINT
:

539 
	`add_h™dÀ
((
PﬁyC⁄n
 *)
obj
, 
ch™ge
->
pos
, &ch™ge->
poöt
,

540 
ch™ge
->
h™dÀ
);

541 i‡(
ch™ge
->
c⁄√˘ed_to
) {

542 
	`obje˘_c⁄√˘
(
obj
, 
ch™ge
->
h™dÀ
, ch™ge->
c⁄√˘ed_to
);

547 
ch™ge
->
≠∂õd
 = 0;

548 
	}
}

550 
Obje˘Ch™ge
 *

551 
	$pﬁyc⁄n_¸óã_ch™ge
(
PﬁyC⁄n
 *
pﬁy
, 
ch™ge_ty≥
 
ty≥
,

552 
Poöt
 *
poöt
, 
pos
, 
H™dÀ
 *
h™dÀ
,

553 
C⁄√˘i⁄Poöt
 *
c⁄√˘ed_to
)

555 
PoötCh™ge
 *
ch™ge
;

557 
ch™ge
 = 
	`g_√w
(
PoötCh™ge
, 1);

559 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
pﬁyc⁄n_ch™ge_≠∂y
;

560 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
pﬁyc⁄n_ch™ge_ªvît
;

561 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
pﬁyc⁄n_ch™ge_‰ì
;

563 
ch™ge
->
ty≥
 =Åype;

564 
ch™ge
->
≠∂õd
 = 1;

565 
ch™ge
->
poöt
 = *point;

566 
ch™ge
->
pos
 =Öos;

567 
ch™ge
->
h™dÀ
 = handle;

568 
ch™ge
->
c⁄√˘ed_to
 = connected_to;

570  (
Obje˘Ch™ge
 *)
ch™ge
;

571 
	}
}

	@O:\tool\dvs50\lib\poly_conn.h

18 #i‚de‡
POLY_CONN_H


19 
	#POLY_CONN_H


	)

21 
	~"düty≥s.h
"

22 
	~"obje˘.h
"

23 
	~"boundögbox.h
"

25 
	#HANDLE_CORNER
 (
HANDLE_CUSTOM1
)

	)

30 
	s_PﬁyC⁄n
 {

32 
DüObje˘
 
	mobje˘
;

34 
	mnumpoöts
;

35 
Poöt
 *
	mpoöts
;

37 
PﬁyBBExåas
 
	mexåa_•acög
;

41 
DIAVAR
 
pﬁyc⁄n_upd©e_d©a
(
PﬁyC⁄n
 *
pﬁy
);

42 
DIAVAR
 
pﬁyc⁄n_upd©e_boundögbox
(
PﬁyC⁄n
 *
pﬁy
);

43 
DIAVAR
 
pﬁyc⁄n_sim∂e_døw
(
PﬁyC⁄n
 *
pﬁy
, 
DüRídîî
 *
ªndîî
, 
ªÆ
 
width
);

44 
DIAVAR
 
pﬁyc⁄n_öô
(
PﬁyC⁄n
 *
pﬁy
, 
num_poöts
);

45 
DIAVAR
 
pﬁyc⁄n_£t_poöts
(
PﬁyC⁄n
 *
pﬁy
, 
num_poöts
, 
Poöt
 *
poöts
);

46 
DIAVAR
 
pﬁyc⁄n_de°roy
(
PﬁyC⁄n
 *
pﬁy
);

47 
DIAVAR
 
pﬁyc⁄n_c›y
(
PﬁyC⁄n
 *
‰om
, PﬁyC⁄¿*
to
);

48 
DIAVAR
 
pﬁyc⁄n_ßve
(
PﬁyC⁄n
 *
pﬁy
, 
Obje˘Node
 
obj_node
);

49 
DIAVAR
 
pﬁyc⁄n_lﬂd
(
PﬁyC⁄n
 *
pﬁy
, 
Obje˘Node
 
obj_node
);

50 
DIAVAR
 
Obje˘Ch™ge
 *
pﬁyc⁄n_add_poöt
(
PﬁyC⁄n
 *
pﬁy
, 
£gmít
, 
Poöt
 *
poöt
);

51 
DIAVAR
 
Obje˘Ch™ge
 *
pﬁyc⁄n_ªmove_poöt
(
PﬁyC⁄n
 *
pﬁy
, 
poöt
);

52 
DIAVAR
 
Obje˘Ch™ge
 *
pﬁyc⁄n_move_h™dÀ
(
PﬁyC⁄n
 *
pﬁy
, 
H™dÀ
 *
id
,

53 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

54 
H™dÀMoveRós⁄
 
ªas⁄
,

55 
ModifõrKeys
 
modifõrs
);

56 
DIAVAR
 
Obje˘Ch™ge
 *
pﬁyc⁄n_move
(
PﬁyC⁄n
 *
pﬁy
, 
Poöt
 *
to
);

57 
DIAVAR
 
ªÆ
 
pﬁyc⁄n_di°™˚_‰om
(
PﬁyC⁄n
 *
pﬁy
, 
Poöt
 *
poöt
,

58 
ªÆ
 
löe_width
);

59 
DIAVAR
 
H™dÀ
 *
pﬁyc⁄n_˛o£°_h™dÀ
(
PﬁyC⁄n
 *
pﬁy
, 
Poöt
 *
poöt
);

60 
DIAVAR
 
pﬁyc⁄n_˛o£°_£gmít
(
PﬁyC⁄n
 *
pﬁy
, 
Poöt
 *
poöt
,

61 
ªÆ
 
löe_width
);

63 
	#POLYCONN_COMMON_PROPERTIES
 \

64 
OBJECT_COMMON_PROPERTIES
, \

65 { "pﬁy_poöts", 
PROP_TYPE_POINTARRAY
, 0, "pﬁc⁄¿poöts", 
NULL
} \

66 

	)

67 
	#POLYCONN_COMMON_PROPERTIES_OFFSETS
 \

68 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

69 { "pﬁy_poöts", 
PROP_TYPE_POINTARRAY
, \

70 
	`off£tof
(
PﬁyC⁄n
,
poöts
), off£tof(PﬁyC⁄n,
numpoöts
)} \

71 

	)

	@O:\tool\dvs50\lib\polyshape.c

19 
	~<c⁄fig.h
>

21 
	~<°dio.h
>

22 
	~<°dlib.h
>

23 
	~<as£π.h
>

24 
	~<m©h.h
>

25 
	~<°rög.h
>

27 
	~"pﬁysh≠e.h
"

28 
	~"mesßge.h
"

29 
	~"düªndîî.h
"

31 
	#NUM_CONNECTIONS
(
pﬁy
Ë(’ﬁy)->
numpoöts
 * 2 + 1)

	)

33 
	ech™ge_ty≥
 {

34 
	mTYPE_ADD_POINT
,

35 
	mTYPE_REMOVE_POINT


38 
	sPoötCh™ge
 {

39 
Obje˘Ch™ge
 
	mobj_ch™ge
;

41 
ch™ge_ty≥
 
	mty≥
;

42 
	m≠∂õd
;

44 
Poöt
 
	mpoöt
;

45 
	mpos
;

47 
H™dÀ
 *
	mh™dÀ
;

49 
C⁄√˘i⁄Poöt
 *
	m˝1
, *
	m˝2
;

52 
Obje˘Ch™ge
 *

53 
pﬁysh≠e_¸óã_ch™ge
(
PﬁySh≠e
 *
pﬁy
, 
ch™ge_ty≥
 
ty≥
,

54 
Poöt
 *
poöt
, 
£gmít
, 
H™dÀ
 *
h™dÀ
,

55 
C⁄√˘i⁄Poöt
 *
˝1
, C⁄√˘i⁄Poöà*
˝2
);

57 
	$£tup_h™dÀ
(
H™dÀ
 *
h™dÀ
)

59 
h™dÀ
->
id
 = 
HANDLE_CORNER
;

60 
h™dÀ
->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

61 
h™dÀ
->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

62 
h™dÀ
->
c⁄√˘ed_to
 = 
NULL
;

63 
	}
}

66 
	$gë_h™dÀ_ƒ
(
PﬁySh≠e
 *
pﬁy
, 
H™dÀ
 *
h™dÀ
)

68 
i
 = 0;

69 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

70 i‡(
pﬁy
->
obje˘
.
h™dÀs
[
i
] =
h™dÀ
)

71  
i
;

74 
	}
}

76 
Obje˘Ch™ge
*

77 
	$pﬁysh≠e_move_h™dÀ
(
PﬁySh≠e
 *
pﬁy
, 
H™dÀ
 *
h™dÀ
,

78 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

79 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

81 
h™dÀ_ƒ
;

83 
h™dÀ_ƒ
 = 
	`gë_h™dÀ_ƒ
(
pﬁy
, 
h™dÀ
);

84 
pﬁy
->
poöts
[
h™dÀ_ƒ
] = *
to
;

86  
NULL
;

87 
	}
}

89 
Obje˘Ch™ge
*

90 
	$pﬁysh≠e_move
(
PﬁySh≠e
 *
pﬁy
, 
Poöt
 *
to
)

92 
Poöt
 
p
;

93 
i
;

95 
p
 = *
to
;

96 
	`poöt_sub
(&
p
, &
pﬁy
->
poöts
[0]);

98 
pﬁy
->
poöts
[0] = *
to
;

99 
i
=1;i<
pﬁy
->
numpoöts
;i++) {

100 
	`poöt_add
(&
pﬁy
->
poöts
[
i
], &
p
);

103  
NULL
;

104 
	}
}

107 
	$pﬁysh≠e_˛o£°_£gmít
(
PﬁySh≠e
 *
pﬁy
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

109 
i
;

110 
ªÆ
 
di°
;

111 
˛o£°
;

113 
di°
 = 
	`di°™˚_löe_poöt
–&
pﬁy
->
poöts
[pﬁy->
numpoöts
-1], &poly->points[0],

114 
löe_width
, 
poöt
);

115 
˛o£°
 = 
pﬁy
->
numpoöts
-1;

116 
i
=0;i<
pﬁy
->
numpoöts
-1;i++) {

117 
ªÆ
 
√w_di°
 =

118 
	`di°™˚_löe_poöt
–&
pﬁy
->
poöts
[
i
], &poly->points[i+1],

119 
löe_width
, 
poöt
);

120 i‡(
√w_di°
 < 
di°
) {

121 
di°
 = 
√w_di°
;

122 
˛o£°
 = 
i
;

125  
˛o£°
;

126 
	}
}

128 
H™dÀ
 *

129 
	$pﬁysh≠e_˛o£°_h™dÀ
(
PﬁySh≠e
 *
pﬁy
, 
Poöt
 *
poöt
)

131 
i
;

132 
ªÆ
 
di°
;

133 
H™dÀ
 *
˛o£°
;

135 
˛o£°
 = 
pﬁy
->
obje˘
.
h™dÀs
[0];

136 
di°
 = 
	`di°™˚_poöt_poöt
–
poöt
, &
˛o£°
->
pos
);

137 
i
=1;i<
pﬁy
->
numpoöts
;i++) {

138 
ªÆ
 
√w_di°
;

139 
√w_di°
 = 
	`di°™˚_poöt_poöt
–
poöt
, &
pﬁy
->
poöts
[
i
]);

140 i‡(
√w_di°
 < 
di°
) {

141 
di°
 = 
√w_di°
;

142 
˛o£°
 = 
pﬁy
->
obje˘
.
h™dÀs
[
i
];

145  
˛o£°
;

146 
	}
}

148 
ªÆ


149 
	$pﬁysh≠e_di°™˚_‰om
(
PﬁySh≠e
 *
pﬁy
, 
Poöt
 *
poöt
, 
ªÆ
 
löe_width
)

151  
	`di°™˚_pﬁyg⁄_poöt
(
pﬁy
->
poöts
,Öﬁy->
numpoöts
,

152 
löe_width
, 
poöt
);

153 
	}
}

156 
	$add_h™dÀ
(
PﬁySh≠e
 *
pﬁy
, 
pos
, 
Poöt
 *
poöt
, 
H™dÀ
 *
h™dÀ
,

157 
C⁄√˘i⁄Poöt
 *
˝1
, C⁄√˘i⁄Poöà*
˝2
)

159 
i
;

160 
DüObje˘
 *
obj
;

162 
pﬁy
->
numpoöts
++;

163 
pﬁy
->
poöts
 = 
	`g_ªÆloc
’ﬁy->poöts,Öﬁy->
numpoöts
*(
Poöt
));

165 
i
=
pﬁy
->
numpoöts
-1; i > 
pos
; i--) {

166 
pﬁy
->
poöts
[
i
] =Öoly->points[i-1];

168 
pﬁy
->
poöts
[
pos
] = *
poöt
;

169 
	`obje˘_add_h™dÀ_©
((
DüObje˘
*)
pﬁy
, 
h™dÀ
, 
pos
);

170 
	`obje˘_add_c⁄√˘i⁄poöt_©
((
DüObje˘
*)
pﬁy
, 
˝1
, 2*
pos
);

171 
	`obje˘_add_c⁄√˘i⁄poöt_©
((
DüObje˘
*)
pﬁy
, 
˝2
, 2*
pos
+1);

173 
obj
 = (
DüObje˘
 *)
pﬁy
;

174 
	}
}

177 
	$ªmove_h™dÀ
(
PﬁySh≠e
 *
pﬁy
, 
pos
)

179 
i
;

180 
DüObje˘
 *
obj
;

181 
H™dÀ
 *
ﬁd_h™dÀ
;

182 
C⁄√˘i⁄Poöt
 *
ﬁd_˝1
, *
ﬁd_˝2
;

184 
obj
 = (
DüObje˘
 *)
pﬁy
;

187 
pﬁy
->
numpoöts
--;

188 
i
=
pos
; i < 
pﬁy
->
numpoöts
; i++) {

189 
pﬁy
->
poöts
[
i
] =Öoly->points[i+1];

191 
pﬁy
->
poöts
 = 
	`g_ªÆloc
’ﬁy->poöts,Öﬁy->
numpoöts
*(
Poöt
));

193 
ﬁd_h™dÀ
 = 
obj
->
h™dÀs
[
pos
];

194 
ﬁd_˝1
 = 
obj
->
c⁄√˘i⁄s
[2*
pos
];

195 
ﬁd_˝2
 = 
obj
->
c⁄√˘i⁄s
[2*
pos
+1];

196 
	`obje˘_ªmove_h™dÀ
(&
pﬁy
->
obje˘
, 
ﬁd_h™dÀ
);

197 
	`obje˘_ªmove_c⁄√˘i⁄poöt
(
obj
, 
ﬁd_˝1
);

198 
	`obje˘_ªmove_c⁄√˘i⁄poöt
(
obj
, 
ﬁd_˝2
);

199 
	}
}

204 
Obje˘Ch™ge
 *

205 
	$pﬁysh≠e_add_poöt
(
PﬁySh≠e
 *
pﬁy
, 
£gmít
, 
Poöt
 *
poöt
)

207 
Poöt
 
ªÆpoöt
;

208 
H™dÀ
 *
√w_h™dÀ
;

209 
C⁄√˘i⁄Poöt
 *
√w_˝1
, *
√w_˝2
;

211 i‡(
poöt
 =
NULL
) {

212 
ªÆpoöt
.
x
 = (
pﬁy
->
poöts
[
£gmít
].x+poly->points[segment+1].x)/2;

213 
ªÆpoöt
.
y
 = (
pﬁy
->
poöts
[
£gmít
].y+poly->points[segment+1].y)/2;

215 
ªÆpoöt
 = *
poöt
;

218 
√w_h™dÀ
 = 
	`g_√w
(
H™dÀ
, 1);

219 
√w_˝1
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

220 
√w_˝1
->
obje˘
 = &
pﬁy
->object;

221 
√w_˝2
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

222 
√w_˝2
->
obje˘
 = &
pﬁy
->object;

223 
	`£tup_h™dÀ
(
√w_h™dÀ
);

224 
	`add_h™dÀ
(
pﬁy
, 
£gmít
+1, &
ªÆpoöt
, 
√w_h™dÀ
, 
√w_˝1
, 
√w_˝2
);

225  
	`pﬁysh≠e_¸óã_ch™ge
(
pﬁy
, 
TYPE_ADD_POINT
,

226 &
ªÆpoöt
, 
£gmít
+1, 
√w_h™dÀ
,

227 
√w_˝1
, 
√w_˝2
);

228 
	}
}

230 
Obje˘Ch™ge
 *

231 
	$pﬁysh≠e_ªmove_poöt
(
PﬁySh≠e
 *
pﬁy
, 
pos
)

233 
H™dÀ
 *
ﬁd_h™dÀ
;

234 
C⁄√˘i⁄Poöt
 *
ﬁd_˝1
, *
ﬁd_˝2
;

235 
Poöt
 
ﬁd_poöt
;

237 
ﬁd_h™dÀ
 = 
pﬁy
->
obje˘
.
h™dÀs
[
pos
];

238 
ﬁd_poöt
 = 
pﬁy
->
poöts
[
pos
];

239 
ﬁd_˝1
 = 
pﬁy
->
obje˘
.
c⁄√˘i⁄s
[2*
pos
];

240 
ﬁd_˝2
 = 
pﬁy
->
obje˘
.
c⁄√˘i⁄s
[2*
pos
+1];

242 
	`obje˘_unc⁄√˘
((
DüObje˘
 *)
pﬁy
, 
ﬁd_h™dÀ
);

244 
	`ªmove_h™dÀ
(
pﬁy
, 
pos
);

246 
	`pﬁysh≠e_upd©e_d©a
(
pﬁy
);

248  
	`pﬁysh≠e_¸óã_ch™ge
(
pﬁy
, 
TYPE_REMOVE_POINT
,

249 &
ﬁd_poöt
, 
pos
, 
ﬁd_h™dÀ
,

250 
ﬁd_˝1
, 
ﬁd_˝2
);

251 
	}
}

255 
göt


256 
	$fú°_dúe˘i⁄
(
göt
 
dús
) {

257 
dús
) {

258 
DIR_NORTHEAST
:  
DIR_NORTH
;

259 
DIR_SOUTHEAST
:  
DIR_EAST
;

260 
DIR_NORTHWEST
:  
DIR_WEST
;

261 
DIR_SOUTHWEST
:  
DIR_SOUTH
;

262 :  
dús
;

264 
	}
}

268 
göt


269 
	$œ°_dúe˘i⁄
(
göt
 
dús
) {

270 
dús
) {

271 
DIR_NORTHEAST
:  
DIR_EAST
;

272 
DIR_SOUTHEAST
:  
DIR_SOUTH
;

273 
DIR_NORTHWEST
:  
DIR_NORTH
;

274 
DIR_SOUTHWEST
:  
DIR_WEST
;

275 :  
dús
;

277 
	}
}

280 
göt


281 
	$föd_tù_dúe˘i⁄s
(
Poöt
 
¥ev
, Poöà
this
, Poöà
√xt
)

283 
göt
 
°¨tdús
 = 
	`föd_¶›e_dúe˘i⁄s
(
¥ev
, 
this
);

284 
göt
 
íddús
 = 
	`föd_¶›e_dúe˘i⁄s
(
this
, 
√xt
);

285 
göt
 
fú°dú
 = 
	`fú°_dúe˘i⁄
(
°¨tdús
);

286 
göt
 
œ°dú
 = 
	`œ°_dúe˘i⁄
(
íddús
);

287 
göt
 
dú
, 
dús
 = 0;

289 
dú
 = 
fú°dú
;

290 
dú
 !
œ°dú
) {

291 
dús
 |
dú
;

292 
dú
 = dir * 2;

293 i‡(
dú
 == 16) dir = 1;

295 
dús
 |
dú
;

297  
dús
;

298 
	}
}

301 
	$pﬁysh≠e_upd©e_d©a
(
PﬁySh≠e
 *
pﬁy
)

303 
Poöt
 
√xt
;

304 
i
;

305 
DüObje˘
 *
obj
 = &
pﬁy
->
obje˘
;

306 
Poöt
 
möp
, 
maxp
;

309 i‡(
pﬁy
->
numpoöts
 !
obj
->
num_h™dÀs
 ||

310 
	`NUM_CONNECTIONS
(
pﬁy
Ë!
obj
->
num_c⁄√˘i⁄s
) {

311 
	`obje˘_unc⁄√˘_Æl
(
obj
);

313 
obj
->
h™dÀs
 = 
	`g_ªÆloc
(obj->handles,

314 
pﬁy
->
numpoöts
*(
H™dÀ
 *));

315 
obj
->
num_h™dÀs
 = 
pﬁy
->
numpoöts
;

316 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

317 
obj
->
h™dÀs
[
i
] = 
	`g_√w
(
H™dÀ
, 1);

318 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[
i
]);

321 
obj
->
c⁄√˘i⁄s
 = 
	`g_ªÆloc
(obj->connections,

322 
	`NUM_CONNECTIONS
(
pﬁy
Ë* (
C⁄√˘i⁄Poöt
 *));

323 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pﬁy
); i++) {

324 
obj
->
c⁄√˘i⁄s
[
i
] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

325 
obj
->
c⁄√˘i⁄s
[
i
]->
obje˘
 = obj;

327 
obj
->
num_c⁄√˘i⁄s
 = 
	`NUM_CONNECTIONS
(
pﬁy
);

331 
möp
 = 
maxp
 = 
pﬁy
->
poöts
[0];

332 
i
 = 0; i < 
pﬁy
->
numpoöts
; i++) {

333 
göt
 
thisdú
, 
√xtdú
;

334 
Poöt
 
¥ev
;

335 
obj
->
h™dÀs
[
i
]->
pos
 = 
pﬁy
->
poöts
[i];

337 i‡(
i
 == 0)

338 
¥ev
 = 
pﬁy
->
poöts
[pﬁy->
numpoöts
-1];

340 
¥ev
 = 
pﬁy
->
poöts
[
i
-1];

341 i‡(
i
 =
pﬁy
->
numpoöts
 - 1)

342 
√xt
 = 
pﬁy
->
poöts
[0];

344 
√xt
 = 
pﬁy
->
poöts
[
i
+1];

345 
	`poöt_add
(&
√xt
, &
pﬁy
->
poöts
[
i
]);

346 
	`poöt_sˇÀ
(&
√xt
, 0.5);

348 
thisdú
 = 
	`föd_tù_dúe˘i⁄s
(
¥ev
, 
pﬁy
->
poöts
[
i
], 
√xt
);

349 
√xtdú
 = 
	`föd_¶›e_dúe˘i⁄s
(
pﬁy
->
poöts
[
i
], 
√xt
);

351 
obj
->
c⁄√˘i⁄s
[2*
i
]->
pos
 = 
pﬁy
->
poöts
[i];

352 
obj
->
c⁄√˘i⁄s
[2*
i
]->
dúe˘i⁄s
 = 
thisdú
;

353 
obj
->
c⁄√˘i⁄s
[2*
i
+1]->
pos
 = 
√xt
;

354 
obj
->
c⁄√˘i⁄s
[2*
i
+1]->
dúe˘i⁄s
 = 
√xtdú
;

356 i‡(
pﬁy
->
poöts
[
i
].
x
 < 
möp
.x) minp.x =Öoly->points[i].x;

357 i‡(
pﬁy
->
poöts
[
i
].
x
 > 
maxp
.x) maxp.x =Öoly->points[i].x;

358 i‡(
pﬁy
->
poöts
[
i
].
y
 < 
möp
.y) minp.y =Öoly->points[i].y;

359 i‡(
pﬁy
->
poöts
[
i
].
y
 > 
maxp
.y) maxp.y =Öoly->points[i].y;

362 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1]->
pos
.
x
 = (
möp
.x + 
maxp
.x) / 2;

363 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1]->
pos
.
y
 = (
möp
.y + 
maxp
.y) / 2;

364 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1]->
dúe˘i⁄s
 = 
DIR_ALL
;

365 
	}
}

368 
	$pﬁysh≠e_upd©e_boundögbox
(
PﬁySh≠e
 *
pﬁy
)

370 
EÀmítBBExåas
 *
exåa
;

371 
PﬁyBBExåas
 
≥xåa
;

373 
	`as£π
(
pﬁy
 !
NULL
);

375 
exåa
 = &
pﬁy
->
exåa_•acög
;

376 
≥xåa
.
°¨t_å™s
 =Öexåa.
íd_å™s
 =

377 
≥xåa
.
°¨t_l⁄g
 =Öexåa.
íd_l⁄g
 = 0;

378 
≥xåa
.
middÀ_å™s
 = 
exåa
->
b‹dî_å™s
;

380 
	`pﬁylöe_bbox
(&
pﬁy
->
poöts
[0],

381 
pﬁy
->
numpoöts
,

382 &
≥xåa
, 
TRUE
,

383 &
pﬁy
->
obje˘
.
boundög_box
);

384 
	}
}

387 
	$pﬁysh≠e_sim∂e_døw
(
PﬁySh≠e
 *
pﬁy
, 
DüRídîî
 *
ªndîî
, 
ªÆ
 
width
)

389 
Poöt
 *
poöts
;

391 
	`as£π
(
pﬁy
 !
NULL
);

392 
	`as£π
(
ªndîî
 !
NULL
);

394 
poöts
 = &
pﬁy
->points[0];

396 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
width
);

397 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

398 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_ROUND
);

399 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_BUTT
);

401 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_pﬁyg⁄
‘ídîî, 
poöts
, 
pﬁy
->
numpoöts
,

402 &
cﬁ‹_bœck
);

403 
	}
}

407 
	$pﬁysh≠e_öô
(
PﬁySh≠e
 *
pﬁy
, 
num_poöts
)

409 
DüObje˘
 *
obj
;

410 
i
;

412 
obj
 = &
pﬁy
->
obje˘
;

414 
	`obje˘_öô
(
obj
, 
num_poöts
, 2 *Çum_points + 1);

416 
pﬁy
->
numpoöts
 = 
num_poöts
;

418 
pﬁy
->
poöts
 = 
	`g_mÆloc
(
num_poöts
*(
Poöt
));

420 
i
 = 0; i < 
num_poöts
; i++) {

421 
obj
->
h™dÀs
[
i
] = 
	`g_√w
(
H™dÀ
, 1);

423 
obj
->
h™dÀs
[
i
]->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

424 
obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 = 
NULL
;

425 
obj
->
h™dÀs
[
i
]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

426 
obj
->
h™dÀs
[
i
]->
id
 = 
HANDLE_CORNER
;

429 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pﬁy
); i++) {

430 
obj
->
c⁄√˘i⁄s
[
i
] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

431 
obj
->
c⁄√˘i⁄s
[
i
]->
obje˘
 = &
pﬁy
->object;

432 
obj
->
c⁄√˘i⁄s
[
i
]->
Êags
 = 0;

434 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
 - 1]->
Êags
 = 
CP_FLAGS_MAIN
;

440 
	}
}

443 
	$pﬁysh≠e_£t_poöts
(
PﬁySh≠e
 *
pﬁy
, 
num_poöts
, 
Poöt
 *
poöts
)

445 
i
;

447 
pﬁy
->
numpoöts
 = 
num_poöts
;

449 i‡(
pﬁy
->
poöts
Ë
	`g_‰ì
(poly->points);

450 
pﬁy
->
poöts
 = 
	`g_√w
(
Poöt
, 
num_poöts
);

452 
i
 = 0; i < 
num_poöts
; i++) {

453 
pﬁy
->
poöts
[
i
] =Öoints[i];

455 
	}
}

458 
	$pﬁysh≠e_c›y
(
PﬁySh≠e
 *
‰om
, PﬁySh≠ê*
to
)

460 
i
;

461 
DüObje˘
 *
toobj
, *
‰omobj
;

463 
toobj
 = &
to
->
obje˘
;

464 
‰omobj
 = &
‰om
->
obje˘
;

466 
	`obje˘_c›y
(
‰omobj
, 
toobj
);

468 
	`pﬁysh≠e_£t_poöts
(
to
, 
‰om
->
numpoöts
, from->
poöts
);

470 
i
=0;i<
to
->
numpoöts
;i++) {

471 
toobj
->
h™dÀs
[
i
] = 
	`g_√w
(
H™dÀ
, 1);

472 
	`£tup_h™dÀ
(
toobj
->
h™dÀs
[
i
]);

473 
toobj
->
c⁄√˘i⁄s
[2*
i
] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

474 
toobj
->
c⁄√˘i⁄s
[2*
i
]->
obje˘
 = &
to
->object;

475 
toobj
->
c⁄√˘i⁄s
[2*
i
+1] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

476 
toobj
->
c⁄√˘i⁄s
[2*
i
+1]->
obje˘
 = &
to
->object;

478 
toobj
->
c⁄√˘i⁄s
[toobj->
num_c⁄√˘i⁄s
 - 1] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

479 
toobj
->
c⁄√˘i⁄s
[toobj->
num_c⁄√˘i⁄s
 - 1]->
obje˘
 = &
to
->object;

481 
	`mem˝y
(&
to
->
exåa_•acög
,&
‰om
->extra_spacing,(to->extra_spacing));

482 
	`pﬁysh≠e_upd©e_d©a
(
to
);

483 
	}
}

486 
	$pﬁysh≠e_de°roy
(
PﬁySh≠e
 *
pﬁy
)

488 
i
;

489 
H™dÀ
 **
ãmp_h™dÀs
;

490 
C⁄√˘i⁄Poöt
 **
ãmp_˝s
;

494 
ãmp_h™dÀs
 = 
	`g_√w
(
H™dÀ
 *, 
pﬁy
->
numpoöts
);

495 
i
=0;i<
pﬁy
->
numpoöts
;i++)

496 
ãmp_h™dÀs
[
i
] = 
pﬁy
->
obje˘
.
h™dÀs
[i];

498 
ãmp_˝s
 = 
	`g_√w
(
C⁄√˘i⁄Poöt
 *, 
	`NUM_CONNECTIONS
(
pﬁy
));

499 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pﬁy
); i++)

500 
ãmp_˝s
[
i
] = 
pﬁy
->
obje˘
.
c⁄√˘i⁄s
[i];

502 
	`obje˘_de°roy
(&
pﬁy
->
obje˘
);

504 
i
=0;i<
pﬁy
->
numpoöts
;i++)

505 
	`g_‰ì
(
ãmp_h™dÀs
[
i
]);

506 
	`g_‰ì
(
ãmp_h™dÀs
);

507 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pﬁy
); i++)

508 
	`g_‰ì
(
ãmp_˝s
[
i
]);

509 
	`g_‰ì
(
ãmp_˝s
);

511 
	`g_‰ì
(
pﬁy
->
poöts
);

512 
	}
}

516 
	$pﬁysh≠e_ßve
(
PﬁySh≠e
 *
pﬁy
, 
Obje˘Node
 
obj_node
)

518 
i
;

519 
AâribuãNode
 
©å
;

521 
	`obje˘_ßve
(&
pﬁy
->
obje˘
, 
obj_node
);

523 
©å
 = 
	`√w_©åibuã
(
obj_node
, "poly_points");

525 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

526 
	`d©a_add_poöt
(
©å
, &
pﬁy
->
poöts
[
i
]);

528 
	}
}

531 
	$pﬁysh≠e_lﬂd
(
PﬁySh≠e
 *
pﬁy
, 
Obje˘Node
 
obj_node
)

533 
i
;

534 
AâribuãNode
 
©å
;

535 
D©aNode
 
d©a
;

537 
DüObje˘
 *
obj
 = &
pﬁy
->
obje˘
;

539 
	`obje˘_lﬂd
(
obj
, 
obj_node
);

541 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "poly_points");

543 i‡(
©å
 !
NULL
)

544 
pﬁy
->
numpoöts
 = 
	`©åibuã_num_d©a
(
©å
);

546 
pﬁy
->
numpoöts
 = 0;

548 
	`obje˘_öô
(
obj
, 
pﬁy
->
numpoöts
, 
	`NUM_CONNECTIONS
(poly));

550 
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
);

551 
pﬁy
->
poöts
 = 
	`g_√w
(
Poöt
,Öﬁy->
numpoöts
);

552 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

553 
	`d©a_poöt
(
d©a
, &
pﬁy
->
poöts
[
i
]);

554 
d©a
 = 
	`d©a_√xt
(data);

557 
i
=0;i<
pﬁy
->
numpoöts
;i++) {

558 
obj
->
h™dÀs
[
i
] = 
	`g_√w
(
H™dÀ
, 1);

559 
	`£tup_h™dÀ
(
obj
->
h™dÀs
[
i
]);

561 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pﬁy
); i++) {

562 
obj
->
c⁄√˘i⁄s
[
i
] = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

563 
obj
->
c⁄√˘i⁄s
[
i
]->
obje˘
 = obj;

565 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
 - 1]->
Êags
 = 
CP_FLAGS_MAIN
;

567 
	`pﬁysh≠e_upd©e_d©a
(
pﬁy
);

568 
	}
}

571 
	$pﬁysh≠e_ch™ge_‰ì
(
PoötCh™ge
 *
ch™ge
)

573 i‡–(
ch™ge
->
ty≥
==
TYPE_ADD_POINT
 && !ch™ge->
≠∂õd
) ||

574 (
ch™ge
->
ty≥
==
TYPE_REMOVE_POINT
 && ch™ge->
≠∂õd
) ){

575 
	`g_‰ì
(
ch™ge
->
h™dÀ
);

576 
	`g_‰ì
(
ch™ge
->
˝1
);

577 
	`g_‰ì
(
ch™ge
->
˝2
);

578 
ch™ge
->
h™dÀ
 = 
NULL
;

579 
ch™ge
->
˝1
 = 
NULL
;

580 
ch™ge
->
˝2
 = 
NULL
;

582 
	}
}

585 
	$pﬁysh≠e_ch™ge_≠∂y
(
PoötCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

587 
ch™ge
->
≠∂õd
 = 1;

588 
ch™ge
->
ty≥
) {

589 
TYPE_ADD_POINT
:

590 
	`add_h™dÀ
((
PﬁySh≠e
 *)
obj
, 
ch™ge
->
pos
, &ch™ge->
poöt
,

591 
ch™ge
->
h™dÀ
, ch™ge->
˝1
, ch™ge->
˝2
);

593 
TYPE_REMOVE_POINT
:

594 
	`obje˘_unc⁄√˘
(
obj
, 
ch™ge
->
h™dÀ
);

595 
	`ªmove_h™dÀ
((
PﬁySh≠e
 *)
obj
, 
ch™ge
->
pos
);

598 
	}
}

601 
	$pﬁysh≠e_ch™ge_ªvît
(
PoötCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

603 
ch™ge
->
ty≥
) {

604 
TYPE_ADD_POINT
:

605 
	`ªmove_h™dÀ
((
PﬁySh≠e
 *)
obj
, 
ch™ge
->
pos
);

607 
TYPE_REMOVE_POINT
:

608 
	`add_h™dÀ
((
PﬁySh≠e
 *)
obj
, 
ch™ge
->
pos
, &ch™ge->
poöt
,

609 
ch™ge
->
h™dÀ
, ch™ge->
˝1
, ch™ge->
˝2
);

613 
ch™ge
->
≠∂õd
 = 0;

614 
	}
}

616 
Obje˘Ch™ge
 *

617 
	$pﬁysh≠e_¸óã_ch™ge
(
PﬁySh≠e
 *
pﬁy
, 
ch™ge_ty≥
 
ty≥
,

618 
Poöt
 *
poöt
, 
pos
, 
H™dÀ
 *
h™dÀ
,

619 
C⁄√˘i⁄Poöt
 *
˝1
, C⁄√˘i⁄Poöà*
˝2
)

621 
PoötCh™ge
 *
ch™ge
;

623 
ch™ge
 = 
	`g_√w
(
PoötCh™ge
, 1);

625 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
pﬁysh≠e_ch™ge_≠∂y
;

626 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
pﬁysh≠e_ch™ge_ªvît
;

627 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
pﬁysh≠e_ch™ge_‰ì
;

629 
ch™ge
->
ty≥
 =Åype;

630 
ch™ge
->
≠∂õd
 = 1;

631 
ch™ge
->
poöt
 = *point;

632 
ch™ge
->
pos
 =Öos;

633 
ch™ge
->
h™dÀ
 = handle;

634 
ch™ge
->
˝1
 = cp1;

635 
ch™ge
->
˝2
 = cp2;

637  (
Obje˘Ch™ge
 *)
ch™ge
;

638 
	}
}

	@O:\tool\dvs50\lib\polyshape.h

18 #i‚de‡
POLYSHAPE_H


19 
	#POLYSHAPE_H


	)

21 
	~"düty≥s.h
"

22 
	~"obje˘.h
"

23 
	~"boundögbox.h
"

25 
	#HANDLE_CORNER
 (
HANDLE_CUSTOM1
)

	)

30 
	s_PﬁySh≠e
 {

32 
DüObje˘
 
	mobje˘
;

34 
	mnumpoöts
;

35 
Poöt
 *
	mpoöts
;

37 
EÀmítBBExåas
 
	mexåa_•acög
;

40 
DIAVAR
 
pﬁysh≠e_upd©e_d©a
(
PﬁySh≠e
 *
pﬁy
);

41 
DIAVAR
 
pﬁysh≠e_upd©e_boundögbox
(
PﬁySh≠e
 *
pﬁy
);

42 
DIAVAR
 
pﬁysh≠e_sim∂e_døw
(
PﬁySh≠e
 *
pﬁy
, 
DüRídîî
 *
ªndîî
, 
ªÆ
 
width
);

43 
DIAVAR
 
pﬁysh≠e_öô
(
PﬁySh≠e
 *
pﬁy
, 
num_poöts
);

44 
DIAVAR
 
pﬁysh≠e_£t_poöts
(
PﬁySh≠e
 *
pﬁy
, 
num_poöts
, 
Poöt
 *
poöts
);

45 
DIAVAR
 
pﬁysh≠e_de°roy
(
PﬁySh≠e
 *
pﬁy
);

46 
DIAVAR
 
pﬁysh≠e_c›y
(
PﬁySh≠e
 *
‰om
, PﬁySh≠ê*
to
);

47 
DIAVAR
 
pﬁysh≠e_ßve
(
PﬁySh≠e
 *
pﬁy
, 
Obje˘Node
 
obj_node
);

48 
DIAVAR
 
pﬁysh≠e_lﬂd
(
PﬁySh≠e
 *
pﬁy
, 
Obje˘Node
 
obj_node
);

49 
DIAVAR
 
Obje˘Ch™ge
 *
pﬁysh≠e_add_poöt
(
PﬁySh≠e
 *
pﬁy
, 
£gmít
, 
Poöt
 *
poöt
);

50 
DIAVAR
 
Obje˘Ch™ge
 *
pﬁysh≠e_ªmove_poöt
(
PﬁySh≠e
 *
pﬁy
, 
poöt
);

51 
DIAVAR
 
Obje˘Ch™ge
 *
pﬁysh≠e_move_h™dÀ
(
PﬁySh≠e
 *
pﬁy
, 
H™dÀ
 *
id
,

52 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

53 
H™dÀMoveRós⁄
 
ªas⁄
,

54 
ModifõrKeys
 
modifõrs
);

55 
DIAVAR
 
Obje˘Ch™ge
 *
pﬁysh≠e_move
(
PﬁySh≠e
 *
pﬁy
, 
Poöt
 *
to
);

56 
DIAVAR
 
ªÆ
 
pﬁysh≠e_di°™˚_‰om
(
PﬁySh≠e
 *
pﬁy
, 
Poöt
 *
poöt
,

57 
ªÆ
 
löe_width
);

58 
DIAVAR
 
H™dÀ
 *
pﬁysh≠e_˛o£°_h™dÀ
(
PﬁySh≠e
 *
pﬁy
, 
Poöt
 *
poöt
);

59 
DIAVAR
 
pﬁysh≠e_˛o£°_£gmít
(
PﬁySh≠e
 *
pﬁy
, 
Poöt
 *
poöt
,

60 
ªÆ
 
löe_width
);

62 
	#POLYSHAPE_COMMON_PROPERTIES
 \

63 
OBJECT_COMMON_PROPERTIES
, \

64 { "pﬁy_poöts", 
PROP_TYPE_POINTARRAY
, 0, "pﬁysh≠êpoöts", 
NULL
} \

65 

	)

66 
	#POLYSHAPE_COMMON_PROPERTIES_OFFSETS
 \

67 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

68 { "pﬁy_poöts", 
PROP_TYPE_POINTARRAY
, \

69 
	`off£tof
(
PﬁySh≠e
,
poöts
), off£tof(PﬁySh≠e,
numpoöts
)} \

70 

	)

	@O:\tool\dvs50\lib\prefs.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

22 
	~<°rög.h
>

24 
	~"¥efs.h
"

25 
	~"widgës.h
"

27 
DüUnô
 
	gÀngth_unô
 = 
DIA_UNIT_CENTIMETER
;

28 
DüUnô
 
	gf⁄tsize_unô
 = 
DIA_UNIT_POINT
;

31 
	$¥efs_£t_Àngth_unô
(
gch¨
* 
unô
) {

32 
GLi°
 *
«me_li°
 = 
	`gë_unôs_«me_li°
();

33 
i
;

35 
i
 = 0; 
«me_li°
 !
NULL
;Çame_li° = 
	`g_li°_√xt
(name_list), i++) {

36 i‡(!
	`°rcmp
(
unô
, (
gch¨
*Ë
«me_li°
->
d©a
)) {

37 
Àngth_unô
 = 
i
;

41 
Àngth_unô
 = 
DIA_UNIT_CENTIMETER
;

42 
	}
}

45 
	$¥efs_£t_f⁄tsize_unô
(
gch¨
* 
unô
) {

46 
GLi°
 *
«me_li°
 = 
	`gë_unôs_«me_li°
();

47 
i
;

49 
i
 = 0; 
«me_li°
 !
NULL
;Çame_li° = 
	`g_li°_√xt
(name_list), i++) {

50 i‡(!
	`°rcmp
(
unô
, (
gch¨
*Ë
«me_li°
->
d©a
)) {

51 
f⁄tsize_unô
 = 
i
;

55 
f⁄tsize_unô
 = 
DIA_UNIT_POINT
;

56 
	}
}

58 
DüUnô


59 
	$¥efs_gë_Àngth_unô
()

61  
Àngth_unô
;

62 
	}
}

64 
DüUnô


65 
	$¥efs_gë_f⁄tsize_unô
()

67  
f⁄tsize_unô
;

68 
	}
}

	@O:\tool\dvs50\lib\prefs.h

21 #i‚de‡
PREFS_H


22 
	#PREFS_H


	)

24 #ifde‡
HAVE_CONFIG_H


25 
	~<c⁄fig.h
>

28 
	~"düty≥s.h
"

29 
	~"widgës.h
"

31 
DIAVAR
 
¥efs_£t_Àngth_unô
(
gch¨
* 
unô
);

32 
DIAVAR
 
¥efs_£t_f⁄tsize_unô
(
gch¨
* 
unô
);

34 
DIAVAR
 
DüUnô
 
¥efs_gë_Àngth_unô
();

35 
DIAVAR
 
DüUnô
 
¥efs_gë_f⁄tsize_unô
();

	@O:\tool\dvs50\lib\prop_attr.c

25 #ifde‡
HAVE_CONFIG_H


26 
	~<c⁄fig.h
>

29 
	~<gtk/gtk.h
>

30 
	~"dü_xml.h
"

31 
	~"widgës.h
"

32 
	~"¥›îtõs.h
"

33 
	~"¥›öã∫Æs.h
"

34 
	~"dü¨rowchoo£r.h
"

40 
Löe°yÀPr›îty
 *

41 
	$löe°yÀ¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

42 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

44 
Löe°yÀPr›îty
 *
¥›
 = 
	`g_√w0
(LinestyleProperty,1);

45 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

46 
¥›
->
°yÀ
 = 
LINESTYLE_SOLID
;

47 
¥›
->
dash
 = 0.0;

48  
¥›
;

49 
	}
}

51 
Löe°yÀPr›îty
 *

52 
	$löe°yÀ¥›_c›y
(
Löe°yÀPr›îty
 *
§c
)

54 
Löe°yÀPr›îty
 *
¥›
 =

55 (
Löe°yÀPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

56 
§c
->
comm⁄
.
ªas⁄
);

57 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

58 
¥›
->
°yÀ
 = 
§c
->style;

59 
¥›
->
dash
 = 
§c
->dash;

60  
¥›
;

61 
	}
}

63 
WIDGET
 *

64 
	$löe°yÀ¥›_gë_widgë
(
Löe°yÀPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

66 
GtkWidgë
 *
ªt
 = 
	`dü_löe_°yÀ_£À˘‹_√w
();

67 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "value-changed");

68  
ªt
;

69 
	}
}

72 
	$löe°yÀ¥›_ª£t_widgë
(
Löe°yÀPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

74 
	`dü_löe_°yÀ_£À˘‹_£t_löe°yÀ
(
	`DIALINESTYLESELECTOR
(
widgë
),

75 
¥›
->
°yÀ
,

76 
¥›
->
dash
);

77 
	}
}

80 
	$löe°yÀ¥›_£t_‰om_widgë
(
Löe°yÀPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

82 
	`dü_löe_°yÀ_£À˘‹_gë_löe°yÀ
(
	`DIALINESTYLESELECTOR
(
widgë
),

83 &
¥›
->
°yÀ
,

84 &
¥›
->
dash
);

85 
	}
}

88 
	$löe°yÀ¥›_lﬂd
(
Löe°yÀPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

90 
¥›
->
°yÀ
 = 
	`d©a_íum
(
d©a
);

91 
¥›
->
dash
 = 1.0;

93 i‡(
¥›
->
°yÀ
 !
LINESTYLE_SOLID
) {

94 
d©a
 = 
	`d©a_√xt
(data);

95 i‡(
d©a
)

96 
¥›
->
dash
 = 
	`d©a_ªÆ
(
d©a
);

98 
Obje˘Node
 
obj_node
 = 
©å
->
∑ª¡
;

100 i‡((
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength")) &&

101 (
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
)))

102 
¥›
->
dash
 = 
	`d©a_ªÆ
(
d©a
);

105 
	}
}

108 
	$löe°yÀ¥›_ßve
(
Löe°yÀPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

110 
	`d©a_add_íum
(
©å
, 
¥›
->
°yÀ
);

111 
	`d©a_add_ªÆ
(
©å
, 
¥›
->
dash
);

118 
	}
}

121 
	$löe°yÀ¥›_gë_‰om_off£t
(
Löe°yÀPr›îty
 *
¥›
,

122 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

124 
¥›
->
°yÀ
 = 
	`°ru˘_membî
(
ba£
, 
off£t
, 
LöeStyÀ
);

125 
¥›
->
dash
 = 
	`°ru˘_membî
(
ba£
, 
off£t2
, 
ªÆ
);

126 
	}
}

129 
	$löe°yÀ¥›_£t_‰om_off£t
(
Löe°yÀPr›îty
 *
¥›
,

130 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

132 
	`°ru˘_membî
(
ba£
, 
off£t
, 
LöeStyÀ
Ë
¥›
->
°yÀ
;

133 
	`°ru˘_membî
(
ba£
, 
off£t2
, 
ªÆ
Ë
¥›
->
dash
;

134 
	}
}

136 c⁄° 
Pr›îtyOps
 
	glöe°yÀ¥›_›s
 = {

137 (
Pr›îtyTy≥_New
Ë
löe°yÀ¥›_√w
,

138 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

139 (
Pr›îtyTy≥_C›y
Ë
löe°yÀ¥›_c›y
,

140 (
Pr›îtyTy≥_Lﬂd
Ë
löe°yÀ¥›_lﬂd
,

141 (
Pr›îtyTy≥_Save
Ë
löe°yÀ¥›_ßve
,

142 (
Pr›îtyTy≥_GëWidgë
Ë
löe°yÀ¥›_gë_widgë
,

143 (
Pr›îtyTy≥_Re£tWidgë
Ë
löe°yÀ¥›_ª£t_widgë
,

144 (
Pr›îtyTy≥_SëFromWidgë
Ë
löe°yÀ¥›_£t_‰om_widgë
,

146 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

147 (
Pr›îtyTy≥_GëFromOff£t
Ë
löe°yÀ¥›_gë_‰om_off£t
,

148 (
Pr›îtyTy≥_SëFromOff£t
Ë
löe°yÀ¥›_£t_‰om_off£t


155 
AºowPr›îty
 *

156 
	$¨row¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

158 
AºowPr›îty
 *
¥›
 = 
	`g_√w0
(ArrowProperty,1);

159 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

160 
¥›
->
¨row_d©a
.
ty≥
 = 
ARROW_NONE
;

161 
¥›
->
¨row_d©a
.
Àngth
 = 0.0;

162 
¥›
->
¨row_d©a
.
width
 = 0.0;

163  
¥›
;

164 
	}
}

166 
AºowPr›îty
 *

167 
	$¨row¥›_c›y
(
AºowPr›îty
 *
§c
)

169 
AºowPr›îty
 *
¥›
 =

170 (
AºowPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

171 
§c
->
comm⁄
.
ªas⁄
);

172 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

173 
¥›
->
¨row_d©a
 = 
§c
->arrow_data;

174  
¥›
;

175 
	}
}

177 
WIDGET
 *

178 
	$¨row¥›_gë_widgë
(
AºowPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

180 
GtkWidgë
 *
ªt
 = 
	`dü_¨row_£À˘‹_√w
();

181 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "value-changed");

182  
ªt
;

183 
	}
}

186 
	$¨row¥›_ª£t_widgë
(
AºowPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

188 
	`dü_¨row_£À˘‹_£t_¨row
(
	`DIA_ARROW_SELECTOR
(
widgë
),

189 
¥›
->
¨row_d©a
);

190 
	}
}

193 
	$¨row¥›_£t_‰om_widgë
(
AºowPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

195 
¥›
->
¨row_d©a
 = 
	`dü_¨row_£À˘‹_gë_¨row
(
	`DIA_ARROW_SELECTOR
(
widgë
));

196 
	}
}

199 
	$¨row¥›_lﬂd
(
AºowPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

204 
¥›
->
¨row_d©a
.
ty≥
 = 
	`d©a_íum
(
d©a
);

205 
¥›
->
¨row_d©a
.
Àngth
 = 
DEFAULT_ARROW_SIZE
;

206 
¥›
->
¨row_d©a
.
width
 = 
DEFAULT_ARROW_SIZE
;

207 i‡(
¥›
->
¨row_d©a
.
ty≥
 !
ARROW_NONE
) {

208 
Obje˘Node
 
obj_node
 = 
©å
->
∑ª¡
;

209 
gch¨
 *
°r
 = 
	`g_°rc⁄ˇt
(
¥›
->
comm⁄
.
«me
, "_Àngth", 
NULL
);

210 i‡((
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
°r
)) &&

211 (
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
)))

212 
¥›
->
¨row_d©a
.
Àngth
 = 
	`d©a_ªÆ
(
d©a
);

213 
	`g_‰ì
(
°r
);

214 
°r
 = 
	`g_°rc⁄ˇt
(
¥›
->
comm⁄
.
«me
, "_width", 
NULL
);

215 i‡((
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
°r
)) &&

216 (
d©a
 = 
	`©åibuã_fú°_d©a
(
©å
)))

217 
¥›
->
¨row_d©a
.
width
 = 
	`d©a_ªÆ
(
d©a
);

218 
	`g_‰ì
(
°r
);

220 
	}
}

223 
	$¨row¥›_ßve
(
AºowPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

225 
	`d©a_add_íum
(
©å
, 
¥›
->
¨row_d©a
.
ty≥
);

226 i‡(
¥›
->
¨row_d©a
.
ty≥
 !
ARROW_NONE
) {

227 
Obje˘Node
 
obj_node
 = 
©å
->
∑ª¡
;

228 
gch¨
 *
°r
 = 
	`g_°rc⁄ˇt
(
¥›
->
comm⁄
.
«me
, "_Àngth", 
NULL
);

229 
©å
 = 
	`√w_©åibuã
(
obj_node
, 
°r
);

230 
	`g_‰ì
(
°r
);

231 
	`d©a_add_ªÆ
(
©å
, 
¥›
->
¨row_d©a
.
Àngth
);

232 
°r
 = 
	`g_°rc⁄ˇt
(
¥›
->
comm⁄
.
«me
, "_width", 
NULL
);

233 
©å
 = 
	`√w_©åibuã
(
obj_node
, 
°r
);

234 
	`g_‰ì
(
°r
);

235 
	`d©a_add_ªÆ
(
©å
, 
¥›
->
¨row_d©a
.
width
);

237 
	}
}

240 
	$¨row¥›_gë_‰om_off£t
(
AºowPr›îty
 *
¥›
,

241 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

243 
¥›
->
¨row_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
Aºow
);

244 
	}
}

247 
	$¨row¥›_£t_‰om_off£t
(
AºowPr›îty
 *
¥›
,

248 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

250 
	`°ru˘_membî
(
ba£
,
off£t
,
Aºow
Ë
¥›
->
¨row_d©a
;

251 
	}
}

253 c⁄° 
Pr›îtyOps
 
	g¨row¥›_›s
 = {

254 (
Pr›îtyTy≥_New
Ë
¨row¥›_√w
,

255 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

256 (
Pr›îtyTy≥_C›y
Ë
¨row¥›_c›y
,

257 (
Pr›îtyTy≥_Lﬂd
Ë
¨row¥›_lﬂd
,

258 (
Pr›îtyTy≥_Save
Ë
¨row¥›_ßve
,

259 (
Pr›îtyTy≥_GëWidgë
Ë
¨row¥›_gë_widgë
,

260 (
Pr›îtyTy≥_Re£tWidgë
Ë
¨row¥›_ª£t_widgë
,

261 (
Pr›îtyTy≥_SëFromWidgë
Ë
¨row¥›_£t_‰om_widgë
,

263 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

264 (
Pr›îtyTy≥_GëFromOff£t
Ë
¨row¥›_gë_‰om_off£t
,

265 (
Pr›îtyTy≥_SëFromOff£t
Ë
¨row¥›_£t_‰om_off£t


272 
Cﬁ‹Pr›îty
 *

273 
	$cﬁ‹¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

275 
Cﬁ‹Pr›îty
 *
¥›
 = 
	`g_√w0
(ColorProperty,1);

276 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

277 
¥›
->
cﬁ‹_d©a
.
ªd
 = 0.0;

278 
¥›
->
cﬁ‹_d©a
.
gªí
 = 0.0;

279 
¥›
->
cﬁ‹_d©a
.
blue
 = 1.0;

280  
¥›
;

281 
	}
}

283 
Cﬁ‹Pr›îty
 *

284 
	$cﬁ‹¥›_c›y
(
Cﬁ‹Pr›îty
 *
§c
)

286 
Cﬁ‹Pr›îty
 *
¥›
 =

287 (
Cﬁ‹Pr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

288 
§c
->
comm⁄
.
ªas⁄
);

289 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

290 
¥›
->
cﬁ‹_d©a
 = 
§c
->color_data;

291  
¥›
;

292 
	}
}

294 
WIDGET
 *

295 
	$cﬁ‹¥›_gë_widgë
(
Cﬁ‹Pr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

297 
GtkWidgë
 *
ªt
 = 
	`dü_cﬁ‹_£À˘‹_√w
();

298 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "value-changed");

299  
ªt
;

300 
	}
}

303 
	$cﬁ‹¥›_ª£t_widgë
(
Cﬁ‹Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

305 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
widgë
,

306 &
¥›
->
cﬁ‹_d©a
);

307 
	}
}

310 
	$cﬁ‹¥›_£t_‰om_widgë
(
Cﬁ‹Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

312 
	`dü_cﬁ‹_£À˘‹_gë_cﬁ‹
(
widgë
,

313 &
¥›
->
cﬁ‹_d©a
);

314 
	}
}

317 
	$cﬁ‹¥›_lﬂd
(
Cﬁ‹Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

319 
	`d©a_cﬁ‹
(
d©a
,&
¥›
->
cﬁ‹_d©a
);

320 
	}
}

323 
	$cﬁ‹¥›_ßve
(
Cﬁ‹Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

325 
	`d©a_add_cﬁ‹
(
©å
,&
¥›
->
cﬁ‹_d©a
);

326 
	}
}

329 
	$cﬁ‹¥›_gë_‰om_off£t
(
Cﬁ‹Pr›îty
 *
¥›
,

330 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

332 
¥›
->
cﬁ‹_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
Cﬁ‹
);

333 
	}
}

336 
	$cﬁ‹¥›_£t_‰om_off£t
(
Cﬁ‹Pr›îty
 *
¥›
,

337 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

339 
	`°ru˘_membî
(
ba£
,
off£t
,
Cﬁ‹
Ë
¥›
->
cﬁ‹_d©a
;

340 
	}
}

342 c⁄° 
Pr›îtyOps
 
	gcﬁ‹¥›_›s
 = {

343 (
Pr›îtyTy≥_New
Ë
cﬁ‹¥›_√w
,

344 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

345 (
Pr›îtyTy≥_C›y
Ë
cﬁ‹¥›_c›y
,

346 (
Pr›îtyTy≥_Lﬂd
Ë
cﬁ‹¥›_lﬂd
,

347 (
Pr›îtyTy≥_Save
Ë
cﬁ‹¥›_ßve
,

348 (
Pr›îtyTy≥_GëWidgë
Ë
cﬁ‹¥›_gë_widgë
,

349 (
Pr›îtyTy≥_Re£tWidgë
Ë
cﬁ‹¥›_ª£t_widgë
,

350 (
Pr›îtyTy≥_SëFromWidgë
Ë
cﬁ‹¥›_£t_‰om_widgë
,

352 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

353 (
Pr›îtyTy≥_GëFromOff£t
Ë
cﬁ‹¥›_gë_‰om_off£t
,

354 (
Pr›îtyTy≥_SëFromOff£t
Ë
cﬁ‹¥›_£t_‰om_off£t


362 
F⁄tPr›îty
 *

363 
	$f⁄çr›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

365 
F⁄tPr›îty
 *
¥›
 = 
	`g_√w0
(FontProperty,1);

366 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

367 
¥›
->
f⁄t_d©a
 = 
NULL
;

368  
¥›
;

369 
	}
}

372 
	$f⁄çr›_‰ì
(
F⁄tPr›îty
 *
¥›
)

374 i‡(
¥›
->
f⁄t_d©a
)

375 
	`dü_f⁄t_uƒef
(
¥›
->
f⁄t_d©a
);

376 
	`g_‰ì
(
¥›
);

377 
	}
}

379 
F⁄tPr›îty
 *

380 
	$f⁄çr›_c›y
(
F⁄tPr›îty
 *
§c
)

382 
F⁄tPr›îty
 *
¥›
 =

383 (
F⁄tPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

384 
§c
->
comm⁄
.
ªas⁄
);

385 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

387 i‡(
¥›
->
f⁄t_d©a
)

388 
	`dü_f⁄t_uƒef
(
¥›
->
f⁄t_d©a
);

389 
¥›
->
f⁄t_d©a
 = 
	`dü_f⁄t_ªf
(
§c
->font_data);

391  
¥›
;

392 
	}
}

394 
WIDGET
 *

395 
	$f⁄çr›_gë_widgë
(
F⁄tPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

397 
GtkWidgë
 *
ªt
 = 
	`dü_f⁄t_£À˘‹_√w
();

398 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "value-changed");

399  
ªt
;

400 
	}
}

403 
	$f⁄çr›_ª£t_widgë
(
F⁄tPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

405 
	`dü_f⁄t_£À˘‹_£t_f⁄t
(
	`DIAFONTSELECTOR
(
widgë
),

406 
¥›
->
f⁄t_d©a
);

407 
	}
}

410 
	$f⁄çr›_£t_‰om_widgë
(
F⁄tPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

412 
¥›
->
f⁄t_d©a
 = 
	`dü_f⁄t_£À˘‹_gë_f⁄t
(
	`DIAFONTSELECTOR
(
widgë
));

413 
	}
}

416 
	$f⁄çr›_lﬂd
(
F⁄tPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

418 i‡(
¥›
->
f⁄t_d©a
)

419 
	`dü_f⁄t_uƒef
(
¥›
->
f⁄t_d©a
);

420 
¥›
->
f⁄t_d©a
 = 
	`d©a_f⁄t
(
d©a
);

421 
	}
}

424 
	$f⁄çr›_ßve
(
F⁄tPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

426 
	`d©a_add_f⁄t
(
©å
,
¥›
->
f⁄t_d©a
);

427 
	}
}

430 
	$f⁄çr›_gë_‰om_off£t
(
F⁄tPr›îty
 *
¥›
,

431 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

433 i‡(
¥›
->
f⁄t_d©a
)

434 
	`dü_f⁄t_uƒef
(
¥›
->
f⁄t_d©a
);

435 
¥›
->
f⁄t_d©a
 = 
	`dü_f⁄t_ªf
(
	`°ru˘_membî
(
ba£
,
off£t
,
DüF⁄t
 *));

436 
	}
}

439 
	$f⁄çr›_£t_‰om_off£t
(
F⁄tPr›îty
 *
¥›
,

440 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

442 i‡(
¥›
->
f⁄t_d©a
) {

443 i‡(
	`°ru˘_membî
(
ba£
,
off£t
,
DüF⁄t
 *))

444 
	`dü_f⁄t_uƒef
(
	`°ru˘_membî
(
ba£
,
off£t
,
DüF⁄t
 *));

445 
	`°ru˘_membî
(
ba£
,
off£t
,
DüF⁄t
 *Ë
	`dü_f⁄t_ªf
(
¥›
->
f⁄t_d©a
);

447 
	}
}

449 c⁄° 
Pr›îtyOps
 
	gf⁄çr›_›s
 = {

450 (
Pr›îtyTy≥_New
Ë
f⁄çr›_√w
,

451 (
Pr›îtyTy≥_Fªe
Ë
f⁄çr›_‰ì
,

452 (
Pr›îtyTy≥_C›y
Ë
f⁄çr›_c›y
,

453 (
Pr›îtyTy≥_Lﬂd
Ë
f⁄çr›_lﬂd
,

454 (
Pr›îtyTy≥_Save
Ë
f⁄çr›_ßve
,

455 (
Pr›îtyTy≥_GëWidgë
Ë
f⁄çr›_gë_widgë
,

456 (
Pr›îtyTy≥_Re£tWidgë
Ë
f⁄çr›_ª£t_widgë
,

457 (
Pr›îtyTy≥_SëFromWidgë
Ë
f⁄çr›_£t_‰om_widgë
,

459 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

460 (
Pr›îtyTy≥_GëFromOff£t
Ë
f⁄çr›_gë_‰om_off£t
,

461 (
Pr›îtyTy≥_SëFromOff£t
Ë
f⁄çr›_£t_‰om_off£t


467 
	$¥›_©å_ªgi°î
()

469 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_LINESTYLE
,&
löe°yÀ¥›_›s
);

470 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_ARROW
,&
¨row¥›_›s
);

471 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_COLOUR
,&
cﬁ‹¥›_›s
);

472 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_FONT
,&
f⁄çr›_›s
);

473 
	}
}

	@O:\tool\dvs50\lib\prop_attr.h

25 #i‚de‡
PROP_ATTR_H


26 
	#PROP_ATTR_H


	)

28 
	~"¥›îtõs.h
"

29 
	~"dü_xml.h
"

32 
Pr›îty
 
	mcomm⁄
;

33 
LöeStyÀ
 
	m°yÀ
;

34 
ªÆ
 
	mdash
;

35 } 
	tLöe°yÀPr›îty
;

38 
Pr›îty
 
	mcomm⁄
;

39 
Aºow
 
	m¨row_d©a
;

40 } 
	tAºowPr›îty
;

43 
Pr›îty
 
	mcomm⁄
;

44 
Cﬁ‹
 
	mcﬁ‹_d©a
;

45 } 
	tCﬁ‹Pr›îty
;

48 
Pr›îty
 
	mcomm⁄
;

49 
DüF⁄t
 *
	mf⁄t_d©a
;

50 } 
	tF⁄tPr›îty
;

52 
¥›_©å_ªgi°î
();

	@O:\tool\dvs50\lib\prop_basic.c

26 #ifde‡
HAVE_CONFIG_H


27 
	~<c⁄fig.h
>

30 
	~<°rög.h
>

32 
	~<gtk/gtk.h
>

33 
	#WIDGET
 
GtkWidgë


	)

34 
	~"¥›îtõs.h
"

35 
	~"¥›_basic.h
"

36 
	~"¥›öã∫Æs.h
"

39 c⁄° 
gch¨
 *
	m«me
;

40 c⁄° 
gch¨
 *
	mty≥
;

41 } 
	tPr›M⁄ikî
;

43 
guöt


44 
	$desc_hash_hash
(c⁄° 
Pr›M⁄ikî
 *
desc
)

46 
guöt
 
«me_hash
 = 
	`g_°r_hash
(
desc
->
«me
);

47 
guöt
 
ty≥_hash
 = 
	`g_°r_hash
(
desc
->
ty≥
);

49  (
«me_hash
 ^ ((
ty≥_hash
 & 0xFFFF0000) >> 16) ^

50 ((
ty≥_hash
 & 0x0000FFFF) << 16) ^ (type_hash));

51 
	}
}

53 
guöt


54 
	$desc_hash_com∑ª
(c⁄° 
Pr›M⁄ikî
 *
a
, c⁄° Pr›M⁄ikî *
b
)

56  ((0 =
	`°rcmp
(
a
->
«me
,
b
->«me)Ë&& (0 =°rcmp◊->
ty≥
,b->type)));

57 
	}
}

59 
Pr›îty
 *

60 
	$make_√w_¥›
(c⁄° *
«me
, 
Pr›îtyTy≥
 
ty≥
, 
guöt
 
Êags
)

62 
GHashTabÀ
 *
hash
 = 
NULL
;

63 
Pr›M⁄ikî
 *
m⁄ikî
 = 
	`g_√w0
(PropMoniker, 1);

64 
Pr›Des¸ùti⁄
 *
des¸
;

66 
m⁄ikî
->
«me
 =Çame;

67 
m⁄ikî
->
ty≥
 =Åype;

69 i‡(!
hash
Ëhash = 
	`g_hash_èbÀ_√w
((
GHashFunc
)
desc_hash_hash
,

70 (
GCom∑ªFunc
)
desc_hash_com∑ª
);

72 
des¸
 = 
	`g_hash_èbÀ_lookup
(
hash
,
m⁄ikî
);

73 i‡(
des¸
) {

74 
	`g_‰ì
(
m⁄ikî
);

76 
des¸
 = 
	`g_√w0
(
Pr›Des¸ùti⁄
,1);

77 
des¸
->
«me
 =Çame;

78 
des¸
->
ty≥
 =Åype;

79 
des¸
->
Êags
 = flags;

80 
des¸
->
qu¨k
 = 
	`g_qu¨k_‰om_°©ic_°rög
(des¸->
«me
);

81 
des¸
->
ty≥_qu¨k
 = 
	`g_qu¨k_‰om_°©ic_°rög
(des¸->
ty≥
);

82 
des¸
->
›s
 = 
	`¥›_ty≥_gë_›s
(
ty≥
);

83 
	`g_hash_èbÀ_ö£π
(
hash
,
m⁄ikî
,
des¸
);

86  
des¸
->
›s
->
	`√w_¥›
(des¸,
pdçp_sy¡hëic
);

87 
	}
}

97 
Pr›îty
 *

98 
	$comm⁄¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

102  
pdesc
->
›s
->
	`√w_¥›
’desc,
ªas⁄
);

103 
	}
}

106 
	$comm⁄¥›_‰ì
(
Pr›îty
 *
¥›
)

108 
¥›
->
ªÆ_›s
->
	`‰ì
(prop);

109 
	}
}

111 
Pr›îty
 *

112 
	$comm⁄¥›_c›y
(
Pr›îty
 *
§c
)

114 
Pr›îty
 *
¥›
 = 
§c
->
ªÆ_›s
->
	`c›y
(src);

115 
§c
->
ex≥rõn˚
 |
PXP_COPIED
;

116 
¥›
->
ex≥rõn˚
 |
PXP_COPY
;

117  
¥›
;

118 
	}
}

120 
WIDGET
 *

121 
	$comm⁄¥›_gë_widgë
(
Pr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

123 
WIDGET
 *
wid
 = 
¥›
->
ªÆ_›s
->
	`gë_widgë
’r›,
dülog
);

124 
¥›
->
ex≥rõn˚
 |
PXP_GET_WIDGET
;

125  
wid
;

126 
	}
}

129 
	$comm⁄¥›_ª£t_widgë
(
Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

131 
¥›
->
ªÆ_›s
->
	`ª£t_widgë
’r›,
widgë
);

132 
¥›
->
ex≥rõn˚
 |
PXP_RESET_WIDGET
;

133 
	}
}

136 
	$comm⁄¥›_£t_‰om_widgë
(
Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

138 
¥›
->
ªÆ_›s
->
	`£t_‰om_widgë
’r›,
widgë
);

139 
¥›
->
ex≥rõn˚
 |
PXP_SET_FROM_WIDGET
;

140 
	}
}

143 
	$comm⁄¥›_lﬂd
(
Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

145 
¥›
->
ªÆ_›s
->
	`lﬂd
’r›,
©å
,
d©a
);

146 
¥›
->
ex≥rõn˚
 |
PXP_LOADED
;

147 
	}
}

150 
	$comm⁄¥›_ßve
(
Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

152 
¥›
->
ªÆ_›s
->
	`ßve
’r›,
©å
);

153 
¥›
->
ex≥rõn˚
 |
PXP_SAVED
;

154 
	}
}

156 
gboﬁón


157 
	$comm⁄¥›_ˇn_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
, c⁄° Pr›Des¸ùti⁄ *
pd2
)

159  
pd1
->
›s
->
	`ˇn_mîge
’d1,
pd2
);

160 
	}
}

163 
	$comm⁄¥›_gë_‰om_off£t
(c⁄° 
Pr›îty
 *
¥›
,

164 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

166 
¥›
->
ªÆ_›s
->
	`gë_‰om_off£t
’r›,
ba£
,
off£t
,
off£t2
);

167 ((
Pr›îty
 *)
¥›
)->
ex≥rõn˚
 |
PXP_GFO
;

168 
	}
}

171 
	$comm⁄¥›_£t_‰om_off£t
(
Pr›îty
 *
¥›
,

172 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

174 
¥›
->
ªÆ_›s
->
	`£t_‰om_off£t
’r›,
ba£
,
off£t
,
off£t2
);

175 
¥›
->
ex≥rõn˚
 |
PXP_SFO
;

176 
	}
}

178 c⁄° 
Pr›îtyOps
 
	gcomm⁄¥›_›s
 = {

179 (
Pr›îtyTy≥_New
Ë
comm⁄¥›_√w
,

180 (
Pr›îtyTy≥_Fªe
Ë
comm⁄¥›_‰ì
,

181 (
Pr›îtyTy≥_C›y
Ë
comm⁄¥›_c›y
,

182 (
Pr›îtyTy≥_Lﬂd
Ë
comm⁄¥›_lﬂd
,

183 (
Pr›îtyTy≥_Save
Ë
comm⁄¥›_ßve
,

184 (
Pr›îtyTy≥_GëWidgë
Ë
comm⁄¥›_gë_widgë
,

185 (
Pr›îtyTy≥_Re£tWidgë
Ë
comm⁄¥›_ª£t_widgë
,

186 (
Pr›îtyTy≥_SëFromWidgë
Ë
comm⁄¥›_£t_‰om_widgë
,

188 (
Pr›îtyTy≥_C™Mîge
Ë
comm⁄¥›_ˇn_mîge
,

189 (
Pr›îtyTy≥_GëFromOff£t
Ë
comm⁄¥›_gë_‰om_off£t
,

190 (
Pr›îtyTy≥_SëFromOff£t
Ë
comm⁄¥›_£t_‰om_off£t


195 
	$öôülize_¥›îty
(
Pr›îty
 *
¥›
, c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

196 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

198 
¥›
->
ªas⁄
 =Ñeason;

199 
¥›
->
«me
 = 
pdesc
->name;

200 
¥›
->
«me_qu¨k
 = 
pdesc
->
qu¨k
;

201 i‡(!
¥›
->
«me_qu¨k
) {

202 
¥›
->
«me_qu¨k
 = 
	`g_qu¨k_‰om_°rög
’r›->
«me
);

203 
	`g_îr‹
("%s:Üate quark construction forÖroperty %s",

204 
G_STRFUNC
,
¥›
->
«me
);

206 
¥›
->
ty≥
 = 
pdesc
->type;

207 
¥›
->
ty≥_qu¨k
 = 
pdesc
->type_quark;

208 
¥›
->
›s
 = &
comm⁄¥›_›s
;

209 
¥›
->
ªÆ_›s
 = 
pdesc
->
›s
;

211 
¥›
->
des¸
 = 
pdesc
;

212 
¥›
->
ªas⁄
 =Ñeason;

213 
¥›
->
exåa_d©a
 = 
pdesc
->extra_data;

215 
¥›
->
evít_h™dÀr
 = 
pdesc
->event_handler;

217 
¥›
->
ex≥rõn˚
 = 0;

218 
	}
}

220 
	$c›y_öô_¥›îty
(
Pr›îty
 *
de°
, c⁄° Pr›îty *
§c
)

222 
	`mem˝y
(
de°
,
§c
,(*dest));

223 
de°
->
ex≥rõn˚
 = 0;

224 
	}
}

233 
No›Pr›îty
 *

234 
	$no›¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

236 
No›Pr›îty
 *
¥›
 = 
	`g_√w
(NoopProperty,1);

237 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

238  
¥›
;

239 
	}
}

242 
	$no›¥›_‰ì
(
No›Pr›îty
 *
¥›
)

244 
	`g_‰ì
(
¥›
);

245 
	}
}

247 
No›Pr›îty
 *

248 
	$no›¥›_c›y
(
No›Pr›îty
 *
§c
)

250 
No›Pr›îty
 *
¥›
 =

251 (
No›Pr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

252 
§c
->
comm⁄
.
ªas⁄
);

253 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

254  
¥›
;

256 
	}
}

258 
WIDGET
 *

259 
	$no›¥›_gë_widgë
(
No›Pr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

261  
NULL
;

262 
	}
}

265 
	$no›¥›_ª£t_widgë
(
No›Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

267 
	}
}

270 
	$no›¥›_£t_‰om_widgë
(
No›Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

272 
	}
}

275 
	$no›¥›_lﬂd
(
No›Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

277 
	}
}

280 
	$no›¥›_ßve
(
No›Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

282 
	}
}

284 
gboﬁón


285 
	$no›¥›_ˇn_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
, c⁄° Pr›Des¸ùti⁄ *
pd2
)

287  
TRUE
;

288 
	}
}

290 
gboﬁón


291 
	$no›¥›_ˇ¬Ÿ_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
, c⁄° Pr›Des¸ùti⁄ *
pd2
)

293  
TRUE
;

294 
	}
}

297 
	$no›¥›_gë_‰om_off£t
(c⁄° 
No›Pr›îty
 *
¥›
,

298 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

300 
	}
}

303 
	$no›¥›_£t_‰om_off£t
(
No›Pr›îty
 *
¥›
,

304 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

306 
	}
}

308 c⁄° 
Pr›îtyOps
 
	gno›¥›_›s
 = {

309 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

310 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

311 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

312 (
Pr›îtyTy≥_Lﬂd
Ë
no›¥›_lﬂd
,

313 (
Pr›îtyTy≥_Save
Ë
no›¥›_ßve
,

314 (
Pr›îtyTy≥_GëWidgë
Ë
no›¥›_gë_widgë
,

315 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

316 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

318 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

319 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

320 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


328 
InvÆidPr›îty
 *

329 
	$övÆid¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

330 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

332 
	`g_as£π_nŸ_ªached
();

333  
NULL
;

334 
	}
}

337 
	$övÆid¥›_‰ì
(
InvÆidPr›îty
 *
¥›
)

339 
	`g_as£π_nŸ_ªached
();

340 
	}
}

342 
InvÆidPr›îty
 *

343 
	$övÆid¥›_c›y
(
InvÆidPr›îty
 *
§c
)

345 
	`g_as£π_nŸ_ªached
();

346  
NULL
;

347 
	}
}

349 
WIDGET
 *

350 
	$övÆid¥›_gë_widgë
(
InvÆidPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

352 
	`g_as£π_nŸ_ªached
();

353  
NULL
;

354 
	}
}

357 
	$övÆid¥›_ª£t_widgë
(
InvÆidPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

359 
	`g_as£π_nŸ_ªached
();

360 
	}
}

363 
	$övÆid¥›_£t_‰om_widgë
(
InvÆidPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

365 
	`g_as£π_nŸ_ªached
();

366 
	}
}

369 
	$övÆid¥›_lﬂd
(
InvÆidPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

371 
	`g_as£π_nŸ_ªached
();

372 
	}
}

375 
	$övÆid¥›_ßve
(
InvÆidPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

377 
	`g_as£π_nŸ_ªached
();

378 
	}
}

380 
gboﬁón


381 
	$övÆid¥›_ˇn_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
, c⁄° Pr›Des¸ùti⁄ *
pd2
)

383 
	`g_as£π_nŸ_ªached
();

384  
TRUE
;

385 
	}
}

388 
	$övÆid¥›_gë_‰om_off£t
(c⁄° 
InvÆidPr›îty
 *
¥›
,

389 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

391 
	`g_as£π_nŸ_ªached
();

392 
	}
}

395 
	$övÆid¥›_£t_‰om_off£t
(
InvÆidPr›îty
 *
¥›
,

396 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

398 
	`g_as£π_nŸ_ªached
();

399 
	}
}

401 c⁄° 
Pr›îtyOps
 
	gövÆid¥›_›s
 = {

402 (
Pr›îtyTy≥_New
Ë
övÆid¥›_√w
,

403 (
Pr›îtyTy≥_Fªe
Ë
övÆid¥›_‰ì
,

404 (
Pr›îtyTy≥_C›y
Ë
övÆid¥›_c›y
,

405 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

406 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

407 (
Pr›îtyTy≥_GëWidgë
Ë
övÆid¥›_gë_widgë
,

408 (
Pr›îtyTy≥_Re£tWidgë
Ë
övÆid¥›_ª£t_widgë
,

409 (
Pr›îtyTy≥_SëFromWidgë
Ë
övÆid¥›_£t_‰om_widgë
,

411 (
Pr›îtyTy≥_C™Mîge
Ë
övÆid¥›_ˇn_mîge
,

412 (
Pr›îtyTy≥_GëFromOff£t
Ë
övÆid¥›_gë_‰om_off£t
,

413 (
Pr›îtyTy≥_SëFromOff£t
Ë
övÆid¥›_£t_‰om_off£t


421 
Unim∂emíãdPr›îty
 *

422 
	$unim∂emíãd¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

423 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

425 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
pdesc
->
«me
);

426  
NULL
;

427 
	}
}

430 
	$unim∂emíãd¥›_‰ì
(
Unim∂emíãdPr›îty
 *
¥›
)

432 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
¥›
->
comm⁄
.
des¸
->
«me
);

433 
	}
}

435 
Unim∂emíãdPr›îty
 *

436 
	$unim∂emíãd¥›_c›y
(
Unim∂emíãdPr›îty
 *
§c
)

438 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
§c
->
comm⁄
.
des¸
->
«me
);

439  
NULL
;

440 
	}
}

442 
WIDGET
 *

443 
	$unim∂emíãd¥›_gë_widgë
(
Unim∂emíãdPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

445 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
¥›
->
comm⁄
.
des¸
->
«me
);

446  
NULL
;

447 
	}
}

450 
	$unim∂emíãd¥›_ª£t_widgë
(
Unim∂emíãdPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

452 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
¥›
->
comm⁄
.
des¸
->
«me
);

453 
	}
}

456 
	$unim∂emíãd¥›_£t_‰om_widgë
(
Unim∂emíãdPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

458 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
¥›
->
comm⁄
.
des¸
->
«me
);

459 
	}
}

462 
	$unim∂emíãd¥›_lﬂd
(
Unim∂emíãdPr›îty
 *
¥›
,

463 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

465 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
¥›
->
comm⁄
.
des¸
->
«me
);

466 
	}
}

469 
	$unim∂emíãd¥›_ßve
(
Unim∂emíãdPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

471 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
¥›
->
comm⁄
.
des¸
->
«me
);

472 
	}
}

474 
gboﬁón


475 
	$unim∂emíãd¥›_ˇn_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
, c⁄° Pr›Des¸ùti⁄ *
pd2
)

477 
	`g_w¨nög
("%s: f‹Ör›îty %s/%s",
G_STRFUNC
,
pd1
->
«me
,
pd2
->name);

478  
FALSE
;

479 
	}
}

482 
	$unim∂emíãd¥›_gë_‰om_off£t
(c⁄° 
Unim∂emíãdPr›îty
 *
¥›
,

483 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

485 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
¥›
->
comm⁄
.
des¸
->
«me
);

486 
	}
}

489 
	$unim∂emíãd¥›_£t_‰om_off£t
(
Unim∂emíãdPr›îty
 *
¥›
,

490 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

492 
	`g_w¨nög
("%s: f‹Ör›îty %s",
G_STRFUNC
,
¥›
->
comm⁄
.
des¸
->
«me
);

493 
	}
}

495 c⁄° 
Pr›îtyOps
 
	gunim∂emíãd¥›_›s
 = {

496 (
Pr›îtyTy≥_New
Ë
unim∂emíãd¥›_√w
,

497 (
Pr›îtyTy≥_Fªe
Ë
unim∂emíãd¥›_‰ì
,

498 (
Pr›îtyTy≥_C›y
Ë
unim∂emíãd¥›_c›y
,

499 (
Pr›îtyTy≥_Lﬂd
Ë
unim∂emíãd¥›_lﬂd
,

500 (
Pr›îtyTy≥_Save
Ë
unim∂emíãd¥›_ßve
,

501 (
Pr›îtyTy≥_GëWidgë
Ë
unim∂emíãd¥›_gë_widgë
,

502 (
Pr›îtyTy≥_Re£tWidgë
Ë
unim∂emíãd¥›_ª£t_widgë
,

503 (
Pr›îtyTy≥_SëFromWidgë
Ë
unim∂emíãd¥›_£t_‰om_widgë
,

505 (
Pr›îtyTy≥_C™Mîge
Ë
unim∂emíãd¥›_ˇn_mîge
,

506 (
Pr›îtyTy≥_GëFromOff£t
Ë
unim∂emíãd¥›_gë_‰om_off£t
,

507 (
Pr›îtyTy≥_SëFromOff£t
Ë
unim∂emíãd¥›_£t_‰om_off£t


513 
	$¥›_basic_ªgi°î
()

515 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_NOOP
,&
no›¥›_›s
);

516 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_INVALID
,&
övÆid¥›_›s
);

517 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_UNIMPLEMENTED
,&
unim∂emíãd¥›_›s
);

518 
	}
}

	@O:\tool\dvs50\lib\prop_basic.h

26 #i‚de‡
PROP_BASIC_H


27 
	#PROP_BASIC_H


	)

29 
	~"¥›îtõs.h
"

30 
	~"dü_xml.h
"

32 
öôülize_¥›îty
(
Pr›îty
 *
¥›
, c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

33 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
);

34 
c›y_öô_¥›îty
(
Pr›îty
 *
de°
, c⁄° Pr›îty *
§c
);

37 
Pr›îty
 
	mcomm⁄
;

38 } 
	tNo›Pr›îty
;

40 
No›Pr›îty
 *
no›¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

41 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
);

42 
no›¥›_‰ì
(
No›Pr›îty
 *
¥›
);

43 
No›Pr›îty
 *
no›¥›_c›y
(No›Pr›îty *
§c
);

44 
WIDGET
 *
no›¥›_gë_widgë
(
No›Pr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
);

45 
no›¥›_ª£t_widgë
(
No›Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
);

46 
no›¥›_£t_‰om_widgë
(
No›Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
);

47 
no›¥›_lﬂd
(
No›Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
);

48 
no›¥›_ßve
(
No›Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
);

49 
gboﬁón
 
no›¥›_ˇn_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
,

50 c⁄° 
Pr›Des¸ùti⁄
 *
pd2
);

51 
gboﬁón
 
no›¥›_ˇ¬Ÿ_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
,

52 c⁄° 
Pr›Des¸ùti⁄
 *
pd2
);

53 
no›¥›_gë_‰om_off£t
(c⁄° 
No›Pr›îty
 *
¥›
,

54 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
);

55 
no›¥›_£t_‰om_off£t
(
No›Pr›îty
 *
¥›
,

56 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
);

59 
Pr›îty
 
	mcomm⁄
;

60 } 
	tInvÆidPr›îty
;

62 
InvÆidPr›îty
 *
övÆid¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

63 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
);

64 
övÆid¥›_‰ì
(
InvÆidPr›îty
 *
¥›
);

65 
InvÆidPr›îty
 *
övÆid¥›_c›y
(InvÆidPr›îty *
§c
);

66 
WIDGET
 *
övÆid¥›_gë_widgë
(
InvÆidPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
);

67 
övÆid¥›_ª£t_widgë
(
InvÆidPr›îty
 *
¥›
, 
WIDGET
 *
widgë
);

68 
övÆid¥›_£t_‰om_widgë
(
InvÆidPr›îty
 *
¥›
, 
WIDGET
 *
widgë
);

69 
övÆid¥›_lﬂd
(
InvÆidPr›îty
 *
¥›
, 
AâribuãNode
 
©å
,

70 
D©aNode
 
d©a
);

71 
övÆid¥›_ßve
(
InvÆidPr›îty
 *
¥›
, 
AâribuãNode
 
©å
);

72 
gboﬁón
 
övÆid¥›_ˇn_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
,

73 c⁄° 
Pr›Des¸ùti⁄
 *
pd2
);

74 
övÆid¥›_gë_‰om_off£t
(c⁄° 
InvÆidPr›îty
 *
¥›
,

75 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
);

76 
övÆid¥›_£t_‰om_off£t
(
InvÆidPr›îty
 *
¥›
,

77 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
);

79 
Pr›îty
 
	mcomm⁄
;

80 } 
	tUnim∂emíãdPr›îty
;

82 
Unim∂emíãdPr›îty
 *
unim∂emíãd¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

83 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
);

84 
unim∂emíãd¥›_‰ì
(
Unim∂emíãdPr›îty
 *
¥›
);

85 
Unim∂emíãdPr›îty
 *
unim∂emíãd¥›_c›y
(Unim∂emíãdPr›îty *
§c
);

86 
WIDGET
 *
unim∂emíãd¥›_gë_widgë
(
Unim∂emíãdPr›îty
 *
¥›
,

87 
Pr›Dülog
 *
dülog
);

88 
unim∂emíãd¥›_ª£t_widgë
(
Unim∂emíãdPr›îty
 *
¥›
,

89 
WIDGET
 *
widgë
);

90 
unim∂emíãd¥›_£t_‰om_widgë
(
Unim∂emíãdPr›îty
 *
¥›
,

91 
WIDGET
 *
widgë
);

92 
unim∂emíãd¥›_lﬂd
(
Unim∂emíãdPr›îty
 *
¥›
,

93 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
);

94 
unim∂emíãd¥›_ßve
(
Unim∂emíãdPr›îty
 *
¥›
, 
AâribuãNode
 
©å
);

95 
gboﬁón
 
unim∂emíãd¥›_ˇn_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
,

96 c⁄° 
Pr›Des¸ùti⁄
 *
pd2
);

97 
unim∂emíãd¥›_gë_‰om_off£t
(c⁄° 
Unim∂emíãdPr›îty
 *
¥›
,

98 *
ba£
,

99 
guöt
 
off£t
, guöà
off£t2
);

101 
unim∂emíãd¥›_£t_‰om_off£t
(
Unim∂emíãdPr›îty
 *
¥›
,

102 *
ba£
,

103 
guöt
 
off£t
, guöà
off£t2
);

104 
DIAVAR
 
¥›_basic_ªgi°î
();

	@O:\tool\dvs50\lib\prop_dict.c

26 #ifde‡
HAVE_CONFIG_H


27 
	~<c⁄fig.h
>

30 
	~<gtk/gtk.h
>

31 
	#WIDGET
 
GtkWidgë


	)

32 
	~"widgës.h
"

33 
	~"¥›îtõs.h
"

34 
	~"¥›öã∫Æs.h
"

36 
	s_WñlKnownKeys
 {

37 c⁄° 
gch¨
 *
	m«me
;

38 c⁄° 
gch¨
 *
	mdi•œy_«me
;

39 } 
	tWñlKnownKeys
;

42 
WñlKnownKeys
 
	g_wñl_known
[] = {

43 { "auth‹", 
N_
("Author") },

44 { "id", 
N_
("Identifier") },

45 { "¸óti⁄", 
N_
("Creation date") },

46 { "modifiˇti⁄", 
N_
("Modification date") },

47 { "uæ", 
N_
("URL") },

48 { 
NULL
, NULL }

51 
Di˘Pr›îty
 *

52 
	$di˘¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

54 
Di˘Pr›îty
 *
¥›
 = 
	`g_√w0
(DictProperty,1);

56 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

57 
¥›
->
di˘
 = 
	`g_hash_èbÀ_√w_fuŒ
 (
g_°r_hash
, 
g_°r_equÆ
, 
g_‰ì
, g_free);

58  
¥›
;

59 
	}
}

62 
	$di˘¥›_‰ì
(
Di˘Pr›îty
 *
¥›
)

64 i‡(
¥›
->
di˘
)

65 
	`g_hash_èbÀ_de°roy
(
¥›
->
di˘
);

66 
	`g_‰ì
(
¥›
);

67 
	}
}

70 
	$_keyvÆue_c›y
 (
gpoöãr
 
key
,

71 
gpoöãr
 
vÆue
,

72 
gpoöãr
 
u£r_d©a
)

74 
gch¨
 *
«me
 = (gch¨ *)
key
;

75 
gch¨
 *
vÆ
 = (gch¨ *)
vÆue
;

76 
GHashTabÀ
 *
de°
 = (GHashTabÀ *)
u£r_d©a
;

78 
	`g_hash_èbÀ_ö£π
 (
de°
, 
	`g_°rdup
 (
«me
), g_°rdu∞(
vÆ
));

79 
	}
}

80 
Di˘Pr›îty
 *

81 
	$di˘¥›_c›y
(
Di˘Pr›îty
 *
§c
)

83 
Di˘Pr›îty
 *
¥›
 =

84 (
Di˘Pr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

85 
§c
->
comm⁄
.
ªas⁄
);

86 i‡(
§c
->
di˘
)

87 
	`g_hash_èbÀ_f‹óch
 (
§c
->
di˘
, 
_keyvÆue_c›y
, 
¥›
->dict);

89  
¥›
;

90 
	}
}

93 
	$di˘¥›_lﬂd
(
Di˘Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

95 
D©aNode
 
kv
;

96 
guöt
 
nvÆs
 = 
	`©åibuã_num_d©a
(
©å
);

97 i‡(!
nvÆs
)

100 
kv
 = 
	`©åibuã_fú°_d©a
 (
d©a
);

101 
kv
) {

102 
xmlCh¨
 *
key
 = 
	`xmlGëPr›
(
kv
, (const xmlChar *)"name");

104 i‡(
key
) {

105 
gch¨
 *
vÆue
 = 
	`d©a_°rög
(
	`©åibuã_fú°_d©a
 (
kv
));

106 i‡(
vÆue
)

107 
	`g_hash_èbÀ_ö£π
 (
¥›
->
di˘
, 
	`g_°rdup
((
gch¨
 *)
key
), 
vÆue
);

109 
	`g_w¨nög
 ("Dictionary key missing");

111 
kv
 = 
	`d©a_√xt
(kv);

113 
	}
}

115 
GHashTabÀ
 *

116 
	$_hash_dup
 (c⁄° 
GHashTabÀ
 *
§c
)

118 
GHashTabÀ
 *
de°
 = 
NULL
;

119 i‡(
§c
) {

120 
de°
 = 
	`g_hash_èbÀ_√w_fuŒ
 (
g_°r_hash
, 
g_°r_equÆ
, 
g_‰ì
, g_free);

121 
	`g_hash_èbÀ_f‹óch
 ((
GHashTabÀ
 *)
§c
, 
_keyvÆue_c›y
, 
de°
);

123  
de°
;

124 
	}
}

127 
	$_keyvÆue_ßve
 (
gpoöãr
 
key
,

128 
gpoöãr
 
vÆue
,

129 
gpoöãr
 
u£r_d©a
)

131 
gch¨
 *
«me
 = (gch¨ *)
key
;

132 
gch¨
 *
vÆ
 = (gch¨ *)
vÆue
;

133 
Obje˘Node
 
node
 = (Obje˘Node)
u£r_d©a
;

135 
	`d©a_add_°rög
(
	`√w_©åibuã
(
node
, 
«me
), 
vÆ
);

136 
	}
}

138 
	$di˘¥›_ßve
(
Di˘Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

140 
Obje˘Node
 
composôe
 = 
	`d©a_add_composôe
(
©å
, "dict");

141 i‡(
¥›
->
di˘
)

142 
	`g_hash_èbÀ_f‹óch
 (
¥›
->
di˘
, 
_keyvÆue_ßve
, 
composôe
);

143 
	}
}

146 
	$di˘¥›_gë_‰om_off£t
(
Di˘Pr›îty
 *
¥›
,

147 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

149 
¥›
->
di˘
 = 
	`_hash_dup
 (
	`°ru˘_membî
(
ba£
,
off£t
,
GHashTabÀ
 *));

150 
	}
}

153 
	$di˘¥›_£t_‰om_off£t
(
Di˘Pr›îty
 *
¥›
,

154 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

156 
GHashTabÀ
 *
de°
 = 
	`°ru˘_membî
(
ba£
,
off£t
,GHashTable *);

157 i‡(
de°
)

158 
	`g_hash_èbÀ_de°roy
 (
de°
);

159 
	`°ru˘_membî
(
ba£
,
off£t
, 
GHashTabÀ
 *Ë
	`_hash_dup
 (
¥›
->
di˘
);

160 
	}
}

162 c⁄° 
Pr›îtyOps
 
	gdi˘¥›_›s
 = {

163 (
Pr›îtyTy≥_New
Ë
di˘¥›_√w
,

164 (
Pr›îtyTy≥_Fªe
Ë
di˘¥›_‰ì
,

165 (
Pr›îtyTy≥_C›y
Ë
di˘¥›_c›y
,

166 (
Pr›îtyTy≥_Lﬂd
Ë
di˘¥›_lﬂd
,

167 (
Pr›îtyTy≥_Save
Ë
di˘¥›_ßve
,

168 (
Pr›îtyTy≥_GëWidgë
Ë
no›¥›_gë_widgë
,

169 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

170 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

172 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

173 (
Pr›îtyTy≥_GëFromOff£t
Ë
di˘¥›_gë_‰om_off£t
,

174 (
Pr›îtyTy≥_SëFromOff£t
Ë
di˘¥›_£t_‰om_off£t


178 
	$¥›_di˘ty≥s_ªgi°î
()

180 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_DICT
, &
di˘¥›_›s
);

181 
	}
}

183 
GHashTabÀ
 *

184 
	$d©a_di˘
 (
D©aNode
 
d©a
)

186 
GHashTabÀ
 *
ht
 = 
NULL
;

187 
nvÆs
 = 
	`©åibuã_num_d©a
 (
d©a
);

189 i‡(
nvÆs
) {

190 
D©aNode
 
kv
 = 
	`©åibuã_fú°_d©a
 (
d©a
);

191 
gch¨
 *
vÆ
 = 
NULL
;

193 
ht
 = 
	`g_hash_èbÀ_√w_fuŒ
 (
g_°r_hash
, 
g_°r_equÆ
, 
g_‰ì
, g_free);

194 
kv
) {

195 
xmlCh¨
 *
key
 = 
	`xmlGëPr›
(
kv
, (const xmlChar *)"name");

197 i‡(
key
) {

198 
vÆ
 = 
	`d©a_°rög
 (
	`©åibuã_fú°_d©a
 (
kv
));

199 i‡(
vÆ
)

200 
	`g_hash_èbÀ_ö£π
 (
ht
, 
	`g_°rdup
 ((
gch¨
 *)
key
), 
vÆ
);

201 
	`xmlFªe
 (
key
);

203 
kv
 = 
	`d©a_√xt
 (kv);

206  
ht
;

207 
	}
}

210 
	$d©a_add_di˘
 (
AâribuãNode
 
©å
, 
GHashTabÀ
 *
d©a
)

212 
Obje˘Node
 
composôe
 = 
	`d©a_add_composôe
(
©å
, "dict");

214 
	`g_hash_èbÀ_f‹óch
 (
d©a
, 
_keyvÆue_ßve
, 
composôe
);

215 
	}
}

	@O:\tool\dvs50\lib\prop_dict.h

26 #i‚de‡
PROP_DICT_H


27 
	#PROP_DICT_H


	)

29 
	~"¥›îtõs.h
"

30 
	~"dü_xml.h
"

33 
Pr›îty
 
	mcomm⁄
;

34 
GHashTabÀ
 *
	mdi˘
;

35 } 
	tDi˘Pr›îty
;

37 
DIAVAR
 
¥›_di˘ty≥s_ªgi°î
();

	@O:\tool\dvs50\lib\prop_geomtypes.c

25 #ifde‡
HAVE_CONFIG_H


26 
	~<c⁄fig.h
>

29 
	~<°rög.h
>

31 
	~<gtk/gtk.h
>

32 
	#WIDGET
 
GtkWidgë


	)

33 
	~"widgës.h
"

34 
	~"¥›îtõs.h
"

35 
	~"¥›öã∫Æs.h
"

36 
	~"geomëry.h
"

37 
	~"c⁄≈oöt_löe.h
"

38 
	~"¥›_geomty≥s.h
"

39 
	~"¥efs.h
"

41 
f⁄tsizïr›_ª£t_widgë
(
F⁄tsizePr›îty
 *
¥›
, 
WIDGET
 *
widgë
);

47 
RólPr›îty
 *

48 
	$ªÆ¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

50 
RólPr›îty
 *
¥›
 = 
	`g_√w0
(RealProperty,1);

51 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

52 
¥›
->
ªÆ_d©a
 = 0.0;

53  
¥›
;

54 
	}
}

56 
RólPr›îty
 *

57 
	$ªÆ¥›_c›y
(
RólPr›îty
 *
§c
)

59 
RólPr›îty
 *
¥›
 =

60 (
RólPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

61 
§c
->
comm⁄
.
ªas⁄
);

62 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

63 
¥›
->
ªÆ_d©a
 = 
§c
->real_data;

64  
¥›
;

65 
	}
}

67 
WIDGET
 *

68 
	$ªÆ¥›_gë_widgë
(
RólPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

70 
GtkAdju°mít
 *
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(
¥›
->
ªÆ_d©a
,

71 
G_MINFLOAT
,

72 
G_MAXFLOAT
,

74 
GtkWidgë
 *
ªt
 = 
	`gtk_•ö_buâ⁄_√w
(
adj
, 1.0, 2);

75 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
ªt
),
TRUE
);

76 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "value_changed");

78  
ªt
;

79 
	}
}

82 
	$ªÆ¥›_ª£t_widgë
(
RólPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

84 
GtkAdju°mít
 *
adj
;

85 i‡(
¥›
->
comm⁄
.
exåa_d©a
) {

86 
Pr›NumD©a
 *
numd©a
 = 
¥›
->
comm⁄
.
exåa_d©a
;

87 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(
¥›
->
ªÆ_d©a
,

88 
numd©a
->
mö
,Çumd©a->
max
,

89 
numd©a
->
°ï
,

90 10.0 * 
numd©a
->
°ï
, 0));

92 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(
¥›
->
ªÆ_d©a
,

93 
G_MINFLOAT
, 
G_MAXFLOAT
,

96 
	`gtk_•ö_buâ⁄_£t_adju°mít
(
	`GTK_SPIN_BUTTON
(
widgë
), 
adj
);

97 
	}
}

100 
	$ªÆ¥›_£t_‰om_widgë
(
RólPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

102 
¥›
->
ªÆ_d©a
 = 
	`gtk_•ö_buâ⁄_gë_vÆue
(
	`GTK_SPIN_BUTTON
(
widgë
));

103 
	}
}

106 
	$ªÆ¥›_lﬂd
(
RólPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

108 
¥›
->
ªÆ_d©a
 = 
	`d©a_ªÆ
(
d©a
);

109 
	}
}

112 
	$ªÆ¥›_ßve
(
RólPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

114 
	`d©a_add_ªÆ
(
©å
, 
¥›
->
ªÆ_d©a
);

115 
	}
}

118 
	$ªÆ¥›_gë_‰om_off£t
(
RólPr›îty
 *
¥›
,

119 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

121 
¥›
->
ªÆ_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
ªÆ
);

122 
	}
}

125 
	$ªÆ¥›_£t_‰om_off£t
(
RólPr›îty
 *
¥›
,

126 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

128 
	`°ru˘_membî
(
ba£
,
off£t
,
ªÆ
Ë
¥›
->
ªÆ_d©a
;

129 
	}
}

132 
	$ªÆ¥›_gë_d©a_size
(
RólPr›îty
 *
¥›
)

134   (
¥›
->
ªÆ_d©a
);

135 
	}
}

137 c⁄° 
Pr›îtyOps
 
	gªÆ¥›_›s
 = {

138 (
Pr›îtyTy≥_New
Ë
ªÆ¥›_√w
,

139 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

140 (
Pr›îtyTy≥_C›y
Ë
ªÆ¥›_c›y
,

141 (
Pr›îtyTy≥_Lﬂd
Ë
ªÆ¥›_lﬂd
,

142 (
Pr›îtyTy≥_Save
Ë
ªÆ¥›_ßve
,

143 (
Pr›îtyTy≥_GëWidgë
Ë
ªÆ¥›_gë_widgë
,

144 (
Pr›îtyTy≥_Re£tWidgë
Ë
ªÆ¥›_ª£t_widgë
,

145 (
Pr›îtyTy≥_SëFromWidgë
Ë
ªÆ¥›_£t_‰om_widgë
,

147 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

148 (
Pr›îtyTy≥_GëFromOff£t
Ë
ªÆ¥›_gë_‰om_off£t
,

149 (
Pr›îtyTy≥_SëFromOff£t
Ë
ªÆ¥›_£t_‰om_off£t
,

150 (
Pr›îtyTy≥_GëD©aSize
Ë
ªÆ¥›_gë_d©a_size


157 
LígthPr›îty
 *

158 
	$Àngth¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

160 
LígthPr›îty
 *
¥›
 = 
	`g_√w0
(LengthProperty,1);

161 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

162 
¥›
->
Àngth_d©a
 = 0.0;

163  
¥›
;

164 
	}
}

166 
LígthPr›îty
 *

167 
	$Àngth¥›_c›y
(
LígthPr›îty
 *
§c
)

169 
LígthPr›îty
 *
¥›
 =

170 (
LígthPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

171 
§c
->
comm⁄
.
ªas⁄
);

172 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

173 
¥›
->
Àngth_d©a
 = 
§c
->length_data;

174  
¥›
;

175 
	}
}

177 
WIDGET
 *

178 
	$Àngth¥›_gë_widgë
(
LígthPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

180 
GtkAdju°mít
 *
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(
¥›
->
Àngth_d©a
,

181 
G_MINFLOAT
,

182 
G_MAXFLOAT
,

184 
GtkWidgë
 *
ªt
 = 
	`dü_unô_•ö√r_√w
(
adj
, 
	`¥efs_gë_Àngth_unô
());

186 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "value-changed");

188  
ªt
;

189 
	}
}

192 
	$Àngth¥›_ª£t_widgë
(
LígthPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

209 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
widgë
), 
¥›
->
Àngth_d©a
);

210 
	}
}

213 
	$Àngth¥›_£t_‰om_widgë
(
LígthPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

215 
¥›
->
Àngth_d©a
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
widgë
));

216 
	}
}

219 
	$Àngth¥›_lﬂd
(
LígthPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

221 
¥›
->
Àngth_d©a
 = 
	`d©a_ªÆ
(
d©a
);

222 
	}
}

225 
	$Àngth¥›_ßve
(
LígthPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

227 
	`d©a_add_ªÆ
(
©å
, 
¥›
->
Àngth_d©a
);

228 
	}
}

231 
	$Àngth¥›_gë_‰om_off£t
(
LígthPr›îty
 *
¥›
,

232 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

234 
¥›
->
Àngth_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
ªÆ
);

235 
	}
}

238 
	$Àngth¥›_£t_‰om_off£t
(
LígthPr›îty
 *
¥›
,

239 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

241 
	`°ru˘_membî
(
ba£
,
off£t
,
ªÆ
Ë
¥›
->
Àngth_d©a
;

242 
	}
}

245 
	$Àngth¥›_gë_d©a_size
(
LígthPr›îty
 *
¥›
)

247   (
¥›
->
Àngth_d©a
);

248 
	}
}

250 c⁄° 
Pr›îtyOps
 
	gÀngth¥›_›s
 = {

251 (
Pr›îtyTy≥_New
Ë
Àngth¥›_√w
,

252 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

253 (
Pr›îtyTy≥_C›y
Ë
Àngth¥›_c›y
,

254 (
Pr›îtyTy≥_Lﬂd
Ë
Àngth¥›_lﬂd
,

255 (
Pr›îtyTy≥_Save
Ë
Àngth¥›_ßve
,

256 (
Pr›îtyTy≥_GëWidgë
Ë
Àngth¥›_gë_widgë
,

257 (
Pr›îtyTy≥_Re£tWidgë
Ë
Àngth¥›_ª£t_widgë
,

258 (
Pr›îtyTy≥_SëFromWidgë
Ë
Àngth¥›_£t_‰om_widgë
,

260 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

261 (
Pr›îtyTy≥_GëFromOff£t
Ë
Àngth¥›_gë_‰om_off£t
,

262 (
Pr›îtyTy≥_SëFromOff£t
Ë
Àngth¥›_£t_‰om_off£t
,

263 (
Pr›îtyTy≥_GëD©aSize
Ë
Àngth¥›_gë_d©a_size


270 
F⁄tsizePr›îty
 *

271 
	$f⁄tsizïr›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

273 
F⁄tsizePr›îty
 *
¥›
 = 
	`g_√w0
(FontsizeProperty,1);

274 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

275 
¥›
->
f⁄tsize_d©a
 = 0.0;

276  
¥›
;

277 
	}
}

279 
F⁄tsizePr›îty
 *

280 
	$f⁄tsizïr›_c›y
(
F⁄tsizePr›îty
 *
§c
)

282 
F⁄tsizePr›îty
 *
¥›
 =

283 (
F⁄tsizePr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

284 
§c
->
comm⁄
.
ªas⁄
);

285 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

286 
¥›
->
f⁄tsize_d©a
 = 
§c
->fontsize_data;

287  
¥›
;

288 
	}
}

290 
WIDGET
 *

291 
	$f⁄tsizïr›_gë_widgë
(
F⁄tsizePr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

293 
GtkAdju°mít
 *
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(
¥›
->
f⁄tsize_d©a
,

294 
G_MINFLOAT
,

295 
G_MAXFLOAT
,

297 
GtkWidgë
 *
ªt
 = 
	`dü_unô_•ö√r_√w
(
adj
, 
	`¥efs_gë_f⁄tsize_unô
());

299 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "value-changed");

301  
ªt
;

302 
	}
}

305 
	$f⁄tsizïr›_ª£t_widgë
(
F⁄tsizePr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

307 
	`dü_unô_•ö√r_£t_vÆue
(
	`DIA_UNIT_SPINNER
(
widgë
), 
¥›
->
f⁄tsize_d©a
);

308 
	}
}

311 
	$f⁄tsizïr›_£t_‰om_widgë
(
F⁄tsizePr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

313 
¥›
->
f⁄tsize_d©a
 = 
	`dü_unô_•ö√r_gë_vÆue
(
	`DIA_UNIT_SPINNER
(
widgë
));

314 
	}
}

317 
	$f⁄tsizïr›_lﬂd
(
F⁄tsizePr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

319 
Pr›NumD©a
 *
numd©a
 = 
¥›
->
comm⁄
.
exåa_d©a
;

320 
ªÆ
 
vÆue
 = 
	`d©a_ªÆ
(
d©a
);

322 i‡(
numd©a
) {

323 i‡(
vÆue
 < 
numd©a
->
mö
)

324 
vÆue
 = 
numd©a
->
mö
;

325 i‡(
vÆue
 > 
numd©a
->
max
)

326 
vÆue
 = 
numd©a
->
max
;

328 
¥›
->
f⁄tsize_d©a
 = 
vÆue
;

329 
	}
}

332 
	$f⁄tsizïr›_ßve
(
F⁄tsizePr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

334 
	`d©a_add_ªÆ
(
©å
, 
¥›
->
f⁄tsize_d©a
);

335 
	}
}

338 
	$f⁄tsizïr›_gë_‰om_off£t
(
F⁄tsizePr›îty
 *
¥›
,

339 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

341 
¥›
->
f⁄tsize_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
ªÆ
);

342 
	}
}

345 
	$f⁄tsizïr›_£t_‰om_off£t
(
F⁄tsizePr›îty
 *
¥›
,

346 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

348 
Pr›NumD©a
 *
numd©a
 = 
¥›
->
comm⁄
.
exåa_d©a
;

349 
ªÆ
 
vÆue
 = 
¥›
->
f⁄tsize_d©a
;

351 i‡(
numd©a
) {

352 i‡(
vÆue
 < 
numd©a
->
mö
)

353 
vÆue
 = 
numd©a
->
mö
;

354 i‡(
vÆue
 > 
numd©a
->
max
)

355 
vÆue
 = 
numd©a
->
max
;

357 
	`°ru˘_membî
(
ba£
,
off£t
,
ªÆ
Ë
vÆue
;

358 
	}
}

361 
	$f⁄tsizïr›_gë_d©a_size
(
F⁄tsizePr›îty
 *
¥›
)

363   (
¥›
->
f⁄tsize_d©a
);

364 
	}
}

366 c⁄° 
Pr›îtyOps
 
	gf⁄tsizïr›_›s
 = {

367 (
Pr›îtyTy≥_New
Ë
f⁄tsizïr›_√w
,

368 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

369 (
Pr›îtyTy≥_C›y
Ë
f⁄tsizïr›_c›y
,

370 (
Pr›îtyTy≥_Lﬂd
Ë
f⁄tsizïr›_lﬂd
,

371 (
Pr›îtyTy≥_Save
Ë
f⁄tsizïr›_ßve
,

372 (
Pr›îtyTy≥_GëWidgë
Ë
f⁄tsizïr›_gë_widgë
,

373 (
Pr›îtyTy≥_Re£tWidgë
Ë
f⁄tsizïr›_ª£t_widgë
,

374 (
Pr›îtyTy≥_SëFromWidgë
Ë
f⁄tsizïr›_£t_‰om_widgë
,

376 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

377 (
Pr›îtyTy≥_GëFromOff£t
Ë
f⁄tsizïr›_gë_‰om_off£t
,

378 (
Pr›îtyTy≥_SëFromOff£t
Ë
f⁄tsizïr›_£t_‰om_off£t
,

379 (
Pr›îtyTy≥_GëD©aSize
Ë
f⁄tsizïr›_gë_d©a_size


386 
PoötPr›îty
 *

387 
	$poöçr›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

389 
PoötPr›îty
 *
¥›
 = 
	`g_√w0
(PointProperty,1);

390 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

391 
¥›
->
poöt_d©a
.
x
 = 0.0;

392 
¥›
->
poöt_d©a
.
y
 = 0.0;

393  
¥›
;

394 
	}
}

396 
PoötPr›îty
 *

397 
	$poöçr›_c›y
(
PoötPr›îty
 *
§c
)

399 
PoötPr›îty
 *
¥›
 =

400 (
PoötPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

401 
§c
->
comm⁄
.
ªas⁄
);

402 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

403 
¥›
->
poöt_d©a
 = 
§c
->point_data;

404  
¥›
;

405 
	}
}

408 
	$poöçr›_lﬂd
(
PoötPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

410 
	`d©a_poöt
(
d©a
,&
¥›
->
poöt_d©a
);

411 
	}
}

414 
	$poöçr›_ßve
(
PoötPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

416 
	`d©a_add_poöt
(
©å
, &
¥›
->
poöt_d©a
);

417 
	}
}

420 
	$poöçr›_gë_‰om_off£t
(
PoötPr›îty
 *
¥›
,

421 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

423 
¥›
->
poöt_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
Poöt
);

424 
	}
}

427 
	$poöçr›_£t_‰om_off£t
(
PoötPr›îty
 *
¥›
,

428 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

430 
	`°ru˘_membî
(
ba£
,
off£t
,
Poöt
Ë
¥›
->
poöt_d©a
;

431 
	}
}

433 c⁄° 
Pr›îtyOps
 
	gpoöçr›_›s
 = {

434 (
Pr›îtyTy≥_New
Ë
poöçr›_√w
,

435 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

436 (
Pr›îtyTy≥_C›y
Ë
poöçr›_c›y
,

437 (
Pr›îtyTy≥_Lﬂd
Ë
poöçr›_lﬂd
,

438 (
Pr›îtyTy≥_Save
Ë
poöçr›_ßve
,

439 (
Pr›îtyTy≥_GëWidgë
Ë
övÆid¥›_gë_widgë
,

440 (
Pr›îtyTy≥_Re£tWidgë
Ë
övÆid¥›_ª£t_widgë
,

441 (
Pr›îtyTy≥_SëFromWidgë
Ë
övÆid¥›_£t_‰om_widgë
,

443 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

444 (
Pr›îtyTy≥_GëFromOff£t
Ë
poöçr›_gë_‰om_off£t
,

445 (
Pr›îtyTy≥_SëFromOff£t
Ë
poöçr›_£t_‰om_off£t


452 
PoöèºayPr›îty
 *

453 
	$poöèºay¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

454 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

456 
PoöèºayPr›îty
 *
¥›
 = 
	`g_√w0
(PointarrayProperty,1);

457 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

458 
¥›
->
poöèºay_d©a
 = 
	`g_¨øy_√w
(
FALSE
,
TRUE
,(
Poöt
));

459  
¥›
;

460 
	}
}

463 
	$poöèºay¥›_‰ì
(
PoöèºayPr›îty
 *
¥›
)

465 
	`g_¨øy_‰ì
(
¥›
->
poöèºay_d©a
,
TRUE
);

466 
	`g_‰ì
(
¥›
);

467 
	}
}

469 
PoöèºayPr›îty
 *

470 
	$poöèºay¥›_c›y
(
PoöèºayPr›îty
 *
§c
)

472 
guöt
 
i
;

473 
PoöèºayPr›îty
 *
¥›
 =

474 (
PoöèºayPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

475 
§c
->
comm⁄
.
ªas⁄
);

476 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

477 
	`g_¨øy_£t_size
(
¥›
->
poöèºay_d©a
,
§c
->poöèºay_d©a->
Àn
);

478 
i
 = 0 ; i < 
§c
->
poöèºay_d©a
->
Àn
; i++)

479 
	`g_¨øy_ödex
(
¥›
->
poöèºay_d©a
,
Poöt
,
i
) =

480 
	`g_¨øy_ödex
(
§c
->
poöèºay_d©a
,
Poöt
,
i
);

481  
¥›
;

482 
	}
}

485 
	$poöèºay¥›_lﬂd
(
PoöèºayPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

487 
guöt
 
nvÆs
 = 
	`©åibuã_num_d©a
(
©å
);

488 
guöt
 
i
;

489 
	`g_¨øy_£t_size
(
¥›
->
poöèºay_d©a
,
nvÆs
);

490 
i
=0; (ò< 
nvÆs
Ë&& 
d©a
; i++, d©®
	`d©a_√xt
(data))

491 
	`d©a_poöt
(
d©a
,&
	`g_¨øy_ödex
(
¥›
->
poöèºay_d©a
,
Poöt
,
i
));

492 i‡(
i
 !
nvÆs
)

493 
	`g_w¨nög
("attribute_num_data()ándáctual data count mismatch "

495 
	}
}

498 
	$poöèºay¥›_ßve
(
PoöèºayPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

500 
guöt
 
i
;

501 
i
 = 0; i < 
¥›
->
poöèºay_d©a
->
Àn
; i++)

502 
	`d©a_add_poöt
(
©å
, &
	`g_¨øy_ödex
(
¥›
->
poöèºay_d©a
,
Poöt
,
i
));

503 
	}
}

506 
	$poöèºay¥›_gë_‰om_off£t
(
PoöèºayPr›îty
 *
¥›
,

507 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

509 
guöt
 
nvÆs
 = 
	`°ru˘_membî
(
ba£
,
off£t2
,guint);

510 
guöt
 
i
;

511 *
ofs_vÆ
 = 
	`°ru˘_membî
(
ba£
,
off£t
,*);

512 
	`g_¨øy_£t_size
(
¥›
->
poöèºay_d©a
,
nvÆs
);

513 
i
 = 0; i < 
nvÆs
; i++)

514 
	`g_¨øy_ödex
(
¥›
->
poöèºay_d©a
,
Poöt
,
i
) =

515 
	`°ru˘_membî
(
ofs_vÆ
,
i
 * (
Poöt
),Point);

516 
	}
}

519 
	$poöèºay¥›_£t_‰om_off£t
(
PoöèºayPr›îty
 *
¥›
,

520 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

522 
guöt
 
nvÆs
 = 
¥›
->
poöèºay_d©a
->
Àn
;

523 
Poöt
 *
vÆs
 = 
	`g_memdup
(&
	`g_¨øy_ödex
(
¥›
->
poöèºay_d©a
,Point,0),

524 (
Poöt
Ë* 
nvÆs
);

525 
	`g_‰ì
(
	`°ru˘_membî
(
ba£
,
off£t
,
Poöt
 *));

526 
	`°ru˘_membî
(
ba£
,
off£t
,
Poöt
 *Ë
vÆs
;

527 
	`°ru˘_membî
(
ba£
,
off£t2
,
guöt
Ë
nvÆs
;

528 
	}
}

530 c⁄° 
Pr›îtyOps
 
	gpoöèºay¥›_›s
 = {

531 (
Pr›îtyTy≥_New
Ë
poöèºay¥›_√w
,

532 (
Pr›îtyTy≥_Fªe
Ë
poöèºay¥›_‰ì
,

533 (
Pr›îtyTy≥_C›y
Ë
poöèºay¥›_c›y
,

534 (
Pr›îtyTy≥_Lﬂd
Ë
poöèºay¥›_lﬂd
,

535 (
Pr›îtyTy≥_Save
Ë
poöèºay¥›_ßve
,

536 (
Pr›îtyTy≥_GëWidgë
Ë
övÆid¥›_gë_widgë
,

537 (
Pr›îtyTy≥_Re£tWidgë
Ë
övÆid¥›_ª£t_widgë
,

538 (
Pr›îtyTy≥_SëFromWidgë
Ë
övÆid¥›_£t_‰om_widgë
,

540 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

541 (
Pr›îtyTy≥_GëFromOff£t
Ë
poöèºay¥›_gë_‰om_off£t
,

542 (
Pr›îtyTy≥_SëFromOff£t
Ë
poöèºay¥›_£t_‰om_off£t


550 
BezPoötPr›îty
 *

551 
	$bezpoöçr›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

552 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

554 
BezPoötPr›îty
 *
¥›
 = 
	`g_√w0
(BezPointProperty,1);

555 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

556 
	`mem£t
(&
¥›
->
bezpoöt_d©a
,0,(prop->bezpoint_data));

557  
¥›
;

558 
	}
}

560 
BezPoötPr›îty
 *

561 
	$bezpoöçr›_c›y
(
BezPoötPr›îty
 *
§c
)

563 
BezPoötPr›îty
 *
¥›
 =

564 (
BezPoötPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

565 
§c
->
comm⁄
.
ªas⁄
);

566 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

567 
¥›
->
bezpoöt_d©a
 = 
§c
->bezpoint_data;

568  
¥›
;

569 
	}
}

572 
	$bezpoöçr›_lﬂd
(
BezPoötPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

574 
	`d©a_bezpoöt
(
d©a
,&
¥›
->
bezpoöt_d©a
);

575 
	}
}

578 
	$bezpoöçr›_ßve
(
BezPoötPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

580 
	`d©a_add_bezpoöt
(
©å
, &
¥›
->
bezpoöt_d©a
);

581 
	}
}

584 
	$bezpoöçr›_gë_‰om_off£t
(
BezPoötPr›îty
 *
¥›
,

585 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

587 
¥›
->
bezpoöt_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
BezPoöt
);

588 
	}
}

591 
	$bezpoöçr›_£t_‰om_off£t
(
BezPoötPr›îty
 *
¥›
,

592 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

594 
	`°ru˘_membî
(
ba£
,
off£t
,
BezPoöt
Ë
¥›
->
bezpoöt_d©a
;

595 
	}
}

597 c⁄° 
Pr›îtyOps
 
	gbezpoöçr›_›s
 = {

598 (
Pr›îtyTy≥_New
Ë
bezpoöçr›_√w
,

599 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

600 (
Pr›îtyTy≥_C›y
Ë
bezpoöçr›_c›y
,

601 (
Pr›îtyTy≥_Lﬂd
Ë
bezpoöçr›_lﬂd
,

602 (
Pr›îtyTy≥_Save
Ë
bezpoöçr›_ßve
,

603 (
Pr›îtyTy≥_GëWidgë
Ë
övÆid¥›_gë_widgë
,

604 (
Pr›îtyTy≥_Re£tWidgë
Ë
övÆid¥›_ª£t_widgë
,

605 (
Pr›îtyTy≥_SëFromWidgë
Ë
övÆid¥›_£t_‰om_widgë
,

607 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

608 (
Pr›îtyTy≥_GëFromOff£t
Ë
bezpoöçr›_gë_‰om_off£t
,

609 (
Pr›îtyTy≥_SëFromOff£t
Ë
bezpoöçr›_£t_‰om_off£t


616 
BezPoöèºayPr›îty
 *

617 
	$bezpoöèºay¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

618 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

620 
BezPoöèºayPr›îty
 *
¥›
 = 
	`g_√w0
(BezPointarrayProperty,1);

621 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

622 
¥›
->
bezpoöèºay_d©a
 = 
	`g_¨øy_√w
(
FALSE
,
TRUE
,(
BezPoöt
));

623  
¥›
;

624 
	}
}

627 
	$bezpoöèºay¥›_‰ì
(
BezPoöèºayPr›îty
 *
¥›
)

629 
	`g_¨øy_‰ì
(
¥›
->
bezpoöèºay_d©a
,
TRUE
);

630 
	`g_‰ì
(
¥›
);

631 
	}
}

633 
BezPoöèºayPr›îty
 *

634 
	$bezpoöèºay¥›_c›y
(
BezPoöèºayPr›îty
 *
§c
)

636 
guöt
 
i
;

637 
BezPoöèºayPr›îty
 *
¥›
 =

638 (
BezPoöèºayPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

639 
§c
->
comm⁄
.
ªas⁄
);

640 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

641 
	`g_¨øy_£t_size
(
¥›
->
bezpoöèºay_d©a
,
§c
->bezpoöèºay_d©a->
Àn
);

642 
i
 = 0 ; i < 
§c
->
bezpoöèºay_d©a
->
Àn
; i++)

643 
	`g_¨øy_ödex
(
¥›
->
bezpoöèºay_d©a
,
BezPoöt
,
i
) =

644 
	`g_¨øy_ödex
(
§c
->
bezpoöèºay_d©a
,
BezPoöt
,
i
);

645  
¥›
;

646 
	}
}

649 
	$bezpoöèºay¥›_lﬂd
(
BezPoöèºayPr›îty
 *
¥›
,

650 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

652 
guöt
 
nvÆs
 = 
	`©åibuã_num_d©a
(
©å
);

653 
guöt
 
i
;

655 
	`g_¨øy_£t_size
(
¥›
->
bezpoöèºay_d©a
,
nvÆs
);

657 
i
=0; (ò< 
nvÆs
Ë&& 
d©a
; i++, d©®
	`d©a_√xt
(data))

658 
	`d©a_bezpoöt
(
d©a
,&
	`g_¨øy_ödex
(
¥›
->
bezpoöèºay_d©a
,
BezPoöt
,
i
));

659 i‡(
i
 !
nvÆs
)

660 
	`g_w¨nög
("attribute_num_data()ándáctual data count mismatch "

662 
	}
}

665 
	$bezpoöèºay¥›_ßve
(
BezPoöèºayPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

667 
guöt
 
i
;

668 
i
 = 0; i < 
¥›
->
bezpoöèºay_d©a
->
Àn
; i++)

669 
	`d©a_add_bezpoöt
(
©å
,

670 &
	`g_¨øy_ödex
(
¥›
->
bezpoöèºay_d©a
,
BezPoöt
,
i
));

671 
	}
}

674 
	$bezpoöèºay¥›_gë_‰om_off£t
(
BezPoöèºayPr›îty
 *
¥›
,

675 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

677 
guöt
 
nvÆs
 = 
	`°ru˘_membî
(
ba£
,
off£t2
,guint);

678 
guöt
 
i
;

679 *
ofs_vÆ
 = 
	`°ru˘_membî
(
ba£
,
off£t
,*);

680 
	`g_¨øy_£t_size
(
¥›
->
bezpoöèºay_d©a
,
nvÆs
);

681 
i
 = 0; i < 
nvÆs
; i++)

682 
	`g_¨øy_ödex
(
¥›
->
bezpoöèºay_d©a
,
BezPoöt
,
i
) =

683 
	`°ru˘_membî
(
ofs_vÆ
,
i
 * (
BezPoöt
),BezPoint);

684 
	}
}

687 
	$bezpoöèºay¥›_£t_‰om_off£t
(
BezPoöèºayPr›îty
 *
¥›
,

688 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

690 
guöt
 
nvÆs
 = 
¥›
->
bezpoöèºay_d©a
->
Àn
;

691 
BezPoöt
 *
vÆs
 = 
	`g_memdup
(&
	`g_¨øy_ödex
(
¥›
->
bezpoöèºay_d©a
,

692 
BezPoöt
,0),

693 (
BezPoöt
Ë* 
nvÆs
);

694 
	`g_‰ì
(
	`°ru˘_membî
(
ba£
,
off£t
,
göt
 *));

695 
	`°ru˘_membî
(
ba£
,
off£t
,
BezPoöt
 *Ë
vÆs
;

696 
	`°ru˘_membî
(
ba£
,
off£t2
,
guöt
Ë
nvÆs
;

697 
	}
}

699 c⁄° 
Pr›îtyOps
 
	gbezpoöèºay¥›_›s
 = {

700 (
Pr›îtyTy≥_New
Ë
bezpoöèºay¥›_√w
,

701 (
Pr›îtyTy≥_Fªe
Ë
bezpoöèºay¥›_‰ì
,

702 (
Pr›îtyTy≥_C›y
Ë
bezpoöèºay¥›_c›y
,

703 (
Pr›îtyTy≥_Lﬂd
Ë
bezpoöèºay¥›_lﬂd
,

704 (
Pr›îtyTy≥_Save
Ë
bezpoöèºay¥›_ßve
,

705 (
Pr›îtyTy≥_GëWidgë
Ë
övÆid¥›_gë_widgë
,

706 (
Pr›îtyTy≥_Re£tWidgë
Ë
övÆid¥›_ª£t_widgë
,

707 (
Pr›îtyTy≥_SëFromWidgë
Ë
övÆid¥›_£t_‰om_widgë
,

709 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

710 (
Pr›îtyTy≥_GëFromOff£t
Ë
bezpoöèºay¥›_gë_‰om_off£t
,

711 (
Pr›îtyTy≥_SëFromOff£t
Ë
bezpoöèºay¥›_£t_‰om_off£t


718 
Re˘Pr›îty
 *

719 
	$ª˘¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

721 
Re˘Pr›îty
 *
¥›
 = 
	`g_√w0
(RectProperty,1);

722 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

723 
	`mem£t
(&
¥›
->
ª˘_d©a
,0,(prop->rect_data));

724  
¥›
;

725 
	}
}

727 
Re˘Pr›îty
 *

728 
	$ª˘¥›_c›y
(
Re˘Pr›îty
 *
§c
)

730 
Re˘Pr›îty
 *
¥›
 =

731 (
Re˘Pr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

732 
§c
->
comm⁄
.
ªas⁄
);

733 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

734 
¥›
->
ª˘_d©a
 = 
§c
->rect_data;

735  
¥›
;

736 
	}
}

739 
	$ª˘¥›_lﬂd
(
Re˘Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

741 
	`d©a_ª˘™gÀ
(
d©a
,&
¥›
->
ª˘_d©a
);

742 
	}
}

745 
	$ª˘¥›_ßve
(
Re˘Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

747 
	`d©a_add_ª˘™gÀ
(
©å
, &
¥›
->
ª˘_d©a
);

748 
	}
}

751 
	$ª˘¥›_gë_‰om_off£t
(
Re˘Pr›îty
 *
¥›
,

752 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

754 
¥›
->
ª˘_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
Re˘™gÀ
);

755 
	}
}

758 
	$ª˘¥›_£t_‰om_off£t
(
Re˘Pr›îty
 *
¥›
,

759 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

761 
	`°ru˘_membî
(
ba£
,
off£t
,
Re˘™gÀ
Ë
¥›
->
ª˘_d©a
;

762 
	}
}

764 c⁄° 
Pr›îtyOps
 
	gª˘¥›_›s
 = {

765 (
Pr›îtyTy≥_New
Ë
ª˘¥›_√w
,

766 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

767 (
Pr›îtyTy≥_C›y
Ë
ª˘¥›_c›y
,

768 (
Pr›îtyTy≥_Lﬂd
Ë
ª˘¥›_lﬂd
,

769 (
Pr›îtyTy≥_Save
Ë
ª˘¥›_ßve
,

770 (
Pr›îtyTy≥_GëWidgë
Ë
övÆid¥›_gë_widgë
,

771 (
Pr›îtyTy≥_Re£tWidgë
Ë
övÆid¥›_ª£t_widgë
,

772 (
Pr›îtyTy≥_SëFromWidgë
Ë
övÆid¥›_£t_‰om_widgë
,

774 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

775 (
Pr›îtyTy≥_GëFromOff£t
Ë
ª˘¥›_gë_‰om_off£t
,

776 (
Pr›îtyTy≥_SëFromOff£t
Ë
ª˘¥›_£t_‰om_off£t


783 
EndpoötsPr›îty
 *

784 
	$ídpoöt•r›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

785 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

787 
EndpoötsPr›îty
 *
¥›
 = 
	`g_√w0
(EndpointsProperty,1);

788 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

789 
	`mem£t
(&
¥›
->
ídpoöts_d©a
,0,(prop->endpoints_data));

790  
¥›
;

791 
	}
}

793 
EndpoötsPr›îty
 *

794 
	$ídpoöt•r›_c›y
(
EndpoötsPr›îty
 *
§c
)

796 
EndpoötsPr›îty
 *
¥›
 =

797 (
EndpoötsPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

798 
§c
->
comm⁄
.
ªas⁄
);

799 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

800 
	`mem˝y
(&
¥›
->
ídpoöts_d©a
,

801 &
§c
->
ídpoöts_d©a
,

802 (
¥›
->
ídpoöts_d©a
));

803  
¥›
;

804 
	}
}

807 
	$ídpoöt•r›_lﬂd
(
EndpoötsPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

809 
	`d©a_poöt
(
d©a
,&
¥›
->
ídpoöts_d©a
[0]);

810 
d©a
 = 
	`d©a_√xt
(data);

811 
	`d©a_poöt
(
d©a
,&
¥›
->
ídpoöts_d©a
[1]);

812 
	}
}

815 
	$ídpoöt•r›_ßve
(
EndpoötsPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

817 
	`d©a_add_poöt
(
©å
, &
¥›
->
ídpoöts_d©a
[0]);

818 
	`d©a_add_poöt
(
©å
, &
¥›
->
ídpoöts_d©a
[1]);

819 
	}
}

822 
	$ídpoöt•r›_gë_‰om_off£t
(
EndpoötsPr›îty
 *
¥›
,

823 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

825 
	`mem˝y
(&
¥›
->
ídpoöts_d©a
,

826 &
	`°ru˘_membî
(
ba£
,
off£t
,
Poöt
),

827 (
¥›
->
ídpoöts_d©a
));

828 
	}
}

831 
	$ídpoöt•r›_£t_‰om_off£t
(
EndpoötsPr›îty
 *
¥›
,

832 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

834 
	`mem˝y
(&
	`°ru˘_membî
(
ba£
,
off£t
,
Poöt
),

835 &
¥›
->
ídpoöts_d©a
,

836 (
¥›
->
ídpoöts_d©a
));

837 
	}
}

839 c⁄° 
Pr›îtyOps
 
	gídpoöt•r›_›s
 = {

840 (
Pr›îtyTy≥_New
Ë
ídpoöt•r›_√w
,

841 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

842 (
Pr›îtyTy≥_C›y
Ë
ídpoöt•r›_c›y
,

843 (
Pr›îtyTy≥_Lﬂd
Ë
ídpoöt•r›_lﬂd
,

844 (
Pr›îtyTy≥_Save
Ë
ídpoöt•r›_ßve
,

845 (
Pr›îtyTy≥_GëWidgë
Ë
övÆid¥›_gë_widgë
,

846 (
Pr›îtyTy≥_Re£tWidgë
Ë
övÆid¥›_ª£t_widgë
,

847 (
Pr›îtyTy≥_SëFromWidgë
Ë
övÆid¥›_£t_‰om_widgë
,

849 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

850 (
Pr›îtyTy≥_GëFromOff£t
Ë
ídpoöt•r›_gë_‰om_off£t
,

851 (
Pr›îtyTy≥_SëFromOff£t
Ë
ídpoöt•r›_£t_‰om_off£t


858 
C⁄≈oöt_LöePr›îty
 *

859 
	$c⁄≈oöt_löïr›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

860 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

862 
C⁄≈oöt_LöePr›îty
 *
¥›
 = 
	`g_√w0
(Connpoint_LineProperty,1);

863 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

864 
¥›
->
c⁄≈oöt_löe_d©a
 = 0;

865  
¥›
;

866 
	}
}

868 
C⁄≈oöt_LöePr›îty
 *

869 
	$c⁄≈oöt_löïr›_c›y
(
C⁄≈oöt_LöePr›îty
 *
§c
)

871 
C⁄≈oöt_LöePr›îty
 *
¥›
 =

872 (
C⁄≈oöt_LöePr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

873 
§c
->
comm⁄
.
ªas⁄
);

874 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

875 
¥›
->
c⁄≈oöt_löe_d©a
 = 
§c
->connpoint_line_data;

876  
¥›
;

877 
	}
}

880 
	$c⁄≈oöt_löïr›_lﬂd
(
C⁄≈oöt_LöePr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

882 
¥›
->
c⁄≈oöt_löe_d©a
 = 
	`d©a_öt
(
d©a
);

883 
	}
}

886 
	$c⁄≈oöt_löïr›_ßve
(
C⁄≈oöt_LöePr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

888 
	`d©a_add_öt
(
©å
, 
¥›
->
c⁄≈oöt_löe_d©a
);

889 
	}
}

892 
	$c⁄≈oöt_löïr›_gë_‰om_off£t
(
C⁄≈oöt_LöePr›îty
 *
¥›
,

893 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

895 
¥›
->
c⁄≈oöt_löe_d©a
 =

896 
	`°ru˘_membî
(
ba£
,
off£t
,
C⁄nPoötLöe
 *)->
num_c⁄√˘i⁄s
;

897 
	}
}

900 
	$c⁄≈oöt_löïr›_£t_‰om_off£t
(
C⁄≈oöt_LöePr›îty
 *
¥›
,

901 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

903 
	`c⁄≈oöéöe_adju°_cou¡
(
	`°ru˘_membî
(
ba£
,
off£t
,
C⁄nPoötLöe
 *),

904 
¥›
->
c⁄≈oöt_löe_d©a
,

905 &
	`°ru˘_membî
(
ba£
,
off£t
,
C⁄nPoötLöe
 *)->
íd
);

906 
	}
}

908 c⁄° 
Pr›îtyOps
 
	gc⁄≈oöt_löïr›_›s
 = {

909 (
Pr›îtyTy≥_New
Ë
c⁄≈oöt_löïr›_√w
,

910 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

911 (
Pr›îtyTy≥_C›y
Ë
c⁄≈oöt_löïr›_c›y
,

912 (
Pr›îtyTy≥_Lﬂd
Ë
c⁄≈oöt_löïr›_lﬂd
,

913 (
Pr›îtyTy≥_Save
Ë
c⁄≈oöt_löïr›_ßve
,

914 (
Pr›îtyTy≥_GëWidgë
Ë
övÆid¥›_gë_widgë
,

915 (
Pr›îtyTy≥_Re£tWidgë
Ë
övÆid¥›_ª£t_widgë
,

916 (
Pr›îtyTy≥_SëFromWidgë
Ë
övÆid¥›_£t_‰om_widgë
,

918 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

919 (
Pr›îtyTy≥_GëFromOff£t
Ë
c⁄≈oöt_löïr›_gë_‰om_off£t
,

920 (
Pr›îtyTy≥_SëFromOff£t
Ë
c⁄≈oöt_löïr›_£t_‰om_off£t


927 
	$¥›_geomty≥s_ªgi°î
()

929 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_REAL
,&
ªÆ¥›_›s
);

930 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_LENGTH
,&
Àngth¥›_›s
);

931 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_FONTSIZE
,&
f⁄tsizïr›_›s
);

932 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_POINT
,&
poöçr›_›s
);

933 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_POINTARRAY
,&
poöèºay¥›_›s
);

934 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_BEZPOINTARRAY
,&
bezpoöèºay¥›_›s
);

935 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_RECT
,&
ª˘¥›_›s
);

936 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_ENDPOINTS
,&
ídpoöt•r›_›s
);

937 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_CONNPOINT_LINE
,&
c⁄≈oöt_löïr›_›s
);

938 
	}
}

	@O:\tool\dvs50\lib\prop_geomtypes.h

25 #i‚de‡
PROP_GEOMTYPES_H


26 
	#PROP_GEOMTYPES_H


	)

28 
	~"¥›îtõs.h
"

29 
	~"geomëry.h
"

32 
Pr›îty
 
	mcomm⁄
;

33 
ªÆ
 
	mªÆ_d©a
;

34 } 
	tRólPr›îty
;

37 
Pr›îty
 
	mcomm⁄
;

38 
ªÆ
 
	mÀngth_d©a
;

39 } 
	tLígthPr›îty
;

42 
Pr›îty
 
	mcomm⁄
;

43 
ªÆ
 
	mf⁄tsize_d©a
;

44 } 
	tF⁄tsizePr›îty
;

47 
Pr›îty
 
	mcomm⁄
;

48 
Poöt
 
	mpoöt_d©a
;

49 } 
	tPoötPr›îty
;

52 
Pr›îty
 
	mcomm⁄
;

53 
GAºay
 *
	mpoöèºay_d©a
;

54 } 
	tPoöèºayPr›îty
;

57 
Pr›îty
 
	mcomm⁄
;

58 
BezPoöt
 
	mbezpoöt_d©a
;

59 } 
	tBezPoötPr›îty
;

62 
Pr›îty
 
	mcomm⁄
;

63 
GAºay
 *
	mbezpoöèºay_d©a
;

64 } 
	tBezPoöèºayPr›îty
;

67 
Pr›îty
 
	mcomm⁄
;

68 
Re˘™gÀ
 
	mª˘_d©a
;

69 } 
	tRe˘Pr›îty
;

72 
Pr›îty
 
	mcomm⁄
;

73 
Poöt
 
	mídpoöts_d©a
[2];

74 } 
	tEndpoötsPr›îty
;

77 
Pr›îty
 
	mcomm⁄
;

78 
göt
 
	mc⁄≈oöt_löe_d©a
;

79 } 
	tC⁄≈oöt_LöePr›îty
;

81 
DIAVAR
 
¥›_geomty≥s_ªgi°î
();

	@O:\tool\dvs50\lib\prop_inttypes.c

26 #ifde‡
HAVE_CONFIG_H


27 
	~<c⁄fig.h
>

30 
	~<°dlib.h
>

32 
	~<gtk/gtk.h
>

33 
	#WIDGET
 
GtkWidgë


	)

34 
	~"¥›îtõs.h
"

35 
	~"¥›öã∫Æs.h
"

36 
	~"mesßge.h
"

42 
Ch¨Pr›îty
 *

43 
	$ch¨¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

45 
Ch¨Pr›îty
 *
¥›
 = 
	`g_√w0
(CharProperty,1);

46 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

47 
¥›
->
ch¨_d©a
 = 0;

48  
¥›
;

49 
	}
}

51 
Ch¨Pr›îty
 *

52 
	$ch¨¥›_c›y
(
Ch¨Pr›îty
 *
§c
)

54 
Ch¨Pr›îty
 *
¥›
 =

55 (
Ch¨Pr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

56 
§c
->
comm⁄
.
ªas⁄
);

57 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

58 
¥›
->
ch¨_d©a
 = 
§c
->char_data;

59  
¥›
;

60 
	}
}

62 
WIDGET
 *

63 
	$ch¨¥›_gë_widgë
(
Ch¨Pr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

65 
GtkWidgë
 *
ªt
 = 
	`gtk_íåy_√w
();

66 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "changed");

67  
ªt
;

68 
	}
}

71 
	$ch¨¥›_ª£t_widgë
(
Ch¨Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

73 
gch¨
 
ch
[7];

74 
unûí
 = 
	`g_unich¨_to_utf8
 (
¥›
->
ch¨_d©a
, 
ch
);

75 
ch
[
unûí
] = 0;

76 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
widgë
), 
ch
);

77 
	}
}

80 
	$ch¨¥›_£t_‰om_widgë
(
Ch¨Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

82 
gch¨
 *
buf
 = 
	`gtk_edôabÀ_gë_ch¨s
(
	`GTK_EDITABLE
(
widgë
), 0, 1);

83 
¥›
->
ch¨_d©a
 = 
	`g_utf8_gë_ch¨
(
buf
);

84 
	`g_‰ì
(
buf
);

85 
	}
}

88 
	$ch¨¥›_lﬂd
(
Ch¨Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

90 
gch¨
 *
°r
 = 
	`d©a_°rög
(
d©a
);

92 i‡(
°r
 && str[0]) {

93 
¥›
->
ch¨_d©a
 = 
	`g_utf8_gë_ch¨
(
°r
);

94 
	`g_‰ì
(
°r
);

96 
	`g_w¨nög
("CouldÇotÑead character data foráttribute %s",

97 
¥›
->
comm⁄
.
«me
);

99 
	}
}

102 
	$ch¨¥›_ßve
(
Ch¨Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

104 
gch¨
 
utf
[7];

105 
göt
 
n
 = 
	`g_unich¨_to_utf8
 (
¥›
->
ch¨_d©a
, 
utf
);

106 
utf
[
n
] = 0;

107 
	`d©a_add_°rög
 (
©å
, 
utf
);

108 
	}
}

111 
	$ch¨¥›_gë_‰om_off£t
(
Ch¨Pr›îty
 *
¥›
,

112 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

114 
¥›
->
ch¨_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
gunich¨
);

115 
	}
}

118 
	$ch¨¥›_£t_‰om_off£t
(
Ch¨Pr›îty
 *
¥›
,

119 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

121 
	`°ru˘_membî
(
ba£
,
off£t
,
gunich¨
Ë
¥›
->
ch¨_d©a
;

122 
	}
}

125 
	$ch¨¥›_gë_d©a_size
(
Ch¨Pr›îty
 *
¥›
)

127   (
¥›
->
ch¨_d©a
);

128 
	}
}

131 c⁄° 
Pr›îtyOps
 
	gch¨¥›_›s
 = {

132 (
Pr›îtyTy≥_New
Ë
ch¨¥›_√w
,

133 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

134 (
Pr›îtyTy≥_C›y
Ë
ch¨¥›_c›y
,

135 (
Pr›îtyTy≥_Lﬂd
Ë
ch¨¥›_lﬂd
,

136 (
Pr›îtyTy≥_Save
Ë
ch¨¥›_ßve
,

137 (
Pr›îtyTy≥_GëWidgë
Ë
ch¨¥›_gë_widgë
,

138 (
Pr›îtyTy≥_Re£tWidgë
Ë
ch¨¥›_ª£t_widgë
,

139 (
Pr›îtyTy≥_SëFromWidgë
Ë
ch¨¥›_£t_‰om_widgë
,

141 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

142 (
Pr›îtyTy≥_GëFromOff£t
Ë
ch¨¥›_gë_‰om_off£t
,

143 (
Pr›îtyTy≥_SëFromOff£t
Ë
ch¨¥›_£t_‰om_off£t
,

144 (
Pr›îtyTy≥_GëD©aSize
Ë
ch¨¥›_gë_d©a_size


155 
	$boﬁ_toggÀd
(
GtkWidgë
 *
wid
)

157 i‡(
	`GTK_TOGGLE_BUTTON
(
wid
)->
a˘ive
)

158 
	`gtk_œbñ_£t_ãxt
(
	`GTK_LABEL
(
	`GTK_BIN
(
wid
)->
chûd
), 
	`_
("Yes"));

160 
	`gtk_œbñ_£t_ãxt
(
	`GTK_LABEL
(
	`GTK_BIN
(
wid
)->
chûd
), 
	`_
("No"));

161 
	}
}

163 
Pr›îty
 *

164 
	$boﬁ¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

166 
BoﬁPr›îty
 *
¥›
 = 
	`g_√w0
(BoolProperty,1);

167 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

168 
¥›
->
boﬁ_d©a
 = 
FALSE
;

169  &
¥›
->
comm⁄
;

170 
	}
}

172 
BoﬁPr›îty
 *

173 
	$boﬁ¥›_c›y
(
BoﬁPr›îty
 *
§c
)

175 
BoﬁPr›îty
 *
¥›
 =

176 (
BoﬁPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

177 
§c
->
comm⁄
.
ªas⁄
);

178 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

179 
¥›
->
boﬁ_d©a
 = 
§c
->bool_data;

180  
¥›
;

181 
	}
}

183 
WIDGET
 *

184 
	$boﬁ¥›_gë_widgë
(
BoﬁPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

186 
GtkWidgë
 *
ªt
 = 
	`gtk_toggÀ_buâ⁄_√w_wôh_œbñ
(
	`_
("No"));

187 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
ªt
), "toggled",

188 
	`G_CALLBACK
 (
boﬁ_toggÀd
), 
NULL
);

189 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "toggled");

190  
ªt
;

191 
	}
}

194 
	$boﬁ¥›_ª£t_widgë
(
BoﬁPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

196 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
widgë
),
¥›
->
boﬁ_d©a
);

197 
	}
}

200 
	$boﬁ¥›_£t_‰om_widgë
(
BoﬁPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

202 
¥›
->
boﬁ_d©a
 = 
	`GTK_TOGGLE_BUTTON
(
widgë
)->
a˘ive
;

203 
	}
}

206 
	$boﬁ¥›_lﬂd
(
BoﬁPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

208 
¥›
->
boﬁ_d©a
 = 
	`d©a_boﬁón
(
d©a
);

209 
	}
}

212 
	$boﬁ¥›_ßve
(
BoﬁPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

214 
	`d©a_add_boﬁón
(
©å
, 
¥›
->
boﬁ_d©a
);

215 
	}
}

218 
	$boﬁ¥›_gë_‰om_off£t
(
BoﬁPr›îty
 *
¥›
,

219 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

221 
¥›
->
boﬁ_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
gboﬁón
);

222 
	}
}

225 
	$boﬁ¥›_£t_‰om_off£t
(
BoﬁPr›îty
 *
¥›
,

226 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

228 
	`°ru˘_membî
(
ba£
,
off£t
,
gboﬁón
Ë
¥›
->
boﬁ_d©a
;

229 
	}
}

232 
	$boﬁ¥›_gë_d©a_size
(
BoﬁPr›îty
 *
¥›
)

234   (
¥›
->
boﬁ_d©a
);

235 
	}
}

238 c⁄° 
Pr›îtyOps
 
	gboﬁ¥›_›s
 = {

239 (
Pr›îtyTy≥_New
Ë
boﬁ¥›_√w
,

240 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

241 (
Pr›îtyTy≥_C›y
Ë
boﬁ¥›_c›y
,

242 (
Pr›îtyTy≥_Lﬂd
Ë
boﬁ¥›_lﬂd
,

243 (
Pr›îtyTy≥_Save
Ë
boﬁ¥›_ßve
,

244 (
Pr›îtyTy≥_GëWidgë
Ë
boﬁ¥›_gë_widgë
,

245 (
Pr›îtyTy≥_Re£tWidgë
Ë
boﬁ¥›_ª£t_widgë
,

246 (
Pr›îtyTy≥_SëFromWidgë
Ë
boﬁ¥›_£t_‰om_widgë
,

248 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

249 (
Pr›îtyTy≥_GëFromOff£t
Ë
boﬁ¥›_gë_‰om_off£t
,

250 (
Pr›îtyTy≥_SëFromOff£t
Ë
boﬁ¥›_£t_‰om_off£t
,

251 (
Pr›îtyTy≥_GëD©aSize
Ë
boﬁ¥›_gë_d©a_size


258 
I¡Pr›îty
 *

259 
	$öçr›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

261 
I¡Pr›îty
 *
¥›
 = 
	`g_√w0
(IntProperty,1);

262 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

263 
¥›
->
öt_d©a
 = 0;

264  
¥›
;

265 
	}
}

267 
I¡Pr›îty
 *

268 
	$öçr›_c›y
(
I¡Pr›îty
 *
§c
)

270 
I¡Pr›îty
 *
¥›
 =

271 (
I¡Pr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

272 
§c
->
comm⁄
.
ªas⁄
);

273 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

274 
¥›
->
öt_d©a
 = 
§c
->int_data;

275  
¥›
;

276 
	}
}

278 
WIDGET
 *

279 
	$öçr›_gë_widgë
(
I¡Pr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

281 
GtkAdju°mít
 *
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(
¥›
->
öt_d©a
,

282 
G_MININT
, 
G_MAXINT
,

284 
GtkWidgë
 *
ªt
 = 
	`gtk_•ö_buâ⁄_√w
(
adj
, 1.0, 0);

285 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
ªt
),
TRUE
);

286 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "value_changed");

288  
ªt
;

289 
	}
}

292 
	$öçr›_ª£t_widgë
(
I¡Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

294 
GtkAdju°mít
 *
adj
;

295 i‡(
¥›
->
comm⁄
.
exåa_d©a
) {

296 
Pr›NumD©a
 *
numd©a
 = 
¥›
->
comm⁄
.
exåa_d©a
;

297 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(
¥›
->
öt_d©a
,

298 
numd©a
->
mö
,Çumd©a->
max
,

299 
numd©a
->
°ï
, 10.0 *Çumdata->step, 0));

301 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(
¥›
->
öt_d©a
,

302 
G_MININT
, 
G_MAXINT
,

305 
	`gtk_•ö_buâ⁄_£t_adju°mít
(
	`GTK_SPIN_BUTTON
(
widgë
), 
adj
);

306 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
widgë
), 
TRUE
);

307 
	}
}

310 
	$öçr›_£t_‰om_widgë
(
I¡Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

312 
¥›
->
öt_d©a
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_öt
(
	`GTK_SPIN_BUTTON
(
widgë
));

313 
	}
}

316 
	$öçr›_lﬂd
(
I¡Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

318 
¥›
->
öt_d©a
 = 
	`d©a_öt
(
d©a
);

319 
	}
}

322 
	$öçr›_ßve
(
I¡Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

324 
	`d©a_add_öt
(
©å
, 
¥›
->
öt_d©a
);

325 
	}
}

328 
	$öçr›_gë_‰om_off£t
(
I¡Pr›îty
 *
¥›
,

329 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

331 
¥›
->
öt_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
göt
);

332 
	}
}

335 
	$öçr›_£t_‰om_off£t
(
I¡Pr›îty
 *
¥›
,

336 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

338 
	`°ru˘_membî
(
ba£
,
off£t
,
göt
Ë
¥›
->
öt_d©a
;

339 
	}
}

342 
	$öçr›_gë_d©a_size
(
I¡Pr›îty
 *
¥›
)

344   (
¥›
->
öt_d©a
);

345 
	}
}

347 c⁄° 
Pr›îtyOps
 
	göçr›_›s
 = {

348 (
Pr›îtyTy≥_New
Ë
öçr›_√w
,

349 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

350 (
Pr›îtyTy≥_C›y
Ë
öçr›_c›y
,

351 (
Pr›îtyTy≥_Lﬂd
Ë
öçr›_lﬂd
,

352 (
Pr›îtyTy≥_Save
Ë
öçr›_ßve
,

353 (
Pr›îtyTy≥_GëWidgë
Ë
öçr›_gë_widgë
,

354 (
Pr›îtyTy≥_Re£tWidgë
Ë
öçr›_ª£t_widgë
,

355 (
Pr›îtyTy≥_SëFromWidgë
Ë
öçr›_£t_‰om_widgë
,

357 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

358 (
Pr›îtyTy≥_GëFromOff£t
Ë
öçr›_gë_‰om_off£t
,

359 (
Pr›îtyTy≥_SëFromOff£t
Ë
öçr›_£t_‰om_off£t
,

360 (
Pr›îtyTy≥_GëD©aSize
Ë
öçr›_gë_d©a_size


367 
I¡¨øyPr›îty
 *

368 
	$öèºay¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

369 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

371 
I¡¨øyPr›îty
 *
¥›
 = 
	`g_√w0
(IntarrayProperty,1);

372 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

373 
¥›
->
öèºay_d©a
 = 
	`g_¨øy_√w
(
FALSE
,
TRUE
,(
göt
));

374  
¥›
;

375 
	}
}

378 
	$öèºay¥›_‰ì
(
I¡¨øyPr›îty
 *
¥›
)

380 
	`g_¨øy_‰ì
(
¥›
->
öèºay_d©a
,
TRUE
);

381 
	`g_‰ì
(
¥›
);

382 
	}
}

384 
I¡¨øyPr›îty
 *

385 
	$öèºay¥›_c›y
(
I¡¨øyPr›îty
 *
§c
)

387 
guöt
 
i
;

388 
I¡¨øyPr›îty
 *
¥›
 =

389 (
I¡¨øyPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

390 
§c
->
comm⁄
.
ªas⁄
);

391 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

392 
	`g_¨øy_£t_size
(
¥›
->
öèºay_d©a
,
§c
->öèºay_d©a->
Àn
);

393 
i
 = 0 ; i < 
§c
->
öèºay_d©a
->
Àn
; i++)

394 
	`g_¨øy_ödex
(
¥›
->
öèºay_d©a
,
göt
,
i
) =

395 
	`g_¨øy_ödex
(
§c
->
öèºay_d©a
,
göt
,
i
);

396  
¥›
;

397 
	}
}

400 
	$öèºay¥›_lﬂd
(
I¡¨øyPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

402 
guöt
 
nvÆs
 = 
	`©åibuã_num_d©a
(
©å
);

403 
guöt
 
i
;

404 
	`g_¨øy_£t_size
(
¥›
->
öèºay_d©a
,
nvÆs
);

405 
i
=0; (ò< 
nvÆs
Ë&& 
d©a
; i++, d©®
	`d©a_√xt
(data))

406 
	`g_¨øy_ödex
(
¥›
->
öèºay_d©a
,
göt
,
i
Ë
	`d©a_öt
(
d©a
);

407 i‡(
i
 !
nvÆs
)

408 
	`g_w¨nög
("attribute_num_data()ándáctual data count mismatch "

410 
	}
}

413 
	$öèºay¥›_ßve
(
I¡¨øyPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

415 
guöt
 
i
;

416 
i
 = 0; i < 
¥›
->
öèºay_d©a
->
Àn
; i++)

417 
	`d©a_add_öt
(
©å
, 
	`g_¨øy_ödex
(
¥›
->
öèºay_d©a
,
göt
,
i
));

418 
	}
}

421 
	$öèºay¥›_gë_‰om_off£t
(
I¡¨øyPr›îty
 *
¥›
,

422 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

424 
guöt
 
nvÆs
 = 
	`°ru˘_membî
(
ba£
,
off£t2
,guint);

425 
guöt
 
i
;

426 *
ofs_vÆ
 = 
	`°ru˘_membî
(
ba£
,
off£t
,*);

427 
	`g_¨øy_£t_size
(
¥›
->
öèºay_d©a
,
nvÆs
);

428 
i
 = 0; i < 
nvÆs
; i++)

429 
	`g_¨øy_ödex
(
¥›
->
öèºay_d©a
,
göt
,
i
) =

430 
	`°ru˘_membî
(
ofs_vÆ
,
i
 * (
göt
),gint);

431 
	}
}

434 
	$öèºay¥›_£t_‰om_off£t
(
I¡¨øyPr›îty
 *
¥›
,

435 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

437 
guöt
 
nvÆs
 = 
¥›
->
öèºay_d©a
->
Àn
;

438 
göt
 *
vÆs
 = 
	`g_memdup
(&
	`g_¨øy_ödex
(
¥›
->
öèºay_d©a
,gint,0),

439 (
göt
Ë* 
nvÆs
);

440 
	`g_‰ì
(
	`°ru˘_membî
(
ba£
,
off£t
,
göt
 *));

441 
	`°ru˘_membî
(
ba£
,
off£t
,
göt
 *Ë
vÆs
;

442 
	`°ru˘_membî
(
ba£
,
off£t2
,
guöt
Ë
nvÆs
;

443 
	}
}

445 c⁄° 
Pr›îtyOps
 
	göèºay¥›_›s
 = {

446 (
Pr›îtyTy≥_New
Ë
öèºay¥›_√w
,

447 (
Pr›îtyTy≥_Fªe
Ë
öèºay¥›_‰ì
,

448 (
Pr›îtyTy≥_C›y
Ë
öèºay¥›_c›y
,

449 (
Pr›îtyTy≥_Lﬂd
Ë
öèºay¥›_lﬂd
,

450 (
Pr›îtyTy≥_Save
Ë
öèºay¥›_ßve
,

451 (
Pr›îtyTy≥_GëWidgë
Ë
no›¥›_gë_widgë
,

452 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

453 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

455 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

456 (
Pr›îtyTy≥_GëFromOff£t
Ë
öèºay¥›_gë_‰om_off£t
,

457 (
Pr›îtyTy≥_SëFromOff£t
Ë
öèºay¥›_£t_‰om_off£t


464 
EnumPr›îty
 *

465 
	$íum¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

467 
EnumPr›îty
 *
¥›
 = 
	`g_√w0
(EnumProperty,1);

468 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

469 
¥›
->
íum_d©a
 = 0;

470  
¥›
;

471 
	}
}

473 
EnumPr›îty
 *

474 
	$íum¥›_c›y
(
EnumPr›îty
 *
§c
)

476 
EnumPr›îty
 *
¥›
 =

477 (
EnumPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

478 
§c
->
comm⁄
.
ªas⁄
);

479 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

480 
¥›
->
íum_d©a
 = 
§c
->enum_data;

481  
¥›
;

482 
	}
}

484 
WIDGET
 *

485 
	$íum¥›_gë_widgë
(
EnumPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

487 
GtkWidgë
 *
ªt
;

489 i‡(
¥›
->
comm⁄
.
exåa_d©a
) {

490 
Pr›EnumD©a
 *
íumd©a
 = 
¥›
->
comm⁄
.
exåa_d©a
;

491 
guöt
 
i
;

493 
ªt
 = 
	`gtk_combo_box_√w_ãxt
 ();

494 
i
 = 0; 
íumd©a
[i].
«me
 !
NULL
; i++)

495 
	`gtk_combo_box_≠≥nd_ãxt
 (
	`GTK_COMBO_BOX
 (
ªt
), 
	`_
(
íumd©a
[
i
].
«me
));

496 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
 (
ªt
), "changed");

498 
ªt
 = 
	`gtk_íåy_√w
();

500  
ªt
;

501 
	}
}

504 
	$íum¥›_ª£t_widgë
(
EnumPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

506 i‡(
¥›
->
comm⁄
.
exåa_d©a
) {

507 
Pr›EnumD©a
 *
íumd©a
 = 
¥›
->
comm⁄
.
exåa_d©a
;

508 
guöt
 
i
, 
pos
 = 0;

510 
i
 = 0; 
íumd©a
[i].
«me
 !
NULL
; i++) {

511 i‡(
íumd©a
[
i
].
íumv
 =
¥›
->
íum_d©a
) {

512 
pos
 = 
i
;

516 
	`gtk_combo_box_£t_a˘ive
 (
	`GTK_COMBO_BOX
 (
widgë
), 
pos
);

518 
buf
[16];

519 
	`g_¢¥ötf
(
buf
, (buf), "%d", 
¥›
->
íum_d©a
);

520 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
widgë
), 
buf
);

522 
	}
}

525 
	$íum¥›_£t_‰om_widgë
(
EnumPr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

527 i‡(
	`GTK_IS_COMBO_BOX
 (
widgë
)) {

528 
guöt
 
pos
 = 
	`gtk_combo_box_gë_a˘ive
 (
	`GTK_COMBO_BOX
 (
widgë
));

529 
Pr›EnumD©a
 *
íumd©a
 = 
¥›
->
comm⁄
.
exåa_d©a
;

531 
	`g_ªtu∫_if_Áû
 (
íumd©a
 !
NULL
);

533 
¥›
->
íum_d©a
 = 
íumd©a
[
pos
].
íumv
;

535 
¥›
->
íum_d©a
 = 
	`°πﬁ
(
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
widgë
)), 
NULL
, 0);

537 
	}
}

540 
	$íum¥›_lﬂd
(
EnumPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

542 
D©aTy≥
 
dt
 = 
	`d©a_ty≥
 (
d©a
);

543 i‡(
DATATYPE_ENUM
 =
dt
)

544 
¥›
->
íum_d©a
 = 
	`d©a_íum
(
d©a
);

545 i‡(
DATATYPE_INT
 =
dt
) {

546 
gboﬁón
 
ˇ°_ok
 = 
FALSE
;

547 
Pr›EnumD©a
 *
íumd©a
 = 
¥›
->
comm⁄
.
exåa_d©a
;

548 
guöt
 
i
, 
v
 = 
	`d©a_öt
(
d©a
);

549 
i
 = 0; 
íumd©a
[i].
«me
 !
NULL
; ++i) {

550 i‡(
v
 =
íumd©a
[
i
].
íumv
) {

551 
¥›
->
íum_d©a
 = 
v
;

552 
ˇ°_ok
 = 
TRUE
;

556 i‡(!
ˇ°_ok
) {

557 
¥›
->
íum_d©a
 = 
íumd©a
[0].
íumv
;

558 
	`mesßge_w¨nög
 (
	`_
("Property cast from intÅoÉnum out ofÑange"));

561 
	}
}

564 
	$íum¥›_ßve
(
EnumPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

566 
	`d©a_add_íum
(
©å
, 
¥›
->
íum_d©a
);

567 
	}
}

570 
	$íum¥›_gë_‰om_off£t
(
EnumPr›îty
 *
¥›
,

571 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

573 
¥›
->
íum_d©a
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
göt
);

574 
	}
}

577 
	$íum¥›_£t_‰om_off£t
(
EnumPr›îty
 *
¥›
,

578 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

580 
	`°ru˘_membî
(
ba£
,
off£t
,
göt
Ë
¥›
->
íum_d©a
;

581 
	}
}

583 c⁄° 
Pr›îtyOps
 
	gíum¥›_›s
 = {

584 (
Pr›îtyTy≥_New
Ë
íum¥›_√w
,

585 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

586 (
Pr›îtyTy≥_C›y
Ë
íum¥›_c›y
,

587 (
Pr›îtyTy≥_Lﬂd
Ë
íum¥›_lﬂd
,

588 (
Pr›îtyTy≥_Save
Ë
íum¥›_ßve
,

589 (
Pr›îtyTy≥_GëWidgë
Ë
íum¥›_gë_widgë
,

590 (
Pr›îtyTy≥_Re£tWidgë
Ë
íum¥›_ª£t_widgë
,

591 (
Pr›îtyTy≥_SëFromWidgë
Ë
íum¥›_£t_‰om_widgë
,

593 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

594 (
Pr›îtyTy≥_GëFromOff£t
Ë
íum¥›_gë_‰om_off£t
,

595 (
Pr›îtyTy≥_SëFromOff£t
Ë
íum¥›_£t_‰om_off£t


602 
Enum¨øyPr›îty
 *

603 
	$íum¨øy¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

604 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

606 
Enum¨øyPr›îty
 *
¥›
 = 
	`g_√w0
(EnumarrayProperty,1);

607 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

608 
¥›
->
íum¨øy_d©a
 = 
	`g_¨øy_√w
(
FALSE
,
TRUE
,(
göt
));

609  
¥›
;

610 
	}
}

613 
	$íum¨øy¥›_‰ì
(
Enum¨øyPr›îty
 *
¥›
)

615 
	`g_¨øy_‰ì
(
¥›
->
íum¨øy_d©a
,
TRUE
);

616 
	`g_‰ì
(
¥›
);

617 
	}
}

619 
Enum¨øyPr›îty
 *

620 
	$íum¨øy¥›_c›y
(
Enum¨øyPr›îty
 *
§c
)

622 
guöt
 
i
;

623 
Enum¨øyPr›îty
 *
¥›
 =

624 (
Enum¨øyPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

625 
§c
->
comm⁄
.
ªas⁄
);

626 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

627 
	`g_¨øy_£t_size
(
¥›
->
íum¨øy_d©a
,
§c
->íum¨øy_d©a->
Àn
);

628 
i
 = 0 ; i < 
§c
->
íum¨øy_d©a
->
Àn
; i++)

629 
	`g_¨øy_ödex
(
¥›
->
íum¨øy_d©a
,
göt
,
i
) =

630 
	`g_¨øy_ödex
(
§c
->
íum¨øy_d©a
,
göt
,
i
);

631  
¥›
;

632 
	}
}

635 
	$íum¨øy¥›_lﬂd
(
Enum¨øyPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

637 
guöt
 
nvÆs
 = 
	`©åibuã_num_d©a
(
©å
);

638 
guöt
 
i
;

639 
	`g_¨øy_£t_size
(
¥›
->
íum¨øy_d©a
,
nvÆs
);

641 
i
=0; (ò< 
nvÆs
Ë&& 
d©a
; i++, d©®
	`d©a_√xt
(data))

642 
	`g_¨øy_ödex
(
¥›
->
íum¨øy_d©a
,
göt
,
i
Ë
	`d©a_íum
(
d©a
);

643 i‡(
i
 !
nvÆs
)

644 
	`g_w¨nög
("attribute_num_data()ándáctual data count mismatch "

646 
	}
}

649 
	$íum¨øy¥›_ßve
(
Enum¨øyPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

651 
guöt
 
i
;

652 
i
 = 0; i < 
¥›
->
íum¨øy_d©a
->
Àn
; i++)

653 
	`d©a_add_íum
(
©å
, 
	`g_¨øy_ödex
(
¥›
->
íum¨øy_d©a
,
göt
,
i
));

654 
	}
}

657 
	$íum¨øy¥›_gë_‰om_off£t
(
Enum¨øyPr›îty
 *
¥›
,

658 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

660 
guöt
 
nvÆs
 = 
	`°ru˘_membî
(
ba£
,
off£t2
,guint);

661 
guöt
 
i
;

662 *
ofs_vÆ
 = 
	`°ru˘_membî
(
ba£
,
off£t
,*);

663 
	`g_¨øy_£t_size
(
¥›
->
íum¨øy_d©a
,
nvÆs
);

664 
i
 = 0; i < 
nvÆs
; i++)

665 
	`g_¨øy_ödex
(
¥›
->
íum¨øy_d©a
,
göt
,
i
) =

666 
	`°ru˘_membî
(
ofs_vÆ
,
i
 * (
göt
),gint);

667 
	}
}

670 
	$íum¨øy¥›_£t_‰om_off£t
(
Enum¨øyPr›îty
 *
¥›
,

671 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

673 
guöt
 
nvÆs
 = 
¥›
->
íum¨øy_d©a
->
Àn
;

674 
göt
 *
vÆs
 = 
	`g_memdup
(&
	`g_¨øy_ödex
(
¥›
->
íum¨øy_d©a
,gint,0),

675 (
göt
Ë* 
nvÆs
);

676 
	`g_‰ì
(
	`°ru˘_membî
(
ba£
,
off£t
,
göt
 *));

677 
	`°ru˘_membî
(
ba£
,
off£t
,
göt
 *Ë
vÆs
;

678 
	`°ru˘_membî
(
ba£
,
off£t2
,
guöt
Ë
nvÆs
;

679 
	}
}

681 c⁄° 
Pr›îtyOps
 
	gíum¨øy¥›_›s
 = {

682 (
Pr›îtyTy≥_New
Ë
íum¨øy¥›_√w
,

683 (
Pr›îtyTy≥_Fªe
Ë
íum¨øy¥›_‰ì
,

684 (
Pr›îtyTy≥_C›y
Ë
íum¨øy¥›_c›y
,

685 (
Pr›îtyTy≥_Lﬂd
Ë
íum¨øy¥›_lﬂd
,

686 (
Pr›îtyTy≥_Save
Ë
íum¨øy¥›_ßve
,

687 (
Pr›îtyTy≥_GëWidgë
Ë
no›¥›_gë_widgë
,

688 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

689 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

691 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

692 (
Pr›îtyTy≥_GëFromOff£t
Ë
íum¨øy¥›_gë_‰om_off£t
,

693 (
Pr›îtyTy≥_SëFromOff£t
Ë
íum¨øy¥›_£t_‰om_off£t


699 
	$¥›_öây≥s_ªgi°î
()

701 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_CHAR
,&
ch¨¥›_›s
);

702 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_BOOL
,&
boﬁ¥›_›s
);

703 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_INT
,&
öçr›_›s
);

704 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_INTARRAY
,&
öèºay¥›_›s
);

705 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_ENUM
,&
íum¥›_›s
);

706 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_ENUMARRAY
,&
íum¨øy¥›_›s
);

707 
	}
}

	@O:\tool\dvs50\lib\prop_inttypes.h

25 #i‚de‡
PROP_INTTYPES_H


26 
	#PROP_INTTYPES_H


	)

28 
	~"¥›îtõs.h
"

29 
	~"dü_xml.h
"

33 
Pr›îty
 
	mcomm⁄
;

34 
gunich¨
 
	mch¨_d©a
;

35 } 
	tCh¨Pr›îty
;

38 
Pr›îty
 
	mcomm⁄
;

39 
gboﬁón
 
	mboﬁ_d©a
;

40 } 
	tBoﬁPr›îty
;

43 
Pr›îty
 
	mcomm⁄
;

44 
göt
 
	möt_d©a
;

45 } 
	tI¡Pr›îty
;

48 
Pr›îty
 
	mcomm⁄
;

49 
GAºay
 *
	möèºay_d©a
;

50 } 
	tI¡¨øyPr›îty
;

53 
Pr›îty
 
	mcomm⁄
;

54 
göt
 
	míum_d©a
;

55 } 
	tEnumPr›îty
;

58 
Pr›îty
 
	mcomm⁄
;

59 
GAºay
 *
	míum¨øy_d©a
;

60 } 
	tEnum¨øyPr›îty
;

62 
¥›_öây≥s_ªgi°î
();

	@O:\tool\dvs50\lib\prop_sdarray.c

27 #ifde‡
HAVE_CONFIG_H


28 
	~<c⁄fig.h
>

31 
	~<gtk/gtk.h
>

32 
	#WIDGET
 
GtkWidgë


	)

33 
	~"widgës.h
"

34 
	~"¥›îtõs.h
"

35 
	~"¥›öã∫Æs.h
"

41 
AºayPr›îty
 *

42 
	$¨øy¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

44 
AºayPr›îty
 *
¥›
 = 
	`g_√w0
(ArrayProperty,1);

45 c⁄° 
Pr›DescComm⁄AºayExåa
 *
exåa
 = 
pdesc
->
exåa_d©a
;

47 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
, 
pdesc
, 
ªas⁄
);

48 
¥›
->
ex_¥›s
 = 
	`¥›_li°_‰om_descs
(
exåa
->
ªc‹d
,
ªas⁄
);

49 
¥›
->
ªc‹ds
 = 
	`g_±r_¨øy_√w
();

50  
¥›
;

51 
	}
}

54 
	$¨øy¥›_‰ìªc‹ds
(
AºayPr›îty
 *
¥›
)

56 
guöt
 
i
;

58 
i
=0; i < 
¥›
->
ªc‹ds
->
Àn
; i++)

59 
	`¥›_li°_‰ì
(
	`g_±r_¨øy_ödex
(
¥›
->
ªc‹ds
,
i
));

60 
	}
}

63 
	$¨øy¥›_‰ì
(
AºayPr›îty
 *
¥›
)

65 
	`¨øy¥›_‰ìªc‹ds
(
¥›
);

66 
	`g_±r_¨øy_‰ì
(
¥›
->
ªc‹ds
,
TRUE
);

67 
	`g_‰ì
(
¥›
);

68 
	}
}

70 
AºayPr›îty
 *

71 
	$¨øy¥›_c›y
(
AºayPr›îty
 *
§c
)

73 
AºayPr›îty
 *
¥›
 =

74 (
AºayPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

75 
§c
->
comm⁄
.
ªas⁄
);

76 
guöt
 
i
;

77 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

78 
¥›
->
ex_¥›s
 = 
	`¥›_li°_c›y
(
§c
->ex_props);

79 
¥›
->
ªc‹ds
 = 
	`g_±r_¨øy_√w
();

80 
i
 = 0; i < 
§c
->
ªc‹ds
->
Àn
; i++) {

81 
	`g_±r_¨øy_add
(
¥›
->
ªc‹ds
,

82 
	`¥›_li°_c›y
(
	`g_±r_¨øy_ödex
(
§c
->
ªc‹ds
,
i
)));

84  
¥›
;

85 
	}
}

88 
	$¨øy¥›_lﬂd
(
AºayPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

90 c⁄° 
Pr›DescComm⁄AºayExåa
 *
exåa
 = 
¥›
->
comm⁄
.
des¸
->
exåa_d©a
;

91 
D©aNode
 
composôe
;

92 
GEº‹
 *
îr
 = 
NULL
;

94 
	`¨øy¥›_‰ìªc‹ds
(
¥›
);

95 
	`g_±r_¨øy_£t_size
(
¥›
->
ªc‹ds
,0);

97 
composôe
 = 
d©a
;

98 
composôe
 !
NULL
;

99 
composôe
 = 
	`d©a_√xt
(composite)) {

100 
GPåAºay
 *
ªc‹d
 = 
	`¥›_li°_‰om_descs
(
exåa
->record,

101 
¥›
->
comm⁄
.
ªas⁄
);

102 i‡(!
	`¥›_li°_lﬂd
(
ªc‹d
,
composôe
, &
îr
)) {

103 
	`g_w¨nög
 ("%s:%s", 
¥›
->
comm⁄
.
«me
, 
îr
->
mesßge
);

104 
	`g_îr‹_‰ì
 (
îr
);

105 
îr
 = 
NULL
;

107 
	`g_±r_¨øy_add
(
¥›
->
ªc‹ds
,
ªc‹d
);

109 
	}
}

112 
	$¨øy¥›_ßve
(
AºayPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

114 
i
;

115 c⁄° 
Pr›DescComm⁄AºayExåa
 *
exåa
 = 
¥›
->
comm⁄
.
des¸
->
exåa_d©a
;

117 
i
 = 0; i < 
¥›
->
ªc‹ds
->
Àn
; i++) {

118 
	`¥›_li°_ßve
(
	`g_±r_¨øy_ödex
(
¥›
->
ªc‹ds
,
i
),

119 
	`d©a_add_composôe
(
©å
,
exåa
->
composôe_ty≥
));

121 
	}
}

124 
	$ßºay¥›_gë_‰om_off£t
(
AºayPr›îty
 *
¥›
,

125 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

127 c⁄° 
Pr›DescSAºayExåa
 *
exåa
 = 
¥›
->
comm⁄
.
des¸
->
exåa_d©a
;

128 
Pr›Off£t
 *
suboff£ts
 = 
exåa
->
comm⁄
.
off£ts
;

129 
guöt
 
i
;

131 
	`¥›_off£t_li°_ˇlcuœã_qu¨ks
(
suboff£ts
);

133 
	`¨øy¥›_‰ìªc‹ds
(
¥›
);

134 
	`g_±r_¨øy_£t_size
(
¥›
->
ªc‹ds
,
exåa
->
¨øy_Àn
);

136 
i
=0; i < 
¥›
->
ªc‹ds
->
Àn
; i++) {

137 *
ªc_ö_obj
 = &
	`°ru˘_membî
(
ba£
,

138 
off£t
 + (
i
 * 
exåa
->
ñemít_size
),

140 
GPåAºay
 *
sub¥›s
 = 
	`¥›_li°_c›y
(
¥›
->
ex_¥›s
);

142 
	`do_gë_¥›s_‰om_off£ts
(
ªc_ö_obj
,
sub¥›s
,
suboff£ts
);

144 
	`g_±r_¨øy_ödex
(
¥›
->
ªc‹ds
,
i
Ë
sub¥›s
;

146 
	}
}

149 
	$ßºay¥›_£t_‰om_off£t
(
AºayPr›îty
 *
¥›
,

150 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

152 c⁄° 
Pr›DescSAºayExåa
 *
exåa
 = 
¥›
->
comm⁄
.
des¸
->
exåa_d©a
;

153 
Pr›Off£t
 *
suboff£ts
 = 
exåa
->
comm⁄
.
off£ts
;

154 
guöt
 
i
;

156 
	`g_as£π
(
¥›
->
ªc‹ds
->
Àn
 =
exåa
->
¨øy_Àn
);

158 
	`¥›_off£t_li°_ˇlcuœã_qu¨ks
(
suboff£ts
);

160 
i
=0; i < 
¥›
->
ªc‹ds
->
Àn
; i++) {

161 *
ªc_ö_obj
 = &
	`°ru˘_membî
(
ba£
,

162 
off£t
 + (
i
 * 
exåa
->
ñemít_size
),

164 
GPåAºay
 *
sub¥›s
 = 
	`g_±r_¨øy_ödex
(
¥›
->
ªc‹ds
,
i
);

166 
	`do_£t_¥›s_‰om_off£ts
(
ªc_ö_obj
,
sub¥›s
,
suboff£ts
);

168 
	}
}

171 
	$d¨øy¥›_gë_‰om_off£t
(
AºayPr›îty
 *
¥›
,

172 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

175 c⁄° 
Pr›DescSAºayExåa
 *
exåa
 = 
¥›
->
comm⁄
.
des¸
->
exåa_d©a
;

176 
Pr›Off£t
 *
suboff£ts
 = 
exåa
->
comm⁄
.
off£ts
;

177 
guöt
 
i
;

178 
GLi°
 *
obj_ªc
 = 
	`°ru˘_membî
(
ba£
,
off£t
,GList *);

180 
	`¥›_off£t_li°_ˇlcuœã_qu¨ks
(
suboff£ts
);

182 
	`¨øy¥›_‰ìªc‹ds
(
¥›
);

183 
	`g_±r_¨øy_£t_size
(
¥›
->
ªc‹ds
,0);

185 
obj_ªc
 = 
	`g_li°_fú°
(obj_ªc), 
i
 = 0;

186 
obj_ªc
 !
NULL
;

187 
obj_ªc
 = 
	`g_li°_√xt
(obj_ªc), 
i
++) {

188 *
ªc_ö_obj
 = 
obj_ªc
->
d©a
;

189 
GPåAºay
 *
sub¥›s
 = 
	`¥›_li°_c›y
(
¥›
->
ex_¥›s
);

191 
	`do_gë_¥›s_‰om_off£ts
(
ªc_ö_obj
,
sub¥›s
,
suboff£ts
);

193 
	`g_±r_¨øy_add
(
¥›
->
ªc‹ds
,
sub¥›s
);

195 
	}
}

197 
GLi°
 *

198 
	$d¨øy¥›_adju°_obje˘_ªc‹ds
(
AºayPr›îty
 *
¥›
,

199 c⁄° 
Pr›DescDAºayExåa
 *
exåa
,

200 
GLi°
 *
obj_ªc
) {

201 
guöt
 
li°_Àn
 = 
	`g_li°_Àngth
(
obj_ªc
);

203 
li°_Àn
 > 
¥›
->
ªc‹ds
->
Àn
) {

204 
gpoöãr
 
ªc
 = 
obj_ªc
->
d©a
;

205 
obj_ªc
 = 
	`g_li°_ªmove
(obj_ªc,
ªc
);

206 
exåa
->
	`‰ìªc
(
ªc
);

207 
li°_Àn
--;

209 
li°_Àn
 < 
¥›
->
ªc‹ds
->
Àn
) {

210 
obj_ªc
 = 
	`g_li°_≠≥nd
(obj_ªc,
exåa
->
	`√wªc
());

211 
li°_Àn
++;

213  
obj_ªc
;

214 
	}
}

217 
	$d¨øy¥›_£t_‰om_off£t
(
AºayPr›îty
 *
¥›
,

218 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

221 c⁄° 
Pr›DescDAºayExåa
 *
exåa
 = 
¥›
->
comm⁄
.
des¸
->
exåa_d©a
;

222 
Pr›Off£t
 *
suboff£ts
 = 
exåa
->
comm⁄
.
off£ts
;

223 
guöt
 
i
;

224 
GLi°
 *
obj_ªc
 = 
	`°ru˘_membî
(
ba£
,
off£t
,GList *);

226 
	`¥›_off£t_li°_ˇlcuœã_qu¨ks
(
suboff£ts
);

228 
obj_ªc
 = 
	`d¨øy¥›_adju°_obje˘_ªc‹ds
(
¥›
,
exåa
,obj_rec);

229 
	`°ru˘_membî
(
ba£
,
off£t
,
GLi°
 *Ë
obj_ªc
;

231 
obj_ªc
 = 
	`g_li°_fú°
(obj_ªc), 
i
 = 0;

232 
obj_ªc
 !
NULL
;

233 
obj_ªc
 = 
	`g_li°_√xt
(obj_ªc), 
i
++) {

234 *
ªc_ö_obj
 = 
obj_ªc
->
d©a
;

235 
GPåAºay
 *
sub¥›s
 = 
	`g_±r_¨øy_ödex
(
¥›
->
ªc‹ds
,
i
);

237 
	`do_£t_¥›s_‰om_off£ts
(
ªc_ö_obj
,
sub¥›s
,
suboff£ts
);

239 
	}
}

245 
	$d¨øy_¥›_edô
 (
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

247 
AºayPr›îty
 *
¥›
 = 
d©a
;

249 
	}
}

251 
WIDGET
 *

252 
	$¨øy¥›_gë_widgë
(
AºayPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

254 
GtkWidgë
 *
ªt
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
 (
¥›
->
comm⁄
.
des¸
->
toﬁtù
);

255 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
ªt
), "clicked",

256 
	`G_CALLBACK
 (
d¨øy_¥›_edô
), 
¥›
);

258  
ªt
;

259 
	}
}

262 
	$¨øy¥›_ª£t_widgë
(
No›Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

264 
	}
}

267 
	$¨øy¥›_£t_‰om_widgë
(
No›Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

269 
	}
}

271 
gboﬁón


272 
	$¨øy¥›_ˇn_mîge
(c⁄° 
Pr›Des¸ùti⁄
 *
pd1
, c⁄° Pr›Des¸ùti⁄ *
pd2
)

274 i‡(
pd1
->
exåa_d©a
 !
pd2
->exåa_d©aË 
FALSE
;

275  
TRUE
;

276 
	}
}

278 c⁄° 
Pr›îtyOps
 
	gßºay¥›_›s
 = {

279 (
Pr›îtyTy≥_New
Ë
¨øy¥›_√w
,

280 (
Pr›îtyTy≥_Fªe
Ë
¨øy¥›_‰ì
,

281 (
Pr›îtyTy≥_C›y
Ë
¨øy¥›_c›y
,

282 (
Pr›îtyTy≥_Lﬂd
Ë
¨øy¥›_lﬂd
,

283 (
Pr›îtyTy≥_Save
Ë
¨øy¥›_ßve
,

285 (
Pr›îtyTy≥_GëWidgë
Ë
¨øy¥›_gë_widgë
,

286 (
Pr›îtyTy≥_Re£tWidgë
Ë
¨øy¥›_ª£t_widgë
,

287 (
Pr›îtyTy≥_SëFromWidgë
Ë
¨øy¥›_£t_‰om_widgë
,

289 (
Pr›îtyTy≥_C™Mîge
Ë
¨øy¥›_ˇn_mîge
,

290 (
Pr›îtyTy≥_GëFromOff£t
Ë
ßºay¥›_gë_‰om_off£t
,

291 (
Pr›îtyTy≥_SëFromOff£t
Ë
ßºay¥›_£t_‰om_off£t


294 c⁄° 
Pr›îtyOps
 
	gd¨øy¥›_›s
 = {

295 (
Pr›îtyTy≥_New
Ë
¨øy¥›_√w
,

296 (
Pr›îtyTy≥_Fªe
Ë
¨øy¥›_‰ì
,

297 (
Pr›îtyTy≥_C›y
Ë
¨øy¥›_c›y
,

298 (
Pr›îtyTy≥_Lﬂd
Ë
¨øy¥›_lﬂd
,

299 (
Pr›îtyTy≥_Save
Ë
¨øy¥›_ßve
,

301 (
Pr›îtyTy≥_GëWidgë
Ë
¨øy¥›_gë_widgë
,

302 (
Pr›îtyTy≥_Re£tWidgë
Ë
¨øy¥›_ª£t_widgë
,

303 (
Pr›îtyTy≥_SëFromWidgë
Ë
¨øy¥›_£t_‰om_widgë
,

305 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

306 (
Pr›îtyTy≥_GëFromOff£t
Ë
d¨øy¥›_gë_‰om_off£t
,

307 (
Pr›îtyTy≥_SëFromOff£t
Ë
d¨øy¥›_£t_‰om_off£t


313 
	$¥›_sd¨øy_ªgi°î
()

315 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_SARRAY
,&
ßºay¥›_›s
);

316 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_DARRAY
,&
d¨øy¥›_›s
);

317 
	}
}

	@O:\tool\dvs50\lib\prop_sdarray.h

27 #i‚de‡
PROP_SDARRAY_H


28 
	#PROP_SDARRAY_H


	)

30 
	~"¥›îtõs.h
"

31 
	~"dü_xml.h
"

34 
Pr›îty
 
	mcomm⁄
;

35 
GPåAºay
 *
	mex_¥›s
;

36 
GPåAºay
 *
	mªc‹ds
;

37 } 
	tAºayPr›îty
;

39 
¥›_sd¨øy_ªgi°î
();

	@O:\tool\dvs50\lib\prop_text.c

26 #ifde‡
HAVE_CONFIG_H


27 
	~<c⁄fig.h
>

30 
	~<gtk/gtk.h
>

31 
	~<gdk/gdkkeysyms.h
>

32 
	~"widgës.h
"

33 
	~"¥›îtõs.h
"

34 
	~"¥›öã∫Æs.h
"

35 
	~"ãxt.h
"

36 
	~"group.h
"

42 
SåögPr›îty
 *

43 
	$°rög¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

45 
SåögPr›îty
 *
¥›
 = 
	`g_√w0
(StringProperty,1);

46 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

47 
¥›
->
°rög_d©a
 = 
NULL
;

48 
¥›
->
num_löes
 = 1;

49  
¥›
;

50 
	}
}

52 
SåögPr›îty
 *

53 
	$mu…i°rög¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
,

54 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

56 
SåögPr›îty
 *
¥›
 = 
	`g_√w0
(StringProperty,1);

57 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

58 
¥›
->
°rög_d©a
 = 
NULL
;

59 
¥›
->
num_löes
 = 
	`GPOINTER_TO_INT
(
pdesc
->
exåa_d©a
);

60  
¥›
;

61 
	}
}

63 
SåögPr›îty
 *

64 
	$°rög¥›_c›y
(
SåögPr›îty
 *
§c
)

66 
SåögPr›îty
 *
¥›
 =

67 (
SåögPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

68 
§c
->
comm⁄
.
ªas⁄
);

69 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

70 i‡(
§c
->
°rög_d©a
)

71 
¥›
->
°rög_d©a
 = 
	`g_°rdup
(
§c
->string_data);

73 
¥›
->
°rög_d©a
 = 
NULL
;

74 
¥›
->
num_löes
 = 
§c
->num_lines;

75  
¥›
;

76 
	}
}

79 
	$°rög¥›_‰ì
(
SåögPr›îty
 *
¥›
)

81 
	`g_‰ì
(
¥›
->
°rög_d©a
);

82 
	`g_‰ì
(
¥›
);

83 
	}
}

85 
GtkWidgë
 *

86 
	$°rög¥›_gë_widgë
(
SåögPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

88 
GtkWidgë
 *
ªt
 = 
	`gtk_íåy_√w
();

89 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "changed");

90  
ªt
;

91 
	}
}

94 
	$°rög¥›_ª£t_widgë
(
SåögPr›îty
 *
¥›
, 
GtkWidgë
 *
widgë
)

96 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
widgë
),

97 
¥›
->
°rög_d©a
 ?Örop->string_data : "");

98 
	}
}

101 
	$°rög¥›_£t_‰om_widgë
(
SåögPr›îty
 *
¥›
, 
GtkWidgë
 *
widgë
)

103 
	`g_‰ì
(
¥›
->
°rög_d©a
);

104 
¥›
->
°rög_d©a
 =

105 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
	`GTK_ENTRY
(
widgë
)));

106 
	}
}

108 
gboﬁón


109 
	$mu…i°rög¥›_h™dÀ_key
(
GtkWidgë
 *
wid
, 
GdkEvítKey
 *
evít
)

115 i‡(
evít
->
keyvÆ
 =
GDK_Rëu∫
)

116  
TRUE
;

117  
FALSE
;

118 
	}
}

120 
GtkWidgë
 *

121 
	$mu…i°rög¥›_gë_widgë
(
SåögPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

123 
GtkWidgë
 *
ªt
 = 
	`gtk_ãxt_võw_√w
();

124 
GtkTextBuf„r
 *
buf„r
 = 
	`gtk_ãxt_võw_gë_buf„r
(
	`GTK_TEXT_VIEW
(
ªt
));

125 
GtkWidgë
 *
‰ame
 = 
	`gtk_‰ame_√w
(
NULL
);

126 
	`gtk_‰ame_£t_shadow_ty≥
(
	`GTK_FRAME
(
‰ame
), 
GTK_SHADOW_IN
);

127 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
‰ame
), 
ªt
);

128 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
ªt
), "key-release-event",

129 
	`G_CALLBACK
(
mu…i°rög¥›_h™dÀ_key
), 
NULL
);

130 
	`gtk_widgë_show
(
ªt
);

131 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
buf„r
), "changed");

132  
‰ame
;

133 
	}
}

136 
	$mu…i°rög¥›_ª£t_widgë
(
SåögPr›îty
 *
¥›
, 
GtkWidgë
 *
widgë
)

138 
GtkWidgë
 *
ãxtvõw
 = 
	`gtk_bö_gë_chûd
(
	`GTK_BIN
(
widgë
));

139 
GtkTextBuf„r
 *
buf„r
 = 
	`gtk_ãxt_võw_gë_buf„r
(
	`GTK_TEXT_VIEW
(
ãxtvõw
));

140 
	`gtk_ãxt_buf„r_£t_ãxt
(
buf„r
,

141 
¥›
->
°rög_d©a
 ?Örop->string_data : "", -1);

142 
	}
}

145 
	$mu…i°rög¥›_£t_‰om_widgë
(
SåögPr›îty
 *
¥›
, 
GtkWidgë
 *
widgë
) {

146 
GtkWidgë
 *
ãxtvõw
 = 
	`gtk_bö_gë_chûd
(
	`GTK_BIN
(
widgë
));

147 
GtkTextBuf„r
 *
buf„r
 = 
	`gtk_ãxt_võw_gë_buf„r
(
	`GTK_TEXT_VIEW
(
ãxtvõw
));

148 
GtkTextIãr
 
°¨t
, 
íd
;

149 
	`gtk_ãxt_buf„r_gë_°¨t_ôî
(
buf„r
, &
°¨t
);

150 
	`gtk_ãxt_buf„r_gë_íd_ôî
(
buf„r
, &
íd
);

151 
	`g_‰ì
(
¥›
->
°rög_d©a
);

152 
¥›
->
°rög_d©a
 =

153 
	`g_°rdup
 (
	`gtk_ãxt_buf„r_gë_ãxt
 (
buf„r
, &
°¨t
, &
íd
, 
TRUE
));

154 
	}
}

156 
GtkWidgë
 *

157 
	$fûïr›_gë_widgë
(
SåögPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

159 
GtkWidgë
 *
ªt
 = 
	`dü_fûe_£À˘‹_√w
();

160 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "value-changed");

161  
ªt
;

162 
	}
}

165 
	$fûïr›_ª£t_widgë
(
SåögPr›îty
 *
¥›
, 
GtkWidgë
 *
widgë
)

167 
	`dü_fûe_£À˘‹_£t_fûe
(
	`DIAFILESELECTOR
(
widgë
),
¥›
->
°rög_d©a
);

168 
	}
}

171 
	$fûïr›_£t_‰om_widgë
(
SåögPr›îty
 *
¥›
, 
GtkWidgë
 *
widgë
)

173 
	`g_‰ì
(
¥›
->
°rög_d©a
);

174 
¥›
->
°rög_d©a
 =

175 
	`g_°rdup
(
	`dü_fûe_£À˘‹_gë_fûe
(
	`DIAFILESELECTOR
(
widgë
)));

176 
	}
}

179 
	$°rög¥›_lﬂd
(
SåögPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

181 
	`g_‰ì
(
¥›
->
°rög_d©a
);

182 
¥›
->
°rög_d©a
 = 
	`d©a_°rög
(
d©a
);

183 i‡(
¥›
->
°rög_d©a
 =
NULL
) {

184 
¥›
->
°rög_d©a
 = 
	`g_°rdup
("");

186 
	}
}

189 
	$°rög¥›_ßve
(
SåögPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

191 
	`d©a_add_°rög
(
©å
, 
¥›
->
°rög_d©a
);

192 
	}
}

195 
	$°rög¥›_gë_‰om_off£t
(
SåögPr›îty
 *
¥›
,

196 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

198 
	`g_‰ì
(
¥›
->
°rög_d©a
);

199 
¥›
->
°rög_d©a
 = 
	`g_°rdup
(
	`°ru˘_membî
(
ba£
,
off£t
,
gch¨
 *));

200 
	}
}

203 
	$°rög¥›_£t_‰om_off£t
(
SåögPr›îty
 *
¥›
,

204 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

206 
	`g_‰ì
(
	`°ru˘_membî
(
ba£
,
off£t
,
gch¨
 *));

207 
	`°ru˘_membî
(
ba£
,
off£t
,
gch¨
 *Ë
	`g_°rdup
(
¥›
->
°rög_d©a
);

208 
	}
}

211 
	$°rög¥›_gë_d©a_size
(
SåögPr›îty
 *
¥›
)

213   (
¥›
->
°rög_d©a
);

214 
	}
}

216 
SåögLi°Pr›îty
 *

217 
	$°rögli°¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

219 
SåögLi°Pr›îty
 *
¥›
 = 
	`g_√w0
(StringListProperty,1);

220 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

221 
¥›
->
°rög_li°
 = 
NULL
;

222  
¥›
;

223 
	}
}

226 
	$°rögli°¥›_‰ì
(
SåögLi°Pr›îty
 *
¥›
)

228 
	`g_li°_f‹óch
(
¥›
->
°rög_li°
, (
GFunc
)
g_‰ì
, 
NULL
);

229 
	`g_li°_‰ì
(
¥›
->
°rög_li°
);

230 
	`g_‰ì
(
¥›
);

231 
	}
}

233 
SåögLi°Pr›îty
 *

234 
	$°rögli°¥›_c›y
(
SåögLi°Pr›îty
 *
§c
)

236 
SåögLi°Pr›îty
 *
¥›
 =

237 (
SåögLi°Pr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

238 
§c
->
comm⁄
.
ªas⁄
);

239 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

240 i‡(
§c
->
°rög_li°
) {

241 
GLi°
 *
tmp
;

243 
tmp
 = 
§c
->
°rög_li°
;Åm∞!
NULL
;Åm∞tmp->
√xt
)

244 
¥›
->
°rög_li°
 = 
	`g_li°_≠≥nd
’r›->°rög_li°, 
	`g_°rdup
(
tmp
->
d©a
));

247 
¥›
->
°rög_li°
 = 
NULL
;

248  
¥›
;

249 
	}
}

252 
	$°rögli°¥›_lﬂd
(
SåögLi°Pr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

254 
	`g_w¨nög
("stringlistprop_loadÇot implemented");

255 
	}
}

258 
	$°rögli°¥›_ßve
(
SåögPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

260 
	`g_w¨nög
("stringlistprop_saveÇot implemented");

261 
	}
}

264 
	$°rögli°¥›_gë_‰om_off£t
(
SåögLi°Pr›îty
 *
¥›
,

265 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

267 
GLi°
 *
tmp
, *
l°
 = 
¥›
->
°rög_li°
;

269 
	`g_li°_f‹óch
(
l°
, (
GFunc
)
g_‰ì
, 
NULL
);

270 
	`g_li°_‰ì
(
l°
);

271 
tmp
 = 
	`°ru˘_membî
(
ba£
,
off£t
,
GLi°
 *);Åm∞!
NULL
;Åm∞tmp->
√xt
)

272 
l°
 = 
	`g_li°_≠≥nd
÷°, 
	`g_°rdup
(
tmp
->
d©a
));

273 
¥›
->
°rög_li°
 = 
l°
;

274 
	}
}

277 
	$°rögli°¥›_£t_‰om_off£t
(
SåögLi°Pr›îty
 *
¥›
,

278 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

280 
GLi°
 *
tmp
, *
l°
 = 
	`°ru˘_membî
(
ba£
,
off£t
,GList *);

282 
	`g_li°_f‹óch
(
l°
, (
GFunc
)
g_‰ì
, 
NULL
);

283 
	`g_li°_‰ì
(
l°
);

284 
tmp
 = 
¥›
->
°rög_li°
;Åm∞!
NULL
;Åm∞tmp->
√xt
)

285 
l°
 = 
	`g_li°_≠≥nd
÷°, 
	`g_°rdup
(
tmp
->
d©a
));

286 
	`°ru˘_membî
(
ba£
,
off£t
,
GLi°
 *Ë
l°
;

287 
	}
}

289 c⁄° 
Pr›îtyOps
 
	g°rög¥›_›s
 = {

290 (
Pr›îtyTy≥_New
Ë
°rög¥›_√w
,

291 (
Pr›îtyTy≥_Fªe
Ë
°rög¥›_‰ì
,

292 (
Pr›îtyTy≥_C›y
Ë
°rög¥›_c›y
,

293 (
Pr›îtyTy≥_Lﬂd
Ë
°rög¥›_lﬂd
,

294 (
Pr›îtyTy≥_Save
Ë
°rög¥›_ßve
,

295 (
Pr›îtyTy≥_GëWidgë
Ë
°rög¥›_gë_widgë
,

296 (
Pr›îtyTy≥_Re£tWidgë
Ë
°rög¥›_ª£t_widgë
,

297 (
Pr›îtyTy≥_SëFromWidgë
Ë
°rög¥›_£t_‰om_widgë
,

299 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

300 (
Pr›îtyTy≥_GëFromOff£t
Ë
°rög¥›_gë_‰om_off£t
,

301 (
Pr›îtyTy≥_SëFromOff£t
Ë
°rög¥›_£t_‰om_off£t
,

302 (
Pr›îtyTy≥_GëD©aSize
Ë
°rög¥›_gë_d©a_size


305 c⁄° 
Pr›îtyOps
 
	g°rögli°¥›_›s
 = {

306 (
Pr›îtyTy≥_New
Ë
°rögli°¥›_√w
,

307 (
Pr›îtyTy≥_Fªe
Ë
°rögli°¥›_‰ì
,

308 (
Pr›îtyTy≥_C›y
Ë
°rögli°¥›_c›y
,

309 (
Pr›îtyTy≥_Lﬂd
Ë
°rögli°¥›_lﬂd
,

310 (
Pr›îtyTy≥_Save
Ë
°rögli°¥›_ßve
,

311 (
Pr›îtyTy≥_GëWidgë
Ë
no›¥›_gë_widgë
,

312 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

313 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

315 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

316 (
Pr›îtyTy≥_GëFromOff£t
Ë
°rögli°¥›_gë_‰om_off£t
,

317 (
Pr›îtyTy≥_SëFromOff£t
Ë
°rögli°¥›_£t_‰om_off£t


320 c⁄° 
Pr›îtyOps
 
	gmu…i°rög¥›_›s
 = {

321 (
Pr›îtyTy≥_New
Ë
mu…i°rög¥›_√w
,

322 (
Pr›îtyTy≥_Fªe
Ë
°rög¥›_‰ì
,

323 (
Pr›îtyTy≥_C›y
Ë
°rög¥›_c›y
,

324 (
Pr›îtyTy≥_Lﬂd
Ë
°rög¥›_lﬂd
,

325 (
Pr›îtyTy≥_Save
Ë
°rög¥›_ßve
,

326 (
Pr›îtyTy≥_GëWidgë
Ë
mu…i°rög¥›_gë_widgë
,

327 (
Pr›îtyTy≥_Re£tWidgë
Ë
mu…i°rög¥›_ª£t_widgë
,

328 (
Pr›îtyTy≥_SëFromWidgë
Ë
mu…i°rög¥›_£t_‰om_widgë
,

330 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

331 (
Pr›îtyTy≥_GëFromOff£t
Ë
°rög¥›_gë_‰om_off£t
,

332 (
Pr›îtyTy≥_SëFromOff£t
Ë
°rög¥›_£t_‰om_off£t


335 c⁄° 
Pr›îtyOps
 
	gfûïr›_›s
 = {

336 (
Pr›îtyTy≥_New
Ë
°rög¥›_√w
,

337 (
Pr›îtyTy≥_Fªe
Ë
°rög¥›_‰ì
,

338 (
Pr›îtyTy≥_C›y
Ë
°rög¥›_c›y
,

339 (
Pr›îtyTy≥_Lﬂd
Ë
°rög¥›_lﬂd
,

340 (
Pr›îtyTy≥_Save
Ë
°rög¥›_ßve
,

341 (
Pr›îtyTy≥_GëWidgë
Ë
fûïr›_gë_widgë
,

342 (
Pr›îtyTy≥_Re£tWidgë
Ë
fûïr›_ª£t_widgë
,

343 (
Pr›îtyTy≥_SëFromWidgë
Ë
fûïr›_£t_‰om_widgë
,

345 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

346 (
Pr›îtyTy≥_GëFromOff£t
Ë
°rög¥›_gë_‰om_off£t
,

347 (
Pr›îtyTy≥_SëFromOff£t
Ë
°rög¥›_£t_‰om_off£t


354 
TextPr›îty
 *

355 
	$ãxçr›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

357 
TextPr›îty
 *
¥›
 = 
	`g_√w0
(TextProperty,1);

358 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

359 
¥›
->
ãxt_d©a
 = 
NULL
;

360  
¥›
;

361 
	}
}

363 
TextPr›îty
 *

364 
	$ãxçr›_c›y
(
TextPr›îty
 *
§c
)

366 
TextPr›îty
 *
¥›
 =

367 (
TextPr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

368 
§c
->
comm⁄
.
ªas⁄
);

369 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

370 i‡(
§c
->
ãxt_d©a
)

371 
¥›
->
ãxt_d©a
 = 
	`g_°rdup
(
§c
->text_data);

373 
¥›
->
ãxt_d©a
 = 
NULL
;

374  
¥›
;

375 
	}
}

378 
	$ãxçr›_‰ì
(
TextPr›îty
 *
¥›
)

380 i‡(
¥›
->
©å
.
f⁄t
)

381 
	`dü_f⁄t_uƒef
(
¥›
->
©å
.
f⁄t
);

382 
	`g_‰ì
(
¥›
->
ãxt_d©a
);

383 
	`g_‰ì
(
¥›
);

384 
	}
}

387 
	$ãxçr›_lﬂd
(
TextPr›îty
 *
¥›
, 
AâribuãNode
 
©å
, 
D©aNode
 
d©a
)

389 
Text
 *
ãxt
;

390 
	`g_‰ì
(
¥›
->
ãxt_d©a
);

391 
ãxt
 = 
	`d©a_ãxt
(
d©a
);

392 
	`ãxt_gë_©åibuãs
(
ãxt
,&
¥›
->
©å
);

393 
¥›
->
ãxt_d©a
 = 
	`ãxt_gë_°rög_c›y
(
ãxt
);

394 
	`ãxt_de°roy
(
ãxt
);

395 
	}
}

398 
	$ãxçr›_ßve
(
TextPr›îty
 *
¥›
, 
AâribuãNode
 
©å
)

400 
Text
 *
ãxt
 = 
	`√w_ãxt
(
¥›
->
ãxt_d©a
,

401 
¥›
->
©å
.
f⁄t
,

402 
¥›
->
©å
.
height
,

403 &
¥›
->
©å
.
posôi⁄
,

404 &
¥›
->
©å
.
cﬁ‹
,

405 
¥›
->
©å
.
Æignmít
);

406 
	`d©a_add_ãxt
(
©å
,
ãxt
);

407 
	`ãxt_de°roy
(
ãxt
);

408 
	}
}

411 
	$ãxçr›_gë_‰om_off£t
(
TextPr›îty
 *
¥›
,

412 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

414 
Text
 *
ãxt
 = 
	`°ru˘_membî
(
ba£
,
off£t
,Text *);

415 
	`g_‰ì
(
¥›
->
ãxt_d©a
);

416 
¥›
->
ãxt_d©a
 = 
	`ãxt_gë_°rög_c›y
(
ãxt
);

417 
	`ãxt_gë_©åibuãs
(
ãxt
,&
¥›
->
©å
);

418 
	}
}

421 
	$ãxçr›_£t_‰om_off£t
(
TextPr›îty
 *
¥›
,

422 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

424 
Text
 *
ãxt
 = 
	`°ru˘_membî
(
ba£
,
off£t
,Text *);

425 
	`ãxt_£t_°rög
(
ãxt
,
¥›
->
ãxt_d©a
);

426 
	`ãxt_£t_©åibuãs
(
ãxt
,&
¥›
->
©å
);

427 
	}
}

429 c⁄° 
Pr›îtyOps
 
	gãxçr›_›s
 = {

430 (
Pr›îtyTy≥_New
Ë
ãxçr›_√w
,

431 (
Pr›îtyTy≥_Fªe
Ë
ãxçr›_‰ì
,

432 (
Pr›îtyTy≥_C›y
Ë
ãxçr›_c›y
,

433 (
Pr›îtyTy≥_Lﬂd
Ë
ãxçr›_lﬂd
,

434 (
Pr›îtyTy≥_Save
Ë
ãxçr›_ßve
,

435 (
Pr›îtyTy≥_GëWidgë
Ë
no›¥›_gë_widgë
,

436 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

437 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

439 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

440 (
Pr›îtyTy≥_GëFromOff£t
Ë
ãxçr›_gë_‰om_off£t
,

441 (
Pr›îtyTy≥_SëFromOff£t
Ë
ãxçr›_£t_‰om_off£t


447 
	$¥›_ãxt_ªgi°î
()

449 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_STRING
,&
°rög¥›_›s
);

450 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_STRINGLIST
,&
°rögli°¥›_›s
);

451 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_MULTISTRING
,&
mu…i°rög¥›_›s
);

452 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_FILE
,&
fûïr›_›s
);

453 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_TEXT
,&
ãxçr›_›s
);

454 
	}
}

459 
gch¨
 *

460 
	$obje˘_gë_di•œy«me
 (
DüObje˘
* 
obje˘
)

462 
gch¨
 *
«me
 = 
NULL
;

463 
Pr›îty
 *
¥›
 = 
NULL
;

465 i‡(!
obje˘
)

466  
	`g_°rdup
 ("<null>");

468 i‡(
	`IS_GROUP
(
obje˘
))

469 
«me
 = 
	`g_°rdup_¥ötf
 (
	`_
("Grou∞wôh %d obje˘s"), 
	`g_li°_Àngth
(
	`group_obje˘s
(
obje˘
)));

470 i‡((
¥›
 = 
	`obje˘_¥›_by_«me
(
obje˘
, "«me")Ë!
NULL
)

471 
«me
 = 
	`g_°rdup
 (((
SåögPr›îty
 *)
¥›
)->
°rög_d©a
);

472 i‡((
¥›
 = 
	`obje˘_¥›_by_«me
(
obje˘
, "ãxt")Ë!
NULL
)

473 
«me
 = 
	`g_°rdup
 (((
TextPr›îty
 *)
¥›
)->
ãxt_d©a
);

475 i‡(!
«me
)

476 
«me
 = 
	`g_°rdup
 (
obje˘
->
ty≥
->name);

478 i‡(
¥›
)

479 
¥›
->
›s
->
	`‰ì
(prop);

481 
«me
 = 
	`g_°rdñimô
 (name, "\n", ' ');

483  
«me
;

484 
	}
}

	@O:\tool\dvs50\lib\prop_text.h

25 #i‚de‡
PROP_TEXT_H


26 
	#PROP_TEXT_H


	)

28 
	~"¥›îtõs.h
"

29 
	~"dü_xml.h
"

30 
	~"ãxt.h
"

34 
Pr›îty
 
	mcomm⁄
;

35 
gch¨
 *
	m°rög_d©a
;

36 
göt
 
	mnum_löes
;

37 } 
	tSåögPr›îty
;

40 
Pr›îty
 
	mcomm⁄
;

41 
GLi°
 *
	m°rög_li°
;

42 } 
	tSåögLi°Pr›îty
;

45 
Pr›îty
 
	mcomm⁄
;

46 
gch¨
 *
	mãxt_d©a
;

47 
TextAâribuãs
 
	m©å
;

48 } 
	tTextPr›îty
;

50 
¥›_ãxt_ªgi°î
();

	@O:\tool\dvs50\lib\prop_widgets.c

25 #ifde‡
HAVE_CONFIG_H


26 
	~<c⁄fig.h
>

29 
	~<glib.h
>

30 #unde‡
GTK_DISABLE_DEPRECATED


31 
	~<gtk/gtk.h
>

32 
	#WIDGET
 
GtkWidgë


	)

33 
	~"widgës.h
"

34 
	~"¥›îtõs.h
"

35 
	~"¥›öã∫Æs.h
"

41 
WIDGET
 *

42 
	$°©i˝r›_gë_widgë
(
SèticPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

44 
GtkWidgë
 *
ªt
 = 
NULL
;

45 i‡(!
¥›
->
comm⁄
.
des¸
Ë 
NULL
;

47 
ªt
 = 
	`gtk_œbñ_√w
(
¥›
->
comm⁄
.
des¸
->
toﬁtù
);

48 
	`gtk_œbñ_£t_ju°ify
(
	`GTK_LABEL
(
ªt
),
GTK_JUSTIFY_LEFT
);

49  
ªt
;

50 
	}
}

52 c⁄° 
Pr›îtyOps
 
	g°©i˝r›_›s
 = {

53 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

54 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

55 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

56 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

57 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

58 (
Pr›îtyTy≥_GëWidgë
Ë
°©i˝r›_gë_widgë
,

59 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

60 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

62 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

63 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

64 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


72 
WIDGET
 *

73 
	$buâ⁄¥›_gë_widgë
(
Buâ⁄Pr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

75 
GtkWidgë
 *
ªt
 = 
NULL
;

76 i‡(!
¥›
->
comm⁄
.
des¸
Ë 
NULL
;

78 
ªt
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
(
	`_
(
¥›
->
comm⁄
.
des¸
->
toﬁtù
));

79 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "clicked");

81  
ªt
;

82 
	}
}

84 c⁄° 
Pr›îtyOps
 
	gbuâ⁄¥›_›s
 = {

85 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

86 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

87 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

88 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

89 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

90 (
Pr›îtyTy≥_GëWidgë
Ë
buâ⁄¥›_gë_widgë
,

91 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

92 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

94 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

95 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

96 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


103 
	sFﬁdBuâ⁄Info
 {

104 
GtkWidgë
 *
	munfﬁdbuâ⁄
;

105 
GtkWidgë
 *
	m‰ame
;

109 
	$‰ame_fﬁd_unfﬁd
(
GtkWidgë
 *
buâ⁄1
, 
gpoöãr
 
u£rd©a
)

111 
FﬁdBuâ⁄Info
 *
öfo
 = (FﬁdBuâ⁄Infÿ*)
u£rd©a
;

113 i‡(
buâ⁄1
 =
öfo
->
unfﬁdbuâ⁄
) {

114 
	`gtk_widgë_£t_£nsôive
 (
öfo
->
unfﬁdbuâ⁄
, 
FALSE
);

115 
	`gtk_widgë_hide
(
öfo
->
unfﬁdbuâ⁄
);

116 
	`gtk_widgë_show
(
öfo
->
‰ame
);

118 
	`gtk_widgë_hide
(
öfo
->
‰ame
);

119 
	`gtk_widgë_show
(
öfo
->
unfﬁdbuâ⁄
);

120 
	`gtk_widgë_£t_£nsôive
 (
öfo
->
unfﬁdbuâ⁄
, 
TRUE
);

122 
	}
}

124 
WIDGET
 *

125 
	$‰ame_begö¥›_gë_widgë
(
FømePr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

127 
gch¨
 *
fﬁd°rög
 = 
	`g_°rdup_¥ötf
("%†<<<", 
¥›
->
comm⁄
.
des¸
->
des¸ùti⁄
);

128 
gch¨
 *
unfﬁd°rög
 = 
	`g_°rdup_¥ötf
("%†>>>", 
¥›
->
comm⁄
.
des¸
->
des¸ùti⁄
);

129 
GtkWidgë
 *
‰ame
 = 
	`gtk_‰ame_√w
(
NULL
);

130 
GtkWidgë
 *
vbox
 = 
	`gtk_vbox_√w
(
FALSE
,2);

131 
GtkWidgë
 *
fﬁdbuâ⁄
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
(
fﬁd°rög
);

132 
GtkWidgë
 *
unfﬁdbuâ⁄
 = 
	`gtk_buâ⁄_√w_wôh_œbñ
(
unfﬁd°rög
);

134 
FﬁdBuâ⁄Info
 *
öfo
 = 
	`g_√w
(FoldButtonInfo, 1);

136 
	`g_‰ì
(
fﬁd°rög
);

137 
	`g_‰ì
(
unfﬁd°rög
);

139 
öfo
->
‰ame
 = frame;

140 
öfo
->
unfﬁdbuâ⁄
 = unfoldbutton;

142 
	`gtk_‰ame_£t_œbñ_widgë
(
	`GTK_FRAME
(
‰ame
), 
fﬁdbuâ⁄
);

144 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
(
‰ame
), 2);

145 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
‰ame
),
vbox
);

146 
	`gtk_widgë_£t_£nsôive
 (
unfﬁdbuâ⁄
, 
FALSE
);

147 
	`gtk_widgë_show
(
fﬁdbuâ⁄
);

148 
	`gtk_widgë_show
(
‰ame
);

149 
	`gtk_widgë_show
(
vbox
);

151 
	`¥›_dülog_add_øw
(
dülog
, 
‰ame
);

153 
	`¥›_dülog_add_øw_wôh_Êags
(
dülog
, 
unfﬁdbuâ⁄
, 
FALSE
, FALSE);

155 
	`gtk_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
fﬁdbuâ⁄
), "clicked",

156 
	`GTK_SIGNAL_FUNC
(
‰ame_fﬁd_unfﬁd
), 
öfo
);

157 
	`gtk_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
unfﬁdbuâ⁄
), "clicked",

158 
	`GTK_SIGNAL_FUNC
(
‰ame_fﬁd_unfﬁd
), 
öfo
);

160 
	`¥›_dülog_c⁄èöî_push
(
dülog
,
vbox
);

162  
NULL
;

163 
	}
}

165 
WIDGET
 *

166 
	$‰ame_íd¥›_gë_widgë
(
FømePr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

168 
	`¥›_dülog_c⁄èöî_p›
(
dülog
);

169  
NULL
;

170 
	}
}

172 c⁄° 
Pr›îtyOps
 
	g‰ame_begö¥›_›s
 = {

173 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

174 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

175 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

176 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

177 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

178 (
Pr›îtyTy≥_GëWidgë
Ë
‰ame_begö¥›_gë_widgë
,

179 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

180 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

182 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

183 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

184 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


187 c⁄° 
Pr›îtyOps
 
	g‰ame_íd¥›_›s
 = {

188 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

189 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

190 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

191 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

192 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

193 (
Pr›îtyTy≥_GëWidgë
Ë
‰ame_íd¥›_gë_widgë
,

194 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

195 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

197 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

198 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

199 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


206 
WIDGET
 *

207 
	$mu…icﬁ_begö¥›_gë_widgë
(
Mu…icﬁPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

209 
GtkWidgë
 *
mu…icﬁ
 = 
	`gtk_hbox_√w
(
FALSE
,1);

211 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
(
mu…icﬁ
), 2);

212 
	`gtk_widgë_show
(
mu…icﬁ
);

214 
	`¥›_dülog_add_øw
(
dülog
,
mu…icﬁ
);

216 
	`¥›_dülog_c⁄èöî_push
(
dülog
,
mu…icﬁ
);

217 
	`¥›_dülog_c⁄èöî_push
(
dülog
,
NULL
);

219  
NULL
;

220 
	}
}

222 
WIDGET
 *

223 
	$mu…icﬁ_cﬁum≈r›_gë_widgë
(
Mu…icﬁPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

225 
GtkWidgë
 *
cﬁ
 = 
	`gtk_vbox_√w
(
FALSE
,1);

227 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
(
cﬁ
), 2);

228 
	`gtk_widgë_show
(
cﬁ
);

230 
	`¥›_dülog_c⁄èöî_p›
(
dülog
);

232 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
dülog
->
œ°c⁄t
),
cﬁ
);

234 
	`¥›_dülog_add_øw
(
dülog
,
NULL
);

235 
	`¥›_dülog_c⁄èöî_push
(
dülog
,
cﬁ
);

237  
NULL
;

238 
	}
}

240 
WIDGET
 *

241 
	$mu…icﬁ_íd¥›_gë_widgë
(
Mu…icﬁPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

243 
	`¥›_dülog_c⁄èöî_p›
(
dülog
);

244 
	`¥›_dülog_c⁄èöî_p›
(
dülog
);

245  
NULL
;

246 
	}
}

248 c⁄° 
Pr›îtyOps
 
	gmu…icﬁ_begö¥›_›s
 = {

249 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

250 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

251 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

252 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

253 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

254 (
Pr›îtyTy≥_GëWidgë
Ë
mu…icﬁ_begö¥›_gë_widgë
,

255 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

256 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

258 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

259 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

260 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


263 c⁄° 
Pr›îtyOps
 
	gmu…icﬁ_cﬁum≈r›_›s
 = {

264 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

265 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

266 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

267 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

268 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

269 (
Pr›îtyTy≥_GëWidgë
Ë
mu…icﬁ_cﬁum≈r›_gë_widgë
,

270 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

271 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

273 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

274 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

275 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


278 c⁄° 
Pr›îtyOps
 
	gmu…icﬁ_íd¥›_›s
 = {

279 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

280 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

281 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

282 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

283 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

284 (
Pr›îtyTy≥_GëWidgë
Ë
mu…icﬁ_íd¥›_gë_widgë
,

285 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

286 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

288 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

289 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

290 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


297 
WIDGET
 *

298 
	$nŸebook_begö¥›_gë_widgë
(
NŸebookPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

300 
GtkWidgë
 *
nŸebook
 = 
	`gtk_nŸebook_√w
();

302 
	`gtk_nŸebook_£t_èb_pos
(
	`GTK_NOTEBOOK
(
nŸebook
),
GTK_POS_TOP
);

303 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
(
nŸebook
), 1);

304 
	`gtk_widgë_show
(
nŸebook
);

306 
	`¥›_dülog_add_øw
(
dülog
,
nŸebook
);

308 
	`¥›_dülog_c⁄èöî_push
(
dülog
,
nŸebook
);

309 
	`¥›_dülog_c⁄èöî_push
(
dülog
,
NULL
);

311  
NULL
;

312 
	}
}

314 
WIDGET
 *

315 
	$nŸebook_∑gïr›_gë_widgë
(
NŸebookPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

317 
GtkWidgë
 *
∑ge
 = 
	`gtk_vbox_√w
(
FALSE
,1);

318 
GtkWidgë
 *
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
(
¥›
->
comm⁄
.
des¸
->
des¸ùti⁄
));

320 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
(
∑ge
), 2);

321 
	`gtk_widgë_show
(
∑ge
);

322 
	`gtk_widgë_show
(
œbñ
);

324 
	`¥›_dülog_c⁄èöî_p›
(
dülog
);

326 
	`gtk_nŸebook_≠≥nd_∑ge
(
	`GTK_NOTEBOOK
(
dülog
->
œ°c⁄t
),
∑ge
,
œbñ
);

328 
	`¥›_dülog_add_øw
(
dülog
,
NULL
);

329 
	`¥›_dülog_c⁄èöî_push
(
dülog
,
∑ge
);

331  
NULL
;

332 
	}
}

334 
WIDGET
 *

335 
	$nŸebook_íd¥›_gë_widgë
(
NŸebookPr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

337 
	`¥›_dülog_c⁄èöî_p›
(
dülog
);

338 
	`¥›_dülog_c⁄èöî_p›
(
dülog
);

339  
NULL
;

340 
	}
}

342 c⁄° 
Pr›îtyOps
 
	gnŸebook_begö¥›_›s
 = {

343 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

344 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

345 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

346 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

347 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

348 (
Pr›îtyTy≥_GëWidgë
Ë
nŸebook_begö¥›_gë_widgë
,

349 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

350 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

352 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

353 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

354 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


357 c⁄° 
Pr›îtyOps
 
	gnŸebook_∑gïr›_›s
 = {

358 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

359 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

360 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

361 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

362 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

363 (
Pr›îtyTy≥_GëWidgë
Ë
nŸebook_∑gïr›_gë_widgë
,

364 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

365 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

367 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

368 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

369 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


372 c⁄° 
Pr›îtyOps
 
	gnŸebook_íd¥›_›s
 = {

373 (
Pr›îtyTy≥_New
Ë
no›¥›_√w
,

374 (
Pr›îtyTy≥_Fªe
Ë
no›¥›_‰ì
,

375 (
Pr›îtyTy≥_C›y
Ë
no›¥›_c›y
,

376 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

377 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

378 (
Pr›îtyTy≥_GëWidgë
Ë
nŸebook_íd¥›_gë_widgë
,

379 (
Pr›îtyTy≥_Re£tWidgë
Ë
no›¥›_ª£t_widgë
,

380 (
Pr›îtyTy≥_SëFromWidgë
Ë
no›¥›_£t_‰om_widgë
,

382 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

383 (
Pr›îtyTy≥_GëFromOff£t
Ë
no›¥›_gë_‰om_off£t
,

384 (
Pr›îtyTy≥_SëFromOff£t
Ë
no›¥›_£t_‰om_off£t


392 
	$li°¥›_em±ylöes_ªÆloc
(
Li°Pr›îty
 *
¥›
,
guöt
 
√w_size
) {

393 
guöt
 
i
;

395 
i
 = 0; i < 
¥›
->
löes
->
Àn
; i++)

396 
	`g_‰ì
(
	`g_±r_¨øy_ödex
(
¥›
->
löes
,
i
));

397 i‡(
√w_size
 >= 0)

398 
	`g_±r_¨øy_£t_size
(
¥›
->
löes
,
√w_size
);

399 
	}
}

402 
	$li°¥›_c›ylöes
(
Li°Pr›îty
 *
¥›
, 
GPåAºay
 *
§c
) {

403 
guöt
 
i
;

405 
	`li°¥›_em±ylöes_ªÆloc
(
¥›
,
§c
->
Àn
);

407 
i
 = 0; i < 
§c
->
Àn
; i++)

408 
	`g_±r_¨øy_ödex
(
¥›
->
löes
,
i
Ë
	`g_°rdup
(g_±r_¨øy_ödex(
§c
,i));

409 
	}
}

411 
Li°Pr›îty
 *

412 
	$li°¥›_√w
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
, 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
)

414 
Li°Pr›îty
 *
¥›
 = 
	`g_√w0
(ListProperty,1);

415 
	`öôülize_¥›îty
(&
¥›
->
comm⁄
,
pdesc
,
ªas⁄
);

416 
¥›
->
£À˘ed
 = -1;

417 
¥›
->
w_£À˘ed
 = -1;

418 
¥›
->
löes
 = 
	`g_±r_¨øy_√w
();

419  
¥›
;

420 
	}
}

423 
	$li°¥›_‰ì
(
Li°Pr›îty
 *
¥›
)

425 
	`li°¥›_em±ylöes_ªÆloc
(
¥›
,-1);

426 
	`g_±r_¨øy_‰ì
(
¥›
->
löes
,
TRUE
);

427 
	}
}

429 
Li°Pr›îty
 *

430 
	$li°¥›_c›y
(
Li°Pr›îty
 *
§c
)

432 
Li°Pr›îty
 *
¥›
 =

433 (
Li°Pr›îty
 *)
§c
->
comm⁄
.
›s
->
	`√w_¥›
(§c->comm⁄.
des¸
,

434 
§c
->
comm⁄
.
ªas⁄
);

436 
	`c›y_öô_¥›îty
(&
¥›
->
comm⁄
,&
§c
->common);

437 
¥›
->
£À˘ed
 = 
§c
->selected;

438 
¥›
->
w_£À˘ed
 = 
§c
->w_selected;

439 
	`li°¥›_c›ylöes
(
¥›
,
§c
->
löes
);

441  
¥›
;

442 
	}
}

445 
	$li°¥›_£À˘_chûd_sig«l
(
GtkLi°
 *
li°
,

446 
GtkWidgë
 *
chûd
,

447 
Li°Pr›îty
 *
¥›
)

449 
¥›
->
w_£À˘ed
 = 
	`gtk_li°_chûd_posôi⁄
(
li°
,
chûd
);

450 
	}
}

452 
WIDGET
 *

453 
	$li°¥›_gë_widgë
(
Li°Pr›îty
 *
¥›
, 
Pr›Dülog
 *
dülog
)

455 
GtkWidgë
 *
ªt
 = 
	`gtk_li°_√w
();

457 
	`gtk_li°_£t_£À˘i⁄_mode
(
	`GTK_LIST
(
ªt
),
GTK_SELECTION_BROWSE
);

458 
	`gtk_li°_un£À˘_Æl
(
	`GTK_LIST
(
ªt
));

460 
	`gtk_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
ªt
), "select-child",

461 
	`GTK_SIGNAL_FUNC
(
li°¥›_£À˘_chûd_sig«l
), 
¥›
);

463 
	`¥›h™dÀr_c⁄√˘
(&
¥›
->
comm⁄
, 
	`G_OBJECT
(
ªt
), "selection-changed");

464  
ªt
;

465 
	}
}

467 
GtkWidgë
 *

468 
	$make_ôem
(c⁄° 
gch¨
 *
löe
) {

469 
GtkWidgë
 *
ôem
 = 
	`gtk_li°_ôem_√w_wôh_œbñ
(
löe
);

470 
	`gtk_widgë_show
(
ôem
);

471  
ôem
;

472 
	}
}

475 
	$li°¥›_ª£t_widgë
(
Li°Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

477 
guöt
 
i
;

478 
GLi°
 *
ôems
 = 
NULL
;

479 
	`gtk_li°_˛ór_ôems
(
	`GTK_LIST
(
widgë
),0,-1);

481 
i
 = 0; i < 
¥›
->
löes
->
Àn
; i++) {

482 
ôems
 = 
	`g_li°_≠≥nd
(ôems, 
	`make_ôem
(
	`g_±r_¨øy_ödex
(
¥›
->
löes
,
i
)));

484 
	`gtk_li°_≠≥nd_ôems
(
	`GTK_LIST
(
widgë
),
ôems
);

485 
¥›
->
w_£À˘ed
 =Ör›->
£À˘ed
;

486 
	`gtk_li°_£À˘_ôem
(
	`GTK_LIST
(
widgë
),
¥›
->
£À˘ed
);

487 
	}
}

490 
	$li°¥›_£t_‰om_widgë
(
Li°Pr›îty
 *
¥›
, 
WIDGET
 *
widgë
)

492 
¥›
->
£À˘ed
 =Ör›->
w_£À˘ed
;

493 
	}
}

496 
	$li°¥›_gë_‰om_off£t
(
Li°Pr›îty
 *
¥›
,

497 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

499 
	`li°¥›_c›ylöes
(
¥›
,
	`°ru˘_membî
(
ba£
,
off£t
, 
GPåAºay
 *));

500 
¥›
->
£À˘ed
 = 
	`°ru˘_membî
(
ba£
,
off£t2
,
göt
);

501 
	}
}

504 
	$li°¥›_£t_‰om_off£t
(
Li°Pr›îty
 *
¥›
,

505 *
ba£
, 
guöt
 
off£t
, guöà
off£t2
)

507 
	`°ru˘_membî
(
ba£
,
off£t2
,
göt
Ë
¥›
->
£À˘ed
;

508 
	}
}

510 c⁄° 
Pr›îtyOps
 
	gli°¥›_›s
 = {

511 (
Pr›îtyTy≥_New
Ë
li°¥›_√w
,

512 (
Pr›îtyTy≥_Fªe
Ë
li°¥›_‰ì
,

513 (
Pr›îtyTy≥_C›y
Ë
li°¥›_c›y
,

515 (
Pr›îtyTy≥_Lﬂd
Ë
övÆid¥›_lﬂd
,

516 (
Pr›îtyTy≥_Save
Ë
övÆid¥›_ßve
,

518 (
Pr›îtyTy≥_GëWidgë
Ë
li°¥›_gë_widgë
,

519 (
Pr›îtyTy≥_Re£tWidgë
Ë
li°¥›_ª£t_widgë
,

520 (
Pr›îtyTy≥_SëFromWidgë
Ë
li°¥›_£t_‰om_widgë
,

522 (
Pr›îtyTy≥_C™Mîge
Ë
no›¥›_ˇn_mîge
,

523 (
Pr›îtyTy≥_GëFromOff£t
Ë
li°¥›_gë_‰om_off£t
,

524 (
Pr›îtyTy≥_SëFromOff£t
Ë
li°¥›_£t_‰om_off£t


530 
	$¥›_widgës_ªgi°î
()

532 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_STATIC
,&
°©i˝r›_›s
);

533 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_BUTTON
,&
buâ⁄¥›_›s
);

534 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_FRAME_BEGIN
,&
‰ame_begö¥›_›s
);

535 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_FRAME_END
,&
‰ame_íd¥›_›s
);

536 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_MULTICOL_BEGIN
,&
mu…icﬁ_begö¥›_›s
);

537 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_MULTICOL_END
,&
mu…icﬁ_íd¥›_›s
);

538 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_MULTICOL_COLUMN
,&
mu…icﬁ_cﬁum≈r›_›s
);

539 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_NOTEBOOK_BEGIN
,&
nŸebook_begö¥›_›s
);

540 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_NOTEBOOK_END
,&
nŸebook_íd¥›_›s
);

541 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_NOTEBOOK_PAGE
,&
nŸebook_∑gïr›_›s
);

542 
	`¥›_ty≥_ªgi°î
(
PROP_TYPE_LIST
,&
li°¥›_›s
);

543 
	}
}

	@O:\tool\dvs50\lib\prop_widgets.h

25 #i‚de‡
PROP_WIDGETS_H


26 
	#PROP_WIDGETS_H


	)

28 
	~"¥›îtõs.h
"

29 
	~"dü_xml.h
"

30 
	~"ãxt.h
"

34 
Pr›îty
 
	mcomm⁄
;

35 } 
	tSèticPr›îty
;

38 
Pr›îty
 
	mcomm⁄
;

39 } 
	tBuâ⁄Pr›îty
;

42 
Pr›îty
 
	mcomm⁄
;

43 
gboﬁón
 
	mcﬁœpsibÀ
;

44 
gboﬁón
 
	mcﬁœp£d
;

45 } 
	tFømePr›îty
;

48 
Pr›îty
 
	mcomm⁄
;

49 } 
	tMu…icﬁPr›îty
;

52 
Pr›îty
 
	mcomm⁄
;

53 } 
	tNŸebookPr›îty
;

56 
Pr›îty
 
	mcomm⁄
;

57 
göt
 
	m£À˘ed
;

58 
GPåAºay
 *
	mlöes
;

59 
göt
 
	mw_£À˘ed
;

60 } 
	tLi°Pr›îty
;

62 
¥›_widgës_ªgi°î
();

	@O:\tool\dvs50\lib\propdesc.c

27 #ifde‡
HAVE_CONFIG_H


28 
	~<c⁄fig.h
>

31 
	~<glib.h
>

33 
	~"¥›îtõs.h
"

34 
	~"¥›öã∫Æs.h
"

37 
	$¥›_desc_li°_ˇlcuœã_qu¨ks
(
Pr›Des¸ùti⁄
 *
∂i°
)

39 
guöt
 
i
;

41 
i
 = 0; 
∂i°
[i].
«me
 !
NULL
; i++) {

42 i‡(
∂i°
[
i
].
qu¨k
 == 0)

43 
∂i°
[
i
].
qu¨k
 = 
	`g_qu¨k_‰om_°©ic_°rög
’li°[i].
«me
);

44 i‡(
∂i°
[
i
].
ty≥_qu¨k
 == 0)

45 
∂i°
[
i
].
ty≥_qu¨k
 = 
	`g_qu¨k_‰om_°©ic_°rög
’li°[i].
ty≥
);

46 i‡(!
∂i°
[
i
].
›s
)

47 
∂i°
[
i
].
›s
 = 
	`¥›_ty≥_gë_›s
’li°[i].
ty≥
);

49 
	}
}

51 c⁄° 
Pr›Des¸ùti⁄
 *

52 
	$¥›_desc_li°_föd_¥›
(c⁄° 
Pr›Des¸ùti⁄
 *
∂i°
, c⁄° 
gch¨
 *
«me
)

54 
göt
 
i
 = 0;

55 
GQu¨k
 
«me_qu¨k
 = 
	`g_qu¨k_‰om_°rög
(
«me
);

57 
∂i°
[
i
].
«me
 !
NULL
) {

58 i‡(
∂i°
[
i
].
qu¨k
 =
«me_qu¨k
)

59  &
∂i°
[
i
];

60 
i
++;

62  
NULL
;

63 
	}
}

66 
Pr›EvítH™dÀr


67 
	$¥›_desc_föd_ªÆ_h™dÀr
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

69 
Pr›EvítH™dÀr
 
ªt
 = 
pdesc
->
evít_h™dÀr
;

70 c⁄° 
Pr›EvítH™dÀrChaö
 *
chaö
 = &
pdesc
->
chaö_h™dÀr
;

71 i‡(!
chaö
->
h™dÀr
Ë 
ªt
;

72 
chaö
) {

73 i‡(
chaö
->
h™dÀr
Ë
ªt
 = chain->handler;

74 
chaö
 = chain->chain;

76  
ªt
;

77 
	}
}

81 
	$¥›_desc_‰ì_h™dÀr_chaö
(
Pr›Des¸ùti⁄
 *
pdesc
)

83 i‡(
pdesc
) {

84 
Pr›EvítH™dÀrChaö
 *
chaö
 = 
pdesc
->
chaö_h™dÀr
.chain;

85 
chaö
) {

86 
Pr›EvítH™dÀrChaö
 *
√xt
 = 
chaö
->chain;

87 
	`g_‰ì
(
chaö
);

88 
chaö
 = 
√xt
;

90 
pdesc
->
chaö_h™dÀr
.
chaö
 = 
NULL
;

91 
pdesc
->
chaö_h™dÀr
.
h™dÀr
 = 
NULL
;

93 
	}
}

97 
	$¥›_desc_li°_‰ì_h™dÀr_chaö
(
Pr›Des¸ùti⁄
 *
pdesc
)

99 i‡(!
pdesc
) ;

100 
pdesc
->
«me
) {

101 
	`¥›_desc_‰ì_h™dÀr_chaö
(
pdesc
);

102 
pdesc
++;

104 
	}
}

108 
	$¥›_desc_ö£π_h™dÀr
(
Pr›Des¸ùti⁄
 *
pdesc
,

109 
Pr›EvítH™dÀr
 
h™dÀr
)

111 i‡((
pdesc
->
chaö_h™dÀr
.
h™dÀr
Ë|| (pdesc->chaö_h™dÀr.
chaö
)) {

113 
Pr›EvítH™dÀrChaö
 *
pushed
 = 
	`g_√w0
(PropEventHandlerChain,1);

114 *
pushed
 = 
pdesc
->
chaö_h™dÀr
;

115 
pdesc
->
chaö_h™dÀr
.
chaö
 = 
pushed
;

117 
pdesc
->
chaö_h™dÀr
.
h™dÀr
 =Ödesc->
evít_h™dÀr
;

118 
pdesc
->
evít_h™dÀr
 = 
h™dÀr
;

119 
	}
}

121 c⁄° 
Pr›Des¸ùti⁄
 
	gnuŒ_¥›_desc
 = { 
NULL
 };

123 
Pr›Des¸ùti⁄
 *

124 
	$¥›_desc_li°s_uni⁄
(
GLi°
 *
∂i°s
)

126 
GAºay
 *
¨r
 = 
	`g_¨øy_√w
(
TRUE
, TRUE, (
Pr›Des¸ùti⁄
));

127 
Pr›Des¸ùti⁄
 *
ªt
;

128 
GLi°
 *
tmp
;

132 
	`g_¨øy_≠≥nd_vÆ
(
¨r
, 
nuŒ_¥›_desc
);

133 
	`g_¨øy_ªmove_ödex
(
¨r
, 0);

137 
tmp
 = 
∂i°s
;Åmp;Åm∞tmp->
√xt
) {

138 
Pr›Des¸ùti⁄
 *
∂i°
 = 
tmp
->
d©a
;

139 
i
;

141 
i
 = 0; 
∂i°
[i].
«me
 !
NULL
; i++) {

142 
j
;

144 i‡(
∂i°
[
i
].
Êags
 & 
PROP_FLAG_DONT_MERGE
)

149 
j
 = 0; j < 
¨r
->
Àn
; j++)

150 i‡(
	`g_¨øy_ödex
(
¨r
, 
Pr›Des¸ùti⁄
, 
j
).
qu¨k
 =
∂i°
[
i
].quark)

154 i‡(
j
 =
¨r
->
Àn
)

155 
	`g_¨øy_≠≥nd_vÆ
(
¨r
, 
∂i°
[
i
]);

160 
ªt
 = (
Pr›Des¸ùti⁄
 *)
¨r
->
d©a
;

161 
	`g_¨øy_‰ì
(
¨r
, 
FALSE
);

162  
ªt
;

163 
	}
}

165 
gboﬁón


166 
	$¥›descs_ˇn_be_mîged
(c⁄° 
Pr›Des¸ùti⁄
 *
p1
,

167 c⁄° 
Pr›Des¸ùti⁄
 *
p2
) {

168 
Pr›EvítH™dÀr
 
≥h1
 = 
	`¥›_desc_föd_ªÆ_h™dÀr
(
p1
);

169 
Pr›EvítH™dÀr
 
≥h2
 = 
	`¥›_desc_föd_ªÆ_h™dÀr
(
p2
);

171 i‡(
p1
->
›s
 !
p2
->›sË 
FALSE
;

172 i‡((
p1
->
Êags
|
p2
->ÊagsË& 
PROP_FLAG_DONT_MERGE
Ë 
FALSE
;

173 i‡(
≥h1
 !
≥h2
Ë 
FALSE
;

174 i‡((
p1
->
›s
->
ˇn_mîge
 && !’1->›s->
	`ˇn_mîge
’1,
p2
))) ||

175 (
p2
->
›s
->
ˇn_mîge
 && !’2->›s->
	`ˇn_mîge
’2,
p1
)))Ë 
FALSE
;

177  
TRUE
;

178 
	}
}

180 
Pr›Des¸ùti⁄
 *

181 
	$¥›_desc_li°s_öãr£˘i⁄
(
GLi°
 *
∂i°s
)

183 
GAºay
 *
¨r
 = 
	`g_¨øy_√w
(
TRUE
, TRUE, (
Pr›Des¸ùti⁄
));

184 
Pr›Des¸ùti⁄
 *
ªt
;

185 
GLi°
 *
tmp
;

186 
göt
 
i
;

189 
	`g_¨øy_≠≥nd_vÆ
(
¨r
, 
nuŒ_¥›_desc
);

190 
	`g_¨øy_ªmove_ödex
(
¨r
, 0);

192 i‡(
∂i°s
) {

195 
ªt
 = 
∂i°s
->
d©a
;

196 
i
 = 0; 
ªt
[i].
«me
 !
NULL
; i++)

197 
	`g_¨øy_≠≥nd_vÆ
(
¨r
, 
ªt
[
i
]);

200 
tmp
 = 
∂i°s
->
√xt
;Åmp;Åmp =Åmp->next) {

201 
ªt
 = 
tmp
->
d©a
;

204 
i
 = 
¨r
->
Àn
 - 1; i >= 0; i--) {

205 
göt
 
j
;

208 
Pr›Des¸ùti⁄
 
ˇnd
 = 
	`g_¨øy_ödex
(
¨r
,Pr›Des¸ùti⁄,
i
);

209 
gboﬁón
 
ªmove
 = 
TRUE
;

210 
j
 = 0; 
ªt
[j].
«me
 !
NULL
; j++) {

211 i‡(
ˇnd
.
qu¨k
 =
ªt
[
j
].quark) {

212 
ªmove
 = !(
	`¥›descs_ˇn_be_mîged
(&
ªt
[
j
],&
ˇnd
));

216 i‡(
ªmove
Ë
	`g_¨øy_ªmove_ödex
(
¨r
, 
i
);

220 
ªt
 = (
Pr›Des¸ùti⁄
 *)
¨r
->
d©a
;

221 
	`g_¨øy_‰ì
(
¨r
, 
FALSE
);

222  
ªt
;

223 
	}
}

	@O:\tool\dvs50\lib\propdialogs.c

25 #ifde‡
HAVE_CONFIG_H


26 
	~<c⁄fig.h
>

29 
	~<°rög.h
>

31 
	~<gtk/gtk.h
>

32 
	#WIDGET
 
GtkWidgë


	)

33 
	~"widgës.h
"

34 
	~"¥›îtõs.h
"

35 
	~"¥›öã∫Æs.h
"

36 
	~"obje˘.h
"

38 c⁄° 
gch¨
 *
	g¥›_dülogd©a_key
 = "object-props:dialogdata";

40 
¥›_dülog_sig«l_de°roy
(
GtkWidgë
 *
dülog_widgë
);

41 
¥›_dülog_fûl
(
Pr›Dülog
 *
dülog
, 
GLi°
 *
obje˘s
, 
gboﬁón
 
is_deÁu…
);

43 
Pr›Dülog
 *

44 
	$¥›_dülog_√w
(
GLi°
 *
obje˘s
, 
gboﬁón
 
is_deÁu…
)

46 
Pr›Dülog
 *
dülog
 = 
	`g_√w0
(PropDialog,1);

47 
dülog
->
¥›s
 = 
NULL
;

48 
dülog
->
widgë
 = 
	`gtk_vbox_√w
(
FALSE
,1);

49 
dülog
->
¥›_widgës
 = 
	`g_¨øy_√w
(
FALSE
,
TRUE
,(
Pr›WidgëAssoc
));

50 
dülog
->
c›õs
 = 
NULL
;

51 
dülog
->
cuπabÀ
 = 
NULL
;

52 
dülog
->
c⁄èöîs
 = 
	`g_±r_¨øy_√w
();

54 
	`¥›_dülog_c⁄èöî_push
(
dülog
,dülog->
widgë
);

56 
	`g_obje˘_£t_d©a
 (
	`G_OBJECT
 (
dülog
->
widgë
), 
¥›_dülogd©a_key
, dialog);

57 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
dülog
->
widgë
), "destroy",

58 
	`G_CALLBACK
 (
¥›_dülog_sig«l_de°roy
), 
NULL
);

60 
	`¥›_dülog_fûl
(
dülog
,
obje˘s
,
is_deÁu…
);

62  
dülog
;

63 
	}
}

66 
	$¥›_dülog_de°roy
(
Pr›Dülog
 *
dülog
)

68 i‡(
dülog
->
¥›s
Ë
	`¥›_li°_‰ì
(dialog->props);

69 
	`g_¨øy_‰ì
(
dülog
->
¥›_widgës
,
TRUE
);

70 
	`g_±r_¨øy_‰ì
(
dülog
->
c⁄èöîs
,
TRUE
);

71 i‡(
dülog
->
c›õs
Ë
	`de°roy_obje˘_li°
(dialog->copies);

72 
	`g_‰ì
(
dülog
);

73 
	}
}

75 
Pr›Dülog
 *

76 
	$¥›_dülog_‰om_widgë
(
GtkWidgë
 *
dülog_widgë
)

78  
	`g_obje˘_gë_d©a
 (
	`G_OBJECT
 (
dülog_widgë
), 
¥›_dülogd©a_key
);

79 
	}
}

82 
	$¥›_dülog_sig«l_de°roy
(
GtkWidgë
 *
dülog_widgë
)

84 
	`¥›_dülog_de°roy
(
	`¥›_dülog_‰om_widgë
(
dülog_widgë
));

85 
	}
}

87 
WIDGET
 *

88 
	$¥›_dülog_gë_widgë
(c⁄° 
Pr›Dülog
 *
dülog
)

90  
dülog
->
widgë
;

91 
	}
}

94 
	$¥›_dülog_add_øw
(
Pr›Dülog
 *
dülog
, 
GtkWidgë
 *
widgë
)

96 
dülog
->
cuπabÀ
 = 
NULL
;

97 i‡(!
widgë
) ;

98 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
dülog
->
œ°c⁄t
),
widgë
);

99 
	}
}

102 
	$¥›_dülog_add_øw_wôh_Êags
(
Pr›Dülog
 *
dülog
, 
GtkWidgë
 *
widgë
,

103 
gboﬁón
 
ex∑nd
, gboﬁó¿
fûl
)

105 
	`g_ªtu∫_if_Áû
(
	`GTK_IS_BOX
(
dülog
->
œ°c⁄t
));

107 
dülog
->
cuπabÀ
 = 
NULL
;

108 i‡(!
widgë
) ;

109 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
dülog
->
œ°c⁄t
),
widgë
, 
ex∑nd
, 
fûl
, 0);

110 
	}
}

113 
	$¥›_dülog_make_cuπabÀ
(
Pr›Dülog
 *
dülog
)

115 
GtkWidgë
 *
èbÀ
 = 
	`gtk_èbÀ_√w
(1,2,
FALSE
);

116 
	`gtk_èbÀ_£t_row_•acögs
(
	`GTK_TABLE
(
èbÀ
), 2);

117 
	`gtk_èbÀ_£t_cﬁ_•acögs
(
	`GTK_TABLE
(
èbÀ
), 5);

118 
	`gtk_widgë_show
(
èbÀ
);

119 
	`¥›_dülog_add_øw
(
dülog
,
èbÀ
);

121 
dülog
->
cuºow
 = 0;

122 
dülog
->
cuπabÀ
 = 
èbÀ
;

123 
	}
}

126 
	$¥›_dülog_add_widgë
(
Pr›Dülog
 *
dülog
, 
GtkWidgë
 *
œbñ
, GtkWidgë *
widgë
)

128 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

130 i‡(!
dülog
->
cuπabÀ
Ë
	`¥›_dülog_make_cuπabÀ
(dialog);

131 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
dülog
->
cuπabÀ
),
œbñ
,

133 
dülog
->
cuºow
, dialog->currow+1,

134 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
,

136 
	`gtk_èbÀ_©èch
(
	`GTK_TABLE
(
dülog
->
cuπabÀ
),
widgë
,

138 
dülog
->
cuºow
, dialog->currow+1,

139 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND,

141 
	`gtk_widgë_show
(
œbñ
);

142 
	`gtk_widgë_show
(
widgë
);

143 
dülog
->
cuºow
++;

144 
	}
}

148 
	$¥›_dülog_c⁄èöî_push
(
Pr›Dülog
 *
dülog
, 
GtkWidgë
 *
c⁄èöî
)

150 
	`g_±r_¨øy_add
(
dülog
->
c⁄èöîs
,
c⁄èöî
);

151 
dülog
->
œ°c⁄t
 = 
c⁄èöî
;

152 
dülog
->
cuπabÀ
 = 
NULL
;

153 
	}
}

156 
GtkWidgë
 *

157 
	$¥›_dülog_c⁄èöî_p›
(
Pr›Dülog
 *
dülog
)

159 
GtkWidgë
 *
ªs
 = 
	`g_±r_¨øy_ªmove_ödex
(
dülog
->
c⁄èöîs
,

160 
dülog
->
c⁄èöîs
->
Àn
-1);

161 
dülog
->
œ°c⁄t
 = 
	`g_±r_¨øy_ödex
(dülog->
c⁄èöîs
,

162 
dülog
->
c⁄èöîs
->
Àn
-1);

163 
dülog
->
cuπabÀ
 = 
NULL
;

165  
ªs
;

166 
	}
}

169 
	$¥›îty_sig«l_h™dÀr
(
GtkObje˘
 *
obj
,

170 
gpoöãr
 
func_d©a
)

172 
Pr›EvítD©a
 *
≥d
 = (Pr›EvítD©®*)
func_d©a
;

173 i‡(
≥d
) {

174 
Pr›Dülog
 *
dülog
 = 
≥d
->dialog;

175 
Pr›îty
 *
¥›
 = 
≥d
->
£lf
;

176 
GLi°
 *
li°
, *
tmp
;

177 
guöt
 
j
;

179 
li°
 = 
dülog
->
c›õs
;

180 
	`g_ªtu∫_if_Áû
(
li°
);

182 
¥›
->
ex≥rõn˚
 &~
PXP_NOTSET
;

184 i‡(!
¥›
->
evít_h™dÀr
)

191 
	`¥›_gë_d©a_‰om_widgës
(
dülog
);

193 
tmp
 = 
li°
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

194 
DüObje˘
 *
obj
 = (DüObje˘*)
tmp
->
d©a
;

195 
obj
->
›s
->
	`£t_¥›s
(obj,
dülog
->
¥›s
);

196 
¥›
->
	`evít_h™dÀr
(
obj
,prop);

197 
obj
->
›s
->
	`gë_¥›s
(obj,
dülog
->
¥›s
);

200 
j
 = 0; j < 
dülog
->
¥›_widgës
->
Àn
; j++) {

201 
Pr›WidgëAssoc
 *
pwa
 =

202 &
	`g_¨øy_ödex
(
dülog
->
¥›_widgës
,
Pr›WidgëAssoc
,
j
);

203 
pwa
->
¥›
->
›s
->
	`ª£t_widgë
’wa->¥›,pwa->
widgë
);

206 
	`g_as£π_nŸ_ªached
();

208 
	}
}

211 
	$¥›h™dÀr_c⁄√˘
(c⁄° 
Pr›îty
 *
¥›
,

212 
GObje˘
 *
obje˘
,

213 c⁄° 
gch¨
 *
sig«l
)

215 i‡(0==
	`°rcmp
(
sig«l
,"FIXME")) {

216 
	`g_w¨nög
("signalÅype unknown forÅhis kind ofÖroperty (name is %s), \n"

217 "h™dÀ∏ign‹ed.",
¥›
->
«me
);

221 
	`g_sig«l_c⁄√˘
 (
	`G_OBJECT
 (
obje˘
),

222 
sig«l
,

223 
	`G_CALLBACK
 (
¥›îty_sig«l_h™dÀr
),

224 (
gpoöãr
)(&
¥›
->
£lf
));

225 
	}
}

228 
	$¥›_dülog_add_¥›îty
(
Pr›Dülog
 *
dülog
, 
Pr›îty
 *
¥›
)

230 
GtkWidgë
 *
widgë
 = 
NULL
;

231 
Pr›WidgëAssoc
 
pwa
;

232 
GtkWidgë
 *
œbñ
;

234 
¥›
->
£lf
.
dülog
 = dialog;

235 
¥›
->
£lf
.self =Örop;

236 
¥›
->
£lf
.
my_ödex
 = 
dülog
->
¥›_widgës
->
Àn
;

238 i‡(
¥›
->
›s
->
gë_widgë
)

239 
widgë
 = 
¥›
->
›s
->
	`gë_widgë
’r›,
dülog
);

240 i‡(!
widgë
)

243 
¥›
->
£lf
.
widgë
 = widget;

244 i‡(
¥›
->
›s
->
ª£t_widgë
Ë¥›->›s->
	`ª£t_widgë
’r›,
widgë
);

245 
¥›
->
ex≥rõn˚
 |
PXP_NOTSET
;

247 
pwa
.
¥›
 =Örop;

248 
pwa
.
widgë
 = widget;

249 
	`g_¨øy_≠≥nd_vÆ
(
dülog
->
¥›_widgës
,
pwa
);

251 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
(
¥›
->
des¸
->
des¸ùti⁄
));

252 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

254 
	`¥›_dülog_add_widgë
(
dülog
, 
œbñ
, 
widgë
);

255 
	}
}

258 
	$¥›_dülog_add_¥›îtõs
(
Pr›Dülog
 *
dülog
, 
GPåAºay
 *
¥›s
)

260 
guöt
 
i
;

261 
gboﬁón
 
s¸ﬁœbÀ
 = (
¥›s
->
Àn
 > 16);

263 i‡(
s¸ﬁœbÀ
) {

264 
GtkWidgë
 *
swö
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

265 
GtkWidgë
 *
vbox
 = 
	`gtk_vbox_√w
(
FALSE
,2);

266 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
 (
dülog
->
widgë
), 
swö
, 
TRUE
, TRUE, 0);

267 
	`gtk_widgë_show
 (
swö
);

268 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
 (
	`GTK_SCROLLED_WINDOW
 (
swö
), 
vbox
);

269 
	`gtk_võwp‹t_£t_shadow_ty≥
(
	`GTK_VIEWPORT
(
	`GTK_BIN
(
swö
)->
chûd
), 
GTK_SHADOW_NONE
);

270 
	`gtk_widgë_show
 (
vbox
);

271 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
swö
), 
GTK_POLICY_NEVER
, 
GTK_POLICY_AUTOMATIC
);

272 
	`¥›_dülog_c⁄èöî_push
 (
dülog
, 
swö
);

273 
	`¥›_dülog_c⁄èöî_push
 (
dülog
, 
vbox
);

277 
i
 = 0; i < 
¥›s
->
Àn
; i++) {

278 
Pr›îty
 *
¥›
 = (Pr›îty*)
	`g_±r_¨øy_ödex
(
¥›s
,
i
);

279 
	`¥›_dülog_add_¥›îty
(
dülog
, 
¥›
);

282 i‡(
s¸ﬁœbÀ
) {

283 
GtkRequisôi⁄
 
ªquisôi⁄
;

284 
GtkWidgë
 *
vbox
 = 
	`¥›_dülog_c⁄èöî_p›
(
dülog
);

285 
GtkWidgë
 *
swö
 = 
	`¥›_dülog_c⁄èöî_p›
(
dülog
);

286 
GdkS¸ìn
 *
s¸ìn
 = 
	`gtk_widgë_gë_s¸ìn
(
swö
);

287 
guöt
 
sheight
 = 
s¸ìn
 ? (2 * 
	`gdk_s¸ìn_gë_height
(screen)) / 3 : 400;

289 
	`gtk_widgë_size_ªque°
 (
vbox
, &
ªquisôi⁄
);

291 
	`gtk_widgë_£t_size_ªque°
 (
swö
, -1, 
ªquisôi⁄
.
height
 > 
sheight
 ? sheight :Ñequisition.height);

293 
	}
}

296 
	$¥›_gë_d©a_‰om_widgës
(
Pr›Dülog
 *
dülog
)

298 
guöt
 
i
;

299 
i
 = 0; i < 
dülog
->
¥›_widgës
->
Àn
; i++) {

300 
Pr›WidgëAssoc
 *
pwa
 = &
	`g_¨øy_ödex
(
dülog
->
¥›_widgës
,

301 
Pr›WidgëAssoc
,
i
);

302 
pwa
->
¥›
->
›s
->
	`£t_‰om_widgë
’wa->¥›,pwa->
widgë
);

305 
	}
}

307 
gboﬁón


308 
	$pdçp_is_visibÀ_deÁu…
 (c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

310  
	`pdçp_deÁu…s
 (
pdesc
Ë&& 
	`pdçp_is_visibÀ_no_°™d¨d
(pdesc);

311 
	}
}

314 
	$¥›_dülog_fûl
(
Pr›Dülog
 *
dülog
, 
GLi°
 *
obje˘s
, 
gboﬁón
 
is_deÁu…
)

316 c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
;

317 
GPåAºay
 *
¥›s
;

319 
	`g_ªtu∫_if_Áû
(
	`obje˘s_com∂y_wôh_°d¥›
(
obje˘s
));

321 
dülog
->
obje˘s
 = 
	`g_li°_c›y
(objects);

322 
dülog
->
c›õs
 = 
	`obje˘_c›y_li°
(
obje˘s
);

324 
pdesc
 = 
	`obje˘_li°_gë_¥›_des¸ùti⁄s
(
obje˘s
, 
PROP_UNION
);

325 i‡(!
pdesc
) ;

327 i‡(
is_deÁu…
)

328 
¥›s
 = 
	`¥›_li°_‰om_descs
(
pdesc
,
pdçp_is_visibÀ_deÁu…
);

330 
¥›s
 = 
	`¥›_li°_‰om_descs
(
pdesc
,
pdçp_is_visibÀ
);

332 i‡(!
¥›s
) ;

334 
dülog
->
¥›s
 =Örops;

335 
	`obje˘_li°_gë_¥›s
(
obje˘s
, 
¥›s
);

337 
	`¥›_dülog_add_¥›îtõs
(
dülog
, 
¥›s
);

338 
	}
}

	@O:\tool\dvs50\lib\properties.c

27 #ifde‡
HAVE_CONFIG_H


28 
	~<c⁄fig.h
>

31 
	~"geomëry.h
"

32 #i‚de‡
LIBDIA_COMPILATION


33 
	#LIBDIA_COMPILATION


	)

35 #unde‡
G_INLINE_FUNC


36 
	#G_INLINE_FUNC
 

	)

37 
	#G_CAN_INLINE
 1

	)

38 
	~"¥›îtõs.h
"

39 
	~"¥›öã∫Æs.h
"

44 
	$°d¥›s_öô
()

46 
	`¥›_basic_ªgi°î
();

47 
	`¥›_öây≥s_ªgi°î
();

48 
	`¥›_geomty≥s_ªgi°î
();

49 
	`¥›_©å_ªgi°î
();

50 
	`¥›_ãxt_ªgi°î
();

51 
	`¥›_widgës_ªgi°î
();

52 
	`¥›_sd¨øy_ªgi°î
();

53 
	`¥›_di˘ty≥s_ªgi°î
();

54 
	}
}

58 #ifde‡
G_OS_WIN32


62 
Pr›NumD©a
 
¥›_°d_löe_width_d©a
 = { 0.0, 10.0, 0.01 };

63 
Pr›NumD©a
 
	g¥›_°d_ãxt_height_d©a
 = { 0.1, 10.0, 0.1 };

64 
Pr›EnumD©a
 
	g¥›_°d_ãxt_Æign_d©a
[] = {

65 { 
N_
("Le·"), 
ALIGN_LEFT
 },

66 { 
N_
("Cíãr"), 
ALIGN_CENTER
 },

67 { 
N_
("Right"), 
ALIGN_RIGHT
 },

68 { 
NULL
, 0 }

72 #ifde‡
FOR_TRANSLATORS_ONLY


73 *
	gli°
 [] = {

74 
N_
("Line color"),

75 
N_
("Line style"),

76 
N_
("Fill color"),

77 
N_
("Draw background"),

78 
N_
("Startárrow"),

79 
N_
("Endárrow"),

80 
N_
("Text"),

81 
N_
("Textálignment"),

82 
N_
("Font"),

83 
N_
("Font size"),

84 
N_
("Text color")

	@O:\tool\dvs50\lib\properties.h

24 #i‚de‡
LIB_PROPERTIES_H


25 
	#LIB_PROPERTIES_H


	)

27 #i‚de‡
WIDGET


28 #ifde‡
GTK_WIDGET


29 
	#WIDGET
 
GtkWidgë


	)

31 
	#WIDGET
 

	)

36 #ifde‡
HAVE_STDDEF_H


37 
	~<°ddef.h
>

40 
	~<glib.h
>

41 
	~"düty≥s.h
"

43 
	~"geomëry.h
"

44 
	~"¨rows.h
"

45 
	~"cﬁ‹.h
"

46 
	~"f⁄t.h
"

47 
	~"dü_xml.h
"

48 
	~"öé.h
"

49 
	~"ãxèâr.h
"

51 
G_BEGIN_DECLS


53 
	$gboﬁón
 (*
	tPr›DescToPr›Pªdiˇã
)(c⁄° 
	tPr›Des¸ùti⁄
 *
	tpdesc
);

55 
	s_Pr›WidgëAssoc
 {

56 
Pr›îty
 *
¥›
;

57 
WIDGET
 *
widgë
;

60 
	s_Pr›Dülog
 {

61 
WIDGET
 *
widgë
;

63 
GPåAºay
 *
¥›s
;

64 
GAºay
 *
¥›_widgës
;

67 
GLi°
 *
obje˘s
;

68 
GLi°
 *
c›õs
;

70 
GPåAºay
 *
c⁄èöîs
;

71 
WIDGET
 *
œ°c⁄t
;

72 
WIDGET
 *
cuπabÀ
;

73 
guöt
 
cuºow
;

76 
	s_Pr›EvítD©a
 {

77 
Pr›Dülog
 *
dülog
;

78 
guöt
 
my_ödex
;

79 
WIDGET
 *
widgë
;

80 
Pr›îty
 *
£lf
;

83 
	$gboﬁón
 (*
	tPr›EvítH™dÀr
Ë(
	tDüObje˘
 *
	tobj
, 
	tPr›îty
 *
	t¥›
);

85 
	s_Pr›EvítH™dÀrChaö
 {

86 
Pr›EvítH™dÀr
 
h™dÀr
;

87 
Pr›EvítH™dÀrChaö
 *
chaö
;

93 
Pr›îty
 * (*
	tPr›îtyTy≥_New
Ë(c⁄° 
	tPr›Des¸ùti⁄
 *
	tpdesc
,

94 
	tPr›DescToPr›Pªdiˇã
 
	tªas⁄
);

96 (* 
	tPr›îtyTy≥_Fªe
)(
	tPr›îty
 *
	t¥›
);

98 
Pr›îty
 *(* 
	tPr›îtyTy≥_C›y
)(
	tPr›îty
 *
	t§c
);

101 
WIDGET
 *(* 
	tPr›îtyTy≥_GëWidgë
)(
	tPr›îty
 *
	t¥›
,

102 
	tPr›Dülog
 *
	tdülog
);

105 (* 
	tPr›îtyTy≥_Re£tWidgë
)(c⁄° 
	tPr›îty
 *
	t¥›
, 
	tWIDGET
 *
	twidgë
);

107 (* 
	tPr›îtyTy≥_SëFromWidgë
)(
	tPr›îty
 *
	t¥›
, 
	tWIDGET
 *
	twidgë
);

109 (*
	tPr›îtyTy≥_Lﬂd
)(
	tPr›îty
 *
	t¥›
, 
	tAâribuãNode
 
	t©å
, 
	tD©aNode
 
	td©a
);

110 (*
	tPr›îtyTy≥_Save
)(
	tPr›îty
 *
	t¥›
, 
	tAâribuãNode
 
	t©å
);

114 
	$gboﬁón
 (*
	tPr›îtyTy≥_C™Mîge
)(c⁄° 
	tPr›Des¸ùti⁄
 *
	tpd1
,c⁄° Pr›Des¸ùti⁄ *
	tpd2
);

115 (*
	tPr›îtyTy≥_GëFromOff£t
)(c⁄° 
	tPr›îty
 *
	t¥›
,

116 *
	tba£
, 
	tguöt
 
	toff£t
, guöà
	toff£t2
);

117 (*
	tPr›îtyTy≥_SëFromOff£t
)(
	tPr›îty
 *
	t¥›
,

118 *
	tba£
, 
	tguöt
 
	toff£t
, guöà
	toff£t2
);

119 (*
	tPr›îtyTy≥_GëD©aSize
)(
	tPr›îty
 *
	t¥›
);

122 
	s_Pr›îtyOps
 {

123 
Pr›îtyTy≥_New
 
√w_¥›
;

124 
Pr›îtyTy≥_Fªe
 
‰ì
;

125 
Pr›îtyTy≥_C›y
 
c›y
;

126 
Pr›îtyTy≥_Lﬂd
 
lﬂd
;

127 
Pr›îtyTy≥_Save
 
ßve
;

128 
Pr›îtyTy≥_GëWidgë
 
gë_widgë
;

129 
Pr›îtyTy≥_Re£tWidgë
 
ª£t_widgë
;

130 
Pr›îtyTy≥_SëFromWidgë
 
£t_‰om_widgë
;

132 
Pr›îtyTy≥_C™Mîge
 
ˇn_mîge
;

134 
Pr›îtyTy≥_GëFromOff£t
 
gë_‰om_off£t
;

135 
Pr›îtyTy≥_SëFromOff£t
 
£t_‰om_off£t
;

136 
Pr›îtyTy≥_GëD©aSize
 
gë_d©a_size
;

139 c⁄° 
	tgch¨
 *
	tPr›îtyTy≥
;

142 
	#PROP_TYPE_INVALID
 "övÆid"

	)

143 
	#PROP_TYPE_NOOP
 "no›"

	)

144 
	#PROP_TYPE_UNIMPLEMENTED
 "unim∂emíãd"

	)

147 
	#PROP_TYPE_CHAR
 "ch¨"

	)

148 
	#PROP_TYPE_BOOL
 "boﬁ"

	)

149 
	#PROP_TYPE_INT
 "öt"

	)

150 
	#PROP_TYPE_INTARRAY
 "öèºay"

	)

151 
	#PROP_TYPE_ENUM
 "íum"

	)

152 
	#PROP_TYPE_ENUMARRAY
 "íum¨øy"

	)

155 
	#PROP_TYPE_MULTISTRING
 "mu…i°rög"

	)

157 
	#PROP_TYPE_STRING
 "°rög"

	)

158 
	#PROP_TYPE_FILE
 "fûe"

	)

159 
	#PROP_TYPE_TEXT
 "ãxt"

	)

160 
	#PROP_TYPE_STRINGLIST
 "°rögli°"

	)

163 
	#PROP_TYPE_REAL
 "ªÆ"

	)

164 
	#PROP_TYPE_LENGTH
 "Àngth"

	)

165 
	#PROP_TYPE_FONTSIZE
 "f⁄tsize"

	)

166 
	#PROP_TYPE_POINT
 "poöt"

	)

167 
	#PROP_TYPE_POINTARRAY
 "poöèºay"

	)

168 
	#PROP_TYPE_BEZPOINT
 "bezpoöt"

	)

169 
	#PROP_TYPE_BEZPOINTARRAY
 "bezpoöèºay"

	)

170 
	#PROP_TYPE_RECT
 "ª˘"

	)

171 
	#PROP_TYPE_ENDPOINTS
 "ídpoöts"

	)

172 
	#PROP_TYPE_CONNPOINT_LINE
 "c⁄≈oöt_löe"

	)

175 
	#PROP_TYPE_LINESTYLE
 "löe°yÀ"

	)

176 
	#PROP_TYPE_ARROW
 "¨row"

	)

177 
	#PROP_TYPE_COLOUR
 "cﬁour"

	)

178 
	#PROP_TYPE_FONT
 "f⁄t"

	)

181 
	#PROP_TYPE_STATIC
 "°©ic"

	)

183 
	#PROP_TYPE_BUTTON
 "buâ⁄"

	)

185 
	#PROP_TYPE_NOTEBOOK_BEGIN
 "nb_begö"

	)

186 
	#PROP_TYPE_NOTEBOOK_END
 "nb_íd"

	)

187 
	#PROP_TYPE_NOTEBOOK_PAGE
 "nb_∑ge"

	)

188 
	#PROP_TYPE_MULTICOL_BEGIN
 "mc_begö"

	)

189 
	#PROP_TYPE_MULTICOL_END
 "mc_íd"

	)

190 
	#PROP_TYPE_MULTICOL_COLUMN
 "mc_cﬁ"

	)

191 
	#PROP_TYPE_FRAME_BEGIN
 "f_begö"

	)

192 
	#PROP_TYPE_FRAME_END
 "f_íd"

	)

193 
	#PROP_TYPE_LIST
 "li°"

	)

198 
	#PROP_TYPE_SARRAY
 "ßºay"

	)

199 
	#PROP_TYPE_DARRAY
 "d¨øy"

	)

200 
	#PROP_TYPE_DICT
 "di˘"

	)

204 
	s_Pr›Des¸ùti⁄
 {

205 c⁄° 
gch¨
 *
«me
;

206 
Pr›îtyTy≥
 
ty≥
;

207 
guöt
 
Êags
;

208 c⁄° 
gch¨
 *
des¸ùti⁄
;

209 c⁄° 
gch¨
 *
toﬁtù
;

214 
gpoöãr
 
exåa_d©a
;

221 
Pr›EvítH™dÀr
 
evít_h™dÀr
;

223 
GQu¨k
 
qu¨k
;

224 
GQu¨k
 
ty≥_qu¨k
;

227 
Pr›EvítH™dÀrChaö
 
chaö_h™dÀr
;

229 c⁄° 
Pr›îtyOps
 *
›s
;

232 
	#PROP_FLAG_VISIBLE
 0x0001

	)

233 
	#PROP_FLAG_DONT_SAVE
 0x0002

	)

234 
	#PROP_FLAG_DONT_MERGE
 0x0004

	)

235 
	#PROP_FLAG_NO_DEFAULTS
 0x0008

	)

236 
	#PROP_FLAG_LOAD_ONLY
 0x0010

	)

237 
	#PROP_FLAG_STANDARD
 0x0020

	)

238 
	#PROP_FLAG_MULTIVALUE
 0x0040

	)

239 
	#PROP_FLAG_WIDGET_ONLY
 0x0080

	)

240 
	#PROP_FLAG_OPTIONAL
 0x0100

	)

242 íum {
PROP_UNION
, 
PROP_INTERSECTION
} 
	tPr›MîgeO±i⁄
;

244 
	#PROP_DESC_END
 { 
NULL
, 0, 0, NULL, NULL, NULL, 0 
	}

	)
}

247 
	s_Pr›NumD©a
 {

248 
gÊﬂt
 
	mmö
, 
	mmax
, 
	m°ï
;

250 
	s_Pr›EnumD©a
 {

251 c⁄° 
gch¨
 *
	m«me
;

252 
guöt
 
	míumv
;

255 
	$gpoöãr
 (*
	tNewRec‹dFunc
)();

256 (*
	tFªeRec‹dFunc
)(
	tgpoöãr
 
	tªc
);

258 
	s_Pr›DescComm⁄AºayExåa
 {

260 
Pr›Des¸ùti⁄
 *
ªc‹d
;

261 
Pr›Off£t
 *
off£ts
;

262 c⁄° 
gch¨
 *
composôe_ty≥
;

265 
	s_Pr›DescDAºayExåa
 {

266 
Pr›DescComm⁄AºayExåa
 
comm⁄
;

267 
NewRec‹dFunc
 
√wªc
;

268 
FªeRec‹dFunc
 
‰ìªc
;

271 
	s_Pr›DescSAºayExåa
 {

272 
Pr›DescComm⁄AºayExåa
 
comm⁄
;

273 
guöt
 
ñemít_size
;

274 
guöt
 
¨øy_Àn
;

281 
	s_Pr›îty
 {

282 c⁄° 
gch¨
 *
«me
;

283 
GQu¨k
 
«me_qu¨k
;

284 
Pr›îtyTy≥
 
ty≥
;

285 
GQu¨k
 
ty≥_qu¨k
;

286 c⁄° 
Pr›Des¸ùti⁄
 *
des¸
;

287 
gpoöãr
 
exåa_d©a
;

288 
Pr›EvítD©a
 
£lf
;

289 
Pr›EvítH™dÀr
 
evít_h™dÀr
;

290 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
;

292 
guöt
 
ex≥rõn˚
;

294 c⁄° 
Pr›îtyOps
 *
›s
;

295 c⁄° 
Pr›îtyOps
 *
ªÆ_›s
;

299 
	#PXP_COPIED
 0x00000001

	)

300 
	#PXP_COPY
 0x00000002

	)

301 
	#PXP_GET_WIDGET
 0x00000004

	)

302 
	#PXP_RESET_WIDGET
 0x00000008

	)

303 
	#PXP_SET_FROM_WIDGET
 0x00000010

	)

304 
	#PXP_LOADED
 0x00000020

	)

305 
	#PXP_SAVED
 0x00000040

	)

306 
	#PXP_GFO
 0x00000080

	)

307 
	#PXP_SFO
 0x00000100

	)

308 
	#PXP_NOTSET
 0x00000200

	)

309 
	#PXP_SHAMELESS
 0xFFFFFFFF

	)

314 
DIAVAR
 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
Pr›Des¸ùti⁄
 *
∂i°
);

316 
DIAVAR
 c⁄° 
Pr›Des¸ùti⁄
 *
	`¥›_desc_li°_föd_¥›
(c⁄° Pr›Des¸ùti⁄ *
∂i°
,

317 c⁄° 
gch¨
 *
«me
);

319 
DIAVAR
 
Pr›EvítH™dÀr
 
	`¥›_desc_föd_ªÆ_h™dÀr
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

321 
DIAVAR
 
	`¥›_desc_‰ì_h™dÀr_chaö
(
Pr›Des¸ùti⁄
 *
pdesc
);

323 
DIAVAR
 
	`¥›_desc_li°_‰ì_h™dÀr_chaö
(
Pr›Des¸ùti⁄
 *
pdesc
);

325 
DIAVAR
 
	`¥›_desc_ö£π_h™dÀr
(
Pr›Des¸ùti⁄
 *
pdesc
,

326 
Pr›EvítH™dÀr
 
h™dÀr
);

329 
DIAVAR
 
Pr›Des¸ùti⁄
 *
	`¥›_desc_li°s_uni⁄
(
GLi°
 *
∂i°s
);

330 
DIAVAR
 
Pr›Des¸ùti⁄
 *
	`¥›_desc_li°s_öãr£˘i⁄
(
GLi°
 *
∂i°s
);

335 
	`¥›_ty≥_ªgi°î
(
Pr›îtyTy≥
 
ty≥
, c⁄° 
Pr›îtyOps
 *
›s
);

336 c⁄° 
Pr›îtyOps
 *
	`¥›_ty≥_gë_›s
(
Pr›îtyTy≥
 
ty≥
);

341 
DIAVAR
 
	`¥›_li°_‰ì
(
GPåAºay
 *
∂i°
);

345 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_c›y
(GPåAºay *
∂i°
);

347 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_c›y_em±y
(GPåAºay *
∂i°
);

349 
DIAVAR
 
	`¥›_li°_add_li°
 (
GPåAºay
 *
¥›s
, c⁄° GPåAºay *
±ﬂdd
);

351 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_‰om_descs
(c⁄° 
Pr›Des¸ùti⁄
 *
∂i°
,

352 
Pr›DescToPr›Pªdiˇã
 
¥ed
);

354 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_‰om_sögÀ
(
Pr›îty
 *
¥›
);

357 
DIAVAR
 
gboﬁón
 
	`pdçp_åue
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

358 
DIAVAR
 
gboﬁón
 
	`pdçp_is_visibÀ
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

359 
gboﬁón
 
	`pdçp_is_visibÀ_no_°™d¨d
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

360 
gboﬁón
 
	`pdçp_is_nŸ_visibÀ
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

361 
gboﬁón
 
	`pdçp_do_ßve
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

362 
gboﬁón
 
	`pdçp_do_ßve_no_°™d¨d
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

363 
gboﬁón
 
	`pdçp_do_lﬂd
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

364 
gboﬁón
 
	`pdçp_do_nŸ_ßve
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

366 
gboﬁón
 
	`pdçp_deÁu…s
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

368 
gboﬁón
 
	`pdçp_sy¡hëic
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

369 
gboﬁón
 
	`pdçp_‰om_obje˘
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

377 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_of_sögÀ
(
Pr›îty
 *
¥›
);

382 
DIAVAR
 
Pr›îty
 *
	`make_√w_¥›
(c⁄° *
«me
, 
Pr›îtyTy≥
 
ty≥
, 
guöt
 
Êags
);

389 #i‚de‡
off£tof


390 
	#off£tof
(
ty≥
, 
membî
Ë–(Ë& (—y≥*)0Ë-> membî )

	)

392 
	s_Pr›Off£t
 {

393 c⁄° 
gch¨
 *
«me
;

394 
Pr›îtyTy≥
 
ty≥
;

395 
off£t
;

396 
off£t2
;

397 
GQu¨k
 
«me_qu¨k
;

398 
GQu¨k
 
ty≥_qu¨k
;

399 c⁄° 
Pr›îtyOps
 *
›s
;

407 
gboﬁón
 
	`obje˘_com∂õs_wôh_°d¥›
(c⁄° 
DüObje˘
 *
obj
);

408 
gboﬁón
 
	`obje˘s_com∂y_wôh_°d¥›
(
GLi°
 *
obje˘s
);

410 
	`obje˘_li°_gë_¥›s
(
GLi°
 *
obje˘s
, 
GPåAºay
 *
¥›s
);

414 
DIAVAR
 c⁄° 
Pr›Des¸ùti⁄
 *
	`obje˘_gë_¥›_des¸ùti⁄s
(c⁄° 
DüObje˘
 *
obj
);

415 c⁄° 
Pr›Des¸ùti⁄
 *
	`obje˘_li°_gë_¥›_des¸ùti⁄s
(
GLi°
 *
obje˘s
,

416 
Pr›MîgeO±i⁄
 
›ti⁄
);

418 
DIAVAR
 
gboﬁón
 
	`obje˘_gë_¥›s_‰om_off£ts
(
DüObje˘
 *
obj
, 
Pr›Off£t
 *
off£ts
,

419 
GPåAºay
 *
¥›s
);

420 
DIAVAR
 
gboﬁón
 
	`obje˘_£t_¥›s_‰om_off£ts
(
DüObje˘
 *
obj
, 
Pr›Off£t
 *
off£ts
,

421 
GPåAºay
 *
¥›s
);

424 
DIAVAR
 
Obje˘Ch™ge
 *
	`obje˘_≠∂y_¥›s
(
DüObje˘
 *
obj
, 
GPåAºay
 *
¥›s
);

430 
DIAVAR
 
WIDGET
 *
	`obje˘_¸óã_¥›s_dülog
 (
DüObje˘
 *
obj
, 
gboﬁón
 
is_deÁu…
);

431 
DIAVAR
 
WIDGET
 *
	`obje˘_li°_¸óã_¥›s_dülog
(
GLi°
 *
obj
, 
gboﬁón
 
is_deÁu…
);

432 
DIAVAR
 
Obje˘Ch™ge
 *
	`obje˘_≠∂y_¥›s_‰om_dülog
 (
DüObje˘
 *
obj
, 
WIDGET
 *
dülog
);

438 
DIAVAR
 
Pr›îty
 *
	`obje˘_¥›_by_«me
(
DüObje˘
 *
obj
, c⁄° *
«me
);

439 
DIAVAR
 
Pr›îty
 *
	`obje˘_¥›_by_«me_ty≥
(
DüObje˘
 *
obj
, c⁄° *
«me
, c⁄° *
ty≥
);

442 
DIAVAR
 
	`obje˘_lﬂd_¥›s
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
);

443 
DIAVAR
 
	`obje˘_ßve_¥›s
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
);

447 
DIAVAR
 
	`obje˘_c›y_¥›s
(
DüObje˘
 *
de°
, c⁄° DüObje˘ *
§c
,

448 
gboﬁón
 
is_deÁu…
);

451 
DIAVAR
 
Pr›îty
 *
	`obje˘_gë_¥›_by_«me
 (
DüObje˘
 *
obj
, c⁄° * 
«me
);

455 
	`°d¥›s_öô
();

473 #ifde‡
G_OS_WIN32


474 
Pr›NumD©a
 
¥›_°d_löe_width_d©a
 = { 0.0f, 10.0f, 0.01‡
	}
};

475 
Pr›NumD©a
 
	g¥›_°d_ãxt_height_d©a
 = { 0.1f, 10.0f, 0.1f };

476 
Pr›EnumD©a
 
	g¥›_°d_ãxt_Æign_d©a
[] = {

477 { 
N_
("Le·"), 
ALIGN_LEFT
 },

478 { 
N_
("Cíãr"), 
ALIGN_CENTER
 },

479 { 
N_
("Right"), 
ALIGN_RIGHT
 },

480 { 
NULL
, 0 }

483 
Pr›NumD©a
 
¥›_°d_löe_width_d©a
, 
¥›_°d_ãxt_height_d©a
;

484 
Pr›EnumD©a
 
¥›_°d_ãxt_Æign_d©a
[];

487 
	#PROP_STDNAME_LINE_WIDTH
 "löe_width"

	)

488 
	#PROP_STDTYPE_LINE_WIDTH
 
PROP_TYPE_LENGTH


	)

489 
	#PROP_STD_LINE_WIDTH
 \

490 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

491 
	`N_
("Löêwidth"), 
NULL
, &
¥›_°d_löe_width_d©a
 }

	)

492 
	#PROP_STD_LINE_WIDTH_OPTIONAL
 \

493 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

494 
	`N_
("Löêwidth"), 
NULL
, &
¥›_°d_löe_width_d©a
 }

	)

495 
	#PROP_STD_LINE_COLOUR
 \

496 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

497 
	`N_
("Löêcﬁ‹"), 
NULL
, NULL }

	)

498 
	#PROP_STD_LINE_COLOUR_OPTIONAL
 \

499 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

500 
	`N_
("Löêcﬁ‹"), 
NULL
, NULL }

	)

501 
	#PROP_STD_LINE_STYLE
 \

502 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

503 
	`N_
("Löê°yÀ"), 
NULL
, NULL }

	)

504 
	#PROP_STD_LINE_STYLE_OPTIONAL
 \

505 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

506 
	`N_
("Löê°yÀ"), 
NULL
, NULL }

	)

508 
	#PROP_STD_FILL_COLOUR
 \

509 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

510 
	`N_
("Fû»cﬁ‹"), 
NULL
, NULL }

	)

511 
	#PROP_STD_FILL_COLOUR_OPTIONAL
 \

512 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

513 
	`N_
("Fû»cﬁ‹"), 
NULL
, NULL }

	)

514 
	#PROP_STD_SHOW_BACKGROUND
 \

515 { "show_background", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
, \

516 
	`N_
("Døw background"), 
NULL
, NULL }

	)

517 
	#PROP_STD_SHOW_BACKGROUND_OPTIONAL
 \

518 { "show_background", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_OPTIONAL
, \

519 
	`N_
("Døw background"), 
NULL
, NULL }

	)

521 
	#PROP_STD_START_ARROW
 \

522 { "°¨t_¨row", 
PROP_TYPE_ARROW
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

523 
	`N_
("Sèπáºow"), 
NULL
, NULL }

	)

524 
	#PROP_STD_END_ARROW
 \

525 { "íd_¨row", 
PROP_TYPE_ARROW
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

526 
	`N_
("Endáºow"), 
NULL
, NULL }

	)

528 
	#PROP_STD_TEXT_OPTIONS
(
›ti⁄s
) \

529 { "ãxt", 
PROP_TYPE_TEXT
, (
›ti⁄s
), \

530 
	`N_
("Text"), 
NULL
, NULL }

	)

531 
	#PROP_STD_TEXT
 
	`PROP_STD_TEXT_OPTIONS
(
PROP_FLAG_DONT_SAVE
)

	)

532 
	#PROP_STD_SAVED_TEXT
 
	`PROP_STD_TEXT_OPTIONS
(0)

	)

534 
	#PROP_STD_TEXT_ALIGNMENT_OPTIONS
(
›ti⁄s
) \

535 { "ãxt_Æignmít", 
PROP_TYPE_ENUM
, (
›ti⁄s
), \

536 
	`N_
("TexàÆignmít"), 
NULL
, 
¥›_°d_ãxt_Æign_d©a
 }

	)

537 
	#PROP_STD_TEXT_ALIGNMENT
 \

538 
	`PROP_STD_TEXT_ALIGNMENT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

540 
	#PROP_STD_TEXT_FONT_OPTIONS
(
›ti⁄s
) \

541 { "ãxt_f⁄t", 
PROP_TYPE_FONT
, (
›ti⁄s
), 
	`N_
("F⁄t"), 
NULL
, NULL }

	)

542 
	#PROP_STD_TEXT_FONT
 \

543 
	`PROP_STD_TEXT_FONT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

545 
	#PROP_STDNAME_TEXT_HEIGHT
 "ãxt_height"

	)

546 
	#PROP_STDTYPE_TEXT_HEIGHT
 
PROP_TYPE_FONTSIZE


	)

547 
	#PROP_STD_TEXT_HEIGHT_OPTIONS
(
›ti⁄s
) \

548 { 
PROP_STDNAME_TEXT_HEIGHT
, 
PROP_STDTYPE_TEXT_HEIGHT
, (
›ti⁄s
), \

549 
	`N_
("F⁄àsize"), 
NULL
, &
¥›_°d_ãxt_height_d©a
 }

	)

550 
	#PROP_STD_TEXT_HEIGHT
 \

551 
	`PROP_STD_TEXT_HEIGHT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

553 
	#PROP_STD_TEXT_COLOUR_OPTIONS
(
›ti⁄s
) \

554 { "ãxt_cﬁour", 
PROP_TYPE_COLOUR
, (
›ti⁄s
), \

555 
	`N_
("Texàcﬁ‹"), 
NULL
, NULL }

	)

556 
	#PROP_STD_TEXT_COLOUR
 \

557 
	`PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_STANDARD
)

	)

558 
	#PROP_STD_TEXT_COLOUR_OPTIONAL
 \

559 
	`PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
)

	)

562 
	#PROP_NOTEBOOK_BEGIN
(
«me
) \

563 { "nbook_" 
«me
, 
PROP_TYPE_NOTEBOOK_BEGIN
, \

564 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
, 
NULL
, NULL}

	)

565 
	#PROP_STD_NOTEBOOK_BEGIN
 
	`PROP_NOTEBOOK_BEGIN
("°d")

	)

566 
	#PROP_OFFSET_NOTEBOOK_BEGIN
(
«me
) \

567 { "nbook_" 
«me
, 
PROP_TYPE_NOTEBOOK_BEGIN
, 0}

	)

568 
	#PROP_OFFSET_STD_NOTEBOOK_BEGIN
 
	`PROP_OFFSET_NOTEBOOK_BEGIN
("°d")

	)

570 
	#PROP_NOTEBOOK_END
(
«me
) \

571 { "nbook_" 
«me
 "_íd", 
PROP_TYPE_NOTEBOOK_END
, \

572 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
, 
NULL
, NULL}

	)

573 
	#PROP_STD_NOTEBOOK_END
 
	`PROP_NOTEBOOK_END
("°d")

	)

574 
	#PROP_OFFSET_NOTEBOOK_END
(
«me
) \

575 { "nbook_" 
«me
 "_íd", 
PROP_TYPE_NOTEBOOK_END
, 0}

	)

576 
	#PROP_OFFSET_STD_NOTEBOOK_END
 
	`PROP_OFFSET_NOTEBOOK_END
("°d")

	)

578 
	#PROP_NOTEBOOK_PAGE
(
«me
,
Êags
,
des¸
) \

579 { "nbook_∑ge_" 
«me
, 
PROP_TYPE_NOTEBOOK_PAGE
, \

580 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
|
Êags
,
des¸
,
NULL
}

	)

581 
	#PROP_OFFSET_NOTEBOOK_PAGE
(
«me
) \

582 { "nbook_∑ge_" 
«me
 , 
PROP_TYPE_NOTEBOOK_PAGE
, 0}

	)

584 
	#PROP_MULTICOL_BEGIN
(
«me
) \

585 { "mcﬁ_" 
«me
, 
PROP_TYPE_MULTICOL_BEGIN
, \

586 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
, 
NULL
, NULL}

	)

587 
	#PROP_OFFSET_MULTICOL_BEGIN
(
«me
) \

588 { "mcﬁ_" 
«me
, 
PROP_TYPE_NOTEBOOK_BEGIN
, 0}

	)

590 
	#PROP_MULTICOL_END
(
«me
) \

591 { "mcﬁ_" 
«me
 "_íd", 
PROP_TYPE_MULTICOL_END
, \

592 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
, 
NULL
, NULL}

	)

593 
	#PROP_OFFSET_MULTICOL_END
(
«me
) \

594 { "mcﬁ_" 
«me
 "_íd", 
PROP_TYPE_MULTICOL_END
, 0}

	)

596 
	#PROP_MULTICOL_COLUMN
(
«me
) \

597 { "mcﬁ_cﬁ_" 
«me
, 
PROP_TYPE_MULTICOL_COLUMN
, \

598 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
,
NULL
,NULL}

	)

599 
	#PROP_OFFSET_MULTICOL_COLUMN
(
«me
) \

600 { "mcﬁ_cﬁ_" 
«me
, 
PROP_TYPE_MULTICOL_COLUMN
, 0}

	)

602 
	#PROP_FRAME_BEGIN
(
«me
,
Êags
,
des¸
) \

603 { "‰ame_" 
«me
, 
PROP_TYPE_FRAME_BEGIN
, \

604 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
Êags
, 
des¸
, 
NULL
}

	)

605 
	#PROP_OFFSET_FRAME_BEGIN
(
«me
) \

606 { "‰ame_" 
«me
, 
PROP_TYPE_FRAME_BEGIN
, 0}

	)

608 
	#PROP_FRAME_END
(
«me
,
Êags
) \

609 { "‰ame_" 
«me
 "_íd", 
PROP_TYPE_FRAME_END
, \

610 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
Êags
, 
NULL
, NULL}

	)

611 
	#PROP_OFFSET_FRAME_END
(
«me
) \

612 { "‰ame_" 
«me
 "_íd", 
PROP_TYPE_FRAME_END
, 0}

	)

614 
	gG_END_DECLS


	@O:\tool\dvs50\lib\propinternals.h

27 #i‚de‡
PROPINTERNALS_H


28 
	#PROPINTERNALS_H


	)

30 
	~<glib.h
>

32 
	~<gtk/gtk.h
>

33 
	~"¥›îtõs.h
"

37 
gboﬁón
 
¥›descs_ˇn_be_mîged
(c⁄° 
Pr›Des¸ùti⁄
 *
p1
,

38 c⁄° 
Pr›Des¸ùti⁄
 *
p2
);

41 
gboﬁón
 
¥›_li°_lﬂd
(
GPåAºay
 *
¥›s
, 
D©aNode
 
d©a
, 
GEº‹
 **
îr
);

42 
¥›_li°_ßve
(
GPåAºay
 *
¥›s
, 
D©aNode
 
d©a
);

44 
	#°ru˘_membî
(
•
, 
off
, 
ç
Ë(*—∞*)(((*)•Ë+ off))

	)

46 
DIAVAR
 
Pr›îty
 *
föd_¥›_by_«me
(c⁄° 
GPåAºay
 *
¥›s
, c⁄° 
gch¨
 *
«me
);

47 
Pr›îty
 *
föd_¥›_by_«me_™d_ty≥
(c⁄° 
GPåAºay
 *
¥›s
, c⁄° 
gch¨
 *
«me
,

48 
Pr›îtyTy≥
 
ty≥
);

55 
¥›_dülog_add_øw
(
Pr›Dülog
 *
dülog
, 
GtkWidgë
 *
widgë
);

56 
¥›_dülog_add_øw_wôh_Êags
(
Pr›Dülog
 *
dülog
, 
GtkWidgë
 *
widgë
,

57 
gboﬁón
 
ex∑nd
, gboﬁó¿
fûl
);

59 
¥›_dülog_c⁄èöî_push
(
Pr›Dülog
 *
dülog
, 
GtkWidgë
 *
c⁄èöî
);

61 
GtkWidgë
 *
¥›_dülog_c⁄èöî_p›
(
Pr›Dülog
 *
dülog
);

62 
¥›_dülog_add_¥›îty
(
Pr›Dülog
 *
dülog
, 
Pr›îty
 *
¥›
);

64 
Pr›Dülog
 *
¥›_dülog_√w
(
GLi°
 *
obje˘s
, 
gboﬁón
 
is_deÁu…
);

65 
DIAVAR
 
Pr›Dülog
 *
¥›_dülog_‰om_widgë
(
GtkWidgë
 *
dülog_widgë
);

66 
DIAVAR
 
¥›_dülog_de°roy
(
Pr›Dülog
 *
dülog
);

67 
DIAVAR
 
¥›_gë_d©a_‰om_widgës
(
Pr›Dülog
 *
dülog
);

68 
WIDGET
 *
¥›_dülog_gë_widgë
(c⁄° 
Pr›Dülog
 *
dülog
);

70 
¥›h™dÀr_c⁄√˘
(c⁄° 
Pr›îty
 *
¥›
, 
GObje˘
 *
obje˘
,

71 c⁄° 
gch¨
 *
sig«l
);

74 
DIAVAR
 
¥›_off£t_li°_ˇlcuœã_qu¨ks
(
Pr›Off£t
 *
off£ts
);

75 
do_£t_¥›s_‰om_off£ts
(*
ba£
, 
GPåAºay
 *
¥›s
,

76 c⁄° 
Pr›Off£t
 *
off£ts
);

77 
do_gë_¥›s_‰om_off£ts
(*
ba£
, 
GPåAºay
 *
¥›s
,

78 c⁄° 
Pr›Off£t
 *
off£ts
);

81 
	~"¥›_basic.h
"

82 
	~"¥›_öây≥s.h
"

83 
	~"¥›_geomty≥s.h
"

84 
	~"¥›_©å.h
"

85 
	~"¥›_ãxt.h
"

86 
	~"¥›_widgës.h
"

87 
	~"¥›_sd¨øy.h
"

88 
	~"¥›_di˘.h
"

	@O:\tool\dvs50\lib\proplist.c

26 #ifde‡
HAVE_CONFIG_H


27 
	~<c⁄fig.h
>

30 
	~"¥›îtõs.h
"

31 
	~"¥›öã∫Æs.h
"

32 
	~"dü_xml.h
"

33 
	~"düîr‹.h
"

39 
gboﬁón
 
	$pdçp_åue
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

40 {  
TRUE
; 
	}
}

41 
gboﬁón
 
	$pdçp_sy¡hëic
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

42 {  
TRUE
; 
	}
}

43 
gboﬁón
 
	$pdçp_‰om_obje˘
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

44 {  
TRUE
; 
	}
}

45 
gboﬁón
 
	$pdçp_is_visibÀ
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

46 {  (
pdesc
->
Êags
 & 
PROP_FLAG_VISIBLE
Ë!0; 
	}
}

47 
gboﬁón
 
	$pdçp_is_visibÀ_no_°™d¨d
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

48 {  (
pdesc
->
Êags
 & 
PROP_FLAG_VISIBLE
) != 0 &&

49 (
pdesc
->
Êags
 & 
PROP_FLAG_STANDARD
Ë=0; 
	}
}

50 
gboﬁón
 
	$pdçp_is_nŸ_visibÀ
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

51 {  (
pdesc
->
Êags
 & 
PROP_FLAG_VISIBLE
Ë=0; 
	}
}

52 
gboﬁón
 
	$pdçp_do_ßve
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

53 {  (
pdesc
->
Êags
 & (
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_LOAD_ONLY
)Ë=0; 
	}
}

54 
gboﬁón
 
	$pdçp_do_ßve_no_°™d¨d
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

55 {  (
pdesc
->
Êags
 & (
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_LOAD_ONLY
|
PROP_FLAG_STANDARD
)Ë=0; 
	}
}

56 
gboﬁón
 
	$pdçp_do_lﬂd
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

57 {  (((
pdesc
->
Êags
 & 
PROP_FLAG_DONT_SAVE
) == 0) ||

58 ((
pdesc
->
Êags
 & 
PROP_FLAG_LOAD_ONLY
Ë!0)); 
	}
}

59 
gboﬁón
 
	$pdçp_deÁu…s
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

60 {  (
pdesc
->
Êags
 & 
PROP_FLAG_NO_DEFAULTS
Ë=0; 
	}
}

61 
gboﬁón
 
	$pdçp_do_nŸ_ßve
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

62 {  (
pdesc
->
Êags
 & 
PROP_FLAG_DONT_SAVE
Ë!0; 
	}
}

64 
GPåAºay
 *

65 
	$¥›_li°_‰om_descs
(c⁄° 
Pr›Des¸ùti⁄
 *
∂i°
,

66 
Pr›DescToPr›Pªdiˇã
 
¥ed
)

68 
GPåAºay
 *
ªt
;

69 
guöt
 
cou¡
 = 0, 
i
;

71 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
((
Pr›Des¸ùti⁄
 *)
∂i°
);

73 
i
 = 0; 
∂i°
[i].
«me
 !
NULL
; i++)

74 i‡(
	`¥ed
(&
∂i°
[
i
])Ë
cou¡
++;

76 
ªt
 = 
	`g_±r_¨øy_√w
();

77 
	`g_±r_¨øy_£t_size
(
ªt
,
cou¡
);

79 
cou¡
 = 0;

80 
i
 = 0; 
∂i°
[i].
«me
 !
NULL
; i++) {

82 
	`g_mesßge
("aboutÅoáppendÖroperty %s/%sÅoÜist"

83 "¥ediˇã i†%†%d %d",
∂i°
[
i
].
ty≥
,∂i°[i].
«me
,

84 
	`¥ed
(&
∂i°
[
i
])?"TRUE":"FALSE",

85 
∂i°
[
i
].
Êags
,∂i°[i].Êag†& 
PROP_FLAG_DONT_SAVE
);

87 i‡(
	`¥ed
(&
∂i°
[
i
])) {

88 
Pr›îty
 *
¥›
 = 
∂i°
[
i
].
›s
->
	`√w_¥›
(&∂i°[i],
¥ed
);

89 
	`g_±r_¨øy_ödex
(
ªt
,
cou¡
++Ë
¥›
;

93  
ªt
;

94 
	}
}

97 
	$¥›_li°_‰ì
(
GPåAºay
 *
∂i°
)

99 
i
;

100 i‡(!
∂i°
) ;

102 
i
 = 0; i < 
∂i°
->
Àn
; i++) {

103 
Pr›îty
 *
¥›
 = 
	`g_±r_¨øy_ödex
(
∂i°
,
i
);

104 
¥›
->
›s
->
	`‰ì
(prop);

106 
	`g_±r_¨øy_‰ì
(
∂i°
,
TRUE
);

107 
	}
}

110 
GPåAºay
 *

111 
	$¥›_li°_c›y
(
GPåAºay
 *
§c
)

113 
i
;

114 
GPåAºay
 *
de°
;

116 
de°
 = 
	`g_±r_¨øy_√w
();

117 
	`g_±r_¨øy_£t_size
(
de°
, 
§c
->
Àn
);

119 
i
=0; i < 
§c
->
Àn
; i++) {

120 
Pr›îty
 *
p§c
 = 
	`g_±r_¨øy_ödex
(
§c
,
i
);

121 
Pr›îty
 *
pde°
 =Öde° = 
p§c
->
›s
->
	`c›y
(psrc);

122 
	`g_±r_¨øy_ödex
(
de°
,
i
Ë
pde°
;

124  
de°
;

125 
	}
}

128 
GPåAºay
 *

129 
	$¥›_li°_c›y_em±y
(
GPåAºay
 *
∂i°
)

131 
i
;

132 
GPåAºay
 *
de°
;

134 
de°
 = 
	`g_±r_¨øy_√w
();

135 
	`g_±r_¨øy_£t_size
(
de°
, 
∂i°
->
Àn
);

137 
i
=0; i < 
∂i°
->
Àn
; i++) {

138 
Pr›îty
 *
p§c
 = 
	`g_±r_¨øy_ödex
(
∂i°
,
i
);

139 
Pr›îty
 *
pde°
 = 
p§c
->
›s
->
	`√w_¥›
’§c->
des¸
,p§c->
ªas⁄
);

140 
	`g_±r_¨øy_ödex
(
de°
,
i
Ë
pde°
;

142  
de°
;

143 
	}
}

145 
gboﬁón


146 
	$¥›_li°_lﬂd
(
GPåAºay
 *
¥›s
, 
D©aNode
 
d©a
, 
GEº‹
 **
îr
)

148 
i
;

149 
gboﬁón
 
ªt
 = 
TRUE
;

151 
i
 = 0; i < 
¥›s
->
Àn
; i++) {

152 
Pr›îty
 *
¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,
i
);

153 
AâribuãNode
 
©å
 = 
	`obje˘_föd_©åibuã
(
d©a
, 
¥›
->
«me
);

154 
D©aNode
 
d©a
 = 
©å
 ? 
	`©åibuã_fú°_d©a
◊ârË: 
NULL
;

155 i‡((!
©å
 || !
d©a
Ë&& 
¥›
->
des¸
->
Êags
 & 
PROP_FLAG_OPTIONAL
) {

156 
¥›
->
ex≥rõn˚
 |
PXP_NOTSET
;

159 i‡((!
©å
Ë|| (!
d©a
)) {

160 i‡(
îr
 && !*err)

161 *
îr
 = 
	`g_îr‹_√w
 (
DIA_ERROR
,

162 
DIA_ERROR_FORMAT
,

163 
	`_
("Noáttribute '%s' (%p) orÇo data(%p) inÅhisáttribute"),

164 
¥›
->
«me
,
©å
,
d©a
);

165 
¥›
->
ex≥rõn˚
 |
PXP_NOTSET
;

166 
ªt
 = 
FALSE
;

169 
¥›
->
›s
->
	`lﬂd
’r›,
©å
,
d©a
);

171  
ªt
;

172 
	}
}

175 
	$¥›_li°_ßve
(
GPåAºay
 *
¥›s
, 
D©aNode
 
d©a
)

177 
i
;

178 
i
 = 0; i < 
¥›s
->
Àn
; i++) {

179 
Pr›îty
 *
¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,
i
);

180 
AâribuãNode
 
©å
 = 
	`√w_©åibuã
(
d©a
,
¥›
->
«me
);

181 
¥›
->
›s
->
	`ßve
’r›,
©å
);

183 
	}
}

185 
Pr›îty
 *

186 
	$föd_¥›_by_«me
(c⁄° 
GPåAºay
 *
¥›s
, c⁄° 
gch¨
 *
«me
)

188 
i
;

189 
GQu¨k
 
¥›_qu¨k
 = 
	`g_qu¨k_‰om_°rög
(
«me
);

191 
i
 = 0; i < 
¥›s
->
Àn
; i++) {

192 
Pr›îty
 *
¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,
i
);

193 i‡(
¥›
->
«me_qu¨k
 =
¥›_qu¨k
) Örop;

195  
NULL
;

196 
	}
}

198 
Pr›îty
 *

199 
	$föd_¥›_by_«me_™d_ty≥
(c⁄° 
GPåAºay
 *
¥›s
, c⁄° 
gch¨
 *
«me
,

200 
Pr›îtyTy≥
 
ty≥
)

202 
Pr›îty
 *
ªt
 = 
	`föd_¥›_by_«me
(
¥›s
,
«me
);

203 
GQu¨k
 
ty≥_qu¨k
 = 
	`g_qu¨k_‰om_°rög
(
ty≥
);

204 i‡(!
ªt
Ë 
NULL
;

205 i‡(
ty≥_qu¨k
 !
ªt
->ty≥_qu¨kË 
NULL
;

206  
ªt
;

207 
	}
}

210 
	$¥›_li°_add_li°
 (
GPåAºay
 *
¥›s
, c⁄° GPåAºay *
±ﬂdd
)

212 
guöt
 
i
;

213 
i
 = 0 ; i < 
±ﬂdd
->
Àn
; i++) {

214 
Pr›îty
 *
¥›
 = 
	`g_±r_¨øy_ödex
(
±ﬂdd
,
i
);

216 
	`g_±r_¨øy_add
(
¥›s
,
¥›
->
›s
->
	`c›y
(prop));

218 
	}
}

220 
GPåAºay
 *

221 
	$¥›_li°_‰om_sögÀ
(
Pr›îty
 *
¥›
) {

222 
GPåAºay
 *
∂i°
 = 
	`g_±r_¨øy_√w
();

223 
	`g_±r_¨øy_add
(
∂i°
,
¥›
);

224  
∂i°
;

225 
	}
}

	@O:\tool\dvs50\lib\propobject.c

30 #ifde‡
HAVE_CONFIG_H


31 
	~<c⁄fig.h
>

34 
	~<°rög.h
>

36 
	~<glib.h
>

37 
	~"¥›îtõs.h
"

38 
	~"¥›öã∫Æs.h
"

39 
	~"obje˘.h
"

41 c⁄° 
Pr›Des¸ùti⁄
 *

42 
	$obje˘_gë_¥›_des¸ùti⁄s
(c⁄° 
DüObje˘
 *
obj
) {

43 c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
;

44 i‡(!
obj
->
›s
->
des¸ibe_¥›s
Ë 
NULL
;

46 
pdesc
 = 
obj
->
›s
->
	`des¸ibe_¥›s
((
DüObje˘
 *)obj);

47 i‡(!
pdesc
Ë 
NULL
;

49 i‡(
pdesc
[0].
qu¨k
 != 0) Ödesc;

51 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
((
Pr›Des¸ùti⁄
 *)
pdesc
);

52  
pdesc
;

53 
	}
}

55 c⁄° 
Pr›Des¸ùti⁄
 *

56 
	$obje˘_li°_gë_¥›_des¸ùti⁄s
(
GLi°
 *
obje˘s
, 
Pr›MîgeO±i⁄
 
›ti⁄
)

58 
GLi°
 *
descs
 = 
NULL
, *
tmp
;

59 c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
;

61 
tmp
 = 
obje˘s
;Åm∞!
NULL
;Åm∞tmp->
√xt
) {

62 
DüObje˘
 *
obj
 = 
tmp
->
d©a
;

63 c⁄° 
Pr›Des¸ùti⁄
 *
desc
 = 
	`obje˘_gë_¥›_des¸ùti⁄s
(
obj
);

65 i‡(
desc
Ë
descs
 = 
	`g_li°_≠≥nd
(descs, (
gpoöãr
)desc);

70 i‡(
›ti⁄
 =
PROP_UNION
 && 
	`g_li°_Àngth
(
obje˘s
)!=1)

71 
pdesc
 = 
	`¥›_desc_li°s_uni⁄
(
descs
);

73 
pdesc
 = 
	`¥›_desc_li°s_öãr£˘i⁄
(
descs
);

77 
	`g_li°_‰ì
(
descs
);

79  
pdesc
;

80 
	}
}

87 
_Obje˘Pr›Ch™ge
 
	tObje˘Pr›Ch™ge
;

88 
	s_Obje˘Pr›Ch™ge
 {

89 
Obje˘Ch™ge
 
	mobj_ch™ge
;

91 
DüObje˘
 *
	mobj
;

92 
GPåAºay
 *
	mßved_¥›s
;

96 
	$obje˘_¥›_ch™ge_≠∂y_ªvît
(
Obje˘Pr›Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

98 
GPåAºay
 *
ﬁd_¥›s
;

100 
ﬁd_¥›s
 = 
	`¥›_li°_c›y_em±y
(
ch™ge
->
ßved_¥›s
);

102 i‡(
ch™ge
->
obj
->
›s
->
gë_¥›s
)

103 
ch™ge
->
obj
->
›s
->
	`gë_¥›s
(ch™ge->obj, 
ﬁd_¥›s
);

106 i‡(
ch™ge
->
obj
->
›s
->
£t_¥›s
)

107 
ch™ge
->
obj
->
›s
->
	`£t_¥›s
(ch™ge->obj, ch™ge->
ßved_¥›s
);

110 
	`¥›_li°_‰ì
(
ch™ge
->
ßved_¥›s
);

111 
ch™ge
->
ßved_¥›s
 = 
ﬁd_¥›s
;

112 
	}
}

115 
	$obje˘_¥›_ch™ge_‰ì
(
Obje˘Pr›Ch™ge
 *
ch™ge
)

117 
	`¥›_li°_‰ì
(
ch™ge
->
ßved_¥›s
);

118 
	}
}

120 
Obje˘Ch™ge
 *

121 
	$obje˘_≠∂y_¥›s
(
DüObje˘
 *
obj
, 
GPåAºay
 *
¥›s
)

123 
Obje˘Pr›Ch™ge
 *
ch™ge
;

124 
GPåAºay
 *
ﬁd_¥›s
;

126 
ch™ge
 = 
	`g_√w0
(
Obje˘Pr›Ch™ge
, 1);

128 
ch™ge
->
obj_ch™ge
.
≠∂y
 =

129 (
Obje˘Ch™geAµlyFunc
Ë
obje˘_¥›_ch™ge_≠∂y_ªvît
;

130 
ch™ge
->
obj_ch™ge
.
ªvît
 =

131 (
Obje˘Ch™geRevîtFunc
Ë
obje˘_¥›_ch™ge_≠∂y_ªvît
;

132 
ch™ge
->
obj_ch™ge
.
‰ì
 =

133 (
Obje˘Ch™geFªeFunc
Ë
obje˘_¥›_ch™ge_‰ì
;

135 
ch™ge
->
obj
 = obj;

138 
ﬁd_¥›s
 = 
	`¥›_li°_c›y_em±y
(
¥›s
);

140 i‡(
obj
->
›s
->
gë_¥›s
)

141 
obj
->
›s
->
	`gë_¥›s
(obj, 
ﬁd_¥›s
);

144 i‡(
obj
->
›s
->
£t_¥›s
)

145 
obj
->
›s
->
	`£t_¥›s
(obj, 
¥›s
);

147 
ch™ge
->
ßved_¥›s
 = 
ﬁd_¥›s
;

149  (
Obje˘Ch™ge
 *)
ch™ge
;

150 
	}
}

155 
gboﬁón


156 
	$obje˘_gë_¥›s_‰om_off£ts
(
DüObje˘
 *
obj
, 
Pr›Off£t
 *
off£ts
,

157 
GPåAºay
 *
¥›s
)

159 
	`¥›_off£t_li°_ˇlcuœã_qu¨ks
(
off£ts
);

160 
	`do_gë_¥›s_‰om_off£ts
(
obj
,
¥›s
,
off£ts
);

162  
TRUE
;

163 
	}
}

165 
gboﬁón


166 
	$obje˘_£t_¥›s_‰om_off£ts
(
DüObje˘
 *
obj
, 
Pr›Off£t
 *
off£ts
,

167 
GPåAºay
 *
¥›s
)

169 
	`¥›_off£t_li°_ˇlcuœã_qu¨ks
(
off£ts
);

170 
	`do_£t_¥›s_‰om_off£ts
(
obj
,
¥›s
,
off£ts
);

172  
TRUE
;

173 
	}
}

176 
WIDGET
 *

177 
	$obje˘_¸óã_¥›s_dülog
(
DüObje˘
 *
obj
, 
gboﬁón
 
is_deÁu…
)

179 
GLi°
 *
li°
 = 
NULL
;

180 
li°
 = 
	`g_li°_≠≥nd
÷i°, 
obj
);

181  
	`obje˘_li°_¸óã_¥›s_dülog
(
li°
, 
is_deÁu…
);

182 
	}
}

184 
WIDGET
 *

185 
	$obje˘_li°_¸óã_¥›s_dülog
(
GLi°
 *
obje˘s
, 
gboﬁón
 
is_deÁu…
)

187  
	`¥›_dülog_√w
(
obje˘s
, 
is_deÁu…
)->
widgë
;

188 
	}
}

191 
Obje˘Ch™ge
 *

192 
	$obje˘_≠∂y_¥›s_‰om_dülog
(
DüObje˘
 *
obj
, 
WIDGET
 *
dülog_widgë
)

194 
Pr›Dülog
 *
dülog
 = 
	`¥›_dülog_‰om_widgë
(
dülog_widgë
);

196 
	`¥›_gë_d©a_‰om_widgës
(
dülog
);

197 i‡(!
obj
->
›s
->
≠∂y_¥›îtõs_li°
) {

198 
	`g_w¨nög
("usingá fallback functionÅoápplyÖroperties;"

200  
	`obje˘_≠∂y_¥›s
(
obj
, 
dülog
->
¥›s
);

202  
obj
->
›s
->
	`≠∂y_¥›îtõs_li°
(obj, 
dülog
->
¥›s
);

203 
	}
}

205 
gboﬁón


206 
	$obje˘s_com∂y_wôh_°d¥›
(
GLi°
 *
obje˘s
)

208 
GLi°
 *
tmp
 = 
obje˘s
;

210 ; 
tmp
 !
NULL
;Åm∞tmp->
√xt
) {

211 c⁄° 
DüObje˘
 *
obj
 = (c⁄° DüObje˘*)
tmp
->
d©a
;

212 i‡(!
	`obje˘_com∂õs_wôh_°d¥›
(
obj
))

213  
FALSE
;

216  
TRUE
;

217 
	}
}

219 
gboﬁón


220 
	$obje˘_com∂õs_wôh_°d¥›
(c⁄° 
DüObje˘
 *
obj
)

222 i‡(
obj
->
›s
->
£t_¥›s
 =
NULL
) {

223 
	`g_w¨nög
("No set_props !");

224  
FALSE
;

226 i‡(
obj
->
›s
->
gë_¥›s
 =
NULL
) {

227 
	`g_w¨nög
("No get_props !");

228  
FALSE
;

230 i‡(
obj
->
›s
->
des¸ibe_¥›s
 =
NULL
) {

231 
	`g_w¨nög
("No describe_props !");

232  
FALSE
;

234 i‡(
	`obje˘_gë_¥›_des¸ùti⁄s
(
obj
Ë=
NULL
) {

235 
	`g_w¨nög
("NoÖroperties !");

236  
FALSE
;

238  
TRUE
;

239 
	}
}

242 
	$obje˘_li°_gë_¥›s
(
GLi°
 *
obje˘s
, 
GPåAºay
 *
¥›s
)

244 
GLi°
 *
tmp
 = 
obje˘s
;

246 ; 
tmp
 !
NULL
;Åm∞tmp->
√xt
) {

247 
DüObje˘
 *
obj
 = (DüObje˘*)
tmp
->
d©a
;

248 
obj
->
›s
->
	`gë_¥›s
(obj,
¥›s
);

250 
	}
}

252 
gboﬁón


253 
	$pdçp_do_ßve_no_°™d¨d_deÁu…
 (c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
)

255  
	`pdçp_do_ßve_no_°™d¨d
(
pdesc
Ë&& 
	`pdçp_deÁu…s
 (pdesc);

256 
	}
}

259 
	$obje˘_c›y_¥›s
(
DüObje˘
 *
de°
, c⁄° DüObje˘ *
§c
, 
gboﬁón
 
is_deÁu…
)

261 
GPåAºay
 *
¥›s
;

263 
	`g_ªtu∫_if_Áû
(
§c
 !
NULL
);

264 
	`g_ªtu∫_if_Áû
(
de°
 !
NULL
);

265 
	`g_ªtu∫_if_Áû
(
	`°rcmp
(
§c
->
ty≥
->
«me
,
de°
->type->name)==0);

266 
	`g_ªtu∫_if_Áû
(
§c
->
›s
 =
de°
->ops);

267 
	`g_ªtu∫_if_Áû
(
	`obje˘_com∂õs_wôh_°d¥›
(
§c
));

268 
	`g_ªtu∫_if_Áû
(
	`obje˘_com∂õs_wôh_°d¥›
(
de°
));

270 
¥›s
 = 
	`¥›_li°_‰om_descs
(
	`obje˘_gë_¥›_des¸ùti⁄s
(
§c
),

271 (
is_deÁu…
?
pdçp_do_ßve_no_°™d¨d_deÁu…
:

272 
pdçp_do_ßve
));

274 
§c
->
›s
->
	`gë_¥›s
((
DüObje˘
 *)§c, 
¥›s
);

277 
de°
->
›s
->
	`£t_¥›s
(de°, 
¥›s
);

279 
	`¥›_li°_‰ì
(
¥›s
);

280 
	}
}

283 
	$obje˘_lﬂd_¥›s
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
)

285 
GPåAºay
 *
¥›s
;

286 
GEº‹
 *
îr
 = 
NULL
;

288 
	`g_ªtu∫_if_Áû
(
obj
 !
NULL
);

289 
	`g_ªtu∫_if_Áû
(
obj_node
 !
NULL
);

290 
	`g_ªtu∫_if_Áû
(
	`obje˘_com∂õs_wôh_°d¥›
(
obj
));

292 
¥›s
 = 
	`¥›_li°_‰om_descs
(
	`obje˘_gë_¥›_des¸ùti⁄s
(
obj
),

293 
pdçp_do_lﬂd
);

295 i‡(!
	`¥›_li°_lﬂd
(
¥›s
,
obj_node
, &
îr
)) {

296 
	`g_w¨nög
 ("%s: %s", 
obj
->
ty≥
->
«me
, 
îr
->
mesßge
);

297 
	`g_îr‹_‰ì
(
îr
);

300 
obj
->
›s
->
	`£t_¥›s
(obj, 
¥›s
);

301 
	`¥›_li°_‰ì
(
¥›s
);

302 
	}
}

305 
	$obje˘_ßve_¥›s
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
)

307 
GPåAºay
 *
¥›s
;

309 
	`g_ªtu∫_if_Áû
(
obj
 !
NULL
);

310 
	`g_ªtu∫_if_Áû
(
obj_node
 !
NULL
);

311 
	`g_ªtu∫_if_Áû
(
	`obje˘_com∂õs_wôh_°d¥›
(
obj
));

313 
¥›s
 = 
	`¥›_li°_‰om_descs
(
	`obje˘_gë_¥›_des¸ùti⁄s
(
obj
),

314 
pdçp_do_ßve
);

316 
obj
->
›s
->
	`gë_¥›s
(obj, 
¥›s
);

317 
	`¥›_li°_ßve
(
¥›s
,
obj_node
);

318 
	`¥›_li°_‰ì
(
¥›s
);

319 
	}
}

321 
Pr›îty
 *

322 
	$obje˘_¥›_by_«me_ty≥
(
DüObje˘
 *
obj
, c⁄° *
«me
, c⁄° *
ty≥
)

324 c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
;

325 
GQu¨k
 
«me_qu¨k
 = 
	`g_qu¨k_‰om_°rög
(
«me
);

327 i‡(!
	`obje˘_com∂õs_wôh_°d¥›
(
obj
)Ë 
NULL
;

329 
pdesc
 = 
	`obje˘_gë_¥›_des¸ùti⁄s
(
obj
);

330 
pdesc
->
«me
 !
NULL
;

331 
pdesc
++) {

332 i‡((
pdesc
->
qu¨k
 =
«me_qu¨k
)) {

333 
Pr›îty
 *
¥›
;

334 
GPåAºay
 *
∂i°
 = 
NULL
;

336 i‡(
ty≥
 && (0 !
	`°rcmp
(
pdesc
->type,type))) ;

338 i‡(!
∂i°
) {

339 
∂i°
 = 
	`g_±r_¨øy_√w
();

340 
	`g_±r_¨øy_£t_size
(
∂i°
,1);

342 
¥›
 = 
pdesc
->
›s
->
	`√w_¥›
’desc,
pdçp_‰om_obje˘
);

343 
	`g_±r_¨øy_ödex
(
∂i°
,0Ë
¥›
;

344 
obj
->
›s
->
	`gë_¥›s
(obj,
∂i°
);

345  
¥›
;

348  
NULL
;

349 
	}
}

351 
Pr›îty
 *

352 
	$obje˘_¥›_by_«me
(
DüObje˘
 *
obj
, c⁄° *
«me
)

354  
	`obje˘_¥›_by_«me_ty≥
(
obj
,
«me
,
NULL
);

355 
	}
}

	@O:\tool\dvs50\lib\propoffsets.c

27 
	~<glib.h
>

28 
	~"¥›îtõs.h
"

29 
	~"¥›öã∫Æs.h
"

32 
	$do_£t_¥›s_‰om_off£ts
(*
ba£
,

33 
GPåAºay
 *
¥›s
, c⁄° 
Pr›Off£t
 *
off£ts
)

36 
guöt
 
i
;

38 
i
 = 0; i < 
¥›s
->
Àn
; i++) {

39 
Pr›îty
 *
¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,
i
);

40 c⁄° 
Pr›Off£t
 *
ofs
;

41 
ofs
 = 
off£ts
; ofs->
«me
 ; ofs++) {

42 i‡((
¥›
->
«me_qu¨k
 =
ofs
->name_quark) &&

43 (
¥›
->
ty≥_qu¨k
 =
ofs
->type_quark)) {

45 i‡((
¥›
->
ex≥rõn˚
 & 
PXP_NOTSET
) == 0)

46 
¥›
->
›s
->
	`£t_‰om_off£t
’r›,
ba£
,
ofs
->
off£t
,ofs->
off£t2
);

51 
	}
}

54 
	$do_gë_¥›s_‰om_off£ts
(*
ba£
,

55 
GPåAºay
 *
¥›s
, c⁄° 
Pr›Off£t
 *
off£ts
)

59 
guöt
 
i
;

61 
i
 = 0; i < 
¥›s
->
Àn
; i++) {

62 
Pr›îty
 *
¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,
i
);

63 c⁄° 
Pr›Off£t
 *
ofs
;

64 
ofs
 = 
off£ts
; ofs->
«me
 ; ofs++) {

65 i‡((
¥›
->
«me_qu¨k
 =
ofs
->name_quark) &&

66 (
¥›
->
ty≥_qu¨k
 =
ofs
->type_quark)) {

67 
¥›
->
›s
->
	`gë_‰om_off£t
’r›,
ba£
,
ofs
->
off£t
,ofs->
off£t2
);

72 
	}
}

77 
	$¥›_off£t_li°_ˇlcuœã_qu¨ks
(
Pr›Off£t
 *
ﬁi°
)

79 
guöt
 
i
;

81 
i
 = 0; 
ﬁi°
[i].
«me
 !
NULL
; i++) {

82 i‡(
ﬁi°
[
i
].
«me_qu¨k
 == 0)

83 
ﬁi°
[
i
].
«me_qu¨k
 = 
	`g_qu¨k_‰om_°©ic_°rög
(ﬁi°[i].
«me
);

84 i‡(
ﬁi°
[
i
].
ty≥_qu¨k
 == 0)

85 
ﬁi°
[
i
].
ty≥_qu¨k
 = 
	`g_qu¨k_‰om_°©ic_°rög
(ﬁi°[i].
ty≥
);

86 i‡(!
ﬁi°
[
i
].
›s
)

87 
ﬁi°
[
i
].
›s
 = 
	`¥›_ty≥_gë_›s
(ﬁi°[i].
ty≥
);

89 
	}
}

	@O:\tool\dvs50\lib\propregistry.c

25 #ifde‡
HAVE_CONFIG_H


26 
	~<c⁄fig.h
>

29 
	~<gtk/gtk.h
>

30 
	~"¥›îtõs.h
"

31 
	~"¥›öã∫Æs.h
"

33 
GHashTabÀ
 *
	g¥›s_hash
 = 
NULL
;

35 
	$check_¥›s_hash
()

37 i‡(!
¥›s_hash
) {

38 
¥›s_hash
 = 
	`g_hash_èbÀ_√w
(
g_°r_hash
,
g_°r_equÆ
);

40 
	}
}

43 
	$¥›_ty≥_ªgi°î
(
Pr›îtyTy≥
 
ty≥
, c⁄° 
Pr›îtyOps
 *
›s
)

45 
	`check_¥›s_hash
();

46 
	`g_hash_èbÀ_ö£π
(
¥›s_hash
,(
gpoöãr
)
ty≥
,(gpoöãr)
›s
);

47 
	}
}

49 c⁄° 
Pr›îtyOps
 *

50 
	$¥›_ty≥_gë_›s
(
Pr›îtyTy≥
 
ty≥
)

52 
	`check_¥›s_hash
();

53  
	`g_hash_èbÀ_lookup
(
¥›s_hash
,
ty≥
);

54 
	}
}

	@O:\tool\dvs50\lib\render_pixmap.c

32 
	~<c⁄fig.h
>

34 
	~<m©h.h
>

35 
	~<°dlib.h
>

36 
	~<gdk/gdk.h
>

38 
	~"ªndî_pixm≠.h
"

39 
	~"mesßge.h
"

40 
	~"dügdkªndîî.h
"

42 
Re˘™gÀ
 
	gª˘
;

43 
ªÆ
 
	gzoom
 = 1.0;

45 
DüRídîî
 *

46 
	$√w_pixm≠_ªndîî
(
GdkWödow
 *
wödow
, 
width
, 
height
)

48 
DüGdkRídîî
 *
ªndîî
;

49 
GdkCﬁ‹
 
cﬁ‹
;

51 
ª˘
.
À·
 = 0;

52 
ª˘
.
t›
 = 0;

53 
ª˘
.
right
 = 
width
;

54 
ª˘
.
bŸtom
 = 
height
;

56 
ªndîî
 = 
	`g_obje˘_√w
 (
DIA_TYPE_GDK_RENDERER
, 
NULL
);

57 
ªndîî
->
å™sf‹m
 = 
	`dü_å™sf‹m_√w
 (&
ª˘
, &
zoom
);

58 
ªndîî
->
pixm≠
 = 
	`gdk_pixm≠_√w
(
wödow
, 
width
, 
height
, -1);

59 
ªndîî
->
gc
 = 
	`gdk_gc_√w
(
wödow
);

61 
	`gdk_cﬁ‹_whôe
(
	`gdk_cﬁ‹m≠_gë_sy°em
(), &
cﬁ‹
);

62 
	`gdk_gc_£t_f‹eground
(
ªndîî
->
gc
, &
cﬁ‹
);

63 
	`gdk_døw_ª˘™gÀ
(
ªndîî
->
pixm≠
,Ñídîî->
gc
, 1,

64 0, 0, 
width
, 
height
);

66  
	`DIA_RENDERER
(
ªndîî
);

67 
	}
}

70 
	$ªndîî_pixm≠_£t_pixm≠
 (
DüRídîî
 *
ªn
,

71 
GdkDøwabÀ
 *
døwabÀ
,

72 
xoff£t
, 
yoff£t
,

73 
width
, 
height
)

75 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
ªn
);

77 i‡(
ªndîî
->
pixm≠
 !
NULL
)

78 
	`gdk_pixm≠_uƒef
(
ªndîî
->
pixm≠
);

80 i‡(
ªndîî
->
gc
 !
NULL
)

81 
	`gdk_gc_uƒef
(
ªndîî
->
gc
);

83 
	`gdk_pixm≠_ªf
(
døwabÀ
);

84 
ªndîî
->
pixm≠
 = 
døwabÀ
;

85 
ªndîî
->
gc
 = 
	`gdk_gc_√w
(
døwabÀ
);

87 
ª˘
.
À·
 = -
xoff£t
;

88 
ª˘
.
t›
 = -
yoff£t
;

89 
ª˘
.
right
 = 
width
;

90 
ª˘
.
bŸtom
 = 
height
;

91 
	}
}

93 
GdkPixm≠
 *

94 
	$ªndîî_pixm≠_gë_pixm≠
 (
DüRídîî
 *
ªn
)

96 
DüGdkRídîî
 *
ªndîî
 = 
	`DIA_GDK_RENDERER
 (
ªn
);

98  
ªndîî
->
pixm≠
;

99 
	}
}

	@O:\tool\dvs50\lib\render_pixmap.h

18 #i‚de‡
RENDER_PIXMAP_H


19 
	#RENDER_PIXMAP_H


	)

21 
	~"düªndîî.h
"

23 
DüRídîî
 *
√w_pixm≠_ªndîî
(
GdkWödow
 *
wödow
, 
width
, 
height
);

24 
ªndîî_pixm≠_£t_pixm≠
(
DüRídîî
 *
ªndîî
,

25 
GdkDøwabÀ
 *
døwabÀ
,

26 
xoff£t
, 
yoff£t
,

27 
width
, 
height
);

28 
GdkPixm≠
 *
ªndîî_pixm≠_gë_pixm≠
(
DüRídîî
 *
ªndîî
);

	@O:\tool\dvs50\lib\sheet.c

19 
	~<c⁄fig.h
>

21 
	~<°dlib.h
>

22 
	~<°rög.h
>

23 
	~<sys/ty≥s.h
>

24 
	~<sys/°©.h
>

25 #ifde‡
HAVE_UNISTD_H


26 
	~<uni°d.h
>

28 
	~<glib.h
>

29 
	~<libxml/åì.h
>

30 
	~<libxml/∑r£r.h
>

31 
	~<libxml/xmlmem‹y.h
>

32 
	~"dü_xml_libxml.h
"

33 
	~<°rög.h
>

35 
	~"öé.h
"

37 
	~"shìt.h
"

38 
	~"mesßge.h
"

39 
	~"obje˘.h
"

40 
	~"dü_dús.h
"

42 
Fa˘‹ySåu˘IãmAŒ
 
	g°ru˘Li°
 = {
NULL
,NULL};

43 
GSLi°
 *
	gshìts
 = 
NULL
;

45 
Shìt
 *

46 
	$√w_shìt
(*
«me
, 
gch¨
 *
des¸ùti⁄
, *
fûíame
, 
ShìtSc›e
 
sc›e
,

47 
Shìt
 *
shadowög
)

49 
Shìt
 *
shìt
;

51 
shìt
 = 
	`g_√w
(
Shìt
, 1);

53 
shìt
->
«me
 = 
	`g_°rdup
(name);

54 
shìt
->
des¸ùti⁄
 = 
	`g_°rdup
(description);

56 
shìt
->
fûíame
 = filename;

57 
shìt
->
sc›e
 = scope;

58 
shìt
->
shadowög
 = shadowing;

59 
shìt
->
obje˘s
 = 
NULL
;

60  
shìt
;

61 
	}
}

64 
	$shìt_¥ïíd_shìt_obj
(
Shìt
 *
shìt
, 
ShìtObje˘
 *
obj
)

66 
DüObje˘Ty≥
 *
ty≥
;

68 
ty≥
 = 
	`obje˘_gë_ty≥
(
obj
->
obje˘_ty≥
);

69 i‡(
ty≥
 =
NULL
) {

70 
	`mesßge_w¨nög
(
	`_
("DiaObject '%s'Çeeded in sheet '%s' wasÇot found.\n"

72 
obj
->
obje˘_ty≥
, 
shìt
->
«me
);

74 
shìt
->
obje˘s
 = 
	`g_¶i°_¥ïíd
–shìt->obje˘s, (
gpoöãr
Ë
obj
);

76 
	}
}

79 
	$shìt_≠≥nd_shìt_obj
(
Shìt
 *
shìt
, 
ShìtObje˘
 *
obj
)

81 
DüObje˘Ty≥
 *
ty≥
;

83 
ty≥
 = 
	`obje˘_gë_ty≥
(
obj
->
obje˘_ty≥
);

84 i‡(
ty≥
 =
NULL
) {

85 
	`mesßge_w¨nög
(
	`_
("DiaObject '%s'Çeeded in sheet '%s' wasÇot found.\n"

87 
obj
->
obje˘_ty≥
, 
shìt
->
«me
);

89 
shìt
->
obje˘s
 = 
	`g_¶i°_≠≥nd
–shìt->obje˘s, (
gpoöãr
Ë
obj
);

91 
	}
}

94 
	$ªgi°î_shìt
(
Shìt
 *
shìt
)

96 
shìts
 = 
	`g_¶i°_≠≥nd
(shìts, (
gpoöãr
Ë
shìt
);

97 
	}
}

99 
GSLi°
 *

100 
	$gë_shìts_li°
()

102  
shìts
;

103 
	}
}

107 
lﬂd_shìts_‰om_dú
(c⁄° 
gch¨
 *
dúe˘‹y
, 
ShìtSc›e
 
sc›e
);

108 
lﬂd_ªgi°î_shìt
(c⁄° 
gch¨
 *
dúe˘‹y
,c⁄° gch¨ *
fûíame
,

109 
ShìtSc›e
 
sc›e
);

113 
göt


114 
	$dü_shìt_s‹t_ˇŒback
(
gc⁄°poöãr
 
a
, gc⁄°poöã∏
b
)

116  
	`g_utf8_cﬁœã
(
	`gëãxt
–((
Shìt
 *)(
a
))->
«me
 ),

117 
	`gëãxt
–((
Shìt
 *)(
b
))->
«me
 ));

118 
	}
}

121 
	$dü_s‹t_shìts
()

123 
shìts
 = 
	`g_¶i°_s‹t
(shìts, 
dü_shìt_s‹t_ˇŒback
);

124 
	}
}

127 
	$lﬂd_Æl_shìts
()

129 *
shìt_∑th
;

130 *
home_dú
;

131 
	`Á˘‹yRódD©aFromFûe
(&
°ru˘Li°
);

152 *
thedú
 = 
	`dü_gë_d©a_dúe˘‹y
("sheets");

153 
	`dü_log_mesßge
 ("shìt†‰om '%s'", 
thedú
);

154 
	`lﬂd_shìts_‰om_dú
(
thedú
, 
SHEET_SCOPE_SYSTEM
);

155 
	`g_‰ì
(
thedú
);

160 
	`dü_s‹t_shìts
();

161 
	}
}

164 
	$lﬂd_shìts_‰om_dú
(c⁄° 
gch¨
 *
dúe˘‹y
, 
ShìtSc›e
 
sc›e
)

166 
GDú
 *
dp
;

167 c⁄° *
díåy
;

168 
gch¨
 *
p
;

170 
dp
 = 
	`g_dú_›í
(
dúe˘‹y
, 0, 
NULL
);

171 i‡(!
dp
) ;

173  (
díåy
 = 
	`g_dú_ªad_«me
(
dp
)) ) {

174 
gch¨
 *
fûíame
 = 
	`g_°rc⁄ˇt
(
dúe˘‹y
,
G_DIR_SEPARATOR_S
,

175 
díåy
,
NULL
);

177 i‡(!
	`g_fûe_ã°
(
fûíame
, 
G_FILE_TEST_IS_REGULAR
)) {

178 
	`g_‰ì
(
fûíame
);

183 
p
 = 
fûíame
 + 
	`°æí
(filename) - 6 ;

184 i‡(0!=
	`°∫cmp
(
p
,".sheet",6)) {

185 
	`g_‰ì
(
fûíame
);

189 
	`lﬂd_ªgi°î_shìt
(
dúe˘‹y
, 
fûíame
, 
sc›e
);

190 
	`g_‰ì
(
fûíame
);

194 
	`g_dú_˛o£
(
dp
);

195 
	}
}

198 
	$Á˘‹yRódD©aFromFûe
(
Fa˘‹ySåu˘IãmAŒ
 *
Æl°ru˘li°
)

200 
	#MAX_LINE
 1024

	)

201 
	#MAX_SECTION
 7

	)

203 
gch¨
 *
d©afûï©h
;

204 c⁄° 
gch¨
* 
c‚ame
 = "test.data";

205 
°©
 
°©buf
;

206 
d©afûï©h
 = 
	`dü_gë_lib_dúe˘‹y
("config");

207 i‡–
	`°©
(
d©afûï©h
, &
°©buf
) < 0)

209 
	`mesßge_îr‹
(
	`_
("Couldn't find configÖath "

213 * 
fûíame
 = 
	`g_°rc⁄ˇt
(
d©afûï©h
, 
G_DIR_SEPARATOR_S
 ,

214 
c‚ame
, 
NULL
);

215 
FILE
 *
fd
;

216 if((
fd
 = 
	`f›í
(
fûíame
,"r")Ë=
NULL
)

218 
	`mesßge_îr‹
(
	`_
("Couldn't open filename "

222 if(
	`°©
(
fûíame
,&
°©buf
) <0 )

224 
	`mesßge_îr‹
(
	`_
("Couldn'tÑead filename stats"

230 
fûëxt
[
MAX_LINE
]={'\0'};

231 
gch¨
* 
Æöe
 = 
NULL
;

232 
GLi°
 *
d©Æi°
 = 
NULL
;

233 
GLi°
 *
°ru˘li°
 = 
NULL
;

234 
GLi°
 *
íumli°
 = 
NULL
;

237 
gboﬁón
 
isEmnu
 = 
FALSE
;

238 
gboﬁón
 
isSåu˘
 = 
FALSE
;

240 
Fa˘‹ySåu˘EnumLi°
 *
f£l
 = 
NULL
;

241 
Fa˘‹ySåu˘IãmLi°
 *
fs¶
 = 
NULL
;

242 
n
 = 0;

243 
	`fgës
(
fûëxt
,
MAX_LINE
,
fd
)!=
NULL
)

245 
Æöe
 = 
	`g_°r°rù
(
fûëxt
);

246 if(
Æöe
[0]==':')

248 
gch¨
 ** 
sbuf
=
NULL
;

249 
sbuf

	`g_°r•lô_£t
 (
fûëxt
,":",-1);

251 if(
	`g_°rv_Àngth
(
sbuf
) < 3)

253 
	`mesßge_îr‹
(
	`_
("This Header format isÉrror."

256 if(0 =
	`°∫cmp
("Enum",
sbuf
[1],4))

258 
isEmnu
 = 
TRUE
;

259 
f£l
 = 
	`g_√w0
(
Fa˘‹ySåu˘EnumLi°
,1);

260 
f£l
->
«me
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[2],-1,
NULL
,NULL,NULL);

261 
f£l
->
li°
 = 
NULL
;

264 if–0 =
	`°∫cmp
("Såu˘",
sbuf
[1],6))

266 
isSåu˘
 = 
TRUE
;

267 
fs¶
 = 
	`g_√w0
(
Fa˘‹ySåu˘IãmLi°
,1);

268 
fs¶
->
«me
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[2],-1,
NULL
,NULL,NULL);

269 
fs¶
->
li°
 = 
NULL
;

270 
fs¶
->
numbî
 = 
n
++;

273 
	`g_°r‰ìv
(
sbuf
);

275 if(
Æöe
[0] == '{' )

279 if(
Æöe
[0] == '}')

281 if(
isSåu˘
)

283 
isSåu˘
 = 
FALSE
;

284 
Æl°ru˘li°
->
°ru˘Li°
 = 
	`g_li°_≠≥nd
◊Œ°ru˘li°->°ru˘Li°,
fs¶
);

287 
isEmnu
 = 
FALSE
;

288 
Æl°ru˘li°
->
íumLi°
 = 
	`g_li°_≠≥nd
◊Œ°ru˘li°->íumLi°,
f£l
);

291 if(
isEmnu
)

293 if(
Æöe
[0] ='/' ||álöe[0] ='#' || !
	`°æí
(aline))

295 
Fa˘‹ySåu˘Enum
 *
kvm≠
 = 
	`g_√w0
(FactoryStructEnum,1);

296 
gch¨
 ** 
sbuf
=
NULL
;

297 
sbuf

	`g_°r•lô_£t
 (
Æöe
,":",-1);

298 if–
	`g_°rv_Àngth
(
sbuf
) <2)

300 
kvm≠
->
key
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[0],-1,
NULL
,NULL,NULL);

301 
kvm≠
->
vÆue
 = 
	`g_loˇÀ_to_utf8
("0",-1,
NULL
,NULL,NULL);

305 
kvm≠
->
key
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[0],-1,
NULL
,NULL,NULL);

306 
kvm≠
->
vÆue
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[1],-1,
NULL
,NULL,NULL);

308 
f£l
->
li°
 = 
	`g_li°_≠≥nd
(f£l->li° ,
kvm≠
);

309 
	`g_°r‰ìv
(
sbuf
);

313 
gch¨
 ** 
sbuf
=
NULL
;

314 if(
Æöe
[0] ='/' ||álöe[0] ='#' || !
	`°æí
(aline))

316 
Fa˘‹ySåu˘Iãm
 *
ôem
 = 
	`g_√w0
(FactoryStructItem,1);

318 
sbuf

	`g_°r•lô_£t
 (
fûëxt
,":",-1);

320 if–
	`g_°rv_Àngth
(
sbuf
Ë<
MAX_SECTION
)

323 
ôem
->
ôemTy≥
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[0],-1,
NULL
,NULL,NULL);

324 
ôem
->
ôemName
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[1],-1,
NULL
,NULL,NULL);

325 
ôem
->
ôemC«me
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[2],-1,
NULL
,NULL,NULL);

326 
ôem
->
ôemVÆue
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[3],-1,
NULL
,NULL,NULL);

327 
ôem
->
ôemMö
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[4],-1,
NULL
,NULL,NULL);

328 
ôem
->
ôemMax
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[5],-1,
NULL
,NULL,NULL);

329 
ôem
->
ôemCommít
 = 
	`g_loˇÀ_to_utf8
(
sbuf
[6],-1,
NULL
,NULL,NULL);

330 
fs¶
->
li°
 = 
	`g_li°_≠≥nd
(fs¶->li°,
ôem
);

331 
	`g_°r‰ìv
(
sbuf
);

335 
	`f˛o£
(
fd
);

336 
	}
}

339 
	$lﬂd_ªgi°î_shìt
(c⁄° 
gch¨
 *
dú«me
, c⁄° gch¨ *
fûíame
,

340 
ShìtSc›e
 
sc›e
)

342 
xmlDocPå
 
doc
;

343 
xmlNsPå
 
ns
;

344 
xmlNodePå
 
node
, 
c⁄ã¡s
,
subnode
,
roŸ
;

345 
xmlCh¨
 *
tmp
;

346 
gch¨
 *
«me
 = 
NULL
, *
des¸ùti⁄
 = NULL;

347 
«me_sc‹e
 = -1;

348 
des¸_sc‹e
 = -1;

349 
Shìt
 *
shìt
 = 
NULL
;

350 
GSLi°
 *
shìç
;

351 
gboﬁón
 
£t_löe_bªak
 = 
FALSE
;

352 
gboﬁón
 
«me_is_gmÆlo˚d
 = 
FALSE
;

353 
Shìt
 *
shadowög
 = 
NULL
;

354 
Shìt
 *
shadowög_shìt
 = 
NULL
;

358 
doc
 = 
	`xmlDoP¨£Fûe
(
fûíame
);

359 i‡(!
doc
) ;

360 
roŸ
 = 
doc
->
xmlRoŸNode
;

361 
roŸ
 && (roŸ->
ty≥
 !
XML_ELEMENT_NODE
)ËroŸÙoŸ->
√xt
;

362 i‡(!
roŸ
) ;

363 i‡(
	`xmlIsBœnkNode
(
roŸ
)) ;

365 i‡(!(
ns
 = 
	`xmlSórchNsByHªf
(
doc
,
roŸ
, (c⁄° 
xmlCh¨
 *)

366 
DIA_XML_NAME_SPACE_BASE
 "dia-sheet-ns"))) {

367 
	`g_w¨nög
("couldÇot find sheetÇamespace");

368 
	`xmlFªeDoc
(
doc
);

371 i‡((
roŸ
->
ns
 !nsË|| (
	`xmlSåcmp
‘oŸ->
«me
, (c⁄° 
xmlCh¨
 *)"sheet"))) {

372 
	`g_w¨nög
("rootÉlement was %s --Éxpecting sheet",

373 
doc
->
xmlRoŸNode
->
«me
);

374 
	`xmlFªeDoc
(
doc
);

378 
c⁄ã¡s
 = 
NULL
;

379 
node
 = 
roŸ
->
xmlChûdªnNode
;Çodê!
NULL
;Çodênode->
√xt
) {

380 i‡(
	`xmlIsBœnkNode
(
node
)) ;

381 i‡(
node
->
ty≥
 !
XML_ELEMENT_NODE
)

384 i‡(
node
->
ns
 =n†&& !
	`xmlSåcmp
“ode->
«me
, (c⁄° 
xmlCh¨
 *)"name")) {

385 
göt
 
sc‹e
;

398 
sc‹e
 = 
	`öé_sc‹e_loˇÀ
("C");

403 i‡(
«me_sc‹e
 < 0 || 
sc‹e
 <Çame_score) {

404 
«me_sc‹e
 = 
sc‹e
;

405 i‡(
«me
Ë
	`xmlFªe
(name);

406 
«me
 = (*Ë
	`xmlNodeGëC⁄ã¡
(
node
);

408 } i‡(
node
->
ns
 =n†&& !
	`xmlSåcmp
“ode->
«me
, (c⁄° 
xmlCh¨
 *)"description")) {

409 
göt
 
sc‹e
;

414 
tmp
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"xml:lang");

415 i‡(!
tmp
Ëtm∞
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"lang");

416 
sc‹e
 = 
	`öé_sc‹e_loˇÀ
((*Ë
tmp
);

417 i‡(
tmp
Ë
	`xmlFªe
(tmp);

419 i‡(
des¸_sc‹e
 < 0 || 
sc‹e
 < descr_score) {

420 
des¸_sc‹e
 = 
sc‹e
;

421 i‡(
des¸ùti⁄
Ë
	`xmlFªe
(description);

422 
des¸ùti⁄
 = (*Ë
	`xmlNodeGëC⁄ã¡
(
node
);

425 } i‡(
node
->
ns
 =n†&& !
	`xmlSåcmp
“ode->
«me
, (c⁄° 
xmlCh¨
 *)"contents")) {

426 
c⁄ã¡s
 = 
node
;

430 i‡(!
«me
 || !
c⁄ã¡s
) {

431 
	`g_w¨nög
("Nÿ<«me>ánd/‹ <c⁄ã¡s> i¿shìà%s--skùpög", 
fûíame
);

432 
	`xmlFªeDoc
(
doc
);

433 i‡(
«me
Ë
	`xmlFªe
(name);

434 i‡(
des¸ùti⁄
Ë
	`xmlFªe
(description);

440 #ifde‡
DEBUG


441 
n
 = 
	`g_li°_Àngth
(
shìts
);

444 
shìç
 = 
	`gë_shìts_li°
();

445 
shìç
)

447 i‡(
shìç
->
d©a
 && !
	`°rcmp
(((
Shìt
 *)(shìç->d©a))->
«me
,Çame))

449 
°©
 
fú°_fûe
, 
this_fûe
;

450 
°©_ªt
;

452 
°©_ªt
 = 
	`°©
(((
Shìt
 *)(
shìç
->
d©a
))->
fûíame
, &
fú°_fûe
);

453 
	`g_as£π
(!
°©_ªt
);

455 
°©_ªt
 = 
	`°©
(
fûíame
, &
this_fûe
);

456 
	`g_as£π
(!
°©_ªt
);

458 i‡(
this_fûe
.
°_mtime
 > 
fú°_fûe
.st_mtime)

460 
gch¨
 *
tmp
 = 
	`g_°rdup_¥ötf
("%†[C›y o‡sy°em]", 
«me
);

461 
	`mesßge_nŸi˚
(
	`_
("The system sheet '%s'áppearsÅo be moreÑecent"

468 
«me
, 
tmp
,Åmp,Åmp);

469 
	`xmlFªe
(
«me
);

470 
«me
 = 
tmp
;

471 
«me_is_gmÆlo˚d
 = 
TRUE
;

472 
shadowög
 = 
shìç
->
d©a
;

479 
shadowög_shìt
 = 
shìç
->
d©a
;

482 
shìç
 = 
	`g_¶i°_√xt
(sheetp);

485 
shìt
 = 
	`√w_shìt
(
«me
, 
des¸ùti⁄
, 
	`g_°rdup
(
fûíame
), 
sc›e
, 
shadowög
);

487 i‡(
shadowög_shìt
)

488 
shadowög_shìt
->
shadowög
 = 
shìt
;

490 i‡(
«me_is_gmÆlo˚d
 =
TRUE
)

491 
	`g_‰ì
(
«me
);

493 
	`xmlFªe
(
«me
);

494 
	`xmlFªe
(
des¸ùti⁄
);

496 
node
 = 
c⁄ã¡s
->
xmlChûdªnNode
 ;Çodê!
NULL
;Çodênode->
√xt
) {

497 
ShìtObje˘
 *
shìt_obj
;

498 
DüObje˘Ty≥
 *
Ÿy≥
;

499 
gch¨
 *
ic⁄«me
 = 
NULL
;

501 
subdesc_sc‹e
 = -1;

502 
gch¨
 *
objdesc
 = 
NULL
;

504 
göt
 
ötd©a
 = 0;

505 
gch¨
 *
ch¨d©a
 = 
NULL
;

507 
gboﬁón
 
has_ötd©a
 = 
FALSE
;

508 
gboﬁón
 
has_ic⁄_⁄_shìt
 = 
FALSE
;

510 i‡(
	`xmlIsBœnkNode
(
node
)) ;

512 i‡(
node
->
ty≥
 !
XML_ELEMENT_NODE
)

514 i‡(
node
->
ns
 !=Çs) ;

515 i‡(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"object")) {

517 } i‡(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"shape")) {

518 
	`g_mesßge
(
	`_
("%s: you should use objectÅagsÑatherÅhan shapeÅagsÇow"),

519 
fûíame
);

520 } i‡(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"br")) {

522 
£t_löe_bªak
 = 
TRUE
;

527 
tmp
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"intdata");

528 i‡(
tmp
) {

529 *
p
;

530 
ötd©a
 = (
göt
)
	`°πﬁ
((*Ë
tmp
,&
p
,0);

531 i‡(*
p
 !0Ë
ötd©a
 = 0;

532 
	`xmlFªe
(
tmp
);

533 
has_ötd©a
 = 
TRUE
;

535 
ch¨d©a
 = (
gch¨
 *Ë
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"chardata");

537 i‡(
ch¨d©a
Ë
	`xmlFªe
(chardata);

539 
subnode
 = 
node
->
xmlChûdªnNode
;

540 
subnode
 !
NULL
 ;

541 
subnode
 = subnode->
√xt
) {

542 i‡(
	`xmlIsBœnkNode
(
subnode
)) ;

544 i‡(
subnode
->
ns
 =n†&& !
	`xmlSåcmp
(subnode->
«me
, (c⁄° 
xmlCh¨
 *)"description")) {

545 
göt
 
sc‹e
;

551 
tmp
 = 
	`xmlGëPr›
(
subnode
, (
xmlCh¨
 *)"xml:lang");

552 i‡(!
tmp
Ëtm∞
	`xmlGëPr›
(
subnode
, (
xmlCh¨
 *)"lang");

553 
sc‹e
 = 
	`öé_sc‹e_loˇÀ
((*Ë
tmp
);

554 i‡(
tmp
Ë
	`xmlFªe
(tmp);

556 i‡(
subdesc_sc‹e
 < 0 || 
sc‹e
 < subdesc_score) {

557 
subdesc_sc‹e
 = 
sc‹e
;

558 i‡(
objdesc
Ë
	`‰ì
(objdesc);

559 
objdesc
 = (
gch¨
 *Ë
	`xmlNodeGëC⁄ã¡
(
subnode
);

562 } i‡(
subnode
->
ns
 =n†&& !
	`xmlSåcmp
(subnode->
«me
, (c⁄° 
xmlCh¨
 *)"icon")) {

563 
tmp
 = 
	`xmlNodeGëC⁄ã¡
(
subnode
);

564 
ic⁄«me
 = 
	`g_°rc⁄ˇt
(
dú«me
,
G_DIR_SEPARATOR_S
, (*Ë
tmp
,
NULL
);

565 if(!
shadowög_shìt
 && !
	`g_fûe_ã°
 (
ic⁄«me
, 
G_FILE_TEST_EXISTS
))

568 
gch¨
 *
shìtdú
 = 
	`dü_gë_d©a_dúe˘‹y
("sheets");

569 
ic⁄«me
 = 
	`g_°rc⁄ˇt
(
shìtdú
,
G_DIR_SEPARATOR_S
, (*Ë
tmp
,
NULL
);

570 
	`g_‰ì
(
shìtdú
);

572 
has_ic⁄_⁄_shìt
 = 
TRUE
;

573 i‡(
tmp
Ë
	`xmlFªe
(tmp);

577 
tmp
 = 
	`xmlGëPr›
(
node
, (
xmlCh¨
 *)"name");

579 
GLi°
 *
¶i°
 = 
°ru˘Li°
.structList;

581 
Fa˘‹ySåu˘IãmLi°
 *
fs¶
 = 
NULL
;

582 ;
¶i°
 !
NULL
; sli° = sli°->
√xt
)

584 
fs¶
 = 
¶i°
->
d©a
;

585 
shìt_obj
 = 
	`g_√w
(
ShìtObje˘
,1);

586 
shìt_obj
->
obje˘_ty≥
 = 
	`g_°rdup
((*Ë
tmp
);

587 
shìt_obj
->
des¸ùti⁄
 = 
	`g_°rdup
(
fs¶
->
«me
);

590 
shìt_obj
->
pixm≠
 = 
NULL
;

592 
shìt_obj
->
u£r_d©a
 = 
	`GINT_TO_POINTER
(
fs¶
->
numbî
);

593 
shìt_obj
->
u£r_d©a_ty≥
 = 
has_ötd©a
 ? 
USER_DATA_IS_INTDATA


594 : 
USER_DATA_IS_OTHER
;

595 
shìt_obj
->
pixm≠_fûe
 = 
ic⁄«me
;

596 
shìt_obj
->
has_ic⁄_⁄_shìt
 = has_icon_on_sheet;

597 
shìt_obj
->
löe_bªak
 = 
£t_löe_bªak
;

598 
£t_löe_bªak
 = 
FALSE
;

600 i‡((
Ÿy≥
 = 
	`obje˘_gë_ty≥
((*Ë
tmp
)Ë=
NULL
) {

603 i‡(
shìt_obj
->
des¸ùti⁄
Ë
	`g_‰ì
(sheet_obj->description);

604 
	`g_‰ì
(
shìt_obj
->
pixm≠_fûe
);

605 
	`g_‰ì
(
shìt_obj
->
obje˘_ty≥
);

606 
	`g_‰ì
(
shìt_obj
);

607 i‡(
tmp
)

608 
	`xmlFªe
(
tmp
);

613 i‡(
shìt_obj
->
pixm≠_fûe
 =
NULL
) {

614 
	`g_as£π
(
Ÿy≥
->
pixm≠
 || oty≥->
pixm≠_fûe
);

615 
shìt_obj
->
pixm≠
 = 
Ÿy≥
->pixmap;

616 
shìt_obj
->
pixm≠_fûe
 = 
Ÿy≥
->pixmap_file;

617 
shìt_obj
->
has_ic⁄_⁄_shìt
 = has_icon_on_sheet;

619 i‡(
shìt_obj
->
u£r_d©a
 =
NULL


620 && 
shìt_obj
->
u£r_d©a_ty≥
 !
USER_DATA_IS_INTDATA
)

621 
shìt_obj
->
u£r_d©a
 = 
Ÿy≥
->
deÁu…_u£r_d©a
;

623 
shìt_obj
->
u£r_d©a_ty≥
 = 
USER_DATA_IS_INTDATA
;

630 
	`shìt_≠≥nd_shìt_obj
(
shìt
,
shìt_obj
);

633 i‡(
tmp
Ë
	`xmlFªe
(tmp);

634 
	`xmlFªe
(
objdesc
); objdes¯
NULL
;

637 i‡(!
shadowög_shìt
)

638 
	`ªgi°î_shìt
(
shìt
);

640 
	`xmlFªeDoc
(
doc
);

641 
	}
}

	@O:\tool\dvs50\lib\sheet.h

18 #i‚de‡
SHEET_H


19 
	#SHEET_H


	)

21 
	~<glib.h
>

23 
	~"düty≥s.h
"

24 
DIAVAR
 
Fa˘‹ySåu˘IãmAŒ
 
	g°ru˘Li°
;

25 
	s_ShìtObje˘
 {

26 *
	mobje˘_ty≥
;

27 *
	mdes¸ùti⁄
;

28 **
	mpixm≠
;

30 *
	mu£r_d©a
;

31 íum { 
	mUSER_DATA_IS_INTDATA
, 
	mUSER_DATA_IS_OTHER
 } 
	mu£r_d©a_ty≥
;

33 
gboﬁón
 
	mlöe_bªak
;

35 *
	mpixm≠_fûe
;

36 
gboﬁón
 
	mhas_ic⁄_⁄_shìt
;

41 
	mSHEET_SCOPE_SYSTEM
,

42 
	mSHEET_SCOPE_USER


44 
	tShìtSc›e
;

46 
	s_Shìt
 {

47 *
	m«me
;

48 *
	mdes¸ùti⁄
;

49 *
	mfûíame
;

51 
ShìtSc›e
 
	msc›e
;

52 
Shìt
 *
	mshadowög
;

60 
GSLi°
 *
	mobje˘s
;

64 
	s_Fa˘‹ySåu˘Enum


66 
gch¨
 *
	mkey
;

67 
gch¨
 *
	mvÆue
;

70 
	s_Fa˘‹ySåu˘Iãm
{

71 
gch¨
 *
	môemTy≥
;

72 
gch¨
 *
	môemName
;

73 
gch¨
 *
	môemC«me
;

74 
gch¨
 *
	môemVÆue
;

75 
gch¨
 *
	môemMö
;

76 
gch¨
 *
	môemMax
;

77 
gch¨
 *
	môemCommít
;

79 
	s_Fa˘‹ySåu˘EnumLi°
{

80 
gch¨
 *
	m«me
;

81 
GLi°
 *
	mli°
;

88 
Shìt
 *
√w_shìt
(*
«me
, *
des¸ùti⁄
, *
fûíame
,

89 
ShìtSc›e
 
sc›e
, 
Shìt
 *
shadowög
);

90 
shìt_¥ïíd_shìt_obj
(
Shìt
 *
shìt
, 
ShìtObje˘
 *
ty≥
);

91 
DIAVAR
 
shìt_≠≥nd_shìt_obj
(
Shìt
 *
shìt
, 
ShìtObje˘
 *
ty≥
);

92 
DIAVAR
 
ªgi°î_shìt
(
Shìt
 *
shìt
);

93 
DIAVAR
 
GSLi°
 *
gë_shìts_li°
();

94 
DIAVAR
 
Á˘‹yRódD©aFromFûe
(
Fa˘‹ySåu˘IãmAŒ
 *
Æl°ru˘li°
);

96 
DIAVAR
 
lﬂd_Æl_shìts
();

97 
DIAVAR
 
dü_s‹t_shìts
();

	@O:\tool\dvs50\lib\text.c

18 
	~<c⁄fig.h
>

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<°rög.h
>

23 
	~<glib.h
>

24 
	~<m©h.h
>

26 
	~<gdk/gdkkeysyms.h
>

28 
	~"¥›öã∫Æs.h
"

29 
	~"ãxt.h
"

30 
	~"mesßge.h
"

31 
	~"düªndîî.h
"

32 
	~"dügømd©a.h
"

33 
	~"objch™ge.h
"

34 
	~"ãxéöe.h
"

36 
ãxt_key_evít
(
Focus
 *
focus
, 
guöt
 
keysym
,

37 c⁄° 
gch¨
 *
°r
, 
°æí
,

38 
Obje˘Ch™ge
 **
ch™ge
);

40 
	ech™ge_ty≥
 {

41 
	mTYPE_DELETE_BACKWARD
,

42 
	mTYPE_DELETE_FORWARD
,

43 
	mTYPE_INSERT_CHAR
,

44 
	mTYPE_JOIN_ROW
,

45 
	mTYPE_SPLIT_ROW
,

46 
	mTYPE_DELETE_ALL


49 
	sTextObje˘Ch™ge
 {

50 
Obje˘Ch™ge
 
	mobj_ch™ge
;

52 
Text
 *
	mãxt
;

53 
ch™ge_ty≥
 
	mty≥
;

54 
gunich¨
 
	mch
;

55 
	mpos
;

56 
	mrow
;

57 
gch¨
 *
	m°r
;

60 
	#CURSOR_HEIGHT_RATIO
 20

	)

63 
gch¨
 *

64 
	$ãxt_gë_löe
(
Text
 *
ãxt
, 
löe
)

66  
	`ãxt_löe_gë_°rög
(
ãxt
->
löes
[
löe
]);

67 
	}
}

72 
	$ãxt_£t_löe
(
Text
 *
ãxt
, 
löe_no
, 
gch¨
 *
löe
)

74 
	`ãxt_löe_£t_°rög
(
ãxt
->
löes
[
löe_no
], 
löe
);

75 
	}
}

81 
	$ãxt_£t_löe_ãxt
(
Text
 *
ãxt
, 
löe_no
, 
gch¨
 *
löe
)

83 
	`ãxt_£t_löe
(
ãxt
, 
löe_no
, 
löe
);

84 
	}
}

90 
	$ãxt_dñëe_löe
(
Text
 *
ãxt
, 
löe_no
)

92 
i
;

94 
	`g_‰ì
(
ãxt
->
löes
[
löe_no
]);

95 
i
 = 
löe_no
; i < 
ãxt
->
numlöes
 - 1; i++) {

96 
ãxt
->
löes
[
i
] =Åext->lines[i+1];

98 
ãxt
->
numlöes
 -= 1;

99 
ãxt
->
löes
 = 
	`g_ªÆloc
—ext->löes, (
TextLöe
 *)*ãxt->
numlöes
);

100 
	}
}

106 
	$ãxt_ö£π_löe
(
Text
 *
ãxt
, 
löe_no
)

108 
i
;

109 
ãxt
->
numlöes
 += 1;

110 
ãxt
->
löes
 = 
	`g_ªÆloc
—ext->löes, (*)*ãxt->
numlöes
);

112 
i
 = 
ãxt
->
numlöes
 - 1; i > 
löe_no
; i--) {

113 
ãxt
->
löes
[
i
] =Åext->lines[i - 1];

115 
ãxt
->
löes
[
löe_no
] = 
	`ãxt_löe_√w
("",Åext->
f⁄t
,Åext->
height
);;

116 
	}
}

123 
ªÆ


124 
	$ãxt_gë_löe_width
(
Text
 *
ãxt
, 
löe_no
)

126  
	`ãxt_löe_gë_width
(
ãxt
->
löes
[
löe_no
]);

127 
	}
}

135 
	$ãxt_gë_löe_°æí
(
Text
 *
ãxt
, 
löe_no
)

137  
	`g_utf8_°æí
(
	`ãxt_löe_gë_°rög
(
ãxt
->
löes
[
löe_no
]), -1);

138 
	}
}

140 
ªÆ


141 
	$ãxt_gë_max_width
(
Text
 *
ãxt
)

143  
ãxt
->
max_width
;

144 
	}
}

150 
ªÆ


151 
	$ãxt_gë_as˚¡
(
Text
 *
ãxt
)

153  
ãxt
->
as˚¡
;

154 
	}
}

160 
ªÆ


161 
	$ãxt_gë_des˚¡
(
Text
 *
ãxt
)

163  
ãxt
->
des˚¡
;

164 
	}
}

166 
Obje˘Ch™ge
 *
ãxt_¸óã_ch™ge
(
Text
 *
ãxt
, 
ch™ge_ty≥
 
ty≥
,

167 
gunich¨
 
ch
, 
pos
, 
row
);

170 
	$ˇlc_width
(
Text
 *
ãxt
)

172 
ªÆ
 
width
;

173 
i
;

175 
width
 = 0.0;

176 
i
 = 0; i < 
ãxt
->
numlöes
; i++) {

177 
width
 = 
	`MAX
(width, 
	`ãxt_gë_löe_width
(
ãxt
, 
i
));

180 
ãxt
->
max_width
 = 
width
;

181 
	}
}

184 
	$ˇlc_as˚¡_des˚¡
(
Text
 *
ãxt
)

186 
ªÆ
 
sig_a
 = 0.0,
sig_d
 = 0.0;

187 
guöt
 
i
;

189  
i
 = 0; i < 
ãxt
->
numlöes
; i++) {

190 
sig_a
 +
	`ãxt_löe_gë_as˚¡
(
ãxt
->
löes
[
i
]);

191 
sig_d
 +
	`ãxt_löe_gë_des˚¡
(
ãxt
->
löes
[
i
]);

194 
ãxt
->
as˚¡
 = 
sig_a
 / (
ªÆ
Èext->
numlöes
;

195 
ãxt
->
des˚¡
 = 
sig_d
 / (
ªÆ
Èext->
numlöes
;

196 
	}
}

199 
	$‰ì_°rög
(
Text
 *
ãxt
)

201 
i
;

203 
i
=0;i<
ãxt
->
numlöes
;i++) {

204 
	`ãxt_löe_de°roy
(
ãxt
->
löes
[
i
]);

207 
	`g_‰ì
(
ãxt
->
löes
);

208 
ãxt
->
löes
 = 
NULL
;

209 
	}
}

212 
	$£t_°rög
(
Text
 *
ãxt
, c⁄° *
°rög
)

214 
numlöes
, 
i
;

215 c⁄° *
s
,*
s2
;

217 
s
 = 
°rög
;

219 
numlöes
 = 1;

220 i‡(
s
 !
NULL
)

221  (
s
 = 
	`g_utf8_°rchr
(s, -1, '\n')Ë!
NULL
 ) {

222 
numlöes
++;

223 i‡(*
s
) {

224 
s
 = 
	`g_utf8_√xt_ch¨
(s);

227 
ãxt
->
numlöes
 =Çumlines;

228 
ãxt
->
löes
 = 
	`g_√w0
(
TextLöe
 *, 
numlöes
);

229 
i
 = 0; i < 
numlöes
; i++) {

230 
ãxt
->
löes
[
i
] = 
	`ãxt_löe_√w
("",Åext->
f⁄t
,Åext->
height
);

233 
s
 = 
°rög
;

235 i‡(
°rög
 =
NULL
) {

236 
	`ãxt_£t_löe_ãxt
(
ãxt
, 0, "");

240 
i
 = 0; i < 
numlöes
; i++) {

241 
gch¨
 *
°rög_löe
;

242 
s2
 = 
	`g_utf8_°rchr
(
s
, -1, '\n');

243 i‡(
s2
 =
NULL
) {

244 
s2
 = 
s
 + 
	`°æí
(s);

246 
°rög_löe
 = 
	`g_°∫dup
(
s
, 
s2
 - s);

247 
	`ãxt_£t_löe_ãxt
(
ãxt
, 
i
, 
°rög_löe
);

248 
	`g_‰ì
(
°rög_löe
);

249 
s
 = 
s2
;

250 i‡(*
s
) {

251 
s
 = 
	`g_utf8_√xt_ch¨
(s);

255 i‡(
ãxt
->
curs‹_row
 >ãxt->
numlöes
) {

256 
ãxt
->
curs‹_row
 =Åext->
numlöes
 - 1;

259 i‡(
ãxt
->
curs‹_pos
 > 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
)) {

260 
ãxt
->
curs‹_pos
 = 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
);

262 
	}
}

265 
	$ãxt_£t_°rög
(
Text
 *
ãxt
, c⁄° *
°rög
)

267 i‡(
ãxt
->
löes
 !
NULL
)

268 
	`‰ì_°rög
(
ãxt
);

270 
	`£t_°rög
(
ãxt
, 
°rög
);

271 
	}
}

273 
Text
 *

274 
	$√w_ãxt
(c⁄° *
°rög
, 
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
,

275 
Poöt
 *
pos
, 
Cﬁ‹
 *
cﬁ‹
, 
Alignmít
 
Æign
)

277 
Text
 *
ãxt
;

279 
ãxt
 = 
	`g_√w
(
Text
, 1);

281 
ãxt
->
f⁄t
 = 
	`dü_f⁄t_ªf
(font);

282 
ãxt
->
height
 = height;

284 
ãxt
->
posôi⁄
 = *
pos
;

285 
ãxt
->
cﬁ‹
 = *color;

286 
ãxt
->
Æignmít
 = 
Æign
;

288 
ãxt
->
curs‹_pos
 = 0;

289 
ãxt
->
curs‹_row
 = 0;

291 
ãxt
->
focus
.
obj
 = 
NULL
;

292 
ãxt
->
focus
.
has_focus
 = 
FALSE
;

293 
ãxt
->
focus
.
u£r_d©a
 = (*)text;

294 
ãxt
->
focus
.
key_evít
 = 
ãxt_key_evít
;

295 
ãxt
->
focus
.text =Åext;

297 
	`£t_°rög
(
ãxt
, 
°rög
);

299 
	`ˇlc_as˚¡_des˚¡
(
ãxt
);

301  
ãxt
;

302 
	}
}

304 
Text
 *

305 
	$ãxt_c›y
(
Text
 *
ãxt
)

307 
Text
 *
c›y
;

308 
i
;

310 
c›y
 = 
	`g_√w
(
Text
, 1);

311 
c›y
->
numlöes
 = 
ãxt
->numlines;

312 
c›y
->
löes
 = 
	`g_√w
(
TextLöe
 *, 
ãxt
->
numlöes
);

314 
c›y
->
f⁄t
 = 
	`dü_f⁄t_c›y
(
ãxt
->font);

315 
c›y
->
height
 = 
ãxt
->height;

316 
c›y
->
posôi⁄
 = 
ãxt
->position;

317 
c›y
->
cﬁ‹
 = 
ãxt
->color;

318 
c›y
->
Æignmít
 = 
ãxt
->alignment;

320 
i
=0;i<
ãxt
->
numlöes
;i++) {

321 
TextLöe
 *
ãxt_löe
 = 
ãxt
->
löes
[
i
];

322 
c›y
->
löes
[
i
] = 
	`ãxt_löe_√w
(
	`ãxt_löe_gë_°rög
(
ãxt_löe
),

323 
	`ãxt_löe_gë_f⁄t
(
ãxt_löe
),

324 
	`ãxt_löe_gë_height
(
ãxt_löe
));

327 
c›y
->
curs‹_pos
 = 0;

328 
c›y
->
curs‹_row
 = 0;

329 
c›y
->
focus
.
obj
 = 
NULL
;

330 
c›y
->
focus
.
has_focus
 = 
FALSE
;

331 
c›y
->
focus
.
u£r_d©a
 = (*)copy;

332 
c›y
->
focus
.
key_evít
 = 
ãxt_key_evít
;

333 
c›y
->
focus
.
ãxt
 = copy;

335 
c›y
->
as˚¡
 = 
ãxt
->ascent;

336 
c›y
->
des˚¡
 = 
ãxt
->descent;

337 
c›y
->
max_width
 = 
ãxt
->max_width;

339  
c›y
;

340 
	}
}

343 
	$ãxt_de°roy
(
Text
 *
ãxt
)

345 
	`‰ì_°rög
(
ãxt
);

346 
	`dü_f⁄t_uƒef
(
ãxt
->
f⁄t
);

347 
	`g_‰ì
(
ãxt
);

348 
	}
}

351 
	$ãxt_£t_height
(
Text
 *
ãxt
, 
ªÆ
 
height
)

353 
i
;

354 
ãxt
->
height
 = height;

355 
i
 = 0; i < 
ãxt
->
numlöes
; i++) {

356 
	`ãxt_löe_£t_height
(
ãxt
->
löes
[
i
], 
height
);

358 
	`ˇlc_width
(
ãxt
);

359 
	`ˇlc_as˚¡_des˚¡
(
ãxt
);

360 
	}
}

363 
	$ãxt_£t_f⁄t
(
Text
 *
ãxt
, 
DüF⁄t
 *
f⁄t
)

365 
DüF⁄t
 *
ﬁd_f⁄t
 = 
ãxt
->
f⁄t
;

366 
i
;

368 
ãxt
->
f⁄t
 = 
	`dü_f⁄t_ªf
(font);

369 
	`dü_f⁄t_uƒef
(
ﬁd_f⁄t
);

371 
i
 = 0; i < 
ãxt
->
numlöes
; i++) {

372 
	`ãxt_löe_£t_f⁄t
(
ãxt
->
löes
[
i
], 
f⁄t
);

375 
	`ˇlc_width
(
ãxt
);

376 
	`ˇlc_as˚¡_des˚¡
(
ãxt
);

377 
	}
}

380 
	$ãxt_£t_posôi⁄
(
Text
 *
ãxt
, 
Poöt
 *
pos
)

382 
ãxt
->
posôi⁄
 = *
pos
;

383 
	}
}

386 
	$ãxt_£t_cﬁ‹
(
Text
 *
ãxt
, 
Cﬁ‹
 *
cﬁ
)

388 
ãxt
->
cﬁ‹
 = *
cﬁ
;

389 
	}
}

392 
	$ãxt_£t_Æignmít
(
Text
 *
ãxt
, 
Alignmít
 
Æign
)

394 
ãxt
->
Æignmít
 = 
Æign
;

395 
	}
}

398 
	$ãxt_ˇlc_boundögbox
(
Text
 *
ãxt
, 
Re˘™gÀ
 *
box
)

400 
	`ˇlc_width
(
ãxt
);

401 
	`ˇlc_as˚¡_des˚¡
(
ãxt
);

403 i‡(
box
 =
NULL
) ;

405 
box
->
À·
 = 
ãxt
->
posôi⁄
.
x
;

406 
ãxt
->
Æignmít
) {

407 
ALIGN_LEFT
:

409 
ALIGN_CENTER
:

410 
box
->
À·
 -
ãxt
->
max_width
 / 2.0;

412 
ALIGN_RIGHT
:

413 
box
->
À·
 -
ãxt
->
max_width
;

417 
box
->
right
 = box->
À·
 + 
ãxt
->
max_width
;

419 
box
->
t›
 = 
ãxt
->
posôi⁄
.
y
 -Åext->
as˚¡
;

421 
box
->
bŸtom
 = box->
t›
 + 
ãxt
->
height
*ãxt->
numlöes
 +Åext->
des˚¡
;

424 
box
->
bŸtom
 = box->
t›
 + (
ãxt
->
as˚¡
+ãxt->
des˚¡
+ãxt->
height
*—ext->
numlöes
-1));

426 i‡(
ãxt
->
focus
.
has_focus
) {

427 
ªÆ
 
height
 = 
ãxt
->
as˚¡
 +Åext->
des˚¡
;

428 i‡(
ãxt
->
curs‹_pos
 == 0) {

430 
box
->
À·
 -
height
/(
CURSOR_HEIGHT_RATIO
*2);

435 
box
->
right
 +
height
/(
CURSOR_HEIGHT_RATIO
*2);

439 
box
->
t›
 -
height
/(
CURSOR_HEIGHT_RATIO
*2);

440 
box
->
bŸtom
 +
height
/
CURSOR_HEIGHT_RATIO
;

442 
	}
}

445 
	$ãxt_gë_°rög_c›y
(
Text
 *
ãxt
)

447 
num
,
i
;

448 *
°r
;

450 
num
 = 0;

451 
i
=0;i<
ãxt
->
numlöes
;i++) {

453 
num
 +
	`°æí
(
	`ãxt_gë_löe
(
ãxt
, 
i
))+1;

456 
°r
 = 
	`g_mÆloc
(
num
);

458 *
°r
 = 0;

460 
i
=0;i<
ãxt
->
numlöes
;i++) {

461 
	`°rˇt
(
°r
, 
	`ãxt_gë_löe
(
ãxt
, 
i
));

462 i‡(
i
 !(
ãxt
->
numlöes
-1)) {

463 
	`°rˇt
(
°r
, "\n");

467  
°r
;

468 
	}
}

470 
ªÆ


471 
	$ãxt_di°™˚_‰om
(
Text
 *
ãxt
, 
Poöt
 *
poöt
)

473 
ªÆ
 
dx
, 
dy
;

474 
ªÆ
 
t›y
, 
bŸtomy
;

475 
ªÆ
 
À·
, 
right
;

476 
löe
;

478 
t›y
 = 
ãxt
->
posôi⁄
.
y
 -Åext->
as˚¡
;

479 
bŸtomy
 = 
t›y
 + 
ãxt
->
height
*ãxt->
numlöes
;

480 i‡(
poöt
->
y
 <
t›y
) {

481 
dy
 = 
t›y
 - 
poöt
->
y
;

482 
löe
 = 0;

483 } i‡(
poöt
->
y
 >
bŸtomy
) {

484 
dy
 = 
poöt
->
y
 - 
bŸtomy
;

485 
löe
 = 
ãxt
->
numlöes
 - 1;

487 
dy
 = 0.0;

488 
löe
 = (Ë
	`Êo‹
–(
poöt
->
y
 - 
t›y
Ë/ 
ãxt
->
height
 );

491 
À·
 = 
ãxt
->
posôi⁄
.
x
;

492 
ãxt
->
Æignmít
) {

493 
ALIGN_LEFT
:

495 
ALIGN_CENTER
:

496 
À·
 -
	`ãxt_gë_löe_width
(
ãxt
, 
löe
) / 2.0;

498 
ALIGN_RIGHT
:

499 
À·
 -
	`ãxt_gë_löe_width
(
ãxt
, 
löe
);

502 
right
 = 
À·
 + 
	`ãxt_gë_löe_width
(
ãxt
, 
löe
);

504 i‡(
poöt
->
x
 <
À·
) {

505 
dx
 = 
À·
 - 
poöt
->
x
;

506 } i‡(
poöt
->
x
 >
right
) {

507 
dx
 = 
poöt
->
x
 - 
right
;

509 
dx
 = 0.0;

512  
dx
 + 
dy
;

513 
	}
}

516 
	$ãxt_døw
(
Text
 *
ãxt
, 
DüRídîî
 *
ªndîî
)

518 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_ãxt
‘ídîî, 
ãxt
);

520 i‡((
ªndîî
->
is_öãø˘ive
Ë&& (
ãxt
->
focus
.
has_focus
)) {

521 
ªÆ
 
curs_x
, 
curs_y
;

522 
ªÆ
 
°r_width_fú°
;

523 
ªÆ
 
°r_width_whﬁe
;

524 
Poöt
 
p1
, 
p2
;

525 
ªÆ
 
height
 = 
ãxt
->
as˚¡
+ãxt->
des˚¡
;

526 
curs_y
 = 
ãxt
->
posôi⁄
.
y
 -Åext->
as˚¡
 +Åext->
curs‹_row
*ãxt->
height
;

528 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_f⁄t
‘ídîî, 
ãxt
->
f⁄t
,Åext->
height
);

530 
°r_width_fú°
 =

531 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`gë_ãxt_width
(renderer,

532 
	`ãxt_gë_löe
(
ãxt
,Åext->
curs‹_row
),

533 
ãxt
->
curs‹_pos
);

534 
°r_width_whﬁe
 =

535 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`gë_ãxt_width
(renderer,

536 
	`ãxt_gë_löe
(
ãxt
,Åext->
curs‹_row
),

537 
	`ãxt_gë_löe_°æí
(
ãxt
,Åext->
curs‹_row
));

538 
curs_x
 = 
ãxt
->
posôi⁄
.
x
 + 
°r_width_fú°
;

540 
ãxt
->
Æignmít
) {

541 
ALIGN_LEFT
:

543 
ALIGN_CENTER
:

544 
curs_x
 -
°r_width_whﬁe
 / 2.0;

546 
ALIGN_RIGHT
:

547 
curs_x
 -
°r_width_whﬁe
;

551 
p1
.
x
 = 
curs_x
;

552 
p1
.
y
 = 
curs_y
;

553 
p2
.
x
 = 
curs_x
;

554 
p2
.
y
 = 
curs_y
 + 
height
;

556 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löe°yÀ
‘ídîî, 
LINESTYLE_SOLID
);

557 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_löewidth
‘ídîî, 
height
/
CURSOR_HEIGHT_RATIO
);

558 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`døw_löe
‘ídîî, &
p1
, &
p2
, &
cﬁ‹_bœck
);

560 
	}
}

563 
	$ãxt_gøb_focus
(
Text
 *
ãxt
, 
DüObje˘
 *
obje˘
)

565 
ãxt
->
focus
.
obj
 = 
obje˘
;

566 
	`ªque°_focus
(&
ãxt
->
focus
);

567 
	}
}

570 
	$ãxt_£t_curs‹_©_íd
–
Text
* 
ãxt
 )

572 
ãxt
->
curs‹_row
 =Åext->
numlöes
 - 1 ;

573 
ãxt
->
curs‹_pos
 = 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
) ;

574 
	}
}

579 
	$ãxt_£t_curs‹
(
Text
 *
ãxt
, 
Poöt
 *
˛icked_poöt
,

580 
DüRídîî
 *
ªndîî
)

582 
ªÆ
 
°r_width_whﬁe
;

583 
ªÆ
 
°r_width_fú°
;

584 
ªÆ
 
t›
;

585 
ªÆ
 
°¨t_x
;

586 
row
;

587 
i
;

589 i‡(
˛icked_poöt
 !
NULL
) {

590 
t›
 = 
ãxt
->
posôi⁄
.
y
 -Åext->
as˚¡
;

592 
row
 = ()
	`Êo‹
((
˛icked_poöt
->
y
 - 
t›
Ë/ 
ãxt
->
height
);

594 i‡(
row
 < 0)

595 
row
 = 0;

597 i‡(
row
 >
ãxt
->
numlöes
)

598 
row
 = 
ãxt
->
numlöes
 - 1;

600 
ãxt
->
curs‹_row
 = 
row
;

601 
ãxt
->
curs‹_pos
 = 0;

603 i‡(!
ªndîî
->
is_öãø˘ive
) {

604 
	`mesßge_îr‹
("InternalÉrror: Select givesÇon interactiveÑenderer!\n"

605 "vÆ: %d\n", 
ªndîî
->
is_öãø˘ive
);

610 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`£t_f⁄t
‘ídîî, 
ãxt
->
f⁄t
,Åext->
height
);

611 
°r_width_whﬁe
 =

612 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`gë_ãxt_width
(renderer,

613 
	`ãxt_gë_löe
(
ãxt
, 
row
),

614 
	`ãxt_gë_löe_°æí
(
ãxt
, 
row
));

615 
°¨t_x
 = 
ãxt
->
posôi⁄
.
x
;

616 
ãxt
->
Æignmít
) {

617 
ALIGN_LEFT
:

619 
ALIGN_CENTER
:

620 
°¨t_x
 -
°r_width_whﬁe
 / 2.0;

622 
ALIGN_RIGHT
:

623 
°¨t_x
 -
°r_width_whﬁe
;

630 
i
=0;i<=
	`ãxt_gë_löe_°æí
(
ãxt
, 
row
);i++) {

631 
°r_width_fú°
 =

632 
	`DIA_RENDERER_GET_CLASS
(
ªndîî
)->
	`gë_ãxt_width
‘ídîî, 
	`ãxt_gë_löe
(
ãxt
, 
row
), 
i
);

633 i‡(
˛icked_poöt
->
x
 - 
°¨t_x
 >
°r_width_fú°
) {

634 
ãxt
->
curs‹_pos
 = 
i
;

639 
ãxt
->
curs‹_pos
 = 
	`ãxt_gë_löe_°æí
—ext, 
row
);

643 
	}
}

646 
	$ãxt_joö_löes
(
Text
 *
ãxt
, 
fú°_löe
)

648 
gch¨
 *
comböed_löe
;

649 
Àn1
;

651 
Àn1
 = 
	`ãxt_gë_löe_°æí
(
ãxt
, 
fú°_löe
);

653 
comböed_löe
 = 
	`g_°rc⁄ˇt
(
	`ãxt_gë_löe
(
ãxt
, 
fú°_löe
),

654 
	`ãxt_gë_löe
(
ãxt
, 
fú°_löe
 + 1), 
NULL
);

655 
	`ãxt_dñëe_löe
(
ãxt
, 
fú°_löe
);

656 
	`ãxt_£t_löe_ãxt
(
ãxt
, 
fú°_löe
, 
comböed_löe
);

657 
	`g_‰ì
(
comböed_löe
);

659 
ãxt
->
max_width
 = 
	`MAX
—ext->max_width, 
	`ãxt_gë_löe_width
—ext, 
fú°_löe
));

661 
ãxt
->
curs‹_row
 = 
fú°_löe
;

662 
ãxt
->
curs‹_pos
 = 
Àn1
;

663 
	}
}

666 
	$ãxt_dñëe_f‹w¨d
(
Text
 *
ãxt
)

668 
row
;

669 
i
;

670 
ªÆ
 
width
;

671 
gch¨
 *
löe
;

672 
gch¨
 *
utf8_bef‹e
, *
utf8_a·î
;

673 
gch¨
 *
°r1
, *
°r
;

675 
row
 = 
ãxt
->
curs‹_row
;

677 i‡(
ãxt
->
curs‹_pos
 >
	`ãxt_gë_löe_°æí
—ext, 
row
)) {

678 i‡(
row
 + 1 < 
ãxt
->
numlöes
)

679 
	`ãxt_joö_löes
(
ãxt
, 
row
);

683 
löe
 = 
	`ãxt_gë_löe
(
ãxt
, 
row
);

684 
utf8_bef‹e
 = 
	`g_utf8_off£t_to_poöãr
(
löe
, (
gl⁄g
)(
ãxt
->
curs‹_pos
));

685 
utf8_a·î
 = 
	`g_utf8_off£t_to_poöãr
(
utf8_bef‹e
, 1);

686 
°r1
 = 
	`g_°∫dup
(
löe
, 
utf8_bef‹e
 -Üine);

687 
°r
 = 
	`g_°rc⁄ˇt
(
°r1
, 
utf8_a·î
, 
NULL
);

688 
	`ãxt_£t_löe_ãxt
(
ãxt
, 
row
, 
°r
);

689 
	`g_‰ì
(
°r1
);

690 
	`g_‰ì
(
°r
);

692 i‡(
ãxt
->
curs‹_pos
 > 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
))

693 
ãxt
->
curs‹_pos
 = 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
);

695 
width
 = 0.0;

696 
i
 = 0; i < 
ãxt
->
numlöes
; i++) {

697 
width
 = 
	`MAX
(width, 
	`ãxt_gë_löe_width
(
ãxt
, 
i
));

699 
ãxt
->
max_width
 = 
width
;

700 
	}
}

703 
	$ãxt_dñëe_backw¨d
(
Text
 *
ãxt
)

705 
row
;

706 
i
;

707 
ªÆ
 
width
;

708 
gch¨
 *
löe
;

709 
gch¨
 *
utf8_bef‹e
, *
utf8_a·î
;

710 
gch¨
 *
°r1
, *
°r
;

712 
row
 = 
ãxt
->
curs‹_row
;

714 i‡(
ãxt
->
curs‹_pos
 <= 0) {

715 i‡(
row
 > 0)

716 
	`ãxt_joö_löes
(
ãxt
, 
row
-1);

720 
löe
 = 
	`ãxt_gë_löe
(
ãxt
, 
row
);

721 
utf8_bef‹e
 = 
	`g_utf8_off£t_to_poöãr
(
löe
, (
gl⁄g
)(
ãxt
->
curs‹_pos
 - 1));

722 
utf8_a·î
 = 
	`g_utf8_off£t_to_poöãr
(
utf8_bef‹e
, 1);

723 
°r1
 = 
	`g_°∫dup
(
löe
, 
utf8_bef‹e
 -Üine);

724 
°r
 = 
	`g_°rc⁄ˇt
(
°r1
, 
utf8_a·î
, 
NULL
);

725 
	`ãxt_£t_löe_ãxt
(
ãxt
, 
row
, 
°r
);

726 
	`g_‰ì
(
°r
);

727 
	`g_‰ì
(
°r1
);

729 
ãxt
->
curs‹_pos
 --;

730 i‡(
ãxt
->
curs‹_pos
 > 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
))

731 
ãxt
->
curs‹_pos
 = 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
);

733 
width
 = 0.0;

734 
i
 = 0; i < 
ãxt
->
numlöes
; i++) {

735 
width
 = 
	`MAX
(width, 
	`ãxt_gë_löe_width
(
ãxt
, 
i
));

737 
ãxt
->
max_width
 = 
width
;

738 
	}
}

741 
	$ãxt_•lô_löe
(
Text
 *
ãxt
)

743 
i
;

744 *
löe
;

745 
ªÆ
 
width
;

746 
gch¨
 *
utf8_bef‹e
;

747 
gch¨
 *
°r1
, *
°r2
;

750 
löe
 = 
	`ãxt_gë_löe
(
ãxt
,Åext->
curs‹_row
);

751 
	`ãxt_ö£π_löe
(
ãxt
,Åext->
curs‹_row
);

752 
utf8_bef‹e
 = 
	`g_utf8_off£t_to_poöãr
(
löe
, (
gl⁄g
)(
ãxt
->
curs‹_pos
));

753 
°r1
 = 
	`g_°∫dup
(
löe
, 
utf8_bef‹e
 -Üine);

754 
°r2
 = 
	`g_°rdup
(
utf8_bef‹e
);

755 
	`ãxt_£t_löe_ãxt
(
ãxt
,Åext->
curs‹_row
, 
°r1
);

756 
	`ãxt_£t_löe_ãxt
(
ãxt
,Åext->
curs‹_row
 + 1, 
°r2
);

757 
	`g_‰ì
(
°r2
);

758 
	`g_‰ì
(
°r1
);

760 
ãxt
->
curs‹_row
 ++;

761 
ãxt
->
curs‹_pos
 = 0;

763 
width
 = 0.0;

764 
i
=0;i<
ãxt
->
numlöes
;i++) {

765 
width
 = 
	`MAX
(width, 
	`ãxt_gë_löe_width
(
ãxt
, 
i
));

767 
ãxt
->
max_width
 = 
width
;

768 
	}
}

771 
	$ãxt_ö£π_ch¨
(
Text
 *
ãxt
, 
gunich¨
 
c
)

773 
gch¨
 
ch
[7];

774 
unûí
;

775 
row
;

776 
gch¨
 *
löe
, *
°r
;

777 
gch¨
 *
utf8_bef‹e
;

778 
gch¨
 *
°r1
;

781 
unûí
 = 
	`g_unich¨_to_utf8
 (
c
, 
ch
);

782 
ch
[
unûí
] = 0;

784 
row
 = 
ãxt
->
curs‹_row
;

787 
löe
 = 
	`ãxt_gë_löe
(
ãxt
, 
row
);

788 
utf8_bef‹e
 = 
	`g_utf8_off£t_to_poöãr
(
löe
, (
gl⁄g
)(
ãxt
->
curs‹_pos
));

789 
°r1
 = 
	`g_°∫dup
(
löe
, 
utf8_bef‹e
 -Üine);

790 
°r
 = 
	`g_°rc⁄ˇt
(
°r1
, 
ch
, 
utf8_bef‹e
, 
NULL
);

791 
	`ãxt_£t_löe_ãxt
(
ãxt
, 
row
, 
°r
);

792 
	`g_‰ì
(
°r
);

793 
	`g_‰ì
(
°r1
);

795 
ãxt
->
curs‹_pos
++;

796 
ãxt
->
max_width
 = 
	`MAX
—ext->max_width, 
	`ãxt_gë_löe_width
—ext, 
row
));

797 
	}
}

799 
gboﬁón


800 
	$ãxt_dñëe_key_h™dÀr
(
Focus
 *
focus
, 
Obje˘Ch™ge
 ** 
ch™ge
)

802 
Text
 *
ãxt
;

803 
row
, 
i
;

804 c⁄° *
utf
;

805 
gunich¨
 
c
;

807 
ãxt
 = (
Text
 *)
focus
->
u£r_d©a
;

808 
row
 = 
ãxt
->
curs‹_row
;

809 i‡(
ãxt
->
curs‹_pos
 >
	`ãxt_gë_löe_°æí
—ext, 
row
)) {

810 i‡(
row
+1 < 
ãxt
->
numlöes
) {

811 *
ch™ge
 = 
	`ãxt_¸óã_ch™ge
(
ãxt
, 
TYPE_JOIN_ROW
, 'Q',

812 
ãxt
->
curs‹_pos
, 
row
);

814  
FALSE
;

817 
utf
 = 
	`ãxt_gë_löe
(
ãxt
, 
row
);

818 
i
 = 0; i < 
ãxt
->
curs‹_pos
; i++)

819 
utf
 = 
	`g_utf8_√xt_ch¨
 (utf);

820 
c
 = 
	`g_utf8_gë_ch¨
 (
utf
);

821 *
ch™ge
 = 
	`ãxt_¸óã_ch™ge
 (
ãxt
, 
TYPE_DELETE_FORWARD
, 
c
,

822 
ãxt
->
curs‹_pos
,Åext->
curs‹_row
);

824 
	`ãxt_dñëe_f‹w¨d
(
ãxt
);

825  
TRUE
;;

826 
	}
}

829 
	$ãxt_key_evít
(
Focus
 *
focus
, 
guöt
 
keyvÆ
, c⁄° 
gch¨
 *
°r
, 
°æí
,

830 
Obje˘Ch™ge
 **
ch™ge
)

832 
Text
 *
ãxt
;

833 
ªtu∫_vÆ
 = 
FALSE
;

834 
row
, 
i
;

835 c⁄° *
utf
;

836 
gunich¨
 
c
;

838 *
ch™ge
 = 
NULL
;

840 
ãxt
 = (
Text
 *)
focus
->
u£r_d©a
;

842 
keyvÆ
) {

843 
GDK_Up
:

844 
ãxt
->
curs‹_row
--;

845 i‡(
ãxt
->
curs‹_row
<0)

846 
ãxt
->
curs‹_row
 = 0;

848 i‡(
ãxt
->
curs‹_pos
 > 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
))

849 
ãxt
->
curs‹_pos
 = 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
);

852 
GDK_Down
:

853 
ãxt
->
curs‹_row
++;

854 i‡(
ãxt
->
curs‹_row
 >ãxt->
numlöes
)

855 
ãxt
->
curs‹_row
 =Åext->
numlöes
 - 1;

857 i‡(
ãxt
->
curs‹_pos
 > 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
))

858 
ãxt
->
curs‹_pos
 = 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
);

861 
GDK_Le·
:

862 
ãxt
->
curs‹_pos
--;

863 i‡(
ãxt
->
curs‹_pos
<0)

864 
ãxt
->
curs‹_pos
 = 0;

866 
GDK_Right
:

867 
ãxt
->
curs‹_pos
++;

868 i‡(
ãxt
->
curs‹_pos
 > 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
))

869 
ãxt
->
curs‹_pos
 = 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
);

871 
GDK_Home
:

872 
ãxt
->
curs‹_pos
 = 0;

874 
GDK_End
:

875 
ãxt
->
curs‹_pos
 = 
	`ãxt_gë_löe_°æí
—ext,Åext->
curs‹_row
);

877 
GDK_Dñëe
:

878 
ªtu∫_vÆ
 = 
	`ãxt_dñëe_key_h™dÀr
(
focus
, 
ch™ge
);

880 
GDK_BackS∑˚
:

881 
ªtu∫_vÆ
 = 
TRUE
;

882 
row
 = 
ãxt
->
curs‹_row
;

883 i‡(
ãxt
->
curs‹_pos
 <= 0) {

884 i‡(
row
 > 0) {

885 *
ch™ge
 = 
	`ãxt_¸óã_ch™ge
(
ãxt
, 
TYPE_JOIN_ROW
, 'Q',

886 
	`ãxt_gë_löe_°æí
(
ãxt
, 
row
-1),Ñow-1);

888 
ªtu∫_vÆ
 = 
FALSE
;

892 
utf
 = 
	`ãxt_gë_löe
(
ãxt
, 
row
);

893 
i
 = 0; i < (
ãxt
->
curs‹_pos
 - 1); i++)

894 
utf
 = 
	`g_utf8_√xt_ch¨
 (utf);

895 
c
 = 
	`g_utf8_gë_ch¨
 (
utf
);

896 *
ch™ge
 = 
	`ãxt_¸óã_ch™ge
 (
ãxt
, 
TYPE_DELETE_BACKWARD
, 
c
,

897 
ãxt
->
curs‹_pos
 - 1,

898 
ãxt
->
curs‹_row
);

900 
	`ãxt_dñëe_backw¨d
(
ãxt
);

902 
GDK_Rëu∫
:

903 
GDK_KP_E¡î
:

904 
ªtu∫_vÆ
 = 
TRUE
;

905 *
ch™ge
 = 
	`ãxt_¸óã_ch™ge
(
ãxt
, 
TYPE_SPLIT_ROW
, 'Q',

906 
ãxt
->
curs‹_pos
,Åext->
curs‹_row
);

907 
	`ãxt_•lô_löe
(
ãxt
);

909 
GDK_Shi·_L
:

910 
GDK_Shi·_R
:

911 
GDK_C⁄åﬁ_L
:

912 
GDK_C⁄åﬁ_R
:

913 
GDK_A…_L
:

914 
GDK_A…_R
:

915 
GDK_Mëa_L
:

916 
GDK_Mëa_R
:

917 
ªtu∫_vÆ
 = 
FALSE
;

920 i‡(
°r
 || (
°æí
>0)) {

921 i‡(
°æí
 =1 && *
°r
 == '\r')

923 
ªtu∫_vÆ
 = 
TRUE
;

924 
utf
 = 
°r
;

925 
utf
 = 
°r
; ut‡&& *ut‡&& 
°æí
 > 0 ;

926 
utf
 = 
	`g_utf8_√xt_ch¨
 (utf), 
°æí
--) {

927 
c
 = 
	`g_utf8_gë_ch¨
 (
utf
);

929 *
ch™ge
 = 
	`ãxt_¸óã_ch™ge
 (
ãxt
, 
TYPE_INSERT_CHAR
, 
c
,

930 
ãxt
->
curs‹_pos
,Åext->
curs‹_row
);

931 
	`ãxt_ö£π_ch¨
 (
ãxt
, 
c
);

937  
ªtu∫_vÆ
;

938 
	}
}

940 
	$ãxt_is_em±y
(
Text
 *
ãxt
)

942 
i
;

943 
i
 = 0; i < 
ãxt
->
numlöes
; i++) {

944 i‡(
	`ãxt_gë_löe_°æí
(
ãxt
, 
i
) != 0) {

945  
FALSE
;

948  
TRUE
;

949 
	}
}

952 
	$ãxt_dñëe_Æl
(
Text
 *
ãxt
, 
Obje˘Ch™ge
 **
ch™ge
)

954 i‡(!
	`ãxt_is_em±y
(
ãxt
)) {

955 *
ch™ge
 = 
	`ãxt_¸óã_ch™ge
(
ãxt
, 
TYPE_DELETE_ALL
,

956 0, 
ãxt
->
curs‹_pos
,Åext->
curs‹_row
);

958 
	`ãxt_£t_°rög
(
ãxt
, "");

959 
	`ˇlc_as˚¡_des˚¡
(
ãxt
);

960  
TRUE
;

962  
FALSE
;

963 
	}
}

966 
	$d©a_add_ãxt
(
AâribuãNode
 
©å
, 
Text
 *
ãxt
)

968 
D©aNode
 
composôe
;

969 *
°r
;

971 
composôe
 = 
	`d©a_add_composôe
(
©å
, "text");

973 
°r
 = 
	`ãxt_gë_°rög_c›y
(
ãxt
);

974 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "string"),

975 
°r
);

976 
	`g_‰ì
(
°r
);

977 
	`d©a_add_f⁄t
(
	`composôe_add_©åibuã
(
composôe
, "font"),

978 
ãxt
->
f⁄t
);

979 
	`d©a_add_ªÆ
(
	`composôe_add_©åibuã
(
composôe
, "height"),

980 
ãxt
->
height
);

981 
	`d©a_add_poöt
(
	`composôe_add_©åibuã
(
composôe
, "pos"),

982 &
ãxt
->
posôi⁄
);

983 
	`d©a_add_cﬁ‹
(
	`composôe_add_©åibuã
(
composôe
, "color"),

984 &
ãxt
->
cﬁ‹
);

985 
	`d©a_add_íum
(
	`composôe_add_©åibuã
(
composôe
, "alignment"),

986 
ãxt
->
Æignmít
);

987 
	}
}

990 
Text
 *

991 
	$d©a_ãxt
(
AâribuãNode
 
ãxt_©å
)

993 *
°rög
 = 
NULL
;

994 
DüF⁄t
 *
f⁄t
;

995 
ªÆ
 
height
;

996 
Poöt
 
pos
 = {0.0, 0.0};

997 
Cﬁ‹
 
cﬁ
;

998 
Alignmít
 
Æign
;

999 
AâribuãNode
 
©å
;

1000 
D©aNode
 
composôe_node
;

1001 
Text
 *
ãxt
;

1003 
composôe_node
 = 
	`©åibuã_fú°_d©a
(
ãxt_©å
);

1005 
©å
 = 
	`composôe_föd_©åibuã
(
ãxt_©å
, "string");

1006 i‡(
©å
 !
NULL
)

1007 
°rög
 = 
	`d©a_°rög
(
	`©åibuã_fú°_d©a
(
©å
));

1009 
height
 = 1.0;

1010 
©å
 = 
	`composôe_föd_©åibuã
(
ãxt_©å
, "height");

1011 i‡(
©å
 !
NULL
)

1012 
height
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

1014 
©å
 = 
	`composôe_föd_©åibuã
(
ãxt_©å
, "font");

1015 i‡(
©å
 !
NULL
) {

1016 
f⁄t
 = 
	`d©a_f⁄t
(
	`©åibuã_fú°_d©a
(
©å
));

1018 
f⁄t
 = 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_SANS
,1.0);

1021 
©å
 = 
	`composôe_föd_©åibuã
(
ãxt_©å
, "pos");

1022 i‡(
©å
 !
NULL
)

1023 
	`d©a_poöt
(
	`©åibuã_fú°_d©a
(
©å
), &
pos
);

1025 
cﬁ
 = 
cﬁ‹_bœck
;

1026 
©å
 = 
	`composôe_föd_©åibuã
(
ãxt_©å
, "color");

1027 i‡(
©å
 !
NULL
)

1028 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
cﬁ
);

1030 
Æign
 = 
ALIGN_LEFT
;

1031 
©å
 = 
	`composôe_föd_©åibuã
(
ãxt_©å
, "alignment");

1032 i‡(
©å
 !
NULL
)

1033 
Æign
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

1035 
ãxt
 = 
	`√w_ãxt
(
°rög
 ? såög : "", 
f⁄t
, 
height
, &
pos
, &
cﬁ
, 
Æign
);

1036 i‡(
f⁄t
Ë
	`dü_f⁄t_uƒef
(font);

1037 i‡(
°rög
Ë
	`g_‰ì
(string);

1038  
ãxt
;

1039 
	}
}

1042 
	$ãxt_gë_©åibuãs
(
Text
 *
ãxt
, 
TextAâribuãs
 *
©å
)

1044 
DüF⁄t
 *
ﬁd_f⁄t
;

1045 
ﬁd_f⁄t
 = 
©å
->
f⁄t
;

1046 
©å
->
f⁄t
 = 
	`dü_f⁄t_ªf
(
ãxt
->font);

1047 i‡(
ﬁd_f⁄t
 !
NULL
Ë
	`dü_f⁄t_uƒef
(old_font);

1048 
©å
->
height
 = 
ãxt
->height;

1049 
©å
->
posôi⁄
 = 
ãxt
->position;

1050 
©å
->
cﬁ‹
 = 
ãxt
->color;

1051 
©å
->
Æignmít
 = 
ãxt
->alignment;

1052 
	}
}

1055 
	$ãxt_£t_©åibuãs
(
Text
 *
ãxt
, 
TextAâribuãs
 *
©å
)

1057 i‡(
ãxt
->
f⁄t
 !
©å
->font) {

1058 
	`ãxt_£t_f⁄t
(
ãxt
, 
©å
->
f⁄t
);

1060 
	`ãxt_£t_height
(
ãxt
, 
©å
->
height
);

1061 
ãxt
->
posôi⁄
 = 
©å
->position;

1062 
ãxt
->
cﬁ‹
 = 
©å
->color;

1063 
ãxt
->
Æignmít
 = 
©å
->alignment;

1064 
	}
}

1067 
	$ãxt_ch™ge_≠∂y
(
TextObje˘Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1069 
Text
 *
ãxt
 = 
ch™ge
->text;

1070 
ch™ge
->
ty≥
) {

1071 
TYPE_INSERT_CHAR
:

1072 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
;

1073 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1074 
	`ãxt_ö£π_ch¨
(
ãxt
, 
ch™ge
->
ch
);

1076 
TYPE_DELETE_BACKWARD
:

1077 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
+1;

1078 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1079 
	`ãxt_dñëe_backw¨d
(
ãxt
);

1081 
TYPE_DELETE_FORWARD
:

1082 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
;

1083 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1084 
	`ãxt_dñëe_f‹w¨d
(
ãxt
);

1086 
TYPE_SPLIT_ROW
:

1087 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
;

1088 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1089 
	`ãxt_•lô_löe
(
ãxt
);

1091 
TYPE_JOIN_ROW
:

1092 
	`ãxt_joö_löes
(
ãxt
, 
ch™ge
->
row
);

1094 
TYPE_DELETE_ALL
:

1095 
	`£t_°rög
(
ãxt
, "");

1096 
ãxt
->
curs‹_pos
 = 0;

1097 
ãxt
->
curs‹_row
 = 0;

1100 
	}
}

1103 
	$ãxt_ch™ge_ªvît
(
TextObje˘Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

1105 
Text
 *
ãxt
 = 
ch™ge
->text;

1106 
ch™ge
->
ty≥
) {

1107 
TYPE_INSERT_CHAR
:

1108 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
;

1109 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1110 
	`ãxt_dñëe_f‹w¨d
(
ãxt
);

1112 
TYPE_DELETE_BACKWARD
:

1113 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
;

1114 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1115 
	`ãxt_ö£π_ch¨
(
ãxt
, 
ch™ge
->
ch
);

1117 
TYPE_DELETE_FORWARD
:

1118 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
;

1119 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1120 
	`ãxt_ö£π_ch¨
(
ãxt
, 
ch™ge
->
ch
);

1121 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
;

1122 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1124 
TYPE_SPLIT_ROW
:

1125 
	`ãxt_joö_löes
(
ãxt
, 
ch™ge
->
row
);

1127 
TYPE_JOIN_ROW
:

1128 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
;

1129 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1130 
	`ãxt_•lô_löe
(
ãxt
);

1132 
TYPE_DELETE_ALL
:

1133 
	`£t_°rög
(
ãxt
, 
ch™ge
->
°r
);

1134 
ãxt
->
curs‹_pos
 = 
ch™ge
->
pos
;

1135 
ãxt
->
curs‹_row
 = 
ch™ge
->
row
;

1138 
	}
}

1141 
	$ãxt_ch™ge_‰ì
(
TextObje˘Ch™ge
 *
ch™ge
) {

1142 
	`g_‰ì
(
ch™ge
->
°r
);

1143 
	}
}

1145 
Obje˘Ch™ge
 *

1146 
	$ãxt_¸óã_ch™ge
(
Text
 *
ãxt
, 
ch™ge_ty≥
 
ty≥
,

1147 
gunich¨
 
ch
, 
pos
, 
row
)

1149 
TextObje˘Ch™ge
 *
ch™ge
;

1151 
ch™ge
 = 
	`g_√w0
(
TextObje˘Ch™ge
, 1);

1153 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
ãxt_ch™ge_≠∂y
;

1154 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
ãxt_ch™ge_ªvît
;

1155 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
ãxt_ch™ge_‰ì
;

1157 
ch™ge
->
ãxt
 =Åext;

1158 
ch™ge
->
ty≥
 =Åype;

1159 
ch™ge
->
ch
 = ch;

1160 
ch™ge
->
pos
 =Öos;

1161 
ch™ge
->
row
 =Ñow;

1162 i‡(
ty≥
 =
TYPE_DELETE_ALL
)

1163 
ch™ge
->
°r
 = 
	`ãxt_gë_°rög_c›y
(
ãxt
);

1165 
ch™ge
->
°r
 = 
NULL
;

1166  (
Obje˘Ch™ge
 *)
ch™ge
;

1167 
	}
}

1169 
gboﬁón


1170 
	$≠∂y_ãxèâr_¥›îtõs
(
GPåAºay
 *
¥›s
,

1171 
Text
 *
ãxt
, c⁄° 
gch¨
 *
ãxäame
,

1172 
TextAâribuãs
 *
©ås
)

1174 
TextPr›îty
 *
ãxçr›
 =

1175 (
TextPr›îty
 *)
	`föd_¥›_by_«me_™d_ty≥
(
¥›s
,
ãxäame
,
PROP_TYPE_TEXT
);

1177 i‡((!
ãxçr›
) ||

1178 ((
ãxçr›
->
comm⁄
.
ex≥rõn˚
 & (
PXP_LOADED
|
PXP_SFO
))==0 )) {

1180 
	`ãxt_£t_©åibuãs
(
ãxt
,
©ås
);

1181  
TRUE
;

1183  
FALSE
;

1184 
	}
}

1186 
gboﬁón


1187 
	$≠∂y_ãxt°r_¥›îtõs
(
GPåAºay
 *
¥›s
,

1188 
Text
 *
ãxt
, c⁄° 
gch¨
 *
ãxäame
,

1189 c⁄° 
gch¨
 *
°r
)

1191 
TextPr›îty
 *
ãxçr›
 =

1192 (
TextPr›îty
 *)
	`föd_¥›_by_«me_™d_ty≥
(
¥›s
,
ãxäame
,
PROP_TYPE_TEXT
);

1194 i‡((!
ãxçr›
) ||

1195 ((
ãxçr›
->
comm⁄
.
ex≥rõn˚
 & (
PXP_LOADED
|
PXP_SFO
))==0 )) {

1197 
	`ãxt_£t_°rög
(
ãxt
,
°r
);

1198  
TRUE
;

1200  
FALSE
;

1201 
	}
}

	@O:\tool\dvs50\lib\text.h

18 #i‚de‡
TEXT_H


19 
	#TEXT_H


	)

22 
	mTEXT_EDIT_START
,

23 
	mTEXT_EDIT_CHANGE
,

24 
	mTEXT_EDIT_END


25 } 
	tTextEdôSèã
;

27 
	~<glib.h
>

28 
	~"düty≥s.h
"

29 
	~"ãxèâr.h
"

30 
	~"focus.h
"

31 
	~"¥›îtõs.h
"

33 
	#USE_TEXTLINE_FOR_LINES


	)

35 
	s_Text
 {

37 
DüObje˘
 *
	m∑ª¡_obje˘
;

41 
	mnumlöes
;

42 
TextLöe
 **
	mlöes
;

45 
DüF⁄t
 *
	mf⁄t
;

46 
ªÆ
 
	mheight
;

47 
Poöt
 
	mposôi⁄
;

48 
Cﬁ‹
 
	mcﬁ‹
;

49 
Alignmít
 
	mÆignmít
;

52 
	mcurs‹_pos
;

53 
	mcurs‹_row
;

54 
Focus
 
	mfocus
;

57 
ªÆ
 
	mas˚¡
;

58 
ªÆ
 
	mdes˚¡
;

59 
ªÆ
 
	mmax_width
;

64 
DIAVAR
 
Text
 *
√w_ãxt
(c⁄° *
°rög
, 
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
,

65 
Poöt
 *
pos
, 
Cﬁ‹
 *
cﬁ‹
, 
Alignmít
 
Æign
);

66 
DIAVAR
 
ãxt_de°roy
(
Text
 *
ãxt
);

67 
DIAVAR
 
Text
 *
ãxt_c›y
(Texà*
ãxt
);

68 
DIAVAR
 
gch¨
 *
ãxt_gë_löe
(
Text
 *
ãxt
, 
löe
);

69 
DIAVAR
 *
ãxt_gë_°rög_c›y
(
Text
 *
ãxt
);

70 
DIAVAR
 
ãxt_£t_°rög
(
Text
 *
ãxt
, c⁄° *
°rög
);

71 
DIAVAR
 
ãxt_£t_height
(
Text
 *
ãxt
, 
ªÆ
 
height
);

72 
DIAVAR
 
ãxt_£t_f⁄t
(
Text
 *
ãxt
, 
DüF⁄t
 *
f⁄t
);

73 
DIAVAR
 
ãxt_£t_posôi⁄
(
Text
 *
ãxt
, 
Poöt
 *
pos
);

74 
DIAVAR
 
ãxt_£t_cﬁ‹
(
Text
 *
ãxt
, 
Cﬁ‹
 *
cﬁ
);

75 
DIAVAR
 
ãxt_£t_Æignmít
(
Text
 *
ãxt
, 
Alignmít
 
Æign
);

76 
DIAVAR
 
ªÆ
 
ãxt_di°™˚_‰om
(
Text
 *
ãxt
, 
Poöt
 *
poöt
);

77 
DIAVAR
 
ãxt_ˇlc_boundögbox
(
Text
 *
ãxt
, 
Re˘™gÀ
 *
box
);

78 
DIAVAR
 
ãxt_døw
(
Text
 *
ãxt
, 
DüRídîî
 *
ªndîî
);

79 
DIAVAR
 
ãxt_£t_curs‹
(
Text
 *
ãxt
, 
Poöt
 *
˛icked_poöt
,

80 
DüRídîî
 *
öãø˘ive_ªndîî
);

81 
DIAVAR
 
ãxt_£t_curs‹_©_íd
–
Text
* 
ãxt
 );

82 
DIAVAR
 
ãxt_gøb_focus
(
Text
 *
ãxt
, 
DüObje˘
 *
obje˘
);

83 
DIAVAR
 
ãxt_is_em±y
(
Text
 *
ãxt
);

84 
DIAVAR
 
ãxt_dñëe_Æl
(
Text
 *
ãxt
, 
Obje˘Ch™ge
 **
ch™ge
);

85 
DIAVAR
 
ãxt_gë_©åibuãs
(
Text
 *
ãxt
, 
TextAâribuãs
 *
©å
);

86 
DIAVAR
 
ãxt_£t_©åibuãs
(
Text
 *
ãxt
, 
TextAâribuãs
 *
©å
);

88 
DIAVAR
 
ªÆ
 
ãxt_gë_löe_width
(
Text
 *
ãxt
, 
löe_no
);

89 
DIAVAR
 
ãxt_gë_löe_°æí
(
Text
 *
ãxt
, 
löe_no
);

90 
DIAVAR
 
ªÆ
 
ãxt_gë_max_width
(
Text
 *
ãxt
);

91 
DIAVAR
 
ªÆ
 
ãxt_gë_as˚¡
(
Text
 *
ãxt
);

92 
DIAVAR
 
ªÆ
 
ãxt_gë_des˚¡
(
Text
 *
ãxt
);

96 
DIAVAR
 
gboﬁón
 
ãxt_dñëe_key_h™dÀr
(
Focus
 *
focus
, 
Obje˘Ch™ge
 **
ch™ge
);

97 
DIAVAR
 
d©a_add_ãxt
(
AâribuãNode
 
©å
, 
Text
 *
ãxt
);

98 
DIAVAR
 
Text
 *
d©a_ãxt
(
AâribuãNode
 
©å
);

99 
DIAVAR
 
gboﬁón
 
≠∂y_ãxèâr_¥›îtõs
(
GPåAºay
 *
¥›s
,

100 
Text
 *
ãxt
, c⁄° 
gch¨
 *
ãxäame
,

101 
TextAâribuãs
 *
©ås
);

102 
DIAVAR
 
gboﬁón
 
≠∂y_ãxt°r_¥›îtõs
(
GPåAºay
 *
¥›s
,

103 
Text
 *
ãxt
, c⁄° 
gch¨
 *
ãxäame
,

104 c⁄° 
gch¨
 *
°r
);

	@O:\tool\dvs50\lib\textattr.h

18 #i‚de‡
TEXTATTR_H


19 
	#TEXTATTR_H


	)

21 
	~"düty≥s.h
"

22 
	~"f⁄t.h
"

23 
	~"geomëry.h
"

24 
	~"cﬁ‹.h
"

26 
	s_TextAâribuãs
 {

27 
DüF⁄t
 *
	mf⁄t
;

28 
ªÆ
 
	mheight
;

29 
Poöt
 
	mposôi⁄
;

30 
Cﬁ‹
 
	mcﬁ‹
;

31 
Alignmít
 
	mÆignmít
;

	@O:\tool\dvs50\lib\textline.c

18 
	~<c⁄fig.h
>

20 
	~<°dio.h
>

21 
	~<°dlib.h
>

22 
	~<°rög.h
>

23 
	~<glib.h
>

24 
	~<m©h.h
>

26 
	~<gdk/gdkkeysyms.h
>

28 
	~"¥›öã∫Æs.h
"

29 
	~"ãxt.h
"

30 
	~"mesßge.h
"

31 
	~"ãxéöe.h
"

33 
ãxt_löe_dúty_ˇche
(
TextLöe
 *
ãxt_löe
);

34 
ãxt_löe_ˇche_vÆues
(
TextLöe
 *
ãxt_löe
);

35 
˛ór_œyout_off£t
 (
TextLöe
 *
ãxt_löe
);

42 
	$ãxt_löe_£t_°rög
(
TextLöe
 *
ãxt_löe
, c⁄° 
gch¨
 *
°rög
)

44 i‡(
ãxt_löe
->
ch¨s
 =
NULL
 ||

45 
	`°rcmp
(
ãxt_löe
->
ch¨s
, 
°rög
)) {

46 i‡(
ãxt_löe
->
ch¨s
 !
NULL
) {

47 
	`g_‰ì
(
ãxt_löe
->
ch¨s
);

50 
ãxt_löe
->
ch¨s
 = 
	`g_°rdup
(
°rög
);

52 
	`ãxt_löe_dúty_ˇche
(
ãxt_löe
);

54 
	}
}

61 
	$ãxt_löe_£t_f⁄t
(
TextLöe
 *
ãxt_löe
, 
DüF⁄t
 *
f⁄t
)

63 i‡(
ãxt_löe
->
f⁄t
 != font) {

64 
DüF⁄t
 *
ﬁd_f⁄t
 = 
ãxt_löe
->
f⁄t
;

65 
	`dü_f⁄t_ªf
(
f⁄t
);

66 
ãxt_löe
->
f⁄t
 = font;

67 i‡(
ﬁd_f⁄t
 !
NULL
) {

68 
	`dü_f⁄t_uƒef
(
ﬁd_f⁄t
);

70 
	`ãxt_löe_dúty_ˇche
(
ãxt_löe
);

72 
	}
}

80 
	$ãxt_löe_£t_height
(
TextLöe
 *
ãxt_löe
, 
ªÆ
 
height
)

82 i‡(
	`Ábs
(
ãxt_löe
->
height
 - height) > 0.00001) {

83 
ãxt_löe
->
height
 = height;

84 
	`ãxt_löe_dúty_ˇche
(
ãxt_löe
);

86 
	}
}

93 
TextLöe
 *

94 
	$ãxt_löe_√w
(c⁄° 
gch¨
 *
°rög
, 
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
)

96 
TextLöe
 *
ãxt_löe
 = 
	`g_√w0
(TextLine, 1);

98 
	`ãxt_löe_£t_°rög
(
ãxt_löe
, 
°rög
);

99 
	`ãxt_löe_£t_f⁄t
(
ãxt_löe
, 
f⁄t
);

100 
	`ãxt_löe_£t_height
(
ãxt_löe
, 
height
);

102  
ãxt_löe
;

103 
	}
}

105 
TextLöe
 *

106 
	$ãxt_löe_c›y
(c⁄° 
TextLöe
 *
ãxt_löe
)

108  
	`ãxt_löe_√w
(
ãxt_löe
->
ch¨s
,Åext_löe->
f⁄t
,Åext_löe->
height
);

109 
	}
}

116 
	$ãxt_löe_de°roy
(
TextLöe
 *
ãxt_löe
)

118 i‡(
ãxt_löe
->
ch¨s
 !
NULL
) {

119 
	`g_‰ì
(
ãxt_löe
->
ch¨s
);

121 i‡(
ãxt_löe
->
f⁄t
 !
NULL
) {

122 
	`dü_f⁄t_uƒef
(
ãxt_löe
->
f⁄t
);

124 
	`˛ór_œyout_off£t
 (
ãxt_löe
);

125 
	`g_‰ì
 (
ãxt_löe
->
off£ts
);

126 
	`g_‰ì
(
ãxt_löe
);

127 
	}
}

135 
	$ãxt_löe_ˇlc_boundögbox_size
(
TextLöe
 *
ãxt_löe
, 
Poöt
 *
size
)

137 
	`ãxt_löe_ˇche_vÆues
(
ãxt_löe
);

139 
size
->
x
 = 
ãxt_löe
->
width
;

140 
size
->
y
 = 
ãxt_löe
->
as˚¡
 +Åext_löe->
des˚¡
;

141 
	}
}

143 
gch¨
 *

144 
	$ãxt_löe_gë_°rög
(c⁄° 
TextLöe
 *
ãxt_löe
)

146  
ãxt_löe
->
ch¨s
;

147 
	}
}

149 
DüF⁄t
 *

150 
	$ãxt_löe_gë_f⁄t
(c⁄° 
TextLöe
 *
ãxt_löe
)

152  
ãxt_löe
->
f⁄t
;

153 
	}
}

155 
ªÆ


156 
	$ãxt_löe_gë_height
(c⁄° 
TextLöe
 *
ãxt_löe
)

158  
ãxt_löe
->
height
;

159 
	}
}

161 
ªÆ


162 
	$ãxt_löe_gë_width
(c⁄° 
TextLöe
 *
ãxt_löe
)

164 
	`ãxt_löe_ˇche_vÆues
((
TextLöe
 *)
ãxt_löe
);

165  
ãxt_löe
->
width
;

166 
	}
}

168 
ªÆ


169 
	$ãxt_löe_gë_as˚¡
(c⁄° 
TextLöe
 *
ãxt_löe
)

171 
	`ãxt_löe_ˇche_vÆues
((
TextLöe
 *)
ãxt_löe
);

172  
ãxt_löe
->
as˚¡
;

173 
	}
}

175 
ªÆ


176 
	$ãxt_löe_gë_des˚¡
(c⁄° 
TextLöe
 *
ãxt_löe
)

178 
	`ãxt_löe_ˇche_vÆues
((
TextLöe
 *)
ãxt_löe
);

179  
ãxt_löe
->
des˚¡
;

180 
	}
}

190 
ªÆ


191 
	$ãxt_löe_gë_Æignmít_adju°mít
(
TextLöe
 *
ãxt_löe
, 
Alignmít
 
Æignmít
)

193 
	`ãxt_löe_ˇche_vÆues
(
ãxt_löe
);

194 
Æignmít
) {

195 
ALIGN_CENTER
:

196  
ãxt_löe
->
width
 / 2;

197 
ALIGN_RIGHT
:

198  
ãxt_löe
->
width
;

202 
	}
}

209 
	$ãxt_löe_dúty_ˇche
(
TextLöe
 *
ãxt_löe
)

211 
ãxt_löe
->
˛ón
 = 
FALSE
;

212 
	}
}

215 
	$˛ór_œyout_off£t
 (
TextLöe
 *
ãxt_löe
)

217 i‡(
ãxt_löe
->
œyout_off£ts
 !
NULL
) {

218 
GSLi°
 *
runs
 = 
ãxt_löe
->
œyout_off£ts
->runs;

220 ; 
runs
 !
NULL
;Ñun†
	`g_¶i°_√xt
(runs)) {

221 
P™goGlyphIãm
 *
run
 = (P™goGlyphIãm *Ë
runs
->
d©a
;

223 
	`g_‰ì
(
run
->
glyphs
->glyphs);

224 
	`g_‰ì
(
run
->
glyphs
);

226 
	`g_¶i°_‰ì
(
runs
);

227 
	`g_‰ì
(
ãxt_löe
->
œyout_off£ts
);

228 
ãxt_löe
->
œyout_off£ts
 = 
NULL
;

230 
	}
}

233 
	$ãxt_löe_ˇche_vÆues
(
TextLöe
 *
ãxt_löe
)

235 i‡(!
ãxt_löe
->
˛ón
 ||

236 
ãxt_löe
->
ch¨s
 !ãxt_löe->
ch¨s_ˇche
 ||

237 
ãxt_löe
->
f⁄t
 !ãxt_löe->
f⁄t_ˇche
 ||

238 
ãxt_löe
->
height
 !ãxt_löe->
height_ˇche
) {

239 
n_off£ts
;

241 i‡(
ãxt_löe
->
off£ts
 !
NULL
) {

242 
	`g_‰ì
(
ãxt_löe
->
off£ts
);

243 
ãxt_löe
->
off£ts
 = 
NULL
;

245 
	`˛ór_œyout_off£t
 (
ãxt_löe
);

247 i‡(
ãxt_löe
->
ch¨s
 =
NULL
 ||

248 
ãxt_löe
->
ch¨s
[0] == '\0') {

250 
ãxt_löe
->
off£ts
 =

251 
	`dü_f⁄t_gë_sizes
("XjgM149", 
ãxt_löe
->
f⁄t
,Åext_löe->
height
,

252 &
ãxt_löe
->
width
, &ãxt_löe->
as˚¡
,

253 &
ãxt_löe
->
des˚¡
, &
n_off£ts
,

254 &
ãxt_löe
->
œyout_off£ts
);

255 
	`˛ór_œyout_off£t
 (
ãxt_löe
);

256 
	`g_‰ì
 (
ãxt_löe
->
off£ts
);

257 
ãxt_löe
->
off£ts
 = 
	`g_√w
 (
ªÆ
,0);

258 
ãxt_löe
->
width
 = 0;

260 
ãxt_löe
->
off£ts
 =

261 
	`dü_f⁄t_gë_sizes
(
ãxt_löe
->
ch¨s
,Åext_löe->
f⁄t
,Åext_löe->
height
,

262 &
ãxt_löe
->
width
, &ãxt_löe->
as˚¡
,

263 &
ãxt_löe
->
des˚¡
, &
n_off£ts
,

264 &
ãxt_löe
->
œyout_off£ts
);

266 
ãxt_löe
->
˛ón
 = 
TRUE
;

267 
ãxt_löe
->
ch¨s_ˇche
 =Åext_löe->
ch¨s
;

268 
ãxt_löe
->
f⁄t_ˇche
 =Åext_löe->
f⁄t
;

269 
ãxt_löe
->
height_ˇche
 =Åext_löe->
height
;

271 
	}
}

280 
	$ãxt_löe_adju°_glyphs
(
TextLöe
 *
löe
, 
P™goGlyphSåög
 *
glyphs
, 
ªÆ
 
sˇÀ
)

282 
i
;

284 
i
 = 0; i < 
glyphs
->
num_glyphs
; i++) {

290 
glyphs
->glyphs[
i
].
geomëry
.
width
 =

291 ()(
löe
->
off£ts
[
i
] * 
sˇÀ
 * 20.0 * 
PANGO_SCALE
);

293 
	}
}

304 
	$ãxt_löe_adju°_œyout_löe
(
TextLöe
 *
löe
, 
P™goLayoutLöe
 *
œyouéöe
,

305 
ªÆ
 
sˇÀ
)

307 
GSLi°
 *
œyouåuns
 = 
œyouéöe
->
runs
;

308 
GSLi°
 *
runs
;

310 i‡(
löe
->
œyout_off£ts
 =
NULL
) {

314 
runs
 = 
löe
->
œyout_off£ts
->runs;

316 i‡(
	`g_¶i°_Àngth
(
runs
Ë!g_¶i°_Àngth(
œyouåuns
)) {

317 
	`¥ötf
("RunsÜengthÉrror: %d != %d\n",

318 
	`g_¶i°_Àngth
(
löe
->
œyout_off£ts
->
runs
),

319 
	`g_¶i°_Àngth
(
œyouéöe
->
runs
));

321 ; 
runs
 !
NULL
 && 
œyouåuns
 !NULL;Ñun†
	`g_¶i°_√xt
(runs),

322 
œyouåuns
 = 
	`g_¶i°_√xt
(layoutruns)) {

323 
P™goGlyphSåög
 *
glyphs
 = ((
P™goLayoutRun
 *Ë
runs
->
d©a
)->glyphs;

324 
P™goGlyphSåög
 *
œyoutglyphs
 =

325 ((
P™goLayoutRun
 *Ë
œyouåuns
->
d©a
)->
glyphs
;

326 
i
;

328 
i
 = 0; i < 
glyphs
->
num_glyphs
 && i < 
œyoutglyphs
->num_glyphs; i++) {

329 
œyoutglyphs
->
glyphs
[
i
].
geomëry
.
width
 =

330 ()(
glyphs
->glyphs[
i
].
geomëry
.
width
 * 
sˇÀ
 / 20.0);

331 
œyoutglyphs
->
glyphs
[
i
].
geomëry
.
x_off£t
 =

332 ()(
glyphs
->glyphs[
i
].
geomëry
.
x_off£t
 * 
sˇÀ
 / 20.0);

333 
œyoutglyphs
->
glyphs
[
i
].
geomëry
.
y_off£t
 =

334 ()(
glyphs
->glyphs[
i
].
geomëry
.
y_off£t
 * 
sˇÀ
 / 20.0);

336 i‡(
glyphs
->
num_glyphs
 !
œyoutglyphs
->num_glyphs) {

337 
	`¥ötf
("GlyphÜengthÉrror: %d != %d\n",

338 
glyphs
->
num_glyphs
, 
œyoutglyphs
->num_glyphs);

341 
	}
}

	@O:\tool\dvs50\lib\textline.h

18 #i‚de‡
TEXTLINE_H


19 
	#TEXTLINE_H


	)

27 
	~<glib.h
>

28 
	~"düty≥s.h
"

29 
	~"¥›îtõs.h
"

30 
	~"düv¨.h
"

32 
	s_TextLöe
 {

36 
gch¨
 *
	mch¨s
;

39 
DüF⁄t
 *
	mf⁄t
;

40 
ªÆ
 
	mheight
;

43 
ªÆ
 
	mas˚¡
;

44 
ªÆ
 
	mdes˚¡
;

45 
ªÆ
 
	mwidth
;

49 
gboﬁón
 
	m˛ón
;

54 
gch¨
 *
	mch¨s_ˇche
;

55 
DüF⁄t
 *
	mf⁄t_ˇche
;

56 
ªÆ
 
	mheight_ˇche
;

59 
ªÆ
 *
	moff£ts
;

60 
P™goLayoutLöe
 *
	mœyout_off£ts
;

63 
DIAVAR
 
TextLöe
 *
ãxt_löe_√w
(c⁄° 
gch¨
 *
°rög
, 
DüF⁄t
 *
f⁄t
, 
ªÆ
 
height
);

64 
DIAVAR
 
ãxt_löe_de°roy
(
TextLöe
 *
ãxt
);

65 
DIAVAR
 
TextLöe
 *
ãxt_löe_c›y
(c⁄° TextLöê*
ãxt
);

66 
DIAVAR
 
ãxt_löe_£t_°rög
(
TextLöe
 *
ãxt
, c⁄° *
°rög
);

67 
DIAVAR
 
ãxt_löe_£t_height
(
TextLöe
 *
ãxt
, 
ªÆ
 
height
);

68 
DIAVAR
 
ãxt_löe_£t_f⁄t
(
TextLöe
 *
ãxt
, 
DüF⁄t
 *
f⁄t
);

69 
	$__de˛•ec
(
dŒexp‹t
Ë
gch¨
 *
	`ãxt_löe_gë_°rög
(c⁄° 
TextLöe
 *
ãxt
);

70 
	$__de˛•ec
(
dŒexp‹t
Ë
DüF⁄t
 *
	`ãxt_löe_gë_f⁄t
(c⁄° 
TextLöe
 *
ãxt
);

71 
	$__de˛•ec
(
dŒexp‹t
Ë
ªÆ
 
	`ãxt_löe_gë_height
(c⁄° 
TextLöe
 *
ãxt
);

72 
DIAVAR
 
	`ãxt_löe_ˇlc_boundögbox_size
(
TextLöe
 *
ãxt
, 
Poöt
 *
size
);

73 
DIAVAR
 
ªÆ
 
	`ãxt_löe_gë_width
(c⁄° 
TextLöe
 *
ãxt
);

74 
DIAVAR
 
ªÆ
 
	`ãxt_löe_gë_as˚¡
(c⁄° 
TextLöe
 *
ãxt
);

75 
DIAVAR
 
ªÆ
 
	`ãxt_löe_gë_des˚¡
(c⁄° 
TextLöe
 *
ãxt
);

77 
	`ãxt_löe_adju°_glyphs
(
TextLöe
 *
löe
,

78 
P™goGlyphSåög
 *
glyphs
,

79 
ªÆ
 
sˇÀ
);

80 
DIAVAR
 
	`ãxt_löe_adju°_œyout_löe
(
TextLöe
 *
löe
, 
P™goLayoutLöe
 *
œyouéöe
,

81 
ªÆ
 
sˇÀ
);

82 
DIAVAR
 
ªÆ
 
	`ãxt_löe_gë_Æignmít_adju°mít
(
TextLöe
 *
ãxt_löe
,

83 
Alignmít
 
Æignmít
);

	@O:\tool\dvs50\lib\units.c

2 
	~"unôs.h
"

5 c⁄° 
DIAVAR
 
DüUnôDef
 
	gunôs
[] =

	@O:\tool\dvs50\lib\units.h

18 #i‚de‡
UNITS_H


19 
	#UNITS_H


	)

21 
	~<c⁄fig.h
>

22 
	~"düv¨.h
"

25 
	mDIA_UNIT_CENTIMETER
,

26 
	mDIA_UNIT_DECIMETER
,

27 
	mDIA_UNIT_FEET
,

28 
	mDIA_UNIT_INCH
,

29 
	mDIA_UNIT_METER
,

30 
	mDIA_UNIT_MILLIMETER
,

31 
	mDIA_UNIT_POINT
,

32 
	mDIA_UNIT_PICA
,

33 } 
	tDüUnô
;

35 
_DüUnôDef
 
	tDüUnôDef
;

36 
	s_DüUnôDef
 {

37 * 
	m«me
;

38 * 
	munô
;

39 
	mÁ˘‹
;

40 
	mdigôs
;

43 c⁄° 
DIAVAR
 
DüUnôDef
 
	gunôs
[];

	@O:\tool\dvs50\lib\utils.c

27 
	~<c⁄fig.h
>

29 
	~<°dlib.h
>

30 
	~<°dio.h
>

31 
	~<°rög.h
>

33 
	~<glib.h
>

35 
	~"utûs.h
"

38 
	$√¨e°_pow
 (
num
)

40 
n
 = 1;

42 
n
 < 
num
)

43 
n
 <<= 1;

45  
n
;

46 
	}
}

49 
	$f‹m©_°rög_Àngth_uµî_bound
 (c⁄° * 
fmt
, 
va_li°
 *
¨gs
)

51 
Àn
 = 0;

52 
sh‹t_öt
;

53 
l⁄g_öt
;

54 
d⁄e
;

55 *
tmp
;

57 *
fmt
)

59 
c
 = *
fmt
++;

61 
sh‹t_öt
 = 
FALSE
;

62 
l⁄g_öt
 = 
FALSE
;

64 i‡(
c
 == '%')

66 
d⁄e
 = 
FALSE
;

67 *
fmt
 && !
d⁄e
)

69 *
fmt
++)

72 
Àn
 +
	`va_¨g
(*
¨gs
, );

83 
fmt
 -= 1;

84 
Àn
 +
	`°πﬁ
 (
fmt
, (**)&fmt, 10);

87 
sh‹t_öt
 = 
TRUE
;

90 
l⁄g_öt
 = 
TRUE
;

96 
tmp
 = 
	`va_¨g
(*
¨gs
, *);

97 if(
tmp
)

98 
Àn
 +
	`°æí
 (
tmp
);

100 
Àn
 +
	`°æí
 ("(null)");

101 
d⁄e
 = 
TRUE
;

109 i‡(
l⁄g_öt
)

110 ()
	`va_¨g
 (*
¨gs
, );

111 i‡(
sh‹t_öt
)

112 ()
	`va_¨g
 (*
¨gs
, );

114 ()
	`va_¨g
 (*
¨gs
, );

115 
Àn
 += 32;

116 
d⁄e
 = 
TRUE
;

121 ()
	`va_¨g
 (*
¨gs
, );

122 
Àn
 += 32;

123 
d⁄e
 = 
TRUE
;

129 ()
	`va_¨g
 (*
¨gs
, );

130 
Àn
 += 32;

131 
d⁄e
 = 
TRUE
;

134 ()
	`va_¨g
 (*
¨gs
, );

135 
Àn
 += 1;

136 
d⁄e
 = 
TRUE
;

140 ()
	`va_¨g
 (*
¨gs
, *);

141 
Àn
 += 32;

142 
d⁄e
 = 
TRUE
;

145 
Àn
 += 1;

146 
d⁄e
 = 
TRUE
;

154 
Àn
 += 1;

157  
Àn
;

158 
	}
}

	@O:\tool\dvs50\lib\utils.h

18 #i‚de‡
UTILS_H


19 
	#UTILS_H


	)

21 
	~<°d¨g.h
>

22 
	~"düv¨.h
"

24 
G_BEGIN_DECLS


26 
DIAVAR
 
√¨e°_pow
 (
num
);

27 
DIAVAR
 
f‹m©_°rög_Àngth_uµî_bound
 (c⁄° * 
fmt
,

28 
va_li°
 *
¨gs
);

30 
	gG_END_DECLS


	@O:\tool\dvs50\lib\widgets.c

19 
	~<c⁄fig.h
>

20 
	~<°rög.h
>

21 
	~"öé.h
"

22 #unde‡
GTK_DISABLE_DEPRECATED


23 
	~"widgës.h
"

24 
	~"unôs.h
"

25 
	~"mesßge.h
"

26 
	~"dü_dús.h
"

27 
	~"¨rows.h
"

28 
	~"dü¨rowchoo£r.h
"

29 
	~"dülöechoo£r.h
"

30 
	~"≥rsi°í˚.h
"

31 
	~"dü-lib-ic⁄s.h
"

33 
	~<°dlib.h
>

34 
	~<glib.h
>

35 
	~<gdk/gdk.h
>

36 
	~<gtk/gtk.h
>

37 
	~<∑ngo/∑ngo.h
>

38 
	~<°dio.h
>

39 
	~<time.h
>

40 
	~<gdk/gdkkeysyms.h
>

46 
	s_DüDy«micMíu
 {

47 
GtkO±i⁄Míu
 
	m∑ª¡
;

49 
GLi°
 *
	mdeÁu…_íåõs
;

51 
DDMCª©eIãmFunc
 
	m¸óã_func
;

52 
DDMCÆlbackFunc
 
	ma˘iv©e_func
;

53 
gpoöãr
 
	mu£rd©a
;

55 
GtkMíuIãm
 *
	mŸhî_ôem
;

57 
gch¨
 *
	m≥rsi°ít_«me
;

58 
göt
 
	mcﬁs
;

60 
gch¨
 *
	ma˘ive
;

62 
GLi°
 *
	m›ti⁄s
;

66 
	s_DüDy«micMíuCœss
 {

67 
GtkO±i⁄MíuCœss
 
	m∑ª¡_˛ass
;

77 
	s_DüSizeSñe˘‹


79 
GtkHBox
 
	mhbox
;

80 
GtkSpöBuâ⁄
 *
	mwidth
, *
	mheight
;

81 
GtkToggÀBuâ⁄
 *
	ma•e˘_locked
;

82 
ªÆ
 
	møtio
;

83 
GtkAdju°mít
 *
	mœ°_adju°ed
;

86 
	s_DüSizeSñe˘‹Cœss


88 
GtkHBoxCœss
 
	m∑ª¡_˛ass
;

92 
	mDSS_VALUE_CHANGED
,

93 
	mDSS_LAST_SIGNAL


96 
guöt
 
	gdss_sig«ls
[
DSS_LAST_SIGNAL
] = { 0 };

99 
	$dü_size_£À˘‹_uƒólize
(
GtkWidgë
 *
widgë
)

101 (* 
	`GTK_WIDGET_CLASS
 (
	`gtk_ty≥_˛ass
(
	`gtk_hbox_gë_ty≥
 ()))->
uƒólize
Ë(
widgë
);

102 
	}
}

105 
	$dü_size_£À˘‹_˛ass_öô
 (
DüSizeSñe˘‹Cœss
 *
˛ass
)

107 
GtkObje˘Cœss
 *
obje˘_˛ass
;

108 
GtkWidgëCœss
 *
widgë_˛ass
;

110 
obje˘_˛ass
 = (
GtkObje˘Cœss
*Ë
˛ass
;

111 
widgë_˛ass
 = (
GtkWidgëCœss
*Ë
˛ass
;

112 
widgë_˛ass
->
uƒólize
 = 
dü_size_£À˘‹_uƒólize
;

114 
dss_sig«ls
[
DSS_VALUE_CHANGED
]

115 
	`g_sig«l_√w
("value-changed",

116 
	`G_TYPE_FROM_CLASS
(
˛ass
),

117 
G_SIGNAL_RUN_FIRST
,

118 0, 
NULL
, NULL,

119 
g_c˛osuª_m¨shÆ_VOID__VOID
,

120 
G_TYPE_NONE
, 0);

121 
	}
}

124 
	$dü_size_£À˘‹_adju°_width
(
DüSizeSñe˘‹
 *
ss
)

126 
ªÆ
 
height
 =

127 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
(
	`GTK_SPIN_BUTTON
(
ss
->
height
));

128 i‡(
	`Ábs
(
ss
->
øtio
) > 1e-6)

129 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
ss
->
width
), 
height
*ss->
øtio
);

130 
	}
}

133 
	$dü_size_£À˘‹_adju°_height
(
DüSizeSñe˘‹
 *
ss
)

135 
ªÆ
 
width
 =

136 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
(
	`GTK_SPIN_BUTTON
(
ss
->
width
));

137 i‡(
	`Ábs
(
ss
->
øtio
) > 1e-6)

138 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
ss
->
height
), 
width
/ss->
øtio
);

139 
	}
}

142 
	$dü_size_£À˘‹_øtio_ˇŒback
(
GtkAdju°mít
 *
limôs
, 
gpoöãr
 
u£rd©a
)

144 
gboﬁón
 
ö_¥ogªss
 = 
FALSE
;

145 
DüSizeSñe˘‹
 *
ss
 = 
	`DIA_SIZE_SELECTOR
(
u£rd©a
);

147 
ss
->
œ°_adju°ed
 = 
limôs
;

149 i‡(
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
ss
->
a•e˘_locked
))

150 && 
ss
->
øtio
 != 0.0) {

152 i‡(
ö_¥ogªss
)

154 
ö_¥ogªss
 = 
TRUE
;

156 i‡(
limôs
 =
	`gtk_•ö_buâ⁄_gë_adju°mít
(
	`GTK_SPIN_BUTTON
(
ss
->
width
))) {

157 
	`dü_size_£À˘‹_adju°_height
(
ss
);

159 
	`dü_size_£À˘‹_adju°_width
(
ss
);

162 
ö_¥ogªss
 = 
FALSE
;

165 
	`g_sig«l_emô
(
ss
, 
dss_sig«ls
[
DSS_VALUE_CHANGED
], 0);

167 
	}
}

173 
	$dü_size_£À˘‹_£t_øtio
(
DüSizeSñe˘‹
 *
ss
, 
ªÆ
 
width
,Ñó»
height
)

175 i‡(
height
 > 0.0)

176 
ss
->
øtio
 = 
width
/
height
;

178 
ss
->
øtio
 = 0.0;

179 
	}
}

182 
	$dü_size_£À˘‹_lock_¥es£d
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

184 
DüSizeSñe˘‹
 *
ss
 = 
	`DIA_SIZE_SELECTOR
(
d©a
);

186 
	`dü_size_£À˘‹_£t_øtio
(
ss
,

187 
	`gtk_•ö_buâ⁄_gë_vÆue
(
	`GTK_SPIN_BUTTON
(
ss
->
width
)),

188 
	`gtk_•ö_buâ⁄_gë_vÆue
(
	`GTK_SPIN_BUTTON
(
ss
->
height
)));

189 
	}
}

194 
	$dü_size_£À˘‹_öô
 (
DüSizeSñe˘‹
 *
ss
)

196 
GtkAdju°mít
 *
adj
;

198 
ss
->
øtio
 = 0.0;

200 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1.0, 0.01, 10,

202 
ss
->
width
 = 
	`GTK_SPIN_BUTTON
(
	`gtk_•ö_buâ⁄_√w
(
adj
, 1.0, 2));

203 
	`gtk_•ö_buâ⁄_£t_wøp
(
	`GTK_SPIN_BUTTON
(
ss
->
width
), 
TRUE
);

204 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
ss
->
width
), 
TRUE
);

205 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
ss
), 
	`GTK_WIDGET
(ss->
width
), 
FALSE
, 
TRUE
, 0);

206 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
ss
->
width
));

208 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju°mít_√w
(1.0, 0.01, 10,

210 
ss
->
height
 = 
	`GTK_SPIN_BUTTON
(
	`gtk_•ö_buâ⁄_√w
(
adj
, 1.0, 2));

211 
	`gtk_•ö_buâ⁄_£t_wøp
(
	`GTK_SPIN_BUTTON
(
ss
->
height
), 
TRUE
);

212 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
ss
->
height
), 
TRUE
);

213 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
ss
), 
	`GTK_WIDGET
(ss->
height
), 
FALSE
, 
TRUE
, 0);

214 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
ss
->
height
));

220 
ss
->
a•e˘_locked
 =

221 
	`GTK_TOGGLE_BUTTON
(
dü_toggÀ_buâ⁄_√w_wôh_ic⁄s


222 (
dü_unbrokí_chaö_ic⁄
,

223 
dü_brokí_chaö_ic⁄
));

225 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
ss
->
a•e˘_locked
), 0);

227 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
ss
), 
	`GTK_WIDGET
(ss->
a•e˘_locked
), 
FALSE
, 
TRUE
, 0);

228 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
ss
->
a•e˘_locked
), 
TRUE
);

229 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
ss
->
a•e˘_locked
));

231 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
ss
->
a•e˘_locked
), "clicked",

232 (
GtkSig«lFunc
Ë
dü_size_£À˘‹_lock_¥es£d
,

233 
ss
);

235 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
	`gtk_•ö_buâ⁄_gë_adju°mít
(
ss
->
width
)),

237 
	`G_CALLBACK
(
dü_size_£À˘‹_øtio_ˇŒback
), (
gpoöãr
)
ss
);

238 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
	`gtk_•ö_buâ⁄_gë_adju°mít
(
ss
->
height
)),

240 
	`G_CALLBACK
(
dü_size_£À˘‹_øtio_ˇŒback
), (
gpoöãr
)
ss
);

241 
	}
}

243 
GtkTy≥


244 
	$dü_size_£À˘‹_gë_ty≥
 ()

246 
GtkTy≥
 
dss_ty≥
 = 0;

248 i‡(!
dss_ty≥
) {

249 c⁄° 
GtkTy≥Info
 
dss_öfo
 = {

251  (
DüSizeSñe˘‹
),

252  (
DüSizeSñe˘‹Cœss
),

253 (
GtkCœssInôFunc
Ë
dü_size_£À˘‹_˛ass_öô
,

254 (
GtkObje˘InôFunc
Ë
dü_size_£À˘‹_öô
,

255 
NULL
,

256 
NULL
,

257 (
GtkCœssInôFunc
Ë
NULL
,

260 
dss_ty≥
 = 
	`gtk_ty≥_unique
 (
	`gtk_hbox_gë_ty≥
 (), &
dss_öfo
);

264  
dss_ty≥
;

265 
	}
}

267 
GtkWidgë
 *

268 
	$dü_size_£À˘‹_√w
 (
ªÆ
 
width
,Ñó»
height
)

270 
GtkWidgë
 *
wid
;

272 
wid
 = 
	`GTK_WIDGET
 ( 
	`gtk_ty≥_√w
 (
	`dü_size_£À˘‹_gë_ty≥
 ()));

273 
	`dü_size_£À˘‹_£t_size
(
	`DIA_SIZE_SELECTOR
(
wid
), 
width
, 
height
);

274  
wid
;

275 
	}
}

278 
	$dü_size_£À˘‹_£t_size
(
DüSizeSñe˘‹
 *
ss
, 
ªÆ
 
width
,Ñó»
height
)

280 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
ss
->
width
), width);

281 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
ss
->
height
), height);

286 
	`dü_size_£À˘‹_£t_øtio
(
ss
, 
width
, 
height
);

287 
	}
}

290 
	$dü_size_£À˘‹_£t_locked
(
DüSizeSñe˘‹
 *
ss
, 
gboﬁón
 
locked
)

292 i‡(!
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
ss
->
a•e˘_locked
))

293 && 
locked
) {

294 
	`dü_size_£À˘‹_£t_øtio
(
ss
,

295 
	`gtk_•ö_buâ⁄_gë_vÆue
(
	`GTK_SPIN_BUTTON
(
ss
->
width
)),

296 
	`gtk_•ö_buâ⁄_gë_vÆue
(
	`GTK_SPIN_BUTTON
(
ss
->
height
)));

298 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
	`GTK_TOGGLE_BUTTON
(
ss
->
a•e˘_locked
), 
locked
);

299 
	}
}

301 
gboﬁón


302 
	$dü_size_£À˘‹_gë_size
(
DüSizeSñe˘‹
 *
ss
, 
ªÆ
 *
width
,Ñó»*
height
)

304 *
width
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
(
	`GTK_SPIN_BUTTON
(
ss
->width));

305 *
height
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
(
	`GTK_SPIN_BUTTON
(
ss
->height));

306  
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
ss
->
a•e˘_locked
);

307 
	}
}

315 
	s_DüF⁄tSñe˘‹


317 
GtkHBox
 
	mhbox
;

319 
GtkO±i⁄Míu
 *
	mf⁄t_omíu
;

320 
GtkO±i⁄Míu
 *
	m°yÀ_omíu
;

321 
GtkMíu
 *
	m°yÀ_míu
;

324 
	s_DüF⁄tSñe˘‹Cœss


326 
GtkHBoxCœss
 
	m∑ª¡_˛ass
;

330 
	mDFONTSEL_VALUE_CHANGED
,

331 
	mDFONTSEL_LAST_SIGNAL


334 
guöt
 
	gdf⁄t£l_sig«ls
[
DFONTSEL_LAST_SIGNAL
] = { 0 };

354 
dü_f⁄t_£À˘‹_f⁄tmíu_ˇŒback
(
DüDy«micMíu
 *
ddm
,

355 
gpoöãr
 
d©a
);

356 
dü_f⁄t_£À˘‹_°yÀmíu_ˇŒback
(
GtkMíu
 *
míu
,

357 
gpoöãr
 
d©a
);

358 
dü_f⁄t_£À˘‹_£t_°yÀs
(
DüF⁄tSñe˘‹
 *
fs
,

359 c⁄° 
gch¨
 *
«me
,

360 
DüF⁄tStyÀ
 
dü_°yÀ
);

361 
dü_f⁄t_£À˘‹_£t_°yÀ_míu
(
DüF⁄tSñe˘‹
 *
fs
,

362 
P™goF⁄tFamûy
 *
pff
,

363 
DüF⁄tStyÀ
 
dü_°yÀ
);

366 
	$dü_f⁄t_£À˘‹_˛ass_öô
 (
DüF⁄tSñe˘‹Cœss
 *
˛ass
)

368 
GtkObje˘Cœss
 *
obje˘_˛ass
;

370 
obje˘_˛ass
 = (
GtkObje˘Cœss
*Ë
˛ass
;

372 
df⁄t£l_sig«ls
[
DFONTSEL_VALUE_CHANGED
]

373 
	`g_sig«l_√w
("value_changed",

374 
	`G_TYPE_FROM_CLASS
(
˛ass
),

375 
G_SIGNAL_RUN_FIRST
,

376 0, 
NULL
, NULL,

377 
g_c˛osuª_m¨shÆ_VOID__VOID
,

378 
G_TYPE_NONE
, 0);

379 
	}
}

382 
	$dü_f⁄t_£À˘‹_s‹t_f⁄ts
(c⁄° *
p1
, c⁄° *
p2
)

384 c⁄° 
gch¨
 *
n1
 = 
	`∑ngo_f⁄t_Ámûy_gë_«me
(
	`PANGO_FONT_FAMILY
(*(**)
p1
));

385 c⁄° 
gch¨
 *
n2
 = 
	`∑ngo_f⁄t_Ámûy_gë_«me
(
	`PANGO_FONT_FAMILY
(*(**)
p2
));

386  
	`g_ascii_°rˇ£cmp
(
n1
, 
n2
);

387 
	}
}

389 
gch¨
*

390 
	$ª∂a˚_am≥rßnds
(
gch¨
* 
°rög
)

392 
gch¨
** 
põ˚s
 = 
	`g_°r•lô
(
°rög
, "&", -1);

393 
gch¨
* 
esˇ≥d
 = 
	`g_°rjoöv
("&amp;", 
põ˚s
);

394 
	`g_°r‰ìv
(
põ˚s
);

395  
esˇ≥d
;

396 
	}
}

398 
GtkWidgë
 *

399 
	$dü_f⁄t_£À˘‹_¸óã_°rög_ôem
(
DüDy«micMíu
 *
ddm
, 
gch¨
 *
°rög
)

401 
GtkWidgë
 *
ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
°rög
);

402 i‡(
	`°rchr
(
°rög
, '&')) {

403 
gch¨
 *
esˇ≥d
 = 
	`ª∂a˚_am≥rßnds
(
°rög
);

404 
gch¨
 *
œbñ
 = 
	`g_°rdup_¥ötf
("<span face=\"%s,sans\" size=\"medium\">%s</span>",

405 
esˇ≥d
,Éscaped);

406 
	`gtk_œbñ_£t_m¨kup
(
	`GTK_LABEL
(
	`gtk_bö_gë_chûd
(
	`GTK_BIN
(
ôem
))), 
œbñ
);

407 
	`g_‰ì
(
œbñ
);

408 
	`g_‰ì
(
esˇ≥d
);

410 
gch¨
 *
œbñ
 = 
	`g_°rdup_¥ötf
("<span face=\"%s,sans\" size=\"medium\">%s</span>",

411 
°rög
, string);

412 
	`gtk_œbñ_£t_m¨kup
(
	`GTK_LABEL
(
	`gtk_bö_gë_chûd
(
	`GTK_BIN
(
ôem
))), 
œbñ
);

413 
	`g_‰ì
(
œbñ
);

415  
ôem
;

416 
	}
}

419 
	$dü_f⁄t_£À˘‹_öô
 (
DüF⁄tSñe˘‹
 *
fs
)

421 
GtkWidgë
 *
míu
;

422 
GtkWidgë
 *
omíu
;

424 
P™goF⁄tFamûy
 **
Ámûõs
;

425 
n_Ámûõs
,
i
;

426 
GLi°
 *
f⁄äames
 = 
NULL
;

428 
	`∑ngo_c⁄ãxt_li°_Ámûõs
 (
	`dü_f⁄t_gë_c⁄ãxt
(),

429 &
Ámûõs
, &
n_Ámûõs
);

430 
	`qs‹t
(
Ámûõs
, 
n_Ámûõs
, (
P™goF⁄tFamûy
*),

431 
dü_f⁄t_£À˘‹_s‹t_f⁄ts
);

433 
i
 = 0; i < 
n_Ámûõs
; i++) {

434 
f⁄äames
 = 
	`g_li°_≠≥nd
(fontnames,

435 
	`g_°rdup
(
	`∑ngo_f⁄t_Ámûy_gë_«me
(
Ámûõs
[
i
])));

437 
	`g_‰ì
 (
Ámûõs
);

439 
fs
->
f⁄t_omíu
 =

440 
	`GTK_OPTION_MENU
(
	`dü_dy«mic_míu_√w_li°ba£d
(
dü_f⁄t_£À˘‹_¸óã_°rög_ôem
,

441 
fs
, 
	`_
("Other fonts"),

442 
f⁄äames
, "font-menu"));

443 
	`g_sig«l_c⁄√˘
(
	`DIA_DYNAMIC_MENU
(
fs
->
f⁄t_omíu
), "value-changed",

444 
	`G_CALLBACK
(
dü_f⁄t_£À˘‹_f⁄tmíu_ˇŒback
), 
fs
);

445 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
fs
->
f⁄t_omíu
),

447 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
fs
->
f⁄t_omíu
),

449 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
fs
->
f⁄t_omíu
),

451 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
fs
->
f⁄t_omíu
));

454 
omíu
 = 
	`gtk_›ti⁄_míu_√w
();

455 
fs
->
°yÀ_omíu
 = 
	`GTK_OPTION_MENU
(
omíu
);

456 
míu
 = 
	`gtk_míu_√w
 ();

458 
fs
->
°yÀ_míu
 = 
	`GTK_MENU
(
míu
);

459 
	`gtk_›ti⁄_míu_£t_míu
 (
	`GTK_OPTION_MENU
 (
fs
->
°yÀ_omíu
), 
míu
);

461 
	`gtk_widgë_show
(
míu
);

462 
	`gtk_widgë_show
(
omíu
);

464 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
f⁄t_omíu
));

465 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
°yÀ_omíu
));

466 
	}
}

468 
GtkTy≥


469 
	$dü_f⁄t_£À˘‹_gë_ty≥
 ()

471 
GtkTy≥
 
dfs_ty≥
 = 0;

473 i‡(!
dfs_ty≥
) {

474 c⁄° 
GtkTy≥Info
 
dfs_öfo
 = {

476  (
DüF⁄tSñe˘‹
),

477  (
DüF⁄tSñe˘‹Cœss
),

478 (
GtkCœssInôFunc
Ë
dü_f⁄t_£À˘‹_˛ass_öô
,

479 (
GtkObje˘InôFunc
Ë
dü_f⁄t_£À˘‹_öô
,

480 
NULL
,

481 
NULL
,

482 (
GtkCœssInôFunc
Ë
NULL


485 
dfs_ty≥
 = 
	`gtk_ty≥_unique
 (
	`gtk_hbox_gë_ty≥
 (), &
dfs_öfo
);

488  
dfs_ty≥
;

489 
	}
}

491 
GtkWidgë
 *

492 
	$dü_f⁄t_£À˘‹_√w
 ()

494  
	`GTK_WIDGET
 ( 
	`gtk_ty≥_√w
 (
	`dü_f⁄t_£À˘‹_gë_ty≥
 ()));

495 
	}
}

497 
P™goF⁄tFamûy
 *

498 
	$dü_f⁄t_£À˘‹_gë_Ámûy_‰om_«me
(
GtkWidgë
 *
widgë
, c⁄° 
gch¨
 *
f⁄äame
)

500 
P™goF⁄tFamûy
 **
Ámûõs
;

501 
n_Ámûõs
,
i
;

503 
	`∑ngo_c⁄ãxt_li°_Ámûõs
 (
	`dü_f⁄t_gë_c⁄ãxt
(),

504 &
Ámûõs
, &
n_Ámûõs
);

506 
i
 = 0; i < 
n_Ámûõs
; i++) {

507 i‡(!(
	`g_ascii_°rˇ£cmp
(
	`∑ngo_f⁄t_Ámûy_gë_«me
(
Ámûõs
[
i
]), 
f⁄äame
))) {

508 
P™goF⁄tFamûy
 *
Ám
 = 
Ámûõs
[
i
];

509 
	`g_‰ì
(
Ámûõs
);

510  
Ám
;

513 
	`g_w¨nög
(
	`_
("Couldn'àföd f⁄àÁmûy f‹ %s\n"), 
f⁄äame
);

514 
	`g_‰ì
(
Ámûõs
);

515  
NULL
;

516 
	}
}

519 
	$dü_f⁄t_£À˘‹_f⁄tmíu_ˇŒback
(
DüDy«micMíu
 *
ddm
, 
gpoöãr
 
d©a
)

521 
DüF⁄tSñe˘‹
 *
fs
 = 
	`DIAFONTSELECTOR
(
d©a
);

522 *
f⁄äame
 = 
	`dü_dy«mic_míu_gë_íåy
(
ddm
);

523 
	`dü_f⁄t_£À˘‹_£t_°yÀs
(
fs
, 
f⁄äame
, -1);

524 
	`g_sig«l_emô
(
	`GTK_OBJECT
(
fs
),

525 
df⁄t£l_sig«ls
[
DFONTSEL_VALUE_CHANGED
], 0);

526 
	`g_‰ì
(
f⁄äame
);

527 
	}
}

530 
	$dü_f⁄t_£À˘‹_°yÀmíu_ˇŒback
(
GtkMíu
 *
míu
, 
gpoöãr
 
d©a
)

532 
DüF⁄tSñe˘‹
 *
fs
 = 
	`DIAFONTSELECTOR
(
d©a
);

533 
	`g_sig«l_emô
(
	`GTK_OBJECT
(
fs
),

534 
df⁄t£l_sig«ls
[
DFONTSEL_VALUE_CHANGED
], 0);

535 
	}
}

537 *
	g°yÀ_œbñs
[] = {

565 
	$dü_f⁄t_£À˘‹_£t_°yÀ_míu
(
DüF⁄tSñe˘‹
 *
fs
,

566 
P™goF⁄tFamûy
 *
pff
,

567 
DüF⁄tStyÀ
 
dü_°yÀ
)

569 
£À˘
 = 0;

570 
P™goF⁄tFa˚
 **
Á˚s
 = 
NULL
;

571 
guöt
 
nÁ˚s
 = 0;

572 
guöt
 
i
=0;

573 
GtkWidgë
 *
míu
 = 
NULL
;

574 
°yÀbôs
 = 0;

575 
míu_ôem_ƒ
 = 0;

576 
GSLi°
 *
group
 = 
NULL
;

578 
míu
 = 
	`gtk_míu_√w
 ();

579 
	`g_sig«l_c⁄√˘
(
míu
, "selection-done",

580 
	`G_CALLBACK
(
dü_f⁄t_£À˘‹_°yÀmíu_ˇŒback
), 
fs
);

582 
	`∑ngo_f⁄t_Ámûy_li°_Á˚s
(
pff
, &
Á˚s
, &
nÁ˚s
);

584 
i
 = 0; i < 
nÁ˚s
; i++) {

585 
P™goF⁄tDes¸ùti⁄
 *
pfd
 = 
	`∑ngo_f⁄t_Á˚_des¸ibe
(
Á˚s
[
i
]);

586 
P™goStyÀ
 
°yÀ
 = 
	`∑ngo_f⁄t_des¸ùti⁄_gë_°yÀ
(
pfd
);

587 
P™goWeight
 
weight
 = 
	`∑ngo_f⁄t_des¸ùti⁄_gë_weight
(
pfd
);

596 
weighär
 = (
weight
-200)/100;

597 i‡(
weighär
 < 2) weightnr ++;

598 i‡(
weighär
 == 2) weightnr = 0;

599 
°yÀbôs
 |1 << (3*
weighär
 + 
°yÀ
);

600 
	`∑ngo_f⁄t_des¸ùti⁄_‰ì
(
pfd
);

603 
	`g_‰ì
(
Á˚s
);

605 i‡(
°yÀbôs
 == 0) {

606 
	`g_w¨nög
 ("'%s' hasÇo style!",

607 
	`∑ngo_f⁄t_Ámûy_gë_«me
 (
pff
) ?Öango_font_family_get_name (pff) : "(null font)");

610 
i
 = 
DIA_FONT_NORMAL
; i <(
DIA_FONT_HEAVY
 | 
DIA_FONT_ITALIC
); i+=4) {

611 
GtkWidgë
 *
míuôem
;

615 
weight
 = 
	`DIA_FONT_STYLE_GET_WEIGHT
(
i
) >> 4;

616 
¶™t
 = 
	`DIA_FONT_STYLE_GET_SLANT
(
i
) >> 2;

617 i‡(
	`DIA_FONT_STYLE_GET_SLANT
(
i
Ë> 
DIA_FONT_ITALIC
) ;

618 i‡(!(
°yÀbôs
 & (1 << (3*
weight
 + 
¶™t
)))) ;

619 
míuôem
 = 
	`gtk_ødio_míu_ôem_√w_wôh_œbñ
 (
group
, 
°yÀ_œbñs
[3*
weight
+
¶™t
]);

620 
group
 = 
	`gtk_ødio_míu_ôem_gë_group
(
	`GTK_RADIO_MENU_ITEM
(
míuôem
));

621 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
i
));

622 i‡(
dü_°yÀ
 =
i
) {

623 
£À˘
 = 
míu_ôem_ƒ
;

625 
míu_ôem_ƒ
++;

626 
	`gtk_míu_≠≥nd
 (
	`GTK_MENU
 (
míu
), 
míuôem
);

627 
	`gtk_widgë_show
 (
míuôem
);

629 
	`gtk_widgë_show
(
míu
);

630 
	`gtk_›ti⁄_míu_ªmove_míu
(
fs
->
°yÀ_omíu
);

631 
	`gtk_›ti⁄_míu_£t_míu
(
fs
->
°yÀ_omíu
, 
míu
);

632 
fs
->
°yÀ_míu
 = 
	`GTK_MENU
(
míu
);

633 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
fs
->
°yÀ_omíu
), 
£À˘
);

634 
	`gtk_míu_£t_a˘ive
(
fs
->
°yÀ_míu
, 
£À˘
);

635 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
fs
->
°yÀ_omíu
), 
míu_ôem_ƒ
 > 1);

636 
	`gtk_check_míu_ôem_£t_a˘ive
(
	`GTK_CHECK_MENU_ITEM
(
	`gtk_míu_gë_a˘ive
(
fs
->
°yÀ_míu
)), 
TRUE
);

637 
	}
}

640 
	$dü_f⁄t_£À˘‹_£t_°yÀs
(
DüF⁄tSñe˘‹
 *
fs
,

641 c⁄° 
gch¨
 *
«me
, 
DüF⁄tStyÀ
 
dü_°yÀ
)

643 
P™goF⁄tFamûy
 *
pff
;

644 
pff
 = 
	`dü_f⁄t_£À˘‹_gë_Ámûy_‰om_«me
(
	`GTK_WIDGET
(
fs
), 
«me
);

645 
	`dü_f⁄t_£À˘‹_£t_°yÀ_míu
(
fs
, 
pff
, 
dü_°yÀ
);

646 
	}
}

655 
	$dü_f⁄t_£À˘‹_£t_¥evõw
(
DüF⁄tSñe˘‹
 *
fs
, 
gch¨
 *
ãxt
) {

656 
	}
}

661 
	$dü_f⁄t_£À˘‹_£t_f⁄t
(
DüF⁄tSñe˘‹
 *
fs
, 
DüF⁄t
 *
f⁄t
)

663 c⁄° 
gch¨
 *
f⁄äame
 = 
	`dü_f⁄t_gë_Ámûy
(
f⁄t
);

665 
	`dü_dy«mic_míu_£À˘_íåy
(
	`DIA_DYNAMIC_MENU
(
fs
->
f⁄t_omíu
), 
f⁄äame
);

666 
	`g_sig«l_emô
(
	`GTK_OBJECT
(
fs
),

667 
df⁄t£l_sig«ls
[
DFONTSEL_VALUE_CHANGED
], 0);

668 
	`dü_f⁄t_£À˘‹_£t_°yÀs
(
fs
, 
f⁄äame
, 
	`dü_f⁄t_gë_°yÀ
 (
f⁄t
));

669 
	}
}

671 
DüF⁄t
 *

672 
	$dü_f⁄t_£À˘‹_gë_f⁄t
(
DüF⁄tSñe˘‹
 *
fs
)

674 
GtkWidgë
 *
míuôem
;

675 *
f⁄äame
;

676 
DüF⁄tStyÀ
 
°yÀ
;

677 
DüF⁄t
 *
f⁄t
;

679 
f⁄äame
 = 
	`dü_dy«mic_míu_gë_íåy
(
	`DIA_DYNAMIC_MENU
(
fs
->
f⁄t_omíu
));

680 
míuôem
 = 
	`gtk_míu_gë_a˘ive
(
fs
->
°yÀ_míu
);

681 i‡(!
míuôem
)

682 
°yÀ
 = 0;

684 
°yÀ
 = 
	`GPOINTER_TO_INT
(
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
)));

685 
f⁄t
 = 
	`dü_f⁄t_√w
(
f⁄äame
, 
°yÀ
, 1.0);

686 
	`g_‰ì
(
f⁄äame
);

687  
f⁄t
;

688 
	}
}

691 
	s_DüAlignmítSñe˘‹


693 
GtkO±i⁄Míu
 
	momíu
;

695 
GtkMíu
 *
	mÆignmít_míu
;

698 
	s_DüAlignmítSñe˘‹Cœss


700 
GtkO±i⁄MíuCœss
 
	m∑ª¡_˛ass
;

704 
	$dü_Æignmít_£À˘‹_˛ass_öô
 (
DüAlignmítSñe˘‹Cœss
 *
˛ass
)

706 
GtkObje˘Cœss
 *
obje˘_˛ass
;

708 
obje˘_˛ass
 = (
GtkObje˘Cœss
*Ë
˛ass
;

709 
	}
}

712 
	$dü_Æignmít_£À˘‹_öô
 (
DüAlignmítSñe˘‹
 *
fs
)

714 
GtkWidgë
 *
míu
;

715 
GtkWidgë
 *
submíu
;

716 
GtkWidgë
 *
míuôem
;

717 
GSLi°
 *
group
;

719 
míu
 = 
	`gtk_míu_√w
 ();

720 
fs
->
Æignmít_míu
 = 
	`GTK_MENU
(
míu
);

721 
submíu
 = 
NULL
;

722 
group
 = 
NULL
;

724 
míuôem
 = 
	`gtk_ødio_míu_ôem_√w_wôh_œbñ
 (
group
, 
	`_
("Left"));

725 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
ALIGN_LEFT
));

726 
group
 = 
	`gtk_ødio_míu_ôem_group
 (
	`GTK_RADIO_MENU_ITEM
 (
míuôem
));

727 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míuôem
);

728 
	`gtk_widgë_show
 (
míuôem
);

730 
míuôem
 = 
	`gtk_ødio_míu_ôem_√w_wôh_œbñ
 (
group
, 
	`_
("Center"));

731 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
ALIGN_CENTER
));

732 
group
 = 
	`gtk_ødio_míu_ôem_group
 (
	`GTK_RADIO_MENU_ITEM
 (
míuôem
));

733 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míuôem
);

734 
	`gtk_widgë_show
 (
míuôem
);

736 
míuôem
 = 
	`gtk_ødio_míu_ôem_√w_wôh_œbñ
 (
group
, 
	`_
("Right"));

737 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
ALIGN_RIGHT
));

738 
group
 = 
	`gtk_ødio_míu_ôem_group
 (
	`GTK_RADIO_MENU_ITEM
 (
míuôem
));

739 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míuôem
);

740 
	`gtk_widgë_show
 (
míuôem
);

742 
	`gtk_míu_£t_a˘ive
(
	`GTK_MENU
 (
míu
), 
DEFAULT_ALIGNMENT
);

743 
	`gtk_›ti⁄_míu_£t_míu
 (
	`GTK_OPTION_MENU
 (
fs
), 
míu
);

744 
	}
}

746 
GtkTy≥


747 
	$dü_Æignmít_£À˘‹_gë_ty≥
 ()

749 
GtkTy≥
 
dfs_ty≥
 = 0;

751 i‡(!
dfs_ty≥
) {

752 c⁄° 
GtkTy≥Info
 
dfs_öfo
 = {

754  (
DüAlignmítSñe˘‹
),

755  (
DüAlignmítSñe˘‹Cœss
),

756 (
GtkCœssInôFunc
Ë
dü_Æignmít_£À˘‹_˛ass_öô
,

757 (
GtkObje˘InôFunc
Ë
dü_Æignmít_£À˘‹_öô
,

758 
NULL
,

759 
NULL
,

760 (
GtkCœssInôFunc
Ë
NULL
,

763 
dfs_ty≥
 = 
	`gtk_ty≥_unique
 (
	`gtk_›ti⁄_míu_gë_ty≥
 (), &
dfs_öfo
);

766  
dfs_ty≥
;

767 
	}
}

769 
GtkWidgë
 *

770 
	$dü_Æignmít_£À˘‹_√w
 ()

772  
	`GTK_WIDGET
 ( 
	`gtk_ty≥_√w
 (
	`dü_Æignmít_£À˘‹_gë_ty≥
 ()));

773 
	}
}

776 
Alignmít


777 
	$dü_Æignmít_£À˘‹_gë_Æignmít
(
DüAlignmítSñe˘‹
 *
fs
)

779 
GtkWidgë
 *
míuôem
;

780 *
Æign
;

782 
míuôem
 = 
	`gtk_míu_gë_a˘ive
(
fs
->
Æignmít_míu
);

783 
Æign
 = 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
));

785  
	`GPOINTER_TO_INT
(
Æign
);

786 
	}
}

789 
	$dü_Æignmít_£À˘‹_£t_Æignmít
 (
DüAlignmítSñe˘‹
 *
as
,

790 
Alignmít
 
Æign
)

792 
	`gtk_míu_£t_a˘ive
(
	`GTK_MENU
 (
as
->
Æignmít_míu
), 
Æign
);

793 
	`gtk_›ti⁄_míu_£t_hi°‹y
 (
	`GTK_OPTION_MENU
(
as
), 
Æign
);

794 
	}
}

797 
	s_DüLöeStyÀSñe˘‹


799 
GtkVBox
 
	mvbox
;

801 
GtkO±i⁄Míu
 *
	momíu
;

802 
GtkMíu
 *
	mlöe°yÀ_míu
;

803 
GtkLabñ
 *
	mÀngthœbñ
;

804 
GtkSpöBuâ⁄
 *
	mdashÀngth
;

808 
	s_DüLöeStyÀSñe˘‹Cœss


810 
GtkVBoxCœss
 
	m∑ª¡_˛ass
;

814 
	mDLS_VALUE_CHANGED
,

815 
	mDLS_LAST_SIGNAL


818 
guöt
 
	gdls_sig«ls
[
DLS_LAST_SIGNAL
] = { 0 };

821 
	$dü_löe_°yÀ_£À˘‹_˛ass_öô
 (
DüLöeStyÀSñe˘‹Cœss
 *
˛ass
)

823 
GtkObje˘Cœss
 *
obje˘_˛ass
;

825 
obje˘_˛ass
 = (
GtkObje˘Cœss
*Ë
˛ass
;

827 
dls_sig«ls
[
DLS_VALUE_CHANGED
]

828 
	`g_sig«l_√w
("value-changed",

829 
	`G_TYPE_FROM_CLASS
(
˛ass
),

830 
G_SIGNAL_RUN_FIRST
,

831 0, 
NULL
, NULL,

832 
g_c˛osuª_m¨shÆ_VOID__VOID
,

833 
G_TYPE_NONE
, 0);

834 
	}
}

837 
	$£t_löe°yÀ_£nsôivôy
(
DüLöeStyÀSñe˘‹
 *
fs
)

839 
°©e
;

840 
GtkWidgë
 *
míuôem
;

841 i‡(!
fs
->
löe°yÀ_míu
) ;

842 
míuôem
 = 
	`gtk_míu_gë_a˘ive
(
fs
->
löe°yÀ_míu
);

843 
°©e
 = (
	`GPOINTER_TO_INT
(
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
)))

844 !
LINESTYLE_SOLID
);

846 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
fs
->
Àngthœbñ
), 
°©e
);

847 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
fs
->
dashÀngth
), 
°©e
);

848 
	}
}

851 
	$löe°yÀ_ty≥_ch™ge_ˇŒback
(
GtkMíu
 *
míu
, 
gpoöãr
 
d©a
)

853 
	`£t_löe°yÀ_£nsôivôy
(
	`DIALINESTYLESELECTOR
(
d©a
));

854 
	`g_sig«l_emô
(
	`DIALINESTYLESELECTOR
(
d©a
),

855 
dls_sig«ls
[
DLS_VALUE_CHANGED
], 0);

856 
	}
}

859 
	$löe°yÀ_dashÀngth_ch™ge_ˇŒback
(
GtkSpöBuâ⁄
 *
sb
, 
gpoöãr
 
d©a
)

861 
	`g_sig«l_emô
(
	`DIALINESTYLESELECTOR
(
d©a
),

862 
dls_sig«ls
[
DLS_VALUE_CHANGED
], 0);

863 
	}
}

866 
	$dü_löe_°yÀ_£À˘‹_öô
 (
DüLöeStyÀSñe˘‹
 *
fs
)

868 
GtkWidgë
 *
míu
;

869 
GtkWidgë
 *
submíu
;

870 
GtkWidgë
 *
míuôem
, *
 
;

871 
GtkWidgë
 *
œbñ
;

872 
GtkWidgë
 *
Àngth
;

873 
GtkWidgë
 *
box
;

874 
GSLi°
 *
group
;

875 
GtkAdju°mít
 *
adj
;

876 
göt
 
i
;

878 
míu
 = 
	`gtk_›ti⁄_míu_√w
();

879 
fs
->
omíu
 = 
	`GTK_OPTION_MENU
(
míu
);

881 
míu
 = 
	`gtk_míu_√w
 ();

882 
fs
->
löe°yÀ_míu
 = 
	`GTK_MENU
(
míu
);

883 
submíu
 = 
NULL
;

884 
group
 = 
NULL
;

886 
i
 = 0; i <
LINESTYLE_DOTTED
; i++) {

887 
míuôem
 = 
	`gtk_míu_ôem_√w
();

888 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
i
));

889 
 
 = 
	`dü_löe_¥evõw_√w
(
i
);

890 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
míuôem
), 
 
);

891 
	`gtk_widgë_show
(
 
);

892 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míuôem
);

893 
	`gtk_widgë_show
(
míuôem
);

896 
míuôem
 = 
	`gtk_ødio_míu_ôem_√w_wôh_œbñ
 (
group
, 
	`_
("Solid"));

897 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
LINESTYLE_SOLID
));

898 
group
 = 
	`gtk_ødio_míu_ôem_group
 (
	`GTK_RADIO_MENU_ITEM
 (
míuôem
));

899 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míuôem
);

900 
	`gtk_widgë_show
 (
míuôem
);

902 
míuôem
 = 
	`gtk_ødio_míu_ôem_√w_wôh_œbñ
 (
group
, 
	`_
("Dashed"));

903 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
LINESTYLE_DASHED
));

904 
group
 = 
	`gtk_ødio_míu_ôem_group
 (
	`GTK_RADIO_MENU_ITEM
 (
míuôem
));

905 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míuôem
);

906 
	`gtk_widgë_show
 (
míuôem
);

908 
míuôem
 = 
	`gtk_ødio_míu_ôem_√w_wôh_œbñ
 (
group
, 
	`_
("Dash-Dot"));

909 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
LINESTYLE_DASH_DOT
));

910 
group
 = 
	`gtk_ødio_míu_ôem_group
 (
	`GTK_RADIO_MENU_ITEM
 (
míuôem
));

911 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míuôem
);

912 
	`gtk_widgë_show
 (
míuôem
);

914 
míuôem
 = 
	`gtk_ødio_míu_ôem_√w_wôh_œbñ
 (
group
, 
	`_
("Dash-Dot-Dot"));

915 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
LINESTYLE_DASH_DOT_DOT
));

916 
group
 = 
	`gtk_ødio_míu_ôem_group
 (
	`GTK_RADIO_MENU_ITEM
 (
míuôem
));

917 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míuôem
);

918 
	`gtk_widgë_show
 (
míuôem
);

920 
míuôem
 = 
	`gtk_ødio_míu_ôem_√w_wôh_œbñ
 (
group
, 
	`_
("Dotted"));

921 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
	`GINT_TO_POINTER
(
LINESTYLE_DOTTED
));

922 
group
 = 
	`gtk_ødio_míu_ôem_group
 (
	`GTK_RADIO_MENU_ITEM
 (
míuôem
));

923 
	`gtk_míu_shñl_≠≥nd
 (
	`GTK_MENU_SHELL
 (
míu
), 
míuôem
);

924 
	`gtk_widgë_show
 (
míuôem
);

927 
	`gtk_míu_£t_a˘ive
(
	`GTK_MENU
 (
míu
), 
DEFAULT_LINESTYLE
);

928 
	`gtk_›ti⁄_míu_£t_míu
 (
	`GTK_OPTION_MENU
 (
fs
->
omíu
), 
míu
);

929 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
míu
), "selection-done",

930 
	`G_CALLBACK
(
löe°yÀ_ty≥_ch™ge_ˇŒback
), 
fs
);

932 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
omíu
), 
FALSE
, 
TRUE
, 0);

933 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
fs
->
omíu
));

935 
box
 = 
	`gtk_hbox_√w
(
FALSE
,0);

938 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("DashÜength: "));

939 
fs
->
Àngthœbñ
 = 
	`GTK_LABEL
(
œbñ
);

940 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
box
), 
œbñ
);

941 
	`gtk_widgë_show
(
œbñ
);

943 
adj
 = (
GtkAdju°mít
 *)
	`gtk_adju°mít_√w
(0.1, 0.00, 10.0, 0.1, 1.0, 0);

944 
Àngth
 = 
	`gtk_•ö_buâ⁄_√w
(
adj
, 
DEFAULT_LINESTYLE_DASHLEN
, 2);

945 
	`gtk_•ö_buâ⁄_£t_wøp
(
	`GTK_SPIN_BUTTON
(
Àngth
), 
TRUE
);

946 
	`gtk_•ö_buâ⁄_£t_numîic
(
	`GTK_SPIN_BUTTON
(
Àngth
), 
TRUE
);

947 
fs
->
dashÀngth
 = 
	`GTK_SPIN_BUTTON
(
Àngth
);

948 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
 (
box
), 
Àngth
);

949 
	`gtk_widgë_show
 (
Àngth
);

951 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
Àngth
), "changed",

952 
	`G_CALLBACK
(
löe°yÀ_dashÀngth_ch™ge_ˇŒback
), 
fs
);

954 
	`£t_löe°yÀ_£nsôivôy
(
fs
);

955 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
fs
), 
box
);

956 
	`gtk_widgë_show
(
box
);

958 
	}
}

960 
GtkTy≥


961 
	$dü_löe_°yÀ_£À˘‹_gë_ty≥
 ()

963 
GtkTy≥
 
dfs_ty≥
 = 0;

965 i‡(!
dfs_ty≥
) {

966 c⁄° 
GtkTy≥Info
 
dfs_öfo
 = {

968  (
DüLöeStyÀSñe˘‹
),

969  (
DüLöeStyÀSñe˘‹Cœss
),

970 (
GtkCœssInôFunc
Ë
dü_löe_°yÀ_£À˘‹_˛ass_öô
,

971 (
GtkObje˘InôFunc
Ë
dü_löe_°yÀ_£À˘‹_öô
,

972 
NULL
,

973 
NULL
,

974 (
GtkCœssInôFunc
Ë
NULL
,

977 
dfs_ty≥
 = 
	`gtk_ty≥_unique
 (
	`gtk_vbox_gë_ty≥
 (), &
dfs_öfo
);

980  
dfs_ty≥
;

981 
	}
}

983 
GtkWidgë
 *

984 
	$dü_löe_°yÀ_£À˘‹_√w
 ()

986  
	`GTK_WIDGET
 ( 
	`gtk_ty≥_√w
 (
	`dü_löe_°yÀ_£À˘‹_gë_ty≥
 ()));

987 
	}
}

991 
	$dü_löe_°yÀ_£À˘‹_gë_löe°yÀ
(
DüLöeStyÀSñe˘‹
 *
fs
,

992 
LöeStyÀ
 *
ls
, 
ªÆ
 *
dl
)

994 
GtkWidgë
 *
míuôem
;

995 *
Æign
;

997 
míuôem
 = 
	`gtk_míu_gë_a˘ive
(
fs
->
löe°yÀ_míu
);

998 
Æign
 = 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
));

999 *
ls
 = 
	`GPOINTER_TO_INT
(
Æign
);

1000 i‡(
dl
!=
NULL
) {

1001 *
dl
 = 
	`gtk_•ö_buâ⁄_gë_vÆue
(
fs
->
dashÀngth
);

1003 
	}
}

1006 
	$dü_löe_°yÀ_£À˘‹_£t_löe°yÀ
 (
DüLöeStyÀSñe˘‹
 *
as
,

1007 
LöeStyÀ
 
löe°yÀ
, 
ªÆ
 
dashÀngth
)

1009 
	`gtk_míu_£t_a˘ive
(
	`GTK_MENU
 (
as
->
löe°yÀ_míu
), 
löe°yÀ
);

1010 
	`gtk_›ti⁄_míu_£t_hi°‹y
 (
	`GTK_OPTION_MENU
(
as
->
omíu
), 
löe°yÀ
);

1013 
	`£t_löe°yÀ_£nsôivôy
(
	`DIALINESTYLESELECTOR
(
as
));

1014 
	`gtk_•ö_buâ⁄_£t_vÆue
(
	`GTK_SPIN_BUTTON
(
as
->
dashÀngth
), dashlength);

1015 
	}
}

1021 
GtkWidgë
 *

1022 
	$dü_cﬁ‹_£À˘‹_¸óã_°rög_ôem
(
DüDy«micMíu
 *
ddm
, 
gch¨
 *
°rög
)

1024 
GtkWidgë
 *
ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
°rög
);

1025 
göt
 
r
, 
g
, 
b
;

1026 
	`ssˇnf
(
°rög
, "#%2x%2x%2x", &
r
, &
g
, &
b
);

1030 i‡(
r
*299+
g
*587+
b
*114 > 500 * 256) {

1031 
gch¨
 *
œbñ
 = 
	`g_°rdup_¥ötf
("<•™ f‹eground=\"bœck\" background=\"%s\">%s</•™>", 
°rög
, string);

1032 
	`gtk_œbñ_£t_m¨kup
(
	`GTK_LABEL
(
	`gtk_bö_gë_chûd
(
	`GTK_BIN
(
ôem
))), 
œbñ
);

1033 
	`g_‰ì
(
œbñ
);

1035 
gch¨
 *
œbñ
 = 
	`g_°rdup_¥ötf
("<•™ f‹eground=\"whôe\" background=\"%s\">%s</•™>", 
°rög
, string);

1036 
	`gtk_œbñ_£t_m¨kup
(
	`GTK_LABEL
(
	`gtk_bö_gë_chûd
(
	`GTK_BIN
(
ôem
))), 
œbñ
);

1037 
	`g_‰ì
(
œbñ
);

1040  
ôem
;

1041 
	}
}

1044 
	$dü_cﬁ‹_£À˘‹_m‹e_ok
(
GtkWidgë
 *
ok
, 
gpoöãr
 
u£rd©a
)

1046 
DüDy«micMíu
 *
ddm
 = 
	`g_obje˘_gë_d©a
(
	`G_OBJECT
(
u£rd©a
), "ddm");

1047 
GtkWidgë
 *
cﬁ‹£l
 = 
	`GTK_WIDGET
(
u£rd©a
);

1048 
GdkCﬁ‹
 
gcﬁ
;

1049 
gch¨
 *
íåy
;

1051 
	`gtk_cﬁ‹_£À˘i⁄_gë_cuºít_cﬁ‹
(

1052 
	`GTK_COLOR_SELECTION
(

1053 
	`GTK_COLOR_SELECTION_DIALOG
(
cﬁ‹£l
)->colorsel),

1054 &
gcﬁ
);

1056 
íåy
 = 
	`g_°rdup_¥ötf
("#%02X%02X%02X", 
gcﬁ
.
ªd
/256, gcﬁ.
gªí
/256, gcﬁ.
blue
/256);

1057 
	`dü_dy«mic_míu_£À˘_íåy
(
ddm
, 
íåy
);

1058 
	`g_‰ì
(
íåy
);

1060 
	`gtk_widgë_de°roy
(
cﬁ‹£l
);

1061 
	}
}

1064 
	$dü_cﬁ‹_£À˘‹_m‹e_ˇŒback
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
u£rd©a
)

1066 
GtkCﬁ‹Sñe˘i⁄Dülog
 *
dülog
 = 
	`GTK_COLOR_SELECTION_DIALOG
 (
	`gtk_cﬁ‹_£À˘i⁄_dülog_√w
(
	`_
("Select color")));

1067 
DüDy«micMíu
 *
ddm
 = 
	`DIA_DYNAMIC_MENU
(
u£rd©a
);

1068 
GtkCﬁ‹Sñe˘i⁄
 *
cﬁ‹£l
 = 
	`GTK_COLOR_SELECTION
(
dülog
->colorsel);

1069 
GSåög
 *
∑Àâe
 = 
	`g_°rög_√w
 ("");

1071 
gch¨
 *
ﬁd_cﬁ‹
 = 
	`dü_dy«mic_míu_gë_íåy
(
ddm
);

1073 
	`dü_dy«mic_míu_£À˘_íåy
(
ddm
, 
ﬁd_cﬁ‹
);

1075 i‡(
ddm
->
deÁu…_íåõs
 !
NULL
) {

1076 
GLi°
 *
tm∂i°
;

1077 
ödex
 = 0;

1078 
gboﬁón
 
adv™˚
 = 
TRUE
;

1080 
tm∂i°
 = 
ddm
->
deÁu…_íåõs
;

1081 
tm∂i°
 !
NULL
 || 
adv™˚
;

1082 
tm∂i°
 = 
	`g_li°_√xt
(tmplist)) {

1083 c⁄° 
gch¨
* 
•ec
;

1084 
GdkCﬁ‹
 
cﬁ‹
;

1087 i‡(!
tm∂i°
 && 
adv™˚
) {

1088 
adv™˚
 = 
FALSE
;

1089 
tm∂i°
 = 
	`≥rsi°ít_li°_gë_gli°
(
ddm
->
≥rsi°ít_«me
);

1090 i‡(!
tm∂i°
)

1093 
•ec
 = (
gch¨
 *)
tm∂i°
->
d©a
;

1095 
	`gdk_cﬁ‹_∑r£
 (
•ec
, &
cﬁ‹
);

1098 
	`gtk_cﬁ‹_£À˘i⁄_£t_∑Àâe_cﬁ‹
 (
cﬁ‹£l
, 
ödex
, &
cﬁ‹
);

1100 
	`g_°rög_≠≥nd
 (
∑Àâe
, 
•ec
);

1101 
	`g_°rög_≠≥nd
 (
∑Àâe
, ":");

1103 i‡(0 =
	`°rcmp
 (
•ec
, 
ﬁd_cﬁ‹
)) {

1104 
	`gtk_cﬁ‹_£À˘i⁄_£t_¥evious_cﬁ‹
 (
cﬁ‹£l
, &
cﬁ‹
);

1105 
	`gtk_cﬁ‹_£À˘i⁄_£t_cuºít_cﬁ‹
 (
cﬁ‹£l
, &
cﬁ‹
);

1107 
ödex
++;

1111 
	`g_obje˘_£t
 (
	`gtk_widgë_gë_£âögs
 (
	`GTK_WIDGET
 (
cﬁ‹£l
)), "gtk-cﬁ‹-∑Àâe", 
∑Àâe
->
°r
, 
NULL
);

1112 
	`gtk_cﬁ‹_£À˘i⁄_£t_has_∑Àâe
 (
cﬁ‹£l
, 
TRUE
);

1113 
	`g_°rög_‰ì
 (
∑Àâe
, 
TRUE
);

1114 
	`g_‰ì
(
ﬁd_cﬁ‹
);

1116 
	`gtk_widgë_hide
(
dülog
->
hñp_buâ⁄
);

1118 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
dülog
->
ok_buâ⁄
), "clicked",

1119 (
GtkSig«lFunc
Ë
dü_cﬁ‹_£À˘‹_m‹e_ok
,

1120 
dülog
);

1121 
	`gtk_sig«l_c⁄√˘_obje˘
(
	`GTK_OBJECT
 (
dülog
->
ˇn˚l_buâ⁄
), "clicked",

1122 (
GtkSig«lFunc
Ë
gtk_widgë_de°roy
,

1123 
	`GTK_OBJECT
(
dülog
));

1124 
	`g_obje˘_£t_d©a
(
	`G_OBJECT
(
dülog
), "ddm", 
ddm
);

1126 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
dülog
));

1127 
	}
}

1129 
GtkWidgë
 *

1130 
	$dü_cﬁ‹_£À˘‹_√w
 ()

1132 
GtkWidgë
 *
Ÿhîôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`_
("More colors..."));

1133 
GtkWidgë
 *
ddm
 = 
	`dü_dy«mic_míu_√w
(
dü_cﬁ‹_£À˘‹_¸óã_°rög_ôem
,

1134 
NULL
,

1135 
	`GTK_MENU_ITEM
(
Ÿhîôem
),

1137 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1139 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1141 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1143 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1145 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1147 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
Ÿhîôem
), "activate",

1148 
	`G_CALLBACK
(
dü_cﬁ‹_£À˘‹_m‹e_ˇŒback
), 
ddm
);

1149 
	`gtk_widgë_show
(
Ÿhîôem
);

1150  
ddm
;

1151 
	}
}

1155 
	$dü_cﬁ‹_£À˘‹_gë_cﬁ‹
(
GtkWidgë
 *
widgë
, 
Cﬁ‹
 *
cﬁ‹
)

1157 
gch¨
 *
íåy
 = 
	`dü_dy«mic_míu_gë_íåy
(
	`DIA_DYNAMIC_MENU
(
widgë
));

1158 
göt
 
r
, 
g
, 
b
;

1160 
	`ssˇnf
(
íåy
, "#%2x%2x%2x", &
r
, &
g
, &
b
);

1161 
	`g_‰ì
(
íåy
);

1162 
cﬁ‹
->
ªd
 = 
r
 / 255.0;

1163 
cﬁ‹
->
gªí
 = 
g
 / 255.0;

1164 
cﬁ‹
->
blue
 = 
b
 / 255.0;

1165 
	}
}

1168 
	$dü_cﬁ‹_£À˘‹_£t_cﬁ‹
 (
GtkWidgë
 *
widgë
,

1169 c⁄° 
Cﬁ‹
 *
cﬁ‹
)

1171 
göt
 
ªd
, 
gªí
, 
blue
;

1172 
gch¨
 *
íåy
;

1173 
ªd
 = 
cﬁ‹
->red * 255;

1174 
gªí
 = 
cﬁ‹
->green * 255;

1175 
blue
 = 
cﬁ‹
->blue * 255;

1176 i‡(
cﬁ‹
->
ªd
 > 1.0 || cﬁ‹->
gªí
 > 1.0 || cﬁ‹->
blue
 > 1.0) {

1177 
	`¥ötf
("Color out ofÑange:Ñ %f, g %f, b %f\n",

1178 
cﬁ‹
->
ªd
, cﬁ‹->
gªí
, cﬁ‹->
blue
);

1179 
ªd
 = 
	`MIN
(red, 255);

1180 
gªí
 = 
	`MIN
(green, 255);

1181 
blue
 = 
	`MIN
(blue, 255);

1183 
íåy
 = 
	`g_°rdup_¥ötf
("#%02X%02X%02X", 
ªd
, 
gªí
, 
blue
);

1184 
	`dü_dy«mic_míu_£À˘_íåy
(
	`DIA_DYNAMIC_MENU
(
widgë
), 
íåy
);

1185 
	`g_‰ì
 (
íåy
);

1186 
	}
}

1192 
	s_DüAºowSñe˘‹


1194 
GtkVBox
 
	mvbox
;

1196 
GtkHBox
 *
	msizebox
;

1197 
GtkLabñ
 *
	msizñabñ
;

1198 
DüSizeSñe˘‹
 *
	msize
;

1200 
GtkO±i⁄Míu
 *
	momíu
;

1203 
	s_DüAºowSñe˘‹Cœss


1205 
GtkVBoxCœss
 
	m∑ª¡_˛ass
;

1209 
	mDAS_VALUE_CHANGED
,

1210 
	mDAS_LAST_SIGNAL


1213 
guöt
 
	gdas_sig«ls
[
DAS_LAST_SIGNAL
] = {0};

1216 
	$dü_¨row_£À˘‹_˛ass_öô
 (
DüAºowSñe˘‹Cœss
 *
˛ass
)

1218 
das_sig«ls
[
DAS_VALUE_CHANGED
]

1219 
	`g_sig«l_√w
("value_changed",

1220 
	`G_TYPE_FROM_CLASS
(
˛ass
),

1221 
G_SIGNAL_RUN_FIRST
,

1222 0, 
NULL
, NULL,

1223 
g_c˛osuª_m¨shÆ_VOID__VOID
,

1224 
G_TYPE_NONE
, 0);

1225 
	}
}

1228 
	$£t_size_£nsôivôy
(
DüAºowSñe˘‹
 *
as
)

1230 
°©e
;

1231 
gch¨
 *
íåy«me
 = 
	`dü_dy«mic_míu_gë_íåy
(
	`DIA_DYNAMIC_MENU
(
as
->
omíu
));

1233 
°©e
 = (
íåy«me
 !
NULL
Ë&& (0 !
	`g_ascii_°rˇ£cmp
(entryname, "None"));

1234 
	`g_‰ì
(
íåy«me
);

1236 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
as
->
sizñabñ
), 
°©e
);

1237 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
as
->
size
), 
°©e
);

1238 
	}
}

1241 
	$¨row_ty≥_ch™ge_ˇŒback
(
DüDy«micMíu
 *
ddm
, 
gpoöãr
 
u£rd©a
)

1243 
	`£t_size_£nsôivôy
(
	`DIA_ARROW_SELECTOR
(
u£rd©a
));

1244 
	`g_sig«l_emô
(
	`DIA_ARROW_SELECTOR
(
u£rd©a
),

1245 
das_sig«ls
[
DAS_VALUE_CHANGED
], 0);

1246 
	}
}

1249 
	$¨row_size_ch™ge_ˇŒback
(
DüSizeSñe˘‹
 *
size
, 
gpoöãr
 
u£rd©a
)

1251 
	`g_sig«l_emô
(
	`DIA_ARROW_SELECTOR
(
u£rd©a
),

1252 
das_sig«ls
[
DAS_VALUE_CHANGED
], 0);

1253 
	}
}

1255 
GtkWidgë
 *

1256 
	$¸óã_¨row_míu_ôem
(
DüDy«micMíu
 *
ddm
, 
gch¨
 *
«me
)

1258 
AºowTy≥
 
©y≥
 = 
	`¨row_ty≥_‰om_«me
(
«me
);

1259 
GtkWidgë
 *
ôem
 = 
	`gtk_míu_ôem_√w
();

1260 
GtkWidgë
 *
¥evõw
 = 
	`dü_¨row_¥evõw_√w
(
©y≥
, 
FALSE
);

1262 
	`gtk_widgë_show
(
¥evõw
);

1263 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
ôem
), 
¥evõw
);

1264 
	`gtk_widgë_show
(
ôem
);

1265  
ôem
;

1266 
	}
}

1269 
	$dü_¨row_£À˘‹_öô
 (
DüAºowSñe˘‹
 *
as
,

1270 
gpoöãr
 
g_˛ass
)

1272 
GtkWidgë
 *
omíu
;

1273 
GtkWidgë
 *
box
;

1274 
GtkWidgë
 *
œbñ
;

1275 
GtkWidgë
 *
size
;

1277 
GLi°
 *
¨row_«mes
 = 
	`gë_¨row_«mes
();

1278 
omíu
 = 
	`dü_dy«mic_míu_√w_li°ba£d
(
¸óã_¨row_míu_ôem
,

1279 
as
,

1280 
	`_
("Moreárrows"),

1281 
¨row_«mes
,

1283 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
omíu
), "None");

1284 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
omíu
), "Lines");

1285 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
	`DIA_DYNAMIC_MENU
(
omíu
), "Filled Concave");

1286 
as
->
omíu
 = 
	`GTK_OPTION_MENU
(omenu);

1287 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
as
), 
omíu
, 
FALSE
, 
TRUE
, 0);

1288 
	`gtk_widgë_show
(
omíu
);

1290 
	`g_sig«l_c⁄√˘
(
	`DIA_DYNAMIC_MENU
(
omíu
),

1291 "vÆue-ch™ged", 
	`G_CALLBACK
(
¨row_ty≥_ch™ge_ˇŒback
),

1292 
as
);

1294 
box
 = 
	`gtk_hbox_√w
(
FALSE
,0);

1295 
as
->
sizebox
 = 
	`GTK_HBOX
(
box
);

1297 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Size: "));

1298 
as
->
sizñabñ
 = 
	`GTK_LABEL
(
œbñ
);

1299 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
box
), 
œbñ
);

1300 
	`gtk_widgë_show
(
œbñ
);

1302 
size
 = 
	`dü_size_£À˘‹_√w
(0.0, 0.0);

1303 
as
->
size
 = 
	`DIA_SIZE_SELECTOR
(size);

1304 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
box
), 
size
);

1305 
	`gtk_widgë_show
(
size
);

1306 
	`g_sig«l_c⁄√˘
(
size
, "value-changed",

1307 
	`G_CALLBACK
(
¨row_size_ch™ge_ˇŒback
), 
as
);

1309 
	`£t_size_£nsôivôy
(
as
);

1310 
	`gtk_box_∑ck_°¨t_deÁu…s
(
	`GTK_BOX
(
as
), 
box
);

1312 
	`gtk_widgë_show
(
box
);

1313 
	}
}

1315 
GTy≥


1316 
	$dü_¨row_£À˘‹_gë_ty≥
 ()

1318 
GTy≥
 
dfs_ty≥
 = 0;

1320 i‡(!
dfs_ty≥
) {

1321 c⁄° 
GTy≥Info
 
dfs_öfo
 = {

1323  (
DüAºowSñe˘‹Cœss
),

1324 (
GBa£InôFunc
Ë
NULL
,

1325 (
GBa£FöÆizeFunc
Ë
NULL
,

1326 (
GCœssInôFunc
Ë
dü_¨row_£À˘‹_˛ass_öô
,

1327 
NULL
,

1328 
NULL
,

1329  (
DüAºowSñe˘‹
),

1331 (
GIn°™˚InôFunc
)
dü_¨row_£À˘‹_öô
,

1340 
dfs_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
GTK_TYPE_VBOX
,

1342 &
dfs_öfo
, 0);

1345  
dfs_ty≥
;

1346 
	}
}

1348 
GtkWidgë
 *

1349 
	$dü_¨row_£À˘‹_√w
 ()

1351  
	`GTK_WIDGET
 ( 
	`g_obje˘_√w
 (
DIA_TYPE_ARROW_SELECTOR
, 
NULL
));

1352 
	}
}

1355 
Aºow


1356 
	$dü_¨row_£À˘‹_gë_¨row
(
DüAºowSñe˘‹
 *
as
)

1358 
Aºow
 
©
;

1359 
gch¨
 *
¨row«me
 = 
	`dü_dy«mic_míu_gë_íåy
(
	`DIA_DYNAMIC_MENU
(
as
->
omíu
));

1361 
©
.
ty≥
 = 
	`¨row_ty≥_‰om_«me
(
¨row«me
);

1362 
	`g_‰ì
(
¨row«me
);

1363 
	`dü_size_£À˘‹_gë_size
(
as
->
size
, &
©
.
width
, &©.
Àngth
);

1364  
©
;

1365 
	}
}

1368 
	$dü_¨row_£À˘‹_£t_¨row
 (
DüAºowSñe˘‹
 *
as
,

1369 
Aºow
 
¨row
)

1371 
	`dü_dy«mic_míu_£À˘_íåy
(
	`DIA_DYNAMIC_MENU
(
as
->
omíu
),

1372 
	`¨row_gë_«me_‰om_ty≥
(
¨row
.
ty≥
));

1373 
	`£t_size_£nsôivôy
(
as
);

1374 
	`dü_size_£À˘‹_£t_size
(
	`DIA_SIZE_SELECTOR
(
as
->
size
), 
¨row
.
width
,áºow.
Àngth
);

1375 
	}
}

1378 
	s_DüFûeSñe˘‹


1380 
GtkHBox
 
	mhbox
;

1381 
GtkE¡ry
 *
	míåy
;

1382 
GtkBuâ⁄
 *
	mbrow£
;

1383 
GtkWidgë
 *
	mdülog
;

1384 
gch¨
 *
	msys_fûíame
;

1387 
	s_DüFûeSñe˘‹Cœss


1389 
GtkHBoxCœss
 
	m∑ª¡_˛ass
;

1393 
	mDFILE_VALUE_CHANGED
,

1394 
	mDFILE_LAST_SIGNAL


1397 
guöt
 
	gdfûe_sig«ls
[
DFILE_LAST_SIGNAL
] = { 0 };

1400 
	$dü_fûe_£À˘‹_uƒólize
(
GtkWidgë
 *
widgë
)

1402 
DüFûeSñe˘‹
 *
fs
 = 
	`DIAFILESELECTOR
(
widgë
);

1404 i‡(
fs
->
dülog
 !
NULL
) {

1405 
	`gtk_widgë_de°roy
(
	`GTK_WIDGET
(
fs
->
dülog
));

1406 
fs
->
dülog
 = 
NULL
;

1408 i‡(
fs
->
sys_fûíame
) {

1409 
	`g_‰ì
(
fs
->
sys_fûíame
);

1410 
fs
->
sys_fûíame
 = 
NULL
;

1413 (* 
	`GTK_WIDGET_CLASS
 (
	`gtk_ty≥_˛ass
(
	`gtk_hbox_gë_ty≥
 ()))->
uƒólize
Ë(
widgë
);

1414 
	}
}

1417 
	$dü_fûe_£À˘‹_˛ass_öô
 (
DüFûeSñe˘‹Cœss
 *
˛ass
)

1419 
GtkObje˘Cœss
 *
obje˘_˛ass
;

1420 
GtkWidgëCœss
 *
widgë_˛ass
;

1422 
obje˘_˛ass
 = (
GtkObje˘Cœss
*Ë
˛ass
;

1423 
widgë_˛ass
 = (
GtkWidgëCœss
*Ë
˛ass
;

1424 
widgë_˛ass
->
uƒólize
 = 
dü_fûe_£À˘‹_uƒólize
;

1426 
dfûe_sig«ls
[
DFILE_VALUE_CHANGED
]

1427 
	`g_sig«l_√w
("value-changed",

1428 
	`G_TYPE_FROM_CLASS
(
˛ass
),

1429 
G_SIGNAL_RUN_FIRST
,

1430 0, 
NULL
, NULL,

1431 
g_c˛osuª_m¨shÆ_VOID__VOID
,

1432 
G_TYPE_NONE
, 0);

1433 
	}
}

1436 
	$dü_fûe_£À˘‹_íåy_ch™ged
(
GtkEdôabÀ
 *
edôabÀ


1437 , 
gpoöãr
 
d©a
)

1439 
DüFûeSñe˘‹
 *
fs
 = 
	`DIAFILESELECTOR
(
d©a
);

1440 
	`g_sig«l_emô
(
fs
, 
dfûe_sig«ls
[
DFILE_VALUE_CHANGED
], 0);

1441 
	}
}

1444 
	$fûe_›í_ª•⁄£_ˇŒback
(
GtkWidgë
 *
dülog
,

1445 
göt
 
ª•⁄£
,

1446 
gpoöãr
 
u£r_d©a
)

1448 
DüFûeSñe˘‹
 *
fs
 =

1449 
	`DIAFILESELECTOR
(
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
dülog
)));

1451 i‡(
ª•⁄£
 =
GTK_RESPONSE_ACCEPT
 ||Ñe•⁄£ =
GTK_RESPONSE_OK
) {

1452 
gch¨
 *
utf8
 = 
	`g_fûíame_to_utf8
(
	`gtk_fûe_choo£r_gë_fûíame
(
	`GTK_FILE_CHOOSER
(
dülog
)),

1453 -1, 
NULL
, NULL, NULL);

1454 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
fs
->
íåy
), 
utf8
);

1455 
	`g_‰ì
(
utf8
);

1457 
	`gtk_widgë_de°roy
(
	`GTK_WIDGET
(
dülog
));

1458 
	}
}

1461 
	$dü_fûe_£À˘‹_brow£_¥es£d
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

1463 
GtkWidgë
 *
dülog
;

1464 
DüFûeSñe˘‹
 *
fs
 = 
	`DIAFILESELECTOR
(
d©a
);

1465 
gch¨
 *
fûíame
;

1466 
GtkWidgë
 *
t›Àvñ
 = 
	`gtk_widgë_gë_t›Àvñ
 (
widgë
);

1468 i‡(!
	`GTK_WIDGET_TOPLEVEL
(
t›Àvñ
Ë|| !
	`GTK_WINDOW
(toplevel))

1469 
t›Àvñ
 = 
NULL
;

1471 i‡(
fs
->
dülog
 =
NULL
) {

1472 
GtkFûeFûãr
 *
fûãr
;

1474 
dülog
 = 
fs
->dialog =

1475 
	`gtk_fûe_choo£r_dülog_√w
 (
	`_
("Sñe˘ imagêfûe"), 
t›Àvñ
 ? 
	`GTK_WINDOW
—›ÀvñË: 
NULL
,

1476 
GTK_FILE_CHOOSER_ACTION_OPEN
,

1477 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

1478 
GTK_STOCK_OPEN
, 
GTK_RESPONSE_ACCEPT
,

1479 
NULL
);

1480 
	`gtk_dülog_£t_deÁu…_ª•⁄£
(
	`GTK_DIALOG
(
dülog
), 
GTK_RESPONSE_ACCEPT
);

1481 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
dülog
), "response",

1482 
	`G_CALLBACK
(
fûe_›í_ª•⁄£_ˇŒback
), 
NULL
);

1483 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
fs
->
dülog
), "destroy",

1484 
	`GTK_SIGNAL_FUNC
 (
gtk_widgë_de°royed
),

1485 &
fs
->
dülog
);

1487 
fûãr
 = 
	`gtk_fûe_fûãr_√w
 ();

1488 
	`gtk_fûe_fûãr_£t_«me
 (
fûãr
, 
	`_
("Supported Formats"));

1489 
	`gtk_fûe_fûãr_add_pixbuf_f‹m©s
 (
fûãr
);

1490 
	`gtk_fûe_choo£r_add_fûãr
 (
	`GTK_FILE_CHOOSER
 (
dülog
), 
fûãr
);

1492 
fûãr
 = 
	`gtk_fûe_fûãr_√w
 ();

1493 
	`gtk_fûe_fûãr_£t_«me
 (
fûãr
, 
	`_
("All Files"));

1494 
	`gtk_fûe_fûãr_add_∑âîn
 (
fûãr
, "*");

1495 
	`gtk_fûe_choo£r_add_fûãr
 (
	`GTK_FILE_CHOOSER
 (
dülog
), 
fûãr
);

1497 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
dülog
), 
fs
);

1500 
fûíame
 = 
	`g_fûíame_‰om_utf8
(
	`gtk_íåy_gë_ãxt
(
fs
->
íåy
), -1, 
NULL
, NULL, NULL);

1502 i‡(
	`g_∑th_is_absﬁuã
(
fûíame
))

1503 
	`gtk_fûe_choo£r_£t_fûíame
(
	`GTK_FILE_CHOOSER
(
fs
->
dülog
), 
fûíame
);

1505 
	`g_‰ì
(
fûíame
);

1507 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
fs
->
dülog
));

1508 
	}
}

1511 
	$dü_fûe_£À˘‹_öô
 (
DüFûeSñe˘‹
 *
fs
)

1514 
fs
->
dülog
 = 
NULL
;

1515 
fs
->
sys_fûíame
 = 
NULL
;

1517 
fs
->
íåy
 = 
	`GTK_ENTRY
(
	`gtk_íåy_√w
());

1518 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
íåy
), 
FALSE
, 
TRUE
, 0);

1519 
	`g_sig«l_c⁄√˘
(
	`GTK_OBJECT
(
fs
->
íåy
), "changed",

1520 
	`G_CALLBACK
(
dü_fûe_£À˘‹_íåy_ch™ged
), 
fs
);

1521 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
fs
->
íåy
));

1523 
fs
->
brow£
 = 
	`GTK_BUTTON
(
	`gtk_buâ⁄_√w_wôh_œbñ
(
	`_
("Browse")));

1524 
	`gtk_box_∑ck_°¨t
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
brow£
), 
FALSE
, 
TRUE
, 0);

1525 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
fs
->
brow£
), "clicked",

1526 (
GtkSig«lFunc
Ë
dü_fûe_£À˘‹_brow£_¥es£d
,

1527 
fs
);

1528 
	`gtk_widgë_show
(
	`GTK_WIDGET
(
fs
->
brow£
));

1529 
	}
}

1532 
GtkTy≥


1533 
	$dü_fûe_£À˘‹_gë_ty≥
 ()

1535 
GtkTy≥
 
dfs_ty≥
 = 0;

1537 i‡(!
dfs_ty≥
) {

1538 c⁄° 
GtkTy≥Info
 
dfs_öfo
 = {

1540  (
DüFûeSñe˘‹
),

1541  (
DüFûeSñe˘‹Cœss
),

1542 (
GtkCœssInôFunc
Ë
dü_fûe_£À˘‹_˛ass_öô
,

1543 (
GtkObje˘InôFunc
Ë
dü_fûe_£À˘‹_öô
,

1544 
NULL
,

1545 
NULL
,

1546 (
GtkCœssInôFunc
Ë
NULL
,

1549 
dfs_ty≥
 = 
	`gtk_ty≥_unique
 (
	`gtk_hbox_gë_ty≥
 (), &
dfs_öfo
);

1553  
dfs_ty≥
;

1554 
	}
}

1556 
GtkWidgë
 *

1557 
	$dü_fûe_£À˘‹_√w
 ()

1559  
	`GTK_WIDGET
 ( 
	`gtk_ty≥_√w
 (
	`dü_fûe_£À˘‹_gë_ty≥
 ()));

1560 
	}
}

1563 
	$dü_fûe_£À˘‹_£t_fûe
(
DüFûeSñe˘‹
 *
fs
, 
gch¨
 *
fûe
)

1566 
gch¨
 *
utf8
 = 
	`g_fûíame_to_utf8
(
fûe
, -1, 
NULL
, NULL, NULL);

1567 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
fs
->
íåy
), 
utf8
);

1568 
	`g_‰ì
(
utf8
);

1569 
	}
}

1571 c⁄° 
gch¨
 *

1572 
	$dü_fûe_£À˘‹_gë_fûe
(
DüFûeSñe˘‹
 *
fs
)

1575 
	`g_‰ì
(
fs
->
sys_fûíame
);

1576 
fs
->
sys_fûíame
 = 
	`g_fûíame_‰om_utf8
(
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(fs->
íåy
)),

1577 -1, 
NULL
, NULL, NULL);

1578  
fs
->
sys_fûíame
;

1579 
	}
}

1589 
dü_unô_•ö√r_öô
(
DüUnôSpö√r
 *
£lf
);

1591 
GTy≥


1592 
	$dü_unô_•ö√r_gë_ty≥
()

1594 
GTy≥
 
us_ty≥
 = 0;

1596 i‡(!
us_ty≥
) {

1597 c⁄° 
GTy≥Info
 
us_öfo
 = {

1598 (
DüUnôSpö√rCœss
),

1599 
NULL
,

1600 
NULL
,

1601 
NULL
,

1602 
NULL
,

1603 
NULL
,

1604 (
DüUnôSpö√r
),

1606 (
GIn°™˚InôFunc
Ë
dü_unô_•ö√r_öô
,

1608 
us_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
(
GTK_TYPE_SPIN_BUTTON
,

1610 &
us_öfo
, 0);

1612  
us_ty≥
;

1613 
	}
}

1617 
	$dü_unô_•ö√r_öô
(
DüUnôSpö√r
 *
£lf
)

1619 
£lf
->
unô_num
 = 
DIA_UNIT_CENTIMETER
;

1620 
	}
}

1627 
gboﬁón


1628 
dü_unô_•ö√r_öput
(
DüUnôSpö√r
 *
£lf
, 
gdoubÀ
 *
vÆue
);

1629 
gboﬁón
 
dü_unô_•ö√r_ouçut
(
DüUnôSpö√r
 *
£lf
);

1631 
GtkWidgë
 *

1632 
	$dü_unô_•ö√r_√w
(
GtkAdju°mít
 *
adju°mít
, 
DüUnô
 
adj_unô
)

1634 
DüUnôSpö√r
 *
£lf
;

1636 i‡(
adju°mít
) {

1637 
	`g_ªtu∫_vÆ_if_Áû
 (
	`GTK_IS_ADJUSTMENT
 (
adju°mít
), 
NULL
);

1640 
£lf
 = 
	`gtk_ty≥_√w
(
	`dü_unô_•ö√r_gë_ty≥
());

1641 
£lf
->
unô_num
 = 
adj_unô
;

1643 
	`gtk_•ö_buâ⁄_c⁄figuª
(
	`GTK_SPIN_BUTTON
(
£lf
),

1644 
adju°mít
, 0.0, 
unôs
[
adj_unô
].
digôs
);

1646 
	`g_sig«l_c⁄√˘
(
	`GTK_SPIN_BUTTON
(
£lf
), "output",

1647 
	`G_CALLBACK
(
dü_unô_•ö√r_ouçut
),

1648 
NULL
);

1649 
	`g_sig«l_c⁄√˘
(
	`GTK_SPIN_BUTTON
(
£lf
), "input",

1650 
	`G_CALLBACK
(
dü_unô_•ö√r_öput
),

1651 
NULL
);

1653  
	`GTK_WIDGET
(
£lf
);

1654 
	}
}

1656 
gboﬁón


1657 
	$dü_unô_•ö√r_öput
(
DüUnôSpö√r
 *
£lf
, 
gdoubÀ
 *
vÆue
)

1659 
gÊﬂt
 
vÆ
, 
Á˘‹
 = 1.0;

1660 
gch¨
 *
exåa
 = 
NULL
;

1662 
vÆ
 = 
	`g_°πod
(
	`gtk_íåy_gë_ãxt
(
	`GTK_ENTRY
(
£lf
)), &
exåa
);

1665 *
exåa
 && 
	`g_ascii_is•a˚
(*extra))Éxtra++;

1666 i‡(*
exåa
) {

1667 
i
;

1669 
i
 = 0; 
unôs
[i].
«me
 !
NULL
; i++)

1670 i‡(!
	`g_ascii_°rˇ£cmp
(
unôs
[
i
].
unô
, 
exåa
)) {

1671 
Á˘‹
 = 
unôs
[
i
].Á˘‹ / unôs[
£lf
->
unô_num
].factor;

1676 
vÆ
 *
Á˘‹
;

1679 *
vÆue
 = 
vÆ
;

1682  
TRUE
;

1683 
	}
}

1685 
gboﬁón
 
	$dü_unô_•ö√r_ouçut
(
DüUnôSpö√r
 *
£lf
)

1687 
buf
[256];

1689 
GtkSpöBuâ⁄
 *
sbuâ⁄
 = 
	`GTK_SPIN_BUTTON
(
£lf
);

1690 
GtkAdju°mít
 *
adju°mít
 = 
	`gtk_•ö_buâ⁄_gë_adju°mít
(
sbuâ⁄
);

1692 
	`g_¢¥ötf
(
buf
, (buf), "%0.*f %s",

1693 
	`gtk_•ö_buâ⁄_gë_digôs
(
sbuâ⁄
),

1694 
	`gtk_adju°mít_gë_vÆue
(
adju°mít
),

1695 
unôs
[
£lf
->
unô_num
].
unô
);

1696 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
£lf
), 
buf
);

1699  
TRUE
;

1700 
	}
}

1705 
	$dü_unô_•ö√r_£t_vÆue
(
DüUnôSpö√r
 *
£lf
, 
gdoubÀ
 
vÆ
)

1707 
GtkSpöBuâ⁄
 *
sbuâ⁄
 = 
	`GTK_SPIN_BUTTON
(
£lf
);

1709 
	`gtk_•ö_buâ⁄_£t_vÆue
(
sbuâ⁄
,

1710 
vÆ
 /

1711 (
unôs
[
£lf
->
unô_num
].
Á˘‹
 /

1712 
unôs
[
DIA_UNIT_CENTIMETER
].
Á˘‹
));

1713 
	}
}

1716 
gdoubÀ


1717 
	$dü_unô_•ö√r_gë_vÆue
(
DüUnôSpö√r
 *
£lf
)

1719 
GtkSpöBuâ⁄
 *
sbuâ⁄
 = 
	`GTK_SPIN_BUTTON
(
£lf
);

1721  
	`gtk_•ö_buâ⁄_gë_vÆue
(
sbuâ⁄
) *

1722 (
unôs
[
£lf
->
unô_num
].
Á˘‹
 / unôs[
DIA_UNIT_CENTIMETER
].factor);

1723 
	}
}

1729 
	$dü_unô_•ö√r_£t_uµî
 (
DüUnôSpö√r
 *
£lf
, 
gdoubÀ
 
vÆ
)

1731 
vÆ
 /(
unôs
[
£lf
->
unô_num
].
Á˘‹
 / unôs[
DIA_UNIT_CENTIMETER
].factor);

1733 
	`gtk_adju°mít_£t_uµî
 (

1734 
	`gtk_•ö_buâ⁄_gë_adju°mít
(
	`GTK_SPIN_BUTTON
(
£lf
)), 
vÆ
);

1735 
	}
}

1736 
GLi°
 *

1737 
	$gë_unôs_«me_li°
()

1739 
i
;

1740 
GLi°
 *
«me_li°
 = 
NULL
;

1742 i‡(
«me_li°
 =
NULL
) {

1743 
i
 = 0; 
unôs
[i].
«me
 !
NULL
; i++) {

1744 
«me_li°
 = 
	`g_li°_≠≥nd
“ame_li°, 
unôs
[
i
].
«me
);

1748  
«me_li°
;

1749 
	}
}

1753 
dü_dy«mic_míu_˛ass_öô
(
DüDy«micMíuCœss
 *
˛ass
);

1754 
dü_dy«mic_míu_öô
(
DüDy«micMíu
 *
£lf
);

1755 
dü_dy«mic_míu_¸óã_subli°
(
DüDy«micMíu
 *
ddm
,

1756 
GLi°
 *
ôems
,

1757 
DDMCª©eIãmFunc
 
¸óã
);

1758 
dü_dy«mic_míu_¸óã_míu
(
DüDy«micMíu
 *
ddm
);

1759 
dü_dy«mic_míu_de°roy
(
GtkObje˘
 *
obje˘
);

1762 
	mDDM_VALUE_CHANGED
,

1763 
	mDDM_LAST_SIGNAL


1766 
guöt
 
	gddm_sig«ls
[
DDM_LAST_SIGNAL
] = { 0 };

1768 
GtkTy≥


1769 
	$dü_dy«mic_míu_gë_ty≥
()

1771 
GtkTy≥
 
us_ty≥
 = 0;

1773 i‡(!
us_ty≥
) {

1774 c⁄° 
GtkTy≥Info
 
us_öfo
 = {

1776 (
DüDy«micMíu
),

1777 (
DüDy«micMíuCœss
),

1778 (
GtkCœssInôFunc
Ë
dü_dy«mic_míu_˛ass_öô
,

1779 (
GtkObje˘InôFunc
Ë
dü_dy«mic_míu_öô
,

1780 
NULL
,

1781 
NULL
,

1782 (
GtkCœssInôFunc
Ë
NULL
,

1784 
us_ty≥
 = 
	`gtk_ty≥_unique
(
	`gtk_›ti⁄_míu_gë_ty≥
(), &
us_öfo
);

1786  
us_ty≥
;

1787 
	}
}

1790 
	$dü_dy«mic_míu_˛ass_öô
(
DüDy«micMíuCœss
 *
˛ass
)

1792 
GtkObje˘Cœss
 *
obje˘_˛ass
 = (GtkObje˘Cœss*)
˛ass
;

1794 
obje˘_˛ass
->
de°roy
 = 
dü_dy«mic_míu_de°roy
;

1796 
ddm_sig«ls
[
DDM_VALUE_CHANGED
]

1797 
	`g_sig«l_√w
("value-changed",

1798 
	`G_TYPE_FROM_CLASS
(
˛ass
),

1799 
G_SIGNAL_RUN_FIRST
,

1800 0, 
NULL
, NULL,

1801 
g_c˛osuª_m¨shÆ_VOID__VOID
,

1802 
G_TYPE_NONE
, 0);

1803 
	}
}

1806 
	$dü_dy«mic_míu_öô
(
DüDy«micMíu
 *
£lf
)

1808 
	}
}

1811 
	$dü_dy«mic_míu_de°roy
(
GtkObje˘
 *
obje˘
)

1813 
DüDy«micMíu
 *
ddm
 = 
	`DIA_DYNAMIC_MENU
(
obje˘
);

1814 
GtkObje˘Cœss
 *
∑ª¡_˛ass
 = 
	`GTK_OBJECT_CLASS
(
	`g_ty≥_˛ass_≥ek_∑ª¡
(
	`GTK_OBJECT_GET_CLASS
(
obje˘
)));

1816 i‡(
ddm
->
a˘ive
)

1817 
	`g_‰ì
(
ddm
->
a˘ive
);

1818 
ddm
->
a˘ive
 = 
NULL
;

1820 i‡(
∑ª¡_˛ass
->
de°roy
)

1821 (* 
∑ª¡_˛ass
->
de°roy
Ë(
obje˘
);

1822 
	}
}

1833 
GtkWidgë
 *

1834 
	$dü_dy«mic_míu_√w
(
DDMCª©eIãmFunc
 
¸óã
,

1835 
gpoöãr
 
u£rd©a
,

1836 
GtkMíuIãm
 *
Ÿhîôem
, 
gch¨
 *
≥rsi°
)

1838 
DüDy«micMíu
 *
ddm
;

1840 
	`g_as£π
(
≥rsi°
 !
NULL
);

1842 
ddm
 = 
	`DIA_DYNAMIC_MENU
 ( 
	`gtk_ty≥_√w
 (
	`dü_dy«mic_míu_gë_ty≥
 ()));

1844 
ddm
->
¸óã_func
 = 
¸óã
;

1845 
ddm
->
u£rd©a
 = userdata;

1846 
ddm
->
Ÿhî_ôem
 = 
Ÿhîôem
;

1847 
ddm
->
≥rsi°ít_«me
 = 
≥rsi°
;

1848 
ddm
->
cﬁs
 = 1;

1850 
	`≥rsi°í˚_ªgi°î_li°
(
≥rsi°
);

1852 
	`dü_dy«mic_míu_¸óã_míu
(
ddm
);

1854  
	`GTK_WIDGET
(
ddm
);

1855 
	}
}

1859 
	$dü_dy«mic_míu_£À˘_íåy
(
DüDy«micMíu
 *
ddm
, c⁄° 
gch¨
 *
«me
)

1861 
göt
 
add_ªsu…
 = 
	`dü_dy«mic_míu_add_íåy
(
ddm
, 
«me
);

1862 i‡(
add_ªsu…
 == 0) {

1863 
GLi°
 *
tmp
;

1864 
i
 = 0;

1865 
tmp
 = 
ddm
->
deÁu…_íåõs
;Åm∞!
NULL
;

1866 
tmp
 = 
	`g_li°_√xt
—mp), 
i
++) {

1867 i‡(!
	`g_ascii_°rˇ£cmp
(
tmp
->
d©a
, 
«me
))

1868 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
ddm
), 
i
);

1872 i‡(
ddm
->
deÁu…_íåõs
 !
NULL
)

1873 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
ddm
),

1874 
	`g_li°_Àngth
(
ddm
->
deÁu…_íåõs
)+1);

1876 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
ddm
), 0);

1879 
	`g_‰ì
(
ddm
->
a˘ive
);

1880 
ddm
->
a˘ive
 = 
	`g_°rdup
(
«me
);

1881 
	`g_sig«l_emô
(
	`GTK_OBJECT
(
ddm
), 
ddm_sig«ls
[
DDM_VALUE_CHANGED
], 0);

1882 
	}
}

1885 
	$dü_dy«mic_míu_a˘iv©e
(
GtkWidgë
 *
ôem
, 
gpoöãr
 
u£rd©a
)

1887 
DüDy«micMíu
 *
ddm
 = 
	`DIA_DYNAMIC_MENU
(
u£rd©a
);

1888 
gch¨
 *
«me
 = 
	`g_obje˘_gë_d©a
(
	`G_OBJECT
(
ôem
), "ddm_name");

1889 
	`dü_dy«mic_míu_£À˘_íåy
(
ddm
, 
«me
);

1890 
	}
}

1892 
GtkWidgë
 *

1893 
	$dü_dy«mic_míu_¸óã_°rög_ôem
(
DüDy«micMíu
 *
ddm
, 
gch¨
 *
°rög
)

1895 
GtkWidgë
 *
ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
	`gëãxt
(
°rög
));

1896  
ôem
;

1897 
	}
}

1902 
GtkWidgë
 *

1903 
	$dü_dy«mic_míu_√w_°rögba£d
(
GtkMíuIãm
 *
Ÿhîôem
,

1904 
gpoöãr
 
u£rd©a
,

1905 
gch¨
 *
≥rsi°
)

1907 
GtkWidgë
 *
ddm
 = 
	`dü_dy«mic_míu_√w
(
dü_dy«mic_míu_¸óã_°rög_ôem
,

1908 
u£rd©a
,

1909 
Ÿhîôem
, 
≥rsi°
);

1910  
ddm
;

1911 
	}
}

1917 
GtkWidgë
 *

1918 
	$dü_dy«mic_míu_√w_li°ba£d
(
DDMCª©eIãmFunc
 
¸óã
,

1919 
gpoöãr
 
u£rd©a
,

1920 
gch¨
 *
Ÿhî_œbñ
, 
GLi°
 *
ôems
,

1921 
gch¨
 *
≥rsi°
)

1923 
GtkWidgë
 *
ôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
(
Ÿhî_œbñ
);

1924 
GtkWidgë
 *
ddm
 = 
	`dü_dy«mic_míu_√w
(
¸óã
, 
u£rd©a
,

1925 
	`GTK_MENU_ITEM
(
ôem
), 
≥rsi°
);

1928 
	`gtk_widgë_show
(
ôem
);

1929  
ddm
;

1930 
	}
}

1935 
GtkWidgë
 *

1936 
	$dü_dy«mic_míu_√w_°rögli°ba£d
(
gch¨
 *
Ÿhî_œbñ
,

1937 
GLi°
 *
ôems
,

1938 
gpoöãr
 
u£rd©a
,

1939 
gch¨
 *
≥rsi°
)

1941  
	`dü_dy«mic_míu_√w_li°ba£d
(
dü_dy«mic_míu_¸óã_°rög_ôem
,

1942 
u£rd©a
,

1943 
Ÿhî_œbñ
, 
ôems
, 
≥rsi°
);

1944 
	}
}

1947 
	$dü_dy«mic_míu_¸óã_subli°
(
DüDy«micMíu
 *
ddm
,

1948 
GLi°
 *
ôems
, 
DDMCª©eIãmFunc
 
¸óã
)

1950 
GtkWidgë
 *
ôem
 = 
	`GTK_WIDGET
(
ddm
->
Ÿhî_ôem
);

1952 
GtkWidgë
 *
submíu
 = 
	`gtk_míu_√w
();

1954 ; 
ôems
 !
NULL
; iãm†
	`g_li°_√xt
(items)) {

1955 
GtkWidgë
 *
submíuôem
 = (
¸óã
)(
ddm
, 
ôems
->
d©a
);

1957 
	`gtk_míu_shñl_≠≥nd
(
	`GTK_MENU_SHELL
(
submíu
), 
submíuôem
);

1958 
	`g_obje˘_£t_d©a
(
	`G_OBJECT
(
submíuôem
), "ddm_«me", 
ôems
->
d©a
);

1959 
	`g_sig«l_c⁄√˘
(
submíuôem
, "activate",

1960 
	`G_CALLBACK
(
dü_dy«mic_míu_a˘iv©e
), 
ddm
);

1961 
	`gtk_widgë_show
(
submíuôem
);

1964 
	`gtk_míu_ôem_£t_submíu
(
	`GTK_MENU_ITEM
(
ôem
), 
submíu
);

1965 
	`gtk_widgë_show
(
submíu
);

1966 
	}
}

1978 
	$dü_dy«mic_míu_add_deÁu…_íåy
(
DüDy«micMíu
 *
ddm
, c⁄° 
gch¨
 *
íåy
)

1980 
ddm
->
deÁu…_íåõs
 = 
	`g_li°_≠≥nd
(ddm->default_entries,

1981 
	`g_°rdup
(
íåy
));

1983 
	`dü_dy«mic_míu_¸óã_míu
(
ddm
);

1984 
	}
}

1990 
	$dü_dy«mic_míu_£t_cﬁumns
(
DüDy«micMíu
 *
ddm
, 
göt
 
cﬁs
)

1992 
ddm
->
cﬁs
 = cols;

1994 
	`dü_dy«mic_míu_¸óã_míu
(
ddm
);

1995 
	}
}

2007 
göt


2008 
	$dü_dy«mic_míu_add_íåy
(
DüDy«micMíu
 *
ddm
, c⁄° 
gch¨
 *
íåy
)

2010 
GLi°
 *
tmp
;

2011 
gboﬁón
 
exi°ed
;

2013 
tmp
 = 
ddm
->
deÁu…_íåõs
;Åm∞!
NULL
;Åm∞
	`g_li°_√xt
(tmp)) {

2014 i‡(!
	`g_ascii_°rˇ£cmp
(
tmp
->
d©a
, 
íåy
))

2017 
exi°ed
 = 
	`≥rsi°ít_li°_add
(
ddm
->
≥rsi°ít_«me
, 
íåy
);

2019 
	`dü_dy«mic_míu_¸óã_míu
(
ddm
);

2021  
exi°ed
?1:2;

2022 
	}
}

2027 
gch¨
 *

2028 
	$dü_dy«mic_míu_gë_íåy
(
DüDy«micMíu
 *
ddm
)

2030  
	`g_°rdup
(
ddm
->
a˘ive
);

2031 
	}
}

2037 
	$dü_dy«mic_míu_¸óã_míu
(
DüDy«micMíu
 *
ddm
)

2039 
GtkWidgë
 *
£p
;

2040 
GLi°
 *
tm∂i°
;

2041 
GtkWidgë
 *
míu
;

2042 
GtkWidgë
 *
ôem
;

2044 
	`g_obje˘_ªf
(
	`G_OBJECT
(
ddm
->
Ÿhî_ôem
));

2045 
míu
 = 
	`gtk_›ti⁄_míu_gë_míu
(
	`GTK_OPTION_MENU
(
ddm
));

2046 i‡(
míu
 !
NULL
) {

2047 
	`gtk_c⁄èöî_ªmove
(
	`GTK_CONTAINER
(
míu
), 
	`GTK_WIDGET
(
ddm
->
Ÿhî_ôem
));

2048 
	`gtk_c⁄èöî_f‹óch
(
	`GTK_CONTAINER
(
míu
),

2049 (
GtkCÆlback
)
gtk_widgë_de°roy
, 
NULL
);

2050 
	`gtk_›ti⁄_míu_ªmove_míu
(
	`GTK_OPTION_MENU
(
ddm
));

2053 
míu
 = 
	`gtk_míu_√w
();

2055 i‡(
ddm
->
deÁu…_íåõs
 !
NULL
) {

2056 
tm∂i°
 = 
ddm
->
deÁu…_íåõs
;Åm∂i° !
NULL
;Åm∂i° = 
	`g_li°_√xt
(tmplist)) {

2057 
GtkWidgë
 *
ôem
 = (
ddm
->
¸óã_func
)(ddm, 
tm∂i°
->
d©a
);

2058 
	`g_obje˘_£t_d©a
(
	`G_OBJECT
(
ôem
), "ddm_«me", 
tm∂i°
->
d©a
);

2059 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
ôem
), "activate",

2060 
	`G_CALLBACK
(
dü_dy«mic_míu_a˘iv©e
), 
ddm
);

2061 
	`gtk_míu_shñl_≠≥nd
(
	`GTK_MENU_SHELL
(
míu
), 
ôem
);

2062 
	`gtk_widgë_show
(
ôem
);

2064 
£p
 = 
	`gtk_£∑øt‹_míu_ôem_√w
();

2065 
	`gtk_widgë_show
(
£p
);

2066 
	`gtk_míu_shñl_≠≥nd
(
	`GTK_MENU_SHELL
(
míu
), 
£p
);

2069 
tm∂i°
 = 
	`≥rsi°ít_li°_gë_gli°
(
ddm
->
≥rsi°ít_«me
);

2070 
tm∂i°
 !
NULL
;Åm∂i° = 
	`g_li°_√xt
(tmplist)) {

2071 
GtkWidgë
 *
ôem
 = (
ddm
->
¸óã_func
)(ddm, 
tm∂i°
->
d©a
);

2072 
	`g_obje˘_£t_d©a
(
	`G_OBJECT
(
ôem
), "ddm_«me", 
tm∂i°
->
d©a
);

2073 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
ôem
), "activate",

2074 
	`G_CALLBACK
(
dü_dy«mic_míu_a˘iv©e
), 
ddm
);

2075 
	`gtk_míu_shñl_≠≥nd
(
	`GTK_MENU_SHELL
(
míu
), 
ôem
);

2076 
	`gtk_widgë_show
(
ôem
);

2093 
	`gtk_›ti⁄_míu_£t_míu
(
	`GTK_OPTION_MENU
(
ddm
), 
míu
);

2095 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
	`GTK_OPTION_MENU
(
ddm
), 0);

2096 
	}
}

2103 
	$dü_dy«mic_míu_£t_s‹tög_mëhod
(
DüDy«micMíu
 *
ddm
, 
DdmS‹tTy≥
 
s‹t
)

2105 
	}
}

2110 
	$dü_dy«mic_míu_ª£t
(
GtkWidgë
 *
ôem
, 
gpoöãr
 
u£rd©a
)

2112 
DüDy«micMíu
 *
ddm
 = 
	`DIA_DYNAMIC_MENU
(
u£rd©a
);

2113 
Pîsi°ítLi°
 *
∂i°
 = 
	`≥rsi°ít_li°_gë
(
ddm
->
≥rsi°ít_«me
);

2114 
gch¨
 *
a˘ive
 = 
	`dü_dy«mic_míu_gë_íåy
(
ddm
);

2115 
	`g_li°_f‹óch
(
∂i°
->
gli°
, (
GFunc
)
g_‰ì
, 
NULL
);

2116 
	`g_li°_‰ì
(
∂i°
->
gli°
);

2117 
∂i°
->
gli°
 = 
NULL
;

2118 
	`dü_dy«mic_míu_¸óã_míu
(
ddm
);

2119 i‡(
a˘ive
)

2120 
	`dü_dy«mic_míu_£À˘_íåy
(
ddm
, 
a˘ive
);

2121 
	`g_‰ì
(
a˘ive
);

2122 
	}
}

2128 
	$dü_dy«mic_míu_£t_max_íåõs
(
DüDy«micMíu
 *
ddm
, 
göt
 
max
)

2130 
	}
}

2134 
	simage_∑ú
 { 
GtkWidgë
 *
	m⁄
; GtkWidgë *
	moff
; };

2137 
	$dü_toggÀ_buâ⁄_sw≠_images
(
GtkToggÀBuâ⁄
 *
widgë
,

2138 
gpoöãr
 
d©a
)

2140 
image_∑ú
 *
images
 = (image_∑ú *)
d©a
;

2141 i‡(
	`gtk_toggÀ_buâ⁄_gë_a˘ive
(
widgë
)) {

2142 
	`gtk_c⁄èöî_ªmove
(
	`GTK_CONTAINER
(
widgë
),

2143 
	`gtk_bö_gë_chûd
(
	`GTK_BIN
(
widgë
)));

2144 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
widgë
),

2145 
images
->
⁄
);

2148 
	`gtk_c⁄èöî_ªmove
(
	`GTK_CONTAINER
(
widgë
),

2149 
	`gtk_bö_gë_chûd
(
	`GTK_BIN
(
widgë
)));

2150 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
widgë
),

2151 
images
->
off
);

2153 
	}
}

2156 
	$dü_toggÀ_buâ⁄_de°roy
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
d©a
)

2158 
image_∑ú
 *
images
 = (image_∑ú *)
d©a
;

2160 i‡(
images
->
⁄
)

2161 
	`g_obje˘_uƒef
(
images
->
⁄
);

2162 
images
->
⁄
 = 
NULL
;

2163 i‡(
images
->
off
)

2164 
	`g_obje˘_uƒef
(
images
->
off
);

2165 
images
->
off
 = 
NULL
;

2166 i‡(
images
)

2167 
	`g_‰ì
(
images
);

2168 
images
 = 
NULL
;

2169 
	}
}

2172 
GtkWidgë
 *

2173 
	$dü_toggÀ_buâ⁄_√w
(
GtkWidgë
 *
⁄_widgë
, GtkWidgë *
off_widgë
)

2175 
GtkWidgë
 *
buâ⁄
 = 
	`gtk_toggÀ_buâ⁄_√w
();

2176 
GtkRcStyÀ
 *
rc°yÀ
;

2177 
GVÆue
 *
¥›
;

2178 
göt
 
i
;

2179 
image_∑ú
 *
images
;

2181 
images
 = 
	`g_√w
(
image_∑ú
, 1);

2184 
images
->
⁄
 = 
⁄_widgë
;

2185 
	`g_obje˘_ªf
(
	`G_OBJECT
(
images
->
⁄
));

2186 
	`gtk_obje˘_sök
(
	`GTK_OBJECT
(
images
->
⁄
));

2187 
	`gtk_widgë_show
(
images
->
⁄
);

2189 
images
->
off
 = 
off_widgë
;

2190 
	`g_obje˘_ªf
(
	`G_OBJECT
(
images
->
off
));

2191 
	`gtk_obje˘_sök
(
	`GTK_OBJECT
(
images
->
off
));

2192 
	`gtk_widgë_show
(
images
->
off
);

2195 
	`gtk_misc_£t_∑ddög
(
	`GTK_MISC
(
images
->
⁄
), 0, 0);

2196 
	`gtk_misc_£t_∑ddög
(
	`GTK_MISC
(
images
->
off
), 0, 0);

2197 
	`GTK_WIDGET_UNSET_FLAGS
(
	`GTK_WIDGET
(
buâ⁄
), 
GTK_CAN_FOCUS
);

2198 
	`GTK_WIDGET_UNSET_FLAGS
(
	`GTK_WIDGET
(
buâ⁄
), 
GTK_CAN_DEFAULT
);

2200 
rc°yÀ
 = 
	`gtk_rc_°yÀ_√w
 ();

2201 
rc°yÀ
->
xthick√ss
 =Ñc°yÀ->
ythick√ss
 = 0;

2202 
	`gtk_widgë_modify_°yÀ
 (
buâ⁄
, 
rc°yÀ
);

2203 
	`gtk_rc_°yÀ_uƒef
 (
rc°yÀ
);

2205 
¥›
 = 
	`g_√w0
(
GVÆue
, 1);

2206 
	`g_vÆue_öô
(
¥›
, 
G_TYPE_INT
);

2207 
	`gtk_widgë_°yÀ_gë_¥›îty
(
	`GTK_WIDGET
(
buâ⁄
), "focus-∑ddög", 
¥›
);

2208 
i
 = 
	`g_vÆue_gë_öt
(
¥›
);

2209 
	`g_vÆue_£t_öt
(
¥›
, 0);

2210 
	`g_‰ì
(
¥›
);

2212 
	`gtk_buâ⁄_£t_ªlõf
(
	`GTK_BUTTON
(
buâ⁄
), 
GTK_RELIEF_NONE
);

2214 
	`gtk_c⁄èöî_£t_b‹dî_width
(
	`GTK_CONTAINER
(
buâ⁄
), 0);

2216 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
buâ⁄
), 
images
->
off
);

2218 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
buâ⁄
), "toggled",

2219 
	`G_CALLBACK
(
dü_toggÀ_buâ⁄_sw≠_images
), 
images
);

2220 
	`g_sig«l_c⁄√˘
(
	`G_OBJECT
(
buâ⁄
), "destroy",

2221 
	`G_CALLBACK
(
dü_toggÀ_buâ⁄_de°roy
), 
images
);

2223  
buâ⁄
;

2224 
	}
}

2229 
GtkWidgë
 *

2230 
	$dü_toggÀ_buâ⁄_√w_wôh_ic⁄s
(c⁄° 
guöt8
 *
⁄_ic⁄
,

2231 c⁄° 
guöt8
 *
off_ic⁄
)

2233 
GdkPixbuf
 *
p1
, *
p2
;

2235 
p1
 = 
	`gdk_pixbuf_√w_‰om_ölöe
(-1, 
⁄_ic⁄
, 
FALSE
, 
NULL
);

2236 
p2
 = 
	`gdk_pixbuf_√w_‰om_ölöe
(-1, 
off_ic⁄
, 
FALSE
, 
NULL
);

2238  
	`dü_toggÀ_buâ⁄_√w
(
	`gtk_image_√w_‰om_pixbuf
(
p1
),

2239 
	`gtk_image_√w_‰om_pixbuf
(
p2
));

2240 
	}
}

	@O:\tool\dvs50\lib\widgets.h

18 #i‚de‡
WIDGETS_H


19 
	#WIDGETS_H


	)

21 
	~<c⁄fig.h
>

23 
	~<gdk/gdk.h
>

24 
	~<gtk/gtkmíu.h
>

25 
	~<gtk/gtk›ti⁄míu.h
>

26 
	~<gtk/gtkdøwög¨ó.h
>

27 
	~<gtk/gtkcﬁ‹£l.h
>

28 
	~<gtk/gtkhbox.h
>

29 
	~<gtk/gtkfûe£l.h
>

30 
	~<gtk/gtk•öbuâ⁄.h
>

31 
	~<gtk/gtkœbñ.h
>

32 
	~<gtk/gtkcﬁ‹£ldülog.h
>

33 
	~<gtk/gtkmíuôem.h
>

35 
	~"düty≥s.h
"

36 
	~"f⁄t.h
"

37 
	~"cﬁ‹.h
"

38 
	~"¨rows.h
"

39 
	~"unôs.h
"

42 
	#DIAFONTSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_f⁄t_£À˘‹_gë_ty≥
 (), 
DüF⁄tSñe˘‹
)

	)

43 
	#DIAFONTSELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_f⁄t_£À˘‹_gë_ty≥
 (), 
DüF⁄tSñe˘‹Cœss
)

	)

44 
	#IS_DIAFONTSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_f⁄t_£À˘‹_gë_ty≥
 ())

	)

47 
DIAVAR
 
GTy≥
 
dü_f⁄t_£À˘‹_gë_ty≥
 ();

48 
DIAVAR
 
GtkWidgë
* 
dü_f⁄t_£À˘‹_√w
 ();

49 
DIAVAR
 
dü_f⁄t_£À˘‹_£t_f⁄t
 (
DüF⁄tSñe˘‹
 *
fs
, 
DüF⁄t
 *
f⁄t
);

50 
dü_f⁄t_£À˘‹_£t_¥evõw
 (
DüF⁄tSñe˘‹
 *
fs
, 
gch¨
 *
ãxt
);

51 
DIAVAR
 
DüF⁄t
 * 
dü_f⁄t_£À˘‹_gë_f⁄t
 (
DüF⁄tSñe˘‹
 *
fs
);

54 
	#DIAALIGNMENTSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_Æignmít_£À˘‹_gë_ty≥
 (), 
DüAlignmítSñe˘‹
)

	)

55 
	#DIAALIGNMENTSELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_Æignmít_£À˘‹_gë_ty≥
 (), 
DüAlignmítSñe˘‹Cœss
)

	)

56 
	#IS_DIAALIGNMENTSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_Æignmít_£À˘‹_gë_ty≥
 ())

	)

59 
DIAVAR
 
GTy≥
 
dü_Æignmít_£À˘‹_gë_ty≥
 ();

60 
DIAVAR
 
GtkWidgë
* 
dü_Æignmít_£À˘‹_√w
 ();

61 
DIAVAR
 
Alignmít
 
dü_Æignmít_£À˘‹_gë_Æignmít
 (
DüAlignmítSñe˘‹
 *
as
);

62 
DIAVAR
 
dü_Æignmít_£À˘‹_£t_Æignmít
 (
DüAlignmítSñe˘‹
 *
as
,

63 
Alignmít
 
Æign
);

66 
	#DIALINESTYLESELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_löe_°yÀ_£À˘‹_gë_ty≥
 (), 
DüLöeStyÀSñe˘‹
)

	)

67 
	#DIALINESTYLESELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_löe_°yÀ_£À˘‹_gë_ty≥
 (), 
DüLöeStyÀSñe˘‹Cœss
)

	)

68 
	#IS_DIALINESTYLESELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_löe_°yÀ_£À˘‹_gë_ty≥
 ())

	)

70 
	#DEFAULT_LINESTYLE
 
LINESTYLE_SOLID


	)

71 
	#DEFAULT_LINESTYLE_DASHLEN
 1.0

	)

74 
DIAVAR
 
GTy≥
 
dü_löe_°yÀ_£À˘‹_gë_ty≥
 ();

75 
DIAVAR
 
GtkWidgë
* 
dü_löe_°yÀ_£À˘‹_√w
 ();

76 
DIAVAR
 
dü_löe_°yÀ_£À˘‹_gë_löe°yÀ
 (
DüLöeStyÀSñe˘‹
 *
as
,

77 
LöeStyÀ
 *
löe°yÀ
,

78 
ªÆ
 *
dashÀngth
);

79 
DIAVAR
 
dü_löe_°yÀ_£À˘‹_£t_löe°yÀ
 (
DüLöeStyÀSñe˘‹
 *
as
,

80 
LöeStyÀ
 
löe°yÀ
,

81 
ªÆ
 
dashÀngth
);

84 
	#DIACOLORSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_cﬁ‹_£À˘‹_gë_ty≥
 (), 
DüCﬁ‹Sñe˘‹
)

	)

85 
	#DIACOLORSELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_cﬁ‹_£À˘‹_gë_ty≥
 (), 
DüCﬁ‹Sñe˘‹Cœss
)

	)

86 
	#IS_DIACOLORSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_cﬁ‹_£À˘‹_gë_ty≥
 ())

	)

88 
	#DEFAULT_FG_COLOR
 
cﬁ‹_bœck


	)

89 
	#DEFAULT_BG_COLOR
 
cﬁ‹_whôe


	)

90 
	#DEFAULT_COLOR
 
cﬁ‹_whôe


	)

94 
DIAVAR
 
GTy≥
 
dü_cﬁ‹_£À˘‹_gë_ty≥
 ();

95 
DIAVAR
 
GtkWidgë
* 
dü_cﬁ‹_£À˘‹_√w
 ();

96 
DIAVAR
 
dü_cﬁ‹_£À˘‹_gë_cﬁ‹
 (
GtkWidgë
 *
cs
, 
Cﬁ‹
 *
cﬁ‹
);

97 
DIAVAR
 
dü_cﬁ‹_£À˘‹_£t_cﬁ‹
 (
GtkWidgë
 *
cs
,

98 c⁄° 
Cﬁ‹
 *
cﬁ‹
);

102 
	#DIA_TYPE_ARROW_SELECTOR
 (
	`dü_¨row_£À˘‹_gë_ty≥
())

	)

103 
	#DIA_ARROW_SELECTOR
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_¨row_£À˘‹_gë_ty≥
 (), 
DüAºowSñe˘‹
))

	)

104 
	#DIA_ARROW_SELECTOR_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_¨row_£À˘‹_gë_ty≥
 (), 
DüAºowSñe˘‹Cœss
))

	)

105 
	#DIA_IS_ARROW_SELECTOR
(
obj
Ë(
	`G_TYPE_CHECK_TYPE
 (obj, 
	`dü_¨row_£À˘‹_gë_ty≥
 ()))

	)

106 
	#DIA_ARROW_SELECTOR_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_ARROW_SELECTOR
, 
DüAºowSñe˘‹Cœss
))

	)

108 
	#DEFAULT_ARROW
 
ARROW_NONE


	)

109 
	#DEFAULT_ARROW_LENGTH
 
DEFAULT_ARROW_SIZE


	)

110 
	#DEFAULT_ARROW_WIDTH
 
DEFAULT_ARROW_SIZE


	)

113 
DIAVAR
 
GTy≥
 
dü_¨row_£À˘‹_gë_ty≥
 ();

114 
DIAVAR
 
GtkWidgë
* 
dü_¨row_£À˘‹_√w
 ();

115 
DIAVAR
 
Aºow
 
dü_¨row_£À˘‹_gë_¨row
 (
DüAºowSñe˘‹
 *
as
);

116 
DIAVAR
 
dü_¨row_£À˘‹_£t_¨row
 (
DüAºowSñe˘‹
 *
as
,

117 
Aºow
 
¨row
);

121 
	#DIAFILESELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_fûe_£À˘‹_gë_ty≥
 (), 
DüFûeSñe˘‹
)

	)

122 
	#DIAFILESELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_fûe_£À˘‹_gë_ty≥
 (), 
DüFûeSñe˘‹Cœss
)

	)

123 
	#IS_DIAFILESELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_fûe_£À˘‹_gë_ty≥
 ())

	)

126 
DIAVAR
 
GTy≥
 
dü_fûe_£À˘‹_gë_ty≥
 ();

127 
DIAVAR
 
GtkWidgë
* 
dü_fûe_£À˘‹_√w
 ();

128 
DIAVAR
 
dü_fûe_£À˘‹_£t_fûe
 (
DüFûeSñe˘‹
 *
fs
, *
fûe
);

129 
DIAVAR
 c⁄° 
gch¨
 *
dü_fûe_£À˘‹_gë_fûe
 (
DüFûeSñe˘‹
 *
fs
);

132 
	#DIA_SIZE_SELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_size_£À˘‹_gë_ty≥
 (), 
DüSizeSñe˘‹
)

	)

133 
	#DIA_SIZE_SELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_size_£À˘‹_gë_ty≥
 (), 
DüSizeSñe˘‹Cœss
)

	)

134 
	#IS_DIA_SIZE_SELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_size_£À˘‹_gë_ty≥
 ())

	)

137 
DIAVAR
 
GTy≥
 
dü_size_£À˘‹_gë_ty≥
 ();

138 
DIAVAR
 
GtkWidgë
* 
dü_size_£À˘‹_√w
 (
ªÆ
 
width
,Ñó»
height
);

139 
DIAVAR
 
dü_size_£À˘‹_£t_locked
(
DüSizeSñe˘‹
 *
ss
, 
gboﬁón
 
locked
);

140 
DIAVAR
 
dü_size_£À˘‹_£t_size
 (
DüSizeSñe˘‹
 *
ss
, 
ªÆ
 
width
,Ñó»
height
);

141 
DIAVAR
 
gboﬁón
 
dü_size_£À˘‹_gë_size
 (
DüSizeSñe˘‹
 *
ss
, 
ªÆ
 *
width
,Ñó»*
height
);

145 
	#DIA_UNIT_SPINNER
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
(obj, 
	`dü_unô_•ö√r_gë_ty≥
(), 
DüUnôSpö√r
)

	)

146 
	#DIA_UNIT_SPINNER_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
(kœss, 
	`dü_unô_•ö√r_gë_ty≥
(), 
DüUnôSpö√rCœss
)

	)

147 
	#DIA_IS_UNIT_SPINNER
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
(obj, 
	`dü_unô_•ö√r_gë_ty≥
())

	)

149 
_DüUnôSpö√r
 
	tDüUnôSpö√r
;

150 
_DüUnôSpö√rCœss
 
	tDüUnôSpö√rCœss
;

152 
	s_DüUnôSpö√r
 {

153 
GtkSpöBuâ⁄
 
	m∑ª¡
;

155 
DüUnô
 
	munô_num
;

158 
	s_DüUnôSpö√rCœss
 {

159 
GtkSpöBuâ⁄Cœss
 
	m∑ª¡_˛ass
;

163 
DIAVAR
 
GTy≥
 
dü_unô_•ö√r_gë_ty≥
 ();

164 
DIAVAR
 
GtkWidgë
 *
dü_unô_•ö√r_√w
 (
GtkAdju°mít
 *
adju°mít
,

165 
DüUnô
 
adj_unô
);

166 
DIAVAR
 
dü_unô_•ö√r_£t_vÆue
 (
DüUnôSpö√r
 *
£lf
, 
gdoubÀ
 
vÆ
);

167 
DIAVAR
 
gdoubÀ
 
dü_unô_•ö√r_gë_vÆue
 (
DüUnôSpö√r
 *
£lf
);

168 
DIAVAR
 
dü_unô_•ö√r_£t_uµî
 (
DüUnôSpö√r
 *
£lf
, 
gdoubÀ
 
vÆ
);

170 
DIAVAR
 
GLi°
 * 
gë_unôs_«me_li°
();

174 
	#DIA_DYNAMIC_MENU
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
(obj, 
	`dü_dy«mic_míu_gë_ty≥
(), 
DüDy«micMíu
)

	)

175 
	#DIA_DYNAMIC_MENU_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
(kœss, 
	`dü_dy«mic_míu_gë_ty≥
(), 
DüDy«micMíuCœss
)

	)

176 
	#DIA_IS_DYNAMIC_MENU
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
(obj, 
	`dü_dy«mic_míu_gë_ty≥
())

	)

178 
_DüDy«micMíu
 
	tDüDy«micMíu
;

179 
_DüDy«micMíuCœss
 
	tDüDy«micMíuCœss
;

188 íum { 
	mDDM_SORT_TOP
, 
	mDDM_SORT_NEWEST
, 
	mDDM_SORT_SORT
 } 
	tDdmS‹tTy≥
;

190 
	gGtkWidgë
 *(* 
	tDDMCª©eIãmFunc
)(
	tDüDy«micMíu
 *, 
	tgch¨
 *);

191 (* 
	tDDMCÆlbackFunc
)(
	tDüDy«micMíu
 *, c⁄° 
	tgch¨
 *, 
	tgpoöãr
);

193 
DIAVAR
 
GTy≥
 
	`dü_dy«mic_míu_gë_ty≥
 ();

195 
DIAVAR
 
GtkWidgë
 *
	`dü_dy«mic_míu_√w
(
DDMCª©eIãmFunc
 
¸óã
,

196 
gpoöãr
 
u£rd©a
,

197 
GtkMíuIãm
 *
Ÿhîôem
, 
gch¨
 *
≥rsi°
);

198 
DIAVAR
 
GtkWidgë
 *
	`dü_dy«mic_míu_√w_°rögba£d
(
GtkMíuIãm
 *
Ÿhîôem
,

199 
gpoöãr
 
u£rd©a
,

200 
gch¨
 *
≥rsi°
);

201 
DIAVAR
 
GtkWidgë
 *
	`dü_dy«mic_míu_√w_li°ba£d
(
DDMCª©eIãmFunc
 
¸óã
,

202 
gpoöãr
 
u£rd©a
,

203 
gch¨
 *
Ÿhî_œbñ
,

204 
GLi°
 *
ôems
, 
gch¨
 *
≥rsi°
);

205 
DIAVAR
 
GtkWidgë
 *
	`dü_dy«mic_míu_√w_°rögli°ba£d
(
gch¨
 *
Ÿhî_œbñ
,

206 
GLi°
 *
ôems
,

207 
gpoöãr
 
u£rd©a
,

208 
gch¨
 *
≥rsi°
);

209 
DIAVAR
 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
DüDy«micMíu
 *
ddm
, c⁄° 
gch¨
 *
íåy
);

210 
DIAVAR
 
göt
 
	`dü_dy«mic_míu_add_íåy
(
DüDy«micMíu
 *
ddm
, c⁄° 
gch¨
 *
íåy
);

211 
DIAVAR
 
	`dü_dy«mic_míu_£t_s‹tög_mëhod
(
DüDy«micMíu
 *
ddm
, 
DdmS‹tTy≥
 
s‹t
);

212 
DIAVAR
 
	`dü_dy«mic_míu_ª£t
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
u£rd©a
);

213 
DIAVAR
 
	`dü_dy«mic_míu_£t_max_íåõs
(
DüDy«micMíu
 *
ddm
, 
göt
 
max
);

214 
DIAVAR
 
	`dü_dy«mic_míu_£t_cﬁumns
(
DüDy«micMíu
 *
ddm
, 
göt
 
cﬁs
);

215 
DIAVAR
 
gch¨
 *
	`dü_dy«mic_míu_gë_íåy
(
DüDy«micMíu
 *
ddm
);

216 
DIAVAR
 
	`dü_dy«mic_míu_£À˘_íåy
(
DüDy«micMíu
 *
ddm
, c⁄° 
gch¨
 *
íåy
);

223 
DIAVAR
 
GtkWidgë
 *
	`dü_toggÀ_buâ⁄_√w_wôh_ic⁄s
(c⁄° 
guöt8
 *
⁄_ic⁄
,

224 c⁄° 
guöt8
 *
off_ic⁄
);

228 
	#DEFAULT_ALIGNMENT
 
ALIGN_LEFT


	)

230 
	#DEFAULT_LINE_WIDTH
 2*0.05

	)

	@O:\tool\dvs50\objects\Struct\struct.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<°rög.h
>

24 
	~<°dio.h
>

25 
	~<as£π.h
>

27 
	~"öé.h
"

28 
	~"obje˘.h
"

29 
	~"°ru˘.h
"

30 
	~"∂ug-ös.h
"

31 
	~"shìts.h
"

33 
DüObje˘Ty≥
 
°ru˘˛ass_ty≥
;

40 
DIA_PLUGIN_CHECK_INIT


42 
PlugöInôResu…


43 
	$dü_∂ugö_öô
(
PlugöInfo
 *
öfo
)

45 i‡(!
	`dü_∂ugö_öfo_öô
(
öfo
, "STRUCT",

46 
	`_
("Unified Modelling Language diagram objects STRUCT 1.3"),

47 
NULL
, NULL))

48  
DIA_PLUGIN_INIT_ERROR
;

50 
	`obje˘_ªgi°î_ty≥
(&
°ru˘˛ass_ty≥
);

52  
DIA_PLUGIN_INIT_OK
;

53 
	}
}

56 
Pr›EnumD©a
 
	g_°ru˘_visibûôõs
[] = {

57 { 
N_
("Public"), 
STRUCT_PUBLIC
 },

58 { 
N_
("Priv©e"), 
STRUCT_PRIVATE
 },

59 { 
N_
("PrŸe˘ed"), 
STRUCT_PROTECTED
 },

60 { 
N_
("Im∂emíèti⁄"), 
STRUCT_IMPLEMENTATION
 },

61 { 
NULL
, 0 }

64 
Pr›EnumD©a
 
	g_°ru˘_öhîô™˚s
[] = {

65 { 
N_
("Ab°ø˘"), 
STRUCT_ABSTRACT
 },

66 { 
N_
("Pﬁym‹phi¯(vútuÆ)"), 
STRUCT_POLYMORPHIC
 },

67 { 
N_
("Ló‡(föÆ)"), 
STRUCT_LEAF
 },

68 { 
NULL
, 0 }

	@O:\tool\dvs50\objects\Struct\struct.h

21 #i‚de‡
STRUCT_H


22 
	#STRUCT_H


	)

24 
	~<glib.h
>

25 
	~"öé.h
"

26 
	~"c⁄√˘i⁄poöt.h
"

27 
	~"dü_xml.h
"

29 
_STRUCTAâribuã
 
	tSTRUCTAâribuã
;

30 
_STRUCTO≥øti⁄
 
	tSTRUCTO≥øti⁄
;

31 
_STRUCTP¨amëî
 
	tSTRUCTP¨amëî
;

32 
_STRUCTF‹mÆP¨amëî
 
	tSTRUCTF‹mÆP¨amëî
;

35 
	e_STRUCTVisibûôy
 {

36 
	mSTRUCT_PUBLIC
,

37 
	mSTRUCT_PRIVATE
,

38 
	mSTRUCT_PROTECTED
,

39 
	mSTRUCT_IMPLEMENTATION


40 } 
	tSTRUCTVisibûôy
;

43 
	e_STRUCTInhîô™˚Ty≥
 {

44 
	mSTRUCT_ABSTRACT
,

45 
	mSTRUCT_POLYMORPHIC
,

46 
	mSTRUCT_LEAF


47 } 
	tSTRUCTInhîô™˚Ty≥
;

50 
	e_STRUCTP¨amëîKöd
 {

51 
	mSTRUCT_UNDEF_KIND
,

52 
	mSTRUCT_IN
,

53 
	mSTRUCT_OUT
,

54 
	mSTRUCT_INOUT


55 } 
	tSTRUCTP¨amëîKöd
;

57 
gch¨
 * 
	tSTRUCTSãªŸy≥
;

62 
	s_STRUCTAâribuã
 {

63 
göt
 
	möã∫Æ_id
;

65 
gch¨
 *
	m«me
;

66 
gch¨
 *
	mty≥
;

67 
gch¨
 *
	mvÆue
;

68 
gch¨
 *
	mcommít
;

69 
STRUCTVisibûôy
 
	mvisibûôy
;

70 
	mab°ø˘
;

71 
	m˛ass_sc›e
;

73 
C⁄√˘i⁄Poöt
* 
	mÀ·_c⁄√˘i⁄
;

74 
C⁄√˘i⁄Poöt
* 
	mright_c⁄√˘i⁄
;

80 
	s_STRUCTO≥øti⁄
 {

81 
göt
 
	möã∫Æ_id
;

83 
gch¨
 *
	m«me
;

84 
gch¨
 *
	mty≥
;

85 
gch¨
 *
	mcommít
;

86 
STRUCTSãªŸy≥
 
	m°îeŸy≥
;

87 
STRUCTVisibûôy
 
	mvisibûôy
;

88 
STRUCTInhîô™˚Ty≥
 
	möhîô™˚_ty≥
;

89 
	mquîy
;

90 
	m˛ass_sc›e
;

91 
GLi°
 *
	m∑ømëîs
;

93 
C⁄√˘i⁄Poöt
* 
	mÀ·_c⁄√˘i⁄
;

94 
C⁄√˘i⁄Poöt
* 
	mright_c⁄√˘i⁄
;

96 
gboﬁón
 
	m√eds_wøµög
;

97 
göt
 
	mwøp_ödít
;

98 
GLi°
 *
	mwøµos
;

99 
ªÆ
 
	mas˚¡
;

106 
	s_STRUCTP¨amëî
 {

107 
gch¨
 *
	m«me
;

108 
gch¨
 *
	mty≥
;

109 
gch¨
 *
	mvÆue
;

110 
gch¨
 *
	mcommít
;

111 
STRUCTP¨amëîKöd
 
	mköd
;

117 
	s_STRUCTF‹mÆP¨amëî
 {

118 
gch¨
 *
	m«me
;

119 
gch¨
 *
	mty≥
;

124 
	#STRUCT_STEREOTYPE_START
 
	`_
("<<")

	)

126 
	#STRUCT_STEREOTYPE_END
 
	`_
(">>")

	)

129 
gch¨
 *
°ru˘_gë_©åibuã_°rög
 (
STRUCTAâribuã
 *
©åibuã
);

131 
gch¨
 *
°ru˘_gë_›î©i⁄_°rög
(
STRUCTO≥øti⁄
 *
›î©i⁄
);

133 
gch¨
 *
°ru˘_gë_∑ømëî_°rög
(
STRUCTP¨amëî
 *
∑øm
);

135 
gch¨
 *
°ru˘_gë_f‹mÆ∑ømëî_°rög
(
STRUCTF‹mÆP¨amëî
 *
∑ømëî
);

136 
°ru˘_©åibuã_c›y_öto
(
STRUCTAâribuã
 *
§ˇâr
, STRUCTAâribuã *
de°©å
);

137 
STRUCTAâribuã
 *
°ru˘_©åibuã_c›y
(STRUCTAâribuã *
©å
);

138 
°ru˘_›î©i⁄_c›y_öto
(
STRUCTO≥øti⁄
 *
§c›
, STRUCTO≥øti⁄ *
de°›
);

139 
STRUCTO≥øti⁄
 *
°ru˘_›î©i⁄_c›y
(STRUCTO≥øti⁄ *
›
);

140 
STRUCTF‹mÆP¨amëî
 *
°ru˘_f‹mÆ∑ømëî_c›y
(STRUCTF‹mÆP¨amëî *
∑øm
);

141 
°ru˘_©åibuã_de°roy
(
STRUCTAâribuã
 *
©åibuã
);

142 
°ru˘_›î©i⁄_de°roy
(
STRUCTO≥øti⁄
 *
›
);

143 
°ru˘_∑ømëî_de°roy
(
STRUCTP¨amëî
 *
∑øm
);

144 
°ru˘_f‹mÆ∑ømëî_de°roy
(
STRUCTF‹mÆP¨amëî
 *
∑øm
);

145 
STRUCTAâribuã
 *
°ru˘_©åibuã_√w
();

146 
STRUCTO≥øti⁄
 *
°ru˘_›î©i⁄_√w
();

147 
STRUCTP¨amëî
 *
°ru˘_∑ømëî_√w
();

148 
STRUCTF‹mÆP¨amëî
 *
°ru˘_f‹mÆ∑ømëî_√w
();

150 
°ru˘_©åibuã_ísuª_c⁄√˘i⁄_poöts
 (
STRUCTAâribuã
 *
©å
, 
DüObje˘
* 
obj
);

151 
°ru˘_›î©i⁄_ísuª_c⁄√˘i⁄_poöts
 (
STRUCTO≥øti⁄
 *
›î
, 
DüObje˘
* 
obj
);

153 
°ru˘_©åibuã_wrôe
(
AâribuãNode
 
©å_node
, 
STRUCTAâribuã
 *
©å
);

154 
°ru˘_›î©i⁄_wrôe
(
AâribuãNode
 
©å_node
, 
STRUCTO≥øti⁄
 *
›
);

155 
°ru˘_f‹mÆ∑ømëî_wrôe
(
AâribuãNode
 
©å_node
, 
STRUCTF‹mÆP¨amëî
 *
∑øm
);

	@O:\tool\dvs50\objects\Struct\struct_class.c

25 #ifde‡
HAVE_CONFIG_H


26 
	~<c⁄fig.h
>

29 
	~<as£π.h
>

30 
	~<gtk/gtk.h
>

31 
	~<m©h.h
>

32 
	~<°rög.h
>

34 
	~"öé.h
"

35 
	~"düªndîî.h
"

36 
	~"©åibuãs.h
"

37 
	~"¥›îtõs.h
"

38 
	~"dümíu.h
"

40 
	~"°ru˘_˛ass.h
"

42 
	~"pixm≠s/°ru˘˛ass.xpm
"

44 
	~"debug.h
"

45 
	~"shìt.h
"

46 
Fa˘‹ySåu˘IãmAŒ
 
°ru˘Li°
;

49 
	#STRUCTCLASS_BORDER
 0.1

	)

50 
	#STRUCTCLASS_UNDERLINEWIDTH
 0.05

	)

51 
	#STRUCTCLASS_TEMPLATE_OVERLAY_X
 2.3

	)

52 
	#STRUCTCLASS_TEMPLATE_OVERLAY_Y
 0.3

	)

54 
ªÆ
 
°ru˘˛ass_di°™˚_‰om
(
STRUCTCœss
 *
°ru˘˛ass
, 
Poöt
 *
poöt
);

55 
°ru˘˛ass_£À˘
(
STRUCTCœss
 *
°ru˘˛ass
, 
Poöt
 *
˛icked_poöt
,

56 
DüRídîî
 *
öãø˘ive_ªndîî
);

57 
Obje˘Ch™ge
* 
°ru˘˛ass_move_h™dÀ
(
STRUCTCœss
 *
°ru˘˛ass
, 
H™dÀ
 *
h™dÀ
,

58 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
, 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

59 
Obje˘Ch™ge
* 
°ru˘˛ass_move
(
STRUCTCœss
 *
°ru˘˛ass
, 
Poöt
 *
to
);

60 
°ru˘˛ass_døw
(
STRUCTCœss
 *
°ru˘˛ass
, 
DüRídîî
 *
ªndîî
);

61 
DüObje˘
 *
°ru˘˛ass_¸óã
(
Poöt
 *
°¨çoöt
,

62 *
u£r_d©a
,

63 
H™dÀ
 **
h™dÀ1
,

64 
H™dÀ
 **
h™dÀ2
);

65 
°ru˘˛ass_de°roy
(
STRUCTCœss
 *
°ru˘˛ass
);

66 
DüObje˘
 *
°ru˘˛ass_c›y
(
STRUCTCœss
 *
°ru˘˛ass
);

68 
°ru˘˛ass_ßve
(
STRUCTCœss
 *
°ru˘˛ass
, 
Obje˘Node
 
obj_node
,

69 c⁄° *
fûíame
);

71 
Á˘‹y_°ru˘_ôems_ßve
(
STRUCTCœss
 *
°ru˘˛ass
, 
Obje˘Node
 
obj_node
,

72 c⁄° *
fûíame
);

74 
DüObje˘
 *
°ru˘˛ass_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
,

75 c⁄° *
fûíame
);

77 
DüMíu
 * 
°ru˘˛ass_obje˘_míu
(
DüObje˘
 *
obj
, 
Poöt
 *
p
);

78 
Obje˘Ch™ge
 *
°ru˘˛ass_show_commíts_ˇŒback
(
DüObje˘
 *
obj
, 
Poöt
 *
pos
, 
gpoöãr
 
d©a
);

80 
Pr›Des¸ùti⁄
 *
°ru˘˛ass_des¸ibe_¥›s
(
STRUCTCœss
 *
°ru˘˛ass
);

82 
Pr›Des¸ùti⁄
 *
°ru˘ã°_des¸ibe_¥›s
(
STRUCTCœss
 *
°ru˘˛ass
);

83 
°ru˘˛ass_gë_¥›s
(
STRUCTCœss
 *
°ru˘˛ass
, 
GPåAºay
 *
¥›s
);

84 
°ru˘˛ass_£t_¥›s
(
STRUCTCœss
 *
°ru˘˛ass
, 
GPåAºay
 *
¥›s
);

86 
fûl_ö_f⁄td©a
(
STRUCTCœss
 *
°ru˘˛ass
);

87 
°ru˘˛ass_num_dy«mic_c⁄√˘i⁄poöts
(
STRUCTCœss
 *
˛ass
);

89 
Obje˘Ch™ge
 *
_°ru˘˛ass_≠∂y_¥›s_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
, 
GtkWidgë
 *
widgë
);

91 
Obje˘Ty≥Ops
 
	g°ru˘˛ass_ty≥_›s
 =

93 (
Cª©eFunc
Ë
°ru˘˛ass_¸óã
,

94 (
LﬂdFunc
Ë
°ru˘˛ass_lﬂd
,

95 (
SaveFunc
Ë
°ru˘˛ass_ßve


108 
DüObje˘Ty≥
 
	g°ru˘˛ass_ty≥
 =

112 (**Ë
°ru˘˛ass_xpm
,

114 &
°ru˘˛ass_ty≥_›s
,

115 
NULL
,

120 
Obje˘Ops
 
	g°ru˘˛ass_›s
 = {

121 (
De°royFunc
Ë
°ru˘˛ass_de°roy
,

122 (
DøwFunc
Ë
°ru˘˛ass_døw
,

123 (
Di°™˚Func
Ë
°ru˘˛ass_di°™˚_‰om
,

124 (
Sñe˘Func
Ë
°ru˘˛ass_£À˘
,

125 (
C›yFunc
Ë
°ru˘˛ass_c›y
,

126 (
MoveFunc
Ë
°ru˘˛ass_move
,

127 (
MoveH™dÀFunc
Ë
°ru˘˛ass_move_h™dÀ
,

129 (
GëPr›îtõsFunc
Ë
Á˘‹y_gë_¥›îtõs
,

130 (
AµlyPr›îtõsDülogFunc
Ë
_°ru˘˛ass_≠∂y_¥›s_‰om_dülog
,

131 (
Obje˘MíuFunc
Ë
°ru˘˛ass_obje˘_míu
,

132 (
Des¸ibePr›sFunc
Ë
°ru˘˛ass_des¸ibe_¥›s
,

133 (
GëPr›sFunc
Ë
°ru˘˛ass_gë_¥›s
,

134 (
SëPr›sFunc
Ë
°ru˘˛ass_£t_¥›s
,

135 (
TextEdôFunc
) 0,

136 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

139 
Pr›DescDAºayExåa
 
°ru˘©åibuã_exåa
;

140 
Pr›DescDAºayExåa
 
°ru˘›î©i⁄_exåa
;

141 
Pr›DescDAºayExåa
 
°ru˘∑ømëî_exåa
;

142 
Pr›DescDAºayExåa
 
°ru˘f‹mÆ∑ømëî_exåa
;

146 
Pr›Des¸ùti⁄
 
	gMySåu˘_¥›s
[] ={

147 
ELEMENT_COMMON_PROPERTIES
,

148 
PROP_STD_LINE_WIDTH_OPTIONAL
,

149 
PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
),

150 
PROP_STD_LINE_COLOUR_OPTIONAL
,

151 
PROP_STD_FILL_COLOUR_OPTIONAL
,

152 
PROP_STD_NOTEBOOK_BEGIN
,

153 
PROP_NOTEBOOK_PAGE
("˛ass", 
PROP_FLAG_DONT_MERGE
, 
N_
("Class")),

154 { "«me", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
 | 
PROP_FLAG_NO_DEFAULTS
,

155 
N_
("Name"), 
NULL
, NULL },

156 
PROP_MULTICOL_END
("class"),

157 
PROP_STD_NOTEBOOK_END
,

158 { "©åibuãs", 
PROP_TYPE_DARRAY
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
 | 
PROP_FLAG_DONT_MERGE
 | 
PROP_FLAG_NO_DEFAULTS
,

159 
N_
("Aâribuãs"), 
NULL
, NULL },

160 
PROP_DESC_END


166 
Pr›Des¸ùti⁄
 
	g°ru˘˛ass_¥›s
[] = {

167 
ELEMENT_COMMON_PROPERTIES
,

168 
PROP_STD_LINE_WIDTH_OPTIONAL
,

170 
PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
),

171 
PROP_STD_LINE_COLOUR_OPTIONAL
,

172 
PROP_STD_FILL_COLOUR_OPTIONAL
,

174 
PROP_STD_NOTEBOOK_BEGIN
,

175 
PROP_NOTEBOOK_PAGE
("˛ass", 
PROP_FLAG_DONT_MERGE
, 
N_
("Class")),

176 { "«me", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
 | 
PROP_FLAG_NO_DEFAULTS
,

177 
N_
("Name"), 
NULL
, NULL },

178 { "°îeŸy≥", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

179 
N_
("SãªŸy≥"), 
NULL
, NULL },

180 { "commít", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

181 
N_
("Commít"), 
NULL
, NULL },

182 { "ab°ø˘", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

183 
N_
("Ab°ø˘"), 
NULL
, NULL },

184 { "ãm∂©e", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
 | 
PROP_FLAG_NO_DEFAULTS
,

185 
N_
("Tem∂©e"), 
NULL
, NULL },

187 { "suµªss_©åibuãs", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

188 
N_
("Suµªs†Aâribuãs"), 
NULL
, NULL },

189 { "suµªss_›î©i⁄s", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

190 
N_
("Suµªs†O≥øti⁄s"), 
NULL
, NULL },

191 { "visibÀ_©åibuãs", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

192 
N_
("VisibÀ Aâribuãs"), 
NULL
, NULL },

193 { "visibÀ_›î©i⁄s", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

194 
N_
("VisibÀ O≥øti⁄s"), 
NULL
, NULL },

195 { "visibÀ_commíts", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

196 
N_
("VisibÀ Commíts"), 
NULL
, NULL },

197 { "wøp_›î©i⁄s", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

198 
N_
("Wø∞O≥øti⁄s"), 
NULL
, NULL },

199 { "wøp_a·î_ch¨", 
PROP_TYPE_INT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

200 
N_
("Wø∞a·î ch¨"), 
NULL
, NULL },

201 { "commít_löe_Àngth", 
PROP_TYPE_INT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

202 
N_
("CommíàlöêÀngth"), 
NULL
, NULL},

203 { "commít_èggög", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

204 
N_
("Commíàèggög"), 
NULL
, NULL},

207 
PROP_NOTEBOOK_PAGE
("f⁄t", 
PROP_FLAG_DONT_MERGE
, 
N_
("Font")),

208 
PROP_MULTICOL_BEGIN
("class"),

209 
PROP_MULTICOL_COLUMN
("font"),

211 { "n‹mÆ_f⁄t", 
PROP_TYPE_FONT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

212 
N_
("N‹mÆ"), 
NULL
, NULL },

213 { "pﬁym‹phic_f⁄t", 
PROP_TYPE_FONT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

214 
N_
("Pﬁym‹phic"), 
NULL
, NULL },

215 { "ab°ø˘_f⁄t", 
PROP_TYPE_FONT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

216 
N_
("Ab°ø˘"), 
NULL
, NULL },

217 { "˛as¢ame_f⁄t", 
PROP_TYPE_FONT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

218 
N_
("Cœs¢ame"), 
NULL
, NULL },

219 { "ab°ø˘_˛as¢ame_f⁄t", 
PROP_TYPE_FONT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

220 
N_
("Ab°ø˘ Cœs¢ame"), 
NULL
, NULL },

221 { "commít_f⁄t", 
PROP_TYPE_FONT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

222 
N_
("Commít"), 
NULL
, NULL },

224 
PROP_MULTICOL_COLUMN
("height"),

225 { "n‹mÆ_f⁄t_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

226 
N_
(" "), 
NULL
, NULL },

227 { "pﬁym‹phic_f⁄t_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

228 
N_
(" "), 
NULL
, NULL },

229 { "ab°ø˘_f⁄t_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

230 
N_
(" "), 
NULL
, NULL },

231 { "˛as¢ame_f⁄t_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

232 
N_
(" "), 
NULL
, NULL },

233 { "ab°ø˘_˛as¢ame_f⁄t_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

234 
N_
(" "), 
NULL
, NULL },

235 { "commít_f⁄t_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

236 
N_
(" "), 
NULL
, NULL },

237 
PROP_MULTICOL_END
("class"),

238 
PROP_STD_NOTEBOOK_END
,

241 { "©åibuãs", 
PROP_TYPE_DARRAY
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
 | 
PROP_FLAG_DONT_MERGE
 | 
PROP_FLAG_NO_DEFAULTS
,

242 
N_
("Aâribuãs"), 
NULL
, NULL },

243 { "›î©i⁄s", 
PROP_TYPE_DARRAY
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
 | 
PROP_FLAG_DONT_MERGE
 | 
PROP_FLAG_NO_DEFAULTS
,

244 
N_
("O≥øti⁄s"), 
NULL
, NULL },

246 { "ãm∂©es", 
PROP_TYPE_DARRAY
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
 | 
PROP_FLAG_DONT_MERGE
 | 
PROP_FLAG_NO_DEFAULTS
,

247 
N_
("Tem∂©êP¨amëîs"), 
NULL
, NULL },

249 
PROP_DESC_END


252 
Obje˘Ch™ge
 *

253 
	$_°ru˘˛ass_≠∂y_¥›s_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
, 
GtkWidgë
 *
widgë
)

255 
DüObje˘
 *
obj
 = &
°ru˘˛ass
->
ñemít
.
obje˘
;

257 i‡(!
°ru˘˛ass
->
¥›îtõs_dülog
)

258  
	`obje˘_≠∂y_¥›s_‰om_dülog
 (
obj
, 
widgë
);

260  
	`°ru˘˛ass_≠∂y_¥›s_‰om_dülog
 (
°ru˘˛ass
, 
widgë
);

261 
	}
}

264 
Pr›Des¸ùti⁄
 *

265 
	$°ru˘˛ass_des¸ibe_¥›s
(
STRUCTCœss
 *
°ru˘˛ass
)

267 i‡(
°ru˘˛ass_¥›s
[0].
qu¨k
 == 0) {

268 
i
 = 0;

270 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
°ru˘˛ass_¥›s
);

271 
°ru˘˛ass_¥›s
[
i
].
«me
 !
NULL
) {

275 i‡(0 =
	`°rcmp
(
°ru˘˛ass_¥›s
[
i
].
«me
, "attributes"))

276 
°ru˘˛ass_¥›s
[
i
].
exåa_d©a
 = &
°ru˘©åibuã_exåa
;

277 i‡(0 =
	`°rcmp
(
°ru˘˛ass_¥›s
[
i
].
«me
, "operations")) {

278 
Pr›Des¸ùti⁄
 *
ªc‹ds
 = 
°ru˘›î©i⁄_exåa
.
comm⁄
.
ªc‹d
;

279 
j
 = 0;

281 
°ru˘˛ass_¥›s
[
i
].
exåa_d©a
 = &
°ru˘›î©i⁄_exåa
;

282 
ªc‹ds
[
j
].
«me
 !
NULL
) {

283 i‡(0 =
	`°rcmp
(
ªc‹ds
[
j
].
«me
, "parameters"))

284 
ªc‹ds
[
j
].
exåa_d©a
 = &
°ru˘∑ømëî_exåa
;

285 
j
++;

288 i‡(0 =
	`°rcmp
(
°ru˘˛ass_¥›s
[
i
].
«me
, "templates"))

289 
°ru˘˛ass_¥›s
[
i
].
exåa_d©a
 = &
°ru˘f‹mÆ∑ømëî_exåa
;

291 
i
++;

294  
°ru˘˛ass_¥›s
;

295 
	}
}

297 
Pr›Off£t
 
	g°ru˘˛ass_off£ts
[] = {

298 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

300 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
STRUCTCœss
, 
löe_width
) },

301 { "ãxt_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
STRUCTCœss
, 
ãxt_cﬁ‹
) },

302 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
STRUCTCœss
, 
löe_cﬁ‹
) },

303 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
STRUCTCœss
, 
fûl_cﬁ‹
) },

304 { "«me", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTCœss
, 
«me
) },

305 { "°îeŸy≥", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTCœss
, 
°îeŸy≥
) },

306 { "commít", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTCœss
, 
commít
) },

307 { "ab°ø˘", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
, 
ab°ø˘
) },

308 { "ãm∂©e", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
, 
ãm∂©e
) },

309 { "suµªss_©åibuãs", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
 , 
suµªss_©åibuãs
) },

310 { "visibÀ_©åibuãs", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
 , 
visibÀ_©åibuãs
) },

311 { "visibÀ_commíts", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
 , 
visibÀ_commíts
) },

312 { "suµªss_›î©i⁄s", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
 , 
suµªss_›î©i⁄s
) },

313 { "visibÀ_›î©i⁄s", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
 , 
visibÀ_›î©i⁄s
) },

314 { "visibÀ_commíts", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
 , 
visibÀ_commíts
) },

315 { "wøp_›î©i⁄s", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
 , 
wøp_›î©i⁄s
) },

316 { "wøp_a·î_ch¨", 
PROP_TYPE_INT
, 
off£tof
(
STRUCTCœss
 , 
wøp_a·î_ch¨
) },

317 { "commít_löe_Àngth", 
PROP_TYPE_INT
, 
off£tof
(
STRUCTCœss
, 
commít_löe_Àngth
) },

318 { "commít_èggög", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTCœss
, 
commít_èggög
) },

321 
PROP_OFFSET_MULTICOL_BEGIN
("class"),

322 
PROP_OFFSET_MULTICOL_COLUMN
("font"),

323 { "n‹mÆ_f⁄t", 
PROP_TYPE_FONT
, 
off£tof
(
STRUCTCœss
, 
n‹mÆ_f⁄t
) },

324 { "ab°ø˘_f⁄t", 
PROP_TYPE_FONT
, 
off£tof
(
STRUCTCœss
, 
ab°ø˘_f⁄t
) },

325 { "pﬁym‹phic_f⁄t", 
PROP_TYPE_FONT
, 
off£tof
(
STRUCTCœss
, 
pﬁym‹phic_f⁄t
) },

326 { "˛as¢ame_f⁄t", 
PROP_TYPE_FONT
, 
off£tof
(
STRUCTCœss
, 
˛as¢ame_f⁄t
) },

327 { "ab°ø˘_˛as¢ame_f⁄t", 
PROP_TYPE_FONT
, 
off£tof
(
STRUCTCœss
, 
ab°ø˘_˛as¢ame_f⁄t
) },

328 { "commít_f⁄t", 
PROP_TYPE_FONT
, 
off£tof
(
STRUCTCœss
, 
commít_f⁄t
) },

330 
PROP_OFFSET_MULTICOL_COLUMN
("height"),

331 { "n‹mÆ_f⁄t_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCœss
, 
f⁄t_height
) },

332 { "ab°ø˘_f⁄t_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCœss
, 
ab°ø˘_f⁄t_height
) },

333 { "pﬁym‹phic_f⁄t_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCœss
, 
pﬁym‹phic_f⁄t_height
) },

334 { "˛as¢ame_f⁄t_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCœss
, 
˛as¢ame_f⁄t_height
) },

335 { "ab°ø˘_˛as¢ame_f⁄t_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCœss
, 
ab°ø˘_˛as¢ame_f⁄t_height
) },

336 { "commít_f⁄t_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCœss
, 
commít_f⁄t_height
) },

337 
PROP_OFFSET_MULTICOL_END
("class"),

339 { "›î©i⁄s", 
PROP_TYPE_DARRAY
, 
off£tof
(
STRUCTCœss
 , 
›î©i⁄s
) },

340 { "©åibuãs", 
PROP_TYPE_DARRAY
, 
off£tof
(
STRUCTCœss
 , 
©åibuãs
) } ,

341 { "ãm∂©es", 
PROP_TYPE_DARRAY
, 
off£tof
(
STRUCTCœss
 , 
f‹mÆ_∑øms
) } ,

343 { 
NULL
, 0, 0 },

347 
	$°ru˘˛ass_gë_¥›s
(
STRUCTCœss
 * 
°ru˘˛ass
, 
GPåAºay
 *
¥›s
)

349 
	`obje˘_gë_¥›s_‰om_off£ts
(&
°ru˘˛ass
->
ñemít
.
obje˘
,

350 
°ru˘˛ass_off£ts
, 
¥›s
);

351 
	}
}

353 
DüMíuIãm
 
	g°ru˘˛ass_míu_ôems
[] = {

354 { 
N_
("Show Commíts"), 
°ru˘˛ass_show_commíts_ˇŒback
, 
NULL
,

355 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
 },

358 
DüMíu
 
	g°ru˘˛ass_míu
 = {

359 
N_
("Class"),

360 (
°ru˘˛ass_míu_ôems
)/(
DüMíuIãm
),

361 
°ru˘˛ass_míu_ôems
,

362 
NULL


365 
DüMíu
 *

366 
	$°ru˘˛ass_obje˘_míu
(
DüObje˘
 *
obj
, 
Poöt
 *
p
)

368 
°ru˘˛ass_míu_ôems
[0].
a˘ive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
|

369 (((
STRUCTCœss
 *)
obj
)->
visibÀ_commíts
?
DIAMENU_TOGGLE_ON
:0);

371  &
°ru˘˛ass_míu
;

372 
	}
}

374 
	s_CommítSèã
 {

375 
Obje˘Sèã
 
	m°©e
;

376 
gboﬁón
 
	mvisibÀ_commíts
;

377 } 
	tCommítSèã
;

378 
Obje˘Sèã
*

379 
	$_commít_gë_°©e
 (
DüObje˘
 *
obj
)

381 
CommítSèã
 *
°©e
 = 
	`g_√w
 (CommentState,1);

382 
°©e
->°©e.
‰ì
 = 
NULL
;

383 
°©e
->
visibÀ_commíts
 = ((
STRUCTCœss
 *)
obj
)->visible_comments;

384  (
Obje˘Sèã
 *)
°©e
;

385 
	}
}

387 
	$_commít_£t_°©e
 (
DüObje˘
 *
obj
, 
Obje˘Sèã
 *
°©e
)

389 ((
STRUCTCœss
 *)
obj
)->
visibÀ_commíts
 = ((
CommítSèã
 *)
°©e
)->visible_comments;

390 
	`g_‰ì
 (
°©e
);

391 
	`°ru˘˛ass_ˇlcuœã_d©a
((
STRUCTCœss
 *)
obj
);

392 
	`°ru˘˛ass_upd©e_d©a
((
STRUCTCœss
 *)
obj
);

393 
	}
}

395 
Obje˘Ch™ge
 *

396 
	$°ru˘˛ass_show_commíts_ˇŒback
(
DüObje˘
 *
obj
, 
Poöt
 *
pos
, 
gpoöãr
 
d©a
)

398 
Obje˘Sèã
 *
ﬁd_°©e
 = 
	`_commít_gë_°©e
(
obj
);

399 
Obje˘Ch™ge
 *
ch™ge
 = 
	`√w_obje˘_°©e_ch™ge
(
obj
, 
ﬁd_°©e
, 
_commít_gë_°©e
, 
_commít_£t_°©e
 );

401 ((
STRUCTCœss
 *)
obj
)->
visibÀ_commíts
 = !((STRUCTClass *)obj)->visible_comments;

402 
	`°ru˘˛ass_ˇlcuœã_d©a
((
STRUCTCœss
 *)
obj
);

403 
	`°ru˘˛ass_upd©e_d©a
((
STRUCTCœss
 *)
obj
);

404  
ch™ge
;

405 
	}
}

408 
	$°ru˘˛ass_£t_¥›s
(
STRUCTCœss
 *
°ru˘˛ass
, 
GPåAºay
 *
¥›s
)

415 
DüObje˘
 *
obj
 = &
°ru˘˛ass
->
ñemít
.
obje˘
;

416 
GLi°
 *
li°
;

417 
num
;

419 
	`obje˘_£t_¥›s_‰om_off£ts
(&
°ru˘˛ass
->
ñemít
.
obje˘
, 
°ru˘˛ass_off£ts
,

420 
¥›s
);

422 
num
 = 
STRUCTCLASS_CONNECTIONPOINTS
 + 
	`°ru˘˛ass_num_dy«mic_c⁄√˘i⁄poöts
(
°ru˘˛ass
);

424 #ifde‡
STRUCT_MAINPOINT


425 
obj
->
num_c⁄√˘i⁄s
 = 
num
 + 1;

427 
obj
->
num_c⁄√˘i⁄s
 = 
num
;

430 
obj
->
c⁄√˘i⁄s
 = 
	`g_ªÆloc
(obj->c⁄√˘i⁄s, obj->
num_c⁄√˘i⁄s
*(
C⁄√˘i⁄Poöt
 *));

433 i‡(
num
 > 
STRUCTCLASS_CONNECTIONPOINTS
) {

434 
i
;

438 
i
 = 
STRUCTCLASS_CONNECTIONPOINTS
;

439 
li°
 = (!
°ru˘˛ass
->
visibÀ_©åibuãs
 || såu˘˛ass->
suµªss_©åibuãs
Ë? 
NULL
 : såu˘˛ass->
©åibuãs
;

440 
li°
 !
NULL
) {

441 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *)
li°
->
d©a
;

443 
	`°ru˘_©åibuã_ísuª_c⁄√˘i⁄_poöts
 (
©å
, 
obj
);

444 
obj
->
c⁄√˘i⁄s
[
i
] = 
©å
->
À·_c⁄√˘i⁄
;

445 
obj
->
c⁄√˘i⁄s
[
i
]->
obje˘
 = obj;

446 
i
++;

447 
obj
->
c⁄√˘i⁄s
[
i
] = 
©å
->
right_c⁄√˘i⁄
;

448 
obj
->
c⁄√˘i⁄s
[
i
]->
obje˘
 = obj;

449 
i
++;

450 
li°
 = 
	`g_li°_√xt
(list);

452 
li°
 = (!
°ru˘˛ass
->
visibÀ_›î©i⁄s
 || såu˘˛ass->
suµªss_›î©i⁄s
Ë? 
NULL
 : såu˘˛ass->
›î©i⁄s
;

453 
li°
 !
NULL
) {

454 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *)
li°
->
d©a
;

456 
	`°ru˘_›î©i⁄_ísuª_c⁄√˘i⁄_poöts
 (
›
, 
obj
);

457 
obj
->
c⁄√˘i⁄s
[
i
] = 
›
->
À·_c⁄√˘i⁄
;

458 
obj
->
c⁄√˘i⁄s
[
i
]->
obje˘
 = obj;

459 
i
++;

460 
obj
->
c⁄√˘i⁄s
[
i
] = 
›
->
right_c⁄√˘i⁄
;

461 
obj
->
c⁄√˘i⁄s
[
i
]->
obje˘
 = obj;

462 
i
++;

463 
li°
 = 
	`g_li°_√xt
(list);

466 #ifde‡
STRUCT_MAINPOINT


467 
obj
->
c⁄√˘i⁄s
[
num
] = &
°ru˘˛ass
->c⁄√˘i⁄s[
STRUCTCLASS_CONNECTIONPOINTS
];

468 
obj
->
c⁄√˘i⁄s
[
num
]->
obje˘
 = obj;

471 
	`°ru˘˛ass_ˇlcuœã_d©a
(
°ru˘˛ass
);

472 
	`°ru˘˛ass_upd©e_d©a
(
°ru˘˛ass
);

473 #ifde‡
DEBUG


476 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "After updating data");

478 
	}
}

480 
ªÆ


481 
	$°ru˘˛ass_di°™˚_‰om
(
STRUCTCœss
 *
°ru˘˛ass
, 
Poöt
 *
poöt
)

483 
DüObje˘
 *
obj
 = &
°ru˘˛ass
->
ñemít
.
obje˘
;

484  
	`di°™˚_ª˘™gÀ_poöt
(&
obj
->
boundög_box
, 
poöt
);

485 
	}
}

488 
	$°ru˘˛ass_£À˘
(
STRUCTCœss
 *
°ru˘˛ass
, 
Poöt
 *
˛icked_poöt
,

489 
DüRídîî
 *
öãø˘ive_ªndîî
)

491 
	`ñemít_upd©e_h™dÀs
(&
°ru˘˛ass
->
ñemít
);

492 
	}
}

494 
Obje˘Ch™ge
*

495 
	$°ru˘˛ass_move_h™dÀ
(
STRUCTCœss
 *
°ru˘˛ass
, 
H™dÀ
 *
h™dÀ
,

496 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

497 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

499 
	`as£π
(
°ru˘˛ass
!=
NULL
);

500 
	`as£π
(
h™dÀ
!=
NULL
);

501 
	`as£π
(
to
!=
NULL
);

503 
	`as£π
(
h™dÀ
->
id
 < 
STRUCTCLASS_CONNECTIONPOINTS
);

505  
NULL
;

506 
	}
}

508 
Obje˘Ch™ge
*

509 
	$°ru˘˛ass_move
(
STRUCTCœss
 *
°ru˘˛ass
, 
Poöt
 *
to
)

511 
°ru˘˛ass
->
ñemít
.
c‹√r
 = *
to
;

512 
	`°ru˘˛ass_upd©e_d©a
(
°ru˘˛ass
);

514  
NULL
;

515 
	}
}

535 
	$°ru˘_undîlöe_ãxt
(
DüRídîî
 *
ªndîî
,

536 
Poöt
 
SèπPoöt
,

537 
DüF⁄t
 *
f⁄t
,

538 
ªÆ
 
f⁄t_height
,

539 
gch¨
 *
°rög
,

540 
Cﬁ‹
 *
cﬁ‹
,

541 
ªÆ
 
löe_width
,

542 
ªÆ
 
undîlöe_width
)

544 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

545 
Poöt
 
UndîlöeSèπPoöt
;

546 
Poöt
 
UndîlöeEndPoöt
;

547 
gch¨
 *
whôe•a˚s
;

548 
fú°_n⁄_whôe•a˚
 = 0;

550 
UndîlöeSèπPoöt
 = 
SèπPoöt
;

551 
UndîlöeSèπPoöt
.
y
 +
f⁄t_height
 * 0.1;

552 
UndîlöeEndPoöt
 = 
UndîlöeSèπPoöt
;

554 
whôe•a˚s
 = 
°rög
;

555 
whôe•a˚s
 &&

556 
	`g_unich¨_is•a˚
(
	`g_utf8_gë_ch¨
(
whôe•a˚s
))) {

557 
whôe•a˚s
 = 
	`g_utf8_√xt_ch¨
(whitespaces);

559 
fú°_n⁄_whôe•a˚
 = 
whôe•a˚s
 - 
°rög
;

560 
whôe•a˚s
 = 
	`g_°rdup
(
°rög
);

561 
whôe•a˚s
[
fú°_n⁄_whôe•a˚
] = '\0';

562 
UndîlöeSèπPoöt
.
x
 +
	`dü_f⁄t_°rög_width
(
whôe•a˚s
, 
f⁄t
, 
f⁄t_height
);

563 
	`g_‰ì
(
whôe•a˚s
);

564 
UndîlöeEndPoöt
.
x
 +
	`dü_f⁄t_°rög_width
(
°rög
, 
f⁄t
, 
f⁄t_height
);

565 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
undîlöe_width
);

566 
ªndîî_›s
->
	`døw_löe
(
ªndîî
, &
UndîlöeSèπPoöt
, &
UndîlöeEndPoöt
, 
cﬁ‹
);

567 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
löe_width
);

568 
	}
}

600 
gch¨
 *

601 
	$°ru˘_¸óã_documíèti⁄_èg
 (
gch¨
 * 
commít
,

602 
gboﬁón
 
èggög
,

603 
göt
 
WøpPoöt
,

604 
göt
 *
NumbîOfLöes
)

606 
gch¨
 *
CommítTag
 = 
èggög
 ? "{documentation = " : "";

607 
göt
 
TagLígth
 = 
	`°æí
(
CommítTag
);

613 
göt
 
W‹kögWøpPoöt
 = (
TagLígth
<
WøpPoöt
) ? WrapPoint : ((TagLength<=0)?1:TagLength);

614 
göt
 
RawLígth
 = 
TagLígth
 + 
	`°æí
(
commít
Ë+ (
èggög
?1:0);

615 
göt
 
MaxCookedLígth
 = 
RawLígth
 + RawLígth/
W‹kögWøpPoöt
;

616 
gch¨
 *
WøµedCommít
 = 
	`g_mÆloc0
(
MaxCookedLígth
+1);

617 
göt
 
AvaûS∑˚
 = 
W‹kögWøpPoöt
 - 
TagLígth
;

618 
gch¨
 *
Sˇn
;

619 
gch¨
 *
BªakC™did©e
;

620 
gunich¨
 
SˇnCh¨
;

621 
gboﬁón
 
AddNL
 = 
FALSE
;

623 i‡(
èggög
)

624 
	`°rˇt
(
WøµedCommít
, 
CommítTag
);

625 *
NumbîOfLöes
 = 1;

627  *
commít
 ) {

629  *
commít
 && 
	`g_unich¨_is•a˚
(
	`g_utf8_gë_ch¨
(comment)) ) {

630 
commít
 = 
	`g_utf8_√xt_ch¨
(comment);

633 i‡–*
commít
 ){

635 
Sˇn
 = 
commít
;

636 
BªakC™did©e
 = 
NULL
;

637  *
Sˇn
 && *Sˇ¿!'\n' && 
AvaûS∑˚
 > 0 ) {

638 
SˇnCh¨
 = 
	`g_utf8_gë_ch¨
(
Sˇn
);

642 i‡–
	`g_unich¨_is•a˚
(
SˇnCh¨
) )

643 
BªakC™did©e
 = 
Sˇn
;

644 
AvaûS∑˚
--;

645 
Sˇn
 = 
	`g_utf8_√xt_ch¨
(Scan);

647 i‡–
AvaûS∑˚
==0 && 
BªakC™did©e
 !
NULL
 )

648 
Sˇn
 = 
BªakC™did©e
;

649 i‡–
AddNL
 ){

650 
	`°rˇt
(
WøµedCommít
, "\n");

651 *
NumbîOfLöes
+=1;

653 
AddNL
 = 
TRUE
;

654 
	`°∫ˇt
(
WøµedCommít
, 
commít
, 
Sˇn
-comment);

655 
AvaûS∑˚
 = 
W‹kögWøpPoöt
;

656 
commít
 = 
Sˇn
;

659 i‡(
èggög
)

660 
	`°rˇt
(
WøµedCommít
, "}");

661 
	`as£π
(
	`°æí
(
WøµedCommít
)<=
MaxCookedLígth
);

662  
WøµedCommít
;

663 
	}
}

685 
	$°ru˘_døw_commíts
(
DüRídîî
 *
ªndîî
,

686 
DüF⁄t
 *
f⁄t
,

687 
ªÆ
 
f⁄t_height
,

688 
Cﬁ‹
 *
ãxt_cﬁ‹
,

689 
gch¨
 *
commít
,

690 
gboﬁón
 
commít_èggög
,

691 
göt
 
Commít_löe_Àngth
,

692 
Poöt
 *
p
,

693 
göt
 
Æignmít
)

695 
göt
 
NumbîOfLöes
 = 0;

696 
göt
 
Index
;

697 
ªÆ
 
as˚¡
;

698 
gch¨
 *
CommítSåög
 = 0;

699 
gch¨
 *
NewLöeP

NULL
;

700 
gch¨
 *
RídîP
;

702 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

704 
CommítSåög
 =

705 
	`°ru˘_¸óã_documíèti⁄_èg
(
commít
, 
commít_èggög
, 
Commít_löe_Àngth
, &
NumbîOfLöes
);

706 
RídîP
 = 
CommítSåög
;

707 
ªndîî_›s
->
	`£t_f⁄t
(
ªndîî
, 
f⁄t
, 
f⁄t_height
);

708 
as˚¡
 = 
	`dü_f⁄t_as˚¡
(
RídîP
, 
f⁄t
, 
f⁄t_height
);

709  
Index
=0; Index < 
NumbîOfLöes
; Index++)

711 
NewLöeP
 = 
	`°rchr
(
RídîP
, '\n');

712 i‡–
NewLöeP
 !
NULL
)

714 *
NewLöeP
++ = '\0';

716 i‡(
Index
 == 0) {

717 
p
->
y
 +
as˚¡
;

721 
p
->
y
 +
f⁄t_height
;

723 
ªndîî_›s
->
	`døw_°rög
(
ªndîî
, 
RídîP
, 
p
, 
Æignmít
, 
ãxt_cﬁ‹
);

724 
RídîP
 = 
NewLöeP
;

725 i‡–
NewLöeP
 =
NULL
){

729 
p
->
y
 +
f⁄t_height
 - 
as˚¡
;

730 
	`g_‰ì
(
CommítSåög
);

731 
	}
}

753 
ªÆ


754 
	$°ru˘˛ass_døw_«mebox
(
STRUCTCœss
 *
°ru˘˛ass
, 
DüRídîî
 *
ªndîî
, 
EÀmít
 *
ñem
 )

756 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

757 
ªÆ
 
f⁄t_height
;

758 
ªÆ
 
as˚¡
;

759 
DüF⁄t
 *
f⁄t
;

760 
Poöt
 
SèπPoöt
;

761 
Poöt
 
LowîRightPoöt
;

762 
ªÆ
 
Yoff£t
;

763 
Cﬁ‹
 *
ãxt_cﬁ‹
 = &
°ru˘˛ass
->text_color;

767 
SèπPoöt
.
x
 = 
ñem
->
c‹√r
.x;

768 
SèπPoöt
.
y
 = 
ñem
->
c‹√r
.y;

770 
Yoff£t
 = 
ñem
->
c‹√r
.
y
 + 
°ru˘˛ass
->
«mebox_height
;

772 
LowîRightPoöt
 = 
SèπPoöt
;

773 
LowîRightPoöt
.
x
 +
ñem
->
width
;

774 
LowîRightPoöt
.
y
 = 
Yoff£t
;

780 
ªndîî_›s
->
	`fûl_ª˘
(
ªndîî
, &
SèπPoöt
, &
LowîRightPoöt
, &
°ru˘˛ass
->
fûl_cﬁ‹
);

781 
ªndîî_›s
->
	`døw_ª˘
(
ªndîî
, &
SèπPoöt
, &
LowîRightPoöt
, &
°ru˘˛ass
->
löe_cﬁ‹
);

784 
SèπPoöt
.
x
 +
ñem
->
width
 / 2.0;

785 
SèπPoöt
.
y
 += 0.2;

788 i‡(
°ru˘˛ass
->
°îeŸy≥
 !
NULL
 && structclass->stereotype[0] != '\0') {

789 
gch¨
 *
Såög
 = 
°ru˘˛ass
->
°îeŸy≥_°rög
;

790 
as˚¡
 = 
	`dü_f⁄t_as˚¡
(
Såög
, 
°ru˘˛ass
->
n‹mÆ_f⁄t
, såu˘˛ass->
f⁄t_height
);

791 
SèπPoöt
.
y
 +
as˚¡
;

792 
ªndîî_›s
->
	`£t_f⁄t
(
ªndîî
, 
°ru˘˛ass
->
n‹mÆ_f⁄t
, såu˘˛ass->
f⁄t_height
);

793 
ªndîî_›s
->
	`døw_°rög
(
ªndîî
, 
Såög
, &
SèπPoöt
, 
ALIGN_CENTER
, 
ãxt_cﬁ‹
);

794 
SèπPoöt
.
y
 +
°ru˘˛ass
->
f⁄t_height
 - 
as˚¡
;

798 i‡(
°ru˘˛ass
->
«me
 !
NULL
) {

799 i‡(
°ru˘˛ass
->
ab°ø˘
) {

800 
f⁄t
 = 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
;

801 
f⁄t_height
 = 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t_height
;

803 
f⁄t
 = 
°ru˘˛ass
->
˛as¢ame_f⁄t
;

804 
f⁄t_height
 = 
°ru˘˛ass
->
˛as¢ame_f⁄t_height
;

806 
as˚¡
 = 
	`dü_f⁄t_as˚¡
(
°ru˘˛ass
->
«me
, 
f⁄t
, 
f⁄t_height
);

807 
SèπPoöt
.
y
 +
as˚¡
;

809 
ªndîî_›s
->
	`£t_f⁄t
(
ªndîî
, 
f⁄t
, 
f⁄t_height
);

810 
ªndîî_›s
->
	`døw_°rög
(
ªndîî
, 
°ru˘˛ass
->
«me
, &
SèπPoöt
, 
ALIGN_CENTER
, 
ãxt_cﬁ‹
);

811 
SèπPoöt
.
y
 +
f⁄t_height
 - 
as˚¡
;

815 i‡(
°ru˘˛ass
->
visibÀ_commíts
 && såu˘˛ass->
commít
 !
NULL
 && structclass->comment[0] != '\0'){

816 
	`°ru˘_døw_commíts
(
ªndîî
, 
°ru˘˛ass
->
commít_f⁄t
 ,°ru˘˛ass->
commít_f⁄t_height
,

817 &
°ru˘˛ass
->
ãxt_cﬁ‹
, såu˘˛ass->
commít
, såu˘˛ass->
commít_èggög
,

818 
°ru˘˛ass
->
commít_löe_Àngth
, &
SèπPoöt
, 
ALIGN_CENTER
);

820  
Yoff£t
;

821 
	}
}

842 
ªÆ


843 
	$°ru˘˛ass_døw_©åibuãbox
(
STRUCTCœss
 *
°ru˘˛ass
, 
DüRídîî
 *
ªndîî
, 
EÀmít
 *
ñem
, 
ªÆ
 
Yoff£t
)

845 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

846 
ªÆ
 
f⁄t_height
;

847 
ªÆ
 
as˚¡
;

848 
Poöt
 
SèπPoöt
;

849 
Poöt
 
LowîRight
;

850 
DüF⁄t
 *
f⁄t
;

851 
Cﬁ‹
 *
fûl_cﬁ‹
 = &
°ru˘˛ass
->fill_color;

852 
Cﬁ‹
 *
löe_cﬁ‹
 = &
°ru˘˛ass
->line_color;

853 
Cﬁ‹
 *
ãxt_cﬁ‹
 = &
°ru˘˛ass
->text_color;

854 
GLi°
 *
li°
;

856 
SèπPoöt
.
x
 = 
ñem
->
c‹√r
.x;

857 
SèπPoöt
.
y
 = 
Yoff£t
;

858 
Yoff£t
 +
°ru˘˛ass
->
©åibuãsbox_height
;

860 
LowîRight
 = 
SèπPoöt
;

861 
LowîRight
.
x
 +
ñem
->
width
;

862 
LowîRight
.
y
 = 
Yoff£t
;

864 
ªndîî_›s
->
	`fûl_ª˘
(
ªndîî
, &
SèπPoöt
, &
LowîRight
, 
fûl_cﬁ‹
);

865 
ªndîî_›s
->
	`døw_ª˘
(
ªndîî
, &
SèπPoöt
, &
LowîRight
, 
löe_cﬁ‹
);

867 i‡(!
°ru˘˛ass
->
suµªss_©åibuãs
) {

868 
göt
 
i
 = 0;

869 
SèπPoöt
.
x
 +(
°ru˘˛ass
->
löe_width
/2.0 + 0.1);

870 
SèπPoöt
.
y
 += 0.1;

872 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

873 
li°
 !
NULL
)

875 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *)
li°
->
d©a
;

876 
gch¨
 *
©t°r
 = 
	`°ru˘_gë_©åibuã_°rög
(
©å
);

878 i‡(
©å
->
ab°ø˘
) {

879 
f⁄t
 = 
°ru˘˛ass
->
ab°ø˘_f⁄t
;

880 
f⁄t_height
 = 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
;

883 
f⁄t
 = 
°ru˘˛ass
->
n‹mÆ_f⁄t
;

884 
f⁄t_height
 = 
°ru˘˛ass
->font_height;

886 
as˚¡
 = 
	`dü_f⁄t_as˚¡
(
©t°r
, 
f⁄t
, 
f⁄t_height
);

887 
SèπPoöt
.
y
 +
as˚¡
;

888 
ªndîî_›s
->
	`£t_f⁄t
 (
ªndîî
, 
f⁄t
, 
f⁄t_height
);

889 
ªndîî_›s
->
	`døw_°rög
(
ªndîî
, 
©t°r
, &
SèπPoöt
, 
ALIGN_LEFT
, 
ãxt_cﬁ‹
);

890 
SèπPoöt
.
y
 +
f⁄t_height
 - 
as˚¡
;

892 i‡(
©å
->
˛ass_sc›e
) {

893 
	`°ru˘_undîlöe_ãxt
(
ªndîî
, 
SèπPoöt
, 
f⁄t
, 
f⁄t_height
, 
©t°r
, 
löe_cﬁ‹
,

894 
°ru˘˛ass
->
löe_width
, 
STRUCTCLASS_UNDERLINEWIDTH
 );

897 i‡(
°ru˘˛ass
->
visibÀ_commíts
 && 
©å
->
commít
 !
NULL
 &&áttr->comment[0] != '\0') {

898 
	`°ru˘_døw_commíts
(
ªndîî
, 
°ru˘˛ass
->
commít_f⁄t
 ,°ru˘˛ass->
commít_f⁄t_height
,

899 &
°ru˘˛ass
->
ãxt_cﬁ‹
, 
©å
->
commít
, såu˘˛ass->
commít_èggög
,

900 
°ru˘˛ass
->
commít_löe_Àngth
, &
SèπPoöt
, 
ALIGN_LEFT
);

901 
SèπPoöt
.
y
 +
°ru˘˛ass
->
commít_f⁄t_height
/2;

903 
li°
 = 
	`g_li°_√xt
(list);

904 
i
++;

905 
	`g_‰ì
 (
©t°r
);

908  
Yoff£t
;

909 
	}
}

930 
ªÆ


931 
	$°ru˘˛ass_døw_›î©i⁄box
(
STRUCTCœss
 *
°ru˘˛ass
, 
DüRídîî
 *
ªndîî
, 
EÀmít
 *
ñem
, 
ªÆ
 
Yoff£t
)

933 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

934 
ªÆ
 
f⁄t_height
;

935 
Poöt
 
SèπPoöt
;

936 
Poöt
 
LowîRight
;

937 
DüF⁄t
 *
f⁄t
;

938 
GLi°
 *
li°
;

939 
Cﬁ‹
 *
fûl_cﬁ‹
 = &
°ru˘˛ass
->fill_color;

940 
Cﬁ‹
 *
löe_cﬁ‹
 = &
°ru˘˛ass
->line_color;

941 
Cﬁ‹
 *
ãxt_cﬁ‹
 = &
°ru˘˛ass
->text_color;

944 
SèπPoöt
.
x
 = 
ñem
->
c‹√r
.x;

945 
SèπPoöt
.
y
 = 
Yoff£t
;

946 
Yoff£t
 +
°ru˘˛ass
->
›î©i⁄sbox_height
;

948 
LowîRight
 = 
SèπPoöt
;

949 
LowîRight
.
x
 +
ñem
->
width
;

950 
LowîRight
.
y
 = 
Yoff£t
;

952 
ªndîî_›s
->
	`fûl_ª˘
(
ªndîî
, &
SèπPoöt
, &
LowîRight
, 
fûl_cﬁ‹
);

953 
ªndîî_›s
->
	`døw_ª˘
(
ªndîî
, &
SèπPoöt
, &
LowîRight
, 
löe_cﬁ‹
);

955 i‡(!
°ru˘˛ass
->
suµªss_›î©i⁄s
) {

956 
göt
 
i
 = 0;

957 
GLi°
 *
wøpsubli°
 = 
NULL
;

958 
gch¨
 *
∑π_›°r
 = 
NULL
;

959 
wøp_pos
, 
œ°_wøp_pos
, 
idít
, 
wøµög_√eded
;

960 
∑π_›°r_Àn
 = 0, 
∑π_›°r_√ed
 = 0;

962 
SèπPoöt
.
x
 +(
°ru˘˛ass
->
löe_width
/2.0 + 0.1);

963 
SèπPoöt
.
y
 += 0.1;

965 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

966 
li°
 !
NULL
) {

967 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *)
li°
->
d©a
;

968 
gch¨
* 
›°r
 = 
	`°ru˘_gë_›î©i⁄_°rög
(
›
);

969 
ªÆ
 
as˚¡
;

971 
›
->
öhîô™˚_ty≥
) {

972 
STRUCT_ABSTRACT
:

973 
f⁄t
 = 
°ru˘˛ass
->
ab°ø˘_f⁄t
;

974 
f⁄t_height
 = 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
;

976 
STRUCT_POLYMORPHIC
:

977 
f⁄t
 = 
°ru˘˛ass
->
pﬁym‹phic_f⁄t
;

978 
f⁄t_height
 = 
°ru˘˛ass
->
pﬁym‹phic_f⁄t_height
;

980 
STRUCT_LEAF
:

982 
f⁄t
 = 
°ru˘˛ass
->
n‹mÆ_f⁄t
;

983 
f⁄t_height
 = 
°ru˘˛ass
->font_height;

986 
wøµög_√eded
 = 0;

987 if–
°ru˘˛ass
->
wøp_›î©i⁄s
 ) {

988 
wøpsubli°
 = 
›
->
wøµos
;

991 
as˚¡
 = 
	`dü_f⁄t_as˚¡
(
›°r
, 
f⁄t
, 
f⁄t_height
);

992 
›
->
as˚¡
 =áscent;

993 
ªndîî_›s
->
	`£t_f⁄t
(
ªndîî
, 
f⁄t
, 
f⁄t_height
);

995 if–
°ru˘˛ass
->
wøp_›î©i⁄s
 && 
›
->
√eds_wøµög
) {

996 
idít
 = 
›
->
wøp_ödít
;

997 
wøpsubli°
 = 
›
->
wøµos
;

998 
wøp_pos
 = 
œ°_wøp_pos
 = 0;

1000  
wøpsubli°
 !
NULL
) {

1001 
wøp_pos
 = 
	`GPOINTER_TO_INT
–
wøpsubli°
->
d©a
);

1003 if–
œ°_wøp_pos
 == 0) {

1004 
∑π_›°r_√ed
 = 
wøp_pos
 + 1;

1005 i‡(
∑π_›°r_Àn
 < 
∑π_›°r_√ed
) {

1006 
∑π_›°r_Àn
 = 
∑π_›°r_√ed
;

1007 
∑π_›°r
 = 
	`g_ªÆloc
 (∑π_›°r, 
∑π_›°r_√ed
);

1009 
	`°∫˝y
–
∑π_›°r
, 
›°r
, 
wøp_pos
);

1010 
	`mem£t
–
∑π_›°r
+
wøp_pos
, '\0', 1);

1013 
∑π_›°r_√ed
 = 
idít
 + 
wøp_pos
 - 
œ°_wøp_pos
 + 1;

1014 i‡(
∑π_›°r_Àn
 < 
∑π_›°r_√ed
) {

1015 
∑π_›°r_Àn
 = 
∑π_›°r_√ed
;

1016 
∑π_›°r
 = 
	`g_ªÆloc
 (∑π_›°r, 
∑π_›°r_√ed
);

1018 
	`mem£t
–
∑π_›°r
, ' ', 
idít
);

1019 
	`mem£t
–
∑π_›°r
+
idít
, '\0', 1);

1020 
	`°∫ˇt
–
∑π_›°r
, 
›°r
+
œ°_wøp_pos
, 
wøp_pos
-last_wrap_pos);

1023 if–
œ°_wøp_pos
 == 0 ) {

1024 
SèπPoöt
.
y
 +
as˚¡
;

1028 
SèπPoöt
.
y
 +
f⁄t_height
;

1030 
ªndîî_›s
->
	`døw_°rög
(
ªndîî
, 
∑π_›°r
, &
SèπPoöt
, 
ALIGN_LEFT
, 
ãxt_cﬁ‹
);

1031 i‡(
›
->
˛ass_sc›e
) {

1032 
	`°ru˘_undîlöe_ãxt
(
ªndîî
, 
SèπPoöt
, 
f⁄t
, 
f⁄t_height
, 
∑π_›°r
, 
löe_cﬁ‹
,

1033 
°ru˘˛ass
->
löe_width
, 
STRUCTCLASS_UNDERLINEWIDTH
 );

1035 
œ°_wøp_pos
 = 
wøp_pos
;

1036 
wøpsubli°
 = 
	`g_li°_√xt
( wrapsublist);

1041 
SèπPoöt
.
y
 +
as˚¡
;

1042 
ªndîî_›s
->
	`døw_°rög
(
ªndîî
, 
›°r
, &
SèπPoöt
, 
ALIGN_LEFT
, 
ãxt_cﬁ‹
);

1043 i‡(
›
->
˛ass_sc›e
) {

1044 
	`°ru˘_undîlöe_ãxt
(
ªndîî
, 
SèπPoöt
, 
f⁄t
, 
f⁄t_height
, 
›°r
, 
löe_cﬁ‹
,

1045 
°ru˘˛ass
->
löe_width
, 
STRUCTCLASS_UNDERLINEWIDTH
 );

1050 
SèπPoöt
.
y
 +
f⁄t_height
 - 
as˚¡
;

1052 i‡(
°ru˘˛ass
->
visibÀ_commíts
 && 
›
->
commít
 !
NULL
 && op->comment[0] != '\0'){

1053 
	`°ru˘_døw_commíts
(
ªndîî
, 
°ru˘˛ass
->
commít_f⁄t
 ,°ru˘˛ass->
commít_f⁄t_height
,

1054 &
°ru˘˛ass
->
ãxt_cﬁ‹
, 
›
->
commít
, såu˘˛ass->
commít_èggög
,

1055 
°ru˘˛ass
->
commít_löe_Àngth
, &
SèπPoöt
, 
ALIGN_LEFT
);

1056 
SèπPoöt
.
y
 +
°ru˘˛ass
->
commít_f⁄t_height
/2;

1059 
li°
 = 
	`g_li°_√xt
(list);

1060 
i
++;

1061 
	`g_‰ì
 (
›°r
);

1063 i‡(
∑π_›°r
){

1064 
	`g_‰ì
(
∑π_›°r
);

1067  
Yoff£t
;

1068 
	}
}

1084 
	$°ru˘˛ass_døw_ãm∂©e_∑ømëîs_box
(
STRUCTCœss
 *
°ru˘˛ass
, 
DüRídîî
 *
ªndîî
, 
EÀmít
 *
ñem
)

1086 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

1087 
Poöt
 
UµîLe·
;

1088 
Poöt
 
LowîRight
;

1089 
Poöt
 
TextIn£π
;

1090 
GLi°
 *
li°
;

1091 
göt
 
i
;

1092 
DüF⁄t
 *
f⁄t
 = 
°ru˘˛ass
->
n‹mÆ_f⁄t
;

1093 
ªÆ
 
f⁄t_height
 = 
°ru˘˛ass
->font_height;

1094 
ªÆ
 
as˚¡
;

1095 
Cﬁ‹
 *
fûl_cﬁ‹
 = &
°ru˘˛ass
->fill_color;

1096 
Cﬁ‹
 *
löe_cﬁ‹
 = &
°ru˘˛ass
->line_color;

1097 
Cﬁ‹
 *
ãxt_cﬁ‹
 = &
°ru˘˛ass
->text_color;

1103 
UµîLe·
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 - 
STRUCTCLASS_TEMPLATE_OVERLAY_X
;

1104 
UµîLe·
.
y
 = 
ñem
->
c‹√r
.y - 
°ru˘˛ass
->
ãm∂©es_height
 + 
STRUCTCLASS_TEMPLATE_OVERLAY_Y
;

1105 
TextIn£π
 = 
UµîLe·
;

1106 
LowîRight
 = 
UµîLe·
;

1107 
LowîRight
.
x
 +
°ru˘˛ass
->
ãm∂©es_width
;

1108 
LowîRight
.
y
 +
°ru˘˛ass
->
ãm∂©es_height
;

1110 
ªndîî_›s
->
	`fûl_ª˘
(
ªndîî
, &
UµîLe·
, &
LowîRight
, 
fûl_cﬁ‹
);

1111 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
LINESTYLE_DASHED
);

1112 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 0.3);

1113 
ªndîî_›s
->
	`døw_ª˘
(
ªndîî
, &
UµîLe·
, &
LowîRight
, 
löe_cﬁ‹
);

1115 
TextIn£π
.
x
 += 0.3;

1116 
TextIn£π
.
y
 += 0.1;

1117 
ªndîî_›s
->
	`£t_f⁄t
(
ªndîî
, 
f⁄t
, 
f⁄t_height
);

1118 
i
 = 0;

1119 
li°
 = 
°ru˘˛ass
->
f‹mÆ_∑øms
;

1120 
li°
 !
NULL
)

1122 
gch¨
 *
∑øm°r
 = 
	`°ru˘_gë_f‹mÆ∑ømëî_°rög
((
STRUCTF‹mÆP¨amëî
 *)
li°
->
d©a
);

1124 
as˚¡
 = 
	`dü_f⁄t_as˚¡
(
∑øm°r
, 
f⁄t
, 
f⁄t_height
);

1125 
TextIn£π
.
y
 +
as˚¡
;

1126 
ªndîî_›s
->
	`døw_°rög
(
ªndîî
, 
∑øm°r
, &
TextIn£π
, 
ALIGN_LEFT
, 
ãxt_cﬁ‹
);

1127 
TextIn£π
.
y
 +
f⁄t_height
 - 
as˚¡
;

1129 
li°
 = 
	`g_li°_√xt
(list);

1130 
i
++;

1131 
	`g_‰ì
 (
∑øm°r
);

1133 
	}
}

1148 
	$°ru˘˛ass_døw
(
STRUCTCœss
 *
°ru˘˛ass
, 
DüRídîî
 *
ªndîî
)

1150 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

1151 
ªÆ
 
y
 = 0.0;

1152 
EÀmít
 *
ñem
;

1154 
	`as£π
(
°ru˘˛ass
 !
NULL
);

1155 
	`as£π
(
ªndîî
 !
NULL
);

1157 
ªndîî_›s
->
	`£t_fûl°yÀ
(
ªndîî
, 
FILLSTYLE_SOLID
);

1158 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
°ru˘˛ass
->
löe_width
);

1159 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
LINESTYLE_SOLID
);

1161 
ñem
 = &
°ru˘˛ass
->
ñemít
;

1163 
y
 = 
	`°ru˘˛ass_døw_«mebox
(
°ru˘˛ass
, 
ªndîî
, 
ñem
);

1164 i‡(
°ru˘˛ass
->
visibÀ_©åibuãs
) {

1165 
y
 = 
	`°ru˘˛ass_døw_©åibuãbox
(
°ru˘˛ass
, 
ªndîî
, 
ñem
, y);

1167 i‡(
°ru˘˛ass
->
visibÀ_›î©i⁄s
) {

1168 
y
 = 
	`°ru˘˛ass_døw_›î©i⁄box
(
°ru˘˛ass
, 
ªndîî
, 
ñem
, y);

1170 i‡(
°ru˘˛ass
->
ãm∂©e
) {

1171 
	`°ru˘˛ass_døw_ãm∂©e_∑ømëîs_box
(
°ru˘˛ass
, 
ªndîî
, 
ñem
);

1173 
	}
}

1176 
	$°ru˘˛ass_upd©e_d©a
(
STRUCTCœss
 *
°ru˘˛ass
)

1178 
EÀmít
 *
ñem
 = &
°ru˘˛ass
->
ñemít
;

1179 
DüObje˘
 *
obj
 = &
ñem
->
obje˘
;

1180 
ªÆ
 
x
,
y
;

1181 
GLi°
 *
li°
;

1182 
i
;

1183 
poötswide
;

1184 
lowîÀ·c‹√r
;

1185 
ªÆ
 
poöt•acög
;

1187 
x
 = 
ñem
->
c‹√r
.x;

1188 
y
 = 
ñem
->
c‹√r
.y;

1191 
°ru˘˛ass
->
c⁄√˘i⁄s
[0].
pos
 = 
ñem
->
c‹√r
;

1192 
°ru˘˛ass
->
c⁄√˘i⁄s
[0].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_WEST
;

1197 
poötswide
 = (
STRUCTCLASS_CONNECTIONPOINTS
 - 6) / 2;

1198 
poöt•acög
 = 
ñem
->
width
 / (
poötswide
 + 1.0);

1201 
i
=1;i<=
poötswide
;i++) {

1202 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
x
 = x + (
poöt•acög
 * i);

1203 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
y
 = y;

1204 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
dúe˘i⁄s
 = 
DIR_NORTH
;

1207 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2) - 2;

1208 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
x
 = x + 
ñem
->
width
;

1209 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
y
 = y;

1210 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_EAST
;

1212 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2) - 1;

1213 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
x
 = x;

1214 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
y
 = y + såu˘˛ass->
«mebox_height
 / 2.0;

1215 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
dúe˘i⁄s
 = 
DIR_WEST
;

1217 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2);

1218 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
x
 = x + 
ñem
->
width
;

1219 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
y
 = y + såu˘˛ass->
«mebox_height
 / 2.0;

1220 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
dúe˘i⁄s
 = 
DIR_EAST
;

1222 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2) + 1;

1223 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
x
 = x;

1224 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
y
 = y + 
ñem
->
height
;

1225 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
dúe˘i⁄s
 = 
DIR_WEST
|
DIR_SOUTH
;

1228 
lowîÀ·c‹√r
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2) + 1;

1229 
i
=1;i<=
poötswide
;i++) {

1230 
°ru˘˛ass
->
c⁄√˘i⁄s
[
lowîÀ·c‹√r
 + 
i
].
pos
.
x
 = x + (
poöt•acög
 * i);

1231 
°ru˘˛ass
->
c⁄√˘i⁄s
[
lowîÀ·c‹√r
 + 
i
].
pos
.
y
 = y + 
ñem
->
height
;

1232 
°ru˘˛ass
->
c⁄√˘i⁄s
[
lowîÀ·c‹√r
 + 
i
].
dúe˘i⁄s
 = 
DIR_SOUTH
;

1236 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
) - 1;

1237 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
x
 = x + 
ñem
->
width
;

1238 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
y
 = y + 
ñem
->
height
;

1239 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
dúe˘i⁄s
 = 
DIR_EAST
|
DIR_SOUTH
;

1241 #ifde‡
STRUCT_MAINPOINT


1243 
i
 = 
STRUCTCLASS_CONNECTIONPOINTS
;

1244 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
x
 = x + 
ñem
->
width
 / 2;

1245 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
.
y
 = y + 
ñem
->
height
 / 2;

1246 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
dúe˘i⁄s
 = 
DIR_ALL
;

1247 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
Êags
 = 
CP_FLAGS_MAIN
;

1250 
y
 +
°ru˘˛ass
->
«mebox_height
 + 0.1 + såu˘˛ass->
f⁄t_height
/2;

1252 
li°
 = (!
°ru˘˛ass
->
visibÀ_©åibuãs
 || såu˘˛ass->
suµªss_©åibuãs
Ë? 
NULL
 : såu˘˛ass->
©åibuãs
;

1253 
li°
 !
NULL
) {

1254 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *)
li°
->
d©a
;

1256 
©å
->
À·_c⁄√˘i⁄
->
pos
.
x
 = x;

1257 
©å
->
À·_c⁄√˘i⁄
->
pos
.
y
 = y;

1258 
©å
->
À·_c⁄√˘i⁄
->
dúe˘i⁄s
 = 
DIR_WEST
;

1259 
©å
->
right_c⁄√˘i⁄
->
pos
.
x
 = x + 
ñem
->
width
;

1260 
©å
->
right_c⁄√˘i⁄
->
pos
.
y
 = y;

1261 
©å
->
right_c⁄√˘i⁄
->
dúe˘i⁄s
 = 
DIR_EAST
;

1263 
y
 +
°ru˘˛ass
->
f⁄t_height
;

1264 i‡(
°ru˘˛ass
->
visibÀ_commíts
 && 
©å
->
commít
 !
NULL
 &&áttr->comment[0] != '\0') {

1265 
göt
 
NumbîOfLöes
 = 0;

1266 
gch¨
 *
CommítSåög
 = 0;

1268 
CommítSåög
 =

1269 
	`°ru˘_¸óã_documíèti⁄_èg
(
©å
->
commít
, 
°ru˘˛ass
->
commít_èggög
, såu˘˛ass->
commít_löe_Àngth
, &
NumbîOfLöes
);

1270 
	`g_‰ì
(
CommítSåög
);

1271 
y
 +
°ru˘˛ass
->
commít_f⁄t_height
*
NumbîOfLöes
 + structclass->comment_font_height/2;

1274 
li°
 = 
	`g_li°_√xt
(list);

1277 
y
 = 
ñem
->
c‹√r
.y + 
°ru˘˛ass
->
«mebox_height
 + 0.1 + såu˘˛ass->
f⁄t_height
/2;

1278 i‡(
°ru˘˛ass
->
visibÀ_©åibuãs
) {

1279 
y
 +
°ru˘˛ass
->
©åibuãsbox_height
;

1282 
li°
 = (!
°ru˘˛ass
->
visibÀ_›î©i⁄s
 || såu˘˛ass->
suµªss_›î©i⁄s
Ë? 
NULL
 : såu˘˛ass->
›î©i⁄s
;

1283 
li°
 !
NULL
) {

1284 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *)
li°
->
d©a
;

1286 
›
->
À·_c⁄√˘i⁄
->
pos
.
x
 = x;

1287 
›
->
À·_c⁄√˘i⁄
->
pos
.
y
 = y;

1288 
›
->
À·_c⁄√˘i⁄
->
dúe˘i⁄s
 = 
DIR_WEST
;

1289 
›
->
right_c⁄√˘i⁄
->
pos
.
x
 = x + 
ñem
->
width
;

1290 
›
->
right_c⁄√˘i⁄
->
pos
.
y
 = y;

1291 
›
->
right_c⁄√˘i⁄
->
dúe˘i⁄s
 = 
DIR_EAST
;

1293 i‡(
›
->
√eds_wøµög
) {

1294 
löes
 = 
	`g_li°_Àngth
(
›
->
wøµos
);

1295 
y
 +
°ru˘˛ass
->
f⁄t_height
 * 
löes
;

1297 
y
 +
°ru˘˛ass
->
f⁄t_height
;

1299 i‡(
°ru˘˛ass
->
visibÀ_commíts
 && 
›
->
commít
 !
NULL
 && op->comment[0] != '\0') {

1300 
göt
 
NumbîOfLöes
 = 0;

1301 
gch¨
 *
CommítSåög
 = 0;

1303 
CommítSåög
 =

1304 
	`°ru˘_¸óã_documíèti⁄_èg
(
›
->
commít
, 
°ru˘˛ass
->
commít_èggög
, såu˘˛ass->
commít_löe_Àngth
, &
NumbîOfLöes
);

1305 
	`g_‰ì
(
CommítSåög
);

1306 
y
 +
°ru˘˛ass
->
commít_f⁄t_height
*
NumbîOfLöes
 + structclass->comment_font_height/2;

1308 
li°
 = 
	`g_li°_√xt
(list);

1311 
	`ñemít_upd©e_boundögbox
(
ñem
);

1313 i‡(
°ru˘˛ass
->
ãm∂©e
) {

1315 
obj
->
boundög_box
.
t›
 -(
°ru˘˛ass
->
ãm∂©es_height
 - 
STRUCTCLASS_TEMPLATE_OVERLAY_Y
) ;

1316 
obj
->
boundög_box
.
right
 +(
°ru˘˛ass
->
ãm∂©es_width
 - 
STRUCTCLASS_TEMPLATE_OVERLAY_X
);

1317 
obj
->
boundög_box
.
À·
 -(
ñem
->
width
 < 
STRUCTCLASS_TEMPLATE_OVERLAY_X
) ?

1318 (
STRUCTCLASS_TEMPLATE_OVERLAY_X
 - 
ñem
->
width
) : 0;

1321 
obj
->
posôi⁄
 = 
ñem
->
c‹√r
;

1323 
	`ñemít_upd©e_h™dÀs
(
ñem
);

1325 #ifde‡
DEBUG


1326 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "After updating data");

1328 
	}
}

1341 
ªÆ


1342 
	$°ru˘˛ass_ˇlcuœã_«me_d©a
(
STRUCTCœss
 *
°ru˘˛ass
)

1344 
ªÆ
 
maxwidth
 = 0.0;

1345 
ªÆ
 
width
 = 0.0;

1348 i‡(
°ru˘˛ass
->
«me
 !
NULL
 && structclass->name[0] != '\0') {

1349 i‡(
°ru˘˛ass
->
ab°ø˘
) {

1350 
maxwidth
 = 
	`dü_f⁄t_°rög_width
(
°ru˘˛ass
->
«me
,

1351 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
,

1352 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t_height
);

1354 
maxwidth
 = 
	`dü_f⁄t_°rög_width
(
°ru˘˛ass
->
«me
,

1355 
°ru˘˛ass
->
˛as¢ame_f⁄t
,

1356 
°ru˘˛ass
->
˛as¢ame_f⁄t_height
);

1360 
°ru˘˛ass
->
«mebox_height
 = såu˘˛ass->
˛as¢ame_f⁄t_height
 + 4*0.1;

1361 i‡(
°ru˘˛ass
->
°îeŸy≥_°rög
 !
NULL
) {

1362 
	`g_‰ì
(
°ru˘˛ass
->
°îeŸy≥_°rög
);

1364 i‡(
°ru˘˛ass
->
°îeŸy≥
 !
NULL
 && structclass->stereotype[0] != '\0') {

1365 
°ru˘˛ass
->
«mebox_height
 +°ru˘˛ass->
f⁄t_height
;

1366 
°ru˘˛ass
->
°îeŸy≥_°rög
 = 
	`g_°rc⁄ˇt
 ( 
STRUCT_STEREOTYPE_START
,

1367 
°ru˘˛ass
->
°îeŸy≥
,

1368 
STRUCT_STEREOTYPE_END
,

1369 
NULL
);

1371 
width
 = 
	`dü_f⁄t_°rög_width
 (
°ru˘˛ass
->
°îeŸy≥_°rög
,

1372 
°ru˘˛ass
->
n‹mÆ_f⁄t
,

1373 
°ru˘˛ass
->
f⁄t_height
);

1374 
maxwidth
 = 
	`MAX
(
width
, maxwidth);

1376 
°ru˘˛ass
->
°îeŸy≥_°rög
 = 
NULL
;

1379 i‡(
°ru˘˛ass
->
visibÀ_commíts
 && såu˘˛ass->
commít
 !
NULL
 && structclass->comment[0] != '\0')

1381 
NumbîOfLöes
 = 0;

1382 
gch¨
 *
CommítSåög
 = 
	`°ru˘_¸óã_documíèti⁄_èg
 (
°ru˘˛ass
->
commít
,

1383 
°ru˘˛ass
->
commít_èggög
,

1384 
°ru˘˛ass
->
commít_löe_Àngth
,

1385 &
NumbîOfLöes
);

1386 
width
 = 
	`dü_f⁄t_°rög_width
 (
CommítSåög
,

1387 
°ru˘˛ass
->
commít_f⁄t
,

1388 
°ru˘˛ass
->
commít_f⁄t_height
);

1390 
	`g_‰ì
(
CommítSåög
);

1391 
°ru˘˛ass
->
«mebox_height
 +°ru˘˛ass->
commít_f⁄t_height
 * 
NumbîOfLöes
;

1392 
maxwidth
 = 
	`MAX
(
width
, maxwidth);

1394  
maxwidth
;

1395 
	}
}

1404 
ªÆ


1405 
	$°ru˘˛ass_ˇlcuœã_©åibuã_d©a
(
STRUCTCœss
 *
°ru˘˛ass
)

1407 
i
;

1408 
ªÆ
 
maxwidth
 = 0.0;

1409 
ªÆ
 
width
 = 0.0;

1410 
GLi°
 *
li°
;

1412 
°ru˘˛ass
->
©åibuãsbox_height
 = 2*0.1;

1414 i‡(
	`g_li°_Àngth
(
°ru˘˛ass
->
©åibuãs
) != 0)

1416 
i
 = 0;

1417 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

1418 
li°
 !
NULL
)

1420 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *Ë
li°
->
d©a
;

1421 
gch¨
 *
©t°r
 = 
	`°ru˘_gë_©åibuã_°rög
(
©å
);

1423 i‡(
©å
->
ab°ø˘
)

1425 
width
 = 
	`dü_f⁄t_°rög_width
(
©t°r
,

1426 
°ru˘˛ass
->
ab°ø˘_f⁄t
,

1427 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
);

1428 
°ru˘˛ass
->
©åibuãsbox_height
 +°ru˘˛ass->
ab°ø˘_f⁄t_height
;

1432 
width
 = 
	`dü_f⁄t_°rög_width
(
©t°r
,

1433 
°ru˘˛ass
->
n‹mÆ_f⁄t
,

1434 
°ru˘˛ass
->
f⁄t_height
);

1435 
°ru˘˛ass
->
©åibuãsbox_height
 +°ru˘˛ass->
f⁄t_height
;

1437 
maxwidth
 = 
	`MAX
(
width
, maxwidth);

1439 i‡(
°ru˘˛ass
->
visibÀ_commíts
 && 
©å
->
commít
 !
NULL
 &&áttr->comment[0] != '\0')

1441 
NumbîOfLöes
 = 0;

1442 
gch¨
 *
CommítSåög
 = 
	`°ru˘_¸óã_documíèti⁄_èg
(
©å
->
commít
,

1443 
°ru˘˛ass
->
commít_èggög
,

1444 
°ru˘˛ass
->
commít_löe_Àngth
,

1445 &
NumbîOfLöes
);

1446 
width
 = 
	`dü_f⁄t_°rög_width
(
CommítSåög
,

1447 
°ru˘˛ass
->
commít_f⁄t
,

1448 
°ru˘˛ass
->
commít_f⁄t_height
);

1449 
	`g_‰ì
(
CommítSåög
);

1450 
°ru˘˛ass
->
©åibuãsbox_height
 +°ru˘˛ass->
commít_f⁄t_height
 * 
NumbîOfLöes
 + structclass->comment_font_height/2;

1451 
maxwidth
 = 
	`MAX
(
width
, maxwidth);

1454 
i
++;

1455 
li°
 = 
	`g_li°_√xt
(list);

1456 
	`g_‰ì
 (
©t°r
);

1460 i‡((
°ru˘˛ass
->
©åibuãsbox_height
<0.4)|| såu˘˛ass->
suµªss_©åibuãs
 )

1462 
°ru˘˛ass
->
©åibuãsbox_height
 = 0.4;

1464  
maxwidth
;

1465 
	}
}

1475 
ªÆ


1476 
	$°ru˘˛ass_ˇlcuœã_›î©i⁄_d©a
(
STRUCTCœss
 *
°ru˘˛ass
)

1478 
i
;

1479 
pos_√xt_comma
;

1480 
pos_bø˚
;

1481 
wøp_pos
;

1482 
œ°_wøp_pos
;

1483 
ödít
;

1484 
off£t
;

1485 
maxlöewidth
;

1486 
Àngth
;

1487 
ªÆ
 
maxwidth
 = 0.0;

1488 
ªÆ
 
width
 = 0.0;

1489 
GLi°
 *
li°
;

1490 
GLi°
 *
wøpsubli°
;

1493 
°ru˘˛ass
->
›î©i⁄sbox_height
 = 2*0.1;

1495 i‡(0 !
	`g_li°_Àngth
(
°ru˘˛ass
->
›î©i⁄s
))

1497 
i
 = 0;

1498 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

1499 
li°
 !
NULL
)

1501 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *Ë
li°
->
d©a
;

1502 
gch¨
 *
›°r
 = 
	`°ru˘_gë_›î©i⁄_°rög
(
›
);

1503 
DüF⁄t
 *
F⁄t
;

1504 
ªÆ
 
F⁄tHeight
;

1506 
Àngth
 = 
	`°æí
–(c⁄° 
gch¨
*)
›°r
);

1508 i‡(
›
->
wøµos
 !
NULL
) {

1509 
	`g_li°_‰ì
(
›
->
wøµos
);

1511 
›
->
wøµos
 = 
NULL
;

1513 
›
->
öhîô™˚_ty≥
)

1515 
STRUCT_ABSTRACT
:

1516 
F⁄t
 = 
°ru˘˛ass
->
ab°ø˘_f⁄t
;

1517 
F⁄tHeight
 = 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
;

1519 
STRUCT_POLYMORPHIC
:

1520 
F⁄t
 = 
°ru˘˛ass
->
pﬁym‹phic_f⁄t
;

1521 
F⁄tHeight
 = 
°ru˘˛ass
->
pﬁym‹phic_f⁄t_height
;

1523 
STRUCT_LEAF
:

1525 
F⁄t
 = 
°ru˘˛ass
->
n‹mÆ_f⁄t
;

1526 
F⁄tHeight
 = 
°ru˘˛ass
->
f⁄t_height
;

1528 
›
->
as˚¡
 = 
	`dü_f⁄t_as˚¡
(
›°r
, 
F⁄t
, 
F⁄tHeight
);

1530 if–
°ru˘˛ass
->
wøp_›î©i⁄s
 )

1532 if–
Àngth
 > 
°ru˘˛ass
->
wøp_a·î_ch¨
)

1534 
gch¨
 *
∑π_›°r
;

1535 
›
->
√eds_wøµög
 = 
TRUE
;

1540 
pos_√xt_comma
 = 
pos_bø˚
 = 
wøp_pos
 = 
off£t


1541 
maxlöewidth
 = 
°ru˘˛ass
->
max_wøµed_löe_width
 = 0;

1542  
wøp_pos
 + 
off£t
 < 
Àngth
)

1546 
pos_√xt_comma
 = 
	`°rc•n
–(c⁄° 
gch¨
*)
›°r
 + 
wøp_pos
 + 
off£t
, ",");

1547 
wøp_pos
 +
pos_√xt_comma
 + 1;

1548 }  
wøp_pos
 < 
°ru˘˛ass
->
wøp_a·î_ch¨
 - 
pos_bø˚


1549 && 
wøp_pos
 + 
off£t
 < 
Àngth
);

1551 if–
off£t
 == 0){

1552 
pos_bø˚
 = 
	`°rc•n
–
›°r
, "(");

1553 
›
->
wøp_ödít
 = 
pos_bø˚
 + 1;

1555 
›
->
wøµos
 = 
	`g_li°_≠≥nd
(op->wrappos,

1556 
	`GINT_TO_POINTER
(
wøp_pos
 + 
off£t
));

1558 
maxlöewidth
 = 
	`MAX
(maxlöewidth, 
wøp_pos
);

1560 
off£t
 +
wøp_pos
;

1561 
wøp_pos
 = 0;

1563 
°ru˘˛ass
->
max_wøµed_löe_width
 = 
	`MAX
–°ru˘˛ass->max_wøµed_löe_width, 
maxlöewidth
+1);

1565 
ödít
 = 
›
->
wøp_ödít
;

1566 
∑π_›°r
 = 
	`g_Æloˇ
(
°ru˘˛ass
->
max_wøµed_löe_width
+
ödít
+1);

1568 
wøpsubli°
 = 
›
->
wøµos
;

1569 
wøp_pos
 = 
œ°_wøp_pos
 = 0;

1571  
wøpsubli°
 !
NULL
){

1572 
wøp_pos
 = 
	`GPOINTER_TO_INT
–
wøpsubli°
->
d©a
);

1573 if–
œ°_wøp_pos
 == 0){

1574 
	`°∫˝y
–
∑π_›°r
, 
›°r
, 
wøp_pos
);

1575 
	`mem£t
–
∑π_›°r
+
wøp_pos
, '\0', 1);

1579 
	`mem£t
–
∑π_›°r
, ' ', 
ödít
);

1580 
	`mem£t
–
∑π_›°r
+
ödít
, '\0', 1);

1581 
	`°∫ˇt
–
∑π_›°r
, 
›°r
+
œ°_wøp_pos
, 
wøp_pos
-last_wrap_pos);

1584 
width
 = 
	`dü_f⁄t_°rög_width
(
∑π_›°r
,
F⁄t
,
F⁄tHeight
);

1585 
°ru˘˛ass
->
›î©i⁄sbox_height
 +
F⁄tHeight
;

1587 
maxwidth
 = 
	`MAX
(
width
, maxwidth);

1588 
œ°_wøp_pos
 = 
wøp_pos
;

1589 
wøpsubli°
 = 
	`g_li°_√xt
( wrapsublist);

1594 
›
->
√eds_wøµög
 = 
FALSE
;

1598 i‡(!(
°ru˘˛ass
->
wøp_›î©i⁄s
 && 
Àngth
 > såu˘˛ass->
wøp_a·î_ch¨
)) {

1599 
›
->
öhîô™˚_ty≥
)

1601 
STRUCT_ABSTRACT
:

1602 
F⁄t
 = 
°ru˘˛ass
->
ab°ø˘_f⁄t
;

1603 
F⁄tHeight
 = 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
;

1605 
STRUCT_POLYMORPHIC
:

1606 
F⁄t
 = 
°ru˘˛ass
->
pﬁym‹phic_f⁄t
;

1607 
F⁄tHeight
 = 
°ru˘˛ass
->
pﬁym‹phic_f⁄t_height
;

1609 
STRUCT_LEAF
:

1611 
F⁄t
 = 
°ru˘˛ass
->
n‹mÆ_f⁄t
;

1612 
F⁄tHeight
 = 
°ru˘˛ass
->
f⁄t_height
;

1614 
width
 = 
	`dü_f⁄t_°rög_width
(
›°r
,
F⁄t
,
F⁄tHeight
);

1615 
°ru˘˛ass
->
›î©i⁄sbox_height
 +
F⁄tHeight
;

1617 
maxwidth
 = 
	`MAX
(
width
, maxwidth);

1620 i‡(
°ru˘˛ass
->
visibÀ_commíts
 && 
›
->
commít
 !
NULL
 && op->comment[0] != '\0'){

1621 
NumbîOfLöes
 = 0;

1622 
gch¨
 *
CommítSåög
 = 
	`°ru˘_¸óã_documíèti⁄_èg
(
›
->
commít
,

1623 
°ru˘˛ass
->
commít_èggög
,

1624 
°ru˘˛ass
->
commít_löe_Àngth
,

1625 &
NumbîOfLöes
);

1626 
width
 = 
	`dü_f⁄t_°rög_width
(
CommítSåög
,

1627 
°ru˘˛ass
->
commít_f⁄t
,

1628 
°ru˘˛ass
->
commít_f⁄t_height
);

1629 
	`g_‰ì
(
CommítSåög
);

1630 
°ru˘˛ass
->
›î©i⁄sbox_height
 +°ru˘˛ass->
commít_f⁄t_height
 * 
NumbîOfLöes
 + structclass->comment_font_height/2;

1631 
maxwidth
 = 
	`MAX
(
width
, maxwidth);

1634 
i
++;

1635 
li°
 = 
	`g_li°_√xt
(list);

1636 
	`g_‰ì
 (
›°r
);

1640 
°ru˘˛ass
->
ñemít
.
width
 = 
maxwidth
 + 2*0.3;

1642 i‡((
°ru˘˛ass
->
›î©i⁄sbox_height
<0.4Ë|| såu˘˛ass->
suµªss_›î©i⁄s
 ) {

1643 
°ru˘˛ass
->
›î©i⁄sbox_height
 = 0.4;

1646  
maxwidth
;

1647 
	}
}

1662 
	$°ru˘˛ass_ˇlcuœã_d©a
(
STRUCTCœss
 *
°ru˘˛ass
)

1664 
i
;

1665 
num_ãm∂©es
;

1666 
ªÆ
 
maxwidth
 = 0.0;

1667 
ªÆ
 
width
;

1668 
GLi°
 *
li°
;

1670 i‡(!
°ru˘˛ass
->
de°royed
)

1672 
maxwidth
 = 
	`MAX
(
	`°ru˘˛ass_ˇlcuœã_«me_d©a
(
°ru˘˛ass
), maxwidth);

1674 
°ru˘˛ass
->
ñemít
.
height
 = såu˘˛ass->
«mebox_height
;

1676 i‡(
°ru˘˛ass
->
visibÀ_©åibuãs
){

1677 
maxwidth
 = 
	`MAX
(
	`°ru˘˛ass_ˇlcuœã_©åibuã_d©a
(
°ru˘˛ass
), maxwidth);

1678 
°ru˘˛ass
->
ñemít
.
height
 +°ru˘˛ass->
©åibuãsbox_height
;

1680 i‡(
°ru˘˛ass
->
visibÀ_›î©i⁄s
){

1681 
maxwidth
 = 
	`MAX
(
	`°ru˘˛ass_ˇlcuœã_›î©i⁄_d©a
(
°ru˘˛ass
), maxwidth);

1682 
°ru˘˛ass
->
ñemít
.
height
 +°ru˘˛ass->
›î©i⁄sbox_height
;

1684 
°ru˘˛ass
->
ñemít
.
width
 = 
maxwidth
+0.5;

1686 
num_ãm∂©es
 = 
	`g_li°_Àngth
(
°ru˘˛ass
->
f‹mÆ_∑øms
);

1688 
°ru˘˛ass
->
ãm∂©es_height
 =

1689 
°ru˘˛ass
->
f⁄t_height
 * 
num_ãm∂©es
 + 2*0.1;

1690 
°ru˘˛ass
->
ãm∂©es_height
 = 
	`MAX
(structclass->templates_height, 0.4);

1693 
maxwidth
 = 
STRUCTCLASS_TEMPLATE_OVERLAY_X
;

1694 i‡(
num_ãm∂©es
 != 0)

1696 
i
 = 0;

1697 
li°
 = 
°ru˘˛ass
->
f‹mÆ_∑øms
;

1698 
li°
 !
NULL
)

1700 
STRUCTF‹mÆP¨amëî
 *
∑øm
 = (STRUCTF‹mÆP¨amëî *Ë
li°
->
d©a
;

1701 
gch¨
 *
∑øm°r
 = 
	`°ru˘_gë_f‹mÆ∑ømëî_°rög
(
∑øm
);

1703 
width
 = 
	`dü_f⁄t_°rög_width
(
∑øm°r
,

1704 
°ru˘˛ass
->
n‹mÆ_f⁄t
,

1705 
°ru˘˛ass
->
f⁄t_height
);

1706 
maxwidth
 = 
	`MAX
(
width
, maxwidth);

1708 
i
++;

1709 
li°
 = 
	`g_li°_√xt
(list);

1710 
	`g_‰ì
 (
∑øm°r
);

1713 
°ru˘˛ass
->
ãm∂©es_width
 = 
maxwidth
 + 2*0.2;

1715 
	}
}

1718 
	$fûl_ö_f⁄td©a
(
STRUCTCœss
 *
°ru˘˛ass
)

1720 i‡(
°ru˘˛ass
->
n‹mÆ_f⁄t
 =
NULL
) {

1721 
°ru˘˛ass
->
f⁄t_height
 = 0.8;

1722 
°ru˘˛ass
->
n‹mÆ_f⁄t
 = 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_MONOSPACE
, 0.8);

1724 i‡(
°ru˘˛ass
->
ab°ø˘_f⁄t
 =
NULL
) {

1725 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
 = 0.8;

1726 
°ru˘˛ass
->
ab°ø˘_f⁄t
 =

1727 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
 | 
DIA_FONT_BOLD
, 0.8);

1729 i‡(
°ru˘˛ass
->
pﬁym‹phic_f⁄t
 =
NULL
) {

1730 
°ru˘˛ass
->
pﬁym‹phic_f⁄t_height
 = 0.8;

1731 
°ru˘˛ass
->
pﬁym‹phic_f⁄t
 =

1732 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
, 0.8);

1734 i‡(
°ru˘˛ass
->
˛as¢ame_f⁄t
 =
NULL
) {

1735 
°ru˘˛ass
->
˛as¢ame_f⁄t_height
 = 1.0;

1736 
°ru˘˛ass
->
˛as¢ame_f⁄t
 =

1737 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
, 1.0);

1739 i‡(
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
 =
NULL
) {

1740 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t_height
 = 1.0;

1741 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
 =

1742 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
 | 
DIA_FONT_ITALIC
, 1.0);

1744 i‡(
°ru˘˛ass
->
commít_f⁄t
 =
NULL
) {

1745 
°ru˘˛ass
->
commít_f⁄t_height
 = 0.7;

1746 
°ru˘˛ass
->
commít_f⁄t
 = 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_SANS
 | 
DIA_FONT_ITALIC
, 0.7);

1748 
	}
}

1772 
DüObje˘
 *

1773 
	$°ru˘˛ass_¸óã
(
Poöt
 *
°¨çoöt
,

1774 *
u£r_d©a
,

1775 
H™dÀ
 **
h™dÀ1
,

1776 
H™dÀ
 **
h™dÀ2
)

1778 
STRUCTCœss
 *
°ru˘˛ass
;

1779 
EÀmít
 *
ñem
;

1780 
DüObje˘
 *
obj
;

1781 
i
;

1783 
°ru˘˛ass
 = 
	`g_mÆloc0
((
STRUCTCœss
));

1784 
ñem
 = &
°ru˘˛ass
->
ñemít
;

1785 
obj
 = &
ñem
->
obje˘
;

1788 
ñem
->
c‹√r
 = *
°¨çoöt
;

1790 #ifde‡
STRUCT_MAINPOINT


1791 
	`ñemít_öô
(
ñem
, 8, 
STRUCTCLASS_CONNECTIONPOINTS
 + 1);

1793 
	`ñemít_öô
(
ñem
, 8, 
STRUCTCLASS_CONNECTIONPOINTS
);

1796 
	`fûl_ö_f⁄td©a
(
°ru˘˛ass
);

1803 
°ru˘˛ass
->
ãm∂©e
 = 
FALSE
;

1804 
ödex
 = 
	`GPOINTER_TO_INT
(
u£r_d©a
);

1805 
GLi°
 *
s°ru˘
 = 
°ru˘Li°
.structList;

1806 ;
s°ru˘
 !=
NULL
;s°ru˘ = s°ru˘->
√xt
)

1808 
Fa˘‹ySåu˘IãmLi°
 *
i
 = 
s°ru˘
->
d©a
;

1809 if(
i
->
numbî
 =
ödex
)

1811 
°ru˘˛ass
->
«me
 = 
	`g_°rdup
(
	`_
(
i
->name));

1817 
obj
->
ty≥
 = &
°ru˘˛ass_ty≥
;

1818 
obj
->
›s
 = &
°ru˘˛ass_›s
;

1820 
°ru˘˛ass
->
°îeŸy≥
 = 
NULL
;

1821 
°ru˘˛ass
->
commít
 = 
NULL
;

1823 
°ru˘˛ass
->
ab°ø˘
 = 
FALSE
;

1825 
°ru˘˛ass
->
suµªss_©åibuãs
 = 
FALSE
;

1826 
°ru˘˛ass
->
suµªss_›î©i⁄s
 = 
FALSE
;

1828 
°ru˘˛ass
->
visibÀ_©åibuãs
 = 
TRUE
;

1829 
°ru˘˛ass
->
visibÀ_›î©i⁄s
 = 
TRUE
;

1830 
°ru˘˛ass
->
visibÀ_commíts
 = 
FALSE
;

1832 
°ru˘˛ass
->
wøp_›î©i⁄s
 = 
TRUE
;

1833 
°ru˘˛ass
->
wøp_a·î_ch¨
 = 
STRUCTCLASS_WRAP_AFTER_CHAR
;

1835 
°ru˘˛ass
->
©åibuãs
 = 
NULL
;

1837 
°ru˘˛ass
->
›î©i⁄s
 = 
NULL
;

1839 
°ru˘˛ass
->
f‹mÆ_∑øms
 = 
NULL
;

1841 
°ru˘˛ass
->
°îeŸy≥_°rög
 = 
NULL
;

1843 
°ru˘˛ass
->
löe_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

1844 
°ru˘˛ass
->
ãxt_cﬁ‹
 = 
cﬁ‹_bœck
;

1845 
°ru˘˛ass
->
löe_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

1846 
°ru˘˛ass
->
fûl_cﬁ‹
 = 
	`©åibuãs_gë_background
();

1848 
	`°ru˘˛ass_ˇlcuœã_d©a
(
°ru˘˛ass
);

1850 
i
=0;i<
STRUCTCLASS_CONNECTIONPOINTS
;i++) {

1851 
obj
->
c⁄√˘i⁄s
[
i
] = &
°ru˘˛ass
->connections[i];

1852 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

1853 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

1855 #ifde‡
STRUCT_MAINPOINT


1858 
i
 +
	`°ru˘˛ass_num_dy«mic_c⁄√˘i⁄poöts
(
°ru˘˛ass
);

1859 
obj
->
c⁄√˘i⁄s
[
i
] = &
°ru˘˛ass
->c⁄√˘i⁄s[
STRUCTCLASS_CONNECTIONPOINTS
];

1860 
°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
obje˘
 = 
obj
;

1861 
°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
c⁄√˘ed
 = 
NULL
;

1864 
ñem
->
exåa_•acög
.
b‹dî_å™s
 = 
°ru˘˛ass
->
löe_width
/2.0;

1865 
	`°ru˘˛ass_upd©e_d©a
(
°ru˘˛ass
);

1867 
i
=0;i<8;i++) {

1868 
obj
->
h™dÀs
[
i
]->
ty≥
 = 
HANDLE_NON_MOVABLE
;

1871 *
h™dÀ1
 = 
NULL
;

1872 *
h™dÀ2
 = 
NULL
;

1875  &
°ru˘˛ass
->
ñemít
.
obje˘
;

1876 
	}
}

1879 
	$°ru˘˛ass_de°roy
(
STRUCTCœss
 *
°ru˘˛ass
)

1881 
GLi°
 *
li°
;

1882 
STRUCTAâribuã
 *
©å
;

1883 
STRUCTO≥øti⁄
 *
›
;

1884 
STRUCTF‹mÆP¨amëî
 *
∑øm
;

1886 #ifde‡
DEBUG


1887 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "Destroying");

1890 
°ru˘˛ass
->
de°royed
 = 
TRUE
;

1892 
	`dü_f⁄t_uƒef
(
°ru˘˛ass
->
n‹mÆ_f⁄t
);

1893 
	`dü_f⁄t_uƒef
(
°ru˘˛ass
->
ab°ø˘_f⁄t
);

1894 
	`dü_f⁄t_uƒef
(
°ru˘˛ass
->
pﬁym‹phic_f⁄t
);

1895 
	`dü_f⁄t_uƒef
(
°ru˘˛ass
->
˛as¢ame_f⁄t
);

1896 
	`dü_f⁄t_uƒef
(
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
);

1897 
	`dü_f⁄t_uƒef
(
°ru˘˛ass
->
commít_f⁄t
);

1899 
	`ñemít_de°roy
(&
°ru˘˛ass
->
ñemít
);

1901 
	`g_‰ì
(
°ru˘˛ass
->
«me
);

1902 
	`g_‰ì
(
°ru˘˛ass
->
°îeŸy≥
);

1903 
	`g_‰ì
(
°ru˘˛ass
->
commít
);

1905 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

1906 
li°
 !
NULL
) {

1907 
©å
 = (
STRUCTAâribuã
 *)
li°
->
d©a
;

1908 
	`g_‰ì
(
©å
->
À·_c⁄√˘i⁄
);

1909 
	`g_‰ì
(
©å
->
right_c⁄√˘i⁄
);

1910 
	`°ru˘_©åibuã_de°roy
(
©å
);

1911 
li°
 = 
	`g_li°_√xt
(list);

1913 
	`g_li°_‰ì
(
°ru˘˛ass
->
©åibuãs
);

1915 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

1916 
li°
 !
NULL
) {

1917 
›
 = (
STRUCTO≥øti⁄
 *)
li°
->
d©a
;

1918 
	`g_‰ì
(
›
->
À·_c⁄√˘i⁄
);

1919 
	`g_‰ì
(
›
->
right_c⁄√˘i⁄
);

1920 
	`°ru˘_›î©i⁄_de°roy
(
›
);

1921 
li°
 = 
	`g_li°_√xt
(list);

1923 
	`g_li°_‰ì
(
°ru˘˛ass
->
›î©i⁄s
);

1925 
li°
 = 
°ru˘˛ass
->
f‹mÆ_∑øms
;

1926 
li°
 !
NULL
) {

1927 
∑øm
 = (
STRUCTF‹mÆP¨amëî
 *)
li°
->
d©a
;

1928 
	`°ru˘_f‹mÆ∑ømëî_de°roy
(
∑øm
);

1929 
li°
 = 
	`g_li°_√xt
(list);

1931 
	`g_li°_‰ì
(
°ru˘˛ass
->
f‹mÆ_∑øms
);

1933 i‡(
°ru˘˛ass
->
°îeŸy≥_°rög
 !
NULL
) {

1934 
	`g_‰ì
(
°ru˘˛ass
->
°îeŸy≥_°rög
);

1937 i‡(
°ru˘˛ass
->
¥›îtõs_dülog
 !
NULL
) {

1938 
	`°ru˘˛ass_dülog_‰ì
 (
°ru˘˛ass
->
¥›îtõs_dülog
);

1940 
	}
}

1942 
DüObje˘
 *

1943 
	$°ru˘˛ass_c›y
(
STRUCTCœss
 *
°ru˘˛ass
)

1945 
i
;

1946 
STRUCTCœss
 *
√w°ru˘˛ass
;

1947 
EÀmít
 *
ñem
, *
√wñem
;

1948 
DüObje˘
 *
√wobj
;

1949 
GLi°
 *
li°
;

1950 
STRUCTF‹mÆP¨amëî
 *
∑øm
;

1952 
ñem
 = &
°ru˘˛ass
->
ñemít
;

1954 
√w°ru˘˛ass
 = 
	`g_mÆloc0
((
STRUCTCœss
));

1955 
√wñem
 = &
√w°ru˘˛ass
->
ñemít
;

1956 
√wobj
 = &
√wñem
->
obje˘
;

1958 
	`ñemít_c›y
(
ñem
, 
√wñem
);

1960 
√w°ru˘˛ass
->
f⁄t_height
 = 
°ru˘˛ass
->font_height;

1961 
√w°ru˘˛ass
->
ab°ø˘_f⁄t_height
 = 
°ru˘˛ass
->abstract_font_height;

1962 
√w°ru˘˛ass
->
pﬁym‹phic_f⁄t_height
 = 
°ru˘˛ass
->polymorphic_font_height;

1963 
√w°ru˘˛ass
->
˛as¢ame_f⁄t_height
 = 
°ru˘˛ass
->classname_font_height;

1964 
√w°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t_height
 =

1965 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t_height
;

1966 
√w°ru˘˛ass
->
commít_f⁄t_height
 =

1967 
°ru˘˛ass
->
commít_f⁄t_height
;

1969 
√w°ru˘˛ass
->
n‹mÆ_f⁄t
 =

1970 
	`dü_f⁄t_c›y
(
°ru˘˛ass
->
n‹mÆ_f⁄t
);

1971 
√w°ru˘˛ass
->
ab°ø˘_f⁄t
 =

1972 
	`dü_f⁄t_c›y
(
°ru˘˛ass
->
ab°ø˘_f⁄t
);

1973 
√w°ru˘˛ass
->
pﬁym‹phic_f⁄t
 =

1974 
	`dü_f⁄t_c›y
(
°ru˘˛ass
->
pﬁym‹phic_f⁄t
);

1975 
√w°ru˘˛ass
->
˛as¢ame_f⁄t
 =

1976 
	`dü_f⁄t_c›y
(
°ru˘˛ass
->
˛as¢ame_f⁄t
);

1977 
√w°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
 =

1978 
	`dü_f⁄t_c›y
(
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
);

1979 
√w°ru˘˛ass
->
commít_f⁄t
 =

1980 
	`dü_f⁄t_c›y
(
°ru˘˛ass
->
commít_f⁄t
);

1982 
√w°ru˘˛ass
->
«me
 = 
	`g_°rdup
(
°ru˘˛ass
->name);

1983 i‡(
°ru˘˛ass
->
°îeŸy≥
 !
NULL
 && structclass->stereotype[0] != '\0')

1984 
√w°ru˘˛ass
->
°îeŸy≥
 = 
	`g_°rdup
(
°ru˘˛ass
->stereotype);

1986 
√w°ru˘˛ass
->
°îeŸy≥
 = 
NULL
;

1988 i‡(
°ru˘˛ass
->
commít
 !
NULL
)

1989 
√w°ru˘˛ass
->
commít
 = 
	`g_°rdup
(
°ru˘˛ass
->comment);

1991 
√w°ru˘˛ass
->
commít
 = 
NULL
;

1993 
√w°ru˘˛ass
->
ab°ø˘
 = 
°ru˘˛ass
->abstract;

1994 
√w°ru˘˛ass
->
suµªss_©åibuãs
 = 
°ru˘˛ass
->suppress_attributes;

1995 
√w°ru˘˛ass
->
suµªss_›î©i⁄s
 = 
°ru˘˛ass
->suppress_operations;

1996 
√w°ru˘˛ass
->
visibÀ_©åibuãs
 = 
°ru˘˛ass
->visible_attributes;

1997 
√w°ru˘˛ass
->
visibÀ_›î©i⁄s
 = 
°ru˘˛ass
->visible_operations;

1998 
√w°ru˘˛ass
->
visibÀ_commíts
 = 
°ru˘˛ass
->visible_comments;

1999 
√w°ru˘˛ass
->
wøp_›î©i⁄s
 = 
°ru˘˛ass
->wrap_operations;

2000 
√w°ru˘˛ass
->
wøp_a·î_ch¨
 = 
°ru˘˛ass
->wrap_after_char;

2001 
√w°ru˘˛ass
->
commít_löe_Àngth
 = 
°ru˘˛ass
->comment_line_length;

2002 
√w°ru˘˛ass
->
commít_èggög
 = 
°ru˘˛ass
->comment_tagging;

2003 
√w°ru˘˛ass
->
löe_width
 = 
°ru˘˛ass
->line_width;

2004 
√w°ru˘˛ass
->
ãxt_cﬁ‹
 = 
°ru˘˛ass
->text_color;

2005 
√w°ru˘˛ass
->
löe_cﬁ‹
 = 
°ru˘˛ass
->line_color;

2006 
√w°ru˘˛ass
->
fûl_cﬁ‹
 = 
°ru˘˛ass
->fill_color;

2008 
√w°ru˘˛ass
->
©åibuãs
 = 
NULL
;

2009 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

2010 
li°
 !
NULL
) {

2011 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *)
li°
->
d©a
;

2013 
STRUCTAâribuã
 *
√w©å
 = 
	`°ru˘_©åibuã_c›y
(
©å
);

2014 
	`°ru˘_©åibuã_ísuª_c⁄√˘i⁄_poöts
 (
√w©å
, 
√wobj
);

2016 
√w°ru˘˛ass
->
©åibuãs
 = 
	`g_li°_≠≥nd
(newstructclass->attributes,

2017 
√w©å
);

2018 
li°
 = 
	`g_li°_√xt
(list);

2021 
√w°ru˘˛ass
->
›î©i⁄s
 = 
NULL
;

2022 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

2023 
li°
 !
NULL
) {

2024 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *)
li°
->
d©a
;

2025 
STRUCTO≥øti⁄
 *
√w›
 = 
	`°ru˘_›î©i⁄_c›y
(
›
);

2026 
	`°ru˘_›î©i⁄_ísuª_c⁄√˘i⁄_poöts
 (
√w›
, 
√wobj
);

2028 
√w°ru˘˛ass
->
›î©i⁄s
 = 
	`g_li°_≠≥nd
(newstructclass->operations,

2029 
√w›
);

2030 
li°
 = 
	`g_li°_√xt
(list);

2033 
√w°ru˘˛ass
->
ãm∂©e
 = 
°ru˘˛ass
->template;

2035 
√w°ru˘˛ass
->
f‹mÆ_∑øms
 = 
NULL
;

2036 
li°
 = 
°ru˘˛ass
->
f‹mÆ_∑øms
;

2037 
li°
 !
NULL
) {

2038 
∑øm
 = (
STRUCTF‹mÆP¨amëî
 *)
li°
->
d©a
;

2039 
√w°ru˘˛ass
->
f‹mÆ_∑øms
 =

2040 
	`g_li°_≠≥nd
(
√w°ru˘˛ass
->
f‹mÆ_∑øms
,

2041 
	`°ru˘_f‹mÆ∑ømëî_c›y
(
∑øm
));

2042 
li°
 = 
	`g_li°_√xt
(list);

2045 
√w°ru˘˛ass
->
¥›îtõs_dülog
 = 
NULL
;

2047 
√w°ru˘˛ass
->
°îeŸy≥_°rög
 = 
NULL
;

2049 
i
=0;i<
STRUCTCLASS_CONNECTIONPOINTS
;i++) {

2050 
√wobj
->
c⁄√˘i⁄s
[
i
] = &
√w°ru˘˛ass
->connections[i];

2051 
√w°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
√wobj
;

2052 
√w°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

2053 
√w°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
pos
 = 
°ru˘˛ass
->connections[i].pos;

2054 
√w°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
œ°_pos
 = 
°ru˘˛ass
->connections[i].last_pos;

2057 
	`°ru˘˛ass_ˇlcuœã_d©a
(
√w°ru˘˛ass
);

2059 
i
 = 
STRUCTCLASS_CONNECTIONPOINTS
;

2060 i‡–(
√w°ru˘˛ass
->
visibÀ_©åibuãs
) &&

2061 (!
√w°ru˘˛ass
->
suµªss_©åibuãs
)) {

2062 
li°
 = 
√w°ru˘˛ass
->
©åibuãs
;

2063 
li°
 !
NULL
) {

2064 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *)
li°
->
d©a
;

2065 
√wobj
->
c⁄√˘i⁄s
[
i
++] = 
©å
->
À·_c⁄√˘i⁄
;

2066 
√wobj
->
c⁄√˘i⁄s
[
i
++] = 
©å
->
right_c⁄√˘i⁄
;

2068 
li°
 = 
	`g_li°_√xt
(list);

2072 i‡–(
√w°ru˘˛ass
->
visibÀ_›î©i⁄s
) &&

2073 (!
√w°ru˘˛ass
->
suµªss_›î©i⁄s
)) {

2074 
li°
 = 
√w°ru˘˛ass
->
›î©i⁄s
;

2075 
li°
 !
NULL
) {

2076 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *)
li°
->
d©a
;

2077 
√wobj
->
c⁄√˘i⁄s
[
i
++] = 
›
->
À·_c⁄√˘i⁄
;

2078 
√wobj
->
c⁄√˘i⁄s
[
i
++] = 
›
->
right_c⁄√˘i⁄
;

2080 
li°
 = 
	`g_li°_√xt
(list);

2084 #ifde‡
STRUCT_MAINPOINT


2085 
√wobj
->
c⁄√˘i⁄s
[
i
] = &
√w°ru˘˛ass
->c⁄√˘i⁄s[
STRUCTCLASS_CONNECTIONPOINTS
];

2086 
√w°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
obje˘
 = 
√wobj
;

2087 
√w°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
c⁄√˘ed
 = 
NULL
;

2088 
√w°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
pos
 =

2089 
°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
pos
;

2090 
√w°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
œ°_pos
 =

2091 
°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
œ°_pos
;

2092 
√w°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
Êags
 =

2093 
°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
].
Êags
;

2094 
i
++;

2097 
	`°ru˘˛ass_upd©e_d©a
(
√w°ru˘˛ass
);

2099 #ifde‡
DEBUG


2100 
	`°ru˘˛ass_ßnôy_check
(
√w°ru˘˛ass
, "Copied");

2103  &
√w°ru˘˛ass
->
ñemít
.
obje˘
;

2104 
	}
}

2107 
	$Á˘‹y_°ru˘_ôems_ßve
(
STRUCTCœss
 *
°ru˘˛ass
, 
Obje˘Node
 
obj_node
,

2108 c⁄° *
fûíame
)

2110 
STRUCTAâribuã
 *
©å
;

2111 
STRUCTO≥øti⁄
 *
›
;

2112 
STRUCTF‹mÆP¨amëî
 *
f‹mÆ_∑øm
;

2113 
GLi°
 *
li°
;

2114 
AâribuãNode
 
©å_node
;

2118 
	`ñemít_ßve
(&
°ru˘˛ass
->
ñemít
, 
obj_node
);

2123 
	}
}

2127 
	$°ru˘˛ass_ßve
(
STRUCTCœss
 *
°ru˘˛ass
, 
Obje˘Node
 
obj_node
,

2128 c⁄° *
fûíame
)

2130 
STRUCTAâribuã
 *
©å
;

2131 
STRUCTO≥øti⁄
 *
›
;

2132 
STRUCTF‹mÆP¨amëî
 *
f‹mÆ_∑øm
;

2133 
GLi°
 *
li°
;

2134 
AâribuãNode
 
©å_node
;

2136 #ifde‡
DEBUG


2137 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "Saving");

2140 
	`ñemít_ßve
(&
°ru˘˛ass
->
ñemít
, 
obj_node
);

2143 
	`d©a_add_°rög
(
	`√w_©åibuã
(
obj_node
, "name"),

2144 
°ru˘˛ass
->
«me
);

2145 
	`d©a_add_°rög
(
	`√w_©åibuã
(
obj_node
, "stereotype"),

2146 
°ru˘˛ass
->
°îeŸy≥
);

2147 
	`d©a_add_°rög
(
	`√w_©åibuã
(
obj_node
, "comment"),

2148 
°ru˘˛ass
->
commít
);

2149 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "abstract"),

2150 
°ru˘˛ass
->
ab°ø˘
);

2151 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "suppress_attributes"),

2152 
°ru˘˛ass
->
suµªss_©åibuãs
);

2153 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "suppress_operations"),

2154 
°ru˘˛ass
->
suµªss_›î©i⁄s
);

2155 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "visible_attributes"),

2156 
°ru˘˛ass
->
visibÀ_©åibuãs
);

2157 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "visible_operations"),

2158 
°ru˘˛ass
->
visibÀ_›î©i⁄s
);

2159 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "visible_comments"),

2160 
°ru˘˛ass
->
visibÀ_commíts
);

2161 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "wrap_operations"),

2162 
°ru˘˛ass
->
wøp_›î©i⁄s
);

2163 
	`d©a_add_öt
(
	`√w_©åibuã
(
obj_node
, "wrap_after_char"),

2164 
°ru˘˛ass
->
wøp_a·î_ch¨
);

2165 
	`d©a_add_öt
(
	`√w_©åibuã
(
obj_node
, "comment_line_length"),

2166 
°ru˘˛ass
->
commít_löe_Àngth
);

2167 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "comment_tagging"),

2168 
°ru˘˛ass
->
commít_èggög
);

2169 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

2170 
°ru˘˛ass
->
löe_width
);

2171 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "line_color"),

2172 &
°ru˘˛ass
->
löe_cﬁ‹
);

2173 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "fill_color"),

2174 &
°ru˘˛ass
->
fûl_cﬁ‹
);

2175 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "text_color"),

2176 &
°ru˘˛ass
->
ãxt_cﬁ‹
);

2177 
	`d©a_add_f⁄t
 (
	`√w_©åibuã
 (
obj_node
, "normal_font"),

2178 
°ru˘˛ass
->
n‹mÆ_f⁄t
);

2179 
	`d©a_add_f⁄t
 (
	`√w_©åibuã
 (
obj_node
, "abstract_font"),

2180 
°ru˘˛ass
->
ab°ø˘_f⁄t
);

2181 
	`d©a_add_f⁄t
 (
	`√w_©åibuã
 (
obj_node
, "polymorphic_font"),

2182 
°ru˘˛ass
->
pﬁym‹phic_f⁄t
);

2183 
	`d©a_add_f⁄t
 (
	`√w_©åibuã
 (
obj_node
, "classname_font"),

2184 
°ru˘˛ass
->
˛as¢ame_f⁄t
);

2185 
	`d©a_add_f⁄t
 (
	`√w_©åibuã
 (
obj_node
, "abstract_classname_font"),

2186 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
);

2187 
	`d©a_add_f⁄t
 (
	`√w_©åibuã
 (
obj_node
, "comment_font"),

2188 
°ru˘˛ass
->
commít_f⁄t
);

2189 
	`d©a_add_ªÆ
 (
	`√w_©åibuã
 (
obj_node
, "normal_font_height"),

2190 
°ru˘˛ass
->
f⁄t_height
);

2191 
	`d©a_add_ªÆ
 (
	`√w_©åibuã
 (
obj_node
, "polymorphic_font_height"),

2192 
°ru˘˛ass
->
pﬁym‹phic_f⁄t_height
);

2193 
	`d©a_add_ªÆ
 (
	`√w_©åibuã
 (
obj_node
, "abstract_font_height"),

2194 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
);

2195 
	`d©a_add_ªÆ
 (
	`√w_©åibuã
 (
obj_node
, "classname_font_height"),

2196 
°ru˘˛ass
->
˛as¢ame_f⁄t_height
);

2197 
	`d©a_add_ªÆ
 (
	`√w_©åibuã
 (
obj_node
, "abstract_classname_font_height"),

2198 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t_height
);

2199 
	`d©a_add_ªÆ
 (
	`√w_©åibuã
 (
obj_node
, "comment_font_height"),

2200 
°ru˘˛ass
->
commít_f⁄t_height
);

2203 
©å_node
 = 
	`√w_©åibuã
(
obj_node
, "attributes");

2204 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

2205 
li°
 !
NULL
) {

2206 
©å
 = (
STRUCTAâribuã
 *Ë
li°
->
d©a
;

2207 
	`°ru˘_©åibuã_wrôe
(
©å_node
, 
©å
);

2208 
li°
 = 
	`g_li°_√xt
(list);

2212 
©å_node
 = 
	`√w_©åibuã
(
obj_node
, "operations");

2213 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

2214 
li°
 !
NULL
) {

2215 
›
 = (
STRUCTO≥øti⁄
 *Ë
li°
->
d©a
;

2216 
	`°ru˘_›î©i⁄_wrôe
(
©å_node
, 
›
);

2217 
li°
 = 
	`g_li°_√xt
(list);

2221 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "template"),

2222 
°ru˘˛ass
->
ãm∂©e
);

2224 
©å_node
 = 
	`√w_©åibuã
(
obj_node
, "templates");

2225 
li°
 = 
°ru˘˛ass
->
f‹mÆ_∑øms
;

2226 
li°
 !
NULL
) {

2227 
f‹mÆ_∑øm
 = (
STRUCTF‹mÆP¨amëî
 *Ë
li°
->
d©a
;

2228 
	`°ru˘_f‹mÆ∑ømëî_wrôe
(
©å_node
, 
f‹mÆ_∑øm
);

2229 
li°
 = 
	`g_li°_√xt
(list);

2231 
	}
}

2233 
DüObje˘
 *
	$°ru˘˛ass_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
,

2234 c⁄° *
fûíame
)

2236 
STRUCTCœss
 *
°ru˘˛ass
;

2237 
EÀmít
 *
ñem
;

2238 
DüObje˘
 *
obj
;

2239 
AâribuãNode
 
©å_node
;

2240 
i
;

2241 
GLi°
 *
li°
;

2245 
°ru˘˛ass
 = 
	`g_mÆloc0
((
STRUCTCœss
));

2247 
ñem
 = &
°ru˘˛ass
->
ñemít
;

2248 
obj
 = &
ñem
->
obje˘
;

2250 
obj
->
ty≥
 = &
°ru˘˛ass_ty≥
;

2251 
obj
->
›s
 = &
°ru˘˛ass_›s
;

2253 
	`ñemít_lﬂd
(
ñem
, 
obj_node
);

2255 #ifde‡
STRUCT_MAINPOINT


2256 
	`ñemít_öô
(
ñem
, 8, 
STRUCTCLASS_CONNECTIONPOINTS
 + 1);

2258 
	`ñemít_öô
(
ñem
, 8, 
STRUCTCLASS_CONNECTIONPOINTS
);

2261 
°ru˘˛ass
->
¥›îtõs_dülog
 = 
NULL
;

2263 
i
=0;i<
STRUCTCLASS_CONNECTIONPOINTS
;i++) {

2264 
obj
->
c⁄√˘i⁄s
[
i
] = &
°ru˘˛ass
->connections[i];

2265 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

2266 
°ru˘˛ass
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

2269 
	`fûl_ö_f⁄td©a
(
°ru˘˛ass
);

2272 
	`obje˘_lﬂd_¥›s
(
obj
,
obj_node
);

2281 
°ru˘˛ass
->
wøp_›î©i⁄s
 = 
FALSE
;

2282 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "wrap_operations");

2283 i‡(
©å_node
 !
NULL
)

2284 
°ru˘˛ass
->
wøp_›î©i⁄s
 = 
	`d©a_boﬁón
(
	`©åibuã_fú°_d©a
(
©å_node
));

2286 
°ru˘˛ass
->
wøp_a·î_ch¨
 = 
STRUCTCLASS_WRAP_AFTER_CHAR
;

2287 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "wrap_after_char");

2288 i‡(
©å_node
 !
NULL
)

2289 
°ru˘˛ass
->
wøp_a·î_ch¨
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å_node
));

2292 
°ru˘˛ass
->
commít_löe_Àngth
 = 
STRUCTCLASS_COMMENT_LINE_LENGTH
;

2293 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
,"comment_line_length");

2295 i‡(
©å_node
 =
NULL
)

2296 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
,"Comment_line_length");

2297 i‡(
©å_node
 !
NULL
)

2298 
°ru˘˛ass
->
commít_löe_Àngth
 = 
	`d©a_öt
(
	`©åibuã_fú°_d©a
(
©å_node
));

2301 
°ru˘˛ass
->
commít_èggög
 = (
©å_node
 !
NULL
);

2302 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "comment_tagging");

2303 i‡(
©å_node
 !
NULL
)

2304 
°ru˘˛ass
->
commít_èggög
 = 
	`d©a_boﬁón
(
	`©åibuã_fú°_d©a
(
©å_node
));

2307 
°ru˘˛ass
->
löe_width
 = 
STRUCTCLASS_BORDER
;

2308 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

2309 if(
©å_node
 !
NULL
)

2310 
°ru˘˛ass
->
löe_width
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å_node
));

2312 
°ru˘˛ass
->
löe_cﬁ‹
 = 
cﬁ‹_bœck
;

2314 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "foreground_color");

2315 if(
©å_node
 !
NULL
)

2316 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å_node
), &
°ru˘˛ass
->
löe_cﬁ‹
);

2317 
°ru˘˛ass
->
ãxt_cﬁ‹
 = såu˘˛ass->
löe_cﬁ‹
;

2319 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_color");

2320 if(
©å_node
 !
NULL
)

2321 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å_node
), &
°ru˘˛ass
->
löe_cﬁ‹
);

2322 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "text_color");

2323 if(
©å_node
 !
NULL
)

2324 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å_node
), &
°ru˘˛ass
->
ãxt_cﬁ‹
);

2326 
°ru˘˛ass
->
fûl_cﬁ‹
 = 
cﬁ‹_whôe
;

2328 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "background_color");

2329 if(
©å_node
 !
NULL
)

2330 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å_node
), &
°ru˘˛ass
->
fûl_cﬁ‹
);

2332 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "fill_color");

2333 if(
©å_node
 !
NULL
)

2334 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å_node
), &
°ru˘˛ass
->
fûl_cﬁ‹
);

2337 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

2338 
li°
) {

2339 
STRUCTAâribuã
 *
©å
 = 
li°
->
d©a
;

2340 
	`g_as£π
(
©å
);

2342 
	`°ru˘_©åibuã_ísuª_c⁄√˘i⁄_poöts
 (
©å
, 
obj
);

2343 
li°
 = 
	`g_li°_√xt
(list);

2347 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

2348 
li°
) {

2349 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *)
li°
->
d©a
;

2350 
	`g_as£π
(
›
);

2352 
	`°ru˘_›î©i⁄_ísuª_c⁄√˘i⁄_poöts
 (
›
, 
obj
);

2353 
li°
 = 
	`g_li°_√xt
(list);

2357 
°ru˘˛ass
->
ãm∂©e
 = 
FALSE
;

2358 
©å_node
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "template");

2359 i‡(
©å_node
 !
NULL
)

2360 
°ru˘˛ass
->
ãm∂©e
 = 
	`d©a_boﬁón
(
	`©åibuã_fú°_d©a
(
©å_node
));

2362 
	`fûl_ö_f⁄td©a
(
°ru˘˛ass
);

2364 
°ru˘˛ass
->
°îeŸy≥_°rög
 = 
NULL
;

2366 
	`°ru˘˛ass_ˇlcuœã_d©a
(
°ru˘˛ass
);

2368 
ñem
->
exåa_•acög
.
b‹dî_å™s
 = 
°ru˘˛ass
->
löe_width
/2.0;

2369 
	`°ru˘˛ass_upd©e_d©a
(
°ru˘˛ass
);

2371 
i
=0;i<8;i++) {

2372 
obj
->
h™dÀs
[
i
]->
ty≥
 = 
HANDLE_NON_MOVABLE
;

2375 #ifde‡
DEBUG


2376 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "Loaded class");

2379  &
°ru˘˛ass
->
ñemít
.
obje˘
;

2380 
	}
}

2386 
	$°ru˘˛ass_num_dy«mic_c⁄√˘i⁄poöts
(
STRUCTCœss
 *
°ru˘˛ass
) {

2387 
num
 = 0;

2388 i‡–(
°ru˘˛ass
->
visibÀ_©åibuãs
) &&

2389 (!
°ru˘˛ass
->
suµªss_©åibuãs
)) {

2390 
GLi°
 *
li°
 = 
°ru˘˛ass
->
©åibuãs
;

2391 
num
 +2 * 
	`g_li°_Àngth
(
li°
);

2394 i‡–(
°ru˘˛ass
->
visibÀ_›î©i⁄s
) &&

2395 (!
°ru˘˛ass
->
suµªss_›î©i⁄s
)) {

2396 
GLi°
 *
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

2397 
num
 +2 * 
	`g_li°_Àngth
(
li°
);

2399  
num
;

2400 
	}
}

2403 
	$°ru˘˛ass_ßnôy_check
(
STRUCTCœss
 *
c
, 
gch¨
 *
msg
)

2405 #ifde‡
STRUCT_MAINPOINT


2406 
num_fixed_c⁄√˘i⁄s
 = 
STRUCTCLASS_CONNECTIONPOINTS
 + 1;

2408 
num_fixed_c⁄√˘i⁄s
 = 
STRUCTCLASS_CONNECTIONPOINTS
;

2410 
DüObje˘
 *
obj
 = (DüObje˘*)
c
;

2411 
GLi°
 *
©ås
;

2412 
i
;

2414 
	`dü_obje˘_ßnôy_check
((
DüObje˘
 *)
c
, 
msg
);

2417 
	`dü_as£π_åue
(
num_fixed_c⁄√˘i⁄s
 + 
	`°ru˘˛ass_num_dy«mic_c⁄√˘i⁄poöts
(
c
)

2418 =
obj
->
num_c⁄√˘i⁄s
,

2420 
msg
, 
c
, 
obj
->
num_c⁄√˘i⁄s
, 
num_fixed_c⁄√˘i⁄s
,

2421 
	`°ru˘˛ass_num_dy«mic_c⁄√˘i⁄poöts
(
c
));

2423 
i
 = 0; i < 
STRUCTCLASS_CONNECTIONPOINTS
; i++) {

2424 
	`dü_as£π_åue
(&
c
->
c⁄√˘i⁄s
[
i
] =
obj
->connections[i],

2426 
msg
, 
c
, 
i
, &c->
c⁄√˘i⁄s
[i], 
obj
->connections[i]);

2429 #ifde‡
STRUCT_MAINPOINT


2430 
	`dü_as£π_åue
(&
c
->
c⁄√˘i⁄s
[
i
] ==

2431 
obj
->
c⁄√˘i⁄s
[
i
 + 
	`°ru˘˛ass_num_dy«mic_c⁄√˘i⁄poöts
(
c
)],

2433 
msg
, 
c
, 
i
, &c->
c⁄√˘i⁄s
[i],

2434 
obj
->
c⁄√˘i⁄s
[
i
 + 
	`°ru˘˛ass_num_dy«mic_c⁄√˘i⁄poöts
(
c
)],

2435 
i
 + 
	`°ru˘˛ass_num_dy«mic_c⁄√˘i⁄poöts
(
c
));

2439 
i
 = 0;

2440 
©ås
 = 
c
->
©åibuãs
;áâr†!
NULL
;áâr†
	`g_li°_√xt
(attrs)) {

2441 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *)
©ås
->
d©a
;

2443 
	`dü_as£π_åue
(
©å
->
«me
 !
NULL
,

2445 
msg
, 
c
, 
i
);

2446 
	`dü_as£π_åue
(
©å
->
ty≥
 !
NULL
,

2448 
msg
, 
c
, 
i
);

2450 
	`dü_as£π_åue
(
©å
->
commít
 !
NULL
,

2452 
msg
, 
c
, 
i
);

2456 i‡(
c
->
visibÀ_©åibuãs
 && !c->
suµªss_©åibuãs
) {

2457 
c⁄n_off£t
 = 
STRUCTCLASS_CONNECTIONPOINTS
 + 2 * 
i
;

2459 
	`dü_as£π_åue
(
©å
->
À·_c⁄√˘i⁄
 !
NULL
,

2461 
msg
, 
c
, 
i
);

2462 
	`dü_as£π_åue
(
©å
->
right_c⁄√˘i⁄
 !
NULL
,

2464 
msg
, 
c
, 
i
);

2466 
	`dü_as£π_åue
(
©å
->
À·_c⁄√˘i⁄
 =
obj
->
c⁄√˘i⁄s
[
c⁄n_off£t
],

2468 
msg
, 
c
, 
i
, 
©å
->
À·_c⁄√˘i⁄
,

2469 
c⁄n_off£t
, 
obj
->
c⁄√˘i⁄s
[conn_offset]);

2470 
	`dü_as£π_åue
(
©å
->
right_c⁄√˘i⁄
 =
obj
->
c⁄√˘i⁄s
[
c⁄n_off£t
 + 1],

2472 
msg
, 
c
, 
i
, 
©å
->
right_c⁄√˘i⁄
,

2473 
c⁄n_off£t
 + 1, 
obj
->
c⁄√˘i⁄s
[conn_offset + 1]);

2474 
i
++;

2478 
	}
}

	@O:\tool\dvs50\objects\Struct\struct_class.h

24 #i‚de‡
CLASS_H


25 
	#CLASS_H


	)

27 
	~"obje˘.h
"

28 
	~"ñemít.h
"

29 
	~"c⁄√˘i⁄poöt.h
"

30 
	~"widgës.h
"

32 
	~"°ru˘.h
"

34 
	#DIA_OBJECT
(
x
Ë(
DüObje˘
*)(x)

	)

38 
	#STRUCTCLASS_CONNECTIONPOINTS
 8

	)

40 
	#STRUCTCLASS_WRAP_AFTER_CHAR
 40

	)

42 
	#STRUCTCLASS_COMMENT_LINE_LENGTH
 40

	)

54 
	#STRUCT_MAINPOINT
 1

	)

61 
_STRUCTCœss
 
	tSTRUCTCœss
;

62 
_STRUCTCœssDülog
 
	tSTRUCTCœssDülog
;

70 
	s_STRUCTCœssDülog
 {

71 
GtkWidgë
 *
	mdülog
;

75 
Fa˘‹ySåu˘IãmAŒ
 *
	mEnumsAndSåu˘s
 ;

76 
GtkWidgë
 *
	mmaöTabÀ
;

77 
Fa˘‹ySåu˘IãmLi°
 *
	m√wVÆue
;

78 
GtkE¡ry
 *
	m˛as¢ame
;

79 
GtkE¡ry
 *
	m°îeŸy≥
;

80 
GtkTextVõw
 *
	mcommít
;

82 
GtkToggÀBuâ⁄
 *
	mab°ø˘_˛ass
;

83 
GtkToggÀBuâ⁄
 *
	m©å_vis
;

84 
GtkToggÀBuâ⁄
 *
	m©å_suµ
;

85 
GtkToggÀBuâ⁄
 *
	m›_vis
;

86 
GtkToggÀBuâ⁄
 *
	m›_suµ
;

87 
GtkToggÀBuâ⁄
 *
	mcommíts_vis
;

88 
GtkToggÀBuâ⁄
 *
	m›_wøp
;

89 
DüF⁄tSñe˘‹
 *
	mn‹mÆ_f⁄t
;

90 
DüF⁄tSñe˘‹
 *
	mab°ø˘_f⁄t
;

91 
DüF⁄tSñe˘‹
 *
	mpﬁym‹phic_f⁄t
;

92 
DüF⁄tSñe˘‹
 *
	m˛as¢ame_f⁄t
;

93 
DüF⁄tSñe˘‹
 *
	mab°ø˘_˛as¢ame_f⁄t
;

94 
DüF⁄tSñe˘‹
 *
	mcommít_f⁄t
;

95 
GtkSpöBuâ⁄
 *
	mn‹mÆ_f⁄t_height
;

96 
GtkSpöBuâ⁄
 *
	mab°ø˘_f⁄t_height
;

97 
GtkSpöBuâ⁄
 *
	mpﬁym‹phic_f⁄t_height
;

98 
GtkSpöBuâ⁄
 *
	m˛as¢ame_f⁄t_height
;

99 
GtkSpöBuâ⁄
 *
	mab°ø˘_˛as¢ame_f⁄t_height
;

100 
GtkSpöBuâ⁄
 *
	mcommít_f⁄t_height
;

101 
GtkSpöBuâ⁄
 *
	mwøp_a·î_ch¨
;

102 
GtkSpöBuâ⁄
 *
	mcommít_löe_Àngth
;

103 
GtkToggÀBuâ⁄
 *
	mcommít_èggög
;

104 
GtkSpöBuâ⁄
 *
	mlöe_width
;

105 
DüCﬁ‹Sñe˘‹
 *
	mãxt_cﬁ‹
;

106 
DüCﬁ‹Sñe˘‹
 *
	mlöe_cﬁ‹
;

107 
DüCﬁ‹Sñe˘‹
 *
	mfûl_cﬁ‹
;

108 
GtkLabñ
 *
	mmax_Àngth_œbñ
;

109 
GtkLabñ
 *
	mCommít_Àngth_œbñ
;

111 
GLi°
 *
	mdisc⁄√˘ed_c⁄√˘i⁄s
;

112 
GLi°
 *
	madded_c⁄√˘i⁄s
;

113 
GLi°
 *
	mdñëed_c⁄√˘i⁄s
;

115 
GtkLi°
 *
	m©åibuãs_li°
;

116 
GtkLi°Iãm
 *
	mcuºít_©å
;

117 
GtkE¡ry
 *
	m©å_«me
;

118 
GtkE¡ry
 *
	m©å_ty≥
;

119 
GtkE¡ry
 *
	m©å_vÆue
;

120 
GtkTextVõw
 *
	m©å_commít
;

121 
GtkMíu
 *
	m©å_visibÀ
;

122 
GtkO±i⁄Míu
 *
	m©å_visibÀ_buâ⁄
;

123 
GtkToggÀBuâ⁄
 *
	m©å_˛ass_sc›e
;

125 
GtkLi°
 *
	m›î©i⁄s_li°
;

126 
GtkLi°Iãm
 *
	mcuºít_›
;

127 
GtkE¡ry
 *
	m›_«me
;

128 
GtkE¡ry
 *
	m›_ty≥
;

129 
GtkE¡ry
 *
	m›_°îeŸy≥
;

130 
GtkTextVõw
 *
	m›_commít
;

132 
GtkMíu
 *
	m›_visibÀ
;

133 
GtkO±i⁄Míu
 *
	m›_visibÀ_buâ⁄
;

134 
GtkToggÀBuâ⁄
 *
	m›_˛ass_sc›e
;

135 
GtkMíu
 *
	m›_öhîô™˚_ty≥
;

136 
GtkO±i⁄Míu
 *
	m›_öhîô™˚_ty≥_buâ⁄
;

137 
GtkToggÀBuâ⁄
 *
	m›_quîy
;

139 
GtkLi°
 *
	m∑ømëîs_li°
;

140 
GtkLi°Iãm
 *
	mcuºít_∑øm
;

141 
GtkE¡ry
 *
	m∑øm_«me
;

142 
GtkE¡ry
 *
	m∑øm_ty≥
;

143 
GtkE¡ry
 *
	m∑øm_vÆue
;

144 
GtkTextVõw
 *
	m∑øm_commít
;

145 
GtkMíu
 *
	m∑øm_köd
;

146 
GtkO±i⁄Míu
 *
	m∑øm_köd_buâ⁄
;

147 
GtkWidgë
 *
	m∑øm_√w_buâ⁄
;

148 
GtkWidgë
 *
	m∑øm_dñëe_buâ⁄
;

149 
GtkWidgë
 *
	m∑øm_up_buâ⁄
;

150 
GtkWidgë
 *
	m∑øm_down_buâ⁄
;

152 
GtkLi°
 *
	mãm∂©es_li°
;

153 
GtkLi°Iãm
 *
	mcuºít_ãm∂
;

154 
GtkToggÀBuâ⁄
 *
	mãm∂_ãm∂©e
;

155 
GtkE¡ry
 *
	mãm∂_«me
;

156 
GtkE¡ry
 *
	mãm∂_ty≥
;

160 
_Fa˘‹yCœssDülog
 
	tFa˘‹yCœssDülog
;

162 
	s_Fa˘‹yCœssDülog
{

163 
GtkWidgë
 *
	mdülog
;

167 
Fa˘‹ySåu˘IãmAŒ
 *
	mEnumsAndSåu˘s
 ;

168 
GtkWidgë
 *
	mmaöTabÀ
;

173 
_Fa˘‹yCœss
 
	tFa˘‹yCœss
;

175 
	s_Fa˘‹yCœss
{

176 
EÀmít
 
	mñemít
;

179 #ifde‡
STRUCT_MAINPOINT


180 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
 + 1];

182 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
];

184 
DüF⁄t
 *
	mn‹mÆ_f⁄t
;

185 
DüF⁄t
 *
	mab°ø˘_f⁄t
;

186 
DüF⁄t
 *
	mpﬁym‹phic_f⁄t
;

187 
DüF⁄t
 *
	m˛as¢ame_f⁄t
;

188 
DüF⁄t
 *
	mab°ø˘_˛as¢ame_f⁄t
;

189 
DüF⁄t
 *
	mcommít_f⁄t
;

191 *
	m«me
;

193 
Cﬁ‹
 
	mlöe_cﬁ‹
;

194 
Cﬁ‹
 
	mfûl_cﬁ‹
;

195 
Cﬁ‹
 
	mãxt_cﬁ‹
;

198 
Fa˘‹yCœssDülog
 *
	m¥›îtõs_dülog
;

204 
gboﬁón
 
	mde°royed
;

214 
	s_STRUCTCœss
 {

215 
EÀmít
 
	mñemít
;

218 #ifde‡
STRUCT_MAINPOINT


219 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
 + 1];

221 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
];

226 
ªÆ
 
	mlöe_width
;

227 
ªÆ
 
	mf⁄t_height
;

228 
ªÆ
 
	mab°ø˘_f⁄t_height
;

229 
ªÆ
 
	mpﬁym‹phic_f⁄t_height
;

230 
ªÆ
 
	m˛as¢ame_f⁄t_height
;

231 
ªÆ
 
	mab°ø˘_˛as¢ame_f⁄t_height
;

232 
ªÆ
 
	mcommít_f⁄t_height
;

234 
DüF⁄t
 *
	mn‹mÆ_f⁄t
;

235 
DüF⁄t
 *
	mab°ø˘_f⁄t
;

236 
DüF⁄t
 *
	mpﬁym‹phic_f⁄t
;

237 
DüF⁄t
 *
	m˛as¢ame_f⁄t
;

238 
DüF⁄t
 *
	mab°ø˘_˛as¢ame_f⁄t
;

239 
DüF⁄t
 *
	mcommít_f⁄t
;

241 *
	m«me
;

242 *
	m°îeŸy≥
;

243 *
	mcommít
;

244 
	mab°ø˘
;

245 
	msuµªss_©åibuãs
;

246 
	msuµªss_›î©i⁄s
;

247 
	mvisibÀ_©åibuãs
;

248 
	mvisibÀ_›î©i⁄s
;

249 
	mvisibÀ_commíts
;

251 
	mwøp_›î©i⁄s
;

252 
	mwøp_a·î_ch¨
;

253 
	mcommít_löe_Àngth
;

254 
	mcommít_èggög
;

256 
Cﬁ‹
 
	mlöe_cﬁ‹
;

257 
Cﬁ‹
 
	mfûl_cﬁ‹
;

258 
Cﬁ‹
 
	mãxt_cﬁ‹
;

261 
GLi°
 *
	m©åibuãs
;

264 
GLi°
 *
	m›î©i⁄s
;

267 
	mãm∂©e
;

269 
GLi°
 *
	mf‹mÆ_∑øms
;

273 
ªÆ
 
	m«mebox_height
;

274 *
	m°îeŸy≥_°rög
;

276 
ªÆ
 
	m©åibuãsbox_height
;

278 
ªÆ
 
	m›î©i⁄sbox_height
;

281 
	mmax_wøµed_löe_width
;

283 
ªÆ
 
	mãm∂©es_height
;

284 
ªÆ
 
	mãm∂©es_width
;

287 
STRUCTCœssDülog
 *
	m¥›îtõs_dülog
;

293 
gboﬁón
 
	mde°royed
;

297 
°ru˘˛ass_dülog_‰ì
 (
STRUCTCœssDülog
 *
dülog
);

298 
GtkWidgë
 *
°ru˘˛ass_gë_¥›îtõs
(
STRUCTCœss
 *
°ru˘˛ass
, 
gboﬁón
 
is_deÁu…
);

299 
Obje˘Ch™ge
 *
°ru˘˛ass_≠∂y_¥›s_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
, 
GtkWidgë
 *
widgë
);

300 
°ru˘˛ass_ˇlcuœã_d©a
(
STRUCTCœss
 *
°ru˘˛ass
);

301 
°ru˘˛ass_upd©e_d©a
(
STRUCTCœss
 *
°ru˘˛ass
);

303 
©åibuãs_upd©e_evít
(
GtkWidgë
 *
widgë
, 
GdkEvítFocus
 *
ev
, 
STRUCTCœss
 *
°ru˘˛ass
);

305 
©åibuãs_upd©e
(
GtkWidgë
 *
widgë
, 
STRUCTCœss
 *
°ru˘˛ass
);

308 
©åibuãs_li°_£À˘i⁄_ch™ged_ˇŒback
(
GtkWidgë
 *
gtkli°
,

309 
STRUCTCœss
 *
°ru˘˛ass
);

311 
°ru˘˛ass_ßnôy_check
(
STRUCTCœss
 *
c
, 
gch¨
 *
msg
);

313 
GtkWidgë
 *

314 
Á˘‹y_gë_¥›îtõs
(
STRUCTCœss
 *
°ru˘˛ass
, 
gboﬁón
 
is_deÁu…
);

316 
Obje˘Ch™ge
 *

317 
Á˘‹y_≠∂e_¥›s_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
, 
GtkWidgë
 *
widgë
);

	@O:\tool\dvs50\objects\Struct\struct_dialog.c

32 #ifde‡
HAVE_CONFIG_H


33 
	~<c⁄fig.h
>

36 
	~<as£π.h
>

37 #unde‡
GTK_DISABLE_DEPRECATED


38 
	~<gtk/gtk.h
>

39 
	~<m©h.h
>

40 
	~<°rög.h
>

42 
	~"obje˘.h
"

43 
	~"objch™ge.h
"

44 
	~"öé.h
"

45 
	~"°ru˘_˛ass.h
"

46 
	~"shìt.h
"

52 
	$°ru˘˛ass_dülog_‰ì
 (
STRUCTCœssDülog
 *
dülog
)

54 
	`g_li°_‰ì
(
dülog
->
dñëed_c⁄√˘i⁄s
);

55 
	`gtk_widgë_de°roy
(
dülog
->dialog);

56 
dülog
->dülog = 
NULL
;

57 
	`gtk_widgë_de°roy
(
dülog
->
maöTabÀ
);

58 
	`g_li°_‰ì
(
dülog
->
EnumsAndSåu˘s
->
íumLi°
);

59 
	`g_li°_‰ì
(
dülog
->
EnumsAndSåu˘s
->
°ru˘Li°
);

61 
	}
}

63 
	s_Disc⁄√˘
 {

64 
C⁄√˘i⁄Poöt
 *
	m˝
;

65 
DüObje˘
 *
	mŸhî_obje˘
;

66 
H™dÀ
 *
	mŸhî_h™dÀ
;

67 } 
	tDisc⁄√˘
;

69 
_STRUCTCœssSèã
 
	tSTRUCTCœssSèã
;

71 
	s_STRUCTCœssSèã
 {

72 
ªÆ
 
	mf⁄t_height
;

73 
ªÆ
 
	mab°ø˘_f⁄t_height
;

74 
ªÆ
 
	mpﬁym‹phic_f⁄t_height
;

75 
ªÆ
 
	m˛as¢ame_f⁄t_height
;

76 
ªÆ
 
	mab°ø˘_˛as¢ame_f⁄t_height
;

77 
ªÆ
 
	mcommít_f⁄t_height
;

79 
DüF⁄t
 *
	mn‹mÆ_f⁄t
;

80 
DüF⁄t
 *
	mab°ø˘_f⁄t
;

81 
DüF⁄t
 *
	mpﬁym‹phic_f⁄t
;

82 
DüF⁄t
 *
	m˛as¢ame_f⁄t
;

83 
DüF⁄t
 *
	mab°ø˘_˛as¢ame_f⁄t
;

84 
DüF⁄t
 *
	mcommít_f⁄t
;

86 *
	m«me
;

87 *
	m°îeŸy≥
;

88 *
	mcommít
;

90 
	mab°ø˘
;

91 
	msuµªss_©åibuãs
;

92 
	msuµªss_›î©i⁄s
;

93 
	mvisibÀ_©åibuãs
;

94 
	mvisibÀ_›î©i⁄s
;

95 
	mvisibÀ_commíts
;

97 
	mwøp_›î©i⁄s
;

98 
	mwøp_a·î_ch¨
;

99 
	mcommít_löe_Àngth
;

100 
	mcommít_èggög
;

102 
ªÆ
 
	mlöe_width
;

103 
Cﬁ‹
 
	mlöe_cﬁ‹
;

104 
Cﬁ‹
 
	mfûl_cﬁ‹
;

105 
Cﬁ‹
 
	mãxt_cﬁ‹
;

108 
GLi°
 *
	m©åibuãs
;

111 
GLi°
 *
	m›î©i⁄s
;

114 
	mãm∂©e
;

115 
GLi°
 *
	mf‹mÆ_∑øms
;

119 
_STRUCTCœssCh™ge
 
	tSTRUCTCœssCh™ge
;

121 
	s_STRUCTCœssCh™ge
 {

122 
Obje˘Ch™ge
 
	mobj_ch™ge
;

124 
STRUCTCœss
 *
	mobj
;

126 
GLi°
 *
	madded_˝
;

127 
GLi°
 *
	mdñëed_˝
;

128 
GLi°
 *
	mdisc⁄√˘ed
;

130 
	m≠∂õd
;

132 
STRUCTCœssSèã
 *
	mßved_°©e
;

135 
STRUCTCœssSèã
 *
°ru˘˛ass_gë_°©e
(
STRUCTCœss
 *
°ru˘˛ass
);

136 
Obje˘Ch™ge
 *
√w_°ru˘˛ass_ch™ge
(
STRUCTCœss
 *
obj
, 
STRUCTCœssSèã
 *
ßved_°©e
,

137 
GLi°
 *
added
, GLi° *
dñëed
,

138 
GLi°
 *
disc⁄√˘ed
);

139 c⁄° 
gch¨
 *
gë_commít
(
GtkTextVõw
 *);

140 
£t_commít
(
GtkTextVõw
 *, 
gch¨
 *);

144 
	$°ru˘˛ass_°‹e_disc⁄√˘s
(
STRUCTCœssDülog
 *
¥›_dülog
,

145 
C⁄√˘i⁄Poöt
 *
˝
)

147 
Disc⁄√˘
 *
dis
;

148 
DüObje˘
 *
c⁄√˘ed_obj
;

149 
GLi°
 *
li°
;

150 
i
;

152 
li°
 = 
˝
->
c⁄√˘ed
;

153 
li°
 !
NULL
) {

154 
c⁄√˘ed_obj
 = (
DüObje˘
 *)
li°
->
d©a
;

156 
i
=0;i<
c⁄√˘ed_obj
->
num_h™dÀs
;i++) {

157 i‡(
c⁄√˘ed_obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 =
˝
) {

158 
dis
 = 
	`g_√w0
(
Disc⁄√˘
, 1);

159 
dis
->
˝
 = cp;

160 
dis
->
Ÿhî_obje˘
 = 
c⁄√˘ed_obj
;

161 
dis
->
Ÿhî_h™dÀ
 = 
c⁄√˘ed_obj
->
h™dÀs
[
i
];

163 
¥›_dülog
->
disc⁄√˘ed_c⁄√˘i⁄s
 =

164 
	`g_li°_¥ïíd
(
¥›_dülog
->
disc⁄√˘ed_c⁄√˘i⁄s
, 
dis
);

167 
li°
 = 
	`g_li°_√xt
(list);

169 
	}
}

179 
	$add_›ti⁄_míu_ôem
(
GtkMíu
 *
míu
, 
gch¨
 *
œbñ
, 
GtkSig«lFunc
 
upd©e_func
,

180 
STRUCTCœss
 *
°ru˘˛ass
, 
gpoöãr
 
u£r_d©a
)

182 
GtkWidgë
 *
míuôem
 = 
	`gtk_míu_ôem_√w_wôh_œbñ
 (
œbñ
);

183 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
míuôem
), "activate",

184 
upd©e_func
, 
°ru˘˛ass
);

185 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
míuôem
), 
u£r_d©a
);

186 
	`gtk_míu_≠≥nd
 (
	`GTK_MENU
 (
míu
), 
míuôem
);

187 
	`gtk_widgë_show
 (
míuôem
);

188 
	}
}

195 
	$˛ass_ªad_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
, 
STRUCTCœssDülog
 *
¥›_dülog
)

197 c⁄° 
gch¨
 *
s
;

199 i‡(
°ru˘˛ass
->
«me
 !
NULL
)

200 
	`g_‰ì
(
°ru˘˛ass
->
«me
);

202 
s
 = 
	`gtk_íåy_gë_ãxt
 (
¥›_dülog
->
˛as¢ame
);

203 i‡(
s
 && s[0])

204 
°ru˘˛ass
->
«me
 = 
	`g_°rdup
 (
s
);

206 
°ru˘˛ass
->
«me
 = 
NULL
;

208 i‡(
°ru˘˛ass
->
°îeŸy≥
 !
NULL
)

209 
	`g_‰ì
(
°ru˘˛ass
->
°îeŸy≥
);

211 
s
 = 
	`gtk_íåy_gë_ãxt
(
¥›_dülog
->
°îeŸy≥
);

212 i‡(
s
 && s[0])

213 
°ru˘˛ass
->
°îeŸy≥
 = 
	`g_°rdup
 (
s
);

215 
°ru˘˛ass
->
°îeŸy≥
 = 
NULL
;

217 i‡(
°ru˘˛ass
->
commít
 !
NULL
)

218 
	`g_‰ì
 (
°ru˘˛ass
->
commít
);

220 
s
 = 
	`gë_commít
(
¥›_dülog
->
commít
);

221 i‡(
s
 && s[0])

222 
°ru˘˛ass
->
commít
 = 
	`g_°rdup
 (
s
);

224 
°ru˘˛ass
->
commít
 = 
NULL
;

226 
°ru˘˛ass
->
ab°ø˘
 = 
¥›_dülog
->
ab°ø˘_˛ass
->
a˘ive
;

227 
°ru˘˛ass
->
visibÀ_©åibuãs
 = 
¥›_dülog
->
©å_vis
->
a˘ive
;

228 
°ru˘˛ass
->
visibÀ_›î©i⁄s
 = 
¥›_dülog
->
›_vis
->
a˘ive
;

229 
°ru˘˛ass
->
wøp_›î©i⁄s
 = 
¥›_dülog
->
›_wøp
->
a˘ive
;

230 
°ru˘˛ass
->
wøp_a·î_ch¨
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_öt
(
¥›_dülog
->wrap_after_char);

231 
°ru˘˛ass
->
commít_löe_Àngth
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_öt
(
¥›_dülog
->comment_line_length);

232 
°ru˘˛ass
->
commít_èggög
 = 
¥›_dülog
->commít_èggög->
a˘ive
;

233 
°ru˘˛ass
->
visibÀ_commíts
 = 
¥›_dülog
->
commíts_vis
->
a˘ive
;

234 
°ru˘˛ass
->
suµªss_©åibuãs
 = 
¥›_dülog
->
©å_suµ
->
a˘ive
;

235 
°ru˘˛ass
->
suµªss_›î©i⁄s
 = 
¥›_dülog
->
›_suµ
->
a˘ive
;

236 
°ru˘˛ass
->
löe_width
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
(
¥›_dülog
->line_width);

237 
	`dü_cﬁ‹_£À˘‹_gë_cﬁ‹
(
	`GTK_WIDGET
(
¥›_dülog
->
ãxt_cﬁ‹
), &
°ru˘˛ass
->text_color);

238 
	`dü_cﬁ‹_£À˘‹_gë_cﬁ‹
(
	`GTK_WIDGET
(
¥›_dülog
->
löe_cﬁ‹
), &
°ru˘˛ass
->line_color);

239 
	`dü_cﬁ‹_£À˘‹_gë_cﬁ‹
(
	`GTK_WIDGET
(
¥›_dülog
->
fûl_cﬁ‹
), &
°ru˘˛ass
->fill_color);

241 
°ru˘˛ass
->
n‹mÆ_f⁄t
 = 
	`dü_f⁄t_£À˘‹_gë_f⁄t
 (
¥›_dülog
->normal_font);

242 
°ru˘˛ass
->
pﬁym‹phic_f⁄t
 = 
	`dü_f⁄t_£À˘‹_gë_f⁄t
 (
¥›_dülog
->polymorphic_font);

243 
°ru˘˛ass
->
ab°ø˘_f⁄t
 = 
	`dü_f⁄t_£À˘‹_gë_f⁄t
 (
¥›_dülog
->abstract_font);

244 
°ru˘˛ass
->
˛as¢ame_f⁄t
 = 
	`dü_f⁄t_£À˘‹_gë_f⁄t
 (
¥›_dülog
->classname_font);

245 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
 = 
	`dü_f⁄t_£À˘‹_gë_f⁄t
 (
¥›_dülog
->abstract_classname_font);

246 
°ru˘˛ass
->
commít_f⁄t
 = 
	`dü_f⁄t_£À˘‹_gë_f⁄t
 (
¥›_dülog
->comment_font);

248 
°ru˘˛ass
->
f⁄t_height
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
 (
¥›_dülog
->
n‹mÆ_f⁄t_height
);

249 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
 (
¥›_dülog
->abstract_font_height);

250 
°ru˘˛ass
->
pﬁym‹phic_f⁄t_height
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
 (
¥›_dülog
->polymorphic_font_height);

251 
°ru˘˛ass
->
˛as¢ame_f⁄t_height
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
 (
¥›_dülog
->classname_font_height);

252 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t_height
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
 (
¥›_dülog
->abstract_classname_font_height);

253 
°ru˘˛ass
->
commít_f⁄t_height
 = 
	`gtk_•ö_buâ⁄_gë_vÆue_as_Êﬂt
 (
¥›_dülog
->comment_font_height);

254 
	}
}

257 
	$˛ass_fûl_ö_dülog
(
STRUCTCœss
 *
°ru˘˛ass
)

259 
STRUCTCœssDülog
 *
¥›_dülog
;

261 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

263 i‡(
°ru˘˛ass
->
«me
)

264 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
˛as¢ame
, 
°ru˘˛ass
->
«me
);

265 i‡(
°ru˘˛ass
->
°îeŸy≥
 !
NULL
)

266 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
°îeŸy≥
, 
°ru˘˛ass
->stereotype);

268 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
°îeŸy≥
, "");

270 i‡(
°ru˘˛ass
->
commít
 !
NULL
)

271 
	`£t_commít
(
¥›_dülog
->
commít
, 
°ru˘˛ass
->comment);

273 
	`£t_commít
(
¥›_dülog
->
commít
, "");

275 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
ab°ø˘_˛ass
, 
°ru˘˛ass
->
ab°ø˘
);

276 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
©å_vis
, 
°ru˘˛ass
->
visibÀ_©åibuãs
);

277 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
›_vis
, 
°ru˘˛ass
->
visibÀ_›î©i⁄s
);

278 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
›_wøp
, 
°ru˘˛ass
->
wøp_›î©i⁄s
);

279 
	`gtk_•ö_buâ⁄_£t_vÆue
 (
¥›_dülog
->
wøp_a·î_ch¨
, 
°ru˘˛ass
->wrap_after_char);

280 
	`gtk_•ö_buâ⁄_£t_vÆue
 (
¥›_dülog
->
commít_löe_Àngth
, 
°ru˘˛ass
->comment_line_length);

281 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
commít_èggög
, 
°ru˘˛ass
->comment_tagging);

282 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
commíts_vis
, 
°ru˘˛ass
->
visibÀ_commíts
);

283 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
©å_suµ
, 
°ru˘˛ass
->
suµªss_©åibuãs
);

284 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
›_suµ
, 
°ru˘˛ass
->
suµªss_›î©i⁄s
);

285 
	`gtk_•ö_buâ⁄_£t_vÆue
 (
¥›_dülog
->
löe_width
, 
°ru˘˛ass
->line_width);

286 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
	`GTK_WIDGET
(
¥›_dülog
->
ãxt_cﬁ‹
), &
°ru˘˛ass
->text_color);

287 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
	`GTK_WIDGET
(
¥›_dülog
->
löe_cﬁ‹
), &
°ru˘˛ass
->line_color);

288 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
	`GTK_WIDGET
(
¥›_dülog
->
fûl_cﬁ‹
), &
°ru˘˛ass
->fill_color);

289 
	`dü_f⁄t_£À˘‹_£t_f⁄t
 (
¥›_dülog
->
n‹mÆ_f⁄t
, 
°ru˘˛ass
->normal_font);

290 
	`dü_f⁄t_£À˘‹_£t_f⁄t
 (
¥›_dülog
->
pﬁym‹phic_f⁄t
, 
°ru˘˛ass
->polymorphic_font);

291 
	`dü_f⁄t_£À˘‹_£t_f⁄t
 (
¥›_dülog
->
ab°ø˘_f⁄t
, 
°ru˘˛ass
->abstract_font);

292 
	`dü_f⁄t_£À˘‹_£t_f⁄t
 (
¥›_dülog
->
˛as¢ame_f⁄t
, 
°ru˘˛ass
->classname_font);

293 
	`dü_f⁄t_£À˘‹_£t_f⁄t
 (
¥›_dülog
->
ab°ø˘_˛as¢ame_f⁄t
, 
°ru˘˛ass
->abstract_classname_font);

294 
	`dü_f⁄t_£À˘‹_£t_f⁄t
 (
¥›_dülog
->
commít_f⁄t
, 
°ru˘˛ass
->comment_font);

295 
	`gtk_•ö_buâ⁄_£t_vÆue
 (
¥›_dülog
->
n‹mÆ_f⁄t_height
, 
°ru˘˛ass
->
f⁄t_height
);

296 
	`gtk_•ö_buâ⁄_£t_vÆue
 (
¥›_dülog
->
pﬁym‹phic_f⁄t_height
, 
°ru˘˛ass
->polymorphic_font_height);

297 
	`gtk_•ö_buâ⁄_£t_vÆue
 (
¥›_dülog
->
ab°ø˘_f⁄t_height
, 
°ru˘˛ass
->abstract_font_height);

298 
	`gtk_•ö_buâ⁄_£t_vÆue
 (
¥›_dülog
->
˛as¢ame_f⁄t_height
, 
°ru˘˛ass
->classname_font_height);

299 
	`gtk_•ö_buâ⁄_£t_vÆue
 (
¥›_dülog
->
ab°ø˘_˛as¢ame_f⁄t_height
, 
°ru˘˛ass
->abstract_classname_font_height);

300 
	`gtk_•ö_buâ⁄_£t_vÆue
 (
¥›_dülog
->
commít_f⁄t_height
, 
°ru˘˛ass
->comment_font_height);

301 
	}
}

304 
	$¸óã_f⁄t_¥›s_row
 (
GtkTabÀ
 *
èbÀ
,

305 c⁄° *
köd
,

306 
göt
 
row
,

307 
DüF⁄t
 *
f⁄t
,

308 
ªÆ
 
height
,

309 
DüF⁄tSñe˘‹
 **
f⁄t£l
,

310 
GtkSpöBuâ⁄
 **
height£l
)

312 
GtkWidgë
 *
œbñ
;

313 
GtkObje˘
 *
adj
;

315 
œbñ
 = 
	`gtk_œbñ_√w
 (
köd
);

316 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

317 
	`gtk_èbÀ_©èch_deÁu…s
 (
èbÀ
, 
œbñ
, 0, 1, 
row
,Ñow+1);

318 *
f⁄t£l
 = 
	`DIAFONTSELECTOR
 (
	`dü_f⁄t_£À˘‹_√w
 ());

319 
	`dü_f⁄t_£À˘‹_£t_f⁄t
 (
	`DIAFONTSELECTOR
 (*
f⁄t£l
), 
f⁄t
);

320 
	`gtk_èbÀ_©èch_deÁu…s
 (
	`GTK_TABLE
 (
èbÀ
), 
	`GTK_WIDGET
(*
f⁄t£l
), 1, 2, 
row
,Ñow+1);

322 
adj
 = 
	`gtk_adju°mít_√w
 (
height
, 0.1, 10.0, 0.1, 1.0, 0);

323 *
height£l
 = 
	`GTK_SPIN_BUTTON
 (
	`gtk_•ö_buâ⁄_√w
 (
	`GTK_ADJUSTMENT
(
adj
), 1.0, 2));

324 
	`gtk_•ö_buâ⁄_£t_numîic
 (
	`GTK_SPIN_BUTTON
 (*
height£l
), 
TRUE
);

325 
	`gtk_èbÀ_©èch_deÁu…s
 (
èbÀ
, 
	`GTK_WIDGET
 (*
height£l
), 2, 3, 
row
,Ñow+1);

326 
	}
}

331 
	$Á˘‹y_¸óã_°ru˘_dülog
(
STRUCTCœssDülog
 *
dülog
, 
Fa˘‹ySåu˘Iãm
 *
ôem
,
row
 )

333 
GtkWidgë
 *
ôemName
;

334 
GtkWidgë
 *
cﬁumTwo
;

335 
GtkToﬁtùs
 *
toﬁ_tùs
;

336 
toﬁ_tùs
 = 
	`gtk_toﬁtùs_√w
();

337 
GLi°
 *
íumLi°
 = 
dülog
->
EnumsAndSåu˘s
->enumList;

338 
gboﬁón
 
isEnum
 = 
FALSE
;

339 ;
íumLi°
 !
NULL
;ÉnumLi° =ÉnumLi°->
√xt
)

342 
Fa˘‹ySåu˘EnumLi°
 *
f£t
 = 
íumLi°
->
d©a
;

343 
gch¨
 **
•lô
 = 
	`g_°r•lô
(
ôem
->
ôemTy≥
,".",-1);

344 
£˘i⁄
 = 
	`g_°rv_Àngth
(
•lô
);

345 if(!
	`g_ascii_°∫ˇ£cmp
(
•lô
[
£˘i⁄
-1],
f£t
->
«me
,
	`°æí
(
ôem
->
ôemTy≥
)))

347 
isEnum
 = 
TRUE
;

348 
cﬁumTwo
 = 
	`gtk_combo_box_√w_ãxt
();

349 
	`gtk_combo_box_p›down
(
	`GTK_COMBO_BOX
(
cﬁumTwo
));

351 
GLi°
 *
ãnum
 = 
f£t
->
li°
;

352 ;
ãnum
 !
NULL
;Åíum =Åíum->
√xt
)

354 
Fa˘‹ySåu˘Enum
 *
o
 = 
ãnum
->
d©a
;

355 
	`gtk_combo_box_≠≥nd_ãxt
(
	`GTK_COMBO_BOX
(
cﬁumTwo
),
o
->
key
);

357 
	`gtk_combo_box_£t_a˘ive
(
	`GTK_COMBO_BOX
(
cﬁumTwo
),0);

360 
	`g_°r‰ìv
(
•lô
);

364 if(!
isEnum
)

366 
cﬁumTwo
 = 
	`gtk_íåy_√w
();

367 
	`gtk_íåy_£t_ãxt
(
	`GTK_ENTRY
(
cﬁumTwo
),
ôem
->
ôemVÆue
);

370 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
,
cﬁumTwo
,
	`_
(
ôem
->
ôemCommít
),
NULL
);

372 
ôemName
 = 
	`gtk_œbñ_√w
(
ôem
->
ôemC«me
);

373 
	`gtk_toﬁtùs_£t_tù
(
toﬁ_tùs
,
ôemName
,
	`_
(
ôem
->
ôemCommít
),
NULL
);

374 if–
row
 == 0 || !(row % 2 ))

376 
	`gtk_èbÀ_©èch_deÁu…s
(
	`GTK_TABLE
(
dülog
->
maöTabÀ
),
ôemName
,0,1,
row
,row+1);

377 
	`gtk_èbÀ_©èch_deÁu…s
(
	`GTK_TABLE
(
dülog
->
maöTabÀ
),
cﬁumTwo
,1,2,
row
,row+1);

380 
	`gtk_èbÀ_©èch_deÁu…s
(
	`GTK_TABLE
(
dülog
->
maöTabÀ
),
ôemName
,2,3,
row
-1,row);

381 
	`gtk_èbÀ_©èch_deÁu…s
(
	`GTK_TABLE
(
dülog
->
maöTabÀ
),
cﬁumTwo
,3,4,
row
-1,row);

383 
	`gtk_c⁄èöî_add
(
	`GTK_OBJECT
(
dülog
->dülog),dülog->
maöTabÀ
);

384 
	}
}

390 
	$˛ass_¸óã_∑ge
(
GtkNŸebook
 *
nŸebook
, 
STRUCTCœss
 *
°ru˘˛ass
)

392 
STRUCTCœssDülog
 *
¥›_dülog
;

393 
GtkWidgë
 *
∑ge_œbñ
;

394 
GtkWidgë
 *
œbñ
;

395 
GtkWidgë
 *
hbox
;

396 
GtkWidgë
 *
hbox2
;

397 
GtkWidgë
 *
vbox
;

398 
GtkWidgë
 *
íåy
;

399 
GtkWidgë
 *
s¸ﬁÀdwödow
;

400 
GtkWidgë
 *
checkbox
;

401 
GtkWidgë
 *
èbÀ
;

402 
GtkObje˘
 *
adj
;

404 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

407 
∑ge_œbñ
 = 
	`gtk_œbñ_√w_wôh_m√m⁄ic
 (
	`_
("_Class"));

409 
vbox
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

410 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox
), 10);

412 
èbÀ
 = 
	`gtk_èbÀ_√w
 (3, 2, 
FALSE
);

413 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
èbÀ
, 
FALSE
, FALSE, 0);

415 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("ClassÇame:"));

416 
íåy
 = 
	`gtk_íåy_√w
();

417 
¥›_dülog
->
˛as¢ame
 = 
	`GTK_ENTRY
(
íåy
);

418 
	`gtk_widgë_gøb_focus
(
íåy
);

419 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

420 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,0,1, 
GTK_FILL
,0, 0,0);

421 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,0,1, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

423 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Stereotype:"));

424 
íåy
 = 
	`gtk_íåy_√w
();

425 
¥›_dülog
->
°îeŸy≥
 = 
	`GTK_ENTRY
(
íåy
);

426 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

427 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,1,2, 
GTK_FILL
,0, 0,0);

428 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,1,2, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

430 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Comment:"));

431 
s¸ﬁÀdwödow
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

432 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
s¸ﬁÀdwödow
, 1, 2, 2, 3,

433 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
),

434 (
GtkAâachO±i⁄s
Ë(
GTK_FILL
), 0, 0);

435 
	`gtk_s¸ﬁÀd_wödow_£t_shadow_ty≥
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀdwödow
),

436 
GTK_SHADOW_IN
);

437 
íåy
 = 
	`gtk_ãxt_võw_√w
 ();

438 
¥›_dülog
->
commít
 = 
	`GTK_TEXT_VIEW
(
íåy
);

439 
	`gtk_ãxt_võw_£t_wøp_mode
 (
	`GTK_TEXT_VIEW
 (
íåy
), 
GTK_WRAP_WORD
);

441 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

442 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,2,3, 
GTK_FILL
,0, 0,0);

443 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
s¸ﬁÀdwödow
), 
íåy
);

445 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

446 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Abstract"));

447 
¥›_dülog
->
ab°ø˘_˛ass
 = 
	`GTK_TOGGLE_BUTTON
–
checkbox
 );

448 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
checkbox
, 
TRUE
, TRUE, 0);

449 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, 
TRUE
, 0);

451 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

452 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Attributes visible"));

453 
¥›_dülog
->
©å_vis
 = 
	`GTK_TOGGLE_BUTTON
–
checkbox
 );

454 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
checkbox
, 
TRUE
, TRUE, 0);

455 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Suppress Attributes"));

456 
¥›_dülog
->
©å_suµ
 = 
	`GTK_TOGGLE_BUTTON
–
checkbox
 );

457 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
checkbox
, 
TRUE
, TRUE, 0);

458 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, 
TRUE
, 0);

460 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

461 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Operations visible"));

462 
¥›_dülog
->
›_vis
 = 
	`GTK_TOGGLE_BUTTON
–
checkbox
 );

463 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
checkbox
, 
TRUE
, TRUE, 0);

464 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Suppress operations"));

465 
¥›_dülog
->
›_suµ
 = 
	`GTK_TOGGLE_BUTTON
–
checkbox
 );

466 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
checkbox
, 
TRUE
, TRUE, 0);

467 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, 
TRUE
, 0);

469 
hbox
 = 
	`gtk_hbox_√w
(
TRUE
, 5);

470 
hbox2
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

471 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Wrap Operations"));

472 
¥›_dülog
->
›_wøp
 = 
	`GTK_TOGGLE_BUTTON
–
checkbox
 );

473 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
checkbox
, 
TRUE
, TRUE, 0);

474 
adj
 = 
	`gtk_adju°mít_√w
–
°ru˘˛ass
->
wøp_a·î_ch¨
, 0.0, 200.0, 1.0, 5.0, 0);

475 
¥›_dülog
->
wøp_a·î_ch¨
 = 
	`GTK_SPIN_BUTTON
(
	`gtk_•ö_buâ⁄_√w
–
	`GTK_ADJUSTMENT
–
adj
), 0.1, 0));

476 
	`gtk_•ö_buâ⁄_£t_numîic
–
	`GTK_SPIN_BUTTON
–
¥›_dülog
->
wøp_a·î_ch¨
), 
TRUE
);

477 
	`gtk_•ö_buâ⁄_£t_¢≠_to_ticks
–
	`GTK_SPIN_BUTTON
–
¥›_dülog
->
wøp_a·î_ch¨
), 
TRUE
);

478 
¥›_dülog
->
max_Àngth_œbñ
 = 
	`GTK_LABEL
–
	`gtk_œbñ_√w
–
	`_
("WrapáfterÅhisÜength: ")));

479 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox2
), 
	`GTK_WIDGET
–
¥›_dülog
->
max_Àngth_œbñ
), 
FALSE
, 
TRUE
, 0);

480 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox2
), 
	`GTK_WIDGET
–
¥›_dülog
->
wøp_a·î_ch¨
), 
TRUE
, TRUE, 0);

481 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
	`GTK_WIDGET
–
hbox2
), 
TRUE
, TRUE, 0);

482 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, 
TRUE
, 0);

484 
hbox
 = 
	`gtk_hbox_√w
(
TRUE
, 5);

485 
hbox2
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

486 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Comments visible"));

487 
¥›_dülog
->
commíts_vis
 = 
	`GTK_TOGGLE_BUTTON
–
checkbox
 );

488 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
checkbox
, 
TRUE
, TRUE, 0);

489 
adj
 = 
	`gtk_adju°mít_√w
–
°ru˘˛ass
->
commít_löe_Àngth
, 17.0, 200.0, 1.0, 5.0, 0);

490 
¥›_dülog
->
commít_löe_Àngth
 = 
	`GTK_SPIN_BUTTON
(
	`gtk_•ö_buâ⁄_√w
–
	`GTK_ADJUSTMENT
–
adj
), 0.1, 0));

491 
	`gtk_•ö_buâ⁄_£t_numîic
–
	`GTK_SPIN_BUTTON
–
¥›_dülog
->
commít_löe_Àngth
), 
TRUE
);

492 
	`gtk_•ö_buâ⁄_£t_¢≠_to_ticks
–
	`GTK_SPIN_BUTTON
–
¥›_dülog
->
commít_löe_Àngth
), 
TRUE
);

493 
¥›_dülog
->
Commít_Àngth_œbñ
 = 
	`GTK_LABEL
–
	`gtk_œbñ_√w
–
	`_
("Wrap commentáfterÅhisÜength: ")));

494 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox2
), 
	`GTK_WIDGET
–
¥›_dülog
->
Commít_Àngth_œbñ
), 
FALSE
, 
TRUE
, 0);

495 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox2
), 
	`GTK_WIDGET
–
¥›_dülog
->
commít_löe_Àngth
), 
TRUE
, TRUE, 0);

496 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
	`GTK_WIDGET
–
hbox2
), 
TRUE
, TRUE, 0);

497 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, 
TRUE
, 0);

499 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

500 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Show documentationÅag111111"));

501 
¥›_dülog
->
commít_èggög
 = 
	`GTK_TOGGLE_BUTTON
–
checkbox
 );

502 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
checkbox
, 
TRUE
, TRUE, 0);

503 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, 
TRUE
, 0);

505 
	`gtk_widgë_show_Æl
 (
vbox
);

506 
	`gtk_widgë_show
 (
∑ge_œbñ
);

507 
	`gtk_nŸebook_≠≥nd_∑ge
(
nŸebook
, 
vbox
, 
∑ge_œbñ
);

509 
	}
}

513 
	$°yÀ_¸óã_∑ge
(
GtkNŸebook
 *
nŸebook
, 
STRUCTCœss
 *
°ru˘˛ass
)

515 
STRUCTCœssDülog
 *
¥›_dülog
;

516 
GtkWidgë
 *
∑ge_œbñ
;

517 
GtkWidgë
 *
œbñ
;

518 
GtkWidgë
 *
vbox
;

519 
GtkWidgë
 *
löe_width
;

520 
GtkWidgë
 *
ãxt_cﬁ‹
;

521 
GtkWidgë
 *
fûl_cﬁ‹
;

522 
GtkWidgë
 *
löe_cﬁ‹
;

523 
GtkWidgë
 *
èbÀ
;

524 
GtkObje˘
 *
adj
;

526 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

529 
∑ge_œbñ
 = 
	`gtk_œbñ_√w_wôh_m√m⁄ic
 (
	`_
("_Style"));

531 
vbox
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

532 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox
), 10);

534 
èbÀ
 = 
	`gtk_èbÀ_√w
 (5, 6, 
TRUE
);

535 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
èbÀ
, 
FALSE
, 
TRUE
, 0);

536 
	`gtk_èbÀ_£t_homogíeous
 (
	`GTK_TABLE
 (
èbÀ
), 
FALSE
);

539 
œbñ
 = 
	`gtk_œbñ_√w
 (
	`_
("Kind"));

541 
	`gtk_èbÀ_©èch_deÁu…s
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0, 1, 0, 1);

542 
œbñ
 = 
	`gtk_œbñ_√w
 (
	`_
("Font"));

543 
	`gtk_èbÀ_©èch_deÁu…s
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 1, 2, 0, 1);

544 
œbñ
 = 
	`gtk_œbñ_√w
 (
	`_
("Size"));

545 
	`gtk_èbÀ_©èch_deÁu…s
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 2, 3, 0, 1);

548 
	`¸óã_f⁄t_¥›s_row
 (
	`GTK_TABLE
 (
èbÀ
), 
	`_
("Normal"), 1,

549 
°ru˘˛ass
->
n‹mÆ_f⁄t
,

550 
°ru˘˛ass
->
f⁄t_height
,

551 &(
¥›_dülog
->
n‹mÆ_f⁄t
),

552 &(
¥›_dülog
->
n‹mÆ_f⁄t_height
));

553 
	`¸óã_f⁄t_¥›s_row
 (
	`GTK_TABLE
 (
èbÀ
), 
	`_
("Polymorphic"), 2,

554 
°ru˘˛ass
->
pﬁym‹phic_f⁄t
,

555 
°ru˘˛ass
->
pﬁym‹phic_f⁄t_height
,

556 &(
¥›_dülog
->
pﬁym‹phic_f⁄t
),

557 &(
¥›_dülog
->
pﬁym‹phic_f⁄t_height
));

558 
	`¸óã_f⁄t_¥›s_row
 (
	`GTK_TABLE
 (
èbÀ
), 
	`_
("Abstract"), 3,

559 
°ru˘˛ass
->
ab°ø˘_f⁄t
,

560 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
,

561 &(
¥›_dülog
->
ab°ø˘_f⁄t
),

562 &(
¥›_dülog
->
ab°ø˘_f⁄t_height
));

563 
	`¸óã_f⁄t_¥›s_row
 (
	`GTK_TABLE
 (
èbÀ
), 
	`_
("Class Name"), 4,

564 
°ru˘˛ass
->
˛as¢ame_f⁄t
,

565 
°ru˘˛ass
->
˛as¢ame_f⁄t_height
,

566 &(
¥›_dülog
->
˛as¢ame_f⁄t
),

567 &(
¥›_dülog
->
˛as¢ame_f⁄t_height
));

568 
	`¸óã_f⁄t_¥›s_row
 (
	`GTK_TABLE
 (
èbÀ
), 
	`_
("Abstract Class"), 5,

569 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
,

570 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t_height
,

571 &(
¥›_dülog
->
ab°ø˘_˛as¢ame_f⁄t
),

572 &(
¥›_dülog
->
ab°ø˘_˛as¢ame_f⁄t_height
));

573 
	`¸óã_f⁄t_¥›s_row
 (
	`GTK_TABLE
 (
èbÀ
), 
	`_
("Comment"), 6,

574 
°ru˘˛ass
->
commít_f⁄t
,

575 
°ru˘˛ass
->
commít_f⁄t_height
,

576 &(
¥›_dülog
->
commít_f⁄t
),

577 &(
¥›_dülog
->
commít_f⁄t_height
));

581 
èbÀ
 = 
	`gtk_èbÀ_√w
 (2, 4, 
TRUE
);

582 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
),

583 
èbÀ
, 
FALSE
, 
TRUE
, 0);

585 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Line Width"));

586 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

587 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0, 1, 0, 1, 
GTK_EXPAND
 | 
GTK_FILL
, 0, 0, 2);

588 
adj
 = 
	`gtk_adju°mít_√w
(
°ru˘˛ass
->
löe_width
, 0.0, 
G_MAXFLOAT
, 0.1, 1.0, 0);

589 
löe_width
 = 
	`gtk_•ö_buâ⁄_√w
 (
	`GTK_ADJUSTMENT
(
adj
), 1.0, 2);

590 
	`gtk_•ö_buâ⁄_£t_numîic
 (
	`GTK_SPIN_BUTTON
 (
löe_width
), 
TRUE
);

591 
¥›_dülog
->
löe_width
 = 
	`GTK_SPIN_BUTTON
(line_width);

592 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
löe_width
, 1, 2, 0, 1, 
GTK_EXPAND
 | 
GTK_FILL
, 0, 3, 2);

594 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Text Color"));

595 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

596 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0, 1, 1, 2, 
GTK_EXPAND
 | 
GTK_FILL
, 0, 0, 2);

597 
ãxt_cﬁ‹
 = 
	`dü_cﬁ‹_£À˘‹_√w
();

598 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
ãxt_cﬁ‹
, &
°ru˘˛ass
->text_color);

599 
¥›_dülog
->
ãxt_cﬁ‹
 = (
DüCﬁ‹Sñe˘‹
 *)text_color;

600 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
ãxt_cﬁ‹
, 1, 2, 1, 2, 
GTK_EXPAND
 | 
GTK_FILL
, 0, 3, 2);

602 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Foreground Color"));

603 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

604 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0, 1, 2, 3, 
GTK_EXPAND
 | 
GTK_FILL
, 0, 0, 2);

605 
löe_cﬁ‹
 = 
	`dü_cﬁ‹_£À˘‹_√w
();

606 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
löe_cﬁ‹
, &
°ru˘˛ass
->line_color);

607 
¥›_dülog
->
löe_cﬁ‹
 = (
DüCﬁ‹Sñe˘‹
 *)line_color;

608 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
löe_cﬁ‹
, 1, 2, 2, 3, 
GTK_EXPAND
 | 
GTK_FILL
, 0, 3, 2);

610 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Background Color"));

611 
	`gtk_misc_£t_Æignmít
(
	`GTK_MISC
(
œbñ
), 0.0, 0.5);

612 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0, 1, 3, 4, 
GTK_EXPAND
 | 
GTK_FILL
, 0, 0, 2);

613 
fûl_cﬁ‹
 = 
	`dü_cﬁ‹_£À˘‹_√w
();

614 
	`dü_cﬁ‹_£À˘‹_£t_cﬁ‹
(
fûl_cﬁ‹
, &
°ru˘˛ass
->fill_color);

615 
¥›_dülog
->
fûl_cﬁ‹
 = (
DüCﬁ‹Sñe˘‹
 *)fill_color;

616 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
fûl_cﬁ‹
, 1, 2, 3, 4, 
GTK_EXPAND
 | 
GTK_FILL
, 0, 3, 2);

618 
	`gtk_widgë_show_Æl
 (
vbox
);

619 
	`gtk_widgë_show
 (
∑ge_œbñ
);

620 
	`gtk_nŸebook_≠≥nd_∑ge
(
nŸebook
, 
vbox
, 
∑ge_œbñ
);

622 
	}
}

630 
	$©åibuãs_£t_£nsôive
(
STRUCTCœssDülog
 *
¥›_dülog
, 
göt
 
vÆ
)

632 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
©å_«me
), 
vÆ
);

633 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
©å_ty≥
), 
vÆ
);

634 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
©å_vÆue
), 
vÆ
);

635 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
©å_commít
), 
vÆ
);

636 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
©å_visibÀ_buâ⁄
), 
vÆ
);

637 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
©å_visibÀ
), 
vÆ
);

638 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
©å_˛ass_sc›e
), 
vÆ
);

639 
	}
}

642 
	$©åibuãs_£t_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
, 
STRUCTAâribuã
 *
©å
)

644 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
©å_«me
, 
©å
->
«me
);

645 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
©å_ty≥
, 
©å
->
ty≥
);

646 i‡(
©å
->
vÆue
 !
NULL
)

647 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
©å_vÆue
, 
©å
->
vÆue
);

649 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
©å_vÆue
, "");

651 i‡(
©å
->
commít
 !
NULL
)

652 
	`£t_commít
(
¥›_dülog
->
©å_commít
, 
©å
->
commít
);

654 
	`£t_commít
(
¥›_dülog
->
©å_commít
, "");

657 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
¥›_dülog
->
©å_visibÀ_buâ⁄
,

658 (
göt
)
©å
->
visibûôy
);

659 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
©å_˛ass_sc›e
, 
©å
->
˛ass_sc›e
);

660 
	}
}

663 
	$©åibuãs_˛ór_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
)

665 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
©å_«me
, "");

666 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
©å_ty≥
, "");

667 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
©å_vÆue
, "");

668 
	`£t_commít
(
¥›_dülog
->
©å_commít
, "");

669 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
©å_˛ass_sc›e
, 
FALSE
);

670 
	}
}

673 
	$©åibuãs_gë_vÆues
 (
STRUCTCœssDülog
 *
¥›_dülog
, 
STRUCTAâribuã
 *
©å
)

675 
	`g_‰ì
 (
©å
->
«me
);

676 
	`g_‰ì
 (
©å
->
ty≥
);

677 i‡(
©å
->
vÆue
 !
NULL
)

678 
	`g_‰ì
 (
©å
->
vÆue
);

680 
©å
->
«me
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
¥›_dülog
->
©å_«me
));

681 
©å
->
ty≥
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
¥›_dülog
->
©å_ty≥
));

683 
©å
->
vÆue
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
(
¥›_dülog
->
©å_vÆue
));

684 
©å
->
commít
 = 
	`g_°rdup
 (
	`gë_commít
(
¥›_dülog
->
©å_commít
));

686 
©å
->
visibûôy
 = (
STRUCTVisibûôy
)

687 
	`GPOINTER_TO_INT
 (
	`gtk_obje˘_gë_u£r_d©a
 (

688 
	`GTK_OBJECT
 (
	`gtk_míu_gë_a˘ive
 (
¥›_dülog
->
©å_visibÀ
))));

690 
©å
->
˛ass_sc›e
 = 
¥›_dülog
->
©å_˛ass_sc›e
->
a˘ive
;

691 
	}
}

694 
	$©åibuãs_gë_cuºít_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
)

696 
STRUCTAâribuã
 *
cuºít_©å
;

697 
GtkLabñ
 *
œbñ
;

698 *
√w_°r
;

700 i‡(
¥›_dülog
 !
NULL
 &&Ör›_dülog->
cuºít_©å
 != NULL) {

701 
cuºít_©å
 = (
STRUCTAâribuã
 *)

702 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
¥›_dülog
->
cuºít_©å
));

703 i‡(
cuºít_©å
 !
NULL
) {

704 
	`©åibuãs_gë_vÆues
(
¥›_dülog
, 
cuºít_©å
);

705 
œbñ
 = 
	`GTK_LABEL
(
	`GTK_BIN
(
¥›_dülog
->
cuºít_©å
)->
chûd
);

706 
√w_°r
 = 
	`°ru˘_gë_©åibuã_°rög
(
cuºít_©å
);

707 
	`gtk_œbñ_£t_ãxt
 (
œbñ
, 
√w_°r
);

708 
	`g_‰ì
 (
√w_°r
);

711 
	}
}

714 
	$©åibuã_li°_ôem_de°roy_ˇŒback
(
GtkWidgë
 *
li°_ôem
,

715 
gpoöãr
 
d©a
)

717 
STRUCTAâribuã
 *
©å
;

719 
©å
 = (
STRUCTAâribuã
 *Ë
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
));

721 i‡(
©å
 !
NULL
) {

722 
	`°ru˘_©åibuã_de°roy
(
©å
);

725 
	}
}

728 
	$©åibuãs_li°_£À˘i⁄_ch™ged_ˇŒback
(
GtkWidgë
 *
gtkli°
,

729 
STRUCTCœss
 *
°ru˘˛ass
)

731 
GLi°
 *
li°
;

732 
STRUCTCœssDülog
 *
¥›_dülog
;

733 
GtkObje˘
 *
li°_ôem
;

734 
STRUCTAâribuã
 *
©å
;

741 i‡(
°ru˘˛ass
->
de°royed
)

744 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

746 i‡(!
¥›_dülog
)

749 
	`©åibuãs_gë_cuºít_vÆues
(
¥›_dülog
);

751 
li°
 = 
	`GTK_LIST
(
gtkli°
)->
£À˘i⁄
;

752 i‡(!
li°
 && 
¥›_dülog
) {

753 
	`©åibuãs_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

754 
	`©åibuãs_˛ór_vÆues
(
¥›_dülog
);

755 
¥›_dülog
->
cuºít_©å
 = 
NULL
;

759 
li°_ôem
 = 
	`GTK_OBJECT
(
li°
->
d©a
);

760 
©å
 = (
STRUCTAâribuã
 *)
	`gtk_obje˘_gë_u£r_d©a
(
li°_ôem
);

761 
	`©åibuãs_£t_vÆues
(
¥›_dülog
, 
©å
);

762 
	`©åibuãs_£t_£nsôive
(
¥›_dülog
, 
TRUE
);

764 
¥›_dülog
->
cuºít_©å
 = 
	`GTK_LIST_ITEM
(
li°_ôem
);

765 
	`gtk_widgë_gøb_focus
(
	`GTK_WIDGET
(
¥›_dülog
->
©å_«me
));

766 
	}
}

769 
	$©åibuãs_li°_√w_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

770 
STRUCTCœss
 *
°ru˘˛ass
)

772 
GLi°
 *
li°
;

773 
STRUCTCœssDülog
 *
¥›_dülog
;

774 
GtkWidgë
 *
li°_ôem
;

775 
STRUCTAâribuã
 *
©å
;

776 *
utf°r
;

777 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

779 
	`©åibuãs_gë_cuºít_vÆues
(
¥›_dülog
);

781 
©å
 = 
	`°ru˘_©åibuã_√w
();

783 
	`°ru˘_©åibuã_ísuª_c⁄√˘i⁄_poöts
 (
©å
, &
°ru˘˛ass
->
ñemít
.
obje˘
);

784 
¥›_dülog
->
added_c⁄√˘i⁄s
 =

785 
	`g_li°_¥ïíd
(
¥›_dülog
->
added_c⁄√˘i⁄s
, 
©å
->
À·_c⁄√˘i⁄
);

786 
¥›_dülog
->
added_c⁄√˘i⁄s
 =

787 
	`g_li°_¥ïíd
(
¥›_dülog
->
added_c⁄√˘i⁄s
, 
©å
->
right_c⁄√˘i⁄
);

789 
utf°r
 = 
	`°ru˘_gë_©åibuã_°rög
 (
©å
);

790 
li°_ôem
 = 
	`gtk_li°_ôem_√w_wôh_œbñ
 (
utf°r
);

791 
	`gtk_widgë_show
 (
li°_ôem
);

792 
	`g_‰ì
 (
utf°r
);

794 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), 
©å
);

795 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°_ôem
), "destroy",

796 
	`GTK_SIGNAL_FUNC
 (
©åibuã_li°_ôem_de°roy_ˇŒback
),

797 
NULL
);

799 
li°
 = 
	`g_li°_≠≥nd
(
NULL
, 
li°_ôem
);

800 
	`gtk_li°_≠≥nd_ôems
(
¥›_dülog
->
©åibuãs_li°
, 
li°
);

802 i‡(
¥›_dülog
->
©åibuãs_li°
->
chûdªn
 !
NULL
)

803 
	`gtk_li°_un£À˘_chûd
(
¥›_dülog
->
©åibuãs_li°
,

804 
	`GTK_WIDGET
(
¥›_dülog
->
©åibuãs_li°
->
chûdªn
->
d©a
));

805 
	`gtk_li°_£À˘_chûd
(
¥›_dülog
->
©åibuãs_li°
, 
li°_ôem
);

806 
	}
}

809 
	$©åibuãs_li°_dñëe_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

810 
STRUCTCœss
 *
°ru˘˛ass
)

812 
GLi°
 *
li°
;

813 
STRUCTCœssDülog
 *
¥›_dülog
;

814 
GtkLi°
 *
gtkli°
;

815 
STRUCTAâribuã
 *
©å
;

817 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

818 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
©åibuãs_li°
);

820 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

821 
©å
 = (
STRUCTAâribuã
 *)

822 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
gtkli°
->
£À˘i⁄
->
d©a
));

824 i‡(
©å
->
À·_c⁄√˘i⁄
 !
NULL
) {

825 
¥›_dülog
->
dñëed_c⁄√˘i⁄s
 =

826 
	`g_li°_¥ïíd
(
¥›_dülog
->
dñëed_c⁄√˘i⁄s
,

827 
©å
->
À·_c⁄√˘i⁄
);

828 
¥›_dülog
->
dñëed_c⁄√˘i⁄s
 =

829 
	`g_li°_¥ïíd
(
¥›_dülog
->
dñëed_c⁄√˘i⁄s
,

830 
©å
->
right_c⁄√˘i⁄
);

833 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
gtkli°
->
£À˘i⁄
->
d©a
);

834 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

835 
	`g_li°_‰ì
(
li°
);

836 
	`©åibuãs_˛ór_vÆues
(
¥›_dülog
);

837 
	`©åibuãs_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

839 
	}
}

842 
	$©åibuãs_li°_move_up_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

843 
STRUCTCœss
 *
°ru˘˛ass
)

845 
GLi°
 *
li°
;

846 
STRUCTCœssDülog
 *
¥›_dülog
;

847 
GtkLi°
 *
gtkli°
;

848 
GtkWidgë
 *
li°_ôem
;

849 
i
;

851 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

852 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
©åibuãs_li°
);

854 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

855 
li°_ôem
 = 
	`GTK_WIDGET
(
gtkli°
->
£À˘i⁄
->
d©a
);

857 
i
 = 
	`gtk_li°_chûd_posôi⁄
(
gtkli°
, 
li°_ôem
);

858 i‡(
i
>0)

859 
i
--;

861 
	`gtk_widgë_ªf
(
li°_ôem
);

862 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
li°_ôem
);

863 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

864 
	`gtk_li°_ö£π_ôems
(
gtkli°
, 
li°
, 
i
);

865 
	`gtk_widgë_uƒef
(
li°_ôem
);

867 
	`gtk_li°_£À˘_chûd
(
gtkli°
, 
li°_ôem
);

869 
	}
}

872 
	$©åibuãs_li°_move_down_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

873 
STRUCTCœss
 *
°ru˘˛ass
)

875 
GLi°
 *
li°
;

876 
STRUCTCœssDülog
 *
¥›_dülog
;

877 
GtkLi°
 *
gtkli°
;

878 
GtkWidgë
 *
li°_ôem
;

879 
i
;

881 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

882 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
©åibuãs_li°
);

884 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

885 
li°_ôem
 = 
	`GTK_WIDGET
(
gtkli°
->
£À˘i⁄
->
d©a
);

887 
i
 = 
	`gtk_li°_chûd_posôi⁄
(
gtkli°
, 
li°_ôem
);

888 i‡(
i
<(
	`g_li°_Àngth
(
gtkli°
->
chûdªn
)-1))

889 
i
++;

892 
	`gtk_widgë_ªf
(
li°_ôem
);

893 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
li°_ôem
);

894 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

895 
	`gtk_li°_ö£π_ôems
(
gtkli°
, 
li°
, 
i
);

896 
	`gtk_widgë_uƒef
(
li°_ôem
);

898 
	`gtk_li°_£À˘_chûd
(
gtkli°
, 
li°_ôem
);

900 
	}
}

903 
	$©åibuãs_ªad_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
,

904 
STRUCTCœssDülog
 *
¥›_dülog
,

905 
c⁄√˘i⁄_ödex
)

907 
GLi°
 *
li°
;

908 
STRUCTAâribuã
 *
©å
;

909 
GtkWidgë
 *
li°_ôem
;

910 
GLi°
 *
˛ór_li°
;

911 
DüObje˘
 *
obj
;

913 
obj
 = &
°ru˘˛ass
->
ñemít
.
obje˘
;

917 
	`©åibuãs_gë_cuºít_vÆues
(
¥›_dülog
);

919 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

920 
li°
 !
NULL
) {

921 
©å
 = (
STRUCTAâribuã
 *)
li°
->
d©a
;

922 
	`°ru˘_©åibuã_de°roy
(
©å
);

923 
li°
 = 
	`g_li°_√xt
(list);

925 
	`g_li°_‰ì
 (
°ru˘˛ass
->
©åibuãs
);

926 
°ru˘˛ass
->
©åibuãs
 = 
NULL
;

929 
li°
 = 
	`GTK_LIST
 (
¥›_dülog
->
©åibuãs_li°
)->
chûdªn
;

930 
˛ór_li°
 = 
NULL
;

931 
li°
 !
NULL
) {

932 
li°_ôem
 = 
	`GTK_WIDGET
(
li°
->
d©a
);

934 
˛ór_li°
 = 
	`g_li°_¥ïíd
 (˛ór_li°, 
li°_ôem
);

935 
©å
 = (
STRUCTAâribuã
 *)

936 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
));

937 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), 
NULL
);

938 
°ru˘˛ass
->
©åibuãs
 = 
	`g_li°_≠≥nd
(°ru˘˛ass->©åibuãs, 
©å
);

940 i‡(
©å
->
À·_c⁄√˘i⁄
 =
NULL
) {

941 
	`°ru˘_©åibuã_ísuª_c⁄√˘i⁄_poöts
 (
©å
, 
obj
);

943 
¥›_dülog
->
added_c⁄√˘i⁄s
 =

944 
	`g_li°_¥ïíd
(
¥›_dülog
->
added_c⁄√˘i⁄s
,

945 
©å
->
À·_c⁄√˘i⁄
);

946 
¥›_dülog
->
added_c⁄√˘i⁄s
 =

947 
	`g_li°_¥ïíd
(
¥›_dülog
->
added_c⁄√˘i⁄s
,

948 
©å
->
right_c⁄√˘i⁄
);

951 i‡–(
¥›_dülog
->
©å_vis
->
a˘ive
) &&

952 (!
¥›_dülog
->
©å_suµ
->
a˘ive
) ) {

953 
obj
->
c⁄√˘i⁄s
[
c⁄√˘i⁄_ödex
] = 
©å
->
À·_c⁄√˘i⁄
;

954 
c⁄√˘i⁄_ödex
++;

955 
obj
->
c⁄√˘i⁄s
[
c⁄√˘i⁄_ödex
] = 
©å
->
right_c⁄√˘i⁄
;

956 
c⁄√˘i⁄_ödex
++;

958 
	`°ru˘˛ass_°‹e_disc⁄√˘s
(
¥›_dülog
, 
©å
->
À·_c⁄√˘i⁄
);

959 
	`obje˘_ªmove_c⁄√˘i⁄s_to
(
©å
->
À·_c⁄√˘i⁄
);

960 
	`°ru˘˛ass_°‹e_disc⁄√˘s
(
¥›_dülog
, 
©å
->
right_c⁄√˘i⁄
);

961 
	`obje˘_ªmove_c⁄√˘i⁄s_to
(
©å
->
right_c⁄√˘i⁄
);

964 
li°
 = 
	`g_li°_√xt
(list);

966 
˛ór_li°
 = 
	`g_li°_ªvî£
 (clear_list);

967 
	`gtk_li°_ªmove_ôems
 (
	`GTK_LIST
 (
¥›_dülog
->
©åibuãs_li°
), 
˛ór_li°
);

968 
	`g_li°_‰ì
 (
˛ór_li°
);

971 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "Read from dialog");

973 
	}
}

977 
	$©åibuãs_fûl_ö_dülog
(
STRUCTCœss
 *
°ru˘˛ass
)

979 
STRUCTCœssDülog
 *
¥›_dülog
;

980 
STRUCTAâribuã
 *
©å_c›y
;

981 
GtkWidgë
 *
li°_ôem
;

982 
GLi°
 *
li°
;

983 
i
;

985 #ifde‡
DEBUG


986 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "Filling in dialog");

989 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

992 i‡(
¥›_dülog
->
©åibuãs_li°
->
chûdªn
 =
NULL
) {

993 
i
 = 0;

994 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

995 
li°
 !
NULL
) {

996 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *)
li°
->
d©a
;

997 
gch¨
 *
©å°r
 = 
	`°ru˘_gë_©åibuã_°rög
(
©å
);

999 
li°_ôem
 = 
	`gtk_li°_ôem_√w_wôh_œbñ
 (
©å°r
);

1000 
©å_c›y
 = 
	`°ru˘_©åibuã_c›y
(
©å
);

1002 
©å_c›y
->
À·_c⁄√˘i⁄
 = 
©å
->left_connection;

1003 
©å_c›y
->
right_c⁄√˘i⁄
 = 
©å
->right_connection;

1004 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), (
gpoöãr
Ë
©å_c›y
);

1005 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°_ôem
), "destroy",

1006 
	`GTK_SIGNAL_FUNC
 (
©åibuã_li°_ôem_de°roy_ˇŒback
),

1007 
NULL
);

1008 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
¥›_dülog
->
©åibuãs_li°
), 
li°_ôem
);

1009 
	`gtk_widgë_show
 (
li°_ôem
);

1011 
li°
 = 
	`g_li°_√xt
÷i°); 
i
++;

1012 
	`g_‰ì
 (
©å°r
);

1015 
¥›_dülog
->
cuºít_©å
 = 
NULL
;

1016 
	`©åibuãs_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

1017 
	`©åibuãs_˛ór_vÆues
(
¥›_dülog
);

1019 
	}
}

1022 
	$©åibuãs_upd©e
(
GtkWidgë
 *
widgë
, 
STRUCTCœss
 *
°ru˘˛ass
)

1024 
	`©åibuãs_gë_cuºít_vÆues
(
°ru˘˛ass
->
¥›îtõs_dülog
);

1025 
	}
}

1028 
	$©åibuãs_upd©e_evít
(
GtkWidgë
 *
widgë
, 
GdkEvítFocus
 *
ev
, 
STRUCTCœss
 *
°ru˘˛ass
)

1030 
	`©åibuãs_gë_cuºít_vÆues
(
°ru˘˛ass
->
¥›îtõs_dülog
);

1032 
	}
}

1035 
	$©åibuãs_¸óã_∑ge
(
GtkNŸebook
 *
nŸebook
, 
STRUCTCœss
 *
°ru˘˛ass
)

1037 
STRUCTCœssDülog
 *
¥›_dülog
;

1038 
GtkWidgë
 *
∑ge_œbñ
;

1039 
GtkWidgë
 *
œbñ
;

1040 
GtkWidgë
 *
hbox
;

1041 
GtkWidgë
 *
vbox
;

1042 
GtkWidgë
 *
vbox2
;

1043 
GtkWidgë
 *
hbox2
;

1044 
GtkWidgë
 *
èbÀ
;

1045 
GtkWidgë
 *
íåy
;

1046 
GtkWidgë
 *
checkbox
;

1047 
GtkWidgë
 *
s¸ﬁÀd_wö
;

1048 
GtkWidgë
 *
buâ⁄
;

1049 
GtkWidgë
 *
li°
;

1050 
GtkWidgë
 *
‰ame
;

1051 
GtkWidgë
 *
omíu
;

1052 
GtkWidgë
 *
míu
;

1053 
GtkWidgë
 *
submíu
;

1054 
GtkWidgë
 *
s¸ﬁÀdwödow
;

1055 
GSLi°
 *
group
;

1057 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1060 
∑ge_œbñ
 = 
	`gtk_œbñ_√w_wôh_m√m⁄ic
 (
	`_
("_Attributes"));

1062 
vbox
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

1063 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox
), 10);

1065 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

1067 
s¸ﬁÀd_wö
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

1068 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
),

1069 
GTK_POLICY_AUTOMATIC
,

1070 
GTK_POLICY_AUTOMATIC
);

1071 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
s¸ﬁÀd_wö
, 
TRUE
, TRUE, 0);

1072 
	`gtk_widgë_show
 (
s¸ﬁÀd_wö
);

1074 
li°
 = 
	`gtk_li°_√w
 ();

1075 
¥›_dülog
->
©åibuãs_li°
 = 
	`GTK_LIST
(
li°
);

1076 
	`gtk_li°_£t_£À˘i⁄_mode
 (
	`GTK_LIST
 (
li°
), 
GTK_SELECTION_SINGLE
);

1077 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
), 
li°
);

1078 
	`gtk_c⁄èöî_£t_focus_vadju°mít
 (
	`GTK_CONTAINER
 (
li°
),

1079 
	`gtk_s¸ﬁÀd_wödow_gë_vadju°mít
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
)));

1080 
	`gtk_widgë_show
 (
li°
);

1082 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°
), "selection_changed",

1083 
	`GTK_SIGNAL_FUNC
(
©åibuãs_li°_£À˘i⁄_ch™ged_ˇŒback
),

1084 
°ru˘˛ass
);

1086 
vbox2
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

1088 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_NEW
);

1089 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1090 
	`GTK_SIGNAL_FUNC
(
©åibuãs_li°_√w_ˇŒback
),

1091 
°ru˘˛ass
);

1092 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

1093 
	`gtk_widgë_show
 (
buâ⁄
);

1094 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_DELETE
);

1095 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1096 
	`GTK_SIGNAL_FUNC
(
©åibuãs_li°_dñëe_ˇŒback
),

1097 
°ru˘˛ass
);

1098 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

1099 
	`gtk_widgë_show
 (
buâ⁄
);

1100 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_UP
);

1101 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1102 
	`GTK_SIGNAL_FUNC
(
©åibuãs_li°_move_up_ˇŒback
),

1103 
°ru˘˛ass
);

1104 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

1105 
	`gtk_widgë_show
 (
buâ⁄
);

1106 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_DOWN
);

1107 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

1108 
	`GTK_SIGNAL_FUNC
(
©åibuãs_li°_move_down_ˇŒback
),

1109 
°ru˘˛ass
);

1110 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

1111 
	`gtk_widgë_show
 (
buâ⁄
);

1113 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
vbox2
, 
FALSE
, 
TRUE
, 0);

1115 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
TRUE
, TRUE, 0);

1117 
‰ame
 = 
	`gtk_‰ame_√w
(
	`_
("Attribute data"));

1118 
vbox2
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

1119 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox2
), 10);

1120 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame
), 
vbox2
);

1121 
	`gtk_widgë_show
(
‰ame
);

1122 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
‰ame
, 
FALSE
, 
TRUE
, 0);

1124 
èbÀ
 = 
	`gtk_èbÀ_√w
 (5, 2, 
FALSE
);

1125 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
èbÀ
, 
FALSE
, FALSE, 0);

1127 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Name:"));

1128 
íåy
 = 
	`gtk_íåy_√w
();

1129 
¥›_dülog
->
©å_«me
 = 
	`GTK_ENTRY
(
íåy
);

1130 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

1131 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e_evít
), 
°ru˘˛ass
);

1132 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

1133 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e
), 
°ru˘˛ass
);

1134 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

1135 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,0,1, 
GTK_FILL
,0, 0,0);

1136 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,0,1, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

1138 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Type:"));

1139 
íåy
 = 
	`gtk_íåy_√w
();

1140 
¥›_dülog
->
©å_ty≥
 = 
	`GTK_ENTRY
(
íåy
);

1141 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

1142 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e_evít
), 
°ru˘˛ass
);

1143 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

1144 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e
), 
°ru˘˛ass
);

1145 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

1146 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,1,2, 
GTK_FILL
,0, 0,0);

1147 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,1,2, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

1149 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Value:"));

1150 
íåy
 = 
	`gtk_íåy_√w
();

1151 
¥›_dülog
->
©å_vÆue
 = 
	`GTK_ENTRY
(
íåy
);

1152 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

1153 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e_evít
), 
°ru˘˛ass
);

1154 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

1155 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e
), 
°ru˘˛ass
);

1156 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

1157 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,2,3, 
GTK_FILL
,0, 0,0);

1158 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,2,3, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

1160 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Comment:"));

1161 
s¸ﬁÀdwödow
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

1162 
	`gtk_s¸ﬁÀd_wödow_£t_shadow_ty≥
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀdwödow
),

1163 
GTK_SHADOW_IN
);

1164 
íåy
 = 
	`gtk_ãxt_võw_√w
 ();

1165 
¥›_dülog
->
©å_commít
 = 
	`GTK_TEXT_VIEW
(
íåy
);

1166 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
s¸ﬁÀdwödow
), 
íåy
);

1167 
	`gtk_ãxt_võw_£t_wøp_mode
 (
	`GTK_TEXT_VIEW
 (
íåy
), 
GTK_WRAP_WORD
);

1168 
	`gtk_ãxt_võw_£t_curs‹_visibÀ
(
	`GTK_TEXT_VIEW
 (
íåy
),
TRUE
);

1169 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

1170 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e_evít
), 
°ru˘˛ass
);

1174 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

1175 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e
), 
°ru˘˛ass
);

1177 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

1178 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,3,4, 
GTK_FILL
,0, 0,0);

1179 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
s¸ﬁÀdwödow
, 1,2,3,4, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

1182 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Visibility:"));

1184 
omíu
 = 
	`gtk_›ti⁄_míu_√w
 ();

1185 
míu
 = 
	`gtk_míu_√w
 ();

1186 
¥›_dülog
->
©å_visibÀ
 = 
	`GTK_MENU
(
míu
);

1187 
¥›_dülog
->
©å_visibÀ_buâ⁄
 = 
	`GTK_OPTION_MENU
(
omíu
);

1188 
submíu
 = 
NULL
;

1189 
group
 = 
NULL
;

1191 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Public"),

1192 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e
),

1193 
°ru˘˛ass
, 
	`GINT_TO_POINTER
(
STRUCT_PUBLIC
));

1194 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Private"),

1195 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e
),

1196 
°ru˘˛ass
, 
	`GINT_TO_POINTER
(
STRUCT_PRIVATE
) );

1197 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Protected"),

1198 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e
),

1199 
°ru˘˛ass
, 
	`GINT_TO_POINTER
(
STRUCT_PROTECTED
) );

1200 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Implementation"),

1201 
	`GTK_SIGNAL_FUNC
 (
©åibuãs_upd©e
),

1202 
°ru˘˛ass
, 
	`GINT_TO_POINTER
(
STRUCT_IMPLEMENTATION
) );

1204 
	`gtk_›ti⁄_míu_£t_míu
 (
	`GTK_OPTION_MENU
 (
omíu
), 
míu
);

1207 
GtkWidgë
 * 
Æign
;

1208 
Æign
 = 
	`gtk_Æignmít_√w
(0.0, 0.5, 0.0, 0.0);

1209 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
Æign
), 
omíu
);

1210 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

1211 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,4,5, 
GTK_FILL
,0, 0,3);

1212 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
Æign
, 1,2,4,5, 
GTK_FILL
,0, 0,3);

1215 
hbox2
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

1216 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Class scope"));

1217 
¥›_dülog
->
©å_˛ass_sc›e
 = 
	`GTK_TOGGLE_BUTTON
(
checkbox
);

1218 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox2
), 
checkbox
, 
TRUE
, TRUE, 0);

1219 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
hbox2
, 
FALSE
, 
TRUE
, 0);

1221 
	`gtk_widgë_show
(
vbox2
);

1223 
	`gtk_widgë_show_Æl
 (
vbox
);

1224 
	`gtk_widgë_show
 (
∑ge_œbñ
);

1225 
	`gtk_nŸebook_≠≥nd_∑ge
(
nŸebook
, 
vbox
, 
∑ge_œbñ
);

1227 
	}
}

1234 
›î©i⁄s_gë_cuºít_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
);

1237 
	$∑ømëîs_£t_£nsôive
(
STRUCTCœssDülog
 *
¥›_dülog
, 
göt
 
vÆ
)

1239 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
∑øm_«me
), 
vÆ
);

1240 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
∑øm_ty≥
), 
vÆ
);

1241 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
∑øm_vÆue
), 
vÆ
);

1242 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
∑øm_commít
), 
vÆ
);

1243 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
∑øm_köd
), 
vÆ
);

1244 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
∑øm_köd_buâ⁄
), 
vÆ
);

1245 
	}
}

1248 
	$∑ømëîs_£t_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
, 
STRUCTP¨amëî
 *
∑øm
)

1250 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
∑øm_«me
, 
∑øm
->
«me
);

1251 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
∑øm_ty≥
, 
∑øm
->
ty≥
);

1252 i‡(
∑øm
->
vÆue
 !
NULL
)

1253 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
∑øm_vÆue
, 
∑øm
->
vÆue
);

1255 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
∑øm_vÆue
, "");

1256 i‡(
∑øm
->
commít
 !
NULL
)

1257 
	`£t_commít
(
¥›_dülog
->
∑øm_commít
, 
∑øm
->
commít
);

1259 
	`£t_commít
(
¥›_dülog
->
∑øm_commít
, "");

1261 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
¥›_dülog
->
∑øm_köd_buâ⁄
,

1262 (
göt
)
∑øm
->
köd
);

1263 
	}
}

1266 
	$∑ømëîs_˛ór_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
)

1268 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
∑øm_«me
, "");

1269 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
∑øm_ty≥
, "");

1270 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
∑øm_vÆue
, "");

1271 
	`£t_commít
(
¥›_dülog
->
∑øm_commít
, "");

1272 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
¥›_dülog
->
∑øm_köd_buâ⁄
,

1273 (
göt
Ë
STRUCT_UNDEF_KIND
);

1275 
	}
}

1278 
	$∑ømëîs_gë_vÆues
 (
STRUCTCœssDülog
 *
¥›_dülog
, 
STRUCTP¨amëî
 *
∑øm
)

1280 
	`g_‰ì
(
∑øm
->
«me
);

1281 
	`g_‰ì
(
∑øm
->
ty≥
);

1282 
	`g_‰ì
(
∑øm
->
commít
);

1283 i‡(
∑øm
->
vÆue
 !
NULL
)

1284 
	`g_‰ì
(
∑øm
->
vÆue
);

1286 
∑øm
->
«me
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
¥›_dülog
->
∑øm_«me
));

1287 
∑øm
->
ty≥
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
¥›_dülog
->
∑øm_ty≥
));

1289 
∑øm
->
vÆue
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
(
¥›_dülog
->
∑øm_vÆue
));

1290 
∑øm
->
commít
 = 
	`g_°rdup
 (
	`gë_commít
(
¥›_dülog
->
∑øm_commít
));

1292 
∑øm
->
köd
 = (
STRUCTP¨amëîKöd
Ë
	`GPOINTER_TO_INT
(
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
	`gtk_míu_gë_a˘ive
(
¥›_dülog
->
∑øm_köd
))));

1293 
	}
}

1296 
	$∑ømëîs_gë_cuºít_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
)

1298 
STRUCTP¨amëî
 *
cuºít_∑øm
;

1299 
GtkLabñ
 *
œbñ
;

1300 *
√w_°r
;

1302 i‡(
¥›_dülog
->
cuºít_∑øm
 !
NULL
) {

1303 
cuºít_∑øm
 = (
STRUCTP¨amëî
 *)

1304 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
¥›_dülog
->
cuºít_∑øm
));

1305 i‡(
cuºít_∑øm
 !
NULL
) {

1306 
	`∑ømëîs_gë_vÆues
(
¥›_dülog
, 
cuºít_∑øm
);

1307 
œbñ
 = 
	`GTK_LABEL
(
	`GTK_BIN
(
¥›_dülog
->
cuºít_∑øm
)->
chûd
);

1308 
√w_°r
 = 
	`°ru˘_gë_∑ømëî_°rög
(
cuºít_∑øm
);

1309 
	`gtk_œbñ_£t_ãxt
(
œbñ
, 
√w_°r
);

1310 
	`g_‰ì
(
√w_°r
);

1313 
	}
}

1317 
	$∑ømëîs_li°_£À˘i⁄_ch™ged_ˇŒback
(
GtkWidgë
 *
gtkli°
,

1318 
STRUCTCœss
 *
°ru˘˛ass
)

1320 
GLi°
 *
li°
;

1321 
STRUCTCœssDülog
 *
¥›_dülog
;

1322 
GtkObje˘
 *
li°_ôem
;

1323 
STRUCTP¨amëî
 *
∑øm
;

1325 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1327 i‡(!
¥›_dülog
)

1330 
	`∑ømëîs_gë_cuºít_vÆues
(
¥›_dülog
);

1332 
li°
 = 
	`GTK_LIST
(
gtkli°
)->
£À˘i⁄
;

1333 i‡(!
li°
) {

1334 
	`∑ømëîs_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

1335 
	`∑ømëîs_˛ór_vÆues
(
¥›_dülog
);

1336 
¥›_dülog
->
cuºít_∑øm
 = 
NULL
;

1340 
li°_ôem
 = 
	`GTK_OBJECT
(
li°
->
d©a
);

1341 
∑øm
 = (
STRUCTP¨amëî
 *)
	`gtk_obje˘_gë_u£r_d©a
(
li°_ôem
);

1342 
	`∑ømëîs_£t_vÆues
(
¥›_dülog
, 
∑øm
);

1343 
	`∑ømëîs_£t_£nsôive
(
¥›_dülog
, 
TRUE
);

1345 
¥›_dülog
->
cuºít_∑øm
 = 
	`GTK_LIST_ITEM
(
li°_ôem
);

1346 
	`gtk_widgë_gøb_focus
(
	`GTK_WIDGET
(
¥›_dülog
->
∑øm_«me
));

1347 
	}
}

1350 
	$∑ømëîs_li°_√w_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

1351 
STRUCTCœss
 *
°ru˘˛ass
)

1353 
GLi°
 *
li°
;

1354 
STRUCTCœssDülog
 *
¥›_dülog
;

1355 
GtkWidgë
 *
li°_ôem
;

1356 
STRUCTO≥øti⁄
 *
cuºít_›
;

1357 
STRUCTP¨amëî
 *
∑øm
;

1358 *
utf
;

1360 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1362 
	`∑ømëîs_gë_cuºít_vÆues
(
¥›_dülog
);

1364 
cuºít_›
 = (
STRUCTO≥øti⁄
 *)

1365 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
¥›_dülog
->
cuºít_›
));

1367 
∑øm
 = 
	`°ru˘_∑ømëî_√w
();

1369 
utf
 = 
	`°ru˘_gë_∑ømëî_°rög
 (
∑øm
);

1370 
li°_ôem
 = 
	`gtk_li°_ôem_√w_wôh_œbñ
 (
utf
);

1371 
	`gtk_widgë_show
 (
li°_ôem
);

1372 
	`g_‰ì
 (
utf
);

1374 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), 
∑øm
);

1376 
cuºít_›
->
∑ømëîs
 = 
	`g_li°_≠≥nd
(current_op->parameters,

1377 (
gpoöãr
Ë
∑øm
);

1379 
li°
 = 
	`g_li°_≠≥nd
(
NULL
, 
li°_ôem
);

1380 
	`gtk_li°_≠≥nd_ôems
(
¥›_dülog
->
∑ømëîs_li°
, 
li°
);

1382 i‡(
¥›_dülog
->
∑ømëîs_li°
->
chûdªn
 !
NULL
)

1383 
	`gtk_li°_un£À˘_chûd
(
¥›_dülog
->
∑ømëîs_li°
,

1384 
	`GTK_WIDGET
(
¥›_dülog
->
∑ømëîs_li°
->
chûdªn
->
d©a
));

1385 
	`gtk_li°_£À˘_chûd
(
¥›_dülog
->
∑ømëîs_li°
, 
li°_ôem
);

1387 
¥›_dülog
->
cuºít_∑øm
 = 
	`GTK_LIST_ITEM
(
li°_ôem
);

1388 
	}
}

1391 
	$∑ømëîs_li°_dñëe_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

1392 
STRUCTCœss
 *
°ru˘˛ass
)

1394 
GLi°
 *
li°
;

1395 
STRUCTCœssDülog
 *
¥›_dülog
;

1396 
GtkLi°
 *
gtkli°
;

1397 
STRUCTO≥øti⁄
 *
cuºít_›
;

1398 
STRUCTP¨amëî
 *
∑øm
;

1400 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1401 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
∑ømëîs_li°
);

1404 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

1406 
cuºít_›
 = (
STRUCTO≥øti⁄
 *)

1407 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
¥›_dülog
->
cuºít_›
));

1408 
∑øm
 = (
STRUCTP¨amëî
 *)

1409 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
¥›_dülog
->
cuºít_∑øm
));

1411 
cuºít_›
->
∑ømëîs
 = 
	`g_li°_ªmove
(current_op->parameters,

1412 (
gpoöãr
Ë
∑øm
);

1413 
	`°ru˘_∑ømëî_de°roy
(
∑øm
);

1416 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
¥›_dülog
->
cuºít_∑øm
);

1418 
¥›_dülog
->
cuºít_∑øm
 = 
NULL
;

1420 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

1421 
	`g_li°_‰ì
(
li°
);

1423 
	}
}

1426 
	$∑ømëîs_li°_move_up_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

1427 
STRUCTCœss
 *
°ru˘˛ass
)

1429 
GLi°
 *
li°
;

1430 
STRUCTCœssDülog
 *
¥›_dülog
;

1431 
GtkLi°
 *
gtkli°
;

1432 
GtkWidgë
 *
li°_ôem
;

1433 
STRUCTO≥øti⁄
 *
cuºít_›
;

1434 
STRUCTP¨amëî
 *
∑øm
;

1435 
i
;

1437 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1438 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
∑ømëîs_li°
);

1440 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

1441 
li°_ôem
 = 
	`GTK_WIDGET
(
gtkli°
->
£À˘i⁄
->
d©a
);

1443 
i
 = 
	`gtk_li°_chûd_posôi⁄
(
gtkli°
, 
li°_ôem
);

1444 i‡(
i
>0)

1445 
i
--;

1447 
∑øm
 = (
STRUCTP¨amëî
 *Ë
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
));

1450 
cuºít_›
 = (
STRUCTO≥øti⁄
 *)

1451 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
¥›_dülog
->
cuºít_›
));

1453 
cuºít_›
->
∑ømëîs
 = 
	`g_li°_ªmove
(current_op->parameters,

1454 (
gpoöãr
Ë
∑øm
);

1455 
cuºít_›
->
∑ømëîs
 = 
	`g_li°_ö£π
(current_op->parameters,

1456 (
gpoöãr
Ë
∑øm
,

1457 
i
);

1460 
	`gtk_widgë_ªf
(
li°_ôem
);

1461 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
li°_ôem
);

1462 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

1463 
	`gtk_li°_ö£π_ôems
(
gtkli°
, 
li°
, 
i
);

1464 
	`gtk_widgë_uƒef
(
li°_ôem
);

1466 
	`gtk_li°_£À˘_chûd
(
gtkli°
, 
li°_ôem
);

1468 
	`›î©i⁄s_gë_cuºít_vÆues
(
¥›_dülog
);

1470 
	}
}

1473 
	$∑ømëîs_li°_move_down_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

1474 
STRUCTCœss
 *
°ru˘˛ass
)

1476 
GLi°
 *
li°
;

1477 
STRUCTCœssDülog
 *
¥›_dülog
;

1478 
GtkLi°
 *
gtkli°
;

1479 
GtkWidgë
 *
li°_ôem
;

1480 
STRUCTO≥øti⁄
 *
cuºít_›
;

1481 
STRUCTP¨amëî
 *
∑øm
;

1482 
i
;

1484 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1485 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
∑ømëîs_li°
);

1487 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

1488 
li°_ôem
 = 
	`GTK_WIDGET
(
gtkli°
->
£À˘i⁄
->
d©a
);

1490 
i
 = 
	`gtk_li°_chûd_posôi⁄
(
gtkli°
, 
li°_ôem
);

1491 i‡(
i
<(
	`g_li°_Àngth
(
gtkli°
->
chûdªn
)-1))

1492 
i
++;

1494 
∑øm
 = (
STRUCTP¨amëî
 *Ë
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
));

1497 
cuºít_›
 = (
STRUCTO≥øti⁄
 *)

1498 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
¥›_dülog
->
cuºít_›
));

1500 
cuºít_›
->
∑ømëîs
 = 
	`g_li°_ªmove
(current_op->parameters,

1501 (
gpoöãr
Ë
∑øm
);

1502 
cuºít_›
->
∑ømëîs
 = 
	`g_li°_ö£π
(current_op->parameters,

1503 (
gpoöãr
Ë
∑øm
,

1504 
i
);

1507 
	`gtk_widgë_ªf
(
li°_ôem
);

1508 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
li°_ôem
);

1509 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

1510 
	`gtk_li°_ö£π_ôems
(
gtkli°
, 
li°
, 
i
);

1511 
	`gtk_widgë_uƒef
(
li°_ôem
);

1513 
	`gtk_li°_£À˘_chûd
(
gtkli°
, 
li°_ôem
);

1515 
	`›î©i⁄s_gë_cuºít_vÆues
(
¥›_dülog
);

1517 
	}
}

1520 
	$›î©i⁄s_£t_£nsôive
(
STRUCTCœssDülog
 *
¥›_dülog
, 
göt
 
vÆ
)

1522 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_«me
), 
vÆ
);

1523 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_ty≥
), 
vÆ
);

1524 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_°îeŸy≥
), 
vÆ
);

1525 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_commít
), 
vÆ
);

1526 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_visibÀ_buâ⁄
), 
vÆ
);

1527 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_visibÀ
), 
vÆ
);

1528 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_˛ass_sc›e
), 
vÆ
);

1529 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_öhîô™˚_ty≥
), 
vÆ
);

1530 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_öhîô™˚_ty≥_buâ⁄
), 
vÆ
);

1531 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
›_quîy
), 
vÆ
);

1533 
	`gtk_widgë_£t_£nsôive
(
¥›_dülog
->
∑øm_√w_buâ⁄
, 
vÆ
);

1534 
	`gtk_widgë_£t_£nsôive
(
¥›_dülog
->
∑øm_dñëe_buâ⁄
, 
vÆ
);

1535 
	`gtk_widgë_£t_£nsôive
(
¥›_dülog
->
∑øm_down_buâ⁄
, 
vÆ
);

1536 
	`gtk_widgë_£t_£nsôive
(
¥›_dülog
->
∑øm_up_buâ⁄
, 
vÆ
);

1537 
	}
}

1540 
	$›î©i⁄s_£t_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
, 
STRUCTO≥øti⁄
 *
›
)

1542 
GLi°
 *
li°
;

1543 
STRUCTP¨amëî
 *
∑øm
;

1544 
GtkWidgë
 *
li°_ôem
;

1545 
gch¨
 *
°r
;

1547 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
›_«me
, 
›
->
«me
);

1548 i‡(
›
->
ty≥
 !
NULL
)

1549 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
›_ty≥
, 
›
->
ty≥
);

1551 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
›_ty≥
, "");

1553 i‡(
›
->
°îeŸy≥
 !
NULL
)

1554 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
›_°îeŸy≥
, 
›
->
°îeŸy≥
);

1556 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
›_°îeŸy≥
, "");

1558 i‡(
›
->
commít
 !
NULL
)

1559 
	`£t_commít
(
¥›_dülog
->
›_commít
, 
›
->
commít
);

1561 
	`£t_commít
(
¥›_dülog
->
›_commít
, "");

1563 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
¥›_dülog
->
›_visibÀ_buâ⁄
,

1564 (
göt
)
›
->
visibûôy
);

1565 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
›_˛ass_sc›e
, 
›
->
˛ass_sc›e
);

1566 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
›_quîy
, 
›
->
quîy
);

1567 
	`gtk_›ti⁄_míu_£t_hi°‹y
(
¥›_dülog
->
›_öhîô™˚_ty≥_buâ⁄
,

1568 (
göt
)
›
->
öhîô™˚_ty≥
);

1570 
	`gtk_li°_˛ór_ôems
(
¥›_dülog
->
∑ømëîs_li°
, 0, -1);

1571 
¥›_dülog
->
cuºít_∑øm
 = 
NULL
;

1572 
	`∑ømëîs_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

1574 
li°
 = 
›
->
∑ømëîs
;

1575 
li°
 !
NULL
) {

1576 
∑øm
 = (
STRUCTP¨amëî
 *)
li°
->
d©a
;

1578 
°r
 = 
	`°ru˘_gë_∑ømëî_°rög
 (
∑øm
);

1579 
li°_ôem
 = 
	`gtk_li°_ôem_√w_wôh_œbñ
 (
°r
);

1580 
	`g_‰ì
 (
°r
);

1582 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), (
gpoöãr
Ë
∑øm
);

1583 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
¥›_dülog
->
∑ømëîs_li°
), 
li°_ôem
);

1584 
	`gtk_widgë_show
 (
li°_ôem
);

1586 
li°
 = 
	`g_li°_√xt
(list);

1588 
	}
}

1591 
	$›î©i⁄s_˛ór_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
)

1593 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
›_«me
, "");

1594 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
›_ty≥
, "");

1595 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
›_°îeŸy≥
, "");

1596 
	`£t_commít
(
¥›_dülog
->
›_commít
, "");

1597 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
›_˛ass_sc›e
, 
FALSE
);

1598 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
›_quîy
, 
FALSE
);

1600 
	`gtk_li°_˛ór_ôems
(
¥›_dülog
->
∑ømëîs_li°
, 0, -1);

1601 
¥›_dülog
->
cuºít_∑øm
 = 
NULL
;

1602 
	`∑ømëîs_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

1603 
	}
}

1607 
	$›î©i⁄s_gë_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
, 
STRUCTO≥øti⁄
 *
›
)

1609 c⁄° 
gch¨
 *
s
;

1611 
	`g_‰ì
(
›
->
«me
);

1612 i‡(
›
->
ty≥
 !
NULL
)

1613 
	`g_‰ì
(
›
->
ty≥
);

1615 
›
->
«me
 = 
	`g_°rdup
(
	`gtk_íåy_gë_ãxt
(
¥›_dülog
->
›_«me
));

1616 
›
->
ty≥
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
(
¥›_dülog
->
›_ty≥
));

1617 
›
->
commít
 = 
	`g_°rdup
(
	`gë_commít
(
¥›_dülog
->
›_commít
));

1619 
s
 = 
	`gtk_íåy_gë_ãxt
(
¥›_dülog
->
›_°îeŸy≥
);

1620 i‡(
s
 && s[0])

1621 
›
->
°îeŸy≥
 = 
	`g_°rdup
 (
s
);

1623 
›
->
°îeŸy≥
 = 
NULL
;

1625 
›
->
visibûôy
 = (
STRUCTVisibûôy
)

1626 
	`GPOINTER_TO_INT
(
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
	`gtk_míu_gë_a˘ive
(
¥›_dülog
->
›_visibÀ
))));

1628 
›
->
˛ass_sc›e
 = 
¥›_dülog
->
›_˛ass_sc›e
->
a˘ive
;

1629 
›
->
öhîô™˚_ty≥
 = (
STRUCTInhîô™˚Ty≥
)

1630 
	`GPOINTER_TO_INT
(
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
	`gtk_míu_gë_a˘ive
(
¥›_dülog
->
›_öhîô™˚_ty≥
))));

1632 
›
->
quîy
 = 
¥›_dülog
->
›_quîy
->
a˘ive
;

1634 
	}
}

1637 
	$›î©i⁄s_gë_cuºít_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
)

1639 
STRUCTO≥øti⁄
 *
cuºít_›
;

1640 
GtkLabñ
 *
œbñ
;

1641 *
√w_°r
;

1643 
	`∑ømëîs_gë_cuºít_vÆues
(
¥›_dülog
);

1645 i‡(
¥›_dülog
->
cuºít_›
 !
NULL
) {

1646 
cuºít_›
 = (
STRUCTO≥øti⁄
 *)

1647 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
¥›_dülog
->
cuºít_›
));

1648 i‡(
cuºít_›
 !
NULL
) {

1649 
	`›î©i⁄s_gë_vÆues
(
¥›_dülog
, 
cuºít_›
);

1650 
œbñ
 = 
	`GTK_LABEL
(
	`GTK_BIN
(
¥›_dülog
->
cuºít_›
)->
chûd
);

1651 
√w_°r
 = 
	`°ru˘_gë_›î©i⁄_°rög
(
cuºít_›
);

1652 
	`gtk_œbñ_£t_ãxt
 (
œbñ
, 
√w_°r
);

1653 
	`g_‰ì
 (
√w_°r
);

1656 
	}
}

1659 
	$›î©i⁄s_li°_ôem_de°roy_ˇŒback
(
GtkWidgë
 *
li°_ôem
,

1660 
gpoöãr
 
d©a
)

1662 
STRUCTO≥øti⁄
 *
›
;

1664 
›
 = (
STRUCTO≥øti⁄
 *Ë
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
));

1666 i‡(
›
 !
NULL
) {

1667 
	`°ru˘_›î©i⁄_de°roy
(
›
);

1670 
	}
}

1673 
	$›î©i⁄s_li°_£À˘i⁄_ch™ged_ˇŒback
(
GtkWidgë
 *
gtkli°
,

1674 
STRUCTCœss
 *
°ru˘˛ass
)

1676 
GLi°
 *
li°
;

1677 
STRUCTCœssDülog
 *
¥›_dülog
;

1678 
GtkObje˘
 *
li°_ôem
;

1679 
STRUCTO≥øti⁄
 *
›
;

1681 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1683 i‡(!
¥›_dülog
)

1686 
	`›î©i⁄s_gë_cuºít_vÆues
(
¥›_dülog
);

1688 
li°
 = 
	`GTK_LIST
(
gtkli°
)->
£À˘i⁄
;

1689 i‡(!
li°
) {

1690 
	`›î©i⁄s_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

1691 
	`›î©i⁄s_˛ór_vÆues
(
¥›_dülog
);

1692 
¥›_dülog
->
cuºít_›
 = 
NULL
;

1696 
li°_ôem
 = 
	`GTK_OBJECT
(
li°
->
d©a
);

1697 
›
 = (
STRUCTO≥øti⁄
 *)
	`gtk_obje˘_gë_u£r_d©a
(
li°_ôem
);

1698 
	`›î©i⁄s_£t_vÆues
(
¥›_dülog
, 
›
);

1699 
	`›î©i⁄s_£t_£nsôive
(
¥›_dülog
, 
TRUE
);

1701 
¥›_dülog
->
cuºít_›
 = 
	`GTK_LIST_ITEM
(
li°_ôem
);

1702 
	`gtk_widgë_gøb_focus
(
	`GTK_WIDGET
(
¥›_dülog
->
›_«me
));

1703 
	}
}

1706 
	$›î©i⁄s_li°_√w_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

1707 
STRUCTCœss
 *
°ru˘˛ass
)

1709 
GLi°
 *
li°
;

1710 
STRUCTCœssDülog
 *
¥›_dülog
;

1711 
GtkWidgë
 *
li°_ôem
;

1712 
STRUCTO≥øti⁄
 *
›
;

1713 *
utf°r
;

1715 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1717 
	`›î©i⁄s_gë_cuºít_vÆues
(
¥›_dülog
);

1719 
›
 = 
	`°ru˘_›î©i⁄_√w
();

1721 
	`°ru˘_›î©i⁄_ísuª_c⁄√˘i⁄_poöts
 (
›
, &
°ru˘˛ass
->
ñemít
.
obje˘
);

1722 
¥›_dülog
->
added_c⁄√˘i⁄s
 =

1723 
	`g_li°_¥ïíd
(
¥›_dülog
->
added_c⁄√˘i⁄s
, 
›
->
À·_c⁄√˘i⁄
);

1724 
¥›_dülog
->
added_c⁄√˘i⁄s
 =

1725 
	`g_li°_¥ïíd
(
¥›_dülog
->
added_c⁄√˘i⁄s
, 
›
->
right_c⁄√˘i⁄
);

1728 
utf°r
 = 
	`°ru˘_gë_›î©i⁄_°rög
 (
›
);

1729 
li°_ôem
 = 
	`gtk_li°_ôem_√w_wôh_œbñ
 (
utf°r
);

1730 
	`gtk_widgë_show
 (
li°_ôem
);

1731 
	`g_‰ì
 (
utf°r
);

1733 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), 
›
);

1734 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°_ôem
), "destroy",

1735 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_li°_ôem_de°roy_ˇŒback
),

1736 
NULL
);

1738 
li°
 = 
	`g_li°_≠≥nd
(
NULL
, 
li°_ôem
);

1739 
	`gtk_li°_≠≥nd_ôems
(
¥›_dülog
->
›î©i⁄s_li°
, 
li°
);

1741 i‡(
¥›_dülog
->
›î©i⁄s_li°
->
chûdªn
 !
NULL
)

1742 
	`gtk_li°_un£À˘_chûd
(
¥›_dülog
->
›î©i⁄s_li°
,

1743 
	`GTK_WIDGET
(
¥›_dülog
->
›î©i⁄s_li°
->
chûdªn
->
d©a
));

1744 
	`gtk_li°_£À˘_chûd
(
¥›_dülog
->
›î©i⁄s_li°
, 
li°_ôem
);

1745 
	}
}

1748 
	$›î©i⁄s_li°_dñëe_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

1749 
STRUCTCœss
 *
°ru˘˛ass
)

1751 
GLi°
 *
li°
;

1752 
STRUCTCœssDülog
 *
¥›_dülog
;

1753 
GtkLi°
 *
gtkli°
;

1754 
STRUCTO≥øti⁄
 *
›
;

1757 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1758 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
›î©i⁄s_li°
);

1760 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

1761 
›
 = (
STRUCTO≥øti⁄
 *)

1762 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
gtkli°
->
£À˘i⁄
->
d©a
));

1764 i‡(
›
->
À·_c⁄√˘i⁄
 !
NULL
) {

1765 
¥›_dülog
->
dñëed_c⁄√˘i⁄s
 =

1766 
	`g_li°_¥ïíd
(
¥›_dülog
->
dñëed_c⁄√˘i⁄s
,

1767 
›
->
À·_c⁄√˘i⁄
);

1768 
¥›_dülog
->
dñëed_c⁄√˘i⁄s
 =

1769 
	`g_li°_¥ïíd
(
¥›_dülog
->
dñëed_c⁄√˘i⁄s
,

1770 
›
->
right_c⁄√˘i⁄
);

1773 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
gtkli°
->
£À˘i⁄
->
d©a
);

1774 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

1775 
	`g_li°_‰ì
(
li°
);

1776 
	`›î©i⁄s_˛ór_vÆues
(
¥›_dülog
);

1777 
	`›î©i⁄s_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

1779 
	}
}

1782 
	$›î©i⁄s_li°_move_up_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

1783 
STRUCTCœss
 *
°ru˘˛ass
)

1785 
GLi°
 *
li°
;

1786 
STRUCTCœssDülog
 *
¥›_dülog
;

1787 
GtkLi°
 *
gtkli°
;

1788 
GtkWidgë
 *
li°_ôem
;

1789 
i
;

1791 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1792 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
›î©i⁄s_li°
);

1794 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

1795 
li°_ôem
 = 
	`GTK_WIDGET
(
gtkli°
->
£À˘i⁄
->
d©a
);

1797 
i
 = 
	`gtk_li°_chûd_posôi⁄
(
gtkli°
, 
li°_ôem
);

1798 i‡(
i
>0)

1799 
i
--;

1801 
	`gtk_widgë_ªf
(
li°_ôem
);

1802 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
li°_ôem
);

1803 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

1804 
	`gtk_li°_ö£π_ôems
(
gtkli°
, 
li°
, 
i
);

1805 
	`gtk_widgë_uƒef
(
li°_ôem
);

1807 
	`gtk_li°_£À˘_chûd
(
gtkli°
, 
li°_ôem
);

1810 
	}
}

1813 
	$›î©i⁄s_li°_move_down_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

1814 
STRUCTCœss
 *
°ru˘˛ass
)

1816 
GLi°
 *
li°
;

1817 
STRUCTCœssDülog
 *
¥›_dülog
;

1818 
GtkLi°
 *
gtkli°
;

1819 
GtkWidgë
 *
li°_ôem
;

1820 
i
;

1822 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1823 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
›î©i⁄s_li°
);

1825 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

1826 
li°_ôem
 = 
	`GTK_WIDGET
(
gtkli°
->
£À˘i⁄
->
d©a
);

1828 
i
 = 
	`gtk_li°_chûd_posôi⁄
(
gtkli°
, 
li°_ôem
);

1829 i‡(
i
<(
	`g_li°_Àngth
(
gtkli°
->
chûdªn
)-1))

1830 
i
++;

1832 
	`gtk_widgë_ªf
(
li°_ôem
);

1833 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
li°_ôem
);

1834 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

1835 
	`gtk_li°_ö£π_ôems
(
gtkli°
, 
li°
, 
i
);

1836 
	`gtk_widgë_uƒef
(
li°_ôem
);

1838 
	`gtk_li°_£À˘_chûd
(
gtkli°
, 
li°_ôem
);

1840 
	}
}

1843 
	$›î©i⁄s_ªad_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
,

1844 
STRUCTCœssDülog
 *
¥›_dülog
,

1845 
c⁄√˘i⁄_ödex
)

1847 
GLi°
 *
li°
;

1848 
STRUCTO≥øti⁄
 *
›
;

1849 
GtkWidgë
 *
li°_ôem
;

1850 
GLi°
 *
˛ór_li°
;

1851 
DüObje˘
 *
obj
;

1853 
obj
 = &
°ru˘˛ass
->
ñemít
.
obje˘
;

1856 
	`›î©i⁄s_gë_cuºít_vÆues
(
¥›_dülog
);

1859 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

1860 
li°
 !
NULL
) {

1861 
›
 = (
STRUCTO≥øti⁄
 *)
li°
->
d©a
;

1862 
	`°ru˘_›î©i⁄_de°roy
(
›
);

1863 
li°
 = 
	`g_li°_√xt
(list);

1865 
	`g_li°_‰ì
 (
°ru˘˛ass
->
›î©i⁄s
);

1866 
°ru˘˛ass
->
›î©i⁄s
 = 
NULL
;

1869 
li°
 = 
	`GTK_LIST
 (
¥›_dülog
->
›î©i⁄s_li°
)->
chûdªn
;

1870 
˛ór_li°
 = 
NULL
;

1871 
li°
 !
NULL
) {

1872 
li°_ôem
 = 
	`GTK_WIDGET
(
li°
->
d©a
);

1874 
˛ór_li°
 = 
	`g_li°_¥ïíd
 (˛ór_li°, 
li°_ôem
);

1875 
›
 = (
STRUCTO≥øti⁄
 *)

1876 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
));

1877 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), 
NULL
);

1878 
°ru˘˛ass
->
›î©i⁄s
 = 
	`g_li°_≠≥nd
(°ru˘˛ass->›î©i⁄s, 
›
);

1880 i‡(
›
->
À·_c⁄√˘i⁄
 =
NULL
) {

1881 
	`°ru˘_›î©i⁄_ísuª_c⁄√˘i⁄_poöts
 (
›
, 
obj
);

1883 
¥›_dülog
->
added_c⁄√˘i⁄s
 =

1884 
	`g_li°_¥ïíd
(
¥›_dülog
->
added_c⁄√˘i⁄s
,

1885 
›
->
À·_c⁄√˘i⁄
);

1886 
¥›_dülog
->
added_c⁄√˘i⁄s
 =

1887 
	`g_li°_¥ïíd
(
¥›_dülog
->
added_c⁄√˘i⁄s
,

1888 
›
->
right_c⁄√˘i⁄
);

1891 i‡–(
¥›_dülog
->
›_vis
->
a˘ive
) &&

1892 (!
¥›_dülog
->
›_suµ
->
a˘ive
) ) {

1893 
obj
->
c⁄√˘i⁄s
[
c⁄√˘i⁄_ödex
] = 
›
->
À·_c⁄√˘i⁄
;

1894 
c⁄√˘i⁄_ödex
++;

1895 
obj
->
c⁄√˘i⁄s
[
c⁄√˘i⁄_ödex
] = 
›
->
right_c⁄√˘i⁄
;

1896 
c⁄√˘i⁄_ödex
++;

1898 
	`°ru˘˛ass_°‹e_disc⁄√˘s
(
¥›_dülog
, 
›
->
À·_c⁄√˘i⁄
);

1899 
	`obje˘_ªmove_c⁄√˘i⁄s_to
(
›
->
À·_c⁄√˘i⁄
);

1900 
	`°ru˘˛ass_°‹e_disc⁄√˘s
(
¥›_dülog
, 
›
->
right_c⁄√˘i⁄
);

1901 
	`obje˘_ªmove_c⁄√˘i⁄s_to
(
›
->
right_c⁄√˘i⁄
);

1904 
li°
 = 
	`g_li°_√xt
(list);

1906 
˛ór_li°
 = 
	`g_li°_ªvî£
 (clear_list);

1907 
	`gtk_li°_ªmove_ôems
 (
	`GTK_LIST
 (
¥›_dülog
->
›î©i⁄s_li°
), 
˛ór_li°
);

1908 
	`g_li°_‰ì
 (
˛ór_li°
);

1909 
	}
}

1912 
	$›î©i⁄s_fûl_ö_dülog
(
STRUCTCœss
 *
°ru˘˛ass
)

1914 
STRUCTCœssDülog
 *
¥›_dülog
;

1915 
STRUCTO≥øti⁄
 *
›_c›y
;

1916 
GtkWidgë
 *
li°_ôem
;

1917 
GLi°
 *
li°
;

1918 
i
;

1920 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1922 i‡(
¥›_dülog
->
›î©i⁄s_li°
->
chûdªn
 =
NULL
) {

1923 
i
 = 0;

1924 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

1925 
li°
 !
NULL
) {

1926 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *)
li°
->
d©a
;

1927 
gch¨
 *
›°r
 = 
	`°ru˘_gë_›î©i⁄_°rög
 (
›
);

1929 
li°_ôem
 = 
	`gtk_li°_ôem_√w_wôh_œbñ
 (
›°r
);

1930 
›_c›y
 = 
	`°ru˘_›î©i⁄_c›y
 (
›
);

1932 
›_c›y
->
À·_c⁄√˘i⁄
 = 
›
->left_connection;

1933 
›_c›y
->
right_c⁄√˘i⁄
 = 
›
->right_connection;

1934 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), (
gpoöãr
Ë
›_c›y
);

1935 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°_ôem
), "destroy",

1936 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_li°_ôem_de°roy_ˇŒback
),

1937 
NULL
);

1938 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
¥›_dülog
->
›î©i⁄s_li°
), 
li°_ôem
);

1939 
	`gtk_widgë_show
 (
li°_ôem
);

1941 
li°
 = 
	`g_li°_√xt
÷i°); 
i
++;

1942 
	`g_‰ì
 (
›°r
);

1946 
¥›_dülog
->
cuºít_›
 = 
NULL
;

1947 
	`›î©i⁄s_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

1948 
	`›î©i⁄s_˛ór_vÆues
(
¥›_dülog
);

1950 
	}
}

1953 
	$›î©i⁄s_upd©e
(
GtkWidgë
 *
widgë
, 
STRUCTCœss
 *
°ru˘˛ass
)

1955 
	`›î©i⁄s_gë_cuºít_vÆues
(
°ru˘˛ass
->
¥›îtõs_dülog
);

1956 
	}
}

1959 
	$›î©i⁄s_upd©e_evít
(
GtkWidgë
 *
widgë
, 
GdkEvítFocus
 *
ev
, 
STRUCTCœss
 *
°ru˘˛ass
)

1961 
	`›î©i⁄s_gë_cuºít_vÆues
(
°ru˘˛ass
->
¥›îtõs_dülog
);

1963 
	}
}

1965 
GtkWidgë
*

1966 
	$›î©i⁄s_d©a_¸óã_hbox
 (
STRUCTCœss
 *
°ru˘˛ass
)

1968 
STRUCTCœssDülog
 *
¥›_dülog
;

1969 
GtkWidgë
 *
hbox
;

1970 
GtkWidgë
 *
vbox2
;

1971 
GtkWidgë
 *
èbÀ
;

1972 
GtkWidgë
 *
œbñ
;

1973 
GtkWidgë
 *
íåy
;

1974 
GtkWidgë
 *
omíu
;

1975 
GtkWidgë
 *
míu
;

1976 
GtkWidgë
 *
submíu
;

1977 
GtkWidgë
 *
s¸ﬁÀdwödow
;

1978 
GtkWidgë
 *
checkbox
;

1979 
GSLi°
 *
group
;

1981 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

1983 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

1984 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
hbox
), 5);

1986 
vbox2
 = 
	`gtk_vbox_√w
(
FALSE
, 0);

1989 
èbÀ
 = 
	`gtk_èbÀ_√w
 (5, 3, 
FALSE
);

1990 
	`gtk_èbÀ_£t_cﬁ_•acögs
 (
	`GTK_TABLE
 (
èbÀ
), 5);

1991 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
èbÀ
, 
FALSE
, FALSE, 0);

1993 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Name:"));

1994 
íåy
 = 
	`gtk_íåy_√w
();

1995 
¥›_dülog
->
›_«me
 = 
	`GTK_ENTRY
(
íåy
);

1996 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

1997 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e_evít
), 
°ru˘˛ass
);

1998 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

1999 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
);

2000 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2001 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,0,1, 
GTK_FILL
,0, 0,0);

2002 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,0,1, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2004 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Type:"));

2005 
íåy
 = 
	`gtk_íåy_√w
();

2006 
¥›_dülog
->
›_ty≥
 = 
	`GTK_ENTRY
(
íåy
);

2007 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

2008 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e_evít
), 
°ru˘˛ass
);

2009 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

2010 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
);

2011 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2012 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,1,2, 
GTK_FILL
,0, 0,0);

2013 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,1,2, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2015 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Stereotype:"));

2016 
íåy
 = 
	`gtk_íåy_√w
();

2017 
¥›_dülog
->
›_°îeŸy≥
 = 
	`GTK_ENTRY
(
íåy
);

2018 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

2019 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e_evít
), 
°ru˘˛ass
);

2020 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

2021 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
);

2022 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2023 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,2,3, 
GTK_FILL
,0, 0,0);

2024 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,2,3, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2027 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Visibility:"));

2029 
omíu
 = 
	`gtk_›ti⁄_míu_√w
 ();

2030 
míu
 = 
	`gtk_míu_√w
 ();

2031 
¥›_dülog
->
›_visibÀ
 = 
	`GTK_MENU
(
míu
);

2032 
¥›_dülog
->
›_visibÀ_buâ⁄
 = 
	`GTK_OPTION_MENU
(
omíu
);

2033 
submíu
 = 
NULL
;

2034 
group
 = 
NULL
;

2036 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Public"),

2037 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2038 
	`GINT_TO_POINTER
(
STRUCT_PUBLIC
) );

2039 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Private"),

2040 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2041 
	`GINT_TO_POINTER
(
STRUCT_PRIVATE
) );

2042 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Protected"),

2043 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2044 
	`GINT_TO_POINTER
(
STRUCT_PROTECTED
) );

2045 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Implementation"),

2046 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2047 
	`GINT_TO_POINTER
(
STRUCT_IMPLEMENTATION
) );

2049 
	`gtk_›ti⁄_míu_£t_míu
 (
	`GTK_OPTION_MENU
 (
omíu
), 
míu
);

2051 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2053 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 2,3,0,1, 
GTK_FILL
,0, 0,0);

2054 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
omíu
, 3,4,0,1, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2057 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("InheritanceÅype:"));

2059 
omíu
 = 
	`gtk_›ti⁄_míu_√w
 ();

2060 
míu
 = 
	`gtk_míu_√w
 ();

2061 
¥›_dülog
->
›_öhîô™˚_ty≥
 = 
	`GTK_MENU
(
míu
);

2062 
¥›_dülog
->
›_öhîô™˚_ty≥_buâ⁄
 = 
	`GTK_OPTION_MENU
(
omíu
);

2063 
submíu
 = 
NULL
;

2064 
group
 = 
NULL
;

2066 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Abstract"),

2067 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2068 
	`GINT_TO_POINTER
(
STRUCT_ABSTRACT
) );

2069 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Polymorphic (virtual)"),

2070 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2071 
	`GINT_TO_POINTER
(
STRUCT_POLYMORPHIC
) );

2072 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Leaf (final)"),

2073 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2074 
	`GINT_TO_POINTER
(
STRUCT_LEAF
) );

2076 
	`gtk_›ti⁄_míu_£t_míu
 (
	`GTK_OPTION_MENU
 (
omíu
), 
míu
);

2078 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 2,3,1,2, 
GTK_FILL
,0, 0,0);

2079 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
omíu
, 3,4,1,2, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2082 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Class scope"));

2083 
¥›_dülog
->
›_˛ass_sc›e
 = 
	`GTK_TOGGLE_BUTTON
(
checkbox
);

2084 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
checkbox
, 2,3,2,3, 
GTK_FILL
,0, 0,2);

2086 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Query"));

2087 
¥›_dülog
->
›_quîy
 = 
	`GTK_TOGGLE_BUTTON
(
checkbox
);

2088 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
checkbox
, 3,4,2,3, 
GTK_FILL
,0, 2,0);

2090 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Comment:"));

2091 
s¸ﬁÀdwödow
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

2092 
	`gtk_s¸ﬁÀd_wödow_£t_shadow_ty≥
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀdwödow
), 
GTK_SHADOW_IN
);

2094 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀdwödow
), 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

2096 
íåy
 = 
	`gtk_ãxt_võw_√w
 ();

2097 
¥›_dülog
->
›_commít
 = 
	`GTK_TEXT_VIEW
(
íåy
);

2098 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
s¸ﬁÀdwödow
), 
íåy
);

2099 
	`gtk_ãxt_võw_£t_wøp_mode
 (
	`GTK_TEXT_VIEW
 (
íåy
), 
GTK_WRAP_WORD
);

2100 
	`gtk_ãxt_võw_£t_curs‹_visibÀ
(
	`GTK_TEXT_VIEW
 (
íåy
),
TRUE
);

2102 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

2103 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e_evít
), 
°ru˘˛ass
);

2105 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

2106 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
);

2108 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 4,5,0,1, 
GTK_FILL
,0, 0,0);

2109 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
s¸ﬁÀdwödow
, 4,5,1,3, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,0);

2110 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
vbox2
, 
TRUE
, TRUE, 0);

2112  
hbox
;

2113 
	}
}

2115 
GtkWidgë
*

2116 
	$›î©i⁄s_∑ømëîs_edô‹_¸óã_vbox
 (
STRUCTCœss
 *
°ru˘˛ass
)

2118 
STRUCTCœssDülog
 *
¥›_dülog
;

2119 
GtkWidgë
 *
vbox2
;

2120 
GtkWidgë
 *
hbox2
;

2121 
GtkWidgë
 *
vbox3
;

2122 
GtkWidgë
 *
œbñ
;

2123 
GtkWidgë
 *
s¸ﬁÀd_wö
;

2124 
GtkWidgë
 *
li°
;

2125 
GtkWidgë
 *
buâ⁄
;

2127 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2129 
vbox2
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

2131 
hbox2
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

2133 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Parameters:"));

2134 
	`gtk_box_∑ck_°¨t
–
	`GTK_BOX
(
hbox2
), 
œbñ
, 
FALSE
, 
TRUE
, 0);

2136 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
hbox2
, 
TRUE
, TRUE, 0);

2139 
hbox2
 = 
	`gtk_hbox_√w
(
TRUE
, 5);

2141 
s¸ﬁÀd_wö
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

2142 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
),

2143 
GTK_POLICY_AUTOMATIC
,

2144 
GTK_POLICY_AUTOMATIC
);

2145 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox2
), 
s¸ﬁÀd_wö
, 
TRUE
, TRUE, 0);

2146 
	`gtk_widgë_show
 (
s¸ﬁÀd_wö
);

2148 
li°
 = 
	`gtk_li°_√w
 ();

2149 
¥›_dülog
->
∑ømëîs_li°
 = 
	`GTK_LIST
(
li°
);

2150 
	`gtk_li°_£t_£À˘i⁄_mode
 (
	`GTK_LIST
 (
li°
), 
GTK_SELECTION_SINGLE
);

2151 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
), 
li°
);

2152 
	`gtk_c⁄èöî_£t_focus_vadju°mít
 (
	`GTK_CONTAINER
 (
li°
),

2153 
	`gtk_s¸ﬁÀd_wödow_gë_vadju°mít
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
)));

2154 
	`gtk_widgë_show
 (
li°
);

2156 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°
), "selection_changed",

2157 
	`GTK_SIGNAL_FUNC
(
∑ømëîs_li°_£À˘i⁄_ch™ged_ˇŒback
),

2158 
°ru˘˛ass
);

2160 
vbox3
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

2162 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_NEW
);

2163 
¥›_dülog
->
∑øm_√w_buâ⁄
 = 
buâ⁄
;

2164 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2165 
	`GTK_SIGNAL_FUNC
(
∑ømëîs_li°_√w_ˇŒback
),

2166 
°ru˘˛ass
);

2167 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox3
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2168 
	`gtk_widgë_show
 (
buâ⁄
);

2169 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_DELETE
);

2170 
¥›_dülog
->
∑øm_dñëe_buâ⁄
 = 
buâ⁄
;

2171 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2172 
	`GTK_SIGNAL_FUNC
(
∑ømëîs_li°_dñëe_ˇŒback
),

2173 
°ru˘˛ass
);

2174 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox3
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2175 
	`gtk_widgë_show
 (
buâ⁄
);

2176 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_UP
);

2177 
¥›_dülog
->
∑øm_up_buâ⁄
 = 
buâ⁄
;

2178 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2179 
	`GTK_SIGNAL_FUNC
(
∑ømëîs_li°_move_up_ˇŒback
),

2180 
°ru˘˛ass
);

2181 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox3
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2182 
	`gtk_widgë_show
 (
buâ⁄
);

2183 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_DOWN
);

2184 
¥›_dülog
->
∑øm_down_buâ⁄
 = 
buâ⁄
;

2185 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2186 
	`GTK_SIGNAL_FUNC
(
∑ømëîs_li°_move_down_ˇŒback
),

2187 
°ru˘˛ass
);

2188 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox3
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2189 
	`gtk_widgë_show
 (
buâ⁄
);

2191 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox2
), 
vbox3
, 
FALSE
, 
TRUE
, 0);

2193 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
hbox2
, 
TRUE
, TRUE, 0);

2196  
vbox2
;

2197 
	}
}

2199 
GtkWidgë
*

2200 
	$›î©i⁄s_∑ømëîs_d©a_¸óã_vbox
 (
STRUCTCœss
 *
°ru˘˛ass
)

2202 
STRUCTCœssDülog
 *
¥›_dülog
;

2203 
GtkWidgë
 *
vbox2
;

2204 
GtkWidgë
 *
‰ame
;

2205 
GtkWidgë
 *
vbox3
;

2206 
GtkWidgë
 *
èbÀ
;

2207 
GtkWidgë
 *
œbñ
;

2208 
GtkWidgë
 *
íåy
;

2209 
GtkWidgë
 *
s¸ﬁÀdwödow
;

2210 
GtkWidgë
 *
omíu
;

2211 
GtkWidgë
 *
míu
;

2212 
GtkWidgë
 *
submíu
;

2213 
GSLi°
 *
group
;

2215 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2217 
vbox2
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

2218 
‰ame
 = 
	`gtk_‰ame_√w
(
	`_
("Parameter data"));

2219 
vbox3
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

2220 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox3
), 5);

2221 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame
), 
vbox3
);

2222 
	`gtk_widgë_show
(
‰ame
);

2223 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
‰ame
, 
FALSE
, 
TRUE
, 0);

2225 
èbÀ
 = 
	`gtk_èbÀ_√w
 (3, 4, 
FALSE
);

2226 
	`gtk_èbÀ_£t_cﬁ_•acögs
 (
	`GTK_TABLE
 (
èbÀ
), 5);

2227 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox3
), 
èbÀ
, 
FALSE
, FALSE, 0);

2229 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Name:"));

2230 
íåy
 = 
	`gtk_íåy_√w
();

2231 
¥›_dülog
->
∑øm_«me
 = 
	`GTK_ENTRY
(
íåy
);

2232 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

2233 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e_evít
), 
°ru˘˛ass
);

2234 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

2235 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
);

2236 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2237 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,0,1, 
GTK_FILL
,0, 0,0);

2238 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,0,1, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2240 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Type:"));

2241 
íåy
 = 
	`gtk_íåy_√w
();

2242 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

2243 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e_evít
), 
°ru˘˛ass
);

2244 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

2245 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
);

2246 
¥›_dülog
->
∑øm_ty≥
 = 
	`GTK_ENTRY
(
íåy
);

2247 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2248 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,1,2, 
GTK_FILL
,0, 0,0);

2249 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,1,2, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2251 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Def. value:"));

2252 
íåy
 = 
	`gtk_íåy_√w
();

2253 
¥›_dülog
->
∑øm_vÆue
 = 
	`GTK_ENTRY
(
íåy
);

2254 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

2255 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e_evít
), 
°ru˘˛ass
);

2256 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

2257 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
);

2258 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2259 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,2,3, 
GTK_FILL
,0, 0,0);

2260 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,2,3, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2262 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Comment:"));

2263 
s¸ﬁÀdwödow
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

2264 
	`gtk_s¸ﬁÀd_wödow_£t_shadow_ty≥
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀdwödow
),

2265 
GTK_SHADOW_IN
);

2266 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀdwödow
),

2267 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

2269 
íåy
 = 
	`gtk_ãxt_võw_√w
 ();

2270 
¥›_dülog
->
∑øm_commít
 = 
	`GTK_TEXT_VIEW
(
íåy
);

2271 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
s¸ﬁÀdwödow
), 
íåy
);

2272 
	`gtk_ãxt_võw_£t_wøp_mode
 (
	`GTK_TEXT_VIEW
 (
íåy
), 
GTK_WRAP_WORD
);

2273 
	`gtk_ãxt_võw_£t_curs‹_visibÀ
(
	`GTK_TEXT_VIEW
 (
íåy
),
TRUE
);

2275 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

2276 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e_evít
), 
°ru˘˛ass
);

2278 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

2279 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
);

2281 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2282 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 2,3,1,2, 
GTK_FILL
,0, 0,0);

2283 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
s¸ﬁÀdwödow
, 3,4,1,3, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2285 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Direction:"));

2287 
omíu
 = 
	`gtk_›ti⁄_míu_√w
 ();

2288 
míu
 = 
	`gtk_míu_√w
 ();

2289 
¥›_dülog
->
∑øm_köd
 = 
	`GTK_MENU
(
míu
);

2290 
¥›_dülog
->
∑øm_köd_buâ⁄
 = 
	`GTK_OPTION_MENU
(
omíu
);

2291 
submíu
 = 
NULL
;

2292 
group
 = 
NULL
;

2294 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Undefined"),

2295 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2296 
	`GINT_TO_POINTER
(
STRUCT_UNDEF_KIND
) );

2297 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("In"),

2298 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2299 
	`GINT_TO_POINTER
(
STRUCT_IN
) );

2300 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("Out"),

2301 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2302 
	`GINT_TO_POINTER
(
STRUCT_OUT
) );

2303 
	`add_›ti⁄_míu_ôem
(
	`GTK_MENU
(
míu
), 
	`_
("In & Out"),

2304 
	`GTK_SIGNAL_FUNC
 (
›î©i⁄s_upd©e
), 
°ru˘˛ass
,

2305 
	`GINT_TO_POINTER
(
STRUCT_INOUT
) );

2307 
	`gtk_›ti⁄_míu_£t_míu
 (
	`GTK_OPTION_MENU
 (
omíu
), 
míu
);

2310 
GtkWidgë
 * 
Æign
;

2311 
Æign
 = 
	`gtk_Æignmít_√w
(0.0, 0.5, 0.0, 0.0);

2312 
	`gtk_c⁄èöî_add
(
	`GTK_CONTAINER
(
Æign
), 
omíu
);

2313 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2314 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 2,3,0,1, 
GTK_FILL
,0, 0,3);

2315 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
Æign
, 3,4,0,1, 
GTK_FILL
,0, 0,3);

2318  
vbox2
;

2319 
	}
}

2322 
	$›î©i⁄s_¸óã_∑ge
(
GtkNŸebook
 *
nŸebook
, 
STRUCTCœss
 *
°ru˘˛ass
)

2324 
STRUCTCœssDülog
 *
¥›_dülog
;

2325 
GtkWidgë
 *
∑ge_œbñ
;

2326 
GtkWidgë
 *
hbox
;

2327 
GtkWidgë
 *
vbox
;

2328 
GtkWidgë
 *
vbox2
;

2329 
GtkWidgë
 *
vbox3
;

2330 
GtkWidgë
 *
s¸ﬁÀd_wö
;

2331 
GtkWidgë
 *
buâ⁄
;

2332 
GtkWidgë
 *
li°
;

2333 
GtkWidgë
 *
‰ame
;

2335 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2338 
∑ge_œbñ
 = 
	`gtk_œbñ_√w_wôh_m√m⁄ic
 (
	`_
("_Operations"));

2340 
vbox
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

2341 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox
), 10);

2343 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

2345 
s¸ﬁÀd_wö
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

2346 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
),

2347 
GTK_POLICY_AUTOMATIC
,

2348 
GTK_POLICY_AUTOMATIC
);

2349 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
s¸ﬁÀd_wö
, 
TRUE
, TRUE, 0);

2350 
	`gtk_widgë_show
 (
s¸ﬁÀd_wö
);

2352 
li°
 = 
	`gtk_li°_√w
 ();

2353 
¥›_dülog
->
›î©i⁄s_li°
 = 
	`GTK_LIST
(
li°
);

2354 
	`gtk_li°_£t_£À˘i⁄_mode
 (
	`GTK_LIST
 (
li°
), 
GTK_SELECTION_SINGLE
);

2355 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
), 
li°
);

2356 
	`gtk_c⁄èöî_£t_focus_vadju°mít
 (
	`GTK_CONTAINER
 (
li°
),

2357 
	`gtk_s¸ﬁÀd_wödow_gë_vadju°mít
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
)));

2358 
	`gtk_widgë_show
 (
li°
);

2360 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°
), "selection_changed",

2361 
	`GTK_SIGNAL_FUNC
(
›î©i⁄s_li°_£À˘i⁄_ch™ged_ˇŒback
),

2362 
°ru˘˛ass
);

2364 
vbox2
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

2366 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_NEW
);

2367 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2368 
	`GTK_SIGNAL_FUNC
(
›î©i⁄s_li°_√w_ˇŒback
),

2369 
°ru˘˛ass
);

2370 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2371 
	`gtk_widgë_show
 (
buâ⁄
);

2372 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_DELETE
);

2373 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2374 
	`GTK_SIGNAL_FUNC
(
›î©i⁄s_li°_dñëe_ˇŒback
),

2375 
°ru˘˛ass
);

2376 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2377 
	`gtk_widgë_show
 (
buâ⁄
);

2378 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_UP
);

2379 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2380 
	`GTK_SIGNAL_FUNC
(
›î©i⁄s_li°_move_up_ˇŒback
),

2381 
°ru˘˛ass
);

2382 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2383 
	`gtk_widgë_show
 (
buâ⁄
);

2384 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_DOWN
);

2385 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2386 
	`GTK_SIGNAL_FUNC
(
›î©i⁄s_li°_move_down_ˇŒback
),

2387 
°ru˘˛ass
);

2389 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2390 
	`gtk_widgë_show
 (
buâ⁄
);

2392 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
vbox2
, 
FALSE
, 
TRUE
, 0);

2394 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
TRUE
, TRUE, 0);

2396 
‰ame
 = 
	`gtk_‰ame_√w
(
	`_
("Operation data"));

2397 
vbox2
 = 
	`gtk_vbox_√w
(
FALSE
, 0);

2398 
hbox
 = 
	`›î©i⁄s_d©a_¸óã_hbox
 (
°ru˘˛ass
);

2399 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
hbox
, 
TRUE
, TRUE, 0);

2400 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame
), 
vbox2
);

2401 
	`gtk_widgë_show
(
‰ame
);

2402 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
‰ame
, 
FALSE
, 
TRUE
, 0);

2405 
hbox
 = 
	`gtk_hbox_√w
 (
FALSE
, 5);

2406 
vbox3
 = 
	`›î©i⁄s_∑ømëîs_edô‹_¸óã_vbox
 (
°ru˘˛ass
);

2407 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
vbox3
, 
TRUE
, TRUE, 5);

2409 
vbox3
 = 
	`›î©i⁄s_∑ømëîs_d©a_¸óã_vbox
 (
°ru˘˛ass
);

2410 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
vbox3
, 
TRUE
, TRUE, 5);

2412 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
hbox
, 
TRUE
, TRUE, 5);

2414 
	`gtk_widgë_show_Æl
 (
vbox
);

2415 
	`gtk_widgë_show
 (
∑ge_œbñ
);

2416 
	`gtk_nŸebook_≠≥nd_∑ge
 (
nŸebook
, 
vbox
, 
∑ge_œbñ
);

2417 
	}
}

2424 
	$ãm∂©es_£t_£nsôive
(
STRUCTCœssDülog
 *
¥›_dülog
, 
göt
 
vÆ
)

2426 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
ãm∂_«me
), 
vÆ
);

2427 
	`gtk_widgë_£t_£nsôive
(
	`GTK_WIDGET
(
¥›_dülog
->
ãm∂_ty≥
), 
vÆ
);

2428 
	}
}

2431 
	$ãm∂©es_£t_vÆues
 (
STRUCTCœssDülog
 *
¥›_dülog
,

2432 
STRUCTF‹mÆP¨amëî
 *
∑øm
)

2434 i‡(
∑øm
->
«me
)

2435 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
ãm∂_«me
, 
∑øm
->
«me
);

2436 i‡(
∑øm
->
ty≥
 !
NULL
)

2437 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
ãm∂_ty≥
, 
∑øm
->
ty≥
);

2438 
	}
}

2441 
	$ãm∂©es_˛ór_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
)

2443 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
ãm∂_«me
, "");

2444 
	`gtk_íåy_£t_ãxt
(
¥›_dülog
->
ãm∂_ty≥
, "");

2445 
	}
}

2448 
	$ãm∂©es_gë_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
, 
STRUCTF‹mÆP¨amëî
 *
∑øm
)

2450 
	`g_‰ì
(
∑øm
->
«me
);

2451 i‡(
∑øm
->
ty≥
 !
NULL
)

2452 
	`g_‰ì
(
∑øm
->
ty≥
);

2454 
∑øm
->
«me
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
¥›_dülog
->
ãm∂_«me
));

2455 
∑øm
->
ty≥
 = 
	`g_°rdup
 (
	`gtk_íåy_gë_ãxt
 (
¥›_dülog
->
ãm∂_ty≥
));

2456 
	}
}

2460 
	$ãm∂©es_gë_cuºít_vÆues
(
STRUCTCœssDülog
 *
¥›_dülog
)

2462 
STRUCTF‹mÆP¨amëî
 *
cuºít_∑øm
;

2463 
GtkLabñ
 *
œbñ
;

2464 
gch¨
* 
√w_°r
;

2466 i‡(
¥›_dülog
->
cuºít_ãm∂
 !
NULL
) {

2467 
cuºít_∑øm
 = (
STRUCTF‹mÆP¨amëî
 *)

2468 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
¥›_dülog
->
cuºít_ãm∂
));

2469 i‡(
cuºít_∑øm
 !
NULL
) {

2470 
	`ãm∂©es_gë_vÆues
(
¥›_dülog
, 
cuºít_∑øm
);

2471 
œbñ
 = 
	`GTK_LABEL
(
	`GTK_BIN
(
¥›_dülog
->
cuºít_ãm∂
)->
chûd
);

2472 
√w_°r
 = 
	`°ru˘_gë_f‹mÆ∑ømëî_°rög
 (
cuºít_∑øm
);

2473 
	`gtk_œbñ_£t_ãxt
(
œbñ
, 
√w_°r
);

2474 
	`g_‰ì
(
√w_°r
);

2477 
	}
}

2480 
	$ãm∂©es_li°_ôem_de°roy_ˇŒback
(
GtkWidgë
 *
li°_ôem
,

2481 
gpoöãr
 
d©a
)

2483 
STRUCTF‹mÆP¨amëî
 *
∑øm
;

2485 
∑øm
 = (
STRUCTF‹mÆP¨amëî
 *)

2486 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
));

2488 i‡(
∑øm
 !
NULL
) {

2489 
	`°ru˘_f‹mÆ∑ømëî_de°roy
(
∑øm
);

2492 
	}
}

2495 
	$ãm∂©es_li°_£À˘i⁄_ch™ged_ˇŒback
(
GtkWidgë
 *
gtkli°
,

2496 
STRUCTCœss
 *
°ru˘˛ass
)

2498 
GLi°
 *
li°
;

2499 
STRUCTCœssDülog
 *
¥›_dülog
;

2500 
GtkObje˘
 *
li°_ôem
;

2501 
STRUCTF‹mÆP¨amëî
 *
∑øm
;

2503 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2505 i‡(!
¥›_dülog
)

2508 
	`ãm∂©es_gë_cuºít_vÆues
(
¥›_dülog
);

2510 
li°
 = 
	`GTK_LIST
(
gtkli°
)->
£À˘i⁄
;

2511 i‡(!
li°
) {

2512 
	`ãm∂©es_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

2513 
	`ãm∂©es_˛ór_vÆues
(
¥›_dülog
);

2514 
¥›_dülog
->
cuºít_ãm∂
 = 
NULL
;

2518 
li°_ôem
 = 
	`GTK_OBJECT
(
li°
->
d©a
);

2519 
∑øm
 = (
STRUCTF‹mÆP¨amëî
 *)
	`gtk_obje˘_gë_u£r_d©a
(
li°_ôem
);

2520 
	`ãm∂©es_£t_vÆues
(
¥›_dülog
, 
∑øm
);

2521 
	`ãm∂©es_£t_£nsôive
(
¥›_dülog
, 
TRUE
);

2523 
¥›_dülog
->
cuºít_ãm∂
 = 
	`GTK_LIST_ITEM
(
li°_ôem
);

2524 
	`gtk_widgë_gøb_focus
(
	`GTK_WIDGET
(
¥›_dülog
->
ãm∂_«me
));

2525 
	}
}

2528 
	$ãm∂©es_li°_√w_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

2529 
STRUCTCœss
 *
°ru˘˛ass
)

2531 
GLi°
 *
li°
;

2532 
STRUCTCœssDülog
 *
¥›_dülog
;

2533 
GtkWidgë
 *
li°_ôem
;

2534 
STRUCTF‹mÆP¨amëî
 *
∑øm
;

2535 *
utf°r
;

2537 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2539 
	`ãm∂©es_gë_cuºít_vÆues
(
¥›_dülog
);

2541 
∑øm
 = 
	`°ru˘_f‹mÆ∑ømëî_√w
();

2543 
utf°r
 = 
	`°ru˘_gë_f‹mÆ∑ømëî_°rög
 (
∑øm
);

2544 
li°_ôem
 = 
	`gtk_li°_ôem_√w_wôh_œbñ
 (
utf°r
);

2545 
	`gtk_widgë_show
 (
li°_ôem
);

2546 
	`g_‰ì
 (
utf°r
);

2548 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), 
∑øm
);

2549 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°_ôem
), "destroy",

2550 
	`GTK_SIGNAL_FUNC
 (
ãm∂©es_li°_ôem_de°roy_ˇŒback
),

2551 
NULL
);

2553 
li°
 = 
	`g_li°_≠≥nd
(
NULL
, 
li°_ôem
);

2554 
	`gtk_li°_≠≥nd_ôems
(
¥›_dülog
->
ãm∂©es_li°
, 
li°
);

2556 i‡(
¥›_dülog
->
ãm∂©es_li°
->
chûdªn
 !
NULL
)

2557 
	`gtk_li°_un£À˘_chûd
(
¥›_dülog
->
ãm∂©es_li°
,

2558 
	`GTK_WIDGET
(
¥›_dülog
->
ãm∂©es_li°
->
chûdªn
->
d©a
));

2559 
	`gtk_li°_£À˘_chûd
(
¥›_dülog
->
ãm∂©es_li°
, 
li°_ôem
);

2560 
	}
}

2563 
	$ãm∂©es_li°_dñëe_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

2564 
STRUCTCœss
 *
°ru˘˛ass
)

2566 
GLi°
 *
li°
;

2567 
STRUCTCœssDülog
 *
¥›_dülog
;

2568 
GtkLi°
 *
gtkli°
;

2570 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2571 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
ãm∂©es_li°
);

2573 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

2574 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
gtkli°
->
£À˘i⁄
->
d©a
);

2575 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

2576 
	`g_li°_‰ì
(
li°
);

2577 
	`ãm∂©es_˛ór_vÆues
(
¥›_dülog
);

2578 
	`ãm∂©es_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

2580 
	}
}

2583 
	$ãm∂©es_li°_move_up_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

2584 
STRUCTCœss
 *
°ru˘˛ass
)

2586 
GLi°
 *
li°
;

2587 
STRUCTCœssDülog
 *
¥›_dülog
;

2588 
GtkLi°
 *
gtkli°
;

2589 
GtkWidgë
 *
li°_ôem
;

2590 
i
;

2592 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2593 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
ãm∂©es_li°
);

2595 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

2596 
li°_ôem
 = 
	`GTK_WIDGET
(
gtkli°
->
£À˘i⁄
->
d©a
);

2598 
i
 = 
	`gtk_li°_chûd_posôi⁄
(
gtkli°
, 
li°_ôem
);

2599 i‡(
i
>0)

2600 
i
--;

2602 
	`gtk_widgë_ªf
(
li°_ôem
);

2603 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
li°_ôem
);

2604 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

2605 
	`gtk_li°_ö£π_ôems
(
gtkli°
, 
li°
, 
i
);

2606 
	`gtk_widgë_uƒef
(
li°_ôem
);

2608 
	`gtk_li°_£À˘_chûd
(
gtkli°
, 
li°_ôem
);

2610 
	}
}

2613 
	$ãm∂©es_li°_move_down_ˇŒback
(
GtkWidgë
 *
buâ⁄
,

2614 
STRUCTCœss
 *
°ru˘˛ass
)

2616 
GLi°
 *
li°
;

2617 
STRUCTCœssDülog
 *
¥›_dülog
;

2618 
GtkLi°
 *
gtkli°
;

2619 
GtkWidgë
 *
li°_ôem
;

2620 
i
;

2622 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2623 
gtkli°
 = 
	`GTK_LIST
(
¥›_dülog
->
ãm∂©es_li°
);

2625 i‡(
gtkli°
->
£À˘i⁄
 !
NULL
) {

2626 
li°_ôem
 = 
	`GTK_WIDGET
(
gtkli°
->
£À˘i⁄
->
d©a
);

2628 
i
 = 
	`gtk_li°_chûd_posôi⁄
(
gtkli°
, 
li°_ôem
);

2629 i‡(
i
<(
	`g_li°_Àngth
(
gtkli°
->
chûdªn
)-1))

2630 
i
++;

2632 
	`gtk_widgë_ªf
(
li°_ôem
);

2633 
li°
 = 
	`g_li°_¥ïíd
(
NULL
, 
li°_ôem
);

2634 
	`gtk_li°_ªmove_ôems
(
gtkli°
, 
li°
);

2635 
	`gtk_li°_ö£π_ôems
(
gtkli°
, 
li°
, 
i
);

2636 
	`gtk_widgë_uƒef
(
li°_ôem
);

2638 
	`gtk_li°_£À˘_chûd
(
gtkli°
, 
li°_ôem
);

2640 
	}
}

2644 
	$ãm∂©es_ªad_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
, 
STRUCTCœssDülog
 *
¥›_dülog
)

2646 
GLi°
 *
li°
;

2647 
STRUCTF‹mÆP¨amëî
 *
∑øm
;

2648 
GtkWidgë
 *
li°_ôem
;

2649 
GLi°
 *
˛ór_li°
;

2651 
	`ãm∂©es_gë_cuºít_vÆues
(
¥›_dülog
);

2653 
°ru˘˛ass
->
ãm∂©e
 = 
¥›_dülog
->
ãm∂_ãm∂©e
->
a˘ive
;

2656 
li°
 = 
°ru˘˛ass
->
f‹mÆ_∑øms
;

2657 
li°
 !
NULL
) {

2658 
∑øm
 = (
STRUCTF‹mÆP¨amëî
 *)
li°
->
d©a
;

2659 
	`°ru˘_f‹mÆ∑ømëî_de°roy
(
∑øm
);

2660 
li°
 = 
	`g_li°_√xt
(list);

2662 
	`g_li°_‰ì
 (
°ru˘˛ass
->
f‹mÆ_∑øms
);

2663 
°ru˘˛ass
->
f‹mÆ_∑øms
 = 
NULL
;

2666 
li°
 = 
	`GTK_LIST
 (
¥›_dülog
->
ãm∂©es_li°
)->
chûdªn
;

2667 
˛ór_li°
 = 
NULL
;

2668 
li°
 !
NULL
) {

2669 
li°_ôem
 = 
	`GTK_WIDGET
(
li°
->
d©a
);

2670 
˛ór_li°
 = 
	`g_li°_¥ïíd
 (˛ór_li°, 
li°_ôem
);

2671 
∑øm
 = (
STRUCTF‹mÆP¨amëî
 *)

2672 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
));

2673 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
), 
NULL
);

2674 
°ru˘˛ass
->
f‹mÆ_∑øms
 = 
	`g_li°_≠≥nd
(°ru˘˛ass->f‹mÆ_∑øms, 
∑øm
);

2675 
li°
 = 
	`g_li°_√xt
(list);

2677 
˛ór_li°
 = 
	`g_li°_ªvî£
 (clear_list);

2678 
	`gtk_li°_ªmove_ôems
 (
	`GTK_LIST
 (
¥›_dülog
->
ãm∂©es_li°
), 
˛ór_li°
);

2679 
	`g_li°_‰ì
 (
˛ór_li°
);

2680 
	}
}

2683 
	$ãm∂©es_fûl_ö_dülog
(
STRUCTCœss
 *
°ru˘˛ass
)

2685 
STRUCTCœssDülog
 *
¥›_dülog
;

2686 
STRUCTF‹mÆP¨amëî
 *
∑øm_c›y
;

2687 
GLi°
 *
li°
;

2688 
GtkWidgë
 *
li°_ôem
;

2689 
i
;

2690 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2692 
	`gtk_toggÀ_buâ⁄_£t_a˘ive
(
¥›_dülog
->
ãm∂_ãm∂©e
, 
°ru˘˛ass
->
ãm∂©e
);

2695 i‡(
¥›_dülog
->
ãm∂©es_li°
->
chûdªn
 =
NULL
) {

2696 
i
 = 0;

2697 
li°
 = 
°ru˘˛ass
->
f‹mÆ_∑øms
;

2698 
li°
 !
NULL
) {

2699 
STRUCTF‹mÆP¨amëî
 *
∑øm
 = (STRUCTF‹mÆP¨amëî *)
li°
->
d©a
;

2700 
gch¨
 *
∑øm°r
 = 
	`°ru˘_gë_f‹mÆ∑ømëî_°rög
(
∑øm
);

2702 
li°_ôem
 = 
	`gtk_li°_ôem_√w_wôh_œbñ
 (
∑øm°r
);

2703 
∑øm_c›y
 = 
	`°ru˘_f‹mÆ∑ømëî_c›y
(
∑øm
);

2704 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
li°_ôem
),

2705 (
gpoöãr
Ë
∑øm_c›y
);

2706 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°_ôem
), "destroy",

2707 
	`GTK_SIGNAL_FUNC
 (
ãm∂©es_li°_ôem_de°roy_ˇŒback
),

2708 
NULL
);

2709 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
¥›_dülog
->
ãm∂©es_li°
),

2710 
li°_ôem
);

2711 
	`gtk_widgë_show
 (
li°_ôem
);

2713 
li°
 = 
	`g_li°_√xt
÷i°); 
i
++;

2714 
	`g_‰ì
 (
∑øm°r
);

2717 
¥›_dülog
->
cuºít_ãm∂
 = 
NULL
;

2718 
	`ãm∂©es_£t_£nsôive
(
¥›_dülog
, 
FALSE
);

2719 
	`ãm∂©es_˛ór_vÆues
(
¥›_dülog
);

2722 
	}
}

2726 
	$ãm∂©es_upd©e
(
GtkWidgë
 *
widgë
, 
STRUCTCœss
 *
°ru˘˛ass
)

2728 
	`ãm∂©es_gë_cuºít_vÆues
(
°ru˘˛ass
->
¥›îtõs_dülog
);

2729 
	}
}

2732 
	$ãm∂©es_upd©e_evít
(
GtkWidgë
 *
widgë
, 
GdkEvítFocus
 *
ev
, 
STRUCTCœss
 *
°ru˘˛ass
)

2734 
	`ãm∂©es_gë_cuºít_vÆues
(
°ru˘˛ass
->
¥›îtõs_dülog
);

2736 
	}
}

2739 
	$ãm∂©es_¸óã_∑ge
(
GtkNŸebook
 *
nŸebook
, 
STRUCTCœss
 *
°ru˘˛ass
)

2741 
STRUCTCœssDülog
 *
¥›_dülog
;

2742 
GtkWidgë
 *
∑ge_œbñ
;

2743 
GtkWidgë
 *
œbñ
;

2744 
GtkWidgë
 *
hbox
;

2745 
GtkWidgë
 *
vbox
;

2746 
GtkWidgë
 *
vbox2
;

2747 
GtkWidgë
 *
hbox2
;

2748 
GtkWidgë
 *
èbÀ
;

2749 
GtkWidgë
 *
íåy
;

2750 
GtkWidgë
 *
checkbox
;

2751 
GtkWidgë
 *
s¸ﬁÀd_wö
;

2752 
GtkWidgë
 *
buâ⁄
;

2753 
GtkWidgë
 *
li°
;

2754 
GtkWidgë
 *
‰ame
;

2756 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2759 
∑ge_œbñ
 = 
	`gtk_œbñ_√w_wôh_m√m⁄ic
 (
	`_
("_Templates"));

2761 
vbox
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

2762 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox
), 10);

2764 
hbox2
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

2765 
checkbox
 = 
	`gtk_check_buâ⁄_√w_wôh_œbñ
(
	`_
("Template class"));

2766 
¥›_dülog
->
ãm∂_ãm∂©e
 = 
	`GTK_TOGGLE_BUTTON
(
checkbox
);

2767 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox2
), 
checkbox
, 
TRUE
, TRUE, 0);

2768 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox2
, 
FALSE
, 
TRUE
, 0);

2770 
hbox
 = 
	`gtk_hbox_√w
(
FALSE
, 5);

2772 
s¸ﬁÀd_wö
 = 
	`gtk_s¸ﬁÀd_wödow_√w
 (
NULL
, NULL);

2773 
	`gtk_s¸ﬁÀd_wödow_£t_pﬁicy
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
),

2774 
GTK_POLICY_AUTOMATIC
,

2775 
GTK_POLICY_AUTOMATIC
);

2776 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
s¸ﬁÀd_wö
, 
TRUE
, TRUE, 0);

2777 
	`gtk_widgë_show
 (
s¸ﬁÀd_wö
);

2779 
li°
 = 
	`gtk_li°_√w
 ();

2780 
¥›_dülog
->
ãm∂©es_li°
 = 
	`GTK_LIST
(
li°
);

2781 
	`gtk_li°_£t_£À˘i⁄_mode
 (
	`GTK_LIST
 (
li°
), 
GTK_SELECTION_SINGLE
);

2782 
	`gtk_s¸ﬁÀd_wödow_add_wôh_võwp‹t
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
), 
li°
);

2783 
	`gtk_c⁄èöî_£t_focus_vadju°mít
 (
	`GTK_CONTAINER
 (
li°
),

2784 
	`gtk_s¸ﬁÀd_wödow_gë_vadju°mít
 (
	`GTK_SCROLLED_WINDOW
 (
s¸ﬁÀd_wö
)));

2785 
	`gtk_widgë_show
 (
li°
);

2787 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
li°
), "selection_changed",

2788 
	`GTK_SIGNAL_FUNC
(
ãm∂©es_li°_£À˘i⁄_ch™ged_ˇŒback
),

2789 
°ru˘˛ass
);

2791 
vbox2
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

2793 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_NEW
);

2794 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2795 
	`GTK_SIGNAL_FUNC
(
ãm∂©es_li°_√w_ˇŒback
),

2796 
°ru˘˛ass
);

2797 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2798 
	`gtk_widgë_show
 (
buâ⁄
);

2799 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_DELETE
);

2800 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2801 
	`GTK_SIGNAL_FUNC
(
ãm∂©es_li°_dñëe_ˇŒback
),

2802 
°ru˘˛ass
);

2803 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2804 
	`gtk_widgë_show
 (
buâ⁄
);

2805 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_UP
);

2806 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2807 
	`GTK_SIGNAL_FUNC
(
ãm∂©es_li°_move_up_ˇŒback
),

2808 
°ru˘˛ass
);

2809 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2810 
	`gtk_widgë_show
 (
buâ⁄
);

2811 
buâ⁄
 = 
	`gtk_buâ⁄_√w_‰om_°ock
 (
GTK_STOCK_GO_DOWN
);

2812 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
buâ⁄
), "clicked",

2813 
	`GTK_SIGNAL_FUNC
(
ãm∂©es_li°_move_down_ˇŒback
),

2814 
°ru˘˛ass
);

2815 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
buâ⁄
, 
FALSE
, 
TRUE
, 0);

2816 
	`gtk_widgë_show
 (
buâ⁄
);

2818 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
hbox
), 
vbox2
, 
FALSE
, 
TRUE
, 0);

2820 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
TRUE
, TRUE, 0);

2822 
‰ame
 = 
	`gtk_‰ame_√w
(
	`_
("FormalÖarameter data"));

2823 
vbox2
 = 
	`gtk_vbox_√w
(
FALSE
, 5);

2824 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
vbox2
), 10);

2825 
	`gtk_c⁄èöî_add
 (
	`GTK_CONTAINER
 (
‰ame
), 
vbox2
);

2826 
	`gtk_widgë_show
(
‰ame
);

2827 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
‰ame
, 
FALSE
, 
TRUE
, 0);

2829 
èbÀ
 = 
	`gtk_èbÀ_√w
 (2, 2, 
FALSE
);

2830 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox2
), 
èbÀ
, 
FALSE
, FALSE, 0);

2832 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Name:"));

2833 
íåy
 = 
	`gtk_íåy_√w
();

2834 
¥›_dülog
->
ãm∂_«me
 = 
	`GTK_ENTRY
(
íåy
);

2835 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

2836 
	`GTK_SIGNAL_FUNC
 (
ãm∂©es_upd©e_evít
), 
°ru˘˛ass
);

2837 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

2838 
	`GTK_SIGNAL_FUNC
 (
ãm∂©es_upd©e
), 
°ru˘˛ass
);

2839 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2840 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,0,1, 
GTK_FILL
,0, 0,0);

2841 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,0,1, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2843 
œbñ
 = 
	`gtk_œbñ_√w
(
	`_
("Type:"));

2844 
íåy
 = 
	`gtk_íåy_√w
();

2845 
¥›_dülog
->
ãm∂_ty≥
 = 
	`GTK_ENTRY
(
íåy
);

2846 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "focus_out_event",

2847 
	`GTK_SIGNAL_FUNC
 (
ãm∂©es_upd©e_evít
), 
°ru˘˛ass
);

2848 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
íåy
), "activate",

2849 
	`GTK_SIGNAL_FUNC
 (
ãm∂©es_upd©e
), 
°ru˘˛ass
);

2850 
	`gtk_misc_£t_Æignmít
 (
	`GTK_MISC
 (
œbñ
), 0.0, 0.5);

2851 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
œbñ
, 0,1,1,2, 
GTK_FILL
,0, 0,0);

2852 
	`gtk_èbÀ_©èch
 (
	`GTK_TABLE
 (
èbÀ
), 
íåy
, 1,2,1,2, 
GTK_FILL
 | 
GTK_EXPAND
,0, 0,2);

2854 
	`gtk_widgë_show
(
vbox2
);

2858 
	`gtk_widgë_show_Æl
 (
vbox
);

2859 
	`gtk_widgë_show
 (
∑ge_œbñ
);

2860 
	`gtk_nŸebook_≠≥nd_∑ge
 (
nŸebook
, 
vbox
, 
∑ge_œbñ
);

2861 
	}
}

2870 
	$swôch_∑ge_ˇŒback
(
GtkNŸebook
 *
nŸebook
,

2871 
GtkNŸebookPage
 *
∑ge
)

2873 
STRUCTCœss
 *
°ru˘˛ass
;

2874 
STRUCTCœssDülog
 *
¥›_dülog
;

2876 
°ru˘˛ass
 = (
STRUCTCœss
 *)

2877 
	`gtk_obje˘_gë_u£r_d©a
(
	`GTK_OBJECT
(
nŸebook
));

2879 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2881 i‡(
¥›_dülog
 !
NULL
) {

2882 
	`©åibuãs_gë_cuºít_vÆues
(
¥›_dülog
);

2883 
	`›î©i⁄s_gë_cuºít_vÆues
(
¥›_dülog
);

2884 
	`ãm∂©es_gë_cuºít_vÆues
(
¥›_dülog
);

2886 
	}
}

2889 
	$de°roy_¥›îtõs_dülog
 (
GtkWidgë
* 
widgë
,

2890 
gpoöãr
 
u£r_d©a
)

2893 
STRUCTCœss
 *
°ru˘˛ass
 = (STRUCTCœs†*)
u£r_d©a
;

2895 
	`g_‰ì
 (
°ru˘˛ass
->
¥›îtõs_dülog
);

2896 
°ru˘˛ass
->
¥›îtõs_dülog
 = 
NULL
;

2897 
	}
}

2902 
	$fûl_ö_dülog
(
STRUCTCœss
 *
°ru˘˛ass
)

2904 #ifde‡
DEBUG


2905 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "Filling in dialog beforeáttrs");

2911 
	}
}

2913 
Obje˘Ch™ge
 *

2914 
	$Á˘‹y_≠∂y_¥›s_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
, 
GtkWidgë
 *
widgë
)

2916 
STRUCTCœssDülog
 *
¥›_dülog
;

2917 
DüObje˘
 *
obj
;

2918 
GLi°
 *
li°
;

2919 
num_©åib
, 
num_›s
;

2920 
GLi°
 *
added
, *
dñëed
, *
disc⁄√˘ed
;

2921 
STRUCTCœssSèã
 *
ﬁd_°©e
 = 
NULL
;

2922 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2923 
ﬁd_°©e
 = 
	`°ru˘˛ass_gë_°©e
(
°ru˘˛ass
);

2925 
	}
}

2928 
Obje˘Ch™ge
 *

2929 
	$°ru˘˛ass_≠∂y_¥›s_‰om_dülog
(
STRUCTCœss
 *
°ru˘˛ass
, 
GtkWidgë
 *
widgë
)

2931 
STRUCTCœssDülog
 *
¥›_dülog
;

2932 
DüObje˘
 *
obj
;

2933 
GLi°
 *
li°
;

2934 
num_©åib
, 
num_›s
;

2935 
GLi°
 *
added
, *
dñëed
, *
disc⁄√˘ed
;

2936 
STRUCTCœssSèã
 *
ﬁd_°©e
 = 
NULL
;

2938 #ifde‡
DEBUG


2939 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "Apply from dialog start");

2942 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

2944 
ﬁd_°©e
 = 
	`°ru˘˛ass_gë_°©e
(
°ru˘˛ass
);

2948 i‡–(
¥›_dülog
->
©å_vis
->
a˘ive
Ë&& (!¥›_dülog->
©å_suµ
->active))

2949 
num_©åib
 = 
	`g_li°_Àngth
(
¥›_dülog
->
©åibuãs_li°
->
chûdªn
);

2951 
num_©åib
 = 0;

2952 i‡–(
¥›_dülog
->
›_vis
->
a˘ive
Ë&& (!¥›_dülog->
›_suµ
->active))

2953 
num_›s
 = 
	`g_li°_Àngth
(
¥›_dülog
->
›î©i⁄s_li°
->
chûdªn
);

2955 
num_›s
 = 0;

2956 
obj
 = &
°ru˘˛ass
->
ñemít
.
obje˘
;

2957 #ifde‡
STRUCT_MAINPOINT


2958 
obj
->
num_c⁄√˘i⁄s
 =

2959 
STRUCTCLASS_CONNECTIONPOINTS
 + 
num_©åib
*2 + 
num_›s
*2 + 1;

2961 
obj
->
num_c⁄√˘i⁄s
 =

2962 
STRUCTCLASS_CONNECTIONPOINTS
 + 
num_©åib
*2 + 
num_›s
*2;

2964 
obj
->
c⁄√˘i⁄s
 =

2965 
	`g_ªÆloc
(
obj
->
c⁄√˘i⁄s
,

2966 
obj
->
num_c⁄√˘i⁄s
*(
C⁄√˘i⁄Poöt
 *));

2969 
	`˛ass_ªad_‰om_dülog
(
°ru˘˛ass
, 
¥›_dülog
);

2970 
	`©åibuãs_ªad_‰om_dülog
(
°ru˘˛ass
, 
¥›_dülog
, 
STRUCTCLASS_CONNECTIONPOINTS
);

2973 
	`›î©i⁄s_ªad_‰om_dülog
(
°ru˘˛ass
, 
¥›_dülog
, 
STRUCTCLASS_CONNECTIONPOINTS
+
num_©åib
*2);

2974 
	`ãm∂©es_ªad_‰om_dülog
(
°ru˘˛ass
, 
¥›_dülog
);

2977 #ifde‡
STRUCT_MAINPOINT


2978 
obj
->
c⁄√˘i⁄s
[obj->
num_c⁄√˘i⁄s
-1] =

2979 &
°ru˘˛ass
->
c⁄√˘i⁄s
[
STRUCTCLASS_CONNECTIONPOINTS
];

2983 
li°
 = 
¥›_dülog
->
dñëed_c⁄√˘i⁄s
;

2984 
li°
 !
NULL
) {

2985 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄
 = (C⁄√˘i⁄Poöà*Ë
li°
->
d©a
;

2987 
	`°ru˘˛ass_°‹e_disc⁄√˘s
(
¥›_dülog
, 
c⁄√˘i⁄
);

2988 
	`obje˘_ªmove_c⁄√˘i⁄s_to
(
c⁄√˘i⁄
);

2990 
li°
 = 
	`g_li°_√xt
(list);

2993 
dñëed
 = 
¥›_dülog
->
dñëed_c⁄√˘i⁄s
;

2994 
¥›_dülog
->
dñëed_c⁄√˘i⁄s
 = 
NULL
;

2996 
added
 = 
¥›_dülog
->
added_c⁄√˘i⁄s
;

2997 
¥›_dülog
->
added_c⁄√˘i⁄s
 = 
NULL
;

2999 
disc⁄√˘ed
 = 
¥›_dülog
->
disc⁄√˘ed_c⁄√˘i⁄s
;

3000 
¥›_dülog
->
disc⁄√˘ed_c⁄√˘i⁄s
 = 
NULL
;

3003 
	`°ru˘˛ass_ˇlcuœã_d©a
(
°ru˘˛ass
);

3004 
	`°ru˘˛ass_upd©e_d©a
(
°ru˘˛ass
);

3007 
	`fûl_ö_dülog
(
°ru˘˛ass
);

3008 #ifde‡
DEBUG


3009 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "Apply from dialogÉnd");

3011  
	`√w_°ru˘˛ass_ch™ge
(
°ru˘˛ass
, 
ﬁd_°©e
, 
added
, 
dñëed
, 
disc⁄√˘ed
);

3012 
	}
}

3015 
	$¸óã_dülog_∑ges
(
GtkNŸebook
 *
nŸebook
, 
STRUCTCœss
 *
°ru˘˛ass
)

3018 
	`˛ass_¸óã_∑ge
(
nŸebook
, 
°ru˘˛ass
);

3019 
	`©åibuãs_¸óã_∑ge
(
nŸebook
, 
°ru˘˛ass
);

3020 
	`›î©i⁄s_¸óã_∑ge
(
nŸebook
, 
°ru˘˛ass
);

3021 
	`ãm∂©es_¸óã_∑ge
(
nŸebook
, 
°ru˘˛ass
);

3022 
	`°yÀ_¸óã_∑ge
(
nŸebook
, 
°ru˘˛ass
);

3023 
	}
}

3025 
GtkWidgë
 *

3026 
	$Á˘‹y_gë_¥›îtõs
(
STRUCTCœss
 *
˛ass
, 
gboﬁón
 
is_deÁu…
)

3029 
STRUCTCœssDülog
 *
¥›_dülog
;

3030 
GtkWidgë
 *
vbox
;

3031 
GtkTabÀ
 *
maöTabÀ
;

3032 i‡(
˛ass
->
¥›îtõs_dülog
 =
NULL
) {

3033 
¥›_dülog
 = 
	`g_√w
(
STRUCTCœssDülog
, 1);

3034 
˛ass
->
¥›îtõs_dülog
 = 
¥›_dülog
;

3035 
˛ass
->
¥›îtõs_dülog
->
EnumsAndSåu˘s
 = &
°ru˘Li°
;

3038 
vbox
 = 
	`gtk_vbox_√w
(
FALSE
, 0);

3042 
¥›_dülog
->
dülog
 = 
vbox
;

3043 
	`gtk_widgë_£t_«me
(
vbox
,
˛ass
->
«me
);

3045 
¥›_dülog
->
cuºít_©å
 = 
NULL
;

3046 
¥›_dülog
->
cuºít_›
 = 
NULL
;

3047 
¥›_dülog
->
cuºít_∑øm
 = 
NULL
;

3048 
¥›_dülog
->
cuºít_ãm∂
 = 
NULL
;

3049 
¥›_dülog
->
dñëed_c⁄√˘i⁄s
 = 
NULL
;

3050 
¥›_dülog
->
added_c⁄√˘i⁄s
 = 
NULL
;

3051 
¥›_dülog
->
disc⁄√˘ed_c⁄√˘i⁄s
 = 
NULL
;

3054 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
¥›_dülog
->
dülog
),

3056 
	`GTK_SIGNAL_FUNC
(
de°roy_¥›îtõs_dülog
),

3057 (
gpoöãr
Ë
˛ass
);

3059 
GLi°
 *
d©Æi°
 = 
NULL
;

3060 
row
 =0;

3061 
cﬁ
 = 0;

3062 
GLi°
 *
éi°
 = 
¥›_dülog
->
EnumsAndSåu˘s
->
°ru˘Li°
;

3063 ;
éi°
 !
NULL
;éi° =Åli°->
√xt
)

3065 
Fa˘‹ySåu˘IãmLi°
 *
fsû
 = 
éi°
->
d©a
;

3066 if(0 =
	`°rcmp
(
fsû
->
«me
,
˛ass
->name))

3068 
GLi°
 *
ôem
 = 
fsû
->
li°
;

3069 
num
 = 
	`g_li°_Àngth
(
ôem
);

3070 
¥›_dülog
->
maöTabÀ
 = 
	`gtk_èbÀ_√w
(
num
,4,
FALSE
);

3071 ;
ôem
 !
NULL
 ; iãm = iãm->
√xt
,
row
++)

3073 
	`Á˘‹y_¸óã_°ru˘_dülog
(
¥›_dülog
,
ôem
->
d©a
,
row
);

3079 
	`gtk_èbÀ_£t_cﬁ_•acög
(
	`GTK_TABLE
(
¥›_dülog
->
maöTabÀ
),1,20);

3080 
	`gtk_widgë_show_Æl
 (
˛ass
->
¥›îtõs_dülog
->
dülog
);

3082  
˛ass
->
¥›îtõs_dülog
->
dülog
;

3084 
	}
}

3088 
GtkWidgë
 *

3089 
	$°ru˘˛ass_gë_¥›îtõs
(
STRUCTCœss
 *
°ru˘˛ass
, 
gboﬁón
 
is_deÁu…
)

3091 
STRUCTCœssDülog
 *
¥›_dülog
;

3092 
GtkWidgë
 *
vbox
;

3093 
GtkWidgë
 *
nŸebook
;

3095 #ifde‡
DEBUG


3096 
	`°ru˘˛ass_ßnôy_check
(
°ru˘˛ass
, "GetÖroperties start");

3098 i‡(
°ru˘˛ass
->
¥›îtõs_dülog
 =
NULL
) {

3099 
¥›_dülog
 = 
	`g_√w
(
STRUCTCœssDülog
, 1);

3100 
°ru˘˛ass
->
¥›îtõs_dülog
 = 
¥›_dülog
;

3102 
vbox
 = 
	`gtk_vbox_√w
(
FALSE
, 0);

3103 
	`gtk_obje˘_ªf
(
	`GTK_OBJECT
(
vbox
));

3104 
	`gtk_obje˘_sök
(
	`GTK_OBJECT
(
vbox
));

3106 
¥›_dülog
->
dülog
 = 
vbox
;

3108 
¥›_dülog
->
cuºít_©å
 = 
NULL
;

3109 
¥›_dülog
->
cuºít_›
 = 
NULL
;

3110 
¥›_dülog
->
cuºít_∑øm
 = 
NULL
;

3111 
¥›_dülog
->
cuºít_ãm∂
 = 
NULL
;

3112 
¥›_dülog
->
dñëed_c⁄√˘i⁄s
 = 
NULL
;

3113 
¥›_dülog
->
added_c⁄√˘i⁄s
 = 
NULL
;

3114 
¥›_dülog
->
disc⁄√˘ed_c⁄√˘i⁄s
 = 
NULL
;

3116 
nŸebook
 = 
	`gtk_nŸebook_√w
 ();

3117 
	`gtk_nŸebook_£t_èb_pos
 (
	`GTK_NOTEBOOK
 (
nŸebook
), 
GTK_POS_TOP
);

3118 
	`gtk_box_∑ck_°¨t
 (
	`GTK_BOX
 (
vbox
), 
nŸebook
, 
TRUE
, TRUE, 0);

3119 
	`gtk_c⁄èöî_£t_b‹dî_width
 (
	`GTK_CONTAINER
 (
nŸebook
), 10);

3121 
	`gtk_obje˘_£t_u£r_d©a
(
	`GTK_OBJECT
(
nŸebook
), (
gpoöãr
Ë
°ru˘˛ass
);

3123 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
nŸebook
),

3125 
	`GTK_SIGNAL_FUNC
(
swôch_∑ge_ˇŒback
),

3126 (
gpoöãr
Ë
°ru˘˛ass
);

3127 
	`gtk_sig«l_c⁄√˘
 (
	`GTK_OBJECT
 (
°ru˘˛ass
->
¥›îtõs_dülog
->
dülog
),

3129 
	`GTK_SIGNAL_FUNC
(
de°roy_¥›îtõs_dülog
),

3130 (
gpoöãr
Ë
°ru˘˛ass
);

3132 
	`¸óã_dülog_∑ges
(
	`GTK_NOTEBOOK
–
nŸebook
 ), 
°ru˘˛ass
);

3134 
	`gtk_widgë_show
 (
nŸebook
);

3137 
	`fûl_ö_dülog
(
°ru˘˛ass
);

3138 
	`gtk_widgë_show
 (
°ru˘˛ass
->
¥›îtõs_dülog
->
dülog
);

3140  
°ru˘˛ass
->
¥›îtõs_dülog
->
dülog
;

3141 
	}
}

3147 
	$°ru˘˛ass_‰ì_°©e
(
STRUCTCœssSèã
 *
°©e
)

3149 
GLi°
 *
li°
;

3151 
	`g_obje˘_uƒef
 (
°©e
->
n‹mÆ_f⁄t
);

3152 
	`g_obje˘_uƒef
 (
°©e
->
ab°ø˘_f⁄t
);

3153 
	`g_obje˘_uƒef
 (
°©e
->
pﬁym‹phic_f⁄t
);

3154 
	`g_obje˘_uƒef
 (
°©e
->
˛as¢ame_f⁄t
);

3155 
	`g_obje˘_uƒef
 (
°©e
->
ab°ø˘_˛as¢ame_f⁄t
);

3156 
	`g_obje˘_uƒef
 (
°©e
->
commít_f⁄t
);

3158 
	`g_‰ì
(
°©e
->
«me
);

3159 
	`g_‰ì
(
°©e
->
°îeŸy≥
);

3160 
	`g_‰ì
(
°©e
->
commít
);

3162 
li°
 = 
°©e
->
©åibuãs
;

3163 
li°
) {

3164 
	`°ru˘_©åibuã_de°roy
((
STRUCTAâribuã
 *Ë
li°
->
d©a
);

3165 
li°
 = 
	`g_li°_√xt
(list);

3167 
	`g_li°_‰ì
(
°©e
->
©åibuãs
);

3169 
li°
 = 
°©e
->
›î©i⁄s
;

3170 
li°
) {

3171 
	`°ru˘_›î©i⁄_de°roy
((
STRUCTO≥øti⁄
 *Ë
li°
->
d©a
);

3172 
li°
 = 
	`g_li°_√xt
(list);

3174 
	`g_li°_‰ì
(
°©e
->
›î©i⁄s
);

3176 
li°
 = 
°©e
->
f‹mÆ_∑øms
;

3177 
li°
) {

3178 
	`°ru˘_f‹mÆ∑ømëî_de°roy
((
STRUCTF‹mÆP¨amëî
 *Ë
li°
->
d©a
);

3179 
li°
 = 
	`g_li°_√xt
(list);

3181 
	`g_li°_‰ì
(
°©e
->
f‹mÆ_∑øms
);

3182 
	}
}

3184 
STRUCTCœssSèã
 *

3185 
	$°ru˘˛ass_gë_°©e
(
STRUCTCœss
 *
°ru˘˛ass
)

3187 
STRUCTCœssSèã
 *
°©e
 = 
	`g_√w0
(STRUCTClassState, 1);

3188 
GLi°
 *
li°
;

3190 
°©e
->
f⁄t_height
 = 
°ru˘˛ass
->font_height;

3191 
°©e
->
ab°ø˘_f⁄t_height
 = 
°ru˘˛ass
->abstract_font_height;

3192 
°©e
->
pﬁym‹phic_f⁄t_height
 = 
°ru˘˛ass
->polymorphic_font_height;

3193 
°©e
->
˛as¢ame_f⁄t_height
 = 
°ru˘˛ass
->classname_font_height;

3194 
°©e
->
ab°ø˘_˛as¢ame_f⁄t_height
 = 
°ru˘˛ass
->abstract_classname_font_height;

3195 
°©e
->
commít_f⁄t_height
 = 
°ru˘˛ass
->comment_font_height;

3197 
°©e
->
n‹mÆ_f⁄t
 = 
	`g_obje˘_ªf
 (
°ru˘˛ass
->normal_font);

3198 
°©e
->
ab°ø˘_f⁄t
 = 
	`g_obje˘_ªf
 (
°ru˘˛ass
->abstract_font);

3199 
°©e
->
pﬁym‹phic_f⁄t
 = 
	`g_obje˘_ªf
 (
°ru˘˛ass
->polymorphic_font);

3200 
°©e
->
˛as¢ame_f⁄t
 = 
	`g_obje˘_ªf
 (
°ru˘˛ass
->classname_font);

3201 
°©e
->
ab°ø˘_˛as¢ame_f⁄t
 = 
	`g_obje˘_ªf
 (
°ru˘˛ass
->abstract_classname_font);

3202 
°©e
->
commít_f⁄t
 = 
	`g_obje˘_ªf
 (
°ru˘˛ass
->comment_font);

3204 
°©e
->
«me
 = 
	`g_°rdup
(
°ru˘˛ass
->name);

3205 
°©e
->
°îeŸy≥
 = 
	`g_°rdup
(
°ru˘˛ass
->stereotype);

3206 
°©e
->
commít
 = 
	`g_°rdup
(
°ru˘˛ass
->comment);

3208 
°©e
->
ab°ø˘
 = 
°ru˘˛ass
->abstract;

3209 
°©e
->
suµªss_©åibuãs
 = 
°ru˘˛ass
->suppress_attributes;

3210 
°©e
->
suµªss_›î©i⁄s
 = 
°ru˘˛ass
->suppress_operations;

3211 
°©e
->
visibÀ_©åibuãs
 = 
°ru˘˛ass
->visible_attributes;

3212 
°©e
->
visibÀ_›î©i⁄s
 = 
°ru˘˛ass
->visible_operations;

3213 
°©e
->
visibÀ_commíts
 = 
°ru˘˛ass
->visible_comments;

3215 
°©e
->
wøp_›î©i⁄s
 = 
°ru˘˛ass
->wrap_operations;

3216 
°©e
->
wøp_a·î_ch¨
 = 
°ru˘˛ass
->wrap_after_char;

3217 
°©e
->
commít_löe_Àngth
 = 
°ru˘˛ass
->comment_line_length;

3218 
°©e
->
commít_èggög
 = 
°ru˘˛ass
->comment_tagging;

3220 
°©e
->
löe_cﬁ‹
 = 
°ru˘˛ass
->line_color;

3221 
°©e
->
fûl_cﬁ‹
 = 
°ru˘˛ass
->fill_color;

3222 
°©e
->
ãxt_cﬁ‹
 = 
°ru˘˛ass
->text_color;

3224 
°©e
->
©åibuãs
 = 
NULL
;

3225 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

3226 
li°
 !
NULL
) {

3227 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *)
li°
->
d©a
;

3228 
STRUCTAâribuã
 *
©å_c›y
;

3230 
©å_c›y
 = 
	`°ru˘_©åibuã_c›y
(
©å
);

3232 
©å_c›y
->
À·_c⁄√˘i⁄
 = 
©å
->left_connection;

3233 
©å_c›y
->
right_c⁄√˘i⁄
 = 
©å
->right_connection;

3235 
°©e
->
©åibuãs
 = 
	`g_li°_≠≥nd
(°©e->©åibuãs, 
©å_c›y
);

3236 
li°
 = 
	`g_li°_√xt
(list);

3240 
°©e
->
›î©i⁄s
 = 
NULL
;

3241 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

3242 
li°
 !
NULL
) {

3243 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *)
li°
->
d©a
;

3244 
STRUCTO≥øti⁄
 *
›_c›y
;

3246 
›_c›y
 = 
	`°ru˘_›î©i⁄_c›y
(
›
);

3247 
›_c›y
->
À·_c⁄√˘i⁄
 = 
›
->left_connection;

3248 
›_c›y
->
right_c⁄√˘i⁄
 = 
›
->right_connection;

3249 
°©e
->
›î©i⁄s
 = 
	`g_li°_≠≥nd
(°©e->›î©i⁄s, 
›_c›y
);

3250 
li°
 = 
	`g_li°_√xt
(list);

3254 
°©e
->
ãm∂©e
 = 
°ru˘˛ass
->template;

3256 
°©e
->
f‹mÆ_∑øms
 = 
NULL
;

3257 
li°
 = 
°ru˘˛ass
->
f‹mÆ_∑øms
;

3258 
li°
 !
NULL
) {

3259 
STRUCTF‹mÆP¨amëî
 *
∑øm
 = (STRUCTF‹mÆP¨amëî *)
li°
->
d©a
;

3260 
STRUCTF‹mÆP¨amëî
 *
∑øm_c›y
;

3262 
∑øm_c›y
 = 
	`°ru˘_f‹mÆ∑ømëî_c›y
(
∑øm
);

3263 
°©e
->
f‹mÆ_∑øms
 = 
	`g_li°_≠≥nd
(°©e->f‹mÆ_∑øms, 
∑øm_c›y
);

3265 
li°
 = 
	`g_li°_√xt
(list);

3268  
°©e
;

3269 
	}
}

3272 
	$°ru˘˛ass_upd©e_c⁄√˘i⁄poöts
(
STRUCTCœss
 *
°ru˘˛ass
)

3274 
num_©åib
, 
num_›s
;

3275 
DüObje˘
 *
obj
;

3276 
GLi°
 *
li°
;

3277 
c⁄√˘i⁄_ödex
;

3278 
STRUCTCœssDülog
 *
¥›_dülog
;

3280 
¥›_dülog
 = 
°ru˘˛ass
->
¥›îtõs_dülog
;

3284 i‡–(
°ru˘˛ass
->
visibÀ_©åibuãs
Ë&& (!°ru˘˛ass->
suµªss_©åibuãs
))

3285 
num_©åib
 = 
	`g_li°_Àngth
(
°ru˘˛ass
->
©åibuãs
);

3287 
num_©åib
 = 0;

3288 i‡–(
°ru˘˛ass
->
visibÀ_›î©i⁄s
Ë&& (!°ru˘˛ass->
suµªss_›î©i⁄s
))

3289 
num_›s
 = 
	`g_li°_Àngth
(
°ru˘˛ass
->
›î©i⁄s
);

3291 
num_›s
 = 0;

3293 
obj
 = &
°ru˘˛ass
->
ñemít
.
obje˘
;

3294 #ifde‡
STRUCT_MAINPOINT


3295 
obj
->
num_c⁄√˘i⁄s
 = 
STRUCTCLASS_CONNECTIONPOINTS
 + 
num_©åib
*2 + 
num_›s
*2 + 1;

3297 
obj
->
num_c⁄√˘i⁄s
 = 
STRUCTCLASS_CONNECTIONPOINTS
 + 
num_©åib
*2 + 
num_›s
*2;

3299 
obj
->
c⁄√˘i⁄s
 =

3300 
	`g_ªÆloc
(
obj
->
c⁄√˘i⁄s
,

3301 
obj
->
num_c⁄√˘i⁄s
*(
C⁄√˘i⁄Poöt
 *));

3303 
c⁄√˘i⁄_ödex
 = 
STRUCTCLASS_CONNECTIONPOINTS
;

3305 
li°
 = 
°ru˘˛ass
->
©åibuãs
;

3306 
li°
 !
NULL
) {

3307 
STRUCTAâribuã
 *
©å
 = (STRUCTAâribuã *Ë
li°
->
d©a
;

3309 i‡–(
°ru˘˛ass
->
visibÀ_©åibuãs
) &&

3310 (!
°ru˘˛ass
->
suµªss_©åibuãs
)) {

3311 
obj
->
c⁄√˘i⁄s
[
c⁄√˘i⁄_ödex
] = 
©å
->
À·_c⁄√˘i⁄
;

3312 
c⁄√˘i⁄_ödex
++;

3313 
obj
->
c⁄√˘i⁄s
[
c⁄√˘i⁄_ödex
] = 
©å
->
right_c⁄√˘i⁄
;

3314 
c⁄√˘i⁄_ödex
++;

3317 
li°
 = 
	`g_li°_√xt
(list);

3320 i‡(
¥›_dülog
)

3321 
	`gtk_li°_˛ór_ôems
 (
	`GTK_LIST
 (
¥›_dülog
->
©åibuãs_li°
), 0, -1);

3323 
li°
 = 
°ru˘˛ass
->
›î©i⁄s
;

3324 
li°
 !
NULL
) {

3325 
STRUCTO≥øti⁄
 *
›
 = (STRUCTO≥øti⁄ *Ë
li°
->
d©a
;

3327 i‡–(
°ru˘˛ass
->
visibÀ_›î©i⁄s
) &&

3328 (!
°ru˘˛ass
->
suµªss_›î©i⁄s
)) {

3329 
obj
->
c⁄√˘i⁄s
[
c⁄√˘i⁄_ödex
] = 
›
->
À·_c⁄√˘i⁄
;

3330 
c⁄√˘i⁄_ödex
++;

3331 
obj
->
c⁄√˘i⁄s
[
c⁄√˘i⁄_ödex
] = 
›
->
right_c⁄√˘i⁄
;

3332 
c⁄√˘i⁄_ödex
++;

3335 
li°
 = 
	`g_li°_√xt
(list);

3337 i‡(
¥›_dülog
)

3338 
	`gtk_li°_˛ór_ôems
 (
	`GTK_LIST
 (
¥›_dülog
->
›î©i⁄s_li°
), 0, -1);

3340 #ifde‡
STRUCT_MAINPOINT


3341 
obj
->
c⁄√˘i⁄s
[
c⁄√˘i⁄_ödex
++] = &
°ru˘˛ass
->c⁄√˘i⁄s[
STRUCTCLASS_CONNECTIONPOINTS
];

3344 
	}
}

3347 
	$°ru˘˛ass_£t_°©e
(
STRUCTCœss
 *
°ru˘˛ass
, 
STRUCTCœssSèã
 *
°©e
)

3349 
°ru˘˛ass
->
f⁄t_height
 = 
°©e
->font_height;

3350 
°ru˘˛ass
->
ab°ø˘_f⁄t_height
 = 
°©e
->abstract_font_height;

3351 
°ru˘˛ass
->
pﬁym‹phic_f⁄t_height
 = 
°©e
->polymorphic_font_height;

3352 
°ru˘˛ass
->
˛as¢ame_f⁄t_height
 = 
°©e
->classname_font_height;

3353 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t_height
 = 
°©e
->abstract_classname_font_height;

3354 
°ru˘˛ass
->
commít_f⁄t_height
 = 
°©e
->comment_font_height;

3357 
	`g_obje˘_uƒef
 (
°ru˘˛ass
->
n‹mÆ_f⁄t
);

3358 
°ru˘˛ass
->
n‹mÆ_f⁄t
 = 
°©e
->normal_font;

3359 
	`g_obje˘_uƒef
 (
°ru˘˛ass
->
ab°ø˘_f⁄t
);

3360 
°ru˘˛ass
->
ab°ø˘_f⁄t
 = 
°©e
->abstract_font;

3361 
	`g_obje˘_uƒef
 (
°ru˘˛ass
->
pﬁym‹phic_f⁄t
);

3362 
°ru˘˛ass
->
pﬁym‹phic_f⁄t
 = 
°©e
->polymorphic_font;

3363 
	`g_obje˘_uƒef
 (
°ru˘˛ass
->
˛as¢ame_f⁄t
);

3364 
°ru˘˛ass
->
˛as¢ame_f⁄t
 = 
°©e
->classname_font;

3365 
	`g_obje˘_uƒef
 (
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
);

3366 
°ru˘˛ass
->
ab°ø˘_˛as¢ame_f⁄t
 = 
°©e
->abstract_classname_font;

3367 
	`g_obje˘_uƒef
 (
°ru˘˛ass
->
commít_f⁄t
);

3368 
°ru˘˛ass
->
commít_f⁄t
 = 
°©e
->comment_font;

3370 
°ru˘˛ass
->
«me
 = 
°©e
->name;

3371 
°ru˘˛ass
->
°îeŸy≥
 = 
°©e
->stereotype;

3372 
°ru˘˛ass
->
commít
 = 
°©e
->comment;

3374 
°ru˘˛ass
->
ab°ø˘
 = 
°©e
->abstract;

3375 
°ru˘˛ass
->
suµªss_©åibuãs
 = 
°©e
->suppress_attributes;

3376 
°ru˘˛ass
->
suµªss_›î©i⁄s
 = 
°©e
->suppress_operations;

3377 
°ru˘˛ass
->
visibÀ_©åibuãs
 = 
°©e
->visible_attributes;

3378 
°ru˘˛ass
->
visibÀ_›î©i⁄s
 = 
°©e
->visible_operations;

3379 
°ru˘˛ass
->
visibÀ_commíts
 = 
°©e
->visible_comments;

3381 
°ru˘˛ass
->
wøp_›î©i⁄s
 = 
°©e
->wrap_operations;

3382 
°ru˘˛ass
->
wøp_a·î_ch¨
 = 
°©e
->wrap_after_char;

3383 
°ru˘˛ass
->
commít_löe_Àngth
 = 
°©e
->comment_line_length;

3384 
°ru˘˛ass
->
commít_èggög
 = 
°©e
->comment_tagging;

3386 
°ru˘˛ass
->
löe_cﬁ‹
 = 
°©e
->line_color;

3387 
°ru˘˛ass
->
fûl_cﬁ‹
 = 
°©e
->fill_color;

3388 
°ru˘˛ass
->
ãxt_cﬁ‹
 = 
°©e
->text_color;

3390 
°ru˘˛ass
->
©åibuãs
 = 
°©e
->attributes;

3391 
°ru˘˛ass
->
›î©i⁄s
 = 
°©e
->operations;

3392 
°ru˘˛ass
->
ãm∂©e
 = 
°©e
->template;

3393 
°ru˘˛ass
->
f‹mÆ_∑øms
 = 
°©e
->formal_params;

3395 
	`g_‰ì
(
°©e
);

3397 
	`°ru˘˛ass_upd©e_c⁄√˘i⁄poöts
(
°ru˘˛ass
);

3399 
	`°ru˘˛ass_ˇlcuœã_d©a
(
°ru˘˛ass
);

3400 
	`°ru˘˛ass_upd©e_d©a
(
°ru˘˛ass
);

3401 
	}
}

3404 
	$°ru˘˛ass_ch™ge_≠∂y
(
STRUCTCœssCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

3406 
STRUCTCœssSèã
 *
ﬁd_°©e
;

3407 
GLi°
 *
li°
;

3409 
ﬁd_°©e
 = 
	`°ru˘˛ass_gë_°©e
(
ch™ge
->
obj
);

3411 
	`°ru˘˛ass_£t_°©e
(
ch™ge
->
obj
, ch™ge->
ßved_°©e
);

3413 
li°
 = 
ch™ge
->
disc⁄√˘ed
;

3414 
li°
) {

3415 
Disc⁄√˘
 *
dis
 = (Disc⁄√˘ *)
li°
->
d©a
;

3417 
	`obje˘_unc⁄√˘
(
dis
->
Ÿhî_obje˘
, dis->
Ÿhî_h™dÀ
);

3419 
li°
 = 
	`g_li°_√xt
(list);

3422 
ch™ge
->
ßved_°©e
 = 
ﬁd_°©e
;

3423 
ch™ge
->
≠∂õd
 = 1;

3424 
	}
}

3427 
	$°ru˘˛ass_ch™ge_ªvît
(
STRUCTCœssCh™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

3429 
STRUCTCœssSèã
 *
ﬁd_°©e
;

3430 
GLi°
 *
li°
;

3432 
ﬁd_°©e
 = 
	`°ru˘˛ass_gë_°©e
(
ch™ge
->
obj
);

3434 
	`°ru˘˛ass_£t_°©e
(
ch™ge
->
obj
, ch™ge->
ßved_°©e
);

3436 
li°
 = 
ch™ge
->
disc⁄√˘ed
;

3437 
li°
) {

3438 
Disc⁄√˘
 *
dis
 = (Disc⁄√˘ *)
li°
->
d©a
;

3440 
	`obje˘_c⁄√˘
(
dis
->
Ÿhî_obje˘
, dis->
Ÿhî_h™dÀ
, dis->
˝
);

3442 
li°
 = 
	`g_li°_√xt
(list);

3445 
ch™ge
->
ßved_°©e
 = 
ﬁd_°©e
;

3446 
ch™ge
->
≠∂õd
 = 0;

3447 
	}
}

3450 
	$°ru˘˛ass_ch™ge_‰ì
(
STRUCTCœssCh™ge
 *
ch™ge
)

3452 
GLi°
 *
li°
, *
‰ì_li°
;

3454 
	`°ru˘˛ass_‰ì_°©e
(
ch™ge
->
ßved_°©e
);

3455 
	`g_‰ì
(
ch™ge
->
ßved_°©e
);

3458 i‡(
ch™ge
->
≠∂õd
)

3459 
‰ì_li°
 = 
ch™ge
->
dñëed_˝
;

3461 
‰ì_li°
 = 
ch™ge
->
added_˝
;

3463 
li°
 = 
‰ì_li°
;

3464 
li°
 !
NULL
) {

3465 
C⁄√˘i⁄Poöt
 *
c⁄√˘i⁄
 = (C⁄√˘i⁄Poöà*Ë
li°
->
d©a
;

3467 
	`g_as£π
(
c⁄√˘i⁄
->
c⁄√˘ed
 =
NULL
);

3468 
	`obje˘_ªmove_c⁄√˘i⁄s_to
(
c⁄√˘i⁄
);

3469 
	`g_‰ì
(
c⁄√˘i⁄
);

3471 
li°
 = 
	`g_li°_√xt
(list);

3474 
	`g_li°_‰ì
(
‰ì_li°
);

3476 
	}
}

3478 
Obje˘Ch™ge
 *

3479 
	$√w_°ru˘˛ass_ch™ge
(
STRUCTCœss
 *
obj
, 
STRUCTCœssSèã
 *
ßved_°©e
,

3480 
GLi°
 *
added
, GLi° *
dñëed
, GLi° *
disc⁄√˘ed
)

3482 
STRUCTCœssCh™ge
 *
ch™ge
;

3484 
ch™ge
 = 
	`g_√w0
(
STRUCTCœssCh™ge
, 1);

3486 
ch™ge
->
obj_ch™ge
.
≠∂y
 =

3487 (
Obje˘Ch™geAµlyFunc
Ë
°ru˘˛ass_ch™ge_≠∂y
;

3488 
ch™ge
->
obj_ch™ge
.
ªvît
 =

3489 (
Obje˘Ch™geRevîtFunc
Ë
°ru˘˛ass_ch™ge_ªvît
;

3490 
ch™ge
->
obj_ch™ge
.
‰ì
 =

3491 (
Obje˘Ch™geFªeFunc
Ë
°ru˘˛ass_ch™ge_‰ì
;

3493 
ch™ge
->
obj
 = obj;

3494 
ch™ge
->
ßved_°©e
 = saved_state;

3495 
ch™ge
->
≠∂õd
 = 1;

3497 
ch™ge
->
added_˝
 = 
added
;

3498 
ch™ge
->
dñëed_˝
 = 
dñëed
;

3499 
ch™ge
->
disc⁄√˘ed
 = disconnected;

3501  (
Obje˘Ch™ge
 *)
ch™ge
;

3502 
	}
}

3506 c⁄° 
gch¨
 * 
	$gë_commít
(
GtkTextVõw
 *
võw
)

3508 
GtkTextBuf„r
 * 
buf„r
 = 
	`gtk_ãxt_võw_gë_buf„r
(
võw
);

3509 
GtkTextIãr
 
°¨t
;

3510 
GtkTextIãr
 
íd
;

3512 
	`gtk_ãxt_buf„r_gë_°¨t_ôî
(
buf„r
, &
°¨t
);

3513 
	`gtk_ãxt_buf„r_gë_íd_ôî
(
buf„r
, &
íd
);

3515  
	`gtk_ãxt_buf„r_gë_ãxt
(
buf„r
, &
°¨t
, &
íd
, 
FALSE
);

3516 
	}
}

3519 
	$£t_commít
(
GtkTextVõw
 *
võw
, 
gch¨
 *
ãxt
)

3521 
GtkTextBuf„r
 * 
buf„r
 = 
	`gtk_ãxt_võw_gë_buf„r
(
võw
);

3522 
GtkTextIãr
 
°¨t
;

3523 
GtkTextIãr
 
íd
;

3525 
	`gtk_ãxt_buf„r_gë_°¨t_ôî
(
buf„r
, &
°¨t
);

3526 
	`gtk_ãxt_buf„r_gë_íd_ôî
(
buf„r
, &
íd
);

3527 
	`gtk_ãxt_buf„r_dñëe
(
buf„r
,&
°¨t
,&
íd
);

3528 
	`gtk_ãxt_buf„r_gë_°¨t_ôî
(
buf„r
, &
°¨t
);

3529 
	`gtk_ãxt_buf„r_ö£π
–
buf„r
, &
°¨t
, 
ãxt
, 
	`°æí
(text));

3530 
	}
}

	@O:\tool\dvs50\objects\Struct\structattribute.c

24 #ifde‡
HAVE_CONFIG_H


25 
	~<c⁄fig.h
>

28 
	~<°rög.h
>

30 
	~"°ru˘.h
"

31 
	~"¥›îtõs.h
"

33 
Pr›EnumD©a
 
_°ru˘_visibûôõs
[];

35 
Pr›Des¸ùti⁄
 
	g°ru˘©åibuã_¥›s
[] = {

36 { "«me", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

37 
N_
("Name"), 
NULL
, NULL },

38 { "ty≥", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

39 
N_
("Ty≥"), 
NULL
, NULL },

40 { "vÆue", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

41 
N_
("VÆue"), 
NULL
, NULL },

42 { "commít", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

43 
N_
("Commít"), 
NULL
, NULL },

44 { "visibûôy", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

45 
N_
("Visibûôy"), 
NULL
, 
_°ru˘_visibûôõs
 },

46 { "ab°ø˘", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

47 
N_
("Ab°ø˘ (?)"), 
NULL
, NULL },

48 { "˛ass_sc›e", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

49 
N_
("Cœs†sc›ê(°©ic)"), 
NULL
, NULL },

51 
PROP_DESC_END


54 
Pr›Off£t
 
	g°ru˘©åibuã_off£ts
[] = {

55 { "«me", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTAâribuã
, 
«me
) },

56 { "ty≥", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTAâribuã
, 
ty≥
) },

57 { "vÆue", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTAâribuã
, 
vÆue
) },

58 { "commít", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTAâribuã
, 
commít
) },

59 { "visibûôy", 
PROP_TYPE_ENUM
, 
off£tof
(
STRUCTAâribuã
, 
visibûôy
) },

60 { "ab°ø˘", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTAâribuã
, 
ab°ø˘
) },

61 { "˛ass_sc›e", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTAâribuã
, 
˛ass_sc›e
) },

62 { 
NULL
, 0, 0 },

66 
Pr›DescDAºayExåa
 
	g°ru˘©åibuã_exåa
 = {

67 { 
°ru˘©åibuã_¥›s
, 
°ru˘©åibuã_off£ts
, "structattribute" },

68 (
NewRec‹dFunc
)
°ru˘_©åibuã_√w
,

69 (
FªeRec‹dFunc
)
°ru˘_©åibuã_de°roy


73 
STRUCTAâribuã
 *

74 
	$°ru˘_©åibuã_√w
()

76 
STRUCTAâribuã
 *
©å
;

77 
göt
 
√xt_id
 = 1;

79 
©å
 = 
	`g_√w0
(
STRUCTAâribuã
, 1);

80 
©å
->
öã∫Æ_id
 = 
√xt_id
++;

81 
©å
->
«me
 = 
	`g_°rdup
("");

82 
©å
->
ty≥
 = 
	`g_°rdup
("");

83 
©å
->
vÆue
 = 
NULL
;

84 
©å
->
commít
 = 
	`g_°rdup
("");

85 
©å
->
visibûôy
 = 
STRUCT_PUBLIC
;

86 
©å
->
ab°ø˘
 = 
FALSE
;

87 
©å
->
˛ass_sc›e
 = 
FALSE
;

89 
©å
->
À·_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

90 
©å
->
right_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

92  
©å
;

93 
	}
}

98 
	$°ru˘_©åibuã_c›y_öto
(
STRUCTAâribuã
 *
©å
, STRUCTAâribuã *
√w©å
)

100 
√w©å
->
öã∫Æ_id
 = 
©å
->internal_id;

101 i‡(
√w©å
->
«me
 !
NULL
) {

102 
	`g_‰ì
(
√w©å
->
«me
);

104 
√w©å
->
«me
 = 
	`g_°rdup
(
©å
->name);

105 i‡(
√w©å
->
ty≥
 !
NULL
) {

106 
	`g_‰ì
(
√w©å
->
ty≥
);

108 
√w©å
->
ty≥
 = 
	`g_°rdup
(
©å
->type);

110 i‡(
√w©å
->
vÆue
 !
NULL
) {

111 
	`g_‰ì
(
√w©å
->
vÆue
);

113 i‡(
©å
->
vÆue
 !
NULL
) {

114 
√w©å
->
vÆue
 = 
	`g_°rdup
(
©å
->value);

116 
√w©å
->
vÆue
 = 
NULL
;

119 i‡(
√w©å
->
commít
 !
NULL
) {

120 
	`g_‰ì
(
√w©å
->
commít
);

122 i‡(
©å
->
commít
 !
NULL
)

123 
√w©å
->
commít
 = 
	`g_°rdup
 (
©å
->comment);

125 
√w©å
->
commít
 = 
NULL
;

127 
√w©å
->
visibûôy
 = 
©å
->visibility;

128 
√w©å
->
ab°ø˘
 = 
©å
->abstract;

129 
√w©å
->
˛ass_sc›e
 = 
©å
->class_scope;

130 
	}
}

134 
STRUCTAâribuã
 *

135 
	$°ru˘_©åibuã_c›y
(
STRUCTAâribuã
 *
©å
)

137 
STRUCTAâribuã
 *
√w©å
;

139 
√w©å
 = 
	`g_√w0
(
STRUCTAâribuã
, 1);

141 
	`°ru˘_©åibuã_c›y_öto
(
©å
, 
√w©å
);

143  
√w©å
;

144 
	}
}

147 
	$°ru˘_©åibuã_de°roy
(
STRUCTAâribuã
 *
©å
)

149 
	`g_‰ì
(
©å
->
«me
);

150 
	`g_‰ì
(
©å
->
ty≥
);

151 i‡(
©å
->
vÆue
 !
NULL
)

152 
	`g_‰ì
(
©å
->
vÆue
);

153 i‡(
©å
->
commít
 !
NULL
)

154 
	`g_‰ì
(
©å
->
commít
);

156 
	`g_‰ì
(
©å
->
À·_c⁄√˘i⁄
);

157 
	`g_‰ì
(
©å
->
right_c⁄√˘i⁄
);

159 
	`g_‰ì
(
©å
);

160 
	}
}

163 
	$°ru˘_©åibuã_wrôe
(
AâribuãNode
 
©å_node
, 
STRUCTAâribuã
 *
©å
)

165 
D©aNode
 
composôe
;

167 
composôe
 = 
	`d©a_add_composôe
(
©å_node
, "structattribute");

169 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "name"),

170 
©å
->
«me
);

171 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "type"),

172 
©å
->
ty≥
);

173 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "value"),

174 
©å
->
vÆue
);

175 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "comment"),

176 
©å
->
commít
);

177 
	`d©a_add_íum
(
	`composôe_add_©åibuã
(
composôe
, "visibility"),

178 
©å
->
visibûôy
);

179 
	`d©a_add_boﬁón
(
	`composôe_add_©åibuã
(
composôe
, "abstract"),

180 
©å
->
ab°ø˘
);

181 
	`d©a_add_boﬁón
(
	`composôe_add_©åibuã
(
composôe
, "class_scope"),

182 
©å
->
˛ass_sc›e
);

183 
	}
}

188 
	gvisibÀ_ch¨
[] = { '+', '-', '#', ' ' };

191 
	$°ru˘_gë_©åibuã_°rög
 (
STRUCTAâribuã
 *
©åibuã
)

193 
Àn
;

194 *
°r
;

196 
Àn
 = 1 + (
©åibuã
->
«me
 ? 
	`°æí
 (attribute->name) : 0)

197 + (
©åibuã
->
ty≥
 ? 
	`°æí
 (attribute->type) : 0);

198 i‡(
©åibuã
->
«me
 &&áâribuã->«me[0] &&áâribuã->
ty≥
 &&áttribute->type[0]) {

199 
Àn
 += 2;

201 i‡(
©åibuã
->
vÆue
 !
NULL
 &&áttribute->value[0] != '\0') {

202 
Àn
 +3 + 
	`°æí
 (
©åibuã
->
vÆue
);

205 
°r
 = 
	`g_mÆloc
 ( (Ë* (
Àn
 + 1));

207 
°r
[0] = 
visibÀ_ch¨
[(Ë
©åibuã
->
visibûôy
];

208 
°r
[1] = 0;

210 
	`°rˇt
 (
°r
, 
©åibuã
->
«me
 ?áttribute->name : "");

211 i‡(
©åibuã
->
«me
 &&áâribuã->«me[0] &&áâribuã->
ty≥
 &&áttribute->type[0]) {

212 
	`°rˇt
 (
°r
, ": ");

214 
	`°rˇt
 (
°r
, 
©åibuã
->
ty≥
 ?áttribute->type : "");

215 i‡(
©åibuã
->
vÆue
 !
NULL
 &&áttribute->value[0] != '\0') {

216 
	`°rˇt
 (
°r
, " = ");

217 
	`°rˇt
 (
°r
, 
©åibuã
->
vÆue
);

220 
	`g_as£π
 (
	`°æí
 (
°r
Ë=
Àn
);

222  
°r
;

223 
	}
}

237 
	$°ru˘_©åibuã_ísuª_c⁄√˘i⁄_poöts
 (
STRUCTAâribuã
* 
©å
, 
DüObje˘
* 
obj
)

239 i‡(!
©å
->
À·_c⁄√˘i⁄
)

240 
©å
->
À·_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
,1);

241 
©å
->
À·_c⁄√˘i⁄
->
obje˘
 = 
obj
;

242 i‡(!
©å
->
right_c⁄√˘i⁄
)

243 
©å
->
right_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
,1);

244 
©å
->
right_c⁄√˘i⁄
->
obje˘
 = 
obj
;

245 
	}
}

	@O:\tool\dvs50\objects\Struct\structformalparameter.c

24 #ifde‡
HAVE_CONFIG_H


25 
	~<c⁄fig.h
>

28 
	~<°rög.h
>

30 
	~"°ru˘.h
"

31 
	~"¥›îtõs.h
"

33 
Pr›Des¸ùti⁄
 
	g°ru˘f‹mÆ∑ømëî_¥›s
[] = {

34 { "«me", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

35 
N_
("Name"), 
NULL
, NULL },

36 { "ty≥", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

37 
N_
("Ty≥"), 
NULL
, NULL },

39 
PROP_DESC_END


42 
Pr›Off£t
 
	g°ru˘f‹mÆ∑ømëî_off£ts
[] = {

43 { "«me", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTF‹mÆP¨amëî
, 
«me
) },

44 { "ty≥", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTF‹mÆP¨amëî
, 
ty≥
) },

45 { 
NULL
, 0, 0 },

48 
Pr›DescDAºayExåa
 
	g°ru˘f‹mÆ∑ømëî_exåa
 = {

49 { 
°ru˘f‹mÆ∑ømëî_¥›s
, 
°ru˘f‹mÆ∑ømëî_off£ts
, "structformalparameter" },

50 (
NewRec‹dFunc
)
°ru˘_f‹mÆ∑ømëî_√w
,

51 (
FªeRec‹dFunc
)
°ru˘_f‹mÆ∑ømëî_de°roy


54 
STRUCTF‹mÆP¨amëî
 *

55 
	$°ru˘_f‹mÆ∑ømëî_√w
()

57 
STRUCTF‹mÆP¨amëî
 *
∑øm
;

59 
∑øm
 = 
	`g_√w0
(
STRUCTF‹mÆP¨amëî
, 1);

60 
∑øm
->
«me
 = 
	`g_°rdup
("");

61 
∑øm
->
ty≥
 = 
NULL
;

63  
∑øm
;

64 
	}
}

66 
STRUCTF‹mÆP¨amëî
 *

67 
	$°ru˘_f‹mÆ∑ømëî_c›y
(
STRUCTF‹mÆP¨amëî
 *
∑øm
)

69 
STRUCTF‹mÆP¨amëî
 *
√w∑øm
;

71 
√w∑øm
 = 
	`g_√w0
(
STRUCTF‹mÆP¨amëî
, 1);

73 
√w∑øm
->
«me
 = 
	`g_°rdup
(
∑øm
->name);

74 i‡(
∑øm
->
ty≥
 !
NULL
) {

75 
√w∑øm
->
ty≥
 = 
	`g_°rdup
(
∑øm
->type);

77 
√w∑øm
->
ty≥
 = 
NULL
;

80  
√w∑øm
;

81 
	}
}

84 
	$°ru˘_f‹mÆ∑ømëî_de°roy
(
STRUCTF‹mÆP¨amëî
 *
∑øm
)

86 
	`g_‰ì
(
∑øm
->
«me
);

87 i‡(
∑øm
->
ty≥
 !
NULL
)

88 
	`g_‰ì
(
∑øm
->
ty≥
);

89 
	`g_‰ì
(
∑øm
);

90 
	}
}

93 
	$°ru˘_f‹mÆ∑ømëî_wrôe
(
AâribuãNode
 
©å_node
, 
STRUCTF‹mÆP¨amëî
 *
∑øm
)

95 
D©aNode
 
composôe
;

97 
composôe
 = 
	`d©a_add_composôe
(
©å_node
, "structformalparameter");

99 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "name"),

100 
∑øm
->
«me
);

101 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "type"),

102 
∑øm
->
ty≥
);

103 
	}
}

106 
	$°ru˘_gë_f‹mÆ∑ømëî_°rög
 (
STRUCTF‹mÆP¨amëî
 *
∑ømëî
)

108 
Àn
;

109 *
°r
;

112 
Àn
 = 
∑ømëî
->
«me
 ? 
	`°æí
 (parameter->name) : 0;

114 i‡(
∑ømëî
->
ty≥
 !
NULL
) {

115 
Àn
 +1 + 
	`°æí
 (
∑ømëî
->
ty≥
);

119 
°r
 = 
	`g_mÆloc
 ( (Ë* (
Àn
 + 1));

120 
	`°r˝y
 (
°r
, 
∑ømëî
->
«me
 ?Öarameter->name : "");

121 i‡(
∑ømëî
->
ty≥
 !
NULL
) {

122 
	`°rˇt
 (
°r
, ":");

123 
	`°rˇt
 (
°r
, 
∑ømëî
->
ty≥
);

126 
	`g_as£π
 (
	`°æí
 (
°r
Ë=
Àn
);

128  
°r
;

129 
	}
}

	@O:\tool\dvs50\objects\Struct\structoperation.c

47 #ifde‡
HAVE_CONFIG_H


48 
	~<c⁄fig.h
>

51 
	~<m©h.h
>

52 
	~<°rög.h
>

54 
	~"°ru˘.h
"

55 
	~"¥›îtõs.h
"

57 
Pr›EnumD©a
 
_°ru˘_visibûôõs
[];

58 
Pr›EnumD©a
 
_°ru˘_öhîô™˚s
[];

60 
Pr›Des¸ùti⁄
 
	g°ru˘›î©i⁄_¥›s
[] = {

61 { "«me", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

62 
N_
("Name"), 
NULL
, NULL },

63 { "ty≥", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

64 
N_
("Ty≥"), 
NULL
, NULL },

65 { "commít", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

66 
N_
("Commít"), 
NULL
, NULL },

67 { "°îeŸy≥", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

68 
N_
("SãªŸy≥"), 
NULL
, NULL },

70 { "visibûôy", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

71 
N_
("Visibûôy"), 
NULL
, 
_°ru˘_visibûôõs
 },

72 { "öhîô™˚_ty≥", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

73 
N_
("Inhîô™˚Åy≥"), 
NULL
, 
_°ru˘_öhîô™˚s
 },

74 { "quîy", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

75 
N_
("Quîy (c⁄°)"), 
NULL
, NULL },

76 { "˛ass_sc›e", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

77 
N_
("Cœs†sc›ê(°©ic)"), 
NULL
, NULL },

78 { "∑ømëîs", 
PROP_TYPE_DARRAY
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

79 
N_
("P¨amëîs"), 
NULL
, NULL },

81 
PROP_DESC_END


84 
Pr›Off£t
 
	g°ru˘›î©i⁄_off£ts
[] = {

85 { "«me", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTO≥øti⁄
, 
«me
) },

86 { "ty≥", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTO≥øti⁄
, 
ty≥
) },

87 { "commít", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTO≥øti⁄
, 
commít
) },

88 { "°îeŸy≥", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTO≥øti⁄
, 
°îeŸy≥
) },

89 { "visibûôy", 
PROP_TYPE_ENUM
, 
off£tof
(
STRUCTO≥øti⁄
, 
visibûôy
) },

90 { "öhîô™˚_ty≥", 
PROP_TYPE_ENUM
, 
off£tof
(
STRUCTO≥øti⁄
, 
öhîô™˚_ty≥
) },

91 { "quîy", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTO≥øti⁄
, 
quîy
) },

92 { "˛ass_sc›e", 
PROP_TYPE_BOOL
, 
off£tof
(
STRUCTO≥øti⁄
, 
˛ass_sc›e
) },

93 { "∑ømëîs", 
PROP_TYPE_DARRAY
, 
off£tof
(
STRUCTO≥øti⁄
, 
∑ømëîs
) },

94 { 
NULL
, 0, 0 },

97 
Pr›DescDAºayExåa
 
	g°ru˘›î©i⁄_exåa
 = {

98 { 
°ru˘›î©i⁄_¥›s
, 
°ru˘›î©i⁄_off£ts
, "structoperation" },

99 (
NewRec‹dFunc
)
°ru˘_›î©i⁄_√w
,

100 (
FªeRec‹dFunc
)
°ru˘_›î©i⁄_de°roy


103 
STRUCTO≥øti⁄
 *

104 
	$°ru˘_›î©i⁄_√w
()

106 
STRUCTO≥øti⁄
 *
›
;

107 
göt
 
√xt_id
 = 1;

109 
›
 = 
	`g_√w0
(
STRUCTO≥øti⁄
, 1);

110 
›
->
öã∫Æ_id
 = 
√xt_id
++;

111 
›
->
«me
 = 
	`g_°rdup
("");

112 
›
->
commít
 = 
	`g_°rdup
("");

113 
›
->
visibûôy
 = 
STRUCT_PUBLIC
;

114 
›
->
öhîô™˚_ty≥
 = 
STRUCT_LEAF
;

117 
›
->
À·_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

118 
›
->
right_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
, 1);

120  
›
;

121 
	}
}

124 
	$°ru˘_›î©i⁄_c›y_öto
(
STRUCTO≥øti⁄
 *
§c›
, STRUCTO≥øti⁄ *
de°›
)

126 
STRUCTP¨amëî
 *
∑øm
;

127 
STRUCTP¨amëî
 *
√w∑øm
;

128 
GLi°
 *
li°
;

130 
de°›
->
öã∫Æ_id
 = 
§c›
->internal_id;

132 i‡(
de°›
->
«me
 !
NULL
) {

133 
	`g_‰ì
(
de°›
->
«me
);

135 
de°›
->
«me
 = 
	`g_°rdup
(
§c›
->name);

137 i‡(
de°›
->
ty≥
 !
NULL
) {

138 
	`g_‰ì
(
de°›
->
ty≥
);

140 i‡(
§c›
->
ty≥
 !
NULL
) {

141 
de°›
->
ty≥
 = 
	`g_°rdup
(
§c›
->type);

143 
de°›
->
ty≥
 = 
NULL
;

146 i‡(
de°›
->
°îeŸy≥
 !
NULL
) {

147 
	`g_‰ì
(
de°›
->
°îeŸy≥
);

149 if(
§c›
->
°îeŸy≥
 !
NULL
) {

150 
de°›
->
°îeŸy≥
 = 
	`g_°rdup
(
§c›
->stereotype);

152 
de°›
->
°îeŸy≥
 = 
NULL
;

155 i‡(
de°›
->
commít
 !
NULL
) {

156 
	`g_‰ì
(
de°›
->
commít
);

158 i‡(
§c›
->
commít
 !
NULL
) {

159 
de°›
->
commít
 = 
	`g_°rdup
(
§c›
->comment);

161 
de°›
->
commít
 = 
NULL
;

164 
de°›
->
visibûôy
 = 
§c›
->visibility;

165 
de°›
->
˛ass_sc›e
 = 
§c›
->class_scope;

166 
de°›
->
öhîô™˚_ty≥
 = 
§c›
->inheritance_type;

167 
de°›
->
quîy
 = 
§c›
->query;

169 
li°
 = 
de°›
->
∑ømëîs
;

170 
li°
 !
NULL
) {

171 
∑øm
 = (
STRUCTP¨amëî
 *)
li°
->
d©a
;

172 
	`°ru˘_∑ømëî_de°roy
(
∑øm
);

173 
li°
 = 
	`g_li°_√xt
(list);

175 
de°›
->
∑ømëîs
 = 
NULL
;

176 
li°
 = 
§c›
->
∑ømëîs
;

177 
li°
 !
NULL
) {

178 
∑øm
 = (
STRUCTP¨amëî
 *)
li°
->
d©a
;

180 
√w∑øm
 = 
	`g_√w0
(
STRUCTP¨amëî
, 1);

181 
√w∑øm
->
«me
 = 
	`g_°rdup
(
∑øm
->name);

182 
√w∑øm
->
ty≥
 = 
	`g_°rdup
(
∑øm
->type);

183 
√w∑øm
->
commít
 = 
	`g_°rdup
(
∑øm
->comment);

185 i‡(
∑øm
->
vÆue
 !
NULL
)

186 
√w∑øm
->
vÆue
 = 
	`g_°rdup
(
∑øm
->value);

188 
√w∑øm
->
vÆue
 = 
NULL
;

189 
√w∑øm
->
köd
 = 
∑øm
->kind;

191 
de°›
->
∑ømëîs
 = 
	`g_li°_≠≥nd
(de°›->∑ømëîs, 
√w∑øm
);

193 
li°
 = 
	`g_li°_√xt
(list);

195 
	}
}

197 
STRUCTO≥øti⁄
 *

198 
	$°ru˘_›î©i⁄_c›y
(
STRUCTO≥øti⁄
 *
›
)

200 
STRUCTO≥øti⁄
 *
√w›
;

202 
√w›
 = 
	`g_√w0
(
STRUCTO≥øti⁄
, 1);

204 
	`°ru˘_›î©i⁄_c›y_öto
(
›
, 
√w›
);

206 
√w›
->
À·_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
,1);

207 *
√w›
->
À·_c⁄√˘i⁄
 = *
›
->left_connection;

208 
√w›
->
À·_c⁄√˘i⁄
->
obje˘
 = 
NULL
;

210 
√w›
->
right_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
,1);

211 *
√w›
->
right_c⁄√˘i⁄
 = *
›
->right_connection;

212 
√w›
->
right_c⁄√˘i⁄
->
obje˘
 = 
NULL
;

214  
√w›
;

215 
	}
}

218 
	$°ru˘_›î©i⁄_de°roy
(
STRUCTO≥øti⁄
 *
›
)

220 
GLi°
 *
li°
;

221 
STRUCTP¨amëî
 *
∑øm
;

223 
	`g_‰ì
(
›
->
«me
);

224 i‡(
›
->
ty≥
 !
NULL
)

225 
	`g_‰ì
(
›
->
ty≥
);

226 i‡(
›
->
°îeŸy≥
 !
NULL
)

227 
	`g_‰ì
(
›
->
°îeŸy≥
);

229 
	`g_‰ì
(
›
->
commít
);

231 
li°
 = 
›
->
∑ømëîs
;

232 
li°
 !
NULL
) {

233 
∑øm
 = (
STRUCTP¨amëî
 *)
li°
->
d©a
;

234 
	`°ru˘_∑ømëî_de°roy
(
∑øm
);

235 
li°
 = 
	`g_li°_√xt
(list);

237 i‡(
›
->
wøµos
) {

238 
	`g_li°_‰ì
(
›
->
wøµos
);

243 
	`g_‰ì
(
›
->
À·_c⁄√˘i⁄
);

244 
	`g_‰ì
(
›
->
right_c⁄√˘i⁄
);

246 
	`g_‰ì
(
›
);

247 
	}
}

250 
	$°ru˘_›î©i⁄_wrôe
(
AâribuãNode
 
©å_node
, 
STRUCTO≥øti⁄
 *
›
)

252 
GLi°
 *
li°
;

253 
STRUCTP¨amëî
 *
∑øm
;

254 
D©aNode
 
composôe
;

255 
D©aNode
 
composôe2
;

256 
AâribuãNode
 
©å_node2
;

258 
composôe
 = 
	`d©a_add_composôe
(
©å_node
, "structoperation");

260 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "name"),

261 
›
->
«me
);

262 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "stereotype"),

263 
›
->
°îeŸy≥
);

264 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "type"),

265 
›
->
ty≥
);

266 
	`d©a_add_íum
(
	`composôe_add_©åibuã
(
composôe
, "visibility"),

267 
›
->
visibûôy
);

268 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe
, "comment"),

269 
›
->
commít
);

271 
	`d©a_add_boﬁón
(
	`composôe_add_©åibuã
(
composôe
, "abstract"),

272 
›
->
öhîô™˚_ty≥
 =
STRUCT_ABSTRACT
);

273 
	`d©a_add_íum
(
	`composôe_add_©åibuã
(
composôe
, "inheritance_type"),

274 
›
->
öhîô™˚_ty≥
);

275 
	`d©a_add_boﬁón
(
	`composôe_add_©åibuã
(
composôe
, "query"),

276 
›
->
quîy
);

277 
	`d©a_add_boﬁón
(
	`composôe_add_©åibuã
(
composôe
, "class_scope"),

278 
›
->
˛ass_sc›e
);

280 
©å_node2
 = 
	`composôe_add_©åibuã
(
composôe
, "parameters");

282 
li°
 = 
›
->
∑ømëîs
;

283 
li°
 !
NULL
) {

284 
∑øm
 = (
STRUCTP¨amëî
 *Ë
li°
->
d©a
;

286 
composôe2
 = 
	`d©a_add_composôe
(
©å_node2
, "structparameter");

288 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe2
, "name"),

289 
∑øm
->
«me
);

290 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe2
, "type"),

291 
∑øm
->
ty≥
);

292 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe2
, "value"),

293 
∑øm
->
vÆue
);

294 
	`d©a_add_°rög
(
	`composôe_add_©åibuã
(
composôe2
, "comment"),

295 
∑øm
->
commít
);

296 
	`d©a_add_íum
(
	`composôe_add_©åibuã
(
composôe2
, "kind"),

297 
∑øm
->
köd
);

298 
li°
 = 
	`g_li°_√xt
(list);

300 
	}
}

302 
visibÀ_ch¨
[];

305 
	$°ru˘_gë_›î©i⁄_°rög
 (
STRUCTO≥øti⁄
 *
›î©i⁄
)

307 
Àn
;

308 *
°r
;

309 
GLi°
 *
li°
;

310 
STRUCTP¨amëî
 *
∑øm
;

313 
Àn
 = 1 + (
›î©i⁄
->
«me
 ? 
	`°æí
 (operation->name) : 0) + 1;

314 if(
›î©i⁄
->
°îeŸy≥
 !
NULL
 && operation->stereotype[0] != '\0') {

315 
Àn
 +5 + 
	`°æí
 (
›î©i⁄
->
°îeŸy≥
);

318 
li°
 = 
›î©i⁄
->
∑ømëîs
;

319 
li°
 !
NULL
) {

320 
∑øm
 = (
STRUCTP¨amëî
 *Ë
li°
->
d©a
;

321 
li°
 = 
	`g_li°_√xt
 (list);

323 
∑øm
->
köd
)

325 
STRUCT_UNDEF_KIND
:

327 
STRUCT_IN
:

328 
Àn
 += 3;

330 
STRUCT_OUT
:

331 
Àn
 += 4;

333 
STRUCT_INOUT
:

334 
Àn
 += 6;

337 
Àn
 +(
∑øm
->
«me
 ? 
	`°æí
 (param->name) : 0);

338 i‡(
∑øm
->
ty≥
 !
NULL
) {

339 
Àn
 +
	`°æí
 (
∑øm
->
ty≥
);

340 i‡(
∑øm
->
ty≥
[0] &&Ö¨am->
«me
[0]) {

341 
Àn
 += 1;

344 i‡(
∑øm
->
vÆue
 !
NULL
 &&Öaram->value[0] != '\0') {

345 
Àn
 +1 + 
	`°æí
 (
∑øm
->
vÆue
);

348 i‡(
li°
 !
NULL
) {

349 
Àn
 += 1;

353 
Àn
 += 1;

354 i‡(
›î©i⁄
->
ty≥
 !
NULL
 && operation->type[0]) {

355 
Àn
 +2 + 
	`°æí
 (
›î©i⁄
->
ty≥
);

357 if(
›î©i⁄
->
quîy
 != 0) {

358 
Àn
 += 6;

362 
°r
 = 
	`g_mÆloc
 ( (Ë* (
Àn
 + 1));

364 
°r
[0] = 
visibÀ_ch¨
[(Ë
›î©i⁄
->
visibûôy
];

365 
°r
[1] = 0;

367 if(
›î©i⁄
->
°îeŸy≥
 !
NULL
 && operation->stereotype[0] != '\0') {

368 
	`°rˇt
(
°r
, 
STRUCT_STEREOTYPE_START
);

369 
	`°rˇt
(
°r
, 
›î©i⁄
->
°îeŸy≥
);

370 
	`°rˇt
(
°r
, 
STRUCT_STEREOTYPE_END
);

371 
	`°rˇt
(
°r
, " ");

374 
	`°rˇt
 (
°r
, 
›î©i⁄
->
«me
 ? operation->name : "");

375 
	`°rˇt
 (
°r
, "(");

377 
li°
 = 
›î©i⁄
->
∑ømëîs
;

378 
li°
 !
NULL
) {

379 
∑øm
 = (
STRUCTP¨amëî
 *Ë
li°
->
d©a
;

380 
li°
 = 
	`g_li°_√xt
 (list);

382 
∑øm
->
köd
)

384 
STRUCT_UNDEF_KIND
:

386 
STRUCT_IN
:

387 
	`°rˇt
 (
°r
, "in ");

389 
STRUCT_OUT
:

390 
	`°rˇt
 (
°r
, "out ");

392 
STRUCT_INOUT
:

393 
	`°rˇt
 (
°r
, "inout ");

396 
	`°rˇt
 (
°r
, 
∑øm
->
«me
 ?Öaram->name : "");

398 i‡(
∑øm
->
ty≥
 !
NULL
) {

399 i‡(
∑øm
->
ty≥
[0] &&Ö¨am->
«me
[0]) {

400 
	`°rˇt
 (
°r
, ":");

402 
	`°rˇt
 (
°r
, 
∑øm
->
ty≥
);

405 i‡(
∑øm
->
vÆue
 !
NULL
 &&Öaram->value[0] != '\0') {

406 
	`°rˇt
 (
°r
, "=");

407 
	`°rˇt
 (
°r
, 
∑øm
->
vÆue
);

410 i‡(
li°
 !
NULL
) {

411 
	`°rˇt
 (
°r
, ",");

414 
	`°rˇt
 (
°r
, ")");

416 i‡(
›î©i⁄
->
ty≥
 !
NULL
 &&

417 
›î©i⁄
->
ty≥
[0]) {

418 
	`°rˇt
 (
°r
, ": ");

419 
	`°rˇt
 (
°r
, 
›î©i⁄
->
ty≥
);

422 i‡(
›î©i⁄
->
quîy
 != 0) {

423 
	`°rˇt
(
°r
, " const");

426 
	`g_as£π
 (
	`°æí
 (
°r
Ë=
Àn
);

428  
°r
;

429 
	}
}

443 
	$°ru˘_›î©i⁄_ísuª_c⁄√˘i⁄_poöts
 (
STRUCTO≥øti⁄
* 
›
, 
DüObje˘
* 
obj
)

445 i‡(!
›
->
À·_c⁄√˘i⁄
)

446 
›
->
À·_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
,1);

447 
›
->
À·_c⁄√˘i⁄
->
obje˘
 = 
obj
;

448 i‡(!
›
->
right_c⁄√˘i⁄
)

449 
›
->
right_c⁄√˘i⁄
 = 
	`g_√w0
(
C⁄√˘i⁄Poöt
,1);

450 
›
->
right_c⁄√˘i⁄
->
obje˘
 = 
obj
;

451 
	}
}

	@O:\tool\dvs50\objects\Struct\structparameter.c

24 #ifde‡
HAVE_CONFIG_H


25 
	~<c⁄fig.h
>

28 
	~<°rög.h
>

30 
	~"°ru˘.h
"

31 
	~"¥›îtõs.h
"

33 
Pr›EnumD©a
 
	g_°ru˘_∑ømëî_köds
[] = {

34 { 
N_
("Undeföed"), 
STRUCT_UNDEF_KIND
} ,

35 { 
N_
("In"), 
STRUCT_IN
 },

36 { 
N_
("Out"), 
STRUCT_OUT
 },

37 { 
N_
("I¿& Out"), 
STRUCT_INOUT
 },

38 { 
NULL
, 0 }

41 
Pr›Des¸ùti⁄
 
	g°ru˘∑ømëî_¥›s
[] = {

42 { "«me", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

43 
N_
("Name"), 
NULL
, NULL },

44 { "ty≥", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

45 
N_
("Ty≥"), 
NULL
, NULL },

46 { "vÆue", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

47 
N_
("VÆue"), 
NULL
, NULL },

48 { "commít", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

49 
N_
("Commít"), 
NULL
, NULL },

50 { "köd", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

51 
N_
("Köd"), 
NULL
, 
_°ru˘_∑ømëî_köds
 },

53 
PROP_DESC_END


56 
Pr›Off£t
 
	g°ru˘∑ømëî_off£ts
[] = {

57 { "«me", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTP¨amëî
, 
«me
) },

58 { "ty≥", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTP¨amëî
, 
ty≥
) },

59 { "vÆue", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTP¨amëî
, 
vÆue
) },

60 { "commít", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTP¨amëî
, 
commít
) },

61 { "köd", 
PROP_TYPE_ENUM
, 
off£tof
(
STRUCTP¨amëî
, 
köd
) },

62 { 
NULL
, 0, 0 },

65 
Pr›DescDAºayExåa
 
	g°ru˘∑ømëî_exåa
 = {

66 { 
°ru˘∑ømëî_¥›s
, 
°ru˘∑ømëî_off£ts
, "structparameter" },

67 (
NewRec‹dFunc
)
°ru˘_∑ømëî_√w
,

68 (
FªeRec‹dFunc
)
°ru˘_∑ømëî_de°roy


71 
STRUCTP¨amëî
 *

72 
	$°ru˘_∑ømëî_√w
()

74 
STRUCTP¨amëî
 *
∑øm
;

76 
∑øm
 = 
	`g_√w0
(
STRUCTP¨amëî
, 1);

77 
∑øm
->
«me
 = 
	`g_°rdup
("");

78 
∑øm
->
ty≥
 = 
	`g_°rdup
("");

79 
∑øm
->
commít
 = 
	`g_°rdup
("");

80 
∑øm
->
vÆue
 = 
NULL
;

81 
∑øm
->
köd
 = 
STRUCT_UNDEF_KIND
;

83  
∑øm
;

84 
	}
}

87 
	$°ru˘_∑ømëî_de°roy
(
STRUCTP¨amëî
 *
∑øm
)

89 
	`g_‰ì
(
∑øm
->
«me
);

90 
	`g_‰ì
(
∑øm
->
ty≥
);

91 i‡(
∑øm
->
vÆue
 !
NULL
)

92 
	`g_‰ì
(
∑øm
->
vÆue
);

93 
	`g_‰ì
(
∑øm
->
commít
);

95 
	`g_‰ì
(
∑øm
);

96 
	}
}

99 
	$°ru˘_gë_∑ømëî_°rög
 (
STRUCTP¨amëî
 *
∑øm
)

101 
Àn
;

102 *
°r
;

105 
Àn
 = 
	`°æí
 (
∑øm
->
«me
Ë+ 1 + såÀ¿’¨am->
ty≥
);

107 i‡(
∑øm
->
vÆue
 !
NULL
) {

108 
Àn
 +1 + 
	`°æí
 (
∑øm
->
vÆue
) ;

111 
∑øm
->
köd
)

113 
STRUCT_UNDEF_KIND
:

115 
STRUCT_IN
:

116 
Àn
 += 3;

118 
STRUCT_OUT
:

119 
Àn
 += 4;

121 
STRUCT_INOUT
:

122 
Àn
 += 6;

127 
°r
 = 
	`g_mÆloc
 ( (Ë* (
Àn
 + 1));

129 
	`°r˝y
(
°r
, "");

131 
∑øm
->
köd
)

133 
STRUCT_UNDEF_KIND
:

135 
STRUCT_IN
:

136 
	`°rˇt
 (
°r
, "in ");

138 
STRUCT_OUT
:

139 
	`°rˇt
 (
°r
, "out ");

141 
STRUCT_INOUT
:

142 
	`°rˇt
 (
°r
, "inout ");

147 
	`°rˇt
 (
°r
, 
∑øm
->
«me
);

148 
	`°rˇt
 (
°r
, ":");

149 
	`°rˇt
 (
°r
, 
∑øm
->
ty≥
);

150 i‡(
∑øm
->
vÆue
 !
NULL
) {

151 
	`°rˇt
 (
°r
, "=");

152 
	`°rˇt
 (
°r
, 
∑øm
->
vÆue
);

155 
	`g_as£π
 (
	`°æí
 (
°r
Ë=
Àn
);

157  
°r
;

158 
	}
}

	@O:\tool\dvs50\objects\UML\class.h

24 #i‚de‡
CLASS_H


25 
	#CLASS_H


	)

27 
	~"obje˘.h
"

28 
	~"ñemít.h
"

29 
	~"c⁄√˘i⁄poöt.h
"

30 
	~"widgës.h
"

32 
	~"uml.h
"

34 
	#DIA_OBJECT
(
x
Ë(
DüObje˘
*)(x)

	)

38 
	#UMLCLASS_CONNECTIONPOINTS
 8

	)

40 
	#UMLCLASS_WRAP_AFTER_CHAR
 40

	)

42 
	#UMLCLASS_COMMENT_LINE_LENGTH
 40

	)

54 
	#UML_MAINPOINT
 1

	)

57 
_UMLCœss
 
	tUMLCœss
;

58 
_UMLCœssDülog
 
	tUMLCœssDülog
;

65 
	s_UMLCœss
 {

66 
EÀmít
 
	mñemít
;

69 #ifde‡
UML_MAINPOINT


70 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[
UMLCLASS_CONNECTIONPOINTS
 + 1];

72 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[
UMLCLASS_CONNECTIONPOINTS
];

77 
ªÆ
 
	mlöe_width
;

78 
ªÆ
 
	mf⁄t_height
;

79 
ªÆ
 
	mab°ø˘_f⁄t_height
;

80 
ªÆ
 
	mpﬁym‹phic_f⁄t_height
;

81 
ªÆ
 
	m˛as¢ame_f⁄t_height
;

82 
ªÆ
 
	mab°ø˘_˛as¢ame_f⁄t_height
;

83 
ªÆ
 
	mcommít_f⁄t_height
;

85 
DüF⁄t
 *
	mn‹mÆ_f⁄t
;

86 
DüF⁄t
 *
	mab°ø˘_f⁄t
;

87 
DüF⁄t
 *
	mpﬁym‹phic_f⁄t
;

88 
DüF⁄t
 *
	m˛as¢ame_f⁄t
;

89 
DüF⁄t
 *
	mab°ø˘_˛as¢ame_f⁄t
;

90 
DüF⁄t
 *
	mcommít_f⁄t
;

92 *
	m«me
;

93 *
	m°îeŸy≥
;

94 *
	mcommít
;

95 
	mab°ø˘
;

96 
	msuµªss_©åibuãs
;

97 
	msuµªss_›î©i⁄s
;

98 
	mvisibÀ_©åibuãs
;

99 
	mvisibÀ_›î©i⁄s
;

100 
	mvisibÀ_commíts
;

102 
	mwøp_›î©i⁄s
;

103 
	mwøp_a·î_ch¨
;

104 
	mcommít_löe_Àngth
;

105 
	mcommít_èggög
;

107 
Cﬁ‹
 
	mlöe_cﬁ‹
;

108 
Cﬁ‹
 
	mfûl_cﬁ‹
;

109 
Cﬁ‹
 
	mãxt_cﬁ‹
;

112 
GLi°
 *
	m©åibuãs
;

115 
GLi°
 *
	m›î©i⁄s
;

118 
	mãm∂©e
;

120 
GLi°
 *
	mf‹mÆ_∑øms
;

124 
ªÆ
 
	m«mebox_height
;

125 *
	m°îeŸy≥_°rög
;

127 
ªÆ
 
	m©åibuãsbox_height
;

129 
ªÆ
 
	m›î©i⁄sbox_height
;

132 
	mmax_wøµed_löe_width
;

134 
ªÆ
 
	mãm∂©es_height
;

135 
ªÆ
 
	mãm∂©es_width
;

138 
UMLCœssDülog
 *
	m¥›îtõs_dülog
;

144 
gboﬁón
 
	mde°royed
;

147 
uml˛ass_dülog_‰ì
 (
UMLCœssDülog
 *
dülog
);

148 
GtkWidgë
 *
uml˛ass_gë_¥›îtõs
(
UMLCœss
 *
uml˛ass
, 
gboﬁón
 
is_deÁu…
);

149 
Obje˘Ch™ge
 *
uml˛ass_≠∂y_¥›s_‰om_dülog
(
UMLCœss
 *
uml˛ass
, 
GtkWidgë
 *
widgë
);

150 
uml˛ass_ˇlcuœã_d©a
(
UMLCœss
 *
uml˛ass
);

151 
uml˛ass_upd©e_d©a
(
UMLCœss
 *
uml˛ass
);

153 
uml˛ass_ßnôy_check
(
UMLCœss
 *
c
, 
gch¨
 *
msg
);

	@O:\tool\dvs50\objects\UML\stereotype.h

19 #i‚de‡
STEREOTYPE_H


20 
	#STEREOTYPE_H


	)

22 
	~"uml.h
"

24 *
°rög_to_bøckëãd
 (*
°r
,

25 c⁄° *
°¨t_bøckë
, c⁄° *
íd_bøckë
);

26 *
bøckëãd_to_°rög
 (*
bøckëãd
, c⁄° *
°¨t_bøckë
,

27 c⁄° *
íd_bøckë
);

28 *
°rög_to_°îeŸy≥
 (*
°r
);

29 *
°îeŸy≥_to_°rög
 (*
°îeŸy≥
);

30 *
ªmove_°îeŸy≥_‰om_°rög
 (*
°îeŸy≥
);

	@O:\tool\dvs50\objects\UML\uml.h

21 #i‚de‡
UML_H


22 
	#UML_H


	)

24 
	~<glib.h
>

25 
	~"öé.h
"

26 
	~"c⁄√˘i⁄poöt.h
"

27 
	~"dü_xml.h
"

29 
_UMLAâribuã
 
	tUMLAâribuã
;

30 
_UMLO≥øti⁄
 
	tUMLO≥øti⁄
;

31 
_UMLP¨amëî
 
	tUMLP¨amëî
;

32 
_UMLF‹mÆP¨amëî
 
	tUMLF‹mÆP¨amëî
;

35 
	e_UMLVisibûôy
 {

36 
	mUML_PUBLIC
,

37 
	mUML_PRIVATE
,

38 
	mUML_PROTECTED
,

39 
	mUML_IMPLEMENTATION


40 } 
	tUMLVisibûôy
;

43 
	e_UMLInhîô™˚Ty≥
 {

44 
	mUML_ABSTRACT
,

45 
	mUML_POLYMORPHIC
,

46 
	mUML_LEAF


47 } 
	tUMLInhîô™˚Ty≥
;

50 
	e_UMLP¨amëîKöd
 {

51 
	mUML_UNDEF_KIND
,

52 
	mUML_IN
,

53 
	mUML_OUT
,

54 
	mUML_INOUT


55 } 
	tUMLP¨amëîKöd
;

57 
gch¨
 * 
	tUMLSãªŸy≥
;

62 
	s_UMLAâribuã
 {

63 
göt
 
	möã∫Æ_id
;

65 
gch¨
 *
	m«me
;

66 
gch¨
 *
	mty≥
;

67 
gch¨
 *
	mvÆue
;

68 
gch¨
 *
	mcommít
;

69 
UMLVisibûôy
 
	mvisibûôy
;

70 
	mab°ø˘
;

71 
	m˛ass_sc›e
;

73 
C⁄√˘i⁄Poöt
* 
	mÀ·_c⁄√˘i⁄
;

74 
C⁄√˘i⁄Poöt
* 
	mright_c⁄√˘i⁄
;

80 
	s_UMLO≥øti⁄
 {

81 
göt
 
	möã∫Æ_id
;

83 
gch¨
 *
	m«me
;

84 
gch¨
 *
	mty≥
;

85 
gch¨
 *
	mcommít
;

86 
UMLSãªŸy≥
 
	m°îeŸy≥
;

87 
UMLVisibûôy
 
	mvisibûôy
;

88 
UMLInhîô™˚Ty≥
 
	möhîô™˚_ty≥
;

89 
	mquîy
;

90 
	m˛ass_sc›e
;

91 
GLi°
 *
	m∑ømëîs
;

93 
C⁄√˘i⁄Poöt
* 
	mÀ·_c⁄√˘i⁄
;

94 
C⁄√˘i⁄Poöt
* 
	mright_c⁄√˘i⁄
;

96 
gboﬁón
 
	m√eds_wøµög
;

97 
göt
 
	mwøp_ödít
;

98 
GLi°
 *
	mwøµos
;

99 
ªÆ
 
	mas˚¡
;

106 
	s_UMLP¨amëî
 {

107 
gch¨
 *
	m«me
;

108 
gch¨
 *
	mty≥
;

109 
gch¨
 *
	mvÆue
;

110 
gch¨
 *
	mcommít
;

111 
UMLP¨amëîKöd
 
	mköd
;

117 
	s_UMLF‹mÆP¨amëî
 {

118 
gch¨
 *
	m«me
;

119 
gch¨
 *
	mty≥
;

124 
	#UML_STEREOTYPE_START
 
	`_
("<<")

	)

126 
	#UML_STEREOTYPE_END
 
	`_
(">>")

	)

129 
gch¨
 *
uml_gë_©åibuã_°rög
 (
UMLAâribuã
 *
©åibuã
);

131 
gch¨
 *
uml_gë_›î©i⁄_°rög
(
UMLO≥øti⁄
 *
›î©i⁄
);

133 
gch¨
 *
uml_gë_∑ømëî_°rög
(
UMLP¨amëî
 *
∑øm
);

135 
gch¨
 *
uml_gë_f‹mÆ∑ømëî_°rög
(
UMLF‹mÆP¨amëî
 *
∑ømëî
);

136 
uml_©åibuã_c›y_öto
(
UMLAâribuã
 *
§ˇâr
, UMLAâribuã *
de°©å
);

137 
UMLAâribuã
 *
uml_©åibuã_c›y
(UMLAâribuã *
©å
);

138 
uml_›î©i⁄_c›y_öto
(
UMLO≥øti⁄
 *
§c›
, UMLO≥øti⁄ *
de°›
);

139 
UMLO≥øti⁄
 *
uml_›î©i⁄_c›y
(UMLO≥øti⁄ *
›
);

140 
UMLF‹mÆP¨amëî
 *
uml_f‹mÆ∑ømëî_c›y
(UMLF‹mÆP¨amëî *
∑øm
);

141 
uml_©åibuã_de°roy
(
UMLAâribuã
 *
©åibuã
);

142 
uml_›î©i⁄_de°roy
(
UMLO≥øti⁄
 *
›
);

143 
uml_∑ømëî_de°roy
(
UMLP¨amëî
 *
∑øm
);

144 
uml_f‹mÆ∑ømëî_de°roy
(
UMLF‹mÆP¨amëî
 *
∑øm
);

145 
UMLAâribuã
 *
uml_©åibuã_√w
();

146 
UMLO≥øti⁄
 *
uml_›î©i⁄_√w
();

147 
UMLP¨amëî
 *
uml_∑ømëî_√w
();

148 
UMLF‹mÆP¨amëî
 *
uml_f‹mÆ∑ømëî_√w
();

150 
uml_©åibuã_ísuª_c⁄√˘i⁄_poöts
 (
UMLAâribuã
 *
©å
, 
DüObje˘
* 
obj
);

151 
uml_›î©i⁄_ísuª_c⁄√˘i⁄_poöts
 (
UMLO≥øti⁄
 *
›î
, 
DüObje˘
* 
obj
);

153 
uml_©åibuã_wrôe
(
AâribuãNode
 
©å_node
, 
UMLAâribuã
 *
©å
);

154 
uml_›î©i⁄_wrôe
(
AâribuãNode
 
©å_node
, 
UMLO≥øti⁄
 *
›
);

155 
uml_f‹mÆ∑ømëî_wrôe
(
AâribuãNode
 
©å_node
, 
UMLF‹mÆP¨amëî
 *
∑øm
);

	@O:\tool\dvs50\objects\standard\arc.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<as£π.h
>

24 
	#_BSD_SOURCE
 1

	)

25 
	~<m©h.h
>

27 
	~"öé.h
"

28 
	~"obje˘.h
"

29 
	~"c⁄√˘i⁄.h
"

30 
	~"c⁄√˘i⁄poöt.h
"

31 
	~"düªndîî.h
"

32 
	~"©åibuãs.h
"

33 
	~"widgës.h
"

34 
	~"¨rows.h
"

35 
	~"¥›îtõs.h
"

37 
	~"toﬁ-ic⁄s.h
"

39 
	#DEFAULT_WIDTH
 0.25

	)

41 
	#HANDLE_MIDDLE
 
HANDLE_CUSTOM1


	)

44 
	#TRACE
(
fun
Ë

	)

46 
_Arc
 
	tArc
;

48 
	s_Arc
 {

49 
C⁄√˘i⁄
 
	mc⁄√˘i⁄
;

51 
H™dÀ
 
	mmiddÀ_h™dÀ
;

53 
Cﬁ‹
 
	m¨c_cﬁ‹
;

54 
ªÆ
 
	mcurve_di°™˚
;

55 
ªÆ
 
	mlöe_width
;

56 
LöeStyÀ
 
	mlöe_°yÀ
;

57 
ªÆ
 
	mdashÀngth
;

58 
Aºow
 
	m°¨t_¨row
, 
	míd_¨row
;

61 
ªÆ
 
	mødius
;

62 
Poöt
 
	m˚¡î
;

63 
ªÆ
 
	m™gÀ1
, 
	m™gÀ2
;

68 
Obje˘Ch™ge
* 
¨c_move_h™dÀ
(
Arc
 *
¨c
, 
H™dÀ
 *
h™dÀ
,

69 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

70 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

71 
Obje˘Ch™ge
* 
¨c_move
(
Arc
 *
¨c
, 
Poöt
 *
to
);

72 
¨c_£À˘
(
Arc
 *
¨c
, 
Poöt
 *
˛icked_poöt
,

73 
DüRídîî
 *
öãø˘ive_ªndîî
);

74 
¨c_døw
(
Arc
 *
¨c
, 
DüRídîî
 *
ªndîî
);

75 
DüObje˘
 *
¨c_¸óã
(
Poöt
 *
°¨çoöt
,

76 *
u£r_d©a
,

77 
H™dÀ
 **
h™dÀ1
,

78 
H™dÀ
 **
h™dÀ2
);

79 
ªÆ
 
¨c_di°™˚_‰om
(
Arc
 *
¨c
, 
Poöt
 *
poöt
);

80 
¨c_upd©e_d©a
(
Arc
 *
¨c
);

81 
¨c_upd©e_h™dÀs
(
Arc
 *
¨c
);

82 
¨c_de°roy
(
Arc
 *
¨c
);

83 
DüObje˘
 *
¨c_c›y
(
Arc
 *
¨c
);

85 
Pr›Des¸ùti⁄
 *
¨c_des¸ibe_¥›s
(
Arc
 *
¨c
);

86 
¨c_gë_¥›s
(
Arc
 *
¨c
, 
GPåAºay
 *
¥›s
);

87 
¨c_£t_¥›s
(
Arc
 *
¨c
, 
GPåAºay
 *
¥›s
);

89 
¨c_ßve
(
Arc
 *
¨c
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
);

90 
DüObje˘
 *
¨c_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
);

91 
¨c_compuã_midpoöt
(
Arc
 *
¨c
, c⁄° 
Poöt
 * 
ï0
, c⁄° Poöà* 
ï1
 , Poöà* 
midpoöt
);

92 
ˇlcuœã_¨c_obje˘_edge
(
Arc
 *
¨c
, 
ªÆ
 
™g_°¨t
,Ñó»
™g_íd
, 
DüObje˘
 *
obj
, 
Poöt
 *
èrgë
, 
gboﬁón
 
˛ockwi£√ss
);

93 
¨c_gë_poöt_©_™gÀ
(
Arc
 *
¨c
, 
Poöt
* 
poöt
, 
ªÆ
 
™gÀ
);

94 
ªÆ
 
round_™gÀ
‘ó»
™gÀ
);

95 
ªÆ
 
gë_middÀ_¨c_™gÀ
‘ó»
™gÀ1
,Ñó»
™gÀ2
, 
gboﬁón
 
˛ock
);

97 
Obje˘Ty≥Ops
 
	g¨c_ty≥_›s
 =

99 (
Cª©eFunc
Ë
¨c_¸óã
,

100 (
LﬂdFunc
Ë
¨c_lﬂd
,

101 (
SaveFunc
Ë
¨c_ßve
,

102 (
GëDeÁu…sFunc
Ë
NULL
,

103 (
AµlyDeÁu…sFunc
Ë
NULL


106 
DüObje˘Ty≥
 
	g¨c_ty≥
 =

110 (**Ë
¨c_ic⁄
,

112 &
¨c_ty≥_›s


115 
DüObje˘Ty≥
 *
	g_¨c_ty≥
 = (DüObje˘Ty≥ *Ë&
¨c_ty≥
;

117 
Obje˘Ops
 
	g¨c_›s
 = {

118 (
De°royFunc
Ë
¨c_de°roy
,

119 (
DøwFunc
Ë
¨c_døw
,

120 (
Di°™˚Func
Ë
¨c_di°™˚_‰om
,

121 (
Sñe˘Func
Ë
¨c_£À˘
,

122 (
C›yFunc
Ë
¨c_c›y
,

123 (
MoveFunc
Ë
¨c_move
,

124 (
MoveH™dÀFunc
Ë
¨c_move_h™dÀ
,

125 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

126 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

127 (
Obje˘MíuFunc
Ë
NULL
,

128 (
Des¸ibePr›sFunc
Ë
¨c_des¸ibe_¥›s
,

129 (
GëPr›sFunc
Ë
¨c_gë_¥›s
,

130 (
SëPr›sFunc
Ë
¨c_£t_¥›s
,

131 (
TextEdôFunc
) 0,

132 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

135 
Pr›Des¸ùti⁄
 
	g¨c_¥›s
[] = {

136 
OBJECT_COMMON_PROPERTIES
,

137 
PROP_STD_LINE_WIDTH
,

138 
PROP_STD_LINE_COLOUR
,

139 
PROP_STD_LINE_STYLE
,

140 
PROP_STD_START_ARROW
,

141 
PROP_STD_END_ARROW
,

142 { "curve_di°™˚", 
PROP_TYPE_REAL
, 0,

143 
N_
("Curvêdi°™˚"), 
NULL
 },

144 
PROP_DESC_END


147 
Pr›Des¸ùti⁄
 *

148 
	$¨c_des¸ibe_¥›s
(
Arc
 *
¨c
)

150 i‡(
¨c_¥›s
[0].
qu¨k
 == 0)

151 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
¨c_¥›s
);

152  
¨c_¥›s
;

153 
	}
}

155 
Pr›Off£t
 
	g¨c_off£ts
[] = {

156 
OBJECT_COMMON_PROPERTIES_OFFSETS
,

157 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Arc
, 
löe_width
) },

158 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Arc
, 
¨c_cﬁ‹
) },

159 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

160 
off£tof
(
Arc
, 
löe_°yÀ
), off£tof(Arc, 
dashÀngth
) },

161 { "°¨t_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Arc
, 
°¨t_¨row
) },

162 { "íd_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Arc
, 
íd_¨row
) },

163 { "curve_di°™˚", 
PROP_TYPE_REAL
, 
off£tof
(
Arc
, 
curve_di°™˚
) },

164 { "°¨t_poöt", 
PROP_TYPE_POINT
, 
off£tof
(
C⁄√˘i⁄
, 
ídpoöts
[0]) },

165 { "íd_poöt", 
PROP_TYPE_POINT
, 
off£tof
(
C⁄√˘i⁄
, 
ídpoöts
[1]) },

166 { 
NULL
, 0, 0 }

170 
	$¨c_gë_¥›s
(
Arc
 *
¨c
, 
GPåAºay
 *
¥›s
)

172 
	`obje˘_gë_¥›s_‰om_off£ts
(&
¨c
->
c⁄√˘i⁄
.
obje˘
,

173 
¨c_off£ts
, 
¥›s
);

174 
	}
}

177 
	$¨c_£t_¥›s
(
Arc
 *
¨c
, 
GPåAºay
 *
¥›s
)

179 
	`obje˘_£t_¥›s_‰om_off£ts
(&
¨c
->
c⁄√˘i⁄
.
obje˘
,

180 
¨c_off£ts
, 
¥›s
);

181 
	`¨c_upd©e_d©a
(
¨c
);

182 
	}
}

185 
	$ö_™gÀ
(
ªÆ
 
™gÀ
,Ñó»
°¨èngÀ
,Ñó»
íd™gÀ
)

187 i‡(
°¨èngÀ
 > 
íd™gÀ
) {

188 
íd™gÀ
 += 360.0;

189 i‡(
™gÀ
<
°¨èngÀ
)

190 
™gÀ
 += 360;

192  (
™gÀ
>=
°¨èngÀ
Ë&& (™gÀ<=
íd™gÀ
);

193 
	}
}

195 
ªÆ


196 
	$¨c_di°™˚_‰om
(
Arc
 *
¨c
, 
Poöt
 *
poöt
)

198 
Poöt
 *
ídpoöts
;

199 
Poöt
 
‰om_˚¡î
;

200 
ªÆ
 
™gÀ
;

201 
ªÆ
 
d
, 
d2
;

203 
ídpoöts
 = &
¨c
->
c⁄√˘i⁄
.endpoints[0];

205 
‰om_˚¡î
 = *
poöt
;

206 
	`poöt_sub
(&
‰om_˚¡î
, &
¨c
->
˚¡î
);

208 
™gÀ
 = -
	`©™2
(
‰om_˚¡î
.
y
, from_˚¡î.
x
)*180.0/
M_PI
;

209 i‡(
™gÀ
<0)

210 
™gÀ
+=360.0;

212 i‡(
	`ö_™gÀ
(
™gÀ
, 
¨c
->
™gÀ1
,árc->
™gÀ2
)) {

213 
d
 = 
	`Ábs
(
	`sqπ
(
	`poöt_dŸ
(&
‰om_˚¡î
, &‰om_˚¡î)Ë- 
¨c
->
ødius
);

214 
d
 -
¨c
->
löe_width
/2.0;

215 i‡(
d
<0)

216 
d
 = 0.0;

217  
d
;

219 
d
 = 
	`di°™˚_poöt_poöt
(&
ídpoöts
[0], 
poöt
);

220 
d2
 = 
	`di°™˚_poöt_poöt
(&
ídpoöts
[1], 
poöt
);

222  
	`MIN
(
d
,
d2
);

224 
	}
}

227 
	$¨c_£À˘
(
Arc
 *
¨c
, 
Poöt
 *
˛icked_poöt
,

228 
DüRídîî
 *
öãø˘ive_ªndîî
)

230 
	`¨c_upd©e_h™dÀs
(
¨c
);

231 
	}
}

234 
	$¨c_upd©e_h™dÀs
(
Arc
 *
¨c
)

236 
Poöt
 *
middÀ_pos
;

237 
ªÆ
 
di°
,
dx
,
dy
;

239 
C⁄√˘i⁄
 *
c⁄n
 = &
¨c
->
c⁄√˘i⁄
;

241 
	`c⁄√˘i⁄_upd©e_h™dÀs
(
c⁄n
);

243 
middÀ_pos
 = &
¨c
->
middÀ_h™dÀ
.
pos
;

244 
middÀ_pos
->
x
 = (
c⁄n
->
ídpoöts
[0].x + conn->endpoints[1].x) / 2.0;

245 
middÀ_pos
->
y
 = (
c⁄n
->
ídpoöts
[0].y + conn->endpoints[1].y) / 2.0;

247 
dx
 = 
c⁄n
->
ídpoöts
[1].
x
 - conn->endpoints[0].x;

248 
dy
 = 
c⁄n
->
ídpoöts
[1].
y
 - conn->endpoints[0].y;

250 
di°
 = 
	`sqπ
(
dx
*dx + 
dy
*dy);

251 i‡(
di°
 > 0.000001) {

252 
middÀ_pos
->
x
 -
¨c
->
curve_di°™˚
*
dy
/
di°
;

253 
middÀ_pos
->
y
 +
¨c
->
curve_di°™˚
*
dx
/
di°
;

255 
	}
}

257 
ªÆ


258 
	$¨c_compuã_curve_di°™˚
(c⁄° 
Arc
 *
¨c
, c⁄° 
Poöt
 *
°¨t
, c⁄° Poöà*
íd
, c⁄° Poöà*
mid
)

260 
Poöt
 
a
,
b
;

261 
ªÆ
 
tmp
,
cd
;

263 
b
 = *
mid
;

264 
	`poöt_sub
(&
b
, 
°¨t
);

266 
a
 = *
íd
;

267 
	`poöt_sub
(&
a
, 
°¨t
);

269 
tmp
 = 
	`poöt_dŸ
(&
a
,&
b
);

270 
cd
 =

271 
	`sqπ
(
	`Ábs
(
	`poöt_dŸ
(&
b
,&bË- 
tmp
*tmp/poöt_dŸ(&
a
,&a)));

273 i‡(
a
.
x
*
b
.
y
 -á.y*b.x < 0)

274 
cd
 = - cd;

275  
cd
;

276 
	}
}

281 
	$rŸ©e_poöt_¨ound_poöt
(
Poöt
 *
p
, c⁄° Poöà*
˚¡î
, 
ªÆ
 
™gÀ
)

283 
ªÆ
 
ødius
;

284 
ªÆ
 
a
;

285 
	`poöt_sub
(
p
,
˚¡î
);

286 
ødius
 = 
	`poöt_Àn
(
p
);

287 
a
 = -
	`©™2
(
p
->
y
,p->
x
);

288 
a
 +
™gÀ
;

289 
p
->
x
 = 
	`cos
(
a
);Ö->
y
 = -
	`sö
(a);

290 
	`poöt_sˇÀ
(
p
,
ødius
);

291 
	`poöt_add
(
p
,
˚¡î
);

292 
	}
}

299 
	$¨c_föd_ødül
(c⁄° 
Arc
 *
¨c
, c⁄° 
Poöt
 *
to
, Poöà*
be°
)

301 
Poöt
 
tmp
;

302 
tmp
 = *
to
;

303 
	`poöt_sub
(&
tmp
, &
¨c
->
˚¡î
);

304 
	`poöt_n‹mÆize
(&
tmp
);

305 
	`poöt_sˇÀ
(&
tmp
,
¨c
->
ødius
);

306 
	`poöt_add
(&
tmp
, &
¨c
->
˚¡î
);

307 *
be°
 = 
tmp
;

310 
	}
}

312 
Obje˘Ch™ge
*

313 
	$¨c_move_h™dÀ
(
Arc
 *
¨c
, 
H™dÀ
 *
h™dÀ
,

314 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

315 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

317 
	`as£π
(
¨c
!=
NULL
);

318 
	`as£π
(
h™dÀ
!=
NULL
);

319 
	`as£π
(
to
!=
NULL
);

323 c⁄° 
Poöt
 *
p1
, *
p2
;

325 i‡(
h™dÀ
->
id
 =
HANDLE_MIDDLE
) {

326 
p1
 = &
¨c
->
c⁄√˘i⁄
.
ídpoöts
[0];

327 
p2
 = &
¨c
->
c⁄√˘i⁄
.
ídpoöts
[1];

329 
p1
 = &
¨c
->
middÀ_h™dÀ
.
pos
;

330 
p2
 = &
¨c
->
c⁄√˘i⁄
.
ídpoöts
[(
h™dÀ
 =(&¨c->c⁄√˘i⁄.
ídpoöt_h™dÀs
[0])) ? 1 : 0];

332 i‡–(
	`di°™˚_poöt_poöt
 (
to
, 
p1
) < 0.01)

333 || (
	`di°™˚_poöt_poöt
 (
to
, 
p2
) < 0.01))

334  
NULL
;

337 i‡(
h™dÀ
->
id
 =
HANDLE_MIDDLE
) {

338 
	`TRACE
(
	`¥ötf
("curve_di°: %.2‡\n",
¨c
->
curve_di°™˚
));

339 
¨c
->
curve_di°™˚
 = 
	`¨c_compuã_curve_di°™˚
◊rc, &¨c->
c⁄√˘i⁄
.
ídpoöts
[0], &¨c->c⁄√˘i⁄.ídpoöts[1], 
to
);

340 
	`TRACE
(
	`¥ötf
("curve_di°: %.2‡\n",
¨c
->
curve_di°™˚
));

343 
Poöt
 
be°
;

344 
	`TRACE
(
	`¥ötf
("Modifõrs: %d \n",
modifõrs
));

345 i‡(
modifõrs
 & 
MODIFIER_SHIFT
)

348 
	`TRACE
(
	`¥ötf
("SHIFT USED,Åÿ© %.2‡%.2‡ ",
to
->
x
,to->
y
));

349 i‡(
	`¨c_föd_ødül
(
¨c
, 
to
, &
be°
)){

352 
Poöt
 
midpoöt
;

353 
ok
;

354 i‡(
h™dÀ
 =(&
¨c
->
c⁄√˘i⁄
.
ídpoöt_h™dÀs
[0]))

355 
ok
 = 
	`¨c_compuã_midpoöt
(
¨c
, &
be°
 , &¨c->
c⁄√˘i⁄
.
ídpoöts
[1], &
midpoöt
);

357 
ok
 = 
	`¨c_compuã_midpoöt
(
¨c
, &¨c->
c⁄√˘i⁄
.
ídpoöts
[0], &
be°
 , &
midpoöt
);

358 i‡(!
ok
)

359  
NULL
;

360 
	`c⁄√˘i⁄_move_h™dÀ
(&
¨c
->
c⁄√˘i⁄
, 
h™dÀ
->
id
, &
be°
, 
˝
, 
ªas⁄
, 
modifõrs
);

362 
¨c
->
curve_di°™˚
 = 
	`¨c_compuã_curve_di°™˚
◊rc, &¨c->
c⁄√˘i⁄
.
ídpoöts
[0], &¨c->c⁄√˘i⁄.ídpoöts[1], &
midpoöt
);

363 
	`TRACE
(
	`¥ötf
("curve_di°: %.2‡\n",
¨c
->
curve_di°™˚
));

366 
	`TRACE
(
	`¥ötf
("NO best\n"));

369 
	`c⁄√˘i⁄_move_h™dÀ
(&
¨c
->
c⁄√˘i⁄
, 
h™dÀ
->
id
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

373 
	`¨c_upd©e_d©a
(
¨c
);

375  
NULL
;

376 
	}
}

378 
Obje˘Ch™ge
*

379 
	$¨c_move
(
Arc
 *
¨c
, 
Poöt
 *
to
)

381 
Poöt
 
°¨t_to_íd
;

382 
Poöt
 *
ídpoöts
 = &
¨c
->
c⁄√˘i⁄
.endpoints[0];

384 
°¨t_to_íd
 = 
ídpoöts
[1];

385 
	`poöt_sub
(&
°¨t_to_íd
, &
ídpoöts
[0]);

387 
ídpoöts
[1] =Éndpoöts[0] = *
to
;

388 
	`poöt_add
(&
ídpoöts
[1], &
°¨t_to_íd
);

390 
	`¨c_upd©e_d©a
(
¨c
);

392  
NULL
;

393 
	}
}

396 
	$¨c_compuã_midpoöt
(
Arc
 *
¨c
, c⁄° 
Poöt
 * 
ï0
, c⁄° Poöà* 
ï1
 , Poöà* 
midpoöt
)

398 
ªÆ
 
™gÀ
;

399 
Poöt
 
midpos
;

400 
Poöt
 *
€p0
, *
€p1
;

402 
€p0
 = &
¨c
->
c⁄√˘i⁄
.
ídpoöts
[0];

403 
€p1
 = &
¨c
->
c⁄√˘i⁄
.
ídpoöts
[1];

406 
™gÀ
 = -
	`©™2
(
ï0
->
y
 - 
¨c
->
˚¡î
.y,Ép0->
x
 -árc->center.x);

407 
™gÀ
 --
	`©™2
(
€p0
->
y
 - 
¨c
->
˚¡î
.y, oï0->
x
 -árc->center.x);

408 
™gÀ
 +-
	`©™2
(
ï1
->
y
 - 
¨c
->
˚¡î
.y,Ép1->
x
 -árc->center.x);

409 
™gÀ
 --
	`©™2
(
€p1
->
y
 - 
¨c
->
˚¡î
.y, oï1->
x
 -árc->center.x);

410 i‡(!
	`föôe
(
™gÀ
)){

413 i‡(
™gÀ
 < -1 * 
M_PI
){

414 
	`TRACE
(
	`¥ötf
("™gÀ: %.2‡",
™gÀ
));

415 
™gÀ
 +2*
M_PI
;

416 
	`TRACE
(
	`¥ötf
("™gÀ: %.2‡",
™gÀ
));

418 i‡(
™gÀ
 > 1 * 
M_PI
){

419 
	`TRACE
(
	`¥ötf
("™gÀ: %.2‡",
™gÀ
));

420 
™gÀ
 -2*
M_PI
;

421 
	`TRACE
(
	`¥ötf
("™gÀ: %.2‡",
™gÀ
));

424 
midpos
 = 
¨c
->
middÀ_h™dÀ
.
pos
;

426 
	`TRACE
(
	`¥ötf
("\nmidpo†bef‹e: %.2‡%.2‡\n",
midpos
.
x
, midpos.
y
));

427 
	`rŸ©e_poöt_¨ound_poöt
(&
midpos
, &
¨c
->
˚¡î
, 
™gÀ
/2);

428 
	`TRACE
(
	`¥ötf
("\nmidpo†a·î : %.2‡%.2‡\n",
midpos
.
x
, midpos.
y
));

429 *
midpoöt
 = 
midpos
;

431 
	}
}

433 
	$¨c_gë_poöt_©_™gÀ
(
Arc
 *
¨c
, 
Poöt
* 
poöt
, 
ªÆ
 
™gÀ
)

435 
Poöt
 
vec
;

436 
vec
.
x
 = 
	`cos
(
™gÀ
/180.0*
M_PI
);

437 
vec
.
y
 = -
	`sö
(
™gÀ
/180.0*
M_PI
);

438 
	`poöt_c›y
(
poöt
,&
¨c
->
˚¡î
);

439 
	`poöt_add_sˇÀd
(
poöt
,&
vec
,
¨c
->
ødius
);

440 
	}
}

442 
ªÆ
 
	$round_™gÀ
(
ªÆ
 
™gÀ
){

443 
ªÆ
 
a
 = 
™gÀ
;

444 
a
<0)á+=360;

445 
a
>=360)á-=360;

446  
a
;

447 
	}
}

449 
ªÆ
 
	$gë_middÀ_¨c_™gÀ
(
ªÆ
 
™gÀ1
,Ñó»
™gÀ2
, 
gboﬁón
 
˛ock
)

451 
ªÆ
 
dñè
;

452 
™gÀ1
 = 
	`round_™gÀ
(angle1);

453 
™gÀ2
 = 
	`round_™gÀ
(angle2);

454 
dñè
 = (
™gÀ2
-
™gÀ1
);

455 i‡(
dñè
<0) delta+=360;

456 i‡(
˛ock
)

457  
	`round_™gÀ
(
™gÀ1
-(360-
dñè
)/2);

459  
	`round_™gÀ
(
™gÀ1
+
dñè
/2);

460 
	}
}

462 #unde‡
TRACE_DIST


468 
	$ˇlcuœã_¨c_obje˘_edge
(
Arc
 *
¨c
, 
ªÆ
 
™g_°¨t
,Ñó»
™g_íd
, 
DüObje˘
 *
obj
, 
Poöt
 *
èrgë
, 
gboﬁón
 
˛ockwi£√ss
)

470 
	#MAXITER
 25

	)

471 #ifde‡
TRACE_DIST


472 
ªÆ
 
åa˚
[
MAXITER
];

473 
ªÆ
 
di°åa˚
[
MAXITER
];

474 
j
 = 0;

476 
ªÆ
 
mid1
, 
mid2
, 
mid3
;

477 
ªÆ
 
di°
;

478 
i
 = 0;

480 
mid1
 = 
™g_°¨t
;

481 
mid2
 = 
	`gë_middÀ_¨c_™gÀ
(
™g_°¨t
, 
™g_íd
, 
˛ockwi£√ss
);

482 
mid3
 = 
™g_íd
;

484 
	`TRACE
(
	`¥ötf
("Föd middÀángÀ bëwì¿%f∞ánd %f∞\n",
™g_°¨t
,
™g_íd
));

486 
	`¨c_gë_poöt_©_™gÀ
(
¨c
,
èrgë
,
mid1
);

487 
di°
 = 
obj
->
›s
->
	`di°™˚_‰om
(obj, 
èrgë
 );

488 i‡(
di°
 < 0.001){

489 
	`TRACE
(
	`¥ötf
("Poöà© %f∞: %f,%‡i†vîy clo£Åÿobje˘: %f,Ñëu∫ög it\n",
mid1
, 
èrgë
->
x
,Å¨gë->
y
, 
di°
));

493 
	`¨c_gë_poöt_©_™gÀ
(
¨c
, 
èrgë
, 
mid2
);

494 
di°
 = 
obj
->
›s
->
	`di°™˚_‰om
(obj, 
èrgë
);

495 #ifde‡
TRACE_DIST


496 
åa˚
[
i
] = 
mid2
;

497 
di°åa˚
[
i
] = 
di°
;

499 
i
++;

501 i‡(
di°
 < 0.0000001) {

502 
mid3
 = 
mid2
;

504 
mid1
 = 
mid2
;

506 
mid2
 = 
	`gë_middÀ_¨c_™gÀ
(
mid1
,
mid3
,
˛ockwi£√ss
);

508 } 
i
 < 
MAXITER
 && (
di°
 < 0.0000001 || dist > 0.001));

510 #ifde‡
TRACE_DIST


511 
j
 = 0; j < 
i
; j++) {

512 
	`¨c_gë_poöt_©_™gÀ
(
¨c
,
èrgë
,
åa˚
[
j
]);

513 
	`¥ötf
("%d: %‡∞ : %f,%‡:%f\n", 
j
, 
åa˚
[j],
èrgë
->
x
,èrgë->
y
, 
di°åa˚
[j]);

516 
	`¨c_gë_poöt_©_™gÀ
(
¨c
,
èrgë
,
mid2
);

518 
	}
}

520 
	$¨c_døw
(
Arc
 *
¨c
, 
DüRídîî
 *
ªndîî
)

522 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

523 
Poöt
 *
ídpoöts
;

524 
Poöt
 
g≠tmp
[3];

525 
C⁄√˘i⁄Poöt
 *
°¨t_˝
, *
íd_˝
;

527 
	`as£π
(
¨c
 !
NULL
);

528 
	`as£π
(
ªndîî
 !
NULL
);

530 
ídpoöts
 = &
¨c
->
c⁄√˘i⁄
.endpoints[0];

532 
g≠tmp
[0] = 
ídpoöts
[0];

533 
g≠tmp
[1] = 
ídpoöts
[1];

534 
°¨t_˝
 = 
¨c
->
c⁄√˘i⁄
.
ídpoöt_h™dÀs
[0].
c⁄√˘ed_to
;

535 
íd_˝
 = 
¨c
->
c⁄√˘i⁄
.
ídpoöt_h™dÀs
[1].
c⁄√˘ed_to
;

537 
	`TRACE
(
	`¥ötf
("døwögárc:\¿°¨t:%‡∞:%f,%‡\ãnd:%‡∞:%f,%f\n",
¨c
->
™gÀ1
,
ídpoöts
[0].
x
,ídpoöts[0].
y
,árc->
™gÀ2
,endpoints[1].x,endpoints[1].y));

539 i‡(
	`c⁄≈oöt_is_autog≠
(
°¨t_˝
)) {

540 
	`TRACE
(
	`¥ötf
("computög sèπ i¡î£˘i⁄\ncurve_di°™˚: %f\n",
¨c
->
curve_di°™˚
));

541 i‡(
¨c
->
curve_di°™˚
 < 0)

542 
	`ˇlcuœã_¨c_obje˘_edge
(
¨c
,árc->
™gÀ1
,árc->
™gÀ2
, 
°¨t_˝
->
obje˘
, &
g≠tmp
[0], 
FALSE
);

544 
	`ˇlcuœã_¨c_obje˘_edge
(
¨c
,árc->
™gÀ2
,árc->
™gÀ1
, 
°¨t_˝
->
obje˘
, &
g≠tmp
[0], 
TRUE
);

546 i‡(
	`c⁄≈oöt_is_autog≠
(
íd_˝
)) {

547 
	`TRACE
(
	`¥ötf
("computögÉnd i¡î£˘i⁄\ncurve_di°™˚: %f\n",
¨c
->
curve_di°™˚
));

548 i‡(
¨c
->
curve_di°™˚
 < 0)

549 
	`ˇlcuœã_¨c_obje˘_edge
(
¨c
,árc->
™gÀ2
,árc->
™gÀ1
, 
íd_˝
->
obje˘
, &
g≠tmp
[1], 
TRUE
);

551 
	`ˇlcuœã_¨c_obje˘_edge
(
¨c
,árc->
™gÀ1
,árc->
™gÀ2
, 
íd_˝
->
obje˘
, &
g≠tmp
[1], 
FALSE
);

555 
	`¨c_compuã_midpoöt
(
¨c
, &
g≠tmp
[0], &gaptmp[1], &gaptmp[2]);

557 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
¨c
->
löe_width
);

558 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
¨c
->
löe_°yÀ
);

559 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
¨c
->
dashÀngth
);

560 
ªndîî_›s
->
	`£t_löeˇps
(
ªndîî
, 
LINECAPS_BUTT
);

563 i‡(
	`Ábs
(
¨c
->
curve_di°™˚
) <= 0.01) {

564 
	`TRACE
(
	`¥ötf
("drawingÜikeáÜine\n"));

565 
ªndîî_›s
->
	`døw_löe_wôh_¨rows
(
ªndîî
,

566 &
g≠tmp
[0], &gaptmp[1],

567 
¨c
->
löe_width
,

568 &
¨c
->
¨c_cﬁ‹
,

569 &
¨c
->
°¨t_¨row
,

570 &
¨c
->
íd_¨row
);

574 
ªndîî_›s
->
	`døw_¨c_wôh_¨rows
(
ªndîî
,

575 &
g≠tmp
[0],

576 &
g≠tmp
[1],

577 &
g≠tmp
[2],

578 
¨c
->
löe_width
,

579 &
¨c
->
¨c_cﬁ‹
,

580 &
¨c
->
°¨t_¨row
,

581 &
¨c
->
íd_¨row
);

582 
	}
}

584 
DüObje˘
 *

585 
	$¨c_¸óã
(
Poöt
 *
°¨çoöt
,

586 *
u£r_d©a
,

587 
H™dÀ
 **
h™dÀ1
,

588 
H™dÀ
 **
h™dÀ2
)

590 
Arc
 *
¨c
;

591 
C⁄√˘i⁄
 *
c⁄n
;

592 
DüObje˘
 *
obj
;

593 
Poöt
 
deÁu…Àn
 = { 1.0, 1.0 };

595 
¨c
 = 
	`g_mÆloc0
((
Arc
));

597 
¨c
->
löe_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

598 
¨c
->
curve_di°™˚
 = 1.0;

599 
¨c
->
¨c_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

600 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
¨c
->
löe_°yÀ
, &¨c->
dashÀngth
);

601 
¨c
->
°¨t_¨row
 = 
	`©åibuãs_gë_deÁu…_°¨t_¨row
();

602 
¨c
->
íd_¨row
 = 
	`©åibuãs_gë_deÁu…_íd_¨row
();

604 
c⁄n
 = &
¨c
->
c⁄√˘i⁄
;

605 
c⁄n
->
ídpoöts
[0] = *
°¨çoöt
;

606 
c⁄n
->
ídpoöts
[1] = *
°¨çoöt
;

607 
	`poöt_add
(&
c⁄n
->
ídpoöts
[1], &
deÁu…Àn
);

609 
obj
 = &
c⁄n
->
obje˘
;

611 
obj
->
ty≥
 = &
¨c_ty≥
;;

612 
obj
->
›s
 = &
¨c_›s
;

614 
	`c⁄√˘i⁄_öô
(
c⁄n
, 3, 0);

616 
obj
->
h™dÀs
[2] = &
¨c
->
middÀ_h™dÀ
;

617 
¨c
->
middÀ_h™dÀ
.
id
 = 
HANDLE_MIDDLE
;

618 
¨c
->
middÀ_h™dÀ
.
ty≥
 = 
HANDLE_MINOR_CONTROL
;

619 
¨c
->
middÀ_h™dÀ
.
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

620 
¨c
->
middÀ_h™dÀ
.
c⁄√˘ed_to
 = 
NULL
;

622 
	`¨c_upd©e_d©a
(
¨c
);

624 *
h™dÀ1
 = 
obj
->
h™dÀs
[0];

625 *
h™dÀ2
 = 
obj
->
h™dÀs
[1];

626  &
¨c
->
c⁄√˘i⁄
.
obje˘
;

627 
	}
}

630 
	$¨c_de°roy
(
Arc
 *
¨c
)

632 
	`c⁄√˘i⁄_de°roy
(&
¨c
->
c⁄√˘i⁄
);

633 
	}
}

635 
DüObje˘
 *

636 
	$¨c_c›y
(
Arc
 *
¨c
)

638 
Arc
 *
√w¨c
;

639 
C⁄√˘i⁄
 *
c⁄n
, *
√wc⁄n
;

640 
DüObje˘
 *
√wobj
;

642 
c⁄n
 = &
¨c
->
c⁄√˘i⁄
;

644 
√w¨c
 = 
	`g_mÆloc0
((
Arc
));

645 
√wc⁄n
 = &
√w¨c
->
c⁄√˘i⁄
;

646 
√wobj
 = &
√wc⁄n
->
obje˘
;

648 
	`c⁄√˘i⁄_c›y
(
c⁄n
, 
√wc⁄n
);

650 
√w¨c
->
¨c_cﬁ‹
 = 
¨c
->arc_color;

651 
√w¨c
->
curve_di°™˚
 = 
¨c
->curve_distance;

652 
√w¨c
->
löe_width
 = 
¨c
->line_width;

653 
√w¨c
->
löe_°yÀ
 = 
¨c
->line_style;

654 
√w¨c
->
dashÀngth
 = 
¨c
->dashlength;

655 
√w¨c
->
°¨t_¨row
 = 
¨c
->start_arrow;

656 
√w¨c
->
íd_¨row
 = 
¨c
->end_arrow;

657 
√w¨c
->
ødius
 = 
¨c
->radius;

658 
√w¨c
->
˚¡î
 = 
¨c
->center;

659 
√w¨c
->
™gÀ1
 = 
¨c
->angle1;

660 
√w¨c
->
™gÀ2
 = 
¨c
->angle2;

662 
√wobj
->
h™dÀs
[2] = &
√w¨c
->
middÀ_h™dÀ
;

664 
√w¨c
->
middÀ_h™dÀ
 = 
¨c
->middle_handle;

666 
	`¨c_upd©e_d©a
(
¨c
);

668  &
√w¨c
->
c⁄√˘i⁄
.
obje˘
;

669 
	}
}

672 
gboﬁón


673 
	$is_right_h™d
 (c⁄° 
Poöt
 *
a
, c⁄° Poöà*
b
, c⁄° Poöà*
c
)

675 
Poöt
 
dŸ1
, 
dŸ2
;

677 
dŸ1
 = *
a
;

678 
	`poöt_sub
(&
dŸ1
, 
c
);

679 
	`poöt_n‹mÆize
(&
dŸ1
);

680 
dŸ2
 = *
b
;

681 
	`poöt_sub
(&
dŸ2
, 
c
);

682 
	`poöt_n‹mÆize
(&
dŸ2
);

683  
	`poöt_¸oss
(&
dŸ1
, &
dŸ2
) > 0;

684 
	}
}

687 
	$¨c_upd©e_d©a
(
Arc
 *
¨c
)

689 
C⁄√˘i⁄
 *
c⁄n
 = &
¨c
->
c⁄√˘i⁄
;

690 
LöeBBExåas
 *
exåa
 =&
c⁄n
->
exåa_•acög
;

691 
DüObje˘
 *
obj
 = &
c⁄n
->
obje˘
;

692 
Poöt
 *
ídpoöts
;

693 
ªÆ
 
x1
,
y1
,
x2
,
y2
,
xc
,
yc
;

694 
ªÆ
 
Ànsq
, 
Æpha
, 
ødius
;

695 
ªÆ
 
™gÀ1
, 
™gÀ2
;

696 
gboﬁón
 
righth™d
;

698 
ídpoöts
 = &
¨c
->
c⁄√˘i⁄
.endpoints[0];

699 
x1
 = 
ídpoöts
[0].
x
;

700 
y1
 = 
ídpoöts
[0].
y
;

701 
x2
 = 
ídpoöts
[1].
x
;

702 
y2
 = 
ídpoöts
[1].
y
;

704 
Ànsq
 = (
x2
-
x1
)*(x2-x1Ë+ (
y2
-
y1
)*(y2-y1);

705 
ødius
 = 
Ànsq
/(8*
¨c
->
curve_di°™˚
) +árc->curve_distance/2.0;

707 i‡(
Ànsq
 == 0.0)

708 
Æpha
 = 1.0;

710 
Æpha
 = (
ødius
 - 
¨c
->
curve_di°™˚
Ë/ 
	`sqπ
(
Ànsq
);

712 
xc
 = (
x1
 + 
x2
Ë/ 2.0 + (
y2
 - 
y1
)*
Æpha
;

713 
yc
 = (
y1
 + 
y2
Ë/ 2.0 + (
x1
 - 
x2
)*
Æpha
;

715 
™gÀ1
 = -
	`©™2
(
y1
-
yc
, 
x1
-
xc
)*180.0/
M_PI
;

716 i‡(
™gÀ1
<0)

717 
™gÀ1
+=360.0;

718 
™gÀ2
 = -
	`©™2
(
y2
-
yc
, 
x2
-
xc
)*180.0/
M_PI
;

719 i‡(
™gÀ2
<0)

720 
™gÀ2
+=360.0;

722 i‡(
ødius
<0.0) {

723 
ªÆ
 
tmp
;

724 
tmp
 = 
™gÀ1
;

725 
™gÀ1
 = 
™gÀ2
;

726 
™gÀ2
 = 
tmp
;

727 
ødius
 = -radius;

730 
¨c
->
ødius
 =Ñadius;

731 
¨c
->
˚¡î
.
x
 = 
xc
;árc->˚¡î.
y
 = 
yc
;

732 
¨c
->
™gÀ1
 =ángle1;

733 
¨c
->
™gÀ2
 =ángle2;

736 
exåa
->
°¨t_å™s
 =

737 
exåa
->
íd_å™s
 =

738 
exåa
->
°¨t_l⁄g
 =

739 
exåa
->
íd_l⁄g
 = (
¨c
->
löe_width
 / 2.0);

742 
	`¨c_upd©e_h™dÀs
(
¨c
);

744 
righth™d
 = 
	`is_right_h™d
 (&
ídpoöts
[0], &
¨c
->
middÀ_h™dÀ
.
pos
, &endpoints[1]);

745 
	`c⁄√˘i⁄_upd©e_boundögbox
(
c⁄n
);

748 i‡(
	`ö_™gÀ
(0, 
¨c
->
™gÀ1
,árc->
™gÀ2
)) {

750 
Poöt
 
±
 = { 
¨c
->
˚¡î
.
x
 +árc->
ødius
 + (¨c->
löe_width
 / 2.0), 
y1
 };

751 
	`ª˘™gÀ_add_poöt
 (&
obj
->
boundög_box
, &
±
);

753 i‡(
	`ö_™gÀ
(90, 
¨c
->
™gÀ1
,árc->
™gÀ2
)) {

755 
Poöt
 
±
 = {
x1
, 
¨c
->
˚¡î
.
y
 -árc->
ødius
 - (¨c->
löe_width
 / 2.0) };

756 
	`ª˘™gÀ_add_poöt
 (&
obj
->
boundög_box
, &
±
);

758 i‡(
	`ö_™gÀ
(180, 
¨c
->
™gÀ1
,árc->
™gÀ2
)) {

760 
Poöt
 
±
 = { 
¨c
->
˚¡î
.
x
 -árc->
ødius
 - (¨c->
löe_width
 / 2.0), 
y1
 };

761 
	`ª˘™gÀ_add_poöt
 (&
obj
->
boundög_box
, &
±
);

763 i‡(
	`ö_™gÀ
(270, 
¨c
->
™gÀ1
,árc->
™gÀ2
)) {

765 
Poöt
 
±
 = { 
x1
, 
¨c
->
˚¡î
.
y
 +árc->
ødius
 + (¨c->
löe_width
 / 2.0) };

766 
	`ª˘™gÀ_add_poöt
 (&
obj
->
boundög_box
, &
±
);

768 i‡(
¨c
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

772 
Re˘™gÀ
 
bbox
 = {0,};

773 
ªÆ
 
tmp
;

774 
Poöt
 
move_¨row
, 
move_löe
;

775 
Poöt
 
to
 = 
¨c
->
c⁄√˘i⁄
.
ídpoöts
[0];

776 
Poöt
 
‰om
 = 
to
;

777 
	`poöt_sub
 (&
‰om
, &
¨c
->
˚¡î
);

778 
tmp
 = 
‰om
.
x
;

779 i‡(
righth™d
)

780 
‰om
.
x
 = -‰om.
y
, from.y = 
tmp
;

782 
‰om
.
x
 = from.
y
, from.y = -
tmp
;

783 
	`poöt_add
 (&
‰om
, &
to
);

785 
	`ˇlcuœã_¨row_poöt
(&
¨c
->
°¨t_¨row
, &
to
, &
‰om
,

786 &
move_¨row
, &
move_löe
, 
¨c
->
löe_width
);

788 
	`poöt_sub
(&
to
, &
move_¨row
);

789 
	`poöt_sub
(&
‰om
, &
move_löe
);

790 
	`¨row_bbox
(&
¨c
->
°¨t_¨row
,árc->
löe_width
, &
to
, &
‰om
, &
bbox
);

791 
	`ª˘™gÀ_uni⁄
(&
obj
->
boundög_box
, &
bbox
);

793 i‡(
¨c
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

794 
Re˘™gÀ
 
bbox
 = {0,};

795 
ªÆ
 
tmp
;

796 
Poöt
 
move_¨row
, 
move_löe
;

797 
Poöt
 
to
 = 
¨c
->
c⁄√˘i⁄
.
ídpoöts
[1];

798 
Poöt
 
‰om
 = 
to
;

799 
	`poöt_sub
 (&
‰om
, &
¨c
->
˚¡î
);

800 
tmp
 = 
‰om
.
x
;

801 i‡(
righth™d
)

802 
‰om
.
x
 = from.
y
, from.y = -
tmp
;

804 
‰om
.
x
 = -‰om.
y
, from.y = 
tmp
;

805 
	`poöt_add
 (&
‰om
, &
to
);

806 
	`ˇlcuœã_¨row_poöt
(&
¨c
->
íd_¨row
, &
to
, &
‰om
,

807 &
move_¨row
, &
move_löe
, 
¨c
->
löe_width
);

809 
	`poöt_sub
(&
to
, &
move_¨row
);

810 
	`poöt_sub
(&
‰om
, &
move_löe
);

811 
	`¨row_bbox
(&
¨c
->
íd_¨row
,árc->
löe_width
, &
to
, &
‰om
, &
bbox
);

812 
	`ª˘™gÀ_uni⁄
(&
obj
->
boundög_box
, &
bbox
);

815 
obj
->
posôi⁄
 = 
c⁄n
->
ídpoöts
[0];

816 
	}
}

819 
	$¨c_ßve
(
Arc
 *
¨c
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
)

821 
	`c⁄√˘i⁄_ßve
(&
¨c
->
c⁄√˘i⁄
, 
obj_node
);

823 i‡(!
	`cﬁ‹_equÆs
(&
¨c
->
¨c_cﬁ‹
, &
cﬁ‹_bœck
))

824 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "arc_color"),

825 &
¨c
->
¨c_cﬁ‹
);

827 i‡(
¨c
->
curve_di°™˚
 != 0.1)

828 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "curve_distance"),

829 
¨c
->
curve_di°™˚
);

831 i‡(
¨c
->
löe_width
 != 0.1)

832 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

833 
¨c
->
löe_width
);

835 i‡(
¨c
->
löe_°yÀ
 !
LINESTYLE_SOLID
)

836 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

837 
¨c
->
löe_°yÀ
);

839 i‡(
¨c
->
löe_°yÀ
 !
LINESTYLE_SOLID
 &&

840 
¨c
->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

841 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

842 
¨c
->
dashÀngth
);

844 i‡(
¨c
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

845 
	`ßve_¨row
(
obj_node
, &
¨c
->
°¨t_¨row
, "start_arrow",

849 i‡(
¨c
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

850 
	`ßve_¨row
(
obj_node
, &
¨c
->
íd_¨row
, "end_arrow",

853 
	}
}

855 
DüObje˘
 *

856 
	$¨c_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

858 
Arc
 *
¨c
;

859 
C⁄√˘i⁄
 *
c⁄n
;

860 
DüObje˘
 *
obj
;

861 
AâribuãNode
 
©å
;

863 
¨c
 = 
	`g_mÆloc0
((
Arc
));

865 
c⁄n
 = &
¨c
->
c⁄√˘i⁄
;

866 
obj
 = &
c⁄n
->
obje˘
;

868 
obj
->
ty≥
 = &
¨c_ty≥
;

869 
obj
->
›s
 = &
¨c_›s
;

871 
	`c⁄√˘i⁄_lﬂd
(
c⁄n
, 
obj_node
);

873 
¨c
->
¨c_cﬁ‹
 = 
cﬁ‹_bœck
;

874 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "arc_color");

875 i‡(
©å
 !
NULL
)

876 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
¨c
->
¨c_cﬁ‹
);

878 
¨c
->
curve_di°™˚
 = 0.1;

879 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "curve_distance");

880 i‡(
©å
 !
NULL
)

881 
¨c
->
curve_di°™˚
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

883 
¨c
->
löe_width
 = 0.1;

884 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

885 i‡(
©å
 !
NULL
)

886 
¨c
->
löe_width
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

888 
¨c
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

889 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

890 i‡(
©å
 !
NULL
)

891 
¨c
->
löe_°yÀ
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

893 
¨c
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

894 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

895 i‡(
©å
 !
NULL
)

896 
¨c
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

898 
	`lﬂd_¨row
(
obj_node
, &
¨c
->
°¨t_¨row
, "start_arrow",

901 
	`lﬂd_¨row
(
obj_node
, &
¨c
->
íd_¨row
, "end_arrow",

904 
	`c⁄√˘i⁄_öô
(
c⁄n
, 3, 0);

906 
obj
->
h™dÀs
[2] = &
¨c
->
middÀ_h™dÀ
;

907 
¨c
->
middÀ_h™dÀ
.
id
 = 
HANDLE_MIDDLE
;

908 
¨c
->
middÀ_h™dÀ
.
ty≥
 = 
HANDLE_MINOR_CONTROL
;

909 
¨c
->
middÀ_h™dÀ
.
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

910 
¨c
->
middÀ_h™dÀ
.
c⁄√˘ed_to
 = 
NULL
;

912 
	`¨c_upd©e_d©a
(
¨c
);

914  &
¨c
->
c⁄√˘i⁄
.
obje˘
;

915 
	}
}

	@O:\tool\dvs50\objects\standard\bezier.c

22 #ifde‡
HAVE_CONFIG_H


23 
	~<c⁄fig.h
>

26 
	~<as£π.h
>

27 
	~<m©h.h
>

29 
	~"öé.h
"

30 
	~"obje˘.h
"

31 
	~"bezõr_c⁄n.h
"

32 
	~"c⁄√˘i⁄poöt.h
"

33 
	~"düªndîî.h
"

34 
	~"©åibuãs.h
"

35 
	~"widgës.h
"

36 
	~"dümíu.h
"

37 
	~"mesßge.h
"

38 
	~"¥›îtõs.h
"

39 
	~"¸óã.h
"

41 
	~"toﬁ-ic⁄s.h
"

43 
	#DEFAULT_WIDTH
 0.15

	)

45 
_Bezõæöe
 
	tBezõæöe
;

47 
	s_Bezõæöe
 {

48 
BezõrC⁄n
 
	mbez
;

50 
Cﬁ‹
 
	mlöe_cﬁ‹
;

51 
LöeStyÀ
 
	mlöe_°yÀ
;

52 
ªÆ
 
	mdashÀngth
;

53 
ªÆ
 
	mlöe_width
;

54 
Aºow
 
	m°¨t_¨row
, 
	míd_¨row
;

55 
ªÆ
 
	mabsﬁuã_°¨t_g≠
, 
	mabsﬁuã_íd_g≠
;

59 
Obje˘Ch™ge
* 
bezõæöe_move_h™dÀ
(
Bezõæöe
 *
bezõæöe
, 
H™dÀ
 *
h™dÀ
,

60 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

61 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

62 
Obje˘Ch™ge
* 
bezõæöe_move
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
to
);

63 
bezõæöe_£À˘
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
˛icked_poöt
,

64 
DüRídîî
 *
öãø˘ive_ªndîî
);

65 
bezõæöe_døw
(
Bezõæöe
 *
bezõæöe
, 
DüRídîî
 *
ªndîî
);

66 
DüObje˘
 *
bezõæöe_¸óã
(
Poöt
 *
°¨çoöt
,

67 *
u£r_d©a
,

68 
H™dÀ
 **
h™dÀ1
,

69 
H™dÀ
 **
h™dÀ2
);

70 
ªÆ
 
bezõæöe_di°™˚_‰om
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
poöt
);

71 
bezõæöe_upd©e_d©a
(
Bezõæöe
 *
bezõæöe
);

72 
bezõæöe_de°roy
(
Bezõæöe
 *
bezõæöe
);

73 
DüObje˘
 *
bezõæöe_c›y
(
Bezõæöe
 *
bezõæöe
);

75 
Pr›Des¸ùti⁄
 *
bezõæöe_des¸ibe_¥›s
(
Bezõæöe
 *
bezõæöe
);

76 
bezõæöe_gë_¥›s
(
Bezõæöe
 *
bezõæöe
, 
GPåAºay
 *
¥›s
);

77 
bezõæöe_£t_¥›s
(
Bezõæöe
 *
bezõæöe
, 
GPåAºay
 *
¥›s
);

79 
bezõæöe_ßve
(
Bezõæöe
 *
bezõæöe
, 
Obje˘Node
 
obj_node
,

80 c⁄° *
fûíame
);

81 
DüObje˘
 *
bezõæöe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
,

82 c⁄° *
fûíame
);

83 
DüMíu
 *
bezõæöe_gë_obje˘_míu
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
˛ickedpoöt
);

85 
compuã_g≠_poöts
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
g≠_poöts
);

86 
ªÆ
 
≠¥ox_bez_Àngth
(
BezõrC⁄n
 *
bez
);

87 
exch™ge_bez_g≠_poöts
(
BezõrC⁄n
 * 
bez
, 
Poöt
* 
g≠_poöts
);

89 
Obje˘Ty≥Ops
 
	gbezõæöe_ty≥_›s
 =

91 (
Cª©eFunc
)
bezõæöe_¸óã
,

92 (
LﬂdFunc
Ë
bezõæöe_lﬂd
,

93 (
SaveFunc
Ë
bezõæöe_ßve
,

94 (
GëDeÁu…sFunc
Ë
NULL
,

95 (
AµlyDeÁu…sFunc
Ë
NULL


98 
DüObje˘Ty≥
 
	gbezõæöe_ty≥
 =

102 (**Ë
bezõæöe_ic⁄
,

104 &
bezõæöe_ty≥_›s
,

105 
NULL
,

109 
DüObje˘Ty≥
 *
	g_bezõæöe_ty≥
 = (DüObje˘Ty≥ *Ë&
bezõæöe_ty≥
;

112 
Obje˘Ops
 
	gbezõæöe_›s
 = {

113 (
De°royFunc
Ë
bezõæöe_de°roy
,

114 (
DøwFunc
Ë
bezõæöe_døw
,

115 (
Di°™˚Func
Ë
bezõæöe_di°™˚_‰om
,

116 (
Sñe˘Func
Ë
bezõæöe_£À˘
,

117 (
C›yFunc
Ë
bezõæöe_c›y
,

118 (
MoveFunc
Ë
bezõæöe_move
,

119 (
MoveH™dÀFunc
Ë
bezõæöe_move_h™dÀ
,

120 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

121 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

122 (
Obje˘MíuFunc
Ë
bezõæöe_gë_obje˘_míu
,

123 (
Des¸ibePr›sFunc
Ë
bezõæöe_des¸ibe_¥›s
,

124 (
GëPr›sFunc
Ë
bezõæöe_gë_¥›s
,

125 (
SëPr›sFunc
Ë
bezõæöe_£t_¥›s
,

126 (
TextEdôFunc
) 0,

127 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

130 
Pr›NumD©a
 
	gg≠_ønge
 = { -
G_MAXFLOAT
, G_MAXFLOAT, 0.1};

132 
Pr›Des¸ùti⁄
 
	gbezõæöe_¥›s
[] = {

133 
BEZCONN_COMMON_PROPERTIES
,

134 
PROP_STD_LINE_WIDTH
,

135 
PROP_STD_LINE_COLOUR
,

136 
PROP_STD_LINE_STYLE
,

137 
PROP_STD_START_ARROW
,

138 
PROP_STD_END_ARROW
,

139 
PROP_FRAME_BEGIN
("g≠s",0,
N_
("Line gaps")),

140 { "absﬁuã_°¨t_g≠", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

141 
N_
("Absﬁuã sèπ g≠"), 
NULL
, &
g≠_ønge
 },

142 { "absﬁuã_íd_g≠", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

143 
N_
("AbsﬁuãÉnd g≠"), 
NULL
, &
g≠_ønge
 },

144 
PROP_FRAME_END
("gaps",0),

145 
PROP_DESC_END


148 
Pr›Des¸ùti⁄
 *

149 
	$bezõæöe_des¸ibe_¥›s
(
Bezõæöe
 *
bezõæöe
)

151 i‡(
bezõæöe_¥›s
[0].
qu¨k
 == 0)

152 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
bezõæöe_¥›s
);

153  
bezõæöe_¥›s
;

154 
	}
}

156 
Pr›Off£t
 
	gbezõæöe_off£ts
[] = {

157 
BEZCONN_COMMON_PROPERTIES_OFFSETS
,

158 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Bezõæöe
, 
löe_width
) },

159 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Bezõæöe
, 
löe_cﬁ‹
) },

160 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

161 
off£tof
(
Bezõæöe
, 
löe_°yÀ
), off£tof(Bezõæöe, 
dashÀngth
) },

162 { "°¨t_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Bezõæöe
, 
°¨t_¨row
) },

163 { "íd_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Bezõæöe
, 
íd_¨row
) },

164 
PROP_OFFSET_FRAME_BEGIN
("gaps"),

165 { "absﬁuã_°¨t_g≠", 
PROP_TYPE_REAL
, 
off£tof
(
Bezõæöe
, 
absﬁuã_°¨t_g≠
) },

166 { "absﬁuã_íd_g≠", 
PROP_TYPE_REAL
, 
off£tof
(
Bezõæöe
, 
absﬁuã_íd_g≠
) },

167 
PROP_OFFSET_FRAME_END
("gaps"),

168 { 
NULL
, 0, 0 }

172 
	$bezõæöe_gë_¥›s
(
Bezõæöe
 *
bezõæöe
, 
GPåAºay
 *
¥›s
)

174 
	`obje˘_gë_¥›s_‰om_off£ts
(&
bezõæöe
->
bez
.
obje˘
, 
bezõæöe_off£ts
,

175 
¥›s
);

176 
	}
}

179 
	$bezõæöe_£t_¥›s
(
Bezõæöe
 *
bezõæöe
, 
GPåAºay
 *
¥›s
)

181 
	`obje˘_£t_¥›s_‰om_off£ts
(&
bezõæöe
->
bez
.
obje˘
, 
bezõæöe_off£ts
,

182 
¥›s
);

183 
	`bezõæöe_upd©e_d©a
(
bezõæöe
);

184 
	}
}

186 
ªÆ


187 
	$bezõæöe_di°™˚_‰om
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
poöt
)

189 
BezõrC⁄n
 *
bez
 = &
bezõæöe
->bez;

190 i‡(
	`c⁄≈oöt_is_autog≠
(
bez
->
obje˘
.
h™dÀs
[0]->
c⁄√˘ed_to
) ||

191 
	`c⁄≈oöt_is_autog≠
(
bez
->
obje˘
.
h™dÀs
[3*(bez->
numpoöts
-1)]->
c⁄√˘ed_to
) ||

192 
bezõæöe
->
absﬁuã_°¨t_g≠
 || bezõæöe->
absﬁuã_íd_g≠
) {

193 
Poöt
 
g≠_poöts
[4];

194 
ªÆ
 
di°™˚
;

195 
	`compuã_g≠_poöts
(
bezõæöe
, 
g≠_poöts
);

196 
	`exch™ge_bez_g≠_poöts
(
bez
,
g≠_poöts
);

197 
di°™˚
 = 
	`bezõrc⁄n_di°™˚_‰om
(
bez
, 
poöt
, 
bezõæöe
->
löe_width
);

198 
	`exch™ge_bez_g≠_poöts
(
bez
,
g≠_poöts
);

199  
di°™˚
;

201  
	`bezõrc⁄n_di°™˚_‰om
(
bez
, 
poöt
, 
bezõæöe
->
löe_width
);

203 
	}
}

205 
	$bezõæöe_˛o£°_£gmít
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
poöt
) {

206 
BezõrC⁄n
 *
bez
 = &
bezõæöe
->bez;

207  
	`bezõrc⁄n_˛o£°_£gmít
(
bez
, 
poöt
, 
bezõæöe
->
löe_width
);

208 
	}
}

211 
	$bezõæöe_£À˘
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
˛icked_poöt
,

212 
DüRídîî
 *
öãø˘ive_ªndîî
)

214 
	`bezõrc⁄n_upd©e_d©a
(&
bezõæöe
->
bez
);

215 
	}
}

217 
Obje˘Ch™ge
*

218 
	$bezõæöe_move_h™dÀ
(
Bezõæöe
 *
bezõæöe
, 
H™dÀ
 *
h™dÀ
,

219 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

220 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

222 
	`as£π
(
bezõæöe
!=
NULL
);

223 
	`as£π
(
h™dÀ
!=
NULL
);

224 
	`as£π
(
to
!=
NULL
);

226 i‡(
ªas⁄
 =
HANDLE_MOVE_CREATE
 ||Ñós⁄ =
HANDLE_MOVE_CREATE_FINAL
) {

228 
BezõrC⁄n
 *
bez
 = &
bezõæöe
->bez;

229 
Poöt
 
di°
 = 
bez
->
poöts
[0].
p1
;

231 
	`poöt_sub
(&
di°
, 
to
);

232 
di°
.
y
 = 0;

233 
	`poöt_sˇÀ
(&
di°
, 0.332);

235 
	`bezõrc⁄n_move_h™dÀ
(
bez
, 
h™dÀ
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

237 
bez
->
poöts
[1].
p1
 = bez->points[0].p1;

238 
	`poöt_sub
(&
bez
->
poöts
[1].
p1
, &
di°
);

239 
bez
->
poöts
[1].
p2
 = *
to
;

240 
	`poöt_add
(&
bez
->
poöts
[1].
p2
, &
di°
);

242 
	`bezõrc⁄n_move_h™dÀ
(&
bezõæöe
->
bez
, 
h™dÀ
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

245 
	`bezõæöe_upd©e_d©a
(
bezõæöe
);

247  
NULL
;

248 
	}
}

251 
Obje˘Ch™ge
*

252 
	$bezõæöe_move
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
to
)

254 
	`bezõrc⁄n_move
(&
bezõæöe
->
bez
, 
to
);

255 
	`bezõæöe_upd©e_d©a
(
bezõæöe
);

257  
NULL
;

258 
	}
}

260 
	$exch™ge_bez_g≠_poöts
(
BezõrC⁄n
 * 
bez
, 
Poöt
* 
g≠_poöts
)

262 
Poöt
 
tmp_poöts
[4];

263 
tmp_poöts
[0] = 
bez
->
poöts
[0].
p1
;

264 
tmp_poöts
[1] = 
bez
->
poöts
[1].
p1
;

265 
tmp_poöts
[2] = 
bez
->
poöts
[bez->
numpoöts
-1].
p2
;

266 
tmp_poöts
[3] = 
bez
->
poöts
[bez->
numpoöts
-1].
p3
;

267 
bez
->
poöts
[0].
p1
 = 
g≠_poöts
[0];

268 
bez
->
poöts
[1].
p1
 = 
g≠_poöts
[1];

269 
bez
->
poöts
[bez->
numpoöts
-1].
p2
 = 
g≠_poöts
[2];

270 
bez
->
poöts
[bez->
numpoöts
-1].
p3
 = 
g≠_poöts
[3];

271 
g≠_poöts
[0] = 
tmp_poöts
[0];

272 
g≠_poöts
[1] = 
tmp_poöts
[1];

273 
g≠_poöts
[2] = 
tmp_poöts
[2];

274 
g≠_poöts
[3] = 
tmp_poöts
[3];

275 
	}
}

276 
ªÆ
 
	$≠¥ox_bez_Àngth
(
BezõrC⁄n
 *
bez
)

280 
Poöt
 *
cuºít
, *
œ°
, 
vec
;

281 
ªÆ
 
Àngth
 = .0;

282 
i
;

283 
cuºít
 = &
bez
->
poöts
[0].
p1
;

284 
i
=1; i < 
bez
->
numpoöts
 ; i++){

285 
œ°
 = 
cuºít
;

286 
cuºít
 = &
bez
->
poöts
[
i
].
p3
;

287 
	`poöt_c›y
(&
vec
,
œ°
);

288 
	`poöt_sub
(&
vec
,
cuºít
);

289 
Àngth
 +
	`poöt_Àn
(&
vec
);

291  
Àngth
;

292 
	}
}

294 
	$compuã_g≠_poöts
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
g≠_poöts
)

296 
ªÆ
 
fú°_Àngth
, 
œ°_Àngth
, 
bez_Àngth
;

297 
BezõrC⁄n
 *
bez
 = &
bezõæöe
->bez;

298 
Poöt
 
vec_°¨t
, 
vec_íd
;

301 
g≠_poöts
[0] = 
bez
->
poöts
[0].
p1
;

302 
g≠_poöts
[1] = 
bez
->
poöts
[1].
p1
;

303 
g≠_poöts
[2] = 
bez
->
poöts
[bez->
numpoöts
-1].
p2
;

304 
g≠_poöts
[3] = 
bez
->
poöts
[bez->
numpoöts
-1].
p3
;

306 
	`poöt_c›y
(&
vec_°¨t
, &
g≠_poöts
[1]);

307 
	`poöt_sub
(&
vec_°¨t
, &
g≠_poöts
[0]);

308 
	`poöt_n‹mÆize
(&
vec_°¨t
);

309 
	`poöt_c›y
(&
vec_íd
, &
g≠_poöts
[2]);

310 
	`poöt_sub
(&
vec_íd
, &
g≠_poöts
[3]);

311 
	`poöt_n‹mÆize
(&
vec_íd
);

314 
bez_Àngth
 = 
	`≠¥ox_bez_Àngth
(
bez
) ;

315 
fú°_Àngth
 = 
	`di°™˚_poöt_poöt
(&
g≠_poöts
[0],&gap_points[1]);

316 
œ°_Àngth
 = 
	`di°™˚_poöt_poöt
(&
g≠_poöts
[2],&gap_points[3]);

318 i‡(
	`c⁄≈oöt_is_autog≠
(
bez
->
obje˘
.
h™dÀs
[0]->
c⁄√˘ed_to
) &&

319 (
bez
->
obje˘
.
h™dÀs
[0])->
c⁄√˘ed_to
 !
NULL
 &&

320 (
bez
->
obje˘
.
h™dÀs
[0])->
c⁄√˘ed_to
->obje˘ !
NULL
 ) {

321 
Poöt
 
íd
;

322 
	`poöt_c›y
(&
íd
, &
g≠_poöts
[0]);

323 
	`poöt_add_sˇÀd
(&
íd
, &
vec_°¨t
, 
bez_Àngth
);

324 
íd
 = 
	`ˇlcuœã_obje˘_edge
(&
g≠_poöts
[0], &end,

325 (
bez
->
obje˘
.
h™dÀs
[0])->
c⁄√˘ed_to
->object);

326 
	`poöt_sub
(&
íd
, &
g≠_poöts
[0]);

328 
	`poöt_add
(&
g≠_poöts
[0], &
íd
);

329 
	`poöt_add
(&
g≠_poöts
[1], &
íd
);

332 i‡(
	`c⁄≈oöt_is_autog≠
(
bez
->
obje˘
.
h™dÀs
[3*(bez->
numpoöts
-1)]->
c⁄√˘ed_to
) &&

333 (
bez
->
obje˘
.
h™dÀs
[3*(bez->
numpoöts
-1)])->
c⁄√˘ed_to
 !
NULL
 &&

334 (
bez
->
obje˘
.
h™dÀs
[3*(bez->
numpoöts
-1)])->
c⁄√˘ed_to
->obje˘ !
NULL
) {

335 
Poöt
 
íd
;

336 
	`poöt_c›y
(&
íd
, &
g≠_poöts
[3]);

337 
	`poöt_add_sˇÀd
(&
íd
, &
vec_íd
, 
bez_Àngth
);

338 
íd
 = 
	`ˇlcuœã_obje˘_edge
(&
g≠_poöts
[3], &end,

339 (
bez
->
obje˘
.
h™dÀs
[3*(bez->
numpoöts
-1)])->
c⁄√˘ed_to
->object);

340 
	`poöt_sub
(&
íd
, &
g≠_poöts
[3]);

342 
	`poöt_add
(&
g≠_poöts
[3], &
íd
);

343 
	`poöt_add
(&
g≠_poöts
[2], &
íd
);

348 
	`poöt_add_sˇÀd
(&
g≠_poöts
[0], &
vec_°¨t
, 
bezõæöe
->
absﬁuã_°¨t_g≠
);

349 
	`poöt_add_sˇÀd
(&
g≠_poöts
[1], &
vec_°¨t
, 
bezõæöe
->
absﬁuã_°¨t_g≠
);

352 
	`poöt_add_sˇÀd
(&
g≠_poöts
[2], &
vec_íd
, 
bezõæöe
->
absﬁuã_íd_g≠
);

353 
	`poöt_add_sˇÀd
(&
g≠_poöts
[3], &
vec_íd
, 
bezõæöe
->
absﬁuã_íd_g≠
);

356 
	}
}

358 
	$bezõæöe_døw
(
Bezõæöe
 *
bezõæöe
, 
DüRídîî
 *
ªndîî
)

360 
Poöt
 
g≠_poöts
[4];

362 
BezõrC⁄n
 *
bez
 = &
bezõæöe
->bez;

363 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

365 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
bezõæöe
->
löe_width
);

366 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
bezõæöe
->
löe_°yÀ
);

367 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
bezõæöe
->
dashÀngth
);

368 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_MITER
);

369 
ªndîî_›s
->
	`£t_löeˇps
(
ªndîî
, 
LINECAPS_BUTT
);

371 i‡(
	`c⁄≈oöt_is_autog≠
(
bez
->
obje˘
.
h™dÀs
[0]->
c⁄√˘ed_to
) ||

372 
	`c⁄≈oöt_is_autog≠
(
bez
->
obje˘
.
h™dÀs
[3*(bez->
numpoöts
-1)]->
c⁄√˘ed_to
) ||

373 
bezõæöe
->
absﬁuã_°¨t_g≠
 || bezõæöe->
absﬁuã_íd_g≠
) {

375 
	`compuã_g≠_poöts
(
bezõæöe
,
g≠_poöts
);

376 
	`exch™ge_bez_g≠_poöts
(
bez
,
g≠_poöts
);

377 
ªndîî_›s
->
	`døw_bezõr_wôh_¨rows
(
ªndîî
, 
bez
->
poöts
, bez->
numpoöts
,

378 
bezõæöe
->
löe_width
,

379 &
bezõæöe
->
löe_cﬁ‹
,

380 &
bezõæöe
->
°¨t_¨row
,

381 &
bezõæöe
->
íd_¨row
);

382 
	`exch™ge_bez_g≠_poöts
(
bez
,
g≠_poöts
);

384 
ªndîî_›s
->
	`døw_bezõr_wôh_¨rows
(
ªndîî
, 
bez
->
poöts
, bez->
numpoöts
,

385 
bezõæöe
->
löe_width
,

386 &
bezõæöe
->
löe_cﬁ‹
,

387 &
bezõæöe
->
°¨t_¨row
,

388 &
bezõæöe
->
íd_¨row
);

392 
ªndîî_›s
->
	`døw_bezõr
(
ªndîî
, 
bez
->
poöts
, bez->
numpoöts
,

393 &
bezõæöe
->
löe_cﬁ‹
);

395 i‡(
bezõæöe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

396 
	`¨row_døw
(
ªndîî
, 
bezõæöe
->
°¨t_¨row
.
ty≥
,

397 &
bez
->
poöts
[0].
p1
, &bez->points[1].p1,

398 
bezõæöe
->
°¨t_¨row
.
Àngth
, bezõæöe->°¨t_¨row.
width
,

399 
bezõæöe
->
löe_width
,

400 &
bezõæöe
->
löe_cﬁ‹
, &
cﬁ‹_whôe
);

402 i‡(
bezõæöe
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

403 
	`¨row_døw
(
ªndîî
, 
bezõæöe
->
íd_¨row
.
ty≥
,

404 &
bez
->
poöts
[bez->
numpoöts
-1].
p3
,

405 &
bez
->
poöts
[bez->
numpoöts
-1].
p2
,

406 
bezõæöe
->
íd_¨row
.
Àngth
, bezõæöe->íd_¨row.
width
,

407 
bezõæöe
->
löe_width
,

408 &
bezõæöe
->
löe_cﬁ‹
, &
cﬁ‹_whôe
);

417 i‡(
ªndîî
->
is_öãø˘ive
 &&

418 
	`dü_obje˘_is_£À˘ed
(&
bezõæöe
->
bez
.
obje˘
)) {

419 
	`bezõrc⁄n_døw_c⁄åﬁ_löes
(&
bezõæöe
->
bez
, 
ªndîî
);

421 
	}
}

423 
DüObje˘
 *

424 
	$bezõæöe_¸óã
(
Poöt
 *
°¨çoöt
,

425 *
u£r_d©a
,

426 
H™dÀ
 **
h™dÀ1
,

427 
H™dÀ
 **
h™dÀ2
)

429 
Bezõæöe
 *
bezõæöe
;

430 
BezõrC⁄n
 *
bez
;

431 
DüObje˘
 *
obj
;

432 
Poöt
 
deÁu…Àn
 = { .3, .3 };

434 
bezõæöe
 = 
	`g_√w0
(
Bezõæöe
, 1);

435 
bez
 = &
bezõæöe
->bez;

436 
obj
 = &
bez
->
obje˘
;

438 
obj
->
ty≥
 = &
bezõæöe_ty≥
;

439 
obj
->
›s
 = &
bezõæöe_›s
;

441 i‡(
u£r_d©a
 =
NULL
) {

442 
	`bezõrc⁄n_öô
(
bez
, 2);

444 
bez
->
poöts
[0].
p1
 = *
°¨çoöt
;

445 
bez
->
poöts
[1].
p1
 = *
°¨çoöt
;

446 
	`poöt_add
(&
bez
->
poöts
[1].
p1
, &
deÁu…Àn
);

447 
bez
->
poöts
[1].
p2
 = bez->poöts[1].
p1
;

448 
	`poöt_add
(&
bez
->
poöts
[1].
p2
, &
deÁu…Àn
);

449 
bez
->
poöts
[1].
p3
 = bez->poöts[1].
p2
;

450 
	`poöt_add
(&
bez
->
poöts
[1].
p3
, &
deÁu…Àn
);

452 
BezõrCª©eD©a
 *
bcd
 = (BezõrCª©eD©a*)
u£r_d©a
;

454 
	`bezõrc⁄n_öô
(
bez
, 
bcd
->
num_poöts
);

455 
	`bezõrc⁄n_£t_poöts
(
bez
, 
bcd
->
num_poöts
, bcd->
poöts
);

458 
bezõæöe
->
löe_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

459 
bezõæöe
->
löe_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

460 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
bezõæöe
->
löe_°yÀ
,

461 &
bezõæöe
->
dashÀngth
);

462 
bezõæöe
->
°¨t_¨row
 = 
	`©åibuãs_gë_deÁu…_°¨t_¨row
();

463 
bezõæöe
->
íd_¨row
 = 
	`©åibuãs_gë_deÁu…_íd_¨row
();

465 *
h™dÀ1
 = 
bez
->
obje˘
.
h™dÀs
[0];

466 *
h™dÀ2
 = 
bez
->
obje˘
.
h™dÀs
[3];

468 
	`bezõæöe_upd©e_d©a
(
bezõæöe
);

470  &
bezõæöe
->
bez
.
obje˘
;

471 
	}
}

474 
	$bezõæöe_de°roy
(
Bezõæöe
 *
bezõæöe
)

476 
	`bezõrc⁄n_de°roy
(&
bezõæöe
->
bez
);

477 
	}
}

479 
DüObje˘
 *

480 
	$bezõæöe_c›y
(
Bezõæöe
 *
bezõæöe
)

482 
Bezõæöe
 *
√wbezõæöe
;

483 
BezõrC⁄n
 *
bez
, *
√wbez
;

484 
DüObje˘
 *
√wobj
;

486 
bez
 = &
bezõæöe
->bez;

488 
√wbezõæöe
 = 
	`g_√w0
(
Bezõæöe
, 1);

489 
√wbez
 = &
√wbezõæöe
->
bez
;

490 
√wobj
 = &
bez
->
obje˘
;

492 
	`bezõrc⁄n_c›y
(
bez
, 
√wbez
);

494 
√wbezõæöe
->
löe_cﬁ‹
 = 
bezõæöe
->line_color;

495 
√wbezõæöe
->
löe_width
 = 
bezõæöe
->line_width;

496 
√wbezõæöe
->
löe_°yÀ
 = 
bezõæöe
->line_style;

497 
√wbezõæöe
->
dashÀngth
 = 
bezõæöe
->dashlength;

498 
√wbezõæöe
->
°¨t_¨row
 = 
bezõæöe
->start_arrow;

499 
√wbezõæöe
->
íd_¨row
 = 
bezõæöe
->end_arrow;

500 
√wbezõæöe
->
absﬁuã_°¨t_g≠
 = 
bezõæöe
->absolute_start_gap;

501 
√wbezõæöe
->
absﬁuã_íd_g≠
 = 
bezõæöe
->absolute_end_gap;

503  &
√wbezõæöe
->
bez
.
obje˘
;

504 
	}
}

508 
	$bezõæöe_upd©e_d©a
(
Bezõæöe
 *
bezõæöe
)

510 
BezõrC⁄n
 *
bez
 = &
bezõæöe
->bez;

511 
DüObje˘
 *
obj
 = &
bez
->
obje˘
;

512 
PﬁyBBExåas
 *
exåa
 = &
bez
->
exåa_•acög
;

514 
	`bezõrc⁄n_upd©e_d©a
(
bez
);

516 
exåa
->
°¨t_å™s
 =Éxåa->
°¨t_l⁄g
 =

517 
exåa
->
middÀ_å™s
 =

518 
exåa
->
íd_å™s
 =Éxåa->
íd_l⁄g
 = (
bezõæöe
->
löe_width
 / 2.0);

520 
obj
->
posôi⁄
 = 
bez
->
poöts
[0].
p1
;

522 i‡(
	`c⁄≈oöt_is_autog≠
(
bez
->
obje˘
.
h™dÀs
[0]->
c⁄√˘ed_to
) ||

523 
	`c⁄≈oöt_is_autog≠
(
bez
->
obje˘
.
h™dÀs
[3*(bez->
numpoöts
-1)]->
c⁄√˘ed_to
) ||

524 
bezõæöe
->
absﬁuã_°¨t_g≠
 || bezõæöe->
absﬁuã_íd_g≠
 ||

525 
bezõæöe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
 || bezõæöe->
íd_¨row
.type != ARROW_NONE) {

526 
Poöt
 
g≠_poöts
[4];

527 
Re˘™gÀ
 
bbox_uni⁄
 = {
bez
->
poöts
[0].
p1
.
x
, bez->poöts[0].p1.
y
, bez->points[0].p1.x, bez->points[0].p1.y};

528 
	`compuã_g≠_poöts
(
bezõæöe
, 
g≠_poöts
);

529 
	`exch™ge_bez_g≠_poöts
(
bez
,
g≠_poöts
);

531 i‡(
bezõæöe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

532 
Re˘™gÀ
 
bbox
;

533 
Poöt
 
move_¨row
, 
move_löe
;

534 
Poöt
 
to
 = 
bez
->
poöts
[0].
p1
, 
‰om
 = bez->points[1].p1;

536 
	`ˇlcuœã_¨row_poöt
(&
bezõæöe
->
°¨t_¨row
, &
to
, &
‰om
, &
move_¨row
, &
move_löe
, bezõæöe->
löe_width
);

537 
	`poöt_sub
(&
to
, &
move_¨row
);

538 
	`poöt_sub
(&
bez
->
poöts
[0].
p1
, &
move_löe
);

539 
	`¨row_bbox
 (&
bezõæöe
->
°¨t_¨row
, bezõæöe->
löe_width
, &
to
, &
‰om
, &
bbox
);

540 
	`ª˘™gÀ_uni⁄
 (&
bbox_uni⁄
, &
bbox
);

542 i‡(
bezõæöe
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

543 
Re˘™gÀ
 
bbox
;

544 
Poöt
 
move_¨row
, 
move_löe
;

545 
num_poöts
 = 
bez
->
numpoöts
;

546 
Poöt
 
to
 = 
bez
->
poöts
[
num_poöts
-1].
p3
, 
‰om
 = bez->poöts[num_poöts-1].
p2
;

548 
	`ˇlcuœã_¨row_poöt
(&
bezõæöe
->
íd_¨row
, &
to
, &
‰om
, &
move_¨row
, &
move_löe
, bezõæöe->
löe_width
);

549 
	`poöt_sub
(&
to
, &
move_¨row
);

550 
	`poöt_sub
(&
bez
->
poöts
[
num_poöts
-1].
p3
, &
move_löe
);

551 
	`¨row_bbox
 (&
bezõæöe
->
íd_¨row
, bezõæöe->
löe_width
, &
to
, &
‰om
, &
bbox
);

552 
	`ª˘™gÀ_uni⁄
 (&
bbox_uni⁄
, &
bbox
);

554 
	`bezõrc⁄n_upd©e_boundögbox
(
bez
);

555 
	`ª˘™gÀ_uni⁄
 (&
obj
->
boundög_box
, &
bbox_uni⁄
);

556 
	`exch™ge_bez_g≠_poöts
(
bez
,
g≠_poöts
);

558 
	`bezõrc⁄n_upd©e_boundögbox
(
bez
);

563 
i
, 
num_poöts
 = 
bez
->
numpoöts
;

564 
obj
->
í˛osög_box
 = obj->
boundög_box
;

566 
i
 = 1; i < 
num_poöts
; ++i) {

567 i‡(
bez
->
poöts
[
i
].
ty≥
 !
BEZ_CURVE_TO
)

569 
	`ª˘™gÀ_add_poöt
(&
obj
->
í˛osög_box
, &
bez
->
poöts
[
i
].
p1
);

570 
	`ª˘™gÀ_add_poöt
(&
obj
->
í˛osög_box
, &
bez
->
poöts
[
i
].
p2
);

573 
	}
}

576 
	$bezõæöe_ßve
(
Bezõæöe
 *
bezõæöe
, 
Obje˘Node
 
obj_node
,

577 c⁄° *
fûíame
)

579 i‡(
	`c⁄≈oöt_is_autog≠
(
bezõæöe
->
bez
.
obje˘
.
h™dÀs
[0]->
c⁄√˘ed_to
) ||

580 
	`c⁄≈oöt_is_autog≠
(
bezõæöe
->
bez
.
obje˘
.
h™dÀs
[3*(bezõæöe->bez.
numpoöts
-1)]->
c⁄√˘ed_to
) ||

581 
bezõæöe
->
absﬁuã_°¨t_g≠
 || bezõæöe->
absﬁuã_íd_g≠
) {

582 
Poöt
 
g≠_poöts
[4];

583 
	`compuã_g≠_poöts
(
bezõæöe
, 
g≠_poöts
);

584 
	`exch™ge_bez_g≠_poöts
(&
bezõæöe
->
bez
,
g≠_poöts
);

585 
	`bezõrc⁄n_upd©e_boundögbox
(&
bezõæöe
->
bez
);

586 
	`exch™ge_bez_g≠_poöts
(&
bezõæöe
->
bez
,
g≠_poöts
);

588 
	`bezõrc⁄n_ßve
(&
bezõæöe
->
bez
, 
obj_node
);

590 i‡(!
	`cﬁ‹_equÆs
(&
bezõæöe
->
löe_cﬁ‹
, &
cﬁ‹_bœck
))

591 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "line_color"),

592 &
bezõæöe
->
löe_cﬁ‹
);

594 i‡(
bezõæöe
->
löe_width
 != 0.1)

595 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

596 
bezõæöe
->
löe_width
);

598 i‡(
bezõæöe
->
löe_°yÀ
 !
LINESTYLE_SOLID
)

599 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

600 
bezõæöe
->
löe_°yÀ
);

602 i‡(
bezõæöe
->
löe_°yÀ
 !
LINESTYLE_SOLID
 &&

603 
bezõæöe
->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

604 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

605 
bezõæöe
->
dashÀngth
);

607 i‡(
bezõæöe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

608 
	`ßve_¨row
(
obj_node
, &
bezõæöe
->
°¨t_¨row
, "start_arrow",

612 i‡(
bezõæöe
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

613 
	`ßve_¨row
(
obj_node
, &
bezõæöe
->
íd_¨row
, "end_arrow",

617 i‡(
bezõæöe
->
absﬁuã_°¨t_g≠
)

618 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "absolute_start_gap"),

619 
bezõæöe
->
absﬁuã_°¨t_g≠
);

620 i‡(
bezõæöe
->
absﬁuã_íd_g≠
)

621 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "absolute_end_gap"),

622 
bezõæöe
->
absﬁuã_íd_g≠
);

623 
	}
}

625 
DüObje˘
 *

626 
	$bezõæöe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

628 
Bezõæöe
 *
bezõæöe
;

629 
BezõrC⁄n
 *
bez
;

630 
DüObje˘
 *
obj
;

631 
AâribuãNode
 
©å
;

633 
bezõæöe
 = 
	`g_√w0
(
Bezõæöe
, 1);

635 
bez
 = &
bezõæöe
->bez;

636 
obj
 = &
bez
->
obje˘
;

638 
obj
->
ty≥
 = &
bezõæöe_ty≥
;

639 
obj
->
›s
 = &
bezõæöe_›s
;

641 
	`bezõrc⁄n_lﬂd
(
bez
, 
obj_node
);

643 
bezõæöe
->
löe_cﬁ‹
 = 
cﬁ‹_bœck
;

644 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_color");

645 i‡(
©å
 !
NULL
)

646 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
bezõæöe
->
löe_cﬁ‹
);

648 
bezõæöe
->
löe_width
 = 0.1;

649 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

650 i‡(
©å
 !
NULL
)

651 
bezõæöe
->
löe_width
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

653 
bezõæöe
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

654 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

655 i‡(
©å
 !
NULL
)

656 
bezõæöe
->
löe_°yÀ
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

658 
bezõæöe
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

659 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

660 i‡(
©å
 !
NULL
)

661 
bezõæöe
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

663 
	`lﬂd_¨row
(
obj_node
, &
bezõæöe
->
°¨t_¨row
, "start_arrow",

666 
	`lﬂd_¨row
(
obj_node
, &
bezõæöe
->
íd_¨row
, "end_arrow",

669 
bezõæöe
->
absﬁuã_°¨t_g≠
 = 0.0;

670 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "absolute_start_gap");

671 i‡(
©å
 !
NULL
)

672 
bezõæöe
->
absﬁuã_°¨t_g≠
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

673 
bezõæöe
->
absﬁuã_íd_g≠
 = 0.0;

674 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "absolute_end_gap");

675 i‡(
©å
 !
NULL
)

676 
bezõæöe
->
absﬁuã_íd_g≠
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

682 
	`bezõæöe_upd©e_d©a
(
bezõæöe
);

684  &
bezõæöe
->
bez
.
obje˘
;

685 
	}
}

687 
Obje˘Ch™ge
 *

688 
	$bezõæöe_add_£gmít_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

690 
Bezõæöe
 *
bezõæöe
 = (Bezõæöe*Ë
obj
;

691 
£gmít
;

692 
Obje˘Ch™ge
 *
ch™ge
;

694 
£gmít
 = 
	`bezõæöe_˛o£°_£gmít
(
bezõæöe
, 
˛icked
);

695 
ch™ge
 = 
	`bezõrc⁄n_add_£gmít
(&
bezõæöe
->
bez
, 
£gmít
, 
˛icked
);

696 
	`bezõæöe_upd©e_d©a
(
bezõæöe
);

697  
ch™ge
;

698 
	}
}

700 
Obje˘Ch™ge
 *

701 
	$bezõæöe_dñëe_£gmít_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

703 
£g_ƒ
;

704 
Bezõæöe
 *
bezõæöe
 = (Bezõæöe*Ë
obj
;

705 
Obje˘Ch™ge
 *
ch™ge
;

707 
£g_ƒ
 = 
	`bezõrc⁄n_˛o£°_£gmít
(&
bezõæöe
->
bez
, 
˛icked
,

708 
bezõæöe
->
löe_width
);

710 
ch™ge
 = 
	`bezõrc⁄n_ªmove_£gmít
(&
bezõæöe
->
bez
, 
£g_ƒ
+1);

711 
	`bezõæöe_upd©e_d©a
(
bezõæöe
);

712  
ch™ge
;

713 
	}
}

715 
Obje˘Ch™ge
 *

716 
	$bezõæöe_£t_c‹√r_ty≥_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

718 
H™dÀ
 *
˛o£°
;

719 
Bezõæöe
 *
bezõæöe
 = (Bezõæöe*Ë
obj
;

720 
Obje˘Ch™ge
 *
ch™ge
;

722 
˛o£°
 = 
	`bezõrc⁄n_˛o£°_maj‹_h™dÀ
(&
bezõæöe
->
bez
, 
˛icked
);

723 
ch™ge
 = 
	`bezõrc⁄n_£t_c‹√r_ty≥
(&
bezõæöe
->
bez
, 
˛o£°
,

724 
	`GPOINTER_TO_INT
(
d©a
));

726 
	`bezõæöe_upd©e_d©a
(
bezõæöe
);

727  
ch™ge
;

728 
	}
}

730 
DüMíuIãm
 
	gbezõæöe_míu_ôems
[] = {

731 { 
N_
("Add segmít"), 
bezõæöe_add_£gmít_ˇŒback
, 
NULL
, 1 },

732 { 
N_
("Dñëê£gmít"), 
bezõæöe_dñëe_£gmít_ˇŒback
, 
NULL
, 1 },

733 { 
NULL
, NULL, NULL, 1 },

734 { 
N_
("Symmëri¯c⁄åﬁ"), 
bezõæöe_£t_c‹√r_ty≥_ˇŒback
,

735 
GINT_TO_POINTER
(
BEZ_CORNER_SYMMETRIC
), 1 },

736 { 
N_
("SmoŸh c⁄åﬁ"), 
bezõæöe_£t_c‹√r_ty≥_ˇŒback
,

737 
GINT_TO_POINTER
(
BEZ_CORNER_SMOOTH
), 1 },

738 { 
N_
("Cu• c⁄åﬁ"), 
bezõæöe_£t_c‹√r_ty≥_ˇŒback
,

739 
GINT_TO_POINTER
(
BEZ_CORNER_CUSP
), 1 },

742 
DüMíu
 
	gbezõæöe_míu
 = {

744 (
bezõæöe_míu_ôems
)/(
DüMíuIãm
),

745 
bezõæöe_míu_ôems
,

746 
NULL


749 
DüMíu
 *

750 
	$bezõæöe_gë_obje˘_míu
(
Bezõæöe
 *
bezõæöe
, 
Poöt
 *
˛ickedpoöt
)

752 
H™dÀ
 *
˛o£°
;

753 
gboﬁón
 
˛o£°_is_ídpoöt
;

754 
BezC‹√rTy≥
 
˘y≥
 = 42;

755 
göt
 
i
;

757 
˛o£°
 = 
	`bezõrc⁄n_˛o£°_maj‹_h™dÀ
(&
bezõæöe
->
bez
, 
˛ickedpoöt
);

758 i‡(
˛o£°
->
id
 =
HANDLE_MOVE_STARTPOINT
 ||

759 
˛o£°
->
id
 =
HANDLE_MOVE_ENDPOINT
)

760 
˛o£°_is_ídpoöt
 = 
TRUE
;

762 
˛o£°_is_ídpoöt
 = 
FALSE
;

764 
i
 = 0; i < 
bezõæöe
->
bez
.
numpoöts
; i++)

765 i‡(
bezõæöe
->
bez
.
obje˘
.
h™dÀs
[3*
i
] =
˛o£°
) {

766 
˘y≥
 = 
bezõæöe
->
bez
.
c‹√r_ty≥s
[
i
];

771 
bezõæöe_míu_ôems
[0].
a˘ive
 = 1;

772 
bezõæöe_míu_ôems
[1].
a˘ive
 = 
bezõæöe
->
bez
.
numpoöts
 > 2;

773 
bezõæöe_míu_ôems
[3].
a˘ive
 = !
˛o£°_is_ídpoöt
 &&

774 (
˘y≥
 !
BEZ_CORNER_SYMMETRIC
);

775 
bezõæöe_míu_ôems
[4].
a˘ive
 = !
˛o£°_is_ídpoöt
 &&

776 (
˘y≥
 !
BEZ_CORNER_SMOOTH
);

777 
bezõæöe_míu_ôems
[5].
a˘ive
 = !
˛o£°_is_ídpoöt
 &&

778 (
˘y≥
 !
BEZ_CORNER_CUSP
);

779  &
bezõæöe_míu
;

780 
	}
}

	@O:\tool\dvs50\objects\standard\beziergon.c

22 #ifde‡
HAVE_CONFIG_H


23 
	~<c⁄fig.h
>

26 
	~<as£π.h
>

27 
	~<m©h.h
>

29 
	~"öé.h
"

30 
	~"obje˘.h
"

31 
	~"bezõrsh≠e.h
"

32 
	~"c⁄√˘i⁄poöt.h
"

33 
	~"düªndîî.h
"

34 
	~"©åibuãs.h
"

35 
	~"widgës.h
"

36 
	~"dümíu.h
"

37 
	~"mesßge.h
"

38 
	~"¥›îtõs.h
"

39 
	~"¸óã.h
"

41 
	~"toﬁ-ic⁄s.h
"

43 
	#DEFAULT_WIDTH
 0.15

	)

45 
_Bezõrg⁄Pr›îtõs
 
	tBezõrg⁄Pr›îtõs
;

47 
	s_Bezõrg⁄
 {

48 
BezõrSh≠e
 
	mbezõr
;

50 
Cﬁ‹
 
	mlöe_cﬁ‹
;

51 
LöeStyÀ
 
	mlöe_°yÀ
;

52 
Cﬁ‹
 
	mö√r_cﬁ‹
;

53 
gboﬁón
 
	mshow_background
;

54 
ªÆ
 
	mdashÀngth
;

55 
ªÆ
 
	mlöe_width
;

56 } 
	tBezõrg⁄
;

58 
	s_Bezõrg⁄Pr›îtõs
 {

59 
gboﬁón
 
	mshow_background
;

60 } 
	gdeÁu…_¥›îtõs
 = { 
TRUE
 };

62 
Obje˘Ch™ge
* 
bezõrg⁄_move_h™dÀ
(
Bezõrg⁄
 *
bezõrg⁄
, 
H™dÀ
 *
h™dÀ
,

63 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

64 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

65 
Obje˘Ch™ge
* 
bezõrg⁄_move
(
Bezõrg⁄
 *
bezõrg⁄
, 
Poöt
 *
to
);

66 
bezõrg⁄_£À˘
(
Bezõrg⁄
 *
bezõrg⁄
, 
Poöt
 *
˛icked_poöt
,

67 
DüRídîî
 *
öãø˘ive_ªndîî
);

68 
bezõrg⁄_døw
(
Bezõrg⁄
 *
bezõrg⁄
, 
DüRídîî
 *
ªndîî
);

69 
DüObje˘
 *
bezõrg⁄_¸óã
(
Poöt
 *
°¨çoöt
,

70 *
u£r_d©a
,

71 
H™dÀ
 **
h™dÀ1
,

72 
H™dÀ
 **
h™dÀ2
);

73 
ªÆ
 
bezõrg⁄_di°™˚_‰om
(
Bezõrg⁄
 *
bezõrg⁄
, 
Poöt
 *
poöt
);

74 
bezõrg⁄_upd©e_d©a
(
Bezõrg⁄
 *
bezõrg⁄
);

75 
bezõrg⁄_de°roy
(
Bezõrg⁄
 *
bezõrg⁄
);

76 
DüObje˘
 *
bezõrg⁄_c›y
(
Bezõrg⁄
 *
bezõrg⁄
);

78 
Pr›Des¸ùti⁄
 *
bezõrg⁄_des¸ibe_¥›s
(
Bezõrg⁄
 *
bezõrg⁄
);

79 
bezõrg⁄_gë_¥›s
(
Bezõrg⁄
 *
bezõrg⁄
, 
GPåAºay
 *
¥›s
);

80 
bezõrg⁄_£t_¥›s
(
Bezõrg⁄
 *
bezõrg⁄
, 
GPåAºay
 *
¥›s
);

82 
bezõrg⁄_ßve
(
Bezõrg⁄
 *
bezõrg⁄
, 
Obje˘Node
 
obj_node
,

83 c⁄° *
fûíame
);

84 
DüObje˘
 *
bezõrg⁄_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
,

85 c⁄° *
fûíame
);

86 
DüMíu
 *
bezõrg⁄_gë_obje˘_míu
(
Bezõrg⁄
 *
bezõrg⁄
,

87 
Poöt
 *
˛ickedpoöt
);

89 
Obje˘Ty≥Ops
 
	gbezõrg⁄_ty≥_›s
 =

91 (
Cª©eFunc
)
bezõrg⁄_¸óã
,

92 (
LﬂdFunc
Ë
bezõrg⁄_lﬂd
,

93 (
SaveFunc
Ë
bezõrg⁄_ßve
,

94 (
GëDeÁu…sFunc
Ë
NULL
,

95 (
AµlyDeÁu…sFunc
Ë
NULL


98 
DüObje˘Ty≥
 
	gbezõrg⁄_ty≥
 =

102 (**Ë
bezõrg⁄_ic⁄
,

104 &
bezõrg⁄_ty≥_›s
,

105 
NULL
,

109 
DüObje˘Ty≥
 *
	g_bezõrg⁄_ty≥
 = (DüObje˘Ty≥ *Ë&
bezõrg⁄_ty≥
;

112 
Obje˘Ops
 
	gbezõrg⁄_›s
 = {

113 (
De°royFunc
Ë
bezõrg⁄_de°roy
,

114 (
DøwFunc
Ë
bezõrg⁄_døw
,

115 (
Di°™˚Func
Ë
bezõrg⁄_di°™˚_‰om
,

116 (
Sñe˘Func
Ë
bezõrg⁄_£À˘
,

117 (
C›yFunc
Ë
bezõrg⁄_c›y
,

118 (
MoveFunc
Ë
bezõrg⁄_move
,

119 (
MoveH™dÀFunc
Ë
bezõrg⁄_move_h™dÀ
,

120 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

121 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

122 (
Obje˘MíuFunc
Ë
bezõrg⁄_gë_obje˘_míu
,

123 (
Des¸ibePr›sFunc
Ë
bezõrg⁄_des¸ibe_¥›s
,

124 (
GëPr›sFunc
Ë
bezõrg⁄_gë_¥›s
,

125 (
SëPr›sFunc
Ë
bezõrg⁄_£t_¥›s
,

126 (
TextEdôFunc
) 0,

127 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

130 
Pr›Des¸ùti⁄
 
	gbezõrg⁄_¥›s
[] = {

131 
BEZSHAPE_COMMON_PROPERTIES
,

132 
PROP_STD_LINE_WIDTH
,

133 
PROP_STD_LINE_COLOUR
,

134 
PROP_STD_LINE_STYLE
,

135 
PROP_STD_FILL_COLOUR
,

136 
PROP_STD_SHOW_BACKGROUND
,

137 
PROP_DESC_END


140 
Pr›Des¸ùti⁄
 *

141 
	$bezõrg⁄_des¸ibe_¥›s
(
Bezõrg⁄
 *
bezõrg⁄
)

143 i‡(
bezõrg⁄_¥›s
[0].
qu¨k
 == 0)

144 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
bezõrg⁄_¥›s
);

145  
bezõrg⁄_¥›s
;

146 
	}
}

148 
Pr›Off£t
 
	gbezõrg⁄_off£ts
[] = {

149 
BEZSHAPE_COMMON_PROPERTIES_OFFSETS
,

150 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Bezõrg⁄
, 
löe_width
) },

151 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Bezõrg⁄
, 
löe_cﬁ‹
) },

152 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

153 
off£tof
(
Bezõrg⁄
, 
löe_°yÀ
), off£tof(Bezõrg⁄, 
dashÀngth
) },

154 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Bezõrg⁄
, 
ö√r_cﬁ‹
) },

155 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
Bezõrg⁄
, 
show_background
) },

156 { 
NULL
, 0, 0 }

160 
	$bezõrg⁄_gë_¥›s
(
Bezõrg⁄
 *
bezõrg⁄
, 
GPåAºay
 *
¥›s
)

162 
	`obje˘_gë_¥›s_‰om_off£ts
(&
bezõrg⁄
->
bezõr
.
obje˘
, 
bezõrg⁄_off£ts
,

163 
¥›s
);

164 
	}
}

167 
	$bezõrg⁄_£t_¥›s
(
Bezõrg⁄
 *
bezõrg⁄
, 
GPåAºay
 *
¥›s
)

169 
	`obje˘_£t_¥›s_‰om_off£ts
(&
bezõrg⁄
->
bezõr
.
obje˘
, 
bezõrg⁄_off£ts
,

170 
¥›s
);

171 
	`bezõrg⁄_upd©e_d©a
(
bezõrg⁄
);

172 
	}
}

174 
ªÆ


175 
	$bezõrg⁄_di°™˚_‰om
(
Bezõrg⁄
 *
bezõrg⁄
, 
Poöt
 *
poöt
)

177  
	`bezõrsh≠e_di°™˚_‰om
(&
bezõrg⁄
->
bezõr
, 
poöt
,

178 
bezõrg⁄
->
löe_width
);

179 
	}
}

182 
	$bezõrg⁄_˛o£°_£gmít
(
Bezõrg⁄
 *
bezõrg⁄
, 
Poöt
 *
poöt
)

184  
	`bezõrsh≠e_˛o£°_£gmít
(&
bezõrg⁄
->
bezõr
, 
poöt
,

185 
bezõrg⁄
->
löe_width
);

186 
	}
}

189 
	$bezõrg⁄_£À˘
(
Bezõrg⁄
 *
bezõrg⁄
, 
Poöt
 *
˛icked_poöt
,

190 
DüRídîî
 *
öãø˘ive_ªndîî
)

192 
	`bezõrsh≠e_upd©e_d©a
(&
bezõrg⁄
->
bezõr
);

193 
	}
}

195 
Obje˘Ch™ge
*

196 
	$bezõrg⁄_move_h™dÀ
(
Bezõrg⁄
 *
bezõrg⁄
, 
H™dÀ
 *
h™dÀ
,

197 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

198 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

200 
	`as£π
(
bezõrg⁄
!=
NULL
);

201 
	`as£π
(
h™dÀ
!=
NULL
);

202 
	`as£π
(
to
!=
NULL
);

204 
	`bezõrsh≠e_move_h™dÀ
(&
bezõrg⁄
->
bezõr
, 
h™dÀ
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

205 
	`bezõrg⁄_upd©e_d©a
(
bezõrg⁄
);

207  
NULL
;

208 
	}
}

211 
Obje˘Ch™ge
*

212 
	$bezõrg⁄_move
(
Bezõrg⁄
 *
bezõrg⁄
, 
Poöt
 *
to
)

214 
	`bezõrsh≠e_move
(&
bezõrg⁄
->
bezõr
, 
to
);

215 
	`bezõrg⁄_upd©e_d©a
(
bezõrg⁄
);

217  
NULL
;

218 
	}
}

221 
	$bezõrg⁄_døw
(
Bezõrg⁄
 *
bezõrg⁄
, 
DüRídîî
 *
ªndîî
)

223 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

225 
BezõrSh≠e
 *
bezõr
 = &
bezõrg⁄
->bezier;

226 
BezPoöt
 *
poöts
;

227 
n
;

229 
poöts
 = &
bezõr
->points[0];

230 
n
 = 
bezõr
->
numpoöts
;

232 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
bezõrg⁄
->
löe_width
);

233 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
bezõrg⁄
->
löe_°yÀ
);

234 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
bezõrg⁄
->
dashÀngth
);

235 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_MITER
);

236 
ªndîî_›s
->
	`£t_löeˇps
(
ªndîî
, 
LINECAPS_BUTT
);

238 i‡(
bezõrg⁄
->
show_background
)

239 
ªndîî_›s
->
	`fûl_bezõr
(
ªndîî
, 
poöts
, 
n
, &
bezõrg⁄
->
ö√r_cﬁ‹
);

241 
ªndîî_›s
->
	`døw_bezõr
(
ªndîî
, 
poöts
, 
n
, &
bezõrg⁄
->
löe_cﬁ‹
);

246 i‡(
ªndîî
->
is_öãø˘ive
 &&

247 
	`dü_obje˘_is_£À˘ed
((
DüObje˘
*)
bezõrg⁄
)) {

248 
	`bezõrsh≠e_døw_c⁄åﬁ_löes
(&
bezõrg⁄
->
bezõr
, 
ªndîî
);

250 
	}
}

252 
DüObje˘
 *

253 
	$bezõrg⁄_¸óã
(
Poöt
 *
°¨çoöt
,

254 *
u£r_d©a
,

255 
H™dÀ
 **
h™dÀ1
,

256 
H™dÀ
 **
h™dÀ2
)

258 
Bezõrg⁄
 *
bezõrg⁄
;

259 
BezõrSh≠e
 *
bezõr
;

260 
DüObje˘
 *
obj
;

261 
Poöt
 
deÁu…x
 = { 1.0, 0.0 };

262 
Poöt
 
deÁu…y
 = { 0.0, 1.0 };

264 
bezõrg⁄
 = 
	`g_√w0
(
Bezõrg⁄
, 1);

265 
bezõr
 = &
bezõrg⁄
->bezier;

266 
obj
 = &
bezõr
->
obje˘
;

268 
obj
->
ty≥
 = &
bezõrg⁄_ty≥
;

269 
obj
->
›s
 = &
bezõrg⁄_›s
;

271 i‡(
u£r_d©a
 =
NULL
) {

272 
	`bezõrsh≠e_öô
(
bezõr
, 3);

274 
bezõr
->
poöts
[0].
p1
 = *
°¨çoöt
;

275 
bezõr
->
poöts
[0].
p3
 = *
°¨çoöt
;

276 
bezõr
->
poöts
[2].
p3
 = *
°¨çoöt
;

278 
bezõr
->
poöts
[1].
p1
 = *
°¨çoöt
;

279 
	`poöt_add
(&
bezõr
->
poöts
[1].
p1
, &
deÁu…x
);

280 
bezõr
->
poöts
[2].
p2
 = *
°¨çoöt
;

281 
	`poöt_sub
(&
bezõr
->
poöts
[2].
p2
, &
deÁu…x
);

283 
bezõr
->
poöts
[1].
p3
 = *
°¨çoöt
;

284 
	`poöt_add
(&
bezõr
->
poöts
[1].
p3
, &
deÁu…y
);

285 
bezõr
->
poöts
[1].
p2
 = bezõr->poöts[1].
p3
;

286 
	`poöt_add
(&
bezõr
->
poöts
[1].
p2
, &
deÁu…x
);

287 
bezõr
->
poöts
[2].
p1
 = bezõr->poöts[1].
p3
;

288 
	`poöt_sub
(&
bezõr
->
poöts
[2].
p1
, &
deÁu…x
);

290 
BezõrCª©eD©a
 *
bcd
 = (BezõrCª©eD©a*)
u£r_d©a
;

292 
	`bezõrsh≠e_öô
(
bezõr
, 
bcd
->
num_poöts
);

293 
	`bezõrsh≠e_£t_poöts
(
bezõr
, 
bcd
->
num_poöts
, bcd->
poöts
);

295 
bezõrg⁄
->
löe_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

296 
bezõrg⁄
->
löe_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

297 
bezõrg⁄
->
ö√r_cﬁ‹
 = 
	`©åibuãs_gë_background
();

298 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
bezõrg⁄
->
löe_°yÀ
,

299 &
bezõrg⁄
->
dashÀngth
);

300 
bezõrg⁄
->
show_background
 = 
deÁu…_¥›îtõs
.show_background;

302 
	`bezõrg⁄_upd©e_d©a
(
bezõrg⁄
);

304 *
h™dÀ1
 = 
bezõr
->
obje˘
.
h™dÀs
[5];

305 *
h™dÀ2
 = 
bezõr
->
obje˘
.
h™dÀs
[2];

306  &
bezõrg⁄
->
bezõr
.
obje˘
;

307 
	}
}

310 
	$bezõrg⁄_de°roy
(
Bezõrg⁄
 *
bezõrg⁄
)

312 
	`bezõrsh≠e_de°roy
(&
bezõrg⁄
->
bezõr
);

313 
	}
}

315 
DüObje˘
 *

316 
	$bezõrg⁄_c›y
(
Bezõrg⁄
 *
bezõrg⁄
)

318 
Bezõrg⁄
 *
√wbezõrg⁄
;

319 
BezõrSh≠e
 *
bezõr
, *
√wbezõr
;

320 
DüObje˘
 *
√wobj
;

322 
bezõr
 = &
bezõrg⁄
->bezier;

324 
√wbezõrg⁄
 = 
	`g_mÆloc0
((
Bezõrg⁄
));

325 
√wbezõr
 = &
√wbezõrg⁄
->
bezõr
;

326 
√wobj
 = &
√wbezõr
->
obje˘
;

328 
	`bezõrsh≠e_c›y
(
bezõr
, 
√wbezõr
);

330 
√wbezõrg⁄
->
löe_cﬁ‹
 = 
bezõrg⁄
->line_color;

331 
√wbezõrg⁄
->
löe_width
 = 
bezõrg⁄
->line_width;

332 
√wbezõrg⁄
->
löe_°yÀ
 = 
bezõrg⁄
->line_style;

333 
√wbezõrg⁄
->
dashÀngth
 = 
bezõrg⁄
->dashlength;

334 
√wbezõrg⁄
->
ö√r_cﬁ‹
 = 
bezõrg⁄
->inner_color;

335 
√wbezõrg⁄
->
show_background
 = 
bezõrg⁄
->show_background;

337  &
√wbezõrg⁄
->
bezõr
.
obje˘
;

338 
	}
}

341 
	$bezõrg⁄_upd©e_d©a
(
Bezõrg⁄
 *
bezõrg⁄
)

343 
BezõrSh≠e
 *
bezõr
 = &
bezõrg⁄
->bezier;

344 
DüObje˘
 *
obj
 = &
bezõr
->
obje˘
;

345 
EÀmítBBExåas
 *
exåa
 = &
bezõr
->
exåa_•acög
;

347 
	`bezõrsh≠e_upd©e_d©a
(
bezõr
);

349 
exåa
->
b‹dî_å™s
 = 
bezõrg⁄
->
löe_width
 / 2.0;

350 
	`bezõrsh≠e_upd©e_boundögbox
(
bezõr
);

354 
i
, 
num_poöts
 = 
bezõr
->
numpoöts
;

355 
obj
->
í˛osög_box
 = obj->
boundög_box
;

356 
i
 = 0; i < 
num_poöts
; ++i) {

357 i‡(
bezõr
->
poöts
[
i
].
ty≥
 !
BEZ_CURVE_TO
)

359 
	`ª˘™gÀ_add_poöt
(&
obj
->
í˛osög_box
, &
bezõr
->
poöts
[
i
].
p1
);

360 
	`ª˘™gÀ_add_poöt
(&
obj
->
í˛osög_box
, &
bezõr
->
poöts
[
i
].
p2
);

363 
obj
->
posôi⁄
 = 
bezõr
->
poöts
[0].
p1
;

364 
	}
}

367 
	$bezõrg⁄_ßve
(
Bezõrg⁄
 *
bezõrg⁄
, 
Obje˘Node
 
obj_node
,

368 c⁄° *
fûíame
)

370 
	`bezõrsh≠e_ßve
(&
bezõrg⁄
->
bezõr
, 
obj_node
);

372 i‡(!
	`cﬁ‹_equÆs
(&
bezõrg⁄
->
löe_cﬁ‹
, &
cﬁ‹_bœck
))

373 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "line_color"),

374 &
bezõrg⁄
->
löe_cﬁ‹
);

376 i‡(
bezõrg⁄
->
löe_width
 != 0.1)

377 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

378 
bezõrg⁄
->
löe_width
);

380 i‡(!
	`cﬁ‹_equÆs
(&
bezõrg⁄
->
ö√r_cﬁ‹
, &
cﬁ‹_whôe
))

381 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "inner_color"),

382 &
bezõrg⁄
->
ö√r_cﬁ‹
);

384 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "show_background"),

385 
bezõrg⁄
->
show_background
);

387 i‡(
bezõrg⁄
->
löe_°yÀ
 !
LINESTYLE_SOLID
)

388 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

389 
bezõrg⁄
->
löe_°yÀ
);

391 i‡(
bezõrg⁄
->
löe_°yÀ
 !
LINESTYLE_SOLID
 &&

392 
bezõrg⁄
->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

393 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

394 
bezõrg⁄
->
dashÀngth
);

396 
	}
}

398 
DüObje˘
 *

399 
	$bezõrg⁄_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

401 
Bezõrg⁄
 *
bezõrg⁄
;

402 
BezõrSh≠e
 *
bezõr
;

403 
DüObje˘
 *
obj
;

404 
AâribuãNode
 
©å
;

406 
bezõrg⁄
 = 
	`g_mÆloc0
((
Bezõrg⁄
));

408 
bezõr
 = &
bezõrg⁄
->bezier;

409 
obj
 = &
bezõr
->
obje˘
;

411 
obj
->
ty≥
 = &
bezõrg⁄_ty≥
;

412 
obj
->
›s
 = &
bezõrg⁄_›s
;

414 
	`bezõrsh≠e_lﬂd
(
bezõr
, 
obj_node
);

416 
bezõrg⁄
->
löe_cﬁ‹
 = 
cﬁ‹_bœck
;

417 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_color");

418 i‡(
©å
 !
NULL
)

419 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
bezõrg⁄
->
löe_cﬁ‹
);

421 
bezõrg⁄
->
löe_width
 = 0.1;

422 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

423 i‡(
©å
 !
NULL
)

424 
bezõrg⁄
->
löe_width
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

426 
bezõrg⁄
->
ö√r_cﬁ‹
 = 
cﬁ‹_whôe
;

427 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "inner_color");

428 i‡(
©å
 !
NULL
)

429 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
bezõrg⁄
->
ö√r_cﬁ‹
);

431 
bezõrg⁄
->
show_background
 = 
TRUE
;

432 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "show_background");

433 i‡(
©å
 !
NULL
)

434 
bezõrg⁄
->
show_background
 = 
	`d©a_boﬁón
–
	`©åibuã_fú°_d©a
(
©å
) );

436 
bezõrg⁄
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

437 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

438 i‡(
©å
 !
NULL
)

439 
bezõrg⁄
->
löe_°yÀ
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

441 
bezõrg⁄
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

442 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

443 i‡(
©å
 !
NULL
)

444 
bezõrg⁄
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

446 
	`bezõrg⁄_upd©e_d©a
(
bezõrg⁄
);

448  &
bezõrg⁄
->
bezõr
.
obje˘
;

449 
	}
}

451 
Obje˘Ch™ge
 *

452 
	$bezõrg⁄_add_£gmít_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

454 
Bezõrg⁄
 *
bezõr
 = (Bezõrg⁄*Ë
obj
;

455 
£gmít
;

456 
Obje˘Ch™ge
 *
ch™ge
;

458 
£gmít
 = 
	`bezõrg⁄_˛o£°_£gmít
(
bezõr
, 
˛icked
);

459 
ch™ge
 = 
	`bezõrsh≠e_add_£gmít
(&
bezõr
->bezõr, 
£gmít
, 
˛icked
);

461 
	`bezõrg⁄_upd©e_d©a
(
bezõr
);

462  
ch™ge
;

463 
	}
}

465 
Obje˘Ch™ge
 *

466 
	$bezõrg⁄_dñëe_£gmít_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

468 
£g_ƒ
;

469 
Bezõrg⁄
 *
bezõr
 = (Bezõrg⁄*Ë
obj
;

470 
Obje˘Ch™ge
 *
ch™ge
;

472 
£g_ƒ
 = 
	`bezõrg⁄_˛o£°_£gmít
(
bezõr
, 
˛icked
);

473 
ch™ge
 = 
	`bezõrsh≠e_ªmove_£gmít
(&
bezõr
->bezõr, 
£g_ƒ
);

475 
	`bezõrg⁄_upd©e_d©a
(
bezõr
);

476  
ch™ge
;

477 
	}
}

479 
Obje˘Ch™ge
 *

480 
	$bezõrg⁄_£t_c‹√r_ty≥_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

482 
H™dÀ
 *
˛o£°
;

483 
Bezõrg⁄
 *
bezõrg⁄
 = (Bezõrg⁄ *Ë
obj
;

484 
Obje˘Ch™ge
 *
ch™ge
;

486 
˛o£°
 = 
	`bezõrsh≠e_˛o£°_maj‹_h™dÀ
(&
bezõrg⁄
->
bezõr
, 
˛icked
);

487 
ch™ge
 = 
	`bezõrsh≠e_£t_c‹√r_ty≥
(&
bezõrg⁄
->
bezõr
, 
˛o£°
,

488 
	`GPOINTER_TO_INT
(
d©a
));

490 
	`bezõrg⁄_upd©e_d©a
(
bezõrg⁄
);

491  
ch™ge
;

492 
	}
}

494 
DüMíuIãm
 
	gbezõrg⁄_míu_ôems
[] = {

495 { 
N_
("Add segmít"), 
bezõrg⁄_add_£gmít_ˇŒback
, 
NULL
, 1 },

496 { 
N_
("Dñëê£gmít"), 
bezõrg⁄_dñëe_£gmít_ˇŒback
, 
NULL
, 1 },

497 { 
NULL
, NULL, NULL, 1 },

498 { 
N_
("Symmëri¯c⁄åﬁ"), 
bezõrg⁄_£t_c‹√r_ty≥_ˇŒback
,

499 
GINT_TO_POINTER
(
BEZ_CORNER_SYMMETRIC
), 1 },

500 { 
N_
("SmoŸh c⁄åﬁ"), 
bezõrg⁄_£t_c‹√r_ty≥_ˇŒback
,

501 
GINT_TO_POINTER
(
BEZ_CORNER_SMOOTH
), 1 },

502 { 
N_
("Cu• c⁄åﬁ"), 
bezõrg⁄_£t_c‹√r_ty≥_ˇŒback
,

503 
GINT_TO_POINTER
(
BEZ_CORNER_CUSP
), 1 },

506 
DüMíu
 
	gbezõrg⁄_míu
 = {

508 (
bezõrg⁄_míu_ôems
)/(
DüMíuIãm
),

509 
bezõrg⁄_míu_ôems
,

510 
NULL


513 
DüMíu
 *

514 
	$bezõrg⁄_gë_obje˘_míu
(
Bezõrg⁄
 *
bezõrg⁄
, 
Poöt
 *
˛ickedpoöt
)

517 
bezõrg⁄_míu_ôems
[0].
a˘ive
 = 1;

518 
bezõrg⁄_míu_ôems
[1].
a˘ive
 = 
bezõrg⁄
->
bezõr
.
numpoöts
 > 3;

519  &
bezõrg⁄_míu
;

520 
	}
}

	@O:\tool\dvs50\objects\standard\box.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<as£π.h
>

24 
	~<m©h.h
>

26 
	~"öé.h
"

27 
	~"obje˘.h
"

28 
	~"ñemít.h
"

29 
	~"c⁄√˘i⁄poöt.h
"

30 
	~"düªndîî.h
"

31 
	~"©åibuãs.h
"

32 
	~"widgës.h
"

33 
	~"mesßge.h
"

34 
	~"¥›îtõs.h
"

36 
	~"toﬁ-ic⁄s.h
"

38 
	#DEFAULT_WIDTH
 2.0

	)

39 
	#DEFAULT_HEIGHT
 1.0

	)

40 
	#DEFAULT_BORDER
 0.25

	)

42 
	#NUM_CONNECTIONS
 9

	)

45 
	mFREE_ASPECT
,

46 
	mFIXED_ASPECT
,

47 
	mSQUARE_ASPECT


48 } 
	tA•e˘Ty≥
;

50 
_Box
 
	tBox
;

52 
	s_Box
 {

53 
EÀmít
 
	mñemít
;

55 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[
NUM_CONNECTIONS
];

57 
ªÆ
 
	mb‹dî_width
;

58 
Cﬁ‹
 
	mb‹dî_cﬁ‹
;

59 
Cﬁ‹
 
	mö√r_cﬁ‹
;

60 
gboﬁón
 
	mshow_background
;

61 
LöeStyÀ
 
	mlöe_°yÀ
;

62 
ªÆ
 
	mdashÀngth
;

63 
ªÆ
 
	mc‹√r_ødius
;

64 
A•e˘Ty≥
 
	ma•e˘
;

67 
	s_BoxPr›îtõs
 {

68 
gboﬁón
 
	mshow_background
;

69 
ªÆ
 
	mc‹√r_ødius
;

70 
A•e˘Ty≥
 
	ma•e˘
;

71 } 
	gdeÁu…_¥›îtõs
 = { 
TRUE
, 0.0 };

73 
ªÆ
 
box_di°™˚_‰om
(
Box
 *
box
, 
Poöt
 *
poöt
);

74 
box_£À˘
(
Box
 *
box
, 
Poöt
 *
˛icked_poöt
,

75 
DüRídîî
 *
öãø˘ive_ªndîî
);

76 
Obje˘Ch™ge
* 
box_move_h™dÀ
(
Box
 *
box
, 
H™dÀ
 *
h™dÀ
,

77 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

78 
H™dÀMoveRós⁄
 
ªas⁄
,

79 
ModifõrKeys
 
modifõrs
);

80 
Obje˘Ch™ge
* 
box_move
(
Box
 *
box
, 
Poöt
 *
to
);

81 
box_døw
(
Box
 *
box
, 
DüRídîî
 *
ªndîî
);

82 
box_upd©e_d©a
(
Box
 *
box
);

83 
DüObje˘
 *
box_¸óã
(
Poöt
 *
°¨çoöt
,

84 *
u£r_d©a
,

85 
H™dÀ
 **
h™dÀ1
,

86 
H™dÀ
 **
h™dÀ2
);

87 
box_de°roy
(
Box
 *
box
);

88 
DüObje˘
 *
box_c›y
(
Box
 *
box
);

90 
Pr›Des¸ùti⁄
 *
box_des¸ibe_¥›s
(
Box
 *
box
);

91 
box_gë_¥›s
(
Box
 *
box
, 
GPåAºay
 *
¥›s
);

92 
box_£t_¥›s
(
Box
 *
box
, 
GPåAºay
 *
¥›s
);

94 
box_ßve
(
Box
 *
box
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
);

95 
DüObje˘
 *
box_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
);

96 
DüMíu
 *
box_gë_obje˘_míu
(
Box
 *
box
, 
Poöt
 *
˛ickedpoöt
);

98 
Obje˘Ty≥Ops
 
	gbox_ty≥_›s
 =

100 (
Cª©eFunc
Ë
box_¸óã
,

101 (
LﬂdFunc
Ë
box_lﬂd
,

102 (
SaveFunc
Ë
box_ßve
,

103 (
GëDeÁu…sFunc
Ë
NULL
,

104 (
AµlyDeÁu…sFunc
Ë
NULL


107 
DüObje˘Ty≥
 
	gbox_ty≥
 =

111 (**Ë
box_ic⁄
,

113 &
box_ty≥_›s


116 
DüObje˘Ty≥
 *
	g_box_ty≥
 = (DüObje˘Ty≥ *Ë&
box_ty≥
;

118 
Obje˘Ops
 
	gbox_›s
 = {

119 (
De°royFunc
Ë
box_de°roy
,

120 (
DøwFunc
Ë
box_døw
,

121 (
Di°™˚Func
Ë
box_di°™˚_‰om
,

122 (
Sñe˘Func
Ë
box_£À˘
,

123 (
C›yFunc
Ë
box_c›y
,

124 (
MoveFunc
Ë
box_move
,

125 (
MoveH™dÀFunc
Ë
box_move_h™dÀ
,

126 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

127 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

128 (
Obje˘MíuFunc
Ë
box_gë_obje˘_míu
,

129 (
Des¸ibePr›sFunc
Ë
box_des¸ibe_¥›s
,

130 (
GëPr›sFunc
Ë
box_gë_¥›s
,

131 (
SëPr›sFunc
Ë
box_£t_¥›s
,

132 (
TextEdôFunc
) 0,

133 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

136 
Pr›NumD©a
 
	gc‹√r_ødius_d©a
 = { 0.0, 10.0, 0.1 };

138 
Pr›EnumD©a
 
	g¥›_a•e˘_d©a
[] = {

139 { 
N_
("Fªe"), 
FREE_ASPECT
 },

140 { 
N_
("Fixed"), 
FIXED_ASPECT
 },

141 { 
N_
("Squ¨e"), 
SQUARE_ASPECT
 },

142 { 
NULL
, 0 }

144 
Pr›Des¸ùti⁄
 
	gbox_¥›s
[] = {

145 
ELEMENT_COMMON_PROPERTIES
,

146 
PROP_STD_LINE_WIDTH
,

147 
PROP_STD_LINE_COLOUR
,

148 
PROP_STD_FILL_COLOUR
,

149 
PROP_STD_SHOW_BACKGROUND
,

150 
PROP_STD_LINE_STYLE
,

151 { "c‹√r_ødius", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

152 
N_
("C‹√∏ødius"), 
NULL
, &
c‹√r_ødius_d©a
 },

153 { "a•e˘", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
,

154 
N_
("A•e˘Ñ©io"), 
NULL
, 
¥›_a•e˘_d©a
 },

155 
PROP_DESC_END


158 
Pr›Des¸ùti⁄
 *

159 
	$box_des¸ibe_¥›s
(
Box
 *
box
)

161 i‡(
box_¥›s
[0].
qu¨k
 == 0)

162 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
box_¥›s
);

163  
box_¥›s
;

164 
	}
}

166 
Pr›Off£t
 
	gbox_off£ts
[] = {

167 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

168 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Box
, 
b‹dî_width
) },

169 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Box
, 
b‹dî_cﬁ‹
) },

170 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Box
, 
ö√r_cﬁ‹
) },

171 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
Box
, 
show_background
) },

172 { "a•e˘", 
PROP_TYPE_ENUM
, 
off£tof
(
Box
, 
a•e˘
) },

173 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

174 
off£tof
(
Box
, 
löe_°yÀ
), off£tof(Box, 
dashÀngth
) },

175 { "c‹√r_ødius", 
PROP_TYPE_REAL
, 
off£tof
(
Box
, 
c‹√r_ødius
) },

176 { 
NULL
, 0, 0 }

180 
	$box_gë_¥›s
(
Box
 *
box
, 
GPåAºay
 *
¥›s
)

182 
	`obje˘_gë_¥›s_‰om_off£ts
(&
box
->
ñemít
.
obje˘
,

183 
box_off£ts
, 
¥›s
);

184 
	}
}

187 
	$box_£t_¥›s
(
Box
 *
box
, 
GPåAºay
 *
¥›s
)

189 
	`obje˘_£t_¥›s_‰om_off£ts
(&
box
->
ñemít
.
obje˘
,

190 
box_off£ts
, 
¥›s
);

191 
	`box_upd©e_d©a
(
box
);

192 
	}
}

194 
ªÆ


195 
	$box_di°™˚_‰om
(
Box
 *
box
, 
Poöt
 *
poöt
)

197 
EÀmít
 *
ñem
 = &
box
->
ñemít
;

198 
Re˘™gÀ
 
ª˘
;

200 
ª˘
.
À·
 = 
ñem
->
c‹√r
.
x
 - 
box
->
b‹dî_width
/2;

201 
ª˘
.
right
 = 
ñem
->
c‹√r
.
x
 +ÉÀm->
width
 + 
box
->
b‹dî_width
/2;

202 
ª˘
.
t›
 = 
ñem
->
c‹√r
.
y
 - 
box
->
b‹dî_width
/2;

203 
ª˘
.
bŸtom
 = 
ñem
->
c‹√r
.
y
 +ÉÀm->
height
 + 
box
->
b‹dî_width
/2;

204  
	`di°™˚_ª˘™gÀ_poöt
(&
ª˘
, 
poöt
);

205 
	}
}

208 
	$box_£À˘
(
Box
 *
box
, 
Poöt
 *
˛icked_poöt
,

209 
DüRídîî
 *
öãø˘ive_ªndîî
)

211 
ªÆ
 
ødius
;

213 
	`ñemít_upd©e_h™dÀs
(&
box
->
ñemít
);

215 i‡(
box
->
c‹√r_ødius
 > 0) {

216 
EÀmít
 *
ñem
 = (EÀmíà*)
box
;

217 
ødius
 = 
box
->
c‹√r_ødius
;

218 
ødius
 = 
	`MIN
‘adius, 
ñem
->
width
/2);

219 
ødius
 = 
	`MIN
‘adius, 
ñem
->
height
/2);

220 
ødius
 *(1-
M_SQRT1_2
);

222 
ñem
->
ªsize_h™dÀs
[0].
pos
.
x
 +
ødius
;

223 
ñem
->
ªsize_h™dÀs
[0].
pos
.
y
 +
ødius
;

224 
ñem
->
ªsize_h™dÀs
[2].
pos
.
x
 -
ødius
;

225 
ñem
->
ªsize_h™dÀs
[2].
pos
.
y
 +
ødius
;

226 
ñem
->
ªsize_h™dÀs
[5].
pos
.
x
 +
ødius
;

227 
ñem
->
ªsize_h™dÀs
[5].
pos
.
y
 -
ødius
;

228 
ñem
->
ªsize_h™dÀs
[7].
pos
.
x
 -
ødius
;

229 
ñem
->
ªsize_h™dÀs
[7].
pos
.
y
 -
ødius
;

231 
	}
}

233 
Obje˘Ch™ge
*

234 
	$box_move_h™dÀ
(
Box
 *
box
, 
H™dÀ
 *
h™dÀ
,

235 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

236 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

238 
	`as£π
(
box
!=
NULL
);

239 
	`as£π
(
h™dÀ
!=
NULL
);

240 
	`as£π
(
to
!=
NULL
);

242 i‡(
box
->
a•e˘
 !
FREE_ASPECT
){

243 
width
, 
height
;

244 
√w_width
, 
√w_height
;

245 
to_width
, 
a•e˘_width
;

246 
Poöt
 
c‹√r
 = 
box
->
ñemít
.corner;

247 
Poöt
 
£_to
;

249 
width
 = 
box
->
ñemít
.width;

250 
height
 = 
box
->
ñemít
.height;

251 
h™dÀ
->
id
) {

252 
HANDLE_RESIZE_N
:

253 
HANDLE_RESIZE_S
:

254 
√w_height
 = 
	`Ábs
(
to
->
y
 - 
c‹√r
.y);

255 
√w_width
 = 
√w_height
 / 
height
 * 
width
;

257 
HANDLE_RESIZE_W
:

258 
HANDLE_RESIZE_E
:

259 
√w_width
 = 
	`Ábs
(
to
->
x
 - 
c‹√r
.x);

260 
√w_height
 = 
√w_width
 / 
width
 * 
height
;

262 
HANDLE_RESIZE_NW
:

263 
HANDLE_RESIZE_NE
:

264 
HANDLE_RESIZE_SW
:

265 
HANDLE_RESIZE_SE
:

266 
to_width
 = 
	`Ábs
(
to
->
x
 - 
c‹√r
.x);

267 
a•e˘_width
 = 
	`Ábs
(
to
->
y
 - 
c‹√r
.yË/ 
height
 * 
width
;

268 
√w_width
 = 
to_width
 > 
a•e˘_width
 ?Åo_width :áspect_width;

269 
√w_height
 = 
√w_width
 / 
width
 * 
height
;

272 
√w_width
 = 
width
;

273 
√w_height
 = 
height
;

277 
£_to
.
x
 = 
c‹√r
.x + 
√w_width
;

278 
£_to
.
y
 = 
c‹√r
.y + 
√w_height
;

280 
	`ñemít_move_h™dÀ
(&
box
->
ñemít
, 
HANDLE_RESIZE_SE
, &
£_to
, 
˝
, 
ªas⁄
, 
modifõrs
);

282 
	`ñemít_move_h™dÀ
(&
box
->
ñemít
, 
h™dÀ
->
id
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

285 
	`box_upd©e_d©a
(
box
);

287  
NULL
;

288 
	}
}

290 
Obje˘Ch™ge
*

291 
	$box_move
(
Box
 *
box
, 
Poöt
 *
to
)

293 
box
->
ñemít
.
c‹√r
 = *
to
;

295 
	`box_upd©e_d©a
(
box
);

297  
NULL
;

298 
	}
}

301 
	$box_døw
(
Box
 *
box
, 
DüRídîî
 *
ªndîî
)

303 
Poöt
 
Ã_c‹√r
;

304 
EÀmít
 *
ñem
;

305 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

308 
	`as£π
(
box
 !
NULL
);

309 
	`as£π
(
ªndîî
 !
NULL
);

311 
ñem
 = &
box
->
ñemít
;

313 
Ã_c‹√r
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

314 
Ã_c‹√r
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

316 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
box
->
b‹dî_width
);

317 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
box
->
löe_°yÀ
);

318 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
box
->
dashÀngth
);

319 i‡(
box
->
c‹√r_ødius
 > 0)

320 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_ROUND
);

322 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_MITER
);

324 i‡(
box
->
show_background
) {

325 
ªndîî_›s
->
	`£t_fûl°yÀ
(
ªndîî
, 
FILLSTYLE_SOLID
);

328 i‡(
box
->
c‹√r_ødius
 > 0) {

329 
ªndîî_›s
->
	`fûl_rounded_ª˘
(
ªndîî
,

330 &
ñem
->
c‹√r
,

331 &
Ã_c‹√r
,

332 &
box
->
ö√r_cﬁ‹
,

333 
box
->
c‹√r_ødius
);

335 
ªndîî_›s
->
	`fûl_ª˘
(
ªndîî
,

336 &
ñem
->
c‹√r
,

337 &
Ã_c‹√r
,

338 &
box
->
ö√r_cﬁ‹
);

342 i‡(
box
->
c‹√r_ødius
 > 0) {

343 
ªndîî_›s
->
	`døw_rounded_ª˘
(
ªndîî
,

344 &
ñem
->
c‹√r
,

345 &
Ã_c‹√r
,

346 &
box
->
b‹dî_cﬁ‹
,

347 
box
->
c‹√r_ødius
);

349 
ªndîî_›s
->
	`døw_ª˘
(
ªndîî
,

350 &
ñem
->
c‹√r
,

351 &
Ã_c‹√r
,

352 &
box
->
b‹dî_cﬁ‹
);

354 
	}
}

358 
	$box_upd©e_d©a
(
Box
 *
box
)

360 
EÀmít
 *
ñem
 = &
box
->
ñemít
;

361 
EÀmítBBExåas
 *
exåa
 = &
ñem
->
exåa_•acög
;

362 
DüObje˘
 *
obj
 = &
ñem
->
obje˘
;

363 
ªÆ
 
ødius
;

365 i‡(
box
->
a•e˘
 =
SQUARE_ASPECT
){

366 
size
 = 
ñem
->
height
 <ÉÀm->
width
 ?Élem->height :Élem->width;

367 
ñem
->
height
 =ÉÀm->
width
 = 
size
;

370 
ødius
 = 
box
->
c‹√r_ødius
;

371 
ødius
 = 
	`MIN
‘adius, 
ñem
->
width
/2);

372 
ødius
 = 
	`MIN
‘adius, 
ñem
->
height
/2);

373 
ødius
 *(1-
M_SQRT1_2
);

376 
box
->
c⁄√˘i⁄s
[0].
pos
.
x
 = 
ñem
->
c‹√r
.x + 
ødius
;

377 
box
->
c⁄√˘i⁄s
[0].
pos
.
y
 = 
ñem
->
c‹√r
.y + 
ødius
;

378 
box
->
c⁄√˘i⁄s
[1].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

379 
box
->
c⁄√˘i⁄s
[1].
pos
.
y
 = 
ñem
->
c‹√r
.y;

380 
box
->
c⁄√˘i⁄s
[2].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 - 
ødius
;

381 
box
->
c⁄√˘i⁄s
[2].
pos
.
y
 = 
ñem
->
c‹√r
.y + 
ødius
;

382 
box
->
c⁄√˘i⁄s
[3].
pos
.
x
 = 
ñem
->
c‹√r
.x;

383 
box
->
c⁄√˘i⁄s
[3].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

384 
box
->
c⁄√˘i⁄s
[4].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

385 
box
->
c⁄√˘i⁄s
[4].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

386 
box
->
c⁄√˘i⁄s
[5].
pos
.
x
 = 
ñem
->
c‹√r
.x + 
ødius
;

387 
box
->
c⁄√˘i⁄s
[5].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 - 
ødius
;

388 
box
->
c⁄√˘i⁄s
[6].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

389 
box
->
c⁄√˘i⁄s
[6].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

390 
box
->
c⁄√˘i⁄s
[7].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 - 
ødius
;

391 
box
->
c⁄√˘i⁄s
[7].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 - 
ødius
;

392 
box
->
c⁄√˘i⁄s
[8].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

393 
box
->
c⁄√˘i⁄s
[8].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

395 
box
->
c⁄√˘i⁄s
[0].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_WEST
;

396 
box
->
c⁄√˘i⁄s
[1].
dúe˘i⁄s
 = 
DIR_NORTH
;

397 
box
->
c⁄√˘i⁄s
[2].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_EAST
;

398 
box
->
c⁄√˘i⁄s
[3].
dúe˘i⁄s
 = 
DIR_WEST
;

399 
box
->
c⁄√˘i⁄s
[4].
dúe˘i⁄s
 = 
DIR_EAST
;

400 
box
->
c⁄√˘i⁄s
[5].
dúe˘i⁄s
 = 
DIR_SOUTH
|
DIR_WEST
;

401 
box
->
c⁄√˘i⁄s
[6].
dúe˘i⁄s
 = 
DIR_SOUTH
;

402 
box
->
c⁄√˘i⁄s
[7].
dúe˘i⁄s
 = 
DIR_SOUTH
|
DIR_EAST
;

403 
box
->
c⁄√˘i⁄s
[8].
dúe˘i⁄s
 = 
DIR_ALL
;

405 
exåa
->
b‹dî_å™s
 = 
box
->
b‹dî_width
 / 2.0;

406 
	`ñemít_upd©e_boundögbox
(
ñem
);

408 
obj
->
posôi⁄
 = 
ñem
->
c‹√r
;

410 
	`ñemít_upd©e_h™dÀs
(
ñem
);

412 i‡(
ødius
 > 0.0) {

414 
ñem
->
ªsize_h™dÀs
[0].
pos
.
x
 +
ødius
;

415 
ñem
->
ªsize_h™dÀs
[0].
pos
.
y
 +
ødius
;

416 
ñem
->
ªsize_h™dÀs
[2].
pos
.
x
 -
ødius
;

417 
ñem
->
ªsize_h™dÀs
[2].
pos
.
y
 +
ødius
;

418 
ñem
->
ªsize_h™dÀs
[5].
pos
.
x
 +
ødius
;

419 
ñem
->
ªsize_h™dÀs
[5].
pos
.
y
 -
ødius
;

420 
ñem
->
ªsize_h™dÀs
[7].
pos
.
x
 -
ødius
;

421 
ñem
->
ªsize_h™dÀs
[7].
pos
.
y
 -
ødius
;

423 
	}
}

425 
DüObje˘
 *

426 
	$box_¸óã
(
Poöt
 *
°¨çoöt
,

427 *
u£r_d©a
,

428 
H™dÀ
 **
h™dÀ1
,

429 
H™dÀ
 **
h™dÀ2
)

431 
Box
 *
box
;

432 
EÀmít
 *
ñem
;

433 
DüObje˘
 *
obj
;

434 
i
;

436 
box
 = 
	`g_mÆloc0
((
Box
));

437 
ñem
 = &
box
->
ñemít
;

438 
obj
 = &
ñem
->
obje˘
;

440 
obj
->
ty≥
 = &
box_ty≥
;

442 
obj
->
›s
 = &
box_›s
;

444 
ñem
->
c‹√r
 = *
°¨çoöt
;

445 
ñem
->
width
 = 
DEFAULT_WIDTH
;

446 
ñem
->
height
 = 
DEFAULT_HEIGHT
;

448 
box
->
b‹dî_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

449 
box
->
b‹dî_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

450 
box
->
ö√r_cﬁ‹
 = 
	`©åibuãs_gë_background
();

451 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
box
->
löe_°yÀ
, &box->
dashÀngth
);

453 
box
->
show_background
 = 
deÁu…_¥›îtõs
.show_background;

454 
box
->
c‹√r_ødius
 = 
deÁu…_¥›îtõs
.corner_radius;

455 
box
->
a•e˘
 = 
deÁu…_¥›îtõs
.aspect;

457 
	`ñemít_öô
(
ñem
, 8, 
NUM_CONNECTIONS
);

459 
i
=0;i<
NUM_CONNECTIONS
;i++) {

460 
obj
->
c⁄√˘i⁄s
[
i
] = &
box
->connections[i];

461 
box
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

462 
box
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

464 
box
->
c⁄√˘i⁄s
[8].
Êags
 = 
CP_FLAGS_MAIN
;

466 
	`box_upd©e_d©a
(
box
);

468 *
h™dÀ1
 = 
NULL
;

469 *
h™dÀ2
 = 
obj
->
h™dÀs
[7];

470  &
box
->
ñemít
.
obje˘
;

471 
	}
}

474 
	$box_de°roy
(
Box
 *
box
)

476 
	`ñemít_de°roy
(&
box
->
ñemít
);

477 
	}
}

479 
DüObje˘
 *

480 
	$box_c›y
(
Box
 *
box
)

482 
i
;

483 
Box
 *
√wbox
;

484 
EÀmít
 *
ñem
, *
√wñem
;

485 
DüObje˘
 *
√wobj
;

487 
ñem
 = &
box
->
ñemít
;

489 
√wbox
 = 
	`g_mÆloc0
((
Box
));

490 
√wñem
 = &
√wbox
->
ñemít
;

491 
√wobj
 = &
√wñem
->
obje˘
;

493 
	`ñemít_c›y
(
ñem
, 
√wñem
);

495 
√wbox
->
b‹dî_width
 = 
box
->border_width;

496 
√wbox
->
b‹dî_cﬁ‹
 = 
box
->border_color;

497 
√wbox
->
ö√r_cﬁ‹
 = 
box
->inner_color;

498 
√wbox
->
show_background
 = 
box
->show_background;

499 
√wbox
->
löe_°yÀ
 = 
box
->line_style;

500 
√wbox
->
dashÀngth
 = 
box
->dashlength;

501 
√wbox
->
c‹√r_ødius
 = 
box
->corner_radius;

502 
√wbox
->
a•e˘
 = 
box
->aspect;

504 
i
=0;i<
NUM_CONNECTIONS
;i++) {

505 
√wobj
->
c⁄√˘i⁄s
[
i
] = &
√wbox
->connections[i];

506 
√wbox
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
√wobj
;

507 
√wbox
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

508 
√wbox
->
c⁄√˘i⁄s
[
i
].
pos
 = 
box
->connections[i].pos;

509 
√wbox
->
c⁄√˘i⁄s
[
i
].
œ°_pos
 = 
box
->connections[i].last_pos;

510 
√wbox
->
c⁄√˘i⁄s
[
i
].
Êags
 = 
box
->connections[i].flags;

513  &
√wbox
->
ñemít
.
obje˘
;

514 
	}
}

517 
	$box_ßve
(
Box
 *
box
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
)

519 
	`ñemít_ßve
(&
box
->
ñemít
, 
obj_node
);

521 i‡(
box
->
b‹dî_width
 != 0.1)

522 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "border_width"),

523 
box
->
b‹dî_width
);

525 i‡(!
	`cﬁ‹_equÆs
(&
box
->
b‹dî_cﬁ‹
, &
cﬁ‹_bœck
))

526 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "border_color"),

527 &
box
->
b‹dî_cﬁ‹
);

529 i‡(!
	`cﬁ‹_equÆs
(&
box
->
ö√r_cﬁ‹
, &
cﬁ‹_whôe
))

530 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "inner_color"),

531 &
box
->
ö√r_cﬁ‹
);

533 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "show_background"), 
box
->
show_background
);

535 i‡(
box
->
löe_°yÀ
 !
LINESTYLE_SOLID
)

536 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

537 
box
->
löe_°yÀ
);

539 i‡(
box
->
löe_°yÀ
 !
LINESTYLE_SOLID
 &&

540 
box
->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

541 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

542 
box
->
dashÀngth
);

544 i‡(
box
->
c‹√r_ødius
 > 0.0)

545 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "corner_radius"),

546 
box
->
c‹√r_ødius
);

548 i‡(
box
->
a•e˘
 !
FREE_ASPECT
)

549 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "aspect"),

550 
box
->
a•e˘
);

551 
	}
}

553 
DüObje˘
 *

554 
	$box_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

556 
Box
 *
box
;

557 
EÀmít
 *
ñem
;

558 
DüObje˘
 *
obj
;

559 
i
;

560 
AâribuãNode
 
©å
;

562 
box
 = 
	`g_mÆloc0
((
Box
));

563 
ñem
 = &
box
->
ñemít
;

564 
obj
 = &
ñem
->
obje˘
;

566 
obj
->
ty≥
 = &
box_ty≥
;

567 
obj
->
›s
 = &
box_›s
;

569 
	`ñemít_lﬂd
(
ñem
, 
obj_node
);

571 
box
->
b‹dî_width
 = 0.1;

572 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "border_width");

573 i‡(
©å
 !
NULL
)

574 
box
->
b‹dî_width
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

576 
box
->
b‹dî_cﬁ‹
 = 
cﬁ‹_bœck
;

577 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "border_color");

578 i‡(
©å
 !
NULL
)

579 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
box
->
b‹dî_cﬁ‹
);

581 
box
->
ö√r_cﬁ‹
 = 
cﬁ‹_whôe
;

582 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "inner_color");

583 i‡(
©å
 !
NULL
)

584 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
box
->
ö√r_cﬁ‹
);

586 
box
->
show_background
 = 
TRUE
;

587 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "show_background");

588 i‡(
©å
 !
NULL
)

589 
box
->
show_background
 = 
	`d©a_boﬁón
–
	`©åibuã_fú°_d©a
(
©å
) );

591 
box
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

592 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

593 i‡(
©å
 !
NULL
)

594 
box
->
löe_°yÀ
 = 
	`d©a_íum
–
	`©åibuã_fú°_d©a
(
©å
) );

596 
box
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

597 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

598 i‡(
©å
 !
NULL
)

599 
box
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

601 
box
->
c‹√r_ødius
 = 0.0;

602 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "corner_radius");

603 i‡(
©å
 !
NULL
)

604 
box
->
c‹√r_ødius
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

606 
box
->
a•e˘
 = 
FREE_ASPECT
;

607 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "aspect");

608 i‡(
©å
 !
NULL
)

609 
box
->
a•e˘
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

611 
	`ñemít_öô
(
ñem
, 8, 
NUM_CONNECTIONS
);

613 
i
=0;i<
NUM_CONNECTIONS
;i++) {

614 
obj
->
c⁄√˘i⁄s
[
i
] = &
box
->connections[i];

615 
box
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

616 
box
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

618 
box
->
c⁄√˘i⁄s
[8].
Êags
 = 
CP_FLAGS_MAIN
;

620 
	`box_upd©e_d©a
(
box
);

622  &
box
->
ñemít
.
obje˘
;

623 
	}
}

626 
	sA•e˘Ch™ge
 {

627 
Obje˘Ch™ge
 
	mobj_ch™ge
;

628 
A•e˘Ty≥
 
	mﬁd_ty≥
, 
	m√w_ty≥
;

632 
Poöt
 
	mt›À·
;

633 
ªÆ
 
	mwidth
, 
	mheight
;

637 
	$a•e˘_ch™ge_‰ì
(
A•e˘Ch™ge
 *
ch™ge
)

639 
	}
}

642 
	$a•e˘_ch™ge_≠∂y
(
A•e˘Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

644 
Box
 *
box
 = (Box*)
obj
;

646 
box
->
a•e˘
 = 
ch™ge
->
√w_ty≥
;

647 
	`box_upd©e_d©a
(
box
);

648 
	}
}

651 
	$a•e˘_ch™ge_ªvît
(
A•e˘Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

653 
Box
 *
box
 = (Box*)
obj
;

655 
box
->
a•e˘
 = 
ch™ge
->
ﬁd_ty≥
;

656 
box
->
ñemít
.
c‹√r
 = 
ch™ge
->
t›À·
;

657 
box
->
ñemít
.
width
 = 
ch™ge
->width;

658 
box
->
ñemít
.
height
 = 
ch™ge
->height;

659 
	`box_upd©e_d©a
(
box
);

660 
	}
}

662 
Obje˘Ch™ge
 *

663 
	$a•e˘_¸óã_ch™ge
(
Box
 *
box
, 
A•e˘Ty≥
 
a•e˘
)

665 
A•e˘Ch™ge
 *
ch™ge
;

667 
ch™ge
 = 
	`g_√w0
(
A•e˘Ch™ge
, 1);

669 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
a•e˘_ch™ge_≠∂y
;

670 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
a•e˘_ch™ge_ªvît
;

671 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
a•e˘_ch™ge_‰ì
;

673 
ch™ge
->
ﬁd_ty≥
 = 
box
->
a•e˘
;

674 
ch™ge
->
√w_ty≥
 = 
a•e˘
;

675 
ch™ge
->
t›À·
 = 
box
->
ñemít
.
c‹√r
;

676 
ch™ge
->
width
 = 
box
->
ñemít
.width;

677 
ch™ge
->
height
 = 
box
->
ñemít
.height;

679  (
Obje˘Ch™ge
 *)
ch™ge
;

680 
	}
}

683 
Obje˘Ch™ge
 *

684 
	$box_£t_a•e˘_ˇŒback
 (
DüObje˘
* 
obj
, 
Poöt
* 
˛icked
, 
gpoöãr
 
d©a
)

686 
Obje˘Ch™ge
 *
ch™ge
;

688 
ch™ge
 = 
	`a•e˘_¸óã_ch™ge
((
Box
*)
obj
, (
A•e˘Ty≥
)
d©a
);

689 
ch™ge
->
	`≠∂y
(ch™ge, 
obj
);

691  
ch™ge
;

692 
	}
}

694 
DüMíuIãm
 
	gbox_míu_ôems
[] = {

695 { 
N_
("Fªêa•e˘"), 
box_£t_a•e˘_ˇŒback
, (*)
FREE_ASPECT
,

696 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
 },

697 { 
N_
("Fixedá•e˘"), 
box_£t_a•e˘_ˇŒback
, (*)
FIXED_ASPECT
,

698 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
 },

699 { 
N_
("Squ¨e"), 
box_£t_a•e˘_ˇŒback
, (*)
SQUARE_ASPECT
,

700 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
},

703 
DüMíu
 
	gbox_míu
 = {

705 (
box_míu_ôems
)/(
DüMíuIãm
),

706 
box_míu_ôems
,

707 
NULL


710 
DüMíu
 *

711 
	$box_gë_obje˘_míu
(
Box
 *
box
, 
Poöt
 *
˛ickedpoöt
)

714 
box_míu_ôems
[0].
a˘ive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

715 
box_míu_ôems
[1].
a˘ive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

716 
box_míu_ôems
[2].
a˘ive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

718 
box_míu_ôems
[
box
->
a•e˘
].
a˘ive
 =

719 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
|
DIAMENU_TOGGLE_ON
;

721  &
box_míu
;

722 
	}
}

	@O:\tool\dvs50\objects\standard\ellipse.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<as£π.h
>

24 
	~<m©h.h
>

26 
	~"öé.h
"

27 
	~"obje˘.h
"

28 
	~"ñemít.h
"

29 
	~"c⁄√˘i⁄poöt.h
"

30 
	~"düªndîî.h
"

31 
	~"©åibuãs.h
"

32 
	~"widgës.h
"

33 
	~"mesßge.h
"

34 
	~"¥›îtõs.h
"

36 
	~"toﬁ-ic⁄s.h
"

38 
	#DEFAULT_WIDTH
 2.0

	)

39 
	#DEFAULT_HEIGHT
 1.0

	)

40 
	#DEFAULT_BORDER
 0.15

	)

43 
	mFREE_ASPECT
,

44 
	mFIXED_ASPECT
,

45 
	mCIRCLE_ASPECT


46 } 
	tA•e˘Ty≥
;

48 
_EŒù£
 
	tEŒù£
;

50 
	s_EŒù£
 {

51 
EÀmít
 
	mñemít
;

53 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[9];

54 
H™dÀ
 
	m˚¡î_h™dÀ
;

56 
ªÆ
 
	mb‹dî_width
;

57 
Cﬁ‹
 
	mb‹dî_cﬁ‹
;

58 
Cﬁ‹
 
	mö√r_cﬁ‹
;

59 
gboﬁón
 
	mshow_background
;

60 
A•e˘Ty≥
 
	ma•e˘
;

61 
LöeStyÀ
 
	mlöe_°yÀ
;

62 
ªÆ
 
	mdashÀngth
;

65 
	s_EŒù£Pr›îtõs
 {

66 
A•e˘Ty≥
 
	ma•e˘
;

67 
gboﬁón
 
	mshow_background
;

68 } 
	gdeÁu…_¥›îtõs
 = { 
FREE_ASPECT
, 
TRUE
 };

70 
ªÆ
 
ñlù£_di°™˚_‰om
(
EŒù£
 *
ñlù£
, 
Poöt
 *
poöt
);

71 
ñlù£_£À˘
(
EŒù£
 *
ñlù£
, 
Poöt
 *
˛icked_poöt
,

72 
DüRídîî
 *
öãø˘ive_ªndîî
);

73 
Obje˘Ch™ge
* 
ñlù£_move_h™dÀ
(
EŒù£
 *
ñlù£
, 
H™dÀ
 *
h™dÀ
,

74 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

75 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

76 
Obje˘Ch™ge
* 
ñlù£_move
(
EŒù£
 *
ñlù£
, 
Poöt
 *
to
);

77 
ñlù£_døw
(
EŒù£
 *
ñlù£
, 
DüRídîî
 *
ªndîî
);

78 
ñlù£_upd©e_d©a
(
EŒù£
 *
ñlù£
);

79 
DüObje˘
 *
ñlù£_¸óã
(
Poöt
 *
°¨çoöt
,

80 *
u£r_d©a
,

81 
H™dÀ
 **
h™dÀ1
,

82 
H™dÀ
 **
h™dÀ2
);

83 
ñlù£_de°roy
(
EŒù£
 *
ñlù£
);

84 
DüObje˘
 *
ñlù£_c›y
(
EŒù£
 *
ñlù£
);

86 
Pr›Des¸ùti⁄
 *
ñlù£_des¸ibe_¥›s
(
EŒù£
 *
ñlù£
);

87 
ñlù£_gë_¥›s
(
EŒù£
 *
ñlù£
, 
GPåAºay
 *
¥›s
);

88 
ñlù£_£t_¥›s
(
EŒù£
 *
ñlù£
, 
GPåAºay
 *
¥›s
);

90 
ñlù£_ßve
(
EŒù£
 *
ñlù£
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
);

91 
DüObje˘
 *
ñlù£_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
);

92 
DüMíu
 *
ñlù£_gë_obje˘_míu
(
EŒù£
 *
ñlù£
, 
Poöt
 *
˛ickedpoöt
);

94 
Obje˘Ty≥Ops
 
	gñlù£_ty≥_›s
 =

96 (
Cª©eFunc
Ë
ñlù£_¸óã
,

97 (
LﬂdFunc
Ë
ñlù£_lﬂd
,

98 (
SaveFunc
Ë
ñlù£_ßve
,

99 (
GëDeÁu…sFunc
Ë
NULL
,

100 (
AµlyDeÁu…sFunc
Ë
NULL


103 
DüObje˘Ty≥
 
	gñlù£_ty≥
 =

107 (**Ë
ñlù£_ic⁄
,

109 &
ñlù£_ty≥_›s


112 
DüObje˘Ty≥
 *
	g_ñlù£_ty≥
 = (DüObje˘Ty≥ *Ë&
ñlù£_ty≥
;

114 
Obje˘Ops
 
	gñlù£_›s
 = {

115 (
De°royFunc
Ë
ñlù£_de°roy
,

116 (
DøwFunc
Ë
ñlù£_døw
,

117 (
Di°™˚Func
Ë
ñlù£_di°™˚_‰om
,

118 (
Sñe˘Func
Ë
ñlù£_£À˘
,

119 (
C›yFunc
Ë
ñlù£_c›y
,

120 (
MoveFunc
Ë
ñlù£_move
,

121 (
MoveH™dÀFunc
Ë
ñlù£_move_h™dÀ
,

122 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

123 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

124 (
Obje˘MíuFunc
Ë
ñlù£_gë_obje˘_míu
,

125 (
Des¸ibePr›sFunc
Ë
ñlù£_des¸ibe_¥›s
,

126 (
GëPr›sFunc
Ë
ñlù£_gë_¥›s
,

127 (
SëPr›sFunc
Ë
ñlù£_£t_¥›s
,

128 (
TextEdôFunc
) 0,

129 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

132 
Pr›EnumD©a
 
	g¥›_a•e˘_d©a
[] = {

133 { 
N_
("Fªe"), 
FREE_ASPECT
 },

134 { 
N_
("Fixed"), 
FIXED_ASPECT
 },

135 { 
N_
("Cú˛e"), 
CIRCLE_ASPECT
 },

136 { 
NULL
, 0 }

138 
Pr›Des¸ùti⁄
 
	gñlù£_¥›s
[] = {

139 
ELEMENT_COMMON_PROPERTIES
,

140 
PROP_STD_LINE_WIDTH
,

141 
PROP_STD_LINE_COLOUR
,

142 
PROP_STD_FILL_COLOUR
,

143 
PROP_STD_SHOW_BACKGROUND
,

144 
PROP_STD_LINE_STYLE
,

145 { "a•e˘", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
,

146 
N_
("A•e˘Ñ©io"), 
NULL
, 
¥›_a•e˘_d©a
 },

147 
PROP_DESC_END


150 
Pr›Des¸ùti⁄
 *

151 
	$ñlù£_des¸ibe_¥›s
(
EŒù£
 *
ñlù£
)

153 i‡(
ñlù£_¥›s
[0].
qu¨k
 == 0)

154 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
ñlù£_¥›s
);

155  
ñlù£_¥›s
;

156 
	}
}

158 
Pr›Off£t
 
	gñlù£_off£ts
[] = {

159 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

160 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
EŒù£
, 
b‹dî_width
) },

161 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
EŒù£
, 
b‹dî_cﬁ‹
) },

162 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
EŒù£
, 
ö√r_cﬁ‹
) },

163 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
EŒù£
, 
show_background
) },

164 { "a•e˘", 
PROP_TYPE_ENUM
, 
off£tof
(
EŒù£
, 
a•e˘
) },

165 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

166 
off£tof
(
EŒù£
, 
löe_°yÀ
), off£tof(EŒù£, 
dashÀngth
) },

167 { 
NULL
, 0, 0 }

171 
	$ñlù£_gë_¥›s
(
EŒù£
 *
ñlù£
, 
GPåAºay
 *
¥›s
)

173 
	`obje˘_gë_¥›s_‰om_off£ts
(&
ñlù£
->
ñemít
.
obje˘
,

174 
ñlù£_off£ts
, 
¥›s
);

175 
	}
}

178 
	$ñlù£_£t_¥›s
(
EŒù£
 *
ñlù£
, 
GPåAºay
 *
¥›s
)

181 
	`obje˘_£t_¥›s_‰om_off£ts
(&
ñlù£
->
ñemít
.
obje˘
,

182 
ñlù£_off£ts
, 
¥›s
);

184 
	`ñlù£_upd©e_d©a
(
ñlù£
);

185 
	}
}

187 
ªÆ


188 
	$ñlù£_di°™˚_‰om
(
EŒù£
 *
ñlù£
, 
Poöt
 *
poöt
)

190 
EÀmít
 *
ñem
 = &
ñlù£
->
ñemít
;

191 
Poöt
 
˚¡î
;

193 
˚¡î
.
x
 = 
ñem
->
c‹√r
.x+ñem->
width
/2;

194 
˚¡î
.
y
 = 
ñem
->
c‹√r
.y+ñem->
height
/2;

196  
	`di°™˚_ñlù£_poöt
(&
˚¡î
, 
ñem
->
width
,ÉÀm->
height
,

197 
ñlù£
->
b‹dî_width
, 
poöt
);

198 
	}
}

201 
	$ñlù£_£À˘
(
EŒù£
 *
ñlù£
, 
Poöt
 *
˛icked_poöt
,

202 
DüRídîî
 *
öãø˘ive_ªndîî
)

204 
	`ñemít_upd©e_h™dÀs
(&
ñlù£
->
ñemít
);

205 
	}
}

207 
Obje˘Ch™ge
*

208 
	$ñlù£_move_h™dÀ
(
EŒù£
 *
ñlù£
, 
H™dÀ
 *
h™dÀ
,

209 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

210 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

212 
EÀmít
 *
ñem
 = &
ñlù£
->
ñemít
;

213 
Poöt
 
nw_to
, 
£_to
;

215 
	`as£π
(
ñlù£
!=
NULL
);

216 
	`as£π
(
h™dÀ
!=
NULL
);

217 
	`as£π
(
to
!=
NULL
);

219 
	`as£π
(
h™dÀ
->
id
 < 8 || h™dÀ->id =
HANDLE_CUSTOM1
);

220 i‡(
h™dÀ
->
id
 =
HANDLE_CUSTOM1
) {

221 
Poöt
 
dñè
, 
c‹√r_to
;

222 
dñè
.
x
 = 
to
->x - (
ñem
->
c‹√r
.x +ÉÀm->
width
/2);

223 
dñè
.
y
 = 
to
->y - (
ñem
->
c‹√r
.y +ÉÀm->
height
/2);

224 
c‹√r_to
.
x
 = 
ñem
->
c‹√r
.x + 
dñè
.x;

225 
c‹√r_to
.
y
 = 
ñem
->
c‹√r
.y + 
dñè
.y;

226  
	`ñlù£_move
(
ñlù£
, &
c‹√r_to
);

228 i‡(
ñlù£
->
a•e˘
 !
FREE_ASPECT
){

229 
width
, 
height
;

230 
√w_width
, 
√w_height
;

231 
to_width
, 
a•e˘_width
;

232 
Poöt
 
˚¡î
;

234 
width
 = 
ñlù£
->
ñemít
.width;

235 
height
 = 
ñlù£
->
ñemít
.height;

236 
˚¡î
.
x
 = 
ñem
->
c‹√r
.x + 
width
/2;

237 
˚¡î
.
y
 = 
ñem
->
c‹√r
.y + 
height
/2;

238 
h™dÀ
->
id
) {

239 
HANDLE_RESIZE_E
:

240 
HANDLE_RESIZE_W
:

241 
√w_width
 = 2 * 
	`Ábs
(
to
->
x
 - 
˚¡î
.x);

242 
√w_height
 = 
√w_width
 / 
width
 * 
height
;

244 
HANDLE_RESIZE_N
:

245 
HANDLE_RESIZE_S
:

246 
√w_height
 = 2 * 
	`Ábs
(
to
->
y
 - 
˚¡î
.y);

247 
√w_width
 = 
√w_height
 / 
height
 * 
width
;

249 
HANDLE_RESIZE_NW
:

250 
HANDLE_RESIZE_NE
:

251 
HANDLE_RESIZE_SW
:

252 
HANDLE_RESIZE_SE
:

253 
to_width
 = 2 * 
	`Ábs
(
to
->
x
 - 
˚¡î
.x);

254 
a•e˘_width
 = 2 * 
	`Ábs
(
to
->
y
 - 
˚¡î
.yË/ 
height
 * 
width
;

255 
√w_width
 = 
to_width
 < 
a•e˘_width
 ?Åo_width :áspect_width;

256 
√w_height
 = 
√w_width
 / 
width
 * 
height
;

259 
√w_width
 = 
width
;

260 
√w_height
 = 
height
;

264 
nw_to
.
x
 = 
˚¡î
.x - 
√w_width
/2;

265 
nw_to
.
y
 = 
˚¡î
.y - 
√w_height
/2;

266 
£_to
.
x
 = 
˚¡î
.x + 
√w_width
/2;

267 
£_to
.
y
 = 
˚¡î
.y + 
√w_height
/2;

269 
	`ñemít_move_h™dÀ
(&
ñlù£
->
ñemít
, 
HANDLE_RESIZE_NW
, &
nw_to
, 
˝
, 
ªas⁄
, 
modifõrs
);

270 
	`ñemít_move_h™dÀ
(&
ñlù£
->
ñemít
, 
HANDLE_RESIZE_SE
, &
£_to
, 
˝
, 
ªas⁄
, 
modifõrs
);

272 
Poöt
 
˚¡î
;

273 
Poöt
 
›posôe_to
;

274 
˚¡î
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
/2;

275 
˚¡î
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
/2;

276 
›posôe_to
.
x
 = 
˚¡î
.x - (
to
->x-center.x);

277 
›posôe_to
.
y
 = 
˚¡î
.y - (
to
->y-center.y);

279 
	`ñemít_move_h™dÀ
(&
ñlù£
->
ñemít
, 
h™dÀ
->
id
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

283 
	`ñemít_move_h™dÀ
(&
ñlù£
->
ñemít
, 7-
h™dÀ
->
id
, &
›posôe_to
, 
˝
, 
ªas⁄
, 
modifõrs
);

286 
	`ñlù£_upd©e_d©a
(
ñlù£
);

288  
NULL
;

290 
	}
}

292 
Obje˘Ch™ge
*

293 
	$ñlù£_move
(
EŒù£
 *
ñlù£
, 
Poöt
 *
to
)

295 
ñlù£
->
ñemít
.
c‹√r
 = *
to
;

296 
	`ñlù£_upd©e_d©a
(
ñlù£
);

298  
NULL
;

299 
	}
}

302 
	$ñlù£_døw
(
EŒù£
 *
ñlù£
, 
DüRídîî
 *
ªndîî
)

304 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

305 
Poöt
 
˚¡î
;

306 
EÀmít
 *
ñem
;

308 
	`as£π
(
ñlù£
 !
NULL
);

309 
	`as£π
(
ªndîî
 !
NULL
);

311 
ñem
 = &
ñlù£
->
ñemít
;

313 
˚¡î
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
/2;

314 
˚¡î
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
/2;

316 i‡(
ñlù£
->
show_background
) {

317 
ªndîî_›s
->
	`£t_fûl°yÀ
(
ªndîî
, 
FILLSTYLE_SOLID
);

319 
ªndîî_›s
->
	`fûl_ñlù£
(
ªndîî
,

320 &
˚¡î
,

321 
ñem
->
width
,ÉÀm->
height
,

322 &
ñlù£
->
ö√r_cﬁ‹
);

325 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
ñlù£
->
b‹dî_width
);

326 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
ñlù£
->
löe_°yÀ
);

327 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
ñlù£
->
dashÀngth
);

329 
ªndîî_›s
->
	`døw_ñlù£
(
ªndîî
,

330 &
˚¡î
,

331 
ñem
->
width
,ÉÀm->
height
,

332 &
ñlù£
->
b‹dî_cﬁ‹
);

333 
	}
}

336 
	$ñlù£_upd©e_d©a
(
EŒù£
 *
ñlù£
)

338 
EÀmít
 *
ñem
 = &
ñlù£
->
ñemít
;

339 
EÀmítBBExåas
 *
exåa
 = &
ñem
->
exåa_•acög
;

340 
DüObje˘
 *
obj
 = &
ñem
->
obje˘
;

341 
Poöt
 
˚¡î
;

342 
ªÆ
 
hÆf_x
, 
hÆf_y
;

345 i‡(
ñlù£
->
a•e˘
 =
CIRCLE_ASPECT
){

346 
size
 = 
ñem
->
height
 <ÉÀm->
width
 ?Élem->height :Élem->width;

347 
ñem
->
height
 =ÉÀm->
width
 = 
size
;

350 
˚¡î
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

351 
˚¡î
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

353 
hÆf_x
 = 
ñem
->
width
 * 
M_SQRT1_2
 / 2.0;

354 
hÆf_y
 = 
ñem
->
height
 * 
M_SQRT1_2
 / 2.0;

357 
ñlù£
->
c⁄√˘i⁄s
[0].
pos
.
x
 = 
˚¡î
.x - 
hÆf_x
;

358 
ñlù£
->
c⁄√˘i⁄s
[0].
pos
.
y
 = 
˚¡î
.y - 
hÆf_y
;

359 
ñlù£
->
c⁄√˘i⁄s
[1].
pos
.
x
 = 
˚¡î
.x;

360 
ñlù£
->
c⁄√˘i⁄s
[1].
pos
.
y
 = 
ñem
->
c‹√r
.y;

361 
ñlù£
->
c⁄√˘i⁄s
[2].
pos
.
x
 = 
˚¡î
.x + 
hÆf_x
;

362 
ñlù£
->
c⁄√˘i⁄s
[2].
pos
.
y
 = 
˚¡î
.y - 
hÆf_y
;

363 
ñlù£
->
c⁄√˘i⁄s
[3].
pos
.
x
 = 
ñem
->
c‹√r
.x;

364 
ñlù£
->
c⁄√˘i⁄s
[3].
pos
.
y
 = 
˚¡î
.y;

365 
ñlù£
->
c⁄√˘i⁄s
[4].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

366 
ñlù£
->
c⁄√˘i⁄s
[4].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

367 
ñlù£
->
c⁄√˘i⁄s
[5].
pos
.
x
 = 
˚¡î
.x - 
hÆf_x
;

368 
ñlù£
->
c⁄√˘i⁄s
[5].
pos
.
y
 = 
˚¡î
.y + 
hÆf_y
;

369 
ñlù£
->
c⁄√˘i⁄s
[6].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

370 
ñlù£
->
c⁄√˘i⁄s
[6].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

371 
ñlù£
->
c⁄√˘i⁄s
[7].
pos
.
x
 = 
˚¡î
.x + 
hÆf_x
;

372 
ñlù£
->
c⁄√˘i⁄s
[7].
pos
.
y
 = 
˚¡î
.y + 
hÆf_y
;

373 
ñlù£
->
c⁄√˘i⁄s
[8].
pos
.
x
 = 
˚¡î
.x;

374 
ñlù£
->
c⁄√˘i⁄s
[8].
pos
.
y
 = 
˚¡î
.y;

377 
ñlù£
->
c⁄√˘i⁄s
[0].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_WEST
;

378 
ñlù£
->
c⁄√˘i⁄s
[1].
dúe˘i⁄s
 = 
DIR_NORTH
;

379 
ñlù£
->
c⁄√˘i⁄s
[2].
dúe˘i⁄s
 = 
DIR_NORTH
|
DIR_EAST
;

380 
ñlù£
->
c⁄√˘i⁄s
[3].
dúe˘i⁄s
 = 
DIR_WEST
;

381 
ñlù£
->
c⁄√˘i⁄s
[4].
dúe˘i⁄s
 = 
DIR_EAST
;

382 
ñlù£
->
c⁄√˘i⁄s
[5].
dúe˘i⁄s
 = 
DIR_SOUTH
|
DIR_WEST
;

383 
ñlù£
->
c⁄√˘i⁄s
[6].
dúe˘i⁄s
 = 
DIR_SOUTH
;

384 
ñlù£
->
c⁄√˘i⁄s
[7].
dúe˘i⁄s
 = 
DIR_SOUTH
|
DIR_EAST
;

385 
ñlù£
->
c⁄√˘i⁄s
[8].
dúe˘i⁄s
 = 
DIR_ALL
;

387 
exåa
->
b‹dî_å™s
 = 
ñlù£
->
b‹dî_width
 / 2.0;

388 
	`ñemít_upd©e_boundögbox
(
ñem
);

390 
obj
->
posôi⁄
 = 
ñem
->
c‹√r
;

392 
	`ñemít_upd©e_h™dÀs
(
ñem
);

394 
obj
->
h™dÀs
[8]->
pos
.
x
 = 
˚¡î
.x;

395 
obj
->
h™dÀs
[8]->
pos
.
y
 = 
˚¡î
.y;

396 
	}
}

398 
DüObje˘
 *

399 
	$ñlù£_¸óã
(
Poöt
 *
°¨çoöt
,

400 *
u£r_d©a
,

401 
H™dÀ
 **
h™dÀ1
,

402 
H™dÀ
 **
h™dÀ2
)

404 
EŒù£
 *
ñlù£
;

405 
EÀmít
 *
ñem
;

406 
DüObje˘
 *
obj
;

407 
i
;

409 
ñlù£
 = 
	`g_mÆloc0
((
EŒù£
));

410 
ñem
 = &
ñlù£
->
ñemít
;

411 
obj
 = &
ñem
->
obje˘
;

413 
obj
->
ty≥
 = &
ñlù£_ty≥
;

415 
obj
->
›s
 = &
ñlù£_›s
;

417 
ñem
->
c‹√r
 = *
°¨çoöt
;

418 
ñem
->
width
 = 
DEFAULT_WIDTH
;

419 
ñem
->
height
 = 
DEFAULT_HEIGHT
;

421 
ñlù£
->
b‹dî_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

422 
ñlù£
->
b‹dî_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

423 
ñlù£
->
ö√r_cﬁ‹
 = 
	`©åibuãs_gë_background
();

424 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
ñlù£
->
löe_°yÀ
,

425 &
ñlù£
->
dashÀngth
);

426 
ñlù£
->
show_background
 = 
deÁu…_¥›îtõs
.show_background;

427 
ñlù£
->
a•e˘
 = 
deÁu…_¥›îtõs
.aspect;

429 
	`ñemít_öô
(
ñem
, 9, 9);

431 
obj
->
h™dÀs
[8] = &
ñlù£
->
˚¡î_h™dÀ
;

432 
obj
->
h™dÀs
[8]->
id
 = 
HANDLE_CUSTOM1
;

433 
obj
->
h™dÀs
[8]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

434 
obj
->
h™dÀs
[8]->
c⁄√˘ed_to
 = 
NULL
;

435 
obj
->
h™dÀs
[8]->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

437 
i
=0;i<9;i++) {

438 
obj
->
c⁄√˘i⁄s
[
i
] = &
ñlù£
->connections[i];

439 
ñlù£
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

440 
ñlù£
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

442 
ñlù£
->
c⁄√˘i⁄s
[8].
Êags
 = 
CP_FLAGS_MAIN
;

443 
	`ñlù£_upd©e_d©a
(
ñlù£
);

445 *
h™dÀ1
 = 
NULL
;

446 *
h™dÀ2
 = 
obj
->
h™dÀs
[7];

447  &
ñlù£
->
ñemít
.
obje˘
;

448 
	}
}

451 
	$ñlù£_de°roy
(
EŒù£
 *
ñlù£
)

453 
	`ñemít_de°roy
(&
ñlù£
->
ñemít
);

454 
	}
}

456 
DüObje˘
 *

457 
	$ñlù£_c›y
(
EŒù£
 *
ñlù£
)

459 
i
;

460 
EŒù£
 *
√wñlù£
;

461 
EÀmít
 *
ñem
, *
√wñem
;

462 
DüObje˘
 *
√wobj
;

464 
ñem
 = &
ñlù£
->
ñemít
;

466 
√wñlù£
 = 
	`g_mÆloc0
((
EŒù£
));

467 
√wñem
 = &
√wñlù£
->
ñemít
;

468 
√wobj
 = &
√wñem
->
obje˘
;

470 
	`ñemít_c›y
(
ñem
, 
√wñem
);

472 
√wñlù£
->
b‹dî_width
 = 
ñlù£
->border_width;

473 
√wñlù£
->
b‹dî_cﬁ‹
 = 
ñlù£
->border_color;

474 
√wñlù£
->
ö√r_cﬁ‹
 = 
ñlù£
->inner_color;

475 
√wñlù£
->
dashÀngth
 = 
ñlù£
->dashlength;

476 
√wñlù£
->
show_background
 = 
ñlù£
->show_background;

477 
√wñlù£
->
a•e˘
 = 
ñlù£
->aspect;

478 
√wñlù£
->
löe_°yÀ
 = 
ñlù£
->line_style;

480 
√wñlù£
->
˚¡î_h™dÀ
 = 
ñlù£
->center_handle;

481 
√wñlù£
->
˚¡î_h™dÀ
.
c⁄√˘ed_to
 = 
NULL
;

482 
√wobj
->
h™dÀs
[8] = &
√wñlù£
->
˚¡î_h™dÀ
;

484 
i
=0;i<9;i++) {

485 
√wobj
->
c⁄√˘i⁄s
[
i
] = &
√wñlù£
->connections[i];

486 
√wñlù£
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
√wobj
;

487 
√wñlù£
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

488 
√wñlù£
->
c⁄√˘i⁄s
[
i
].
pos
 = 
ñlù£
->connections[i].pos;

489 
√wñlù£
->
c⁄√˘i⁄s
[
i
].
œ°_pos
 = 
ñlù£
->connections[i].last_pos;

490 
√wñlù£
->
c⁄√˘i⁄s
[
i
].
Êags
 = 
ñlù£
->connections[i].flags;

493  &
√wñlù£
->
ñemít
.
obje˘
;

494 
	}
}

498 
	$ñlù£_ßve
(
EŒù£
 *
ñlù£
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
)

500 
	`ñemít_ßve
(&
ñlù£
->
ñemít
, 
obj_node
);

502 i‡(
ñlù£
->
b‹dî_width
 != 0.1)

503 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "border_width"),

504 
ñlù£
->
b‹dî_width
);

506 i‡(!
	`cﬁ‹_equÆs
(&
ñlù£
->
b‹dî_cﬁ‹
, &
cﬁ‹_bœck
))

507 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "border_color"),

508 &
ñlù£
->
b‹dî_cﬁ‹
);

510 i‡(!
	`cﬁ‹_equÆs
(&
ñlù£
->
ö√r_cﬁ‹
, &
cﬁ‹_whôe
))

511 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "inner_color"),

512 &
ñlù£
->
ö√r_cﬁ‹
);

514 i‡(!
ñlù£
->
show_background
)

515 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "show_background"),

516 
ñlù£
->
show_background
);

518 i‡(
ñlù£
->
a•e˘
 !
FREE_ASPECT
)

519 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "aspect"),

520 
ñlù£
->
a•e˘
);

522 i‡(
ñlù£
->
löe_°yÀ
 !
LINESTYLE_SOLID
) {

523 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

524 
ñlù£
->
löe_°yÀ
);

526 i‡(
ñlù£
->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

527 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

528 
ñlù£
->
dashÀngth
);

530 
	}
}

532 
DüObje˘
 *
	$ñlù£_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

534 
EŒù£
 *
ñlù£
;

535 
EÀmít
 *
ñem
;

536 
DüObje˘
 *
obj
;

537 
i
;

538 
AâribuãNode
 
©å
;

540 
ñlù£
 = 
	`g_mÆloc0
((
EŒù£
));

541 
ñem
 = &
ñlù£
->
ñemít
;

542 
obj
 = &
ñem
->
obje˘
;

544 
obj
->
ty≥
 = &
ñlù£_ty≥
;

545 
obj
->
›s
 = &
ñlù£_›s
;

547 
	`ñemít_lﬂd
(
ñem
, 
obj_node
);

549 
ñlù£
->
b‹dî_width
 = 0.1;

550 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "border_width");

551 i‡(
©å
 !
NULL
)

552 
ñlù£
->
b‹dî_width
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

554 
ñlù£
->
b‹dî_cﬁ‹
 = 
cﬁ‹_bœck
;

555 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "border_color");

556 i‡(
©å
 !
NULL
)

557 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
ñlù£
->
b‹dî_cﬁ‹
);

559 
ñlù£
->
ö√r_cﬁ‹
 = 
cﬁ‹_whôe
;

560 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "inner_color");

561 i‡(
©å
 !
NULL
)

562 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
ñlù£
->
ö√r_cﬁ‹
);

564 
ñlù£
->
show_background
 = 
TRUE
;

565 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "show_background");

566 i‡(
©å
 !
NULL
)

567 
ñlù£
->
show_background
 = 
	`d©a_boﬁón
(
	`©åibuã_fú°_d©a
(
©å
));

569 
ñlù£
->
a•e˘
 = 
FREE_ASPECT
;

570 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "aspect");

571 i‡(
©å
 !
NULL
)

572 
ñlù£
->
a•e˘
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

574 
ñlù£
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

575 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

576 i‡(
©å
 !
NULL
)

577 
ñlù£
->
löe_°yÀ
 = 
	`d©a_íum
–
	`©åibuã_fú°_d©a
(
©å
) );

579 
ñlù£
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

580 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

581 i‡(
©å
 !
NULL
)

582 
ñlù£
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

584 
	`ñemít_öô
(
ñem
, 9, 9);

586 
obj
->
h™dÀs
[8] = &
ñlù£
->
˚¡î_h™dÀ
;

587 
obj
->
h™dÀs
[8]->
id
 = 
HANDLE_CUSTOM1
;

588 
obj
->
h™dÀs
[8]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

589 
obj
->
h™dÀs
[8]->
c⁄√˘ed_to
 = 
NULL
;

590 
obj
->
h™dÀs
[8]->
c⁄√˘_ty≥
 = 
HANDLE_NONCONNECTABLE
;

592 
i
=0;i<9;i++) {

593 
obj
->
c⁄√˘i⁄s
[
i
] = &
ñlù£
->connections[i];

594 
ñlù£
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

595 
ñlù£
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

597 
ñlù£
->
c⁄√˘i⁄s
[8].
Êags
 = 
CP_FLAGS_MAIN
;

599 
	`ñlù£_upd©e_d©a
(
ñlù£
);

601  &
ñlù£
->
ñemít
.
obje˘
;

602 
	}
}

604 
	sA•e˘Ch™ge
 {

605 
Obje˘Ch™ge
 
	mobj_ch™ge
;

606 
A•e˘Ty≥
 
	mﬁd_ty≥
, 
	m√w_ty≥
;

610 
Poöt
 
	mt›À·
;

611 
ªÆ
 
	mwidth
, 
	mheight
;

615 
	$a•e˘_ch™ge_‰ì
(
A•e˘Ch™ge
 *
ch™ge
)

617 
	}
}

620 
	$a•e˘_ch™ge_≠∂y
(
A•e˘Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

622 
EŒù£
 *
ñlù£
 = (EŒù£*)
obj
;

624 
ñlù£
->
a•e˘
 = 
ch™ge
->
√w_ty≥
;

625 
	`ñlù£_upd©e_d©a
(
ñlù£
);

626 
	}
}

629 
	$a•e˘_ch™ge_ªvît
(
A•e˘Ch™ge
 *
ch™ge
, 
DüObje˘
 *
obj
)

631 
EŒù£
 *
ñlù£
 = (EŒù£*)
obj
;

633 
ñlù£
->
a•e˘
 = 
ch™ge
->
ﬁd_ty≥
;

634 
ñlù£
->
ñemít
.
c‹√r
 = 
ch™ge
->
t›À·
;

635 
ñlù£
->
ñemít
.
width
 = 
ch™ge
->width;

636 
ñlù£
->
ñemít
.
height
 = 
ch™ge
->height;

637 
	`ñlù£_upd©e_d©a
(
ñlù£
);

638 
	}
}

640 
Obje˘Ch™ge
 *

641 
	$a•e˘_¸óã_ch™ge
(
EŒù£
 *
ñlù£
, 
A•e˘Ty≥
 
a•e˘
)

643 
A•e˘Ch™ge
 *
ch™ge
;

645 
ch™ge
 = 
	`g_√w0
(
A•e˘Ch™ge
, 1);

647 
ch™ge
->
obj_ch™ge
.
≠∂y
 = (
Obje˘Ch™geAµlyFunc
Ë
a•e˘_ch™ge_≠∂y
;

648 
ch™ge
->
obj_ch™ge
.
ªvît
 = (
Obje˘Ch™geRevîtFunc
Ë
a•e˘_ch™ge_ªvît
;

649 
ch™ge
->
obj_ch™ge
.
‰ì
 = (
Obje˘Ch™geFªeFunc
Ë
a•e˘_ch™ge_‰ì
;

651 
ch™ge
->
ﬁd_ty≥
 = 
ñlù£
->
a•e˘
;

652 
ch™ge
->
√w_ty≥
 = 
a•e˘
;

653 
ch™ge
->
t›À·
 = 
ñlù£
->
ñemít
.
c‹√r
;

654 
ch™ge
->
width
 = 
ñlù£
->
ñemít
.width;

655 
ch™ge
->
height
 = 
ñlù£
->
ñemít
.height;

657  (
Obje˘Ch™ge
 *)
ch™ge
;

658 
	}
}

661 
Obje˘Ch™ge
 *

662 
	$ñlù£_£t_a•e˘_ˇŒback
 (
DüObje˘
* 
obj
, 
Poöt
* 
˛icked
, 
gpoöãr
 
d©a
)

664 
Obje˘Ch™ge
 *
ch™ge
;

666 
ch™ge
 = 
	`a•e˘_¸óã_ch™ge
((
EŒù£
*)
obj
, (
A•e˘Ty≥
)
d©a
);

667 
ch™ge
->
	`≠∂y
(ch™ge, 
obj
);

669  
ch™ge
;

670 
	}
}

672 
DüMíuIãm
 
	gñlù£_míu_ôems
[] = {

673 { 
N_
("Fªêa•e˘"), 
ñlù£_£t_a•e˘_ˇŒback
, (*)
FREE_ASPECT
,

674 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
 },

675 { 
N_
("Fixedá•e˘"), 
ñlù£_£t_a•e˘_ˇŒback
, (*)
FIXED_ASPECT
,

676 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
 },

677 { 
N_
("Cú˛e"), 
ñlù£_£t_a•e˘_ˇŒback
, (*)
CIRCLE_ASPECT
,

678 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
},

681 
DüMíu
 
	gñlù£_míu
 = {

683 (
ñlù£_míu_ôems
)/(
DüMíuIãm
),

684 
ñlù£_míu_ôems
,

685 
NULL


688 
DüMíu
 *

689 
	$ñlù£_gë_obje˘_míu
(
EŒù£
 *
ñlù£
, 
Poöt
 *
˛ickedpoöt
)

692 
ñlù£_míu_ôems
[0].
a˘ive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

693 
ñlù£_míu_ôems
[1].
a˘ive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

694 
ñlù£_míu_ôems
[2].
a˘ive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

696 
ñlù£_míu_ôems
[
ñlù£
->
a•e˘
].
a˘ive
 =

697 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
|
DIAMENU_TOGGLE_ON
;

699  &
ñlù£_míu
;

700 
	}
}

	@O:\tool\dvs50\objects\standard\image.c

18 
	~<c⁄fig.h
>

20 
	~<as£π.h
>

21 
	~<°rög.h
>

22 
	~<m©h.h
>

23 
	~<sys/°©.h
>

24 
	~<time.h
>

25 #ifde‡
HAVE_UNIST_H


26 
	~<uni°d.h
>

28 
	~<glib/g°dio.h
>

30 
	~"öé.h
"

31 
	~"mesßge.h
"

32 
	~"obje˘.h
"

33 
	~"ñemít.h
"

34 
	~"c⁄√˘i⁄poöt.h
"

35 
	~"düªndîî.h
"

36 
	~"©åibuãs.h
"

37 
	~"widgës.h
"

38 
	~"dü_image.h
"

39 
	~"mesßge.h
"

40 
	~"¥›îtõs.h
"

42 
	~"toﬁ-ic⁄s.h
"

44 
	#DEFAULT_WIDTH
 2.0

	)

45 
	#DEFAULT_HEIGHT
 2.0

	)

47 
	#NUM_CONNECTIONS
 9

	)

49 
_Image
 
	tImage
;

51 
	s_Image
 {

52 
EÀmít
 
	mñemít
;

54 
C⁄√˘i⁄Poöt
 
	mc⁄√˘i⁄s
[
NUM_CONNECTIONS
];

56 
ªÆ
 
	mb‹dî_width
;

57 
Cﬁ‹
 
	mb‹dî_cﬁ‹
;

58 
LöeStyÀ
 
	mlöe_°yÀ
;

59 
ªÆ
 
	mdashÀngth
;

61 
DüImage
 *
	mimage
;

62 
gch¨
 *
	mfûe
;

63 
gboﬁón
 
	mdøw_b‹dî
;

64 
gboﬁón
 
	mkìp_a•e˘
;

66 
time_t
 
	mmtime
;

69 
	s_ImagePr›îtõs
 {

70 
gch¨
 *
	mfûe
;

71 
gboﬁón
 
	mdøw_b‹dî
;

72 
gboﬁón
 
	mkìp_a•e˘
;

73 } 
	gdeÁu…_¥›îtõs
 = { "", 
FALSE
, 
TRUE
 };

75 
ªÆ
 
image_di°™˚_‰om
(
Image
 *
image
, 
Poöt
 *
poöt
);

76 
image_£À˘
(
Image
 *
image
, 
Poöt
 *
˛icked_poöt
,

77 
DüRídîî
 *
öãø˘ive_ªndîî
);

78 
Obje˘Ch™ge
* 
image_move_h™dÀ
(
Image
 *
image
, 
H™dÀ
 *
h™dÀ
,

79 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

80 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

81 
Obje˘Ch™ge
* 
image_move
(
Image
 *
image
, 
Poöt
 *
to
);

82 
image_døw
(
Image
 *
image
, 
DüRídîî
 *
ªndîî
);

83 
image_upd©e_d©a
(
Image
 *
image
);

84 
DüObje˘
 *
image_¸óã
(
Poöt
 *
°¨çoöt
,

85 *
u£r_d©a
,

86 
H™dÀ
 **
h™dÀ1
,

87 
H™dÀ
 **
h™dÀ2
);

88 
image_de°roy
(
Image
 *
image
);

89 
DüObje˘
 *
image_c›y
(
Image
 *
image
);

91 
Pr›Des¸ùti⁄
 *
image_des¸ibe_¥›s
(
Image
 *
image
);

92 
image_gë_¥›s
(
Image
 *
image
, 
GPåAºay
 *
¥›s
);

93 
image_£t_¥›s
(
Image
 *
image
, 
GPåAºay
 *
¥›s
);

95 
image_ßve
(
Image
 *
image
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
);

96 
DüObje˘
 *
image_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
);

98 
Obje˘Ty≥Ops
 
	gimage_ty≥_›s
 =

100 (
Cª©eFunc
Ë
image_¸óã
,

101 (
LﬂdFunc
Ë
image_lﬂd
,

102 (
SaveFunc
Ë
image_ßve
,

103 (
GëDeÁu…sFunc
Ë
NULL
,

104 (
AµlyDeÁu…sFunc
Ë
NULL


107 
DüObje˘Ty≥
 
	gimage_ty≥
 =

111 (**Ë
image_ic⁄
,

113 &
image_ty≥_›s


116 
DüObje˘Ty≥
 *
	g_image_ty≥
 = (DüObje˘Ty≥ *Ë&
image_ty≥
;

118 
Obje˘Ops
 
	gimage_›s
 = {

119 (
De°royFunc
Ë
image_de°roy
,

120 (
DøwFunc
Ë
image_døw
,

121 (
Di°™˚Func
Ë
image_di°™˚_‰om
,

122 (
Sñe˘Func
Ë
image_£À˘
,

123 (
C›yFunc
Ë
image_c›y
,

124 (
MoveFunc
Ë
image_move
,

125 (
MoveH™dÀFunc
Ë
image_move_h™dÀ
,

126 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

127 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

128 (
Obje˘MíuFunc
Ë
NULL
,

129 (
Des¸ibePr›sFunc
Ë
image_des¸ibe_¥›s
,

130 (
GëPr›sFunc
Ë
image_gë_¥›s
,

131 (
SëPr›sFunc
Ë
image_£t_¥›s
,

132 (
TextEdôFunc
) 0,

133 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

136 
Pr›Des¸ùti⁄
 
	gimage_¥›s
[] = {

137 
ELEMENT_COMMON_PROPERTIES
,

138 { "image_fûe", 
PROP_TYPE_FILE
, 
PROP_FLAG_VISIBLE
,

139 
N_
("Imagêfûe"), 
NULL
, NULL},

140 { "show_b‹dî", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
,

141 
N_
("Døw b‹dî"), 
NULL
, NULL},

142 { "kìp_a•e˘", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
,

143 
N_
("Kì∞a•e˘Ñ©io"), 
NULL
, NULL},

144 
PROP_STD_LINE_WIDTH
,

145 
PROP_STD_LINE_COLOUR
,

146 
PROP_STD_LINE_STYLE
,

147 
PROP_DESC_END


150 
Pr›Des¸ùti⁄
 *

151 
	$image_des¸ibe_¥›s
(
Image
 *
image
)

153 i‡(
image_¥›s
[0].
qu¨k
 == 0)

154 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
image_¥›s
);

155  
image_¥›s
;

156 
	}
}

158 
Pr›Off£t
 
	gimage_off£ts
[] = {

159 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

160 { "image_fûe", 
PROP_TYPE_FILE
, 
off£tof
(
Image
, 
fûe
) },

161 { "show_b‹dî", 
PROP_TYPE_BOOL
, 
off£tof
(
Image
, 
døw_b‹dî
) },

162 { "kìp_a•e˘", 
PROP_TYPE_BOOL
, 
off£tof
(
Image
, 
kìp_a•e˘
) },

163 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Image
, 
b‹dî_width
) },

164 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Image
, 
b‹dî_cﬁ‹
) },

165 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

166 
off£tof
(
Image
, 
löe_°yÀ
), off£tof(Image, 
dashÀngth
) },

167 { 
NULL
, 0, 0 }

171 
	$image_gë_¥›s
(
Image
 *
image
, 
GPåAºay
 *
¥›s
)

173 
	`obje˘_gë_¥›s_‰om_off£ts
(&
image
->
ñemít
.
obje˘
, 
image_off£ts
, 
¥›s
);

174 
	}
}

177 
	$image_£t_¥›s
(
Image
 *
image
, 
GPåAºay
 *
¥›s
)

179 
°©
 
°
;

180 
time_t
 
mtime
 = 0;

181 *
ﬁd_fûe
 = 
image
->
fûe
 ? 
	`g_°rdup
(image->file) : "";

183 
	`obje˘_£t_¥›s_‰om_off£ts
(&
image
->
ñemít
.
obje˘
, 
image_off£ts
, 
¥›s
);

186 i‡(
	`g_°©
 (
image
->
fûe
, &
°
) != 0)

187 
mtime
 = 
image
->mtime;

189 
mtime
 = 
°
.
°_mtime
;

192 i‡(
	`°rcmp
(
image
->
fûe
, 
ﬁd_fûe
Ë!0 || image->
mtime
 != mtime) {

193 
EÀmít
 *
ñem
 = &
image
->
ñemít
;

194 
DüImage
 *
img
 = 
NULL
;

196 
img
 = 
	`dü_image_lﬂd
(
image
->
fûe
);

197 i‡(
img
)

198 
image
->imagê
img
;

200 
image
->imagê
	`dü_image_gë_brokí
();

201 
ñem
->
height
 = (ñem->
width
*()
	`dü_image_height
(
image
->image))/

202 ()
	`dü_image_width
(
image
->image);

204 
	`g_‰ì
(
ﬁd_fûe
);

206 
image
->
mtime
 = mtime;

208 
	`image_upd©e_d©a
(
image
);

209 
	}
}

211 
ªÆ


212 
	$image_di°™˚_‰om
(
Image
 *
image
, 
Poöt
 *
poöt
)

214 
EÀmít
 *
ñem
 = &
image
->
ñemít
;

215 
Re˘™gÀ
 
ª˘
;

217 
ª˘
.
À·
 = 
ñem
->
c‹√r
.
x
 - 
image
->
b‹dî_width
;

218 
ª˘
.
right
 = 
ñem
->
c‹√r
.
x
 +ÉÀm->
width
 + 
image
->
b‹dî_width
;

219 
ª˘
.
t›
 = 
ñem
->
c‹√r
.
y
 - 
image
->
b‹dî_width
;

220 
ª˘
.
bŸtom
 = 
ñem
->
c‹√r
.
y
 +ÉÀm->
height
 + 
image
->
b‹dî_width
;

221  
	`di°™˚_ª˘™gÀ_poöt
(&
ª˘
, 
poöt
);

222 
	}
}

225 
	$image_£À˘
(
Image
 *
image
, 
Poöt
 *
˛icked_poöt
,

226 
DüRídîî
 *
öãø˘ive_ªndîî
)

228 
	`ñemít_upd©e_h™dÀs
(&
image
->
ñemít
);

229 
	}
}

231 
Obje˘Ch™ge
*

232 
	$image_move_h™dÀ
(
Image
 *
image
, 
H™dÀ
 *
h™dÀ
,

233 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

234 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

236 
EÀmít
 *
ñem
 = &
image
->
ñemít
;

237 
	`as£π
(
image
!=
NULL
);

238 
	`as£π
(
h™dÀ
!=
NULL
);

239 
	`as£π
(
to
!=
NULL
);

241 i‡(
image
->
kìp_a•e˘
) {

242 
width
, 
height
;

243 
√w_width
, 
√w_height
;

244 
width
 = 
image
->
ñemít
.width;

245 
height
 = 
image
->
ñemít
.height;

247 
h™dÀ
->
id
) {

248 
HANDLE_RESIZE_NW
:

249 
√w_width
 = -(
to
->
x
-
image
->
ñemít
.
c‹√r
.x)+
width
;

250 
√w_height
 = -(
to
->
y
-
image
->
ñemít
.
c‹√r
.y)+
height
;

251 i‡(
√w_height
 =0 || 
√w_width
/√w_heighà> 
width
/
height
) {

252 
√w_height
 = 
√w_width
*
height
/
width
;

254 
√w_width
 = 
√w_height
*
width
/
height
;

256 
to
->
x
 = 
image
->
ñemít
.
c‹√r
.x+(image->ñemít.
width
-
√w_width
);

257 
to
->
y
 = 
image
->
ñemít
.
c‹√r
.y+(image->ñemít.
height
-
√w_height
);

258 
	`ñemít_move_h™dÀ
(
ñem
, 
HANDLE_RESIZE_NW
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

260 
HANDLE_RESIZE_N
:

261 
√w_width
 = (-(
to
->
y
-
image
->
ñemít
.
c‹√r
.y)+
height
)*
width
/height;

262 
to
->
x
 = 
image
->
ñemít
.
c‹√r
.x+
√w_width
;

263 
	`ñemít_move_h™dÀ
(
ñem
, 
HANDLE_RESIZE_NE
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

265 
HANDLE_RESIZE_NE
:

266 
√w_width
 = 
to
->
x
-
image
->
ñemít
.
c‹√r
.x;

267 
√w_height
 = -(
to
->
y
-
image
->
ñemít
.
c‹√r
.y)+
height
;

268 i‡(
√w_height
 =0 || 
√w_width
/√w_heighà> 
width
/
height
) {

269 
√w_height
 = 
√w_width
*
height
/
width
;

271 
√w_width
 = 
√w_height
*
width
/
height
;

273 
to
->
x
 = 
image
->
ñemít
.
c‹√r
.x+
√w_width
;

274 
to
->
y
 = 
image
->
ñemít
.
c‹√r
.y+(image->ñemít.
height
-
√w_height
);

275 
	`ñemít_move_h™dÀ
(
ñem
, 
HANDLE_RESIZE_NE
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

277 
HANDLE_RESIZE_E
:

278 
√w_height
 = (
to
->
x
-
image
->
ñemít
.
c‹√r
.x)*
height
/
width
;

279 
to
->
y
 = 
image
->
ñemít
.
c‹√r
.y+
√w_height
;

280 
	`ñemít_move_h™dÀ
(
ñem
, 
HANDLE_RESIZE_SE
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

282 
HANDLE_RESIZE_SE
:

283 
√w_width
 = 
to
->
x
-
image
->
ñemít
.
c‹√r
.x;

284 
√w_height
 = 
to
->
y
-
image
->
ñemít
.
c‹√r
.y;

285 i‡(
√w_height
 =0 || 
√w_width
/√w_heighà> 
width
/
height
) {

286 
√w_height
 = 
√w_width
*
height
/
width
;

288 
√w_width
 = 
√w_height
*
width
/
height
;

290 
to
->
x
 = 
image
->
ñemít
.
c‹√r
.x+
√w_width
;

291 
to
->
y
 = 
image
->
ñemít
.
c‹√r
.y+
√w_height
;

292 
	`ñemít_move_h™dÀ
(
ñem
, 
HANDLE_RESIZE_SE
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

294 
HANDLE_RESIZE_S
:

295 
√w_width
 = (
to
->
y
-
image
->
ñemít
.
c‹√r
.y)*
width
/
height
;

296 
to
->
x
 = 
image
->
ñemít
.
c‹√r
.x+
√w_width
;

297 
	`ñemít_move_h™dÀ
(
ñem
, 
HANDLE_RESIZE_SE
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

299 
HANDLE_RESIZE_SW
:

300 
√w_width
 = -(
to
->
x
-
image
->
ñemít
.
c‹√r
.x)+
width
;

301 
√w_height
 = 
to
->
y
-
image
->
ñemít
.
c‹√r
.y;

302 i‡(
√w_height
 =0 || 
√w_width
/√w_heighà> 
width
/
height
) {

303 
√w_height
 = 
√w_width
*
height
/
width
;

305 
√w_width
 = 
√w_height
*
width
/
height
;

307 
to
->
x
 = 
image
->
ñemít
.
c‹√r
.x+(image->ñemít.
width
-
√w_width
);

308 
to
->
y
 = 
image
->
ñemít
.
c‹√r
.y+
√w_height
;

309 
	`ñemít_move_h™dÀ
(
ñem
, 
HANDLE_RESIZE_SW
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

311 
HANDLE_RESIZE_W
:

312 
√w_height
 = (-(
to
->
x
-
image
->
ñemít
.
c‹√r
.x)+
width
)*
height
/width;

313 
to
->
y
 = 
image
->
ñemít
.
c‹√r
.y+
√w_height
;

314 
	`ñemít_move_h™dÀ
(
ñem
, 
HANDLE_RESIZE_SW
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

317 
	`mesßge_w¨nög
("Unforeseen handle in image_move_handle: %d\n",

318 
h™dÀ
->
id
);

322 
	`ñemít_move_h™dÀ
(
ñem
, 
h™dÀ
->
id
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

324 
	`image_upd©e_d©a
(
image
);

326  
NULL
;

327 
	}
}

329 
Obje˘Ch™ge
*

330 
	$image_move
(
Image
 *
image
, 
Poöt
 *
to
)

332 
image
->
ñemít
.
c‹√r
 = *
to
;

334 
	`image_upd©e_d©a
(
image
);

336  
NULL
;

337 
	}
}

340 
	$image_døw
(
Image
 *
image
, 
DüRídîî
 *
ªndîî
)

342 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

343 
Poöt
 
ul_c‹√r
, 
Ã_c‹√r
;

344 
EÀmít
 *
ñem
;

346 
	`as£π
(
image
 !
NULL
);

347 
	`as£π
(
ªndîî
 !
NULL
);

349 
ñem
 = &
image
->
ñemít
;

351 
Ã_c‹√r
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 + 
image
->
b‹dî_width
/2;

352 
Ã_c‹√r
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 + 
image
->
b‹dî_width
/2;

354 
ul_c‹√r
.
x
 = 
ñem
->
c‹√r
.x - 
image
->
b‹dî_width
/2;

355 
ul_c‹√r
.
y
 = 
ñem
->
c‹√r
.y - 
image
->
b‹dî_width
/2;

357 i‡(
image
->
døw_b‹dî
) {

358 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
image
->
b‹dî_width
);

359 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
image
->
löe_°yÀ
);

360 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
image
->
dashÀngth
);

361 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_MITER
);

363 
ªndîî_›s
->
	`døw_ª˘
(
ªndîî
,

364 &
ul_c‹√r
,

365 &
Ã_c‹√r
,

366 &
image
->
b‹dî_cﬁ‹
);

369 i‡(
image
->image) {

370 
ªndîî_›s
->
	`døw_image
(
ªndîî
, &
ñem
->
c‹√r
,ÉÀm->
width
,

371 
ñem
->
height
, 
image
->image);

373 
DüImage
 *
brokí
 = 
	`dü_image_gë_brokí
();

374 
ªndîî_›s
->
	`døw_image
(
ªndîî
, &
ñem
->
c‹√r
,ÉÀm->
width
,

375 
ñem
->
height
, 
brokí
);

376 
	`dü_image_uƒef
(
brokí
);

378 
	}
}

381 
	$image_upd©e_d©a
(
Image
 *
image
)

383 
EÀmít
 *
ñem
 = &
image
->
ñemít
;

384 
EÀmítBBExåas
 *
exåa
 = &
ñem
->
exåa_•acög
;

385 
DüObje˘
 *
obj
 = &
ñem
->
obje˘
;

388 
image
->
c⁄√˘i⁄s
[0].
pos
 = 
ñem
->
c‹√r
;

389 
image
->
c⁄√˘i⁄s
[1].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

390 
image
->
c⁄√˘i⁄s
[1].
pos
.
y
 = 
ñem
->
c‹√r
.y;

391 
image
->
c⁄√˘i⁄s
[2].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

392 
image
->
c⁄√˘i⁄s
[2].
pos
.
y
 = 
ñem
->
c‹√r
.y;

393 
image
->
c⁄√˘i⁄s
[3].
pos
.
x
 = 
ñem
->
c‹√r
.x;

394 
image
->
c⁄√˘i⁄s
[3].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

395 
image
->
c⁄√˘i⁄s
[4].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

396 
image
->
c⁄√˘i⁄s
[4].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

397 
image
->
c⁄√˘i⁄s
[5].
pos
.
x
 = 
ñem
->
c‹√r
.x;

398 
image
->
c⁄√˘i⁄s
[5].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

399 
image
->
c⁄√˘i⁄s
[6].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

400 
image
->
c⁄√˘i⁄s
[6].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

401 
image
->
c⁄√˘i⁄s
[7].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
;

402 
image
->
c⁄√˘i⁄s
[7].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
;

403 
image
->
c⁄√˘i⁄s
[8].
pos
.
x
 = 
ñem
->
c‹√r
.x +ÉÀm->
width
 / 2.0;

404 
image
->
c⁄√˘i⁄s
[8].
pos
.
y
 = 
ñem
->
c‹√r
.y +ÉÀm->
height
 / 2.0;

406 
exåa
->
b‹dî_å™s
 = 
image
->
b‹dî_width
 / 2.0;

407 
	`ñemít_upd©e_boundögbox
(
ñem
);

409 
obj
->
posôi⁄
 = 
ñem
->
c‹√r
;

410 
image
->
c⁄√˘i⁄s
[8].
dúe˘i⁄s
 = 
DIR_ALL
;

411 
	`ñemít_upd©e_h™dÀs
(
ñem
);

412 
	}
}

415 
DüObje˘
 *

416 
	$image_¸óã
(
Poöt
 *
°¨çoöt
,

417 *
u£r_d©a
,

418 
H™dÀ
 **
h™dÀ1
,

419 
H™dÀ
 **
h™dÀ2
)

421 
Image
 *
image
;

422 
EÀmít
 *
ñem
;

423 
DüObje˘
 *
obj
;

424 
i
;

426 
image
 = 
	`g_mÆloc0
((
Image
));

427 
ñem
 = &
image
->
ñemít
;

428 
obj
 = &
ñem
->
obje˘
;

430 
obj
->
ty≥
 = &
image_ty≥
;

431 
obj
->
›s
 = &
image_›s
;

433 
ñem
->
c‹√r
 = *
°¨çoöt
;

434 
ñem
->
width
 = 
DEFAULT_WIDTH
;

435 
ñem
->
height
 = 
DEFAULT_HEIGHT
;

437 
image
->
b‹dî_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

438 
image
->
b‹dî_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

439 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
image
->
löe_°yÀ
,

440 &
image
->
dashÀngth
);

442 
	`ñemít_öô
(
ñem
, 8, 
NUM_CONNECTIONS
);

444 
i
=0; i<
NUM_CONNECTIONS
; i++) {

445 
obj
->
c⁄√˘i⁄s
[
i
] = &
image
->connections[i];

446 
image
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

447 
image
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

449 
image
->
c⁄√˘i⁄s
[8].
Êags
 = 
CP_FLAGS_MAIN
;

451 i‡(
	`°rcmp
(
deÁu…_¥›îtõs
.
fûe
, "")) {

452 
image
->
fûe
 = 
	`g_°rdup
(
deÁu…_¥›îtõs
.file);

453 
image
->imagê
	`dü_image_lﬂd
(image->
fûe
);

455 i‡(
image
->image) {

456 
ñem
->
width
 = (ñem->width*()
	`dü_image_width
(
image
->image))/

457 ()
	`dü_image_height
(
image
->image);

460 
image
->
fûe
 = 
	`g_°rdup
("");

461 
image
->imagê
NULL
;

464 
image
->
døw_b‹dî
 = 
deÁu…_¥›îtõs
.draw_border;

465 
image
->
kìp_a•e˘
 = 
deÁu…_¥›îtõs
.keep_aspect;

467 
	`image_upd©e_d©a
(
image
);

469 *
h™dÀ1
 = 
NULL
;

470 *
h™dÀ2
 = 
obj
->
h™dÀs
[7];

471  &
image
->
ñemít
.
obje˘
;

472 
	}
}

475 
	$image_de°roy
(
Image
 *
image
) {

476 i‡(
image
->
fûe
 !
NULL
)

477 
	`g_‰ì
(
image
->
fûe
);

479 i‡(
image
->imagê!
NULL
)

480 
	`dü_image_uƒef
(
image
->image);

482 
	`ñemít_de°roy
(&
image
->
ñemít
);

483 
	}
}

485 
DüObje˘
 *

486 
	$image_c›y
(
Image
 *
image
)

488 
i
;

489 
Image
 *
√wimage
;

490 
EÀmít
 *
ñem
, *
√wñem
;

491 
DüObje˘
 *
√wobj
;

493 
ñem
 = &
image
->
ñemít
;

495 
√wimage
 = 
	`g_mÆloc0
((
Image
));

496 
√wñem
 = &
√wimage
->
ñemít
;

497 
√wobj
 = &
√wñem
->
obje˘
;

499 
	`ñemít_c›y
(
ñem
, 
√wñem
);

501 
√wimage
->
b‹dî_width
 = 
image
->border_width;

502 
√wimage
->
b‹dî_cﬁ‹
 = 
image
->border_color;

503 
√wimage
->
löe_°yÀ
 = 
image
->line_style;

505 
i
=0;i<
NUM_CONNECTIONS
;i++) {

506 
√wobj
->
c⁄√˘i⁄s
[
i
] = &
√wimage
->connections[i];

507 
√wimage
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
√wobj
;

508 
√wimage
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

509 
√wimage
->
c⁄√˘i⁄s
[
i
].
pos
 = 
image
->connections[i].pos;

510 
√wimage
->
c⁄√˘i⁄s
[
i
].
œ°_pos
 = 
image
->connections[i].last_pos;

511 
√wimage
->
c⁄√˘i⁄s
[
i
].
Êags
 = 
image
->connections[i].flags;

514 
√wimage
->
fûe
 = 
	`g_°rdup
(
image
->file);

515 i‡(
image
->image)

516 
	`dü_image_add_ªf
(
image
->image);

517 
√wimage
->
image
 = image->image;

519 
√wimage
->
døw_b‹dî
 = 
image
->draw_border;

520 
√wimage
->
kìp_a•e˘
 = 
image
->keep_aspect;

522  &
√wimage
->
ñemít
.
obje˘
;

523 
	}
}

533 
	$gë_dúe˘‹y
(c⁄° *
fûíame
)

535 *
cwd
;

536 *
dúe˘‹y
;

537 *
dú«me
;

539 i‡(
fûíame
==
NULL
)

540  
NULL
;

542 
dú«me
 = 
	`g_∑th_gë_dú«me
(
fûíame
);

543 i‡(
	`g_∑th_is_absﬁuã
(
dú«me
)) {

544 
dúe˘‹y
 = 
	`g_buûd_∑th
(
G_DIR_SEPARATOR_S
, 
dú«me
, 
NULL
);

546 
cwd
 = 
	`g_gë_cuºít_dú
();

547 
dúe˘‹y
 = 
	`g_buûd_∑th
(
G_DIR_SEPARATOR_S
, 
cwd
, 
dú«me
, 
NULL
);

548 
	`g_‰ì
(
cwd
);

550 
	`g_‰ì
(
dú«me
);

552  
dúe˘‹y
;

553 
	}
}

556 
	$image_ßve
(
Image
 *
image
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
)

558 *
düfûe_dú
;

560 
	`ñemít_ßve
(&
image
->
ñemít
, 
obj_node
);

562 i‡(
image
->
b‹dî_width
 != 0.1)

563 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "border_width"),

564 
image
->
b‹dî_width
);

566 i‡(!
	`cﬁ‹_equÆs
(&
image
->
b‹dî_cﬁ‹
, &
cﬁ‹_bœck
))

567 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "border_color"),

568 &
image
->
b‹dî_cﬁ‹
);

570 i‡(
image
->
löe_°yÀ
 !
LINESTYLE_SOLID
)

571 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

572 
image
->
löe_°yÀ
);

574 i‡(
image
->
löe_°yÀ
 !
LINESTYLE_SOLID
 &&

575 
image
->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

576 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

577 
image
->
dashÀngth
);

579 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "døw_b‹dî"), 
image
->
døw_b‹dî
);

580 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "kìp_a•e˘"), 
image
->
kìp_a•e˘
);

582 i‡(
image
->
fûe
 !
NULL
) {

583 i‡(
	`g_∑th_is_absﬁuã
(
image
->
fûe
)) {

584 
düfûe_dú
 = 
	`gë_dúe˘‹y
(
fûíame
);

586 i‡(
	`°∫cmp
(
düfûe_dú
, 
image
->
fûe
, 
	`°æí
(diafile_dir))==0) {

589 
	`d©a_add_fûíame
(
	`√w_©åibuã
(
obj_node
, "fûe"), 
image
->
fûe
 + 
	`°æí
(
düfûe_dú
) + 1);

592 
	`d©a_add_fûíame
(
	`√w_©åibuã
(
obj_node
, "fûe"), 
image
->
fûe
);

595 
	`g_‰ì
(
düfûe_dú
);

600 
	`d©a_add_fûíame
(
	`√w_©åibuã
(
obj_node
, "fûe"), 
image
->
fûe
);

604 
	}
}

606 
DüObje˘
 *

607 
	$image_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

609 
Image
 *
image
;

610 
EÀmít
 *
ñem
;

611 
DüObje˘
 *
obj
;

612 
i
;

613 
AâribuãNode
 
©å
;

614 *
düfûe_dú
;

616 
image
 = 
	`g_mÆloc0
((
Image
));

617 
ñem
 = &
image
->
ñemít
;

618 
obj
 = &
ñem
->
obje˘
;

620 
obj
->
ty≥
 = &
image_ty≥
;

621 
obj
->
›s
 = &
image_›s
;

623 
	`ñemít_lﬂd
(
ñem
, 
obj_node
);

625 
image
->
b‹dî_width
 = 0.1;

626 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "border_width");

627 i‡(
©å
 !
NULL
)

628 
image
->
b‹dî_width
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

630 
image
->
b‹dî_cﬁ‹
 = 
cﬁ‹_bœck
;

631 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "border_color");

632 i‡(
©å
 !
NULL
)

633 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
image
->
b‹dî_cﬁ‹
);

635 
image
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

636 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

637 i‡(
©å
 !
NULL
)

638 
image
->
löe_°yÀ
 = 
	`d©a_íum
–
	`©åibuã_fú°_d©a
(
©å
) );

640 
image
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

641 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

642 i‡(
©å
 !
NULL
)

643 
image
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

645 
image
->
døw_b‹dî
 = 
TRUE
;

646 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "draw_border");

647 i‡(
©å
 !
NULL
)

648 
image
->
døw_b‹dî
 = 
	`d©a_boﬁón
–
	`©åibuã_fú°_d©a
(
©å
) );

650 
image
->
kìp_a•e˘
 = 
TRUE
;

651 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "keep_aspect");

652 i‡(
©å
 !
NULL
)

653 
image
->
kìp_a•e˘
 = 
	`d©a_boﬁón
–
	`©åibuã_fú°_d©a
(
©å
) );

655 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "file");

656 i‡(
©å
 !
NULL
) {

657 
image
->
fûe
 = 
	`d©a_fûíame
–
	`©åibuã_fú°_d©a
(
©å
) );

659 
image
->
fûe
 = 
	`g_°rdup
("");

662 
	`ñemít_öô
(
ñem
, 8, 
NUM_CONNECTIONS
);

664 
i
=0;i<
NUM_CONNECTIONS
;i++) {

665 
obj
->
c⁄√˘i⁄s
[
i
] = &
image
->connections[i];

666 
image
->
c⁄√˘i⁄s
[
i
].
obje˘
 = 
obj
;

667 
image
->
c⁄√˘i⁄s
[
i
].
c⁄√˘ed
 = 
NULL
;

669 
image
->
c⁄√˘i⁄s
[8].
Êags
 = 
CP_FLAGS_MAIN
;

671 
image
->imagê
NULL
;

673 i‡(
	`°rcmp
(
image
->
fûe
, "")!=0) {

674 
düfûe_dú
 = 
	`gë_dúe˘‹y
(
fûíame
);

676 i‡(
	`g_∑th_is_absﬁuã
(
image
->
fûe
)) {

677 
image
->imagê
	`dü_image_lﬂd
(image->
fûe
);

678 i‡(
image
->imagê=
NULL
) {

680 *
ãmp_°rög
;

681 c⁄° *
image_fûe_«me
 = 
image
->
fûe
;

682 c⁄° *
p£p
;

684 
p£p
 = 
	`°ºchr
(
image
->
fûe
, 
G_DIR_SEPARATOR
);

686 i‡(!
p£p
)

687 
p£p
 = 
	`°ºchr
(
image
->
fûe
, 
G_DIR_SEPARATOR
 == '/' ? '\\' : '/');

688 i‡(
p£p
)

689 
image_fûe_«me
 = 
p£p
 + 1;

691 
ãmp_°rög
 = 
	`g_buûd_fûíame
(
düfûe_dú
, 
image_fûe_«me
, 
NULL
);

693 
image
->imagê
	`dü_image_lﬂd
(
ãmp_°rög
);

695 i‡(
image
->imagê!
NULL
) {

697 
	`mesßge_w¨nög
(
	`_
("The image file '%s' wasÇot found inÅhat directory.\n"

698 "UsögÅhêfûê'%s' in°ód\n"), 
image
->
fûe
, 
ãmp_°rög
);

699 
	`g_‰ì
(
image
->
fûe
);

700 
image
->
fûe
 = 
ãmp_°rög
;

702 
	`g_‰ì
(
ãmp_°rög
);

704 
image
->imagê
	`dü_image_lﬂd
((*)
image_fûe_«me
);

705 i‡(
image
->imagê!
NULL
) {

706 *
tmp
;

708 
	`mesßge_w¨nög
(
	`_
("The image file '%s' wasÇot found inÅhat directory.\n"

709 "UsögÅhêfûê'%s' in°ód\n"), 
image
->
fûe
, 
image_fûe_«me
);

710 
tmp
 = 
image
->
fûe
;

711 
image
->
fûe
 = 
	`g_°rdup
(
image_fûe_«me
);

712 
	`g_‰ì
(
tmp
);

714 
	`mesßge_w¨nög
(
	`_
("The image file '%s' wasÇot found.\n"),

715 
image_fûe_«me
);

720 *
ãmp_°rög
;

722 
ãmp_°rög
 = 
	`g_buûd_fûíame
 (
düfûe_dú
, 
image
->
fûe
, 
NULL
);

724 
image
->imagê
	`dü_image_lﬂd
(
ãmp_°rög
);

726 i‡(
image
->imagê!
NULL
) {

728 
	`g_‰ì
(
image
->
fûe
);

729 
image
->
fûe
 = 
ãmp_°rög
;

731 
	`g_‰ì
(
ãmp_°rög
);

733 
image
->imagê
	`dü_image_lﬂd
(image->
fûe
);

734 i‡(
image
->imagê=
NULL
) {

736 
	`mesßge_w¨nög
(
	`_
("The image file '%s' wasÇot found.\n"),

737 
image
->
fûe
);

741 
	`g_‰ì
(
düfûe_dú
);

746 
°©
 
°
;

747 i‡(
	`g_°©
 (
image
->
fûe
, &
°
) != 0)

748 
°
.
°_mtime
 = 0;

750 
image
->
mtime
 = 
°
.
°_mtime
;

752 
	`image_upd©e_d©a
(
image
);

754  &
image
->
ñemít
.
obje˘
;

755 
	}
}

	@O:\tool\dvs50\objects\standard\line.c

20 #ifde‡
HAVE_CONFIG_H


21 
	~<c⁄fig.h
>

24 
	~<as£π.h
>

25 
	~<m©h.h
>

27 
	~"öé.h
"

28 
	~"obje˘.h
"

29 
	~"c⁄√˘i⁄.h
"

30 
	~"c⁄√˘i⁄poöt.h
"

31 
	~"düªndîî.h
"

32 
	~"©åibuãs.h
"

33 
	~"widgës.h
"

34 
	~"¨rows.h
"

35 
	~"c⁄≈oöt_löe.h
"

36 
	~"¥›îtõs.h
"

38 
	~"toﬁ-ic⁄s.h
"

40 
	#DEFAULT_WIDTH
 0.25

	)

42 
_LöePr›îtõs
 
	tLöePr›îtõs
;

44 
	s_Löe
 {

45 
C⁄√˘i⁄
 
	mc⁄√˘i⁄
;

47 
C⁄nPoötLöe
 *
	m˝l
;

49 
Cﬁ‹
 
	mlöe_cﬁ‹
;

50 
ªÆ
 
	mlöe_width
;

51 
LöeStyÀ
 
	mlöe_°yÀ
;

52 
Aºow
 
	m°¨t_¨row
, 
	míd_¨row
;

53 
ªÆ
 
	mdashÀngth
;

54 
ªÆ
 
	mabsﬁuã_°¨t_g≠
, 
	mabsﬁuã_íd_g≠
;

55 } 
	tLöe
;

57 
	s_LöePr›îtõs
 {

58 
ªÆ
 
	mabsﬁuã_°¨t_g≠
, 
	mabsﬁuã_íd_g≠
;

61 
LöePr›îtõs
 
	gdeÁu…_¥›îtõs
;

63 
Obje˘Ch™ge
* 
löe_move_h™dÀ
(
Löe
 *
löe
, 
H™dÀ
 *
h™dÀ
,

64 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

65 
H™dÀMoveRós⁄
 
ªas⁄
,

66 
ModifõrKeys
 
modifõrs
);

67 
Obje˘Ch™ge
* 
löe_move
(
Löe
 *
löe
, 
Poöt
 *
to
);

68 
löe_£À˘
(
Löe
 *
löe
, 
Poöt
 *
˛icked_poöt
,

69 
DüRídîî
 *
öãø˘ive_ªndîî
);

70 
löe_døw
(
Löe
 *
löe
, 
DüRídîî
 *
ªndîî
);

71 
DüObje˘
 *
löe_¸óã
(
Poöt
 *
°¨çoöt
,

72 *
u£r_d©a
,

73 
H™dÀ
 **
h™dÀ1
,

74 
H™dÀ
 **
h™dÀ2
);

75 
ªÆ
 
löe_di°™˚_‰om
(
Löe
 *
löe
, 
Poöt
 *
poöt
);

76 
löe_upd©e_d©a
(
Löe
 *
löe
);

77 
löe_de°roy
(
Löe
 *
löe
);

78 
DüObje˘
 *
löe_c›y
(
Löe
 *
löe
);

80 
Pr›Des¸ùti⁄
 *
löe_des¸ibe_¥›s
(
Löe
 *
löe
);

81 
löe_gë_¥›s
(
Löe
 *
löe
, 
GPåAºay
 *
¥›s
);

82 
löe_£t_¥›s
(
Löe
 *
löe
, 
GPåAºay
 *
¥›s
);

84 
löe_ßve
(
Löe
 *
löe
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
);

85 
DüObje˘
 *
löe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
);

86 
DüMíu
 *
löe_gë_obje˘_míu
(
Löe
 *
löe
, 
Poöt
 *
˛ickedpoöt
);

88 
Löe_adju°_f‹_absﬁuã_g≠
(
Löe
 *
löe
, 
Poöt
 *
g≠_ídpoöts
);

90 
Obje˘Ty≥Ops
 
	glöe_ty≥_›s
 =

92 (
Cª©eFunc
Ë
löe_¸óã
,

93 (
LﬂdFunc
Ë
löe_lﬂd
,

94 (
SaveFunc
Ë
löe_ßve
,

95 (
GëDeÁu…sFunc
Ë
NULL
,

96 (
AµlyDeÁu…sFunc
Ë
NULL


99 
DüObje˘Ty≥
 
	glöe_ty≥
 =

103 (**Ë
löe_ic⁄
,

104 &
löe_ty≥_›s


107 
DüObje˘Ty≥
 *
	g_löe_ty≥
 = (DüObje˘Ty≥ *Ë&
löe_ty≥
;

109 
Obje˘Ops
 
	glöe_›s
 = {

110 (
De°royFunc
Ë
löe_de°roy
,

111 (
DøwFunc
Ë
löe_døw
,

112 (
Di°™˚Func
Ë
löe_di°™˚_‰om
,

113 (
Sñe˘Func
Ë
löe_£À˘
,

114 (
C›yFunc
Ë
löe_c›y
,

115 (
MoveFunc
Ë
löe_move
,

116 (
MoveH™dÀFunc
Ë
löe_move_h™dÀ
,

117 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

118 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

119 (
Obje˘MíuFunc
Ë
löe_gë_obje˘_míu
,

120 (
Des¸ibePr›sFunc
Ë
löe_des¸ibe_¥›s
,

121 (
GëPr›sFunc
Ë
löe_gë_¥›s
,

122 (
SëPr›sFunc
Ë
löe_£t_¥›s
,

123 (
TextEdôFunc
) 0,

124 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

127 
Pr›NumD©a
 
	gg≠_ønge
 = { -
G_MAXFLOAT
, G_MAXFLOAT, 0.1};

129 
Pr›Des¸ùti⁄
 
	glöe_¥›s
[] = {

130 
OBJECT_COMMON_PROPERTIES
,

131 
PROP_STD_LINE_WIDTH
,

132 
PROP_STD_LINE_COLOUR
,

133 
PROP_STD_LINE_STYLE
,

134 
PROP_FRAME_BEGIN
("¨rows",
PROP_FLAG_STANDARD
,
N_
("Arrows")),

135 
PROP_STD_START_ARROW
,

136 
PROP_STD_END_ARROW
,

137 
PROP_FRAME_END
("¨rows",
PROP_FLAG_STANDARD
),

138 { "°¨t_poöt", 
PROP_TYPE_POINT
, 0,

139 
N_
("SèπÖoöt"), 
NULL
 },

140 { "íd_poöt", 
PROP_TYPE_POINT
, 0,

141 
N_
("EndÖoöt"), 
NULL
 },

143 
PROP_FRAME_BEGIN
("g≠s",0,
N_
("Line gaps")),

144 { "absﬁuã_°¨t_g≠", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

145 
N_
("Absﬁuã sèπ g≠"), 
NULL
, &
g≠_ønge
 },

146 { "absﬁuã_íd_g≠", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

147 
N_
("AbsﬁuãÉnd g≠"), 
NULL
, &
g≠_ønge
 },

148 
PROP_FRAME_END
("gaps",0),

150 
PROP_DESC_END


153 
Pr›Des¸ùti⁄
 *

154 
	$löe_des¸ibe_¥›s
(
Löe
 *
löe
)

156 i‡(
löe_¥›s
[0].
qu¨k
 == 0)

157 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
löe_¥›s
);

158  
löe_¥›s
;

159 
	}
}

161 
Pr›Off£t
 
	glöe_off£ts
[] = {

162 
OBJECT_COMMON_PROPERTIES_OFFSETS
,

163 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Löe
, 
löe_width
) },

164 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Löe
, 
löe_cﬁ‹
) },

165 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

166 
off£tof
(
Löe
, 
löe_°yÀ
), off£tof(Löe, 
dashÀngth
) },

167 { "°¨t_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Löe
, 
°¨t_¨row
) },

168 { "íd_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Löe
, 
íd_¨row
) },

169 { "°¨t_poöt", 
PROP_TYPE_POINT
, 
off£tof
(
C⁄√˘i⁄
, 
ídpoöts
[0]) },

170 { "íd_poöt", 
PROP_TYPE_POINT
, 
off£tof
(
C⁄√˘i⁄
, 
ídpoöts
[1]) },

171 
PROP_OFFSET_FRAME_BEGIN
("gaps"),

172 { "absﬁuã_°¨t_g≠", 
PROP_TYPE_REAL
, 
off£tof
(
Löe
, 
absﬁuã_°¨t_g≠
) },

173 { "absﬁuã_íd_g≠", 
PROP_TYPE_REAL
, 
off£tof
(
Löe
, 
absﬁuã_íd_g≠
) },

174 
PROP_OFFSET_FRAME_END
("gaps"),

175 { 
NULL
, 0, 0 }

179 
	$löe_gë_¥›s
(
Löe
 *
löe
, 
GPåAºay
 *
¥›s
)

181 
	`obje˘_gë_¥›s_‰om_off£ts
(&
löe
->
c⁄√˘i⁄
.
obje˘
,

182 
löe_off£ts
, 
¥›s
);

183 
	}
}

186 
	$löe_£t_¥›s
(
Löe
 *
löe
, 
GPåAºay
 *
¥›s
)

188 
	`obje˘_£t_¥›s_‰om_off£ts
(&
löe
->
c⁄√˘i⁄
.
obje˘
,

189 
löe_off£ts
, 
¥›s
);

190 
	`löe_upd©e_d©a
(
löe
);

191 
	}
}

194 
	$löe_öô_deÁu…s
() {

195 
deÁu…s_öôülized
 = 0;

197 i‡(!
deÁu…s_öôülized
) {

198 
deÁu…_¥›îtõs
.
absﬁuã_°¨t_g≠
 = 0.0;

199 
deÁu…_¥›îtõs
.
absﬁuã_íd_g≠
 = 0.0;

200 
deÁu…s_öôülized
 = 1;

202 
	}
}

204 
Obje˘Ch™ge
 *

205 
	$löe_add_c⁄≈oöt_ˇŒback
(
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

207 
Obje˘Ch™ge
 *
oc
;

208 
oc
 = 
	`c⁄≈oöéöe_add_poöt
(((
Löe
 *)
obj
)->
˝l
,
˛icked
);

209 
	`löe_upd©e_d©a
((
Löe
 *)
obj
);

210  
oc
;

211 
	}
}

213 
Obje˘Ch™ge
 *

214 
	$löe_ªmove_c⁄≈oöt_ˇŒback
(
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

216 
Obje˘Ch™ge
 *
oc
;

217 
oc
 = 
	`c⁄≈oöéöe_ªmove_poöt
(((
Löe
 *)
obj
)->
˝l
,
˛icked
);

218 
	`löe_upd©e_d©a
((
Löe
 *)
obj
);

219  
oc
;

220 
	}
}

222 
DüMíuIãm
 
	gobje˘_míu_ôems
[] = {

223 { 
N_
("Add c⁄√˘i⁄Öoöt"), 
löe_add_c⁄≈oöt_ˇŒback
, 
NULL
, 1 },

224 { 
N_
("Dñëêc⁄√˘i⁄Öoöt"), 
löe_ªmove_c⁄≈oöt_ˇŒback
,

225 
NULL
, 1 },

228 
DüMíu
 
	gobje˘_míu
 = {

229 
N_
("Line"),

230 (
obje˘_míu_ôems
)/(
DüMíuIãm
),

231 
obje˘_míu_ôems
,

232 
NULL


235 
DüMíu
 *

236 
	$löe_gë_obje˘_míu
(
Löe
 *
löe
, 
Poöt
 *
˛ickedpoöt
)

238 
C⁄nPoötLöe
 *
˝l
;

240 
˝l
 = 
löe
->cpl;

242 
obje˘_míu_ôems
[0].
a˘ive
 =

243 
	`c⁄≈oöéöe_ˇn_add_poöt
(
˝l
, 
˛ickedpoöt
);

244 
obje˘_míu_ôems
[1].
a˘ive
 =

245 
	`c⁄≈oöéöe_ˇn_ªmove_poöt
(
˝l
,
˛ickedpoöt
);

246  &
obje˘_míu
;

247 
	}
}

256 
	$löe_adju°_f‹_absﬁuã_g≠
(
Löe
 *
löe
, 
Poöt
 *
g≠_ídpoöts
)

258 
Poöt
 
ídpoöts
[2];

259 
ªÆ
 
löe_Àngth
;

261 
ídpoöts
[0] = 
löe
->
c⁄√˘i⁄
.endpoints[0];

262 
ídpoöts
[1] = 
löe
->
c⁄√˘i⁄
.endpoints[1];

264 
löe_Àngth
 = 
	`di°™˚_poöt_poöt
(&
ídpoöts
[0], &endpoints[1]);

267 
	`poöt_c⁄vex
(&
g≠_ídpoöts
[0], &
ídpoöts
[0], &endpoints[1],

268 1 - 
löe
->
absﬁuã_°¨t_g≠
/
löe_Àngth
);

271 
	`poöt_c⁄vex
(&
g≠_ídpoöts
[1], &
ídpoöts
[1], &endpoints[0],

272 1 - 
löe
->
absﬁuã_íd_g≠
/
löe_Àngth
);

273 
	}
}

275 
ªÆ


276 
	$löe_di°™˚_‰om
(
Löe
 *
löe
, 
Poöt
 *
poöt
)

278 
Poöt
 *
ídpoöts
;

280 
ídpoöts
 = &
löe
->
c⁄√˘i⁄
.endpoints[0];

282 i‡(
löe
->
absﬁuã_°¨t_g≠
 ||Üöe->
absﬁuã_íd_g≠
 ) {

283 
Poöt
 
g≠_ídpoöts
[2];

285 
	`löe_adju°_f‹_absﬁuã_g≠
(
löe
, 
g≠_ídpoöts
);

286  
	`di°™˚_löe_poöt
–&
g≠_ídpoöts
[0], &gap_endpoints[1],

287 
löe
->
löe_width
, 
poöt
);

289  
	`di°™˚_löe_poöt
–&
ídpoöts
[0], &endpoints[1],

290 
löe
->
löe_width
, 
poöt
);

292 
	}
}

295 
	$löe_£À˘
(
Löe
 *
löe
, 
Poöt
 *
˛icked_poöt
,

296 
DüRídîî
 *
öãø˘ive_ªndîî
)

298 
	`c⁄√˘i⁄_upd©e_h™dÀs
(&
löe
->
c⁄√˘i⁄
);

299 
	}
}

301 
Obje˘Ch™ge
*

302 
	$löe_move_h™dÀ
(
Löe
 *
löe
, 
H™dÀ
 *
h™dÀ
,

303 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

304 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

306 
	`as£π
(
löe
!=
NULL
);

307 
	`as£π
(
h™dÀ
!=
NULL
);

308 
	`as£π
(
to
!=
NULL
);

310 
	`c⁄√˘i⁄_move_h™dÀ
(&
löe
->
c⁄√˘i⁄
, 
h™dÀ
->
id
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

312 
	`löe_upd©e_d©a
(
löe
);

314  
NULL
;

315 
	}
}

317 
Obje˘Ch™ge
*

318 
	$löe_move
(
Löe
 *
löe
, 
Poöt
 *
to
)

320 
Poöt
 
°¨t_to_íd
;

321 
Poöt
 *
ídpoöts
 = &
löe
->
c⁄√˘i⁄
.endpoints[0];

323 
°¨t_to_íd
 = 
ídpoöts
[1];

324 
	`poöt_sub
(&
°¨t_to_íd
, &
ídpoöts
[0]);

326 
ídpoöts
[1] =Éndpoöts[0] = *
to
;

327 
	`poöt_add
(&
ídpoöts
[1], &
°¨t_to_íd
);

329 
	`löe_upd©e_d©a
(
löe
);

331  
NULL
;

332 
	}
}

335 
	$löe_døw
(
Löe
 *
löe
, 
DüRídîî
 *
ªndîî
)

337 
Poöt
 
g≠_ídpoöts
[2];

339 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

341 
	`as£π
(
löe
 !
NULL
);

342 
	`as£π
(
ªndîî
 !
NULL
);

344 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
löe
->
löe_width
);

345 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
löe
->
löe_°yÀ
);

346 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
löe
->
dashÀngth
);

347 
ªndîî_›s
->
	`£t_löeˇps
(
ªndîî
, 
LINECAPS_BUTT
);

349 i‡(
löe
->
absﬁuã_°¨t_g≠
 ||Üöe->
absﬁuã_íd_g≠
 ) {

350 
	`löe_adju°_f‹_absﬁuã_g≠
(
löe
, 
g≠_ídpoöts
);

352 
ªndîî_›s
->
	`døw_löe_wôh_¨rows
(
ªndîî
,

353 &
g≠_ídpoöts
[0], &gap_endpoints[1],

354 
löe
->
löe_width
,

355 &
löe
->
löe_cﬁ‹
,

356 &
löe
->
°¨t_¨row
,

357 &
löe
->
íd_¨row
);

359 
ªndîî_›s
->
	`døw_löe_wôh_¨rows
(
ªndîî
,

360 &
löe
->
c⁄√˘i⁄
.
ídpoöts
[0],

361 &
löe
->
c⁄√˘i⁄
.
ídpoöts
[1],

362 
löe
->
löe_width
,

363 &
löe
->
löe_cﬁ‹
,

364 &
löe
->
°¨t_¨row
,

365 &
löe
->
íd_¨row
);

368 
	}
}

370 
DüObje˘
 *

371 
	$löe_¸óã
(
Poöt
 *
°¨çoöt
,

372 *
u£r_d©a
,

373 
H™dÀ
 **
h™dÀ1
,

374 
H™dÀ
 **
h™dÀ2
)

376 
Löe
 *
löe
;

377 
C⁄√˘i⁄
 *
c⁄n
;

378 
DüObje˘
 *
obj
;

379 
Poöt
 
deÁu…Àn
 = { 1.0, 1.0 };

381 
	`löe_öô_deÁu…s
();

383 
löe
 = 
	`g_mÆloc0
((
Löe
));

385 
löe
->
löe_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

386 
löe
->
löe_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

387 
löe
->
absﬁuã_°¨t_g≠
 = 
deÁu…_¥›îtõs
.absolute_start_gap;

388 
löe
->
absﬁuã_íd_g≠
 = 
deÁu…_¥›îtõs
.absolute_end_gap;

390 
c⁄n
 = &
löe
->
c⁄√˘i⁄
;

391 
c⁄n
->
ídpoöts
[0] = *
°¨çoöt
;

392 
c⁄n
->
ídpoöts
[1] = *
°¨çoöt
;

393 
	`poöt_add
(&
c⁄n
->
ídpoöts
[1], &
deÁu…Àn
);

395 
obj
 = &
c⁄n
->
obje˘
;

397 
obj
->
ty≥
 = &
löe_ty≥
;

398 
obj
->
›s
 = &
löe_›s
;

400 
	`c⁄√˘i⁄_öô
(
c⁄n
, 2, 0);

402 
löe
->
˝l
 = 
	`c⁄≈oöéöe_¸óã
(
obj
,1);

404 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
löe
->
löe_°yÀ
, &löe->
dashÀngth
);

405 
löe
->
°¨t_¨row
 = 
	`©åibuãs_gë_deÁu…_°¨t_¨row
();

406 
löe
->
íd_¨row
 = 
	`©åibuãs_gë_deÁu…_íd_¨row
();

407 
	`löe_upd©e_d©a
(
löe
);

409 *
h™dÀ1
 = 
obj
->
h™dÀs
[0];

410 *
h™dÀ2
 = 
obj
->
h™dÀs
[1];

411  &
löe
->
c⁄√˘i⁄
.
obje˘
;

412 
	}
}

415 
	$löe_de°roy
(
Löe
 *
löe
)

417 
	`c⁄≈oöéöe_de°roy
(
löe
->
˝l
);

418 
	`c⁄√˘i⁄_de°roy
(&
löe
->
c⁄√˘i⁄
);

419 
	}
}

421 
DüObje˘
 *

422 
	$löe_c›y
(
Löe
 *
löe
)

424 
Löe
 *
√wlöe
;

425 
C⁄√˘i⁄
 *
c⁄n
, *
√wc⁄n
;

426 
DüObje˘
 *
√wobj
;

427 
rcc
 = 0;

429 
c⁄n
 = &
löe
->
c⁄√˘i⁄
;

431 
√wlöe
 = 
	`g_mÆloc0
((
Löe
));

432 
√wc⁄n
 = &
√wlöe
->
c⁄√˘i⁄
;

433 
√wobj
 = &
√wc⁄n
->
obje˘
;

435 
	`c⁄√˘i⁄_c›y
(
c⁄n
, 
√wc⁄n
);

437 
√wlöe
->
˝l
 = 
	`c⁄≈oöéöe_c›y
(
√wobj
,
löe
->˝l,&
rcc
);

439 
√wlöe
->
löe_cﬁ‹
 = 
löe
->line_color;

440 
√wlöe
->
löe_width
 = 
löe
->line_width;

441 
√wlöe
->
löe_°yÀ
 = 
löe
->line_style;

442 
√wlöe
->
dashÀngth
 = 
löe
->dashlength;

443 
√wlöe
->
°¨t_¨row
 = 
löe
->start_arrow;

444 
√wlöe
->
íd_¨row
 = 
löe
->end_arrow;

445 
√wlöe
->
absﬁuã_°¨t_g≠
 = 
löe
->absolute_start_gap;

446 
√wlöe
->
absﬁuã_íd_g≠
 = 
löe
->absolute_end_gap;

448 
	`löe_upd©e_d©a
(
löe
);

450  &
√wlöe
->
c⁄√˘i⁄
.
obje˘
;

451 
	}
}

454 
	$löe_upd©e_d©a
(
Löe
 *
löe
)

456 
C⁄√˘i⁄
 *
c⁄n
 = &
löe
->
c⁄√˘i⁄
;

457 
DüObje˘
 *
obj
 = &
c⁄n
->
obje˘
;

458 
LöeBBExåas
 *
exåa
 = &
c⁄n
->
exåa_•acög
;

459 
Poöt
 
°¨t
, 
íd
;

461 
exåa
->
°¨t_å™s
 =

462 
exåa
->
íd_å™s
 =

463 
exåa
->
°¨t_l⁄g
 =

464 
exåa
->
íd_l⁄g
 = (
löe
->
löe_width
 / 2.0);

466 i‡(
	`c⁄≈oöt_is_autog≠
(
löe
->
c⁄√˘i⁄
.
ídpoöt_h™dÀs
[0].
c⁄√˘ed_to
) ||

467 
	`c⁄≈oöt_is_autog≠
(
löe
->
c⁄√˘i⁄
.
ídpoöt_h™dÀs
[1].
c⁄√˘ed_to
)) {

468 
	`c⁄√˘i⁄_adju°_f‹_autog≠
(
c⁄n
);

470 i‡(
löe
->
absﬁuã_°¨t_g≠
 ||Üöe->
absﬁuã_íd_g≠
 ) {

471 
Poöt
 
g≠_ídpoöts
[2];

473 
	`löe_adju°_f‹_absﬁuã_g≠
(
löe
, 
g≠_ídpoöts
);

474 
	`löe_bbox
(&
g≠_ídpoöts
[0],&gap_endpoints[1],

475 &
c⁄n
->
exåa_•acög
,&c⁄n->
obje˘
.
boundög_box
);

476 
°¨t
 = 
g≠_ídpoöts
[0];

477 
íd
 = 
g≠_ídpoöts
[1];

479 
	`c⁄√˘i⁄_upd©e_boundögbox
(
c⁄n
);

480 
°¨t
 = 
c⁄n
->
ídpoöts
[0];

481 
íd
 = 
c⁄n
->
ídpoöts
[1];

483 i‡(
löe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

484 
Re˘™gÀ
 
bbox
;

485 
Poöt
 
move_¨row
, 
move_löe
;

486 
Poöt
 
to
 = 
°¨t
;

487 
Poöt
 
‰om
 = 
íd
;

488 
	`ˇlcuœã_¨row_poöt
(&
löe
->
°¨t_¨row
, &
to
, &
‰om
,

489 &
move_¨row
, &
move_löe
, 
löe
->
löe_width
);

491 
	`poöt_sub
(&
to
, &
move_¨row
);

492 
	`poöt_sub
(&
‰om
, &
move_löe
);

494 
	`¨row_bbox
 (&
löe
->
°¨t_¨row
,Üöe->
löe_width
, &
to
, &
‰om
, &
bbox
);

495 
	`ª˘™gÀ_uni⁄
 (&
obj
->
boundög_box
, &
bbox
);

497 i‡(
löe
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

498 
Re˘™gÀ
 
bbox
;

499 
Poöt
 
move_¨row
, 
move_löe
;

500 
Poöt
 
to
 = 
íd
;

501 
Poöt
 
‰om
 = 
°¨t
;

502 
	`ˇlcuœã_¨row_poöt
(&
löe
->
°¨t_¨row
, &
to
, &
‰om
,

503 &
move_¨row
, &
move_löe
, 
löe
->
löe_width
);

505 
	`poöt_sub
(&
to
, &
move_¨row
);

506 
	`poöt_sub
(&
‰om
, &
move_löe
);

508 
	`¨row_bbox
 (&
löe
->
íd_¨row
,Üöe->
löe_width
, &
to
, &
‰om
, &
bbox
);

509 
	`ª˘™gÀ_uni⁄
 (&
obj
->
boundög_box
, &
bbox
);

512 
obj
->
posôi⁄
 = 
c⁄n
->
ídpoöts
[0];

514 
	`c⁄≈oöéöe_upd©e
(
löe
->
˝l
);

515 
	`c⁄≈oöéöe_put⁄Æöe
(
löe
->
˝l
, &
°¨t
, &
íd
);

517 
	`c⁄√˘i⁄_upd©e_h™dÀs
(
c⁄n
);

518 
	}
}

522 
	$löe_ßve
(
Löe
 *
löe
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
)

524 #ifde‡
DEBUG


525 
	`dü_obje˘_ßnôy_check
((
DüObje˘
*)
löe
, "SavingÜine");

528 
	`c⁄√˘i⁄_ßve
(&
löe
->
c⁄√˘i⁄
, 
obj_node
);

530 
	`c⁄≈oöéöe_ßve
(
löe
->
˝l
,
obj_node
,"numcp");

532 i‡(!
	`cﬁ‹_equÆs
(&
löe
->
löe_cﬁ‹
, &
cﬁ‹_bœck
))

533 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "line_color"),

534 &
löe
->
löe_cﬁ‹
);

536 i‡(
löe
->
löe_width
 != 0.1)

537 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

538 
löe
->
löe_width
);

540 i‡(
löe
->
löe_°yÀ
 !
LINESTYLE_SOLID
)

541 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

542 
löe
->
löe_°yÀ
);

544 i‡(
löe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

545 
	`ßve_¨row
(
obj_node
, &
löe
->
°¨t_¨row
,

549 i‡(
löe
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

550 
	`ßve_¨row
(
obj_node
, &
löe
->
íd_¨row
,

554 i‡(
löe
->
absﬁuã_°¨t_g≠
)

555 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "absolute_start_gap"),

556 
löe
->
absﬁuã_°¨t_g≠
);

557 i‡(
löe
->
absﬁuã_íd_g≠
)

558 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "absolute_end_gap"),

559 
löe
->
absﬁuã_íd_g≠
);

561 i‡(
löe
->
löe_°yÀ
 !
LINESTYLE_SOLID
 &&Üöe->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

562 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

563 
löe
->
dashÀngth
);

564 
	}
}

566 
DüObje˘
 *

567 
	$löe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

569 
Löe
 *
löe
;

570 
C⁄√˘i⁄
 *
c⁄n
;

571 
DüObje˘
 *
obj
;

572 
AâribuãNode
 
©å
;

574 
löe
 = 
	`g_mÆloc0
((
Löe
));

576 
c⁄n
 = &
löe
->
c⁄√˘i⁄
;

577 
obj
 = &
c⁄n
->
obje˘
;

579 
obj
->
ty≥
 = &
löe_ty≥
;

580 
obj
->
›s
 = &
löe_›s
;

582 
	`c⁄√˘i⁄_lﬂd
(
c⁄n
, 
obj_node
);

584 
löe
->
löe_cﬁ‹
 = 
cﬁ‹_bœck
;

585 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_color");

586 i‡(
©å
 !
NULL
)

587 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
löe
->
löe_cﬁ‹
);

589 
löe
->
löe_width
 = 0.1;

590 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

591 i‡(
©å
 !
NULL
)

592 
löe
->
löe_width
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

594 
löe
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

595 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

596 i‡(
©å
 !
NULL
)

597 
löe
->
löe_°yÀ
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

599 
	`lﬂd_¨row
(
obj_node
, &
löe
->
°¨t_¨row
,

602 
	`lﬂd_¨row
(
obj_node
, &
löe
->
íd_¨row
,

605 
löe
->
absﬁuã_°¨t_g≠
 = 0.0;

606 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "absolute_start_gap");

607 i‡(
©å
 !
NULL
)

608 
löe
->
absﬁuã_°¨t_g≠
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

609 
löe
->
absﬁuã_íd_g≠
 = 0.0;

610 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "absolute_end_gap");

611 i‡(
©å
 !
NULL
)

612 
löe
->
absﬁuã_íd_g≠
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

614 
löe
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

615 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

616 i‡(
©å
 !
NULL
)

617 
löe
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

619 
	`c⁄√˘i⁄_öô
(
c⁄n
, 2, 0);

621 
löe
->
˝l
 = 
	`c⁄≈oöéöe_lﬂd
(
obj
,
obj_node
,"num˝",1,
NULL
);

622 
	`löe_upd©e_d©a
(
löe
);

624  &
löe
->
c⁄√˘i⁄
.
obje˘
;

625 
	}
}

	@O:\tool\dvs50\objects\standard\outline.c

27 
	~<c⁄fig.h
>

29 
	~"obje˘.h
"

30 
	~"düªndîî.h
"

31 
	~"©åibuãs.h
"

32 
	~"¥›îtõs.h
"

33 
	~"boundögbox.h
"

35 
	~"toﬁ-ic⁄s.h
"

37 #ifde‡
HAVE_CAIRO


38 
	~<ˇúo.h
>

40 #ifde‡
CAIRO_HAS_SVG_SURFACE


41 
	~<ˇúo-svg.h
>

44 
	#NUM_HANDLES
 2

	)

46 
	s_Ouéöe
 {

47 
DüObje˘
 
	mobje˘
;

49 *
	m«me
;

50 
ªÆ
 
	mrŸ©i⁄
;

52 
DüF⁄t
 *
	mf⁄t
;

53 
ªÆ
 
	mf⁄t_height
;

55 
Cﬁ‹
 
	mlöe_cﬁ‹
;

56 
Cﬁ‹
 
	mfûl_cﬁ‹
;

57 
gboﬁón
 
	mshow_background
;

58 
ªÆ
 
	mlöe_width
;

60 
H™dÀ
 
	mh™dÀs
[
NUM_HANDLES
];

62 
Poöt
 
	mök_ª˘
[4];

63 
ˇúo_∑th_t
 *
	m∑th
;

64 
	s_M©rix


66 
ªÆ
 
	mxx
;

67 
ªÆ
 
	mxy
;

68 
ªÆ
 
	myx
;

69 
ªÆ
 
	myy
;

70 } 
	mm©
;

71 } 
	tOuéöe
;

74 
DüObje˘
 *
ouéöe_¸óã
 (
Poöt
 *
°¨çoöt
,

75 *
u£r_d©a
,

76 
H™dÀ
 **
h™dÀ1
,

77 
H™dÀ
 **
h™dÀ2
);

78 
DüObje˘
 *

79 
ouéöe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
);

81 
Obje˘Ty≥Ops
 
	gouéöe_ty≥_›s
 =

83 (
Cª©eFunc
)
ouéöe_¸óã
,

84 (
LﬂdFunc
Ë
ouéöe_lﬂd
,

85 (
SaveFunc
Ë
obje˘_ßve_usög_¥›îtõs
,

86 (
GëDeÁu…sFunc
Ë
NULL
,

87 (
AµlyDeÁu…sFunc
Ë
NULL


90 
DüObje˘Ty≥
 
	gouéöe_ty≥
 =

94 (**Ë
ouéöe_ic⁄
,

96 &
ouéöe_ty≥_›s
,

97 
NULL
,

102 
DüObje˘Ty≥
 *
	g_ouéöe_ty≥
 = (DüObje˘Ty≥ *Ë&
ouéöe_ty≥
;

105 
Obje˘Ch™ge
* 
ouéöe_move_h™dÀ
 (
Ouéöe
 *
ouéöe
,

106 
H™dÀ
 *
h™dÀ
,

107 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

108 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

109 
Obje˘Ch™ge
* 
ouéöe_move
 (
Ouéöe
 *
ouéöe
, 
Poöt
 *
to
);

110 
ouéöe_£À˘
(
Ouéöe
 *
ouéöe
, 
Poöt
 *
˛icked_poöt
,

111 
DüRídîî
 *
öãø˘ive_ªndîî
);

112 
ouéöe_døw
(
Ouéöe
 *
ouéöe
, 
DüRídîî
 *
ªndîî
);

113 
ªÆ
 
ouéöe_di°™˚_‰om
 (
Ouéöe
 *
ouéöe
, 
Poöt
 *
poöt
);

114 
ouéöe_upd©e_d©a
 (
Ouéöe
 *
ouéöe
);

115 
ouéöe_de°roy
 (
Ouéöe
 *
ouéöe
);

116 
DüObje˘
 *
ouéöe_c›y
 (
Ouéöe
 *
ouéöe
);

117 
DüMíu
 *
ouéöe_gë_obje˘_míu
(
Ouéöe
 *
ouéöe
,

118 
Poöt
 *
˛ickedpoöt
);

119 
Pr›Des¸ùti⁄
 *
ouéöe_des¸ibe_¥›s
(
Ouéöe
 *
ouéöe
);

120 
ouéöe_gë_¥›s
(
Ouéöe
 *
ouéöe
, 
GPåAºay
 *
¥›s
);

121 
ouéöe_£t_¥›s
(
Ouéöe
 *
ouéöe
, 
GPåAºay
 *
¥›s
);

123 
Obje˘Ops
 
	gouéöe_›s
 = {

124 (
De°royFunc
Ë
ouéöe_de°roy
,

125 (
DøwFunc
Ë
ouéöe_døw
,

126 (
Di°™˚Func
Ë
ouéöe_di°™˚_‰om
,

127 (
Sñe˘Func
Ë
ouéöe_£À˘
,

128 (
C›yFunc
Ë
ouéöe_c›y
,

129 (
MoveFunc
Ë
ouéöe_move
,

130 (
MoveH™dÀFunc
Ë
ouéöe_move_h™dÀ
,

131 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

132 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

133 (
Obje˘MíuFunc
Ë
ouéöe_gë_obje˘_míu
,

134 (
Des¸ibePr›sFunc
Ë
ouéöe_des¸ibe_¥›s
,

135 (
GëPr›sFunc
Ë
ouéöe_gë_¥›s
,

136 (
SëPr›sFunc
Ë
ouéöe_£t_¥›s
,

137 (
TextEdôFunc
) 0,

138 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

143 
	$ouéöe_öô_h™dÀs
 (
Ouéöe
 *
ouéöe
)

145 
DüObje˘
 *
obj
 = &
ouéöe
->
obje˘
;

146 
i
;

148 
i
 = 0; i < 
NUM_HANDLES
; ++i) {

149 
obj
->
h™dÀs
[
i
] = &
ouéöe
->handles[i];

150 
obj
->
h™dÀs
[
i
]->
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

151 
obj
->
h™dÀs
[
i
]->
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

152 
obj
->
h™dÀs
[
i
]->
c⁄√˘ed_to
 = 
NULL
;

154 
	}
}

157 
DüObje˘
 *

158 
	$ouéöe_¸óã
 (
Poöt
 *
°¨çoöt
,

159 *
u£r_d©a
,

160 
H™dÀ
 **
h™dÀ1
,

161 
H™dÀ
 **
h™dÀ2
)

163 
Ouéöe
 *
ouéöe
;

164 
DüObje˘
 *
obj
;

166 
ouéöe
 = 
	`g_√w0
 (
Ouéöe
,1);

167 
obj
 = &
ouéöe
->
obje˘
;

168 
obj
->
ty≥
 = &
ouéöe_ty≥
;

169 
obj
->
›s
 = &
ouéöe_›s
;

171 
	`obje˘_öô
 (
obj
, 
NUM_HANDLES
, 0);

172 
obj
->
posôi⁄
 = *
°¨çoöt
;

174 
	`ouéöe_öô_h™dÀs
 (
ouéöe
);

176 
	`©åibuãs_gë_deÁu…_f⁄t
 (&
ouéöe
->
f⁄t
, &ouéöe->
f⁄t_height
);

178 
ouéöe
->
löe_width
 = 0;

179 
ouéöe
->
löe_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

180 
ouéöe
->
fûl_cﬁ‹
 = 
	`©åibuãs_gë_background
();

181 
ouéöe
->
show_background
 = 
FALSE
;

182 
ouéöe
->
«me
 = 
	`g_°rdup
 ("?");

183 
ouéöe
->
rŸ©i⁄
 = 0;

185 *
h™dÀ1
 = 
ouéöe
->
obje˘
.
h™dÀs
[0];

186 *
h™dÀ2
 = 
ouéöe
->
obje˘
.
h™dÀs
[1];

188 
	`ouéöe_upd©e_d©a
 (
ouéöe
);

190  
obj
;

191 
	}
}

192 
DüObje˘
 *

193 
	$ouéöe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

195  
	`obje˘_lﬂd_usög_¥›îtõs
(&
ouéöe_ty≥
,

196 
obj_node
,
vîsi⁄
,
fûíame
);

197 
	}
}

200 
Pr›NumD©a
 
	g_rŸ©i⁄_ønge
 = { 0.0f, 360.0f, 1.0f };

201 
Pr›Des¸ùti⁄
 
	gouéöe_¥›s
[] = {

202 
OBJECT_COMMON_PROPERTIES
,

203 { "«me", 
PROP_TYPE_STRING
,
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_MERGE
,

204 
N_
("Texàc⁄ã¡"),
NULL
 },

205 { "rŸ©i⁄", 
PROP_TYPE_REAL
,
PROP_FLAG_VISIBLE
,

206 
N_
("RŸ©i⁄"), N_("AngÀÅÿrŸ©êthêouéöe"), &
_rŸ©i⁄_ønge
},

208 
PROP_STD_TEXT_FONT_OPTIONS
(
PROP_FLAG_VISIBLE
),

209 
PROP_STD_TEXT_HEIGHT_OPTIONS
(
PROP_FLAG_VISIBLE
),

210 
PROP_STD_LINE_WIDTH
,

211 
PROP_STD_LINE_COLOUR
,

212 
PROP_STD_FILL_COLOUR
,

213 
PROP_STD_SHOW_BACKGROUND
,

214 
PROP_DESC_END


217 
Pr›Off£t
 
	gouéöe_off£ts
[] = {

218 
OBJECT_COMMON_PROPERTIES_OFFSETS
,

219 { "«me", 
PROP_TYPE_STRING
, 
off£tof
(
Ouéöe
, 
«me
) },

220 { "rŸ©i⁄", 
PROP_TYPE_REAL
, 
off£tof
(
Ouéöe
, 
rŸ©i⁄
) },

221 { "ãxt_f⁄t",
PROP_TYPE_FONT
,
off£tof
(
Ouéöe
,
f⁄t
) },

222 { 
PROP_STDNAME_TEXT_HEIGHT
,
PROP_STDTYPE_TEXT_HEIGHT
,
off£tof
(
Ouéöe
, 
f⁄t_height
) },

223 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Ouéöe
, 
löe_width
) },

224 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Ouéöe
, 
löe_cﬁ‹
) },

225 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Ouéöe
, 
fûl_cﬁ‹
) },

226 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
Ouéöe
, 
show_background
) },

227 { 
NULL
, 0, 0 }

230 
ˇúo_°©us_t


231 
	$wrôe_nul
 (*
˛osuª
,

232 c⁄° *
d©a
,

233 
Àngth
)

235  
CAIRO_STATUS_SUCCESS
;

236 
	}
}

239 
	$outöe_upd©e_h™dÀs
(
Ouéöe
 *
ouéöe
)

241 
DüObje˘
 *
obj
 = &
ouéöe
->
obje˘
;

243 
	`g_ªtu∫_if_Áû
 (
obj
->
h™dÀs
 !
NULL
);

244 
obj
->
h™dÀs
[0]->
id
 = 
HANDLE_RESIZE_NW
;

245 
obj
->
h™dÀs
[0]->
pos
 = 
ouéöe
->
ök_ª˘
[0];

247 
obj
->
h™dÀs
[1]->
id
 = 
HANDLE_RESIZE_SE
;

248 
obj
->
h™dÀs
[1]->
pos
 = 
ouéöe
->
ök_ª˘
[2];

249 
	}
}

252 
	$ouéöe_upd©e_d©a
 (
Ouéöe
 *
ouéöe
)

254 
DüObje˘
 *
obj
 = &
ouéöe
->
obje˘
;

256 
ˇúo_t
 *
¸
;

257 
ˇúo_surÁ˚_t
 *
surÁ˚
;

258 
ˇúo_ãxt_exã¡s_t
 
exã¡s
;

259 
ªÆ
 
x
, 
y
;

260 
DüF⁄tStyÀ
 
°yÀ
;

262 i‡(
ouéöe
->
∑th
)

263 
	`ˇúo_∑th_de°roy
 (
ouéöe
->
∑th
);

264 
ouéöe
->
∑th
 = 
NULL
;

266 #ifde‡
CAIRO_HAS_SVG_SURFACE


267 
surÁ˚
 = 
	`ˇúo_svg_surÁ˚_¸óã_f‹_°ªam
 (
wrôe_nul
, 
NULL
, 100, 100);

270 
surÁ˚
 = 
	`ˇúo_image_surÁ˚_¸óã
 (
CAIRO_FORMAT_ARGB32
, 100, 100);

272 
¸
 = 
	`ˇúo_¸óã
 (
surÁ˚
);

273 
	`ˇúo_surÁ˚_de°roy
 (
surÁ˚
);

274 
°yÀ
 = 
	`dü_f⁄t_gë_°yÀ
 (
ouéöe
->
f⁄t
);

276 
	`ˇúo_£À˘_f⁄t_Á˚
 (
¸
, 
	`dü_f⁄t_gë_Ámûy
 (
ouéöe
->
f⁄t
),

277 
	`DIA_FONT_STYLE_GET_SLANT
 (
°yÀ
Ë=
DIA_FONT_NORMAL
 ? 
CAIRO_FONT_SLANT_NORMAL
 : 
CAIRO_FONT_SLANT_ITALIC
,

278 
	`DIA_FONT_STYLE_GET_WEIGHT
 (
°yÀ
Ë< 
DIA_FONT_MEDIUM
 ? 
CAIRO_FONT_SLANT_NORMAL
 : 
CAIRO_FONT_WEIGHT_BOLD
);

279 
	`ˇúo_£t_f⁄t_size
 (
¸
, 
ouéöe
->
f⁄t_height
);

280 
	`ˇúo_ãxt_exã¡s
 (
¸
, 
ouéöe
->
«me
, &
exã¡s
);

283 
	`ˇúo_rŸ©e
 (
¸
, 
ouéöe
->
rŸ©i⁄
/(2*
G_PI
));

285 
ouéöe
->
m©
.
xx
 = 
	`cos
(
G_PI
*ouéöe->
rŸ©i⁄
/180);

286 
ouéöe
->
m©
.
xy
 = 
	`sö
(
G_PI
*ouéöe->
rŸ©i⁄
/180);

287 
ouéöe
->
m©
.
yx
 = -
	`sö
(
G_PI
*ouéöe->
rŸ©i⁄
/180);

288 
ouéöe
->
m©
.
yy
 = 
	`cos
(
G_PI
*ouéöe->
rŸ©i⁄
/180);

291 
ouéöe
->
ök_ª˘
[0].
x
 = x = 
obj
->
posôi⁄
.x;

292 
ouéöe
->
ök_ª˘
[0].
y
 = y = 
obj
->
posôi⁄
.y;

294 
ouéöe
->
ök_ª˘
[1].
x
 = x + 
exã¡s
.
width
 * ouéöe->
m©
.
xx
;

295 
ouéöe
->
ök_ª˘
[1].
y
 = y + 
exã¡s
.
width
 * ouéöe->
m©
.
yx
;

296 
ouéöe
->
ök_ª˘
[2].
x
 = x + 
exã¡s
.
width
 * ouéöe->
m©
.
xx
 +Éxã¡s.
height
 * ouéöe->m©.
xy
;

297 
ouéöe
->
ök_ª˘
[2].
y
 = y + 
exã¡s
.
width
 * ouéöe->
m©
.
yx
 +Éxã¡s.
height
 * ouéöe->m©.
yy
;

298 
ouéöe
->
ök_ª˘
[3].
x
 = x + 
exã¡s
.
height
 * ouéöe->
m©
.
xy
;

299 
ouéöe
->
ök_ª˘
[3].
y
 = y + 
exã¡s
.
height
 * ouéöe->
m©
.
yy
;

303 
PﬁyBBExåas
 
bbex
 = {0, 0, 
ouéöe
->
löe_width
/2, 0, 0 };

304 
	`pﬁylöe_bbox
 (&
ouéöe
->
ök_ª˘
[0], 4, &
bbex
, 
TRUE
, &
obj
->
boundög_box
);

307 
	`outöe_upd©e_h™dÀs
 (
ouéöe
),

309 
	`ˇúo_move_to
 (
¸
, -
exã¡s
.
x_bórög
, -exã¡s.
y_bórög
);

313 
ouéöe
->
m©
.
xx
 = 1.0;

314 
ouéöe
->
m©
.
xy
 = 0.0;

315 
ouéöe
->
m©
.
yx
 = 0.0;

316 
ouéöe
->
m©
.
yy
 = 1.0;

319 
	`ˇúo_ãxt_∑th
 (
¸
, 
ouéöe
->
«me
);

321 
	`ˇúo_rŸ©e
 (
¸
, 0.0);

322 
ouéöe
->
∑th
 = 
	`ˇúo_c›y_∑th
 (
¸
);

324 
	`ˇúo_de°roy
 (
¸
);

325 
	}
}

327 
	$ouéöe_døw
(
Ouéöe
 *
ouéöe
, 
DüRídîî
 *
ªndîî
)

329 
DüObje˘
 *
obj
 = &
ouéöe
->
obje˘
;

330 
i
, 
n
 = 0, 
tŸÆ
;

331 
BezPoöt
 *
±s
;

332 
ªÆ
 
x
, 
y
;

333 
Poöt
 
ps
 = {0, 0};

335 i‡(!
ouéöe
->
∑th
)

337 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`£t_löewidth
 (ªndîî, 
ouéöe
->
löe_width
);

338 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`£t_löe°yÀ
 (ªndîî, 
LINESTYLE_SOLID
);

339 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`£t_löejoö
‘ídîî, 
LINEJOIN_MITER
);

340 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`£t_löeˇps
‘ídîî, 
LINECAPS_ROUND
);

343 
x
 = 
obj
->
posôi⁄
.x;

344 
y
 = 
obj
->
posôi⁄
.y;

347 
tŸÆ
 = 0;

348 
i
=0; i < 
ouéöe
->
∑th
->
num_d©a
; i +ouéöe->∑th->
d©a
[i].
hódî
.
Àngth
) {

349 ++
tŸÆ
;

352 
±s
 = 
	`g_Æloˇ
 ((
BezPoöt
)*(
tŸÆ
));

353 
i
=0; i < 
ouéöe
->
∑th
->
num_d©a
; i +ouéöe->∑th->
d©a
[i].
hódî
.
Àngth
) {

354 
ˇúo_∑th_d©a_t
 *
d©a
 = &
ouéöe
->
∑th
->d©a[
i
];

355 i‡(
CAIRO_PATH_MOVE_TO
 =
d©a
->
hódî
.
ty≥
) {

357 
±s
[
n
].
ty≥
 = 
BEZ_MOVE_TO
;

358 
ps
.
x
 = 
±s
[
n
].
p1
.x = 
d©a
[1].
poöt
.x * 
ouéöe
->
m©
.
xx
 + d©a[1].poöt.
y
 * ouéöe->m©.
xy
 + x;

359 
ps
.
y
 = 
±s
[
n
].
p1
.y = 
d©a
[1].
poöt
.
x
 * 
ouéöe
->
m©
.
yx
 + d©a[1].poöt.y * ouéöe->m©.
yy
 + y;

360 ++
n
;

361 } i‡(
CAIRO_PATH_LINE_TO
 =
d©a
->
hódî
.
ty≥
) {

362 
±s
[
n
].
ty≥
 = 
BEZ_LINE_TO
;

363 
±s
[
n
].
p1
.
x
 = 
d©a
[1].
poöt
.x * 
ouéöe
->
m©
.
xx
 + d©a[1].poöt.
y
 * ouéöe->m©.
xy
 + x;

364 
±s
[
n
].
p1
.
y
 = 
d©a
[1].
poöt
.
x
 * 
ouéöe
->
m©
.
yx
 + d©a[1].poöt.y * ouéöe->m©.
yy
 + y;

365 ++
n
;

366 } i‡(
CAIRO_PATH_CURVE_TO
 =
d©a
->
hódî
.
ty≥
) {

367 
±s
[
n
].
ty≥
 = 
BEZ_CURVE_TO
;

368 
±s
[
n
].
p1
.
x
 = 
d©a
[1].
poöt
.x * 
ouéöe
->
m©
.
xx
 + d©a[1].poöt.
y
 * ouéöe->m©.
xy
 + x;

369 
±s
[
n
].
p1
.
y
 = 
d©a
[1].
poöt
.
x
 * 
ouéöe
->
m©
.
yx
 + d©a[1].poöt.y * ouéöe->m©.
yy
 + y;

370 
±s
[
n
].
p2
.
x
 = 
d©a
[2].
poöt
.x * 
ouéöe
->
m©
.
xx
 + d©a[2].poöt.
y
 * ouéöe->m©.
xy
 + x;

371 
±s
[
n
].
p2
.
y
 = 
d©a
[2].
poöt
.
x
 * 
ouéöe
->
m©
.
yx
 + d©a[2].poöt.y * ouéöe->m©.
yy
 + y;

372 
±s
[
n
].
p3
.
x
 = 
d©a
[3].
poöt
.x * 
ouéöe
->
m©
.
xx
 + d©a[3].poöt.
y
 * ouéöe->m©.
xy
 + x;

373 
±s
[
n
].
p3
.
y
 = 
d©a
[3].
poöt
.
x
 * 
ouéöe
->
m©
.
yx
 + d©a[3].poöt.y * ouéöe->m©.
yy
 + y;

374 ++
n
;

375 } i‡(
CAIRO_PATH_CLOSE_PATH
 =
d©a
->
hódî
.
ty≥
) {

376 
±s
[
n
].
ty≥
 = 
BEZ_LINE_TO
;

377 
±s
[
n
].
p1
.
x
 = 
ps
.x;

378 
±s
[
n
].
p1
.
y
 = 
ps
.y;

379 ++
n
;

383 i‡(
ouéöe
->
show_background
) {

385 
s1
 = 0, 
n1
 = 0;

386 
s2
 = 0;

387 
i
 = 1; i < 
tŸÆ
; ++i) {

388 i‡(
BEZ_MOVE_TO
 =
±s
[
i
].
ty≥
) {

391 
ªÆ
 
di°
 = 
	`di°™˚_bez_sh≠e_poöt
 (&
±s
[
s1
],

392 
n1
 > 0 ?Ç1 : 
i
 - 
s1
, 0, &
±s
[i].
p1
);

393 i‡(
s2
 > 
s1
) {

394 
n
 = 
i
 - 
s2
 - 1;

395 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`fûl_bezõr
 (ªndîî, &
±s
[
s2
], 
n
, &
cﬁ‹_whôe
);

397 
n1
 = 
n
 = 
i
 - 
s1
;

398 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`fûl_bezõr
 (ªndîî, &
±s
[
s1
], 
n
, &
ouéöe
->
fûl_cﬁ‹
);

400 i‡(
di°
 > 0) {

401 
s1
 = 
i
;

402 
n1
 = 0;

403 
s2
 = 0;

405 
s2
 = 
i
;

410 i‡(
s2
 > 
s1
) {

411 i‡(
s2
 - 
i
 - 1 > 1)

412 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`fûl_bezõr
 (ªndîî, &
±s
[
s2
], s2 - 
i
 - 1, &
cﬁ‹_whôe
);

414 i‡(
s1
 - 
i
 - 1 > 1)

415 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`fûl_bezõr
 (ªndîî, &
±s
[
s1
], s1 - 
i
 - 1, &
ouéöe
->
fûl_cﬁ‹
);

418 
n
 = 0;

419 
i
 = 1; i < 
tŸÆ
; ++i) {

420 i‡(
BEZ_MOVE_TO
 =
±s
[
i
].
ty≥
) {

421 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`døw_bezõr
 (ªndîî, &
±s
[
n
], 
i
 -Ç, &
ouéöe
->
löe_cﬁ‹
);

422 
n
 = 
i
;

426 i‡(
i
 - 
n
 - 1 > 0)

427 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`døw_bezõr
 (ªndîî, &
±s
[
n
], 
i
 -Ç - 1, &
ouéöe
->
löe_cﬁ‹
);

428 
	}
}

430 
DüMíu
 *

431 
	$ouéöe_gë_obje˘_míu
(
Ouéöe
 *
ouéöe
, 
Poöt
 *
˛ickedpoöt
)

433  
NULL
;

434 
	}
}

437 
Pr›Des¸ùti⁄
 *

438 
	$ouéöe_des¸ibe_¥›s
 (
Ouéöe
 *
ouéöe
)

440 i‡(
ouéöe_¥›s
[0].
qu¨k
 == 0)

441 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
ouéöe_¥›s
);

442  
ouéöe_¥›s
;

443 
	}
}

445 
	$ouéöe_gë_¥›s
 (
Ouéöe
 *
ouéöe
, 
GPåAºay
 *
¥›s
)

447 
	`obje˘_gë_¥›s_‰om_off£ts
(&
ouéöe
->
obje˘
, 
ouéöe_off£ts
, 
¥›s
);

448 
	}
}

450 
	$ouéöe_£t_¥›s
 (
Ouéöe
 *
ouéöe
, 
GPåAºay
 *
¥›s
)

452 
	`obje˘_£t_¥›s_‰om_off£ts
(&
ouéöe
->
obje˘
, 
ouéöe_off£ts
, 
¥›s
);

453 
	`ouéöe_upd©e_d©a
 (
ouéöe
);

454 
	}
}

455 
ªÆ


456 
	$ouéöe_di°™˚_‰om
 (
Ouéöe
 *
ouéöe
, 
Poöt
 *
poöt
)

458  
	`di°™˚_pﬁyg⁄_poöt
 (&
ouéöe
->
ök_ª˘
[0], 4, ouéöe->
löe_width
, 
poöt
);

459 
	}
}

460 
Obje˘Ch™ge
*

461 
	$ouéöe_move_h™dÀ
 (
Ouéöe
 *
ouéöe
,

462 
H™dÀ
 *
h™dÀ
,

463 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

464 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

466 
DüObje˘
 *
obj
 = &
ouéöe
->
obje˘
;

467 
Poöt
 
°¨t
 = 
obj
->
posôi⁄
;

468 
Poöt
 
íd
 = 
ouéöe
->
ök_ª˘
[2];

469 
ªÆ
 
di°
, 
ﬁd_di°
 = 
	`di°™˚_poöt_poöt
 (&
°¨t
, &
íd
);

470 
Poöt
 
n‹m
 = 
íd
;

471 
	`poöt_sub
 (&
n‹m
, &
°¨t
);

472 
	`poöt_n‹mÆize
 (&
n‹m
);

474 
h™dÀ
->
id
) {

475 
HANDLE_RESIZE_NW
 :

476 
°¨t
 = *
to
;

478 
HANDLE_RESIZE_SE
 :

479 
íd
 = *
to
;

482 
	`g_w¨nög
 ("Outline unknown handle");

484 
di°
 = 
	`di°™˚_poöt_poöt
 (&
°¨t
, &
íd
);

486 i‡(
di°
 > 0.1) {

487 
obj
->
posôi⁄
 = 
°¨t
;

489 
ouéöe
->
f⁄t_height
 *(
di°
 / 
ﬁd_di°
);

491 
	`ouéöe_upd©e_d©a
 (
ouéöe
);

493  
NULL
;

494 
	}
}

495 
Obje˘Ch™ge
*

496 
	$ouéöe_move
 (
Ouéöe
 *
ouéöe
, 
Poöt
 *
to
)

498 
DüObje˘
 *
obj
 = &
ouéöe
->
obje˘
;

500 
obj
->
posôi⁄
 = *
to
;

502 
	`ouéöe_upd©e_d©a
 (
ouéöe
);

503  
NULL
;

504 
	}
}

505 
DüObje˘
 *

506 
	$ouéöe_c›y
 (
Ouéöe
 *
‰om
)

508 
Ouéöe
 *
to
;

510 
to
 = 
	`g_√w0
 (
Ouéöe
, 1);

511 
	`obje˘_c›y
 (&
‰om
->
obje˘
, &
to
->object);

512 
	`ouéöe_öô_h™dÀs
 (
to
);

513 
to
->
«me
 = 
	`g_°rdup
 (
‰om
->name);

514 
to
->
rŸ©i⁄
 = 
‰om
->rotation;

515 
to
->
f⁄t
 = 
	`dü_f⁄t_c›y
 (
‰om
->font);

516 
to
->
f⁄t_height
 = 
‰om
->font_height;

517 
to
->
löe_width
 = 
‰om
->line_width;

518 
to
->
löe_cﬁ‹
 = 
‰om
->line_color;

519 
to
->
fûl_cﬁ‹
 = 
‰om
->fill_color;

520 
to
->
show_background
 = 
‰om
->show_background;

522 
	`ouéöe_upd©e_d©a
 (
to
);

524  &
to
->
obje˘
;

525 
	}
}

527 
	$ouéöe_de°roy
 (
Ouéöe
 *
ouéöe
)

529 i‡(
ouéöe
->
∑th
)

530 
	`ˇúo_∑th_de°roy
 (
ouéöe
->
∑th
);

531 
	`g_‰ì
 (
ouéöe
->
«me
);

532 
	`obje˘_de°roy
(&
ouéöe
->
obje˘
);

534 
	}
}

536 
	$ouéöe_£À˘
 (
Ouéöe
 *
ouéöe
, 
Poöt
 *
˛icked_poöt
,

537 
DüRídîî
 *
öãø˘ive_ªndîî
)

539 
	`outöe_upd©e_h™dÀs
 (
ouéöe
);

540 
	}
}

	@O:\tool\dvs50\objects\standard\polygon.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<as£π.h
>

24 
	~<m©h.h
>

26 
	~"öé.h
"

27 
	~"obje˘.h
"

28 
	~"pﬁysh≠e.h
"

29 
	~"c⁄√˘i⁄poöt.h
"

30 
	~"düªndîî.h
"

31 
	~"©åibuãs.h
"

32 
	~"widgës.h
"

33 
	~"dümíu.h
"

34 
	~"mesßge.h
"

35 
	~"¥›îtõs.h
"

37 
	~"toﬁ-ic⁄s.h
"

39 
	~"¸óã.h
"

49 
	#DEFAULT_WIDTH
 0.15

	)

51 
	s_Pﬁyg⁄
 {

52 
PﬁySh≠e
 
	mpﬁy
;

54 
Cﬁ‹
 
	mlöe_cﬁ‹
;

55 
LöeStyÀ
 
	mlöe_°yÀ
;

56 
Cﬁ‹
 
	mö√r_cﬁ‹
;

57 
gboﬁón
 
	mshow_background
;

58 
ªÆ
 
	mdashÀngth
;

59 
ªÆ
 
	mlöe_width
;

60 } 
	tPﬁyg⁄
;

62 
	s_Pﬁyg⁄Pr›îtõs
 {

63 
gboﬁón
 
	mshow_background
;

64 } 
	gdeÁu…_¥›îtõs
 = { 
TRUE
 };

66 
Obje˘Ch™ge
* 
pﬁyg⁄_move_h™dÀ
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
H™dÀ
 *
h™dÀ
,

67 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

68 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

69 
Obje˘Ch™ge
* 
pﬁyg⁄_move
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
to
);

70 
pﬁyg⁄_£À˘
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
˛icked_poöt
,

71 
DüRídîî
 *
öãø˘ive_ªndîî
);

72 
pﬁyg⁄_døw
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
DüRídîî
 *
ªndîî
);

73 
DüObje˘
 *
pﬁyg⁄_¸óã
(
Poöt
 *
°¨çoöt
,

74 *
u£r_d©a
,

75 
H™dÀ
 **
h™dÀ1
,

76 
H™dÀ
 **
h™dÀ2
);

77 
ªÆ
 
pﬁyg⁄_di°™˚_‰om
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
poöt
);

78 
pﬁyg⁄_upd©e_d©a
(
Pﬁyg⁄
 *
pﬁyg⁄
);

79 
pﬁyg⁄_de°roy
(
Pﬁyg⁄
 *
pﬁyg⁄
);

80 
DüObje˘
 *
pﬁyg⁄_c›y
(
Pﬁyg⁄
 *
pﬁyg⁄
);

82 
Pr›Des¸ùti⁄
 *
pﬁyg⁄_des¸ibe_¥›s
(
Pﬁyg⁄
 *
pﬁyg⁄
);

83 
pﬁyg⁄_gë_¥›s
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
GPåAºay
 *
¥›s
);

84 
pﬁyg⁄_£t_¥›s
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
GPåAºay
 *
¥›s
);

86 
pﬁyg⁄_ßve
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Obje˘Node
 
obj_node
,

87 c⁄° *
fûíame
);

88 
DüObje˘
 *
pﬁyg⁄_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
,

89 c⁄° *
fûíame
);

90 
DüMíu
 *
pﬁyg⁄_gë_obje˘_míu
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
˛ickedpoöt
);

92 
Obje˘Ty≥Ops
 
	gpﬁyg⁄_ty≥_›s
 =

94 (
Cª©eFunc
)
pﬁyg⁄_¸óã
,

95 (
LﬂdFunc
Ë
pﬁyg⁄_lﬂd
,

96 (
SaveFunc
Ë
pﬁyg⁄_ßve
,

97 (
GëDeÁu…sFunc
Ë
NULL
,

98 (
AµlyDeÁu…sFunc
Ë
NULL
,

101 
DüObje˘Ty≥
 
	gpﬁyg⁄_ty≥
 =

105 (**Ë
pﬁyg⁄_ic⁄
,

107 &
pﬁyg⁄_ty≥_›s
,

108 
NULL
,

112 
DüObje˘Ty≥
 *
	g_pﬁyg⁄_ty≥
 = (DüObje˘Ty≥ *Ë&
pﬁyg⁄_ty≥
;

115 
Obje˘Ops
 
	gpﬁyg⁄_›s
 = {

116 (
De°royFunc
Ë
pﬁyg⁄_de°roy
,

117 (
DøwFunc
Ë
pﬁyg⁄_døw
,

118 (
Di°™˚Func
Ë
pﬁyg⁄_di°™˚_‰om
,

119 (
Sñe˘Func
Ë
pﬁyg⁄_£À˘
,

120 (
C›yFunc
Ë
pﬁyg⁄_c›y
,

121 (
MoveFunc
Ë
pﬁyg⁄_move
,

122 (
MoveH™dÀFunc
Ë
pﬁyg⁄_move_h™dÀ
,

123 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

124 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

125 (
Obje˘MíuFunc
Ë
pﬁyg⁄_gë_obje˘_míu
,

126 (
Des¸ibePr›sFunc
Ë
pﬁyg⁄_des¸ibe_¥›s
,

127 (
GëPr›sFunc
Ë
pﬁyg⁄_gë_¥›s
,

128 (
SëPr›sFunc
Ë
pﬁyg⁄_£t_¥›s
,

129 (
TextEdôFunc
) 0,

130 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

133 
Pr›Des¸ùti⁄
 
	gpﬁyg⁄_¥›s
[] = {

134 
POLYSHAPE_COMMON_PROPERTIES
,

135 
PROP_STD_LINE_WIDTH
,

136 
PROP_STD_LINE_COLOUR
,

137 
PROP_STD_LINE_STYLE
,

138 
PROP_STD_FILL_COLOUR
,

139 
PROP_STD_SHOW_BACKGROUND
,

140 
PROP_DESC_END


143 
Pr›Des¸ùti⁄
 *

144 
	$pﬁyg⁄_des¸ibe_¥›s
(
Pﬁyg⁄
 *
pﬁyg⁄
)

146 i‡(
pﬁyg⁄_¥›s
[0].
qu¨k
 == 0)

147 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
pﬁyg⁄_¥›s
);

148  
pﬁyg⁄_¥›s
;

149 
	}
}

151 
Pr›Off£t
 
	gpﬁyg⁄_off£ts
[] = {

152 
POLYSHAPE_COMMON_PROPERTIES_OFFSETS
,

153 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Pﬁyg⁄
, 
löe_width
) },

154 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Pﬁyg⁄
, 
löe_cﬁ‹
) },

155 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

156 
off£tof
(
Pﬁyg⁄
, 
löe_°yÀ
), off£tof(Pﬁyg⁄, 
dashÀngth
) },

157 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Pﬁyg⁄
, 
ö√r_cﬁ‹
) },

158 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
Pﬁyg⁄
, 
show_background
) },

159 { 
NULL
, 0, 0 }

163 
	$pﬁyg⁄_gë_¥›s
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
GPåAºay
 *
¥›s
)

165 
	`obje˘_gë_¥›s_‰om_off£ts
(&
pﬁyg⁄
->
pﬁy
.
obje˘
,

166 
pﬁyg⁄_off£ts
, 
¥›s
);

167 
	}
}

170 
	$pﬁyg⁄_£t_¥›s
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
GPåAºay
 *
¥›s
)

172 
	`obje˘_£t_¥›s_‰om_off£ts
(&
pﬁyg⁄
->
pﬁy
.
obje˘
,

173 
pﬁyg⁄_off£ts
, 
¥›s
);

174 
	`pﬁyg⁄_upd©e_d©a
(
pﬁyg⁄
);

175 
	}
}

177 
ªÆ


178 
	$pﬁyg⁄_di°™˚_‰om
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
poöt
)

180  
	`pﬁysh≠e_di°™˚_‰om
(&
pﬁyg⁄
->
pﬁy
, 
poöt
,Öﬁyg⁄->
löe_width
);

181 
	}
}

183 
H™dÀ
 *
	$pﬁyg⁄_˛o£°_h™dÀ
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
poöt
) {

184  
	`pﬁysh≠e_˛o£°_h™dÀ
(&
pﬁyg⁄
->
pﬁy
, 
poöt
);

185 
	}
}

187 
	$pﬁyg⁄_˛o£°_£gmít
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
poöt
) {

188  
	`pﬁysh≠e_˛o£°_£gmít
(&
pﬁyg⁄
->
pﬁy
, 
poöt
,Öﬁyg⁄->
löe_width
);

189 
	}
}

192 
	$pﬁyg⁄_£À˘
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
˛icked_poöt
,

193 
DüRídîî
 *
öãø˘ive_ªndîî
)

195 
	`pﬁysh≠e_upd©e_d©a
(&
pﬁyg⁄
->
pﬁy
);

196 
	}
}

198 
Obje˘Ch™ge
*

199 
	$pﬁyg⁄_move_h™dÀ
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
H™dÀ
 *
h™dÀ
,

200 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

201 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

203 
	`as£π
(
pﬁyg⁄
!=
NULL
);

204 
	`as£π
(
h™dÀ
!=
NULL
);

205 
	`as£π
(
to
!=
NULL
);

207 
	`pﬁysh≠e_move_h™dÀ
(&
pﬁyg⁄
->
pﬁy
, 
h™dÀ
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

208 
	`pﬁyg⁄_upd©e_d©a
(
pﬁyg⁄
);

210  
NULL
;

211 
	}
}

214 
Obje˘Ch™ge
*

215 
	$pﬁyg⁄_move
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
to
)

217 
	`pﬁysh≠e_move
(&
pﬁyg⁄
->
pﬁy
, 
to
);

218 
	`pﬁyg⁄_upd©e_d©a
(
pﬁyg⁄
);

220  
NULL
;

221 
	}
}

224 
	$pﬁyg⁄_døw
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
DüRídîî
 *
ªndîî
)

226 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

227 
PﬁySh≠e
 *
pﬁy
 = &
pﬁyg⁄
->poly;

228 
Poöt
 *
poöts
;

229 
n
;

231 
poöts
 = &
pﬁy
->points[0];

232 
n
 = 
pﬁy
->
numpoöts
;

234 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
pﬁyg⁄
->
löe_width
);

235 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
pﬁyg⁄
->
löe_°yÀ
);

236 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
pﬁyg⁄
->
dashÀngth
);

237 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_MITER
);

238 
ªndîî_›s
->
	`£t_löeˇps
(
ªndîî
, 
LINECAPS_BUTT
);

240 i‡(
pﬁyg⁄
->
show_background
)

241 
ªndîî_›s
->
	`fûl_pﬁyg⁄
(
ªndîî
, 
poöts
, 
n
, &
pﬁyg⁄
->
ö√r_cﬁ‹
);

243 
ªndîî_›s
->
	`døw_pﬁyg⁄
(
ªndîî
, 
poöts
, 
n
, &
pﬁyg⁄
->
löe_cﬁ‹
);

244 
	}
}

246 
DüObje˘
 *

247 
	$pﬁyg⁄_¸óã
(
Poöt
 *
°¨çoöt
,

248 *
u£r_d©a
,

249 
H™dÀ
 **
h™dÀ1
,

250 
H™dÀ
 **
h™dÀ2
)

252 
Pﬁyg⁄
 *
pﬁyg⁄
;

253 
PﬁySh≠e
 *
pﬁy
;

254 
DüObje˘
 *
obj
;

255 
Poöt
 
deÁu…x
 = { 1.0, 0.0 };

256 
Poöt
 
deÁu…y
 = { 0.0, 1.0 };

258 
pﬁyg⁄
 = 
	`g_√w0
(
Pﬁyg⁄
, 1);

259 
pﬁy
 = &
pﬁyg⁄
->poly;

260 
obj
 = &
pﬁy
->
obje˘
;

262 
obj
->
ty≥
 = &
pﬁyg⁄_ty≥
;

263 
obj
->
›s
 = &
pﬁyg⁄_›s
;

265 i‡(
u£r_d©a
 =
NULL
) {

266 
	`pﬁysh≠e_öô
(
pﬁy
, 3);

268 
pﬁy
->
poöts
[0] = *
°¨çoöt
;

269 
pﬁy
->
poöts
[1] = *
°¨çoöt
;

270 
	`poöt_add
(&
pﬁy
->
poöts
[1], &
deÁu…x
);

271 
pﬁy
->
poöts
[2] = *
°¨çoöt
;

272 
	`poöt_add
(&
pﬁy
->
poöts
[2], &
deÁu…y
);

274 
Mu…ùoötCª©eD©a
 *
pcd
 = (Mu…ùoötCª©eD©®*)
u£r_d©a
;

276 
	`pﬁysh≠e_öô
(
pﬁy
, 
pcd
->
num_poöts
);

277 
	`pﬁysh≠e_£t_poöts
(
pﬁy
, 
pcd
->
num_poöts
,Öcd->
poöts
);

280 
pﬁyg⁄
->
löe_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

281 
pﬁyg⁄
->
löe_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

282 
pﬁyg⁄
->
ö√r_cﬁ‹
 = 
	`©åibuãs_gë_background
();

283 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
pﬁyg⁄
->
löe_°yÀ
,

284 &
pﬁyg⁄
->
dashÀngth
);

285 
pﬁyg⁄
->
show_background
 = 
deÁu…_¥›îtõs
.show_background;

287 
	`pﬁyg⁄_upd©e_d©a
(
pﬁyg⁄
);

289 *
h™dÀ1
 = 
pﬁy
->
obje˘
.
h™dÀs
[0];

290 *
h™dÀ2
 = 
pﬁy
->
obje˘
.
h™dÀs
[2];

291  &
pﬁyg⁄
->
pﬁy
.
obje˘
;

292 
	}
}

295 
	$pﬁyg⁄_de°roy
(
Pﬁyg⁄
 *
pﬁyg⁄
)

297 
	`pﬁysh≠e_de°roy
(&
pﬁyg⁄
->
pﬁy
);

298 
	}
}

300 
DüObje˘
 *

301 
	$pﬁyg⁄_c›y
(
Pﬁyg⁄
 *
pﬁyg⁄
)

303 
Pﬁyg⁄
 *
√wpﬁyg⁄
;

304 
PﬁySh≠e
 *
pﬁy
, *
√wpﬁy
;

305 
DüObje˘
 *
√wobj
;

307 
pﬁy
 = &
pﬁyg⁄
->poly;

309 
√wpﬁyg⁄
 = 
	`g_mÆloc0
((
Pﬁyg⁄
));

310 
√wpﬁy
 = &
√wpﬁyg⁄
->
pﬁy
;

311 
√wobj
 = &
√wpﬁy
->
obje˘
;

313 
	`pﬁysh≠e_c›y
(
pﬁy
, 
√wpﬁy
);

315 
√wpﬁyg⁄
->
löe_cﬁ‹
 = 
pﬁyg⁄
->line_color;

316 
√wpﬁyg⁄
->
löe_width
 = 
pﬁyg⁄
->line_width;

317 
√wpﬁyg⁄
->
löe_°yÀ
 = 
pﬁyg⁄
->line_style;

318 
√wpﬁyg⁄
->
dashÀngth
 = 
pﬁyg⁄
->dashlength;

319 
√wpﬁyg⁄
->
ö√r_cﬁ‹
 = 
pﬁyg⁄
->inner_color;

320 
√wpﬁyg⁄
->
show_background
 = 
pﬁyg⁄
->show_background;

322  &
√wpﬁyg⁄
->
pﬁy
.
obje˘
;

323 
	}
}

327 
	$pﬁyg⁄_upd©e_d©a
(
Pﬁyg⁄
 *
pﬁyg⁄
)

329 
PﬁySh≠e
 *
pﬁy
 = &
pﬁyg⁄
->poly;

330 
DüObje˘
 *
obj
 = &
pﬁy
->
obje˘
;

331 
EÀmítBBExåas
 *
exåa
 = &
pﬁy
->
exåa_•acög
;

333 
	`pﬁysh≠e_upd©e_d©a
(
pﬁy
);

335 
exåa
->
b‹dî_å™s
 = 
pﬁyg⁄
->
löe_width
 / 2.0;

336 
	`pﬁysh≠e_upd©e_boundögbox
(
pﬁy
);

338 
obj
->
posôi⁄
 = 
pﬁy
->
poöts
[0];

339 
	}
}

342 
	$pﬁyg⁄_ßve
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Obje˘Node
 
obj_node
,

343 c⁄° *
fûíame
)

345 
	`pﬁysh≠e_ßve
(&
pﬁyg⁄
->
pﬁy
, 
obj_node
);

347 i‡(!
	`cﬁ‹_equÆs
(&
pﬁyg⁄
->
löe_cﬁ‹
, &
cﬁ‹_bœck
))

348 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "line_color"),

349 &
pﬁyg⁄
->
löe_cﬁ‹
);

351 i‡(
pﬁyg⁄
->
löe_width
 != 0.1)

352 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

353 
pﬁyg⁄
->
löe_width
);

355 i‡(!
	`cﬁ‹_equÆs
(&
pﬁyg⁄
->
ö√r_cﬁ‹
, &
cﬁ‹_whôe
))

356 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "inner_color"),

357 &
pﬁyg⁄
->
ö√r_cﬁ‹
);

359 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "show_background"),

360 
pﬁyg⁄
->
show_background
);

362 i‡(
pﬁyg⁄
->
löe_°yÀ
 !
LINESTYLE_SOLID
)

363 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

364 
pﬁyg⁄
->
löe_°yÀ
);

366 i‡(
pﬁyg⁄
->
löe_°yÀ
 !
LINESTYLE_SOLID
 &&

367 
pﬁyg⁄
->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

368 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

369 
pﬁyg⁄
->
dashÀngth
);

371 
	}
}

373 
DüObje˘
 *

374 
	$pﬁyg⁄_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

376 
Pﬁyg⁄
 *
pﬁyg⁄
;

377 
PﬁySh≠e
 *
pﬁy
;

378 
DüObje˘
 *
obj
;

379 
AâribuãNode
 
©å
;

381 
pﬁyg⁄
 = 
	`g_mÆloc0
((
Pﬁyg⁄
));

383 
pﬁy
 = &
pﬁyg⁄
->poly;

384 
obj
 = &
pﬁy
->
obje˘
;

386 
obj
->
ty≥
 = &
pﬁyg⁄_ty≥
;

387 
obj
->
›s
 = &
pﬁyg⁄_›s
;

389 
	`pﬁysh≠e_lﬂd
(
pﬁy
, 
obj_node
);

391 
pﬁyg⁄
->
löe_cﬁ‹
 = 
cﬁ‹_bœck
;

392 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_color");

393 i‡(
©å
 !
NULL
)

394 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
pﬁyg⁄
->
löe_cﬁ‹
);

396 
pﬁyg⁄
->
löe_width
 = 0.1;

397 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

398 i‡(
©å
 !
NULL
)

399 
pﬁyg⁄
->
löe_width
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

401 
pﬁyg⁄
->
ö√r_cﬁ‹
 = 
cﬁ‹_whôe
;

402 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "inner_color");

403 i‡(
©å
 !
NULL
)

404 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
pﬁyg⁄
->
ö√r_cﬁ‹
);

406 
pﬁyg⁄
->
show_background
 = 
TRUE
;

407 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "show_background");

408 i‡(
©å
 !
NULL
)

409 
pﬁyg⁄
->
show_background
 = 
	`d©a_boﬁón
–
	`©åibuã_fú°_d©a
(
©å
) );

411 
pﬁyg⁄
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

412 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

413 i‡(
©å
 !
NULL
)

414 
pﬁyg⁄
->
löe_°yÀ
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

416 
pﬁyg⁄
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

417 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

418 i‡(
©å
 !
NULL
)

419 
pﬁyg⁄
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

421 
	`pﬁyg⁄_upd©e_d©a
(
pﬁyg⁄
);

423  &
pﬁyg⁄
->
pﬁy
.
obje˘
;

424 
	}
}

426 
Obje˘Ch™ge
 *

427 
	$pﬁyg⁄_add_c‹√r_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

429 
Pﬁyg⁄
 *
pﬁy
 = (Pﬁyg⁄*Ë
obj
;

430 
£gmít
;

431 
Obje˘Ch™ge
 *
ch™ge
;

433 
£gmít
 = 
	`pﬁyg⁄_˛o£°_£gmít
(
pﬁy
, 
˛icked
);

434 
ch™ge
 = 
	`pﬁysh≠e_add_poöt
(&
pﬁy
->pﬁy, 
£gmít
, 
˛icked
);

436 
	`pﬁyg⁄_upd©e_d©a
(
pﬁy
);

437  
ch™ge
;

438 
	}
}

440 
Obje˘Ch™ge
 *

441 
	$pﬁyg⁄_dñëe_c‹√r_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

443 
H™dÀ
 *
h™dÀ
;

444 
h™dÀ_ƒ
, 
i
;

445 
Pﬁyg⁄
 *
pﬁy
 = (Pﬁyg⁄*Ë
obj
;

446 
Obje˘Ch™ge
 *
ch™ge
;

448 
h™dÀ
 = 
	`pﬁyg⁄_˛o£°_h™dÀ
(
pﬁy
, 
˛icked
);

450 
i
 = 0; i < 
obj
->
num_h™dÀs
; i++) {

451 i‡(
h™dÀ
 =
obj
->
h™dÀs
[
i
]) ;

453 
h™dÀ_ƒ
 = 
i
;

454 
ch™ge
 = 
	`pﬁysh≠e_ªmove_poöt
(&
pﬁy
->pﬁy, 
h™dÀ_ƒ
);

456 
	`pﬁyg⁄_upd©e_d©a
(
pﬁy
);

457  
ch™ge
;

458 
	}
}

461 
DüMíuIãm
 
	gpﬁyg⁄_míu_ôems
[] = {

462 { 
N_
("Add C‹√r"), 
pﬁyg⁄_add_c‹√r_ˇŒback
, 
NULL
, 1 },

463 { 
N_
("DñëêC‹√r"), 
pﬁyg⁄_dñëe_c‹√r_ˇŒback
, 
NULL
, 1 },

466 
DüMíu
 
	gpﬁyg⁄_míu
 = {

468 (
pﬁyg⁄_míu_ôems
)/(
DüMíuIãm
),

469 
pﬁyg⁄_míu_ôems
,

470 
NULL


473 
DüMíu
 *

474 
	$pﬁyg⁄_gë_obje˘_míu
(
Pﬁyg⁄
 *
pﬁyg⁄
, 
Poöt
 *
˛ickedpoöt
)

477 
pﬁyg⁄_míu_ôems
[0].
a˘ive
 = 1;

478 
pﬁyg⁄_míu_ôems
[1].
a˘ive
 = 
pﬁyg⁄
->
pﬁy
.
numpoöts
 > 3;

479  &
pﬁyg⁄_míu
;

480 
	}
}

	@O:\tool\dvs50\objects\standard\polyline.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<as£π.h
>

24 
	~<m©h.h
>

26 
	~"öé.h
"

27 
	~"obje˘.h
"

28 
	~"pﬁy_c⁄n.h
"

29 
	~"c⁄√˘i⁄poöt.h
"

30 
	~"düªndîî.h
"

31 
	~"©åibuãs.h
"

32 
	~"widgës.h
"

33 
	~"dümíu.h
"

34 
	~"mesßge.h
"

35 
	~"¥›îtõs.h
"

37 
	~"¸óã.h
"

39 
	~"toﬁ-ic⁄s.h
"

41 
	#DEFAULT_WIDTH
 0.15

	)

43 
	s_Pﬁylöe
 {

44 
PﬁyC⁄n
 
	mpﬁy
;

46 
Cﬁ‹
 
	mlöe_cﬁ‹
;

47 
LöeStyÀ
 
	mlöe_°yÀ
;

48 
ªÆ
 
	mdashÀngth
;

49 
ªÆ
 
	mlöe_width
;

50 
ªÆ
 
	mc‹√r_ødius
;

51 
Aºow
 
	m°¨t_¨row
, 
	míd_¨row
;

52 
ªÆ
 
	mabsﬁuã_°¨t_g≠
, 
	mabsﬁuã_íd_g≠
;

53 } 
	tPﬁylöe
;

56 
Obje˘Ch™ge
* 
pﬁylöe_move_h™dÀ
(
Pﬁylöe
 *
pﬁylöe
, 
H™dÀ
 *
h™dÀ
,

57 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

58 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

59 
Obje˘Ch™ge
* 
pﬁylöe_move
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
to
);

60 
pﬁylöe_£À˘
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
˛icked_poöt
,

61 
DüRídîî
 *
öãø˘ive_ªndîî
);

62 
pﬁylöe_døw
(
Pﬁylöe
 *
pﬁylöe
, 
DüRídîî
 *
ªndîî
);

63 
DüObje˘
 *
pﬁylöe_¸óã
(
Poöt
 *
°¨çoöt
,

64 *
u£r_d©a
,

65 
H™dÀ
 **
h™dÀ1
,

66 
H™dÀ
 **
h™dÀ2
);

67 
ªÆ
 
pﬁylöe_di°™˚_‰om
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
poöt
);

68 
pﬁylöe_upd©e_d©a
(
Pﬁylöe
 *
pﬁylöe
);

69 
pﬁylöe_de°roy
(
Pﬁylöe
 *
pﬁylöe
);

70 
DüObje˘
 *
pﬁylöe_c›y
(
Pﬁylöe
 *
pﬁylöe
);

72 
Pr›Des¸ùti⁄
 *
pﬁylöe_des¸ibe_¥›s
(
Pﬁylöe
 *
pﬁylöe
);

73 
pﬁylöe_gë_¥›s
(
Pﬁylöe
 *
pﬁylöe
, 
GPåAºay
 *
¥›s
);

74 
pﬁylöe_£t_¥›s
(
Pﬁylöe
 *
pﬁylöe
, 
GPåAºay
 *
¥›s
);

76 
pﬁylöe_ßve
(
Pﬁylöe
 *
pﬁylöe
, 
Obje˘Node
 
obj_node
,

77 c⁄° *
fûíame
);

78 
DüObje˘
 *
pﬁylöe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
,

79 c⁄° *
fûíame
);

80 
DüMíu
 *
pﬁylöe_gë_obje˘_míu
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
˛ickedpoöt
);

81 
pﬁylöe_ˇlcuœã_g≠_ídpoöts
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
g≠_ídpoöts
);

82 
pﬁylöe_exch™ge_g≠_poöts
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
g≠_poöts
);

84 
Obje˘Ty≥Ops
 
	gpﬁylöe_ty≥_›s
 =

86 (
Cª©eFunc
)
pﬁylöe_¸óã
,

87 (
LﬂdFunc
Ë
pﬁylöe_lﬂd
,

88 (
SaveFunc
Ë
pﬁylöe_ßve
,

89 (
GëDeÁu…sFunc
Ë
NULL
 ,

90 (
AµlyDeÁu…sFunc
Ë
NULL


93 
DüObje˘Ty≥
 
	gpﬁylöe_ty≥
 =

97 (**Ë
pﬁylöe_ic⁄
,

99 &
pﬁylöe_ty≥_›s
,

100 
NULL
,

104 
DüObje˘Ty≥
 *
	g_pﬁylöe_ty≥
 = (DüObje˘Ty≥ *Ë&
pﬁylöe_ty≥
;

107 
Obje˘Ops
 
	gpﬁylöe_›s
 = {

108 (
De°royFunc
Ë
pﬁylöe_de°roy
,

109 (
DøwFunc
Ë
pﬁylöe_døw
,

110 (
Di°™˚Func
Ë
pﬁylöe_di°™˚_‰om
,

111 (
Sñe˘Func
Ë
pﬁylöe_£À˘
,

112 (
C›yFunc
Ë
pﬁylöe_c›y
,

113 (
MoveFunc
Ë
pﬁylöe_move
,

114 (
MoveH™dÀFunc
Ë
pﬁylöe_move_h™dÀ
,

115 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

116 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

117 (
Obje˘MíuFunc
Ë
pﬁylöe_gë_obje˘_míu
,

118 (
Des¸ibePr›sFunc
Ë
pﬁylöe_des¸ibe_¥›s
,

119 (
GëPr›sFunc
Ë
pﬁylöe_gë_¥›s
,

120 (
SëPr›sFunc
Ë
pﬁylöe_£t_¥›s
,

121 (
TextEdôFunc
) 0,

122 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

125 
Pr›NumD©a
 
	gpﬁylöe_c‹√r_ødius_d©a
 = { 0.0, 10.0, 0.1 };

126 
Pr›NumD©a
 
	gg≠_ønge
 = { -
G_MAXFLOAT
, G_MAXFLOAT, 0.1};

128 
Pr›Des¸ùti⁄
 
	gpﬁylöe_¥›s
[] = {

129 
POLYCONN_COMMON_PROPERTIES
,

130 
PROP_STD_LINE_WIDTH
,

131 
PROP_STD_LINE_COLOUR
,

132 
PROP_STD_LINE_STYLE
,

133 
PROP_STD_START_ARROW
,

134 
PROP_STD_END_ARROW
,

135 { "c‹√r_ødius", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

136 
N_
("C‹√∏ødius"), 
NULL
, &
pﬁylöe_c‹√r_ødius_d©a
 },

137 
PROP_FRAME_BEGIN
("g≠s",0,
N_
("Line gaps")),

138 { "absﬁuã_°¨t_g≠", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

139 
N_
("Absﬁuã sèπ g≠"), 
NULL
, &
g≠_ønge
 },

140 { "absﬁuã_íd_g≠", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

141 
N_
("AbsﬁuãÉnd g≠"), 
NULL
, &
g≠_ønge
 },

142 
PROP_FRAME_END
("gaps",0),

143 
PROP_DESC_END


146 
Pr›Des¸ùti⁄
 *

147 
	$pﬁylöe_des¸ibe_¥›s
(
Pﬁylöe
 *
pﬁylöe
)

149 i‡(
pﬁylöe_¥›s
[0].
qu¨k
 == 0)

150 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
pﬁylöe_¥›s
);

151  
pﬁylöe_¥›s
;

152 
	}
}

154 
Pr›Off£t
 
	gpﬁylöe_off£ts
[] = {

155 
POLYCONN_COMMON_PROPERTIES_OFFSETS
,

156 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Pﬁylöe
, 
löe_width
) },

157 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Pﬁylöe
, 
löe_cﬁ‹
) },

158 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

159 
off£tof
(
Pﬁylöe
, 
löe_°yÀ
), off£tof(Pﬁylöe, 
dashÀngth
) },

160 { "°¨t_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Pﬁylöe
, 
°¨t_¨row
) },

161 { "íd_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Pﬁylöe
, 
íd_¨row
) },

162 { "c‹√r_ødius", 
PROP_TYPE_REAL
, 
off£tof
(
Pﬁylöe
, 
c‹√r_ødius
) },

163 
PROP_OFFSET_FRAME_BEGIN
("gaps"),

164 { "absﬁuã_°¨t_g≠", 
PROP_TYPE_REAL
, 
off£tof
(
Pﬁylöe
, 
absﬁuã_°¨t_g≠
) },

165 { "absﬁuã_íd_g≠", 
PROP_TYPE_REAL
, 
off£tof
(
Pﬁylöe
, 
absﬁuã_íd_g≠
) },

166 
PROP_OFFSET_FRAME_END
("gaps"),

167 { 
NULL
, 0, 0 }

171 
	$pﬁylöe_gë_¥›s
(
Pﬁylöe
 *
pﬁylöe
, 
GPåAºay
 *
¥›s
)

173 
	`obje˘_gë_¥›s_‰om_off£ts
(&
pﬁylöe
->
pﬁy
.
obje˘
, 
pﬁylöe_off£ts
,

174 
¥›s
);

175 
	}
}

178 
	$pﬁylöe_£t_¥›s
(
Pﬁylöe
 *
pﬁylöe
, 
GPåAºay
 *
¥›s
)

180 
	`obje˘_£t_¥›s_‰om_off£ts
(&
pﬁylöe
->
pﬁy
.
obje˘
, 
pﬁylöe_off£ts
,

181 
¥›s
);

182 
	`pﬁylöe_upd©e_d©a
(
pﬁylöe
);

183 
	}
}

185 
ªÆ


186 
	$pﬁylöe_di°™˚_‰om
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
poöt
)

188 
PﬁyC⁄n
 *
pﬁy
 = &
pﬁylöe
->poly;

189 
ªÆ
 
di°
;

190 
Poöt
 
g≠_ídpoöts
[2];

191 
	`pﬁylöe_ˇlcuœã_g≠_ídpoöts
(
pﬁylöe
, 
g≠_ídpoöts
);

192 
	`pﬁylöe_exch™ge_g≠_poöts
(
pﬁylöe
, 
g≠_ídpoöts
);

193 
di°
 = 
	`pﬁyc⁄n_di°™˚_‰om
(
pﬁy
, 
poöt
, 
pﬁylöe
->
löe_width
);

194 
	`pﬁylöe_exch™ge_g≠_poöts
(
pﬁylöe
, 
g≠_ídpoöts
);

195  
di°
;

196 
	}
}

198 
H™dÀ
 *
	$pﬁylöe_˛o£°_h™dÀ
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
poöt
) {

199  
	`pﬁyc⁄n_˛o£°_h™dÀ
(&
pﬁylöe
->
pﬁy
, 
poöt
);

200 
	}
}

202 
	$pﬁylöe_˛o£°_£gmít
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
poöt
) {

203 
PﬁyC⁄n
 *
pﬁy
 = &
pﬁylöe
->poly;

204  
	`pﬁyc⁄n_˛o£°_£gmít
(
pﬁy
, 
poöt
, 
pﬁylöe
->
löe_width
);

205 
	}
}

208 
	$pﬁylöe_£À˘
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
˛icked_poöt
,

209 
DüRídîî
 *
öãø˘ive_ªndîî
)

211 
	`pﬁyc⁄n_upd©e_d©a
(&
pﬁylöe
->
pﬁy
);

212 
	}
}

214 
Obje˘Ch™ge
*

215 
	$pﬁylöe_move_h™dÀ
(
Pﬁylöe
 *
pﬁylöe
, 
H™dÀ
 *
h™dÀ
,

216 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

217 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

219 
	`as£π
(
pﬁylöe
!=
NULL
);

220 
	`as£π
(
h™dÀ
!=
NULL
);

221 
	`as£π
(
to
!=
NULL
);

223 
	`pﬁyc⁄n_move_h™dÀ
(&
pﬁylöe
->
pﬁy
, 
h™dÀ
, 
to
, 
˝
, 
ªas⁄
, 
modifõrs
);

224 
	`pﬁylöe_upd©e_d©a
(
pﬁylöe
);

226  
NULL
;

227 
	}
}

230 
Obje˘Ch™ge
*

231 
	$pﬁylöe_move
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
to
)

233 
	`pﬁyc⁄n_move
(&
pﬁylöe
->
pﬁy
, 
to
);

234 
	`pﬁylöe_upd©e_d©a
(
pﬁylöe
);

236  
NULL
;

237 
	}
}

240 
	$pﬁylöe_ˇlcuœã_g≠_ídpoöts
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
g≠_ídpoöts
)

242 
Poöt
 
°¨t_vec
, 
íd_vec
;

243 
C⁄√˘i⁄Poöt
 *
°¨t_˝
, *
íd_˝
;

244 
n
 = 
pﬁylöe
->
pﬁy
.
numpoöts
;

246 
g≠_ídpoöts
[0] = 
pﬁylöe
->
pﬁy
.
poöts
[0];

247 
g≠_ídpoöts
[1] = 
pﬁylöe
->
pﬁy
.
poöts
[
n
-1];

249 
°¨t_˝
 = (
pﬁylöe
->
pﬁy
.
obje˘
.
h™dÀs
[0])->
c⁄√˘ed_to
;

250 
íd_˝
 = (
pﬁylöe
->
pﬁy
.
obje˘
.
h™dÀs
[pﬁylöe->pﬁy.obje˘.
num_h™dÀs
-1])->
c⁄√˘ed_to
;

252 i‡(
	`c⁄≈oöt_is_autog≠
(
°¨t_˝
)) {

253 
g≠_ídpoöts
[0] = 
	`ˇlcuœã_obje˘_edge
(&gap_endpoints[0],

254 &
pﬁylöe
->
pﬁy
.
poöts
[1],

255 
°¨t_˝
->
obje˘
);

257 i‡(
	`c⁄≈oöt_is_autog≠
(
íd_˝
)) {

258 
g≠_ídpoöts
[1] = 
	`ˇlcuœã_obje˘_edge
(&gap_endpoints[1],

259 &
pﬁylöe
->
pﬁy
.
poöts
[
n
-2],

260 
íd_˝
->
obje˘
);

263 
°¨t_vec
 = 
g≠_ídpoöts
[0];

264 
	`poöt_sub
(&
°¨t_vec
, &
pﬁylöe
->
pﬁy
.
poöts
[0]);

265 
	`poöt_n‹mÆize
(&
°¨t_vec
);

267 
íd_vec
 = 
g≠_ídpoöts
[1];

268 
	`poöt_sub
(&
íd_vec
, &
pﬁylöe
->
pﬁy
.
poöts
[
n
-1]);

269 
	`poöt_n‹mÆize
(&
íd_vec
);

272 
	`poöt_add_sˇÀd
(&
g≠_ídpoöts
[0], &
°¨t_vec
, 
pﬁylöe
->
absﬁuã_°¨t_g≠
);

273 
	`poöt_add_sˇÀd
(&
g≠_ídpoöts
[1], &
íd_vec
, 
pﬁylöe
->
absﬁuã_íd_g≠
);

274 
	}
}

276 
	$pﬁylöe_exch™ge_g≠_poöts
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
g≠_poöts
)

278 
Poöt
 
tmp
[2];

279 
n
 = 
pﬁylöe
->
pﬁy
.
numpoöts
;

280 
tmp
[0] = 
g≠_poöts
[0];

281 
tmp
[1] = 
g≠_poöts
[1];

282 
g≠_poöts
[0] = 
pﬁylöe
->
pﬁy
.
poöts
[0];

283 
g≠_poöts
[1] = 
pﬁylöe
->
pﬁy
.
poöts
[
n
-1];

284 
pﬁylöe
->
pﬁy
.
poöts
[0] = 
tmp
[0];

285 
pﬁylöe
->
pﬁy
.
poöts
[
n
-1] = 
tmp
[1];

286 
	}
}

290 
	$pﬁylöe_døw
(
Pﬁylöe
 *
pﬁylöe
, 
DüRídîî
 *
ªndîî
)

292 
Poöt
 
g≠_ídpoöts
[2];

293 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

294 
PﬁyC⁄n
 *
pﬁy
 = &
pﬁylöe
->poly;

295 
Poöt
 *
poöts
;

296 
n
;

298 
poöts
 = &
pﬁy
->points[0];

299 
n
 = 
pﬁy
->
numpoöts
;

300 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
pﬁylöe
->
löe_width
);

301 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
pﬁylöe
->
löe_°yÀ
);

302 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
pﬁylöe
->
dashÀngth
);

303 i‡(
pﬁylöe
->
c‹√r_ødius
 > 0.0)

304 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_ROUND
);

306 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_MITER
);

307 
ªndîî_›s
->
	`£t_löeˇps
(
ªndîî
, 
LINECAPS_BUTT
);

309 
	`pﬁylöe_ˇlcuœã_g≠_ídpoöts
(
pﬁylöe
, 
g≠_ídpoöts
);

310 
	`pﬁylöe_exch™ge_g≠_poöts
(
pﬁylöe
, 
g≠_ídpoöts
);

311 
ªndîî_›s
->
	`døw_rounded_pﬁylöe_wôh_¨rows
(
ªndîî
,

312 
poöts
, 
n
,

313 
pﬁylöe
->
löe_width
,

314 &
pﬁylöe
->
löe_cﬁ‹
,

315 &
pﬁylöe
->
°¨t_¨row
,

316 &
pﬁylöe
->
íd_¨row
,

317 
pﬁylöe
->
c‹√r_ødius
);

318 
	`pﬁylöe_exch™ge_g≠_poöts
(
pﬁylöe
, 
g≠_ídpoöts
);

319 
	}
}

326 
DüObje˘
 *

327 
	$pﬁylöe_¸óã
(
Poöt
 *
°¨çoöt
,

328 *
u£r_d©a
,

329 
H™dÀ
 **
h™dÀ1
,

330 
H™dÀ
 **
h™dÀ2
)

332 
Pﬁylöe
 *
pﬁylöe
;

333 
PﬁyC⁄n
 *
pﬁy
;

334 
DüObje˘
 *
obj
;

335 
Poöt
 
deÁu…Àn
 = { 1.0, 1.0 };

338 
pﬁylöe
 = 
	`g_mÆloc0
((
Pﬁylöe
));

339 
pﬁy
 = &
pﬁylöe
->poly;

340 
obj
 = &
pﬁy
->
obje˘
;

342 
obj
->
ty≥
 = &
pﬁylöe_ty≥
;

343 
obj
->
›s
 = &
pﬁylöe_›s
;

345 i‡(
u£r_d©a
 =
NULL
) {

346 
	`pﬁyc⁄n_öô
(
pﬁy
, 2);

348 
pﬁy
->
poöts
[0] = *
°¨çoöt
;

349 
pﬁy
->
poöts
[1] = *
°¨çoöt
;

351 
	`poöt_add
(&
pﬁy
->
poöts
[1], &
deÁu…Àn
);

353 *
h™dÀ1
 = 
pﬁy
->
obje˘
.
h™dÀs
[0];

354 *
h™dÀ2
 = 
pﬁy
->
obje˘
.
h™dÀs
[1];

356 
Mu…ùoötCª©eD©a
 *
pcd
 = (Mu…ùoötCª©eD©®*)
u£r_d©a
;

358 
	`pﬁyc⁄n_öô
(
pﬁy
, 
pcd
->
num_poöts
);

361 
	`pﬁyc⁄n_£t_poöts
(
pﬁy
, 
pcd
->
num_poöts
,Öcd->
poöts
);

363 *
h™dÀ1
 = 
pﬁy
->
obje˘
.
h™dÀs
[0];

364 *
h™dÀ2
 = 
pﬁy
->
obje˘
.
h™dÀs
[
pcd
->
num_poöts
-1];

368 
pﬁylöe
->
löe_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

369 
pﬁylöe
->
löe_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

370 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
pﬁylöe
->
löe_°yÀ
,

371 &
pﬁylöe
->
dashÀngth
);

372 
pﬁylöe
->
°¨t_¨row
 = 
	`©åibuãs_gë_deÁu…_°¨t_¨row
();

373 
pﬁylöe
->
íd_¨row
 = 
	`©åibuãs_gë_deÁu…_íd_¨row
();

374 
pﬁylöe
->
c‹√r_ødius
 = 0.0;

376 
	`pﬁylöe_upd©e_d©a
(
pﬁylöe
);

378  &
pﬁylöe
->
pﬁy
.
obje˘
;

379 
	}
}

382 
	$pﬁylöe_de°roy
(
Pﬁylöe
 *
pﬁylöe
)

384 
	`pﬁyc⁄n_de°roy
(&
pﬁylöe
->
pﬁy
);

385 
	}
}

387 
DüObje˘
 *

388 
	$pﬁylöe_c›y
(
Pﬁylöe
 *
pﬁylöe
)

390 
Pﬁylöe
 *
√wpﬁylöe
;

391 
PﬁyC⁄n
 *
pﬁy
, *
√wpﬁy
;

392 
DüObje˘
 *
√wobj
;

394 
pﬁy
 = &
pﬁylöe
->poly;

396 
√wpﬁylöe
 = 
	`g_mÆloc0
((
Pﬁylöe
));

397 
√wpﬁy
 = &
√wpﬁylöe
->
pﬁy
;

398 
√wobj
 = &
√wpﬁy
->
obje˘
;

400 
	`pﬁyc⁄n_c›y
(
pﬁy
, 
√wpﬁy
);

402 
√wpﬁylöe
->
löe_cﬁ‹
 = 
pﬁylöe
->line_color;

403 
√wpﬁylöe
->
löe_width
 = 
pﬁylöe
->line_width;

404 
√wpﬁylöe
->
löe_°yÀ
 = 
pﬁylöe
->line_style;

405 
√wpﬁylöe
->
dashÀngth
 = 
pﬁylöe
->dashlength;

406 
√wpﬁylöe
->
°¨t_¨row
 = 
pﬁylöe
->start_arrow;

407 
√wpﬁylöe
->
íd_¨row
 = 
pﬁylöe
->end_arrow;

408 
√wpﬁylöe
->
c‹√r_ødius
 = 
pﬁylöe
->corner_radius;

409 
√wpﬁylöe
->
absﬁuã_°¨t_g≠
 = 
pﬁylöe
->absolute_start_gap;

410 
√wpﬁylöe
->
absﬁuã_íd_g≠
 = 
pﬁylöe
->absolute_end_gap;

412 
	`pﬁylöe_upd©e_d©a
(
√wpﬁylöe
);

414  &
√wpﬁylöe
->
pﬁy
.
obje˘
;

415 
	}
}

418 
	$pﬁylöe_upd©e_d©a
(
Pﬁylöe
 *
pﬁylöe
)

420 
PﬁyC⁄n
 *
pﬁy
 = &
pﬁylöe
->poly;

421 
DüObje˘
 *
obj
 = &
pﬁy
->
obje˘
;

422 
PﬁyBBExåas
 *
exåa
 = &
pﬁy
->
exåa_•acög
;

423 
Poöt
 
g≠_ídpoöts
[2];

425 
	`pﬁyc⁄n_upd©e_d©a
(&
pﬁylöe
->
pﬁy
);

427 
exåa
->
°¨t_å™s
 = (
pﬁylöe
->
löe_width
 / 2.0);

428 
exåa
->
íd_å™s
 = (
pﬁylöe
->
löe_width
 / 2.0);

429 
exåa
->
middÀ_å™s
 = (
pﬁylöe
->
löe_width
 / 2.0);

430 
exåa
->
°¨t_l⁄g
 = (
pﬁylöe
->
löe_width
 / 2.0);

431 
exåa
->
íd_l⁄g
 = (
pﬁylöe
->
löe_width
 / 2.0);

433 
	`pﬁylöe_ˇlcuœã_g≠_ídpoöts
(
pﬁylöe
, 
g≠_ídpoöts
);

434 
	`pﬁylöe_exch™ge_g≠_poöts
(
pﬁylöe
, 
g≠_ídpoöts
);

436 
	`pﬁyc⁄n_upd©e_boundögbox
(
pﬁy
);

438 i‡(
pﬁylöe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

439 
Re˘™gÀ
 
bbox
;

440 
Poöt
 
move_¨row
, 
move_löe
;

441 
Poöt
 
to
 = 
g≠_ídpoöts
[0];

442 
Poöt
 
‰om
 = 
pﬁy
->
poöts
[1];

443 
	`ˇlcuœã_¨row_poöt
(&
pﬁylöe
->
°¨t_¨row
, &
to
, &
‰om
,

444 &
move_¨row
, &
move_löe
, 
pﬁylöe
->
löe_width
);

446 
	`poöt_sub
(&
to
, &
move_¨row
);

447 
	`poöt_sub
(&
‰om
, &
move_löe
);

449 
	`¨row_bbox
 (&
pﬁylöe
->
°¨t_¨row
,Öﬁylöe->
löe_width
, &
to
, &
‰om
, &
bbox
);

450 
	`ª˘™gÀ_uni⁄
 (&
obj
->
boundög_box
, &
bbox
);

452 i‡(
pﬁylöe
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

453 
Re˘™gÀ
 
bbox
;

454 
n
 = 
pﬁylöe
->
pﬁy
.
numpoöts
;

455 
Poöt
 
move_¨row
, 
move_löe
;

456 
Poöt
 
to
 = 
g≠_ídpoöts
[1];

457 
Poöt
 
‰om
 = 
pﬁy
->
poöts
[
n
-2];

458 
	`ˇlcuœã_¨row_poöt
(&
pﬁylöe
->
°¨t_¨row
, &
to
, &
‰om
,

459 &
move_¨row
, &
move_löe
, 
pﬁylöe
->
löe_width
);

461 
	`poöt_sub
(&
to
, &
move_¨row
);

462 
	`poöt_sub
(&
‰om
, &
move_löe
);

464 
	`¨row_bbox
 (&
pﬁylöe
->
íd_¨row
,Öﬁylöe->
löe_width
, &
to
, &
‰om
, &
bbox
);

465 
	`ª˘™gÀ_uni⁄
 (&
obj
->
boundög_box
, &
bbox
);

468 
	`pﬁylöe_exch™ge_g≠_poöts
(
pﬁylöe
, 
g≠_ídpoöts
);

470 
obj
->
posôi⁄
 = 
pﬁy
->
poöts
[0];

471 
	}
}

474 
	$pﬁylöe_ßve
(
Pﬁylöe
 *
pﬁylöe
, 
Obje˘Node
 
obj_node
,

475 c⁄° *
fûíame
)

477 
	`pﬁyc⁄n_ßve
(&
pﬁylöe
->
pﬁy
, 
obj_node
);

479 i‡(!
	`cﬁ‹_equÆs
(&
pﬁylöe
->
löe_cﬁ‹
, &
cﬁ‹_bœck
))

480 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "line_color"),

481 &
pﬁylöe
->
löe_cﬁ‹
);

483 i‡(
pﬁylöe
->
löe_width
 != 0.1)

484 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

485 
pﬁylöe
->
löe_width
);

487 i‡(
pﬁylöe
->
löe_°yÀ
 !
LINESTYLE_SOLID
)

488 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

489 
pﬁylöe
->
löe_°yÀ
);

491 i‡(
pﬁylöe
->
löe_°yÀ
 !
LINESTYLE_SOLID
 &&

492 
pﬁylöe
->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

493 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

494 
pﬁylöe
->
dashÀngth
);

496 i‡(
pﬁylöe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

497 
	`ßve_¨row
(
obj_node
, &
pﬁylöe
->
°¨t_¨row
, "start_arrow",

501 i‡(
pﬁylöe
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

502 
	`ßve_¨row
(
obj_node
, &
pﬁylöe
->
íd_¨row
, "end_arrow",

506 i‡(
pﬁylöe
->
absﬁuã_°¨t_g≠
)

507 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "absolute_start_gap"),

508 
pﬁylöe
->
absﬁuã_°¨t_g≠
);

509 i‡(
pﬁylöe
->
absﬁuã_íd_g≠
)

510 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "absolute_end_gap"),

511 
pﬁylöe
->
absﬁuã_íd_g≠
);

513 i‡(
pﬁylöe
->
c‹√r_ødius
 > 0.0)

514 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "corner_radius"),

515 
pﬁylöe
->
c‹√r_ødius
);

516 
	}
}

518 
DüObje˘
 *

519 
	$pﬁylöe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

521 
Pﬁylöe
 *
pﬁylöe
;

522 
PﬁyC⁄n
 *
pﬁy
;

523 
DüObje˘
 *
obj
;

524 
AâribuãNode
 
©å
;

526 
pﬁylöe
 = 
	`g_mÆloc0
((
Pﬁylöe
));

528 
pﬁy
 = &
pﬁylöe
->poly;

529 
obj
 = &
pﬁy
->
obje˘
;

531 
obj
->
ty≥
 = &
pﬁylöe_ty≥
;

532 
obj
->
›s
 = &
pﬁylöe_›s
;

534 
	`pﬁyc⁄n_lﬂd
(
pﬁy
, 
obj_node
);

536 
pﬁylöe
->
löe_cﬁ‹
 = 
cﬁ‹_bœck
;

537 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_color");

538 i‡(
©å
 !
NULL
)

539 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
pﬁylöe
->
löe_cﬁ‹
);

541 
pﬁylöe
->
löe_width
 = 0.1;

542 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

543 i‡(
©å
 !
NULL
)

544 
pﬁylöe
->
löe_width
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

546 
pﬁylöe
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

547 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

548 i‡(
©å
 !
NULL
)

549 
pﬁylöe
->
löe_°yÀ
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

551 
pﬁylöe
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

552 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

553 i‡(
©å
 !
NULL
)

554 
pﬁylöe
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

556 
	`lﬂd_¨row
(
obj_node
, &
pﬁylöe
->
°¨t_¨row
, "start_arrow",

559 
	`lﬂd_¨row
(
obj_node
, &
pﬁylöe
->
íd_¨row
, "end_arrow",

562 
pﬁylöe
->
absﬁuã_°¨t_g≠
 = 0.0;

563 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "absolute_start_gap");

564 i‡(
©å
 !
NULL
)

565 
pﬁylöe
->
absﬁuã_°¨t_g≠
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

566 
pﬁylöe
->
absﬁuã_íd_g≠
 = 0.0;

567 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "absolute_end_gap");

568 i‡(
©å
 !
NULL
)

569 
pﬁylöe
->
absﬁuã_íd_g≠
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

572 
pﬁylöe
->
c‹√r_ødius
 = 0.0;

573 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "corner_radius");

574 i‡(
©å
 !
NULL
)

575 
pﬁylöe
->
c‹√r_ødius
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

577 
	`pﬁylöe_upd©e_d©a
(
pﬁylöe
);

579  &
pﬁylöe
->
pﬁy
.
obje˘
;

580 
	}
}

582 
Obje˘Ch™ge
 *

583 
	$pﬁylöe_add_c‹√r_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

585 
Pﬁylöe
 *
pﬁy
 = (Pﬁylöe*Ë
obj
;

586 
£gmít
;

587 
Obje˘Ch™ge
 *
ch™ge
;

589 
£gmít
 = 
	`pﬁylöe_˛o£°_£gmít
(
pﬁy
, 
˛icked
);

590 
ch™ge
 = 
	`pﬁyc⁄n_add_poöt
(&
pﬁy
->pﬁy, 
£gmít
, 
˛icked
);

591 
	`pﬁylöe_upd©e_d©a
(
pﬁy
);

592  
ch™ge
;

593 
	}
}

595 
Obje˘Ch™ge
 *

596 
	$pﬁylöe_dñëe_c‹√r_ˇŒback
 (
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

598 
H™dÀ
 *
h™dÀ
;

599 
h™dÀ_ƒ
, 
i
;

600 
Pﬁylöe
 *
pﬁy
 = (Pﬁylöe*Ë
obj
;

601 
Obje˘Ch™ge
 *
ch™ge
;

603 
h™dÀ
 = 
	`pﬁylöe_˛o£°_h™dÀ
(
pﬁy
, 
˛icked
);

605 
i
 = 0; i < 
obj
->
num_h™dÀs
; i++) {

606 i‡(
h™dÀ
 =
obj
->
h™dÀs
[
i
]) ;

608 
h™dÀ_ƒ
 = 
i
;

609 
ch™ge
 = 
	`pﬁyc⁄n_ªmove_poöt
(&
pﬁy
->pﬁy, 
h™dÀ_ƒ
);

610 
	`pﬁylöe_upd©e_d©a
(
pﬁy
);

611  
ch™ge
;

612 
	}
}

615 
DüMíuIãm
 
	gpﬁylöe_míu_ôems
[] = {

616 { 
N_
("Add C‹√r"), 
pﬁylöe_add_c‹√r_ˇŒback
, 
NULL
, 1 },

617 { 
N_
("DñëêC‹√r"), 
pﬁylöe_dñëe_c‹√r_ˇŒback
, 
NULL
, 1 },

620 
DüMíu
 
	gpﬁylöe_míu
 = {

622 (
pﬁylöe_míu_ôems
)/(
DüMíuIãm
),

623 
pﬁylöe_míu_ôems
,

624 
NULL


627 
DüMíu
 *

628 
	$pﬁylöe_gë_obje˘_míu
(
Pﬁylöe
 *
pﬁylöe
, 
Poöt
 *
˛ickedpoöt
)

631 
pﬁylöe_míu_ôems
[0].
a˘ive
 = 1;

632 
pﬁylöe_míu_ôems
[1].
a˘ive
 = 
pﬁylöe
->
pﬁy
.
numpoöts
 > 2;

633  &
pﬁylöe_míu
;

634 
	}
}

	@O:\tool\dvs50\objects\standard\standard.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~"obje˘.h
"

24 
	~"shìt.h
"

25 
	~"öé.h
"

26 
	~"∂ug-ös.h
"

29 
DüObje˘Ty≥
 *
_¨c_ty≥
;

30 
DüObje˘Ty≥
 *
_box_ty≥
;

31 
DüObje˘Ty≥
 *
_ñlù£_ty≥
;

32 
DüObje˘Ty≥
 *
_löe_ty≥
;

33 
DüObje˘Ty≥
 *
_zigzaglöe_ty≥
;

34 
DüObje˘Ty≥
 *
_pﬁylöe_ty≥
;

35 
DüObje˘Ty≥
 *
_bezõæöe_ty≥
;

36 
DüObje˘Ty≥
 *
_ãxtobj_ty≥
;

37 
DüObje˘Ty≥
 *
_image_ty≥
;

38 
DüObje˘Ty≥
 *
_ouéöe_ty≥
;

39 
DüObje˘Ty≥
 *
_pﬁyg⁄_ty≥
;

40 
DüObje˘Ty≥
 *
_bezõrg⁄_ty≥
;

42 
DIA_PLUGIN_CHECK_INIT


45 
PlugöInôResu…


46 
	$dü_∂ugö_öô
(
PlugöInfo
 *
öfo
)

48 i‡(!
	`dü_∂ugö_öfo_öô
(
öfo
, "Sènd¨d", 
	`_
("Standard objects"),

49 
NULL
, NULL))

50  
DIA_PLUGIN_INIT_ERROR
;

52 
	`obje˘_ªgi°î_ty≥
(
_¨c_ty≥
);

53 
	`obje˘_ªgi°î_ty≥
(
_box_ty≥
);

54 
	`obje˘_ªgi°î_ty≥
(
_ñlù£_ty≥
);

55 
	`obje˘_ªgi°î_ty≥
(
_löe_ty≥
);

56 
	`obje˘_ªgi°î_ty≥
(
_pﬁylöe_ty≥
);

57 
	`obje˘_ªgi°î_ty≥
(
_zigzaglöe_ty≥
);

58 
	`obje˘_ªgi°î_ty≥
(
_bezõæöe_ty≥
);

59 
	`obje˘_ªgi°î_ty≥
(
_ãxtobj_ty≥
);

60 
	`obje˘_ªgi°î_ty≥
(
_image_ty≥
);

61 #ifde‡
HAVE_CAIRO


62 
	`obje˘_ªgi°î_ty≥
(
_ouéöe_ty≥
);

67  
DIA_PLUGIN_INIT_OK
;

68 
	}
}

	@O:\tool\dvs50\objects\standard\textobj.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<as£π.h
>

24 
	~<m©h.h
>

26 
	~"öé.h
"

27 
	~"obje˘.h
"

28 
	~"c⁄√˘i⁄poöt.h
"

29 
	~"düªndîî.h
"

30 
	~"f⁄t.h
"

31 
	~"ãxt.h
"

32 
	~"©åibuãs.h
"

33 
	~"widgës.h
"

34 
	~"¥›îtõs.h
"

36 
	~"toﬁ-ic⁄s.h
"

38 
	#HANDLE_TEXT
 
HANDLE_CUSTOM1


	)

41 
_VÆign
 
	tVÆign
;

42 
	e_VÆign
 {

43 
	mVALIGN_TOP
,

44 
	mVALIGN_BOTTOM
,

45 
	mVALIGN_CENTER
,

46 
	mVALIGN_FIRST_LINE


48 
_Textobj
 
	tTextobj
;

49 
	s_Textobj
 {

50 
DüObje˘
 
	mobje˘
;

52 
H™dÀ
 
	mãxt_h™dÀ
;

54 
Text
 *
	mãxt
;

55 
TextAâribuãs
 
	m©ås
;

56 
VÆign
 
	mvît_Æign
;

58 
Cﬁ‹
 
	mfûl_cﬁ‹
;

59 
gboﬁón
 
	mshow_background
;

62 
	s_TextobjPr›îtõs
 {

63 
Alignmít
 
	mÆignmít
;

64 
VÆign
 
	mvît_Æign
;

65 } 
	gdeÁu…_¥›îtõs
 = { 
ALIGN_LEFT
, 
VALIGN_FIRST_LINE
 } ;

67 
ªÆ
 
ãxtobj_di°™˚_‰om
(
Textobj
 *
ãxtobj
, 
Poöt
 *
poöt
);

68 
ãxtobj_£À˘
(
Textobj
 *
ãxtobj
, 
Poöt
 *
˛icked_poöt
,

69 
DüRídîî
 *
öãø˘ive_ªndîî
);

70 
Obje˘Ch™ge
* 
ãxtobj_move_h™dÀ
(
Textobj
 *
ãxtobj
, 
H™dÀ
 *
h™dÀ
,

71 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

72 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

73 
Obje˘Ch™ge
* 
ãxtobj_move
(
Textobj
 *
ãxtobj
, 
Poöt
 *
to
);

74 
ãxtobj_døw
(
Textobj
 *
ãxtobj
, 
DüRídîî
 *
ªndîî
);

75 
ãxtobj_upd©e_d©a
(
Textobj
 *
ãxtobj
);

76 
DüObje˘
 *
ãxtobj_¸óã
(
Poöt
 *
°¨çoöt
,

77 *
u£r_d©a
,

78 
H™dÀ
 **
h™dÀ1
,

79 
H™dÀ
 **
h™dÀ2
);

80 
ãxtobj_de°roy
(
Textobj
 *
ãxtobj
);

82 
Pr›Des¸ùti⁄
 *
ãxtobj_des¸ibe_¥›s
(
Textobj
 *
ãxtobj
);

83 
ãxtobj_gë_¥›s
(
Textobj
 *
ãxtobj
, 
GPåAºay
 *
¥›s
);

84 
ãxtobj_£t_¥›s
(
Textobj
 *
ãxtobj
, 
GPåAºay
 *
¥›s
);

86 
ãxtobj_ßve
(
Textobj
 *
ãxtobj
, 
Obje˘Node
 
obj_node
,

87 c⁄° *
fûíame
);

88 
DüObje˘
 *
ãxtobj_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
,

89 c⁄° *
fûíame
);

90 
ãxtobj_vÆign_poöt
(
Textobj
 *
ãxtobj
, 
Poöt
* 
p
, 
ªÆ
 
Á˘‹
);

92 
Obje˘Ty≥Ops
 
	gãxtobj_ty≥_›s
 =

94 (
Cª©eFunc
Ë
ãxtobj_¸óã
,

95 (
LﬂdFunc
Ë
ãxtobj_lﬂd
,

96 (
SaveFunc
Ë
ãxtobj_ßve
,

97 (
GëDeÁu…sFunc
Ë
NULL
,

98 (
AµlyDeÁu…sFunc
Ë
NULL


106 
DüObje˘Ty≥
 
	gãxtobj_ty≥
 =

110 (**Ë
ãxt_ic⁄
,

112 &
ãxtobj_ty≥_›s


115 
DüObje˘Ty≥
 *
	g_ãxtobj_ty≥
 = (DüObje˘Ty≥ *Ë&
ãxtobj_ty≥
;

117 
Obje˘Ops
 
	gãxtobj_›s
 = {

118 (
De°royFunc
Ë
ãxtobj_de°roy
,

119 (
DøwFunc
Ë
ãxtobj_døw
,

120 (
Di°™˚Func
Ë
ãxtobj_di°™˚_‰om
,

121 (
Sñe˘Func
Ë
ãxtobj_£À˘
,

122 (
C›yFunc
Ë
obje˘_c›y_usög_¥›îtõs
,

123 (
MoveFunc
Ë
ãxtobj_move
,

124 (
MoveH™dÀFunc
Ë
ãxtobj_move_h™dÀ
,

125 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

126 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

127 (
Obje˘MíuFunc
Ë
NULL
,

128 (
Des¸ibePr›sFunc
Ë
ãxtobj_des¸ibe_¥›s
,

129 (
GëPr›sFunc
Ë
ãxtobj_gë_¥›s
,

130 (
SëPr›sFunc
Ë
ãxtobj_£t_¥›s
,

131 (
TextEdôFunc
) 0,

132 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

135 
Pr›EnumD©a
 
	g¥›_ãxt_vît_Æign_d©a
[] = {

136 { 
N_
("BŸtom"), 
VALIGN_BOTTOM
 },

137 { 
N_
("T›"), 
VALIGN_TOP
 },

138 { 
N_
("Cíãr"), 
VALIGN_CENTER
 },

139 { 
N_
("Fú° Löe"), 
VALIGN_FIRST_LINE
 },

140 { 
NULL
, 0 }

142 
Pr›Des¸ùti⁄
 
	gãxtobj_¥›s
[] = {

143 
OBJECT_COMMON_PROPERTIES
,

144 
PROP_STD_TEXT_ALIGNMENT
,

145 { "ãxt_vît_Æignmít", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
, \

146 
N_
("Vîtiˇ»ãxàÆignmít"), 
NULL
, 
¥›_ãxt_vît_Æign_d©a
 },

147 
PROP_STD_TEXT_FONT
,

148 
PROP_STD_TEXT_HEIGHT
,

149 
PROP_STD_TEXT_COLOUR
,

150 
PROP_STD_SAVED_TEXT
,

151 
PROP_STD_FILL_COLOUR_OPTIONAL
,

152 
PROP_STD_SHOW_BACKGROUND_OPTIONAL
,

153 
PROP_DESC_END


156 
Pr›Des¸ùti⁄
 *

157 
	$ãxtobj_des¸ibe_¥›s
(
Textobj
 *
ãxtobj
)

159 i‡(
ãxtobj_¥›s
[0].
qu¨k
 == 0)

160 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
ãxtobj_¥›s
);

161  
ãxtobj_¥›s
;

162 
	}
}

164 
Pr›Off£t
 
	gãxtobj_off£ts
[] = {

165 
OBJECT_COMMON_PROPERTIES_OFFSETS
,

166 {"ãxt",
PROP_TYPE_TEXT
,
off£tof
(
Textobj
,
ãxt
)},

167 {"ãxt_f⁄t",
PROP_TYPE_FONT
,
off£tof
(
Textobj
,
©ås
.
f⁄t
)},

168 {
PROP_STDNAME_TEXT_HEIGHT
,
PROP_STDTYPE_TEXT_HEIGHT
,
off£tof
(
Textobj
,
©ås
.
height
)},

169 {"ãxt_cﬁour",
PROP_TYPE_COLOUR
,
off£tof
(
Textobj
,
©ås
.
cﬁ‹
)},

170 {"ãxt_Æignmít",
PROP_TYPE_ENUM
,
off£tof
(
Textobj
,
©ås
.
Æignmít
)},

171 {"ãxt_vît_Æignmít",
PROP_TYPE_ENUM
,
off£tof
(
Textobj
,
vît_Æign
)},

172 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Textobj
, 
fûl_cﬁ‹
) },

173 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
Textobj
, 
show_background
) },

174 { 
NULL
, 0, 0 }

178 
	$ãxtobj_gë_¥›s
(
Textobj
 *
ãxtobj
, 
GPåAºay
 *
¥›s
)

180 
	`ãxt_gë_©åibuãs
(
ãxtobj
->
ãxt
,&ãxtobj->
©ås
);

181 
	`obje˘_gë_¥›s_‰om_off£ts
(&
ãxtobj
->
obje˘
,
ãxtobj_off£ts
,
¥›s
);

182 
	}
}

185 
	$ãxtobj_£t_¥›s
(
Textobj
 *
ãxtobj
, 
GPåAºay
 *
¥›s
)

187 
	`obje˘_£t_¥›s_‰om_off£ts
(&
ãxtobj
->
obje˘
,
ãxtobj_off£ts
,
¥›s
);

188 
	`≠∂y_ãxèâr_¥›îtõs
(
¥›s
,
ãxtobj
->
ãxt
,"ãxt",&ãxtobj->
©ås
);

189 
	`ãxtobj_upd©e_d©a
(
ãxtobj
);

190 
	}
}

192 
ªÆ


193 
	$ãxtobj_di°™˚_‰om
(
Textobj
 *
ãxtobj
, 
Poöt
 *
poöt
)

195  
	`ãxt_di°™˚_‰om
(
ãxtobj
->
ãxt
, 
poöt
);

196 
	}
}

199 
	$ãxtobj_£À˘
(
Textobj
 *
ãxtobj
, 
Poöt
 *
˛icked_poöt
,

200 
DüRídîî
 *
öãø˘ive_ªndîî
)

202 
	`ãxt_£t_curs‹
(
ãxtobj
->
ãxt
, 
˛icked_poöt
, 
öãø˘ive_ªndîî
);

203 
	`ãxt_gøb_focus
(
ãxtobj
->
ãxt
, &ãxtobj->
obje˘
);

204 
	}
}

208 
Obje˘Ch™ge
*

209 
	$ãxtobj_move_h™dÀ
(
Textobj
 *
ãxtobj
, 
H™dÀ
 *
h™dÀ
,

210 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

211 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

213 
	`as£π
(
ãxtobj
!=
NULL
);

214 
	`as£π
(
h™dÀ
!=
NULL
);

215 
	`as£π
(
to
!=
NULL
);

217 i‡(
h™dÀ
->
id
 =
HANDLE_TEXT
) {

222 
	`ãxtobj_move
(
ãxtobj
, 
to
);

226  
NULL
;

227 
	}
}

229 
Obje˘Ch™ge
*

230 
	$ãxtobj_move
(
Textobj
 *
ãxtobj
, 
Poöt
 *
to
)

232 
ãxtobj
->
obje˘
.
posôi⁄
 = *
to
;

234 
	`ãxtobj_upd©e_d©a
(
ãxtobj
);

236  
NULL
;

237 
	}
}

240 
	$ãxtobj_døw
(
Textobj
 *
ãxtobj
, 
DüRídîî
 *
ªndîî
)

242 
	`as£π
(
ãxtobj
 !
NULL
);

243 
	`as£π
(
ªndîî
 !
NULL
);

245 i‡(
ãxtobj
->
show_background
) {

246 
Re˘™gÀ
 
box
;

247 
Poöt
 
ul
, 
Ã
;

248 
	`ãxt_ˇlc_boundögbox
 (
ãxtobj
->
ãxt
, &
box
);

249 
ul
.
x
 = 
box
.
À·
;

250 
ul
.
y
 = 
box
.
t›
;

251 
Ã
.
x
 = 
box
.
right
;

252 
Ã
.
y
 = 
box
.
bŸtom
;

253 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
)->
	`fûl_ª˘
 (ªndîî, &
ul
, &
Ã
, &
ãxtobj
->
fûl_cﬁ‹
);

255 
	`ãxt_døw
(
ãxtobj
->
ãxt
, 
ªndîî
);

256 
	}
}

258 
	$ãxtobj_vÆign_poöt
(
Textobj
 *
ãxtobj
, 
Poöt
* 
p
, 
ªÆ
 
Á˘‹
)

261 
Re˘™gÀ
 *
bb
 = &(
ãxtobj
->
obje˘
.
boundög_box
);

262 
ªÆ
 
off£t
 ;

263 
ãxtobj
->
vît_Æign
){

264 
VALIGN_BOTTOM
:

265 
off£t
 = 
bb
->
bŸtom
 - 
ãxtobj
->
obje˘
.
posôi⁄
.
y
;

266 
p
->
y
 -
off£t
 * 
Á˘‹
;

268 
VALIGN_TOP
:

269 
off£t
 = 
bb
->
t›
 - 
ãxtobj
->
obje˘
.
posôi⁄
.
y
;

270 
p
->
y
 -
off£t
 * 
Á˘‹
;

272 
VALIGN_CENTER
:

273 
off£t
 = (
bb
->
bŸtom
 + bb->
t›
)/2 - 
ãxtobj
->
obje˘
.
posôi⁄
.
y
;

274 
p
->
y
 -
off£t
 * 
Á˘‹
;

276 
VALIGN_FIRST_LINE
:

279 
	}
}

281 
	$ãxtobj_upd©e_d©a
(
Textobj
 *
ãxtobj
)

283 
Poöt
 
to2
;

284 
DüObje˘
 *
obj
 = &
ãxtobj
->
obje˘
;

286 
	`ãxt_£t_posôi⁄
(
ãxtobj
->
ãxt
, &
obj
->
posôi⁄
);

287 
	`ãxt_ˇlc_boundögbox
(
ãxtobj
->
ãxt
, &
obj
->
boundög_box
);

289 
to2
 = 
obj
->
posôi⁄
;

290 
	`ãxtobj_vÆign_poöt
(
ãxtobj
, &
to2
, 1);

291 
	`ãxt_£t_posôi⁄
(
ãxtobj
->
ãxt
, &
to2
);

292 
	`ãxt_ˇlc_boundögbox
(
ãxtobj
->
ãxt
, &
obj
->
boundög_box
);

294 
ãxtobj
->
ãxt_h™dÀ
.
pos
 = 
obj
->
posôi⁄
;

295 
	}
}

297 
DüObje˘
 *

298 
	$ãxtobj_¸óã
(
Poöt
 *
°¨çoöt
,

299 *
u£r_d©a
,

300 
H™dÀ
 **
h™dÀ1
,

301 
H™dÀ
 **
h™dÀ2
)

303 
Textobj
 *
ãxtobj
;

304 
DüObje˘
 *
obj
;

305 
Cﬁ‹
 
cﬁ
;

306 
DüF⁄t
 *
f⁄t
 = 
NULL
;

307 
ªÆ
 
f⁄t_height
;

309 
ãxtobj
 = 
	`g_mÆloc0
((
Textobj
));

310 
obj
 = &
ãxtobj
->
obje˘
;

312 
obj
->
ty≥
 = &
ãxtobj_ty≥
;

314 
obj
->
›s
 = &
ãxtobj_›s
;

316 
cﬁ
 = 
	`©åibuãs_gë_f‹eground
();

317 
	`©åibuãs_gë_deÁu…_f⁄t
(&
f⁄t
, &
f⁄t_height
);

318 
ãxtobj
->
ãxt
 = 
	`√w_ãxt
("", 
f⁄t
, 
f⁄t_height
,

319 
°¨çoöt
, &
cﬁ
, 
deÁu…_¥›îtõs
.
Æignmít
 );

321 
obj
->
posôi⁄
 = *
°¨çoöt
;

323 
	`ãxt_gë_©åibuãs
(
ãxtobj
->
ãxt
,&ãxtobj->
©ås
);

324 
	`dü_f⁄t_uƒef
(
f⁄t
);

325 
ãxtobj
->
vît_Æign
 = 
deÁu…_¥›îtõs
.vert_align;

328 
ãxtobj
->
fûl_cﬁ‹
 = 
	`©åibuãs_gë_background
();

329 
ãxtobj
->
show_background
 = 
FALSE
;

331 
	`obje˘_öô
(
obj
, 1, 0);

333 
obj
->
h™dÀs
[0] = &
ãxtobj
->
ãxt_h™dÀ
;

334 
ãxtobj
->
ãxt_h™dÀ
.
id
 = 
HANDLE_TEXT
;

335 
ãxtobj
->
ãxt_h™dÀ
.
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

336 
ãxtobj
->
ãxt_h™dÀ
.
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

337 
ãxtobj
->
ãxt_h™dÀ
.
c⁄√˘ed_to
 = 
NULL
;

339 
	`ãxtobj_upd©e_d©a
(
ãxtobj
);

341 *
h™dÀ1
 = 
NULL
;

342 *
h™dÀ2
 = 
obj
->
h™dÀs
[0];

343  &
ãxtobj
->
obje˘
;

344 
	}
}

347 
	$ãxtobj_de°roy
(
Textobj
 *
ãxtobj
)

349 
	`ãxt_de°roy
(
ãxtobj
->
ãxt
);

350 
	`dü_f⁄t_uƒef
(
ãxtobj
->
©ås
.
f⁄t
);

351 
	`obje˘_de°roy
(&
ãxtobj
->
obje˘
);

352 
	}
}

355 
	$ãxtobj_ßve
(
Textobj
 *
ãxtobj
, 
Obje˘Node
 
obj_node
, c⁄° *
fûíame
)

357 
	`obje˘_ßve
(&
ãxtobj
->
obje˘
, 
obj_node
);

359 
	`d©a_add_ãxt
(
	`√w_©åibuã
(
obj_node
, "text"),

360 
ãxtobj
->
ãxt
);

361 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "valign"),

362 
ãxtobj
->
vît_Æign
);

364 i‡(
ãxtobj
->
show_background
) {

365 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "fûl_cﬁ‹"), &
ãxtobj
->
fûl_cﬁ‹
);

366 
	`d©a_add_boﬁón
(
	`√w_©åibuã
(
obj_node
, "show_background"), 
ãxtobj
->
show_background
);

368 
	}
}

370 
DüObje˘
 *

371 
	$ãxtobj_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

373 
Textobj
 *
ãxtobj
;

374 
DüObje˘
 *
obj
;

375 
AâribuãNode
 
©å
;

376 
Poöt
 
°¨çoöt
 = {0.0, 0.0};

378 
ãxtobj
 = 
	`g_mÆloc0
((
Textobj
));

379 
obj
 = &
ãxtobj
->
obje˘
;

381 
obj
->
ty≥
 = &
ãxtobj_ty≥
;

382 
obj
->
›s
 = &
ãxtobj_›s
;

384 
	`obje˘_lﬂd
(
obj
, 
obj_node
);

386 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "text");

387 i‡(
©å
 !
NULL
) {

388 
ãxtobj
->
ãxt
 = 
	`d©a_ãxt
–
	`©åibuã_fú°_d©a
(
©å
) );

390 
DüF⁄t
* 
f⁄t
 = 
	`dü_f⁄t_√w_‰om_°yÀ
(
DIA_FONT_MONOSPACE
,1.0);

391 
ãxtobj
->
ãxt
 = 
	`√w_ãxt
("", 
f⁄t
, 1.0,

392 &
°¨çoöt
, &
cﬁ‹_bœck
, 
ALIGN_CENTER
);

393 
	`dü_f⁄t_uƒef
(
f⁄t
);

396 
	`ãxt_gë_©åibuãs
(
ãxtobj
->
ãxt
,&ãxtobj->
©ås
);

398 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "valign");

399 i‡(
©å
 !
NULL
)

400 
ãxtobj
->
vît_Æign
 = 
	`d©a_íum
–
	`©åibuã_fú°_d©a
(
©å
) );

401 i‡(
vîsi⁄
 == 0) {

402 
ãxtobj
->
vît_Æign
 = 
VALIGN_FIRST_LINE
;

406 
ãxtobj
->
fûl_cﬁ‹
 = 
	`©åibuãs_gë_background
();

407 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "fill_color");

408 i‡(
©å
)

409 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
ãxtobj
->
fûl_cﬁ‹
);

410 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "show_background");

411 i‡(
©å
)

412 
ãxtobj
->
show_background
 = 
	`d©a_boﬁón
–
	`©åibuã_fú°_d©a
(
©å
) );

414 
ãxtobj
->
show_background
 = 
FALSE
;

416 
	`obje˘_öô
(
obj
, 1, 0);

418 
obj
->
h™dÀs
[0] = &
ãxtobj
->
ãxt_h™dÀ
;

419 
ãxtobj
->
ãxt_h™dÀ
.
id
 = 
HANDLE_TEXT
;

420 
ãxtobj
->
ãxt_h™dÀ
.
ty≥
 = 
HANDLE_MAJOR_CONTROL
;

421 
ãxtobj
->
ãxt_h™dÀ
.
c⁄√˘_ty≥
 = 
HANDLE_CONNECTABLE
;

422 
ãxtobj
->
ãxt_h™dÀ
.
c⁄√˘ed_to
 = 
NULL
;

424 
	`ãxtobj_upd©e_d©a
(
ãxtobj
);

426  &
ãxtobj
->
obje˘
;

427 
	}
}

	@O:\tool\dvs50\objects\standard\tool-icons.h

3 #ifde‡
__SUNPRO_C


4 #¥agm®
Æign
 4 (
¨c_ic⁄
)

6 #ifde‡
__GNUC__


7 c⁄° 
guöt8
 
	g¨c_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

9 c⁄° 
guöt8
 
¨c_ic⁄
[] =

85 #ifde‡
__SUNPRO_C


86 #¥agm®
Æign
 4 (
bezõrg⁄_ic⁄
)

88 #ifde‡
__GNUC__


89 c⁄° 
guöt8
 
	gbezõrg⁄_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

91 c⁄° 
guöt8
 
bezõrg⁄_ic⁄
[] =

169 #ifde‡
__SUNPRO_C


170 #¥agm®
Æign
 4 (
bezõæöe_ic⁄
)

172 #ifde‡
__GNUC__


173 c⁄° 
guöt8
 
	gbezõæöe_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

175 c⁄° 
guöt8
 
bezõæöe_ic⁄
[] =

253 #ifde‡
__SUNPRO_C


254 #¥agm®
Æign
 4 (
box_ic⁄
)

256 #ifde‡
__GNUC__


257 c⁄° 
guöt8
 
	gbox_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

259 c⁄° 
guöt8
 
box_ic⁄
[] =

342 #ifde‡
__SUNPRO_C


343 #¥agm®
Æign
 4 (
ñlù£_ic⁄
)

345 #ifde‡
__GNUC__


346 c⁄° 
guöt8
 
	gñlù£_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

348 c⁄° 
guöt8
 
ñlù£_ic⁄
[] =

430 #ifde‡
__SUNPRO_C


431 #¥agm®
Æign
 4 (
image_ic⁄
)

433 #ifde‡
__GNUC__


434 c⁄° 
guöt8
 
	gimage_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

436 c⁄° 
guöt8
 
image_ic⁄
[] =

530 #ifde‡
__SUNPRO_C


531 #¥agm®
Æign
 4 (
löe_ic⁄
)

533 #ifde‡
__GNUC__


534 c⁄° 
guöt8
 
	glöe_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

536 c⁄° 
guöt8
 
löe_ic⁄
[] =

612 #ifde‡
__SUNPRO_C


613 #¥agm®
Æign
 4 (
ouéöe_ic⁄
)

615 #ifde‡
__GNUC__


616 c⁄° 
guöt8
 
	gouéöe_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

618 c⁄° 
guöt8
 
ouéöe_ic⁄
[] =

715 #ifde‡
__SUNPRO_C


716 #¥agm®
Æign
 4 (
pﬁyg⁄_ic⁄
)

718 #ifde‡
__GNUC__


719 c⁄° 
guöt8
 
	gpﬁyg⁄_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

721 c⁄° 
guöt8
 
pﬁyg⁄_ic⁄
[] =

798 #ifde‡
__SUNPRO_C


799 #¥agm®
Æign
 4 (
pﬁylöe_ic⁄
)

801 #ifde‡
__GNUC__


802 c⁄° 
guöt8
 
	gpﬁylöe_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

804 c⁄° 
guöt8
 
pﬁylöe_ic⁄
[] =

881 #ifde‡
__SUNPRO_C


882 #¥agm®
Æign
 4 (
ãxt_ic⁄
)

884 #ifde‡
__GNUC__


885 c⁄° 
guöt8
 
	gãxt_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

887 c⁄° 
guöt8
 
ãxt_ic⁄
[] =

966 #ifde‡
__SUNPRO_C


967 #¥agm®
Æign
 4 (
zigzaglöe_ic⁄
)

969 #ifde‡
__GNUC__


970 c⁄° 
guöt8
 
	gzigzaglöe_ic⁄
[] 
__©åibuã__
 ((
__Æig√d__
 (4))) =

972 c⁄° 
guöt8
 
zigzaglöe_ic⁄
[] =

	@O:\tool\dvs50\objects\standard\zigzagline.c

19 #ifde‡
HAVE_CONFIG_H


20 
	~<c⁄fig.h
>

23 
	~<as£π.h
>

24 
	~<m©h.h
>

26 
	~"öé.h
"

27 
	~"obje˘.h
"

28 
	~"‹th_c⁄n.h
"

29 
	~"c⁄√˘i⁄poöt.h
"

30 
	~"düªndîî.h
"

31 
	~"©åibuãs.h
"

32 
	~"widgës.h
"

33 
	~"mesßge.h
"

34 
	~"¥›îtõs.h
"

35 
	~"aut‹ouã.h
"

37 
	~"toﬁ-ic⁄s.h
"

39 
	#DEFAULT_WIDTH
 0.15

	)

41 
	#HANDLE_MIDDLE
 
HANDLE_CUSTOM1


	)

43 
	s_Zigzaglöe
 {

44 
OπhC⁄n
 
	m‹th
;

46 
Cﬁ‹
 
	mlöe_cﬁ‹
;

47 
LöeStyÀ
 
	mlöe_°yÀ
;

48 
ªÆ
 
	mdashÀngth
;

49 
ªÆ
 
	mlöe_width
;

50 
ªÆ
 
	mc‹√r_ødius
;

51 
Aºow
 
	m°¨t_¨row
, 
	míd_¨row
;

52 } 
	tZigzaglöe
;

55 
Obje˘Ch™ge
* 
zigzaglöe_move_h™dÀ
(
Zigzaglöe
 *
zigzaglöe
, 
H™dÀ
 *
h™dÀ
,

56 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

57 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
);

58 
Obje˘Ch™ge
* 
zigzaglöe_move
(
Zigzaglöe
 *
zigzaglöe
, 
Poöt
 *
to
);

59 
zigzaglöe_£À˘
(
Zigzaglöe
 *
zigzaglöe
, 
Poöt
 *
˛icked_poöt
,

60 
DüRídîî
 *
öãø˘ive_ªndîî
);

61 
zigzaglöe_døw
(
Zigzaglöe
 *
zigzaglöe
, 
DüRídîî
 *
ªndîî
);

62 
DüObje˘
 *
zigzaglöe_¸óã
(
Poöt
 *
°¨çoöt
,

63 *
u£r_d©a
,

64 
H™dÀ
 **
h™dÀ1
,

65 
H™dÀ
 **
h™dÀ2
);

66 
ªÆ
 
zigzaglöe_di°™˚_‰om
(
Zigzaglöe
 *
zigzaglöe
, 
Poöt
 *
poöt
);

67 
zigzaglöe_upd©e_d©a
(
Zigzaglöe
 *
zigzaglöe
);

68 
zigzaglöe_de°roy
(
Zigzaglöe
 *
zigzaglöe
);

69 
DüObje˘
 *
zigzaglöe_c›y
(
Zigzaglöe
 *
zigzaglöe
);

70 
DüMíu
 *
zigzaglöe_gë_obje˘_míu
(
Zigzaglöe
 *
zigzaglöe
,

71 
Poöt
 *
˛ickedpoöt
);

73 
Pr›Des¸ùti⁄
 *
zigzaglöe_des¸ibe_¥›s
(
Zigzaglöe
 *
zigzaglöe
);

74 
zigzaglöe_gë_¥›s
(
Zigzaglöe
 *
zigzaglöe
, 
GPåAºay
 *
¥›s
);

75 
zigzaglöe_£t_¥›s
(
Zigzaglöe
 *
zigzaglöe
, 
GPåAºay
 *
¥›s
);

77 
zigzaglöe_ßve
(
Zigzaglöe
 *
zigzaglöe
, 
Obje˘Node
 
obj_node
,

78 c⁄° *
fûíame
);

79 
DüObje˘
 *
zigzaglöe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
,

80 c⁄° *
fûíame
);

82 
Obje˘Ty≥Ops
 
	gzigzaglöe_ty≥_›s
 =

84 (
Cª©eFunc
)
zigzaglöe_¸óã
,

85 (
LﬂdFunc
Ë
zigzaglöe_lﬂd
,

86 (
SaveFunc
Ë
zigzaglöe_ßve
,

87 (
GëDeÁu…sFunc
Ë
NULL
,

88 (
AµlyDeÁu…sFunc
Ë
NULL


91 
DüObje˘Ty≥
 
	gzigzaglöe_ty≥
 =

96 (**Ë
zigzaglöe_ic⁄
,

98 &
zigzaglöe_ty≥_›s


101 
DüObje˘Ty≥
 *
	g_zigzaglöe_ty≥
 = (DüObje˘Ty≥ *Ë&
zigzaglöe_ty≥
;

104 
Obje˘Ops
 
	gzigzaglöe_›s
 = {

105 (
De°royFunc
Ë
zigzaglöe_de°roy
,

106 (
DøwFunc
Ë
zigzaglöe_døw
,

107 (
Di°™˚Func
Ë
zigzaglöe_di°™˚_‰om
,

108 (
Sñe˘Func
Ë
zigzaglöe_£À˘
,

109 (
C›yFunc
Ë
zigzaglöe_c›y
,

110 (
MoveFunc
Ë
zigzaglöe_move
,

111 (
MoveH™dÀFunc
Ë
zigzaglöe_move_h™dÀ
,

112 (
GëPr›îtõsFunc
Ë
obje˘_¸óã_¥›s_dülog
,

113 (
AµlyPr›îtõsDülogFunc
Ë
obje˘_≠∂y_¥›s_‰om_dülog
,

114 (
Obje˘MíuFunc
Ë
zigzaglöe_gë_obje˘_míu
,

115 (
Des¸ibePr›sFunc
Ë
zigzaglöe_des¸ibe_¥›s
,

116 (
GëPr›sFunc
Ë
zigzaglöe_gë_¥›s
,

117 (
SëPr›sFunc
Ë
zigzaglöe_£t_¥›s
,

118 (
TextEdôFunc
) 0,

119 (
AµlyPr›îtõsLi°Func
Ë
obje˘_≠∂y_¥›s
,

122 
Pr›NumD©a
 
	gzigzaglöe_c‹√r_ødius_d©a
 = { 0.0, 10.0, 0.1 };

124 
Pr›Des¸ùti⁄
 
	gzigzaglöe_¥›s
[] = {

125 
ORTHCONN_COMMON_PROPERTIES
,

126 
PROP_STD_LINE_WIDTH
,

127 
PROP_STD_LINE_COLOUR
,

128 
PROP_STD_LINE_STYLE
,

129 
PROP_STD_START_ARROW
,

130 
PROP_STD_END_ARROW
,

131 { "c‹√r_ødius", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

132 
N_
("C‹√∏ødius"), 
NULL
, &
zigzaglöe_c‹√r_ødius_d©a
 },

133 
PROP_DESC_END


136 
Pr›Des¸ùti⁄
 *

137 
	$zigzaglöe_des¸ibe_¥›s
(
Zigzaglöe
 *
zigzaglöe
)

139 i‡(
zigzaglöe_¥›s
[0].
qu¨k
 == 0)

140 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
zigzaglöe_¥›s
);

141  
zigzaglöe_¥›s
;

142 
	}
}

144 
Pr›Off£t
 
	gzigzaglöe_off£ts
[] = {

145 
ORTHCONN_COMMON_PROPERTIES_OFFSETS
,

146 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Zigzaglöe
, 
löe_width
) },

147 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Zigzaglöe
, 
löe_cﬁ‹
) },

148 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
,

149 
off£tof
(
Zigzaglöe
, 
löe_°yÀ
), off£tof(Zigzaglöe, 
dashÀngth
) },

150 { "°¨t_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Zigzaglöe
, 
°¨t_¨row
) },

151 { "íd_¨row", 
PROP_TYPE_ARROW
, 
off£tof
(
Zigzaglöe
, 
íd_¨row
) },

152 { "c‹√r_ødius", 
PROP_TYPE_REAL
, 
off£tof
(
Zigzaglöe
, 
c‹√r_ødius
) },

153 { 
NULL
, 0, 0 }

157 
	$zigzaglöe_gë_¥›s
(
Zigzaglöe
 *
zigzaglöe
, 
GPåAºay
 *
¥›s
)

159 
	`obje˘_gë_¥›s_‰om_off£ts
(&
zigzaglöe
->
‹th
.
obje˘
, 
zigzaglöe_off£ts
,

160 
¥›s
);

161 
	}
}

164 
	$zigzaglöe_£t_¥›s
(
Zigzaglöe
 *
zigzaglöe
, 
GPåAºay
 *
¥›s
)

166 
	`obje˘_£t_¥›s_‰om_off£ts
(&
zigzaglöe
->
‹th
.
obje˘
, 
zigzaglöe_off£ts
,

167 
¥›s
);

168 
	`zigzaglöe_upd©e_d©a
(
zigzaglöe
);

169 
	}
}

171 
ªÆ


172 
	$zigzaglöe_di°™˚_‰om
(
Zigzaglöe
 *
zigzaglöe
, 
Poöt
 *
poöt
)

174 
OπhC⁄n
 *
‹th
 = &
zigzaglöe
->orth;

175  
	`‹thc⁄n_di°™˚_‰om
(
‹th
, 
poöt
, 
zigzaglöe
->
löe_width
);

176 
	}
}

179 
	$zigzaglöe_£À˘
(
Zigzaglöe
 *
zigzaglöe
, 
Poöt
 *
˛icked_poöt
,

180 
DüRídîî
 *
öãø˘ive_ªndîî
)

182 
	`‹thc⁄n_upd©e_d©a
(&
zigzaglöe
->
‹th
);

183 
	}
}

185 
Obje˘Ch™ge
*

186 
	$zigzaglöe_move_h™dÀ
(
Zigzaglöe
 *
zigzaglöe
, 
H™dÀ
 *
h™dÀ
,

187 
Poöt
 *
to
, 
C⁄√˘i⁄Poöt
 *
˝
,

188 
H™dÀMoveRós⁄
 
ªas⁄
, 
ModifõrKeys
 
modifõrs
)

190 
Obje˘Ch™ge
 *
ch™ge
;

191 
	`as£π
(
zigzaglöe
!=
NULL
);

192 
	`as£π
(
h™dÀ
!=
NULL
);

193 
	`as£π
(
to
!=
NULL
);

195 
ch™ge
 = 
	`‹thc⁄n_move_h™dÀ
((
OπhC⁄n
*)
zigzaglöe
, 
h™dÀ
, 
to
, 
˝
,

196 
ªas⁄
, 
modifõrs
);

198 
	`zigzaglöe_upd©e_d©a
(
zigzaglöe
);

200  
ch™ge
;

201 
	}
}

204 
Obje˘Ch™ge
*

205 
	$zigzaglöe_move
(
Zigzaglöe
 *
zigzaglöe
, 
Poöt
 *
to
)

207 
	`‹thc⁄n_move
(&
zigzaglöe
->
‹th
, 
to
);

208 
	`zigzaglöe_upd©e_d©a
(
zigzaglöe
);

210  
NULL
;

211 
	}
}

214 
	$zigzaglöe_døw
(
Zigzaglöe
 *
zigzaglöe
, 
DüRídîî
 *
ªndîî
)

216 
DüRídîîCœss
 *
ªndîî_›s
 = 
	`DIA_RENDERER_GET_CLASS
 (
ªndîî
);

217 
OπhC⁄n
 *
‹th
 = &
zigzaglöe
->orth;

218 
Poöt
 *
poöts
;

219 
n
;

221 
poöts
 = &
‹th
->points[0];

222 
n
 = 
‹th
->
numpoöts
;

224 
ªndîî_›s
->
	`£t_löewidth
(
ªndîî
, 
zigzaglöe
->
löe_width
);

225 
ªndîî_›s
->
	`£t_löe°yÀ
(
ªndîî
, 
zigzaglöe
->
löe_°yÀ
);

226 
ªndîî_›s
->
	`£t_dashÀngth
(
ªndîî
, 
zigzaglöe
->
dashÀngth
);

227 i‡(
zigzaglöe
->
c‹√r_ødius
 > 0)

228 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_ROUND
);

230 
ªndîî_›s
->
	`£t_löejoö
(
ªndîî
, 
LINEJOIN_MITER
);

231 
ªndîî_›s
->
	`£t_löeˇps
(
ªndîî
, 
LINECAPS_BUTT
);

233 
ªndîî_›s
->
	`døw_rounded_pﬁylöe_wôh_¨rows
(
ªndîî
,

234 
poöts
, 
n
,

235 
zigzaglöe
->
löe_width
,

236 &
zigzaglöe
->
löe_cﬁ‹
,

237 &
zigzaglöe
->
°¨t_¨row
,

238 &
zigzaglöe
->
íd_¨row
,

239 
zigzaglöe
->
c‹√r_ødius
);

241 
	}
}

243 
DüObje˘
 *

244 
	$zigzaglöe_¸óã
(
Poöt
 *
°¨çoöt
,

245 *
u£r_d©a
,

246 
H™dÀ
 **
h™dÀ1
,

247 
H™dÀ
 **
h™dÀ2
)

249 
Zigzaglöe
 *
zigzaglöe
;

250 
OπhC⁄n
 *
‹th
;

251 
DüObje˘
 *
obj
;

254 
zigzaglöe
 = 
	`g_mÆloc0
((
Zigzaglöe
));

255 
‹th
 = &
zigzaglöe
->orth;

256 
obj
 = &
‹th
->
obje˘
;

258 
obj
->
ty≥
 = &
zigzaglöe_ty≥
;

259 
obj
->
›s
 = &
zigzaglöe_›s
;

261 
	`‹thc⁄n_öô
(
‹th
, 
°¨çoöt
);

263 
zigzaglöe
->
löe_width
 = 
	`©åibuãs_gë_deÁu…_löewidth
();

264 
zigzaglöe
->
löe_cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

265 
	`©åibuãs_gë_deÁu…_löe_°yÀ
(&
zigzaglöe
->
löe_°yÀ
,

266 &
zigzaglöe
->
dashÀngth
);

267 
zigzaglöe
->
°¨t_¨row
 = 
	`©åibuãs_gë_deÁu…_°¨t_¨row
();

268 
zigzaglöe
->
íd_¨row
 = 
	`©åibuãs_gë_deÁu…_íd_¨row
();

269 
zigzaglöe
->
c‹√r_ødius
 = 0.0;

271 *
h™dÀ1
 = 
‹th
->
h™dÀs
[0];

272 *
h™dÀ2
 = 
‹th
->
h™dÀs
[‹th->
numpoöts
-2];

274 
	`zigzaglöe_upd©e_d©a
(
zigzaglöe
);

276  &
zigzaglöe
->
‹th
.
obje˘
;

277 
	}
}

280 
	$zigzaglöe_de°roy
(
Zigzaglöe
 *
zigzaglöe
)

282 
	`‹thc⁄n_de°roy
(&
zigzaglöe
->
‹th
);

283 
	}
}

285 
DüObje˘
 *

286 
	$zigzaglöe_c›y
(
Zigzaglöe
 *
zigzaglöe
)

288 
Zigzaglöe
 *
√wzigzaglöe
;

289 
OπhC⁄n
 *
‹th
, *
√w‹th
;

290 
DüObje˘
 *
√wobj
;

292 
‹th
 = &
zigzaglöe
->orth;

294 
√wzigzaglöe
 = 
	`g_mÆloc0
((
Zigzaglöe
));

295 
√w‹th
 = &
√wzigzaglöe
->
‹th
;

296 
√wobj
 = &
√w‹th
->
obje˘
;

298 
	`‹thc⁄n_c›y
(
‹th
, 
√w‹th
);

300 
√wzigzaglöe
->
löe_cﬁ‹
 = 
zigzaglöe
->line_color;

301 
√wzigzaglöe
->
löe_width
 = 
zigzaglöe
->line_width;

302 
√wzigzaglöe
->
löe_°yÀ
 = 
zigzaglöe
->line_style;

303 
√wzigzaglöe
->
dashÀngth
 = 
zigzaglöe
->dashlength;

304 
√wzigzaglöe
->
°¨t_¨row
 = 
zigzaglöe
->start_arrow;

305 
√wzigzaglöe
->
íd_¨row
 = 
zigzaglöe
->end_arrow;

306 
√wzigzaglöe
->
c‹√r_ødius
 = 
zigzaglöe
->corner_radius;

308 
	`zigzaglöe_upd©e_d©a
(
√wzigzaglöe
);

310  &
√wzigzaglöe
->
‹th
.
obje˘
;

311 
	}
}

314 
	$zigzaglöe_upd©e_d©a
(
Zigzaglöe
 *
zigzaglöe
)

316 
OπhC⁄n
 *
‹th
 = &
zigzaglöe
->orth;

317 
DüObje˘
 *
obj
 = &
‹th
->
obje˘
;

318 
PﬁyBBExåas
 *
exåa
 = &
‹th
->
exåa_•acög
;

320 
	`‹thc⁄n_upd©e_d©a
(&
zigzaglöe
->
‹th
);

322 
exåa
->
°¨t_l⁄g
 =

323 
exåa
->
íd_l⁄g
 =

324 
exåa
->
middÀ_å™s
 =

325 
exåa
->
°¨t_å™s
 =

326 
exåa
->
íd_å™s
 = (
zigzaglöe
->
löe_width
 / 2.0);

328 
	`‹thc⁄n_upd©e_boundögbox
(
‹th
);

330 i‡(
zigzaglöe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

331 
Re˘™gÀ
 
bbox
;

332 
Poöt
 
move_¨row
, 
move_löe
;

333 
Poöt
 
to
 = 
‹th
->
poöts
[0];

334 
Poöt
 
‰om
 = 
‹th
->
poöts
[1];

335 
	`ˇlcuœã_¨row_poöt
(&
zigzaglöe
->
°¨t_¨row
, &
to
, &
‰om
,

336 &
move_¨row
, &
move_löe
, 
zigzaglöe
->
löe_width
);

338 
	`poöt_sub
(&
to
, &
move_¨row
);

339 
	`poöt_sub
(&
‰om
, &
move_löe
);

341 
	`¨row_bbox
 (&
zigzaglöe
->
°¨t_¨row
, zigzaglöe->
löe_width
, &
to
, &
‰om
, &
bbox
);

342 
	`ª˘™gÀ_uni⁄
 (&
obj
->
boundög_box
, &
bbox
);

344 i‡(
zigzaglöe
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

345 
Re˘™gÀ
 
bbox
;

346 
Poöt
 
move_¨row
, 
move_löe
;

347 
n
 = 
‹th
->
numpoöts
;

348 
Poöt
 
to
 = 
‹th
->
poöts
[
n
-1];

349 
Poöt
 
‰om
 = 
‹th
->
poöts
[
n
-2];

350 
	`ˇlcuœã_¨row_poöt
(&
zigzaglöe
->
°¨t_¨row
, &
to
, &
‰om
,

351 &
move_¨row
, &
move_löe
, 
zigzaglöe
->
löe_width
);

353 
	`poöt_sub
(&
to
, &
move_¨row
);

354 
	`poöt_sub
(&
‰om
, &
move_löe
);

356 
	`¨row_bbox
 (&
zigzaglöe
->
íd_¨row
, zigzaglöe->
löe_width
, &
to
, &
‰om
, &
bbox
);

357 
	`ª˘™gÀ_uni⁄
 (&
obj
->
boundög_box
, &
bbox
);

359 
	}
}

361 
Obje˘Ch™ge
 *

362 
	$zigzaglöe_add_£gmít_ˇŒback
(
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

364 
Obje˘Ch™ge
 *
ch™ge
;

365 
ch™ge
 = 
	`‹thc⁄n_add_£gmít
((
OπhC⁄n
 *)
obj
, 
˛icked
);

366 
	`zigzaglöe_upd©e_d©a
((
Zigzaglöe
 *)
obj
);

367  
ch™ge
;

368 
	}
}

370 
Obje˘Ch™ge
 *

371 
	$zigzaglöe_dñëe_£gmít_ˇŒback
(
DüObje˘
 *
obj
, 
Poöt
 *
˛icked
, 
gpoöãr
 
d©a
)

373 
Obje˘Ch™ge
 *
ch™ge
;

374 
ch™ge
 = 
	`‹thc⁄n_dñëe_£gmít
((
OπhC⁄n
 *)
obj
, 
˛icked
);

375 
	`zigzaglöe_upd©e_d©a
((
Zigzaglöe
 *)
obj
);

376  
ch™ge
;

377 
	}
}

379 
DüMíuIãm
 
	gobje˘_míu_ôems
[] = {

380 { 
N_
("Add segmít"), 
zigzaglöe_add_£gmít_ˇŒback
, 
NULL
, 1 },

381 { 
N_
("Dñëê£gmít"), 
zigzaglöe_dñëe_£gmít_ˇŒback
, 
NULL
, 1 },

382 
ORTHCONN_COMMON_MENUS
,

385 
DüMíu
 
	gobje˘_míu
 = {

387 (
obje˘_míu_ôems
)/(
DüMíuIãm
),

388 
obje˘_míu_ôems
,

389 
NULL


392 
DüMíu
 *

393 
	$zigzaglöe_gë_obje˘_míu
(
Zigzaglöe
 *
zigzaglöe
, 
Poöt
 *
˛ickedpoöt
)

395 
OπhC⁄n
 *
‹th
;

397 
‹th
 = &
zigzaglöe
->orth;

399 
obje˘_míu_ôems
[0].
a˘ive
 = 
	`‹thc⁄n_ˇn_add_£gmít
(
‹th
, 
˛ickedpoöt
);

400 
obje˘_míu_ôems
[1].
a˘ive
 = 
	`‹thc⁄n_ˇn_dñëe_£gmít
(
‹th
, 
˛ickedpoöt
);

401 
	`‹thc⁄n_upd©e_obje˘_míu
(
‹th
, 
˛ickedpoöt
, &
obje˘_míu_ôems
[2]);

403  &
obje˘_míu
;

404 
	}
}

408 
	$zigzaglöe_ßve
(
Zigzaglöe
 *
zigzaglöe
, 
Obje˘Node
 
obj_node
,

409 c⁄° *
fûíame
)

411 
	`‹thc⁄n_ßve
(&
zigzaglöe
->
‹th
, 
obj_node
);

413 i‡(!
	`cﬁ‹_equÆs
(&
zigzaglöe
->
löe_cﬁ‹
, &
cﬁ‹_bœck
))

414 
	`d©a_add_cﬁ‹
(
	`√w_©åibuã
(
obj_node
, "line_color"),

415 &
zigzaglöe
->
löe_cﬁ‹
);

417 i‡(
zigzaglöe
->
löe_width
 != 0.1)

418 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

419 
zigzaglöe
->
löe_width
);

421 i‡(
zigzaglöe
->
löe_°yÀ
 !
LINESTYLE_SOLID
)

422 
	`d©a_add_íum
(
	`√w_©åibuã
(
obj_node
, "line_style"),

423 
zigzaglöe
->
löe_°yÀ
);

425 i‡(
zigzaglöe
->
°¨t_¨row
.
ty≥
 !
ARROW_NONE
) {

426 
	`ßve_¨row
(
obj_node
, &
zigzaglöe
->
°¨t_¨row
, "start_arrow",

430 i‡(
zigzaglöe
->
íd_¨row
.
ty≥
 !
ARROW_NONE
) {

431 
	`ßve_¨row
(
obj_node
, &
zigzaglöe
->
íd_¨row
, "end_arrow",

435 i‡(
zigzaglöe
->
löe_°yÀ
 !
LINESTYLE_SOLID
 &&

436 
zigzaglöe
->
dashÀngth
 !
DEFAULT_LINESTYLE_DASHLEN
)

437 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "dashlength"),

438 
zigzaglöe
->
dashÀngth
);

440 i‡(
zigzaglöe
->
c‹√r_ødius
 > 0.0)

441 
	`d©a_add_ªÆ
(
	`√w_©åibuã
(
obj_node
, "corner_radius"),

442 
zigzaglöe
->
c‹√r_ødius
);

443 
	}
}

445 
DüObje˘
 *

446 
	$zigzaglöe_lﬂd
(
Obje˘Node
 
obj_node
, 
vîsi⁄
, c⁄° *
fûíame
)

448 
Zigzaglöe
 *
zigzaglöe
;

449 
OπhC⁄n
 *
‹th
;

450 
DüObje˘
 *
obj
;

451 
AâribuãNode
 
©å
;

453 
zigzaglöe
 = 
	`g_mÆloc0
((
Zigzaglöe
));

455 
‹th
 = &
zigzaglöe
->orth;

456 
obj
 = &
‹th
->
obje˘
;

458 
obj
->
ty≥
 = &
zigzaglöe_ty≥
;

459 
obj
->
›s
 = &
zigzaglöe_›s
;

461 
	`‹thc⁄n_lﬂd
(
‹th
, 
obj_node
);

463 
zigzaglöe
->
löe_cﬁ‹
 = 
cﬁ‹_bœck
;

464 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_color");

465 i‡(
©å
 !
NULL
)

466 
	`d©a_cﬁ‹
(
	`©åibuã_fú°_d©a
(
©å
), &
zigzaglöe
->
löe_cﬁ‹
);

468 
zigzaglöe
->
löe_width
 = 0.1;

469 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

470 i‡(
©å
 !
NULL
)

471 
zigzaglöe
->
löe_width
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

473 
zigzaglöe
->
löe_°yÀ
 = 
LINESTYLE_SOLID
;

474 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "line_style");

475 i‡(
©å
 !
NULL
)

476 
zigzaglöe
->
löe_°yÀ
 = 
	`d©a_íum
(
	`©åibuã_fú°_d©a
(
©å
));

478 
	`lﬂd_¨row
(
obj_node
, &
zigzaglöe
->
°¨t_¨row
, "start_arrow",

481 
	`lﬂd_¨row
(
obj_node
, &
zigzaglöe
->
íd_¨row
, "end_arrow",

484 
zigzaglöe
->
dashÀngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

485 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "dashlength");

486 i‡(
©å
 !
NULL
)

487 
zigzaglöe
->
dashÀngth
 = 
	`d©a_ªÆ
(
	`©åibuã_fú°_d©a
(
©å
));

489 
zigzaglöe
->
c‹√r_ødius
 = 0.0;

490 
©å
 = 
	`obje˘_föd_©åibuã
(
obj_node
, "corner_radius");

491 i‡(
©å
 !
NULL
)

492 
zigzaglöe
->
c‹√r_ødius
 = 
	`d©a_ªÆ
–
	`©åibuã_fú°_d©a
(
©å
) );

494 
	`zigzaglöe_upd©e_d©a
(
zigzaglöe
);

496  &
zigzaglöe
->
‹th
.
obje˘
;

497 
	}
}

	@O:\tool\dvs50\plug-ins\shape\shape-export.c

32 
	~<c⁄fig.h
>

34 
	~<°dlib.h
>

35 
	~<°rög.h
>

36 
	~<time.h
>

37 
	~<m©h.h
>

38 
	~<î∫o.h
>

39 #ifde‡
HAVE_UNISTD_H


40 
	~<uni°d.h
>

43 
	~<glib/g°dio.h
>

47 
	#DPCM
 20

	)

49 
	~<libxml/ítôõs.h
>

50 
	~<libxml/åì.h
>

51 
	~<libxml/xmlmem‹y.h
>

52 
	~<libxml/∑r£r.h
>

53 
	~"dü_xml.h
"

54 
	~"dü_xml_libxml.h
"

55 
	~"geomëry.h
"

56 
	~"düsvgªndîî.h
"

57 
	~"fûãr.h
"

58 
	~"öé.h
"

59 
	~"mesßge.h
"

60 
	~"dügømd©a.h
"

62 
	gG_BEGIN_DECLS


64 
	#SHAPE_TYPE_RENDERER
 (
	`sh≠e_ªndîî_gë_ty≥
 ())

	)

65 
	#SHAPE_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
SHAPE_TYPE_RENDERER
, 
Sh≠eRídîî
))

	)

66 
	#SHAPE_RENDERER_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
SHAPE_TYPE_RENDERER
, 
Sh≠eRídîîCœss
))

	)

67 
	#SHAPE_IS_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
SHAPE_TYPE_RENDERER
))

	)

68 
	#SHAPE_RENDERER_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
SHAPE_TYPE_RENDERER
, 
Sh≠eRídîîCœss
))

	)

70 
GTy≥
 
	$sh≠e_ªndîî_gë_ty≥
 (Ë
G_GNUC_CONST
;

72 
_Sh≠eRídîî
 
	tSh≠eRídîî
;

73 
_Sh≠eRídîîCœss
 
	tSh≠eRídîîCœss
;

75 
	s_Sh≠eRídîî


77 
DüSvgRídîî
 
∑ª¡_ö°™˚
;

79 
xmlNodePå
 
c⁄√˘i⁄_roŸ
;

82 
	s_Sh≠eRídîîCœss


84 
DüSvgRídîîCœss
 
∑ª¡_˛ass
;

87 
G_END_DECLS


89 
DüSvgRídîî
 *
	`√w_sh≠e_ªndîî
(
DügømD©a
 *
d©a
, c⁄° *
fûíame
);

92 
	`íd_ªndî
(
DüRídîî
 *
£lf
);

94 
	`døw_löe
(
DüRídîî
 *
£lf
,

95 
Poöt
 *
°¨t
, Poöà*
íd
,

96 
Cﬁ‹
 *
löe_cﬁour
);

97 
	`døw_pﬁylöe
(
DüRídîî
 *
£lf
,

98 
Poöt
 *
poöts
, 
num_poöts
,

99 
Cﬁ‹
 *
löe_cﬁour
);

100 
	`døw_pﬁyg⁄
(
DüRídîî
 *
£lf
,

101 
Poöt
 *
poöts
, 
num_poöts
,

102 
Cﬁ‹
 *
löe_cﬁour
);

103 
	`døw_ª˘
(
DüRídîî
 *
£lf
,

104 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

105 
Cﬁ‹
 *
cﬁour
);

106 
	`døw_ñlù£
(
DüRídîî
 *
£lf
,

107 
Poöt
 *
˚¡î
,

108 
ªÆ
 
width
,Ñó»
height
,

109 
Cﬁ‹
 *
cﬁour
);

112 
	`add_c⁄√˘i⁄_poöt
(
Sh≠eRídîî
 *
ªndîî
,

113 
Poöt
 *
poöt
);

114 
	`add_ª˘™gÀ_c⁄√˘i⁄_poöts
(
Sh≠eRídîî
 *
ªndîî
,

115 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
);

116 
	`add_ñlù£_c⁄√˘i⁄_poöts
(
Sh≠eRídîî
 *
ªndîî
,

117 
Poöt
 *
˚¡î
,

118 
ªÆ
 
width
,Ñó»
height
);

120 
DüSvgRídîî
 *

121 
	$√w_sh≠e_ªndîî
(
DügømD©a
 *
d©a
, c⁄° *
fûíame
)

123 
Sh≠eRídîî
 *
sh≠e_ªndîî
;

124 
DüSvgRídîî
 *
ªndîî
;

125 
FILE
 *
fûe
;

126 *
poöt
;

127 
xmlNsPå
 
«me_•a˚
;

128 
xmlNodePå
 
xml_node_±r
;

129 
göt
 
i
;

130 
gch¨
 *
≤g_fûíame
;

131 *
sh≠íame
, *
dú«me
, *
fuŒ«me
;

132 *
shìäame
;

134 
fûe
 = 
	`g_f›í
(
fûíame
, "w");

136 i‡(
fûe
==
NULL
) {

137 
	`mesßge_îr‹
(
	`_
("Can't open output file %s: %s\n"),

138 
	`dü_mesßge_fûíame
(
fûíame
), 
	`°ªº‹
(
î∫o
));

139  
NULL
;

141 
	`f˛o£
(
fûe
);

143 
sh≠e_ªndîî
 = 
	`g_obje˘_√w
(
SHAPE_TYPE_RENDERER
, 
NULL
);

144 
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
sh≠e_ªndîî
);

146 
ªndîî
->
fûíame
 = 
	`g_°rdup
(filename);

148 
ªndîî
->
dash_Àngth
 = 1.0;

149 
ªndîî
->
dŸ_Àngth
 = 0.2;

150 
ªndîî
->
ßved_löe_°yÀ
 = 
LINESTYLE_SOLID
;

152 
ªndîî
->
sˇÀ
 = 1.0;

155 
ªndîî
->
doc
 = 
	`xmlNewDoc
((c⁄° 
xmlCh¨
 *)"1.0");

156 
ªndîî
->
doc
->
ícodög
 = 
	`xmlSådup
((c⁄° 
xmlCh¨
 *)"UTF-8");

157 
ªndîî
->
roŸ
 = 
	`xmlNewDocNode
‘ídîî->
doc
, 
NULL
, (c⁄° 
xmlCh¨
 *)"shape", NULL);

158 
«me_•a˚
 = 
	`xmlNewNs
(
ªndîî
->
roŸ
,

159 (c⁄° 
xmlCh¨
 *)"hâp://www.dØ.com.au/~james/dü-sh≠e-ns", 
NULL
);

161 
ªndîî
->
svg_«me_•a˚
 = 
	`xmlNewNs
‘ídîî->
roŸ
,

162 (c⁄° 
xmlCh¨
 *)"http://www.w3.org/2000/svg", (const xmlChar *)"svg");

163 
ªndîî
->
doc
->
xmlRoŸNode
 =Ñídîî->
roŸ
;

165 
dú«me
 = 
	`g_∑th_gë_dú«me
(
fûíame
);

166 
shìäame
 = 
	`g_∑th_gë_ba£«me
(
dú«me
);

167 
sh≠íame
 = 
	`g_°∫dup
(
	`g_ba£«me
(
fûíame
), 
	`°æí
(g_basename(filename))-6);

168 
fuŒ«me
 = 
	`g_°rdup_¥ötf
 ("%†- %s", 
shìäame
, 
sh≠íame
);

169 
	`g_‰ì
(
dú«me
);

170 
	`g_‰ì
(
shìäame
);

171 
	`g_‰ì
(
sh≠íame
);

173 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"«me", (xmlCh¨ *Ë
fuŒ«me
);

174 
	`g_‰ì
(
fuŒ«me
);

175 
poöt
 = 
	`°ºchr
(
fûíame
, '.');

176 
i
 = ()(
poöt
-
fûíame
);

177 
poöt
 = 
	`g_°∫dup
(
fûíame
, 
i
);

178 
≤g_fûíame
 = 
	`g_°rdup_¥ötf
("%s.≤g",
poöt
);

179 
	`g_‰ì
(
poöt
);

180 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"ic⁄", (xmlCh¨ *Ë
	`g_ba£«me
(
≤g_fûíame
));

181 
	`g_‰ì
(
≤g_fûíame
);

182 
sh≠e_ªndîî
->
c⁄√˘i⁄_roŸ
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"connections", NULL);

183 
xml_node_±r
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"aspectratio",NULL);

184 
	`xmlSëPr›
(
xml_node_±r
, (c⁄° 
xmlCh¨
 *)"type", (const xmlChar *)"fixed");

185 
ªndîî
->
roŸ
 = 
	`xmlNewChûd
‘ídîî->roŸ,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"svg", 
NULL
);

187  
ªndîî
;

188 
	}
}

191 
sh≠e_ªndîî_˛ass_öô
 (
Sh≠eRídîîCœss
 *
kœss
);

193 
gpoöãr
 
	g∑ª¡_˛ass
 = 
NULL
;

195 
GTy≥


196 
	$sh≠e_ªndîî_gë_ty≥
 ()

198 
GTy≥
 
obje˘_ty≥
 = 0;

200 i‡(!
obje˘_ty≥
)

202 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

204  (
Sh≠eRídîîCœss
),

205 (
GBa£InôFunc
Ë
NULL
,

206 (
GBa£FöÆizeFunc
Ë
NULL
,

207 (
GCœssInôFunc
Ë
sh≠e_ªndîî_˛ass_öô
,

208 
NULL
,

209 
NULL
,

210  (
Sh≠eRídîî
),

212 
NULL


215 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
DIA_TYPE_SVG_RENDERER
,

217 &
obje˘_öfo
, 0);

220  
obje˘_ty≥
;

221 
	}
}

224 
	$sh≠e_ªndîî_föÆize
 (
GObje˘
 *
obje˘
)

226 
	`G_OBJECT_CLASS
 (
∑ª¡_˛ass
)->
	`föÆize
 (
obje˘
);

227 
	}
}

230 
	$sh≠e_ªndîî_˛ass_öô
 (
Sh≠eRídîîCœss
 *
kœss
)

232 
GObje˘Cœss
 *
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
kœss
);

233 
DüRídîîCœss
 *
ªndîî_˛ass
 = 
	`DIA_RENDERER_CLASS
 (
kœss
);

235 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
kœss
);

237 
obje˘_˛ass
->
föÆize
 = 
sh≠e_ªndîî_föÆize
;

240 
ªndîî_˛ass
->
íd_ªndî
 =Énd_render;

241 
ªndîî_˛ass
->
døw_löe
 = draw_line;

242 
ªndîî_˛ass
->
døw_pﬁylöe
 = draw_polyline;

243 
ªndîî_˛ass
->
døw_pﬁyg⁄
 = draw_polygon;

244 
ªndîî_˛ass
->
døw_ª˘
 = draw_rect;

245 
ªndîî_˛ass
->
døw_ñlù£
 = draw_ellipse;

246 
	}
}

251 
	$íd_ªndî
(
DüRídîî
 *
£lf
)

253 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

254 
ﬁd_bœnks_deÁu…
 = 
¥ëty_f‹m©ed_xml
;

259 
¥ëty_f‹m©ed_xml
 = 
TRUE
;

261 
	`g_‰ì
(
ªndîî
->
löe°yÀ
);

262 
ªndîî
->
löe°yÀ
 = 
NULL
;

264 
	`xmlSëDocCom¥essMode
(
ªndîî
->
doc
, 0);

265 
	`xmlDüSaveFûe
(
ªndîî
->
fûíame
,Ñídîî->
doc
);

266 
	`g_‰ì
(
ªndîî
->
fûíame
);

267 
ªndîî
->
fûíame
 = 
NULL
;

268 
	`xmlFªeDoc
(
ªndîî
->
doc
);

269 
¥ëty_f‹m©ed_xml
 = 
ﬁd_bœnks_deÁu…
;

270 
	}
}

273 
	$add_c⁄√˘i⁄_poöt
 (
Sh≠eRídîî
 *
ªndîî
,

274 
Poöt
 *
poöt
)

276 
xmlNodePå
 
node
;

277 
gch¨
 
buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

279 
node
 = 
	`xmlNewChûd
(
ªndîî
->
c⁄√˘i⁄_roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"point", NULL);

280 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", 
poöt
->
x
);

281 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *Ë
buf
);

282 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", 
poöt
->
y
);

283 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *Ë
buf
);

284 
	}
}

287 
	$døw_löe
(
DüRídîî
 *
£lf
,

288 
Poöt
 *
°¨t
, Poöà*
íd
,

289 
Cﬁ‹
 *
löe_cﬁour
)

291 
Poöt
 
˚¡î
;

292 
Sh≠eRídîî
 *
ªndîî
 = 
	`SHAPE_RENDERER
(
£lf
);

295 
	`DIA_RENDERER_CLASS
(
∑ª¡_˛ass
)->
	`døw_löe
 (
£lf
, 
°¨t
, 
íd
, 
löe_cﬁour
);

298 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, 
°¨t
);

299 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, 
íd
);

300 
˚¡î
.
x
 = (
°¨t
->x + 
íd
->x)/2;

301 
˚¡î
.
y
 = (
°¨t
->y + 
íd
->y)/2;

302 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
˚¡î
);

304 
	}
}

308 
	$døw_pﬁylöe
(
DüRídîî
 *
£lf
,

309 
Poöt
 *
poöts
, 
num_poöts
,

310 
Cﬁ‹
 *
löe_cﬁour
)

312 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

313 
i
;

314 
xmlNodePå
 
node
;

315 
GSåög
 *
°r
;

316 
Poöt
 
˚¡î
;

317 
gch¨
 
px_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

318 
gch¨
 
py_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

320 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"pﬁylöe", 
NULL
);

322 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"style",

323 (
xmlCh¨
 *Ë
	`DIA_SVG_RENDERER_GET_CLASS
(
ªndîî
)->
	`gë_døw_°yÀ
‘ídîî, 
löe_cﬁour
));

325 
°r
 = 
	`g_°rög_√w
(
NULL
);

326 
i
 = 0; i < 
num_poöts
; i++) {

327 
	`g_°rög_≠≥nd_¥ötf
(
°r
, "%s,%s ",

328 
	`g_ascii_f‹m©d
(
px_buf
, ’x_buf), "%g", 
poöts
[
i
].
x
),

329 
	`g_ascii_f‹m©d
(
py_buf
, ’y_buf), "%g", 
poöts
[
i
].
y
) );

330 
	`add_c⁄√˘i⁄_poöt
(
	`SHAPE_RENDERER
(
£lf
), &
poöts
[
i
]);

332 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"poöts", (xmlCh¨ *Ë
°r
->str);

333 
	`g_°rög_‰ì
(
°r
, 
TRUE
);

334 
i
 = 1; i < 
num_poöts
; i++) {

335 
˚¡î
.
x
 = (
poöts
[
i
].x +Öoints[i-1].x)/2;

336 
˚¡î
.
y
 = (
poöts
[
i
].y +Öoints[i-1].y)/2;

337 
	`add_c⁄√˘i⁄_poöt
(
	`SHAPE_RENDERER
(
ªndîî
), &
˚¡î
);

339 
	}
}

344 
	$døw_pﬁyg⁄
(
DüRídîî
 *
£lf
,

345 
Poöt
 *
poöts
, 
num_poöts
,

346 
Cﬁ‹
 *
löe_cﬁour
)

348 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

349 
i
;

350 
xmlNodePå
 
node
;

351 
GSåög
 *
°r
;

352 
Poöt
 
˚¡î
;

353 
gch¨
 
px_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

354 
gch¨
 
py_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

356 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"pﬁyg⁄", 
NULL
);

358 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"style",

359 (
xmlCh¨
 *Ë
	`DIA_SVG_RENDERER_GET_CLASS
(
ªndîî
)->
	`gë_døw_°yÀ
‘ídîî, 
löe_cﬁour
));

361 
°r
 = 
	`g_°rög_√w
(
NULL
);

362 
i
 = 0; i < 
num_poöts
; i++) {

363 
	`g_°rög_≠≥nd_¥ötf
(
°r
, "%s,%s ",

364 
	`g_ascii_f‹m©d
(
px_buf
, ’x_buf), "%g", 
poöts
[
i
].
x
),

365 
	`g_ascii_f‹m©d
(
py_buf
, ’y_buf), "%g", 
poöts
[
i
].
y
) );

366 
	`add_c⁄√˘i⁄_poöt
(
	`SHAPE_RENDERER
(
£lf
), &
poöts
[
i
]);

368 
i
 = 1; i < 
num_poöts
; i++) {

369 
˚¡î
.
x
 = (
poöts
[
i
].x +Öoints[i-1].x)/2;

370 
˚¡î
.
y
 = (
poöts
[
i
].y +Öoints[i-1].y)/2;

371 
	`add_c⁄√˘i⁄_poöt
(
	`SHAPE_RENDERER
(
£lf
), &
˚¡î
);

373 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"poöts", (xmlCh¨ *Ë
°r
->str);

374 
	`g_°rög_‰ì
(
°r
, 
TRUE
);

375 
	}
}

378 
	$add_ª˘™gÀ_c⁄√˘i⁄_poöts
 (
Sh≠eRídîî
 *
ªndîî
,

379 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
)

381 
Poöt
 
c⁄√˘i⁄
;

382 
co‹d
 
˚¡î_x
, 
˚¡î_y
;

384 
˚¡î_x
 = (
ul_c‹√r
->
x
 + 
Ã_c‹√r
->x)/2;

385 
˚¡î_y
 = (
ul_c‹√r
->
y
 + 
Ã_c‹√r
->y)/2;

387 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, 
ul_c‹√r
);

388 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, 
Ã_c‹√r
);

389 
c⁄√˘i⁄
.
x
 = 
ul_c‹√r
->x;

390 
c⁄√˘i⁄
.
y
 = 
Ã_c‹√r
->y;

391 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

392 
c⁄√˘i⁄
.
y
 = 
˚¡î_y
;

393 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

395 
c⁄√˘i⁄
.
x
 = 
Ã_c‹√r
->x;

396 
c⁄√˘i⁄
.
y
 = 
ul_c‹√r
->y;

397 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

398 
c⁄√˘i⁄
.
y
 = 
˚¡î_y
;

399 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

401 
c⁄√˘i⁄
.
x
 = 
˚¡î_x
;

402 
c⁄√˘i⁄
.
y
 = 
Ã_c‹√r
->y;

403 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

404 
c⁄√˘i⁄
.
y
 = 
ul_c‹√r
->y;

405 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

406 
	}
}

410 
	$døw_ª˘
 (
DüRídîî
 *
£lf
,

411 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

412 
Cﬁ‹
 *
cﬁour
)

414 
Sh≠eRídîî
 *
ªndîî
 = 
	`SHAPE_RENDERER
(
£lf
);

417 
	`DIA_RENDERER_CLASS
(
∑ª¡_˛ass
)->
	`døw_ª˘
 (
£lf
, 
ul_c‹√r
, 
Ã_c‹√r
, 
cﬁour
);

419 
	`add_ª˘™gÀ_c⁄√˘i⁄_poöts
(
ªndîî
, 
ul_c‹√r
, 
Ã_c‹√r
);

420 
	}
}

423 
	$add_ñlù£_c⁄√˘i⁄_poöts
 (
Sh≠eRídîî
 *
ªndîî
,

424 
Poöt
 *
˚¡î
,

425 
ªÆ
 
width
,Ñó»
height
)

427 
Poöt
 
c⁄√˘i⁄
;

429 
c⁄√˘i⁄
.
x
 = 
˚¡î
->x;

430 
c⁄√˘i⁄
.
y
 = 
˚¡î
->y + 
height
/2;

431 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

432 
c⁄√˘i⁄
.
y
 = 
˚¡î
->y - 
height
/2;

433 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

435 
c⁄√˘i⁄
.
y
 = 
˚¡î
->y;

436 
c⁄√˘i⁄
.
x
 = 
˚¡î
->x - 
width
/2;

437 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

438 
c⁄√˘i⁄
.
x
 = 
˚¡î
->x + 
width
/2;

439 
	`add_c⁄√˘i⁄_poöt
(
ªndîî
, &
c⁄√˘i⁄
);

440 
	}
}

443 
	$døw_ñlù£
(
DüRídîî
 *
£lf
,

444 
Poöt
 *
˚¡î
,

445 
ªÆ
 
width
,Ñó»
height
,

446 
Cﬁ‹
 *
cﬁour
)

448 
Sh≠eRídîî
 *
ªndîî
 = 
	`SHAPE_RENDERER
(
£lf
);

451 
	`DIA_RENDERER_CLASS
(
∑ª¡_˛ass
)->
	`døw_ñlù£
 (
£lf
, 
˚¡î
, 
width
, 
height
, 
cﬁour
);

454 
	`add_ñlù£_c⁄√˘i⁄_poöts
(
ªndîî
, 
˚¡î
, 
width
, 
height
);

455 
	}
}

458 
	$exp‹t_sh≠e
(
DügømD©a
 *
d©a
, c⁄° 
gch¨
 *
fûíame
,

459 c⁄° 
gch¨
 *
düfûíame
, * 
u£r_d©a
)

461 
DüSvgRídîî
 *
ªndîî
;

462 
i
;

463 
gch¨
 *
poöt
;

464 
gch¨
 *
≤g_fûíame
 = 
NULL
;

465 
DüExp‹tFûãr
 *
exp‹tfûãr
;

466 
gÊﬂt
 
ﬁd_sˇlög
;

467 
Re˘™gÀ
 *
ext
 = &
d©a
->
exã¡s
;

468 
gÊﬂt
 
sˇlög_x
, 
sˇlög_y
;

471 
poöt
 = 
	`°ºchr
(
fûíame
, '.');

472 i‡(
poöt
 =
NULL
 ||

473 
	`°rcmp
(
poöt
, ".shape")) {

474 
	`mesßge_w¨nög
(
	`_
("Shape files mustÉnd in .shape, orÅhey cannot beÜoaded by Dia"));

477 
i
 = ()(
poöt
-
fûíame
);

478 
poöt
 = 
	`g_°∫dup
(
fûíame
, 
i
);

479 
≤g_fûíame
 = 
	`g_°rdup_¥ötf
("%s.≤g",
poöt
);

480 
	`g_‰ì
(
poöt
);

482 
exp‹tfûãr
 = 
	`fûãr_gë_by_«me
 ("png-libart");

484 i‡(!
exp‹tfûãr
)

485 
exp‹tfûãr
 = 
	`fûãr_guess_exp‹t_fûãr
(
≤g_fûíame
);

487 i‡(!
exp‹tfûãr
) {

488 
	`mesßge_w¨nög
(
	`_
("Can'tÉxportÖng icon withoutÉxportÖlug-in!"));

491 
ﬁd_sˇlög
 = 
d©a
->
∑≥r
.
sˇlög
;

492 
sˇlög_x
 = 22/((
ext
->
right
 -Éxt->
À·
) * 20);

493 
sˇlög_y
 = 22/((
ext
->
bŸtom
 -Éxt->
t›
) * 20);

494 
d©a
->
∑≥r
.
sˇlög
 = 
	`MIN
(
sˇlög_x
, 
sˇlög_y
);

495 
exp‹tfûãr
->
	`exp‹t_func
(
d©a
, 
≤g_fûíame
, 
düfûíame
,Éxp‹tfûãr->
u£r_d©a
);

496 
d©a
->
∑≥r
.
sˇlög
 = 
ﬁd_sˇlög
;

499 if((
ªndîî
 = 
	`√w_sh≠e_ªndîî
(
d©a
, 
fûíame
))) {

500 
	`d©a_ªndî
(
d©a
, 
	`DIA_RENDERER
(
ªndîî
), 
NULL
, NULL, NULL);

501 
	`g_obje˘_uƒef
 (
ªndîî
);

507 
	`g_‰ì
(
≤g_fûíame
);

508 
	}
}

510 c⁄° 
gch¨
 *
	gexãnsi⁄s
[] = { "sh≠e", 
NULL
 };

511 
DüExp‹tFûãr
 
	gsh≠e_exp‹t_fûãr
 = {

512 
N_
("Dia Shape File"),

513 
exãnsi⁄s
,

514 
exp‹t_sh≠e


	@O:\tool\dvs50\plug-ins\shape\shape.c

23 
	~<c⁄fig.h
>

24 
	~"öé.h
"

25 
	~"fûãr.h
"

26 
	~"∂ug-ös.h
"

28 
DüExp‹tFûãr
 
sh≠e_exp‹t_fûãr
;

30 
DIA_PLUGIN_CHECK_INIT


32 
PlugöInôResu…


33 
	$dü_∂ugö_öô
(
PlugöInfo
 *
öfo
)

35 i‡(!
	`dü_∂ugö_öfo_öô
(
öfo
, "shape",

36 
	`N_
("dia shapeÉxport filter"),

37 
NULL
, NULL))

38  
DIA_PLUGIN_INIT_ERROR
;

40 
	`fûãr_ªgi°î_exp‹t
(&
sh≠e_exp‹t_fûãr
);

42  
DIA_PLUGIN_INIT_OK
;

43 
	}
}

	@O:\tool\dvs50\plug-ins\svg\render_svg.c

21 
	~<c⁄fig.h
>

23 
	~<°dlib.h
>

24 
	~<°rög.h
>

25 
	~<time.h
>

26 
	~<m©h.h
>

27 
	~<î∫o.h
>

28 #ifde‡
HAVE_UNISTD_H


29 
	~<uni°d.h
>

32 
	~<glib.h
>

33 
	~<glib/g°dio.h
>

35 
	~<libxml/ítôõs.h
>

36 
	~<libxml/åì.h
>

37 
	~<libxml/xmlmem‹y.h
>

39 
	~"geomëry.h
"

40 
	~"düsvgªndîî.h
"

41 
	~"fûãr.h
"

42 
	~"öé.h
"

43 
	~"mesßge.h
"

44 
	~"dügømd©a.h
"

45 
	~"dü_xml_libxml.h
"

46 
	~"obje˘.h
"

47 
	~"ãxéöe.h
"

49 
	gG_BEGIN_DECLS


51 
	#SVG_TYPE_RENDERER
 (
	`svg_ªndîî_gë_ty≥
 ())

	)

52 
	#SVG_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
SVG_TYPE_RENDERER
, 
SvgRídîî
))

	)

53 
	#SVG_RENDERER_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 ((kœss), 
SVG_TYPE_RENDERER
, 
SvgRídîîCœss
))

	)

54 
	#SVG_IS_RENDERER
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
SVG_TYPE_RENDERER
))

	)

55 
	#SVG_RENDERER_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
SVG_TYPE_RENDERER
, 
SvgRídîîCœss
))

	)

57 
GTy≥
 
	$svg_ªndîî_gë_ty≥
 (Ë
G_GNUC_CONST
;

59 
_SvgRídîî
 
	tSvgRídîî
;

60 
_SvgRídîîCœss
 
	tSvgRídîîCœss
;

62 
	s_SvgRídîî


64 
DüSvgRídîî
 
∑ª¡_ö°™˚
;

67 
GQueue
 *
∑ª¡s
;

70 
	s_SvgRídîîCœss


72 
DüSvgRídîîCœss
 
∑ª¡_˛ass
;

75 
G_END_DECLS


77 
DüSvgRídîî
 *
	`√w_svg_ªndîî
(
DügømD©a
 *
d©a
, c⁄° *
fûíame
);

79 
	`døw_obje˘
 (
DüRídîî
 *
ªndîî
,

80 
DüObje˘
 *
obje˘
);

81 
	`døw_rounded_ª˘
 (
DüRídîî
 *
ªndîî
,

82 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

83 
Cﬁ‹
 *
cﬁour
, 
ªÆ
 
roundög
);

84 
	`fûl_rounded_ª˘
 (
DüRídîî
 *
ªndîî
,

85 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

86 
Cﬁ‹
 *
cﬁour
, 
ªÆ
 
roundög
);

87 
	`døw_°rög
 (
DüRídîî
 *
£lf
,

88 c⁄° *
ãxt
,

89 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
,

90 
Cﬁ‹
 *
cﬁour
);

91 
	`døw_ãxt_löe
 (
DüRídîî
 *
£lf
, 
TextLöe
 *
ãxt_löe
,

92 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
, 
Cﬁ‹
 *
cﬁour
);

93 
	`døw_ãxt
 (
DüRídîî
 *
£lf
, 
Text
 *
ãxt
);

95 
	`svg_ªndîî_˛ass_öô
 (
SvgRídîîCœss
 *
kœss
);

97 
gpoöãr
 
∑ª¡_˛ass
 = 
NULL
;

101 
	$svg_ªndîî_öô
 (
GTy≥In°™˚
 *
£lf
, 
gpoöãr
 
g_˛ass
)

103 
SvgRídîî
 *
ªndîî
 = 
	`SVG_RENDERER
 (
£lf
);

105 
ªndîî
->
∑ª¡s
 = 
	`g_queue_√w
 ();

106 
	}
}

108 
GTy≥


109 
	$svg_ªndîî_gë_ty≥
 ()

111 
GTy≥
 
obje˘_ty≥
 = 0;

113 i‡(!
obje˘_ty≥
)

115 c⁄° 
GTy≥Info
 
obje˘_öfo
 =

117  (
SvgRídîîCœss
),

118 (
GBa£InôFunc
Ë
NULL
,

119 (
GBa£FöÆizeFunc
Ë
NULL
,

120 (
GCœssInôFunc
Ë
svg_ªndîî_˛ass_öô
,

121 
NULL
,

122 
NULL
,

123  (
SvgRídîî
),

125 
svg_ªndîî_öô


128 
obje˘_ty≥
 = 
	`g_ty≥_ªgi°î_°©ic
 (
DIA_TYPE_SVG_RENDERER
,

130 &
obje˘_öfo
, 0);

133  
obje˘_ty≥
;

134 
	}
}

137 
	$begö_ªndî
 (
DüRídîî
 *
£lf
)

139 
SvgRídîî
 *
ªndîî
 = 
	`SVG_RENDERER
 (
£lf
);

140 
	`g_as£π
 (
	`g_queue_is_em±y
 (
ªndîî
->
∑ª¡s
));

141 
	`DIA_RENDERER_CLASS
 (
∑ª¡_˛ass
)->
	`begö_ªndî
 (
	`DIA_RENDERER
 (
£lf
));

142 
	}
}

145 
	$íd_ªndî
 (
DüRídîî
 *
£lf
)

147 
SvgRídîî
 *
ªndîî
 = 
	`SVG_RENDERER
 (
£lf
);

148 
	`g_as£π
 (
	`g_queue_is_em±y
 (
ªndîî
->
∑ª¡s
));

149 
	`DIA_RENDERER_CLASS
 (
∑ª¡_˛ass
)->
	`íd_ªndî
 (
	`DIA_RENDERER
 (
£lf
));

150 
	}
}

154 
	$svg_ªndîî_föÆize
 (
GObje˘
 *
obje˘
)

156 
SvgRídîî
 *
svg_ªndîî
 = 
	`SVG_RENDERER
 (
obje˘
);

158 
	`g_queue_‰ì
 (
svg_ªndîî
->
∑ª¡s
);

160 
	`G_OBJECT_CLASS
 (
∑ª¡_˛ass
)->
	`föÆize
 (
obje˘
);

161 
	}
}

164 
	$svg_ªndîî_˛ass_öô
 (
SvgRídîîCœss
 *
kœss
)

166 
GObje˘Cœss
 *
obje˘_˛ass
 = 
	`G_OBJECT_CLASS
 (
kœss
);

167 
DüRídîîCœss
 *
ªndîî_˛ass
 = 
	`DIA_RENDERER_CLASS
 (
kœss
);

169 
∑ª¡_˛ass
 = 
	`g_ty≥_˛ass_≥ek_∑ª¡
 (
kœss
);

171 
obje˘_˛ass
->
föÆize
 = 
svg_ªndîî_föÆize
;

173 
ªndîî_˛ass
->
begö_ªndî
 = begin_render;

174 
ªndîî_˛ass
->
íd_ªndî
 =Énd_render;

175 
ªndîî_˛ass
->
døw_obje˘
 = draw_object;

176 
ªndîî_˛ass
->
døw_rounded_ª˘
 = draw_rounded_rect;

177 
ªndîî_˛ass
->
fûl_rounded_ª˘
 = fill_rounded_rect;

178 
ªndîî_˛ass
->
døw_°rög
 = draw_string;

179 
ªndîî_˛ass
->
døw_ãxt
 = draw_text;

180 
ªndîî_˛ass
->
døw_ãxt_löe
 = draw_text_line;

181 
	}
}

184 
DüSvgRídîî
 *

185 
	$√w_svg_ªndîî
(
DügømD©a
 *
d©a
, c⁄° *
fûíame
)

187 
DüSvgRídîî
 *
ªndîî
;

188 
SvgRídîî
 *
svg_ªndîî
;

189 
FILE
 *
fûe
;

190 
gch¨
 
buf
[512];

191 
time_t
 
time_now
;

192 
Re˘™gÀ
 *
exã¡
;

193 c⁄° *
«me
;

194 
xmlDtdPå
 
dtd
;

196 
fûe
 = 
	`g_f›í
(
fûíame
, "w");

198 i‡(
fûe
==
NULL
) {

199 
	`mesßge_îr‹
(
	`_
("Can't open output file %s: %s\n"),

200 
	`dü_mesßge_fûíame
(
fûíame
), 
	`°ªº‹
(
î∫o
));

201  
NULL
;

203 
	`f˛o£
(
fûe
);

206 
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
	`g_obje˘_√w
(
SVG_TYPE_RENDERER
, 
NULL
));

208 
ªndîî
->
fûíame
 = 
	`g_°rdup
(filename);

210 
ªndîî
->
dash_Àngth
 = 1.0;

211 
ªndîî
->
dŸ_Àngth
 = 0.2;

212 
ªndîî
->
ßved_löe_°yÀ
 = 
LINESTYLE_SOLID
;

214 
ªndîî
->
sˇÀ
 = 20.0;

217 
ªndîî
->
doc
 = 
	`xmlNewDoc
((c⁄° 
xmlCh¨
 *)"1.0");

218 
ªndîî
->
doc
->
ícodög
 = 
	`xmlSådup
((c⁄° 
xmlCh¨
 *)"UTF-8");

219 
ªndîî
->
doc
->
°™dÆ⁄e
 = 
FALSE
;

220 
dtd
 = 
	`xmlCª©eI¡Sub£t
(
ªndîî
->
doc
, (c⁄° 
xmlCh¨
 *)"svg",

221 (c⁄° 
xmlCh¨
 *)"-//W3C//DTD SVG 1.0//EN",

222 (c⁄° 
xmlCh¨
 *)"http://www.w3.org/TR/2001/PR-SVG-20010719/DTD/svg10.dtd");

223 
	`xmlAddChûd
((
xmlNodePå
Ë
ªndîî
->
doc
, (xmlNodePåË
dtd
);

224 
ªndîî
->
roŸ
 = 
	`xmlNewDocNode
‘ídîî->
doc
, 
NULL
, (c⁄° 
xmlCh¨
 *)"svg", NULL);

225 
	`xmlAddSiblög
(
ªndîî
->
doc
->
chûdªn
, (
xmlNodePå
Ëªndîî->
roŸ
);

228 
svg_ªndîî
 = 
	`SVG_RENDERER
 (
ªndîî
);

231 
exã¡
 = &
d©a
->
exã¡s
;

232 
	`g_¢¥ötf
(
buf
, (buf), "%dcm",

233 ()
	`˚û
((
exã¡
->
right
 -Éxã¡->
À·
)));

234 
	`xmlSëPr›
(
ªndîî
->
roŸ
, (c⁄° 
xmlCh¨
 *)"width", (xmlCh¨ *Ë
buf
);

235 
	`g_¢¥ötf
(
buf
, (buf), "%dcm",

236 ()
	`˚û
((
exã¡
->
bŸtom
 -Éxã¡->
t›
)));

237 
	`xmlSëPr›
(
ªndîî
->
roŸ
, (c⁄° 
xmlCh¨
 *)"height", (xmlCh¨ *Ë
buf
);

238 
	`g_¢¥ötf
(
buf
, (buf), "%d %d %d %d",

239 ()
	`Êo‹
(
exã¡
->
À·
 * 
ªndîî
->
sˇÀ
), ()Êo‹”xã¡->
t›
 *Ñenderer->scale),

240 ()
	`˚û
((
exã¡
->
right
 -Éxã¡->
À·
Ë* 
ªndîî
->
sˇÀ
),

241 ()
	`˚û
((
exã¡
->
bŸtom
 -Éxã¡->
t›
Ë* 
ªndîî
->
sˇÀ
));

242 
	`xmlSëPr›
(
ªndîî
->
roŸ
, (c⁄° 
xmlCh¨
 *)"võwBox", (xmlCh¨ *Ë
buf
);

243 
	`xmlSëPr›
(
ªndîî
->
roŸ
,(c⁄° 
xmlCh¨
 *)"xmlns", (const xmlChar *)"http://www.w3.org/2000/svg");

244 
	`xmlSëPr›
(
ªndîî
->
roŸ
,(c⁄° 
xmlCh¨
 *)"xmlns", (const xmlChar *)"http://www.w3.org/2000/svg");

245 
	`xmlSëPr›
(
ªndîî
->
roŸ
,(c⁄° 
xmlCh¨
 *)"xmlns:xlink", (const xmlChar *)"http://www.w3.org/1999/xlink");

247 
time_now
 = 
	`time
(
NULL
);

248 
«me
 = 
	`g_gë_u£r_«me
();

252 
	`xmlAddChûd
(
ªndîî
->
roŸ
, 
	`xmlNewText
("\n"));

253 
	`xmlAddChûd
(
ªndîî
->
roŸ
, 
	`xmlNewCommít
("Dü-Vîsi⁄: "
VERSION
));

254 
	`xmlAddChûd
(
ªndîî
->
roŸ
, 
	`xmlNewText
("\n"));

255 
	`g_¢¥ötf
(
buf
, (buf), "Fûe: %s", 
dü
->
fûíame
);

256 
	`xmlAddChûd
(
ªndîî
->
roŸ
, 
	`xmlNewCommít
(
buf
));

257 
	`xmlAddChûd
(
ªndîî
->
roŸ
, 
	`xmlNewText
("\n"));

258 
	`g_¢¥ötf
(
buf
, (buf), "D©e: %s", 
	`˘ime
(&
time_now
));

259 
buf
[
	`°æí
(buf)-1] = '\0';

260 
	`xmlAddChûd
(
ªndîî
->
roŸ
, 
	`xmlNewCommít
(
buf
));

261 
	`xmlAddChûd
(
ªndîî
->
roŸ
, 
	`xmlNewText
("\n"));

262 
	`g_¢¥ötf
(
buf
, (buf), "F‹: %s", 
«me
);

263 
	`xmlAddChûd
(
ªndîî
->
roŸ
, 
	`xmlNewCommít
(
buf
));

264 
	`xmlAddChûd
(
ªndîî
->
roŸ
, 
	`xmlNewText
("\n\n"));

266 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, "tôÀ", 
dü
->
fûíame
);

269  
ªndîî
;

270 
	}
}

273 
	$døw_obje˘
(
DüRídîî
 *
£lf
,

274 
DüObje˘
 *
obje˘
)

280 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

281 
SvgRídîî
 *
svg_ªndîî
 = 
	`SVG_RENDERER
 (
£lf
);

282 
n_chûdªn
 = 0;

283 
xmlNodePå
 
chûd
, 
group
;

285 
	`g_queue_push_èû
 (
svg_ªndîî
->
∑ª¡s
, 
ªndîî
->
roŸ
);

287 
ªndîî
->
roŸ
 = 
group
 = 
	`xmlNewNode
 (ªndîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"g");

289 
obje˘
->
›s
->
	`døw
(obje˘, 
	`DIA_RENDERER
 (
ªndîî
));

292 
chûd
 = 
ªndîî
->
roŸ
->
chûdªn
;

293 
chûd
 !
NULL
) {

294 
chûd
 = chûd->
√xt
;

295 ++
n_chûdªn
;

297 
ªndîî
->
roŸ
 = 
	`g_queue_p›_èû
 (
svg_ªndîî
->
∑ª¡s
);

299 i‡(1 =
n_chûdªn
) {

300 
	`xmlAddChûd
 (
ªndîî
->
roŸ
, 
group
->
chûdªn
);

301 
	`xmlU∆ökNode
 (
group
);

302 
	`xmlFªe
 (
group
);

304 
	`xmlAddChûd
 (
ªndîî
->
roŸ
, 
group
);

306 
	}
}

309 
	$døw_rounded_ª˘
(
DüRídîî
 *
£lf
,

310 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

311 
Cﬁ‹
 *
cﬁour
, 
ªÆ
 
roundög
)

313 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

314 
xmlNodePå
 
node
;

315 
gch¨
 
buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

317 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"rect", NULL);

319 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"style",

320 (c⁄° 
xmlCh¨
 *Ë
	`DIA_SVG_RENDERER_GET_CLASS
(
£lf
)->
	`gë_døw_°yÀ
(
ªndîî
, 
cﬁour
));

322 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", 
ul_c‹√r
->
x
 * 
ªndîî
->
sˇÀ
);

323 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *Ë
buf
);

324 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", 
ul_c‹√r
->
y
 * 
ªndîî
->
sˇÀ
);

325 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *Ë
buf
);

326 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", (
Ã_c‹√r
->
x
 - 
ul_c‹√r
->xË* 
ªndîî
->
sˇÀ
);

327 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"width", (xmlCh¨ *Ë
buf
);

328 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", (
Ã_c‹√r
->
y
 - 
ul_c‹√r
->yË* 
ªndîî
->
sˇÀ
);

329 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"height", (xmlCh¨ *Ë
buf
);

330 
	`g_ascii_f‹m©d
(
buf
, (buf),"%g", (
roundög
 * 
ªndîî
->
sˇÀ
));

331 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"rx", (xmlCh¨ *Ë
buf
);

332 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"ry", (xmlCh¨ *Ë
buf
);

333 
	}
}

336 
	$fûl_rounded_ª˘
(
DüRídîî
 *
£lf
,

337 
Poöt
 *
ul_c‹√r
, Poöà*
Ã_c‹√r
,

338 
Cﬁ‹
 *
cﬁour
, 
ªÆ
 
roundög
)

340 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

341 
xmlNodePå
 
node
;

342 
gch¨
 
buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

344 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
, 
NULL
, (c⁄° 
xmlCh¨
 *)"rect", NULL);

346 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"style",

347 (c⁄° 
xmlCh¨
 *Ë
	`DIA_SVG_RENDERER_GET_CLASS
(
£lf
)->
	`gë_fûl_°yÀ
(
ªndîî
, 
cﬁour
));

349 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", (
ul_c‹√r
->
x
 * 
ªndîî
->
sˇÀ
));

350 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *Ë
buf
);

351 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", (
ul_c‹√r
->
y
 * 
ªndîî
->
sˇÀ
));

352 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *Ë
buf
);

353 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", (
Ã_c‹√r
->
x
 - 
ul_c‹√r
->xË* 
ªndîî
->
sˇÀ
);

354 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"width", (xmlCh¨ *Ë
buf
);

355 
	`g_ascii_f‹m©d
(
buf
, (buf), "%g", (
Ã_c‹√r
->
y
 - 
ul_c‹√r
->yË* 
ªndîî
->
sˇÀ
);

356 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"height", (xmlCh¨ *Ë
buf
);

357 
	`g_ascii_f‹m©d
(
buf
, (buf),"%g", (
roundög
 * 
ªndîî
->
sˇÀ
));

358 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"rx", (xmlCh¨ *Ë
buf
);

359 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"ry", (xmlCh¨ *Ë
buf
);

360 
	}
}

362 
	#dü_svg_dto°r
(
buf
,
d
) \

363 
	`g_ascii_f‹m©d
(
buf
,(buf),"%g",(
d
)*
ªndîî
->
sˇÀ
)

	)

366 
	$node_£t_ãxt_°yÀ
 (
xmlNodePå
 
node
,

367 
DüSvgRídîî
 *
ªndîî
,

368 c⁄° 
DüF⁄t
 *
f⁄t
,

369 
ªÆ
 
f⁄t_height
,

370 
Alignmít
 
Æignmít
,

371 
Cﬁ‹
 *
cﬁour
)

373 *
°yÀ
, *
tmp
;

374 
ªÆ
 
ßved_width
;

375 
gch¨
 
d_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

376 
DüSvgRídîîCœss
 *
svg_ªndîî_˛ass
 = 
	`DIA_SVG_RENDERER_GET_CLASS
 (
ªndîî
);

381 
ªÆ
 
f⁄t_size
 = 
	`dü_f⁄t_gë_size
 (
f⁄t
Ë* (
f⁄t_height
 / 
	`dü_f⁄t_gë_height
 (font));

383 c⁄° 
gch¨
 *
Ámûy
 = 
	`dü_f⁄t_gë_Ámûy
(
f⁄t
);

385 
ßved_width
 = 
ªndîî
->
löewidth
;

386 
ªndîî
->
löewidth
 = 0.001;

387 
°yÀ
 = (*)
svg_ªndîî_˛ass
->
	`gë_fûl_°yÀ
(
ªndîî
, 
cﬁour
);

389 
ªndîî
->
löewidth
 = 
ßved_width
;

393 
Æignmít
) {

394 
ALIGN_LEFT
:

395 
°yÀ
 = 
	`g_°rc⁄ˇt
(°yÀ, ";ãxt-™ch‹:°¨t", 
NULL
);

397 
ALIGN_CENTER
:

398 
°yÀ
 = 
	`g_°rc⁄ˇt
(°yÀ, ";ãxt-™ch‹:middÀ", 
NULL
);

400 
ALIGN_RIGHT
:

401 
°yÀ
 = 
	`g_°rc⁄ˇt
(°yÀ, ";ãxt-™ch‹:íd", 
NULL
);

405 
tmp
 = 
	`g_°rdup_¥ötf
("%s;f⁄t-size:%s", 
°yÀ
,

406 
	`dü_svg_dto°r
(
d_buf
, 
f⁄t_size
) );

407 
	`g_‰ì
 (
°yÀ
);

408 
°yÀ
 = 
tmp
;

411 
	`dü_svg_dto°r
(
d_buf
, 
f⁄t_size
);

412 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"f⁄t-size", (xmlCh¨ *Ë
d_buf
);

415 i‡(
f⁄t
) {

416 
tmp
 = 
	`g_°rdup_¥ötf
("%s;font-family:%s;font-style:%s;"

417 "f⁄t-weight:%s",
°yÀ
,

418 
	`°rcmp
(
Ámûy
, "sans") == 0 ? "sans-serif" : family,

419 
	`dü_f⁄t_gë_¶™t_°rög
(
f⁄t
),

420 
	`dü_f⁄t_gë_weight_°rög
(
f⁄t
));

421 
	`g_‰ì
(
°yÀ
);

422 
°yÀ
 = 
tmp
;

427 
	`xmlSëPr›
(
node
, (
xmlCh¨
 *)"°yÀ", (xmlCh¨ *)
°yÀ
);

428 
	`g_‰ì
(
°yÀ
);

429 
	}
}

432 
	$døw_°rög
(
DüRídîî
 *
£lf
,

433 c⁄° *
ãxt
,

434 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
,

435 
Cﬁ‹
 *
cﬁour
)

437 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

438 
xmlNodePå
 
node
;

439 
gch¨
 
d_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

441 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (
xmlCh¨
 *)"ãxt", (xmlCh¨ *)
ãxt
);

443 
	`node_£t_ãxt_°yÀ
(
node
, 
ªndîî
, 
£lf
->
f⁄t
, sñf->
f⁄t_height
, 
Æignmít
, 
cﬁour
);

445 
	`dü_svg_dto°r
(
d_buf
, 
pos
->
x
);

446 
	`xmlSëPr›
(
node
, (
xmlCh¨
 *)"x", (xmlCh¨ *)
d_buf
);

447 
	`dü_svg_dto°r
(
d_buf
, 
pos
->
y
);

448 
	`xmlSëPr›
(
node
, (
xmlCh¨
 *)"y", (xmlCh¨ *)
d_buf
);

449 
	}
}

452 
	$døw_ãxt_löe
(
DüRídîî
 *
£lf
, 
TextLöe
 *
ãxt_löe
,

453 
Poöt
 *
pos
, 
Alignmít
 
Æignmít
, 
Cﬁ‹
 *
cﬁour
)

455 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

456 
xmlNodePå
 
node
;

457 
DüF⁄t
 *
f⁄t
 = 
	`ãxt_löe_gë_f⁄t
(
ãxt_löe
);

458 
ªÆ
 
f⁄t_height
 = 
	`ãxt_löe_gë_height
(
ãxt_löe
);

459 
gch¨
 
d_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

461 
node
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"text",

462 (
xmlCh¨
 *Ë
	`ãxt_löe_gë_°rög
(
ãxt_löe
));

465 
	`node_£t_ãxt_°yÀ
(
node
, 
ªndîî
, 
f⁄t
, 
f⁄t_height
, 
Æignmít
, 
cﬁour
);

467 
	`dü_svg_dto°r
(
d_buf
, 
pos
->
x
);

468 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *Ë
d_buf
);

469 
	`dü_svg_dto°r
(
d_buf
, 
pos
->
y
);

470 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *Ë
d_buf
);

471 
	`dü_svg_dto°r
(
d_buf
, 
	`ãxt_löe_gë_width
(
ãxt_löe
));

472 
	`xmlSëPr›
(
node
, (c⁄° 
xmlCh¨
*)"ãxtLígth", (xmlCh¨ *Ë
d_buf
);

473 
	}
}

476 
	$døw_ãxt
 (
DüRídîî
 *
£lf
, 
Text
 *
ãxt
)

478 
DüSvgRídîî
 *
ªndîî
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

479 
Poöt
 
pos
 = 
ãxt
->
posôi⁄
;

480 
i
;

481 
xmlNodePå
 
node_ãxt
, 
node_t•™
;

482 
gch¨
 
d_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

484 
node_ãxt
 = 
	`xmlNewChûd
(
ªndîî
->
roŸ
,Ñídîî->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"ãxt", 
NULL
);

486 
	`node_£t_ãxt_°yÀ
(
node_ãxt
, 
ªndîî
, 
ãxt
->
f⁄t
,Åext->
height
,Åext->
Æignmít
, &ãxt->
cﬁ‹
);

487 
	`dü_svg_dto°r
(
d_buf
, 
pos
.
x
);

488 
	`xmlSëPr›
(
node_ãxt
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *Ë
d_buf
);

489 
	`dü_svg_dto°r
(
d_buf
, 
pos
.
y
);

490 
	`xmlSëPr›
(
node_ãxt
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *Ë
d_buf
);

492 
pos
 = 
ãxt
->
posôi⁄
;

493 
i
=0;i<
ãxt
->
numlöes
;i++) {

494 
TextLöe
 *
ãxt_löe
 = 
ãxt
->
löes
[
i
];

496 
node_t•™
 = 
	`xmlNewTextChûd
(
node_ãxt
, 
ªndîî
->
svg_«me_•a˚
, (c⁄° 
xmlCh¨
 *)"tspan",

497 (c⁄° 
xmlCh¨
 *)
	`ãxt_löe_gë_°rög
(
ãxt_löe
));

498 
	`dü_svg_dto°r
(
d_buf
, 
pos
.
x
);

499 
	`xmlSëPr›
(
node_t•™
, (c⁄° 
xmlCh¨
 *)"x", (xmlCh¨ *Ë
d_buf
);

500 
	`dü_svg_dto°r
(
d_buf
, 
pos
.
y
);

501 
	`xmlSëPr›
(
node_t•™
, (c⁄° 
xmlCh¨
 *)"y", (xmlCh¨ *Ë
d_buf
);

503 
pos
.
y
 +
ãxt
->
height
;

505 
	}
}

508 
	$exp‹t_svg
(
DügømD©a
 *
d©a
, c⁄° 
gch¨
 *
fûíame
,

509 c⁄° 
gch¨
 *
düfûíame
, * 
u£r_d©a
)

511 
DüSvgRídîî
 *
ªndîî
;

513 i‡((
ªndîî
 = 
	`√w_svg_ªndîî
(
d©a
, 
fûíame
))) {

514 
	`d©a_ªndî
(
d©a
, 
	`DIA_RENDERER
(
ªndîî
), 
NULL
, NULL, NULL);

515 
	`g_obje˘_uƒef
(
ªndîî
);

517 
	}
}

519 c⁄° 
gch¨
 *
	gexãnsi⁄s
[] = { "svg", 
NULL
 };

520 
DüExp‹tFûãr
 
	gsvg_exp‹t_fûãr
 = {

521 
N_
("Scalable Vector Graphics"),

522 
exãnsi⁄s
,

523 
exp‹t_svg


	@O:\tool\dvs50\plug-ins\svg\svg-import.c

24 #ifde‡
HAVE_CONFIG_H


25 
	~<c⁄fig.h
>

28 
	~<°dio.h
>

29 
	~<°rög.h
>

30 
	~<m©h.h
>

31 
	~<glib.h
>

32 
	~<°dlib.h
>

33 
	~<libxml/åì.h
>

34 
	~<libxml/∑r£r.h
>

35 
	~<libxml/xmlmem‹y.h
>

36 
	~<Êﬂt.h
>

38 
	~"öé.h
"

39 
	~"mesßge.h
"

40 
	~"geomëry.h
"

41 
	~"fûãr.h
"

42 
	~"obje˘.h
"

43 
	~"¥›îtõs.h
"

44 
	~"¥›öã∫Æs.h
"

45 
	~"dü_xml_libxml.h
"

46 
	~"öé.h
"

47 
	~"dü_svg.h
"

48 
	~"¸óã.h
"

49 
	~"group.h
"

50 
	~"f⁄t.h
"

51 
	~"©åibuãs.h
"

53 
gboﬁón
 
imp‹t_svg
(c⁄° 
gch¨
 *
fûíame
, 
DügømD©a
 *
dü
, * 
u£r_d©a
);

54 
GLi°
 *
ªad_ñlù£_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, GLi° *
li°
);

55 
GLi°
 *
ªad_ª˘_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, GLi° *
li°
);

56 
GLi°
 *
ªad_löe_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, GLi° *
li°
);

57 
GLi°
 *
ªad_pﬁy_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, GLi° *
li°
, *
obje˘_ty≥
);

58 
GLi°
 *
ªad_ãxt_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, GLi° *
li°
);

59 
GLi°
 *
ªad_∑th_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, GLi° *
li°
);

60 
GPåAºay
 *
make_ñemít_¥›s
(
ªÆ
 
xpos
,Ñó»
ypos
,Ñó»
width
,Ñó»
height
);

63 
Cﬁ‹


64 
	$gë_cﬁour
(
göt32
 
c
)

66 
Cﬁ‹
 
cﬁour
;

67 
cﬁour
.
ªd
 = ((
c
 & 0xff0000) >> 16) / 255.0;

68 
cﬁour
.
gªí
 = ((
c
 & 0x00ff00) >> 8) / 255.0;

69 
cﬁour
.
blue
 = (
c
 & 0x0000ff) / 255.0;

71  
cﬁour
;

72 
	}
}

77 c⁄° 
gdoubÀ
 
	gDEFAULT_SVG_SCALE
 = 20.0;

78 
gdoubÀ
 
	gu£r_sˇÀ
 = 20.0;

85 
gdoubÀ


86 
	$gë_vÆue_as_cm
 (c⁄° 
gch¨
 *
≈å
,

87 
gch¨
 **
íd±r
)

89 
gch¨
 *
ídp
 = 
NULL
;

90 
gdoubÀ
 
vÆ
 = 0.0;

92 
	`g_ªtu∫_vÆ_if_Áû
 (
≈å
 !
NULL
, 0.0);

94 
vÆ
 = 
	`g_ascii_°πod
 (
≈å
, &
ídp
);

95 i‡(!
ídp
 || '\0' == *endp || ' ' == *endp || ',' == *endp || ';' == *endp)

96 
vÆ
 /
u£r_sˇÀ
;

97 i‡(
	`°∫cmp
(
ídp
, "px", 2) == 0)

98 
vÆ
 /
u£r_sˇÀ
, 
ídp
+=2;

99 i‡(
	`°∫cmp
(
ídp
, "cm", 2) == 0)

100 
vÆ
 *1.0, 
ídp
+=2;

101 i‡(
	`°∫cmp
(
ídp
, "mm", 2) == 0)

102 
vÆ
 /10.0, 
ídp
+=2;

103 i‡(
	`°∫cmp
(
ídp
, "in", 2) == 0)

104 
vÆ
 /2.54, 
ídp
+=2;

105 i‡(
	`°∫cmp
(
ídp
, "pt", 2) == 0)

106 
vÆ
 *0.03528, 
ídp
+=2;

109 i‡(
íd±r
)

110 *
íd±r
 = 
ídp
;

112  
vÆ
;

113 
	}
}

115 
Pr›Des¸ùti⁄
 
	gsvg_löe_¥›_descs
[] = {

116 { "°¨t_poöt", 
PROP_TYPE_POINT
 },

117 { "íd_poöt", 
PROP_TYPE_POINT
 },

118 
PROP_DESC_END
};

120 
Pr›Des¸ùti⁄
 
	gsvg_ª˘_¥›_descs
[] = {

121 { "°¨t_poöt", 
PROP_TYPE_POINT
 },

122 { "íd_poöt", 
PROP_TYPE_POINT
 },

123 { "c‹√r_ødius", 
PROP_TYPE_REAL
},

124 
PROP_DESC_END
};

126 
Pr›Des¸ùti⁄
 
	gsvg_°yÀ_¥›_descs
[] = {

127 { "löe_cﬁour", 
PROP_TYPE_COLOUR
 },

128 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
 },

129 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
},

130 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
 },

131 { "show_background", 
PROP_TYPE_BOOL
 },

132 
PROP_DESC_END
};

134 
Pr›Des¸ùti⁄
 
	gsvg_ñemít_¥›_descs
[] = {

135 { "ñem_c‹√r", 
PROP_TYPE_POINT
 },

136 { "ñem_width", 
PROP_TYPE_REAL
 },

137 { "ñem_height", 
PROP_TYPE_REAL
 },

138 
PROP_DESC_END
};

140 
Pr›Des¸ùti⁄
 
	g_¨row_¥›_descs
[] = {

141 
PROP_STD_START_ARROW
,

142 
PROP_STD_END_ARROW
,

143 
PROP_DESC_END


147 
	$ª£t_¨rows
 (
DüObje˘
 *
obj
)

149 
GPåAºay
 *
¥›s
;

150 
i
;

152 
¥›s
 = 
	`¥›_li°_‰om_descs
(
_¨row_¥›_descs
,
pdçp_åue
);

153 
	`g_as£π
(
¥›s
->
Àn
 == 2);

154 
i
 = 0; i < 2; ++i)

155 ((
AºowPr›îty
 *)
	`g_±r_¨øy_ödex
(
¥›s
, 0))->
¨row_d©a
.
ty≥
 = 
ARROW_NONE
;

156 
obj
->
›s
->
	`£t_¥›s
(obj, 
¥›s
);

157 
	`¥›_li°_‰ì
(
¥›s
);

158 
	}
}

160 
GPåAºay
 *

161 
	$make_ñemít_¥›s
(
ªÆ
 
xpos
,Ñó»
ypos
,

162 
ªÆ
 
width
,Ñó»
height
)

164 
GPåAºay
 *
¥›s
;

165 
PoötPr›îty
 *
µr›
;

166 
RólPr›îty
 *
Ωr›
;

168 
¥›s
 = 
	`¥›_li°_‰om_descs
(
svg_ñemít_¥›_descs
,
pdçp_åue
);

169 
	`g_as£π
(
¥›s
->
Àn
 == 3);

171 
µr›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,0);

172 
µr›
->
poöt_d©a
.
x
 = 
xpos
;

173 
µr›
->
poöt_d©a
.
y
 = 
ypos
;

174 
Ωr›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,1);

175 
Ωr›
->
ªÆ_d©a
 = 
width
;

176 
Ωr›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,2);

177 
Ωr›
->
ªÆ_d©a
 = 
height
;

179  
¥›s
;

180 
	}
}

182 
Pr›Des¸ùti⁄
 
	gsvg_ãxt_¥›_descs
[] = {

183 { "ãxt", 
PROP_TYPE_TEXT
 },

184 
PROP_DESC_END
};

188 
	$≠∂y_°yÀ
(
DüObje˘
 *
obj
, 
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
)

190 
DüSvgStyÀ
 *
gs
;

191 
GPåAºay
 *
¥›s
;

192 
Löe°yÀPr›îty
 *
l•r›
;

193 
Cﬁ‹Pr›îty
 *
˝r›
;

194 
RólPr›îty
 *
Ωr›
;

195 
BoﬁPr›îty
 *
b¥›
;

197 
gs
 = 
	`g_√w0
(
DüSvgStyÀ
, 1);

199 
	`dü_svg_°yÀ_öô
 (
gs
, 
∑ª¡_°yÀ
);

201 
	`dü_svg_∑r£_°yÀ
(
node
, 
gs
, 
u£r_sˇÀ
);

202 
¥›s
 = 
	`¥›_li°_‰om_descs
(
svg_°yÀ_¥›_descs
, 
pdçp_åue
);

203 
	`g_as£π
(
¥›s
->
Àn
 == 5);

205 
˝r›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,0);

206 if(
gs
->
°roke
 != (-1)) {

207 
˝r›
->
cﬁ‹_d©a
 = 
	`gë_cﬁour
(
gs
->
°roke
);

209 if(
gs
->
fûl
 =
DIA_SVG_COLOUR_NONE
) {

210 
˝r›
->
cﬁ‹_d©a
 = 
	`gë_cﬁour
(0x000000);

212 
˝r›
->
cﬁ‹_d©a
 = 
	`gë_cﬁour
(
gs
->
fûl
);

215 
Ωr›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,1);

216 
Ωr›
->
ªÆ_d©a
 = 
gs
->
löe_width
;

218 
l•r›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,2);

219 
l•r›
->
°yÀ
 = 
gs
->
löe°yÀ
 !
DIA_SVG_LINESTYLE_DEFAULT
 ? gs->löe°yÀ : 
LINESTYLE_SOLID
;

220 
l•r›
->
dash
 = 
gs
->
dashÀngth
;

222 
˝r›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,3);

223 
˝r›
->
cﬁ‹_d©a
 = 
	`gë_cﬁour
(
gs
->
fûl
);

225 
b¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,4);

226 if(
gs
->
fûl
 == (-1)) {

227 
b¥›
->
boﬁ_d©a
 = 
FALSE
;

229 
b¥›
->
boﬁ_d©a
 = 
TRUE
;

232 
obj
->
›s
->
	`£t_¥›s
(obj, 
¥›s
);

234 i‡(
gs
->
f⁄t
)

235 
	`dü_f⁄t_uƒef
 (
gs
->
f⁄t
);

236 
	`g_‰ì
(
gs
);

237 
	}
}

240 
GLi°
 *

241 
	$ªad_∑th_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, 
GLi°
 *
li°
)

243 
DüObje˘Ty≥
 *
Ÿy≥
;

244 
DüObje˘
 *
√w_obj
;

245 
H™dÀ
 *
h1
, *
h2
;

246 
BezõrCª©eD©a
 *
bcd
;

247 
gch¨
 *
°r
, *
∑thd©a
, *
u≈¨£d
 = 
NULL
;

248 
GAºay
 *
bezpoöts
 = 
NULL
;

249 
gboﬁón
 
˛o£d
 = 
FALSE
;

250 
göt
 
i
;

252 
∑thd©a
 = 
°r
 = (*Ë
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"d");

254 
bezpoöts
 = 
	`dü_svg_∑r£_∑th
 (
∑thd©a
, &
u≈¨£d
, &
˛o£d
);

256 i‡(
bezpoöts
 && bezpoöts->
Àn
 > 0) {

257 i‡(
	`g_¨øy_ödex
(
bezpoöts
, 
BezPoöt
, 0).
ty≥
 !
BEZ_MOVE_TO
) {

258 
	`mesßge_w¨nög
 (
	`_
("InvalidÖath data.\n"

261 } i‡(!
˛o£d
)

262 
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - BezierLine");

264 
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Beziergon");

266 i‡(
Ÿy≥
 =
NULL
){

267 
	`mesßge_îr‹
(
	`_
("Can't find standard object"));

270 
bcd
 = 
	`g_√w
(
BezõrCª©eD©a
, 1);

271 
bcd
->
num_poöts
 = 
bezpoöts
->
Àn
;

272 
bcd
->
poöts
 = &(
	`g_¨øy_ödex
(
bezpoöts
, 
BezPoöt
, 0));

274 
i
 = 0; i < 
bcd
->
num_poöts
; ++i) {

275 
bcd
->
poöts
[
i
].
p1
.
x
 /
u£r_sˇÀ
;

276 
bcd
->
poöts
[
i
].
p1
.
y
 /
u£r_sˇÀ
;

277 
bcd
->
poöts
[
i
].
p2
.
x
 /
u£r_sˇÀ
;

278 
bcd
->
poöts
[
i
].
p2
.
y
 /
u£r_sˇÀ
;

279 
bcd
->
poöts
[
i
].
p3
.
x
 /
u£r_sˇÀ
;

280 
bcd
->
poöts
[
i
].
p3
.
y
 /
u£r_sˇÀ
;

282 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(
NULL
, 
bcd
, &
h1
, &
h2
);

283 i‡(!
˛o£d
)

284 
	`ª£t_¨rows
 (
√w_obj
);

285 
	`g_‰ì
(
bcd
);

286 
	`≠∂y_°yÀ
(
√w_obj
, 
node
, 
∑ª¡_°yÀ
);

287 
li°
 = 
	`g_li°_≠≥nd
 (li°, 
√w_obj
);

289 
	`g_¨øy_£t_size
 (
bezpoöts
, 0);

291 
∑thd©a
 = 
u≈¨£d
;

292 
u≈¨£d
 = 
NULL
;

293 } 
∑thd©a
);

295 i‡(
bezpoöts
)

296 
	`g_¨øy_‰ì
 (
bezpoöts
, 
TRUE
);

298 
	`xmlFªe
 (
°r
);

300  
li°
;

301 
	}
}

304 
GLi°
 *

305 
	$ªad_ãxt_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, 
GLi°
 *
li°
)

307 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Text");

308 
DüObje˘
 *
√w_obj
;

309 
H™dÀ
 *
h1
, *
h2
;

310 
Poöt
 
poöt
;

311 
GPåAºay
 *
¥›s
;

312 
TextPr›îty
 *
¥›
;

313 
xmlCh¨
 *
°r
 = 
NULL
;

314 
gch¨
 *
mu…ûöe
 = 
NULL
;

315 
DüSvgStyÀ
 *
gs
;

316 
gboﬁón
 
™y_t•™
 = 
FALSE
;

318 
gs
 = 
	`g_√w
(
DüSvgStyÀ
, 1);

319 
	`dü_svg_°yÀ_öô
 (
gs
, 
∑ª¡_°yÀ
);

321 
poöt
.
x
 = 0;

322 
poöt
.
y
 = 0;

324 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x");

325 i‡(
°r
) {

326 
poöt
.
x
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

327 
	`xmlFªe
(
°r
);

330 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y");

331 i‡(
°r
) {

332 
poöt
.
y
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

333 
	`xmlFªe
(
°r
);

336 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"text-anchor");

337 i‡(
°r
) {

338 i‡(
	`xmlSåcmp
(
°r
, (c⁄° 
xmlCh¨
*)"middle") == 0)

339 
gs
->
Æignmít
 = 
ALIGN_CENTER
;

340 i‡(
	`xmlSåcmp
(
°r
, (c⁄° 
xmlCh¨
*)"end") == 0)

341 
gs
->
Æignmít
 = 
ALIGN_RIGHT
;

342 i‡(
	`xmlSåcmp
(
°r
, (c⁄° 
xmlCh¨
*)"start") == 0)

343 
gs
->
Æignmít
 = 
ALIGN_LEFT
;

344 
	`xmlFªe
(
°r
);

348 
xmlNode
 *
t•™
 = 
node
->
chûdªn
;

349 
GSåög
 *
∑øgøph
 = 
	`g_°rög_sized_√w
(512);

350 
t•™
) {

351 i‡(
	`xmlSåcmp
 (
t•™
->
«me
, (c⁄° 
xmlCh¨
*)"tspan") == 0) {

352 
xmlCh¨
 *
löe
 = 
	`xmlNodeGëC⁄ã¡
(
t•™
);

353 i‡(
™y_t•™
)

354 
	`g_°rög_≠≥nd
(
∑øgøph
, "\n");

355 
	`g_°rög_≠≥nd
(
∑øgøph
, (
gch¨
*)
löe
);

356 
	`xmlFªe
(
löe
);

357 
™y_t•™
 = 
TRUE
;

359 
t•™
 =Å•™->
√xt
;

361 
mu…ûöe
 = 
∑øgøph
->
°r
;

362 
	`g_°rög_‰ì
 (
∑øgøph
, 
FALSE
);

363 
°r
 = 
NULL
;

365 i‡(!
™y_t•™
) {

366 
°r
 = 
	`xmlNodeGëC⁄ã¡
(
node
);

368 if(
°r
 || 
mu…ûöe
) {

369 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(&
poöt
, oty≥->
deÁu…_u£r_d©a
,

370 &
h1
, &
h2
);

371 
li°
 = 
	`g_li°_≠≥nd
 (li°, 
√w_obj
);

373 
¥›s
 = 
	`¥›_li°_‰om_descs
(
svg_ãxt_¥›_descs
, 
pdçp_åue
);

374 
	`g_as£π
(
¥›s
->
Àn
 == 1);

376 
	`dü_svg_∑r£_°yÀ
(
node
, 
gs
, 
u£r_sˇÀ
);

377 if(
gs
->
f⁄t
 =
NULL
) {

378 
gs
->
f⁄t
 = 
	`dü_f⁄t_√w_‰om_Àgacy_«me
("Courier");

380 
¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
, 0);

381 
	`g_‰ì
(
¥›
->
ãxt_d©a
);

382 
¥›
->
ãxt_d©a
 = 
°r
 ? 
	`g_°rdup
((*Ë°rË: 
mu…ûöe
;

383 
	`xmlFªe
(
°r
);

384 
¥›
->
©å
.
Æignmít
 = 
gs
->alignment;

385 
¥›
->
©å
.
posôi⁄
.
x
 = 
poöt
.x;

386 
¥›
->
©å
.
posôi⁄
.
y
 = 
poöt
.y;

389 
¥›
->
©å
.
f⁄t
 = 
	`dü_f⁄t_ªf
 (
gs
->font);

390 
¥›
->
©å
.
height
 = 
gs
->
f⁄t_height
;

393 
gs
->
fûl
) {

394 
DIA_SVG_COLOUR_NONE
 :

396 
DIA_SVG_COLOUR_TEXT
 :

397 
DIA_SVG_COLOUR_BACKGROUND
 :

398 
¥›
->
©å
.
cﬁ‹
 = 
	`©åibuãs_gë_f‹eground
();

400 
DIA_SVG_COLOUR_FOREGROUND
 :

401 
¥›
->
©å
.
cﬁ‹
 = 
	`©åibuãs_gë_background
();

404 
¥›
->
©å
.
cﬁ‹
 = 
	`gë_cﬁour
 (
gs
->
fûl
);

407 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

408 
	`¥›_li°_‰ì
(
¥›s
);

410 i‡(
gs
->
f⁄t
)

411 
	`dü_f⁄t_uƒef
 (
gs
->
f⁄t
);

412 
	`g_‰ì
(
gs
);

414  
li°
;

415 
	}
}

418 
GLi°
 *

419 
	$ªad_pﬁy_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, 
GLi°
 *
li°
, *
obje˘_ty≥
)

421 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
(
obje˘_ty≥
);

422 
DüObje˘
 *
√w_obj
;

423 
H™dÀ
 *
h1
, *
h2
;

424 
Mu…ùoötCª©eD©a
 *
pcd
;

425 
Poöt
 *
poöts
;

426 
GAºay
 *
¨r
 = 
	`g_¨øy_√w
(
FALSE
, FALSE, (
ªÆ
));

427 
ªÆ
 
vÆ
, *
øº
;

428 
xmlCh¨
 *
°r
;

429 *
tmp
;

430 
i
;

432 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"points");

433 
tmp
 = (*Ë
°r
;

434 
tmp
[0] != '\0') {

436 
tmp
[0] !'\0' && !
	`g_ascii_isdigô
(tmp[0]) &&Åmp[0]!='.'&&tmp[0]!='-')

437 
tmp
++;

438 i‡(
tmp
[0] == '\0') ;

439 
vÆ
 = 
	`gë_vÆue_as_cm
(
tmp
, &tmp);

440 
	`g_¨øy_≠≥nd_vÆ
(
¨r
, 
vÆ
);

442 
	`xmlFªe
(
°r
);

443 
vÆ
 = 0;

444 i‡(
¨r
->
Àn
 % 2 == 1)

445 
	`g_¨øy_≠≥nd_vÆ
(
¨r
, 
vÆ
);

446 
poöts
 = 
	`g_mÆloc0
(
¨r
->
Àn
/2*(
Poöt
));

448 
pcd
 = 
	`g_√w
(
Mu…ùoötCª©eD©a
, 1);

449 
pcd
->
num_poöts
 = 
¨r
->
Àn
/2;

450 
øº
 = (
ªÆ
 *)
¨r
->
d©a
;

451 
i
 = 0; i < 
pcd
->
num_poöts
; i++) {

452 
poöts
[
i
].
x
 = 
øº
[2*i];

453 
poöts
[
i
].
y
 = 
øº
[2*i+1];

455 
	`g_¨øy_‰ì
(
¨r
, 
TRUE
);

457 
pcd
->
poöts
 =Öoints;

458 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(
NULL
, 
pcd
,

459 &
h1
, &
h2
);

460 
	`ª£t_¨rows
 (
√w_obj
);

461 
	`≠∂y_°yÀ
(
√w_obj
, 
node
, 
∑ª¡_°yÀ
);

462 
li°
 = 
	`g_li°_≠≥nd
 (li°, 
√w_obj
);

463 
	`g_‰ì
(
poöts
);

464 
	`g_‰ì
(
pcd
);

466  
li°
;

467 
	}
}

470 
GLi°
 *

471 
	$ªad_ñlù£_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, 
GLi°
 *
li°
)

473 
xmlCh¨
 *
°r
;

474 
ªÆ
 
width
 = 0.0, 
height
 = 0.0;

475 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Ellipse");

476 
DüObje˘
 *
√w_obj
;

477 
H™dÀ
 *
h1
, *
h2
;

478 
GPåAºay
 *
¥›s
;

479 
Poöt
 
°¨t
 = {0, 0};

481 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"cx");

482 i‡(
°r
) {

483 
°¨t
.
x
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

484 
	`xmlFªe
(
°r
);

486  
li°
;

487 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"cy");

488 i‡(
°r
) {

489 
°¨t
.
y
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

490 
	`xmlFªe
(
°r
);

492  
li°
;

493 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"rx");

494 i‡(
°r
) {

495 
width
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
)*2;

496 
	`xmlFªe
(
°r
);

498 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"ry");

499 i‡(
°r
) {

500 
height
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
)*2;

501 
	`xmlFªe
(
°r
);

503 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"ry");

504 i‡(
°r
) {

505 
height
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
)*2;

506 
	`xmlFªe
(
°r
);

508 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"r");

509 i‡(
°r
) {

510 
width
 = 
height
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
)*2;

511 
	`xmlFªe
(
°r
);

513 i‡(
width
 <0.0 || 
height
 <= 0.0) {

514 
	`g_debug
 ("EŒù£ÅoÿsmÆ»%gx%g", 
width
, 
height
);

515  
li°
;

517 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(&
°¨t
, oty≥->
deÁu…_u£r_d©a
,

518 &
h1
, &
h2
);

519 
	`≠∂y_°yÀ
(
√w_obj
, 
node
, 
∑ª¡_°yÀ
);

521 
¥›s
 = 
	`make_ñemít_¥›s
(
°¨t
.
x
-(
width
/2), sèπ.
y
-(
height
/2),

522 
width
, 
height
);

523 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

524 
	`¥›_li°_‰ì
(
¥›s
);

525  
	`g_li°_≠≥nd
 (
li°
, 
√w_obj
);

526 
	}
}

529 
GLi°
 *

530 
	$ªad_löe_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, 
GLi°
 *
li°
)

532 
xmlCh¨
 *
°r
;

533 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Line");

534 
DüObje˘
 *
√w_obj
;

535 
H™dÀ
 *
h1
, *
h2
;

536 
PoötPr›îty
 *
±¥›
;

537 
GPåAºay
 *
¥›s
;

538 
Poöt
 
°¨t
, 
íd
;

540 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x1");

541 i‡(
°r
) {

542 
°¨t
.
x
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

543 
	`xmlFªe
(
°r
);

545  
li°
;

546 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y1");

547 i‡(
°r
) {

548 
°¨t
.
y
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

549 
	`xmlFªe
(
°r
);

551  
li°
;

552 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x2");

553 i‡(
°r
) {

554 
íd
.
x
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

555 
	`xmlFªe
(
°r
);

557  
li°
;

558 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y2");

559 i‡(
°r
) {

560 
íd
.
y
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

561 
	`xmlFªe
(
°r
);

563  
li°
;

565 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(&
°¨t
, oty≥->
deÁu…_u£r_d©a
,

566 &
h1
, &
h2
);

568 
¥›s
 = 
	`¥›_li°_‰om_descs
(
svg_löe_¥›_descs
,
pdçp_åue
);

569 
	`g_as£π
(
¥›s
->
Àn
 == 2);

571 
±¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,0);

572 
±¥›
->
poöt_d©a
 = 
°¨t
;

574 
±¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,1);

575 
±¥›
->
poöt_d©a
 = 
íd
;

577 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

578 
	`ª£t_¨rows
 (
√w_obj
);

580 
	`¥›_li°_‰ì
(
¥›s
);

582 
	`≠∂y_°yÀ
(
√w_obj
, 
node
, 
∑ª¡_°yÀ
);

584  
	`g_li°_≠≥nd
 (
li°
, 
√w_obj
);

585 
	}
}

588 
GLi°
 *

589 
	$ªad_ª˘_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, 
GLi°
 *
li°
)

591 
xmlCh¨
 *
°r
;

592 
ªÆ
 
width
, 
height
;

593 
DüObje˘Ty≥
 *
Ÿy≥
 = 
	`obje˘_gë_ty≥
("Standard - Box");

594 
DüObje˘
 *
√w_obj
;

595 
H™dÀ
 *
h1
, *
h2
;

596 
PoötPr›îty
 *
±¥›
;

597 
RólPr›îty
 *
Ωr›
;

598 
GPåAºay
 *
¥›s
;

599 
Poöt
 
°¨t
,
íd
;

600 
ªÆ
 
c‹√r_ødius
 = 0.0;

602 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x");

603 i‡(
°r
) {

604 
°¨t
.
x
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

605 
	`xmlFªe
(
°r
);

607  
li°
;

608 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y");

609 i‡(
°r
) {

610 
°¨t
.
y
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

611 
	`xmlFªe
(
°r
);

613  
li°
;

614 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"width");

615 i‡(
°r
) {

616 
width
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

617 
	`xmlFªe
(
°r
);

619  
li°
;

620 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"height");

621 i‡(
°r
) {

622 
height
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

623 
	`xmlFªe
(
°r
);

625  
li°
;

626 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"rx");

627 i‡(
°r
) {

628 
c‹√r_ødius
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

629 
	`xmlFªe
(
°r
);

631 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"ry");

632 i‡(
°r
) {

633 if(
c‹√r_ødius
 != 0.0) {

635 
c‹√r_ødius
 = (c‹√r_ødius+
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
))/2;

637 
c‹√r_ødius
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

639 
	`xmlFªe
(
°r
);

642 
√w_obj
 = 
Ÿy≥
->
›s
->
	`¸óã
(&
°¨t
, oty≥->
deÁu…_u£r_d©a
,

643 &
h1
, &
h2
);

644 
li°
 = 
	`g_li°_≠≥nd
 (li°, 
√w_obj
);

645 
¥›s
 = 
	`¥›_li°_‰om_descs
(
svg_ª˘_¥›_descs
, 
pdçp_åue
);

646 
	`g_as£π
(
¥›s
->
Àn
 == 3);

648 
±¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,0);

649 
±¥›
->
poöt_d©a
 = 
°¨t
;

651 
íd
.
x
 = 
°¨t
.x + 
width
;

652 
íd
.
y
 = 
°¨t
.y + 
height
;

653 
±¥›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,1);

654 
±¥›
->
poöt_d©a
 = 
íd
;

656 
Ωr›
 = 
	`g_±r_¨øy_ödex
(
¥›s
,2);

657 
Ωr›
->
ªÆ_d©a
 = 
c‹√r_ødius
;

659 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

660 
	`¥›_li°_‰ì
(
¥›s
);

661 
¥›s
 = 
	`make_ñemít_¥›s
(
°¨t
.
x
,°¨t.
y
,
width
,
height
);

662 
√w_obj
->
›s
->
	`£t_¥›s
“ew_obj, 
¥›s
);

664 
	`≠∂y_°yÀ
(
√w_obj
, 
node
, 
∑ª¡_°yÀ
);

665 
	`¥›_li°_‰ì
(
¥›s
);

667  
li°
;

668 
	}
}

670 
GLi°
 *

671 
	$ªad_image_svg
(
xmlNodePå
 
node
, 
DüSvgStyÀ
 *
∑ª¡_°yÀ
, 
GLi°
 *
li°
)

673 
xmlCh¨
 *
°r
;

674 
ªÆ
 
x
 = 0, 
y
 = 0, 
width
 = 0, 
height
 = 0;

675 
DüObje˘
 *
√w_obj
;

676 
gch¨
 *
fûíame
 = 
NULL
;

678 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"x");

679 i‡(
°r
) {

680 
x
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

681 
	`xmlFªe
(
°r
);

683 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"y");

684 i‡(
°r
) {

685 
y
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

686 
	`xmlFªe
(
°r
);

688 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"width");

689 i‡(
°r
) {

690 
width
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

691 
	`xmlFªe
(
°r
);

693 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"height");

694 i‡(
°r
) {

695 
height
 = 
	`gë_vÆue_as_cm
((*Ë
°r
, 
NULL
);

696 
	`xmlFªe
(
°r
);

700 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"xlink:href");

701 i‡(!
°r
)

702 
°r
 = 
	`xmlGëPr›
(
node
, (c⁄° 
xmlCh¨
 *)"href");

703 i‡(
°r
) {

704 
fûíame
 = 
	`g_fûíame_‰om_uri
((
gch¨
 *Ë
°r
, 
NULL
, NULL);

705 
	`xmlFªe
(
°r
);

707 
√w_obj
 = 
	`¸óã_°™d¨d_image
(
x
, 
y
, 
width
, 
height
, 
fûíame
 ? filename : "<broken>");

708 
	`g_‰ì
(
fûíame
);

710  
	`g_li°_≠≥nd
 (
li°
, 
√w_obj
);

711 
	}
}

719 
GLi°
*

720 
	$ªad_ôems
 (
xmlNodePå
 
°¨äode
, 
DüSvgStyÀ
 *
∑ª¡_gs
)

722 
xmlNodePå
 
node
;

723 
GLi°
 *
ôems
 = 
NULL
;

725 
node
 = 
°¨äode
;Çodê!
NULL
;Çodênode->
√xt
) {

726 i‡(
	`xmlIsBœnkNode
(
node
)) ;

727 i‡(
node
->
ty≥
 !
XML_ELEMENT_NODE
) ;

729 i‡(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"g")) {

730 
GLi°
 *
m‹eôems
;

731 
DüSvgStyÀ
 *
group_gs
;

734 
group_gs
 = 
	`g_√w0
 (
DüSvgStyÀ
, 1);

735 
	`dü_svg_°yÀ_öô
 (
group_gs
, 
∑ª¡_gs
);

736 
	`dü_svg_∑r£_°yÀ
 (
node
, 
group_gs
, 
u£r_sˇÀ
);

738 
m‹eôems
 = 
	`ªad_ôems
 (
node
->
xmlChûdªnNode
, 
group_gs
);

740 i‡(
m‹eôems
) {

741 
DüObje˘
 *
group
 = 
	`group_¸óã
 (
m‹eôems
);

743 
ôems
 = 
	`g_li°_≠≥nd
 (ôems, 
group
);

745 i‡(
group_gs
->
f⁄t
)

746 
	`dü_f⁄t_uƒef
 (
group_gs
->
f⁄t
);

747 
	`g_‰ì
 (
group_gs
);

748 } i‡(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"rect")) {

749 
ôems
 = 
	`ªad_ª˘_svg
(
node
, 
∑ª¡_gs
, items);

750 } i‡(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"line")) {

751 
ôems
 = 
	`ªad_löe_svg
(
node
, 
∑ª¡_gs
, items);

752 } i‡(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"ellipse") || !xmlStrcmp(node->name, (const xmlChar *)"circle")) {

753 
ôems
 = 
	`ªad_ñlù£_svg
(
node
, 
∑ª¡_gs
, items);

754 } i‡(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"polyline")) {

756 
ôems
 = 
	`ªad_pﬁy_svg
(
node
, 
∑ª¡_gs
, iãms,Ö¨ít_g†&&Ö¨ít_gs->
fûl
 >= 0 ?

758 } i‡(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"polygon")) {

759 
ôems
 = 
	`ªad_pﬁy_svg
(
node
, 
∑ª¡_gs
, items, "Standard - Polygon");

760 } if(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"text")) {

761 
ôems
 = 
	`ªad_ãxt_svg
(
node
, 
∑ª¡_gs
, items);

762 } if(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"path")) {

763 
ôems
 = 
	`ªad_∑th_svg
(
node
, 
∑ª¡_gs
, items);

764 } if(!
	`xmlSåcmp
(
node
->
«me
, (c⁄° 
xmlCh¨
 *)"image")) {

765 
ôems
 = 
	`ªad_image_svg
(
node
, 
∑ª¡_gs
, items);

769 
GLi°
 *
m‹eôems
;

771 
m‹eôems
 = 
	`ªad_ôems
 (
node
->
xmlChûdªnNode
, 
∑ª¡_gs
);

772 i‡(
m‹eôems
) {

773 
ôems
 = 
	`g_li°_c⁄ˇt
 (ôems, 
m‹eôems
);

777  
ôems
;

778 
	}
}

781 
gboﬁón


782 
	$imp‹t_svg
(c⁄° 
gch¨
 *
fûíame
, 
DügømD©a
 *
dü
, * 
u£r_d©a
)

784 
xmlDocPå
 
doc
 = 
	`xmlDoP¨£Fûe
(
fûíame
);

785 
xmlNsPå
 
svg_ns
;

786 
xmlNodePå
 
roŸ
;

787 
GLi°
 *
ôems
, *
ôem
;

789 i‡(!
doc
) {

790 
	`mesßge_w¨nög
("parseÉrror for %s",

791 
	`dü_mesßge_fûíame
(
fûíame
));

792  
FALSE
;

795 
roŸ
 = 
doc
->
xmlRoŸNode
;

796 
roŸ
 && (roŸ->
ty≥
 !
XML_ELEMENT_NODE
)ËroŸ =ÑoŸ->
√xt
;

797 i‡(!
roŸ
Ë 
FALSE
;

798 i‡(
	`xmlIsBœnkNode
(
roŸ
)Ë 
FALSE
;

800 i‡(!(
svg_ns
 = 
	`xmlSórchNsByHªf
(
doc
, 
roŸ
, (c⁄° 
xmlCh¨
 *)"http://www.w3.org/2000/svg"))) {

803 
	`xmlFªeDoc
(
doc
);

804  
FALSE
;

806 
	`mesßge_w¨nög
(
	`_
("Expected SVG NamespaceÇot found in file"));

812 i‡(
svg_ns
 && 
roŸ
->
ns
 != svg_ns) {

813 
xmlNodePå
 
node
 = 
roŸ
->
xmlChûdªnNode
;

815 
node
) {

816 i‡(
node
->
ns
 =
svg_ns
)

818 
node
 =Çode->
√xt
;

821 i‡(
node
)

822 
roŸ
 = 
node
;

825 i‡(
roŸ
->
ns
 !
svg_ns
 && 0 !
	`xmlSåcmp
‘oŸ->
«me
, (c⁄° 
xmlCh¨
 *)"svg")) {

826 
	`mesßge_w¨nög
(
	`_
("roŸÉÀmíàwa†'%s' --Éx≥˘ög 'svg'."), 
roŸ
->
«me
);

827 
	`xmlFªeDoc
(
doc
);

828  
FALSE
;

832 
u£r_sˇÀ
 = 
DEFAULT_SVG_SCALE
;

835 
xmlCh¨
 *
swidth
 = 
	`xmlGëPr›
(
roŸ
, (const xmlChar *)"width");

836 
xmlCh¨
 *
sheight
 = 
	`xmlGëPr›
(
roŸ
, (const xmlChar *)"height");

837 
xmlCh¨
 *
svõwbox
 = 
	`xmlGëPr›
(
roŸ
, (const xmlChar *)"viewBox");

839 i‡(
swidth
 && 
sheight
 && 
svõwbox
) {

840 
ªÆ
 
width
 = 
	`gë_vÆue_as_cm
 ((c⁄° *)
swidth
, 
NULL
);

841 
ªÆ
 
height
 = 
	`gë_vÆue_as_cm
 ((c⁄° *)
sheight
, 
NULL
);

842 
göt
 
x1
 = 0, 
y1
 = 0, 
x2
 = 0, 
y2
 = 0;

844 i‡(4 =
	`ssˇnf
 ((c⁄° *)
svõwbox
, "%d %d %d %d", &
x1
, &
y1
, &
x2
, &
y2
)) {

845 
ªÆ
 
xs
, 
ys
;

846 
	`g_debug
 ("võwBox(%d %d %d %dË(%f,%f)\n", 
x1
, 
y1
, 
x2
, 
y2
, 
width
, 
height
);

848 i‡(
x2
 > 
x1
 && 
y2
 > 
y1
 && 
width
 > 0 && 
height
 > 0) {

849 
xs
 = ((
ªÆ
)
x2
 - 
x1
Ë/ 
width
;

850 
ys
 = ((
ªÆ
)
y2
 - 
y1
Ë/ 
height
;

854 i‡(
	`Ábs
((Áb†(
xs
/
ys
) - 1.0) < 0.1)) {

855 
u£r_sˇÀ
 = 
xs
;

856 
	`g_debug
 ("võwBox(%d %d %d %dËsˇlög (%f,%fË-> %f\n", 
x1
, 
y1
, 
x2
, 
y2
, 
xs
, 
ys
, 
u£r_sˇÀ
);

862 i‡(
swidth
)

863 
	`xmlFªe
 (
swidth
);

864 i‡(
sheight
)

865 
	`xmlFªe
 (
sheight
);

866 i‡(
svõwbox
)

867 
	`xmlFªe
 (
svõwbox
);

870 
ôems
 = 
	`ªad_ôems
 (
roŸ
->
xmlChûdªnNode
, 
NULL
);

871 
ôem
 = 
ôems
; iãm !
NULL
; iãm = 
	`g_li°_√xt
 (item)) {

872 
DüObje˘
 *
obj
 = (DüObje˘ *)
ôem
->
d©a
;

873 
	`œyî_add_obje˘
(
dü
->
a˘ive_œyî
, 
obj
);

875 
	`g_li°_‰ì
 (
ôems
);

876 
	`xmlFªeDoc
(
doc
);

877  
TRUE
;

878 
	}
}

882 c⁄° 
gch¨
 *
	gexãnsi⁄s
[] = {"svg", 
NULL
 };

883 
DüImp‹tFûãr
 
	gsvg_imp‹t_fûãr
 = {

884 
N_
("Scalable Vector Graphics"),

885 
exãnsi⁄s
,

886 
imp‹t_svg


	@O:\tool\dvs50\plug-ins\svg\svg.c

23 
	~<c⁄fig.h
>

24 
	~"öé.h
"

25 
	~"fûãr.h
"

26 
	~"∂ug-ös.h
"

28 
DüExp‹tFûãr
 
svg_exp‹t_fûãr
;

29 
DüImp‹tFûãr
 
svg_imp‹t_fûãr
;

31 
DIA_PLUGIN_CHECK_INIT


33 
gboﬁón


34 
	$_∂ugö_ˇn_u∆ﬂd
 (
PlugöInfo
 *
öfo
)

36  
TRUE
;

37 
	}
}

40 
	$_∂ugö_u∆ﬂd
 (
PlugöInfo
 *
öfo
)

42 
	`fûãr_uƒegi°î_exp‹t
(&
svg_exp‹t_fûãr
);

43 
	`fûãr_uƒegi°î_imp‹t
(&
svg_imp‹t_fûãr
);

44 
	}
}

46 
PlugöInôResu…


47 
	$dü_∂ugö_öô
(
PlugöInfo
 *
öfo
)

49 i‡(!
	`dü_∂ugö_öfo_öô
(
öfo
, "SVG",

50 
	`_
("Scalable Vector Graphics importándÉxport filters"),

51 
_∂ugö_ˇn_u∆ﬂd
,

52 
_∂ugö_u∆ﬂd
))

53  
DIA_PLUGIN_INIT_ERROR
;

55 
	`fûãr_ªgi°î_exp‹t
(&
svg_exp‹t_fûãr
);

56 
	`fûãr_ªgi°î_imp‹t
(&
svg_imp‹t_fûãr
);

58  
DIA_PLUGIN_INIT_OK
;

59 
	}
}

	@config.h

5 
	#ENABLE_NLS
 1

	)

7 
	#LIBDIA_COMPILATION
 1

	)

9 
	#GETTEXT_PACKAGE
 "dü"

	)

18 
	#HAVE_BIND_TEXTDOMAIN_CODESET
 1

	)

21 
	#HAVE_CAIRO
 1

	)

24 
	#HAVE_DCGETTEXT
 1

	)

27 
	#HAVE_DLFCN_H
 1

	)

31 
	#HAVE_FCNTL_H
 1

	)

34 
	#HAVE_FREETYPE
 1

	)

37 
	#HAVE_GETTEXT
 1

	)

43 
	#HAVE_INTTYPES_H
 1

	)

46 
	#HAVE_ISINF
 1

	)

49 
	#HAVE_LC_MESSAGES
 1

	)

58 
	#HAVE_LIBPNG


	)

61 
	#HAVE_LIBZ


	)

64 
	#HAVE_LOCALE_H
 1

	)

67 
	#HAVE_MATH_H
 1

	)

70 
	#HAVE_MEMORY_H
 1

	)

73 
	#HAVE_PANGOCAIRO_H
 1

	)

76 
	#HAVE_SELECT
 1

	)

79 
	#HAVE_STDDEF_H
 1

	)

82 
	#HAVE_STDINT_H
 1

	)

85 
	#HAVE_STDLIB_H
 1

	)

88 
	#HAVE_STRCSPN
 1

	)

91 
	#HAVE_STRDUP
 1

	)

94 
	#HAVE_STRINGS_H
 1

	)

97 
	#HAVE_STRING_H
 1

	)

100 
	#HAVE_STRTOL
 1

	)

103 
	#HAVE_SYS_STAT_H
 1

	)

106 
	#HAVE_SYS_TYPES_H
 1

	)

109 
	#HAVE_UNISTD_H
 1

	)

112 
	#HAVE_UTIME_H
 1

	)

115 
	#HAVE_ZLIB_H
 1

	)

118 
	#LIBXSLT_PREFIX
 "/u§/lib"

	)

125 
	#PACKAGE
 "dü"

	)

128 
	#PACKAGE_BUGREPORT
 "hâp://bugzûœ.gnome.‹g/íãr_bug.cgi?¥odu˘=dü"

	)

131 
	#PACKAGE_NAME
 "dü"

	)

134 
	#PACKAGE_STRING
 "dü 0.97.2"

	)

137 
	#PACKAGE_TARNAME
 "dü"

	)

140 
	#PACKAGE_URL
 ""

	)

143 
	#PACKAGE_VERSION
 "0.97.2"

	)

146 
	#STDC_HEADERS
 1

	)

149 
	#VERSION
 "0.97.2"

	)

	@lib/diamarshal.h

2 #i‚de‡
__dü_m¨shÆ_MARSHAL_H__


3 
	#__dü_m¨shÆ_MARSHAL_H__


	)

5 
	~<glib-obje˘.h
>

6 
	~"düv¨.h
"

7 
	gG_BEGIN_DECLS


10 
	#dü_m¨shÆ_VOID__VOID
 
g_c˛osuª_m¨shÆ_VOID__VOID


	)

13 
	#dü_m¨shÆ_VOID__OBJECT
 
g_c˛osuª_m¨shÆ_VOID__OBJECT


	)

16 
	#dü_m¨shÆ_VOID__INT
 
g_c˛osuª_m¨shÆ_VOID__INT


	)

19 
dü_m¨shÆ_VOID__POINTER_POINTER
 (
GClosuª
 *
˛osuª
,

20 
GVÆue
 *
ªtu∫_vÆue
,

21 
guöt
 
n_∑øm_vÆues
,

22 c⁄° 
GVÆue
 *
∑øm_vÆues
,

23 
gpoöãr
 
övoˇti⁄_höt
,

24 
gpoöãr
 
m¨shÆ_d©a
);

27 
dü_m¨shÆ_VOID__STRING_FLAGS
 (
GClosuª
 *
˛osuª
,

28 
GVÆue
 *
ªtu∫_vÆue
,

29 
guöt
 
n_∑øm_vÆues
,

30 c⁄° 
GVÆue
 *
∑øm_vÆues
,

31 
gpoöãr
 
övoˇti⁄_höt
,

32 
gpoöãr
 
m¨shÆ_d©a
);

34 
	gG_END_DECLS


	@lib/geometry.h

20 #i‚de‡
GEOMETRY_H


21 
	#GEOMETRY_H


	)

23 #ifde‡
HAVE_CONFIG_H


24 
	~<c⁄fig.h
>

27 
	~"düty≥s.h
"

29 
	~<glib.h
>

30 
	~<m©h.h
>

36 #ifde‡
HAVE_IEEEFP_H


37 
	~<õìÂ.h
>

39 #i‚de‡
HAVE_ISINF


40 
	#isöf
(
a
Ë(!
	`föôe
◊))

	)

43 #ifde‡
_MSC_VER


46 
	~<Êﬂt.h
>

47 
	#föôe
(
a
Ë
	`_föôe
◊)

	)

48 
	#i¢™
(
a
Ë
	`_i¢™
◊)

	)

50 #ifde‡
G_OS_WIN32


51 
	#M_PI
 3.14159265358979323846

	)

52 
	#M_SQRT2
 1.41421356237309504880

	)

53 
	#M_SQRT1_2
 0.70710678118654752440

	)

57 #i‚de‡
M_PI


58 
	#M_PI
 
G_PI


	)

60 #i‚de‡
M_SQRT2


61 
	#M_SQRT2
 
G_SQRT2


	)

63 #i‚de‡
M_SQRT1_2


64 
	#M_SQRT1_2
 (1.0/
G_SQRT2
)

	)

67 
G_BEGIN_DECLS


78 
	tªÆ
;

79 
ªÆ
 
	tco‹d
;

82 
	s_Poöt
 {

83 
co‹d
 
	mx
;

84 
co‹d
 
	my
;

88 
	s_Re˘™gÀ
 {

89 
co‹d
 
	mÀ·
;

90 
co‹d
 
	mt›
;

91 
co‹d
 
	mright
;

92 
co‹d
 
	mbŸtom
;

96 
	s_I¡Re˘™gÀ
 {

97 
	mÀ·
;

98 
	mt›
;

99 
	mright
;

100 
	mbŸtom
;

106 
	s_BezPoöt
 {

108 
	mBEZ_MOVE_TO
,

109 
	mBEZ_LINE_TO
,

110 
	mBEZ_CURVE_TO


111 } 
	mty≥
;

112 
Poöt
 
	mp1
;

113 
Poöt
 
	mp2
;

114 
Poöt
 
	mp3
;

118 
	#ROUND
(
x
Ë((Ë
	`Êo‹
((x)+0.5))

	)

122 
G_INLINE_FUNC
 
poöt_add
(
Poöt
 *
p1
, c⁄° Poöà*
p2
);

123 #ifde‡
G_CAN_INLINE


124 
G_INLINE_FUNC
 

125 
	$poöt_add
(
Poöt
 *
p1
, c⁄° Poöà*
p2
)

127 
p1
->
x
 +
p2
->x;

128 
p1
->
y
 +
p2
->y;

129 
	}
}

132 
G_INLINE_FUNC
 
poöt_sub
(
Poöt
 *
p1
, c⁄° Poöà*
p2
);

133 #ifde‡
G_CAN_INLINE


134 
G_INLINE_FUNC
 

135 
	$poöt_sub
(
Poöt
 *
p1
, c⁄° Poöà*
p2
)

137 
p1
->
x
 -
p2
->x;

138 
p1
->
y
 -
p2
->y;

139 
	}
}

142 
G_INLINE_FUNC
 
ªÆ
 
poöt_dŸ
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
);

143 #ifde‡
G_CAN_INLINE


144 
G_INLINE_FUNC
 
ªÆ


145 
	$poöt_dŸ
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
)

147  
p1
->
x
*
p2
->x +Ö1->
y
*p2->y;

148 
	}
}

151 
G_INLINE_FUNC
 
ªÆ
 
poöt_Àn
(c⁄° 
Poöt
 *
p
);

152 #ifde‡
G_CAN_INLINE


153 
G_INLINE_FUNC
 
ªÆ


154 
	$poöt_Àn
(c⁄° 
Poöt
 *
p
)

156  
	`sqπ
(
p
->
x
*p->x +Ö->
y
*p->y);

157 
	}
}

160 
G_INLINE_FUNC
 
poöt_sˇÀ
(
Poöt
 *
p
, 
ªÆ
 
Æpha
);

161 #ifde‡
G_CAN_INLINE


162 
G_INLINE_FUNC
 

163 
	$poöt_sˇÀ
(
Poöt
 *
p
, 
ªÆ
 
Æpha
)

165 
p
->
x
 *
Æpha
;

166 
p
->
y
 *
Æpha
;

167 
	}
}

170 
G_INLINE_FUNC
 
poöt_n‹mÆize
(
Poöt
 *
p
);

171 #ifde‡
G_CAN_INLINE


172 
G_INLINE_FUNC
 

173 
	$poöt_n‹mÆize
(
Poöt
 *
p
)

175 
ªÆ
 
Àn
;

177 
Àn
 = 
	`sqπ
(
p
->
x
*p->x +Ö->
y
*p->y);

184 i‡(
Àn
 > 0.0) {

185 
p
->
x
 /
Àn
;

186 
p
->
y
 /
Àn
;

188 
p
->
x
 = 0.0;

189 
p
->
y
 = 0.0;

192 
	}
}

195 
G_INLINE_FUNC
 
poöt_rŸ©e
(
Poöt
 *
p1
, c⁄° Poöà*
p2
);

196 #ifde‡
G_CAN_INLINE


197 
G_INLINE_FUNC
 

198 
	$poöt_rŸ©e
(
Poöt
 *
p1
, c⁄° Poöà*
p2
)

200 
p1
->
x
 =Ö1->x*
p2
->x -Ö1->
y
*p2->y;

201 
p1
->
y
 =Ö1->
x
*
p2
->y +Ö1->y*p2->x;

202 
	}
}

205 
G_INLINE_FUNC
 
poöt_gë_n‹med
(
Poöt
 *
d°
, c⁄° Poöà*
§c
);

206 #ifde‡
G_CAN_INLINE


207 
G_INLINE_FUNC
 

208 
	$poöt_gë_n‹med
(
Poöt
 *
d°
, c⁄° Poöà*
§c
)

210 
ªÆ
 
Àn
;

212 
Àn
 = 
	`sqπ
(
§c
->
x
*§c->x + src->
y
*src->y);

214 
d°
->
x
 = 
§c
->x / 
Àn
;

215 
d°
->
y
 = 
§c
->y / 
Àn
;

216 
	}
}

219 
G_INLINE_FUNC
 
poöt_gë_≥Ω
(
Poöt
 *
d°
, c⁄° Poöà*
§c
);

220 #ifde‡
G_CAN_INLINE


221 
G_INLINE_FUNC
 

222 
	$poöt_gë_≥Ω
(
Poöt
 *
d°
, c⁄° Poöà*
§c
)

226 
d°
->
y
 = 
§c
->
x
;

227 
d°
->
x
 = -
§c
->
y
;

228 
	}
}

231 
G_INLINE_FUNC
 
poöt_c›y
(
Poöt
 *
d°
, c⁄° Poöà*
§c
);

232 #ifde‡
G_CAN_INLINE


233 
G_INLINE_FUNC
 

234 
	$poöt_c›y
(
Poöt
 *
d°
, c⁄° Poöà*
§c
)

241 
d°
->
x
 = 
§c
->x;

242 
d°
->
y
 = 
§c
->y;

243 
	}
}

246 
G_INLINE_FUNC
 
poöt_add_sˇÀd
(
Poöt
 *
d°
, c⁄° Poöà*
§c
, 
ªÆ
 
Æpha
);

247 #ifde‡
G_CAN_INLINE


248 
G_INLINE_FUNC
 

249 
	$poöt_add_sˇÀd
(
Poöt
 *
d°
, c⁄° Poöà*
§c
, 
ªÆ
 
Æpha
)

252 
d°
->
x
 +
Æpha
 * 
§c
->x;

253 
d°
->
y
 +
Æpha
 * 
§c
->y;

254 
	}
}

257 
G_INLINE_FUNC
 
poöt_c›y_add_sˇÀd
(
Poöt
 *
d°
, c⁄° Poöà*
§c
,

258 c⁄° 
Poöt
 *
v˘
,

259 
ªÆ
 
Æpha
);

260 #ifde‡
G_CAN_INLINE


261 
G_INLINE_FUNC
 

262 
	$poöt_c›y_add_sˇÀd
(
Poöt
 *
d°
, c⁄° Poöà*
§c
,

263 c⁄° 
Poöt
 *
v˘
, 
ªÆ
 
Æpha
)

266 
d°
->
x
 = 
§c
->x + (
Æpha
 * 
v˘
->x);

267 
d°
->
y
 = 
§c
->y + (
Æpha
 * 
v˘
->y);

268 
	}
}

271 
DIAVAR
 
poöt_c⁄vex
(
Poöt
 *
d°
, c⁄° Poöà*
§c1
, c⁄° Poöà*
§c2
, 
ªÆ
 
Æpha
);

273 
DIAVAR
 
ª˘™gÀ_uni⁄
(
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
);

274 
DIAVAR
 
öt_ª˘™gÀ_uni⁄
(
I¡Re˘™gÀ
 *
r1
, c⁄° I¡Re˘™gÀ *
r2
);

275 
DIAVAR
 
ª˘™gÀ_öãr£˘i⁄
(
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
);

276 
DIAVAR
 
ª˘™gÀ_öãr£˘s
(c⁄° 
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
);

277 
poöt_ö_ª˘™gÀ
(c⁄° 
Re˘™gÀ
* 
r
, c⁄° 
Poöt
 *
p
);

278 
DIAVAR
 
ª˘™gÀ_ö_ª˘™gÀ
(c⁄° 
Re˘™gÀ
* 
ouãr
, c⁄° Re˘™gÀ *
ö√r
);

279 
DIAVAR
 
ª˘™gÀ_add_poöt
(
Re˘™gÀ
 *
r
, c⁄° 
Poöt
 *
p
);

281 
G_INLINE_FUNC
 
gboﬁón
 
ª˘™gÀ_equÆs
(c⁄° 
Re˘™gÀ
 *
ﬁd_exã¡s
,

282 c⁄° 
Re˘™gÀ
 *
√w_exã¡s
);

283 #ifde‡
G_CAN_INLINE


284 
G_INLINE_FUNC
 
gboﬁón


285 
	$ª˘™gÀ_equÆs
(c⁄° 
Re˘™gÀ
 *
r1
, c⁄° Re˘™gÀ *
r2
)

287  ( (
r2
->
À·
 =
r1
->left) &&

288 (
r2
->
right
 =
r1
->right) &&

289 (
r2
->
t›
 =
r1
->top) &&

290 (
r2
->
bŸtom
 =
r1
->bottom) );

291 
	}
}

294 
G_INLINE_FUNC
 
ªÆ
 
di°™˚_poöt_poöt
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
);

295 #ifde‡
G_CAN_INLINE


296 
G_INLINE_FUNC
 
ªÆ


297 
	$di°™˚_poöt_poöt
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
)

299 
ªÆ
 
dx
 = 
p1
->
x
 - 
p2
->x;

300 
ªÆ
 
dy
 = 
p1
->
y
 - 
p2
->y;

301  
	`sqπ
(
dx
*dx + 
dy
*dy);

302 
	}
}

305 
G_INLINE_FUNC
 c⁄° 
Poöt
 *
˛o£°_to
(c⁄° Poöà*
to
, c⁄° Poöà*
p1
, c⁄° Poöà*
p2
);

306 #ifde‡
G_CAN_INLINE


307 
G_INLINE_FUNC
 c⁄° 
Poöt
 *

308 
	$˛o£°_to
(c⁄° 
Poöt
 *
to
, c⁄° Poöà*
p1
, c⁄° Poöà*
p2
)

310 i‡(
	`di°™˚_poöt_poöt
(
to
,
p1
Ë< di°™˚_poöt_poöt—o,
p2
))

311  
p1
;

312  
p2
;

313 
	}
}

316 
G_INLINE_FUNC
 
ªÆ
 
di°™˚_poöt_poöt_m™h©èn
(c⁄° 
Poöt
 *
p1
,

317 c⁄° 
Poöt
 *
p2
);

318 #ifde‡
G_CAN_INLINE


319 
G_INLINE_FUNC
 
ªÆ


320 
	$di°™˚_poöt_poöt_m™h©èn
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
)

322 
ªÆ
 
dx
 = 
p1
->
x
 - 
p2
->x;

323 
ªÆ
 
dy
 = 
p1
->
y
 - 
p2
->y;

324  
	`ABS
(
dx
Ë+ ABS(
dy
);

325 
	}
}

328 
DIAVAR
 
ªÆ
 
di°™˚_ª˘™gÀ_poöt
(c⁄° 
Re˘™gÀ
 *
ª˘
, c⁄° 
Poöt
 *
poöt
);

329 
DIAVAR
 
ªÆ
 
di°™˚_löe_poöt
(c⁄° 
Poöt
 *
löe_°¨t
, c⁄° Poöà*
löe_íd
,

330 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

332 
DIAVAR
 
ªÆ
 
di°™˚_pﬁyg⁄_poöt
(c⁄° 
Poöt
 *
pﬁy
, 
guöt
 
≈oöts
,

333 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

336 
DIAVAR
 
ªÆ
 
di°™˚_bez_£g_poöt
(c⁄° 
Poöt
 *
b1
, c⁄° Poöà*
b2
,

337 c⁄° 
Poöt
 *
b3
, c⁄° Poöà*
b4
,

338 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

339 
DIAVAR
 
ªÆ
 
di°™˚_bez_löe_poöt
(c⁄° 
BezPoöt
 *
b
, 
guöt
 
≈oöts
,

340 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

341 
DIAVAR
 
ªÆ
 
di°™˚_bez_sh≠e_poöt
(c⁄° 
BezPoöt
 *
b
, 
guöt
 
≈oöts
,

342 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

344 
DIAVAR
 
ªÆ
 
di°™˚_ñlù£_poöt
(c⁄° 
Poöt
 *
˚¡ª
,Ñó»
width
,Ñó»
height
,

345 
ªÆ
 
löe_width
, c⁄° 
Poöt
 *
poöt
);

347 
ªÆ
 
	tVe˘‹
[3];

348 
Ve˘‹
 
	tM©rix
[3];

350 
DIAVAR
 
å™sf‹m_poöt
 (
M©rix
, 
Poöt
 *, Point *);

351 
mu…_m©rix
 (
M©rix
, Matrix);

352 
DIAVAR
 
idítôy_m©rix
 (
M©rix
);

353 
å™¶©e_m©rix
 (
M©rix
, 
ªÆ
,Ñeal);

354 
sˇÀ_m©rix
 (
M©rix
, 
ªÆ
,Ñeal);

355 
DIAVAR
 
rŸ©e_m©rix
 (
M©rix
, 
ªÆ
);

356 
xshór_m©rix
 (
M©rix
, 
ªÆ
);

357 
yshór_m©rix
 (
M©rix
, 
ªÆ
);

359 
ªÆ
 
dŸ2
(
Poöt
 *
p1
, Poöà*
p2
);

360 
löe_c€f
(
ªÆ
 *
a
,Ñó»*
b
,Ñó»*
c
, 
Poöt
 *
p1
, Poöà*
p2
);

361 
ªÆ
 
löe_to_poöt
‘ó»
a
,Ñó»
b
 ,Ñó»
c
, 
Poöt
 *
p
);

362 
poöt_≥Ω
(
Poöt
 *
p
, 
ªÆ
 
a
,Ñó»
b
,Ñó»
c
, Poöà*
≥Ω
);

363 
fûÀt
(
Poöt
 *
p1
, Poöà*
p2
, Poöà*
p3
, Poöà*
p4
,

364 
ªÆ
 
r
, 
Poöt
 *
c
,Ñó»*
∑
,Ñó»*
Ø
);

365 
DIAVAR
 
thªe_poöt_cú˛e
(c⁄° 
Poöt
 *
p1
, c⁄° Poöà*
p2
, c⁄° Poöà*
p3
,

366 
Poöt
* 
˚¡î
, 
ªÆ
* 
ødius
);

367 
DIAVAR
 
ªÆ
 
poöt_¸oss
(
Poöt
 *
p1
, Poöà*
p2
);

368 
DIAVAR
 
Poöt
 
ˇlcuœã_obje˘_edge
(Poöà*
objmid
, Poöà*
íd
, 
DüObje˘
 *
obj
);

370 
	gG_END_DECLS


	@lib/parent.h

19 #i‚de‡
PARENT_H


20 
	#PARENT_H


	)

22 
	~<glib.h
>

23 
	~"geomëry.h
"

25 
DIAVAR
 
GLi°
 *
∑ª¡_li°_af„˘ed
(GLi° *
obj_li°
);

26 
DIAVAR
 
gboﬁón
 
∑ª¡_h™dÀ_exã¡s
(
DüObje˘
 *
obj
, 
Re˘™gÀ
 *
exã¡s
);

27 
DIAVAR
 
Poöt
 
∑ª¡_move_chûd_dñè
(
Re˘™gÀ
 *
p_ext
, Re˘™gÀ *
c_ãxt
, Poöà*
dñè
);

28 
DIAVAR
 
∑ª¡_poöt_exã¡s
(
Poöt
 *
poöt
, 
Re˘™gÀ
 *
exã¡s
);

29 
gboﬁón
 
∑ª¡_li°_ex∑nd
(
GLi°
 *
obj_li°
);

30 
DIAVAR
 
GLi°
 *
∑ª¡_li°_af„˘ed_hõørchy
(GLi° *
obj_li°
);

31 
DIAVAR
 
gboﬁón
 
∑ª¡_h™dÀ_move_out_check
(
DüObje˘
 *
obje˘
, 
Poöt
 *
to
);

32 
DIAVAR
 
gboﬁón
 
∑ª¡_h™dÀ_move_ö_check
(
DüObje˘
 *
obje˘
, 
Poöt
 *
to
, Poöà*
°¨t_©
);

33 
DIAVAR
 
∑ª¡_≠∂y_to_chûdªn
(
DüObje˘
 *
obj
, 
DüObje˘Func
 
func
);

	@lib/prefs.h

21 #i‚de‡
PREFS_H


22 
	#PREFS_H


	)

24 #ifde‡
HAVE_CONFIG_H


25 
	~<c⁄fig.h
>

28 
	~"düty≥s.h
"

29 
	~"widgës.h
"

31 
DIAVAR
 
¥efs_£t_Àngth_unô
(
gch¨
* 
unô
);

32 
DIAVAR
 
¥efs_£t_f⁄tsize_unô
(
gch¨
* 
unô
);

34 
DIAVAR
 
DüUnô
 
¥efs_gë_Àngth_unô
();

35 
DIAVAR
 
DüUnô
 
¥efs_gë_f⁄tsize_unô
();

	@lib/properties.h

24 #i‚de‡
LIB_PROPERTIES_H


25 
	#LIB_PROPERTIES_H


	)

27 #i‚de‡
WIDGET


28 #ifde‡
GTK_WIDGET


29 
	#WIDGET
 
GtkWidgë


	)

31 
	#WIDGET
 

	)

36 #ifde‡
HAVE_STDDEF_H


37 
	~<°ddef.h
>

40 
	~<glib.h
>

41 
	~"düty≥s.h
"

43 
	~"geomëry.h
"

44 
	~"¨rows.h
"

45 
	~"cﬁ‹.h
"

46 
	~"f⁄t.h
"

47 
	~"dü_xml.h
"

48 
	~"öé.h
"

49 
	~"ãxèâr.h
"

51 
G_BEGIN_DECLS


53 
	$gboﬁón
 (*
	tPr›DescToPr›Pªdiˇã
)(c⁄° 
	tPr›Des¸ùti⁄
 *
	tpdesc
);

55 
	s_Pr›WidgëAssoc
 {

56 
Pr›îty
 *
¥›
;

57 
WIDGET
 *
widgë
;

60 
	s_Pr›Dülog
 {

61 
WIDGET
 *
widgë
;

63 
GPåAºay
 *
¥›s
;

64 
GAºay
 *
¥›_widgës
;

67 
GLi°
 *
obje˘s
;

68 
GLi°
 *
c›õs
;

70 
GPåAºay
 *
c⁄èöîs
;

71 
WIDGET
 *
œ°c⁄t
;

72 
WIDGET
 *
cuπabÀ
;

73 
guöt
 
cuºow
;

76 
	s_Pr›EvítD©a
 {

77 
Pr›Dülog
 *
dülog
;

78 
guöt
 
my_ödex
;

79 
WIDGET
 *
widgë
;

80 
Pr›îty
 *
£lf
;

83 
	$gboﬁón
 (*
	tPr›EvítH™dÀr
Ë(
	tDüObje˘
 *
	tobj
, 
	tPr›îty
 *
	t¥›
);

85 
	s_Pr›EvítH™dÀrChaö
 {

86 
Pr›EvítH™dÀr
 
h™dÀr
;

87 
Pr›EvítH™dÀrChaö
 *
chaö
;

93 
Pr›îty
 * (*
	tPr›îtyTy≥_New
Ë(c⁄° 
	tPr›Des¸ùti⁄
 *
	tpdesc
,

94 
	tPr›DescToPr›Pªdiˇã
 
	tªas⁄
);

96 (* 
	tPr›îtyTy≥_Fªe
)(
	tPr›îty
 *
	t¥›
);

98 
Pr›îty
 *(* 
	tPr›îtyTy≥_C›y
)(
	tPr›îty
 *
	t§c
);

101 
WIDGET
 *(* 
	tPr›îtyTy≥_GëWidgë
)(
	tPr›îty
 *
	t¥›
,

102 
	tPr›Dülog
 *
	tdülog
);

105 (* 
	tPr›îtyTy≥_Re£tWidgë
)(c⁄° 
	tPr›îty
 *
	t¥›
, 
	tWIDGET
 *
	twidgë
);

107 (* 
	tPr›îtyTy≥_SëFromWidgë
)(
	tPr›îty
 *
	t¥›
, 
	tWIDGET
 *
	twidgë
);

109 (*
	tPr›îtyTy≥_Lﬂd
)(
	tPr›îty
 *
	t¥›
, 
	tAâribuãNode
 
	t©å
, 
	tD©aNode
 
	td©a
);

110 (*
	tPr›îtyTy≥_Save
)(
	tPr›îty
 *
	t¥›
, 
	tAâribuãNode
 
	t©å
);

114 
	$gboﬁón
 (*
	tPr›îtyTy≥_C™Mîge
)(c⁄° 
	tPr›Des¸ùti⁄
 *
	tpd1
,c⁄° Pr›Des¸ùti⁄ *
	tpd2
);

115 (*
	tPr›îtyTy≥_GëFromOff£t
)(c⁄° 
	tPr›îty
 *
	t¥›
,

116 *
	tba£
, 
	tguöt
 
	toff£t
, guöà
	toff£t2
);

117 (*
	tPr›îtyTy≥_SëFromOff£t
)(
	tPr›îty
 *
	t¥›
,

118 *
	tba£
, 
	tguöt
 
	toff£t
, guöà
	toff£t2
);

119 (*
	tPr›îtyTy≥_GëD©aSize
)(
	tPr›îty
 *
	t¥›
);

122 
	s_Pr›îtyOps
 {

123 
Pr›îtyTy≥_New
 
√w_¥›
;

124 
Pr›îtyTy≥_Fªe
 
‰ì
;

125 
Pr›îtyTy≥_C›y
 
c›y
;

126 
Pr›îtyTy≥_Lﬂd
 
lﬂd
;

127 
Pr›îtyTy≥_Save
 
ßve
;

128 
Pr›îtyTy≥_GëWidgë
 
gë_widgë
;

129 
Pr›îtyTy≥_Re£tWidgë
 
ª£t_widgë
;

130 
Pr›îtyTy≥_SëFromWidgë
 
£t_‰om_widgë
;

132 
Pr›îtyTy≥_C™Mîge
 
ˇn_mîge
;

134 
Pr›îtyTy≥_GëFromOff£t
 
gë_‰om_off£t
;

135 
Pr›îtyTy≥_SëFromOff£t
 
£t_‰om_off£t
;

136 
Pr›îtyTy≥_GëD©aSize
 
gë_d©a_size
;

139 c⁄° 
	tgch¨
 *
	tPr›îtyTy≥
;

142 
	#PROP_TYPE_INVALID
 "övÆid"

	)

143 
	#PROP_TYPE_NOOP
 "no›"

	)

144 
	#PROP_TYPE_UNIMPLEMENTED
 "unim∂emíãd"

	)

147 
	#PROP_TYPE_CHAR
 "ch¨"

	)

148 
	#PROP_TYPE_BOOL
 "boﬁ"

	)

149 
	#PROP_TYPE_INT
 "öt"

	)

150 
	#PROP_TYPE_INTARRAY
 "öèºay"

	)

151 
	#PROP_TYPE_ENUM
 "íum"

	)

152 
	#PROP_TYPE_ENUMARRAY
 "íum¨øy"

	)

155 
	#PROP_TYPE_MULTISTRING
 "mu…i°rög"

	)

157 
	#PROP_TYPE_STRING
 "°rög"

	)

158 
	#PROP_TYPE_FILE
 "fûe"

	)

159 
	#PROP_TYPE_TEXT
 "ãxt"

	)

160 
	#PROP_TYPE_STRINGLIST
 "°rögli°"

	)

163 
	#PROP_TYPE_REAL
 "ªÆ"

	)

164 
	#PROP_TYPE_LENGTH
 "Àngth"

	)

165 
	#PROP_TYPE_FONTSIZE
 "f⁄tsize"

	)

166 
	#PROP_TYPE_POINT
 "poöt"

	)

167 
	#PROP_TYPE_POINTARRAY
 "poöèºay"

	)

168 
	#PROP_TYPE_BEZPOINT
 "bezpoöt"

	)

169 
	#PROP_TYPE_BEZPOINTARRAY
 "bezpoöèºay"

	)

170 
	#PROP_TYPE_RECT
 "ª˘"

	)

171 
	#PROP_TYPE_ENDPOINTS
 "ídpoöts"

	)

172 
	#PROP_TYPE_CONNPOINT_LINE
 "c⁄≈oöt_löe"

	)

175 
	#PROP_TYPE_LINESTYLE
 "löe°yÀ"

	)

176 
	#PROP_TYPE_ARROW
 "¨row"

	)

177 
	#PROP_TYPE_COLOUR
 "cﬁour"

	)

178 
	#PROP_TYPE_FONT
 "f⁄t"

	)

181 
	#PROP_TYPE_STATIC
 "°©ic"

	)

183 
	#PROP_TYPE_BUTTON
 "buâ⁄"

	)

185 
	#PROP_TYPE_NOTEBOOK_BEGIN
 "nb_begö"

	)

186 
	#PROP_TYPE_NOTEBOOK_END
 "nb_íd"

	)

187 
	#PROP_TYPE_NOTEBOOK_PAGE
 "nb_∑ge"

	)

188 
	#PROP_TYPE_MULTICOL_BEGIN
 "mc_begö"

	)

189 
	#PROP_TYPE_MULTICOL_END
 "mc_íd"

	)

190 
	#PROP_TYPE_MULTICOL_COLUMN
 "mc_cﬁ"

	)

191 
	#PROP_TYPE_FRAME_BEGIN
 "f_begö"

	)

192 
	#PROP_TYPE_FRAME_END
 "f_íd"

	)

193 
	#PROP_TYPE_LIST
 "li°"

	)

198 
	#PROP_TYPE_SARRAY
 "ßºay"

	)

199 
	#PROP_TYPE_DARRAY
 "d¨øy"

	)

200 
	#PROP_TYPE_DICT
 "di˘"

	)

204 
	s_Pr›Des¸ùti⁄
 {

205 c⁄° 
gch¨
 *
«me
;

206 
Pr›îtyTy≥
 
ty≥
;

207 
guöt
 
Êags
;

208 c⁄° 
gch¨
 *
des¸ùti⁄
;

209 c⁄° 
gch¨
 *
toﬁtù
;

214 
gpoöãr
 
exåa_d©a
;

221 
Pr›EvítH™dÀr
 
evít_h™dÀr
;

223 
GQu¨k
 
qu¨k
;

224 
GQu¨k
 
ty≥_qu¨k
;

227 
Pr›EvítH™dÀrChaö
 
chaö_h™dÀr
;

229 c⁄° 
Pr›îtyOps
 *
›s
;

232 
	#PROP_FLAG_VISIBLE
 0x0001

	)

233 
	#PROP_FLAG_DONT_SAVE
 0x0002

	)

234 
	#PROP_FLAG_DONT_MERGE
 0x0004

	)

235 
	#PROP_FLAG_NO_DEFAULTS
 0x0008

	)

236 
	#PROP_FLAG_LOAD_ONLY
 0x0010

	)

237 
	#PROP_FLAG_STANDARD
 0x0020

	)

238 
	#PROP_FLAG_MULTIVALUE
 0x0040

	)

239 
	#PROP_FLAG_WIDGET_ONLY
 0x0080

	)

240 
	#PROP_FLAG_OPTIONAL
 0x0100

	)

242 íum {
PROP_UNION
, 
PROP_INTERSECTION
} 
	tPr›MîgeO±i⁄
;

244 
	#PROP_DESC_END
 { 
NULL
, 0, 0, NULL, NULL, NULL, 0 
	}

	)
}

247 
	s_Pr›NumD©a
 {

248 
gÊﬂt
 
	mmö
, 
	mmax
, 
	m°ï
;

250 
	s_Pr›EnumD©a
 {

251 c⁄° 
gch¨
 *
	m«me
;

252 
guöt
 
	míumv
;

255 
	$gpoöãr
 (*
	tNewRec‹dFunc
)();

256 (*
	tFªeRec‹dFunc
)(
	tgpoöãr
 
	tªc
);

258 
	s_Pr›DescComm⁄AºayExåa
 {

260 
Pr›Des¸ùti⁄
 *
ªc‹d
;

261 
Pr›Off£t
 *
off£ts
;

262 c⁄° 
gch¨
 *
composôe_ty≥
;

265 
	s_Pr›DescDAºayExåa
 {

266 
Pr›DescComm⁄AºayExåa
 
comm⁄
;

267 
NewRec‹dFunc
 
√wªc
;

268 
FªeRec‹dFunc
 
‰ìªc
;

271 
	s_Pr›DescSAºayExåa
 {

272 
Pr›DescComm⁄AºayExåa
 
comm⁄
;

273 
guöt
 
ñemít_size
;

274 
guöt
 
¨øy_Àn
;

281 
	s_Pr›îty
 {

282 c⁄° 
gch¨
 *
«me
;

283 
GQu¨k
 
«me_qu¨k
;

284 
Pr›îtyTy≥
 
ty≥
;

285 
GQu¨k
 
ty≥_qu¨k
;

286 c⁄° 
Pr›Des¸ùti⁄
 *
des¸
;

287 
gpoöãr
 
exåa_d©a
;

288 
Pr›EvítD©a
 
£lf
;

289 
Pr›EvítH™dÀr
 
evít_h™dÀr
;

290 
Pr›DescToPr›Pªdiˇã
 
ªas⁄
;

292 
guöt
 
ex≥rõn˚
;

294 c⁄° 
Pr›îtyOps
 *
›s
;

295 c⁄° 
Pr›îtyOps
 *
ªÆ_›s
;

299 
	#PXP_COPIED
 0x00000001

	)

300 
	#PXP_COPY
 0x00000002

	)

301 
	#PXP_GET_WIDGET
 0x00000004

	)

302 
	#PXP_RESET_WIDGET
 0x00000008

	)

303 
	#PXP_SET_FROM_WIDGET
 0x00000010

	)

304 
	#PXP_LOADED
 0x00000020

	)

305 
	#PXP_SAVED
 0x00000040

	)

306 
	#PXP_GFO
 0x00000080

	)

307 
	#PXP_SFO
 0x00000100

	)

308 
	#PXP_NOTSET
 0x00000200

	)

309 
	#PXP_SHAMELESS
 0xFFFFFFFF

	)

314 
DIAVAR
 
	`¥›_desc_li°_ˇlcuœã_qu¨ks
(
Pr›Des¸ùti⁄
 *
∂i°
);

316 
DIAVAR
 c⁄° 
Pr›Des¸ùti⁄
 *
	`¥›_desc_li°_föd_¥›
(c⁄° Pr›Des¸ùti⁄ *
∂i°
,

317 c⁄° 
gch¨
 *
«me
);

319 
DIAVAR
 
Pr›EvítH™dÀr
 
	`¥›_desc_föd_ªÆ_h™dÀr
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

321 
DIAVAR
 
	`¥›_desc_‰ì_h™dÀr_chaö
(
Pr›Des¸ùti⁄
 *
pdesc
);

323 
DIAVAR
 
	`¥›_desc_li°_‰ì_h™dÀr_chaö
(
Pr›Des¸ùti⁄
 *
pdesc
);

325 
DIAVAR
 
	`¥›_desc_ö£π_h™dÀr
(
Pr›Des¸ùti⁄
 *
pdesc
,

326 
Pr›EvítH™dÀr
 
h™dÀr
);

329 
DIAVAR
 
Pr›Des¸ùti⁄
 *
	`¥›_desc_li°s_uni⁄
(
GLi°
 *
∂i°s
);

330 
DIAVAR
 
Pr›Des¸ùti⁄
 *
	`¥›_desc_li°s_öãr£˘i⁄
(
GLi°
 *
∂i°s
);

335 
	`¥›_ty≥_ªgi°î
(
Pr›îtyTy≥
 
ty≥
, c⁄° 
Pr›îtyOps
 *
›s
);

336 c⁄° 
Pr›îtyOps
 *
	`¥›_ty≥_gë_›s
(
Pr›îtyTy≥
 
ty≥
);

341 
DIAVAR
 
	`¥›_li°_‰ì
(
GPåAºay
 *
∂i°
);

345 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_c›y
(GPåAºay *
∂i°
);

347 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_c›y_em±y
(GPåAºay *
∂i°
);

349 
DIAVAR
 
	`¥›_li°_add_li°
 (
GPåAºay
 *
¥›s
, c⁄° GPåAºay *
±ﬂdd
);

351 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_‰om_descs
(c⁄° 
Pr›Des¸ùti⁄
 *
∂i°
,

352 
Pr›DescToPr›Pªdiˇã
 
¥ed
);

354 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_‰om_sögÀ
(
Pr›îty
 *
¥›
);

357 
DIAVAR
 
gboﬁón
 
	`pdçp_åue
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

358 
DIAVAR
 
gboﬁón
 
	`pdçp_is_visibÀ
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

359 
gboﬁón
 
	`pdçp_is_visibÀ_no_°™d¨d
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

360 
gboﬁón
 
	`pdçp_is_nŸ_visibÀ
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

361 
gboﬁón
 
	`pdçp_do_ßve
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

362 
gboﬁón
 
	`pdçp_do_ßve_no_°™d¨d
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

363 
gboﬁón
 
	`pdçp_do_lﬂd
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

364 
gboﬁón
 
	`pdçp_do_nŸ_ßve
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

366 
gboﬁón
 
	`pdçp_deÁu…s
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

368 
gboﬁón
 
	`pdçp_sy¡hëic
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

369 
gboﬁón
 
	`pdçp_‰om_obje˘
(c⁄° 
Pr›Des¸ùti⁄
 *
pdesc
);

377 
DIAVAR
 
GPåAºay
 *
	`¥›_li°_of_sögÀ
(
Pr›îty
 *
¥›
);

382 
DIAVAR
 
Pr›îty
 *
	`make_√w_¥›
(c⁄° *
«me
, 
Pr›îtyTy≥
 
ty≥
, 
guöt
 
Êags
);

389 #i‚de‡
off£tof


390 
	#off£tof
(
ty≥
, 
membî
Ë–(Ë& (—y≥*)0Ë-> membî )

	)

392 
	s_Pr›Off£t
 {

393 c⁄° 
gch¨
 *
«me
;

394 
Pr›îtyTy≥
 
ty≥
;

395 
off£t
;

396 
off£t2
;

397 
GQu¨k
 
«me_qu¨k
;

398 
GQu¨k
 
ty≥_qu¨k
;

399 c⁄° 
Pr›îtyOps
 *
›s
;

407 
gboﬁón
 
	`obje˘_com∂õs_wôh_°d¥›
(c⁄° 
DüObje˘
 *
obj
);

408 
gboﬁón
 
	`obje˘s_com∂y_wôh_°d¥›
(
GLi°
 *
obje˘s
);

410 
	`obje˘_li°_gë_¥›s
(
GLi°
 *
obje˘s
, 
GPåAºay
 *
¥›s
);

414 
DIAVAR
 c⁄° 
Pr›Des¸ùti⁄
 *
	`obje˘_gë_¥›_des¸ùti⁄s
(c⁄° 
DüObje˘
 *
obj
);

415 c⁄° 
Pr›Des¸ùti⁄
 *
	`obje˘_li°_gë_¥›_des¸ùti⁄s
(
GLi°
 *
obje˘s
,

416 
Pr›MîgeO±i⁄
 
›ti⁄
);

418 
DIAVAR
 
gboﬁón
 
	`obje˘_gë_¥›s_‰om_off£ts
(
DüObje˘
 *
obj
, 
Pr›Off£t
 *
off£ts
,

419 
GPåAºay
 *
¥›s
);

420 
DIAVAR
 
gboﬁón
 
	`obje˘_£t_¥›s_‰om_off£ts
(
DüObje˘
 *
obj
, 
Pr›Off£t
 *
off£ts
,

421 
GPåAºay
 *
¥›s
);

424 
DIAVAR
 
Obje˘Ch™ge
 *
	`obje˘_≠∂y_¥›s
(
DüObje˘
 *
obj
, 
GPåAºay
 *
¥›s
);

430 
DIAVAR
 
WIDGET
 *
	`obje˘_¸óã_¥›s_dülog
 (
DüObje˘
 *
obj
, 
gboﬁón
 
is_deÁu…
);

431 
DIAVAR
 
WIDGET
 *
	`obje˘_li°_¸óã_¥›s_dülog
(
GLi°
 *
obj
, 
gboﬁón
 
is_deÁu…
);

432 
DIAVAR
 
Obje˘Ch™ge
 *
	`obje˘_≠∂y_¥›s_‰om_dülog
 (
DüObje˘
 *
obj
, 
WIDGET
 *
dülog
);

438 
DIAVAR
 
Pr›îty
 *
	`obje˘_¥›_by_«me
(
DüObje˘
 *
obj
, c⁄° *
«me
);

439 
DIAVAR
 
Pr›îty
 *
	`obje˘_¥›_by_«me_ty≥
(
DüObje˘
 *
obj
, c⁄° *
«me
, c⁄° *
ty≥
);

442 
DIAVAR
 
	`obje˘_lﬂd_¥›s
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
);

443 
DIAVAR
 
	`obje˘_ßve_¥›s
(
DüObje˘
 *
obj
, 
Obje˘Node
 
obj_node
);

447 
DIAVAR
 
	`obje˘_c›y_¥›s
(
DüObje˘
 *
de°
, c⁄° DüObje˘ *
§c
,

448 
gboﬁón
 
is_deÁu…
);

451 
DIAVAR
 
Pr›îty
 *
	`obje˘_gë_¥›_by_«me
 (
DüObje˘
 *
obj
, c⁄° * 
«me
);

455 
	`°d¥›s_öô
();

473 #ifde‡
G_OS_WIN32


474 
Pr›NumD©a
 
¥›_°d_löe_width_d©a
 = { 0.0f, 10.0f, 0.01‡
	}
};

475 
Pr›NumD©a
 
	g¥›_°d_ãxt_height_d©a
 = { 0.1f, 10.0f, 0.1f };

476 
Pr›EnumD©a
 
	g¥›_°d_ãxt_Æign_d©a
[] = {

477 { 
N_
("Le·"), 
ALIGN_LEFT
 },

478 { 
N_
("Cíãr"), 
ALIGN_CENTER
 },

479 { 
N_
("Right"), 
ALIGN_RIGHT
 },

480 { 
NULL
, 0 }

483 
Pr›NumD©a
 
¥›_°d_löe_width_d©a
, 
¥›_°d_ãxt_height_d©a
;

484 
Pr›EnumD©a
 
¥›_°d_ãxt_Æign_d©a
[];

487 
	#PROP_STDNAME_LINE_WIDTH
 "löe_width"

	)

488 
	#PROP_STDTYPE_LINE_WIDTH
 
PROP_TYPE_LENGTH


	)

489 
	#PROP_STD_LINE_WIDTH
 \

490 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

491 
	`N_
("Löêwidth"), 
NULL
, &
¥›_°d_löe_width_d©a
 }

	)

492 
	#PROP_STD_LINE_WIDTH_OPTIONAL
 \

493 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

494 
	`N_
("Löêwidth"), 
NULL
, &
¥›_°d_löe_width_d©a
 }

	)

495 
	#PROP_STD_LINE_COLOUR
 \

496 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

497 
	`N_
("Löêcﬁ‹"), 
NULL
, NULL }

	)

498 
	#PROP_STD_LINE_COLOUR_OPTIONAL
 \

499 { "löe_cﬁour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

500 
	`N_
("Löêcﬁ‹"), 
NULL
, NULL }

	)

501 
	#PROP_STD_LINE_STYLE
 \

502 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

503 
	`N_
("Löê°yÀ"), 
NULL
, NULL }

	)

504 
	#PROP_STD_LINE_STYLE_OPTIONAL
 \

505 { "löe_°yÀ", 
PROP_TYPE_LINESTYLE
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

506 
	`N_
("Löê°yÀ"), 
NULL
, NULL }

	)

508 
	#PROP_STD_FILL_COLOUR
 \

509 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

510 
	`N_
("Fû»cﬁ‹"), 
NULL
, NULL }

	)

511 
	#PROP_STD_FILL_COLOUR_OPTIONAL
 \

512 { "fûl_cﬁour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

513 
	`N_
("Fû»cﬁ‹"), 
NULL
, NULL }

	)

514 
	#PROP_STD_SHOW_BACKGROUND
 \

515 { "show_background", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
, \

516 
	`N_
("Døw background"), 
NULL
, NULL }

	)

517 
	#PROP_STD_SHOW_BACKGROUND_OPTIONAL
 \

518 { "show_background", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_OPTIONAL
, \

519 
	`N_
("Døw background"), 
NULL
, NULL }

	)

521 
	#PROP_STD_START_ARROW
 \

522 { "°¨t_¨row", 
PROP_TYPE_ARROW
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

523 
	`N_
("Sèπáºow"), 
NULL
, NULL }

	)

524 
	#PROP_STD_END_ARROW
 \

525 { "íd_¨row", 
PROP_TYPE_ARROW
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

526 
	`N_
("Endáºow"), 
NULL
, NULL }

	)

528 
	#PROP_STD_TEXT_OPTIONS
(
›ti⁄s
) \

529 { "ãxt", 
PROP_TYPE_TEXT
, (
›ti⁄s
), \

530 
	`N_
("Text"), 
NULL
, NULL }

	)

531 
	#PROP_STD_TEXT
 
	`PROP_STD_TEXT_OPTIONS
(
PROP_FLAG_DONT_SAVE
)

	)

532 
	#PROP_STD_SAVED_TEXT
 
	`PROP_STD_TEXT_OPTIONS
(0)

	)

534 
	#PROP_STD_TEXT_ALIGNMENT_OPTIONS
(
›ti⁄s
) \

535 { "ãxt_Æignmít", 
PROP_TYPE_ENUM
, (
›ti⁄s
), \

536 
	`N_
("TexàÆignmít"), 
NULL
, 
¥›_°d_ãxt_Æign_d©a
 }

	)

537 
	#PROP_STD_TEXT_ALIGNMENT
 \

538 
	`PROP_STD_TEXT_ALIGNMENT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

540 
	#PROP_STD_TEXT_FONT_OPTIONS
(
›ti⁄s
) \

541 { "ãxt_f⁄t", 
PROP_TYPE_FONT
, (
›ti⁄s
), 
	`N_
("F⁄t"), 
NULL
, NULL }

	)

542 
	#PROP_STD_TEXT_FONT
 \

543 
	`PROP_STD_TEXT_FONT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

545 
	#PROP_STDNAME_TEXT_HEIGHT
 "ãxt_height"

	)

546 
	#PROP_STDTYPE_TEXT_HEIGHT
 
PROP_TYPE_FONTSIZE


	)

547 
	#PROP_STD_TEXT_HEIGHT_OPTIONS
(
›ti⁄s
) \

548 { 
PROP_STDNAME_TEXT_HEIGHT
, 
PROP_STDTYPE_TEXT_HEIGHT
, (
›ti⁄s
), \

549 
	`N_
("F⁄àsize"), 
NULL
, &
¥›_°d_ãxt_height_d©a
 }

	)

550 
	#PROP_STD_TEXT_HEIGHT
 \

551 
	`PROP_STD_TEXT_HEIGHT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

553 
	#PROP_STD_TEXT_COLOUR_OPTIONS
(
›ti⁄s
) \

554 { "ãxt_cﬁour", 
PROP_TYPE_COLOUR
, (
›ti⁄s
), \

555 
	`N_
("Texàcﬁ‹"), 
NULL
, NULL }

	)

556 
	#PROP_STD_TEXT_COLOUR
 \

557 
	`PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_STANDARD
)

	)

558 
	#PROP_STD_TEXT_COLOUR_OPTIONAL
 \

559 
	`PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
)

	)

562 
	#PROP_NOTEBOOK_BEGIN
(
«me
) \

563 { "nbook_" 
«me
, 
PROP_TYPE_NOTEBOOK_BEGIN
, \

564 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
, 
NULL
, NULL}

	)

565 
	#PROP_STD_NOTEBOOK_BEGIN
 
	`PROP_NOTEBOOK_BEGIN
("°d")

	)

566 
	#PROP_OFFSET_NOTEBOOK_BEGIN
(
«me
) \

567 { "nbook_" 
«me
, 
PROP_TYPE_NOTEBOOK_BEGIN
, 0}

	)

568 
	#PROP_OFFSET_STD_NOTEBOOK_BEGIN
 
	`PROP_OFFSET_NOTEBOOK_BEGIN
("°d")

	)

570 
	#PROP_NOTEBOOK_END
(
«me
) \

571 { "nbook_" 
«me
 "_íd", 
PROP_TYPE_NOTEBOOK_END
, \

572 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
, 
NULL
, NULL}

	)

573 
	#PROP_STD_NOTEBOOK_END
 
	`PROP_NOTEBOOK_END
("°d")

	)

574 
	#PROP_OFFSET_NOTEBOOK_END
(
«me
) \

575 { "nbook_" 
«me
 "_íd", 
PROP_TYPE_NOTEBOOK_END
, 0}

	)

576 
	#PROP_OFFSET_STD_NOTEBOOK_END
 
	`PROP_OFFSET_NOTEBOOK_END
("°d")

	)

578 
	#PROP_NOTEBOOK_PAGE
(
«me
,
Êags
,
des¸
) \

579 { "nbook_∑ge_" 
«me
, 
PROP_TYPE_NOTEBOOK_PAGE
, \

580 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
|
Êags
,
des¸
,
NULL
}

	)

581 
	#PROP_OFFSET_NOTEBOOK_PAGE
(
«me
) \

582 { "nbook_∑ge_" 
«me
 , 
PROP_TYPE_NOTEBOOK_PAGE
, 0}

	)

584 
	#PROP_MULTICOL_BEGIN
(
«me
) \

585 { "mcﬁ_" 
«me
, 
PROP_TYPE_MULTICOL_BEGIN
, \

586 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
, 
NULL
, NULL}

	)

587 
	#PROP_OFFSET_MULTICOL_BEGIN
(
«me
) \

588 { "mcﬁ_" 
«me
, 
PROP_TYPE_NOTEBOOK_BEGIN
, 0}

	)

590 
	#PROP_MULTICOL_END
(
«me
) \

591 { "mcﬁ_" 
«me
 "_íd", 
PROP_TYPE_MULTICOL_END
, \

592 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
, 
NULL
, NULL}

	)

593 
	#PROP_OFFSET_MULTICOL_END
(
«me
) \

594 { "mcﬁ_" 
«me
 "_íd", 
PROP_TYPE_MULTICOL_END
, 0}

	)

596 
	#PROP_MULTICOL_COLUMN
(
«me
) \

597 { "mcﬁ_cﬁ_" 
«me
, 
PROP_TYPE_MULTICOL_COLUMN
, \

598 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
,
NULL
,NULL}

	)

599 
	#PROP_OFFSET_MULTICOL_COLUMN
(
«me
) \

600 { "mcﬁ_cﬁ_" 
«me
, 
PROP_TYPE_MULTICOL_COLUMN
, 0}

	)

602 
	#PROP_FRAME_BEGIN
(
«me
,
Êags
,
des¸
) \

603 { "‰ame_" 
«me
, 
PROP_TYPE_FRAME_BEGIN
, \

604 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
Êags
, 
des¸
, 
NULL
}

	)

605 
	#PROP_OFFSET_FRAME_BEGIN
(
«me
) \

606 { "‰ame_" 
«me
, 
PROP_TYPE_FRAME_BEGIN
, 0}

	)

608 
	#PROP_FRAME_END
(
«me
,
Êags
) \

609 { "‰ame_" 
«me
 "_íd", 
PROP_TYPE_FRAME_END
, \

610 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
Êags
, 
NULL
, NULL}

	)

611 
	#PROP_OFFSET_FRAME_END
(
«me
) \

612 { "‰ame_" 
«me
 "_íd", 
PROP_TYPE_FRAME_END
, 0}

	)

614 
	gG_END_DECLS


	@lib/widgets.h

18 #i‚de‡
WIDGETS_H


19 
	#WIDGETS_H


	)

21 
	~<c⁄fig.h
>

23 
	~<gdk/gdk.h
>

24 
	~<gtk/gtkmíu.h
>

25 
	~<gtk/gtk›ti⁄míu.h
>

26 
	~<gtk/gtkdøwög¨ó.h
>

27 
	~<gtk/gtkcﬁ‹£l.h
>

28 
	~<gtk/gtkhbox.h
>

29 
	~<gtk/gtkfûe£l.h
>

30 
	~<gtk/gtk•öbuâ⁄.h
>

31 
	~<gtk/gtkœbñ.h
>

32 
	~<gtk/gtkcﬁ‹£ldülog.h
>

33 
	~<gtk/gtkmíuôem.h
>

35 
	~"düty≥s.h
"

36 
	~"f⁄t.h
"

37 
	~"cﬁ‹.h
"

38 
	~"¨rows.h
"

39 
	~"unôs.h
"

42 
	#DIAFONTSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_f⁄t_£À˘‹_gë_ty≥
 (), 
DüF⁄tSñe˘‹
)

	)

43 
	#DIAFONTSELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_f⁄t_£À˘‹_gë_ty≥
 (), 
DüF⁄tSñe˘‹Cœss
)

	)

44 
	#IS_DIAFONTSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_f⁄t_£À˘‹_gë_ty≥
 ())

	)

47 
DIAVAR
 
GTy≥
 
dü_f⁄t_£À˘‹_gë_ty≥
 ();

48 
DIAVAR
 
GtkWidgë
* 
dü_f⁄t_£À˘‹_√w
 ();

49 
DIAVAR
 
dü_f⁄t_£À˘‹_£t_f⁄t
 (
DüF⁄tSñe˘‹
 *
fs
, 
DüF⁄t
 *
f⁄t
);

50 
dü_f⁄t_£À˘‹_£t_¥evõw
 (
DüF⁄tSñe˘‹
 *
fs
, 
gch¨
 *
ãxt
);

51 
DIAVAR
 
DüF⁄t
 * 
dü_f⁄t_£À˘‹_gë_f⁄t
 (
DüF⁄tSñe˘‹
 *
fs
);

54 
	#DIAALIGNMENTSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_Æignmít_£À˘‹_gë_ty≥
 (), 
DüAlignmítSñe˘‹
)

	)

55 
	#DIAALIGNMENTSELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_Æignmít_£À˘‹_gë_ty≥
 (), 
DüAlignmítSñe˘‹Cœss
)

	)

56 
	#IS_DIAALIGNMENTSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_Æignmít_£À˘‹_gë_ty≥
 ())

	)

59 
DIAVAR
 
GTy≥
 
dü_Æignmít_£À˘‹_gë_ty≥
 ();

60 
DIAVAR
 
GtkWidgë
* 
dü_Æignmít_£À˘‹_√w
 ();

61 
DIAVAR
 
Alignmít
 
dü_Æignmít_£À˘‹_gë_Æignmít
 (
DüAlignmítSñe˘‹
 *
as
);

62 
DIAVAR
 
dü_Æignmít_£À˘‹_£t_Æignmít
 (
DüAlignmítSñe˘‹
 *
as
,

63 
Alignmít
 
Æign
);

66 
	#DIALINESTYLESELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_löe_°yÀ_£À˘‹_gë_ty≥
 (), 
DüLöeStyÀSñe˘‹
)

	)

67 
	#DIALINESTYLESELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_löe_°yÀ_£À˘‹_gë_ty≥
 (), 
DüLöeStyÀSñe˘‹Cœss
)

	)

68 
	#IS_DIALINESTYLESELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_löe_°yÀ_£À˘‹_gë_ty≥
 ())

	)

70 
	#DEFAULT_LINESTYLE
 
LINESTYLE_SOLID


	)

71 
	#DEFAULT_LINESTYLE_DASHLEN
 1.0

	)

74 
DIAVAR
 
GTy≥
 
dü_löe_°yÀ_£À˘‹_gë_ty≥
 ();

75 
DIAVAR
 
GtkWidgë
* 
dü_löe_°yÀ_£À˘‹_√w
 ();

76 
DIAVAR
 
dü_löe_°yÀ_£À˘‹_gë_löe°yÀ
 (
DüLöeStyÀSñe˘‹
 *
as
,

77 
LöeStyÀ
 *
löe°yÀ
,

78 
ªÆ
 *
dashÀngth
);

79 
DIAVAR
 
dü_löe_°yÀ_£À˘‹_£t_löe°yÀ
 (
DüLöeStyÀSñe˘‹
 *
as
,

80 
LöeStyÀ
 
löe°yÀ
,

81 
ªÆ
 
dashÀngth
);

84 
	#DIACOLORSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_cﬁ‹_£À˘‹_gë_ty≥
 (), 
DüCﬁ‹Sñe˘‹
)

	)

85 
	#DIACOLORSELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_cﬁ‹_£À˘‹_gë_ty≥
 (), 
DüCﬁ‹Sñe˘‹Cœss
)

	)

86 
	#IS_DIACOLORSELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_cﬁ‹_£À˘‹_gë_ty≥
 ())

	)

88 
	#DEFAULT_FG_COLOR
 
cﬁ‹_bœck


	)

89 
	#DEFAULT_BG_COLOR
 
cﬁ‹_whôe


	)

90 
	#DEFAULT_COLOR
 
cﬁ‹_whôe


	)

94 
DIAVAR
 
GTy≥
 
dü_cﬁ‹_£À˘‹_gë_ty≥
 ();

95 
DIAVAR
 
GtkWidgë
* 
dü_cﬁ‹_£À˘‹_√w
 ();

96 
DIAVAR
 
dü_cﬁ‹_£À˘‹_gë_cﬁ‹
 (
GtkWidgë
 *
cs
, 
Cﬁ‹
 *
cﬁ‹
);

97 
DIAVAR
 
dü_cﬁ‹_£À˘‹_£t_cﬁ‹
 (
GtkWidgë
 *
cs
,

98 c⁄° 
Cﬁ‹
 *
cﬁ‹
);

102 
	#DIA_TYPE_ARROW_SELECTOR
 (
	`dü_¨row_£À˘‹_gë_ty≥
())

	)

103 
	#DIA_ARROW_SELECTOR
(
obj
Ë(
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_¨row_£À˘‹_gë_ty≥
 (), 
DüAºowSñe˘‹
))

	)

104 
	#DIA_ARROW_SELECTOR_CLASS
(
kœss
Ë(
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_¨row_£À˘‹_gë_ty≥
 (), 
DüAºowSñe˘‹Cœss
))

	)

105 
	#DIA_IS_ARROW_SELECTOR
(
obj
Ë(
	`G_TYPE_CHECK_TYPE
 (obj, 
	`dü_¨row_£À˘‹_gë_ty≥
 ()))

	)

106 
	#DIA_ARROW_SELECTOR_GET_CLASS
(
obj
Ë(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_ARROW_SELECTOR
, 
DüAºowSñe˘‹Cœss
))

	)

108 
	#DEFAULT_ARROW
 
ARROW_NONE


	)

109 
	#DEFAULT_ARROW_LENGTH
 
DEFAULT_ARROW_SIZE


	)

110 
	#DEFAULT_ARROW_WIDTH
 
DEFAULT_ARROW_SIZE


	)

113 
DIAVAR
 
GTy≥
 
dü_¨row_£À˘‹_gë_ty≥
 ();

114 
DIAVAR
 
GtkWidgë
* 
dü_¨row_£À˘‹_√w
 ();

115 
DIAVAR
 
Aºow
 
dü_¨row_£À˘‹_gë_¨row
 (
DüAºowSñe˘‹
 *
as
);

116 
DIAVAR
 
dü_¨row_£À˘‹_£t_¨row
 (
DüAºowSñe˘‹
 *
as
,

117 
Aºow
 
¨row
);

121 
	#DIAFILESELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_fûe_£À˘‹_gë_ty≥
 (), 
DüFûeSñe˘‹
)

	)

122 
	#DIAFILESELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_fûe_£À˘‹_gë_ty≥
 (), 
DüFûeSñe˘‹Cœss
)

	)

123 
	#IS_DIAFILESELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_fûe_£À˘‹_gë_ty≥
 ())

	)

126 
DIAVAR
 
GTy≥
 
dü_fûe_£À˘‹_gë_ty≥
 ();

127 
DIAVAR
 
GtkWidgë
* 
dü_fûe_£À˘‹_√w
 ();

128 
DIAVAR
 
dü_fûe_£À˘‹_£t_fûe
 (
DüFûeSñe˘‹
 *
fs
, *
fûe
);

129 
DIAVAR
 c⁄° 
gch¨
 *
dü_fûe_£À˘‹_gë_fûe
 (
DüFûeSñe˘‹
 *
fs
);

132 
	#DIA_SIZE_SELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dü_size_£À˘‹_gë_ty≥
 (), 
DüSizeSñe˘‹
)

	)

133 
	#DIA_SIZE_SELECTOR_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
 (kœss, 
	`dü_size_£À˘‹_gë_ty≥
 (), 
DüSizeSñe˘‹Cœss
)

	)

134 
	#IS_DIA_SIZE_SELECTOR
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dü_size_£À˘‹_gë_ty≥
 ())

	)

137 
DIAVAR
 
GTy≥
 
dü_size_£À˘‹_gë_ty≥
 ();

138 
DIAVAR
 
GtkWidgë
* 
dü_size_£À˘‹_√w
 (
ªÆ
 
width
,Ñó»
height
);

139 
DIAVAR
 
dü_size_£À˘‹_£t_locked
(
DüSizeSñe˘‹
 *
ss
, 
gboﬁón
 
locked
);

140 
DIAVAR
 
dü_size_£À˘‹_£t_size
 (
DüSizeSñe˘‹
 *
ss
, 
ªÆ
 
width
,Ñó»
height
);

141 
DIAVAR
 
gboﬁón
 
dü_size_£À˘‹_gë_size
 (
DüSizeSñe˘‹
 *
ss
, 
ªÆ
 *
width
,Ñó»*
height
);

145 
	#DIA_UNIT_SPINNER
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
(obj, 
	`dü_unô_•ö√r_gë_ty≥
(), 
DüUnôSpö√r
)

	)

146 
	#DIA_UNIT_SPINNER_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
(kœss, 
	`dü_unô_•ö√r_gë_ty≥
(), 
DüUnôSpö√rCœss
)

	)

147 
	#DIA_IS_UNIT_SPINNER
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
(obj, 
	`dü_unô_•ö√r_gë_ty≥
())

	)

149 
_DüUnôSpö√r
 
	tDüUnôSpö√r
;

150 
_DüUnôSpö√rCœss
 
	tDüUnôSpö√rCœss
;

152 
	s_DüUnôSpö√r
 {

153 
GtkSpöBuâ⁄
 
	m∑ª¡
;

155 
DüUnô
 
	munô_num
;

158 
	s_DüUnôSpö√rCœss
 {

159 
GtkSpöBuâ⁄Cœss
 
	m∑ª¡_˛ass
;

163 
DIAVAR
 
GTy≥
 
dü_unô_•ö√r_gë_ty≥
 ();

164 
DIAVAR
 
GtkWidgë
 *
dü_unô_•ö√r_√w
 (
GtkAdju°mít
 *
adju°mít
,

165 
DüUnô
 
adj_unô
);

166 
DIAVAR
 
dü_unô_•ö√r_£t_vÆue
 (
DüUnôSpö√r
 *
£lf
, 
gdoubÀ
 
vÆ
);

167 
DIAVAR
 
gdoubÀ
 
dü_unô_•ö√r_gë_vÆue
 (
DüUnôSpö√r
 *
£lf
);

168 
DIAVAR
 
dü_unô_•ö√r_£t_uµî
 (
DüUnôSpö√r
 *
£lf
, 
gdoubÀ
 
vÆ
);

170 
DIAVAR
 
GLi°
 * 
gë_unôs_«me_li°
();

174 
	#DIA_DYNAMIC_MENU
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_CAST
(obj, 
	`dü_dy«mic_míu_gë_ty≥
(), 
DüDy«micMíu
)

	)

175 
	#DIA_DYNAMIC_MENU_CLASS
(
kœss
Ë
	`G_TYPE_CHECK_CLASS_CAST
(kœss, 
	`dü_dy«mic_míu_gë_ty≥
(), 
DüDy«micMíuCœss
)

	)

176 
	#DIA_IS_DYNAMIC_MENU
(
obj
Ë
	`G_TYPE_CHECK_INSTANCE_TYPE
(obj, 
	`dü_dy«mic_míu_gë_ty≥
())

	)

178 
_DüDy«micMíu
 
	tDüDy«micMíu
;

179 
_DüDy«micMíuCœss
 
	tDüDy«micMíuCœss
;

188 íum { 
	mDDM_SORT_TOP
, 
	mDDM_SORT_NEWEST
, 
	mDDM_SORT_SORT
 } 
	tDdmS‹tTy≥
;

190 
	gGtkWidgë
 *(* 
	tDDMCª©eIãmFunc
)(
	tDüDy«micMíu
 *, 
	tgch¨
 *);

191 (* 
	tDDMCÆlbackFunc
)(
	tDüDy«micMíu
 *, c⁄° 
	tgch¨
 *, 
	tgpoöãr
);

193 
DIAVAR
 
GTy≥
 
	`dü_dy«mic_míu_gë_ty≥
 ();

195 
DIAVAR
 
GtkWidgë
 *
	`dü_dy«mic_míu_√w
(
DDMCª©eIãmFunc
 
¸óã
,

196 
gpoöãr
 
u£rd©a
,

197 
GtkMíuIãm
 *
Ÿhîôem
, 
gch¨
 *
≥rsi°
);

198 
DIAVAR
 
GtkWidgë
 *
	`dü_dy«mic_míu_√w_°rögba£d
(
GtkMíuIãm
 *
Ÿhîôem
,

199 
gpoöãr
 
u£rd©a
,

200 
gch¨
 *
≥rsi°
);

201 
DIAVAR
 
GtkWidgë
 *
	`dü_dy«mic_míu_√w_li°ba£d
(
DDMCª©eIãmFunc
 
¸óã
,

202 
gpoöãr
 
u£rd©a
,

203 
gch¨
 *
Ÿhî_œbñ
,

204 
GLi°
 *
ôems
, 
gch¨
 *
≥rsi°
);

205 
DIAVAR
 
GtkWidgë
 *
	`dü_dy«mic_míu_√w_°rögli°ba£d
(
gch¨
 *
Ÿhî_œbñ
,

206 
GLi°
 *
ôems
,

207 
gpoöãr
 
u£rd©a
,

208 
gch¨
 *
≥rsi°
);

209 
DIAVAR
 
	`dü_dy«mic_míu_add_deÁu…_íåy
(
DüDy«micMíu
 *
ddm
, c⁄° 
gch¨
 *
íåy
);

210 
DIAVAR
 
göt
 
	`dü_dy«mic_míu_add_íåy
(
DüDy«micMíu
 *
ddm
, c⁄° 
gch¨
 *
íåy
);

211 
DIAVAR
 
	`dü_dy«mic_míu_£t_s‹tög_mëhod
(
DüDy«micMíu
 *
ddm
, 
DdmS‹tTy≥
 
s‹t
);

212 
DIAVAR
 
	`dü_dy«mic_míu_ª£t
(
GtkWidgë
 *
widgë
, 
gpoöãr
 
u£rd©a
);

213 
DIAVAR
 
	`dü_dy«mic_míu_£t_max_íåõs
(
DüDy«micMíu
 *
ddm
, 
göt
 
max
);

214 
DIAVAR
 
	`dü_dy«mic_míu_£t_cﬁumns
(
DüDy«micMíu
 *
ddm
, 
göt
 
cﬁs
);

215 
DIAVAR
 
gch¨
 *
	`dü_dy«mic_míu_gë_íåy
(
DüDy«micMíu
 *
ddm
);

216 
DIAVAR
 
	`dü_dy«mic_míu_£À˘_íåy
(
DüDy«micMíu
 *
ddm
, c⁄° 
gch¨
 *
íåy
);

223 
DIAVAR
 
GtkWidgë
 *
	`dü_toggÀ_buâ⁄_√w_wôh_ic⁄s
(c⁄° 
guöt8
 *
⁄_ic⁄
,

224 c⁄° 
guöt8
 *
off_ic⁄
);

228 
	#DEFAULT_ALIGNMENT
 
ALIGN_LEFT


	)

230 
	#DEFAULT_LINE_WIDTH
 2*0.05

	)

	@
1
.
0
302
9500
O:\tool\dvs50\app\app_procs.c
O:\tool\dvs50\app\app_procs.h
O:\tool\dvs50\app\authors.h
O:\tool\dvs50\app\autosave.c
O:\tool\dvs50\app\autosave.h
O:\tool\dvs50\app\color_area.c
O:\tool\dvs50\app\color_area.h
O:\tool\dvs50\app\commands.c
O:\tool\dvs50\app\commands.h
O:\tool\dvs50\app\confirm.c
O:\tool\dvs50\app\confirm.h
O:\tool\dvs50\app\connectionpoint_ops.c
O:\tool\dvs50\app\connectionpoint_ops.h
O:\tool\dvs50\app\create_object.c
O:\tool\dvs50\app\create_object.h
O:\tool\dvs50\app\cursor.c
O:\tool\dvs50\app\cursor.h
O:\tool\dvs50\app\cut_n_paste.c
O:\tool\dvs50\app\cut_n_paste.h
O:\tool\dvs50\app\defaults.c
O:\tool\dvs50\app\defaults.h
O:\tool\dvs50\app\dia-app-icons.h
O:\tool\dvs50\app\dia-props.c
O:\tool\dvs50\app\dia-props.h
O:\tool\dvs50\app\diacanvas.c
O:\tool\dvs50\app\diacanvas.h
O:\tool\dvs50\app\diagram.c
O:\tool\dvs50\app\diagram.h
O:\tool\dvs50\app\diagram_tree.c
O:\tool\dvs50\app\diagram_tree.h
O:\tool\dvs50\app\diagram_tree_menu.c
O:\tool\dvs50\app\diagram_tree_menu.h
O:\tool\dvs50\app\diagram_tree_menu_callbacks.c
O:\tool\dvs50\app\diagram_tree_menu_callbacks.h
O:\tool\dvs50\app\diagram_tree_window.c
O:\tool\dvs50\app\diagram_tree_window.h
O:\tool\dvs50\app\diagrid.h
O:\tool\dvs50\app\diapagelayout.c
O:\tool\dvs50\app\diapagelayout.h
O:\tool\dvs50\app\disp_callbacks.c
O:\tool\dvs50\app\disp_callbacks.h
O:\tool\dvs50\app\display.c
O:\tool\dvs50\app\display.h
O:\tool\dvs50\app\dynamic_refresh.c
O:\tool\dvs50\app\dynamic_refresh.h
O:\tool\dvs50\app\exit_dialog.c
O:\tool\dvs50\app\exit_dialog.h
O:\tool\dvs50\app\filedlg.c
O:\tool\dvs50\app\filedlg.h
O:\tool\dvs50\app\find-and-replace.c
O:\tool\dvs50\app\find-and-replace.h
O:\tool\dvs50\app\grid.c
O:\tool\dvs50\app\grid.h
O:\tool\dvs50\app\gtkhwrapbox.c
O:\tool\dvs50\app\gtkhwrapbox.h
O:\tool\dvs50\app\gtkvwrapbox.c
O:\tool\dvs50\app\gtkvwrapbox.h
O:\tool\dvs50\app\gtkwrapbox.c
O:\tool\dvs50\app\gtkwrapbox.h
O:\tool\dvs50\app\handle_ops.c
O:\tool\dvs50\app\handle_ops.h
O:\tool\dvs50\app\highlight.c
O:\tool\dvs50\app\highlight.h
O:\tool\dvs50\app\interface.c
O:\tool\dvs50\app\interface.h
O:\tool\dvs50\app\layer_dialog.c
O:\tool\dvs50\app\layer_dialog.h
O:\tool\dvs50\app\linewidth_area.c
O:\tool\dvs50\app\linewidth_area.h
O:\tool\dvs50\app\load_save.c
O:\tool\dvs50\app\load_save.h
O:\tool\dvs50\app\magnify.c
O:\tool\dvs50\app\magnify.h
O:\tool\dvs50\app\main.c
O:\tool\dvs50\app\menus.c
O:\tool\dvs50\app\menus.h
O:\tool\dvs50\app\modify_tool.c
O:\tool\dvs50\app\modify_tool.h
O:\tool\dvs50\app\navigation.c
O:\tool\dvs50\app\navigation.h
O:\tool\dvs50\app\object_ops.c
O:\tool\dvs50\app\object_ops.h
O:\tool\dvs50\app\pagesetup.c
O:\tool\dvs50\app\pagesetup.h
O:\tool\dvs50\app\plugin-manager.c
O:\tool\dvs50\app\plugin-manager.h
O:\tool\dvs50\app\preferences.c
O:\tool\dvs50\app\preferences.h
O:\tool\dvs50\app\properties-dialog.c
O:\tool\dvs50\app\properties-dialog.h
O:\tool\dvs50\app\recent_files.c
O:\tool\dvs50\app\recent_files.h
O:\tool\dvs50\app\render_gdk.c
O:\tool\dvs50\app\render_gdk.h
O:\tool\dvs50\app\scroll_tool.c
O:\tool\dvs50\app\scroll_tool.h
O:\tool\dvs50\app\select.c
O:\tool\dvs50\app\select.h
O:\tool\dvs50\app\sheets.c
O:\tool\dvs50\app\sheets.h
O:\tool\dvs50\app\sheets_dialog.c
O:\tool\dvs50\app\sheets_dialog.h
O:\tool\dvs50\app\sheets_dialog_callbacks.c
O:\tool\dvs50\app\sheets_dialog_callbacks.h
O:\tool\dvs50\app\splash.c
O:\tool\dvs50\app\textedit.c
O:\tool\dvs50\app\textedit.h
O:\tool\dvs50\app\textedit_tool.c
O:\tool\dvs50\app\textedit_tool.h
O:\tool\dvs50\app\tool.c
O:\tool\dvs50\app\tool.h
O:\tool\dvs50\app\undo.c
O:\tool\dvs50\app\undo.h
O:\tool\dvs50\app\winmain.c
O:\tool\dvs50\config.h
O:\tool\dvs50\lib\arrows.c
O:\tool\dvs50\lib\arrows.h
O:\tool\dvs50\lib\attributes.c
O:\tool\dvs50\lib\attributes.h
O:\tool\dvs50\lib\autoroute.c
O:\tool\dvs50\lib\autoroute.h
O:\tool\dvs50\lib\bezier_conn.c
O:\tool\dvs50\lib\bezier_conn.h
O:\tool\dvs50\lib\beziershape.c
O:\tool\dvs50\lib\beziershape.h
O:\tool\dvs50\lib\boundingbox.c
O:\tool\dvs50\lib\boundingbox.h
O:\tool\dvs50\lib\color.c
O:\tool\dvs50\lib\color.h
O:\tool\dvs50\lib\connection.c
O:\tool\dvs50\lib\connection.h
O:\tool\dvs50\lib\connectionpoint.c
O:\tool\dvs50\lib\connectionpoint.h
O:\tool\dvs50\lib\connpoint_line.c
O:\tool\dvs50\lib\connpoint_line.h
O:\tool\dvs50\lib\create.c
O:\tool\dvs50\lib\create.h
O:\tool\dvs50\lib\debug.c
O:\tool\dvs50\lib\debug.h
O:\tool\dvs50\lib\dia-enums.h
O:\tool\dvs50\lib\dia-lib-icons.h
O:\tool\dvs50\lib\dia_dirs.c
O:\tool\dvs50\lib\dia_dirs.h
O:\tool\dvs50\lib\dia_image.c
O:\tool\dvs50\lib\dia_image.h
O:\tool\dvs50\lib\dia_svg.c
O:\tool\dvs50\lib\dia_svg.h
O:\tool\dvs50\lib\dia_xml.c
O:\tool\dvs50\lib\dia_xml.h
O:\tool\dvs50\lib\dia_xml_libxml.h
O:\tool\dvs50\lib\diaarrowchooser.c
O:\tool\dvs50\lib\diaarrowchooser.h
O:\tool\dvs50\lib\diacellrendererproperty.c
O:\tool\dvs50\lib\diacellrendererproperty.h
O:\tool\dvs50\lib\diaerror.c
O:\tool\dvs50\lib\diaerror.h
O:\tool\dvs50\lib\diagdkrenderer.c
O:\tool\dvs50\lib\diagdkrenderer.h
O:\tool\dvs50\lib\diagramdata.c
O:\tool\dvs50\lib\diagramdata.h
O:\tool\dvs50\lib\diainteractiverenderer.c
O:\tool\dvs50\lib\dialib.c
O:\tool\dvs50\lib\dialib.h
O:\tool\dvs50\lib\dialinechooser.c
O:\tool\dvs50\lib\dialinechooser.h
O:\tool\dvs50\lib\dialogs.c
O:\tool\dvs50\lib\dialogs.h
O:\tool\dvs50\lib\diamarshal.c
O:\tool\dvs50\lib\diamarshal.h
O:\tool\dvs50\lib\diamenu.h
O:\tool\dvs50\lib\diarenderer.c
O:\tool\dvs50\lib\diarenderer.h
O:\tool\dvs50\lib\diasvgrenderer.c
O:\tool\dvs50\lib\diasvgrenderer.h
O:\tool\dvs50\lib\diatransform.c
O:\tool\dvs50\lib\diatransform.h
O:\tool\dvs50\lib\diatypes.h
O:\tool\dvs50\lib\diavar.h
O:\tool\dvs50\lib\dummy_dep.h
O:\tool\dvs50\lib\dynamic_obj.c
O:\tool\dvs50\lib\dynamic_obj.h
O:\tool\dvs50\lib\element.c
O:\tool\dvs50\lib\element.h
O:\tool\dvs50\lib\filter.c
O:\tool\dvs50\lib\filter.h
O:\tool\dvs50\lib\focus.c
O:\tool\dvs50\lib\focus.h
O:\tool\dvs50\lib\font.c
O:\tool\dvs50\lib\font.h
O:\tool\dvs50\lib\geometry.c
O:\tool\dvs50\lib\geometry.h
O:\tool\dvs50\lib\group.c
O:\tool\dvs50\lib\group.h
O:\tool\dvs50\lib\handle.h
O:\tool\dvs50\lib\intl.c
O:\tool\dvs50\lib\intl.h
O:\tool\dvs50\lib\layer.c
O:\tool\dvs50\lib\message.c
O:\tool\dvs50\lib\message.h
O:\tool\dvs50\lib\newgroup.c
O:\tool\dvs50\lib\newgroup.h
O:\tool\dvs50\lib\neworth_conn.c
O:\tool\dvs50\lib\neworth_conn.h
O:\tool\dvs50\lib\objchange.c
O:\tool\dvs50\lib\objchange.h
O:\tool\dvs50\lib\object.c
O:\tool\dvs50\lib\object.h
O:\tool\dvs50\lib\object_defaults.c
O:\tool\dvs50\lib\orth_conn.c
O:\tool\dvs50\lib\orth_conn.h
O:\tool\dvs50\lib\paper.c
O:\tool\dvs50\lib\paper.h
O:\tool\dvs50\lib\parent.c
O:\tool\dvs50\lib\parent.h
O:\tool\dvs50\lib\persistence.c
O:\tool\dvs50\lib\persistence.h
O:\tool\dvs50\lib\plug-ins.c
O:\tool\dvs50\lib\plug-ins.h
O:\tool\dvs50\lib\poly_conn.c
O:\tool\dvs50\lib\poly_conn.h
O:\tool\dvs50\lib\polyshape.c
O:\tool\dvs50\lib\polyshape.h
O:\tool\dvs50\lib\prefs.c
O:\tool\dvs50\lib\prefs.h
O:\tool\dvs50\lib\prop_attr.c
O:\tool\dvs50\lib\prop_attr.h
O:\tool\dvs50\lib\prop_basic.c
O:\tool\dvs50\lib\prop_basic.h
O:\tool\dvs50\lib\prop_dict.c
O:\tool\dvs50\lib\prop_dict.h
O:\tool\dvs50\lib\prop_geomtypes.c
O:\tool\dvs50\lib\prop_geomtypes.h
O:\tool\dvs50\lib\prop_inttypes.c
O:\tool\dvs50\lib\prop_inttypes.h
O:\tool\dvs50\lib\prop_sdarray.c
O:\tool\dvs50\lib\prop_sdarray.h
O:\tool\dvs50\lib\prop_text.c
O:\tool\dvs50\lib\prop_text.h
O:\tool\dvs50\lib\prop_widgets.c
O:\tool\dvs50\lib\prop_widgets.h
O:\tool\dvs50\lib\propdesc.c
O:\tool\dvs50\lib\propdialogs.c
O:\tool\dvs50\lib\properties.c
O:\tool\dvs50\lib\properties.h
O:\tool\dvs50\lib\propinternals.h
O:\tool\dvs50\lib\proplist.c
O:\tool\dvs50\lib\propobject.c
O:\tool\dvs50\lib\propoffsets.c
O:\tool\dvs50\lib\propregistry.c
O:\tool\dvs50\lib\render_pixmap.c
O:\tool\dvs50\lib\render_pixmap.h
O:\tool\dvs50\lib\sheet.c
O:\tool\dvs50\lib\sheet.h
O:\tool\dvs50\lib\text.c
O:\tool\dvs50\lib\text.h
O:\tool\dvs50\lib\textattr.h
O:\tool\dvs50\lib\textline.c
O:\tool\dvs50\lib\textline.h
O:\tool\dvs50\lib\units.c
O:\tool\dvs50\lib\units.h
O:\tool\dvs50\lib\utils.c
O:\tool\dvs50\lib\utils.h
O:\tool\dvs50\lib\widgets.c
O:\tool\dvs50\lib\widgets.h
O:\tool\dvs50\objects\Struct\struct.c
O:\tool\dvs50\objects\Struct\struct.h
O:\tool\dvs50\objects\Struct\struct_class.c
O:\tool\dvs50\objects\Struct\struct_class.h
O:\tool\dvs50\objects\Struct\struct_dialog.c
O:\tool\dvs50\objects\Struct\structattribute.c
O:\tool\dvs50\objects\Struct\structformalparameter.c
O:\tool\dvs50\objects\Struct\structoperation.c
O:\tool\dvs50\objects\Struct\structparameter.c
O:\tool\dvs50\objects\UML\class.h
O:\tool\dvs50\objects\UML\stereotype.h
O:\tool\dvs50\objects\UML\uml.h
O:\tool\dvs50\objects\standard\arc.c
O:\tool\dvs50\objects\standard\bezier.c
O:\tool\dvs50\objects\standard\beziergon.c
O:\tool\dvs50\objects\standard\box.c
O:\tool\dvs50\objects\standard\ellipse.c
O:\tool\dvs50\objects\standard\image.c
O:\tool\dvs50\objects\standard\line.c
O:\tool\dvs50\objects\standard\outline.c
O:\tool\dvs50\objects\standard\polygon.c
O:\tool\dvs50\objects\standard\polyline.c
O:\tool\dvs50\objects\standard\standard.c
O:\tool\dvs50\objects\standard\textobj.c
O:\tool\dvs50\objects\standard\tool-icons.h
O:\tool\dvs50\objects\standard\zigzagline.c
O:\tool\dvs50\plug-ins\shape\shape-export.c
O:\tool\dvs50\plug-ins\shape\shape.c
O:\tool\dvs50\plug-ins\svg\render_svg.c
O:\tool\dvs50\plug-ins\svg\svg-import.c
O:\tool\dvs50\plug-ins\svg\svg.c
config.h
lib/diamarshal.h
lib/geometry.h
lib/parent.h
lib/prefs.h
lib/properties.h
lib/widgets.h
