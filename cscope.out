cscope 15 O:\tool\dvs50"               0002325508
	@O:\tool\dvs50\app\app_procs.c

19 
	~<cÚfig.h
>

21 
	~<¡dio.h
>

22 
	~<¡dlib.h
>

23 
	~<sys/ty³s.h
>

24 
	~<”ºo.h
>

25 
	~<¡ršg.h
>

26 
	~<sigÇl.h
>

27 
	~<loÿË.h
>

28 #ifdeà
HAVE_UNISTD_H


29 
	~<uni¡d.h
>

33 #ifdeà
HAVE_LIBPNG


34 
	~<²g.h
>

37 #ifdeà
GNOME


38 #undeà
GTK_DISABLE_DEPRECATED


40 
	~<gnome.h
>

43 
	~<gtk/gtk.h
>

44 
	~<gmoduË.h
>

46 #ifdeà
HAVE_FREETYPE


47 
	~<·ngo/·ngoá2.h
>

50 
	~<libxml/·r£r.h
>

51 
	~<libxml/xmË¼Ü.h
>

53 
	~<glib/g¡dio.h
>

55 
	~"š.h
"

56 
	~"­p_´ocs.h
"

57 
	~"objeù.h
"

58 
	~"commªds.h
"

59 
	~"toŞ.h
"

60 
	~"š‹rçû.h
"

61 
	~"modify_toŞ.h
"

62 
	~"group.h
"

63 
	~"mes§ge.h
"

64 
	~"di¥Ïy.h
"

65 
	~"Ïy”_dŸlog.h
"

66 
	~"lßd_§ve.h
"

67 
	~"´eã»nûs.h
"

68 
	~"dŸ_dœs.h
"

69 
	~"sh“t.h
"

70 
	~"¶ug-šs.h
"

71 
	~"»ûÁ_fes.h
"

72 
	~"authÜs.h
"

73 
	~"auto§ve.h
"

74 
	~"dyÇmic_»äesh.h
"

75 
	~"³rsi¡’û.h
"

76 
	~"sh“ts.h
"

77 
	~"ex™_dŸlog.h
"

78 
	~"Ãwgroup.h
"

79 
	~"dŸlib.h
"

80 
	~"dŸ”rÜ.h
"

82 
gboŞ—n


83 
hªdË_š™Ÿl_dŸg¿m
(cÚ¡ *
šput_fe_Çme
,

84 cÚ¡ *
expÜt_fe_Çme
,

85 cÚ¡ *
expÜt_fe_fÜm©
,

86 cÚ¡ *
size
,

87 *
show_Ïy”s
,

88 cÚ¡ *
outdœ
);

90 
ü—‹_u£r_dœs
();

91 
PlugšIn™ResuÉ
 
š‹º®_¶ugš_š™
(
PlugšInfo
 *
šfo
);

92 
gboŞ—n
 
hªdË_®l_dŸg¿ms
(
GSLi¡
 *
fes
, *
expÜt_fe_Çme
,

93 *
expÜt_fe_fÜm©
, *
size
, *
show_Ïy”s
,

94 cÚ¡ 
gch¬
 *
šput_dœeùÜy
, cÚ¡ gch¬ *
ouut_dœeùÜy
);

95 
´št_üed™s
(
gboŞ—n
 
üed™s
);

97 
gboŞ—n
 
	gdŸ_is_š‹¿ùive
 = 
FALSE
;

99 #ifdeà
GNOME


102 
	$£ssiÚ_d›
 (
gpoš‹r
 
ş›Á_d©a
)

104 
	`gtk_maš_qu™
 ();

105 
	}
}

108 
	$§ve_¡©e
 (
GnomeCl›Á
 *
ş›Á
,

109 
gšt
 
pha£
,

110 
GnomeRe¡¬tStyË
 
§ve_¡yË
,

111 
gšt
 
shutdown
,

112 
GnomeIÁ”aùStyË
 
š‹¿ù_¡yË
,

113 
gšt
 
ç¡
,

114 
gpoš‹r
 
ş›Á_d©a
)

116 
gch¬
 *
¬gv
[20];

117 
gšt
 
i
 = 0;

118 
GLi¡
 *
l
;

119 
DŸg¿m
 *
dŸ
;

121 
¬gv
[
i
++] = "dia";

123 
l
 = 
	`dŸ_İ’_dŸg¿ms
();† !ğ
NULL
;† = 
	`g_li¡_Ãxt
(l)) {

124 
dŸ
 = (
DŸg¿m
 *)
l
->
d©a
;

125 if(!
dŸ
->
un§ved
) {

126 
¬gv
[
i
++] = 
dŸ
->
f’ame
;

130 
	`gnome_ş›Á_£t_»¡¬t_commªd
 (
ş›Á
, 
i
, 
¬gv
);

131 
	`gnome_ş›Á_£t_şÚe_commªd
 (
ş›Á
, 
i
, 
¬gv
);

133  
TRUE
;

134 
	}
}

138 
	$bud_ouut_fe_Çme
(cÚ¡ *
šâame
, cÚ¡ *
fÜm©
, cÚ¡ *
outdœ
)

140 cÚ¡ *
³
 = 
	`¡¼chr
(
šâame
,'.');

141 cÚ¡ *
µ
 = 
	`¡¼chr
(
šâame
,
G_DIR_SEPARATOR
);

142 *
tmp
;

143 ià(!
µ
)

144 
µ
 = 
šâame
;

146 
µ
 += 1;

147 ià(!
³
)

148  
	`g_¡rcÚÿt
(
outdœ
 ? outdœ : "", 
µ
,".",
fÜm©
,
NULL
);

150 
tmp
 = 
	`g_m®loc0
(
	`¡¾’
(
µ
)+1+¡¾’(
fÜm©
)+1);

151 
	`memıy
(
tmp
,
µ
,
³
-pp);

152 
	`¡rÿt
(
tmp
,".");

153 
	`¡rÿt
(
tmp
,
fÜm©
);

154 ià(
outdœ
) {

155 *
»t
 = 
	`g_¡rcÚÿt
(
outdœ
, 
G_DIR_SEPARATOR_S
, 
tmp
, 
NULL
);

156 
	`g_ä“
(
tmp
);

157  
»t
;

159  
tmp
;

160 
	}
}

170 
	$show_Ïy”s_·r£_numb”s
(
DŸg¿mD©a
 *
dŸgd©a
, 
gboŞ—n
 *
visibË_Ïy”s
, 
gšt
 
n_Ïy”s
, cÚ¡ *
¡r
)

172 *
p
;

173 
low
 = 0;

174 
high
 = 
n_Ïy”s
;

175 
i
;

177 ià(
¡r
 =ğ
NULL
)

181 ià(*
¡r
 == '-') {

182 
¡r
++;

183 
low
 = 0;

184 
high
 = 
	`¡¹oul
(
¡r
, &
p
, 10)+1;

186 
	`g_as£¹
(
p
 !ğ
¡r
);

190 
low
 = 
	`¡¹oul
(
¡r
, &
p
, 10);

191 
high
 = 
low
+1;

192 
	`g_as£¹
(
p
 !ğ
¡r
);

193 ià(*
p
 == '-')

196 
¡r
 = 
p
 + 1;

197 ià(*
¡r
 == '\0')

198 
high
 = 
n_Ïy”s
;

201 
high
 = 
	`¡¹oul
(
¡r
, &
p
, 10)+1;

202 
	`g_as£¹
(
p
 !ğ
¡r
);

207 iàĞ
high
 <ğ
low
 ) {

209 
	`g_´št
(
	`_
("W¬nšg: inv®id†ay”„ªg%lu - %lu\n"), 
low
, 
high
-1 );

212 ià(
high
 > 
n_Ïy”s
)

213 
high
 = 
n_Ïy”s
;

216  
i
 = 
low
; i < 
high
; i++ )

218 
Lay”
 *
Ïy
 = (Lay” *)
	`g_±r_¬¿y_šdex
(
dŸgd©a
->
Ïy”s
, 
i
);

220 ià(
visibË_Ïy”s
[
i
] =ğ
TRUE
)

221 
	`g_´št
(
	`_
("W¬nšg: Lay” %lu (%sè£Ëùed mÜthª onû.\n"), 
i
, 
Ïy
->
Çme
);

222 
visibË_Ïy”s
[
i
] = 
TRUE
;

224 
	}
}

227 
	$show_Ïy”s_·r£_wÜd
(
DŸg¿mD©a
 *
dŸgd©a
, 
gboŞ—n
 *
visibË_Ïy”s
, 
gšt
 
n_Ïy”s
, cÚ¡ *
¡r
)

229 
GPŒA¼ay
 *
Ïy”s
 = 
dŸgd©a
->layers;

230 
gboŞ—n
 
found
 = 
FALSE
;

233 ià(
Ïy”s
) {

234 
Ën
,
k
 = 0;

235 
Lay”
 *
Ïy
;

236 *
p
;

237 
k
 = 0; k < 
Ïy”s
->
Ën
; k++) {

238 
Ïy
 = (
Lay”
 *)
	`g_±r_¬¿y_šdex
(
Ïy”s
, 
k
);

240 ià(
Ïy
->
Çme
) {

241 
Ën
 = 
	`¡¾’
(
Ïy
->
Çme
);

242 ià((
p
 = 
	`¡r¡r
(
¡r
, 
Ïy
->
Çme
)è!ğ
NULL
) {

243 ià(((
p
 =ğ
¡r
) || (p[-1] == ','))

244 && ((
p
[
Ën
] == 0) || (p[len] == ','))){

245 
found
 = 
TRUE
;

246 ià(
visibË_Ïy”s
[
k
] =ğ
TRUE
)

247 
	`g_´št
(
	`_
("W¬nšg: Lay” %d (%sè£Ëùed mÜthª onû.\n"), 
k
, 
Ïy
->
Çme
);

248 
visibË_Ïy”s
[
k
] = 
TRUE
;

255 ià(
found
 =ğ
FALSE
)

256 
	`g_´št
(
	`_
("W¬nšg: Th”i nØÏy”‚amed %s\n"), 
¡r
);

257 
	}
}

260 
	$show_Ïy”s_·r£_¡ršg
(
DŸg¿mD©a
 *
dŸgd©a
, 
gboŞ—n
 *
visibË_Ïy”s
, 
gšt
 
n_Ïy”s
, cÚ¡ *
¡r
)

262 
gch¬
 **
µ
;

263 
i
;

265 
µ
 = 
	`g_¡r¥l™
(
¡r
, ",", 100);

267 
i
 = 0; 
µ
[i]; i++) {

268 
gch¬
 *
p
 = 
µ
[
i
];

271 ià(
	`¡¾’
(
p
) == 0)

277 ià(
	`¡¾’
(
p
è!ğ
	`¡r¥n
(p, "0123456789-") )

278 
	`show_Ïy”s_·r£_wÜd
(
dŸgd©a
, 
visibË_Ïy”s
, 
n_Ïy”s
, 
p
);

280 
	`show_Ïy”s_·r£_numb”s
(
dŸgd©a
, 
visibË_Ïy”s
, 
n_Ïy”s
, 
p
);

283 
	`g_¡rä“v
(
µ
);

284 
	}
}

288 
	$hªdË_show_Ïy”s
(
DŸg¿mD©a
 *
dŸgd©a
, cÚ¡ *
show_Ïy”s
)

290 
gboŞ—n
 *
visibË_Ïy”s
;

291 
Lay”
 *
Ïy”
;

292 
i
;

294 
visibË_Ïy”s
 = 
	`g_m®loc
(
dŸgd©a
->
Ïy”s
->
Ën
 * (
gboŞ—n
));

296 
i
=0;i<
dŸgd©a
->
Ïy”s
->
Ën
;i++)

297 
visibË_Ïy”s
[
i
] = 
FALSE
;

300 
	`show_Ïy”s_·r£_¡ršg
(
dŸgd©a
, 
visibË_Ïy”s
, dŸgd©a->
Ïy”s
->
Ën
,

301 
show_Ïy”s
);

304 
i
=0;i<
dŸgd©a
->
Ïy”s
->
Ën
;i++) {

305 
Ïy”
 = 
	`g_±r_¬¿y_šdex
(
dŸgd©a
->
Ïy”s
, 
i
);

307 ià(
visibË_Ïy”s
[
i
] =ğ
TRUE
)

308 
Ïy”
->
visibË
 = 
TRUE
;

310 
Ïy”
->
visibË
 = 
FALSE
;

312 
	`g_ä“
(
visibË_Ïy”s
);

313 
	}
}

316 cÚ¡ *
	g¬gv0
 = 
NULL
;

322 
gboŞ—n


323 
	$do_cÚv”t
(cÚ¡ *
šâame
,

324 cÚ¡ *
outâame
, 
DŸExpÜtF‹r
 *
ef
,

325 cÚ¡ *
size
,

326 *
show_Ïy”s
)

328 
DŸImpÜtF‹r
 *
šf
;

329 
DŸg¿mD©a
 *
dŸgd©a
 = 
NULL
;

331 
šf
 = 
	`f‹r_guess_impÜt_f‹r
(
šâame
);

332 ià(!
šf
)

333 
šf
 = &
dŸ_impÜt_f‹r
;

335 ià(
ef
 =ğ
NULL
) {

336 
ef
 = 
	`f‹r_guess_expÜt_f‹r
(
outâame
);

337 ià(!
ef
) {

338 
	`g_ü™iÿl
(
	`_
("%sƒrror: don't know howoƒxport into %s\n"),

339 
¬gv0
,
outâame
);

340 
	`ex™
(1);

344 
dŸ_is_š‹¿ùive
 = 
FALSE
;

346 ià(0==
	`¡rcmp
(
šâame
,
outâame
)) {

347 
	`g_ü™iÿl
(
	`_
("%sƒrror: input‡nd output file‚ame is identical: %s"),

348 
¬gv0
, 
šâame
);

349 
	`ex™
(1);

352 
dŸgd©a
 = 
	`g_objeù_Ãw
 (
DIA_TYPE_DIAGRAM_DATA
, 
NULL
);

354 ià(!
šf
->
	`impÜt_func
(
šâame
,
dŸgd©a
,šf->
u£r_d©a
)) {

355 
	`g_ü™iÿl
(
	`_
("%sƒrror:‚eed valid input file %s\n"),

356 
¬gv0
, 
šâame
);

357 
	`ex™
(1);

361 ià(
show_Ïy”s
)

362 
	`hªdË_show_Ïy”s
(
dŸgd©a
, 
show_Ïy”s
);

365 
	`d©a_upd©e_ex‹Ás
(
dŸgd©a
);

371 ià(
size
) {

372 ià(
ef
 =ğ
	`f‹r_g‘_by_Çme
 ("png-libart"))

373 
ef
->
	`expÜt_func
(
dŸgd©a
, 
outâame
, 
šâame
, 
size
);

375 
	`g_w¬nšg
 ("--size…arameter unsupported for %s filter",

376 
ef
->
unique_Çme
 ?ƒf->unique_name : "selected");

377 
ef
->
	`expÜt_func
(
dŸgd©a
, 
outâame
, 
šâame
,ƒf->
u£r_d©a
);

381 
ef
->
	`expÜt_func
(
dŸgd©a
, 
outâame
, 
šâame
,ƒf->
u£r_d©a
);

382  
	`årštf
(
¡dout
,

383 
	`_
("%s --> %s\n"),

384 
šâame
,
outâame
);

385 
	`g_objeù_uÄef
(
dŸgd©a
);

386  
TRUE
;

387 
	}
}

389 
debug_b»ak
();

390 
	gdebug_b»ak_dÚt_İtimize
 = 1;

392 
	$debug_b»ak
()

394 ià(
debug_b»ak_dÚt_İtimize
 > 0)

395 
debug_b»ak_dÚt_İtimize
 -= 1;

396 
	}
}

399 
	$dump_d•’d’c›s
()

401 #ifdeà
__GNUC__


402 
	`g_´št
 ("Comp”: GCC " 
__VERSION__
 "\n");

403 #–ià
defšed
 
_MSC_VER


404 
	`g_´št
 ("Comp”: MSC %d\n", 
_MSC_VER
);

406 
	`g_´št
 ("Compiler: unknown\n");

409 
	`g_´št
 (" with : "

410 #ifdeà
G_THREADS_ENABLED


413 #ifdeà
HAVE_CAIRO


416 #ifdeà
GNOME


419 #ifdeà
HAVE_GNOMEPRINT


422 #ifdeà
HAVE_LIBART


425 #ifdeà
HAVE_PANGOCAIRO


434 
	`g_´št
 ("Library versions (at compileime)\n");

435 #ifdeà
HAVE_LIBPNG


436 
	`g_´št
 ("lib²g : % (%s)\n", 
	`²g_g‘_h—d”_v”
(
NULL
), 
PNG_LIBPNG_VER_STRING
);

438 #ifdeà
HAVE_FREETYPE


440 
FT_Lib¿ry
 
á_lib¿ry
;

441 
FT_IÁ
 
á_majÜ_v”siÚ
;

442 
FT_IÁ
 
á_mšÜ_v”siÚ
;

443 
FT_IÁ
 
á_miüo_v”siÚ
;

445 ià(
	`FT_In™_F»eTy³
 (&
á_lib¿ry
) == 0) {

446 
	`FT_Lib¿ry_V”siÚ
 (
á_lib¿ry
,

447 &
á_majÜ_v”siÚ
,

448 &
á_mšÜ_v”siÚ
,

449 &
á_miüo_v”siÚ
);

451 
	`g_´št
 ("ä“ty³: %d.%d.%d\n", 
á_majÜ_v”siÚ
, 
á_mšÜ_v”siÚ
, 
á_miüo_v”siÚ
);

452 
	`FT_DÚe_F»eTy³
 (
á_lib¿ry
);

455 
	`g_´št
 ("freetype: ?.?.?\n");

459 cÚ¡ 
gch¬
* 
libxml_¹_v”siÚ
 = "?";

467 
	`xmlIn™P¬£r
();

468 ià(
	`xmlG‘Glob®S‹
())

469 
libxml_¹_v”siÚ
 = 
	`xmlG‘Glob®S‹
()->
xmlP¬£rV”siÚ
;

471 
libxml_¹_v”siÚ
 = 
xmlP¬£rV”siÚ
;

472 ià(
	`©oi
(
libxml_¹_v”siÚ
))

473 
	`g_´št
 ("libxml : %d.%d.%d (%s)\n",

474 
	`©oi
(
libxml_¹_v”siÚ
) / 10000,‡toi(libxml_rt_version) / 100 % 100,‡toi(libxml_rt_version) % 100,

475 
LIBXML_DOTTED_VERSION
);

477 
	`g_´št
 ("libxmÈ : % (%s)\n", 
libxml_¹_v”siÚ
 ?†ibxml_¹_v”siÚ : "??", 
LIBXML_DOTTED_VERSION
);

479 
	`g_´št
 ("glib : %d.%d.%d (%d.%d.%d)\n",

480 
glib_majÜ_v”siÚ
, 
glib_mšÜ_v”siÚ
, 
glib_miüo_v”siÚ
,

481 
GLIB_MAJOR_VERSION
, 
GLIB_MINOR_VERSION
, 
GLIB_MICRO_VERSION
);

482 #ifdeà
PANGO_VERSION_ENCODE


483 
	`g_´št
 ("·ngØ : % (%d.%d.%d)\n", 
	`·ngo_v”siÚ_¡ršg
(), 
PANGO_VERSION_MAJOR
, 
PANGO_VERSION_MINOR
, 
PANGO_VERSION_MICRO
);

485 
	`g_´št
 ("pango : version‚ot‡vailable (>= 1.14.x)\n");

487 #ià
HAVE_CAIRO


488 #ifdeà
CAIRO_VERSION_STRING


489 
	`g_´št
 ("ÿœØ : % (%s)\n", 
	`ÿœo_v”siÚ_¡ršg
(), 
CAIRO_VERSION_STRING
);

491 
	`g_´št
 ("ÿœØ : % (%d.%d.%d)\n", 
	`ÿœo_v”siÚ_¡ršg
(), 
CAIRO_VERSION_MAJOR
, 
CAIRO_VERSION_MINOR
, 
CAIRO_VERSION_MICRO
);

496 
gch¬
 
lškedÇme
[1024];

497 
gšt
 
Ën
 = 0;

500 ià((
Ën
 = 
	`»adlšk
 (
PREFIX
 "/lib/lib·ngo-1.0.so", 
lškedÇme
, 1023)) > 0) {

502 
lškedÇme
[
Ën
] = '\0';

503 
	`g_´št
 ("%s/%s\n", 
PREFIX
, 
lškedÇme
);

507 
	`g_´št
 ("gtk+ : %d.%d.%d (%d.%d.%d)\n",

508 
gtk_majÜ_v”siÚ
, 
gtk_mšÜ_v”siÚ
, 
gtk_miüo_v”siÚ
,

509 
GTK_MAJOR_VERSION
, 
GTK_MINOR_VERSION
, 
GTK_MICRO_VERSION
);

514 
	`g_´št
 ("gnome : %d.%d.%d (%d.%d.%d)\n"

515 
gnome_majÜ_v”siÚ
, 
gnome_mšÜ_v”siÚ
, 
gnome_miüo_v”siÚ
,

516 
GNOME_MAJOR_VERSION
, 
GNOME_MINOR_VERSION
, 
GNOME_MICRO_VERSION
);

518 
	}
}

520 
gboŞ—n


521 
	$­p_is_š‹¿ùive
()

523  
dŸ_is_š‹¿ùive
;

524 
	}
}

532 
gboŞ—n


533 
	$hªdË_š™Ÿl_dŸg¿m
(cÚ¡ *
š_fe_Çme
,

534 cÚ¡ *
out_fe_Çme
,

535 cÚ¡ *
expÜt_fe_fÜm©
,

536 cÚ¡ *
size
,

537 * 
show_Ïy”s
,

538 cÚ¡ *
outdœ
) {

539 
DDi¥Ïy
 *
ddi¥
 = 
NULL
;

540 
DŸg¿m
 *
dŸg¿m
 = 
NULL
;

541 
gboŞ—n
 
made_cÚv”siÚs
 = 
FALSE
;

543 ià(
expÜt_fe_fÜm©
) {

544 *
expÜt_fe_Çme
 = 
NULL
;

545 
DŸExpÜtF‹r
 *
ef
 = 
NULL
;

548 
expÜt_fe_Çme
 = 
	`bud_ouut_fe_Çme
(
š_fe_Çme
, 
expÜt_fe_fÜm©
, 
outdœ
);

551 iàĞ
size
 && 
	`¡rcmp
(
expÜt_fe_fÜm©
, "png") == 0)

552 
ef
 = 
	`f‹r_g‘_by_Çme
 ("png-libart");

553 ià(!
ef
)

554 
ef
 = 
	`f‹r_guess_expÜt_f‹r
(
expÜt_fe_Çme
);

555 ià(
ef
 =ğ
NULL
) {

556 
ef
 = 
	`f‹r_g‘_by_Çme
(
expÜt_fe_fÜm©
);

557 ià(
ef
 =ğ
NULL
) {

558 
	`g_ü™iÿl
(
	`_
("Cª'ˆfšd ouuˆfÜm©/f‹¸%s\n"), 
expÜt_fe_fÜm©
);

559  
FALSE
;

561 
	`g_ä“
 (
expÜt_fe_Çme
);

562 
expÜt_fe_Çme
 = 
	`bud_ouut_fe_Çme
(
š_fe_Çme
, 
ef
->
ex‹nsiÚs
[0], 
outdœ
);

564 
made_cÚv”siÚs
 |ğ
	`do_cÚv”t
(
š_fe_Çme
,

565 (
out_fe_Çme
 !ğ
NULL
?out_fe_Çme:
expÜt_fe_Çme
),

566 
ef
, 
size
, 
show_Ïy”s
);

567 
	`g_ä“
(
expÜt_fe_Çme
);

568 } ià(
out_fe_Çme
) {

569 
DŸExpÜtF‹r
 *
ef
 = 
NULL
;

572 ià(
size
 && 
	`¡r¡r
(
out_fe_Çme
, ".png"))

573 
ef
 = 
	`f‹r_g‘_by_Çme
 ("png-libart");

575 
made_cÚv”siÚs
 |ğ
	`do_cÚv”t
(
š_fe_Çme
, 
out_fe_Çme
, 
ef
,

576 
size
, 
show_Ïy”s
);

578 ià(
	`g_fe_‹¡
(
š_fe_Çme
, 
G_FILE_TEST_EXISTS
)) {

579 
dŸg¿m
 = 
	`dŸg¿m_lßd
 (
š_fe_Çme
, 
NULL
);

581 
dŸg¿m
 = 
	`Ãw_dŸg¿m
 (
š_fe_Çme
);

584 ià(
dŸg¿m
 !ğ
NULL
) {

585 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸg¿m
);

586 ià(
	`­p_is_š‹¿ùive
()) {

587 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸg¿m
);

589 
ddi¥
 = 
	`Ãw_di¥Ïy
(
dŸg¿m
);

591 
	`g_objeù_uÄef
(
dŸg¿m
);

595  
made_cÚv”siÚs
;

596 
	}
}

598 #ifdeà
HAVE_FREETYPE


600 
	#EPS_PANGO
 "•s-·ngo, "

	)

602 
	#EPS_PANGO
 ""

	)

605 #ifdeà
G_OS_WIN32


607 
	#WMF
 "wmf, "

	)

609 
	#WMF
 ""

	)

612 cÚ¡ 
gch¬
 *
	gšput_dœeùÜy
 = 
NULL
;

613 cÚ¡ 
gch¬
 *
	gouut_dœeùÜy
 = 
NULL
;

615 
gboŞ—n


616 
	$_check_İtiÚ_šput_dœeùÜy
 (cÚ¡ 
gch¬
 *
İtiÚ_Çme
,

617 cÚ¡ 
gch¬
 *
v®ue
,

618 
gpoš‹r
 
d©a
,

619 
GE¼Ü
 **
”rÜ
)

621 
gch¬
 *
dœeùÜy
 = 
	`g_f’ame_äom_utf8
 (
v®ue
, -1, 
NULL
, NULL, NULL);

623 ià(
	`g_fe_‹¡
 (
dœeùÜy
, 
G_FILE_TEST_IS_DIR
)) {

624 
šput_dœeùÜy
 = 
dœeùÜy
;

625  
TRUE
;

627 
	`g_£t_”rÜ
 (
”rÜ
, 
DIA_ERROR
, 
DIA_ERROR_DIRECTORY
,

628 
	`_
("IÅut-dœeùÜy '%s' mu¡ƒxi¡!\n"), 
dœeùÜy
);

629 
	`g_ä“
 (
dœeùÜy
);

630  
FALSE
;

631 
	}
}

632 
gboŞ—n


633 
	$_check_İtiÚ_ouut_dœeùÜy
 (cÚ¡ 
gch¬
 *
İtiÚ_Çme
,

634 cÚ¡ 
gch¬
 *
v®ue
,

635 
gpoš‹r
 
d©a
,

636 
GE¼Ü
 **
”rÜ
)

638 
gch¬
 *
dœeùÜy
 = 
	`g_f’ame_äom_utf8
 (
v®ue
, -1, 
NULL
, NULL, NULL);

640 ià(
	`g_fe_‹¡
 (
dœeùÜy
, 
G_FILE_TEST_IS_DIR
)) {

641 
ouut_dœeùÜy
 = 
dœeùÜy
;

642  
TRUE
;

644 
	`g_£t_”rÜ
 (
”rÜ
, 
DIA_ERROR
, 
DIA_ERROR_DIRECTORY
,

645 
	`_
("Ouut-dœeùÜy '%s' mu¡ƒxi¡!\n"), 
dœeùÜy
);

646 
	`g_ä“
 (
dœeùÜy
);

647  
FALSE
;

648 
	}
}

651 
	$_£tup_‹xtdomašs
 ()

653 #ifdeà
G_OS_WIN32


656 
gch¬
* 
loÿËdœ
 = 
	`dŸ_g‘_lib_dœeùÜy
 ("locale");

658 
	`bšd‹xtdomaš
(
GETTEXT_PACKAGE
, 
loÿËdœ
);

659 
	`g_ä“
 (
loÿËdœ
);

662 cÚ¡ 
gch¬
 *
loÿËdœ
;

664 
loÿËdœ
 = 
	`g_g‘’v
("DIA_LOCALE_PATH");

665 if(
loÿËdœ
 !ğ
NULL
) {

666 
	`bšd‹xtdomaš
(
GETTEXT_PACKAGE
, 
loÿËdœ
);

668 
	`bšd‹xtdomaš
(
GETTEXT_PACKAGE
, 
LOCALEDIR
);

672 #ià
defšed
 
ENABLE_NLS
 && defšed 
HAVE_BIND_TEXTDOMAIN_CODESET


673 
	`bšd_‹xtdomaš_code£t
(
GETTEXT_PACKAGE
,"UTF-8");

675 
	`‹xtdomaš
(
GETTEXT_PACKAGE
);

676 
	}
}

679 
	$­p_š™
 (
¬gc
, **
¬gv
)

681 
gboŞ—n
 
no¥Ïsh
 = 
FALSE
;

682 
gboŞ—n
 
nÚew
 = 
FALSE
;

683 
gboŞ—n
 
u£_š‹g¿‹d_ui
 = 
TRUE
;

684 
gboŞ—n
 
üed™s
 = 
FALSE
;

685 
gboŞ—n
 
v”siÚ
 = 
FALSE
;

686 
gboŞ—n
 
v”bo£
 = 
FALSE
;

687 
gboŞ—n
 
log_to_¡d”r
 = 
FALSE
;

688 #ifdeà
GNOME


689 
GnomeCl›Á
 *
ş›Á
;

691 *
expÜt_fe_Çme
 = 
NULL
;

692 *
expÜt_fe_fÜm©
 = 
NULL
;

693 *
size
 = 
NULL
;

694 *
show_Ïy”s
 = 
NULL
;

695 
gboŞ—n
 
made_cÚv”siÚs
 = 
FALSE
;

696 
GSLi¡
 *
fes
 = 
NULL
;

697 cÚ¡ 
gch¬
 **
f’ames
 = 
NULL
;

698 
i
 = 0;

700 
gch¬
 *
expÜt_fÜm©_¡ršg
 =

702 
	`g_¡rdup_´štf
(
	`_
("Selecthe filter/format out of: %s"),

703 "cgm, dŸ, dxf,ƒps,ƒps-butš, " 
EPS_PANGO


705 #ià
	`defšed
(
HAVE_LIBPNG
è&& defšed(
HAVE_LIBART
)

708 #ifdeà
HAVE_CAIRO


713 "sh­e, svg,ex (pgf-‹x,…¡ricks-‹x), " 
WMF


716 
GO±iÚCÚ‹xt
 *
cÚ‹xt
 = 
NULL
;

717 
GO±iÚEÁry
 
İtiÚs
[] =

719 {"expÜt", 'e', 0, 
G_OPTION_ARG_FILENAME
, 
NULL
 ,

720 
	`N_
("Export†oaded file‡ndƒxit"), N_("OUTPUT")},

721 {"f‹r",'t', 0, 
G_OPTION_ARG_STRING
, 
NULL
 ,

722 
NULL
 , 
	`N_
("TYPE") },

723 {"size", 's', 0, 
G_OPTION_ARG_STRING
, 
NULL
,

724 
	`N_
("Export graphics size"), N_("WxH")},

725 {"show-Ïy”s", 'L', 0, 
G_OPTION_ARG_STRING
, 
NULL
,

726 
	`N_
("Show only specified†ayers (e.g. whenƒxporting). Can beƒitherhe†ayer‚ame or‡„ange of†ayer‚umbers (X-Y)"),

727 
	`N_
("LAYER,LAYER,...")},

728 {"no¥Ïsh", 'n', 0, 
G_OPTION_ARG_NONE
, &
no¥Ïsh
,

729 
	`N_
("DÚ'ˆshowh¥Ïsh sü“n"), 
NULL
 },

730 {"nÚew", 'n', 0, 
G_OPTION_ARG_NONE
, &
nÚew
,

731 
	`N_
("DÚ'ˆü—‹ƒm±y dŸg¿m"), 
NULL
 },

732 {"š‹g¿‹d", '\0', 0, 
G_OPTION_ARG_NONE
, &
u£_š‹g¿‹d_ui
,

733 
	`N_
("S¹ iÁeg¿‹d u£¸š‹rçû (dŸg¿m šabs)"), 
NULL
 },

734 {"log-to-¡d”r", 'l', 0, 
G_OPTION_ARG_NONE
, &
log_to_¡d”r
,

735 
	`N_
("S’dƒ¼Ü mes§ge tØ¡d”¸š¡—d oàshowšg dŸlogs."), 
NULL
 },

736 {"šput-dœeùÜy", 'I', 0, 
G_OPTION_ARG_CALLBACK
, 
_check_İtiÚ_šput_dœeùÜy
,

737 
	`N_
("Directory containing input files"), N_("DIRECTORY")},

738 {"ouut-dœeùÜy", 'O', 0, 
G_OPTION_ARG_CALLBACK
, 
_check_İtiÚ_ouut_dœeùÜy
,

739 
	`N_
("Directory containing output files"), N_("DIRECTORY")},

740 {"üed™s", 'c', 0, 
G_OPTION_ARG_NONE
, &
üed™s
,

741 
	`N_
("Di¥Ïy c»d™ li¡‡ndƒx™"), 
NULL
 },

742 {"v”bo£", 0, 0, 
G_OPTION_ARG_NONE
, &
v”bo£
,

743 
	`N_
("G’”©v”bo£ ouut"), 
NULL
 },

744 {"v”siÚ", 'v', 0, 
G_OPTION_ARG_NONE
, &
v”siÚ
,

745 
	`N_
("Di¥Ïy v”siÚ‡ndƒx™"), 
NULL
 },

746 { 
G_OPTION_REMAINING
, 0, 0, 
G_OPTION_ARG_FILENAME_ARRAY
, 
NULL
 ,

747 
NULL
, NULL },

748 { 
NULL
 }

752 
dŸ_is_š‹¿ùive
 = 
TRUE
;

754 
İtiÚs
[0].
¬g_d©a
 = &
expÜt_fe_Çme
;

755 
İtiÚs
[1].
¬g_d©a
 = &
expÜt_fe_fÜm©
;

756 
İtiÚs
[1].
desütiÚ
 = 
expÜt_fÜm©_¡ršg
;

757 
İtiÚs
[2].
¬g_d©a
 = &
size
;

758 
İtiÚs
[3].
¬g_d©a
 = &
show_Ïy”s
;

759 
	`g_as£¹
 (
	`¡rcmp
 (
İtiÚs
[13].
lÚg_Çme
, 
G_OPTION_REMAINING
) == 0);

760 
İtiÚs
[13].
¬g_d©a
 = (*)&
f’ames
;

762 
¬gv0
 = (
¬gc
 > 0è? 
¬gv
[0] : "(none)";

764 
	`gtk_£t_loÿË
();

765 
	`£oÿË
(
LC_NUMERIC
, "C");

766 
	`_£tup_‹xtdomašs
 ();

768 
cÚ‹xt
 = 
	`g_İtiÚ_cÚ‹xt_Ãw
(
	`_
("[FILE...]"));

769 
	`g_İtiÚ_cÚ‹xt_add_maš_’Œ›s
 (
cÚ‹xt
, 
İtiÚs
, 
GETTEXT_PACKAGE
);

770 
	`g_İtiÚ_cÚ‹xt_add_group
 (
cÚ‹xt
, 
	`gtk_g‘_İtiÚ_group
 (
FALSE
));

772 ià(
¬gv
) {

773 
GE¼Ü
 *
”rÜ
 = 
NULL
;

775 ià(!
	`g_İtiÚ_cÚ‹xt_·r£
 (
cÚ‹xt
, &
¬gc
, &
¬gv
, &
”rÜ
)) {

776 ià(
”rÜ
) {

777 
	`g_´št
 ("%s", 
”rÜ
->
mes§ge
);

778 
	`g_”rÜ_ä“
 (
”rÜ
);

780 
	`g_´št
 (
	`_
("Invalid option?"));

783 
	`g_İtiÚ_cÚ‹xt_ä“
(
cÚ‹xt
);

784 
	`ex™
(1);

787 ià(
f’ames
) {

788 
f’ames
[
i
] !ğ
NULL
) {

789 
gch¬
 *
f’ame
;

790 
gch¬
 *
‹¡·th
;

792 ià(
	`g_¡r_has_´efix
 (
f’ames
[
i
], "file://")) {

793 
f’ame
 = 
	`g_f’ame_äom_uri
 (
f’ames
[
i
], 
NULL
, NULL);

794 ià(!
	`g_utf8_v®id©e
(
f’ame
, -1, 
NULL
)) {

795 
gch¬
 *
tâ
 = 
f’ame
;

796 
f’ame
 = 
	`g_f’ame_to_utf8
(f’ame, -1, 
NULL
, NULL, NULL);

797 
	`g_ä“
(
tâ
);

800 
f’ame
 = 
	`g_f’ame_to_utf8
 (
f’ames
[
i
], -1, 
NULL
, NULL, NULL);

802 ià(!
f’ame
) {

803 
	`g_´št
 (
	`_
("F’amcÚv”siÚ faed: %s\n"), 
f’ames
[
i
]);

807 ià(
	`g_·th_is_absŞu‹
(
f’ame
))

808 
‹¡·th
 = 
f’ame
;

810 
‹¡·th
 = 
	`g_bud_f’ame
(
šput_dœeùÜy
 ? iÅut_dœeùÜy : ".", 
f’ame
, 
NULL
);

813 ià(
	`g_fe_‹¡
 (
‹¡·th
, 
G_FILE_TEST_IS_REGULAR
))

814 
fes
 = 
	`g_¦i¡_­³nd
(fes, 
f’ame
);

816 
	`g_´št
 (
	`_
("Missšg iÅut: %s\n"), 
f’ame
);

817 
	`g_ä“
 (
f’ame
);

819 ià(
f’ame
 !ğ
‹¡·th
)

820 
	`g_ä“
 (
‹¡·th
);

821 ++
i
;

825 ià(
expÜt_fe_Çme
 || 
expÜt_fe_fÜm©
 || 
size
)

826 
dŸ_is_š‹¿ùive
 = 
FALSE
;

830 ià(
¬gv
 && 
dŸ_is_š‹¿ùive
 && !
v”siÚ
) {

831 #ifdeà
GNOME


832 
GnomeProg¿m
 *
´og¿m
 =

833 
	`gnome_´og¿m_š™
 (
PACKAGE
, 
VERSION
, 
LIBGNOMEUI_MODULE
,

834 
¬gc
, 
¬gv
,

836 
GNOME_PARAM_GOPTION_CONTEXT
, 
cÚ‹xt
,

837 
GNOME_PROGRAM_STANDARD_PROPERTIES
,

838 
GNOME_PARAM_NONE
);

839 
ş›Á
 = 
	`gnome_ma¡”_ş›Á
();

840 if(
ş›Á
 =ğ
NULL
) {

841 
	`g_w¬nšg
(
	`_
("Can't connecto session manager!\n"));

844 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
 (
ş›Á
), "save_yourself",

845 
	`G_CALLBACK
 (
§ve_¡©e
), 
NULL
);

846 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
 (
ş›Á
), "die",

847 
	`G_CALLBACK
 (
£ssiÚ_d›
), 
NULL
);

854 #ifdeà
G_THREADS_ENABLED


855 
	`g_th»ad_š™
 (
NULL
);

857 
	`gtk_š™
(&
¬gc
, &
¬gv
);

861 #ifdeà
G_THREADS_ENABLED


862 
	`g_th»ad_š™
 (
NULL
);

864 
	`g_ty³_š™
();

865 #ifdeà
GDK_WINDOWING_WIN32


871 
	`gtk_š™
(&
¬gc
, &
¬gv
);

876 
	`g_ä“
(
expÜt_fÜm©_¡ršg
);

878 ià(
v”siÚ
) {

879 #ià(
defšed
 
__TIME__
è&& (defšed 
__DATE__
)

881 
	`´štf
(
	`g_loÿË_äom_utf8
(
	`_
("DŸ v”siÚ %s, comped % %s\n"), -1, 
NULL
, NULL, NULL), 
VERSION
, 
__TIME__
, 
__DATE__
);

883 
	`´štf
(
	`g_loÿË_äom_utf8
(
	`_
("DŸ v”siÚ %s\n"), -1, 
NULL
, NULL, NULL), 
VERSION
);

885 ià(
v”bo£
)

886 
	`dump_d•’d’c›s
();

887 
	`ex™
(0);

890 ià(!
dŸ_is_š‹¿ùive
)

891 
log_to_¡d”r
 = 
TRUE
;

893 
	`libdŸ_š™
 ( (
dŸ_is_š‹¿ùive
 ? 
DIA_INTERACTIVE
 : 0)

894 | (
log_to_¡d”r
 ? 
DIA_MESSAGE_STDERR
 : 0)

895 | (
v”bo£
 ? 
DIA_VERBOSE
 : 0) );

898 
	`´št_üed™s
(
üed™s
);

900 ià(
dŸ_is_š‹¿ùive
) {

901 
	`ü—‹_u£r_dœs
();

903 ià(!
no¥Ïsh
)

904 
	`­p_¥Ïsh_š™
("");

907 
deçuÉ_cursÜ
 = 
	`gdk_cursÜ_Ãw
(
GDK_LEFT_PTR
);

908 
	`ddi¥Ïy_£t_®l_cursÜ
(
deçuÉ_cursÜ
);

911 
	`dŸ_»gi¡”_¶ugšs
();

912 
	`dŸ_»gi¡”_butš_¶ugš
(
š‹º®_¶ugš_š™
);

914 
	`lßd_®l_sh“ts
();

916 
	`dŸ_log_mes§ge
 ("object defaults");

917 
	`dŸ_objeù_deçuÉs_lßd
 (
NULL
, 
TRUE
 );

921 ià(
	`objeù_g‘_ty³
("Snd¬d - Lše"è=ğ
NULL
) {

922 
	`mes§ge_”rÜ
(
	`_
("Couldn't find standard objects when†ooking for "

924 
	`g_ü™iÿl
Ğ
	`_
("Couldn't find standard objects when†ooking for "

925 "objeù-lib š '%s';ƒx™šg...\n"), 
	`dŸ_g‘_lib_dœeùÜy
("dia"));

926 
	`ex™
(1);

929 
	`³rsi¡’û_lßd
();

932 
	`´efs_š™
();

934 ià(
dŸ_is_š‹¿ùive
) {

937 
aùive_toŞ
 = 
	`ü—‹_modify_toŞ
();

939 
	`dŸ_log_mes§ge
 ("ui creation");

940 ià(
u£_š‹g¿‹d_ui
) {

941 
	`ü—‹_š‹g¿‹d_ui
();

943 
	`ü—‹_toŞbox
();

945 
	`³rsi¡’û_»gi¡”_wšdow_ü—‹
("layer_window",

946 (
NuÎ¬yFunc
*)&
ü—‹_Ïy”_dŸlog
);

950 
	`»ûÁ_fe_hi¡Üy_š™
();

953 #ià
	`GLIB_CHECK_VERSION
(2,14,0)

954 
	`g_timeout_add_£cÚds
(5*60, 
auto§ve_check_auto§ve
, 
NULL
);

956 
	`g_timeout_add
(5*60*1000, 
auto§ve_check_auto§ve
, 
NULL
);

960 
	`ü—‹_Œ“_wšdow
();

962 
	`³rsi¡’û_»gi¡”_wšdow_ü—‹
("sheets_main_dialog",

963 (
NuÎ¬yFunc
*)&
sh“ts_dŸlog_ü—‹
);

970 
	`dŸ_log_mes§ge
 ("diagrams");

971 
made_cÚv”siÚs
 = 
	`hªdË_®l_dŸg¿ms
(
fes
, 
expÜt_fe_Çme
,

972 
expÜt_fe_fÜm©
, 
size
, 
show_Ïy”s
,

973 
šput_dœeùÜy
, 
ouut_dœeùÜy
);

975 ià(
dŸ_is_š‹¿ùive
 && 
fes
 =ğ
NULL
 && !
nÚew
) {

976 ià(
u£_š‹g¿‹d_ui
)

978 
GLi¡
 * 
li¡
;

980 
	`fe_Ãw_ÿÎback
(
NULL
);

981 
li¡
 = 
	`dŸ_İ’_dŸg¿ms
();

982 ià(
li¡
)

984 
DŸg¿m
 * 
dŸg¿m
 = 
li¡
->
d©a
;

985 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸg¿m
);

986 
dŸg¿m
->
is_deçuÉ
 = 
TRUE
;

991 
gch¬
 *
f’ame
 = 
	`g_f’ame_äom_utf8
(
	`_
("DŸg¿m1.dŸ"), -1, 
NULL
, NULL, NULL);

992 
DŸg¿m
 *
dŸg¿m
 = 
	`Ãw_dŸg¿m
 (
f’ame
);

993 
	`g_ä“
(
f’ame
);

995 ià(
dŸg¿m
 !ğ
NULL
) {

996 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸg¿m
);

997 
dŸg¿m
->
is_deçuÉ
 = 
TRUE
;

1000 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸg¿m
);

1001 
	`Ãw_di¥Ïy
(
dŸg¿m
);

1005 
	`g_¦i¡_ä“
(
fes
);

1006 ià(
made_cÚv”siÚs
è
	`ex™
(0);

1009 
	`dŸ_log_mes§ge
 ("initialized");

1010 
	}
}

1012 
gboŞ—n


1013 
	$­p_ex™
()

1015 
GLi¡
 *
li¡
;

1016 
GSLi¡
 *
¦i¡
;

1023 
gboŞ—n
 
­p_ex™_Úû
 = 
FALSE
;

1025 ià(
­p_ex™_Úû
) {

1026 
	`g_”rÜ
(
	`_
("This shouldn't happen. Please file‡ bug„eport‡t bugzilla.gnome.org\n"

1028  
FALSE
;

1031 ià(
	`dŸg¿m_modif›d_exi¡s
()) {

1032 ià(
	`is_š‹g¿‹d_ui
 ())

1034 
GtkWidg‘
 *
dŸlog
;

1035 
»suÉ
;

1036 
ex™_dŸlog_™em_¬¿y_t
 *
™ems
 = 
NULL
;

1037 
GLi¡
 * 
li¡
;

1038 
DŸg¿m
 * 
dŸg¿m
;

1040 
dŸlog
 = 
	`ex™_dŸlog_make
 (
	`GTK_WINDOW
 (
	`š‹rçû_g‘_toŞbox_sh–l
 ()),

1041 
	`_
("Exiting Dia"));

1043 
li¡
 = 
	`dŸ_İ’_dŸg¿ms
();

1044 
li¡
)

1046 
dŸg¿m
 = 
li¡
->
d©a
;

1048 ià(
	`dŸg¿m_is_modif›d
 (
dŸg¿m
))

1050 cÚ¡ 
gch¬
 * 
Çme
 = 
	`dŸg¿m_g‘_Çme
 (
dŸg¿m
);

1051 cÚ¡ 
gch¬
 * 
·th
 = 
dŸg¿m
->
f’ame
;

1052 
	`ex™_dŸlog_add_™em
 (
dŸlog
, 
Çme
, 
·th
, 
dŸg¿m
);

1055 
li¡
 = 
	`g_li¡_Ãxt
 (list);

1058 
»suÉ
 = 
	`ex™_dŸlog_run
 (
dŸlog
, &
™ems
);

1060 
	`gtk_widg‘_de¡roy
 (
dŸlog
);

1062 ià(
»suÉ
 =ğ
EXIT_DIALOG_EXIT_CANCEL
)

1064  
FALSE
;

1066 ià(
»suÉ
 =ğ
EXIT_DIALOG_EXIT_SAVE_SELECTED
)

1068 
i
;

1069 
i
 = 0 ; i < 
™ems
->
¬¿y_size
 ; i++)

1071 
gch¬
 *
f’ame
;

1073 
dŸg¿m
 = 
™ems
->
¬¿y
[
i
].
d©a
;

1074 
f’ame
 = 
	`g_f’ame_äom_utf8
 (
dŸg¿m
->f’ame, -1, 
NULL
, NULL, NULL);

1075 
	`dŸg¿m_upd©e_ex‹Ás
 (
dŸg¿m
);

1076 ià(!
	`dŸg¿m_§ve
 (
dŸg¿m
, 
f’ame
)) {

1077 
	`ex™_dŸlog_ä“_™ems
 (
™ems
);

1078  
FALSE
;

1080 
	`g_ä“
 (
f’ame
);

1082 
	`ex™_dŸlog_ä“_™ems
 (
™ems
);

1084 ià(
»suÉ
 =ğ
EXIT_DIALOG_EXIT_NO_SAVE
)

1086 
li¡
 = 
	`dŸ_İ’_dŸg¿ms
();

1087 
li¡
) {

1088 
dŸg¿m
 = 
li¡
->
d©a
;

1091 
	`dŸg¿m_£t_modif›d
 (
dŸg¿m
, 
FALSE
);

1092 
	`undo_ş—r
(
dŸg¿m
->
undo
);

1093 
li¡
 = 
	`g_li¡_Ãxt
 (list);

1099 
GtkWidg‘
 *
dŸlog
;

1100 
GtkWidg‘
 *
bu‰Ú
;

1101 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
(

1102 
NULL
, 
GTK_DIALOG_MODAL
,

1103 
GTK_MESSAGE_QUESTION
,

1104 
GTK_BUTTONS_NONE
,

1105 
	`_
("Quitting without saving modified diagrams"));

1106 
	`gtk_mes§ge_dŸlog_fÜm©_£cÚd¬y_‹xt
(
	`GTK_MESSAGE_DIALOG
(
dŸlog
),

1107 
	`_
("Modified diagramsƒxist. "

1111 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
(
dŸlog
), 
	`_
("Quit Dia"));

1113 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_CANCEL
);

1114 
	`gtk_dŸlog_add_aùiÚ_widg‘
 (
	`GTK_DIALOG
(
dŸlog
), 
bu‰Ú
, 
GTK_RESPONSE_CANCEL
);

1115 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú
, 
GTK_CAN_DEFAULT
);

1116 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
dŸlog
), 
GTK_RESPONSE_CANCEL
);

1118 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_QUIT
);

1119 
	`gtk_dŸlog_add_aùiÚ_widg‘
 (
	`GTK_DIALOG
(
dŸlog
), 
bu‰Ú
, 
GTK_RESPONSE_OK
);

1121 
	`gtk_widg‘_show_®l
 (
dŸlog
);

1123 ià(
	`gtk_dŸlog_run
(
	`GTK_DIALOG
(
dŸlog
)è!ğ
GTK_RESPONSE_OK
) {

1124 
	`gtk_widg‘_de¡roy
(
dŸlog
);

1125  
FALSE
;

1127 
	`gtk_widg‘_de¡roy
(
dŸlog
);

1130 
	`´efs_§ve
();

1132 
	`³rsi¡’û_§ve
();

1134 
	`dynobj_»äesh_fšish
();

1136 
	`dŸ_objeù_deçuÉs_§ve
 (
NULL
);

1140 
li¡
 = 
	`dŸ_İ’_dŸg¿ms
();

1141 
li¡
!=
NULL
) {

1142 
DŸg¿m
 *
dŸ
 = (DŸg¿m *)
li¡
->
d©a
;

1143 
li¡
 = 
	`g_li¡_Ãxt
(list);

1145 
¦i¡
 = 
dŸ
->
di¥Ïys
;

1146 
¦i¡
!=
NULL
) {

1147 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
¦i¡
->
d©a
;

1148 
¦i¡
 = 
	`g_¦i¡_Ãxt
(slist);

1150 
	`gtk_widg‘_de¡roy
(
ddi¥
->
sh–l
);

1156 ià(
dŸ_is_š‹¿ùive
)

1157 
	`dŸ_¶ugšrc_wr™e
();

1159 
	`gtk_maš_qu™
();

1165 
­p_ex™_Úû
 = 
TRUE
;

1167  
TRUE
;

1168 
	}
}

1170 
	$ü—‹_u£r_dœs
()

1172 
gch¬
 *
dœ
, *
subdœ
;

1174 #ifdeà
G_OS_WIN32


1178 ià(!
	`g_g‘_home_dœ
())

1180 
	`g_w¬nšg
(
	`_
("Could‚ot create…er-user Dia config directory"));

1184 
dœ
 = 
	`g_¡rcÚÿt
(
	`g_g‘_home_dœ
(), 
G_DIR_SEPARATOR_S
 ".dŸ", 
NULL
);

1185 ià(
	`g_mkdœ
(
dœ
, 0755è&& 
”ºo
 !ğ
EEXIST
) {

1186 #iâdeà
G_OS_WIN32


1187 
	`g_ü™iÿl
(
	`_
("Could‚ot create…er-user Dia config directory"));

1188 
	`ex™
(1);

1190 
	`g_w¬nšg
(
	`_
("Could‚ot create…er-user Dia config directory. Please make "

1196 
subdœ
 = 
	`g_¡rcÚÿt
(
dœ
, 
G_DIR_SEPARATOR_S
 "objeùs", 
NULL
);

1197 
	`g_mkdœ
(
subdœ
, 0755);

1198 
	`g_ä“
(
subdœ
);

1199 
subdœ
 = 
	`g_¡rcÚÿt
(
dœ
, 
G_DIR_SEPARATOR_S
 "sh­es", 
NULL
);

1200 
	`g_mkdœ
(
subdœ
, 0755);

1201 
	`g_ä“
(
subdœ
);

1202 
subdœ
 = 
	`g_¡rcÚÿt
(
dœ
, 
G_DIR_SEPARATOR_S
 "sh“ts", 
NULL
);

1203 
	`g_mkdœ
(
subdœ
, 0755);

1204 
	`g_ä“
(
subdœ
);

1205 
	`g_ä“
(
dœ
);

1206 
	}
}

1208 
PlugšIn™ResuÉ


1209 
	$š‹º®_¶ugš_š™
(
PlugšInfo
 *
šfo
)

1211 ià(!
	`dŸ_¶ugš_šfo_š™
(
šfo
, "Internal",

1212 
	`_
("Objects‡nd filters internalo dia"),

1213 
NULL
, NULL))

1214  
DIA_PLUGIN_INIT_ERROR
;

1217 
	`objeù_»gi¡”_ty³
(&
group_ty³
);

1218 #ifdeà
USE_NEWGROUP


1219 
	`objeù_»gi¡”_ty³
(&
Ãwgroup_ty³
);

1223 
	`f‹r_»gi¡”_impÜt
(&
dŸ_impÜt_f‹r
);

1227 
	`f‹r_»gi¡”_expÜt
(&
dŸ_expÜt_f‹r
);

1229  
DIA_PLUGIN_INIT_OK
;

1230 
	}
}

1232 
gboŞ—n


1233 
	$hªdË_®l_dŸg¿ms
(
GSLi¡
 *
fes
, *
expÜt_fe_Çme
,

1234 *
expÜt_fe_fÜm©
, *
size
, *
show_Ïy”s
,

1235 cÚ¡ 
gch¬
 *
šput_dœeùÜy
, cÚ¡ gch¬ *
ouut_dœeùÜy
)

1237 
GSLi¡
 *
node
 = 
NULL
;

1238 
gboŞ—n
 
made_cÚv”siÚs
 = 
FALSE
;

1240 
node
 = 
fes
;‚ode;‚odğnode->
Ãxt
) {

1241 
gch¬
 *
š·th
 = 
šput_dœeùÜy
 ? 
	`g_bud_f’ame
(šput_dœeùÜy, 
node
->
d©a
, 
NULL
) :‚ode->data;

1242 
made_cÚv”siÚs
 |=

1243 
	`hªdË_š™Ÿl_dŸg¿m
(
š·th
, 
expÜt_fe_Çme
,

1244 
expÜt_fe_fÜm©
, 
size
, 
show_Ïy”s
, 
ouut_dœeùÜy
);

1245 ià(
š·th
 !ğ
node
->
d©a
)

1246 
	`g_ä“
(
š·th
);

1248  
made_cÚv”siÚs
;

1249 
	}
}

1261 
	$´št_üed™s
(
gboŞ—n
 
üed™s
)

1263 ià(
üed™s
) {

1264 
i
;

1265 cÚ¡ 
gšt
 
ÇuthÜs
 = ((
authÜs
) / (authors[0])) - 1;

1266 cÚ¡ 
gšt
 
ndocum’tÜs
 = ((
docum’tÜs
) / (documentors[0])) - 1;

1268 
	`g_´št
(
	`_
("The original‡uthor of Dia was:\n\n"));

1269 
i
 = 0; i < 
NUMBER_OF_ORIG_AUTHORS
; i++) {

1270 
	`g_´št
("%s\n", 
authÜs
[
i
]);

1273 
	`g_´št
(
	`_
("\nThe current maintainers of Dia‡re:\n\n"));

1274 
i
 = 
NUMBER_OF_ORIG_AUTHORS
; i < NUMBER_OF_ORIG_AUTHORS + 
NUMBER_OF_MAINTAINERS
; i++) {

1275 
	`g_´št
("%s\n", 
authÜs
[
i
]);

1278 
	`g_´št
(
	`_
("\nOther‡uthors‡re:\n\n"));

1279 
i
 = 
NUMBER_OF_ORIG_AUTHORS
 + 
NUMBER_OF_MAINTAINERS
; i < 
ÇuthÜs
; i++) {

1280 
	`g_´št
("%s\n", 
authÜs
[
i
]);

1283 
	`g_´št
(
	`_
("\nDia is documented by:\n\n"));

1284 
i
 = 0; i < 
ndocum’tÜs
; i++) {

1285 
	`g_´št
("%s\n", 
docum’tÜs
[
i
]);

1288 
	`ex™
(0);

1290 
	}
}

1292 
	$­p_is_embedded
()

1295 
	}
}

	@O:\tool\dvs50\app\app_procs.h

18 #iâdeà
APP_PROCS_H


19 
	#APP_PROCS_H


	)

21 
	~<glib.h
>

22 
	~"dŸv¬.h
"

24 
DIAVAR
 
­p_š™
(
¬gc
, **
¬gv
);

29 
gboŞ—n
 
­p_ex™
();

30 
­p_is_embedded
();

32 
­p_¥Ïsh_š™
(cÚ¡ 
gch¬
* 
Çme
);

33 
DIAVAR
 
­p_¥Ïsh_dÚe
();

35 
DIAVAR
 
gboŞ—n
 
­p_is_š‹¿ùive
();

37 
dŸ_»dœeù_cÚsŞe
 ();

	@O:\tool\dvs50\app\authors.h

54 cÚ¡ 
	gNUMBER_OF_ORIG_AUTHORS
 = 1;

55 cÚ¡ 
	gNUMBER_OF_MAINTAINERS
 = 1;

57 cÚ¡ 
gch¬
 *
	gauthÜs
[] = {

106 
NULL


109 cÚ¡ 
gch¬
 *
	gdocum’tÜs
[] = {

114 
NULL


	@O:\tool\dvs50\app\autosave.c

29 #ifdeà
HAVE_CONFIG_H


30 
	~<cÚfig.h
>

33 
	~<¡dio.h
>

34 
	~<sys/ty³s.h
>

35 #ifdeà
HAVE_UNISTD_H


36 
	~<uni¡d.h
>

39 
	~"š.h
"

40 
	~"dŸ_dœs.h
"

41 
	~"dŸg¿m.h
"

42 
	~"lßd_§ve.h
"

43 
	~"dŸlogs.h
"

44 
	~<gtk/gtk.h
>

46 
gboŞ—n
 
auto§ve_check_auto§ve
(
gpoš‹r
 
d©a
);

49 
	$auto§ve_§ve_dŸg¿m
(
gpoš‹r
 
d©a
)

51 
DŸg¿m
 *
dŸ
 = (DŸg¿m *)
d©a
;

53 
	`g_idË_»move_by_d©a
(
d©a
);

55 
	`dŸg¿m_auto§ve
(
dŸ
);

56 
	}
}

63 
gboŞ—n


64 
	$auto§ve_check_auto§ve
(
gpoš‹r
 
d©a
)

66 
GLi¡
 *
dŸg¿ms
 = 
	`dŸ_İ’_dŸg¿ms
();

67 
DŸg¿m
 *
dŸg¿m
;

69 
dŸg¿ms
 !ğ
NULL
) {

70 
dŸg¿m
 = (
DŸg¿m
 *)
dŸg¿ms
->
d©a
;

71 ià(
	`dŸg¿m_is_modif›d
(
dŸg¿m
) &&

72 !
dŸg¿m
->
auto§ved
) {

74 
	`g_idË_add
 ((
GSourûFunc
)
auto§ve_§ve_dŸg¿m
, 
dŸg¿m
);

76 
dŸg¿ms
 = 
	`g_li¡_Ãxt
(diagrams);

78  
TRUE
;

79 
	}
}

87 
	$auto§ve_make_»¡Üe_dŸlog
(
GLi¡
 *
fes
)

89 
GtkWidg‘
 *
ok
, *
ÿnûl
;

90 
GtkWidg‘
 *
dŸlog
 = 
	`dŸlog_make
(
	`_
("Recovering‡utosaved diagrams"),

91 
NULL
, NULL, &
ok
, &
ÿnûl
);

92 
GtkWidg‘
 *
vbox
 = 
	`GTK_DIALOG
(
dŸlog
)->vbox;

93 
GtkWidg‘
 *
£Ëù¬—
 = 
	`gtk_şi¡_Ãw
(1);

94 
GLi¡
 *
™”
;

95 
gch¬
 **
f—¼ay
 = (gch¬**)
	`g_Ãw
(gch¬ *, 
	`g_li¡_Ëngth
(
fes
)+1);

96 
i
;

98 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
vbox
), 
	`gtk_Ïb–_Ãw
(
	`_
("Autosaved filesƒxist.\nPlease selecthose you wisho„ecover.")));

100 
i
 = 0, 
™”
 = 
fes
; i‹¸!ğ
NULL
; i++, i‹¸ğ
	`g_li¡_Ãxt
(iter)) {

101 
f—¼ay
[
i
] = (
gch¬
 *)
™”
->
d©a
;

103 
f—¼ay
[
i
] = 0;

104 
	`gtk_şi¡_­³nd
(
	`GTK_CLIST
(
£Ëù¬—
), 
f—¼ay
);

106 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
vbox
), 
£Ëù¬—
);

107 
	`gtk_widg‘_show_®l
(
dŸlog
);

108 
	}
}

113 
	$auto§ve_»¡Üe_docum’ts
()

115 
gch¬
 *
§vedœ
 = 
	`dŸ_cÚfig_f’ame
("auto§ve" 
G_DIR_SEPARATOR_S
);

116 
GDœ
 *
dœ
 = 
	`g_dœ_İ’
(
§vedœ
, 0, 
NULL
);

117 cÚ¡ *
’t
;

118 
GLi¡
 *
fes
 = 
NULL
;

120 ià(
dœ
 =ğ
NULL
) ;

121 (
’t
 = 
	`g_dœ_»ad_Çme
(
dœ
)è!ğ
NULL
) {

122 
	`´štf
("Found‡uto§vf%s\n", 
’t
);

123 
fes
 = 
	`g_li¡_´•’d
(fes, 
	`g_¡rdup
(
’t
));

126 ià(
fes
 !ğ
NULL
) {

127 
	`auto§ve_make_»¡Üe_dŸlog
(
fes
);

129 
	`g_dœ_şo£
(
dœ
);

130 
	`g_ä“
(
§vedœ
);

131 
	`g_li¡_ä“
(
fes
);

132 
	}
}

	@O:\tool\dvs50\app\autosave.h

19 #iâdeà
AUTOSAVE_H


20 
	#AUTOSAVE_H


	)

22 
gboŞ—n
 
auto§ve_check_auto§ve
(
gpoš‹r
 
d©a
);

	@O:\tool\dvs50\app\color_area.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<¡dio.h
>

25 
	~"../lib/cŞÜ.h
"

26 
	~"š.h
"

28 
	~"cŞÜ_¬—.h
"

29 
	~"©Œibu‹s.h
"

30 
	~"³rsi¡’û.h
"

32 
	#FORE_AREA
 0

	)

33 
	#BACK_AREA
 1

	)

34 
	#SWAP_AREA
 2

	)

35 
	#DEF_AREA
 3

	)

37 
	#FOREGROUND
 0

	)

38 
	#BACKGROUND
 1

	)

41 
	gaùive_cŞÜ
 = 0;

44 
GtkWidg‘
 *
	gcŞÜ_¬—
;

45 
GdkGC
 *
	gcŞÜ_¬—_gc
 = 
NULL
;

46 
GdkGC
 *
	gmask_gc
 = 
NULL
;

47 
GdkPixm­
 *
	gcŞÜ_¬—_pixm­
 = 
NULL
;

48 
GdkB™m­
 *
	gcŞÜ_¬—_mask
 = 
NULL
;

49 
GdkPixm­
 *
	gdeçuÉ_pixm­
 = 
NULL
;

50 
GdkB™m­
 *
	gdeçuÉ_mask
 = 
NULL
;

51 
GdkPixm­
 *
	gsw­_pixm­
 = 
NULL
;

52 
GdkB™m­
 *
	gsw­_mask
 = 
NULL
;

54 
GtkWidg‘
 *
	gcŞÜ_£Ëù
 = 
NULL
;

55 
	gcŞÜ_£Ëù_aùive
 = 0;

56 
	ged™_cŞÜ
;

57 
CŞÜ
 
	g¡Üed_fÜeground
;

58 
CŞÜ
 
	g¡Üed_background
;

62 
cŞÜ_£ËùiÚ_ok
 (
GtkWidg‘
 *
w
,

63 
GtkCŞÜS–eùiÚDŸlog
 *
cs
);

65 
cŞÜ_£ËùiÚ_ÿnûl
 (
GtkWidg‘
 *
w
,

66 
GtkCŞÜS–eùiÚDŸlog
 *
cs
);

68 
cŞÜ_£ËùiÚ_ÿnûl
 (
GtkWidg‘
 *
w
,

69 
GtkCŞÜS–eùiÚDŸlog
 *
cs
);

70 
gšt


71 
cŞÜ_£ËùiÚ_d–‘e
 (
GtkWidg‘
 *
w
,

72 
GdkEv’t
 *
ev’t
,

73 
GtkCŞÜS–eùiÚDŸlog
 *
cs
);

74 
gšt


75 
cŞÜ_£ËùiÚ_de¡roy
 (
GtkWidg‘
 *
w
,

76 
GtkCŞÜS–eùiÚDŸlog
 *
cs
);

78 
cŞÜ_£ËùiÚ_chªged
 (
GtkWidg‘
 *
w
,

79 
GtkCŞÜS–eùiÚDŸlog
 *
cs
);

83 
	$cŞÜ_¬—_rg‘
 (
x
,

84 
y
)

86 
gšt
 
»ù_w
, 
»ù_h
;

87 
gšt
 
width
, 
height
;

89 
	`gdk_d¿wabË_g‘_size
 (
cŞÜ_¬—_pixm­
, &
width
, &
height
);

91 
»ù_w
 = 
width
 * 0.65;

92 
»ù_h
 = 
height
 * 0.65;

95 ià(
x
 > 0 && x < 
»ù_w
 &&

96 
y
 > 0 && y < 
»ù_h
)

97  
FORE_AREA
;

98 ià(
x
 > (
width
 - 
»ù_w
) && x < width &&

99 
y
 > (
height
 - 
»ù_h
) && y < height)

100  
BACK_AREA
;

101 ià(
x
 > 0 && x < (
width
 - 
»ù_w
) &&

102 
y
 > 
»ù_h
 && y < 
height
)

103  
DEF_AREA
;

104 ià(
x
 > 
»ù_w
 && x < 
width
 &&

105 
y
 > 0 && y < (
height
 - 
»ù_h
))

106  
SWAP_AREA
;

109 
	}
}

112 
	$cŞÜ_¬—_d¿w
 ()

114 
CŞÜ
 
cŞ
;

115 
GdkCŞÜ
 *
wš_bg
;

116 
GdkCŞÜ
 
fg
, 
bg
, 
bd
;

117 
gšt
 
»ù_w
, 
»ù_h
;

118 
gšt
 
width
, 
height
;

119 
gšt
 
def_width
, 
def_height
;

120 
gšt
 
sw­_width
, 
sw­_height
;

121 
GdkCŞÜ
 
mask_·‰”n
;

126 ià(!
cŞÜ_¬—_pixm­
 || !
cŞÜ_¬—_gc
)

129 
	`gdk_d¿wabË_g‘_size
 (
cŞÜ_¬—_pixm­
, &
width
, &
height
);

131 
wš_bg
 = &(
cŞÜ_¬—
->
¡yË
->
bg
[
GTK_STATE_NORMAL
]);

132 
cŞ
 = 
	`©Œibu‹s_g‘_fÜeground
();

133 
	`cŞÜ_cÚv”t
(&
cŞ
, &
fg
);

134 
cŞ
 = 
	`©Œibu‹s_g‘_background
();

135 
	`cŞÜ_cÚv”t
(&
cŞ
, &
bg
);

136 
bd
 = 
cŞÜ_gdk_bÏck
;

138 
»ù_w
 = 
width
 * 0.65;

139 
»ù_h
 = 
height
 * 0.65;

142 
mask_·‰”n
.
pix–
 = 0;

143 
	`gdk_gc_£t_fÜeground
 (
mask_gc
, &
mask_·‰”n
);

144 
	`gdk_d¿w_»ùªgË
 (
cŞÜ_¬—_mask
, 
mask_gc
, 
TRUE
, 0, 0, -1, -1);

147 
mask_·‰”n
.
pix–
 = 1;

148 
	`gdk_gc_£t_fÜeground
 (
mask_gc
, &
mask_·‰”n
);

150 
	`gdk_gc_£t_fÜeground
 (
cŞÜ_¬—_gc
, 
wš_bg
);

151 
	`gdk_d¿w_»ùªgË
 (
cŞÜ_¬—_pixm­
, 
cŞÜ_¬—_gc
, 1,

152 0, 0, 
width
, 
height
);

154 
	`gdk_gc_£t_fÜeground
 (
cŞÜ_¬—_gc
, &
bg
);

155 
	`gdk_d¿w_»ùªgË
 (
cŞÜ_¬—_pixm­
, 
cŞÜ_¬—_gc
, 1,

156 (
width
 - 
»ù_w
), (
height
 - 
»ù_h
),„ect_w,„ect_h);

157 
	`gdk_d¿w_»ùªgË
 (
cŞÜ_¬—_mask
, 
mask_gc
, 
TRUE
,

158 (
width
 - 
»ù_w
), (
height
 - 
»ù_h
),„ect_w,„ect_h);

160 ià(
aùive_cŞÜ
 =ğ
FOREGROUND
)

161 
	`gtk_·št_shadow
 (
cŞÜ_¬—
->
¡yË
, 
cŞÜ_¬—_pixm­
, 
GTK_STATE_NORMAL
,

162 
GTK_SHADOW_OUT
,

163 
NULL
, 
cŞÜ_¬—
, NULL,

164 (
width
 - 
»ù_w
), (
height
 - 
»ù_h
),

165 
»ù_w
, 
»ù_h
);

167 
	`gtk_·št_shadow
 (
cŞÜ_¬—
->
¡yË
, 
cŞÜ_¬—_pixm­
, 
GTK_STATE_NORMAL
,

168 
GTK_SHADOW_IN
,

169 
NULL
, 
cŞÜ_¬—
, NULL,

170 (
width
 - 
»ù_w
), (
height
 - 
»ù_h
),

171 
»ù_w
, 
»ù_h
);

173 
	`gdk_gc_£t_fÜeground
 (
cŞÜ_¬—_gc
, &
fg
);

174 
	`gdk_d¿w_»ùªgË
 (
cŞÜ_¬—_pixm­
, 
cŞÜ_¬—_gc
, 1,

175 0, 0, 
»ù_w
, 
»ù_h
);

176 
	`gdk_d¿w_»ùªgË
 (
cŞÜ_¬—_mask
, 
mask_gc
, 
TRUE
,

177 0, 0, 
»ù_w
, 
»ù_h
);

179 ià(
aùive_cŞÜ
 =ğ
FOREGROUND
)

180 
	`gtk_·št_shadow
 (
cŞÜ_¬—
->
¡yË
, 
cŞÜ_¬—_pixm­
, 
GTK_STATE_NORMAL
,

181 
GTK_SHADOW_IN
,

182 
NULL
, 
cŞÜ_¬—
, NULL,

184 
»ù_w
, 
»ù_h
);

186 
	`gtk_·št_shadow
 (
cŞÜ_¬—
->
¡yË
, 
cŞÜ_¬—_pixm­
, 
GTK_STATE_NORMAL
,

187 
GTK_SHADOW_OUT
,

188 
NULL
, 
cŞÜ_¬—
, NULL,

190 
»ù_w
, 
»ù_h
);

193 
	`gdk_d¿wabË_g‘_size
 (
deçuÉ_pixm­
, &
def_width
, &
def_height
);

194 
	`gdk_d¿w_d¿wabË
 (
cŞÜ_¬—_pixm­
, 
cŞÜ_¬—_gc
, 
deçuÉ_pixm­
,

195 0, 0, 0, 
height
 - 
def_height
, 
def_width
, def_height);

196 
	`gdk_d¿w_d¿wabË
 (
cŞÜ_¬—_mask
, 
mask_gc
, 
deçuÉ_mask
,

197 0, 0, 0, 
height
 - 
def_height
, 
def_width
, def_height);

200 
	`gdk_d¿wabË_g‘_size
 (
sw­_pixm­
, &
sw­_width
, &
sw­_height
);

201 
	`gdk_d¿w_d¿wabË
 (
cŞÜ_¬—_pixm­
, 
cŞÜ_¬—_gc
, 
sw­_pixm­
,

202 0, 0, 
width
 - 
sw­_width
, 0, sw­_width, 
sw­_height
);

203 
	`gdk_d¿w_d¿wabË
 (
cŞÜ_¬—_mask
, 
mask_gc
, 
sw­_mask
,

204 0, 0, 
width
 - 
sw­_width
, 0, sw­_width, 
sw­_height
);

207 
	`gdk_gc_£t_ş_mask
 (
cŞÜ_¬—_gc
, 
cŞÜ_¬—_mask
);

208 
	`gdk_gc_£t_ş_Üigš
 (
cŞÜ_¬—_gc
, 0, 0);

209 
	`gdk_d¿w_d¿wabË
 (
cŞÜ_¬—
->
wšdow
, 
cŞÜ_¬—_gc
, 
cŞÜ_¬—_pixm­
,

210 0, 0, 0, 0, 
width
, 
height
);

213 
	`gdk_gc_£t_ş_mask
 (
cŞÜ_¬—_gc
, 
NULL
);

214 
	}
}

217 
	$cŞÜ_£ËùiÚ_ok
 (
GtkWidg‘
 *
w
,

218 
GtkCŞÜS–eùiÚDŸlog
 *
cs
)

220 
GtkCŞÜS–eùiÚ
 *
cŞÜ£l
;

221 
GdkCŞÜ
 
cŞÜ
;

222 
CŞÜ
 
cŞ
;

224 
cŞÜ£l
=
	`GTK_COLOR_SELECTION
(
cs
->colorsel);

226 
	`gtk_cŞÜ_£ËùiÚ_g‘_cu¼’t_cŞÜ
(
cŞÜ£l
,&
cŞÜ
);

227 
	`GDK_COLOR_TO_DIA
(
cŞÜ
, 
cŞ
);

229 ià(
ed™_cŞÜ
 =ğ
FOREGROUND
) {

230 
	`©Œibu‹s_£t_fÜeground
(&
cŞ
);

232 
	`©Œibu‹s_£t_background
(&
cŞ
);

234 
	`cŞÜ_¬—_d¿w
 ();

238 
	`gtk_widg‘_hide
(
cŞÜ_£Ëù
);

239 
cŞÜ_£Ëù_aùive
 = 0;

240 
	}
}

243 
	$cŞÜ_£ËùiÚ_ÿnûl
 (
GtkWidg‘
 *
w
,

244 
GtkCŞÜS–eùiÚDŸlog
 *
cs
)

246 ià(
cŞÜ_£Ëù
 !ğ
NULL
)

247 
	`gtk_widg‘_hide
(
cŞÜ_£Ëù
);

248 
cŞÜ_£Ëù_aùive
 = 0;

249 
	`©Œibu‹s_£t_fÜeground
(&
¡Üed_fÜeground
);

250 
	`©Œibu‹s_£t_background
(&
¡Üed_background
);

252 
	`cŞÜ_¬—_d¿w
 ();

253 
	}
}

255 
gšt


256 
	$cŞÜ_£ËùiÚ_d–‘e
 (
GtkWidg‘
 *
w
,

257 
GdkEv’t
 *
ev’t
,

258 
GtkCŞÜS–eùiÚDŸlog
 *
cs
)

260 
	`cŞÜ_£ËùiÚ_ÿnûl
(
w
,
cs
);

261  
TRUE
;

262 
	}
}

264 
gšt


265 
	$cŞÜ_£ËùiÚ_de¡roy
 (
GtkWidg‘
 *
w
,

266 
GtkCŞÜS–eùiÚDŸlog
 *
cs
)

268 
cŞÜ_£Ëù
 = 
NULL
;

269 
	`cŞÜ_£ËùiÚ_ÿnûl
(
w
,
cs
);

270  
TRUE
;

271 
	}
}

274 
	$cŞÜ_£ËùiÚ_chªged
 (
GtkWidg‘
 *
w
,

275 
GtkCŞÜS–eùiÚDŸlog
 *
cs
)

277 
GtkCŞÜS–eùiÚ
 *
cŞÜ£l
;

278 
GdkCŞÜ
 
cŞÜ
;

279 
CŞÜ
 
cŞ
;

281 
cŞÜ£l
=
	`GTK_COLOR_SELECTION
(
cs
->colorsel);

283 
	`gtk_cŞÜ_£ËùiÚ_g‘_cu¼’t_cŞÜ
(
cŞÜ£l
,&
cŞÜ
);

284 
	`GDK_COLOR_TO_DIA
(
cŞÜ
, 
cŞ
);

286 ià(
ed™_cŞÜ
 =ğ
FOREGROUND
) {

287 
	`©Œibu‹s_£t_fÜeground
(&
cŞ
);

289 
	`©Œibu‹s_£t_background
(&
cŞ
);

291 
	`cŞÜ_¬—_d¿w
 ();

292 
	}
}

295 
	$cŞÜ_¬—_ed™
 ()

297 
CŞÜ
 
cŞ
;

298 
GtkWidg‘
 *
wšdow
;

299 
GdkCŞÜ
 
cŞÜ
;

301 ià(!
cŞÜ_£Ëù_aùive
) {

302 
¡Üed_fÜeground
 = 
	`©Œibu‹s_g‘_fÜeground
();

303 
¡Üed_background
 = 
	`©Œibu‹s_g‘_background
();

306 ià(
aùive_cŞÜ
 =ğ
FOREGROUND
) {

307 
cŞ
 = 
	`©Œibu‹s_g‘_fÜeground
();

308 
ed™_cŞÜ
 = 
FOREGROUND
;

310 
cŞ
 = 
	`©Œibu‹s_g‘_background
();

311 
ed™_cŞÜ
 = 
BACKGROUND
;

314 ià(! 
cŞÜ_£Ëù
) {

315 
wšdow
 = 
cŞÜ_£Ëù
 =

316 
	`gtk_cŞÜ_£ËùiÚ_dŸlog_Ãw
(
ed™_cŞÜ
==
FOREGROUND
?

317 
	`_
("Select foreground color"):

318 
	`_
("Select background color"));

319 
cŞÜ_£Ëù_aùive
 = 1;

321 
	`gtk_cŞÜ_£ËùiÚ_£t_has_·Ë‰e
 (

322 
	`GTK_COLOR_SELECTION
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
wšdow
)->
cŞÜ£l
),

323 
TRUE
);

325 
	`gtk_wšdow_£t_pos™iÚ
 (
	`GTK_WINDOW
 (
wšdow
), 
GTK_WIN_POS_MOUSE
);

327 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
wšdow
), "delete_event",

328 
	`G_CALLBACK
(
cŞÜ_£ËùiÚ_d–‘e
),

329 
wšdow
);

331 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
wšdow
), "destroy",

332 
	`G_CALLBACK
(
cŞÜ_£ËùiÚ_de¡roy
),

333 
wšdow
);

335 
	`g_sigÇl_cÚÃù
 (

336 
	`G_OBJECT
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
wšdow
)->
cŞÜ£l
),

338 
	`G_CALLBACK
(
cŞÜ_£ËùiÚ_chªged
),

339 
wšdow
);

341 
	`g_sigÇl_cÚÃù
 (

342 
	`G_OBJECT
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
wšdow
)->
ok_bu‰Ú
),

344 
	`G_CALLBACK
(
cŞÜ_£ËùiÚ_ok
),

345 
wšdow
);

347 
	`g_sigÇl_cÚÃù
 (

348 
	`G_OBJECT
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
wšdow
)->
ÿnûl_bu‰Ú
),

350 
	`G_CALLBACK
(
cŞÜ_£ËùiÚ_ÿnûl
),

351 
wšdow
);

355 
	`gtk_widg‘_show_now
 (
cŞÜ_£Ëù
);

358 
	`gtk_wšdow_£t_t™Ë
(
	`GTK_WINDOW
(
cŞÜ_£Ëù
),

359 
ed™_cŞÜ
==
FOREGROUND
?

360 
	`_
("Select foreground color"):

361 
	`_
("Select background color"));

362 ià(! 
cŞÜ_£Ëù_aùive
) {

363 
	`gtk_widg‘_show
 (
cŞÜ_£Ëù
);

366 
	`DIA_COLOR_TO_GDK
(
cŞ
, 
cŞÜ
);

368 
	`gtk_cŞÜ_£ËùiÚ_£t_cu¼’t_cŞÜ
(

369 
	`GTK_COLOR_SELECTION
 (
	`GTK_COLOR_SELECTION_DIALOG
 (
cŞÜ_£Ëù
)->
cŞÜ£l
),

370 &
cŞÜ
);

372 
	}
}

374 
gšt


375 
	$cŞÜ_¬—_ev’ts
 (
GtkWidg‘
 *
widg‘
,

376 
GdkEv’t
 *
ev’t
)

378 
GdkEv’tBu‰Ú
 *
bev’t
;

379 
rg‘
;

381 
ev’t
->
ty³
)

383 
GDK_CONFIGURE
:

384 ià(
cŞÜ_¬—_pixm­
)

386 
	`g_objeù_uÄef
 (
cŞÜ_¬—_pixm­
);

387 
	`g_objeù_uÄef
 (
cŞÜ_¬—_mask
);

390 
cŞÜ_¬—_pixm­
 = 
	`gdk_pixm­_Ãw
 (
cŞÜ_¬—
->
wšdow
,

391 
cŞÜ_¬—
->
®loÿtiÚ
.
width
,

392 
cŞÜ_¬—
->
®loÿtiÚ
.
height
, -1);

393 
cŞÜ_¬—_mask
 = 
	`gdk_pixm­_Ãw
 (
cŞÜ_¬—
->
wšdow
,

394 
cŞÜ_¬—
->
®loÿtiÚ
.
width
,

395 
cŞÜ_¬—
->
®loÿtiÚ
.
height
, 1);

397 
GDK_EXPOSE
:

398 ià(
	`GTK_WIDGET_DRAWABLE
 (
cŞÜ_¬—
))

400 ià(!
cŞÜ_¬—_gc
)

402 
cŞÜ_¬—_gc
 = 
	`gdk_gc_Ãw
 (
cŞÜ_¬—
->
wšdow
);

403 
mask_gc
 = 
	`gdk_gc_Ãw
 (
cŞÜ_¬—_mask
);

406 
	`cŞÜ_¬—_d¿w
 ();

409 
GDK_BUTTON_PRESS
:

410 
bev’t
 = (
GdkEv’tBu‰Ú
 *è
ev’t
;

412 ià(
bev’t
->
bu‰Ú
 == 1) {

413 (
rg‘
 = 
	`cŞÜ_¬—_rg‘
 (
bev’t
->
x
, bev’t->
y
))) {

414 
FORE_AREA
:

415 
BACK_AREA
:

416 ià(
rg‘
 =ğ
aùive_cŞÜ
) {

417 
	`cŞÜ_¬—_ed™
 ();

419 
aùive_cŞÜ
 = 
rg‘
;

420 
	`cŞÜ_¬—_d¿w
();

423 
SWAP_AREA
:

424 
	`©Œibu‹s_sw­_fgbg
();

425 
	`cŞÜ_¬—_d¿w
();

427 
DEF_AREA
:

428 
	`©Œibu‹s_deçuÉ_fgbg
();

429 
	`cŞÜ_¬—_d¿w
();

439  
FALSE
;

440 
	}
}

443 
GtkWidg‘
 *

444 
	$cŞÜ_¬—_ü—‹
 (
width
,

445 
height
,

446 
GdkPixm­
 *
deçuÉ_pm­
,

447 
GdkB™m­
 *
deçuÉ_msk
,

448 
GdkPixm­
 *
sw­_pm­
,

449 
GdkB™m­
 *
sw­_msk
)

451 
GtkWidg‘
 *
ev’t_box
;

453 
	`©Œibu‹s_£t_fÜeground
(
	`³rsi¡’û_»gi¡”_cŞÜ
("fg_cŞÜ", &
cŞÜ_bÏck
));

454 
	`©Œibu‹s_£t_background
(
	`³rsi¡’û_»gi¡”_cŞÜ
("bg_cŞÜ", &
cŞÜ_wh™e
));

456 
ev’t_box
 = 
	`gtk_ev’t_box_Ãw
();

457 
cŞÜ_¬—
 = 
	`gtk_d¿wšg_¬—_Ãw
 ();

458 
	`gtk_widg‘_£t_size_»que¡
 (
cŞÜ_¬—
, 
width
, 
height
);

459 
	`gtk_widg‘_£t_ev’ts
 (
cŞÜ_¬—
, 
GDK_EXPOSURE_MASK
 | 
GDK_BUTTON_PRESS_MASK
);

460 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
cŞÜ_¬—
), "event",

461 
	`G_CALLBACK
(
cŞÜ_¬—_ev’ts
),

462 
NULL
);

463 
deçuÉ_pixm­
 = 
deçuÉ_pm­
;

464 
deçuÉ_mask
 = 
deçuÉ_msk
;

465 
sw­_pixm­
 = 
sw­_pm­
;

466 
sw­_mask
 = 
sw­_msk
;

468 
	`gtk_widg‘_show
(
cŞÜ_¬—
);

469 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
ev’t_box
), 
cŞÜ_¬—
);

470  
ev’t_box
;

471 
	}
}

	@O:\tool\dvs50\app\color_area.h

18 #iâdeà
COLOR_AREA_H


19 
	#COLOR_AREA_H


	)

21 
	~<gtk/gtk.h
>

23 
GtkWidg‘
 *
cŞÜ_¬—_ü—‹
 (
width
,

24 
height
,

25 
GdkPixm­
 *
deçuÉ_pm­
,

26 
GdkB™m­
 *
deçuÉ_msk
,

27 
GdkPixm­
 *
sw­_pm­
,

28 
GdkB™m­
 *
sw­_msk
);

	@O:\tool\dvs50\app\commands.c

18 
	~<cÚfig.h
>

20 #ifdeà
HAVE_UNISTD_H


21 
	~<uni¡d.h
>

23 
	~<¡dlib.h
>

24 
	~<¡dio.h
>

25 
	~<¡ršg.h
>

26 
	~<sys/ty³s.h
>

27 
	~<m©h.h
>

28 
	~<glib.h
>

30 #ifdeà
GNOME


31 #undeà
GTK_DISABLE_DEPRECATED


32 
	~<gnome.h
>

35 
	~<gdk-pixbuf/gdk-pixbuf.h
>

36 
	~<gtk/gtk.h
>

38 
	~<‹x‹d™.h
>

39 
	~<focus.h
>

40 
	~"cÚfœm.h
"

47 #ifdeà
G_OS_WIN32


53 
__¡dÿÎ


54 
Sh–lExecu‹A
 (
hwnd
,

55 cÚ¡ * 
ÍO³¿tiÚ
,

56 cÚ¡ * 
ÍFe
,

57 cÚ¡ * 
ÍP¬am‘”s
,

58 cÚ¡ * 
ÍDœeùÜy
,

59 
nShowCmd
);

62 
	~"š.h
"

63 
	~"commªds.h
"

64 
	~"­p_´ocs.h
"

65 
	~"dŸg¿m.h
"

66 
	~"di¥Ïy.h
"

67 
	~"objeù_İs.h
"

68 
	~"cut_n_·¡e.h
"

69 
	~"š‹rçû.h
"

70 
	~"lßd_§ve.h
"

71 
	~"uts.h
"

72 
	~"mes§ge.h
"

73 
	~"grid.h
"

74 
	~"´İ”t›s-dŸlog.h
"

75 
	~"´İš‹º®s.h
"

76 
	~"´eã»nûs.h
"

77 
	~"Ïy”_dŸlog.h
"

78 
	~"cÚÃùiÚpošt_İs.h
"

79 
	~"undo.h
"

80 
	~"·ge£tup.h
"

81 
	~"‹xt.h
"

82 
	~"dŸ_dœs.h
"

83 
	~"focus.h
"

84 
	~<gdk/gdk.h
>

85 
	~<gdk/gdkkeysyms.h
>

86 
	~"lib/´İ”t›s.h
"

87 
	~"lib/·»Á.h
"

88 
	~"dŸ-´İs.h
"

89 
	~"dŸg¿m_Œ“_wšdow.h
"

90 
	~"authÜs.h
"

93 
	$fe_qu™_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

95 
	`­p_ex™
();

96 
	}
}

99 
	$fe_·ge£tup_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

101 
DŸg¿m
 *
dŸ
;

103 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

104 ià(!
dŸ
) ;

105 
	`ü—‹_·ge_£tup_dlg
(
dŸ
);

106 
	}
}

109 
	$fe_´št_ÿÎback
 (
GtkAùiÚ
 *
_aùiÚ
)

111 
DŸg¿m
 *
dŸ
;

112 
DDi¥Ïy
 *
ddi¥
;

113 
GtkAùiÚ
 *
aùiÚ
;

115 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

116 ià(!
dŸ
) ;

117 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

118 ià(!
ddi¥
) ;

120 
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("FilePrintGTK");

121 ià(!
aùiÚ
)

122 
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("FilePrintGDI");

123 ià(!
aùiÚ
)

124 
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("FilePrintPS");

126 ià(
aùiÚ
) {

127 ià(
	`cÚfœm_expÜt_size
 (
dŸ
, 
	`GTK_WINDOW
(
ddi¥
->
sh–l
), 
CONFIRM_PRINT
|
CONFIRM_PAGES
))

128 
	`gtk_aùiÚ_aùiv©e
 (
aùiÚ
);

130 
	`mes§ge_”rÜ
 (
	`_
("No…rint…lug-in found!"));

132 
	}
}

135 
	$fe_şo£_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

138 ià(
	`ddi¥Ïy_aùive
())

139 
	`ddi¥Ïy_şo£
(
	`ddi¥Ïy_aùive
());

140 
	}
}

143 
	$fe_Ãw_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

145 
DŸg¿m
 *
dŸ
;

146 
DDi¥Ïy
 *
ddi¥
;

147 
uÁ™Ëd_Ä
 = 1;

148 
gch¬
 *
Çme
, *
f’ame
;

150 
Çme
 = 
	`g_¡rdup_´štf
(
	`_
("DŸg¿m%d.dŸ"), 
uÁ™Ëd_Ä
++);

151 
f’ame
 = 
	`g_f’ame_äom_utf8
(
Çme
, -1, 
NULL
, NULL, NULL);

152 
dŸ
 = 
	`Ãw_dŸg¿m
(
f’ame
);

153 
ddi¥
 = 
	`Ãw_di¥Ïy
(
dŸ
);

154 
	`dŸg¿m_Œ“_add
(
	`dŸg¿m_Œ“
(), 
dŸ
);

155 
	`g_ä“
 (
Çme
);

156 
	`g_ä“
 (
f’ame
);

157 
	}
}

160 
	$fe_´eã»nûs_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

162 
	`´efs_show
();

163 
	}
}

172 
	$š£¹_‹xt
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
, cÚ¡ 
gch¬
 *
‹xt
)

174 
ObjeùChªge
 *
chªge
 = 
NULL
;

175 
modif›d
 = 
FALSE
, 
ªy_modif›d
 = FALSE;

176 
DŸObjeù
 *
obj
 = 
	`focus_g‘_objeù
(
focus
);

178 
‹xt
 !ğ
NULL
) {

179 
gch¬
 *
Ãxt_lše
 = 
	`g_utf8_¡rchr
(
‹xt
, -1, '\n');

180 ià(
Ãxt_lše
 !ğ
‹xt
) {

181 
gšt
 
Ën
 = 
	`g_utf8_¡¾’
(
‹xt
, (
Ãxt_lše
-text));

182 
modif›d
 = (*
focus
->
key_ev’t
)(focus, 
GDK_A
, 
‹xt
, 
Ën
, &
chªge
);

184 ià(
Ãxt_lše
 !ğ
NULL
) {

185 
modif›d
 = (*
focus
->
key_ev’t
)(focus, 
GDK_R‘uº
, "\n", 1, &
chªge
);

186 
‹xt
 = 
	`g_utf8_Ãxt_ch¬
(
Ãxt_lše
);

188 
‹xt
 = 
NULL
;

191 
Pošt
 
p
 = 
obj
->
pos™iÚ
;

192 (
obj
->
İs
->
move
)(obj,&
p
); }

195 
	`objeù_add_upd©es
(
obj
, 
ddi¥
->
dŸg¿m
);

197 ià(
modif›d
 && (
chªge
 !ğ
NULL
)) {

198 
	`undo_objeù_chªge
(
ddi¥
->
dŸg¿m
, 
obj
, 
chªge
);

199 
ªy_modif›d
 = 
TRUE
;

202 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

205 ià(
ªy_modif›d
) {

206 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

207 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

208 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

210 
	}
}

214 
	$»ûived_şbßrd_hªdËr
(
GtkClbßrd
 *
şbßrd
,

215 cÚ¡ 
gch¬
 *
‹xt
,

216 
gpoš‹r
 
d©a
) {

217 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
d©a
;

218 
Focus
 *
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

220 ià(
‹xt
 =ğ
NULL
) ;

222 ià((
focus
 =ğ
NULL
è|| (!focus->
has_focus
)) ;

224 ià(!
	`g_utf8_v®id©e
(
‹xt
, -1, 
NULL
)) {

225 
	`mes§ge_”rÜ
("Not valid UTF8");

229 
	`š£¹_‹xt
(
ddi¥
, 
focus
, 
‹xt
);

230 
	}
}

232 
PrİDesütiÚ
 
	g‹xt_´İ_sšgËtÚ_desc
[] = {

233 { "‹xt", 
PROP_TYPE_TEXT
 },

234 
PROP_DESC_END
};

237 
	$make_‹xt_´İ_sšgËtÚ
(
GPŒA¼ay
 **
´İs
, 
TextPrİ”ty
 **
´İ
)

239 *
´İs
 = 
	`´İ_li¡_äom_descs
(
‹xt_´İ_sšgËtÚ_desc
,
pdp_Œue
);

240 
	`g_as£¹
((*
´İs
)->
Ën
 == 1);

242 *
´İ
 = 
	`g_±r_¬¿y_šdex
((*
´İs
),0);

243 
	`g_ä“
((*
´İ
)->
‹xt_d©a
);

244 (*
´İ
)->
‹xt_d©a
 = 
NULL
;

245 
	}
}

249 
	$ed™_cİy_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

251 
GLi¡
 *
cİy_li¡
;

252 
DDi¥Ïy
 *
ddi¥
;

254 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

255 ià(!
ddi¥
) ;

256 ià(
	`‹x‹d™_mode
(
ddi¥
)) {

257 
Focus
 *
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

258 
DŸObjeù
 *
obj
 = 
	`focus_g‘_objeù
(
focus
);

259 
GPŒA¼ay
 *
‹xrİs
;

260 
TextPrİ”ty
 *
´İ
;

262 ià(
obj
->
İs
->
g‘_´İs
 =ğ
NULL
)

265 
	`make_‹xt_´İ_sšgËtÚ
(&
‹xrİs
,&
´İ
);

267 
obj
->
İs
->
	`g‘_´İs
(obj, 
‹xrİs
);

272 #ifdeà
G_OS_WIN32


273 
	`gtk_şbßrd_£t_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_NONE
),

274 
´İ
->
‹xt_d©a
, -1);

276 
	`gtk_şbßrd_£t_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_SELECTION_PRIMARY
),

277 
´İ
->
‹xt_d©a
, -1);

279 
	`´İ_li¡_ä“
(
‹xrİs
);

281 
cİy_li¡
 = 
	`·»Á_li¡_afãùed
(
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
ddi¥
->
dŸg¿m
));

283 
	`úp_¡Üe_objeùs
(
	`objeù_cİy_li¡
(
cİy_li¡
), 1);

284 
	`g_li¡_ä“
(
cİy_li¡
);

286 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

288 
	}
}

291 
	$ed™_cut_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

293 
GLi¡
 *
cut_li¡
;

294 
DDi¥Ïy
 *
ddi¥
;

295 
Chªge
 *
chªge
;

297 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

298 ià(!
ddi¥
) ;

300 ià(
	`‹x‹d™_mode
(
ddi¥
)) {

302 
	`dŸg¿m_£Ëùed_b»ak_ex‹º®
(
ddi¥
->
dŸg¿m
);

304 
cut_li¡
 = 
	`·»Á_li¡_afãùed
(
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
ddi¥
->
dŸg¿m
));

306 
	`úp_¡Üe_objeùs
(
	`objeù_cİy_li¡
(
cut_li¡
), 0);

308 
chªge
 = 
	`undo_d–‘e_objeùs_chd»n
(
ddi¥
->
dŸg¿m
, 
cut_li¡
);

309 (
chªge
->
­¶y
)(chªge, 
ddi¥
->
dŸg¿m
);

311 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

312 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

314 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

315 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

316 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

318 
	}
}

321 
	$ed™_·¡e_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

323 
GLi¡
 *
·¡e_li¡
;

324 
DDi¥Ïy
 *
ddi¥
;

325 
Pošt
 
·¡e_cÜÃr
;

326 
Pošt
 
d–
;

327 
Chªge
 *
chªge
;

328 
g’”©iÚ
 = 0;

330 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

331 ià(!
ddi¥
) ;

332 ià(
	`‹x‹d™_mode
(
ddi¥
)) {

333 #ifdeà
G_OS_WIN32


334 
	`gtk_şbßrd_»que¡_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_NONE
),

335 
»ûived_şbßrd_hªdËr
, 
ddi¥
);

337 
	`gtk_şbßrd_»que¡_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_SELECTION_PRIMARY
),

338 
»ûived_şbßrd_hªdËr
, 
ddi¥
);

341 ià(!
	`úp_exi¡_¡Üed_objeùs
()) {

342 
	`mes§ge_w¬nšg
(
	`_
("Noƒxisting objecto…aste.\n"));

346 
·¡e_li¡
 = 
	`úp_g‘_¡Üed_objeùs
(&
g’”©iÚ
);

348 
·¡e_cÜÃr
 = 
	`objeù_li¡_cÜÃr
(
·¡e_li¡
);

350 
d–
.
x
 = 
ddi¥
->
visibË
.
Ëá
 - 
·¡e_cÜÃr
.x;

351 
d–
.
y
 = 
ddi¥
->
visibË
.
tİ
 - 
·¡e_cÜÃr
.y;

354 
d–
.
x
 +ğ(
ddi¥
->
visibË
.
right
 - ddi¥->visibË.
Ëá
è* 0.1 * 
g’”©iÚ
;

355 
d–
.
y
 +ğ(
ddi¥
->
visibË
.
bÙtom
 - ddi¥->visibË.
tİ
è* 0.1 * 
g’”©iÚ
;

357 ià(
g’”©iÚ
)

358 
	`objeù_li¡_move_d–
(
·¡e_li¡
, &
d–
);

360 
chªge
 = 
	`undo_š£¹_objeùs
(
ddi¥
->
dŸg¿m
, 
·¡e_li¡
, 0);

361 (
chªge
->
­¶y
)(chªge, 
ddi¥
->
dŸg¿m
);

363 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

364 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

366 
	`dŸg¿m_»move_®l_£Ëùed
(
ddi¥
->
dŸg¿m
, 
TRUE
);

367 
	`dŸg¿m_£Ëù_li¡
(
ddi¥
->
dŸg¿m
, 
·¡e_li¡
);

369 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

370 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

372 
	}
}

384 
	$ed™_du¶iÿ‹_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

386 
GLi¡
 *
du¶iÿ‹_li¡
;

387 
DDi¥Ïy
 *
ddi¥
;

388 
Pošt
 
du¶iÿ‹_cÜÃr
;

389 
Pošt
 
d–
;

390 
Chªge
 *
chªge
;

392 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

393 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

394 
du¶iÿ‹_li¡
 = 
	`objeù_cİy_li¡
(
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
ddi¥
->
dŸg¿m
));

395 
du¶iÿ‹_cÜÃr
 = 
	`objeù_li¡_cÜÃr
(
du¶iÿ‹_li¡
);

398 
d–
.
x
 = (
ddi¥
->
visibË
.
right
 - ddi¥->visibË.
Ëá
)*0.05;

399 
d–
.
y
 = (
ddi¥
->
visibË
.
bÙtom
 - ddi¥->visibË.
tİ
)*0.05;

401 
	`objeù_li¡_move_d–
(
du¶iÿ‹_li¡
, &
d–
);

403 
chªge
 = 
	`undo_š£¹_objeùs
(
ddi¥
->
dŸg¿m
, 
du¶iÿ‹_li¡
, 0);

404 (
chªge
->
­¶y
)(chªge, 
ddi¥
->
dŸg¿m
);

406 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

407 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

409 
	`dŸg¿m_»move_®l_£Ëùed
(
ddi¥
->
dŸg¿m
, 
TRUE
);

410 
	`dŸg¿m_£Ëù_li¡
(
ddi¥
->
dŸg¿m
, 
du¶iÿ‹_li¡
);

412 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

414 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

415 
	}
}

418 
	$objeùs_move_up_Ïy”
(
GtkAùiÚ
 *
aùiÚ
)

420 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

421 
GLi¡
 *
£Ëùed_li¡
;

422 
Chªge
 *
chªge
;

424 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

425 
£Ëùed_li¡
 = 
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
ddi¥
->
dŸg¿m
);

427 
chªge
 = 
	`undo_move_objeù_Ùh”_Ïy”
(
ddi¥
->
dŸg¿m
, 
£Ëùed_li¡
, 
TRUE
);

429 (
chªge
->
­¶y
)(chªge, 
ddi¥
->
dŸg¿m
);

431 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

432 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

434 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

436 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

437 
	}
}

440 
	$objeùs_move_down_Ïy”
(
GtkAùiÚ
 *
aùiÚ
)

442 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

443 
GLi¡
 *
£Ëùed_li¡
;

444 
Chªge
 *
chªge
;

446 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

447 
£Ëùed_li¡
 = 
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
ddi¥
->
dŸg¿m
);

451 
chªge
 = 
	`undo_move_objeù_Ùh”_Ïy”
(
ddi¥
->
dŸg¿m
, 
£Ëùed_li¡
, 
FALSE
);

453 (
chªge
->
­¶y
)(chªge, 
ddi¥
->
dŸg¿m
);

455 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

456 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

458 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

460 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

461 
	}
}

464 
	$ed™_cİy_‹xt_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

466 
Focus
 *
focus
;

467 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

468 
DŸObjeù
 *
obj
;

469 
GPŒA¼ay
 *
‹xrİs
;

470 
TextPrİ”ty
 *
´İ
;

472 ià(
ddi¥
 =ğ
NULL
) ;

474 
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

476 ià((
focus
 =ğ
NULL
è|| (!focus->
has_focus
)) ;

478 
obj
 = 
	`focus_g‘_objeù
(
focus
);

480 ià(
obj
->
İs
->
g‘_´İs
 =ğ
NULL
)

483 
	`make_‹xt_´İ_sšgËtÚ
(&
‹xrİs
,&
´İ
);

485 
obj
->
İs
->
	`g‘_´İs
(obj, 
‹xrİs
);

490 #ifdeà
G_OS_WIN32


491 
	`gtk_şbßrd_£t_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_NONE
),

492 
´İ
->
‹xt_d©a
, -1);

494 
	`gtk_şbßrd_£t_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_SELECTION_PRIMARY
),

495 
´İ
->
‹xt_d©a
, -1);

497 
	`´İ_li¡_ä“
(
‹xrİs
);

498 
	}
}

501 
	$ed™_cut_‹xt_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

503 
Focus
 *
focus
;

504 
DDi¥Ïy
 *
ddi¥
;

505 
DŸObjeù
 *
obj
;

506 
Text
 *
‹xt
;

507 
GPŒA¼ay
 *
‹xrİs
;

508 
TextPrİ”ty
 *
´İ
;

509 
ObjeùChªge
 *
chªge
;

511 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

512 ià(!
ddi¥
) ;

514 
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

515 ià((
focus
 =ğ
NULL
è|| (!focus->
has_focus
)) ;

517 
obj
 = 
	`focus_g‘_objeù
(
focus
);

518 
‹xt
 = (
Text
*)
focus
->
u£r_d©a
;

520 ià(
obj
->
İs
->
g‘_´İs
 =ğ
NULL
)

523 
	`make_‹xt_´İ_sšgËtÚ
(&
‹xrİs
,&
´İ
);

525 
obj
->
İs
->
	`g‘_´İs
(obj, 
‹xrİs
);

530 #ifdeà
G_OS_WIN32


531 
	`gtk_şbßrd_£t_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_NONE
),

532 
´İ
->
‹xt_d©a
, -1);

534 
	`gtk_şbßrd_£t_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_SELECTION_PRIMARY
),

535 
´İ
->
‹xt_d©a
, -1);

538 
	`´İ_li¡_ä“
(
‹xrİs
);

540 ià(
	`‹xt_d–‘e_®l
(
‹xt
, &
chªge
)) {

541 
	`objeù_add_upd©es
(
obj
, 
ddi¥
->
dŸg¿m
);

542 
	`undo_objeù_chªge
(
ddi¥
->
dŸg¿m
, 
obj
, 
chªge
);

543 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

544 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

545 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

547 
	}
}

550 
	$ed™_·¡e_‹xt_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

552 
DDi¥Ïy
 *
ddi¥
;

554 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

555 ià(!
ddi¥
) ;

557 #ifdeà
G_OS_WIN32


558 
	`gtk_şbßrd_»que¡_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_NONE
),

559 
»ûived_şbßrd_hªdËr
, 
ddi¥
);

561 
	`gtk_şbßrd_»que¡_‹xt
(
	`gtk_şbßrd_g‘
(
GDK_SELECTION_PRIMARY
),

562 
»ûived_şbßrd_hªdËr
, 
ddi¥
);

564 
	}
}

567 
	$ed™_d–‘e_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

569 
GLi¡
 *
d–‘e_li¡
;

570 
DDi¥Ïy
 *
ddi¥
;

573 ià(
	`gdk_poš‹r_is_g¿bbed
 ()) {

574 
	`gdk_b“p
 ();

578 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

579 ià(!
ddi¥
) ;

580 ià(
	`‹x‹d™_mode
(
ddi¥
)) {

581 
ObjeùChªge
 *
chªge
 = 
NULL
;

582 
Focus
 *
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

583 ià(!
	`‹xt_d–‘e_key_hªdËr
(
focus
, &
chªge
)) {

586 
	`objeù_add_upd©es
(
focus
->
obj
, 
ddi¥
->
dŸg¿m
);

588 
Chªge
 *
chªge
 = 
NULL
;

589 
	`dŸg¿m_£Ëùed_b»ak_ex‹º®
(
ddi¥
->
dŸg¿m
);

591 
d–‘e_li¡
 = 
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
ddi¥
->
dŸg¿m
);

592 
chªge
 = 
	`undo_d–‘e_objeùs_chd»n
(
ddi¥
->
dŸg¿m
, 
d–‘e_li¡
);

593 
	`g_li¡_ä“
(
d–‘e_li¡
);

594 (
chªge
->
­¶y
)(chªge, 
ddi¥
->
dŸg¿m
);

596 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

597 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

599 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

600 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

602 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

603 
	}
}

606 
	$ed™_undo_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

608 
DŸg¿m
 *
dŸ
;

610 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

611 ià(!
dŸ
) ;

614 
	`undo_»v”t_to_Ï¡_
(
dŸ
->
undo
);

615 
	`dŸg¿m_modif›d
(
dŸ
);

616 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸ
);

618 
	`dŸg¿m_æush
(
dŸ
);

619 
	}
}

622 
	$ed™_»do_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

624 
DŸg¿m
 *
dŸ
;

627 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

628 ià(!
dŸ
) ;

630 
	`undo_­¶y_to_Ãxt_
(
dŸ
->
undo
);

631 
	`dŸg¿m_modif›d
(
dŸ
);

632 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸ
);

634 
	`dŸg¿m_æush
(
dŸ
);

635 
	}
}

638 
	$h–p_mªu®_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

640 #ifdeà
GNOME


641 
	`gnome_h–p_di¥Ïy
("dŸ", 
NULL
, NULL);

643 *
h–pdœ
, *
h–pšdex
 = 
NULL
, *
commªd
;

644 
gušt
 
be¡scÜe
 = 
G_MAXINT
;

645 
GDœ
 *
dp
;

646 cÚ¡ *
d’Œy
;

647 
GE¼Ü
 *
”rÜ
 = 
NULL
;

649 
h–pdœ
 = 
	`dŸ_g‘_d©a_dœeùÜy
("help");

650 ià(!
h–pdœ
) {

651 
	`mes§ge_w¬nšg
(
	`_
("Could‚ot find help directory"));

656 
dp
 = 
	`g_dœ_İ’
 (
h–pdœ
, 0, &
”rÜ
);

657 ià(!
dp
) {

658 
	`mes§ge_w¬nšg
(
	`_
("Could‚ot open help directory:\n%s"),

659 
”rÜ
->
mes§ge
);

660 
	`g_”rÜ_ä“
 (
”rÜ
);

664 (
d’Œy
 = 
	`g_dœ_»ad_Çme
(
dp
)è!ğ
NULL
) {

665 
gušt
 
scÜe
;

667 
scÜe
 = 
	`š_scÜe_loÿË
(
d’Œy
);

668 ià(
scÜe
 < 
be¡scÜe
) {

669 ià(
h–pšdex
)

670 
	`g_ä“
(
h–pšdex
);

671 #ifdeà
G_OS_WIN32


673 
h–pšdex
 = 
	`g_¡rcÚÿt
(
h–pdœ
, 
G_DIR_SEPARATOR_S
, 
d’Œy
,

674 
G_DIR_SEPARATOR_S
 "dŸ-mªu®.chm", 
NULL
);

675 ià(!
	`g_fe_‹¡
(
h–pšdex
, 
G_FILE_TEST_EXISTS
)) {

676 
h–pšdex
 = 
	`g_¡rcÚÿt
(
h–pdœ
, 
G_DIR_SEPARATOR_S
, 
d’Œy
,

677 
G_DIR_SEPARATOR_S
 "šdex.html", 
NULL
);

680 
h–pšdex
 = 
	`g_¡rcÚÿt
(
h–pdœ
, 
G_DIR_SEPARATOR_S
, 
d’Œy
,

681 
G_DIR_SEPARATOR_S
 "šdex.html", 
NULL
);

683 
be¡scÜe
 = 
scÜe
;

686 
	`g_dœ_şo£
 (
dp
);

687 
	`g_ä“
(
h–pdœ
);

688 ià(!
h–pšdex
) {

689 
	`mes§ge_w¬nšg
(
	`_
("Could‚ot find help directory"));

693 #ifdeà
G_OS_WIN32


694 
	#SW_SHOWNORMAL
 1

	)

695 
	`Sh–lExecu‹A
 (0, "İ’", 
h–pšdex
, 
NULL
, 
h–pdœ
, 
SW_SHOWNORMAL
);

697 
commªd
 = 
	`g‘’v
("BROWSER");

698 
commªd
 = 
	`g_¡rdup_´štf
("% 'fe://%s' &", commªd ? commªd : "xdg-İ’", 
h–pšdex
);

699 
	`sy¡em
(
commªd
);

700 
	`g_ä“
(
commªd
);

703 
	`g_ä“
(
h–pšdex
);

705 
	}
}

708 
	$aùiv©e_u¾
 (
GtkAboutDŸlog
 *
about
,

709 cÚ¡ 
gch¬
 *
lšk
,

710 
gpoš‹r
 
d©a
)

712 #ifdeà
G_OS_WIN32


713 
	`Sh–lExecu‹A
 (0, "İ’", 
lšk
, 
NULL
, NULL, 
SW_SHOWNORMAL
);

715 
gch¬
 *
commªd
 = 
	`g‘’v
("BROWSER");

716 
commªd
 = 
	`g_¡rdup_´štf
("% '%s' &", commªd ? commªd : "xdg-İ’", 
lšk
);

717 
	`sy¡em
(
commªd
);

718 
	`g_ä“
(
commªd
);

720 
	}
}

723 
	$h–p_about_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

725 cÚ¡ 
gch¬
 *
Œª¦©Üs
 = 
	`_
("translator_credits-PLEASE_ADD_YOURSELF_HERE");

726 cÚ¡ 
gch¬
 *
liûn£
 = 
	`_
(

741 
gch¬
 *
dœÇme
 = 
	`dŸ_g‘_d©a_dœeùÜy
("");

742 
gch¬
 *
f’ame
 = 
	`g_bud_f’ame
 (
dœÇme
, "dŸ-¥Ïsh.²g", 
NULL
);

743 
GdkPixbuf
 *
logo
 = 
	`gdk_pixbuf_Ãw_äom_fe
(
f’ame
, 
NULL
);

745 
	`gtk_about_dŸlog_£t_u¾_hook
 (
aùiv©e_u¾
, 
NULL
, NULL);

746 
	`gtk_show_about_dŸlog
 (
NULL
,

747 "logo", 
logo
,

749 "v”siÚ", 
VERSION
,

750 "comm’ts", 
	`_
("A…rogram for drawing structured diagrams."),

753 "authÜs", 
authÜs
,

754 "docum’‹rs", 
docum’tÜs
,

755 "Œª¦©Ü-üed™s", 
	`¡rcmp
 (
Œª¦©Üs
, "translator_credits-PLEASE_ADD_YOURSELF_HERE")

756 ? 
Œª¦©Üs
 : 
NULL
,

757 "liûn£", 
liûn£
,

758 
NULL
);

759 
	`g_ä“
 (
dœÇme
);

760 
	`g_ä“
 (
f’ame
);

761 ià(
logo
)

762 
	`g_objeù_uÄef
 (
logo
);

763 
	}
}

766 
	$v›w_zoom_š_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

768 
DDi¥Ïy
 *
ddi¥
;

769 
Pošt
 
middË
;

770 
ReùªgË
 *
visibË
;

772 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

773 ià(!
ddi¥
) ;

774 
visibË
 = &
ddi¥
->visible;

775 
middË
.
x
 = 
visibË
->
Ëá
*0.5 + visibË->
right
*0.5;

776 
middË
.
y
 = 
visibË
->
tİ
*0.5 + visibË->
bÙtom
*0.5;

778 
	`ddi¥Ïy_zoom
(
ddi¥
, &
middË
, 
M_SQRT2
);

779 
	}
}

782 
	$v›w_zoom_out_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

784 
DDi¥Ïy
 *
ddi¥
;

785 
Pošt
 
middË
;

786 
ReùªgË
 *
visibË
;

788 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

789 ià(!
ddi¥
) ;

790 
visibË
 = &
ddi¥
->visible;

791 
middË
.
x
 = 
visibË
->
Ëá
*0.5 + visibË->
right
*0.5;

792 
middË
.
y
 = 
visibË
->
tİ
*0.5 + visibË->
bÙtom
*0.5;

794 
	`ddi¥Ïy_zoom
(
ddi¥
, &
middË
, 
M_SQRT1_2
);

795 
	}
}

798 
	$v›w_zoom_£t_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

800 
çùÜ
;

802 
çùÜ
 = 
	`©oi
 (
	`gtk_aùiÚ_g‘_Çme
 (
aùiÚ
è+ 
	`¡¾’
 ("ViewZoom"));

803 
	`v›w_zoom_£t
 (
çùÜ
);

804 
	}
}

807 
	$v›w_show_cx_±s_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
)

809 
DDi¥Ïy
 *
ddi¥
;

810 
Şd_v®
;

812 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

813 ià(!
ddi¥
) ;

815 
Şd_v®
 = 
ddi¥
->
show_cx_±s
;

816 
ddi¥
->
show_cx_±s
 = 
	`gtk_toggË_aùiÚ_g‘_aùive
 (
aùiÚ
);

818 ià(
Şd_v®
 !ğ
ddi¥
->
show_cx_±s
) {

819 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

820 
	`ddi¥Ïy_æush
(
ddi¥
);

822 
	}
}

825 
	$v›w_unfuÎsü“n
 ()

827 
DDi¥Ïy
 *
ddi¥
;

828 
GtkToggËAùiÚ
 *
™em
;

830 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

831 ià(!
ddi¥
) ;

834 
™em
 = 
	`GTK_TOGGLE_ACTION
 (
	`m’us_g‘_aùiÚ
 ("ViewFullscreen"));

835 ià(
™em
 && 
	`gtk_toggË_aùiÚ_g‘_aùive
 (item)) {

836 
	`gtk_toggË_aùiÚ_£t_aùive
 (
™em
, 
FALSE
);

838 
	}
}

841 
	$v›w_fuÎsü“n_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
)

843 
DDi¥Ïy
 *
ddi¥
;

844 
fs
;

846 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

847 ià(!
ddi¥
) ;

849 
fs
 = 
	`gtk_toggË_aùiÚ_g‘_aùive
 (
aùiÚ
);

851 ià(
fs
)

852 
	`gtk_wšdow_fuÎsü“n
(
	`GTK_WINDOW
(
ddi¥
->
sh–l
));

854 
	`gtk_wšdow_unfuÎsü“n
(
	`GTK_WINDOW
(
ddi¥
->
sh–l
));

855 
	}
}

858 
	$v›w_¯_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
)

860 
DDi¥Ïy
 *
ddi¥
;

861 
¯
;

863 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

864 ià(!
ddi¥
) ;

866 
¯
 = 
	`gtk_toggË_aùiÚ_g‘_aùive
 (
aùiÚ
);

868 ià(
¯
 !ğ
ddi¥
->
¯_»nd””
) {

869 
	`ddi¥Ïy_£t_»nd””
(
ddi¥
, 
¯
);

870 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

871 
	`ddi¥Ïy_æush
(
ddi¥
);

873 
	}
}

876 
	$v›w_visibË_grid_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
)

878 
DDi¥Ïy
 *
ddi¥
;

879 
gušt
 
Şd_v®
;

881 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

882 ià(!
ddi¥
) ;

884 
Şd_v®
 = 
ddi¥
->
grid
.
visibË
;

885 
ddi¥
->
grid
.
visibË
 = 
	`gtk_toggË_aùiÚ_g‘_aùive
 (
aùiÚ
);

887 ià(
Şd_v®
 !ğ
ddi¥
->
grid
.
visibË
) {

888 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

889 
	`ddi¥Ïy_æush
(
ddi¥
);

891 
	}
}

894 
	$v›w_¢­_to_grid_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
)

896 
DDi¥Ïy
 *
ddi¥
;

898 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

899 ià(!
ddi¥
) ;

901 
	`ddi¥Ïy_£t_¢­_to_grid
(
ddi¥
, 
	`gtk_toggË_aùiÚ_g‘_aùive
 (
aùiÚ
));

902 
	}
}

905 
	$v›w_¢­_to_objeùs_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
)

907 
DDi¥Ïy
 *
ddi¥
;

909 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

910 ià(!
ddi¥
) ;

912 
	`ddi¥Ïy_£t_¢­_to_objeùs
(
ddi¥
, 
	`gtk_toggË_aùiÚ_g‘_aùive
 (
aùiÚ
));

913 
	}
}

916 
	$v›w_toggË_ruËrs_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
)

918 
DDi¥Ïy
 *
ddi¥
;

920 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

921 ià(!
ddi¥
) ;

923 ià(!
	`gtk_toggË_aùiÚ_g‘_aùive
 (
aùiÚ
)) {

924 ià(
	`di¥Ïy_g‘_ruËrs_showšg
(
ddi¥
)) {

925 
	`di¥Ïy_ruËrs_hide
 (
ddi¥
);

928 ià(!
	`di¥Ïy_g‘_ruËrs_showšg
(
ddi¥
)) {

929 
	`di¥Ïy_ruËrs_show
 (
ddi¥
);

932 
	}
}

935 
	$v›w_Ãw_v›w_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

937 
DŸg¿m
 *
dŸ
;

939 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

940 ià(!
dŸ
) ;

942 
	`Ãw_di¥Ïy
(
dŸ
);

943 
	}
}

946 
	$v›w_şÚe_v›w_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

948 
DDi¥Ïy
 *
ddi¥
;

950 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

951 ià(!
ddi¥
) ;

953 
	`cİy_di¥Ïy
(
ddi¥
);

954 
	}
}

957 
	$v›w_show_®l_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

959 
DDi¥Ïy
 *
ddi¥
;

961 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

962 ià(!
ddi¥
) ;

964 
	`ddi¥Ïy_show_®l
 (
ddi¥
);

965 
	}
}

968 
	$v›w_»d¿w_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

970 
DDi¥Ïy
 *
ddi¥
;

971 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

972 ià(!
ddi¥
) ;

973 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

974 
	`ddi¥Ïy_æush
(
ddi¥
);

975 
	}
}

978 
	$v›w_dŸg¿m_´İ”t›s_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

980 
DDi¥Ïy
 *
ddi¥
;

982 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

983 ià(!
ddi¥
) ;

984 
	`dŸg¿m_´İ”t›s_show
(
ddi¥
->
dŸg¿m
);

985 
	}
}

988 
	$v›w_maš_toŞb¬_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

990 ià(
	`gtk_toggË_aùiÚ_g‘_aùive
 (
	`GTK_TOGGLE_ACTION
(
aùiÚ
)è=ğ
TRUE
)

992 
	`š‹g¿‹d_ui_maš_toŞb¬_show
 ();

996 
	`š‹g¿‹d_ui_maš_toŞb¬_hide
 ();

998 
	}
}

1001 
	$v›w_maš_¡©usb¬_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1003 ià(
	`gtk_toggË_aùiÚ_g‘_aùive
 (
	`GTK_TOGGLE_ACTION
(
aùiÚ
)è=ğ
TRUE
)

1005 
	`š‹g¿‹d_ui_maš_¡©usb¬_show
 ();

1009 
	`š‹g¿‹d_ui_maš_¡©usb¬_hide
 ();

1011 
	}
}

1014 
	$v›w_Ïy”s_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1016 ià(
	`gtk_toggË_aùiÚ_g‘_aùive
 (
	`GTK_TOGGLE_ACTION
(
aùiÚ
)è=ğ
TRUE
)

1018 
	`š‹g¿‹d_ui_Ïy”_v›w_show
 ();

1022 
	`š‹g¿‹d_ui_Ïy”_v›w_hide
 ();

1024 
	}
}

1027 
	$Ïy”s_add_Ïy”_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1029 
DŸg¿m
 *
dŸ
;

1031 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

1032 ià(!
dŸ
) ;

1034 
	`dŸg¿m_ed™_Ïy”
 (
dŸ
, 
NULL
);

1035 
	}
}

1038 
	$Ïy”s_»Çme_Ïy”_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1040 
DŸg¿m
 *
dŸ
;

1042 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

1043 ià(!
dŸ
) ;

1045 
	`dŸg¿m_ed™_Ïy”
 (
dŸ
, dŸ->
d©a
->
aùive_Ïy”
);

1046 
	}
}

1049 
	$objeùs_¶aû_ov”_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1051 
	`dŸg¿m_¶aû_ov”_£Ëùed
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1052 
	}
}

1055 
	$objeùs_¶aû_und”_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1057 
	`dŸg¿m_¶aû_und”_£Ëùed
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1058 
	}
}

1061 
	$objeùs_¶aû_up_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1063 
	`dŸg¿m_¶aû_up_£Ëùed
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1064 
	}
}

1067 
	$objeùs_¶aû_down_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1069 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

1070 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

1072 
	`dŸg¿m_¶aû_down_£Ëùed
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1073 
	}
}

1076 
	$objeùs_·»Á_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1078 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

1079 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

1081 
	`dŸg¿m_·»Á_£Ëùed
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1082 
	}
}

1085 
	$objeùs_uÅ¬’t_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1087 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

1088 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

1090 
	`dŸg¿m_uÅ¬’t_£Ëùed
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1091 
	}
}

1094 
	$objeùs_uÅ¬’t_chd»n_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1096 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

1097 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

1099 
	`dŸg¿m_uÅ¬’t_chd»n_£Ëùed
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1100 
	}
}

1103 
	$objeùs_group_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1105 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

1106 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

1108 
	`dŸg¿m_group_£Ëùed
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1109 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

1110 
	}
}

1113 
	$objeùs_ungroup_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1115 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

1116 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

1118 
	`dŸg¿m_ungroup_£Ëùed
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1119 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

1120 
	}
}

1123 
	$dŸlogs_´İ”t›s_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1125 
DŸg¿m
 *
dŸ
;

1126 
DŸObjeù
 *
£Ëùed
;

1128 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

1129 ià(!
dŸ
 || 
	`‹x‹d™_mode
(
	`ddi¥Ïy_aùive
())) ;

1131 ià(
dŸ
->
d©a
->
£Ëùed
 !ğ
NULL
) {

1132 
	`objeù_li¡_´İ”t›s_show
(
dŸ
, dŸ->
d©a
->
£Ëùed
);

1134 
	`dŸg¿m_´İ”t›s_show
(
dŸ
);

1136 
	}
}

1139 
	$dŸlogs_Ïy”s_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1141 
	`Ïy”_dŸlog_£t_dŸg¿m
(
	`ddi¥Ïy_aùive_dŸg¿m
());

1142 
	`Ïy”_dŸlog_show
();

1143 
	}
}

1147 
	$objeùs_®ign_h_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1149 cÚ¡ 
gch¬
 *
a
;

1150 
®ign
 = 
DIA_ALIGN_LEFT
;

1151 
DŸg¿m
 *
dŸ
;

1152 
GLi¡
 *
objeùs
;

1154 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

1155 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

1158 
a
 = 
	`gtk_aùiÚ_g‘_Çme
 (
aùiÚ
è+ 
	`¡¾’
 ("ObjectsAlign");

1159 ià(0 =ğ
	`¡rcmp
 ("Leá", 
a
)) {

1160 
®ign
 = 
DIA_ALIGN_LEFT
;

1162 ià(0 =ğ
	`¡rcmp
 ("C’‹r", 
a
)) {

1163 
®ign
 = 
DIA_ALIGN_CENTER
;

1165 ià(0 =ğ
	`¡rcmp
 ("Right", 
a
)) {

1166 
®ign
 = 
DIA_ALIGN_RIGHT
;

1168 ià(0 =ğ
	`¡rcmp
 ("S´—douthÜizÚÎy", 
a
)) {

1169 
®ign
 = 
DIA_ALIGN_EQUAL
;

1171 ià(0 =ğ
	`¡rcmp
 ("AdjaûÁ", 
a
)) {

1172 
®ign
 = 
DIA_ALIGN_ADJACENT
;

1175 
	`g_w¬nšg
 ("objects_align_v_callback() called without‡ppropriate‡lign");

1179 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

1180 ià(!
dŸ
) ;

1181 
objeùs
 = 
dŸ
->
d©a
->
£Ëùed
;

1183 
	`objeù_add_upd©es_li¡
(
objeùs
, 
dŸ
);

1184 
	`objeù_li¡_®ign_h
(
objeùs
, 
dŸ
, 
®ign
);

1185 
	`dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
dŸ
);

1186 
	`objeù_add_upd©es_li¡
(
objeùs
, 
dŸ
);

1187 
	`dŸg¿m_modif›d
(
dŸ
);

1188 
	`dŸg¿m_æush
(
dŸ
);

1190 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1191 
	}
}

1194 
	$objeùs_®ign_v_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
)

1196 cÚ¡ 
gch¬
 *
a
;

1197 
®ign
;

1198 
DŸg¿m
 *
dŸ
;

1199 
GLi¡
 *
objeùs
;

1201 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

1202 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

1205 
a
 = 
	`gtk_aùiÚ_g‘_Çme
 (
aùiÚ
è+ 
	`¡¾’
 ("ObjectsAlign");

1206 ià(0 =ğ
	`¡rcmp
 ("Tİ", 
a
)) {

1207 
®ign
 = 
DIA_ALIGN_TOP
;

1209 ià(0 =ğ
	`¡rcmp
 ("MiddË", 
a
)) {

1210 
®ign
 = 
DIA_ALIGN_CENTER
;

1212 ià(0 =ğ
	`¡rcmp
 ("BÙtom", 
a
)) {

1213 
®ign
 = 
DIA_ALIGN_BOTTOM
;

1215 ià(0 =ğ
	`¡rcmp
 ("S´—doutv”tiÿÎy", 
a
)) {

1216 
®ign
 = 
DIA_ALIGN_EQUAL
;

1218 ià(0 =ğ
	`¡rcmp
 ("Scked", 
a
)) {

1219 
®ign
 = 
DIA_ALIGN_ADJACENT
;

1222 
	`g_w¬nšg
 ("objects_align_v_callback() called without‡ppropriate‡lign");

1226 
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

1227 ià(!
dŸ
) ;

1228 
objeùs
 = 
dŸ
->
d©a
->
£Ëùed
;

1230 
	`objeù_add_upd©es_li¡
(
objeùs
, 
dŸ
);

1231 
	`objeù_li¡_®ign_v
(
objeùs
, 
dŸ
, 
®ign
);

1232 
	`dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
dŸ
);

1233 
	`objeù_add_upd©es_li¡
(
objeùs
, 
dŸ
);

1234 
	`dŸg¿m_modif›d
(
dŸ
);

1235 
	`dŸg¿m_æush
(
dŸ
);

1237 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1238 
	}
}

	@O:\tool\dvs50\app\commands.h

18 #iâdeà
COMMANDS_H


19 
	#COMMANDS_H


	)

21 
	~<gtk/gtk.h
>

23 
fe_qu™_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

24 
fe_·ge£tup_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

25 
fe_´št_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

26 
fe_şo£_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

27 
fe_Ãw_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

28 
fe_´eã»nûs_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

30 
h–p_mªu®_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

31 
h–p_about_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

33 
ed™_cİy_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

34 
ed™_cut_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

35 
ed™_·¡e_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

36 
ed™_du¶iÿ‹_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

37 
ed™_d–‘e_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

38 
ed™_undo_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

39 
ed™_»do_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

40 
ed™_·¡e_‹xt_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

41 
ed™_cİy_‹xt_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

42 
ed™_cut_‹xt_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

44 
»ûived_£ËùiÚ_hªdËr
 (
GtkWidg‘
 *
widg‘
, 
GtkS–eùiÚD©a
 *
£ËùiÚ
,

45 
gpoš‹r
 
d©a
);

46 
g‘_£ËùiÚ_hªdËr
(
GtkWidg‘
 *
widg‘
, 
GtkS–eùiÚD©a
 *
£ËùiÚ
,

47 
gpoš‹r
 
d©a
);

49 
v›w_zoom_š_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

50 
v›w_zoom_out_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

51 
v›w_zoom_£t_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

52 
v›w_unfuÎsü“n
 ();

53 
v›w_fuÎsü“n_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
);

54 
v›w_¯_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
);

55 
v›w_visibË_grid_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
);

56 
v›w_¢­_to_grid_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
);

57 
v›w_¢­_to_objeùs_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
);

58 
v›w_toggË_ruËrs_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
);

59 
v›w_show_cx_±s_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
);

60 
v›w_Ãw_v›w_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

61 
v›w_şÚe_v›w_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

62 
v›w_show_®l_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

63 
v›w_»d¿w_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

64 
v›w_dŸg¿m_´İ”t›s_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

67 
v›w_maš_toŞb¬_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

68 
v›w_maš_¡©usb¬_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

69 
v›w_Ïy”s_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

71 
Ïy”s_add_Ïy”_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

72 
Ïy”s_»Çme_Ïy”_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

74 
objeùs_¶aû_ov”_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

75 
objeùs_¶aû_und”_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

76 
objeùs_¶aû_up_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

77 
objeùs_¶aû_down_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

78 
objeùs_move_up_Ïy”
 (
GtkAùiÚ
 *
aùiÚ
);

79 
objeùs_move_down_Ïy”
 (
GtkAùiÚ
 *
aùiÚ
);

81 
objeùs_·»Á_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

82 
objeùs_uÅ¬’t_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

83 
objeùs_uÅ¬’t_chd»n_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

84 
objeùs_group_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

85 
objeùs_ungroup_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

86 
objeùs_®ign_h_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

87 
objeùs_®ign_v_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

89 
dŸlogs_´İ”t›s_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

90 
dŸlogs_Ïy”s_ÿÎback
 (
GtkAùiÚ
 *
aùiÚ
);

	@O:\tool\dvs50\app\confirm.c

23 
	~<cÚfig.h
>

25 
	~"cÚfœm.h
"

26 
	~"š.h
"

28 
gšt


29 
	$cÚfœm_»¥Úd
 (
GtkWidg‘
 *
widg‘
, 
gšt
 
»¥Ú£_id
, 
gpoš‹r
 
d©a
)

32 
	`gtk_widg‘_hide
 (
widg‘
);

34 
	}
}

39 
gboŞ—n


40 
	$cÚfœm_expÜt_size
 (
DŸg¿m
 *
dŸ
, 
GtkWšdow
 *
·»Á
, 
gušt
 
æags
)

42 
GtkWidg‘
 *
dŸlog
;

43 
·ges
 = 0;

44 
gšt64
 
by‹s
 = 0;

45 
gch¬
 *
size
, *
msg
;

46 
gboŞ—n
 
»t
;

48 
·ges
 = 
	`û
((
dŸ
->
d©a
->
ex‹Ás
.
right
 - dŸ->d©a->ex‹Ás.
Ëá
è/ dŸ->d©a->
·³r
.
width
)

49 * 
	`û
((
dŸ
->
d©a
->
ex‹Ás
.
bÙtom
 - dŸ->d©a->ex‹Ás.
tİ
è/ dŸ->d©a->
·³r
.
height
);

51 
by‹s
 = (
gšt64
)4

52 * 
	`û
((
dŸ
->
d©a
->
ex‹Ás
.
right
 - dŸ->d©a->ex‹Ás.
Ëá
è* dŸ->d©a->
·³r
.
sÿlšg
 * 20)

53 * 
	`û
((
dŸ
->
d©a
->
ex‹Ás
.
bÙtom
 - dŸ->d©a->ex‹Ás.
tİ
è* dŸ->d©a->
·³r
.
sÿlšg
 * 20);

55 ià((
æags
 & 
CONFIRM_PRINT
è&& (
·ges
 < 10))

56  
TRUE
;

57 ià((
æags
 & 
CONFIRM_MEMORY
è&& (
by‹s
 < (
	`G_GINT64_CONSTANT
(100)<<16)))

58  
TRUE
;

59 ià((
æags
 & 
CONFIRM_PAGES
è&& (
·ges
 < 50))

60  
TRUE
;

63 #ià
	`GLIB_CHECK_VERSION
(2,16,0)

64 
size
 = 
	`g_fÜm©_size_fÜ_di¥Ïy
 (
by‹s
);

66 
size
 = 
	`g_¡rdup_´štf
 ("%d MB", (
gušt
)(
by‹s
 >> 20));

68 ià(
æags
 & 
CONFIRM_PRINT
)

69 
msg
 = 
	`g_¡rdup_´štf
 (
	`_
("You‡»‡bouˆtØ´šˆ¨dŸg¿m w™h %d…ages."), 
·ges
);

70 ià((
æags
 & ~
CONFIRM_PAGES
) == 0)

71 
msg
 = 
	`g_¡rdup_´štf
 (
	`_
("You‡»‡bouˆtØexpÜˆ¨dŸg¿m w™h %d…ages."), 
·ges
);

73 
msg
 = 
	`g_¡rdup_´štf
 (
	`_
("You‡re‡boutoƒxport‡ diagram "

74 "which may„equœ% oàmemÜy.(%d…ages)."), 
size
, 
·ges
);

75 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
 (
·»Á
,

76 
GTK_DIALOG_MODAL
|
GTK_DIALOG_DESTROY_WITH_PARENT
,

77 
GTK_MESSAGE_WARNING
,

78 
GTK_BUTTONS_OK_CANCEL
,

79 "%s", 
msg
);

80 
	`gtk_mes§ge_dŸlog_fÜm©_£cÚd¬y_‹xt
 (
	`GTK_MESSAGE_DIALOG
 (
dŸlog
),

81 
	`_
("You can‡djusthe size ofhe diagram by changing "

85 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
dŸlog
), 
	`_
("Confirm Diagram Size"));

86 
	`g_ä“
 (
size
);

88 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
dŸlog
), "response",

89 
	`G_CALLBACK
(
cÚfœm_»¥Úd
), 
NULL
);

91 
»t
 = (
GTK_RESPONSE_OK
 =ğ
	`gtk_dŸlog_run
 (
	`GTK_DIALOG
 (
dŸlog
)));

92 
	`gtk_widg‘_de¡roy
(
dŸlog
);

93  
»t
;

94 
	}
}

	@O:\tool\dvs50\app\confirm.h

1 
	~<gtk/gtk.h
>

2 
	~"dŸg¿m.h
"

5 
	mCONFIRM_PAGES
 = (1<<0),

6 
	mCONFIRM_MEMORY
 = (1<<1),

7 
	mCONFIRM_PRINT
 = (1<<2)

8 } 
	tCÚfœm©iÚKšd
;

10 
gboŞ—n
 
cÚfœm_expÜt_size
 (
DŸg¿m
 *
dŸ
, 
GtkWšdow
 *
·»Á
, 
gušt
 
æags
);

	@O:\tool\dvs50\app\connectionpoint_ops.c

18 
	~<cÚfig.h
>

20 
	~<as£¹.h
>

22 
	~"cÚÃùiÚpošt_İs.h
"

23 
	~"objeù_İs.h
"

24 
	~"cŞÜ.h
"

26 
CŞÜ
 
	gcÚÃùiÚpošt_cŞÜ
 = { 0.4, 0.4, 1.0 };

28 
	#CP_SZ
 (
CONNECTIONPOINT_SIZE
/2)

	)

31 
	$cÚÃùiÚpošt_d¿w
(
CÚÃùiÚPošt
 *
cÚpošt
,

32 
DDi¥Ïy
 *
ddi¥
)

34 
x
,
y
;

35 
Pošt
 *
pošt
 = &
cÚpošt
->
pos
;

36 
DŸR’d””
 *
»nd””
 = 
ddi¥
->renderer;

37 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
ddi¥
->
»nd””
);

38 
DŸIÁ”aùiveR’d””IÁ”çû
 *
œ’d””
 =

39 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ddi¥
->
»nd””
);

43 ià(
cÚpošt
->
æags
 & 
CP_FLAG_ANYPLACE
) {

44 ià(!
ddi¥
->
mašpošt_magÃtism
) {

45 
CŞÜ
 
midpošt_cŞÜ
 = { 1.0, 0.0, 0.0 };

47 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
pošt
->
x
,…ošt->
y
, &x, &y);

49 
œ’d””
->
	`d¿w_pix–_lše
 (
»nd””
,

50 
x
-
CP_SZ
,
y
-CP_SZ,

51 
x
+
CP_SZ
,
y
+CP_SZ,

52 &
midpošt_cŞÜ
);

54 
œ’d””
->
	`d¿w_pix–_lše
 (
»nd””
,

55 
x
+
CP_SZ
,
y
-CP_SZ,

56 
x
-
CP_SZ
,
y
+CP_SZ,

57 &
midpošt_cŞÜ
);

62 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
pošt
->
x
,…ošt->
y
, &x, &y);

64 
»nd””_İs
->
	`£t_lšewidth
 (
»nd””
, 0.0);

65 
»nd””_İs
->
	`£t_lše¡yË
 (
»nd””
, 
LINESTYLE_SOLID
);

67 
œ’d””
->
	`d¿w_pix–_lše
 (
»nd””
,

68 
x
-
CP_SZ
,
y
-CP_SZ,

69 
x
+
CP_SZ
,
y
+CP_SZ,

70 &
cÚÃùiÚpošt_cŞÜ
);

72 
œ’d””
->
	`d¿w_pix–_lše
 (
»nd””
,

73 
x
+
CP_SZ
,
y
-CP_SZ,

74 
x
-
CP_SZ
,
y
+CP_SZ,

75 &
cÚÃùiÚpošt_cŞÜ
);

76 
	}
}

79 
	$cÚÃùiÚpošt_add_upd©e
(
CÚÃùiÚPošt
 *
cÚpošt
,

80 
DŸg¿m
 *
dŸ
)

82 
	`dŸg¿m_add_upd©e_pix–s
(
dŸ
, &
cÚpošt
->
pos
,

83 
CONNECTIONPOINT_SIZE
, CONNECTIONPOINT_SIZE);

84 
	}
}

88 
	$dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
DŸg¿m
 *
dŸ
)

90 
GLi¡
 *
li¡
 = 
dŸ
->
d©a
->
£Ëùed
;

92 
li¡
!=
NULL
) {

93 
DŸObjeù
 * 
£Ëùed_obj
 = (DŸObjeù *è
li¡
->
d©a
;

95 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
, 
£Ëùed_obj
, 
TRUE
);

97 
li¡
 = 
	`g_li¡_Ãxt
(list);

99 
	}
}

109 
	$dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
,

110 
upd©e_nÚmoved
)

112 
i
,
j
;

113 
CÚÃùiÚPošt
 *
ı
;

114 
GLi¡
 *
li¡
;

115 
DŸObjeù
 *
cÚÃùed_obj
;

116 
HªdË
 *
hªdË
;

118 
i
=0;i<
obj
->
num_cÚÃùiÚs
;i++) {

119 
ı
 = 
obj
->
cÚÃùiÚs
[
i
];

120 ià((
upd©e_nÚmoved
) ||

121 (
	`di¡ªû_pošt_pošt_mªh©n
(&
ı
->
pos
, &ı->
Ï¡_pos
è> 
CHANGED_TRESHOLD
)) {

122 
ı
->
Ï¡_pos
 = cp->
pos
;

124 
li¡
 = 
ı
->
cÚÃùed
;

125 
li¡
!=
NULL
) {

126 
cÚÃùed_obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

128 
	`objeù_add_upd©es
(
cÚÃùed_obj
, 
dŸ
);

129 
hªdË
 = 
NULL
;

130 
j
=0;j<
cÚÃùed_obj
->
num_hªdËs
;j++) {

131 ià(
cÚÃùed_obj
->
hªdËs
[
j
]->
cÚÃùed_to
 =ğ
ı
) {

132 
hªdË
 = 
cÚÃùed_obj
->
hªdËs
[
j
];

133 
cÚÃùed_obj
->
İs
->
	`move_hªdË
(cÚÃùed_obj, 
hªdË
, &
ı
->
pos
,

134 
ı
, 
HANDLE_MOVE_CONNECTED
,0);

137 
	`objeù_add_upd©es
(
cÚÃùed_obj
, 
dŸ
);

139 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
, 
cÚÃùed_obj
, 
FALSE
);

141 
li¡
 = 
	`g_li¡_Ãxt
(list);

145 ià(
obj
->
chd»n
) {

146 
GLi¡
 *
chd
;

147 
chd
 = 
obj
->
chd»n
; chd !ğ
NULL
; chd = chd->
Ãxt
) {

148 
DŸObjeù
 *
chd_obj
 = (DŸObjeù *)
chd
->
d©a
;

149 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
, 
chd_obj
, 
upd©e_nÚmoved
);

152 
	}
}

155 
	$ddi¥Ïy_cÚÃù_£Ëùed
(
DDi¥Ïy
 *
ddi¥
)

157 
GLi¡
 *
li¡
;

158 
DŸObjeù
 *
£Ëùed_obj
;

159 
i
;

161 
li¡
 = 
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
;

163 
li¡
!=
NULL
) {

164 
£Ëùed_obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

166 
i
=0; i<
£Ëùed_obj
->
num_hªdËs
; i++) {

167 ià(
£Ëùed_obj
->
hªdËs
[
i
]->
cÚÃù_ty³
 !ğ
HANDLE_NONCONNECTABLE
) {

168 
	`objeù_cÚÃù_di¥Ïy
(
ddi¥
, 
£Ëùed_obj
, s–eùed_obj->
hªdËs
[
i
], 
FALSE
);

172 
li¡
 = 
	`g_li¡_Ãxt
(list);

174 
	}
}

177 
	$dŸg¿m_uncÚÃù_£Ëùed
(
DŸg¿m
 *
dŸ
)

179 
GLi¡
 *
li¡
;

180 
DŸObjeù
 *
£Ëùed_obj
;

181 
HªdË
 *
hªdË
;

182 
i
;

184 
li¡
 = 
dŸ
->
d©a
->
£Ëùed
;

186 
li¡
!=
NULL
) {

187 
£Ëùed_obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

189 
i
=0; i<
£Ëùed_obj
->
num_hªdËs
; i++) {

190 
hªdË
 = 
£Ëùed_obj
->
hªdËs
[
i
];

192 ià((
hªdË
->
cÚÃùed_to
 !ğ
NULL
) &&

193 (
hªdË
->
cÚÃù_ty³
 =ğ
HANDLE_CONNECTABLE
)){

195 ià(!
	`dŸg¿m_is_£Ëùed
(
dŸ
, 
hªdË
->
cÚÃùed_to
->
objeù
)) {

196 
Chªge
 *
chªge
 = 
	`undo_uncÚÃù
(
dŸ
, 
£Ëùed_obj
, 
hªdË
);

197 (
chªge
->
­¶y
)(chªge, 
dŸ
);

202 
li¡
 = 
	`g_li¡_Ãxt
(list);

204 
	}
}

	@O:\tool\dvs50\app\connectionpoint_ops.h

18 #iâdeà
CONNECTIONPOINT_OPS_H


19 
	#CONNECTIONPOINT_OPS_H


	)

21 
	~"cÚÃùiÚpošt.h
"

22 
	~"dŸg¿m.h
"

23 
	~"di¥Ïy.h
"

25 
cÚÃùiÚpošt_d¿w
(
CÚÃùiÚPošt
 *
cÚpošt
,

26 
DDi¥Ïy
 *
ddi¥
);

27 
cÚÃùiÚpošt_add_upd©e
(
CÚÃùiÚPošt
 *
cÚpošt
,

28 
DŸg¿m
 *
dŸ
);

29 
DIAVAR
 
dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
DŸg¿m
 *
dŸ
);

30 
dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
,

31 
upd©e_nÚmoved
);

32 
DIAVAR
 
ddi¥Ïy_cÚÃù_£Ëùed
(
DDi¥Ïy
 *
ddi¥
);

33 
dŸg¿m_uncÚÃù_£Ëùed
(
DŸg¿m
 *
dŸ
);

	@O:\tool\dvs50\app\create_object.c

18 
	~<cÚfig.h
>

20 
	~"ü—‹_objeù.h
"

21 
	~"cÚÃùiÚpošt_İs.h
"

22 
	~"hªdË_İs.h
"

23 
	~"objeù_İs.h
"

24 
	~"´eã»nûs.h
"

25 
	~"undo.h
"

26 
	~"cursÜ.h
"

27 
	~"highlight.h
"

28 
	~"‹x‹d™.h
"

29 
	~"·»Á.h
"

30 
	~"mes§ge.h
"

32 
ü—‹_objeù_bu‰Ú_´ess
(
C»©eObjeùToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

33 
DDi¥Ïy
 *
ddi¥
);

34 
ü—‹_objeù_bu‰Ú_»Ëa£
(
C»©eObjeùToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

35 
DDi¥Ïy
 *
ddi¥
);

36 
ü—‹_objeù_mÙiÚ
(
C»©eObjeùToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

37 
DDi¥Ïy
 *
ddi¥
);

38 
ü—‹_objeù_doubË_şick
(
C»©eObjeùToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

39 
DDi¥Ïy
 *
ddi¥
);

43 
	$ü—‹_objeù_bu‰Ú_´ess
(
C»©eObjeùToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

44 
DDi¥Ïy
 *
ddi¥
)

46 
Pošt
 
şickedpošt
, 
Üigpošt
;

47 
HªdË
 *
hªdË1
;

48 
HªdË
 *
hªdË2
;

49 
DŸObjeù
 *
obj
;

50 
»®
 
şick_di¡ªû
;

52 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
,

53 ()
ev’t
->
x
, (ëv’t->
y
,

54 &
şickedpošt
.
x
, &şickedpošt.
y
);

56 
Üigpošt
 = 
şickedpošt
;

58 
	`¢­_to_grid
(
ddi¥
, &
şickedpošt
.
x
, &şickedpošt.
y
);

60 
şick_di¡ªû
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 3.0);

62 
obj
 = 
	`dŸ_objeù_deçuÉ_ü—‹
 (
toŞ
->
objty³
, &
şickedpošt
,

63 
toŞ
->
u£r_d©a
,

64 &
hªdË1
, &
hªdË2
);

66 
toŞ
->
obj
 = obj;

68 ià(!
obj
) {

69 
toŞ
->
movšg
 = 
FALSE
;

70 
toŞ
->
hªdË
 = 
NULL
;

71 
	`mes§ge_”rÜ
(
	`_
("'%s' c»©iÚ faed"), 
toŞ
->
objty³
 ?oŞ->objty³->
Çme
 : "NULL");

75 
	`dŸg¿m_add_objeù
(
ddi¥
->
dŸg¿m
, 
obj
);

78 ià(
hªdË1
 !ğ
NULL
 &&

79 
hªdË1
->
cÚÃù_ty³
 !ğ
HANDLE_NONCONNECTABLE
) {

80 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
;

81 
cÚÃùiÚpošt
 =

82 
	`objeù_fšd_cÚÃùpošt_di¥Ïy
(
ddi¥
, &
Üigpošt
, 
obj
, 
TRUE
);

83 ià(
cÚÃùiÚpošt
 !ğ
NULL
) {

84 (
obj
->
İs
->
move
)(obj, &
Üigpošt
);

88 ià(!(
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
)) {

90 
	`dŸg¿m_»move_®l_£Ëùed
(
ddi¥
->
dŸg¿m
, 
TRUE
);

92 
	`dŸg¿m_£Ëù
(
ddi¥
->
dŸg¿m
, 
obj
);

95 ià((
hªdË1
!ğ
NULL
) &&

96 (
hªdË1
->
cÚÃù_ty³
 !ğ
HANDLE_NONCONNECTABLE
)) {

97 
	`objeù_cÚÃù_di¥Ïy
(
ddi¥
, 
obj
, 
hªdË1
, 
TRUE
);

100 
	`objeù_add_upd©es
(
obj
, 
ddi¥
->
dŸg¿m
);

101 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

102 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

104 ià(
hªdË2
 !ğ
NULL
) {

105 
toŞ
->
hªdË
 = 
hªdË2
;

106 
toŞ
->
movšg
 = 
TRUE
;

107 
toŞ
->
Ï¡_to
 = 
hªdË2
->
pos
;

109 
	`gdk_poš‹r_g¿b
 (
ddi¥
->
ÿnvas
->
wšdow
, 
FALSE
,

110 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

111 
NULL
, NULL, 
ev’t
->
time
);

112 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_SCROLL
));

114 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

115 
toŞ
->
movšg
 = 
FALSE
;

118 
	}
}

121 
	$ü—‹_objeù_doubË_şick
(
C»©eObjeùToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

122 
DDi¥Ïy
 *
ddi¥
)

124 
	}
}

127 
	$ü—‹_objeù_bu‰Ú_»Ëa£
(
C»©eObjeùToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

128 
DDi¥Ïy
 *
ddi¥
)

130 
GLi¡
 *
li¡
 = 
NULL
;

131 
DŸObjeù
 *
obj
 = 
toŞ
->obj;

132 
gboŞ—n
 
»£t
;

134 
GLi¡
 *
·»Á_ÿndid©es
;

136 
	`g_»tuº_if_ç
 (
obj
 !ğ
NULL
);

137 ià(!
obj
)

140 ià(
toŞ
->
movšg
) {

141 
	`gdk_poš‹r_ung¿b
 (
ev’t
->
time
);

143 
	`objeù_add_upd©es
(
toŞ
->
obj
, 
ddi¥
->
dŸg¿m
);

144 
toŞ
->
obj
->
İs
->
	`move_hªdË
ÑoŞ->obj,oŞ->
hªdË
, &toŞ->
Ï¡_to
,

145 
NULL
, 
HANDLE_MOVE_CREATE_FINAL
, 0);

146 
	`objeù_add_upd©es
(
toŞ
->
obj
, 
ddi¥
->
dŸg¿m
);

150 
·»Á_ÿndid©es
 =

151 
	`Ïy”_fšd_objeùs_cÚššg_»ùªgË
(
obj
->
·»Á_Ïy”
,

152 &
obj
->
boundšg_box
);

155 ; 
·»Á_ÿndid©es
 !ğ
NULL
;…¬’t_ÿndid©e ğ
	`g_li¡_Ãxt
(parent_candidates)) {

156 
DŸObjeù
 *
·»Á_obj
 = (DŸObjeù *è
·»Á_ÿndid©es
->
d©a
;

157 ià(
obj
 !ğ
·»Á_obj


158 && 
	`objeù_w™hš_·»Á
(
obj
, 
·»Á_obj
)) {

159 
Chªge
 *
chªge
 = 
	`undo_·»Ášg
(
ddi¥
->
dŸg¿m
, 
·»Á_obj
, 
obj
, 
TRUE
);

160 (
chªge
->
­¶y
)(chªge, 
ddi¥
->
dŸg¿m
);

168 
	`g_li¡_ä“
(
·»Á_ÿndid©es
);

170 
li¡
 = 
	`g_li¡_´•’d
Öi¡, 
toŞ
->
obj
);

172 
	`undo_š£¹_objeùs
(
ddi¥
->
dŸg¿m
, 
li¡
, 1);

174 ià(
toŞ
->
movšg
) {

175 ià(
toŞ
->
hªdË
->
cÚÃù_ty³
 !ğ
HANDLE_NONCONNECTABLE
) {

176 
	`objeù_cÚÃù_di¥Ïy
(
ddi¥
, 
toŞ
->
obj
,oŞ->
hªdË
, 
TRUE
);

177 
	`dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
ddi¥
->
dŸg¿m
);

178 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

180 
toŞ
->
movšg
 = 
FALSE
;

181 
toŞ
->
hªdË
 = 
NULL
;

182 
toŞ
->
obj
 = 
NULL
;

187 
GtkStusb¬
 *
¡©usb¬
 = 
	`GTK_STATUSBAR
 (
ddi¥
->
modif›d_¡©us
);

188 
gušt
 
cÚ‹xt_id
 = 
	`gtk_¡©usb¬_g‘_cÚ‹xt_id
 (
¡©usb¬
, "ObjectPos");

189 
	`gtk_¡©usb¬_pİ
 (
¡©usb¬
, 
cÚ‹xt_id
);

192 
	`highlight_»£t_®l
(
ddi¥
->
dŸg¿m
);

193 
»£t
 = 
´efs
.
»£t_toŞs_aá”_ü—‹
 !ğ
toŞ
->
šv”t_³rsi¡’û
;

195 ià(
	`‹x‹d™_aùiv©e_objeù
(
ddi¥
, 
obj
, 
NULL
è&& 
»£t
) {

196 
	`gtk_aùiÚ_aùiv©e
 (
	`m’us_g‘_aùiÚ
 ("ToolsTextedit"));

197 
»£t
 = 
FALSE
;

199 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

200 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

202 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

204 ià(
»£t
)

205 
	`toŞ_»£t
();

206 
	`ddi¥Ïy_£t_®l_cursÜ
(
deçuÉ_cursÜ
);

207 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

208 
	}
}

211 
	$ü—‹_objeù_mÙiÚ
(
C»©eObjeùToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

212 
DDi¥Ïy
 *
ddi¥
)

214 
Pošt
 
to
;

215 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
 = 
NULL
;

216 
gch¬
 *
po¡ext
;

217 
GtkStusb¬
 *
¡©usb¬
;

218 
gušt
 
cÚ‹xt_id
;

220 ià(!
toŞ
->
movšg
)

223 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
, 
ev’t
->
x
,ƒv’t->
y
, &
to
.x, &to.y);

226 
	`·»Á_hªdË_move_out_check
(
toŞ
->
obj
, &
to
);

229 ià(
toŞ
->
hªdË
 !ğ
NULL
 &&

230 
toŞ
->
hªdË
->
cÚÃù_ty³
 !ğ
HANDLE_NONCONNECTABLE
) {

231 
cÚÃùiÚpošt
 =

232 
	`objeù_fšd_cÚÃùpošt_di¥Ïy
(
ddi¥
, &
to
, 
toŞ
->
obj
, 
TRUE
);

234 ià(
cÚÃùiÚpošt
 !ğ
NULL
) {

235 
to
 = 
cÚÃùiÚpošt
->
pos
;

236 
	`highlight_objeù
(
cÚÃùiÚpošt
->
objeù
, 
NULL
, 
ddi¥
->
dŸg¿m
);

237 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_CONNECT
));

241 ià(
cÚÃùiÚpošt
 =ğ
NULL
) {

243 
	`¢­_to_grid
(
ddi¥
, &
to
.
x
, &to.
y
);

244 
	`highlight_»£t_®l
(
ddi¥
->
dŸg¿m
);

245 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_SCROLL
));

248 
	`objeù_add_upd©es
(
toŞ
->
obj
, 
ddi¥
->
dŸg¿m
);

249 
toŞ
->
obj
->
İs
->
	`move_hªdË
ÑoŞ->obj,oŞ->
hªdË
, &
to
, 
cÚÃùiÚpošt
,

250 
HANDLE_MOVE_CREATE
, 0);

251 
	`objeù_add_upd©es
(
toŞ
->
obj
, 
ddi¥
->
dŸg¿m
);

254 
¡©usb¬
 = 
	`GTK_STATUSBAR
 (
ddi¥
->
modif›d_¡©us
);

255 
cÚ‹xt_id
 = 
	`gtk_¡©usb¬_g‘_cÚ‹xt_id
 (
¡©usb¬
, "ObjectPos");

257 
po¡ext
 = 
	`g_¡rdup_´štf
("%.3f, %.3f - %.3f, %.3f",

258 
toŞ
->
obj
->
boundšg_box
.
Ëá
,

259 
toŞ
->
obj
->
boundšg_box
.
tİ
,

260 
toŞ
->
obj
->
boundšg_box
.
right
,

261 
toŞ
->
obj
->
boundšg_box
.
bÙtom
);

263 
	`gtk_¡©usb¬_pİ
 (
¡©usb¬
, 
cÚ‹xt_id
);

264 
	`gtk_¡©usb¬_push
 (
¡©usb¬
, 
cÚ‹xt_id
, 
po¡ext
);

266 
	`g_ä“
(
po¡ext
);

268 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

270 
toŞ
->
Ï¡_to
 = 
to
;

273 
	}
}

277 
ToŞ
 *

278 
	$ü—‹_ü—‹_objeù_toŞ
(
DŸObjeùTy³
 *
objty³
, *
u£r_d©a
,

279 
šv”t_³rsi¡’û
)

281 
C»©eObjeùToŞ
 *
toŞ
;

283 
toŞ
 = 
	`g_Ãw0
(
C»©eObjeùToŞ
, 1);

284 
toŞ
->toŞ.
ty³
 = 
CREATE_OBJECT_TOOL
;

285 
toŞ
->toŞ.
bu‰Ú_´ess_func
 = (
Bu‰ÚP»ssFunc
è&
ü—‹_objeù_bu‰Ú_´ess
;

286 
toŞ
->toŞ.
bu‰Ú_»Ëa£_func
 = (
Bu‰ÚR–—£Func
è&
ü—‹_objeù_bu‰Ú_»Ëa£
;

287 
toŞ
->toŞ.
mÙiÚ_func
 = (
MÙiÚFunc
è&
ü—‹_objeù_mÙiÚ
;

288 
toŞ
->toŞ.
doubË_şick_func
 = (
DoubËClickFunc
è&
ü—‹_objeù_doubË_şick
;

290 
toŞ
->
objty³
 = objtype;

291 
toŞ
->
u£r_d©a
 = user_data;

292 
toŞ
->
movšg
 = 
FALSE
;

293 
toŞ
->
šv”t_³rsi¡’û
 = invert_persistence;

295  (
ToŞ
 *è
toŞ
;

296 
	}
}

298 
	$ä“_ü—‹_objeù_toŞ
(
ToŞ
 *
toŞ
)

300 
C»©eObjeùToŞ
 *
»®_toŞ
 = (C»©eObjeùToŞ *)
toŞ
;

302 ià(
»®_toŞ
->
movšg
) {

303 
	`gdk_poš‹r_ung¿b
 (
GDK_CURRENT_TIME
);

304 
	`ddi¥Ïy_£t_®l_cursÜ
(
deçuÉ_cursÜ
);

306 
	`g_ä“
(
toŞ
);

307 
	}
}

	@O:\tool\dvs50\app\create_object.h

18 #iâdeà
CREATE_OBJECT_H


19 
	#CREATE_OBJECT_H


	)

21 
	~"geom‘ry.h
"

22 
	~"objeù.h
"

23 
	~"toŞ.h
"

25 
_C»©eObjeùToŞ
 
	tC»©eObjeùToŞ
;

27 
	s_C»©eObjeùToŞ
 {

28 
ToŞ
 
	mtoŞ
;

30 
DŸObjeùTy³
 *
	mobjty³
;

31 *
	mu£r_d©a
;

33 
	mmovšg
;

34 
HªdË
 *
	mhªdË
;

35 
DŸObjeù
 *
	mobj
;

36 
Pošt
 
	mÏ¡_to
;

37 
	mšv”t_³rsi¡’û
;

41 
ToŞ
 *
ü—‹_ü—‹_objeù_toŞ
(
DŸObjeùTy³
 *
objty³
, *
u£r_d©e
, 
šv”t_³rsi¡’û
);

42 
ä“_ü—‹_objeù_toŞ
(
ToŞ
 *
toŞ
);

	@O:\tool\dvs50\app\cursor.c

19 
	~<cÚfig.h
>

21 
	~<gdk/gdk.h
>

23 
	#DIA_CURSOR
 
GDK_LAST_CURSOR


	)

25 
	~"di¥Ïy.h
"

26 
	~"cursÜ.h
"

28 
	~"pixm­s/hªd-İ’-d©a.xbm
"

29 
	~"pixm­s/hªd-İ’-mask.xbm
"

30 
	~"pixm­s/hªd-şo£d-d©a.xbm
"

31 
	~"pixm­s/hªd-şo£d-mask.xbm
"

32 
	~"pixm­s/magnify-¶us-d©a.xbm
"

33 
	~"pixm­s/magnify-¶us-mask.xbm
"

34 
	~"pixm­s/magnify-mšus-d©a.xbm
"

35 
	~"pixm­s/magnify-mšus-mask.xbm
"

40 
	mgdk_cursÜ_numb”
;

41 
gch¬
 *
	md©a
;

42 
	mwidth
;

43 
	mheight
;

44 
gch¬
 *
	mmask
;

45 
	mhÙ_x
;

46 
	mhÙ_y
;

47 
GdkCursÜ
 *
	mcursÜ
;

48 } 
	gcursÜs
[
MAX_CURSORS
] = {

49 { 
GDK_LEFT_PTR
 },

50 { 
GDK_FLEUR
 },

51 { 
DIA_CURSOR
,

52 
hªd_İ’_d©a_b™s
,

53 
hªd_İ’_d©a_width
, 
hªd_İ’_d©a_height
,

54 
hªd_İ’_mask_b™s
,

55 
hªd_İ’_d©a_width
/2, 
hªd_İ’_d©a_height
/2},

56 { 
DIA_CURSOR
,

57 
hªd_şo£d_d©a_b™s
,

58 
hªd_şo£d_d©a_width
, 
hªd_şo£d_d©a_height
,

59 
hªd_şo£d_mask_b™s
,

60 
hªd_şo£d_d©a_width
/2, 
hªd_şo£d_d©a_height
/2},

61 { 
DIA_CURSOR
,

62 
magnify_mšus_d©a_b™s
,

63 
magnify_mšus_d©a_width
, 
magnify_mšus_d©a_height
,

64 
magnify_mšus_mask_b™s
,

65 
magnify_mšus_d©a_x_hÙ
, 
magnify_mšus_d©a_y_hÙ
},

66 { 
DIA_CURSOR
,

67 
magnify_¶us_d©a_b™s
,

68 
magnify_¶us_d©a_width
, 
magnify_¶us_d©a_height
,

69 
magnify_¶us_mask_b™s
,

70 
magnify_¶us_d©a_x_hÙ
, 
magnify_¶us_d©a_y_hÙ
},

71 { 
GDK_CROSS_REVERSE
 },

72 { 
GDK_XTERM
 },

75 
GdkCursÜ
 *

76 
	$g‘_cursÜ
(
DŸCursÜTy³
 
ùy³
) {

77 ià(
ùy³
 >ğ
MAX_CURSORS
 || ctype < 0) {

78  
NULL
;

80 ià(
cursÜs
[
ùy³
].
cursÜ
 =ğ
NULL
) {

81 
GdkCursÜ
 *
Ãw_cursÜ
 = 
NULL
;

83 ià(
cursÜs
[
ùy³
].
gdk_cursÜ_numb”
 !ğ
DIA_CURSOR
) {

84 
Ãw_cursÜ
 = 
	`gdk_cursÜ_Ãw
(
cursÜs
[
ùy³
].
gdk_cursÜ_numb”
);

86 
DDi¥Ïy
 *
aùive_di¥Ïy
 = 
	`ddi¥Ïy_aùive
 ();

87 ià(
aùive_di¥Ïy
 !ğ
NULL
)

88 
Ãw_cursÜ
 = 
	`ü—‹_cursÜ
(
aùive_di¥Ïy
->
ÿnvas
->
wšdow
,

89 
cursÜs
[
ùy³
].
d©a
,

90 
cursÜs
[
ùy³
].
width
,

91 
cursÜs
[
ùy³
].
height
,

92 
cursÜs
[
ùy³
].
mask
,

93 
cursÜs
[
ùy³
].
hÙ_x
,

94 
cursÜs
[
ùy³
].
hÙ_y
);

96 
cursÜs
[
ùy³
].
cursÜ
 = 
Ãw_cursÜ
;

99  
cursÜs
[
ùy³
].
cursÜ
;

100 
	}
}

102 
GdkCursÜ
 *

103 
	$ü—‹_cursÜ
(
GdkWšdow
 *
wšdow
,

104 cÚ¡ 
gch¬
 *
d©a
, 
width
, 
height
,

105 cÚ¡ 
gch¬
 *
mask
, 
hÙ_x
, 
hÙ_y
)

107 
GdkB™m­
 *
db™
, *
mb™
;

108 
GdkCŞÜ
 
bÏck
, 
wh™e
;

109 
GdkCursÜ
 *
cursÜ
;

111 
	`g_»tuº_v®_if_ç
(
wšdow
 !ğ
NULL
, NULL);

113 
db™
 = 
	`gdk_b™m­_ü—‹_äom_d©a
(
wšdow
, 
d©a
, 
width
, 
height
);

114 
mb™
 = 
	`gdk_b™m­_ü—‹_äom_d©a
(
wšdow
, 
mask
, 
width
, 
height
);

115 
	`g_as£¹
(
db™
 !ğ
NULL
 && 
mb™
 != NULL);

118 
	`gdk_cŞÜ_bÏck
(
	`gdk_wšdow_g‘_cŞÜm­
(
wšdow
), &
wh™e
);

119 
	`gdk_cŞÜ_wh™e
(
	`gdk_wšdow_g‘_cŞÜm­
(
wšdow
), &
bÏck
);

121 
cursÜ
 = 
	`gdk_cursÜ_Ãw_äom_pixm­
(
db™
, 
mb™
, &
wh™e
, &
bÏck
, 
hÙ_x
,
hÙ_y
);

122 
	`g_as£¹
(
cursÜ
 !ğ
NULL
);

124 
	`gdk_b™m­_uÄef
(
db™
);

125 
	`gdk_b™m­_uÄef
(
mb™
);

127  
cursÜ
;

128 
	}
}

	@O:\tool\dvs50\app\cursor.h

24 
	mCURSOR_POINT
,

25 
	mCURSOR_SCROLL
,

26 
	mCURSOR_GRAB
,

27 
	mCURSOR_GRABBING
,

28 
	mCURSOR_ZOOM_OUT
,

29 
	mCURSOR_ZOOM_IN
,

30 
	mCURSOR_CONNECT
,

31 
	mCURSOR_XTERM
,

32 
	mMAX_CURSORS


33 } 
	tDŸCursÜTy³
;

36 
GdkCursÜ
 *
g‘_cursÜ
(
DŸCursÜTy³
 
ùy³
);

37 
GdkCursÜ
 *
ü—‹_cursÜ
(
GdkWšdow
 *
wšdow
,

38 cÚ¡ 
gch¬
 *
d©a
, 
width
, 
height
,

39 cÚ¡ 
gch¬
 *
mask
, 
hÙ_x
, 
hÙ_y
);

	@O:\tool\dvs50\app\cut_n_paste.c

18 
	~<cÚfig.h
>

20 
	~<¡dio.h
>

22 
	~"cut_n_·¡e.h
"

23 
	~"objeù.h
"

24 
	~"objeù_İs.h
"

26 
GLi¡
 *
	g¡Üed_li¡
 = 
NULL
;

27 
	g¡Üed_g’”©iÚ
 = 0;

29 
	$ä“_¡Üed
()

31 ià(
¡Üed_li¡
 !ğ
NULL
) {

32 
	`de¡roy_objeù_li¡
(
¡Üed_li¡
);

33 
¡Üed_li¡
 = 
NULL
;

35 
	}
}

38 
	$úp_¡Üe_objeùs
(
GLi¡
 *
objeù_li¡
, 
g’”©iÚ
)

40 
	`ä“_¡Üed
();

41 
¡Üed_li¡
 = 
objeù_li¡
;

42 
¡Üed_g’”©iÚ
 = 
g’”©iÚ
;

43 
	}
}

45 
GLi¡
 *

46 
	$úp_g‘_¡Üed_objeùs
(* 
g’”©iÚ
)

48 
GLi¡
 *
cİ›d_li¡
;

49 
cİ›d_li¡
 = 
	`objeù_cİy_li¡
(
¡Üed_li¡
);

50 *
g’”©iÚ
 = 
¡Üed_g’”©iÚ
;

51 ++
¡Üed_g’”©iÚ
;

52  
cİ›d_li¡
;

53 
	}
}

55 
gšt


56 
	$úp_exi¡_¡Üed_objeùs
()

58  (
¡Üed_li¡
 !ğ
NULL
);

59 
	}
}

	@O:\tool\dvs50\app\cut_n_paste.h

18 #iâdeà
CUT_N_PASTE_H


19 
	#CUT_N_PASTE_H


	)

21 
	~<glib.h
>

22 
	~"dŸv¬.h
"

25 
DIAVAR
 
úp_¡Üe_objeùs
(
GLi¡
 *
objeù_li¡
, 
g’”©iÚ
);

28 
DIAVAR
 
GLi¡
 *
úp_g‘_¡Üed_objeùs
(* 
g’”©iÚ
);

30 
DIAVAR
 
gšt
 
úp_exi¡_¡Üed_objeùs
();

	@O:\tool\dvs50\app\defaults.c

19 
	~<cÚfig.h
>

21 
	~<gtk/gtk.h
>

23 
	~"deçuÉs.h
"

24 
	~"š.h
"

25 
	~"´İ”t›s-dŸlog.h
"

26 
	~"objeù_İs.h
"

27 
	~"cÚÃùiÚpošt_İs.h
"

28 
	~"objeù.h
"

30 
GtkWidg‘
 *
	gdŸlog
 = 
NULL
;

31 
GtkWidg‘
 *
	gdŸlog_vbox
 = 
NULL
;

32 
GtkWidg‘
 *
	gobjeù_·¹
 = 
NULL
;

33 
DŸObjeùTy³
 *
	gcu¼’t_objty³
 = 
NULL
;

34 
DŸObjeù
 *
	gcu¼’t_objeù
 = 
NULL
;

36 
GtkWidg‘
 *
	gno_deçuÉs_dŸlog
 = 
NULL
;

38 
gšt
 
deçuÉs_»¥Úd
(
GtkWidg‘
 *
widg‘
, gšˆ
»¥Ú£_id
, 
gpoš‹r
 
d©a
);

40 
	$ü—‹_dŸlog
()

42 
GtkWidg‘
 *
pwidg‘
 = 
	`gtk_widg‘_g‘_tİËv–
(
	`ddi¥Ïy_aùive
()->
m’u_b¬
);

43 
dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(

44 
	`_
("Object defaults"),

45 
pwidg‘
, 
GTK_DIALOG_MODAL
,

46 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

47 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

48 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

49 
NULL
);

51 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
dŸlog
), 
GTK_RESPONSE_OK
);

53 
dŸlog_vbox
 = 
	`GTK_DIALOG
 (
dŸlog
)->
vbox
;

55 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
dŸlog
), "defaults_window");

57 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
dŸlog
), "response",

58 
	`G_CALLBACK
(
deçuÉs_»¥Úd
), 
NULL
);

59 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
dŸlog
), "delete_event",

60 
	`G_CALLBACK
(
gtk_widg‘_hide
), 
NULL
);

62 
no_deçuÉs_dŸlog
 = 
	`gtk_Ïb–_Ãw
(
	`_
("This object has‚o defaults."));

63 
	`gtk_widg‘_show
 (
no_deçuÉs_dŸlog
);

65 #ià
	`GLIB_CHECK_VERSION
(2,10,0)

66 
	`g_objeù_»f_sšk
(
	`GTK_OBJECT
(
no_deçuÉs_dŸlog
));

68 
	`g_objeù_»f
(
	`GTK_OBJECT
(
no_deçuÉs_dŸlog
));

69 
	`gtk_objeù_sšk
(
	`GTK_OBJECT
(
no_deçuÉs_dŸlog
));

71 
	}
}

73 
gšt


74 
	$deçuÉs_dŸlog_de¡royed
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

76 ià(
widg‘
 =ğ
objeù_·¹
) {

77 
objeù_·¹
 = 
NULL
;

78 
cu¼’t_objty³
 = 
NULL
;

79 
cu¼’t_objeù
 = 
NULL
;

81 
dŸlog
 = 
NULL
;

83 
	}
}

85 
gšt


86 
	$deçuÉs_»¥Úd
(
GtkWidg‘
 *
widg‘
, 
gšt
 
»¥Ú£_id
, 
gpoš‹r
 
d©a
)

88 ià(
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
 ||

89 
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY
) {

90 ià(
cu¼’t_objty³
 !ğ
NULL
) {

91 ià(
cu¼’t_objty³
->
İs
->
­¶y_deçuÉs
)

92 
cu¼’t_objty³
->
İs
->
	`­¶y_deçuÉs
();

93 ià(
cu¼’t_objeù
 !ğ
NULL
)

94 
	`objeù_­¶y_´İs_äom_dŸlog
 (
cu¼’t_objeù
, 
objeù_·¹
);

97 ià(
»¥Ú£_id
 !ğ
GTK_RESPONSE_APPLY
)

98 
	`gtk_widg‘_hide
(
widg‘
);

100 
	}
}

103 
	$deçuÉs_show
(
DŸObjeùTy³
 *
objty³
, 
gpoš‹r
 
u£r_d©a
)

105 
GtkWidg‘
 *
deçuÉs
;

106 
DŸObjeù
 *
def_objeù
 = 
NULL
;

107 
gch¬
 *
t™Ë
 = 
NULL
;

109 ià(
objty³
 !ğ
NULL
) {

110 ià(
objty³
->
İs
->
g‘_deçuÉs
 !ğ
NULL
)

111 
deçuÉs
 = 
objty³
->
İs
->
	`g‘_deçuÉs
();

113 
def_objeù
 = 
	`dŸ_objeù_deçuÉ_g‘
 (
objty³
, 
u£r_d©a
);

114 
deçuÉs
 = 
	`objeù_ü—‹_´İs_dŸlog
 (
def_objeù
, 
TRUE
);

116 
t™Ë
 = 
	`g_¡rcÚÿt
(
	`_
("DeçuÉs: "), 
objty³
->
Çme
, 
NULL
);

118 
deçuÉs
 = 
NULL
;

121 ià(
dŸlog
 =ğ
NULL
)

122 
	`ü—‹_dŸlog
();

124 ià((
objty³
==
NULL
è|| (
deçuÉs
 == NULL)) {

126 
deçuÉs
 = 
no_deçuÉs_dŸlog
;

127 
objty³
 = 
NULL
;

130 ià(
objeù_·¹
 !ğ
NULL
) {

131 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
dŸlog_vbox
), 
objeù_·¹
);

132 
objeù_·¹
 = 
NULL
;

134 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
dŸlog
), "destroy",

135 
	`G_CALLBACK
(
deçuÉs_dŸlog_de¡royed
), 
NULL
);

137 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
dŸlog
), "delete_event",

138 
	`G_CALLBACK
(
gtk_widg‘_hide
), 
NULL
);

139 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
dŸlog
), "delete_event",

140 
	`G_CALLBACK
(
gtk_Œue
), 
NULL
);

142 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
dŸlog_vbox
), 
deçuÉs
, 
TRUE
, TRUE, 0);

143 
	`gtk_widg‘_show
 (
deçuÉs
);

145 ià(
t™Ë
)

147 
	`gtk_wšdow_£t_t™Ë
(
	`GTK_WINDOW
(
dŸlog
), 
t™Ë
);

148 
	`g_ä“
(
t™Ë
);

151 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
dŸlog
), 
	`_
("Object defaults"));

153 ià(
objeù_·¹
 !ğ
deçuÉs
) {

154 
	`gtk_wšdow_»size
 (
	`GTK_WINDOW
(
dŸlog
), 1, 1);

155 ià(
dŸlog
->
wšdow
)

156 
	`gdk_wšdow_šv®id©e_»ù
 (
dŸlog
->
wšdow
, 
NULL
, 
TRUE
);

158 
	`gtk_wšdow_´e£Á
 (
	`GTK_WINDOW
(
dŸlog
));

159 
objeù_·¹
 = 
deçuÉs
;

160 
cu¼’t_objty³
 = 
objty³
;

161 
cu¼’t_objeù
 = 
def_objeù
;

162 
	}
}

	@O:\tool\dvs50\app\defaults.h

18 #iâdeà
DEFAULTS_H


19 
	#DEFAULTS_H


	)

21 
	~"objeù.h
"

22 
	~"dŸg¿m.h
"

24 
deçuÉs_show
(
DŸObjeùTy³
 *
obj
, 
gpoš‹r
 
u£r_d©a
);

	@O:\tool\dvs50\app\dia-app-icons.h

3 #ifdeà
__SUNPRO_C


4 #´agm¨
®ign
 4 (
dŸ_cÚÃùabË_icÚ
)

6 #ifdeà
__GNUC__


7 cÚ¡ 
gušt8
 
	gdŸ_cÚÃùabË_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

9 cÚ¡ 
gušt8
 
dŸ_cÚÃùabË_icÚ
[] =

84 #ifdeà
__SUNPRO_C


85 #´agm¨
®ign
 4 (
dŸ_cÚÃùabË_em±y_icÚ
)

87 #ifdeà
__GNUC__


88 cÚ¡ 
gušt8
 
	gdŸ_cÚÃùabË_em±y_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

90 cÚ¡ 
gušt8
 
dŸ_cÚÃùabË_em±y_icÚ
[] =

199 #ifdeà
__SUNPRO_C


200 #´agm¨
®ign
 4 (
dŸ_£ËùabË_icÚ
)

202 #ifdeà
__GNUC__


203 cÚ¡ 
gušt8
 
	gdŸ_£ËùabË_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

205 cÚ¡ 
gušt8
 
dŸ_£ËùabË_icÚ
[] =

307 #ifdeà
__SUNPRO_C


308 #´agm¨
®ign
 4 (
dŸ_£ËùabË_em±y_icÚ
)

310 #ifdeà
__GNUC__


311 cÚ¡ 
gušt8
 
	gdŸ_£ËùabË_em±y_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

313 cÚ¡ 
gušt8
 
dŸ_£ËùabË_em±y_icÚ
[] =

422 #ifdeà
__SUNPRO_C


423 #´agm¨
®ign
 4 (
dŸ_Ú_grid_icÚ
)

425 #ifdeà
__GNUC__


426 cÚ¡ 
gušt8
 
	gdŸ_Ú_grid_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

428 cÚ¡ 
gušt8
 
dŸ_Ú_grid_icÚ
[] =

582 #ifdeà
__SUNPRO_C


583 #´agm¨
®ign
 4 (
dŸ_off_grid_icÚ
)

585 #ifdeà
__GNUC__


586 cÚ¡ 
gušt8
 
	gdŸ_off_grid_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

588 cÚ¡ 
gušt8
 
dŸ_off_grid_icÚ
[] =

743 #ifdeà
__SUNPRO_C


744 #´agm¨
®ign
 4 (
dŸ_visibË_icÚ
)

746 #ifdeà
__GNUC__


747 cÚ¡ 
gušt8
 
	gdŸ_visibË_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

749 cÚ¡ 
gušt8
 
dŸ_visibË_icÚ
[] =

849 #ifdeà
__SUNPRO_C


850 #´agm¨
®ign
 4 (
dŸ_visibË_em±y_icÚ
)

852 #ifdeà
__GNUC__


853 cÚ¡ 
gušt8
 
	gdŸ_visibË_em±y_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

855 cÚ¡ 
gušt8
 
dŸ_visibË_em±y_icÚ
[] =

964 #ifdeà
__SUNPRO_C


965 #´agm¨
®ign
 4 (
dŸ_modify_toŞ_icÚ
)

967 #ifdeà
__GNUC__


968 cÚ¡ 
gušt8
 
	gdŸ_modify_toŞ_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

970 cÚ¡ 
gušt8
 
dŸ_modify_toŞ_icÚ
[] =

1060 #ifdeà
__SUNPRO_C


1061 #´agm¨
®ign
 4 (
dŸ_süŞl_toŞ_icÚ
)

1063 #ifdeà
__GNUC__


1064 cÚ¡ 
gušt8
 
	gdŸ_süŞl_toŞ_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

1066 cÚ¡ 
gušt8
 
dŸ_süŞl_toŞ_icÚ
[] =

1144 #ifdeà
__SUNPRO_C


1145 #´agm¨
®ign
 4 (
dŸ_‹x‹d™_toŞ_icÚ
)

1147 #ifdeà
__GNUC__


1148 cÚ¡ 
gušt8
 
	gdŸ_‹x‹d™_toŞ_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

1150 cÚ¡ 
gušt8
 
dŸ_‹x‹d™_toŞ_icÚ
[] =

1235 #ifdeà
__SUNPRO_C


1236 #´agm¨
®ign
 4 (
dŸ_zoom_toŞ_icÚ
)

1238 #ifdeà
__GNUC__


1239 cÚ¡ 
gušt8
 
	gdŸ_zoom_toŞ_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

1241 cÚ¡ 
gušt8
 
dŸ_zoom_toŞ_icÚ
[] =

1328 #ifdeà
__SUNPRO_C


1329 #´agm¨
®ign
 4 (
dŸ_group_icÚ
)

1331 #ifdeà
__GNUC__


1332 cÚ¡ 
gušt8
 
	gdŸ_group_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

1334 cÚ¡ 
gušt8
 
dŸ_group_icÚ
[] =

1402 #ifdeà
__SUNPRO_C


1403 #´agm¨
®ign
 4 (
dŸ_ungroup_icÚ
)

1405 #ifdeà
__GNUC__


1406 cÚ¡ 
gušt8
 
	gdŸ_ungroup_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

1408 cÚ¡ 
gušt8
 
dŸ_ungroup_icÚ
[] =

1476 #ifdeà
__SUNPRO_C


1477 #´agm¨
®ign
 4 (
dŸ_mašpošts_Ú_icÚ
)

1479 #ifdeà
__GNUC__


1480 cÚ¡ 
gušt8
 
	gdŸ_mašpošts_Ú_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

1482 cÚ¡ 
gušt8
 
dŸ_mašpošts_Ú_icÚ
[] =

1630 #ifdeà
__SUNPRO_C


1631 #´agm¨
®ign
 4 (
dŸ_mašpošts_off_icÚ
)

1633 #ifdeà
__GNUC__


1634 cÚ¡ 
gušt8
 
	gdŸ_mašpošts_off_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

1636 cÚ¡ 
gušt8
 
dŸ_mašpošts_off_icÚ
[] =

1784 #ifdeà
__SUNPRO_C


1785 #´agm¨
®ign
 4 (
dŸ_dŸg¿m_icÚ
)

1787 #ifdeà
__GNUC__


1788 cÚ¡ 
gušt8
 
	gdŸ_dŸg¿m_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

1790 cÚ¡ 
gušt8
 
dŸ_dŸg¿m_icÚ
[] =

2142 #ifdeà
__SUNPRO_C


2143 #´agm¨
®ign
 4 (
dŸ_­p_icÚ
)

2145 #ifdeà
__GNUC__


2146 cÚ¡ 
gušt8
 
	gdŸ_­p_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

2148 cÚ¡ 
gušt8
 
dŸ_­p_icÚ
[] =

2455 #ifdeà
__SUNPRO_C


2456 #´agm¨
®ign
 4 (
dŸ_objeùs_Ïy”_above
)

2458 #ifdeà
__GNUC__


2459 cÚ¡ 
gušt8
 
	gdŸ_objeùs_Ïy”_above
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

2461 cÚ¡ 
gušt8
 
dŸ_objeùs_Ïy”_above
[] =

2531 #ifdeà
__SUNPRO_C


2532 #´agm¨
®ign
 4 (
dŸ_objeùs_Ïy”_b–ow
)

2534 #ifdeà
__GNUC__


2535 cÚ¡ 
gušt8
 
	gdŸ_objeùs_Ïy”_b–ow
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

2537 cÚ¡ 
gušt8
 
dŸ_objeùs_Ïy”_b–ow
[] =

2607 #ifdeà
__SUNPRO_C


2608 #´agm¨
®ign
 4 (
dŸ_Ïy”s
)

2610 #ifdeà
__GNUC__


2611 cÚ¡ 
gušt8
 
	gdŸ_Ïy”s
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

2613 cÚ¡ 
gušt8
 
dŸ_Ïy”s
[] =

2682 #ifdeà
__SUNPRO_C


2683 #´agm¨
®ign
 4 (
dŸ_Ïy”_add
)

2685 #ifdeà
__GNUC__


2686 cÚ¡ 
gušt8
 
	gdŸ_Ïy”_add
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

2688 cÚ¡ 
gušt8
 
dŸ_Ïy”_add
[] =

2759 #ifdeà
__SUNPRO_C


2760 #´agm¨
®ign
 4 (
dŸ_Ïy”_»Çme
)

2762 #ifdeà
__GNUC__


2763 cÚ¡ 
gušt8
 
	gdŸ_Ïy”_»Çme
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

2765 cÚ¡ 
gušt8
 
dŸ_Ïy”_»Çme
[] =

2834 #ifdeà
__SUNPRO_C


2835 #´agm¨
®ign
 4 (
globe_Ú
)

2837 #ifdeà
__GNUC__


2838 cÚ¡ 
gušt8
 
	gglobe_Ú
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

2840 cÚ¡ 
gušt8
 
globe_Ú
[] =

2958 #ifdeà
__SUNPRO_C


2959 #´agm¨
®ign
 4 (
globe_off
)

2961 #ifdeà
__GNUC__


2962 cÚ¡ 
gušt8
 
	gglobe_off
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

2964 cÚ¡ 
gušt8
 
globe_off
[] =

3080 #ifdeà
__SUNPRO_C


3081 #´agm¨
®ign
 4 (
sy¡emd©a_Ú
)

3083 #ifdeà
__GNUC__


3084 cÚ¡ 
gušt8
 
	gsy¡emd©a_Ú
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

3086 cÚ¡ 
gušt8
 
sy¡emd©a_Ú
[] =

3174 #ifdeà
__SUNPRO_C


3175 #´agm¨
®ign
 4 (
sy¡emd©a_off
)

3177 #ifdeà
__GNUC__


3178 cÚ¡ 
gušt8
 
	gsy¡emd©a_off
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

3180 cÚ¡ 
gušt8
 
sy¡emd©a_off
[] =

3295 #ifdeà
__SUNPRO_C


3296 #´agm¨
®ign
 4 (
femªag”
)

3298 #ifdeà
__GNUC__


3299 cÚ¡ 
gušt8
 
	gfemªag”
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

3301 cÚ¡ 
gušt8
 
femªag”
[] =

3419 #ifdeà
__SUNPRO_C


3420 #´agm¨
®ign
 4 (
idli¡
)

3422 #ifdeà
__GNUC__


3423 cÚ¡ 
gušt8
 
	gidli¡
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

3425 cÚ¡ 
gušt8
 
idli¡
[] =

3564 #ifdeà
__SUNPRO_C


3565 #´agm¨
®ign
 4 (
impÜt
-
audio
-
docum’t
)

3567 #ifdeà
__GNUC__


3568 cÚ¡ 
gušt8
 
	gaudio_li¡
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

3570 cÚ¡ 
gušt8
 
impÜt
-
audio
-
docum’t
[] =

	@O:\tool\dvs50\app\dia-props.c

22 #ifdeà
HAVE_CONFIG_H


23 
	~<cÚfig.h
>

26 
	~"dŸ-´İs.h
"

28 
	~<gtk/gtk.h
>

30 
	~"š.h
"

31 
	~"di¥Ïy.h
"

32 
	~"widg‘s.h
"

33 
	~"di¥Ïy.h
"

35 
GtkWidg‘
 *
	gdŸlog
 = 
NULL
;

36 
GtkWidg‘
 *
	gdyÇmic_check
;

37 
GtkWidg‘
 *
	gwidth_x_’Œy
, *
	gwidth_y_’Œy
;

38 
GtkWidg‘
 *
	gvisibË_x_’Œy
, *
	gvisibË_y_’Œy
;

39 
GtkWidg‘
 *
	gbg_cŞour
, *
	ggrid_cŞour
, *
	g·geb»ak_cŞour
;

40 
GtkWidg‘
 *
	ghex_check
, *
	ghex_size_’Œy
;

42 
dŸg¿m_´İ”t›s_»¥Úd
(
GtkWidg‘
 *
widg‘
,

43 
gšt
 
»¥Ú£_id
,

44 
gpoš‹r
 
u£r_d©a
);

47 
	$dŸg¿m_´İ”t›s_upd©e_£ns™iv™y
(
GtkToggËBu‰Ú
 *
widg‘
,

48 
gpoš‹r
 
u£rd©a
)

50 
DŸg¿m
 *
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

51 
gboŞ—n
 
dyn_grid
, 
squ¬e_grid
, 
hex_grid
;

53 ià(!
dŸ
)

56 
dŸ
->
grid
.
dyÇmic
 =

57 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
dyÇmic_check
));

58 
dyn_grid
 = 
dŸ
->
grid
.
dyÇmic
;

59 ià(!
dyn_grid
)

60 
dŸ
->
grid
.
hex
 =

61 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
hex_check
));

63 
squ¬e_grid
 = !
dyn_grid
 && !
dŸ
->
grid
.
hex
;

64 
hex_grid
 = !
dyn_grid
 && 
dŸ
->
grid
.
hex
;

67 
	`gtk_widg‘_£t_£ns™ive
(
width_x_’Œy
, 
squ¬e_grid
);

68 
	`gtk_widg‘_£t_£ns™ive
(
width_y_’Œy
, 
squ¬e_grid
);

69 
	`gtk_widg‘_£t_£ns™ive
(
visibË_x_’Œy
, 
squ¬e_grid
);

70 
	`gtk_widg‘_£t_£ns™ive
(
visibË_y_’Œy
, 
squ¬e_grid
);

71 
	`gtk_widg‘_£t_£ns™ive
(
hex_check
, !
dyn_grid
);

72 
	`gtk_widg‘_£t_£ns™ive
(
hex_size_’Œy
, 
hex_grid
);

73 
	}
}

76 
	$ü—‹_dŸg¿m_´İ”t›s_dŸlog
(
DŸg¿m
 *
dŸ
)

78 
GtkWidg‘
 *
dŸlog_vbox
;

79 
GtkWidg‘
 *
nÙebook
;

80 
GtkWidg‘
 *
bË
;

81 
GtkWidg‘
 *
Ïb–
;

82 
GtkAdju¡m’t
 *
adj
;

84 
dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(

85 
	`_
("Diagram Properties"),

86 
	`GTK_WINDOW
(
	`ddi¥Ïy_aùive
()->
sh–l
),

87 
GTK_DIALOG_DESTROY_WITH_PARENT
,

88 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CANCEL
,

89 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

90 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

91 
NULL
);

93 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
dŸlog
), 
GTK_RESPONSE_OK
);

95 
dŸlog_vbox
 = 
	`GTK_DIALOG
(
dŸlog
)->
vbox
;

97 
	`gtk_wšdow_£t_rŞe
(
	`GTK_WINDOW
(
dŸlog
), "diagram_properties");

99 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
dŸlog
), "response",

100 
	`G_CALLBACK
(
dŸg¿m_´İ”t›s_»¥Úd
),

101 
NULL
);

102 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
dŸlog
), "delete_event",

103 
	`G_CALLBACK
(
gtk_widg‘_hide
), 
NULL
);

104 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
dŸlog
), "destroy",

105 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
dŸlog
);

107 
nÙebook
 = 
	`gtk_nÙebook_Ãw
();

108 
	`gtk_nÙebook_£t_b_pos
(
	`GTK_NOTEBOOK
(
nÙebook
), 
GTK_POS_TOP
);

109 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
dŸlog_vbox
), 
nÙebook
, 
TRUE
, TRUE, 0);

110 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
nÙebook
), 2);

111 
	`gtk_widg‘_show
(
nÙebook
);

114 
bË
 = 
	`gtk_bË_Ãw
(3,3,
FALSE
);

115 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
bË
), 2);

116 
	`gtk_bË_£t_row_¥acšgs
(
	`GTK_TABLE
(
bË
), 1);

117 
	`gtk_bË_£t_cŞ_¥acšgs
(
	`GTK_TABLE
(
bË
), 2);

119 
dyÇmic_check
 = 
	`gtk_check_bu‰Ú_Ãw_w™h_Ïb–
(
	`_
("Dynamic grid"));

120 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
dyÇmic_check
, 1,2, 0,1,

121 
GTK_FILL
, GTK_FILL, 0, 0);

122 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
dyÇmic_check
), "toggled",

123 
	`G_CALLBACK
(
dŸg¿m_´İ”t›s_upd©e_£ns™iv™y
), 
NULL
);

125 
	`gtk_widg‘_show
(
dyÇmic_check
);

127 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("x"));

128 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
Ïb–
, 1,2, 1,2,

129 
GTK_FILL
, GTK_FILL, 0, 0);

130 
	`gtk_widg‘_show
(
Ïb–
);

131 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("y"));

132 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
Ïb–
, 2,3, 1,2,

133 
GTK_FILL
, GTK_FILL, 0, 0);

134 
	`gtk_widg‘_show
(
Ïb–
);

136 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Spacing"));

137 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
Ïb–
), 0.0, 0.5);

138 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
Ïb–
, 0,1, 2,3,

139 
GTK_FILL
, GTK_FILL, 0, 0);

140 
	`gtk_widg‘_show
(
Ïb–
);

142 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1.0, 0.0, 10.0, 0.1, 10.0, 0));

143 
width_x_’Œy
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 1.0, 3);

144 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
width_x_’Œy
), 
TRUE
);

145 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
width_x_’Œy
, 1,2, 2,3,

146 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

147 
	`gtk_widg‘_show
(
width_x_’Œy
);

149 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1.0, 0.0, 10.0, 0.1, 10.0, 0));

150 
width_y_’Œy
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 1.0, 3);

151 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
width_y_’Œy
), 
TRUE
);

152 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
width_y_’Œy
, 2,3, 2,3,

153 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

154 
	`gtk_widg‘_show
(
width_y_’Œy
);

156 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Visible spacing"));

157 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
Ïb–
), 0.0, 0.5);

158 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
Ïb–
, 0,1, 3,4,

159 
GTK_FILL
, GTK_FILL, 0, 0);

160 
	`gtk_widg‘_show
(
Ïb–
);

162 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1.0, 0.0, 100.0, 1.0, 10.0, 0));

163 
visibË_x_’Œy
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 1.0, 0);

164 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
visibË_x_’Œy
), 
TRUE
);

165 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
visibË_x_’Œy
, 1,2, 3,4,

166 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

167 
	`gtk_widg‘_show
(
visibË_x_’Œy
);

169 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1.0, 0.0, 100.0, 1.0, 10.0, 0));

170 
visibË_y_’Œy
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 1.0, 0);

171 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
visibË_y_’Œy
), 
TRUE
);

172 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
visibË_y_’Œy
, 2,3, 3,4,

173 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

174 
	`gtk_widg‘_show
(
visibË_y_’Œy
);

177 
hex_check
 = 
	`gtk_check_bu‰Ú_Ãw_w™h_Ïb–
(
	`_
("Hex grid"));

178 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
hex_check
, 1,2, 4,5,

179 
GTK_FILL
, GTK_FILL, 0, 0);

180 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
hex_check
), "toggled",

181 
	`G_CALLBACK
(
dŸg¿m_´İ”t›s_upd©e_£ns™iv™y
), 
NULL
);

183 
	`gtk_widg‘_show
(
hex_check
);

185 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Hex grid size"));

186 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
Ïb–
), 0.0, 0.5);

187 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
Ïb–
, 0,1, 5,6,

188 
GTK_FILL
, GTK_FILL, 0, 0);

189 
	`gtk_widg‘_show
(
Ïb–
);

191 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1.0, 0.0, 100.0, 1.0, 10.0, 0));

192 
hex_size_’Œy
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 1.0, 0);

193 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
hex_size_’Œy
), 
TRUE
);

194 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
hex_size_’Œy
, 1,2, 5,6,

195 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

196 
	`gtk_widg‘_show
(
hex_size_’Œy
);

198 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Grid"));

199 
	`gtk_nÙebook_­³nd_·ge
(
	`GTK_NOTEBOOK
(
nÙebook
), 
bË
, 
Ïb–
);

200 
	`gtk_widg‘_show
(
bË
);

201 
	`gtk_widg‘_show
(
Ïb–
);

204 
bË
 = 
	`gtk_bË_Ãw
(1,2, 
FALSE
);

205 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
bË
), 2);

206 
	`gtk_bË_£t_row_¥acšgs
(
	`GTK_TABLE
(
bË
), 1);

207 
	`gtk_bË_£t_cŞ_¥acšgs
(
	`GTK_TABLE
(
bË
), 2);

209 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Background"));

210 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
Ïb–
), 0.0, 0.5);

211 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
Ïb–
, 0,1, 0,1,

212 
GTK_FILL
, GTK_FILL, 0, 0);

213 
	`gtk_widg‘_show
(
Ïb–
);

215 
bg_cŞour
 = 
	`dŸ_cŞÜ_£ËùÜ_Ãw
();

216 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
bg_cŞour
, 1,2, 0,1,

217 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

218 
	`gtk_widg‘_show
(
bg_cŞour
);

220 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Grid Lines"));

221 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
Ïb–
), 0.0, 0.5);

222 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
Ïb–
, 0,1, 1,2,

223 
GTK_FILL
, GTK_FILL, 0, 0);

224 
	`gtk_widg‘_show
(
Ïb–
);

226 
grid_cŞour
 = 
	`dŸ_cŞÜ_£ËùÜ_Ãw
();

227 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
grid_cŞour
, 1,2, 1,2,

228 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

229 
	`gtk_widg‘_show
(
grid_cŞour
);

231 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Page Breaks"));

232 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
Ïb–
), 0.0, 0.5);

233 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
Ïb–
, 0,1, 2,3,

234 
GTK_FILL
, GTK_FILL, 0, 0);

235 
	`gtk_widg‘_show
(
Ïb–
);

237 
·geb»ak_cŞour
 = 
	`dŸ_cŞÜ_£ËùÜ_Ãw
();

238 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
·geb»ak_cŞour
, 1,2, 2,3,

239 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

240 
	`gtk_widg‘_show
(
·geb»ak_cŞour
);

242 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Colors"));

243 
	`gtk_nÙebook_­³nd_·ge
(
	`GTK_NOTEBOOK
(
nÙebook
), 
bË
, 
Ïb–
);

244 
	`gtk_widg‘_show
(
bË
);

245 
	`gtk_widg‘_show
(
Ïb–
);

246 
	}
}

253 
	$dŸg¿m_´İ”t›s_»Œ›ve
(
DŸg¿m
 *
dŸ
)

255 
gch¬
 *
t™Ë
;

256 
gch¬
 *
Çme
 = 
dŸ
 ? 
	`dŸg¿m_g‘_Çme
(dia) : "?";

258 
	`g_»tuº_if_ç
(
dŸ
 !ğ
NULL
);

259 ià(!
dŸlog
)

263 
t™Ë
 = 
	`g_¡rdup_´štf
(
	`_
("DŸg¿m Prİ”t›s: %s"), 
Çme
 ?‚ame : "??");

264 
	`gtk_wšdow_£t_t™Ë
(
	`GTK_WINDOW
(
dŸlog
), 
t™Ë
);

265 
	`g_ä“
(
Çme
);

266 
	`g_ä“
(
t™Ë
);

267 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
dyÇmic_check
),

268 
dŸ
->
grid
.
dyÇmic
);

269 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
width_x_’Œy
),

270 
dŸ
->
grid
.
width_x
);

271 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
width_y_’Œy
),

272 
dŸ
->
grid
.
width_y
);

273 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
visibË_x_’Œy
),

274 
dŸ
->
grid
.
visibË_x
);

275 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
visibË_y_’Œy
),

276 
dŸ
->
grid
.
visibË_y
);

277 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
hex_check
),

278 
dŸ
->
grid
.
hex
);

279 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
hex_size_’Œy
),

280 
dŸ
->
grid
.
hex_size
);

282 
	`dŸ_cŞÜ_£ËùÜ_£t_cŞÜ
(
bg_cŞour
,

283 &
dŸ
->
d©a
->
bg_cŞÜ
);

284 
	`dŸ_cŞÜ_£ËùÜ_£t_cŞÜ
(
grid_cŞour
,

285 &
dŸ
->
grid
.
cŞour
);

286 
	`dŸ_cŞÜ_£ËùÜ_£t_cŞÜ
(
·geb»ak_cŞour
,

287 &
dŸ
->
·geb»ak_cŞÜ
);

289 
	`dŸg¿m_´İ”t›s_upd©e_£ns™iv™y
(
	`GTK_TOGGLE_BUTTON
(
dyÇmic_check
), 
dŸ
);

291 
	}
}

294 
	$dŸg¿m_´İ”t›s_show
(
DŸg¿m
 *
dŸ
)

296 ià(
dŸlog
) {

298 
	`gtk_widg‘_de¡roy
(
dŸlog
);

299 
dŸlog
 = 
NULL
;

302 
	`ü—‹_dŸg¿m_´İ”t›s_dŸlog
(
dŸ
);

304 
	`dŸg¿m_´İ”t›s_»Œ›ve
(
dŸ
);

306 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
dŸlog
),

307 
	`GTK_WINDOW
 (
	`ddi¥Ïy_aùive
()->
sh–l
));

308 
	`gtk_widg‘_show
(
dŸlog
);

309 
	}
}

312 
	$dŸg¿m_´İ”t›s_»¥Úd
(
GtkWidg‘
 *
widg‘
,

313 
gšt
 
»¥Ú£_id
,

314 
gpoš‹r
 
u£r_d©a
)

316 
DŸg¿m
 *
aùive_dŸg¿m
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

318 ià(
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
 ||

319 
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY
) {

320 ià(
aùive_dŸg¿m
) {

321 
aùive_dŸg¿m
->
grid
.
dyÇmic
 =

322 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
dyÇmic_check
));

323 
aùive_dŸg¿m
->
grid
.
width_x
 =

324 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
width_x_’Œy
));

325 
aùive_dŸg¿m
->
grid
.
width_y
 =

326 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
width_y_’Œy
));

327 
aùive_dŸg¿m
->
grid
.
visibË_x
 =

328 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
	`GTK_SPIN_BUTTON
(
visibË_x_’Œy
));

329 
aùive_dŸg¿m
->
grid
.
visibË_y
 =

330 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
	`GTK_SPIN_BUTTON
(
visibË_y_’Œy
));

331 
aùive_dŸg¿m
->
grid
.
hex
 =

332 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
hex_check
));

333 
aùive_dŸg¿m
->
grid
.
hex_size
 =

334 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
hex_size_’Œy
));

335 
	`dŸ_cŞÜ_£ËùÜ_g‘_cŞÜ
(
bg_cŞour
,

336 &
aùive_dŸg¿m
->
d©a
->
bg_cŞÜ
);

337 
	`dŸ_cŞÜ_£ËùÜ_g‘_cŞÜ
(
grid_cŞour
,

338 &
aùive_dŸg¿m
->
grid
.
cŞour
);

339 
	`dŸ_cŞÜ_£ËùÜ_g‘_cŞÜ
(
·geb»ak_cŞour
,

340 &
aùive_dŸg¿m
->
·geb»ak_cŞÜ
);

341 
	`dŸg¿m_add_upd©e_®l
(
aùive_dŸg¿m
);

342 
	`dŸg¿m_æush
(
aùive_dŸg¿m
);

343 
	`dŸg¿m_£t_modif›d
(
aùive_dŸg¿m
, 
TRUE
);

346 ià(
»¥Ú£_id
 !ğ
GTK_RESPONSE_APPLY
)

347 
	`gtk_widg‘_hide
(
dŸlog
);

348 
	}
}

355 
	$dŸg¿m_´İ”t›s_£t_dŸg¿m
(
DŸg¿m
 *
dŸ
)

357 ià(
dŸlog
 && 
dŸ
 !ğ
NULL
)

359 
	`dŸg¿m_´İ”t›s_»Œ›ve
(
dŸ
);

361 
	}
}

	@O:\tool\dvs50\app\dia-props.h

22 #iâdeà
_DIA_PROPS_H_


23 
	#_DIA_PROPS_H_


	)

24 
	~"dŸg¿m.h
"

26 
dŸg¿m_´İ”t›s_show
(
DŸg¿m
 *
dŸ
);

27 
dŸg¿m_´İ”t›s_£t_dŸg¿m
(
DŸg¿m
 *
dŸ
);

	@O:\tool\dvs50\app\diacanvas.c

27 
	~"dŸÿnvas.h
"

28 
	~"š.h
"

31 
	mCHILD_PROP_0
,

32 
	mCHILD_PROP_X
,

33 
	mCHILD_PROP_Y


36 
dŸ_ÿnvas_şass_š™
 (
DŸCªvasCÏss
 *
kÏss
);

37 
dŸ_ÿnvas_š™
 (
DŸCªvas
 *
ÿnvas
);

38 
dŸ_ÿnvas_»®ize
 (
GtkWidg‘
 *
widg‘
);

39 
dŸ_ÿnvas_size_»que¡
 (
GtkWidg‘
 *
widg‘
,

40 
GtkRequis™iÚ
 *
»quis™iÚ
);

41 
dŸ_ÿnvas_size_®loÿ‹
 (
GtkWidg‘
 *
widg‘
,

42 
GtkAÎoÿtiÚ
 *
®loÿtiÚ
);

43 
dŸ_ÿnvas_add
 (
GtkCÚš”
 *
cÚš”
,

44 
GtkWidg‘
 *
widg‘
);

45 
dŸ_ÿnvas_»move
 (
GtkCÚš”
 *
cÚš”
,

46 
GtkWidg‘
 *
widg‘
);

47 
dŸ_ÿnvas_fÜ®l
 (
GtkCÚš”
 *
cÚš”
,

48 
gboŞ—n
 
šşude_š‹º®s
,

49 
GtkC®lback
 
ÿÎback
,

50 
gpoš‹r
 
ÿÎback_d©a
);

51 
GTy³
 
dŸ_ÿnvas_chd_ty³
 (
GtkCÚš”
 *
cÚš”
);

53 
dŸ_ÿnvas_£t_chd_´İ”ty
 (
GtkCÚš”
 *
cÚš”
,

54 
GtkWidg‘
 *
chd
,

55 
gušt
 
´İ”ty_id
,

56 cÚ¡ 
GV®ue
 *
v®ue
,

57 
GP¬amS³c
 *
p¥ec
);

58 
dŸ_ÿnvas_g‘_chd_´İ”ty
 (
GtkCÚš”
 *
cÚš”
,

59 
GtkWidg‘
 *
chd
,

60 
gušt
 
´İ”ty_id
,

61 
GV®ue
 *
v®ue
,

62 
GP¬amS³c
 *
p¥ec
);

63 
dŸ_ÿnvas_£nd_cÚfigu»
 (
DŸCªvas
 *
d¬—
);

65 
GtkCÚš”CÏss
 *
	g·»Á_şass
 = 
NULL
;

68 
GTy³


69 
	$dŸ_ÿnvas_g‘_ty³
 ()

71 
GTy³
 
ÿnvas_ty³
 = 0;

73 ià(!
ÿnvas_ty³
)

75 cÚ¡ 
GTy³Info
 
ÿnvas_šfo
 =

77  (
DŸCªvasCÏss
),

78 
NULL
,

79 
NULL
,

80 (
GCÏssIn™Func
è
dŸ_ÿnvas_şass_š™
,

81 
NULL
,

82 
NULL
,

83  (
DŸCªvas
),

85 (
GIn¡ªûIn™Func
è
dŸ_ÿnvas_š™
,

88 
ÿnvas_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
GTK_TYPE_CONTAINER
, "DiaCanvas",

89 &
ÿnvas_šfo
, 0);

92  
ÿnvas_ty³
;

93 
	}
}

96 
	$dŸ_ÿnvas_şass_š™
 (
DŸCªvasCÏss
 *
şass
)

98 
GtkWidg‘CÏss
 *
widg‘_şass
;

99 
GtkCÚš”CÏss
 *
cÚš”_şass
;

101 
widg‘_şass
 = (
GtkWidg‘CÏss
*è
şass
;

102 
cÚš”_şass
 = (
GtkCÚš”CÏss
*è
şass
;

104 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
şass
);

106 
widg‘_şass
->
»®ize
 = 
dŸ_ÿnvas_»®ize
;

107 
widg‘_şass
->
size_»que¡
 = 
dŸ_ÿnvas_size_»que¡
;

108 
widg‘_şass
->
size_®loÿ‹
 = 
dŸ_ÿnvas_size_®loÿ‹
;

110 
cÚš”_şass
->
add
 = 
dŸ_ÿnvas_add
;

111 
cÚš”_şass
->
»move
 = 
dŸ_ÿnvas_»move
;

112 
cÚš”_şass
->
fÜ®l
 = 
dŸ_ÿnvas_fÜ®l
;

113 
cÚš”_şass
->
chd_ty³
 = 
dŸ_ÿnvas_chd_ty³
;

115 
cÚš”_şass
->
£t_chd_´İ”ty
 = 
dŸ_ÿnvas_£t_chd_´İ”ty
;

116 
cÚš”_şass
->
g‘_chd_´İ”ty
 = 
dŸ_ÿnvas_g‘_chd_´İ”ty
;

118 
	`gtk_cÚš”_şass_š¡®l_chd_´İ”ty
 (
cÚš”_şass
,

119 
CHILD_PROP_X
,

120 
	`g_·¿m_¥ec_št
 ("x",

121 
	`_
("X…osition"),

122 
	`_
("X…osition of child widget"),

123 
G_MININT
,

124 
G_MAXINT
,

126 
G_PARAM_READWRITE
));

128 
	`gtk_cÚš”_şass_š¡®l_chd_´İ”ty
 (
cÚš”_şass
,

129 
CHILD_PROP_Y
,

130 
	`g_·¿m_¥ec_št
 ("y",

131 
	`_
("Y…osition"),

132 
	`_
("Y…osition of child widget"),

133 
G_MININT
,

134 
G_MAXINT
,

136 
G_PARAM_READWRITE
));

137 
	}
}

139 
GTy³


140 
	$dŸ_ÿnvas_chd_ty³
 (
GtkCÚš”
 *
cÚš”
)

142  
GTK_TYPE_WIDGET
;

143 
	}
}

146 
	$dŸ_ÿnvas_š™
 (
DŸCªvas
 *
ÿnvas
)

148 
ÿnvas
->
chd»n
 = 
NULL
;

149 
	}
}

151 
GtkWidg‘
*

152 
	$dŸ_ÿnvas_Ãw
 ()

154  
	`g_objeù_Ãw
 (
DIA_TYPE_CANVAS
, 
NULL
);

155 
	}
}

158 
	$dŸ_ÿnvas_£t_size
 (
DŸCªvas
 *
ÿnvas
,

159 
gšt
 
width
,

160 
gšt
 
height
)

162 
	`g_»tuº_if_ç
 (
	`DIA_IS_CANVAS
 (
ÿnvas
));

164 
ÿnvas
->
wª‹dsize
.
width
 = width;

165 
ÿnvas
->
wª‹dsize
.
height
 = height;

167 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
ÿnvas
));

168 
	}
}

171 
	$dŸ_ÿnvas_£nd_cÚfigu»
 (
DŸCªvas
 *
d¬—
)

173 
GtkWidg‘
 *
widg‘
;

174 
GdkEv’t
 *
ev’t
 = 
	`gdk_ev’t_Ãw
 (
GDK_CONFIGURE
);

176 
widg‘
 = 
	`GTK_WIDGET
 (
d¬—
);

178 
ev’t
->
cÚfigu»
.
wšdow
 = 
	`g_objeù_»f
 (
widg‘
->window);

179 
ev’t
->
cÚfigu»
.
£nd_ev’t
 = 
TRUE
;

180 
ev’t
->
cÚfigu»
.
x
 = 
widg‘
->
®loÿtiÚ
.x;

181 
ev’t
->
cÚfigu»
.
y
 = 
widg‘
->
®loÿtiÚ
.y;

182 
ev’t
->
cÚfigu»
.
width
 = 
widg‘
->
®loÿtiÚ
.width;

183 
ev’t
->
cÚfigu»
.
height
 = 
widg‘
->
®loÿtiÚ
.height;

185 
	`gtk_widg‘_ev’t
 (
widg‘
, 
ev’t
);

186 
	`gdk_ev’t_ä“
 (
ev’t
);

187 
	}
}

189 
DŸCªvasChd
*

190 
	$g‘_chd
 (
DŸCªvas
 *
ÿnvas
,

191 
GtkWidg‘
 *
widg‘
)

193 
GLi¡
 *
chd»n
;

195 
chd»n
 = 
ÿnvas
->children;

196 
chd»n
)

198 
DŸCªvasChd
 *
chd
;

200 
chd
 = 
chd»n
->
d©a
;

201 
chd»n
 = chd»n->
Ãxt
;

203 ià(
chd
->
widg‘
 == widget)

204  
chd
;

207  
NULL
;

208 
	}
}

211 
	$dŸ_ÿnvas_put
 (
DŸCªvas
 *
ÿnvas
,

212 
GtkWidg‘
 *
widg‘
,

213 
gšt
 
x
,

214 
gšt
 
y
)

216 
DŸCªvasChd
 *
chd_šfo
;

218 
	`g_»tuº_if_ç
 (
	`DIA_IS_CANVAS
 (
ÿnvas
));

219 
	`g_»tuº_if_ç
 (
	`GTK_IS_WIDGET
 (
ÿnvas
));

221 
chd_šfo
 = 
	`g_Ãw
 (
DŸCªvasChd
, 1);

222 
chd_šfo
->
widg‘
 = widget;

223 
chd_šfo
->
x
 = x;

224 
chd_šfo
->
y
 = y;

226 
	`gtk_widg‘_£t_·»Á
 (
widg‘
, 
	`GTK_WIDGET
 (
ÿnvas
));

228 
ÿnvas
->
chd»n
 = 
	`g_li¡_­³nd
 (ÿnvas->chd»n, 
chd_šfo
);

229 
	}
}

232 
	$dŸ_ÿnvas_move_š‹º®
 (
DŸCªvas
 *
ÿnvas
,

233 
GtkWidg‘
 *
widg‘
,

234 
gboŞ—n
 
chªge_x
,

235 
gšt
 
x
,

236 
gboŞ—n
 
chªge_y
,

237 
gšt
 
y
)

239 
DŸCªvasChd
 *
chd
;

241 
	`g_»tuº_if_ç
 (
	`DIA_IS_CANVAS
 (
ÿnvas
));

242 
	`g_»tuº_if_ç
 (
	`GTK_IS_WIDGET
 (
widg‘
));

243 
	`g_»tuº_if_ç
 (
widg‘
->
·»Á
 =ğ
	`GTK_WIDGET
 (
ÿnvas
));

245 
chd
 = 
	`g‘_chd
 (
ÿnvas
, 
widg‘
);

247 
	`g_as£¹
 (
chd
);

249 
	`gtk_widg‘_ä“ze_chd_nÙify
 (
widg‘
);

251 ià(
chªge_x
)

253 
chd
->
x
 = x;

254 
	`gtk_widg‘_chd_nÙify
 (
widg‘
, "x");

257 ià(
chªge_y
)

259 
chd
->
y
 = y;

260 
	`gtk_widg‘_chd_nÙify
 (
widg‘
, "y");

263 
	`gtk_widg‘_thaw_chd_nÙify
 (
widg‘
);

265 ià(
	`GTK_WIDGET_VISIBLE
 (
widg‘
è&& GTK_WIDGET_VISIBLE (
ÿnvas
))

266 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
ÿnvas
));

267 
	}
}

270 
	$dŸ_ÿnvas_move
 (
DŸCªvas
 *
ÿnvas
,

271 
GtkWidg‘
 *
widg‘
,

272 
gšt
 
x
,

273 
gšt
 
y
)

275 
	`dŸ_ÿnvas_move_š‹º®
 (
ÿnvas
, 
widg‘
, 
TRUE
, 
x
, TRUE, 
y
);

276 
	}
}

279 
	$dŸ_ÿnvas_£t_chd_´İ”ty
 (
GtkCÚš”
 *
cÚš”
,

280 
GtkWidg‘
 *
chd
,

281 
gušt
 
´İ”ty_id
,

282 cÚ¡ 
GV®ue
 *
v®ue
,

283 
GP¬amS³c
 *
p¥ec
)

285 
´İ”ty_id
)

287 
CHILD_PROP_X
:

288 
	`dŸ_ÿnvas_move_š‹º®
 (
	`DIA_CANVAS
 (
cÚš”
),

289 
chd
,

290 
TRUE
, 
	`g_v®ue_g‘_št
 (
v®ue
),

291 
FALSE
, 0);

293 
CHILD_PROP_Y
:

294 
	`dŸ_ÿnvas_move_š‹º®
 (
	`DIA_CANVAS
 (
cÚš”
),

295 
chd
,

296 
FALSE
, 0,

297 
TRUE
, 
	`g_v®ue_g‘_št
 (
v®ue
));

300 
	`GTK_CONTAINER_WARN_INVALID_CHILD_PROPERTY_ID
 (
cÚš”
, 
´İ”ty_id
, 
p¥ec
);

303 
	}
}

306 
	$dŸ_ÿnvas_g‘_chd_´İ”ty
 (
GtkCÚš”
 *
cÚš”
,

307 
GtkWidg‘
 *
chd
,

308 
gušt
 
´İ”ty_id
,

309 
GV®ue
 *
v®ue
,

310 
GP¬amS³c
 *
p¥ec
)

312 
DŸCªvasChd
 *
ÿnvas_chd
;

314 
ÿnvas_chd
 = 
	`g‘_chd
 (
	`DIA_CANVAS
 (
cÚš”
), 
chd
);

316 
´İ”ty_id
)

318 
CHILD_PROP_X
:

319 
	`g_v®ue_£t_št
 (
v®ue
, 
ÿnvas_chd
->
x
);

321 
CHILD_PROP_Y
:

322 
	`g_v®ue_£t_št
 (
v®ue
, 
ÿnvas_chd
->
y
);

325 
	`GTK_CONTAINER_WARN_INVALID_CHILD_PROPERTY_ID
 (
cÚš”
, 
´İ”ty_id
, 
p¥ec
);

328 
	}
}

331 
	$dŸ_ÿnvas_»®ize
 (
GtkWidg‘
 *
widg‘
)

333 
GdkWšdowA‰r
 
©Œibu‹s
;

334 
gšt
 
©Œibu‹s_mask
;

336 
	`GTK_WIDGET_SET_FLAGS
 (
widg‘
, 
GTK_REALIZED
);

338 
©Œibu‹s
.
wšdow_ty³
 = 
GDK_WINDOW_CHILD
;

339 
©Œibu‹s
.
x
 = 
widg‘
->
®loÿtiÚ
.x;

340 
©Œibu‹s
.
y
 = 
widg‘
->
®loÿtiÚ
.y;

341 
©Œibu‹s
.
width
 = 
widg‘
->
®loÿtiÚ
.width;

342 
©Œibu‹s
.
height
 = 
widg‘
->
®loÿtiÚ
.height;

343 
©Œibu‹s
.
wşass
 = 
GDK_INPUT_OUTPUT
;

344 
©Œibu‹s
.
visu®
 = 
	`gtk_widg‘_g‘_visu®
 (
widg‘
);

345 
©Œibu‹s
.
cŞÜm­
 = 
	`gtk_widg‘_g‘_cŞÜm­
 (
widg‘
);

346 
©Œibu‹s
.
ev’t_mask
 = 
	`gtk_widg‘_g‘_ev’ts
 (
widg‘
);

347 
©Œibu‹s
.
ev’t_mask
 |ğ
GDK_EXPOSURE_MASK
 | 
GDK_BUTTON_PRESS_MASK
;

349 
©Œibu‹s_mask
 = 
GDK_WA_X
 | 
GDK_WA_Y
 | 
GDK_WA_VISUAL
 | 
GDK_WA_COLORMAP
;

351 
widg‘
->
wšdow
 = 
	`gdk_wšdow_Ãw
 (
	`gtk_widg‘_g‘_·»Á_wšdow
 (widg‘), &
©Œibu‹s
,

352 
©Œibu‹s_mask
);

353 
	`gdk_wšdow_£t_u£r_d©a
 (
widg‘
->
wšdow
, widget);

355 
widg‘
->
¡yË
 = 
	`gtk_¡yË_©ch
 (widg‘->¡yË, widg‘->
wšdow
);

356 
	`gtk_¡yË_£t_background
 (
widg‘
->
¡yË
, widg‘->
wšdow
, 
GTK_STATE_NORMAL
);

358 
	`dŸ_ÿnvas_£nd_cÚfigu»
 (
	`DIA_CANVAS
 (
widg‘
));

359 
	}
}

362 
	$dŸ_ÿnvas_size_»que¡
 (
GtkWidg‘
 *
widg‘
,

363 
GtkRequis™iÚ
 *
»quis™iÚ
)

365 
DŸCªvas
 *
ÿnvas
;

366 
DŸCªvasChd
 *
chd
;

367 
GLi¡
 *
chd»n
;

368 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

370 
ÿnvas
 = 
	`DIA_CANVAS
 (
widg‘
);

372 
»quis™iÚ
->
width
 = 
ÿnvas
->
wª‹dsize
.width;

373 
»quis™iÚ
->
height
 = 
ÿnvas
->
wª‹dsize
.height;

376 
chd»n
 = 
ÿnvas
->children;

377 
chd»n
)

379 
chd
 = 
chd»n
->
d©a
;

380 
chd»n
 = chd»n->
Ãxt
;

382 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
))

384 
	`gtk_widg‘_size_»que¡
 (
chd
->
widg‘
, &
chd_»quis™iÚ
);

386 
»quis™iÚ
->
height
 = 
	`MAX
 (requisition->height,

387 
chd
->
y
 +

388 
chd_»quis™iÚ
.
height
);

389 
»quis™iÚ
->
width
 = 
	`MAX
 (requisition->width,

390 
chd
->
x
 +

391 
chd_»quis™iÚ
.
width
);

398 
	}
}

401 
	$dŸ_ÿnvas_size_®loÿ‹
 (
GtkWidg‘
 *
widg‘
,

402 
GtkAÎoÿtiÚ
 *
®loÿtiÚ
)

404 
DŸCªvas
 *
ÿnvas
;

405 
DŸCªvasChd
 *
chd
;

406 
GtkAÎoÿtiÚ
 
chd_®loÿtiÚ
;

407 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

408 
GLi¡
 *
chd»n
;

409 
gušt16
 
bÜd”_width
;

411 
ÿnvas
 = 
	`DIA_CANVAS
 (
widg‘
);

413 
widg‘
->
®loÿtiÚ
 = *allocation;

415 ià(
	`GTK_WIDGET_REALIZED
 (
widg‘
)) {

416 
	`gdk_wšdow_move_»size
 (
widg‘
->
wšdow
,

417 
®loÿtiÚ
->
x
,

418 
®loÿtiÚ
->
y
,

419 
®loÿtiÚ
->
width
,

420 
®loÿtiÚ
->
height
);

421 
	`dŸ_ÿnvas_£nd_cÚfigu»
 (
	`DIA_CANVAS
 (
widg‘
));

423 
bÜd”_width
 = 
	`GTK_CONTAINER
 (
ÿnvas
)->border_width;

425 
chd»n
 = 
ÿnvas
->children;

426 
chd»n
)

428 
chd
 = 
chd»n
->
d©a
;

429 
chd»n
 = chd»n->
Ãxt
;

431 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
))

433 
	`gtk_widg‘_g‘_chd_»quis™iÚ
 (
chd
->
widg‘
, &
chd_»quis™iÚ
);

434 
chd_®loÿtiÚ
.
x
 = 
chd
->x + 
bÜd”_width
;

435 
chd_®loÿtiÚ
.
y
 = 
chd
->y + 
bÜd”_width
;

437 ià(
	`GTK_WIDGET_NO_WINDOW
 (
widg‘
))

439 
chd_®loÿtiÚ
.
x
 +ğ
widg‘
->
®loÿtiÚ
.x;

440 
chd_®loÿtiÚ
.
y
 +ğ
widg‘
->
®loÿtiÚ
.y;

443 
chd_®loÿtiÚ
.
width
 = 
chd_»quis™iÚ
.width;

444 
chd_®loÿtiÚ
.
height
 = 
chd_»quis™iÚ
.height;

445 
	`gtk_widg‘_size_®loÿ‹
 (
chd
->
widg‘
, &
chd_®loÿtiÚ
);

448 
	}
}

451 
	$dŸ_ÿnvas_add
 (
GtkCÚš”
 *
cÚš”
,

452 
GtkWidg‘
 *
widg‘
)

454 
	`dŸ_ÿnvas_put
 (
	`DIA_CANVAS
 (
cÚš”
), 
widg‘
, 0, 0);

455 
	}
}

458 
	$dŸ_ÿnvas_»move
 (
GtkCÚš”
 *
cÚš”
,

459 
GtkWidg‘
 *
widg‘
)

461 
DŸCªvas
 *
ÿnvas
;

462 
DŸCªvasChd
 *
chd
;

463 
GLi¡
 *
chd»n
;

465 
ÿnvas
 = 
	`DIA_CANVAS
 (
cÚš”
);

467 
chd»n
 = 
ÿnvas
->children;

468 
chd»n
)

470 
chd
 = 
chd»n
->
d©a
;

472 ià(
chd
->
widg‘
 == widget)

474 
gboŞ—n
 
was_visibË
 = 
	`GTK_WIDGET_VISIBLE
 (
widg‘
);

476 
	`gtk_widg‘_uÅ¬’t
 (
widg‘
);

478 
ÿnvas
->
chd»n
 = 
	`g_li¡_»move_lšk
 (canvas->children, children);

479 
	`g_li¡_ä“
 (
chd»n
);

480 
	`g_ä“
 (
chd
);

482 ià(
was_visibË
 && 
	`GTK_WIDGET_VISIBLE
 (
cÚš”
))

483 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
cÚš”
));

488 
chd»n
 = chd»n->
Ãxt
;

490 
	}
}

493 
	$dŸ_ÿnvas_fÜ®l
 (
GtkCÚš”
 *
cÚš”
,

494 
gboŞ—n
 
šşude_š‹º®s
,

495 
GtkC®lback
 
ÿÎback
,

496 
gpoš‹r
 
ÿÎback_d©a
)

498 
DŸCªvas
 *
ÿnvas
;

499 
DŸCªvasChd
 *
chd
;

500 
GLi¡
 *
chd»n
;

502 
	`g_»tuº_if_ç
 (
ÿÎback
 !ğ
NULL
);

504 
ÿnvas
 = 
	`DIA_CANVAS
 (
cÚš”
);

506 
chd»n
 = 
ÿnvas
->children;

507 
chd»n
)

509 
chd
 = 
chd»n
->
d©a
;

510 
chd»n
 = chd»n->
Ãxt
;

512 (* 
ÿÎback
è(
chd
->
widg‘
, 
ÿÎback_d©a
);

514 
	}
}

	@O:\tool\dvs50\app\diacanvas.h

27 #iâdeà
__DIA_CANVAS_H__


28 
	#__DIA_CANVAS_H__


	)

31 
	~<gdk/gdk.h
>

32 
	~<gtk/gtkcÚš”.h
>

35 #ifdeà
__ılu¥lus


40 
	#DIA_TYPE_CANVAS
 (
	`dŸ_ÿnvas_g‘_ty³
 ())

	)

41 
	#DIA_CANVAS
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_CANVAS
, 
DŸCªvas
))

	)

42 
	#DIA_CANVAS_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_CANVAS
, 
DŸCªvasCÏss
))

	)

43 
	#DIA_IS_CANVAS
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_CANVAS
))

	)

44 
	#DIA_IS_CANVAS_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kÏss), 
DIA_TYPE_CANVAS
))

	)

45 
	#DIA_CANVAS_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_CANVAS
, 
DŸCªvasCÏss
))

	)

48 
_DŸCªvas
 
	tDŸCªvas
;

49 
_DŸCªvasCÏss
 
	tDŸCªvasCÏss
;

50 
_DŸCªvasChd
 
	tDŸCªvasChd
;

52 
	s_DŸCªvas


54 
GtkCÚš”
 
cÚš”
;

56 
GtkRequis™iÚ
 
wª‹dsize
;

57 
GLi¡
 *
chd»n
;

60 
	s_DŸCªvasCÏss


62 
GtkCÚš”CÏss
 
·»Á_şass
;

65 
	s_DŸCªvasChd


67 
GtkWidg‘
 *
widg‘
;

68 
gšt
 
x
;

69 
gšt
 
y
;

73 
GTy³
 
dŸ_ÿnvas_g‘_ty³
 (è
G_GNUC_CONST
;

74 
GtkWidg‘
* 
dŸ_ÿnvas_Ãw
 ();

75 
dŸ_ÿnvas_put
 (
DŸCªvas
 *
ÿnvas
,

76 
GtkWidg‘
 *
widg‘
,

77 
gšt
 
x
,

78 
gšt
 
y
);

79 
dŸ_ÿnvas_move
 (
DŸCªvas
 *
ÿnvas
,

80 
GtkWidg‘
 *
widg‘
,

81 
gšt
 
x
,

82 
gšt
 
y
);

83 
dŸ_ÿnvas_£t_size
 (
DŸCªvas
 *
ÿnvas
,

84 
gšt
 
width
,

85 
gšt
 
height
);

87 #ifdeà
__ılu¥lus


	@O:\tool\dvs50\app\diagram.c

19 
	~<cÚfig.h
>

21 
	~<as£¹.h
>

22 
	~<¡ršg.h
>

24 
	~"š.h
"

25 
	~"dŸg¿m.h
"

26 
	~"objeù.h
"

27 
	~"group.h
"

28 
	~"objeù_İs.h
"

29 
	~"focus.h
"

30 
	~"mes§ge.h
"

31 
	~"m’us.h
"

32 
	~"´eã»nûs.h
"

33 
	~"´İ”t›s-dŸlog.h
"

34 
	~"cut_n_·¡e.h
"

35 
	~"Ïy”_dŸlog.h
"

36 
	~"­p_´ocs.h
"

37 
	~"dŸ_dœs.h
"

38 
	~"lßd_§ve.h
"

39 
	~"»ûÁ_fes.h
"

40 
	~"dŸg¿m_Œ“_wšdow.h
"

41 
	~"auto§ve.h
"

42 
	~"dyÇmic_»äesh.h
"

43 
	~"‹x‹d™.h
"

44 
	~"lib/dŸm¬sh®.h
"

45 
	~"·»Á.h
"

47 
GLi¡
 *
	gİ’_dŸg¿ms
 = 
NULL
;

49 
	s_ObjeùEx‹Á


51 
DŸObjeù
 *
	mobjeù
;

52 
ReùªgË
 
	mex‹Á
;

55 
_ObjeùEx‹Á
 
	tObjeùEx‹Á
;

57 
gšt
 
dŸg¿m_·»Á_sÜt_cb
(
gcÚ¡poš‹r
 
a
, gcÚ¡poš‹¸
b
);

60 
dŸg¿m_şass_š™
 (
DŸg¿mCÏss
 *
kÏss
);

61 
gboŞ—n
 
dŸg¿m_š™
(
DŸg¿m
 *
obj
, cÚ¡ *
f’ame
);

62 
dŸg¿m_upd©e_fÜ_f’ame
(
DŸg¿m
 *
dŸ
);

65 
	mSELECTION_CHANGED
,

66 
	mREMOVED
,

67 
	mLAST_SIGNAL


70 
gušt
 
	gdŸg¿m_sigÇls
[
LAST_SIGNAL
] = { 0, };

71 
gpoš‹r
 
	g·»Á_şass
 = 
NULL
;

73 
GTy³


74 
	$dŸg¿m_g‘_ty³
 ()

76 
GTy³
 
objeù_ty³
 = 0;

78 ià(!
objeù_ty³
)

80 cÚ¡ 
GTy³Info
 
objeù_šfo
 =

82  (
DŸg¿mCÏss
),

83 (
GBa£In™Func
è
NULL
,

84 (
GBa£Fš®izeFunc
è
NULL
,

85 (
GCÏssIn™Func
è
dŸg¿m_şass_š™
,

86 
NULL
,

87 
NULL
,

88  (
DŸg¿m
),

90 
NULL


93 
objeù_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
DIA_TYPE_DIAGRAM_DATA
,

95 &
objeù_šfo
, 0);

98  
objeù_ty³
;

99 
	}
}

102 
	$dŸg¿m_fš®ize
(
GObjeù
 *
objeù
)

104 
DŸg¿m
 *
dŸ
 = 
	`DIA_DIAGRAM
(
objeù
);

106 
	`as£¹
(
dŸ
->
di¥Ïys
==
NULL
);

108 
İ’_dŸg¿ms
 = 
	`g_li¡_»move
(İ’_dŸg¿ms, 
dŸ
);

109 
	`Ïy”_dŸlog_upd©e_dŸg¿m_li¡
();

111 ià(
dŸ
->
undo
)

112 
	`undo_de¡roy
(
dŸ
->
undo
);

113 
dŸ
->
undo
 = 
NULL
;

115 
	`dŸg¿m_Œ“_»move
(
	`dŸg¿m_Œ“
(), 
dŸ
);

117 
	`dŸg¿m_ş—nup_auto§ve
(
dŸ
);

119 ià(
dŸ
->
f’ame
)

120 
	`g_ä“
(
dŸ
->
f’ame
);

121 
dŸ
->
f’ame
 = 
NULL
;

123 
	`G_OBJECT_CLASS
 (
·»Á_şass
)->
	`fš®ize
 (
objeù
);

124 
	}
}

127 
	$_dŸg¿m_»moved
 (
DŸg¿m
* 
dŸ
)

129 
	}
}

132 
	$_dŸg¿m_£ËùiÚ_chªged
 (
DŸg¿m
* 
dŸ
, 
n
)

134 
	}
}

137 
	$dŸg¿m_şass_š™
 (
DŸg¿mCÏss
 *
kÏss
)

139 
GObjeùCÏss
 *
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
kÏss
);

141 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
kÏss
);

143 
dŸg¿m_sigÇls
[
REMOVED
] =

144 
	`g_sigÇl_Ãw
 ("removed",

145 
	`G_TYPE_FROM_CLASS
 (
kÏss
),

146 
G_SIGNAL_RUN_FIRST
,

147 
	`G_STRUCT_OFFSET
 (
DŸg¿mCÏss
, 
»moved
),

148 
NULL
, NULL,

149 
dŸ_m¬sh®_VOID__VOID
,

150 
G_TYPE_NONE
, 0);

152 
dŸg¿m_sigÇls
[
SELECTION_CHANGED
] =

153 
	`g_sigÇl_Ãw
 ("selection_changed",

154 
	`G_TYPE_FROM_CLASS
 (
kÏss
),

155 
G_SIGNAL_RUN_FIRST
,

156 
	`G_STRUCT_OFFSET
 (
DŸg¿mCÏss
, 
£ËùiÚ_chªged
),

157 
NULL
, NULL,

158 
dŸ_m¬sh®_VOID__INT
,

159 
G_TYPE_NONE
, 1,

160 
G_TYPE_INT
);

162 
kÏss
->
»moved
 = 
_dŸg¿m_»moved
;

163 
kÏss
->
£ËùiÚ_chªged
 = 
_dŸg¿m_£ËùiÚ_chªged
;

165 
objeù_şass
->
fš®ize
 = 
dŸg¿m_fš®ize
;

166 
	}
}

168 
GLi¡
 *

169 
	$dŸ_İ’_dŸg¿ms
()

171  
İ’_dŸg¿ms
;

172 
	}
}

180 
gboŞ—n


181 
	$dŸg¿m_š™
(
DŸg¿m
 *
dŸ
, cÚ¡ *
f’ame
)

183 
gch¬
 *
Ãwf’ame
 = 
NULL
;

184 
GE¼Ü
 *
”rÜ
 = 
NULL
;

186 
dŸ
->
d©a
 = &dŸ->
·»Á_š¡ªû
;

188 
dŸ
->
·geb»ak_cŞÜ
 = 
´efs
.
Ãw_dŸg¿m
.pagebreak_color;

190 
	`g‘_·³r_šfo
 (&
dŸ
->
d©a
->
·³r
, -1, &
´efs
.
Ãw_dŸg¿m
);

192 
dŸ
->
grid
.
width_x
 = 
´efs
.grid.
x
;

193 
dŸ
->
grid
.
width_y
 = 
´efs
.grid.
y
;

194 
dŸ
->
grid
.
width_w
 = 
´efs
.grid.
w
;

195 
dŸ
->
grid
.
hex_size
 = 1.0;

196 
dŸ
->
grid
.
cŞour
 = 
´efs
.
Ãw_dŸg¿m
.
grid_cŞÜ
;

197 
dŸ
->
grid
.
hex
 = 
´efs
.grid.hex;

198 
dŸ
->
grid
.
visibË_x
 = 1;

199 
dŸ
->
grid
.
visibË_y
 = 1;

200 
dŸ
->
grid
.
dyÇmic
 = 
´efs
.grid.dynamic;

201 
dŸ
->
grid
.
majÜ_lšes
 = 
´efs
.grid.major_lines;

203 
dŸ
->
guides
.
nhguides
 = 0;

204 
dŸ
->
guides
.
hguides
 = 
NULL
;

205 
dŸ
->
guides
.
nvguides
 = 0;

206 
dŸ
->
guides
.
vguides
 = 
NULL
;

208 ià(
dŸ
->
f’ame
 !ğ
NULL
)

209 
	`g_ä“
(
dŸ
->
f’ame
);

211 ià(!
	`g_·th_is_absŞu‹
(
f’ame
)) {

212 
gch¬
 *
pwd
 = 
	`g_g‘_cu¼’t_dœ
();

214 
Ãwf’ame
 = 
	`g_bud_f’ame
(
pwd
, 
f’ame
, 
NULL
);

215 
	`g_ä“
(
pwd
);

216 
f’ame
 = 
Ãwf’ame
;

220 
dŸ
->
f’ame
 = 
	`g_f’ame_to_utf8
(f’ame, -1, 
NULL
, NULL, &
”rÜ
);

221 ià(
”rÜ
 !ğ
NULL
) {

222 
	`mes§ge_”rÜ
(
	`_
("Couldn't convert filename '%s'o UTF-8: %s\n"),

223 
	`dŸ_mes§ge_f’ame
(
f’ame
), 
”rÜ
->
mes§ge
);

224 
	`g_”rÜ_ä“
(
”rÜ
);

225 
dŸ
->
f’ame
 = 
	`g_¡rdup
(
	`_
("Error"));

226  
FALSE
;

229 
dŸ
->
un§ved
 = 
TRUE
;

230 
dŸ
->
mŞlif›d
 = 
FALSE
;

231 
dŸ
->
auto§vef’ame
 = 
NULL
;

233 ià(
dŸ
->
undo
)

234 
	`undo_de¡roy
(
dŸ
->
undo
);

235 
dŸ
->
undo
 = 
	`Ãw_undo_¡ack
(dia);

237 ià(!
	`g_li¡_fšd
(
İ’_dŸg¿ms
, 
dŸ
))

238 
İ’_dŸg¿ms
 = 
	`g_li¡_´•’d
(İ’_dŸg¿ms, 
dŸ
);

240 ià(
	`­p_is_š‹¿ùive
())

241 
	`Ïy”_dŸlog_upd©e_dŸg¿m_li¡
();

243 
	`g_ä“
(
Ãwf’ame
);

244  
TRUE
;

245 
	}
}

248 
	$dŸg¿m_lßd_što
(
DŸg¿m
 *
dŸg¿m
,

249 cÚ¡ *
f’ame
,

250 
DŸImpÜtF‹r
 *
if‹r
)

252 
gboŞ—n
 
was_deçuÉ
 = 
dŸg¿m
->
is_deçuÉ
;

253 ià(!
if‹r
)

254 
if‹r
 = 
	`f‹r_guess_impÜt_f‹r
(
f’ame
);

255 ià(!
if‹r
)

256 
if‹r
 = &
dŸ_impÜt_f‹r
;

258 ià(
if‹r
->
	`impÜt_func
(
f’ame
, 
dŸg¿m
->
d©a
, if‹r->
u£r_d©a
)) {

259 ià(
if‹r
 !ğ&
dŸ_impÜt_f‹r
) {

262 ià(
	`¡rcmp
 (
dŸg¿m
->
f’ame
, filename) == 0) {

264 
gch¬
 *
Şd_f’ame
 = 
	`g_¡rdup
 (
dŸg¿m
->
f’ame
);

265 
gch¬
 *
suffix_off£t
 = 
	`g_utf8_¡¼chr
(
Şd_f’ame
, -1, (
gunich¬
)'.');

266 
gch¬
 *
Ãw_f’ame
;

267 ià(
suffix_off£t
 !ğ
NULL
) {

268 
Ãw_f’ame
 = 
	`g_¡ºdup
(
Şd_f’ame
, 
suffix_off£t
 - old_filename);

269 
	`g_ä“
(
Şd_f’ame
);

271 
Ãw_f’ame
 = 
Şd_f’ame
;

273 
Şd_f’ame
 = 
	`g_¡rcÚÿt
(
Ãw_f’ame
, ".dŸ", 
NULL
);

274 
	`g_ä“
(
Ãw_f’ame
);

275 
	`dŸg¿m_£t_f’ame
(
dŸg¿m
, 
Şd_f’ame
);

276 
	`g_ä“
(
Şd_f’ame
);

277 
dŸg¿m
->
un§ved
 = 
TRUE
;

278 
	`dŸg¿m_upd©e_fÜ_f’ame
 (
dŸg¿m
);

279 
	`dŸg¿m_modif›d
(
dŸg¿m
);

283 
dŸg¿m
->
un§ved
 =

284 
	`¡rcmp
(
f’ame
, 
dŸg¿m
->f’ameè=ğ0 ? 
FALSE
 : 
was_deçuÉ
;

286 
	`dŸg¿m_£t_modif›d
(
dŸg¿m
, 
TRUE
);

287  
TRUE
;

289  
FALSE
;

290 
	}
}

292 
DŸg¿m
 *

293 
	$dŸg¿m_lßd
(cÚ¡ *
f’ame
, 
DŸImpÜtF‹r
 *
if‹r
)

295 
DŸg¿m
 *
dŸg¿m
 = 
NULL
;

296 
GLi¡
 *
dŸg¿ms
;

297 
gboŞ—n
 
was_deçuÉ
 = 
FALSE
;

299 
dŸg¿ms
 = 
İ’_dŸg¿ms
; dŸg¿m !ğ
NULL
; dŸg¿m ğ
	`g_li¡_Ãxt
(diagrams)) {

300 
DŸg¿m
 *
Şd_dŸg¿m
 = (DŸg¿m*)
dŸg¿ms
->
d©a
;

301 ià(
Şd_dŸg¿m
->
is_deçuÉ
) {

302 
dŸg¿m
 = 
Şd_dŸg¿m
;

303 
was_deçuÉ
 = 
TRUE
;

309 ià(
dŸg¿m
 =ğ
NULL
) {

310 
dŸg¿m
 = 
	`Ãw_dŸg¿m
(
f’ame
);

312 ià(
dŸg¿m
 =ğ
NULL
)  NULL;

314 iàĞ!
	`dŸg¿m_š™
(
dŸg¿m
, 
f’ame
)

315 || !
	`dŸg¿m_lßd_što
 (
dŸg¿m
, 
f’ame
, 
if‹r
)) {

316 ià(!
was_deçuÉ
)

317 
	`dŸg¿m_de¡roy
(
dŸg¿m
);

318 
dŸg¿m
 = 
NULL
;

321 
	`dŸg¿m_£t_modif›d
(
dŸg¿m
, 
FALSE
);

322 ià(
	`­p_is_š‹¿ùive
()) {

323 
	`»ûÁ_fe_hi¡Üy_add
(
f’ame
);

324 
	`dŸg¿m_Œ“_add
(
	`dŸg¿m_Œ“
(), 
dŸg¿m
);

328 ià(
dŸg¿m
 !ğ
NULL
 && 
was_deçuÉ
 && 
	`­p_is_š‹¿ùive
()) {

329 
	`dŸg¿m_upd©e_fÜ_f’ame
(
dŸg¿m
);

330 
dŸg¿m
->
is_deçuÉ
 = 
FALSE
;

331 iàĞ
	`g_¦i¡_Ëngth
(
dŸg¿m
->
di¥Ïys
) == 1 )

332 
	`di¥Ïy_£t_aùive
 (
dŸg¿m
->
di¥Ïys
->
d©a
);

335  
dŸg¿m
;

336 
	}
}

342 
DŸg¿m
 *

343 
	$Ãw_dŸg¿m
(cÚ¡ *
f’ame
)

345 
DŸg¿m
 *
dŸ
 = 
	`g_objeù_Ãw
(
DIA_TYPE_DIAGRAM
, 
NULL
);

347 ià(
	`dŸg¿m_š™
(
dŸ
, 
f’ame
)) {

348  
dŸ
;

350 
	`g_objeù_uÄef
(
dŸ
);

351  
NULL
;

353 
	}
}

356 
	$dŸg¿m_de¡roy
(
DŸg¿m
 *
dŸ
)

358 
	`g_sigÇl_em™
 (
dŸ
, 
dŸg¿m_sigÇls
[
REMOVED
], 0);

359 
	`g_objeù_uÄef
(
dŸ
);

360 
	}
}

364 
gboŞ—n


365 
	$dŸg¿m_is_modif›d
(
DŸg¿m
 *
dŸ
)

367  
dŸ
->
mŞlif›d
 || !
	`undo_is_§ved
(dŸ->
undo
);

368 
	}
}

374 
	$dŸg¿m_modif›d
(
DŸg¿m
 *
dŸ
)

376 
GSLi¡
 *
di¥Ïys
;

377 
gch¬
 *
dŸ_Çme
 = 
	`dŸg¿m_g‘_Çme
(
dŸ
);

378 
gch¬
 *
exŒa
 = 
	`g_·th_g‘_dœÇme
 (
dŸ
->
f’ame
);

379 
gch¬
 *
t™Ë
 = 
	`g_¡rdup_´štf
 ("%s% (%s)", 
	`dŸg¿m_is_modif›d
(
dŸ
è? "*" : "", 
dŸ_Çme
, 
exŒa
 ?ƒxtra : " ");

381 
	`g_ä“
 (
dŸ_Çme
);

382 
	`g_ä“
 (
exŒa
);

383 
di¥Ïys
 = 
dŸ
->displays;

384 
di¥Ïys
!=
NULL
) {

385 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *è
di¥Ïys
->
d©a
;

387 
	`ddi¥Ïy_£t_t™Ë
(
ddi¥
, 
t™Ë
);

389 
di¥Ïys
 = 
	`g_¦i¡_Ãxt
(displays);

391 ià(
	`dŸg¿m_is_modif›d
(
dŸ
)) {

392 
dŸ
->
auto§ved
 = 
FALSE
;

393 
dŸ
->
is_deçuÉ
 = 
FALSE
;

396 
	`g_ä“
 (
t™Ë
);

397 
	}
}

404 
	$dŸg¿m_£t_modif›d
(
DŸg¿m
 *
dŸ
, 
modif›d
)

406 ià(
dŸ
->
mŞlif›d
 !ğ
modif›d
)

408 
dŸ
->
mŞlif›d
 = 
modif›d
;

410 
	`dŸg¿m_modif›d
(
dŸ
);

411 
	}
}

419 
gboŞ—n


420 
	$dŸg¿m_£Ëùed_ªy_groups
(
DŸg¿m
 *
dŸ
) {

421 
GLi¡
 *
£Ëùed
;

423 
£Ëùed
 = 
dŸ
->
d©a
->selected;

424 
£Ëùed
 !ğ
NULL
; s–eùed = s–eùed->
Ãxt
) {

425 
DŸObjeù
 *
obj
 = (DŸObjeù*)
£Ëùed
->
d©a
;

426 ià(
	`IS_GROUP
(
obj
)è 
TRUE
;

428  
FALSE
;

429 
	}
}

431 
gboŞ—n


432 
	$dŸg¿m_£Ëùed_ªy_·»Ás
(
DŸg¿m
 *
dŸ
) {

433 
GLi¡
 *
£Ëùed
;

435 
£Ëùed
 = 
dŸ
->
d©a
->selected;

436 
£Ëùed
 !ğ
NULL
; s–eùed = s–eùed->
Ãxt
) {

437 
DŸObjeù
 *
obj
 = (DŸObjeù*)
£Ëùed
->
d©a
;

438 ià(
	`objeù_æags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
è&& obj->
chd»n
 !ğ
NULL
)

439  
TRUE
;

441  
FALSE
;

442 
	}
}

444 
gboŞ—n


445 
	$dŸg¿m_£Ëùed_ªy_chd»n
(
DŸg¿m
 *
dŸ
) {

446 
GLi¡
 *
£Ëùed
;

448 
£Ëùed
 = 
dŸ
->
d©a
->selected;

449 
£Ëùed
 !ğ
NULL
; s–eùed = s–eùed->
Ãxt
) {

450 
DŸObjeù
 *
obj
 = (DŸObjeù*)
£Ëùed
->
d©a
;

451 ià(
obj
->
·»Á
 !ğ
NULL
è 
TRUE
;

453  
FALSE
;

454 
	}
}

459 
gboŞ—n


460 
	$dŸg¿m_£Ëùed_ÿn_·»Á
(
DŸg¿m
 *
dŸ
) {

461 
GLi¡
 *
£Ëùed
;

462 
GLi¡
 *
·»Ás
 = 
NULL
;

464 
£Ëùed
 = 
dŸ
->
d©a
->selected;

465 
£Ëùed
 !ğ
NULL
; s–eùed = s–eùed->
Ãxt
) {

466 
DŸObjeù
 *
obj
 = (DŸObjeù*)
£Ëùed
->
d©a
;

467 ià(
	`objeù_æags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
)) {

468 
·»Ás
 = 
	`g_li¡_´•’d
Õ¬’ts, 
obj
);

471 
£Ëùed
 = 
dŸ
->
d©a
->selected;

472 
£Ëùed
 !ğ
NULL
; s–eùed = s–eùed->
Ãxt
) {

473 
DŸObjeù
 *
obj
 = (DŸObjeù*)
£Ëùed
->
d©a
;

474 ià(
obj
->
·»Á
 =ğ
NULL
) {

475 
GLi¡
 *
·»Á_tmp
;

476 
·»Á_tmp
 = 
·»Ás
;…¬’t_tm°!ğ
NULL
;…¬’t_tm°ğ·»Á_tmp->
Ãxt
) {

477 ià(
	`objeù_w™hš_·»Á
(
obj
, (
DŸObjeù
*)
·»Á_tmp
->
d©a
)) {

478 
	`g_li¡_ä“
(
·»Ás
);

479  
TRUE
;

484 
	`g_li¡_ä“
(
·»Ás
);

485  
FALSE
;

486 
	}
}

490 
gboŞ—n


491 
	$objeù_w™hš_·»Á
(
DŸObjeù
 *
obj
, DŸObjeù *
p
)

493 
ReùªgË
 
obj_bb
 = 
obj
->
boundšg_box
;

494 ià(!
	`objeù_æags_£t
(
p
, 
DIA_OBJECT_CAN_PARENT
))

495  
FALSE
;

496 ià(
p
 =ğ
obj
)

497  
FALSE
;

498 ià(
obj_bb
.
Ëá
 > 
p
->
boundšg_box
.left &&

499 
obj_bb
.
right
 < 
p
->
boundšg_box
.right &&

500 
obj_bb
.
tİ
 > 
p
->
boundšg_box
.top &&

501 
obj_bb
.
bÙtom
 < 
p
->
boundšg_box
.bottom)

502  
TRUE
;

503  
FALSE
;

504 
	}
}

511 
	$dŸg¿m_upd©e_m’u_£ns™iv™y
 (
DŸg¿m
 *
dŸ
)

513 
gšt
 
£Ëùed_couÁ
 = 
	`g_li¡_Ëngth
 (
dŸ
->
d©a
->
£Ëùed
);

514 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

515 
gboŞ—n
 
focus_aùive
 = (
	`g‘_aùive_focus
(
dŸ
->
d©a
è!ğ
NULL
);

516 
gboŞ—n
 
‹x‹d™_aùive
 = 
ddi¥
 ? 
	`‹x‹d™_mode
(ddi¥è: 
FALSE
;

517 
GtkAùiÚ
 *
aùiÚ
;

520 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™Undo")è!ğ
NULL
)

521 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, 
dŸ
 ? 
	`undo_avaabË
(dŸ->
undo
, 
TRUE
è: 
FALSE
);

522 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™Redo")è!ğ
NULL
)

523 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, 
dŸ
 ? 
	`undo_avaabË
(dŸ->
undo
, 
FALSE
) : FALSE);

524 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™Cİy")è!ğ
NULL
)

525 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, 
‹x‹d™_aùive
 || 
£Ëùed_couÁ
 > 0);

526 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™Cut")è!ğ
NULL
)

527 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, 
	`‹x‹d™_mode
(
ddi¥
è|| 
£Ëùed_couÁ
 > 0);

528 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™Pa¡e")è!ğ
NULL
)

529 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, 
‹x‹d™_aùive
 || 
	`úp_exi¡_¡Üed_objeùs
());

530 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™D–‘e")è!ğ
NULL
)

531 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, !
‹x‹d™_aùive
 && 
£Ëùed_couÁ
 > 0);

532 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™Du¶iÿ‹")è!ğ
NULL
)

533 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, !
‹x‹d™_aùive
 && 
£Ëùed_couÁ
 > 0);

535 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™Cİy‹xt")è!ğ
NULL
)

536 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, 
focus_aùive
);

537 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™Cu‰ext")è!ğ
NULL
)

538 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, 
focus_aùive
);

539 ià((
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("Ed™Pa¡‘ext")è!ğ
NULL
)

540 
	`gtk_aùiÚ_£t_£ns™ive
 (
aùiÚ
, 
focus_aùive
);

634 
	}
}

638 
	$dŸg¿m_add_ddi¥Ïy
(
DŸg¿m
 *
dŸ
, 
DDi¥Ïy
 *
ddi¥
)

640 
dŸ
->
di¥Ïys
 = 
	`g_¦i¡_´•’d
(dŸ->di¥Ïys, 
ddi¥
);

641 
	}
}

644 
	$dŸg¿m_»move_ddi¥Ïy
(
DŸg¿m
 *
dŸ
, 
DDi¥Ïy
 *
ddi¥
)

646 
dŸ
->
di¥Ïys
 = 
	`g_¦i¡_»move
(dŸ->di¥Ïys, 
ddi¥
);

648 ià(
	`g_¦i¡_Ëngth
(
dŸ
->
di¥Ïys
) == 0) {

649 ià(!
	`­p_is_embedded
()) {

651 
	`dŸg¿m_de¡roy
(
dŸ
);

654 
	}
}

657 
	$dŸg¿m_add_objeù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
)

659 
	`Ïy”_add_objeù
(
dŸ
->
d©a
->
aùive_Ïy”
, 
obj
);

661 
	`dŸg¿m_modif›d
(
dŸ
);

663 
	`dŸg¿m_Œ“_add_objeù
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
obj
);

664 
	}
}

667 
	$dŸg¿m_add_objeù_li¡
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
li¡
)

669 
	`Ïy”_add_objeùs
(
dŸ
->
d©a
->
aùive_Ïy”
, 
li¡
);

671 
	`dŸg¿m_modif›d
(
dŸ
);

673 
	`dŸg¿m_Œ“_add_objeùs
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
li¡
);

674 
	}
}

677 
	$dŸg¿m_£Ëùed_b»ak_ex‹º®
(
DŸg¿m
 *
dŸ
)

679 
GLi¡
 *
li¡
;

680 
GLi¡
 *
cÚÃùed_li¡
;

681 
DŸObjeù
 *
obj
;

682 
DŸObjeù
 *
Ùh”_obj
;

683 
i
,
j
;

685 
li¡
 = 
dŸ
->
d©a
->
£Ëùed
;

686 
li¡
 !ğ
NULL
) {

687 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

690 
i
=0;i<
obj
->
num_hªdËs
;i++) {

691 
CÚÃùiÚPošt
 *
cÚ_pošt
;

692 
cÚ_pošt
 = 
obj
->
hªdËs
[
i
]->
cÚÃùed_to
;

694 iàĞ
cÚ_pošt
 =ğ
NULL
 )

697 
Ùh”_obj
 = 
cÚ_pošt
->
objeù
;

698 ià(
	`g_li¡_fšd
(
dŸ
->
d©a
->
£Ëùed
, 
Ùh”_obj
è=ğ
NULL
) {

700 
Chªge
 *
chªge
 = 
	`undo_uncÚÃù
(
dŸ
, 
obj
, obj->
hªdËs
[
i
]);

701 (
chªge
->
­¶y
)(chªge, 
dŸ
);

702 
	`objeù_add_upd©es
(
obj
, 
dŸ
);

707 
i
=0;i<
obj
->
num_cÚÃùiÚs
;i++) {

708 
cÚÃùed_li¡
 = 
obj
->
cÚÃùiÚs
[
i
]->
cÚÃùed
;

710 
cÚÃùed_li¡
 !ğ
NULL
) {

711 
Ùh”_obj
 = (
DŸObjeù
 *)
cÚÃùed_li¡
->
d©a
;

713 ià(
	`g_li¡_fšd
(
dŸ
->
d©a
->
£Ëùed
, 
Ùh”_obj
è=ğ
NULL
) {

717 
j
=0;j<
Ùh”_obj
->
num_hªdËs
;j++) {

718 
CÚÃùiÚPošt
 *
cÚ_pošt
;

719 
cÚ_pošt
 = 
Ùh”_obj
->
hªdËs
[
j
]->
cÚÃùed_to
;

721 ià(
cÚ_pošt
 && (cÚ_pošt->
objeù
 =ğ
obj
)) {

722 
Chªge
 *
chªge
;

723 
cÚÃùed_li¡
 = 
	`g_li¡_´evious
(connected_list);

724 
chªge
 = 
	`undo_uncÚÃù
(
dŸ
, 
Ùh”_obj
,

725 
Ùh”_obj
->
hªdËs
[
j
]);

726 (
chªge
->
­¶y
)(chªge, 
dŸ
);

727 ià(
cÚÃùed_li¡
 =ğ
NULL
)

728 
cÚÃùed_li¡
 = 
obj
->
cÚÃùiÚs
[
i
]->
cÚÃùed
;

733 
cÚÃùed_li¡
 = 
	`g_li¡_Ãxt
(connected_list);

736 
	`dŸg¿m_Œ“_»move_objeù
(
	`dŸg¿m_Œ“
(), 
obj
);

737 
li¡
 = 
	`g_li¡_Ãxt
(list);

739 
	}
}

742 
	$dŸg¿m_»move_®l_£Ëùed
(
DŸg¿m
 *
dŸg¿m
, 
d–‘e_em±y
)

744 
	`objeù_add_upd©es_li¡
(
dŸg¿m
->
d©a
->
£Ëùed
, diagram);

745 
	`‹x‹d™_»move_focus_®l
(
dŸg¿m
);

746 
	`d©a_»move_®l_£Ëùed
(
dŸg¿m
->
d©a
);

747 
	`g_sigÇl_em™
 (
dŸg¿m
, 
dŸg¿m_sigÇls
[
SELECTION_CHANGED
], 0, 
	`g_li¡_Ëngth
 (dŸg¿m->
d©a
->
£Ëùed
));

748 
	}
}

751 
	$dŸg¿m_un£Ëù_objeù
(
DŸg¿m
 *
dŸg¿m
, 
DŸObjeù
 *
obj
)

753 
	`objeù_add_upd©es
(
obj
, 
dŸg¿m
);

754 
	`‹x‹d™_»move_focus
(
obj
, 
dŸg¿m
);

755 
	`d©a_un£Ëù
(
	`DIA_DIAGRAM_DATA
(
dŸg¿m
), 
obj
);

756 
	`g_sigÇl_em™
 (
dŸg¿m
, 
dŸg¿m_sigÇls
[
SELECTION_CHANGED
], 0,

757 
	`g_li¡_Ëngth
 (
	`DIA_DIAGRAM_DATA
(
dŸg¿m
)->
£Ëùed
));

758 
	}
}

761 
	$dŸg¿m_un£Ëù_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
)

763 
GLi¡
 *
li¡
;

764 
DŸObjeù
 *
obj
;

767 
	`g_sigÇl_hªdËrs_block_by_func
 (
dŸ
, 
_dŸg¿m_£ËùiÚ_chªged
, 
NULL
);

768 
li¡
 = 
obj_li¡
;

769 
li¡
 !ğ
NULL
) {

770 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

772 ià(
	`g_li¡_fšd
(
dŸ
->
d©a
->
£Ëùed
, 
obj
è!ğ
NULL
){

773 
	`dŸg¿m_un£Ëù_objeù
(
dŸ
, 
obj
);

776 
li¡
 = 
	`g_li¡_Ãxt
(list);

778 
	`g_sigÇl_hªdËrs_unblock_by_func
 (
dŸ
, 
_dŸg¿m_£ËùiÚ_chªged
, 
NULL
);

779 
	`g_sigÇl_em™
 (
dŸ
, 
dŸg¿m_sigÇls
[
SELECTION_CHANGED
], 0, 
	`g_li¡_Ëngth
 (dŸ->
d©a
->
£Ëùed
));

780 
	}
}

789 
	$dŸg¿m_£Ëù
(
DŸg¿m
 *
dŸg¿m
, 
DŸObjeù
 *
obj
)

791 ià(
	`dŸ_objeù_is_£ËùabË
(
obj
)) {

792 
	`d©a_£Ëù
(
dŸg¿m
->
d©a
, 
obj
);

793 
obj
->
İs
->
	`£Ëùf
(obj, 
NULL
, NULL);

794 
	`objeù_add_upd©es
(
obj
, 
dŸg¿m
);

795 
	`g_sigÇl_em™
 (
dŸg¿m
, 
dŸg¿m_sigÇls
[
SELECTION_CHANGED
], 0,

796 
	`g_li¡_Ëngth
 (
dŸg¿m
->
d©a
->
£Ëùed
));

798 
	}
}

801 
	$dŸg¿m_£Ëù_li¡
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
li¡
)

803 
	`g_»tuº_if_ç
 (
dŸ
 && 
li¡
);

805 
	`g_sigÇl_hªdËrs_block_by_func
 (
dŸ
, 
_dŸg¿m_£ËùiÚ_chªged
, 
NULL
);

806 
li¡
 !ğ
NULL
) {

807 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

809 
	`dŸg¿m_£Ëù
(
dŸ
, 
obj
);

811 
li¡
 = 
	`g_li¡_Ãxt
(list);

813 ià(
	`g‘_aùive_focus
((
DŸg¿mD©a
*è
dŸ
è=ğ
NULL
) {

814 
	`‹x‹d™_aùiv©e_fœ¡
(
	`ddi¥Ïy_aùive
());

816 
	`g_sigÇl_hªdËrs_unblock_by_func
 (
dŸ
, 
_dŸg¿m_£ËùiÚ_chªged
, 
NULL
);

817 
	`g_sigÇl_em™
 (
dŸ
, 
dŸg¿m_sigÇls
[
SELECTION_CHANGED
], 0, 
	`g_li¡_Ëngth
 (dŸ->
d©a
->
£Ëùed
));

818 
	}
}

821 
	$dŸg¿m_is_£Ëùed
(
DŸg¿m
 *
dŸg¿m
, 
DŸObjeù
 *
obj
)

823  
	`g_li¡_fšd
(
dŸg¿m
->
d©a
->
£Ëùed
, 
obj
è!ğ
NULL
;

824 
	}
}

827 
	$dŸg¿m_»d¿w_®l
()

829 
GLi¡
 *
li¡
;

830 
DŸg¿m
 *
dŸ
;

832 
li¡
 = 
İ’_dŸg¿ms
;

834 
li¡
 !ğ
NULL
) {

835 
dŸ
 = (
DŸg¿m
 *è
li¡
->
d©a
;

837 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

838 
	`dŸg¿m_æush
(
dŸ
);

840 
li¡
 = 
	`g_li¡_Ãxt
(list);

843 
	}
}

846 
	$dŸg¿m_add_upd©e_®l
(
DŸg¿m
 *
dŸ
)

848 
GSLi¡
 *
l
;

849 
DDi¥Ïy
 *
ddi¥
;

851 
l
 = 
dŸ
->
di¥Ïys
;

852 
l
!=
NULL
) {

853 
ddi¥
 = (
DDi¥Ïy
 *è
l
->
d©a
;

855 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

857 
l
 = 
	`g_¦i¡_Ãxt
(l);

859 
	}
}

862 
	$dŸg¿m_add_upd©e
(
DŸg¿m
 *
dŸ
, 
ReùªgË
 *
upd©e
)

864 
GSLi¡
 *
l
;

865 
DDi¥Ïy
 *
ddi¥
;

867 
l
 = 
dŸ
->
di¥Ïys
;

868 
l
!=
NULL
) {

869 
ddi¥
 = (
DDi¥Ïy
 *è
l
->
d©a
;

871 
	`ddi¥Ïy_add_upd©e
(
ddi¥
, 
upd©e
);

873 
l
 = 
	`g_¦i¡_Ãxt
(l);

875 
	}
}

883 
	$dŸg¿m_add_upd©e_w™h_bÜd”
(
DŸg¿m
 *
dŸ
, 
ReùªgË
 *
upd©e
,

884 
pix–_bÜd”
)

886 
GSLi¡
 *
l
;

887 
DDi¥Ïy
 *
ddi¥
;

889 
l
 = 
dŸ
->
di¥Ïys
;

890 
l
!=
NULL
) {

891 
ddi¥
 = (
DDi¥Ïy
 *è
l
->
d©a
;

893 
	`ddi¥Ïy_add_upd©e_w™h_bÜd”
(
ddi¥
, 
upd©e
, 
pix–_bÜd”
);

895 
l
 = 
	`g_¦i¡_Ãxt
(l);

897 
	}
}

900 
	$dŸg¿m_add_upd©e_pix–s
(
DŸg¿m
 *
dŸ
, 
Pošt
 *
pošt
,

901 
pix–_width
, 
pix–_height
)

903 
GSLi¡
 *
l
;

904 
DDi¥Ïy
 *
ddi¥
;

906 
l
 = 
dŸ
->
di¥Ïys
;

907 
l
!=
NULL
) {

908 
ddi¥
 = (
DDi¥Ïy
 *è
l
->
d©a
;

910 
	`ddi¥Ïy_add_upd©e_pix–s
(
ddi¥
, 
pošt
, 
pix–_width
, 
pix–_height
);

912 
l
 = 
	`g_¦i¡_Ãxt
(l);

914 
	}
}

917 
	$dŸg¿m_æush
(
DŸg¿m
 *
dŸ
)

919 
GSLi¡
 *
l
;

920 
DDi¥Ïy
 *
ddi¥
;

921 
l
 = 
dŸ
->
di¥Ïys
;

922 
l
!=
NULL
) {

923 
ddi¥
 = (
DDi¥Ïy
 *è
l
->
d©a
;

925 
	`ddi¥Ïy_æush
(
ddi¥
);

927 
l
 = 
	`g_¦i¡_Ãxt
(l);

929 
	`dynobj_»äesh_kick
();

930 
	}
}

932 
DŸObjeù
 *

933 
	$dŸg¿m_fšd_şicked_objeù
(
DŸg¿m
 *
dŸ
, 
Pošt
 *
pos
,

934 
»®
 
maxdi¡
)

936  
	`Ïy”_fšd_şo£¡_objeù_exû±
(
dŸ
->
d©a
->
aùive_Ïy”
,

937 
pos
, 
maxdi¡
, 
NULL
);

938 
	}
}

940 
DŸObjeù
 *

941 
	$dŸg¿m_fšd_şicked_objeù_exû±
(
DŸg¿m
 *
dŸ
, 
Pošt
 *
pos
,

942 
»®
 
maxdi¡
, 
GLi¡
 *
avoid
)

944  
	`Ïy”_fšd_şo£¡_objeù_exû±
(
dŸ
->
d©a
->
aùive_Ïy”
, 
pos
,

945 
maxdi¡
, 
avoid
);

946 
	}
}

952 
»®


953 
	$dŸg¿m_fšd_şo£¡_hªdË
(
DŸg¿m
 *
dŸ
, 
HªdË
 **
şo£¡
,

954 
DŸObjeù
 **
objeù
, 
Pošt
 *
pos
)

956 
GLi¡
 *
l
;

957 
DŸObjeù
 *
obj
;

958 
HªdË
 *
hªdË
;

959 
»®
 
mšdi¡
, 
di¡
;

960 
i
;

962 
mšdi¡
 = 1000000.0;

964 *
şo£¡
 = 
NULL
;

966 
l
 = 
dŸ
->
d©a
->
£Ëùed
;

967 
l
!=
NULL
) {

968 
obj
 = (
DŸObjeù
 *è
l
->
d©a
;

970 
i
=0;i<
obj
->
num_hªdËs
;i++) {

971 
hªdË
 = 
obj
->
hªdËs
[
i
];

973 
di¡
 = 
	`di¡ªû_pošt_pošt_mªh©n
(
pos
, &
hªdË
->pos);

974 ià(
di¡
<=
mšdi¡
) {

975 
mšdi¡
 = 
di¡
;

976 *
şo£¡
 = 
hªdË
;

977 *
objeù
 = 
obj
;

981 
l
 = 
	`g_li¡_Ãxt
(l);

984  
mšdi¡
;

985 
	}
}

987 
»®


988 
	$dŸg¿m_fšd_şo£¡_cÚÃùiÚpošt
(
DŸg¿m
 *
dŸ
,

989 
CÚÃùiÚPošt
 **
şo£¡
,

990 
Pošt
 *
pos
,

991 
DŸObjeù
 *
nÙthis
)

993 
»®
 
di¡
 = 100000000.0;

994 
gušt
 
i
;

995 
i
=0;i<
dŸ
->
d©a
->
Ïy”s
->
Ën
;i++) {

996 
Lay”
 *
Ïy”
 = (Lay”*)
	`g_±r_¬¿y_šdex
(
dŸ
->
d©a
->
Ïy”s
, 
i
);

997 
CÚÃùiÚPošt
 *
this_ı
;

998 
»®
 
this_di¡
;

999 ià(
Ïy”
->
cÚÃùabË
) {

1000 
this_di¡
 = 
	`Ïy”_fšd_şo£¡_cÚÃùiÚpošt
(
Ïy”
,

1001 &
this_ı
, 
pos
, 
nÙthis
);

1002 ià(
this_di¡
 < 
di¡
) {

1003 
di¡
 = 
this_di¡
;

1004 *
şo£¡
 = 
this_ı
;

1008  
di¡
;

1009 
	}
}

1012 
	$dŸg¿m_upd©e_ex‹Ás
(
DŸg¿m
 *
dŸ
)

1014 
gæßt
 
cur_sÿË
 = 
dŸ
->
d©a
->
·³r
.
sÿlšg
;

1017 ià(
	`d©a_upd©e_ex‹Ás
(
dŸ
->
d©a
)) {

1019 
GSLi¡
 *
l
;

1020 
DDi¥Ïy
 *
ddi¥
;

1022 
l
 = 
dŸ
->
di¥Ïys
;

1023 
l
!=
NULL
) {

1024 
ddi¥
 = (
DDi¥Ïy
 *è
l
->
d©a
;

1026 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

1028 
l
 = 
	`g_¦i¡_Ãxt
(l);

1030 ià(
cur_sÿË
 !ğ
dŸ
->
d©a
->
·³r
.
sÿlšg
) {

1031 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

1032 
	`dŸg¿m_æush
(
dŸ
);

1035 
	}
}

1039 
	$¡r_cÚÃùiÚs
(
DŸObjeù
 *
obj
, 
GLi¡
 *
nÙ_¡r_li¡
, 
DŸg¿m
 *
dŸ
)

1041 
i
;

1042 
HªdË
 *
hªdË
;

1043 
Chªge
 *
chªge
;

1045 
i
=0;i<
obj
->
num_hªdËs
;i++) {

1046 
hªdË
 = 
obj
->
hªdËs
[
i
];

1047 ià((
hªdË
->
cÚÃùed_to
 !ğ
NULL
) &&

1048 (
	`g_li¡_fšd
(
nÙ_¡r_li¡
, 
hªdË
->
cÚÃùed_to
->
objeù
)==
NULL
)) {

1049 
chªge
 = 
	`undo_uncÚÃù
(
dŸ
, 
obj
, 
hªdË
);

1050 (
chªge
->
­¶y
)(chªge, 
dŸ
);

1053 
	}
}

1057 
gšt


1058 
	$dŸg¿m_·»Á_sÜt_cb
(
gcÚ¡poš‹r
 
_a
, gcÚ¡poš‹¸
_b
)

1060 
ObjeùEx‹Á
 **
a
 = (ObjeùEx‹Á **)
_a
;

1061 
ObjeùEx‹Á
 **
b
 = (ObjeùEx‹Á **)
_b
;

1063 ià((*
a
)->
ex‹Á
.
Ëá
 < (*
b
)->extent.left)

1065 ià((*
a
)->
ex‹Á
.
Ëá
 > (*
b
)->extent.left)

1068 ià((*
a
)->
ex‹Á
.
tİ
 < (*
b
)->extent.top)

1070 ià((*
a
)->
ex‹Á
.
tİ
 > (*
b
)->extent.top)

1074 
	}
}

1079 
	$dŸg¿m_·»Á_£Ëùed
(
DŸg¿m
 *
dŸ
)

1081 
GLi¡
 *
li¡
 = 
dŸ
->
d©a
->
£Ëùed
;

1082 
Ëngth
 = 
	`g_li¡_Ëngth
(
li¡
);

1083 
idx
, 
idx2
;

1084 
ObjeùEx‹Á
 *
Û
;

1085 
gboŞ—n
 
ªy_·»Áed
 = 
FALSE
;

1086 
GPŒA¼ay
 *
ex‹Ás
 = 
	`g_±r_¬¿y_sized_Ãw
(
Ëngth
);

1087 
li¡
)

1089 
Û
 = 
	`g_Ãw
(
ObjeùEx‹Á
, 1);

1090 
Û
->
objeù
 = 
li¡
->
d©a
;

1091 
	`·»Á_hªdË_ex‹Ás
(
li¡
->
d©a
, &
Û
->
ex‹Á
);

1092 
	`g_±r_¬¿y_add
(
ex‹Ás
, 
Û
);

1093 
li¡
 = 
	`g_li¡_Ãxt
(list);

1096 
	`g_±r_¬¿y_sÜt
(
ex‹Ás
, 
dŸg¿m_·»Á_sÜt_cb
);

1098 
idx
 = 0; idx < 
Ëngth
; idx++)

1100 
ObjeùEx‹Á
 *
Û1
 = 
	`g_±r_¬¿y_šdex
(
ex‹Ás
, 
idx
);

1101 ià(
Û1
->
objeù
->
·»Á
)

1104 
idx2
 = 
idx
 + 1; idx2 < 
Ëngth
; idx2++)

1106 
ObjeùEx‹Á
 *
Û2
 = 
	`g_±r_¬¿y_šdex
(
ex‹Ás
, 
idx2
);

1107 ià(!
	`objeù_æags_£t
(
Û2
->
objeù
, 
DIA_OBJECT_CAN_PARENT
))

1110 ià(
Û1
->
ex‹Á
.
right
 <ğ
Û2
->extent.right

1111 && 
Û1
->
ex‹Á
.
bÙtom
 <ğ
Û2
->extent.bottom)

1113 
Chªge
 *
chªge
;

1114 
chªge
 = 
	`undo_·»Ášg
(
dŸ
, 
Û2
->
objeù
, 
Û1
->objeù, 
TRUE
);

1115 (
chªge
->
­¶y
)(chªge, 
dŸ
);

1116 
ªy_·»Áed
 = 
TRUE
;

1125 
	`g_±r_¬¿y_ä“
(
ex‹Ás
, 
TRUE
);

1126 ià(
ªy_·»Áed
) {

1127 
	`dŸg¿m_modif›d
(
dŸ
);

1128 
	`dŸg¿m_æush
(
dŸ
);

1129 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1131 
	}
}

1134 
	$dŸg¿m_uÅ¬’t_£Ëùed
(
DŸg¿m
 *
dŸ
)

1136 
GLi¡
 *
li¡
;

1137 
DŸObjeù
 *
obj
, *
·»Á
;

1138 
Chªge
 *
chªge
;

1139 
gboŞ—n
 
ªy_uÅ¬’‹d
 = 
FALSE
;

1141 
li¡
 = 
dŸ
->
d©a
->
£Ëùed
;†i¡ !ğ
NULL
;†i¡ = 
	`g_li¡_Ãxt
(list))

1143 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

1144 
·»Á
 = 
obj
->parent;

1146 ià(!
·»Á
)

1149 
chªge
 = 
	`undo_·»Ášg
(
dŸ
, 
·»Á
, 
obj
, 
FALSE
);

1150 (
chªge
->
­¶y
)(chªge, 
dŸ
);

1151 
ªy_uÅ¬’‹d
 = 
TRUE
;

1157 ià(
ªy_uÅ¬’‹d
) {

1158 
	`dŸg¿m_modif›d
(
dŸ
);

1159 
	`dŸg¿m_æush
(
dŸ
);

1160 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1162 
	}
}

1165 
	$dŸg¿m_uÅ¬’t_chd»n_£Ëùed
(
DŸg¿m
 *
dŸ
)

1167 
GLi¡
 *
li¡
;

1168 
DŸObjeù
 *
obj
, *
chd
;

1169 
gboŞ—n
 
ªy_uÅ¬’‹d
 = 
FALSE
;

1170 
li¡
 = 
dŸ
->
d©a
->
£Ëùed
;†i¡ !ğ
NULL
;†i¡ = 
	`g_li¡_Ãxt
(list))

1172 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

1173 ià(!
	`objeù_æags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
è|| !obj->
chd»n
)

1176 
ªy_uÅ¬’‹d
 = 
TRUE
;

1181 
obj
->
chd»n
 !ğ
NULL
) {

1182 
Chªge
 *
chªge
;

1183 
chd
 = (
DŸObjeù
 *è
obj
->
chd»n
->
d©a
;

1184 
chªge
 = 
	`undo_·»Ášg
(
dŸ
, 
obj
, 
chd
, 
FALSE
);

1186 (
chªge
->
­¶y
)(chªge, 
dŸ
);

1188 ià(
obj
->
chd»n
 !ğ
NULL
)

1189 
	`´štf
("Obj still has %d children\n",

1190 
	`g_li¡_Ëngth
(
obj
->
chd»n
));

1192 ià(
ªy_uÅ¬’‹d
) {

1193 
	`dŸg¿m_modif›d
(
dŸ
);

1194 
	`dŸg¿m_æush
(
dŸ
);

1195 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1197 
	}
}

1199 
	$dŸg¿m_group_£Ëùed
(
DŸg¿m
 *
dŸ
)

1201 
GLi¡
 *
li¡
;

1202 
GLi¡
 *
group_li¡
;

1203 
DŸObjeù
 *
group
;

1204 
DŸObjeù
 *
obj
;

1205 
GLi¡
 *
Üig_li¡
;

1206 
Chªge
 *
chªge
;

1208 ià(
	`g_li¡_Ëngth
(
dŸ
->
d©a
->
£Ëùed
) < 1) {

1209 
	`mes§ge_”rÜ
(
	`_
("Tryingo group with‚o selected objects."));

1213 #ifdeà
USE_NEWGROUP


1214 
li¡
 = 
dŸ
->
d©a
->
£Ëùed
;

1215 
cu¼’t_·»Á
 = ((
DŸObjeù
 *è
li¡
->
d©a
)->
·»Á
;

1216 
li¡
 !ğ
NULL
) {

1217 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

1218 ià(
obj
->
·»Á
 !ğ
cu¼’t_·»Á
) {

1219 
	`mes§ge_w¬nšg
(
	`_
("You cannot group objectshat belongo different groups or have different…arents"));

1224 
group
 = ...

1226 
li¡
 = 
dŸ
->
d©a
->
£Ëùed
;

1227 
li¡
 !ğ
NULL
) {

1228 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

1236 
dŸ
->
d©a
->
£Ëùed
 = 
	`·»Á_li¡_afãùed
(dia->data->selected);

1239 
Üig_li¡
 = 
	`g_li¡_cİy
(
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
);

1243 
group_li¡
 = 
	`dŸg¿m_g‘_sÜ‹d_£Ëùed_»move
(
dŸ
);

1245 
li¡
 = 
group_li¡
;

1246 
li¡
 !ğ
NULL
) {

1247 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

1252 
	`¡r_cÚÃùiÚs
(
obj
, 
dŸ
->
d©a
->
£Ëùed
, dia);

1254 
li¡
 = 
	`g_li¡_Ãxt
(list);

1258 
	`‹x‹d™_»move_focus_®l
(
dŸ
);

1259 
	`d©a_»move_®l_£Ëùed
(
dŸ
->
d©a
);

1261 
group
 = 
	`group_ü—‹
(
group_li¡
);

1262 
chªge
 = 
	`undo_group_objeùs
(
dŸ
, 
group_li¡
, 
group
, 
Üig_li¡
);

1263 (
chªge
->
­¶y
)(chªge, 
dŸ
);

1267 
	`dŸg¿m_£Ëù
(
dŸ
, 
group
);

1269 
	`dŸg¿m_modif›d
(
dŸ
);

1270 
	`dŸg¿m_æush
(
dŸ
);

1272 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1273 
	}
}

1275 
	$dŸg¿m_ungroup_£Ëùed
(
DŸg¿m
 *
dŸ
)

1277 
DŸObjeù
 *
group
;

1278 
GLi¡
 *
group_li¡
;

1279 
GLi¡
 *
£Ëùed
, *
£ËùiÚ_cİy
;

1280 
group_šdex
;

1281 
ªy_groups
 = 0;

1283 ià(
	`g_li¡_Ëngth
(
dŸ
->
d©a
->
£Ëùed
) < 1) {

1284 
	`mes§ge_”rÜ
("Tryingo ungroup with‚o selected objects.");

1288 
£ËùiÚ_cİy
 = 
	`g_li¡_cİy
(
dŸ
->
d©a
->
£Ëùed
);

1289 
£Ëùed
 = 
£ËùiÚ_cİy
;

1290 
£Ëùed
 !ğ
NULL
) {

1291 
group
 = (
DŸObjeù
 *)
£Ëùed
->
d©a
;

1293 ià(
	`IS_GROUP
(
group
)) {

1294 
Chªge
 *
chªge
;

1297 
	`dŸg¿m_un£Ëù_objeù
(
dŸ
, 
group
);

1299 
group_li¡
 = 
	`group_objeùs
(
group
);

1300 
	`dŸg¿m_£Ëù_li¡
(
dŸ
, 
group_li¡
);

1302 
group_šdex
 = 
	`Ïy”_objeù_šdex
(
dŸ
->
d©a
->
aùive_Ïy”
, 
group
);

1304 
chªge
 = 
	`undo_ungroup_objeùs
(
dŸ
, 
group_li¡
, 
group
, 
group_šdex
);

1305 (
chªge
->
­¶y
)(chªge, 
dŸ
);

1307 
ªy_groups
 = 1;

1309 
£Ëùed
 = 
	`g_li¡_Ãxt
(selected);

1311 
	`g_li¡_ä“
(
£ËùiÚ_cİy
);

1313 ià(
ªy_groups
) {

1314 
	`dŸg¿m_modif›d
(
dŸ
);

1315 
	`dŸg¿m_æush
(
dŸ
);

1316 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1318 
	}
}

1320 
GLi¡
 *

1321 
	$dŸg¿m_g‘_sÜ‹d_£Ëùed
(
DŸg¿m
 *
dŸ
)

1323  
	`d©a_g‘_sÜ‹d_£Ëùed
(
dŸ
->
d©a
);

1324 
	}
}

1329 
GLi¡
 *

1330 
	$dŸg¿m_g‘_sÜ‹d_£Ëùed_»move
(
DŸg¿m
 *
dŸ
)

1332 
	`dŸg¿m_modif›d
(
dŸ
);

1334  
	`d©a_g‘_sÜ‹d_£Ëùed_»move
(
dŸ
->
d©a
);

1335 
	}
}

1338 
	$dŸg¿m_¶aû_und”_£Ëùed
(
DŸg¿m
 *
dŸ
)

1340 
GLi¡
 *
sÜ‹d_li¡
;

1341 
GLi¡
 *
Üig_li¡
;

1343 ià(
	`g_li¡_Ëngth
 (
dŸ
->
d©a
->
£Ëùed
) == 0)

1346 
Üig_li¡
 = 
	`g_li¡_cİy
(
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
);

1348 
sÜ‹d_li¡
 = 
	`dŸg¿m_g‘_sÜ‹d_£Ëùed_»move
(
dŸ
);

1349 
	`objeù_add_upd©es_li¡
(
sÜ‹d_li¡
, 
dŸ
);

1350 
	`Ïy”_add_objeùs_fœ¡
(
dŸ
->
d©a
->
aùive_Ïy”
, 
sÜ‹d_li¡
);

1352 
	`undo_»Üd”_objeùs
(
dŸ
, 
	`g_li¡_cİy
(
sÜ‹d_li¡
), 
Üig_li¡
);

1354 
	`dŸg¿m_modif›d
(
dŸ
);

1355 
	`dŸg¿m_æush
(
dŸ
);

1356 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1357 
	}
}

1360 
	$dŸg¿m_¶aû_ov”_£Ëùed
(
DŸg¿m
 *
dŸ
)

1362 
GLi¡
 *
sÜ‹d_li¡
;

1363 
GLi¡
 *
Üig_li¡
;

1365 ià(
	`g_li¡_Ëngth
 (
dŸ
->
d©a
->
£Ëùed
) == 0)

1368 
Üig_li¡
 = 
	`g_li¡_cİy
(
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
);

1370 
sÜ‹d_li¡
 = 
	`dŸg¿m_g‘_sÜ‹d_£Ëùed_»move
(
dŸ
);

1371 
	`objeù_add_upd©es_li¡
(
sÜ‹d_li¡
, 
dŸ
);

1372 
	`Ïy”_add_objeùs
(
dŸ
->
d©a
->
aùive_Ïy”
, 
sÜ‹d_li¡
);

1374 
	`undo_»Üd”_objeùs
(
dŸ
, 
	`g_li¡_cİy
(
sÜ‹d_li¡
), 
Üig_li¡
);

1376 
	`dŸg¿m_modif›d
(
dŸ
);

1377 
	`dŸg¿m_æush
(
dŸ
);

1378 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1379 
	}
}

1382 
	$dŸg¿m_¶aû_up_£Ëùed
(
DŸg¿m
 *
dŸ
)

1384 
GLi¡
 *
sÜ‹d_li¡
;

1385 
GLi¡
 *
Üig_li¡
;

1386 
GLi¡
 *
tmp
, *
¡mp
;

1387 
GLi¡
 *
Ãw_li¡
 = 
NULL
;

1389 ià(
	`g_li¡_Ëngth
 (
dŸ
->
d©a
->
£Ëùed
) == 0)

1392 
Üig_li¡
 = 
	`g_li¡_cİy
(
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
);

1394 
sÜ‹d_li¡
 = 
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
dŸ
);

1395 
	`objeù_add_upd©es_li¡
(
Üig_li¡
, 
dŸ
);

1397 
Ãw_li¡
 = 
	`g_li¡_cİy
(
Üig_li¡
);

1398 
¡mp
 = 
	`g_li¡_Ï¡
(
sÜ‹d_li¡
);

1400 
tmp
 = 
	`g_li¡_Ï¡
(
Ãw_li¡
);

1401 
tmp
 !ğ
NULL
;

1402 
tmp
 = 
	`g_li¡_´evious
(tmp)) {

1403 ià(
¡mp
 =ğ
NULL
) ;

1404 ià(
tmp
->
´ev
 =ğ
NULL
) ;

1405 ià(
tmp
->
d©a
 =ğ
¡mp
->data) {

1406 
¡mp
 = 
	`g_li¡_´evious
(stmp);

1407 } ià(
tmp
->
´ev
->
d©a
 =ğ
¡mp
->data) {

1408 *
sw­
 = 
tmp
->
d©a
;

1409 
tmp
->
d©a
 =mp->
´ev
->data;

1410 
tmp
->
´ev
->
d©a
 = 
sw­
;

1411 
¡mp
 = 
	`g_li¡_´evious
(stmp);

1415 
	`Ïy”_£t_objeù_li¡
(
dŸ
->
d©a
->
aùive_Ïy”
, 
Ãw_li¡
);

1417 
	`undo_»Üd”_objeùs
(
dŸ
, 
	`g_li¡_cİy
(
sÜ‹d_li¡
), 
Üig_li¡
);

1419 
	`dŸg¿m_modif›d
(
dŸ
);

1420 
	`dŸg¿m_æush
(
dŸ
);

1421 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1422 
	}
}

1425 
	$dŸg¿m_¶aû_down_£Ëùed
(
DŸg¿m
 *
dŸ
)

1427 
GLi¡
 *
sÜ‹d_li¡
;

1428 
GLi¡
 *
Üig_li¡
;

1429 
GLi¡
 *
tmp
, *
¡mp
;

1430 
GLi¡
 *
Ãw_li¡
 = 
NULL
;

1432 ià(
	`g_li¡_Ëngth
 (
dŸ
->
d©a
->
£Ëùed
) == 0)

1435 
Üig_li¡
 = 
	`g_li¡_cİy
(
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
);

1437 
sÜ‹d_li¡
 = 
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
dŸ
);

1438 
	`objeù_add_upd©es_li¡
(
Üig_li¡
, 
dŸ
);

1441 
	`g_as£¹
(
	`g_li¡_Ëngth
 (
dŸ
->
d©a
->
£Ëùed
è=ğg_li¡_Ëngth(
sÜ‹d_li¡
));

1443 
Ãw_li¡
 = 
	`g_li¡_cİy
(
Üig_li¡
);

1444 
tmp
 = 
Ãw_li¡
;

1445 
¡mp
 = 
sÜ‹d_li¡
;

1447 
tmp
 = 
Ãw_li¡
;m°!ğ
NULL
;m°ğ
	`g_li¡_Ãxt
(tmp)) {

1448 ià(
¡mp
 =ğ
NULL
) ;

1449 ià(
tmp
->
Ãxt
 =ğ
NULL
) ;

1450 ià(
tmp
->
d©a
 =ğ
¡mp
->data) {

1452 
¡mp
 = 
	`g_li¡_Ãxt
(stmp);

1453 } ià(
tmp
->
Ãxt
->
d©a
 =ğ
¡mp
->data) {

1455 *
sw­
 = 
tmp
->
d©a
;

1456 
tmp
->
d©a
 =mp->
Ãxt
->data;

1457 
tmp
->
Ãxt
->
d©a
 = 
sw­
;

1458 
¡mp
 = 
	`g_li¡_Ãxt
(stmp);

1462 
	`Ïy”_£t_objeù_li¡
(
dŸ
->
d©a
->
aùive_Ïy”
, 
Ãw_li¡
);

1464 
	`undo_»Üd”_objeùs
(
dŸ
, 
	`g_li¡_cİy
(
sÜ‹d_li¡
), 
Üig_li¡
);

1466 
	`dŸg¿m_modif›d
(
dŸ
);

1467 
	`dŸg¿m_æush
(
dŸ
);

1468 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1469 
	}
}

1472 
	$dŸg¿m_£t_f’ame
(
DŸg¿m
 *
dŸ
, cÚ¡ *
f’ame
)

1474 
	`g_ä“
(
dŸ
->
f’ame
);

1475 
dŸ
->
f’ame
 = 
	`g_f’ame_to_utf8
(f’ame, -1, 
NULL
, NULL, NULL);

1477 
	`dŸg¿m_upd©e_fÜ_f’ame
(
dŸ
);

1478 
	}
}

1486 
	$dŸg¿m_upd©e_fÜ_f’ame
(
DŸg¿m
 *
dŸ
)

1488 
GSLi¡
 *
l
;

1489 
DDi¥Ïy
 *
ddi¥
;

1490 *
t™Ë
;

1492 
t™Ë
 = 
	`dŸg¿m_g‘_Çme
(
dŸ
);

1494 
l
 = 
dŸ
->
di¥Ïys
;

1495 
l
!=
NULL
) {

1496 
ddi¥
 = (
DDi¥Ïy
 *è
l
->
d©a
;

1498 
	`ddi¥Ïy_£t_t™Ë
(
ddi¥
, 
t™Ë
);

1500 
l
 = 
	`g_¦i¡_Ãxt
(l);

1503 
	`g_ä“
(
t™Ë
);

1505 
	`Ïy”_dŸlog_upd©e_dŸg¿m_li¡
();

1507 
	`dŸg¿m_Œ“_upd©e_Çme
(
	`dŸg¿m_Œ“
(), 
dŸ
);

1508 
	}
}

1514 
gch¬
 *

1515 
	$dŸg¿m_g‘_Çme
(
DŸg¿m
 *
dŸ
)

1517  
	`g_·th_g‘_ba£Çme
(
dŸ
->
f’ame
);

1518 
	}
}

1520 
	$dŸg¿m_modif›d_exi¡s
()

1522 
GLi¡
 *
li¡
;

1523 
DŸg¿m
 *
dŸ
;

1525 
li¡
 = 
İ’_dŸg¿ms
;

1527 
li¡
 !ğ
NULL
) {

1528 
dŸ
 = (
DŸg¿m
 *è
li¡
->
d©a
;

1530 ià(
	`dŸg¿m_is_modif›d
(
dŸ
))

1531  
TRUE
;

1533 
li¡
 = 
	`g_li¡_Ãxt
(list);

1535  
FALSE
;

1536 
	}
}

1538 
	$dŸg¿m_objeù_modif›d
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
objeù
)

1540 
	`dŸg¿m_Œ“_upd©e_objeù
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
objeù
);

1541 
	}
}

	@O:\tool\dvs50\app\diagram.h

18 #iâdeà
DIAGRAM_H


19 
	#DIAGRAM_H


	)

21 
	~<gtk/gtk.h
>

23 
_DŸg¿m
 
	tDŸg¿m
;

25 
	~"geom‘ry.h
"

26 
	~"hªdË.h
"

27 
	~"cÚÃùiÚpošt.h
"

28 
	~"di¥Ïy.h
"

29 
	~"dŸg¿md©a.h
"

30 
	~"undo.h
"

31 
	~"f‹r.h
"

32 
	~"m’us.h
"

33 
	~"dŸgrid.h
"

35 
GTy³
 
	$dŸg¿m_g‘_ty³
 (è
G_GNUC_CONST
;

37 
	#DIA_TYPE_DIAGRAM
 (
	`dŸg¿m_g‘_ty³
 ())

	)

38 
	#DIA_DIAGRAM
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_DIAGRAM
, 
DŸg¿m
))

	)

39 
	#DIA_DIAGRAM_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_DIAGRAM
, 
DŸg¿mCÏss
))

	)

40 
	#DIA_IS_DIAGRAM
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_DIAGRAM
))

	)

41 
	#DIA_DIAGRAM_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_DIAGRAM
, 
DŸg¿mCÏss
))

	)

43 
	s_DŸg¿m
 {

44 
DŸg¿mD©a
 
·»Á_š¡ªû
;

46 *
f’ame
;

47 
un§ved
;

48 
gboŞ—n
 
is_deçuÉ
;

49 
mŞlif›d
;

50 
gboŞ—n
 
auto§ved
;

51 *
auto§vef’ame
;

54 
CŞÜ
 
·geb»ak_cŞÜ
;

55 
DŸGrid
 
grid
;

60 
»®
 *
hguides
, *
vguides
;

61 
gušt
 
nhguides
, 
nvguides
;

62 } 
guides
;

64 
DŸg¿mD©a
 *
d©a
;

66 
GSLi¡
 *
di¥Ïys
;

68 
UndoSck
 *
undo
;

71 
	s_DŸg¿mCÏss
 {

72 
DŸg¿mD©aCÏss
 
·»Á_şass
;

75 (* 
»moved
è(
DŸg¿m
*);

76 (* 
£ËùiÚ_chªged
è(
DŸg¿m
*, );

78 } 
	tDŸg¿mCÏss
;

80 
GLi¡
 *
	`dŸ_İ’_dŸg¿ms
();

82 
DŸg¿m
 *
	`dŸg¿m_lßd
(cÚ¡ *
f’ame
, 
DŸImpÜtF‹r
 *
if‹r
);

83 
	`dŸg¿m_lßd_što
 (
DŸg¿m
 *
de¡
, cÚ¡ *
f’ame
, 
DŸImpÜtF‹r
 *
if‹r
);

84 
DŸg¿m
 *
	`Ãw_dŸg¿m
(cÚ¡ *
f’ame
);

86 
	`dŸg¿m_£t_cu¼’t
(
DŸg¿m
 *
dŸg¿m
);

87 
	`dŸg¿m_de¡roy
(
DŸg¿m
 *
dŸ
);

88 
gboŞ—n
 
	`dŸg¿m_is_modif›d
(
DŸg¿m
 *
dŸ
);

89 
DIAVAR
 
	`dŸg¿m_modif›d
(
DŸg¿m
 *
dŸ
);

90 
	`dŸg¿m_£t_modif›d
(
DŸg¿m
 *
dŸ
, 
modif›d
);

91 
	`dŸg¿m_add_ddi¥Ïy
(
DŸg¿m
 *
dŸ
, 
DDi¥Ïy
 *
ddi¥
);

92 
	`dŸg¿m_»move_ddi¥Ïy
(
DŸg¿m
 *
dŸ
, 
DDi¥Ïy
 *
ddi¥
);

93 
	`dŸg¿m_add_objeù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
);

94 
	`dŸg¿m_add_objeù_li¡
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
li¡
);

95 
DIAVAR
 
	`dŸg¿m_£Ëùed_b»ak_ex‹º®
(
DŸg¿m
 *
dŸ
);

96 
DIAVAR
 
	`dŸg¿m_»move_®l_£Ëùed
(
DŸg¿m
 *
dŸg¿m
, 
d–‘e_em±y
);

97 
	`dŸg¿m_un£Ëù_objeù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
);

98 
DIAVAR
 
	`dŸg¿m_un£Ëù_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
);

99 
DIAVAR
 
	`dŸg¿m_£Ëù
(
DŸg¿m
 *
dŸg¿m
, 
DŸObjeù
 *
obj
);

100 
	`dŸg¿m_£Ëù_li¡
(
DŸg¿m
 *
dŸg¿m
, 
GLi¡
 *
li¡
);

101 
	`dŸg¿m_is_£Ëùed
(
DŸg¿m
 *
dŸg¿m
, 
DŸObjeù
 *
obj
);

102 
GLi¡
 *
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
DŸg¿m
 *
dŸ
);

104 
GLi¡
 *
	`dŸg¿m_g‘_sÜ‹d_£Ëùed_»move
(
DŸg¿m
 *
dŸ
);

105 
	`dŸg¿m_add_upd©e
(
DŸg¿m
 *
dŸ
, 
ReùªgË
 *
upd©e
);

106 
	`dŸg¿m_add_upd©e_w™h_bÜd”
(
DŸg¿m
 *
dŸ
, 
ReùªgË
 *
upd©e
,

107 
pix–_bÜd”
);

108 
DIAVAR
 
	`dŸg¿m_add_upd©e_®l
(
DŸg¿m
 *
dŸ
);

109 
	`dŸg¿m_add_upd©e_®l_®l_ªd_æush
();

110 
	`dŸg¿m_add_upd©e_pix–s
(
DŸg¿m
 *
dŸ
, 
Pošt
 *
pošt
,

111 
pix–_width
, 
pix–_height
);

112 
DIAVAR
 
	`dŸg¿m_æush
(
DŸg¿m
 *
dŸ
);

113 
DŸObjeù
 *
	`dŸg¿m_fšd_şicked_objeù
(
DŸg¿m
 *
dŸ
,

114 
Pošt
 *
pos
,

115 
»®
 
maxdi¡
);

116 
DŸObjeù
 *
	`dŸg¿m_fšd_şicked_objeù_exû±
(
DŸg¿m
 *
dŸ
,

117 
Pošt
 *
pos
,

118 
»®
 
maxdi¡
,

119 
GLi¡
 *
avoid
);

120 
»®
 
	`dŸg¿m_fšd_şo£¡_hªdË
(
DŸg¿m
 *
dŸ
, 
HªdË
 **
hªdË
,

121 
DŸObjeù
 **
obj
, 
Pošt
 *
pos
);

122 
»®
 
	`dŸg¿m_fšd_şo£¡_cÚÃùiÚpošt
(
DŸg¿m
 *
dŸ
,

123 
CÚÃùiÚPošt
 **
ı
,

124 
Pošt
 *
pos
,

125 
DŸObjeù
 *
nÙthis
);

126 
DIAVAR
 
	`dŸg¿m_upd©e_ex‹Ás
(
DŸg¿m
 *
dŸ
);

128 
	`dŸg¿m_upd©e_m’u_£ns™iv™y
 (
DŸg¿m
 *
dŸ
);

130 
	`dŸg¿m_¶aû_und”_£Ëùed
(
DŸg¿m
 *
dŸ
);

131 
	`dŸg¿m_¶aû_ov”_£Ëùed
(
DŸg¿m
 *
dŸ
);

132 
	`dŸg¿m_¶aû_down_£Ëùed
(
DŸg¿m
 *
dŸ
);

133 
	`dŸg¿m_¶aû_up_£Ëùed
(
DŸg¿m
 *
dŸ
);

134 
	`dŸg¿m_group_£Ëùed
(
DŸg¿m
 *
dŸ
);

135 
	`dŸg¿m_ungroup_£Ëùed
(
DŸg¿m
 *
dŸ
);

136 
	`dŸg¿m_·»Á_£Ëùed
(
DŸg¿m
 *
dŸ
);

137 
	`dŸg¿m_uÅ¬’t_£Ëùed
(
DŸg¿m
 *
dŸ
);

138 
	`dŸg¿m_uÅ¬’t_chd»n_£Ëùed
(
DŸg¿m
 *
dŸ
);

140 
gboŞ—n
 
	`objeù_w™hš_·»Á
(
DŸObjeù
 *
obj
, DŸObjeù *
·»Á
);

141 
	`dŸg¿m_£t_f’ame
(
DŸg¿m
 *
dŸ
, cÚ¡ *
f’ame
);

142 
gch¬
 *
	`dŸg¿m_g‘_Çme
(
DŸg¿m
 *
dŸ
);

144 
	`dŸg¿m_modif›d_exi¡s
();

146 
	`dŸg¿m_»d¿w_®l
();

148 
	`dŸg¿m_objeù_modif›d
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
objeù
);

	@O:\tool\dvs50\app\diagram_tree.c

26 
	~<¡ršg.h
>

28 #undeà
GTK_DISABLE_DEPRECATED


30 
	~"´İ”t›s-dŸlog.h
"

31 
	~"dŸg¿m_Œ“_m’u.h
"

32 
	~"dŸg¿m_Œ“_m’u_ÿÎbacks.h
"

33 
	~"dŸg¿m_Œ“.h
"

34 
	~"³rsi¡’û.h
"

36 
	s_DŸg¿mT»e
 {

37 
GtkCT»e
 *
	mŒ“
;

38 
GtkCT»eNode
 *
	mÏ¡
;

39 
DŸg¿mT»eM’us
 *
	mm’us
;

40 
GtkCLi¡Com·»Func
 
	mdŸ_cmp
;

41 
GtkCLi¡Com·»Func
 
	mobj_cmp
;

44 
	#is_objeù_node
(
node
è(
	`GTK_CTREE_ROW
Òode)->
is_Ëaf
)

	)

46 
gšt


47 
	$fšd_hidd’_ty³
(
gcÚ¡poš‹r
 
ty³
, gcÚ¡poš‹¸
objeù_ty³
)

49  !
ty³


50 || !
objeù_ty³


51 || 
	`¡rcmp
((cÚ¡ 
gch¬
 *)
objeù_ty³
, (cÚ¡ gch¬ *)
ty³
);

52 
	}
}

54 
	#is_hidd’_ty³
(
dŒ“
, 
ty³
) \

55 
	`g_li¡_fšd_cu¡om
(
	`³rsi¡’t_li¡_g‘_gli¡
(
HIDDEN_TYPES_NAME
), \

56 (
gpoš‹r
)
ty³
, 
fšd_hidd’_ty³
)

	)

58 
	#is_hidd’_objeù
(
dŒ“
, 
objeù
) \

59 
	`is_hidd’_ty³
(
dŒ“
, ((
DŸObjeù
 *)
objeù
)->
ty³
->
Çme
)

	)

62 
upd©e_objeù
(
DŸg¿mT»e
 *
Œ“
, 
GtkCT»eNode
 *
node
, 
DŸObjeù
 *
objeù
);

65 
	$£Ëù_node
(
DŸg¿mT»e
 *
Œ“
, 
GtkCT»eNode
 *
node
, 
gboŞ—n
 
¿i£
)

67 
DŸg¿m
 *
d
 = 
NULL
;

68 
GtkCT»eNode
 *
dnode
 = (
	`is_objeù_node
(
node
)) ?

69 
	`GTK_CTREE_ROW
(
node
)->
·»Á
 :‚ode;

70 
DŸObjeù
 *
o
 = (DŸObjeù *)
	`gtk_ù»e_node_g‘_row_d©a
(
Œ“
->Œ“, 
node
);

73 
d
 = (
DŸg¿m
 *)
	`gtk_ù»e_node_g‘_row_d©a
(
Œ“
->Œ“, 
dnode
);

74 ià(
d
) {

75 
GSLi¡
 *
dli¡
 = 
d
->
di¥Ïys
;

76 ià(
	`is_objeù_node
(
node
)) {

77 ià(
o
) {

78 
	`upd©e_objeù
(
Œ“
, 
node
, 
o
);

79 
	`dŸg¿m_»move_®l_£Ëùed
(
d
, 
FALSE
);

80 
	`dŸg¿m_£Ëù
(
d
, 
o
);

83 
dli¡
) {

84 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
dli¡
->
d©a
;

85 ià(
¿i£
) {

86 
	`gdk_wšdow_¿i£
(
ddi¥
->
sh–l
->
wšdow
);

88 ià(
o
) {

89 
	`ddi¥Ïy_süŞl_to_objeù
(
ddi¥
, 
o
);

92 
	`gtk_widg‘_d¿w
(
ddi¥
->
sh–l
, 
NULL
);

93 
dli¡
 = 
	`g_¦i¡_Ãxt
(dlist);

96 
	}
}

99 
	$upd©e_Ï¡_node
(
DŸg¿mT»e
 *
Œ“
)

101 ià(
	`is_objeù_node
(
Œ“
->
Ï¡
)) {

102 
DŸObjeù
 *
o
 = (DŸObjeù *)
	`gtk_ù»e_node_g‘_row_d©a
(
Œ“
->Œ“,»e->
Ï¡
);

103 ià(
o
è
	`upd©e_objeù
(
Œ“
,»e->
Ï¡
, o);

105 
	}
}

108 
gšt


109 
	$bu‰Ú_´ess_ÿÎback
(
GtkCT»e
 *
Œ“
, 
GdkEv’tBu‰Ú
 *
ev’t
,

110 
DŸg¿mT»e
 *
dŒ“
)

112 
gšt
 
row
 = -1;

113 
gšt
 
cŞumn
 = -1;

115 
	`gtk_şi¡_g‘_£ËùiÚ_šfo
(
	`GTK_CLIST
(
Œ“
), 
ev’t
->
x
,ƒv’t->
y
,

116 &
row
, &
cŞumn
);

117 ià(
row
 !ğ-1è
dŒ“
->
Ï¡
 = 
	`gtk_ù»e_node_Áh
(
Œ“
,„ow);

118 
dŒ“
->
Ï¡
 = 
NULL
;

120 ià(
dŒ“
->
Ï¡
è
	`upd©e_Ï¡_node
(dtree);

123 ià(
dŒ“
->
Ï¡
 && 
ev’t
->
ty³
 =ğ
GDK_2BUTTON_PRESS
) {

125 
	`£Ëù_node
(
dŒ“
, dŒ“->
Ï¡
, 
TRUE
);

126 } ià(
dŒ“
->
Ï¡
 && 
ev’t
->
ty³
 =ğ
GDK_BUTTON_PRESS
) {

127 ià(
ev’t
->
bu‰Ú
 == 3) {

128 
DŸg¿mT»eM’uTy³
 
m’u
 = (
	`is_objeù_node
(
dŒ“
->
Ï¡
))?

129 
DIA_MENU_OBJECT
 : 
DIA_MENU_DIAGRAM
;

130 
	`dŸg¿m_Œ“_m’us_pİup_m’u
(
dŒ“
->
m’us
, 
m’u
, 
ev’t
->
time
);

131 } ià(
ev’t
->
bu‰Ú
 == 1) {

132 
	`£Ëù_node
(
dŒ“
, dŒ“->
Ï¡
, 
FALSE
);

134  
FALSE
;

137  
TRUE
;

138 
	}
}

142 
	$sÜt_objeùs
(
DŸg¿mT»e
 *
Œ“
, 
GtkCT»eNode
 *
node
)

144 ià(
Œ“
->
obj_cmp
) {

145 
GtkCT»eNode
 *
dnode
 =

146 (
	`is_objeù_node
(
node
))? 
	`GTK_CTREE_ROW
Òode)->
·»Á
 :‚ode;

147 
	`gtk_şi¡_£t_com·»_func
(
	`GTK_CLIST
(
Œ“
->Œ“),»e->
obj_cmp
);

148 
	`gtk_ù»e_sÜt_node
(
Œ“
->Œ“, 
dnode
);

150 
	}
}

153 
	$sÜt_dŸg¿ms
(
DŸg¿mT»e
 *
Œ“
)

155 ià(
Œ“
->
dŸ_cmp
) {

156 
	`gtk_şi¡_£t_com·»_func
(
	`GTK_CLIST
(
Œ“
->Œ“),»e->
dŸ_cmp
);

157 
	`gtk_ù»e_sÜt_node
(
Œ“
->Œ“, 
NULL
);

159 
	}
}

161 
GLi¡
*

162 
	$g‘_dŸg¿m_objeùs
(
DŸg¿m
 *
dŸg¿m
)

164 
GLi¡
 *
»suÉ
 = 
NULL
;

165 
GPŒA¼ay
 *
Ïy”s
 = 
dŸg¿m
->
d©a
->layers;

166 ià(
Ïy”s
) {

167 
k
 = 0;

168 
Lay”
 *
Ïy
;

169 
k
 = 0; k < 
Ïy”s
->
Ën
; k++) {

170 
Ïy
 = (
Lay”
 *)
	`g_±r_¬¿y_šdex
(
Ïy”s
, 
k
);

171 
»suÉ
 = 
	`g_li¡_cÚÿt
ÔesuÉ, 
	`g_li¡_cİy
(
Ïy
->
objeùs
));

174  
»suÉ
;

175 
	}
}

178 
	$ü—‹_objeù_pixm­
(
DŸObjeù
 *
objeù
, 
GtkWidg‘
 *
·»Á
,

179 
GdkPixm­
 **
pixm­
, 
GdkB™m­
 **
mask
)

181 
GtkStyË
 *
¡yË
;

183 
	`g_as£¹
(
objeù
);

184 
	`g_as£¹
(
pixm­
);

185 
	`g_as£¹
(
mask
);

187 
¡yË
 = 
	`gtk_widg‘_g‘_¡yË
(
·»Á
);

189 ià(
objeù
->
ty³
->
pixm­
 !ğ
NULL
) {

190 ià(
	`¡ºcmp
((*)
objeù
->
ty³
->
pixm­
, "GdkP", 4) == 0) {

191 
GdkPixbuf
 *
p
;

192 
p
 = 
	`gdk_pixbuf_Ãw_äom_šlše
(-1, (
gušt8
*)
objeù
->
ty³
->
pixm­
, 
TRUE
, 
NULL
);

193 
	`gdk_pixbuf_»nd”_pixm­_ªd_mask_fÜ_cŞÜm­
(
p
, 
	`gtk_widg‘_g‘_cŞÜm­
(
·»Á
), 
pixm­
, 
mask
, 128);

194 
	`g_objeù_uÄef
 (
p
);

196 *
pixm­
 =

197 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

198 
	`gtk_widg‘_g‘_cŞÜm­
(
·»Á
),

199 
mask
,

200 &
¡yË
->
bg
[
GTK_STATE_NORMAL
],

201 
objeù
->
ty³
->
pixm­
);

203 } ià(
objeù
->
ty³
->
pixm­_fe
 !ğ
NULL
) {

204 *
pixm­
 =

205 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm
(
NULL
,

206 
	`gtk_widg‘_g‘_cŞÜm­
(
·»Á
),

207 
mask
,

208 &
¡yË
->
bg
[
GTK_STATE_NORMAL
],

209 
objeù
->
ty³
->
pixm­_fe
);

211 *
pixm­
 = 
NULL
;

212 *
mask
 = 
NULL
;

214 
	}
}

216 
gch¬
 *

217 
	$g‘_objeù_Çme
(
DŸObjeù
 *
objeù
)

219 ’um {
SIZE
 = 31};

220 
gch¬
 
BUFFER
[
SIZE
];

222 
gch¬
 *
Çme
 = 
	`objeù_g‘_di¥ÏyÇme
 (
objeù
);

223 
	`g_¢´štf
(
BUFFER
, 
SIZE
, " %s", 
Çme
);

224 
	`g_ä“
(
Çme
);

226  
BUFFER
;

227 
	}
}

230 
	$upd©e_objeù
(
DŸg¿mT»e
 *
Œ“
, 
GtkCT»eNode
 *
node
, 
DŸObjeù
 *
objeù
)

232 *
‹xt
 = 
	`g‘_objeù_Çme
(
objeù
);

233 *
Şd
 = 
NULL
;

234 
	`gtk_ù»e_node_g‘_‹xt
(
Œ“
->Œ“, 
node
, 0, &
Şd
);

235 ià(!
Şd
 || (
‹xt
 && 
	`¡rcmp
(text, old))) {

236 
GdkPixm­
 *
pixm­
;

237 
GdkB™m­
 *
mask
;

238 
	`ü—‹_objeù_pixm­
(
objeù
, 
	`GTK_WIDGET
(
Œ“
->Œ“), &
pixm­
, &
mask
);

239 
	`gtk_ù»e_£t_node_šfo
(
Œ“
->Œ“, 
node
, 
‹xt
, 3, 
pixm­
, 
mask
,

240 
pixm­
, 
mask
, 
TRUE
, TRUE);

241 
	`sÜt_objeùs
(
Œ“
, 
node
);

243 
	}
}

245 
	s_Pixm­sAndMasks


247 
GdkPixm­
 *
	mpixm­
;

248 
GdkB™m­
 *
	mmask
;

249 } 
	tPixm­sAndMasks
;

251 
GHashTabË
 *
	g_pixm­s_ªd_masks
 = 
NULL
;

254 
	$ü—‹_objeù_node
(
DŸg¿mT»e
 *
Œ“
, 
GtkCT»eNode
 *
dnode
, 
DŸObjeù
 *
obj
)

256 
gboŞ—n
 
ex·nded
 = 
	`GTK_CTREE_ROW
(
dnode
)->expanded;

257 *
‹xt
[] = {
NULL
};

258 
GdkPixm­
 *
pixm­
;

259 
GdkB™m­
 *
mask
;

260 
GtkCT»eNode
 *
node
;

261 
Pixm­sAndMasks
 *
²m
;

263 
‹xt
[0] = 
	`g‘_objeù_Çme
(
obj
);

265 ià(!
_pixm­s_ªd_masks
)

266 
_pixm­s_ªd_masks
 = 
	`g_hash_bË_Ãw_fuÎ
(

267 
g_¡r_hash
, 
g_¡r_equ®
, 
NULL
, 
g_ä“
);

269 
²m
 = 
	`g_hash_bË_lookup
 (
_pixm­s_ªd_masks
, 
obj
->
ty³
->
Çme
);

270 ià(!
²m
) {

271 
²m
 = 
	`g_Ãw0
 (
Pixm­sAndMasks
, 1);

272 
	`ü—‹_objeù_pixm­
(
obj
, 
	`GTK_WIDGET
(
Œ“
->Œ“), &
²m
->
pixm­
, &²m->
mask
);

273 
	`g_hash_bË_š£¹
 (
_pixm­s_ªd_masks
, 
obj
->
ty³
->
Çme
, 
²m
);

275 
node
 = 
	`gtk_ù»e_š£¹_node
(
Œ“
->Œ“, 
dnode
, 
NULL
, 
‹xt
, 3,

276 
²m
->
pixm­
 ? 
	`g_objeù_»f
 (²m->pixm­è: 
NULL
,

277 
²m
->
mask
 ? 
	`g_objeù_»f
 (²m->maskè: 
NULL
,

278 
NULL
, NULL, 
TRUE
, 
FALSE
);

279 
	`gtk_ù»e_node_£t_row_d©a
(
Œ“
->Œ“, 
node
, (
gpoš‹r
)
obj
);

280 ià(
ex·nded
è
	`gtk_ù»e_ex·nd
(
Œ“
->Œ“, 
dnode
);

281 
	`sÜt_objeùs
(
Œ“
, 
dnode
);

282 
	}
}

286 
	$ü—‹_dŸg¿m_chd»n
(
DŸg¿mT»e
 *
Œ“
, 
GtkCT»eNode
 *
node
,

287 
DŸg¿m
 *
dŸg¿m
)

289 
GLi¡
 *
objeùs
 = 
	`g‘_dŸg¿m_objeùs
(
dŸg¿m
);

290 
GLi¡
 *
Üg
 = 
objeùs
;

291 
objeùs
) {

292 ià(!
	`is_hidd’_objeù
(
Œ“
, 
objeùs
->
d©a
)) {

293 
	`ü—‹_objeù_node
(
Œ“
, 
node
, (
DŸObjeù
 *)
objeùs
->
d©a
);

295 
objeùs
 = 
	`g_li¡_Ãxt
(objects);

297 
	`g_li¡_ä“
(
Üg
);

298 
	}
}

301 
	$upd©e_dŸg¿m_chd»n
(
DŸg¿mT»e
 *
Œ“
, 
GtkCT»eNode
 *
node
,

302 
DŸg¿m
 *
dŸg¿m
)

304 
GLi¡
 *
dobjeùs
 = 
	`g‘_dŸg¿m_objeùs
(
dŸg¿m
);

305 
GLi¡
 *
Üg
 = 
dobjeùs
;

306 
GtkCT»eNode
 *
chd
 = 
	`GTK_CTREE_ROW
(
node
)->
chd»n
;

307 ià(
dobjeùs
) {

308 
chd
) {

309 
GtkCT»eNode
 *
cu¼’t
 = 
chd
;

310 
gpoš‹r
 
obj
 = 
	`gtk_ù»e_node_g‘_row_d©a
(
Œ“
->Œ“, 
cu¼’t
);

311 
chd
 = 
	`GTK_CTREE_ROW
(chd)->
siblšg
;

312 ià(!
	`g_li¡_fšd
(
dobjeùs
, 
obj
è|| 
	`is_hidd’_objeù
(
Œ“
, obj))

313 
	`gtk_ù»e_»move_node
(
Œ“
->Œ“, 
cu¼’t
);

316 
dobjeùs
) {

317 ià(!
	`is_hidd’_objeù
(
Œ“
, 
dobjeùs
->
d©a
)

318 && !
	`gtk_ù»e_fšd_by_row_d©a
(
Œ“
->Œ“, 
node
, 
dobjeùs
->
d©a
))

319 
	`ü—‹_objeù_node
(
Œ“
, 
node
, (
DŸObjeù
 *)
dobjeùs
->
d©a
);

320 
dobjeùs
 = 
	`g_li¡_Ãxt
(dobjects);

322 
	`g_li¡_ä“
(
Üg
);

323 
	`sÜt_objeùs
(
Œ“
, 
node
);

324 
	}
}

327 
DŸg¿mT»e
*

328 
	$dŸg¿m_Œ“_Ãw
(
GLi¡
 *
dŸg¿ms
, 
GtkWšdow
 *
wšdow
,

329 
DŸg¿mT»eSÜtTy³
 
dŸ_sÜt
,

330 
DŸg¿mT»eSÜtTy³
 
obj_sÜt
)

332 
GLi¡
 *
tm¶i¡
;

333 
DŸg¿mT»e
 *
»suÉ
 = 
	`g_Ãw
(DiagramTree, 1);

334 
»suÉ
->
Œ“
 = 
	`GTK_CTREE
(
	`gtk_ù»e_Ãw
(1, 0));

335 
»suÉ
->
Ï¡
 = 
NULL
;

336 
»suÉ
->
dŸ_cmp
 =„esuÉ->
obj_cmp
 = 
NULL
;

338 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
»suÉ
->
Œ“
),

340 
	`G_CALLBACK
(
bu‰Ú_´ess_ÿÎback
),

341 (
gpoš‹r
)
»suÉ
);

342 
dŸg¿ms
) {

343 
	`dŸg¿m_Œ“_add
(
»suÉ
, (
DŸg¿m
 *)
dŸg¿ms
->
d©a
);

344 
dŸg¿ms
 = 
	`g_li¡_Ãxt
(diagrams);

346 
	`dŸg¿m_Œ“_£t_dŸg¿m_sÜt_ty³
(
»suÉ
, 
dŸ_sÜt
);

347 
	`dŸg¿m_Œ“_£t_objeù_sÜt_ty³
(
»suÉ
, 
obj_sÜt
);

348 
»suÉ
->
m’us
 = 
	`dŸg¿m_Œ“_m’us_Ãw
ÔesuÉ, 
wšdow
);

350 
tm¶i¡
 = 
	`³rsi¡’t_li¡_g‘_gli¡
(
HIDDEN_TYPES_NAME
);

351 ; 
tm¶i¡
 !ğ
NULL
;m¶i¡ = 
	`g_li¡_Ãxt
(tmplist)) {

352 
	`dŸg¿m_Œ“_m’us_add_hidd’_ty³
(
»suÉ
->
m’us
, 
tm¶i¡
->
d©a
);

354  
»suÉ
;

355 
	}
}

358 
	$dŸg¿m_Œ“_d–‘e
(
DŸg¿mT»e
 *
Œ“
)

360 
	`g_»tuº_if_ç
(
Œ“
);

361 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
Œ“
->tree));

362 
	}
}

365 
	$dŸg¿m_Œ“_add
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
)

367 ià(
Œ“
) {

368 ià(
dŸg¿m


369 && !
	`gtk_ù»e_fšd_by_row_d©a
(
Œ“
->Œ“, 
NULL
, (
gpoš‹r
)
dŸg¿m
))

371 *
‹xt
[] = {(*)
	`g_ba£Çme
(
dŸg¿m
->
f’ame
)};

372 
GtkCT»eNode
 *
node
 =

373 
	`gtk_ù»e_š£¹_node
(
Œ“
->Œ“, 
NULL
, NULL, 
‹xt
, 1,

374 
NULL
, NULL, NULL, NULL, 
FALSE
, FALSE);

375 
	`gtk_ù»e_node_£t_row_d©a
(
Œ“
->Œ“, 
node
, (
gpoš‹r
)
dŸg¿m
);

376 
	`ü—‹_dŸg¿m_chd»n
(
Œ“
, 
node
, 
dŸg¿m
);

377 
	`sÜt_dŸg¿ms
(
Œ“
);

380 
	}
}

383 
	$dŸg¿m_Œ“_»move
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
)

385 ià(
Œ“
) {

386 
GtkCT»eNode
 *
node
;

387 ià(
dŸg¿m


388 && (
node
 = 
	`gtk_ù»e_fšd_by_row_d©a
(
Œ“
->Œ“, 
NULL
,

389 (
gpoš‹r
)
dŸg¿m
)))

390 
	`gtk_ù»e_»move_node
(
Œ“
->Œ“, 
node
);

392 
	}
}

395 
	$dŸg¿m_Œ“_upd©e
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
)

397 ià(
Œ“
) {

398 ià(
	`dŸg¿m_is_modif›d
(
dŸg¿m
)) {

399 
GtkCT»eNode
 *
dnode
 =

400 
	`gtk_ù»e_fšd_by_row_d©a
(
Œ“
->Œ“, 
NULL
, (
gpoš‹r
)
dŸg¿m
);

401 ià(
dnode
è
	`upd©e_dŸg¿m_chd»n
(
Œ“
, dnode, 
dŸg¿m
);

402 
	`dŸg¿m_Œ“_add
(
Œ“
, 
dŸg¿m
);

405 
	}
}

408 
	$dŸg¿m_Œ“_upd©e_®l
(
DŸg¿mT»e
 *
Œ“
)

410 ià(
Œ“
) {

411 
GtkCT»eNode
 *
node
 = 
	`gtk_ù»e_node_Áh
(
Œ“
->tree, 0);

412 
node
) {

413 
DŸg¿m
 *
d
 = (DŸg¿m *)
	`gtk_ù»e_node_g‘_row_d©a
(
Œ“
->Œ“, 
node
);

414 ià(
d
è
	`upd©e_dŸg¿m_chd»n
(
Œ“
, 
node
, d);

415 
node
 = 
	`GTK_CTREE_ROW
Òode)->
siblšg
;

418 
	}
}

421 
	$dŸg¿m_Œ“_upd©e_Çme
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
)

423 ià(
Œ“
) {

424 
GtkCT»eNode
 *
node
;

425 
	`g_»tuº_if_ç
(
dŸg¿m
);

426 
node
 = 
	`gtk_ù»e_fšd_by_row_d©a
(
Œ“
->Œ“, 
NULL
, (
gpoš‹r
)
dŸg¿m
);

427 ià(
node
) {

428 
	`gtk_ù»e_node_£t_‹xt
(
Œ“
->Œ“, 
node
, 0,

429 
	`g_ba£Çme
(
dŸg¿m
->
f’ame
));

430 
	`sÜt_dŸg¿ms
(
Œ“
);

433 
	}
}

436 
	$dŸg¿m_Œ“_add_objeù
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
, 
DŸObjeù
 *
objeù
)

438 ià(
Œ“
) {

439 
	`g_»tuº_if_ç
(
dŸg¿m
);

440 ià(
objeù
 && !
	`is_hidd’_objeù
(
Œ“
, object)) {

441 
GtkCT»eNode
 *
dnode
 =

442 
	`gtk_ù»e_fšd_by_row_d©a
(
Œ“
->Œ“, 
NULL
, (
gpoš‹r
)
dŸg¿m
);

443 ià(!
dnode
è
	`dŸg¿m_Œ“_add
(
Œ“
, 
dŸg¿m
);

444 ià(!
	`gtk_ù»e_fšd_by_row_d©a
(
Œ“
->Œ“, 
dnode
, (
gpoš‹r
)
objeù
))

445 
	`ü—‹_objeù_node
(
Œ“
, 
dnode
, 
objeù
);

448 
	}
}

451 
	$dŸg¿m_Œ“_add_objeùs
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
, 
GLi¡
 *
objeùs
)

453 ià(
Œ“
) {

454 
	`g_»tuº_if_ç
(
dŸg¿m
);

455 
objeùs
) {

456 
	`dŸg¿m_Œ“_add_objeù
(
Œ“
, 
dŸg¿m
, (
DŸObjeù
 *)
objeùs
->
d©a
);

457 
objeùs
 = 
	`g_li¡_Ãxt
(objects);

460 
	}
}

464 
	$dŸg¿m_Œ“_»move_objeù
(
DŸg¿mT»e
 *
Œ“
, 
DŸObjeù
 *
objeù
)

466 ià(
Œ“
) {

467 ià(
objeù
) {

468 
GtkCT»eNode
 *
node
 =

469 
	`gtk_ù»e_fšd_by_row_d©a
(
Œ“
->Œ“, 
NULL
, (
gpoš‹r
)
objeù
);

470 ià(
node
è
	`gtk_ù»e_»move_node
(
Œ“
->tree,‚ode);

473 
	}
}

476 
	$dŸg¿m_Œ“_»move_objeùs
(
DŸg¿mT»e
 *
Œ“
, 
GLi¡
 *
objeùs
)

478 ià(
Œ“
) {

479 
objeùs
) {

480 
	`dŸg¿m_Œ“_»move_objeù
(
Œ“
, (
DŸObjeù
 *)
objeùs
->
d©a
);

481 
objeùs
 = 
	`g_li¡_Ãxt
(objects);

484 
	}
}

487 
	$dŸg¿m_Œ“_upd©e_objeù
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
,

488 
DŸObjeù
 *
objeù
)

490 ià(
Œ“
) {

491 
	`g_»tuº_if_ç
(
dŸg¿m
);

492 ià(
objeù
) {

493 
GtkCT»eNode
 *
node
 =

494 
	`gtk_ù»e_fšd_by_row_d©a
(
Œ“
->Œ“, 
NULL
,(
gpoš‹r
)
objeù
);

495 ià(
node
) {

496 
	`upd©e_objeù
(
Œ“
, 
node
, 
objeù
);

500 
	}
}

503 
	$dŸg¿m_Œ“_¿i£
(
DŸg¿mT»e
 *
Œ“
)

505 ià(
Œ“
 &&»e->
Ï¡
) {

506 
	`£Ëù_node
(
Œ“
,»e->
Ï¡
, 
TRUE
);

508 
	}
}

511 
	$dŸg¿m_Œ“_show_´İ”t›s
(cÚ¡ 
DŸg¿mT»e
 *
Œ“
)

513 ià(
Œ“
 &&»e->
Ï¡
 && 
	`is_objeù_node
(tree->last)) {

514 
GtkCT»eNode
 *
·»Á
 = 
	`GTK_CTREE_ROW
(
Œ“
->
Ï¡
)->parent;

515 ià(
·»Á
) {

516 
DŸg¿m
 *
dŸ
 = (DŸg¿m *)
	`gtk_ù»e_node_g‘_row_d©a
(
Œ“
->Œ“, 
·»Á
);

517 
DŸObjeù
 *
obj
 =

518 (
DŸObjeù
 *)
	`gtk_ù»e_node_g‘_row_d©a
(
Œ“
->Œ“,»e->
Ï¡
);

519 
	`objeù_´İ”t›s_show
(
dŸ
, 
obj
);

522 
	}
}

524 cÚ¡ 
gch¬
 *

525 
	$dŸg¿m_Œ“_hide_ty³
(
DŸg¿mT»e
 *
Œ“
)

527 ià(
Œ“
 &&»e->
Ï¡
 && 
	`is_objeù_node
(tree->last)) {

528 
DŸObjeù
 *
obj
 =

529 (
DŸObjeù
 *)
	`gtk_ù»e_node_g‘_row_d©a
(
Œ“
->Œ“,»e->
Ï¡
);

530 
	`g_as£¹
(!
	`is_hidd’_objeù
(
Œ“
, 
obj
));

531 
	`dŸg¿m_Œ“_hide_ex¶ic™_ty³
(
Œ“
, 
obj
->
ty³
->
Çme
);

532  
obj
->
ty³
->
Çme
;

534  
NULL
;

535 
	}
}

538 
	$dŸg¿m_Œ“_hide_ex¶ic™_ty³
(
DŸg¿mT»e
 *
Œ“
, cÚ¡ 
gch¬
 *
ty³
)

540 ià(
Œ“
 && 
ty³
) {

541 
	`³rsi¡’t_li¡_add
(
HIDDEN_TYPES_NAME
, 
ty³
);

542 
	`dŸg¿m_Œ“_m’us_add_hidd’_ty³
(
Œ“
->
m’us
, 
ty³
);

543 
	`dŸg¿m_Œ“_upd©e_®l
(
Œ“
);

545 
	}
}

548 
	$dŸg¿m_Œ“_unhide_ty³
(
DŸg¿mT»e
 *
Œ“
, cÚ¡ 
gch¬
 *
ty³
)

550 ià(
Œ“
 && 
ty³
) {

551 
GLi¡
 *
t
 = 
	`is_hidd’_ty³
(
Œ“
, 
ty³
);

552 ià(
t
) {

553 
	`³rsi¡’t_li¡_»move
(
HIDDEN_TYPES_NAME
, 
ty³
);

554 
	`dŸg¿m_Œ“_upd©e_®l
(
Œ“
);

557 
	}
}

560 
gšt


561 
	$cmp_Çme_
(
GtkCLi¡
 *
Œ“
, 
GtkCLi¡Row
 *
lhm
, GtkCLi¡Row *
rhm
)

563 
k
;

564 
gch¬
 *
Çme1
 = 
lhm
->
ûÎ
->
u
.
‹xt
;

565 
gch¬
 *
Çme2
 = 
rhm
->
ûÎ
->
u
.
‹xt
;

566 ià(
Çme1
 && !
Çme2
è
k
 = -1;

567 ià(!
Çme1
 && 
Çme2
è
k
 = 1;

568 ià(!
Çme1
 && !
Çme2
è
k
 = 0;

569 
k
 = 
	`¡rcmp
(
Çme1
, 
Çme2
);

570 ià(
k
 > 0)  1;

571 ià(
k
 < 0)  -1;

573 
	}
}

575 
gšt


576 
	$cmp_ty³_
(
GtkCLi¡
 *
Œ“
, 
GtkCLi¡Row
 *
lhm
, GtkCLi¡Row *
rhm
)

578 
k
;

579 
DŸObjeù
 *
o1
 = (DŸObjeù *)
lhm
->
d©a
;

580 
DŸObjeù
 *
o2
 = (DŸObjeù *)
rhm
->
d©a
;

581 
k
 = 
	`¡rcmp
(
o1
->
ty³
->
Çme
, 
o2
->type->name);

582 ià(
k
 > 0)  1;

583 ià(
k
 < 0)  -1;

585 
	}
}

587 
GtkCLi¡Com·»Func
 
	gcmp_funcs_
[] = {

588 (
GtkCLi¡Com·»Func
)
cmp_Çme_
,

589 (
GtkCLi¡Com·»Func
)
cmp_ty³_
,

590 
NULL


594 
	$dŸg¿m_Œ“_sÜt_objeùs
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
)

596 ià(
Œ“
 && 
ty³
 <ğ
DIA_TREE_SORT_INSERT
 &&»e->
Ï¡
) {

597 
GtkCT»eNode
 *
node
 = 
	`is_objeù_node
(
Œ“
->
Ï¡
)?

598 
	`GTK_CTREE_ROW
(
Œ“
->
Ï¡
)->
·»Á
 :ree->last;

599 
	`gtk_şi¡_£t_com·»_func
(
	`GTK_CLIST
(
Œ“
->Œ“), 
cmp_funcs_
[
ty³
]);

600 
	`gtk_ù»e_sÜt_node
(
Œ“
->Œ“, 
node
);

602 
	}
}

605 
	$dŸg¿m_Œ“_sÜt_®l_objeùs
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
)

608 ià(
Œ“
 && 
ty³
 <ğ
DIA_TREE_SORT_INSERT
 &&»e->
Ï¡
) {

609 
GtkCT»eNode
 *
node
 = 
	`is_objeù_node
(
Œ“
->
Ï¡
)?

610 
	`GTK_CTREE_ROW
(
Œ“
->
Ï¡
)->
·»Á
 :ree->last;

611 
	`GTK_CTREE_NODE_PREV
(
node
))‚ode = GTK_CTREE_NODE_PREV(node);

612 
node
) {

613 
	`gtk_şi¡_£t_com·»_func
(
	`GTK_CLIST
(
Œ“
->Œ“), 
cmp_funcs_
[
ty³
]);

614 
	`gtk_ù»e_sÜt_node
(
Œ“
->Œ“, 
node
);

615 
node
 = 
	`GTK_CTREE_ROW
Òode)->
siblšg
;

618 
	}
}

621 
	$dŸg¿m_Œ“_sÜt_dŸg¿ms
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
)

623 ià(
Œ“
 && 
ty³
 <ğ
DIA_TREE_SORT_INSERT
 &&y³ !ğ
DIA_TREE_SORT_TYPE
) {

624 
	`gtk_şi¡_£t_com·»_func
(
	`GTK_CLIST
(
Œ“
->Œ“), 
cmp_funcs_
[
ty³
]);

625 
	`gtk_ù»e_sÜt_node
(
Œ“
->Œ“, 
NULL
);

627 
	}
}

630 
	$dŸg¿m_Œ“_£t_objeù_sÜt_ty³
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
)

632 ià(
Œ“
 && 
ty³
 <ğ
DIA_TREE_SORT_INSERT
) {

633 
Œ“
->
obj_cmp
 = 
cmp_funcs_
[
ty³
];

634 
	`dŸg¿m_Œ“_sÜt_®l_objeùs
(
Œ“
, 
ty³
);

636 
	}
}

639 
	$dŸg¿m_Œ“_£t_dŸg¿m_sÜt_ty³
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
)

641 ià(
Œ“
 && 
ty³
 <ğ
DIA_TREE_SORT_INSERT
 &&y³ !ğ
DIA_TREE_SORT_TYPE
) {

642 
Œ“
->
dŸ_cmp
 = 
cmp_funcs_
[
ty³
];

643 
	`dŸg¿m_Œ“_sÜt_dŸg¿ms
(
Œ“
, 
ty³
);

645 
	}
}

647 
DŸg¿mT»eSÜtTy³


648 
	$sÜt_ty³_lookup
(
GtkCLi¡Com·»Func
 
func
)

650 
k
;

651 
k
 = 0; k <ğ
DIA_TREE_SORT_INSERT
; ++k) {

652 ià(
cmp_funcs_
[
k
] =ğ
func
)  k;

654 
	`g_as£¹_nÙ_»ached
();

656 
	}
}

658 
DŸg¿mT»eSÜtTy³


659 
	$dŸg¿m_Œ“_dŸg¿m_sÜt_ty³
(cÚ¡ 
DŸg¿mT»e
 *
Œ“
)

661 ià(
Œ“
) {

662  
	`sÜt_ty³_lookup
(
Œ“
->
dŸ_cmp
);

664  
DIA_TREE_SORT_INSERT
;

665 
	}
}

668 
DŸg¿mT»eSÜtTy³


669 
	$dŸg¿m_Œ“_objeù_sÜt_ty³
(cÚ¡ 
DŸg¿mT»e
 *
Œ“
)

671 ià(
Œ“
) {

672  
	`sÜt_ty³_lookup
(
Œ“
->
obj_cmp
);

674  
DIA_TREE_SORT_INSERT
;

675 
	}
}

677 
GtkWidg‘
*

678 
	$dŸg¿m_Œ“_widg‘
(cÚ¡ 
DŸg¿mT»e
 *
Œ“
)

680 
	`g_»tuº_v®_if_ç
(
Œ“
, 
NULL
);

681  
	`GTK_WIDGET
(
Œ“
->tree);

682 
	}
}

	@O:\tool\dvs50\app\diagram_tree.h

24 #iâdeà
DIAGRAM_TREE_H


25 
	#DIAGRAM_TREE_H


	)

27 
	~<gtk/gtk.h
>

28 
	~"dŸg¿m.h
"

30 
	#HIDDEN_TYPES_NAME
 "dŸg¿m-Œ“-hidd’-ty³s"

	)

33 
_DŸg¿mT»e
 
	tDŸg¿mT»e
;

38 
	mDIA_TREE_SORT_NAME
,

39 
	mDIA_TREE_SORT_TYPE
,

40 
	mDIA_TREE_SORT_INSERT


41 } 
	tDŸg¿mT»eSÜtTy³
;

46 
DŸg¿mT»e
*

47 
dŸg¿m_Œ“_Ãw
(
GLi¡
 *
dŸg¿ms
, 
GtkWšdow
 *
wšdow
,

48 
DŸg¿mT»eSÜtTy³
 
dŸ_sÜt
,

49 
DŸg¿mT»eSÜtTy³
 
obj_sÜt
);

53 
dŸg¿m_Œ“_d–‘e
(
DŸg¿mT»e
 *
Œ“
);

57 
dŸg¿m_Œ“_add
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
);

61 
dŸg¿m_Œ“_»move
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
);

65 
dŸg¿m_Œ“_upd©e_®l
(
DŸg¿mT»e
 *
Œ“
);

68 
dŸg¿m_Œ“_upd©e
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
);

71 
dŸg¿m_Œ“_upd©e_Çme
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
);

75 
dŸg¿m_Œ“_add_objeù
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
, 
DŸObjeù
 *
objeù
);

78 
dŸg¿m_Œ“_add_objeùs
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
, 
GLi¡
 *
objeùs
);

81 
dŸg¿m_Œ“_»move_objeù
(
DŸg¿mT»e
 *
Œ“
, 
DŸObjeù
 *
objeù
);

84 
dŸg¿m_Œ“_»move_objeùs
(
DŸg¿mT»e
 *
Œ“
, 
GLi¡
 *
objeùs
);

87 
dŸg¿m_Œ“_upd©e_objeù
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿m
 *
dŸg¿m
,

88 
DŸObjeù
 *
objeù
);

92 
dŸg¿m_Œ“_¿i£
(
DŸg¿mT»e
 *
Œ“
);

95 
dŸg¿m_Œ“_show_´İ”t›s
(cÚ¡ 
DŸg¿mT»e
 *
Œ“
);

97 cÚ¡ 
gch¬
 *

98 
dŸg¿m_Œ“_hide_ty³
(
DŸg¿mT»e
 *
Œ“
);

101 
dŸg¿m_Œ“_hide_ex¶ic™_ty³
(
DŸg¿mT»e
 *
Œ“
, cÚ¡ 
gch¬
 *
ty³
);

104 
dŸg¿m_Œ“_unhide_ty³
(
DŸg¿mT»e
 *
Œ“
, cÚ¡ 
gch¬
 *
ty³
);

107 
dŸg¿m_Œ“_sÜt_objeùs
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
);

110 
dŸg¿m_Œ“_sÜt_®l_objeùs
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
);

113 
dŸg¿m_Œ“_sÜt_dŸg¿ms
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
);

116 
dŸg¿m_Œ“_£t_objeù_sÜt_ty³
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
);

119 
dŸg¿m_Œ“_£t_dŸg¿m_sÜt_ty³
(
DŸg¿mT»e
 *
Œ“
, 
DŸg¿mT»eSÜtTy³
 
ty³
);

121 
DŸg¿mT»eSÜtTy³


122 
dŸg¿m_Œ“_dŸg¿m_sÜt_ty³
(cÚ¡ 
DŸg¿mT»e
 *
Œ“
);

124 
DŸg¿mT»eSÜtTy³


125 
dŸg¿m_Œ“_objeù_sÜt_ty³
(cÚ¡ 
DŸg¿mT»e
 *
Œ“
);

128 
GtkWidg‘
*

129 
dŸg¿m_Œ“_widg‘
(cÚ¡ 
DŸg¿mT»e
 *
Œ“
);

	@O:\tool\dvs50\app\diagram_tree_menu.c

23 #ifdeà
HAVE_CONFIG_H


24 
	~<cÚfig.h
>

27 #undeà
GTK_DISABLE_DEPRECATED


28 
	~"dŸg¿m_Œ“_m’u_ÿÎbacks.h
"

29 
	~"dŸg¿m_Œ“_m’u.h
"

30 
	~"dŸg¿m_Œ“_wšdow.h
"

31 
	~"´eã»nûs.h
"

32 
	~"š.h
"

34 
	s_DŸg¿mT»eM’us
 {

35 
GtkI‹mFaùÜy
 *
	mçùÜ›s
[2];

36 
GtkWidg‘
 *
	mm’us
[2];

37 
GtkWidg‘
 *
	mshow_m’us
[2];

38 
DŸg¿mT»e
 *
	mŒ“
;

41 
	#SHOW_TYPE_PATH
 "/Show objeùy³"

	)

43 cÚ¡ 
gch¬
 *
	gROOT_NAMES_
[] = {"<DiagramTreeDia>", "<DiagramTreeObj>"};

45 
GtkI‹mFaùÜyEÁry
 
	gcommÚ_™ems_
[] = {

46 { "/£p0", 
NULL
, NULL, 0, "<Separator>" },

47 { 
N_
("/_SÜˆobjeùs"), 
NULL
, NULL, 0, "<Branch>" },

48 { 
N_
("/SÜˆobjeùs/by _Çme"), 
NULL
, 
Ú_sÜt_objeùs_aùiv©e
,

49 
DIA_TREE_SORT_NAME
, "" },

50 { 
N_
("/SÜˆobjeùs/by _ty³"), 
NULL
, 
Ú_sÜt_objeùs_aùiv©e
,

51 
DIA_TREE_SORT_TYPE
, "" },

52 { 
N_
("/SÜˆobjeùs/a _š£¹ed"), 
NULL
, 
Ú_sÜt_objeùs_aùiv©e
,

53 
DIA_TREE_SORT_INSERT
, "" },

54 { "/SÜˆobjeùs/£p0", 
NULL
, NULL, 0, "<Separator>" },

55 { 
N_
("/SÜˆobjeùs/AÎ by‚ame"), 
NULL
, 
Ú_sÜt_®l_objeùs_aùiv©e
,

56 
DIA_TREE_SORT_NAME
, "" },

57 { 
N_
("/SÜˆobjeùs/AÎ byy³"), 
NULL
, 
Ú_sÜt_®l_objeùs_aùiv©e
,

58 
DIA_TREE_SORT_TYPE
, "" },

59 { 
N_
("/SÜˆobjeùs/AÎ‡ š£¹ed"), 
NULL
, 
Ú_sÜt_®l_objeùs_aùiv©e
,

60 
DIA_TREE_SORT_INSERT
, "" },

61 { 
N_
("/SÜˆobjeùs/_DeçuÉ"), 
NULL
, NULL, 0, "<Branch>"},

62 { 
N_
("/SÜˆobjeùs/DeçuÉ/by _Çme"), 
NULL
, 
Ú_sÜt_def_aùiv©e
,

63 
DIA_TREE_SORT_NAME
, "<RadioItem>" },

64 { 
N_
("/SÜˆobjeùs/DeçuÉ/by _ty³"), 
NULL
, 
Ú_sÜt_def_aùiv©e
,

65 
DIA_TREE_SORT_TYPE
, "/Sort objects/Default/by‚ame" },

66 { 
N_
("/SÜˆobjeùs/DeçuÉ/a _š£¹ed"), 
NULL
, 
Ú_sÜt_def_aùiv©e
,

67 
DIA_TREE_SORT_INSERT
, "/Sort objects/Default/by‚ame" },

68 { 
N_
("/SÜˆ_dŸg¿ms"), 
NULL
, NULL, 0, "<Branch>" },

69 { 
N_
("/SÜˆ_dŸg¿ms/by _Çme"), 
NULL
, 
Ú_sÜt_dŸg¿ms_aùiv©e
,

70 
DIA_TREE_SORT_NAME
, "" },

71 { 
N_
("/SÜˆ_dŸg¿ms/a _š£¹ed"), 
NULL
, 
Ú_sÜt_dŸg¿ms_aùiv©e
,

72 
DIA_TREE_SORT_INSERT
, "" },

73 { 
N_
("/SÜˆdŸg¿ms/_DeçuÉ"), 
NULL
, NULL, 0, "<Branch>"},

74 { 
N_
("/SÜˆdŸg¿ms/DeçuÉ/by _Çme"), 
NULL
, 
Ú_sÜt_dŸ_def_aùiv©e
,

75 
DIA_TREE_SORT_NAME
, "<RadioItem>" },

76 { 
N_
("/SÜˆdŸg¿ms/DeçuÉ/a _š£¹ed"), 
NULL
, 
Ú_sÜt_dŸ_def_aùiv©e
,

77 
DIA_TREE_SORT_INSERT
, "/Sort diagrams/Default/by‚ame" },

80 cÚ¡ 
gšt
 
	gCOMMON_ITEMS_SIZE_
 =

81  (
commÚ_™ems_
) /  (common_items_[0]);

83 
GtkI‹mFaùÜyEÁry
 
	gobjeù_™ems_
[] = {

84 { 
N_
("/_Loÿ‹"), 
NULL
, 
Ú_loÿ‹_objeù_aùiv©e
, 0, "" },

85 { 
N_
("/_Prİ”t›s"), 
NULL
, 
Ú_´İ”t›s_aùiv©e
, 0, "" },

86 { 
N_
("/_Hidthi ty³"), 
NULL
, 
Ú_hide_objeù_aùiv©e
, 0, "" },

87 { 
N_
(
SHOW_TYPE_PATH
), 
NULL
, NULL, 0, "<Branch>" },

92 
	#OBJ_ITEMS_SIZE_
 ( (
objeù_™ems_
è/  (objeù_™ems_[0]))

	)

94 
GtkI‹mFaùÜyEÁry
 
	gdŸ_™ems_
[] = {

95 { 
N_
("/_Loÿ‹"), 
NULL
, 
Ú_loÿ‹_dŸ_aùiv©e
, 0, "" },

96 { 
N_
(
SHOW_TYPE_PATH
), 
NULL
, NULL, 0, "<Branch>" },

99 
	#DIA_ITEMS_SIZE_
 ( (
dŸ_™ems_
è/  (dŸ_™ems_[0]))

	)

101 
GtkI‹mFaùÜyEÁry
 *
	g™ems_
[] = { 
dŸ_™ems_
, 
objeù_™ems_
 };

102 
gšt
 
	g™ems_size_
[] = { 
DIA_ITEMS_SIZE_
, 
OBJ_ITEMS_SIZE_
 };

104 
gch¬
*

105 
	$_dŸ_Œª¦©e
 (cÚ¡ 
gch¬
 *
‹rm
, 
gpoš‹r
 
d©a
)

107 
gch¬
 *
Œªs
 = 
‹rm
;

109 ià(
‹rm
 && *term) {

111 
Œªs
 = 
	`dg‘‹xt
 (
GETTEXT_PACKAGE
, 
‹rm
);

113 ià(
‹rm
 =ğ
Œªs
)

114 
Œªs
 = 
	`dg‘‹xt
 ("gtk20", 
‹rm
);

117 ià(
‹rm
 =ğ
Œªs
) {

118 
gch¬
* 
kludge
 = 
	`g_¡rdup_´štf
 ("/%s", 
‹rm
);

119 
Œªs
 = 
	`dg‘‹xt
 (
GETTEXT_PACKAGE
, 
kludge
);

120 ià(
kludge
 =ğ
Œªs
)

121 
Œªs
 = 
‹rm
;

123 ++
Œªs
;

124 
	`g_ä“
 (
kludge
);

126 ià(
‹rm
 =ğ
Œªs
)

127 
Œªs
 = 
	`g_¡rdup_´štf
 ("XXX: %s", 
‹rm
);

130  
Œªs
;

131 
	}
}

133 
GtkI‹mFaùÜy
*

134 
	$ü—‹_çùÜy
(
DŸg¿mT»e
 *
Œ“
, 
GtkWšdow
 *
wšdow
, 
gšt
 
no
,

135 
GtkI‹mFaùÜyEÁry
 
’Œ›s
[], cÚ¡ 
gch¬
 *
·th
)

137 
GtkI‹mFaùÜy
 *
çùÜy
;

138 
GtkAcûlGroup
 *
acûl
 = 
	`gtk_acûl_group_Ãw
();

139 
gch¬
 *
™em_·th
 = 
NULL
;

140 
GtkWidg‘
 *
m’u
;

142 
çùÜy
 = 
	`gtk_™em_çùÜy_Ãw
(
GTK_TYPE_MENU
, 
·th
, 
acûl
);

143 
	`gtk_™em_çùÜy_£t_Œª¦©e_func
(
çùÜy
, 
_dŸ_Œª¦©e
, 
NULL
, NULL);

144 
	`gtk_™em_çùÜy_ü—‹_™ems
(
çùÜy
, 
no
, 
’Œ›s
,
Œ“
);

145 
	`gtk_™em_çùÜy_ü—‹_™ems
(
çùÜy
, 
COMMON_ITEMS_SIZE_
, 
commÚ_™ems_
,

146 
Œ“
);

147 
	`gtk_wšdow_add_acûl_group
(
wšdow
, 
acûl
);

149 
	`dŸg¿m_Œ“_objeù_sÜt_ty³
(
Œ“
)) {

150 
DIA_TREE_SORT_NAME
:

151 
™em_·th
 = 
	`g_¡rcÚÿt
(
·th
, "/SÜˆobjeùs/DeçuÉ/by‚ame", 
NULL
);

153 
DIA_TREE_SORT_TYPE
:

154 
™em_·th
 = 
	`g_¡rcÚÿt
(
·th
, "/SÜˆobjeùs/DeçuÉ/byy³", 
NULL
);

157 
DIA_TREE_SORT_INSERT
:

158 
™em_·th
 = 
	`g_¡rcÚÿt
(
·th
, "/SÜˆobjeùs/DeçuÉ/a š£¹ed", 
NULL
);

162 
m’u
 = 
	`gtk_™em_çùÜy_g‘_widg‘
(
çùÜy
, 
™em_·th
);

163 
	`gtk_check_m’u_™em_£t_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u
), 
TRUE
);

164 
	`g_ä“
(
™em_·th
);

166 
	`dŸg¿m_Œ“_dŸg¿m_sÜt_ty³
(
Œ“
)) {

167 
DIA_TREE_SORT_NAME
:

168 
™em_·th
 = 
	`g_¡rcÚÿt
(
·th
, "/SÜˆdŸg¿ms/DeçuÉ/by‚ame", 
NULL
);

171 
DIA_TREE_SORT_INSERT
:

172 
™em_·th
 = 
	`g_¡rcÚÿt
(
·th
, "/SÜˆdŸg¿ms/DeçuÉ/a š£¹ed", 
NULL
);

176 
m’u
 = 
	`gtk_™em_çùÜy_g‘_widg‘
(
çùÜy
, 
™em_·th
);

177 
	`gtk_check_m’u_™em_£t_aùive
(
	`GTK_CHECK_MENU_ITEM
(
m’u
), 
TRUE
);

178 
	`g_ä“
(
™em_·th
);

180  
çùÜy
;

181 
	}
}

183 
DŸg¿mT»eM’us
 *

184 
	$dŸg¿m_Œ“_m’us_Ãw
(
DŸg¿mT»e
 *
Œ“
, 
GtkWšdow
 *
wšdow
)

186 
DŸg¿mT»eM’us
 *
»suÉ
;

187 
k
;

189 
	`g_»tuº_v®_if_ç
(
Œ“
, 
NULL
);

190 
	`g_»tuº_v®_if_ç
(
wšdow
, 
NULL
);

192 
»suÉ
 = 
	`g_Ãw
(
DŸg¿mT»eM’us
, 1);

193 
»suÉ
->
Œ“
 =ree;

194 
k
 = 0; k < 2; ++k) {

195 ’um {
LEN
 = 128};

196 
gch¬
 
BUFF
[
LEN
];

197 
»suÉ
->
çùÜ›s
[
k
] = 
	`ü—‹_çùÜy
(
Œ“
, 
wšdow
, 
™ems_size_
[k],

198 
™ems_
[
k
], 
ROOT_NAMES_
[k]);

199 
»suÉ
->
m’us
[
k
] =

200 
	`gtk_™em_çùÜy_g‘_widg‘
(
»suÉ
->
çùÜ›s
[
k
], 
ROOT_NAMES_
[k]);

201 
	`g_¢´štf
(
BUFF
, 
LEN
, "%s%s", 
ROOT_NAMES_
[
k
], 
SHOW_TYPE_PATH
);

202 
»suÉ
->
show_m’us
[
k
] =

203 
	`gtk_™em_çùÜy_g‘_widg‘
(
»suÉ
->
çùÜ›s
[
k
], 
BUFF
);

205  
»suÉ
;

206 
	}
}

208 
GtkWidg‘
 *

209 
	$dŸg¿m_Œ“_m’us_g‘_m’u
(cÚ¡ 
DŸg¿mT»eM’us
 *
m’us
,

210 
DŸg¿mT»eM’uTy³
 
ty³
)

212 
	`g_»tuº_v®_if_ç
(
m’us
, 
NULL
);

213 
	`g_»tuº_v®_if_ç
(
ty³
 <ğ
DIA_MENU_OBJECT
, 
NULL
);

214  
m’us
->m’us[
ty³
];

215 
	}
}

218 
	$dŸg¿m_Œ“_m’us_pİup_m’u
(cÚ¡ 
DŸg¿mT»eM’us
 *
m’us
,

219 
DŸg¿mT»eM’uTy³
 
ty³
, 
gšt
 
time
)

221 
	`g_»tuº_if_ç
(
m’us
);

222 
	`g_»tuº_if_ç
(
ty³
 <ğ
DIA_MENU_OBJECT
);

223 
	`gtk_m’u_pİup
(
	`GTK_MENU
(
m’us
->m’us[
ty³
]), 
NULL
, NULL, NULL, NULL, 3, 
time
);

224 
	}
}

227 
	s_ShowTy³D©a


229 
DŸg¿mT»eM’us
 *
	mm’us
;

230 
GtkWidg‘
 *
	m™ems
[2];

231 
gch¬
 *
	mty³
;

232 } 
	tShowTy³D©a
;

235 
	$Ú_show_objeù_ty³
(
GtkM’uI‹m
 *
™em
, 
ShowTy³D©a
 *
d©a
)

237 
k
;

238 
	`dŸg¿m_Œ“_unhide_ty³
(
d©a
->
m’us
->
Œ“
, d©a->
ty³
);

239 
k
 = 0; k < 2; ++k) {

240 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
d©a
->
m’us
->
show_m’us
[
k
]),

241 
d©a
->
™ems
[
k
]);

243 
	`g_ä“
(
d©a
->
ty³
);

244 
	`g_ä“
(
d©a
);

245 
	}
}

248 
	$dŸg¿m_Œ“_m’us_add_hidd’_ty³
(
DŸg¿mT»eM’us
 *
m’us
,

249 cÚ¡ 
gch¬
 *
ty³
)

251 
k
;

252 
ShowTy³D©a
 *
d©a
;

253 
	`g_»tuº_if_ç
(
m’us
);

254 
	`g_»tuº_if_ç
(
ty³
);

255 
d©a
 = 
	`g_Ãw
(
ShowTy³D©a
, 1);

256 
d©a
->
ty³
 = 
	`g_¡rdup
(type);

257 
d©a
->
m’us
 = menus;

258 
k
 = 0; k < 2; ++k) {

259 
GtkM’uSh–l
 *
sh–l
 = 
	`GTK_MENU_SHELL
(
m’us
->
show_m’us
[
k
]);

260 
GtkWidg‘
 *
™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
ty³
);

261 
d©a
->
™ems
[
k
] = 
™em
;

262 
	`gtk_m’u_sh–l_­³nd
(
sh–l
, 
™em
);

263 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
™em
),

265 
	`G_CALLBACK
(
Ú_show_objeù_ty³
),

266 (
gpoš‹r
)
d©a
);

267 
	`gtk_widg‘_show
(
™em
);

269 
	}
}

	@O:\tool\dvs50\app\diagram_tree_menu.h

23 #iâdeà
DIAGRAM_TREE_MENU_H


24 
	#DIAGRAM_TREE_MENU_H


	)

26 
	~"dŸg¿m_Œ“.h
"

28 
_DŸg¿mT»eM’us
 
	tDŸg¿mT»eM’us
;

30 
	mDIA_MENU_DIAGRAM
,

31 
	mDIA_MENU_OBJECT


32 } 
	tDŸg¿mT»eM’uTy³
;

34 
DŸg¿mT»eM’us
 *

35 
dŸg¿m_Œ“_m’us_Ãw
(
DŸg¿mT»e
 *
Œ“
, 
GtkWšdow
 *
wšdow
);

38 
GtkWidg‘
 *

39 
dŸg¿m_Œ“_m’us_g‘_m’u
(cÚ¡ 
DŸg¿mT»eM’us
 *
m’us
,

40 
DŸg¿mT»eM’uTy³
 
ty³
);

43 
dŸg¿m_Œ“_m’us_pİup_m’u
(cÚ¡ 
DŸg¿mT»eM’us
 *
m’us
,

44 
DŸg¿mT»eM’uTy³
 
ty³
, 
gšt
 
time
);

48 
dŸg¿m_Œ“_m’us_add_hidd’_ty³
(
DŸg¿mT»eM’us
 *
m’us
,

49 cÚ¡ 
gch¬
 *
ty³
);

52 
dŸg¿m_Œ“_m’us_»move_hidd’_ty³
(
DŸg¿mT»eM’us
 *
m’us
,

53 cÚ¡ 
gch¬
 *
ty³
);

	@O:\tool\dvs50\app\diagram_tree_menu_callbacks.c

23 #ifdeà
HAVE_CONFIG_H


24 
	~<cÚfig.h
>

27 
	~<gtk/gtk.h
>

29 
	~"dŸg¿m_Œ“_m’u_ÿÎbacks.h
"

30 
	~"dŸg¿m_Œ“_m’u.h
"

31 
	~"dŸg¿m_Œ“_wšdow.h
"

32 
	~"´eã»nûs.h
"

35 
	$Ú_loÿ‹_objeù_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

36 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
m’u™em
)

39 
	`dŸg¿m_Œ“_¿i£
((
DŸg¿mT»e
 *)
u£r_d©a
);

40 
	}
}

43 
	$Ú_´İ”t›s_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

44 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
m’u™em
)

46 
	`dŸg¿m_Œ“_show_´İ”t›s
((
DŸg¿mT»e
 *)
u£r_d©a
);

47 
	}
}

50 
	$Ú_sÜt_objeùs_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

51 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
m’u™em
)

53 
	`dŸg¿m_Œ“_sÜt_objeùs
((
DŸg¿mT»e
 *)
u£r_d©a
, 
aùiÚ
);

54 
	}
}

57 
	$Ú_sÜt_®l_objeùs_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

58 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
m’u™em
)

60 
	`dŸg¿m_Œ“_sÜt_®l_objeùs
((
DŸg¿mT»e
 *)
u£r_d©a
, 
aùiÚ
);

61 
	}
}

64 
	$Ú_sÜt_def_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

65 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
)

67 
´efs
.
dŸ_Œ“
.
obj_sÜt
 = 
aùiÚ
;

68 
	`dŸg¿m_Œ“_£t_objeù_sÜt_ty³
((
DŸg¿mT»e
 *)
u£r_d©a
, 
aùiÚ
);

69 
	}
}

72 
	$Ú_d–‘e_objeù_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

73 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
m’u™em
)

76 
	}
}

79 
	$Ú_loÿ‹_dŸ_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

80 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
m’u™em
)

82 
	`dŸg¿m_Œ“_¿i£
((
DŸg¿mT»e
 *)
u£r_d©a
);

83 
	}
}

87 
	$Ú_sÜt_dŸg¿ms_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

88 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
m’u™em
)

90 
	`dŸg¿m_Œ“_sÜt_dŸg¿ms
((
DŸg¿mT»e
 *)
u£r_d©a
, 
aùiÚ
);

91 
	}
}

95 
	$Ú_sÜt_dŸ_def_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

96 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
)

98 
´efs
.
dŸ_Œ“
.
dŸ_sÜt
 = 
aùiÚ
;

99 
	`dŸg¿m_Œ“_£t_dŸg¿m_sÜt_ty³
((
DŸg¿mT»e
 *)
u£r_d©a
, 
aùiÚ
);

100 
	}
}

103 
	$Ú_hide_objeù_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

104 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
m’u™em
)

106 
	`dŸg¿m_Œ“_hide_ty³
((
DŸg¿mT»e
 *)
u£r_d©a
);

107 
	}
}

	@O:\tool\dvs50\app\diagram_tree_menu_callbacks.h

23 #iâdeà
DIAGRAM_TREE_MENU_CALLBACKS_H


24 
	#DIAGRAM_TREE_MENU_CALLBACKS_H


	)

26 
	~<gtk/gtk.h
>

27 
	~"dŸg¿m_Œ“.h
"

30 
Ú_loÿ‹_objeù_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

31 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

34 
Ú_´İ”t›s_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

35 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

38 
Ú_sÜt_objeùs_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

39 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

42 
Ú_sÜt_®l_objeùs_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

43 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

46 
Ú_sÜt_def_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

47 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

50 
Ú_hide_objeù_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

51 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

54 
Ú_d–‘e_objeù_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

55 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

58 
Ú_loÿ‹_dŸ_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

59 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

62 
Ú_sÜt_dŸg¿ms_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

63 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

66 
Ú_sÜt_dŸ_def_aùiv©e
(
gpoš‹r
 
u£r_d©a
,

67 
gušt
 
aùiÚ
, 
GtkM’uI‹m
 *
™em
);

	@O:\tool\dvs50\app\diagram_tree_window.c

23 #ifdeà
HAVE_CONFIG_H


24 
	~<cÚfig.h
>

27 
	~<¡ršg.h
>

29 
	~"š.h
"

30 
	~"´eã»nûs.h
"

31 
	~"dŸg¿m.h
"

32 
	~"dŸg¿m_Œ“.h
"

33 
	~"dŸg¿m_Œ“_wšdow.h
"

34 
	~"dŸg¿m_Œ“_m’u.h
"

35 
	~"³rsi¡’û.h
"

37 
GtkWidg‘
 *
	gdŸgwšdow_
 = 
NULL
;

38 
GtkToggËAùiÚ
 *
	gtoggË_aùiÚ_
 = 
NULL
;

39 
DŸg¿mT»e
 *
	gdŸgŒ“_
 = 
NULL
;

40 
DŸg¿mT»eCÚfig
 *
	gcÚfig_
 = 
NULL
;

44 
	$dŸg¿m_Œ“_wšdow_hide
(
GtkWidg‘
 *
wšdow
)

46 ià(
toggË_aùiÚ_
 &&

47 
	`gtk_toggË_aùiÚ_g‘_aùive
(
toggË_aùiÚ_
)) {

48 
	`gtk_toggË_aùiÚ_£t_aùive
(
toggË_aùiÚ_
, 
FALSE
);

50 
	`gtk_widg‘_hide
(
wšdow
);

51 
	}
}

55 
	$dŸg¿m_Œ“_wšdow_de¡royed
(
GtkWidg‘
 *
wšdow
)

57 
dŸgwšdow_
 = 
NULL
;

58 
	`g_ä“
(
dŸgŒ“_
);

59 
dŸgŒ“_
 = 
NULL
;

61 ià(
toggË_aùiÚ_
 &&

62 
	`gtk_toggË_aùiÚ_g‘_aùive
(
toggË_aùiÚ_
)) {

63 
	`gtk_toggË_aùiÚ_£t_aùive
(
toggË_aùiÚ_
, 
FALSE
);

65 
	}
}

70 
GtkWidg‘
*

71 
	$dŸg¿m_Œ“_wšdow_Ãw
(
DŸg¿mT»eCÚfig
 *
cÚfig
)

73 
GtkWidg‘
 *
wšdow
;

74 
GtkWidg‘
 *
süŞl
;

75 
GtkWidg‘
 *
Œ“
;

78 
wšdow
 = 
	`gtk_wšdow_Ãw
(
GTK_WINDOW_TOPLEVEL
);

80 
	`g_»tuº_v®_if_ç
(
wšdow
, 
NULL
);

82 
	`gtk_wšdow_£t_t™Ë
(
	`GTK_WINDOW
(
wšdow
), 
	`_
("Diagram Tree"));

83 
	`gtk_wšdow_£t_rŞe
(
	`GTK_WINDOW
(
wšdow
), "diagram_tree");

86 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
wšdow
), "destroy",

87 
	`G_CALLBACK
(
dŸg¿m_Œ“_wšdow_de¡royed
), 
NULL
);

89 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
wšdow
), "delete_event",

90 
	`G_CALLBACK
(
dŸg¿m_Œ“_wšdow_hide
), 
NULL
);

93 ià(!
dŸgŒ“_
)

95 
	`³rsi¡’û_»gi¡”_li¡
(
HIDDEN_TYPES_NAME
);

96 ià(!
cÚfig
->
§ve_hidd’
) {

97 
	`³rsi¡’t_li¡_»move_®l
(
HIDDEN_TYPES_NAME
);

99 
dŸgŒ“_
 = 
	`dŸg¿m_Œ“_Ãw
(
	`dŸ_İ’_dŸg¿ms
(), 
	`GTK_WINDOW
(
wšdow
),

100 
cÚfig
->
dŸ_sÜt
, cÚfig->
obj_sÜt
);

101 
	`dŸg¿m_Œ“_upd©e_®l
(
dŸgŒ“_
);

103 
Œ“
 = 
	`dŸg¿m_Œ“_widg‘
(
dŸgŒ“_
);

106 
süŞl
 = 
	`gtk_süŞËd_wšdow_Ãw
(
NULL
, NULL);

107 
	`gtk_süŞËd_wšdow_£t_pŞicy
(
	`GTK_SCROLLED_WINDOW
(
süŞl
),

108 
GTK_POLICY_NEVER
, 
GTK_POLICY_AUTOMATIC
);

109 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
süŞl
), 
Œ“
);

110 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
wšdow
), 
süŞl
);

112 
	`gtk_widg‘_show
(
Œ“
);

113 
	`gtk_widg‘_show
(
süŞl
);

115 
	`³rsi¡’û_»gi¡”_wšdow
(
	`GTK_WINDOW
(
wšdow
));

117  
wšdow
;

118 
	}
}

121 
DŸg¿mT»e
 *

122 
	$dŸg¿m_Œ“
()

124  
dŸgŒ“_
;

125 
	}
}

128 
	$ü—‹_dŸg¿m_Œ“_wšdow
(
DŸg¿mT»eCÚfig
 *
cÚfig
, 
GtkToggËAùiÚ
 *
aùiÚ
)

130 
cÚfig_
 = 
cÚfig
;

131 
toggË_aùiÚ_
 = 
aùiÚ
;

132 ià(!
dŸgwšdow_
) {

133 
dŸgwšdow_
 = 
	`dŸg¿m_Œ“_wšdow_Ãw
(
cÚfig_
);

135 
	`gtk_toggË_aùiÚ_£t_aùive
(
aùiÚ
, 
	`GTK_WIDGET_REALIZED
(
dŸgwšdow_
));

136 
	}
}

140 
	$dŸgŒ“_show_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
, 
gpoš‹r
 
u£r_d©a
)

142 ià(!
dŸgwšdow_
) {

143 
dŸgwšdow_
 = 
	`dŸg¿m_Œ“_wšdow_Ãw
(
cÚfig_
);

145 
GLi¡
 *
İ’
 = 
	`dŸ_İ’_dŸg¿ms
();

146 
İ’
) {

147 
	`dŸg¿m_Œ“_add
(
dŸgŒ“_
, (
DŸg¿m
 *)
İ’
->
d©a
);

148 
İ’
 = 
	`g_li¡_Ãxt
(open);

151 ià(!
toggË_aùiÚ_
ètoggË_aùiÚ_ = 
aùiÚ
;

152 ià(
	`gtk_toggË_aùiÚ_g‘_aùive
 (
toggË_aùiÚ_
))

153 
	`gtk_widg‘_show
(
dŸgwšdow_
);

155 
	`gtk_widg‘_hide
(
dŸgwšdow_
);

156 
	}
}

	@O:\tool\dvs50\app\diagram_tree_window.h

24 #iâdeà
DIAGRAM_TREE_WINDOW_H


25 
	#DIAGRAM_TREE_WINDOW_H


	)

27 
	~<gtk/gtk.h
>

28 
	~"dŸg¿m_Œ“.h
"

31 
_DŸg¿mT»eCÚfig
 
	tDŸg¿mT»eCÚfig
;

33 
	s_DŸg¿mT»eCÚfig
 {

34 
DŸg¿mT»eSÜtTy³
 
	mdŸ_sÜt
;

35 
DŸg¿mT»eSÜtTy³
 
	mobj_sÜt
;

36 
gboŞ—n
 
	m§ve_hidd’
;

40 
DŸg¿mT»e
 *

41 
dŸg¿m_Œ“
();

44 
ü—‹_dŸg¿m_Œ“_wšdow
(
DŸg¿mT»eCÚfig
 *
cÚfig
, 
GtkToggËAùiÚ
 *
aùiÚ
);

49 
dŸgŒ“_show_ÿÎback
 (
GtkToggËAùiÚ
 *
aùiÚ
, 
gpoš‹r
 
u£r_d©a
);

	@O:\tool\dvs50\app\diagrid.h

1 #iâdeà
DIA_GRID_H


2 
	#DIA_GRID_H


	)

4 
_DŸGrid
 
	tDŸGrid
;

6 
	s_DŸGrid
 {

8 
»®
 
	mwidth_x
, 
	mwidth_y
, 
	mwidth_w
;

10 
gušt
 
	mvisibË_x
, 
	mvisibË_y
;

15 
gušt
 
	mmajÜ_lšes
;

19 
gboŞ—n
 
	mdyÇmic
;

22 
CŞÜ
 
	mcŞour
;

24 
gboŞ—n
 
	mhex
;

26 
»®
 
	mhex_size
;

	@O:\tool\dvs50\app\diapagelayout.c

24 #ifdeà
HAVE_CONFIG_H


25 
	~<cÚfig.h
>

28 #undeà
GTK_DISABLE_DEPRECATED


29 
	~"dŸ·g–ayout.h
"

30 
	~"widg‘s.h
"

32 
	~"š.h
"

34 
	~"pixm­s/pÜŒa™.xpm
"

35 
	~"pixm­s/Ïndsÿ³.xpm
"

37 
	~"´eã»nûs.h
"

38 
	~"·³r.h
"

39 
	~"´efs.h
"

42 
	#DIA_PAGE_LAYOUT_CLASS
(
kÏss
è
	`GTK_CHECK_CLASS_CAST
(kÏss, 
	`dŸ_·ge_Ïyout_g‘_ty³
(), 
DŸPageLayoutCÏss
)

	)

43 
	#DIA_IS_PAGE_LAYOUT
(
obj
è
	`GTK_CHECK_TYPE
(obj, 
	`dŸ_·ge_Ïyout_g‘_ty³
())

	)

45 
_DŸPageLayoutCÏss
 
	tDŸPageLayoutCÏss
;

47 
	s_DŸPageLayout
 {

48 
GtkTabË
 
	m·»Á
;

51 
GtkWidg‘
 *
	m·³r_size
, *
	m·³r_Ïb–
;

52 
GtkWidg‘
 *
	mÜ›Á_pÜŒa™
, *
	mÜ›Á_Ïndsÿ³
;

53 
GtkWidg‘
 *
	mtm¬gš
, *
	mbm¬gš
, *
	mlm¬gš
, *
	mrm¬gš
;

54 
GtkWidg‘
 *
	msÿË
, *
	mf™to
;

55 
GtkWidg‘
 *
	msÿlšg
, *
	mf™w
, *
	mf™h
;

57 
GtkWidg‘
 *
	md¬—
;

59 
GdkGC
 *
	mgc
;

60 
GdkCŞÜ
 
	mwh™e
, 
	mbÏck
, 
	mblue
;

61 
gšt
 
	m·³ºum
;

64 
gšt
 
	mx
, 
	my
, 
	mwidth
, 
	mheight
;

66 
gboŞ—n
 
	mblock_chªged
;

69 
	s_DŸPageLayoutCÏss
 {

70 
GtkTabËCÏss
 
	m·»Á_şass
;

72 (*
	mchªged
)(
DŸPageLayout
 *
	m¶
);

77 
	mCHANGED
,

78 
	mLAST_SIGNAL


81 
gušt
 
	g¶_sigÇls
[
LAST_SIGNAL
] = { 0 };

82 
GtkObjeùCÏss
 *
	g·»Á_şass
;

84 
dŸ_·ge_Ïyout_şass_š™
(
DŸPageLayoutCÏss
 *
şass
);

85 
dŸ_·ge_Ïyout_š™
(
DŸPageLayout
 *
£lf
);

86 
dŸ_·ge_Ïyout_de¡roy
(
GtkObjeù
 *
objeù
);

88 
GtkTy³


89 
	$dŸ_·ge_Ïyout_g‘_ty³
()

91 
GtkTy³
 
¶_ty³
 = 0;

93 ià(!
¶_ty³
) {

94 cÚ¡ 
GtkTy³Info
 
¶_šfo
 = {

96 (
DŸPageLayout
),

97 (
DŸPageLayoutCÏss
),

98 (
GtkCÏssIn™Func
è
dŸ_·ge_Ïyout_şass_š™
,

99 (
GtkObjeùIn™Func
è
dŸ_·ge_Ïyout_š™
,

100 
NULL
,

101 
NULL
,

102 (
GtkCÏssIn™Func
è
NULL
,

104 
¶_ty³
 = 
	`gtk_ty³_unique
(
	`gtk_bË_g‘_ty³
(), &
¶_šfo
);

106  
¶_ty³
;

107 
	}
}

110 
	$dŸ_·ge_Ïyout_şass_š™
(
DŸPageLayoutCÏss
 *
şass
)

112 
GtkObjeùCÏss
 *
objeù_şass
;

114 
objeù_şass
 = (
GtkObjeùCÏss
*è
şass
;

115 
·»Á_şass
 = 
	`gtk_ty³_şass
(
	`gtk_bË_g‘_ty³
());

117 
¶_sigÇls
[
CHANGED
] =

118 
	`gtk_sigÇl_Ãw
("changed",

119 
GTK_RUN_FIRST
,

120 
	`GTK_CLASS_TYPE
 (
objeù_şass
),

121 
	`GTK_SIGNAL_OFFSET
(
DŸPageLayoutCÏss
, 
chªged
),

122 
gtk_sigÇl_deçuÉ_m¬sh®Ër
,

123 
GTK_TYPE_NONE
, 0);

125 
	`gtk_objeù_şass_add_sigÇls
(
objeù_şass
, 
¶_sigÇls
, 
LAST_SIGNAL
);

128 
objeù_şass
->
de¡roy
 = 
dŸ_·ge_Ïyout_de¡roy
;

129 
	}
}

131 
d¬—_size_®loÿ‹
(
DŸPageLayout
 *
£lf
, 
GtkAÎoÿtiÚ
 *
®loc
);

132 
gšt
 
d¬—_expo£_ev’t
(
DŸPageLayout
 *
£lf
, 
GdkEv’tExpo£
 *
ev
);

133 
·³r_size_chªge
(
GtkM’uI‹m
 *
™em
, 
DŸPageLayout
 *
£lf
);

134 
Ü›Á_chªged
(
DŸPageLayout
 *
£lf
);

135 
m¬gš_chªged
(
DŸPageLayout
 *
£lf
);

136 
sÿËmode_chªged
(
DŸPageLayout
 *
£lf
);

137 
sÿË_chªged
(
DŸPageLayout
 *
£lf
);

140 
	$dŸ_·ge_Ïyout_š™
(
DŸPageLayout
 *
£lf
)

142 
GtkWidg‘
 *
äame
, *
box
, *
bË
, *
m’u
, *
m’u™em
, *
wid
;

143 
GdkPixm­
 *
pix
;

144 
GdkB™m­
 *
mask
;

145 
GLi¡
 *
·³r_Çmes
;

146 
gšt
 
i
;

148 
	`gtk_bË_»size
(
	`GTK_TABLE
(
£lf
), 3, 2);

149 
	`gtk_bË_£t_row_¥acšgs
(
	`GTK_TABLE
(
£lf
), 5);

150 
	`gtk_bË_£t_cŞ_¥acšgs
(
	`GTK_TABLE
(
£lf
), 5);

153 
äame
 = 
	`gtk_äame_Ãw
(
	`_
("Paper Size"));

154 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
£lf
), 
äame
, 0,1, 0,1,

155 
GTK_FILL
, GTK_FILL, 0, 0);

156 
	`gtk_widg‘_show
(
äame
);

158 
box
 = 
	`gtk_vbox_Ãw
(
FALSE
, 5);

159 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
box
), 5);

160 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
äame
), 
box
);

161 
	`gtk_widg‘_show
(
box
);

163 
£lf
->
·³r_size
 = 
	`gtk_İtiÚ_m’u_Ãw
();

164 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
box
), 
£lf
->
·³r_size
, 
TRUE
, 
FALSE
, 0);

166 
m’u
 = 
	`gtk_m’u_Ãw
();

168 
·³r_Çmes
 = 
	`g‘_·³r_Çme_li¡
();

169 
i
 = 0; 
·³r_Çmes
 !ğ
NULL
;

170 
i
++, 
·³r_Çmes
 = 
	`g_li¡_Ãxt
(paper_names)) {

171 
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
·³r_Çmes
->
d©a
);

172 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
m’u™em
), "u£r_d©a", 
	`GINT_TO_POINTER
(
i
));

173 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
m’u™em
), "activate",

174 
	`G_CALLBACK
(
·³r_size_chªge
), 
£lf
);

175 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
m’u
), 
m’u™em
);

176 
	`gtk_widg‘_show
(
m’u™em
);

178 
	`gtk_İtiÚ_m’u_£t_m’u
(
	`GTK_OPTION_MENU
(
£lf
->
·³r_size
), 
m’u
);

179 
	`gtk_widg‘_show
(
£lf
->
·³r_size
);

181 
£lf
->
·³r_Ïb–
 = 
	`gtk_Ïb–_Ãw
("");

182 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
box
), 
£lf
->
·³r_Ïb–
, 
TRUE
, TRUE, 0);

183 
	`gtk_widg‘_show
(
£lf
->
·³r_Ïb–
);

186 
äame
 = 
	`gtk_äame_Ãw
(
	`_
("Orientation"));

187 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
£lf
), 
äame
, 1,2, 0,1,

188 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL, 0, 0);

189 
	`gtk_widg‘_show
(
äame
);

191 
box
 = 
	`gtk_hbox_Ãw
(
FALSE
, 5);

192 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
box
), 5);

193 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
äame
), 
box
);

194 
	`gtk_widg‘_show
(
box
);

196 
£lf
->
Ü›Á_pÜŒa™
 = 
	`gtk_¿dio_bu‰Ú_Ãw
(
NULL
);

197 
pix
 = 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

198 
	`gtk_widg‘_g‘_cŞÜm­
(
	`GTK_WIDGET
(
£lf
)), &
mask
, 
NULL
,

199 
pÜŒa™_xpm
);

200 
wid
 = 
	`gtk_pixm­_Ãw
(
pix
, 
mask
);

201 
	`gdk_pixm­_uÄef
(
pix
);

202 
	`gdk_b™m­_uÄef
(
mask
);

203 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
£lf
->
Ü›Á_pÜŒa™
), 
wid
);

204 
	`gtk_widg‘_show
(
wid
);

206 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
box
), 
£lf
->
Ü›Á_pÜŒa™
, 
TRUE
, TRUE, 0);

207 
	`gtk_widg‘_show
(
£lf
->
Ü›Á_pÜŒa™
);

209 
£lf
->
Ü›Á_Ïndsÿ³
 = 
	`gtk_¿dio_bu‰Ú_Ãw
(

210 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(
£lf
->
Ü›Á_pÜŒa™
)));

211 
pix
 = 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

212 
	`gtk_widg‘_g‘_cŞÜm­
(
	`GTK_WIDGET
(
£lf
)), &
mask
, 
NULL
,

213 
Ïndsÿ³_xpm
);

214 
wid
 = 
	`gtk_pixm­_Ãw
(
pix
, 
mask
);

215 
	`gdk_pixm­_uÄef
(
pix
);

216 
	`gdk_b™m­_uÄef
(
mask
);

217 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
£lf
->
Ü›Á_Ïndsÿ³
), 
wid
);

218 
	`gtk_widg‘_show
(
wid
);

220 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
box
), 
£lf
->
Ü›Á_Ïndsÿ³
, 
TRUE
, TRUE, 0);

221 
	`gtk_widg‘_show
(
£lf
->
Ü›Á_Ïndsÿ³
);

224 
äame
 = 
	`gtk_äame_Ãw
(
	`_
("Margins"));

225 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
£lf
), 
äame
, 0,1, 1,2,

226 
GTK_FILL
, GTK_FILL, 0, 0);

227 
	`gtk_widg‘_show
(
äame
);

229 
bË
 = 
	`gtk_bË_Ãw
(4, 2, 
FALSE
);

230 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
bË
), 5);

231 
	`gtk_bË_£t_row_¥acšgs
(
	`GTK_TABLE
(
bË
), 5);

232 
	`gtk_bË_£t_cŞ_¥acšgs
(
	`GTK_TABLE
(
bË
), 5);

233 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
äame
), 
bË
);

234 
	`gtk_widg‘_show
(
bË
);

236 
wid
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Top:"));

237 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
wid
), 1.0, 0.5);

238 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
wid
, 0,1, 0,1,

239 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

240 
	`gtk_widg‘_show
(
wid
);

242 
£lf
->
tm¬gš
 = 
	`dŸ_un™_¥šÃr_Ãw
(

243 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1, 0,100, 0.1,10,0)),

244 
	`´efs_g‘_Ëngth_un™
());

245 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
£lf
->
tm¬gš
, 1,2, 0,1,

246 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

247 
	`gtk_widg‘_show
(
£lf
->
tm¬gš
);

249 
wid
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Bottom:"));

250 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
wid
), 1.0, 0.5);

251 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
wid
, 0,1, 1,2,

252 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

253 
	`gtk_widg‘_show
(
wid
);

255 
£lf
->
bm¬gš
 = 
	`dŸ_un™_¥šÃr_Ãw
(

256 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1, 0,100, 0.1,10,0)),

257 
	`´efs_g‘_Ëngth_un™
());

258 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
£lf
->
bm¬gš
, 1,2, 1,2,

259 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

260 
	`gtk_widg‘_show
(
£lf
->
bm¬gš
);

262 
wid
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Left:"));

263 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
wid
), 1.0, 0.5);

264 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
wid
, 0,1, 2,3,

265 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

266 
	`gtk_widg‘_show
(
wid
);

268 
£lf
->
lm¬gš
 = 
	`dŸ_un™_¥šÃr_Ãw
(

269 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1, 0,100, 0.1,10,0)),

270 
	`´efs_g‘_Ëngth_un™
());

271 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
£lf
->
lm¬gš
, 1,2, 2,3,

272 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

273 
	`gtk_widg‘_show
(
£lf
->
lm¬gš
);

275 
wid
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Right:"));

276 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
wid
), 1.0, 0.5);

277 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
wid
, 0,1, 3,4,

278 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

279 
	`gtk_widg‘_show
(
wid
);

281 
£lf
->
rm¬gš
 = 
	`dŸ_un™_¥šÃr_Ãw
(

282 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1, 0,100, 0.1,10,0)),

283 
	`´efs_g‘_Ëngth_un™
());

284 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
£lf
->
rm¬gš
, 1,2, 3,4,

285 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

286 
	`gtk_widg‘_show
(
£lf
->
rm¬gš
);

289 
äame
 = 
	`gtk_äame_Ãw
(
	`_
("Scaling"));

290 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
£lf
), 
äame
, 0,1, 2,3,

291 
GTK_FILL
, GTK_FILL, 0, 0);

292 
	`gtk_widg‘_show
(
äame
);

294 
bË
 = 
	`gtk_bË_Ãw
(2, 4, 
FALSE
);

295 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
bË
), 5);

296 
	`gtk_bË_£t_row_¥acšgs
(
	`GTK_TABLE
(
bË
), 5);

297 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
äame
), 
bË
);

298 
	`gtk_widg‘_show
(
bË
);

300 
£lf
->
sÿË
 = 
	`gtk_¿dio_bu‰Ú_Ãw_w™h_Ïb–
(
NULL
, 
	`_
("Scale:"));

301 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
£lf
->
sÿË
, 0,1, 0,1,

302 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

303 
	`gtk_widg‘_show
(
£lf
->
sÿË
);

305 
£lf
->
sÿlšg
 = 
	`gtk_¥š_bu‰Ú_Ãw
(

306 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(100,1,10000, 1,10,0)), 1, 0);

307 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
£lf
->
sÿlšg
, 1,4, 0,1,

308 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

309 
	`gtk_widg‘_show
(
£lf
->
sÿlšg
);

311 
£lf
->
f™to
 = 
	`gtk_¿dio_bu‰Ú_Ãw_w™h_Ïb–
(

312 
	`GTK_RADIO_BUTTON
(
£lf
->
sÿË
)->
group
, 
	`_
("Fito:"));

313 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
£lf
->
f™to
, 0,1, 1,2,

314 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

315 
	`gtk_widg‘_show
(
£lf
->
f™to
);

317 
£lf
->
f™w
 = 
	`gtk_¥š_bu‰Ú_Ãw
(

318 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1, 1, 1000, 1, 10, 0)), 1, 0);

319 
	`gtk_widg‘_£t_£ns™ive
(
£lf
->
f™w
, 
FALSE
);

320 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
£lf
->
f™w
, 1,2, 1,2,

321 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

322 
	`gtk_widg‘_show
(
£lf
->
f™w
);

324 
wid
 = 
	`gtk_Ïb–_Ãw
(
	`_
("by"));

325 
	`gtk_misc_£t_·ddšg
(
	`GTK_MISC
(
wid
), 5, 0);

326 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
wid
, 2,3, 1,2,

327 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
, 0, 0);

328 
	`gtk_widg‘_show
(
wid
);

330 
£lf
->
f™h
 = 
	`gtk_¥š_bu‰Ú_Ãw
(

331 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1, 1, 1000, 1, 10, 0)), 1, 0);

332 
	`gtk_widg‘_£t_£ns™ive
(
£lf
->
f™h
, 
FALSE
);

333 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
bË
), 
£lf
->
f™h
, 3,4, 1,2,

334 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

335 
	`gtk_widg‘_show
(
£lf
->
f™h
);

338 
£lf
->
d¬—
 = 
	`gtk_d¿wšg_¬—_Ãw
();

339 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
£lf
), s–f->
d¬—
, 1,2, 1,3,

340 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND, 0, 0);

341 
	`gtk_widg‘_show
(
£lf
->
d¬—
);

344 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
Ü›Á_pÜŒa™
), "toggled",

345 
	`G_CALLBACK
(
Ü›Á_chªged
), 
	`GTK_OBJECT
(
£lf
));

347 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
tm¬gš
), "changed",

348 
	`G_CALLBACK
(
m¬gš_chªged
), 
	`GTK_OBJECT
(
£lf
));

349 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
bm¬gš
), "changed",

350 
	`G_CALLBACK
(
m¬gš_chªged
), 
	`GTK_OBJECT
(
£lf
));

351 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
lm¬gš
), "changed",

352 
	`G_CALLBACK
(
m¬gš_chªged
), 
	`GTK_OBJECT
(
£lf
));

353 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
rm¬gš
), "changed",

354 
	`G_CALLBACK
(
m¬gš_chªged
), 
	`GTK_OBJECT
(
£lf
));

356 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
f™to
), "toggled",

357 
	`G_CALLBACK
(
sÿËmode_chªged
),

358 
	`GTK_OBJECT
(
£lf
));

359 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
sÿlšg
), "changed",

360 
	`G_CALLBACK
(
sÿË_chªged
), 
	`GTK_OBJECT
(
£lf
));

361 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
f™w
), "changed",

362 
	`G_CALLBACK
(
sÿË_chªged
), 
	`GTK_OBJECT
(
£lf
));

363 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
f™h
), "changed",

364 
	`G_CALLBACK
(
sÿË_chªged
), 
	`GTK_OBJECT
(
£lf
));

366 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
d¬—
), "size_allocate",

367 
	`G_CALLBACK
(
d¬—_size_®loÿ‹
),

368 
	`GTK_OBJECT
(
£lf
));

369 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
(
£lf
->
d¬—
), "expose_event",

370 
	`G_CALLBACK
(
d¬—_expo£_ev’t
),

371 
	`GTK_OBJECT
(
£lf
));

373 
	`gdk_cŞÜ_wh™e
(
	`gtk_widg‘_g‘_cŞÜm­
(
	`GTK_WIDGET
(
£lf
)), &£lf->
wh™e
);

374 
	`gdk_cŞÜ_bÏck
(
	`gtk_widg‘_g‘_cŞÜm­
(
	`GTK_WIDGET
(
£lf
)), &£lf->
bÏck
);

375 
£lf
->
blue
.
»d
 = 0;

376 
£lf
->
blue
.
g»’
 = 0;

377 
£lf
->
blue
.blue = 0x7fff;

378 
	`gdk_cŞÜ_®loc
(
	`gtk_widg‘_g‘_cŞÜm­
(
	`GTK_WIDGET
(
£lf
)), &£lf->
blue
);

380 
£lf
->
gc
 = 
NULL
;

381 
£lf
->
block_chªged
 = 
FALSE
;

382 
	}
}

384 
GtkWidg‘
 *

385 
	$dŸ_·ge_Ïyout_Ãw
()

387 
DŸPageLayout
 *
£lf
 = 
	`gtk_ty³_Ãw
(
	`dŸ_·ge_Ïyout_g‘_ty³
());

389 
	`dŸ_·ge_Ïyout_£t_·³r
(
£lf
, "");

390  
	`GTK_WIDGET
(
£lf
);

391 
	}
}

393 cÚ¡ 
gch¬
 *

394 
	$dŸ_·ge_Ïyout_g‘_·³r
(
DŸPageLayout
 *
£lf
)

396  
	`g‘_·³r_Çme
(
£lf
->
·³ºum
);

397 
	}
}

400 
	$dŸ_·ge_Ïyout_£t_·³r
(
DŸPageLayout
 *
£lf
, cÚ¡ 
gch¬
 *
·³r
)

402 
gšt
 
i
;

404 
i
 = 
	`fšd_·³r
(
·³r
);

405 ià(
i
 == -1)

406 
i
 = 
	`fšd_·³r
(
´efs
.
Ãw_dŸg¿m
.
·³¹y³
);

407 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
(
	`GTK_OPTION_MENU
(
£lf
->
·³r_size
), 
i
);

408 
	`gtk_m’u_™em_aùiv©e
(

409 
	`GTK_MENU_ITEM
(
	`GTK_OPTION_MENU
(
£lf
->
·³r_size
)->
m’u_™em
));

410 
	}
}

413 
	$dŸ_·ge_Ïyout_g‘_m¬gšs
(
DŸPageLayout
 *
£lf
,

414 
gæßt
 *
tm¬gš
, gæßˆ*
bm¬gš
,

415 
gæßt
 *
lm¬gš
, gæßˆ*
rm¬gš
)

417 ià(
tm¬gš
)

418 *
tm¬gš
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->tmargin));

419 ià(
bm¬gš
)

420 *
bm¬gš
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->bmargin));

421 ià(
lm¬gš
)

422 *
lm¬gš
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->lmargin));

423 ià(
rm¬gš
)

424 *
rm¬gš
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->rmargin));

425 
	}
}

428 
	$dŸ_·ge_Ïyout_£t_m¬gšs
(
DŸPageLayout
 *
£lf
,

429 
gæßt
 
tm¬gš
, gæßˆ
bm¬gš
,

430 
gæßt
 
lm¬gš
, gæßˆ
rm¬gš
)

432 
£lf
->
block_chªged
 = 
TRUE
;

433 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¬gš
),margin);

434 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¬gš
), bmargin);

435 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¬gš
),†margin);

436 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¬gš
),„margin);

437 
£lf
->
block_chªged
 = 
FALSE
;

439 
	`gtk_sigÇl_em™
(
	`GTK_OBJECT
(
£lf
), 
¶_sigÇls
[
CHANGED
]);

440 
	}
}

442 
DŸPageOr›Á©iÚ


443 
	$dŸ_·ge_Ïyout_g‘_Ü›Á©iÚ
(
DŸPageLayout
 *
£lf
)

445 ià(
	`GTK_TOGGLE_BUTTON
(
£lf
->
Ü›Á_pÜŒa™
)->
aùive
)

446  
DIA_PAGE_ORIENT_PORTRAIT
;

448  
DIA_PAGE_ORIENT_LANDSCAPE
;

449 
	}
}

452 
	$dŸ_·ge_Ïyout_£t_Ü›Á©iÚ
(
DŸPageLayout
 *
£lf
,

453 
DŸPageOr›Á©iÚ
 
Ü›Á
)

455 
Ü›Á
) {

456 
DIA_PAGE_ORIENT_PORTRAIT
:

457 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
£lf
->
Ü›Á_pÜŒa™
),

458 
TRUE
);

460 
DIA_PAGE_ORIENT_LANDSCAPE
:

461 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
£lf
->
Ü›Á_Ïndsÿ³
),

462 
TRUE
);

465 
	}
}

467 
gboŞ—n


468 
	$dŸ_·ge_Ïyout_g‘_f™to
(
DŸPageLayout
 *
£lf
)

470  
	`GTK_TOGGLE_BUTTON
(
£lf
->
f™to
)->
aùive
;

471 
	}
}

474 
	$dŸ_·ge_Ïyout_£t_f™to
(
DŸPageLayout
 *
£lf
, 
gboŞ—n
 
f™to
)

476 ià(
f™to
)

477 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
£lf
->
f™to
), 
TRUE
);

479 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
£lf
->
sÿË
), 
TRUE
);

480 
	}
}

482 
gæßt


483 
	$dŸ_·ge_Ïyout_g‘_sÿlšg
(
DŸPageLayout
 *
£lf
)

485  
	`GTK_SPIN_BUTTON
(
£lf
->
sÿlšg
)->
adju¡m’t
->
v®ue
 / 100.0;

486 
	}
}

489 
	$dŸ_·ge_Ïyout_£t_sÿlšg
(
DŸPageLayout
 *
£lf
, 
gæßt
 
sÿlšg
)

491 
	`GTK_SPIN_BUTTON
(
£lf
->
sÿlšg
)->
adju¡m’t
->
v®ue
 = scaling * 100.0;

492 
	`gtk_adju¡m’t_v®ue_chªged
(
	`GTK_SPIN_BUTTON
(
£lf
->
sÿlšg
)->
adju¡m’t
);

493 
	}
}

496 
	$dŸ_·ge_Ïyout_£t_chªged
 (
DŸPageLayout
 *
£lf
, 
gboŞ—n
 
chªged
)

498 
£lf
->
block_chªged
 = 
chªged
;

499 
	}
}

502 
	$dŸ_·ge_Ïyout_g‘_f™_dims
(
DŸPageLayout
 *
£lf
, 
gšt
 *
w
, gšˆ*
h
)

504 ià(
w
)

505 *
w
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
	`GTK_SPIN_BUTTON
(
£lf
->
f™w
));

506 ià(
h
)

507 *
h
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
	`GTK_SPIN_BUTTON
(
£lf
->
f™h
));

508 
	}
}

511 
	$dŸ_·ge_Ïyout_£t_f™_dims
(
DŸPageLayout
 *
£lf
, 
gšt
 
w
, gšˆ
h
)

513 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
£lf
->
f™w
), 
w
);

514 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
£lf
->
f™h
), 
h
);

515 
	}
}

518 
	$dŸ_·ge_Ïyout_g‘_efãùive_¬—
(
DŸPageLayout
 *
£lf
, 
gæßt
 *
width
,

519 
gæßt
 *
height
)

521 
gæßt
 
h
, 
w
, 
sÿlšg
;

523 ià(
	`GTK_TOGGLE_BUTTON
(
£lf
->
Ü›Á_pÜŒa™
)->
aùive
) {

524 
w
 = 
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
);

525 
h
 = 
	`g‘_·³r_psheight
(
£lf
->
·³ºum
);

527 
h
 = 
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
);

528 
w
 = 
	`g‘_·³r_psheight
(
£lf
->
·³ºum
);

530 
h
 -ğ
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¬gš
));

531 
	`g_»tuº_if_ç
 (
h
 > 0.0);

532 
h
 -ğ
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¬gš
));

533 
	`g_»tuº_if_ç
 (
h
 > 0.0);

534 
w
 -ğ
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¬gš
));

535 
	`g_»tuº_if_ç
 (
w
 > 0.0);

536 
w
 -ğ
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¬gš
));

537 
	`g_»tuº_if_ç
 (
w
 > 0.0);

538 
sÿlšg
 = 
	`GTK_SPIN_BUTTON
(
£lf
->sÿlšg)->
adju¡m’t
->
v®ue
 / 100.0;

539 
h
 /ğ
sÿlšg
;

540 
w
 /ğ
sÿlšg
;

542 ià(
width
è*width = 
w
;

543 ià(
height
è*heighˆğ
h
;

544 
	}
}

547 
	$dŸ_·ge_Ïyout_g‘_·³r_size
(cÚ¡ 
gch¬
 *
·³r
,

548 
gæßt
 *
width
, gæßˆ*
height
)

550 
gšt
 
i
;

552 
i
 = 
	`fšd_·³r
(
·³r
);

553 ià(
i
 == -1)

554 
i
 = 
	`fšd_·³r
(
´efs
.
Ãw_dŸg¿m
.
·³¹y³
);

555 ià(
width
)

556 *
width
 = 
	`g‘_·³r_pswidth
(
i
);

557 ià(
height
)

558 *
height
 = 
	`g‘_·³r_psheight
(
i
);

559 
	}
}

562 
	$dŸ_·ge_Ïyout_g‘_deçuÉ_m¬gšs
(cÚ¡ 
gch¬
 *
·³r
,

563 
gæßt
 *
tm¬gš
, gæßˆ*
bm¬gš
,

564 
gæßt
 *
lm¬gš
, gæßˆ*
rm¬gš
)

566 
gšt
 
i
;

568 
i
 = 
	`fšd_·³r
(
·³r
);

569 ià(
i
 == -1)

570 
i
 = 
	`fšd_·³r
(
´efs
.
Ãw_dŸg¿m
.
·³¹y³
);

571 ià(
tm¬gš
)

572 *
tm¬gš
 = 
	`g‘_·³r_tm¬gš
(
i
);

573 ià(
bm¬gš
)

574 *
bm¬gš
 = 
	`g‘_·³r_bm¬gš
(
i
);

575 ià(
lm¬gš
)

576 *
lm¬gš
 = 
	`g‘_·³r_lm¬gš
(
i
);

577 ià(
rm¬gš
)

578 *
rm¬gš
 = 
	`g‘_·³r_rm¬gš
(
i
);

579 
	}
}

582 
	$size_·ge
(
DŸPageLayout
 *
£lf
, 
GtkAÎoÿtiÚ
 *
a
)

584 
£lf
->
width
 = 
a
->width - 3;

585 
£lf
->
height
 = 
a
->height - 3;

588 ià(
	`GTK_TOGGLE_BUTTON
(
£lf
->
Ü›Á_pÜŒa™
)->
aùive
) {

589 ià(
£lf
->
width
 * 
	`g‘_·³r_psheight
(£lf->
·³ºum
) >

590 
£lf
->
height
 * 
	`g‘_·³r_pswidth
(£lf->
·³ºum
))

591 
£lf
->
width
 = s–f->
height
 * 
	`g‘_·³r_pswidth
(£lf->
·³ºum
) /

592 
	`g‘_·³r_psheight
(
£lf
->
·³ºum
);

594 
£lf
->
height
 = s–f->
width
 * 
	`g‘_·³r_psheight
(£lf->
·³ºum
) /

595 
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
);

597 ià(
£lf
->
width
 * 
	`g‘_·³r_pswidth
(£lf->
·³ºum
) >

598 
£lf
->
height
 * 
	`g‘_·³r_psheight
(£lf->
·³ºum
))

599 
£lf
->
width
 = s–f->
height
 * 
	`g‘_·³r_psheight
(£lf->
·³ºum
) /

600 
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
);

602 
£lf
->
height
 = s–f->
width
 * 
	`g‘_·³r_pswidth
(£lf->
·³ºum
) /

603 
	`g‘_·³r_psheight
(
£lf
->
·³ºum
);

606 
£lf
->
x
 = (
a
->
width
 - self->width - 3) / 2;

607 
£lf
->
y
 = (
a
->
height
 - self->height - 3) / 2;

608 
	}
}

611 
	$d¬—_size_®loÿ‹
(
DŸPageLayout
 *
£lf
, 
GtkAÎoÿtiÚ
 *
®loÿtiÚ
)

613 
	`size_·ge
(
£lf
, 
®loÿtiÚ
);

614 
	}
}

616 
gšt


617 
	$d¬—_expo£_ev’t
(
DŸPageLayout
 *
£lf
, 
GdkEv’tExpo£
 *
ev’t
)

619 
GdkWšdow
 *
wšdow
ğ
£lf
->
d¬—
->window;

620 
gæßt
 
v®
;

621 
gšt
 
num
;

623 ià(!
wšdow
)

624  
FALSE
;

626 ià(!
£lf
->
gc
)

627 
£lf
->
gc
 = 
	`gdk_gc_Ãw
(
wšdow
);

629 
	`gdk_wšdow_ş—r_¬—
 (
wšdow
,

631 
£lf
->
d¬—
->
®loÿtiÚ
.
width
,

632 
£lf
->
d¬—
->
®loÿtiÚ
.
height
);

635 
	`gdk_gc_£t_fÜeground
(
£lf
->
gc
, &£lf->
bÏck
);

636 
	`gdk_d¿w_»ùªgË
(
wšdow
, 
£lf
->
gc
, 
TRUE
, s–f->
x
+3, s–f->
y
+3,

637 
£lf
->
width
, s–f->
height
);

638 
	`gdk_gc_£t_fÜeground
(
£lf
->
gc
, &£lf->
wh™e
);

639 
	`gdk_d¿w_»ùªgË
(
wšdow
, 
£lf
->
gc
, 
TRUE
, s–f->
x
, s–f->
y
,

640 
£lf
->
width
, s–f->
height
);

641 
	`gdk_gc_£t_fÜeground
(
£lf
->
gc
, &£lf->
bÏck
);

642 
	`gdk_d¿w_»ùªgË
(
wšdow
, 
£lf
->
gc
, 
FALSE
, s–f->
x
, s–f->
y
,

643 
£lf
->
width
-1, s–f->
height
-1);

645 
	`gdk_gc_£t_fÜeground
(
£lf
->
gc
, &£lf->
blue
);

648 ià(
	`GTK_TOGGLE_BUTTON
(
£lf
->
Ü›Á_pÜŒa™
)->
aùive
) {

649 
v®
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¬gš
));

650 
num
 = 
£lf
->
y
 + 
v®
 * s–f->
height
 /
	`g‘_·³r_psheight
(£lf->
·³ºum
);

651 
	`gdk_d¿w_lše
(
wšdow
, 
£lf
->
gc
, s–f->
x
+1, 
num
, s–f->x+£lf->
width
-2,num);

653 
v®
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¬gš
));

654 
num
 = 
£lf
->
y
 + s–f->
height
 -

655 
v®
 * 
£lf
->
height
 / 
	`g‘_·³r_psheight
(£lf->
·³ºum
);

656 
	`gdk_d¿w_lše
(
wšdow
, 
£lf
->
gc
, s–f->
x
+1, 
num
, s–f->x+£lf->
width
-2,num);

658 
v®
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¬gš
));

659 
num
 = 
£lf
->
x
 + 
v®
 * s–f->
width
 / 
	`g‘_·³r_pswidth
(£lf->
·³ºum
);

660 
	`gdk_d¿w_lše
(
wšdow
, 
£lf
->
gc
, 
num
, s–f->
y
+1,num,£lf->y+£lf->
height
-2);

662 
v®
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¬gš
));

663 
num
 = 
£lf
->
x
 + s–f->
width
 -

664 
v®
 * 
£lf
->
width
 / 
	`g‘_·³r_pswidth
(£lf->
·³ºum
);

665 
	`gdk_d¿w_lše
(
wšdow
, 
£lf
->
gc
, 
num
, s–f->
y
+1,num,£lf->y+£lf->
height
-2);

667 
v®
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¬gš
));

668 
num
 = 
£lf
->
y
 + 
v®
 * s–f->
height
 /
	`g‘_·³r_pswidth
(£lf->
·³ºum
);

669 
	`gdk_d¿w_lše
(
wšdow
, 
£lf
->
gc
, s–f->
x
+1, 
num
, s–f->x+£lf->
width
-2,num);

671 
v®
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¬gš
));

672 
num
 = 
£lf
->
y
 + s–f->
height
 -

673 
v®
 * 
£lf
->
height
 / 
	`g‘_·³r_pswidth
(£lf->
·³ºum
);

674 
	`gdk_d¿w_lše
(
wšdow
, 
£lf
->
gc
, s–f->
x
+1, 
num
, s–f->x+£lf->
width
-2,num);

676 
v®
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¬gš
));

677 
num
 = 
£lf
->
x
 + 
v®
 * s–f->
width
 / 
	`g‘_·³r_psheight
(£lf->
·³ºum
);

678 
	`gdk_d¿w_lše
(
wšdow
, 
£lf
->
gc
, 
num
, s–f->
y
+1,num,£lf->y+£lf->
height
-2);

680 
v®
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¬gš
));

681 
num
 = 
£lf
->
x
 + s–f->
width
 -

682 
v®
 * 
£lf
->
width
 / 
	`g‘_·³r_psheight
(£lf->
·³ºum
);

683 
	`gdk_d¿w_lše
(
wšdow
, 
£lf
->
gc
, 
num
, s–f->
y
+1,num,£lf->y+£lf->
height
-2);

686  
FALSE
;

687 
	}
}

696 
	$max_m¬gš
 (
size
)

698  
size
 / 2.0 - 0.5;

699 
	}
}

702 
	$·³r_size_chªge
(
GtkM’uI‹m
 *
™em
, 
DŸPageLayout
 *
£lf
)

704 
gch¬
 
buf
[512];

706 
£lf
->
·³ºum
 = 
	`GPOINTER_TO_INT
(
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
(
™em
), "user_data"));

707 
	`size_·ge
(
£lf
, &£lf->
d¬—
->
®loÿtiÚ
);

708 
	`gtk_widg‘_queue_d¿w
(
£lf
->
d¬—
);

710 
£lf
->
block_chªged
 = 
TRUE
;

711 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
tm¬gš
),

712 
	`g‘_·³r_tm¬gš
(
£lf
->
·³ºum
));

713 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
bm¬gš
),

714 
	`g‘_·³r_bm¬gš
(
£lf
->
·³ºum
));

715 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
lm¬gš
),

716 
	`g‘_·³r_lm¬gš
(
£lf
->
·³ºum
));

717 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
£lf
->
rm¬gš
),

718 
	`g‘_·³r_rm¬gš
(
£lf
->
·³ºum
));

720 ià(
	`GTK_TOGGLE_BUTTON
(
£lf
->
Ü›Á_pÜŒa™
)->
aùive
) {

721 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
tm¬gš
),

722 
	`max_m¬gš
(
	`g‘_·³r_psheight
(
£lf
->
·³ºum
)));

723 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
bm¬gš
),

724 
	`max_m¬gš
(
	`g‘_·³r_psheight
(
£lf
->
·³ºum
)));

725 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
lm¬gš
),

726 
	`max_m¬gš
(
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
)));

727 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
rm¬gš
),

728 
	`max_m¬gš
(
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
)));

730 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
tm¬gš
),

731 
	`max_m¬gš
(
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
)));

732 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
bm¬gš
),

733 
	`max_m¬gš
(
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
)));

734 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
lm¬gš
),

735 
	`max_m¬gš
(
	`g‘_·³r_psheight
(
£lf
->
·³ºum
)));

736 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
rm¬gš
),

737 
	`max_m¬gš
(
	`g‘_·³r_psheight
(
£lf
->
·³ºum
)));

739 
£lf
->
block_chªged
 = 
FALSE
;

741 
	`g_¢´štf
(
buf
, (buf), 
	`_
("%0.3gcm x %0.3gcm"),

742 
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
),

743 
	`g‘_·³r_psheight
(
£lf
->
·³ºum
));

744 
	`gtk_Ïb–_£t
(
	`GTK_LABEL
(
£lf
->
·³r_Ïb–
), 
buf
);

746 
	`gtk_sigÇl_em™
(
	`GTK_OBJECT
(
£lf
), 
¶_sigÇls
[
CHANGED
]);

747 
	}
}

750 
	$Ü›Á_chªged
(
DŸPageLayout
 *
£lf
)

752 
	`size_·ge
(
£lf
, &£lf->
d¬—
->
®loÿtiÚ
);

753 
	`gtk_widg‘_queue_d¿w
(
£lf
->
d¬—
);

755 ià(
	`GTK_TOGGLE_BUTTON
(
£lf
->
Ü›Á_pÜŒa™
)->
aùive
) {

756 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
tm¬gš
),

757 
	`max_m¬gš
(
	`g‘_·³r_psheight
(
£lf
->
·³ºum
)));

758 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
bm¬gš
),

759 
	`max_m¬gš
(
	`g‘_·³r_psheight
(
£lf
->
·³ºum
)));

760 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
lm¬gš
),

761 
	`max_m¬gš
(
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
)));

762 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
rm¬gš
),

763 
	`max_m¬gš
(
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
)));

765 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
tm¬gš
),

766 
	`max_m¬gš
(
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
)));

767 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
bm¬gš
),

768 
	`max_m¬gš
(
	`g‘_·³r_pswidth
(
£lf
->
·³ºum
)));

769 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
lm¬gš
),

770 
	`max_m¬gš
(
	`g‘_·³r_psheight
(
£lf
->
·³ºum
)));

771 
	`dŸ_un™_¥šÃr_£t_uµ”
 (
	`DIA_UNIT_SPINNER
(
£lf
->
rm¬gš
),

772 
	`max_m¬gš
(
	`g‘_·³r_psheight
(
£lf
->
·³ºum
)));

775 ià(!
£lf
->
block_chªged
)

776 
	`gtk_sigÇl_em™
(
	`GTK_OBJECT
(
£lf
), 
¶_sigÇls
[
CHANGED
]);

777 
	}
}

780 
	$m¬gš_chªged
(
DŸPageLayout
 *
£lf
)

782 
	`gtk_widg‘_queue_d¿w
(
£lf
->
d¬—
);

783 ià(!
£lf
->
block_chªged
)

784 
	`gtk_sigÇl_em™
(
	`GTK_OBJECT
(
£lf
), 
¶_sigÇls
[
CHANGED
]);

785 
	}
}

788 
	$sÿËmode_chªged
(
DŸPageLayout
 *
£lf
)

790 ià(
	`GTK_TOGGLE_BUTTON
(
£lf
->
f™to
)->
aùive
) {

791 
	`gtk_widg‘_£t_£ns™ive
(
£lf
->
sÿlšg
, 
FALSE
);

792 
	`gtk_widg‘_£t_£ns™ive
(
£lf
->
f™w
, 
TRUE
);

793 
	`gtk_widg‘_£t_£ns™ive
(
£lf
->
f™h
, 
TRUE
);

795 
	`gtk_widg‘_£t_£ns™ive
(
£lf
->
sÿlšg
, 
TRUE
);

796 
	`gtk_widg‘_£t_£ns™ive
(
£lf
->
f™w
, 
FALSE
);

797 
	`gtk_widg‘_£t_£ns™ive
(
£lf
->
f™h
, 
FALSE
);

799 ià(!
£lf
->
block_chªged
)

800 
	`gtk_sigÇl_em™
(
	`GTK_OBJECT
(
£lf
), 
¶_sigÇls
[
CHANGED
]);

801 
	}
}

804 
	$sÿË_chªged
(
DŸPageLayout
 *
£lf
)

806 ià(!
£lf
->
block_chªged
)

807 
	`gtk_sigÇl_em™
(
	`GTK_OBJECT
(
£lf
), 
¶_sigÇls
[
CHANGED
]);

808 
	}
}

811 
	$dŸ_·ge_Ïyout_de¡roy
(
GtkObjeù
 *
objeù
)

813 
DŸPageLayout
 *
£lf
 = 
	`DIA_PAGE_LAYOUT
(
objeù
);

815 ià(
£lf
->
gc
) {

816 
	`gdk_gc_uÄef
(
£lf
->
gc
);

817 
£lf
->
gc
 = 
NULL
;

820 ià(
·»Á_şass
->
de¡roy
)

821 (* 
·»Á_şass
->
de¡roy
)(
objeù
);

822 
	}
}

824 #ifdeà
PAGELAYOUT_TEST


827 
	$chªged_sigÇl
(
DŸPageLayout
 *
£lf
)

829 
	`g_mes§ge
("changed");

830 
	}
}

832 
	$f™tİage_sigÇl
(
DŸPageLayout
 *
£lf
)

834 
	`g_mes§ge
("fito…age");

835 
	}
}

838 
	$maš
(
¬gc
, **
¬gv
)

840 
GtkWidg‘
 *
wš
, *
¶
;

842 
	`gtk_š™
(&
¬gc
, &
¬gv
);

844 
wš
 = 
	`gtk_wšdow_Ãw
(
GTK_WINDOW_TOPLEVEL
);

845 
	`gtk_wšdow_£t_t™Ë
(
	`GTK_WINDOW
(
wš
), 
	`_
("Page Setup"));

846 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
wš
), "destroy",

847 
	`G_CALLBACK
(
gtk_maš_qu™
), 
NULL
);

849 
¶
 = 
	`dŸ_·ge_Ïyout_Ãw
();

850 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
¶
), 5);

851 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
wš
), 
¶
);

852 
	`gtk_widg‘_show
(
¶
);

854 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
¶
), "changed",

855 
	`G_CALLBACK
(
chªged_sigÇl
), 
NULL
);

856 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
¶
), "fittopage",

857 
	`G_CALLBACK
(
f™tİage_sigÇl
), 
NULL
);

859 
	`gtk_widg‘_show
(
wš
);

860 
	`gtk_maš
();

861 
	}
}

	@O:\tool\dvs50\app\diapagelayout.h

22 #iâdeà
DIAPAGELAYOUT_H


23 
	#DIAPAGELAYOUT_H


	)

25 
	~<gtk/gtk.h
>

28 
_DŸPageLayout
 
	tDŸPageLayout
;

29 
GTy³
 
dŸ_·ge_Ïyout_g‘_ty³
 ();

30 
	#DIA_PAGE_LAYOUT
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_·ge_Ïyout_g‘_ty³
(), 
DŸPageLayout
)

	)

33 
	mDIA_PAGE_ORIENT_PORTRAIT
,

34 
	mDIA_PAGE_ORIENT_LANDSCAPE


35 } 
	tDŸPageOr›Á©iÚ
;

37 
GtkWidg‘
 *
dŸ_·ge_Ïyout_Ãw
 ();

39 cÚ¡ 
gch¬
 *
dŸ_·ge_Ïyout_g‘_·³r
 (
DŸPageLayout
 *
¶
);

40 
dŸ_·ge_Ïyout_£t_·³r
 (
DŸPageLayout
 *
¶
,

41 cÚ¡ 
gch¬
 *
·³r
);

42 
dŸ_·ge_Ïyout_g‘_m¬gšs
 (
DŸPageLayout
 *
¶
,

43 
gæßt
 *
tm¬gš
, gæßˆ*
bm¬gš
,

44 
gæßt
 *
lm¬gš
, gæßˆ*
rm¬gš
);

45 
dŸ_·ge_Ïyout_£t_m¬gšs
 (
DŸPageLayout
 *
¶
,

46 
gæßt
 
tm¬gš
, gæßˆ
bm¬gš
,

47 
gæßt
 
lm¬gš
, gæßˆ
rm¬gš
);

48 
DŸPageOr›Á©iÚ
 
dŸ_·ge_Ïyout_g‘_Ü›Á©iÚ
 (
DŸPageLayout
 *
¶
);

49 
dŸ_·ge_Ïyout_£t_Ü›Á©iÚ
 (
DŸPageLayout
 *
¶
,

50 
DŸPageOr›Á©iÚ
 
Ü›Á
);

51 
gboŞ—n
 
dŸ_·ge_Ïyout_g‘_f™to
 (
DŸPageLayout
 *
£lf
);

52 
dŸ_·ge_Ïyout_£t_f™to
 (
DŸPageLayout
 *
£lf
,

53 
gboŞ—n
 
f™to
);

54 
gæßt
 
dŸ_·ge_Ïyout_g‘_sÿlšg
 (
DŸPageLayout
 *
£lf
);

55 
dŸ_·ge_Ïyout_£t_sÿlšg
 (
DŸPageLayout
 *
£lf
,

56 
gæßt
 
sÿlšg
);

57 
dŸ_·ge_Ïyout_g‘_f™_dims
(
DŸPageLayout
 *
£lf
,

58 
gšt
 *
w
, gšˆ*
h
);

59 
dŸ_·ge_Ïyout_£t_f™_dims
(
DŸPageLayout
 *
£lf
,

60 
gšt
 
w
, gšˆ
h
);

61 
dŸ_·ge_Ïyout_£t_chªged
 (
DŸPageLayout
 *
£lf
,

62 
gboŞ—n
 
chªged
);

64 
dŸ_·ge_Ïyout_g‘_efãùive_¬—
 (
DŸPageLayout
 *
£lf
,

65 
gæßt
 *
width
,

66 
gæßt
 *
height
);

69 
dŸ_·ge_Ïyout_g‘_·³r_size
 (cÚ¡ 
gch¬
 *
·³r
,

70 
gæßt
 *
width
, gæßˆ*
height
);

71 
dŸ_·ge_Ïyout_g‘_deçuÉ_m¬gšs
 (cÚ¡ 
gch¬
 *
·³r
,

72 
gæßt
 *
tm¬gš
, gæßˆ*
bm¬gš
,

73 
gæßt
 *
lm¬gš
, gæßˆ*
rm¬gš
);

	@O:\tool\dvs50\app\disp_callbacks.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<m©h.h
>

26 #ifdeà
GNOME


27 #undeà
GTK_DISABLE_DEPRECATED


28 
	~<gnome.h
>

30 
	~<gtk/gtk.h
>

31 
	~<gdk/gdkkeysyms.h
>

33 
	~"di¥Ïy.h
"

34 
	~"dŸg¿m.h
"

35 
	~"toŞ.h
"

36 
	~"š‹rçû.h
"

37 
	~"focus.h
"

38 
	~"objeù_İs.h
"

39 
	~"cÚÃùiÚpošt_İs.h
"

40 
	~"m’us.h
"

41 
	~"mes§ge.h
"

42 
	~"š.h
"

43 
	~"magnify.h
"

44 
	~"dŸm’u.h
"

45 
	~"´eã»nûs.h
"

46 
	~"süŞl_toŞ.h
"

47 
	~"commªds.h
"

48 
	~"highlight.h
"

49 
	~"‹x‹d™.h
"

50 
	~"lib/·»Á.h
"

53 
Pošt
 
	gobjeù_m’u_şicked_pošt
;

56 
GdkEv’t
 *
	mev’t
;

57 
DDi¥Ïy
 *
	mddi¥
;

58 
gušt
 
	mg
;

59 } 
	tHŞdTimeoutD©a
;

61 
HŞdTimeoutD©a
 
	ghŞd_d©a
 = {
NULL
, NULL, 0};

66 
	$objeù_m’u_´oxy
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

68 
DŸM’uI‹m
 *
dŸ_m’u_™em
;

69 
ObjeùChªge
 *
obj_chªge
;

70 
DŸObjeù
 *
obj
;

71 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

73 ià(!
ddi¥
) ;

75 
obj
 = (
DŸObjeù
 *)
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
->data;

76 
dŸ_m’u_™em
 = (
DŸM’uI‹m
 *è
d©a
;

79 
	`objeù_add_upd©es
(
obj
, 
ddi¥
->
dŸg¿m
);

80 
obj_chªge
 = (
dŸ_m’u_™em
->
ÿÎback
)(
obj
, &
objeù_m’u_şicked_pošt
,

81 
dŸ_m’u_™em
->
ÿÎback_d©a
);

82 
	`objeù_add_upd©es
(
obj
, 
ddi¥
->
dŸg¿m
);

83 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
ddi¥
->
dŸg¿m
, 
obj
, 
TRUE
);

85 ià(
obj_chªge
 !ğ
NULL
) {

86 
	`undo_objeù_chªge
(
ddi¥
->
dŸg¿m
, 
obj
, 
obj_chªge
);

88 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

90 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

92 ià(
obj_chªge
 !ğ
NULL
) {

93 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

98 
	`undo_ş—r
(
ddi¥
->
dŸg¿m
->
undo
);

101 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

102 
	}
}

105 
	$dŸ_m’u_ä“
(
DŸM’u
 *
dŸ_m’u
)

107 ià(
dŸ_m’u
->
­p_d©a
)

108 
	`gtk_objeù_de¡roy
((
GtkObjeù
 *)
dŸ_m’u
->
­p_d©a
);

109 
dŸ_m’u
->
­p_d©a
 = 
NULL
;

110 
dŸ_m’u
->
­p_d©a_ä“
 = 
NULL
;

111 
	}
}

121 
	$add_´İ”t›s_m’u_™em
 (
GtkM’u
 *
m’u
, 
gboŞ—n
 
£·¿tÜ
)

123 
GtkWidg‘
 *
m’u_™em
 = 
NULL
;

125 ià(
£·¿tÜ
) {

126 
m’u_™em
 = 
	`gtk_m’u_™em_Ãw
();

127 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u_™em
);

128 
	`gtk_widg‘_show
(
m’u_™em
);

131 
m’u_™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
	`_
("Properties..."));

132 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
m’u_™em
), "aùiv©e", 
	`G_CALLBACK
(
dŸlogs_´İ”t›s_ÿÎback
), 
NULL
);

133 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u_™em
);

134 
	`gtk_widg‘_show
(
m’u_™em
);

135 
	}
}

138 
	$ü—‹_objeù_m’u
(
DŸM’u
 *
dŸ_m’u
)

140 
i
;

141 
GtkWidg‘
 *
m’u
;

142 
GtkWidg‘
 *
m’u_™em
;

144 
m’u
 = 
	`gtk_m’u_Ãw
();

146 iàĞ
dŸ_m’u
->
t™Ë
 ) {

147 
m’u_™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
	`g‘‹xt
(
dŸ_m’u
->
t™Ë
));

148 
	`gtk_widg‘_£t_£ns™ive
(
m’u_™em
, 
FALSE
);

149 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u_™em
);

150 
	`gtk_widg‘_show
(
m’u_™em
);

198 
	`add_´İ”t›s_m’u_™em
(
	`GTK_MENU
 (
m’u
), 
i
 > 0);

200 
dŸ_m’u
->
­p_d©a
 = 
m’u
;

201 
dŸ_m’u
->
­p_d©a_ä“
 = 
dŸ_m’u_ä“
;

202 
	}
}

204 
DŸM’uI‹m
 
	gem±y_m’u_™ems
[] = { {0, } };

205 
DŸM’u
 
	gem±y_m’u
 = {

206 
NULL
,

208 
em±y_m’u_™ems
,

209 
NULL


213 
	$pİup_objeù_m’u
(
DDi¥Ïy
 *
ddi¥
, 
GdkEv’tBu‰Ú
 *
bev’t
)

215 
DŸg¿m
 *
dŸg¿m
;

216 
DŸObjeù
 *
obj
;

217 
GtkM’u
 *
m’u
 = 
NULL
;

218 
DŸM’u
 *
dŸ_m’u
 = 
NULL
;

219 
GLi¡
 *
£Ëùed_li¡
;

220 
i
;

221 
num_™ems
;

223 
dŸg¿m
 = 
ddi¥
->diagram;

224 ià(
	`g_li¡_Ëngth
 (
dŸg¿m
->
d©a
->
£Ëùed
) < 1)

228 
£Ëùed_li¡
 = 
dŸg¿m
->
d©a
->
£Ëùed
;

231 ià(
£Ëùed_li¡
 =ğ
NULL
) {

232 
	`mes§ge_”rÜ
("Selected†ist is %s while selected_count is %d\n",

233 (
£Ëùed_li¡
?"lÚg":"em±y"), 
	`g_li¡_Ëngth
 (
dŸg¿m
->
d©a
->
£Ëùed
));

237 
obj
 = (
DŸObjeù
 *)
	`g_li¡_fœ¡
(
£Ëùed_li¡
)->
d©a
;

242 iàĞ
	`g_li¡_Ëngth
 (
dŸg¿m
->
d©a
->
£Ëùed
) > 1

243 || 
obj
->
İs
->
g‘_objeù_m’u
 =ğ
NULL


244 || (
obj
->
İs
->
g‘_objeù_m’u
)(obj, &
objeù_m’u_şicked_pošt
è=ğ
NULL
) {

245 
dŸ_m’u
 = &
em±y_m’u
;

246 ià(
dŸ_m’u
->
t™Ë
 &&

247 (0 !ğ
	`¡rcmp
(
dŸ_m’u
->
t™Ë
,
obj
->
ty³
->
Çme
))) {

248 
dŸ_m’u
->
	`­p_d©a_ä“
(dia_menu);

250 ià(
	`g_li¡_Ëngth
 (
dŸg¿m
->
d©a
->
£Ëùed
) > 1)

251 
dŸ_m’u
->
t™Ë
 = 
	`_
("Selection");

253 
dŸ_m’u
->
t™Ë
 = 
obj
->
ty³
->
Çme
;

254 
num_™ems
 = 0;

256 
dŸ_m’u
 = (
obj
->
İs
->
g‘_objeù_m’u
)(obj, &
objeù_m’u_şicked_pošt
);

257 
num_™ems
 = 
dŸ_m’u
->num_items;

260 ià(
dŸ_m’u
->
­p_d©a
 =ğ
NULL
) {

261 
	`ü—‹_objeù_m’u
(
dŸ_m’u
);

264 
i
=0;i<
num_™ems
;i++) {

265 
DŸM’uI‹m
 *
™em
 = &
dŸ_m’u
->
™ems
[
i
];

266 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
™em
->
­p_d©a
),

267 
™em
->
aùive
 & 
DIAMENU_ACTIVE
);

268 ià(
™em
->
aùive
 & 
DIAMENU_TOGGLE
) {

269 
	`g_sigÇl_hªdËrs_block_by_func
 (
	`G_OBJECT
 (
	`GTK_CHECK_MENU_ITEM
 (
™em
->
­p_d©a
)),

270 
	`G_CALLBACK
 (
objeù_m’u_´oxy
), 
™em
);

271 
	`gtk_check_m’u_™em_£t_aùive
 (
	`GTK_CHECK_MENU_ITEM
(
™em
->
­p_d©a
),

272 
™em
->
aùive
 & 
DIAMENU_TOGGLE_ON
);

273 
	`g_sigÇl_hªdËrs_unblock_by_func
 (
	`G_OBJECT
 (
	`GTK_CHECK_MENU_ITEM
(
™em
->
­p_d©a
)),

274 
	`G_CALLBACK
 (
objeù_m’u_´oxy
), 
™em
);

278 
m’u
 = 
	`GTK_MENU
(
dŸ_m’u
->
­p_d©a
);

281 
	`gtk_m’u_pİup
(
m’u
, 
NULL
, NULL, NULL, NULL, 
bev’t
->
bu‰Ú
, bev’t->
time
);

282 
	}
}

284 
gšt


285 
	$ddi¥Ïy_focus_š_ev’t
(
GtkWidg‘
 *
widg‘
, 
GdkEv’tFocus
 *
ev’t
, 
gpoš‹r
 
d©a
)

287 
DDi¥Ïy
 *
ddi¥
;

289 
	`g_»tuº_v®_if_ç
 (
widg‘
 !ğ
NULL
, 
FALSE
);

290 
	`g_»tuº_v®_if_ç
 (
ev’t
 !ğ
NULL
, 
FALSE
);

291 
	`g_»tuº_v®_if_ç
 (
d©a
 !ğ
NULL
, 
FALSE
);

293 
ddi¥
 = (
DDi¥Ïy
 *)
d©a
;

295 
	`GTK_WIDGET_SET_FLAGS
(
widg‘
, 
GTK_HAS_FOCUS
);

297 
	`gtk_im_cÚ‹xt_focus_š
(
	`GTK_IM_CONTEXT
(
ddi¥
->
im_cÚ‹xt
));

299  
FALSE
;

300 
	}
}

302 
gšt


303 
	$ddi¥Ïy_focus_out_ev’t
(
GtkWidg‘
 *
widg‘
, 
GdkEv’tFocus
 *
ev’t
,
gpoš‹r
 
d©a
)

305 
DDi¥Ïy
 *
ddi¥
;

306 
»tuº_v®
;

308 
	`g_»tuº_v®_if_ç
 (
widg‘
 !ğ
NULL
, 
FALSE
);

309 
	`g_»tuº_v®_if_ç
 (
ev’t
 !ğ
NULL
, 
FALSE
);

310 
	`g_»tuº_v®_if_ç
 (
d©a
 !ğ
NULL
, 
FALSE
);

312 
»tuº_v®
 = 
FALSE
;

314 
ddi¥
 = (
DDi¥Ïy
 *)
d©a
;

316 
	`GTK_WIDGET_UNSET_FLAGS
 (
widg‘
, 
GTK_HAS_FOCUS
);

318 
	`gtk_im_cÚ‹xt_focus_out
(
	`GTK_IM_CONTEXT
(
ddi¥
->
im_cÚ‹xt
));

320  
»tuº_v®
;

321 
	}
}

324 
	$ddi¥Ïy_»®ize
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

326 
DDi¥Ïy
 *
ddi¥
;

328 
	`g_»tuº_if_ç
(
widg‘
 !ğ
NULL
);

329 
	`g_»tuº_if_ç
(
d©a
 !ğ
NULL
);

331 
ddi¥
 = (
DDi¥Ïy
 *)
d©a
;

333 
	`gtk_im_cÚ‹xt_£t_ş›Á_wšdow
(
	`GTK_IM_CONTEXT
(
ddi¥
->
im_cÚ‹xt
),

334 
	`GDK_WINDOW
(
ddi¥
->
sh–l
->
wšdow
));

335 
	}
}

338 
	$ddi¥Ïy_uÄ—lize
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

340 
DDi¥Ïy
 *
ddi¥
;

342 
	`g_»tuº_if_ç
 (
widg‘
 !ğ
NULL
);

343 
	`g_»tuº_if_ç
 (
d©a
 !ğ
NULL
);

345 
ddi¥
 = (
DDi¥Ïy
 *è
d©a
;

347 ià(
ddi¥
->
im_cÚ‹xt
)

348 
	`gtk_im_cÚ‹xt_£t_ş›Á_wšdow
(
	`GTK_IM_CONTEXT
(
ddi¥
->
im_cÚ‹xt
),

349 
	`GDK_WINDOW
(
ddi¥
->
sh–l
->
wšdow
));

350 
	}
}

353 
	$ddi¥Ïy_size_®loÿ‹
 (
GtkWidg‘
 *
widg‘
,

354 
GtkAÎoÿtiÚ
 *
®loÿtiÚ
,

355 
gpoš‹r
 
d©a
)

357 
DDi¥Ïy
 *
ddi¥
;

359 
	`g_»tuº_if_ç
 (
widg‘
 !ğ
NULL
);

360 
	`g_»tuº_if_ç
 (
®loÿtiÚ
 !ğ
NULL
);

361 
	`g_»tuº_if_ç
 (
d©a
 !ğ
NULL
);

364 
	`g_´št
 ("ddi¥::size_®loÿ‹: %d,%d -> %d,%d\n", 
®loÿtiÚ
->
width
,‡ÎoÿtiÚ->
height
,

365 
widg‘
->
®loÿtiÚ
.
width
, widg‘->®loÿtiÚ.
height
);

367 
widg‘
->
®loÿtiÚ
 = *allocation;

368 
ddi¥
 = (
DDi¥Ïy
 *)
d©a
;

369 
	}
}

372 
	$ddi¥Ïy_pİup_m’u
(
DDi¥Ïy
 *
ddi¥
, 
GdkEv’tBu‰Ú
 *
ev’t
)

374 
GtkWidg‘
 *
m’u
;

376 
m’u
 = 
	`m’us_g‘_di¥Ïy_pİup
();

378 
	`gtk_m’u_pİup
(
	`GTK_MENU
(
m’u
), 
NULL
, NULL, NULL, NULL,

379 
ev’t
->
bu‰Ú
,ƒv’t->
time
);

380 
	}
}

382 
	$hªdË_key_ev’t
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
, 
gušt
 
keysym
,

383 cÚ¡ 
gch¬
 *
¡r
, 
¡¾’
)

385 
DŸObjeù
 *
obj
 = 
	`focus_g‘_objeù
(
focus
);

386 
Pošt
 
p
 = 
obj
->
pos™iÚ
;

387 
ObjeùChªge
 *
obj_chªge
 = 
NULL
;

388 
gboŞ—n
 
modif›d
;

390 
	`objeù_add_upd©es
(
obj
, 
ddi¥
->
dŸg¿m
);

392 
modif›d
 = (
focus
->
key_ev’t
)(focus, 
keysym
, 
¡r
, 
¡¾’
,

393 &
obj_chªge
);

396 
p
 = 
obj
->
pos™iÚ
;

397 (
obj
->
İs
->
move
)(obj,&
p
);

398 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
ddi¥
->
dŸg¿m
,
obj
,
TRUE
);

400 
	`objeù_add_upd©es
(
obj
, 
ddi¥
->
dŸg¿m
);

402 ià(
modif›d
) {

403 ià(
obj_chªge
 !ğ
NULL
) {

404 
	`undo_objeù_chªge
(
ddi¥
->
dŸg¿m
, 
obj
, 
obj_chªge
);

405 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

407 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

408 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

411 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

412 
	}
}

416 
	$ddi¥Ïy_im_cÚ‹xt_comm™
(
GtkIMCÚ‹xt
 *
cÚ‹xt
, cÚ¡ 
gch¬
 *
¡r
,

417 
DDi¥Ïy
 *
ddi¥
)

426 
Focus
 *
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

428 
	`ddi¥Ïy_im_cÚ‹xt_´“d™_»£t
(
ddi¥
, 
focus
);

430 ià(
focus
 !ğ
NULL
)

431 
	`hªdË_key_ev’t
(
ddi¥
, 
focus
, 0, 
¡r
, 
	`g_utf8_¡¾’
(str,-1));

432 
	}
}

435 
	$ddi¥Ïy_im_cÚ‹xt_´“d™_chªged
(
GtkIMCÚ‹xt
 *
cÚ‹xt
,

436 
DDi¥Ïy
 *
ddi¥
)

438 
gšt
 
cursÜ_pos
;

439 
Focus
 *
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

441 
	`ddi¥Ïy_im_cÚ‹xt_´“d™_»£t
(
ddi¥
, 
focus
);

443 
	`gtk_im_cÚ‹xt_g‘_´“d™_¡ršg
(
cÚ‹xt
, &
ddi¥
->
´“d™_¡ršg
,

444 &
ddi¥
->
´“d™_©Œs
, &
cursÜ_pos
);

445 ià(
ddi¥
->
´“d™_¡ršg
 !ğ
NULL
) {

446 ià(
focus
 !ğ
NULL
) {

447 
	`hªdË_key_ev’t
(
ddi¥
, 
focus
, 0, ddi¥->
´“d™_¡ršg
,

448 
	`g_utf8_¡¾’
(
ddi¥
->
´“d™_¡ršg
,-1));

450 
	`ddi¥Ïy_im_cÚ‹xt_´“d™_»£t
(
ddi¥
, 
focus
);

453 
	}
}

456 
	$_süŞl_·ge
 (
DDi¥Ïy
 *
ddi¥
, 
DœeùiÚ
 
dœ
)

458 
Pošt
 
d–
 = {0, 0};

460 
dœ
) {

461 
DIR_LEFT
 :

462 
d–
.
x
 = 
ddi¥
->
dŸg¿m
->
d©a
->
·³r
.
width
 * ddi¥->dŸg¿m->d©a->·³r.
sÿlšg
;

464 
DIR_RIGHT
 :

465 
d–
.
x
 = -
ddi¥
->
dŸg¿m
->
d©a
->
·³r
.
width
 * ddi¥->dŸg¿m->d©a->·³r.
sÿlšg
;

467 
DIR_UP
 :

468 
d–
.
y
 = -
ddi¥
->
dŸg¿m
->
d©a
->
·³r
.
height
 * ddi¥->dŸg¿m->d©a->·³r.
sÿlšg
;

470 
DIR_DOWN
 :

471 
d–
.
y
 = 
ddi¥
->
dŸg¿m
->
d©a
->
·³r
.
height
 * ddi¥->dŸg¿m->d©a->·³r.
sÿlšg
;

474 
	`ddi¥Ïy_süŞl
(
ddi¥
, &
d–
);

475 
	`ddi¥Ïy_æush
(
ddi¥
);

476 
	}
}

479 
	$_süŞl_¡•
 (
DDi¥Ïy
 *
ddi¥
, 
gušt
 
keyv®
)

481 
keyv®
) {

482 
GDK_Up
 :

483 
	`ddi¥Ïy_süŞl_up
(
ddi¥
);

484 
	`ddi¥Ïy_æush
(
ddi¥
);

486 
GDK_Down
:

487 
	`ddi¥Ïy_süŞl_down
(
ddi¥
);

488 
	`ddi¥Ïy_æush
(
ddi¥
);

490 
GDK_Leá
:

491 
	`ddi¥Ïy_süŞl_Ëá
(
ddi¥
);

492 
	`ddi¥Ïy_æush
(
ddi¥
);

494 
GDK_Right
:

495 
	`ddi¥Ïy_süŞl_right
(
ddi¥
);

496 
	`ddi¥Ïy_æush
(
ddi¥
);

499 
	`g_as£¹_nÙ_»ached
 ();

501 
	}
}

506 
	$hŞd_»move_hªdËr
()

508 ià(
hŞd_d©a
.
g
 != 0) {

509 
	`g_sourû_»move
(
hŞd_d©a
.
g
);

510 
hŞd_d©a
.
g
 = 0;

511 
	`gdk_ev’t_ä“
(
hŞd_d©a
.
ev’t
);

513 
	}
}

521 
gboŞ—n


522 
	$hŞd_timeout_hªdËr
(
gpoš‹r
 
d©a
)

524 ià(
aùive_toŞ
->
bu‰Ú_hŞd_func
)

525 (*
aùive_toŞ
->
bu‰Ú_hŞd_func
è×ùive_toŞ, (
GdkEv’tBu‰Ú
 *)(
hŞd_d©a
.
ev’t
), hŞd_d©a.
ddi¥
);

526 
	`hŞd_»move_hªdËr
();

527  
FALSE
;

528 
	}
}

533 
gšt


534 
	$ddi¥Ïy_ÿnvas_ev’ts
 (
GtkWidg‘
 *
ÿnvas
,

535 
GdkEv’t
 *
ev’t
,

536 
DDi¥Ïy
 *
ddi¥
)

538 
GdkEv’tExpo£
 *
“v’t
;

539 
GdkEv’tMÙiÚ
 *
mev’t
;

540 
GdkEv’tBu‰Ú
 *
bev’t
;

541 
GdkEv’tKey
 *
kev’t
;

542 
GdkEv’tSüŞl
 *
£v’t
;

543 
gšt
 
tx
, 
ty
;

544 
GdkModif›rTy³
 
tmask
;

545 
gušt
 
¡©e
 = 0;

546 
Focus
 *
focus
;

547 
DŸObjeù
 *
obj
;

548 
ReùªgË
 *
visibË
;

549 
Pošt
 
middË
;

550 
»tuº_v®
;

551 
key_hªdËd
;

552 
width
, 
height
;

553 
Ãw_size
;

554 
im_cÚ‹xt_u£d
;

555 
gboŞ—n
 
movšg
 = 
FALSE
;

557 
»tuº_v®
 = 
FALSE
;

559 ià(!
ÿnvas
->
wšdow
)

560  
FALSE
;

562 
ev’t
->
ty³
)

564 
GDK_EXPOSE
:

565 
“v’t
 = (
GdkEv’tExpo£
 *è
ev’t
;

566 
	`ddi¥Ïy_add_di¥Ïy_¬—
(
ddi¥
,

567 
“v’t
->
¬—
.
x
,ƒev’t->¬—.
y
,

568 
“v’t
->
¬—
.
x
 +ƒev’t->¬—.
width
,

569 
“v’t
->
¬—
.
y
 +ƒev’t->¬—.
height
);

570 
	`ddi¥Ïy_æush
(
ddi¥
);

573 
GDK_SCROLL
:

574 
£v’t
 = (
GdkEv’tSüŞl
 *è
ev’t
;

576 
£v’t
->
dœeùiÚ
)

578 
GDK_SCROLL_UP
:

579 ià(
£v’t
->
¡©e
 & 
GDK_SHIFT_MASK
)

580 
	`ddi¥Ïy_süŞl_Ëá
(
ddi¥
);

581 ià(
£v’t
->
¡©e
 & 
GDK_CONTROL_MASK
) {

582 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
, ()
£v’t
->
x
, ()£v’t->
y
, &
middË
.x, &middle.y);

584 
	`ddi¥Ïy_zoom_ûÁ”ed
(
ddi¥
, &
middË
, 1.090508);

587 
	`ddi¥Ïy_süŞl_up
(
ddi¥
);

589 
GDK_SCROLL_DOWN
:

590 ià(
£v’t
->
¡©e
 & 
GDK_SHIFT_MASK
)

591 
	`ddi¥Ïy_süŞl_right
(
ddi¥
);

592 ià(
£v’t
->
¡©e
 & 
GDK_CONTROL_MASK
) {

593 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
, ()
£v’t
->
x
, ()£v’t->
y
, &
middË
.x, &middle.y);

595 
	`ddi¥Ïy_zoom_ûÁ”ed
(
ddi¥
, &
middË
, 0.917004);

598 
	`ddi¥Ïy_süŞl_down
(
ddi¥
);

600 
GDK_SCROLL_LEFT
:

601 
	`ddi¥Ïy_süŞl_Ëá
(
ddi¥
);

603 
GDK_SCROLL_RIGHT
:

604 
	`ddi¥Ïy_süŞl_right
(
ddi¥
);

609 
	`ddi¥Ïy_æush
 (
ddi¥
);

612 
GDK_CONFIGURE
:

613 ià(
ddi¥
->
»nd””
 !ğ
NULL
) {

614 
width
 = 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
);

615 
height
 = 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
);

616 
Ãw_size
 = ((
width
 !ğ
ddi¥
->
ÿnvas
->
®loÿtiÚ
.width) ||

617 (
height
 !ğ
ddi¥
->
ÿnvas
->
®loÿtiÚ
.height));

619 
Ãw_size
 = 
TRUE
;

621 ià(
Ãw_size
) {

622 
	`ddi¥Ïy_»size_ÿnvas
(
ddi¥
,

623 
ddi¥
->
ÿnvas
->
®loÿtiÚ
.
width
,

624 
ddi¥
->
ÿnvas
->
®loÿtiÚ
.
height
);

625 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

630 ià(
	`is_š‹g¿‹d_ui
 () == 0)

631 
	`di¥Ïy_£t_aùive
(
ddi¥
);

634 
GDK_FOCUS_CHANGE
: {

635 
GdkEv’tFocus
 *
focus
 = (GdkEv’tFocus*)
ev’t
;

636 
	`hŞd_»move_hªdËr
();

637 ià(
focus
->
š
) {

638 
	`di¥Ïy_£t_aùive
(
ddi¥
);

639 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

643 
GDK_2BUTTON_PRESS
:

644 
	`di¥Ïy_£t_aùive
(
ddi¥
);

645 
	`hŞd_»move_hªdËr
();

646 
bev’t
 = (
GdkEv’tBu‰Ú
 *è
ev’t
;

647 
¡©e
 = 
bev’t
->state;

649 
bev’t
->
bu‰Ú
)

652 ià(
Œªs›Á_toŞ
)

654 ià(
aùive_toŞ
->
doubË_şick_func
)

655 (*
aùive_toŞ
->
doubË_şick_func
è×ùive_toŞ, 
bev’t
, 
ddi¥
);

669 
GDK_BUTTON_PRESS
:

670 
	`di¥Ïy_£t_aùive
(
ddi¥
);

671 
bev’t
 = (
GdkEv’tBu‰Ú
 *è
ev’t
;

672 
¡©e
 = 
bev’t
->state;

674 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
,

675 ()
bev’t
->
x
, ()bev’t->
y
,

676 &
objeù_m’u_şicked_pošt
.
x
,

677 &
objeù_m’u_şicked_pošt
.
y
);

679 
bev’t
->
bu‰Ú
)

682 ià(
Œªs›Á_toŞ
)

685 
movšg
 = 
TRUE
;

686 
	`gtk_widg‘_g¿b_focus
(
ÿnvas
);

687 ià(
aùive_toŞ
->
bu‰Ú_´ess_func
)

688 (*
aùive_toŞ
->
bu‰Ú_´ess_func
è×ùive_toŞ, 
bev’t
, 
ddi¥
);

693 
hŞd_d©a
.
ev’t
 = 
	`gdk_ev’t_cİy
(event);

694 
hŞd_d©a
.
ddi¥
 = ddisp;

695 
hŞd_d©a
.
g
 = 
	`g_timeout_add
(1000, 
hŞd_timeout_hªdËr
, 
NULL
);

699 ià(
ddi¥
->
m’u_b¬
 =ğ
NULL
 && !
	`is_š‹g¿‹d_ui
()) {

700 
	`pİup_objeù_m’u
(
ddi¥
, 
bev’t
);

702 ià(!
Œªs›Á_toŞ
) {

703 
	`gtk_widg‘_g¿b_focus
(
ÿnvas
);

704 
Œªs›Á_toŞ
 = 
	`ü—‹_süŞl_toŞ
();

705 (*
Œªs›Á_toŞ
->
bu‰Ú_´ess_func
èÑ¿ns›Á_toŞ, 
bev’t
, 
ddi¥
);

710 ià(
Œªs›Á_toŞ
)

712 ià(
ddi¥
->
m’u_b¬
 =ğ
NULL
) {

713 ià(
bev’t
->
¡©e
 & 
GDK_CONTROL_MASK
 || 
	`is_š‹g¿‹d_ui
 ()) {

715 
	`pİup_objeù_m’u
(
ddi¥
, 
bev’t
);

718 
	`ddi¥Ïy_pİup_m’u
(
ddi¥
, 
bev’t
);

722 
	`pİup_objeù_m’u
(
ddi¥
, 
bev’t
);

730 
GDK_BUTTON_RELEASE
:

731 
	`di¥Ïy_£t_aùive
(
ddi¥
);

732 
bev’t
 = (
GdkEv’tBu‰Ú
 *è
ev’t
;

733 
¡©e
 = 
bev’t
->state;

735 
bev’t
->
bu‰Ú
)

738 ià(
movšg
)

739 
movšg
 = 
FALSE
;

740 ià(
aùive_toŞ
->
bu‰Ú_»Ëa£_func
)

741 (*
aùive_toŞ
->
bu‰Ú_»Ëa£_func
) (active_tool,

742 
bev’t
, 
ddi¥
);

744 
	`hŞd_»move_hªdËr
();

748 ià(
Œªs›Á_toŞ
) {

749 (*
Œªs›Á_toŞ
->
bu‰Ú_»Ëa£_func
) (transient_tool,

750 
bev’t
, 
ddi¥
);

752 
	`toŞ_ä“
(
Œªs›Á_toŞ
);

753 
Œªs›Á_toŞ
 = 
NULL
;

765 
GDK_MOTION_NOTIFY
:

767 
	`gdk_wšdow_g‘_poš‹r
 (
ÿnvas
->
wšdow
, &
tx
, &
ty
, &
tmask
);

768 
	`hŞd_»move_hªdËr
();

770 
mev’t
 = (
GdkEv’tMÙiÚ
 *è
ev’t
;

771 
¡©e
 = 
mev’t
->state;

773 ià(
mev’t
->
is_hšt
) {

774 
mev’t
->
x
 = 
tx
;

775 
mev’t
->
y
 = 
ty
;

776 
mev’t
->
¡©e
 = 
tmask
;

777 
mev’t
->
is_hšt
 = 
FALSE
;

779 ià(
Œªs›Á_toŞ
 && (*Œªs›Á_toŞ->
mÙiÚ_func
))

780 (*
Œªs›Á_toŞ
->
mÙiÚ_func
èÑ¿ns›Á_toŞ, 
mev’t
, 
ddi¥
);

781 ià(
aùive_toŞ
->
mÙiÚ_func
)

782 (*
aùive_toŞ
->
mÙiÚ_func
è×ùive_toŞ, 
mev’t
, 
ddi¥
);

785 
GDK_KEY_PRESS
:

786 ià(
movšg
)

788 
	`di¥Ïy_£t_aùive
(
ddi¥
);

789 
kev’t
 = (
GdkEv’tKey
 *)
ev’t
;

790 
¡©e
 = 
kev’t
->state;

791 
key_hªdËd
 = 
FALSE
;

792 
im_cÚ‹xt_u£d
 = 
FALSE
;

794 
	`´štf
("Key iÅuˆ%d iÀ¡©%d\n", 
kev’t
->
keyv®
, 
	`‹x‹d™_mode
(
ddi¥
));

796 
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

797 ià(
focus
 !ğ
NULL
) {

799 
obj
 = 
	`focus_g‘_objeù
(
focus
);

800 ià(
	`dŸg¿m_is_£Ëùed
(
ddi¥
->
dŸg¿m
, 
obj
)) {

802 ià(!
	`gtk_im_cÚ‹xt_f‹r_key´ess
(

803 
	`GTK_IM_CONTEXT
(
ddi¥
->
im_cÚ‹xt
), 
kev’t
)) {

805 
kev’t
->
keyv®
) {

806 
GDK_Tab
:

807 
focus
 = 
	`‹x‹d™_move_focus
(
ddi¥
, focus,

808 (
¡©e
 & 
GDK_SHIFT_MASK
) == 0);

809 
obj
 = 
	`focus_g‘_objeù
(
focus
);

811 
GDK_Esÿ³
:

812 
	`‹x‹d™_d—ùiv©e_focus
();

813 
	`toŞ_»£t
 ();

814 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

818 
	`hªdË_key_ev’t
(
ddi¥
, 
focus
, 
kev’t
->
keyv®
,

819 
kev’t
->
¡ršg
, kev’t->
Ëngth
);

821 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

824 
»tuº_v®
 = 
key_hªdËd
 = 
im_cÚ‹xt_u£d
 = 
TRUE
;

831 ià(!
key_hªdËd
 && (
¡©e
 & (
GDK_CONTROL_MASK
 | 
GDK_MOD1_MASK
))) {

833 ià(!
key_hªdËd
) {

836 
»tuº_v®
 = 
TRUE
;

838 
kev’t
->
keyv®
) {

839 
GDK_Home
 :

841 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
, ddi¥->
dŸg¿m
->
d©a
->
ex‹Ás
.
Ëá
, ddi¥->dŸg¿m->d©a->ex‹Ás.
tİ
);

842 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

843 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

845 
GDK_End
 :

847 
visibË
 = &
ddi¥
->visible;

848 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
,

849 
ddi¥
->
dŸg¿m
->
d©a
->
ex‹Ás
.
right
 - (
visibË
->righˆ- visibË->
Ëá
),

850 
ddi¥
->
dŸg¿m
->
d©a
->
ex‹Ás
.
bÙtom
 - (
visibË
->bÙtom - visibË->
tİ
));

851 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

852 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

854 
GDK_Page_Up
 :

855 
	`_süŞl_·ge
 (
ddi¥
, !(
¡©e
 & 
GDK_CONTROL_MASK
è? 
DIR_UP
 : 
DIR_LEFT
);

857 
GDK_Page_Down
 :

858 
	`_süŞl_·ge
 (
ddi¥
, !(
¡©e
 & 
GDK_CONTROL_MASK
è? 
DIR_DOWN
 : 
DIR_RIGHT
);

860 
GDK_Up
:

861 
GDK_Down
:

862 
GDK_Leá
:

863 
GDK_Right
:

864 ià(
	`g_li¡_Ëngth
 (
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
) > 0) {

865 
DŸg¿m
 *
dŸ
 = 
ddi¥
->
dŸg¿m
;

866 
GLi¡
 *
objeùs
 = 
dŸ
->
d©a
->
£Ëùed
;

867 
DœeùiÚ
 
dœ
 = 
GDK_Up
 =ğ
kev’t
->
keyv®
 ? 
DIR_UP
 :

868 
GDK_Down
 =ğ
kev’t
->
keyv®
 ? 
DIR_DOWN
 :

869 
GDK_Right
 =ğ
kev’t
->
keyv®
 ? 
DIR_RIGHT
 : 
DIR_LEFT
;

870 
	`objeù_add_upd©es_li¡
(
objeùs
, 
dŸ
);

871 
	`objeù_li¡_nudge
(
objeùs
, 
dŸ
, 
dœ
,

873 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
 (
ddi¥
, (
¡©e
 & 
GDK_SHIFT_MASK
) ? 10 : 1));

874 
	`dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
dŸ
);

875 
	`objeù_add_upd©es_li¡
(
objeùs
, 
dŸ
);

876 
	`dŸg¿m_modif›d
(
dŸ
);

877 
	`dŸg¿m_æush
(
dŸ
);

879 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

881 
	`_süŞl_¡•
 (
ddi¥
, 
kev’t
->
keyv®
);

884 
GDK_KP_Add
:

885 
GDK_¶us
:

886 
visibË
 = &
ddi¥
->visible;

887 
middË
.
x
 = 
visibË
->
Ëá
*0.5 + visibË->
right
*0.5;

888 
middË
.
y
 = 
visibË
->
tİ
*0.5 + visibË->
bÙtom
*0.5;

890 
	`ddi¥Ïy_zoom
(
ddi¥
, &
middË
, 
M_SQRT2
);

892 
GDK_KP_SubŒaù
:

893 
GDK_mšus
:

894 
visibË
 = &
ddi¥
->visible;

895 
middË
.
x
 = 
visibË
->
Ëá
*0.5 + visibË->
right
*0.5;

896 
middË
.
y
 = 
visibË
->
tİ
*0.5 + visibË->
bÙtom
*0.5;

898 
	`ddi¥Ïy_zoom
(
ddi¥
, &
middË
, 
M_SQRT1_2
);

900 
GDK_Shiá_L
:

901 
GDK_Shiá_R
:

902 ià(
aùive_toŞ
->
ty³
 =ğ
MAGNIFY_TOOL
)

903 
	`£t_zoom_out
(
aùive_toŞ
);

905 
GDK_Esÿ³
:

906 
	`v›w_unfuÎsü“n
();

908 
GDK_F2
:

909 
GDK_R‘uº
:

910 
	`gtk_aùiÚ_aùiv©e
 (
	`m’us_g‘_aùiÚ
 ("ToolsTextedit"));

913 ià(
kev’t
->
¡ršg
 && kev’t->
keyv®
 == ' ') {

914 
	`toŞ_£Ëù_fÜm”
();

915 } ià((
kev’t
->
¡©e
 & (
GDK_MOD1_MASK
|
GDK_CONTROL_MASK
)) == 0 &&

916 
kev’t
->
Ëngth
 != 0) {

918 #ifdeà
NEW_TEXT_EDIT


919 
	`modify_ed™_fœ¡_‹xt
(
ddi¥
);

920 
»tuº_v®
 = 
FALSE
;

926 ià(!
im_cÚ‹xt_u£d
)

927 
	`gtk_im_cÚ‹xt_»£t
(
	`GTK_IM_CONTEXT
(
ddi¥
->
im_cÚ‹xt
));

931 
GDK_KEY_RELEASE
:

932 
kev’t
 = (
GdkEv’tKey
 *è
ev’t
;

933 
¡©e
 = 
kev’t
->state;

934 ià(
	`gtk_im_cÚ‹xt_f‹r_key´ess
(
	`GTK_IM_CONTEXT
(
ddi¥
->
im_cÚ‹xt
),

935 
kev’t
)) {

936 
»tuº_v®
 = 
TRUE
;

938 
kev’t
->
keyv®
) {

939 
GDK_Shiá_L
:

940 
GDK_Shiá_R
:

941 ià(
aùive_toŞ
->
ty³
 =ğ
MAGNIFY_TOOL
)

942 
	`£t_zoom_š
(
aùive_toŞ
);

954  
»tuº_v®
;

955 
	}
}

957 
gšt


958 
	$ddi¥Ïy_hsb_upd©e
 (
GtkAdju¡m’t
 *
adju¡m’t
,

959 
DDi¥Ïy
 *
ddi¥
)

961 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
, 
adju¡m’t
->
v®ue
, ddi¥->
Üigo
.
y
);

962 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

963 
	`ddi¥Ïy_æush
(
ddi¥
);

964  
FALSE
;

965 
	}
}

967 
gšt


968 
	$ddi¥Ïy_vsb_upd©e
 (
GtkAdju¡m’t
 *
adju¡m’t
,

969 
DDi¥Ïy
 *
ddi¥
)

971 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
, ddi¥->
Üigo
.
x
, 
adju¡m’t
->
v®ue
);

972 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

973 
	`ddi¥Ïy_æush
(
ddi¥
);

974  
FALSE
;

975 
	}
}

977 
gšt


978 
	$ddi¥Ïy_d–‘e
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’t
 *
ev’t
, 
gpoš‹r
 
d©a
)

980 
DDi¥Ïy
 *
ddi¥
;

982 
ddi¥
 = (
DDi¥Ïy
 *)
d©a
;

984 
	`ddi¥Ïy_şo£
(
ddi¥
);

985  
TRUE
;

986 
	}
}

989 
	$ddi¥Ïy_de¡roy
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

991 
DDi¥Ïy
 *
ddi¥
;

993 
ddi¥
 = (
DDi¥Ïy
 *è
d©a
;

995 
	`ddi¥Ïy_»®ly_de¡roy
(
ddi¥
);

996 
	}
}

999 
DŸObjeù
 *

1000 
	$ddi¥Ïy_drİ_objeù
(
DDi¥Ïy
 *
ddi¥
, 
gšt
 
x
, gšˆ
y
, 
DŸObjeùTy³
 *
Ùy³
,

1001 
gpoš‹r
 
u£r_d©a
)

1003 
Pošt
 
drİpošt
;

1004 
Pošt
 
drİpošt_Üig
;

1005 
HªdË
 *
hªdË1
, *
hªdË2
;

1006 
DŸObjeù
 *
obj
, *
p_obj
;

1007 
GLi¡
 *
li¡
;

1008 
»®
 
şick_di¡ªû
;

1010 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
, 
x
, 
y
, &
drİpošt
.x, &droppoint.y);

1013 
drİpošt_Üig
 = 
drİpošt
;

1015 
	`¢­_to_grid
(
ddi¥
, &
drİpošt
.
x
, &drİpošt.
y
);

1017 
obj
 = 
	`dŸ_objeù_deçuÉ_ü—‹
 (
Ùy³
, &
drİpošt
,

1018 
u£r_d©a
,

1019 &
hªdË1
, &
hªdË2
);

1021 ià(!
obj
)

1022  
NULL
;

1024 
şick_di¡ªû
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 3.0);

1030 
p_obj
 = 
	`dŸg¿m_fšd_şicked_objeù
(
ddi¥
->
dŸg¿m
, &
drİpošt_Üig
,

1031 
şick_di¡ªû
);

1033 ià(
p_obj
 && 
	`objeù_æags_£t
Õ_obj, 
DIA_OBJECT_CAN_PARENT
))

1036 
ReùªgË
 
p_ext
, 
c_ext
;

1037 
»®
 
·»Á_height
, 
chd_height
, 
·»Á_width
, 
chd_width
;

1038 
»®
 
vadju¡
 = 0.0, 
hadju¡
 = 0.0;

1039 
Pošt
 
Ãw_pos
;

1041 
obj
->
·»Á
 = 
p_obj
;

1042 
p_obj
->
chd»n
 = 
	`g_li¡_­³nd
Õ_obj->chd»n, 
obj
);

1049 
	`·»Á_hªdË_ex‹Ás
(
p_obj
, &
p_ext
);

1050 
	`·»Á_hªdË_ex‹Ás
(
obj
, &
c_ext
);

1052 
·»Á_height
 = 
p_ext
.
bÙtom
 -…_ext.
tİ
;

1053 
chd_height
 = 
c_ext
.
bÙtom
 - c_ext.
tİ
;

1055 
·»Á_width
 = 
p_ext
.
right
 -…_ext.
Ëá
;

1056 
chd_width
 = 
c_ext
.
right
 - c_ext.
Ëá
;

1060 
c_ext
.
Ëá
 = 
drİpošt_Üig
.
x
 - (
obj
->
pos™iÚ
.x - c_ext.left);

1061 
c_ext
.
tİ
 = 
drİpošt_Üig
.
y
 - (
obj
->
pos™iÚ
.y - c_ext.top);

1062 
c_ext
.
right
 = c_ext.
Ëá
 + 
chd_width
;

1063 
c_ext
.
bÙtom
 = c_ext.
tİ
 + 
chd_height
;

1065 ià(
c_ext
.
Ëá
 < 
p_ext
.left) {

1066 
hadju¡
 = 
p_ext
.
Ëá
 - 
c_ext
.left;

1067 } ià(
c_ext
.
right
 > 
p_ext
.right) {

1068 
hadju¡
 = 
p_ext
.
right
 - 
c_ext
.right;

1070 ià(
c_ext
.
tİ
 < 
p_ext
.top) {

1071 
vadju¡
 = 
p_ext
.
tİ
 - 
c_ext
.top;

1072 } ià(
c_ext
.
bÙtom
 > 
p_ext
.bottom) {

1073 
vadju¡
 = 
p_ext
.
bÙtom
 - 
c_ext
.bottom;

1076 ià(
chd_width
 > 
·»Á_width
 ||

1077 
chd_height
 > 
·»Á_height
) {

1078 
	`mes§ge_”rÜ
(
	`_
("The object you dropped cannot fit into its…arent. \nEitherƒxpandhe…arent object, or drophe objectƒlsewhere."));

1079 
obj
->
·»Á
->
chd»n
 = 
	`g_li¡_»move
(obj->parent->children, obj);

1080 
obj
->
İs
->
	`de¡roy
 (obj);

1081  
NULL
;

1084 ià(
hadju¡
 || 
vadju¡
) {

1085 
Ãw_pos
.
x
 = 
drİpošt
.x + 
hadju¡
;

1086 
Ãw_pos
.
y
 = 
drİpošt
.y + 
vadju¡
;

1087 
obj
->
İs
->
	`move
(obj, &
Ãw_pos
);

1091 
	`dŸg¿m_add_objeù
(
ddi¥
->
dŸg¿m
, 
obj
);

1092 
	`dŸg¿m_»move_®l_£Ëùed
(
ddi¥
->
dŸg¿m
, 
TRUE
);

1093 
	`dŸg¿m_£Ëù
(
ddi¥
->
dŸg¿m
, 
obj
);

1094 
obj
->
İs
->
	`£Ëùf
(obj, &
drİpošt
, 
ddi¥
->
»nd””
);

1096 
	`‹x‹d™_aùiv©e_objeù
(
ddi¥
, 
obj
, 
NULL
);

1099 ià((
hªdË1
 !ğ
NULL
) &&

1100 (
hªdË1
->
cÚÃù_ty³
 !ğ
HANDLE_NONCONNECTABLE
)) {

1101 
	`objeù_cÚÃù_di¥Ïy
(
ddi¥
, 
obj
, 
hªdË1
, 
FALSE
);

1103 
	`objeù_add_upd©es
(
obj
, 
ddi¥
->
dŸg¿m
);

1104 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

1105 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

1107 
li¡
 = 
	`g_li¡_´•’d
(
NULL
, 
obj
);

1108 
	`undo_š£¹_objeùs
(
ddi¥
->
dŸg¿m
, 
li¡
, 1);

1109 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

1111 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

1112 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

1113 ià(
´efs
.
»£t_toŞs_aá”_ü—‹
)

1114 
	`toŞ_»£t
();

1115  
obj
;

1116 
	}
}

	@O:\tool\dvs50\app\disp_callbacks.h

18 #iâdeà
DISP_CALLBACKS_H


19 
	#DISP_CALLBACKS_H


	)

21 
	~"di¥Ïy.h
"

23 
	#CANVAS_EVENT_MASK
 \

24 
GDK_EXPOSURE_MASK
 | 
GDK_POINTER_MOTION_MASK
 | \

25 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON_PRESS_MASK
 | \

26 
GDK_BUTTON_RELEASE_MASK
 | 
GDK_STRUCTURE_MASK
 | \

27 
GDK_ENTER_NOTIFY_MASK
 | 
GDK_KEY_PRESS_MASK
 | \

28 
GDK_KEY_RELEASE_MASK


	)

30 
gšt
 
ddi¥Ïy_focus_š_ev’t
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’tFocus
 *
ev’t
,

31 
gpoš‹r
 
d©a
);

32 
gšt
 
ddi¥Ïy_focus_out_ev’t
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’tFocus
 *
ev’t
,

33 
gpoš‹r
 
d©a
);

34 
ddi¥Ïy_»®ize
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
);

35 
ddi¥Ïy_uÄ—lize
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
);

36 
ddi¥Ïy_size_®loÿ‹
 (
GtkWidg‘
 *
widg‘
, 
GtkAÎoÿtiÚ
 *
®loÿtiÚ
,

37 
gpoš‹r
 
d©a
);

39 
gšt
 
ddi¥Ïy_ÿnvas_ev’ts
 (
GtkWidg‘
 *, 
GdkEv’t
 *, 
DDi¥Ïy
 *
ddi¥
);

40 
ddi¥Ïy_pİup_m’u
(
DDi¥Ïy
 *
ddi¥
, 
GdkEv’tBu‰Ú
 *
ev’t
);

41 
gšt
 
ddi¥Ïy_hsb_upd©e
 (
GtkAdju¡m’t
 *
adju¡m’t
, 
DDi¥Ïy
 *
ddi¥
);

42 
gšt
 
ddi¥Ïy_vsb_upd©e
 (
GtkAdju¡m’t
 *
adju¡m’t
, 
DDi¥Ïy
 *
ddi¥
);

43 
gšt
 
ddi¥Ïy_d–‘e
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’t
 *
ev’t
, 
gpoš‹r
 
d©a
);

44 
ddi¥Ïy_de¡roy
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
);

46 
DIAVAR
 
DŸObjeù
 *
ddi¥Ïy_drİ_objeù
(
DDi¥Ïy
 *
ddi¥
, 
gšt
 
x
, gšˆ
y
, 
DŸObjeùTy³
 *
Ùy³
,

47 
gpoš‹r
 
u£r_d©a
);

48 
ddi¥Ïy_im_cÚ‹xt_comm™
(
GtkIMCÚ‹xt
 *
cÚ‹xt
, cÚ¡ 
gch¬
 *
¡r
,

49 
DDi¥Ïy
 *
ddi¥
);

50 
ddi¥Ïy_im_cÚ‹xt_´“d™_chªged
(
GtkIMCÚ‹xt
 *
cÚ‹xt
,

51 
DDi¥Ïy
 *
ddi¥
);

	@O:\tool\dvs50\app\display.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<¡ršg.h
>

24 
	~<¡dio.h
>

25 
	~<m©h.h
>

27 #ifdeà
GNOME


28 #undeà
GTK_DISABLE_DEPRECATED


29 
	~<gnome.h
>

32 
	~<gdk/gdkkeysyms.h
>

34 
	~"š.h
"

36 
	~"di¥Ïy.h
"

37 
	~"group.h
"

38 
	~"š‹rçû.h
"

39 
	~"focus.h
"

40 
	~"cŞÜ.h
"

41 
	~"objeù.h
"

42 
	~"hªdË_İs.h
"

43 
	~"cÚÃùiÚpošt_İs.h
"

44 
	~"m’us.h
"

45 
	~"cut_n_·¡e.h
"

46 
	~"mes§ge.h
"

47 
	~"´eã»nûs.h
"

48 
	~"­p_´ocs.h
"

49 
	~"Ïy”_dŸlog.h
"

50 
	~"lßd_§ve.h
"

51 
	~"dŸ-´İs.h
"

52 
	~"»nd”_gdk.h
"

53 
	~"dŸŒªsfÜm.h
"

55 
GHashTabË
 *
	gdi¥Ïy_ht
 = 
NULL
;

56 
GdkCursÜ
 *
	gcu¼’t_cursÜ
 = 
NULL
;

58 
GdkCursÜ
 *
	gdeçuÉ_cursÜ
 = 
NULL
;

60 
DDi¥Ïy
 *
	gaùive_di¥Ïy
 = 
NULL
;

63 
	s_IReùªgË
 {

64 
	mtİ
, 
	mbÙtom
;

65 
	mËá
,
	mright
;

66 } 
	tIReùªgË
;

68 
gušt
 
di¥Ïy_hash
(
DDi¥Ïy
 *
ddi¥
);

71 
	$upd©e_zoom_¡©us
(
DDi¥Ïy
 *
ddi¥
)

73 
gch¬
* 
zoom_‹xt
;

75 ià(
	`is_š‹g¿‹d_ui
 ())

77 
zoom_‹xt
 = 
	`g_¡rdup_´štf
("%.0f%%",

78 
ddi¥
->
zoom_çùÜ
 * 100.0 / 
DDISPLAY_NORMAL_ZOOM
);

80 
	`š‹g¿‹d_ui_toŞb¬_£t_zoom_‹xt
 (
ddi¥
->
commÚ_toŞb¬
, 
zoom_‹xt
);

84 
GtkWidg‘
 *
zoomcombo
;

85 
zoom_‹xt
 = 
	`g_¡rdup_´štf
("%.1f%%",

86 
ddi¥
->
zoom_çùÜ
 * 100.0 / 
DDISPLAY_NORMAL_ZOOM
);

87 
zoomcombo
 = 
ddi¥
->
zoom_¡©us
;

88 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
 (
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
(
zoomcombo
), "user_data")),

89 
zoom_‹xt
);

92 
	`g_ä“
(
zoom_‹xt
);

93 
	}
}

96 
	$£ËùiÚ_chªged
 (
DŸg¿m
* 
dŸ
, 
n
, 
DDi¥Ïy
* 
ddi¥
)

98 
GtkStusb¬
 *
¡©usb¬
;

99 
gušt
 
cÚ‹xt_id
;

102 ià(
	`g_¦i¡_Ëngth
(
dŸ
->
di¥Ïys
) < 1)

105 
¡©usb¬
 = 
	`GTK_STATUSBAR
 (
ddi¥
->
modif›d_¡©us
);

106 
cÚ‹xt_id
 = 
	`gtk_¡©usb¬_g‘_cÚ‹xt_id
 (
¡©usb¬
, "Selection");

108 ià(
n
 > 1)

110 
gch¬
 *
msg
;

115 
msg
 = 
	`g_¡rdup_´štf
 (
	`ng‘‹xt
 ("S–eùiÚ oà%d objeù", "S–eùiÚ oà%d objeùs", 
n
),‚);

116 
	`gtk_¡©usb¬_pİ
 (
¡©usb¬
, 
cÚ‹xt_id
);

117 
	`gtk_¡©usb¬_push
 (
¡©usb¬
, 
cÚ‹xt_id
, 
msg
);

118 
	`g_ä“
 (
msg
);

120 ià(
n
 == 1)

123 
DŸObjeù
 *
objeù
 = (DŸObjeù *)
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
->data;

124 
gch¬
 *
Çme
 = 
	`objeù_g‘_di¥ÏyÇme
 (
objeù
);

125 
gch¬
 *
msg
 = 
	`g_¡rdup_´štf
 (
	`_
("S–eùed '%s'"), 
Çme
);

127 
	`gtk_¡©usb¬_pİ
 (
¡©usb¬
, 
cÚ‹xt_id
);

128 
	`gtk_¡©usb¬_push
 (
¡©usb¬
, 
cÚ‹xt_id
, 
msg
);

130 
	`g_ä“
 (
Çme
);

131 
	`g_ä“
 (
msg
);

135 
	`gtk_¡©usb¬_pİ
 (
¡©usb¬
, 
cÚ‹xt_id
);

138 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
 (
ddi¥
);

139 
	}
}

142 
	$­³nd_im_m’u
 (
DDi¥Ïy
* 
ddi¥
, 
GtkAùiÚ
* 
aùiÚ
)

144 
GSLi¡
 *
´ox›s
;

145 
GtkWidg‘
 *
im_m’u
;

148 
´ox›s
 = 
	`gtk_aùiÚ_g‘_´ox›s
 (
aùiÚ
);

149 
´ox›s
) {

150 ià(
	`GTK_IS_MENU_ITEM
 (
´ox›s
->
d©a
)) {

151 
im_m’u
 = 
	`gtk_m’u_Ãw
 ();

156 
	`gtk_im_muÉicÚ‹xt_­³nd_m’u™ems
 (

157 
	`GTK_IM_MULTICONTEXT
(
ddi¥
->
im_cÚ‹xt
),

158 
	`GTK_MENU_SHELL
(
im_m’u
));

159 
	`gtk_m’u_™em_£t_subm’u
 (
	`GTK_MENU_ITEM
(
´ox›s
->
d©a
), 
im_m’u
);

160 
	`gtk_widg‘_show
 (
	`GTK_WIDGET
 (
´ox›s
->
d©a
));

161 
	`gtk_widg‘_show
 (
	`GTK_WIDGET
 (
im_m’u
));

163 
´ox›s
 =…rox›s->
Ãxt
;

165 
	}
}

172 
	$š™Ÿlize_di¥Ïy_widg‘s
(
DDi¥Ïy
 *
ddi¥
)

174 
GtkAùiÚ
* 
im_m’u_™em
;

175 
gboŞ—n
 
šput_m‘hods_dÚe
 = 
FALSE
;

176 
DŸg¿m
 *
dŸ
 = 
ddi¥
->
dŸg¿m
;

177 
gch¬
 *
f’ame
;

181 
ddi¥
->
im_cÚ‹xt
 = 
	`gtk_im_muÉicÚ‹xt_Ãw
();

182 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
ddi¥
->
im_cÚ‹xt
), "commit",

183 
	`G_CALLBACK
 (
ddi¥Ïy_im_cÚ‹xt_comm™
), 
ddi¥
);

184 
ddi¥
->
´“d™_¡ršg
 = 
NULL
;

185 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
ddi¥
->
im_cÚ‹xt
), "preedit_changed",

186 
	`G_CALLBACK
 (
ddi¥Ïy_im_cÚ‹xt_´“d™_chªged
),

187 
ddi¥
);

188 
ddi¥
->
´“d™_©Œs
 = 
NULL
;

190 
f’ame
 = 
	`¡¼chr
(
dŸ
->f’ame, 
G_DIR_SEPARATOR
);

191 ià(
f’ame
==
NULL
) {

192 
f’ame
 = 
dŸ
->filename;

194 
f’ame
++;

196 
	`ü—‹_di¥Ïy_sh–l
(
ddi¥
, 
´efs
.
Ãw_v›w
.
width
,…»fs.Ãw_v›w.
height
,

197 
f’ame
, 
´efs
.
Ãw_v›w
.
u£_m’u_b¬
, !
	`­p_is_embedded
());

199 
	`ddi¥Ïy_upd©e_¡©usb¬
 (
ddi¥
);

201 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
, ddi¥->
visibË
.
Ëá
, ddi¥->visibË.
tİ
);

202 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

203 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

205 ià(!
di¥Ïy_ht
)

206 
di¥Ïy_ht
 = 
	`g_hash_bË_Ãw
 ((
GHashFunc
è
di¥Ïy_hash
, 
NULL
);

208 ià(!
	`­p_is_embedded
())

209 
	`ddi¥Ïy_£t_cursÜ
(
ddi¥
, 
cu¼’t_cursÜ
);

211 
	`g_hash_bË_š£¹
 (
di¥Ïy_ht
, 
ddi¥
->
sh–l
, ddisp);

212 
	`g_hash_bË_š£¹
 (
di¥Ïy_ht
, 
ddi¥
->
ÿnvas
, ddisp);

214 ià(!
šput_m‘hods_dÚe
) {

215 
im_m’u_™em
 = 
	`m’us_g‘_aùiÚ
 ("InputMethods");

216 
	`g_as£¹
 (
im_m’u_™em
);

217 
	`­³nd_im_m’u
 (
ddi¥
, 
im_m’u_™em
);

218 
šput_m‘hods_dÚe
 = 
TRUE
;

221 ià(
ddi¥
->
m’u_b¬
) {

222 
im_m’u_™em
 = 
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
ddi¥
->
aùiÚs
, "InputMethods");

223 
	`g_as£¹
 (
im_m’u_™em
);

224 
	`­³nd_im_m’u
 (
ddi¥
, 
im_m’u_™em
);

226 
	}
}

237 
DDi¥Ïy
 *

238 
	$cİy_di¥Ïy
(
DDi¥Ïy
 *
Üig_ddi¥
)

240 
DDi¥Ïy
 *
ddi¥
;

241 
DŸg¿m
 *
dŸ
 = 
Üig_ddi¥
->
dŸg¿m
;

243 
ddi¥
 = 
	`g_Ãw0
(
DDi¥Ïy
,1);

245 
ddi¥
->
dŸg¿m
 = 
Üig_ddi¥
->diagram;

247 
	`g_objeù_»f
(
dŸ
);

249 
ddi¥
->
grid
 = 
Üig_ddi¥
->grid;

251 
ddi¥
->
show_cx_±s
 = 
Üig_ddi¥
->show_cx_pts;

254 
ddi¥
->
autosüŞl
 = 
Üig_ddi¥
->autoscroll;

255 
ddi¥
->
mašpošt_magÃtism
 = 
Üig_ddi¥
->mainpoint_magnetism;

257 
ddi¥
->
¯_»nd””
 = 
Üig_ddi¥
->aa_renderer;

259 
ddi¥
->
upd©e_¬—s
 = 
Üig_ddi¥
->update_areas;

260 
ddi¥
->
di¥Ïy_¬—s
 = 
Üig_ddi¥
->display_areas;

261 
ddi¥
->
upd©e_id
 = 0;

263 
	`dŸg¿m_add_ddi¥Ïy
(
dŸ
, 
ddi¥
);

264 
	`g_sigÇl_cÚÃù
 (
dŸ
, "£ËùiÚ_chªged", 
	`G_CALLBACK
(
£ËùiÚ_chªged
), 
ddi¥
);

265 
ddi¥
->
Üigo
 = 
Üig_ddi¥
->origo;

266 
ddi¥
->
zoom_çùÜ
 = 
Üig_ddi¥
->zoom_factor;

267 
ddi¥
->
visibË
 = 
Üig_ddi¥
->visible;

269 
	`š™Ÿlize_di¥Ïy_widg‘s
(
ddi¥
);

270  
ddi¥
;

271 
	}
}

278 
DDi¥Ïy
 *

279 
	$Ãw_di¥Ïy
(
DŸg¿m
 *
dŸ
)

281 
DDi¥Ïy
 *
ddi¥
;

282 
ReùªgË
 
visibË
;

284 
ddi¥
 = 
	`g_Ãw0
(
DDi¥Ïy
,1);

286 
ddi¥
->
dŸg¿m
 = 
dŸ
;

288 
	`g_objeù_»f
(
dŸ
);

290 
ddi¥
->
grid
.
visibË
 = 
´efs
.grid.visible;

291 
ddi¥
->
grid
.
¢­
 = 
´efs
.grid.snap;

293 
ddi¥
->
show_cx_±s
 = 
´efs
.show_cx_pts;

295 
ddi¥
->
autosüŞl
 = 
TRUE
;

296 
ddi¥
->
mašpošt_magÃtism
 = 
´efs
.
¢­_objeù
;

298 
ddi¥
->
¯_»nd””
 = 
´efs
.
v›w_ªtŸli£d
;

300 
ddi¥
->
upd©e_¬—s
 = 
NULL
;

301 
ddi¥
->
di¥Ïy_¬—s
 = 
NULL
;

302 
ddi¥
->
upd©e_id
 = 0;

304 
	`dŸg¿m_add_ddi¥Ïy
(
dŸ
, 
ddi¥
);

305 
	`g_sigÇl_cÚÃù
 (
dŸ
, "£ËùiÚ_chªged", 
	`G_CALLBACK
(
£ËùiÚ_chªged
), 
ddi¥
);

306 
ddi¥
->
Üigo
.
x
 = 0.0;

307 
ddi¥
->
Üigo
.
y
 = 0.0;

308 
ddi¥
->
zoom_çùÜ
 = 
´efs
.
Ãw_v›w
.
zoom
/100.0*
DDISPLAY_NORMAL_ZOOM
;

309 ià((
ddi¥
->
dŸg¿m
è&& (ddi¥->dŸg¿m->
d©a
)) {

310 
ReùªgË
 *
ex‹Ás
 = &
ddi¥
->
dŸg¿m
->
d©a
->extents;

312 
visibË
.
Ëá
 = 
ex‹Ás
->left;

313 
visibË
.
tİ
 = 
ex‹Ás
->top;

315 
visibË
.
Ëá
 = 0.0;

316 
visibË
.
tİ
 = 0.0;

318 
visibË
.
right
 = visibË.
Ëá
 + 
´efs
.
Ãw_v›w
.
width
/
ddi¥
->
zoom_çùÜ
;

319 
visibË
.
bÙtom
 = visibË.
tİ
 + 
´efs
.
Ãw_v›w
.
height
/
ddi¥
->
zoom_çùÜ
;

321 
ddi¥
->
visibË
 = visible;

323 
	`š™Ÿlize_di¥Ïy_widg‘s
(
ddi¥
);

324  
ddi¥
;

325 
	}
}

327 
gušt


328 
	$di¥Ïy_hash
(
DDi¥Ïy
 *
ddi¥
)

330  (
gulÚg
è
ddi¥
;

331 
	}
}

334 
	$ddi¥Ïy_ŒªsfÜm_coÜds_doubË
(
DDi¥Ïy
 *
ddi¥
,

335 
coÜd
 
x
, coÜd 
y
,

336 *
xi
, *
yi
)

338 
ReùªgË
 *
visibË
 = &
ddi¥
->visible;

339 
width
 = 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
);

340 
height
 = 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
);

342 *
xi
 = (
x
 - 
visibË
->
Ëá
è* (
»®
)
width
 / (visibË->
right
 - visible->left);

343 *
yi
 = (
y
 - 
visibË
->
tİ
è* (
»®
)
height
 / (visibË->
bÙtom
 - visible->top);

344 
	}
}

348 
	$ddi¥Ïy_ŒªsfÜm_coÜds
(
DDi¥Ïy
 *
ddi¥
,

349 
coÜd
 
x
, coÜd 
y
,

350 *
xi
, *
yi
)

352 
ReùªgË
 *
visibË
 = &
ddi¥
->visible;

353 
width
 = 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
);

354 
height
 = 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
);

356 *
xi
 = 
	`ROUND
 ( (
x
 - 
visibË
->
Ëá
è* (
»®
)
width
 /

357 (
visibË
->
right
 - visibË->
Ëá
) );

358 *
yi
 = 
	`ROUND
 ( (
y
 - 
visibË
->
tİ
è* (
»®
)
height
 /

359 (
visibË
->
bÙtom
 - visibË->
tİ
) );

360 
	}
}

363 
»®


364 
	$ddi¥Ïy_ŒªsfÜm_Ëngth
(
DDi¥Ïy
 *
ddi¥
, 
»®
 
Ën
)

366  
Ën
 * 
ddi¥
->
zoom_çùÜ
;

367 
	}
}

370 
»®


371 
	$ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
DDi¥Ïy
 *
ddi¥
, 
»®
 
Ën
)

373  
Ën
 / 
ddi¥
->
zoom_çùÜ
;

374 
	}
}

378 
	$ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
DDi¥Ïy
 *
ddi¥
,

379 
xi
, 
yi
,

380 
coÜd
 *
x
, coÜd *
y
)

382 
ReùªgË
 *
visibË
 = &
ddi¥
->visible;

383 
width
 = 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
);

384 
height
 = 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
);

386 *
x
 = 
visibË
->
Ëá
 + 
xi
*(visibË->
right
 - visibË->Ëáè/ (
»®
)
width
;

387 *
y
 = 
visibË
->
tİ
 + 
yi
*(visibË->
bÙtom
 - visibË->tİè/ (
»®
)
height
;

388 
	}
}

392 
	$ddi¥Ïy_add_upd©e_pix–s
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
pošt
,

393 
pix–_width
, 
pix–_height
)

395 
ReùªgË
 
»ù
;

396 
»®
 
size_x
, 
size_y
;

398 
size_x
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 
pix–_width
+1);

399 
size_y
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 
pix–_height
+1);

401 
»ù
.
Ëá
 = 
pošt
->
x
 - 
size_x
/2.0;

402 
»ù
.
tİ
 = 
pošt
->
y
 - 
size_y
/2.0;

403 
»ù
.
right
 = 
pošt
->
x
 + 
size_x
/2.0;

404 
»ù
.
bÙtom
 = 
pošt
->
y
 + 
size_y
/2.0;

406 
	`ddi¥Ïy_add_upd©e
(
ddi¥
, &
»ù
);

407 
	}
}

411 
	$ddi¥Ïy_ä“_di¥Ïy_¬—s
(
DDi¥Ïy
 *
ddi¥
)

413 
GSLi¡
 *
l
;

414 
l
 = 
ddi¥
->
di¥Ïy_¬—s
;

415 
l
!=
NULL
) {

416 
	`g_ä“
(
l
->
d©a
);

417 
l
 = 
	`g_¦i¡_Ãxt
(l);

419 
	`g_¦i¡_ä“
(
ddi¥
->
di¥Ïy_¬—s
);

420 
ddi¥
->
di¥Ïy_¬—s
 = 
NULL
;

421 
	}
}

425 
	$ddi¥Ïy_ä“_upd©e_¬—s
(
DDi¥Ïy
 *
ddi¥
)

427 
GSLi¡
 *
l
;

428 
l
 = 
ddi¥
->
upd©e_¬—s
;

429 
l
!=
NULL
) {

430 
	`g_ä“
(
l
->
d©a
);

431 
l
 = 
	`g_¦i¡_Ãxt
(l);

433 
	`g_¦i¡_ä“
(
ddi¥
->
upd©e_¬—s
);

434 
ddi¥
->
upd©e_¬—s
 = 
NULL
;

435 
	}
}

441 
	$ddi¥Ïy_add_upd©e_®l
(
DDi¥Ïy
 *
ddi¥
)

443 ià(
ddi¥
->
upd©e_¬—s
 !ğ
NULL
) {

444 
	`ddi¥Ïy_ä“_upd©e_¬—s
(
ddi¥
);

446 ià(
ddi¥
->
di¥Ïy_¬—s
 !ğ
NULL
) {

447 
	`ddi¥Ïy_ä“_di¥Ïy_¬—s
(
ddi¥
);

449 
	`ddi¥Ïy_add_upd©e
(
ddi¥
, &ddi¥->
visibË
);

450 
	}
}

455 
	$ddi¥Ïy_add_upd©e_w™h_bÜd”
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
»ù
,

456 
pix–_bÜd”
)

458 
ReùªgË
 
r
;

459 
»®
 
size
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 
pix–_bÜd”
+1);

461 
r
.
Ëá
 = 
»ù
->Ëá-
size
;

462 
r
.
tİ
 = 
»ù
->tİ-
size
;

463 
r
.
right
 = 
»ù
->right+
size
;

464 
r
.
bÙtom
 = 
»ù
->bÙtom+
size
;

466 
	`ddi¥Ïy_add_upd©e
(
ddi¥
, &
r
);

467 
	}
}

470 
	$ddi¥Ïy_add_upd©e
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
»ù
)

472 
ReùªgË
 *
r
;

473 
tİ
,
bÙtom
,
Ëá
,
right
;

474 
ReùªgË
 *
visibË
;

475 
width
, 
height
;

477 ià(!
ddi¥
->
»nd””
)

479 
width
 = 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
);

480 
height
 = 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
);

482 ià(!
	`»ùªgË_š‹r£ùs
(
»ù
, &
ddi¥
->
visibË
))

486 ià(
ddi¥
->
upd©e_¬—s
==
NULL
) {

487 
r
 = 
	`g_Ãw
(
ReùªgË
,1);

488 *
r
 = *
»ù
;

489 
	`»ùªgË_š‹r£ùiÚ
(
r
, &
ddi¥
->
visibË
);

490 
ddi¥
->
upd©e_¬—s
 = 
	`g_¦i¡_´•’d
(ddi¥->upd©e_¬—s, 
r
);

492 
r
 = (
ReùªgË
 *è
ddi¥
->
upd©e_¬—s
->
d©a
;

493 
	`»ùªgË_uniÚ
(
r
, 
»ù
);

494 
	`»ùªgË_š‹r£ùiÚ
(
r
, &
ddi¥
->
visibË
);

497 
visibË
 = &
ddi¥
->visible;

498 
Ëá
 = 
	`æoÜ
Ğ(
r
->Ëá - 
visibË
->Ëáè* (
»®
)
width
 /

499 (
visibË
->
right
 - visibË->
Ëá
) ) - 1;

500 
tİ
 = 
	`æoÜ
Ğ(
r
->tİ - 
visibË
->tİè* (
»®
)
height
 /

501 (
visibË
->
bÙtom
 - visibË->
tİ
) ) - 1;

502 
right
 = 
	`û
Ğ(
r
->righˆ- 
visibË
->
Ëá
è* (
»®
)
width
 /

503 (
visibË
->
right
 - visibË->
Ëá
) ) + 1;

504 
bÙtom
 = 
	`û
Ğ(
r
->bÙtom - 
visibË
->
tİ
è* (
»®
)
height
 /

505 (
visibË
->
bÙtom
 - visibË->
tİ
) ) + 1;

507 
	`ddi¥Ïy_add_di¥Ïy_¬—
(
ddi¥
,

508 
Ëá
, 
tİ
,

509 
right
, 
bÙtom
);

510 
	}
}

513 
	$ddi¥Ïy_add_di¥Ïy_¬—
(
DDi¥Ïy
 *
ddi¥
,

514 
Ëá
, 
tİ
,

515 
right
, 
bÙtom
)

517 
IReùªgË
 *
r
;

519 ià(!
ddi¥
->
»nd””
)

521 ià(
Ëá
 < 0)

522 
Ëá
 = 0;

523 ià(
tİ
 < 0)

524 
tİ
 = 0;

525 ià(
right
 > 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
))

526 
right
 = 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
);

527 ià(
bÙtom
 > 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
))

528 
bÙtom
 = 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
);

534 ià(
ddi¥
->
di¥Ïy_¬—s
==
NULL
) {

535 
r
 = 
	`g_Ãw
(
IReùªgË
,1);

536 
r
->
tİ
 =İ;„->
bÙtom
 = bottom;

537 
r
->
Ëá
 =†eá;„->
right
 =„ight;

538 
ddi¥
->
di¥Ïy_¬—s
 = 
	`g_¦i¡_´•’d
(ddi¥->di¥Ïy_¬—s, 
r
);

540 
r
 = (
IReùªgË
 *è
ddi¥
->
di¥Ïy_¬—s
->
d©a
;

542 
r
->
tİ
 = 
	`MIN
(„->top,op );

543 
r
->
bÙtom
 = 
	`MAX
(„->bottom, bottom );

544 
r
->
Ëá
 = 
	`MIN
(„->left,†eft );

545 
r
->
right
 = 
	`MAX
(„->right,„ight );

547 
	}
}

549 
gboŞ—n


550 
	$ddi¥Ïy_upd©e_hªdËr
(
DDi¥Ïy
 *
ddi¥
)

552 
GSLi¡
 *
l
;

553 
IReùªgË
 *
œ
;

554 
ReùªgË
 *
r
, 
tÙ»ù
;

555 
DŸIÁ”aùiveR’d””IÁ”çû
 *
»nd””
;

558 
»nd””
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ddi¥
->renderer);

561 
l
 = 
ddi¥
->
upd©e_¬—s
;

562 ià(
l
 !ğ
NULL
)

564 
tÙ»ù
 = *(
ReùªgË
 *è
l
->
d©a
;

566 
	`g_»tuº_v®_if_ç
 ( 
»nd””
->
ş_»giÚ_ş—r
 !ğ
NULL


567 && 
»nd””
->
ş_»giÚ_add_»ù
 !ğ
NULL
, 
FALSE
);

569 
»nd””
->
	`ş_»giÚ_ş—r
 (
ddi¥
->renderer);

571 
l
!=
NULL
) {

572 
r
 = (
ReùªgË
 *è
l
->
d©a
;

574 
	`»ùªgË_uniÚ
(&
tÙ»ù
, 
r
);

575 
»nd””
->
	`ş_»giÚ_add_»ù
 (
ddi¥
->»nd””, 
r
);

577 
l
 = 
	`g_¦i¡_Ãxt
(l);

580 
	`ddi¥Ïy_ä“_upd©e_¬—s
(
ddi¥
);

582 
tÙ»ù
.
Ëá
 -= 0.1;

583 
tÙ»ù
.
right
 += 0.1;

584 
tÙ»ù
.
tİ
 -= 0.1;

585 
tÙ»ù
.
bÙtom
 += 0.1;

587 
	`ddi¥Ïy_»nd”_pixm­
(
ddi¥
, &
tÙ»ù
);

590 
l
 = 
ddi¥
->
di¥Ïy_¬—s
;

591 
l
!=
NULL
) {

592 
œ
 = (
IReùªgË
 *è
l
->
d©a
;

594 
	`g_»tuº_v®_if_ç
 (
»nd””
->
cİy_to_wšdow
, 
FALSE
);

595 
»nd””
->
	`cİy_to_wšdow
(
ddi¥
->renderer,

596 
ddi¥
->
ÿnvas
->
wšdow
,

597 
œ
->
Ëá
, ir->
tİ
,

598 
œ
->
right
 - ir->
Ëá
, ir->
bÙtom
 - ir->
tİ
);

600 
l
 = 
	`g_¦i¡_Ãxt
(l);

603 
	`ddi¥Ïy_ä“_di¥Ïy_¬—s
(
ddi¥
);

605 
ddi¥
->
upd©e_id
 = 0;

607  
FALSE
;

608 
	}
}

611 
	$ddi¥Ïy_æush
(
DDi¥Ïy
 *
ddi¥
)

614 ià(!
ddi¥
->
upd©e_id
)

615 
ddi¥
->
upd©e_id
 = 
	`g_idË_add_fuÎ
 (
G_PRIORITY_DEFAULT_IDLE
, (
GSourûFunc
)
ddi¥Ïy_upd©e_hªdËr
, ddi¥, 
NULL
);

616 
	}
}

619 
	$ddi¥Ïy_obj_»nd”
(
DŸObjeù
 *
obj
, 
DŸR’d””
 *
»nd””
,

620 
aùive_Ïy”
,

621 
gpoš‹r
 
d©a
)

623 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
d©a
;

624 
i
;

626 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_objeù
Ô’d””, 
obj
);

627 ià(
ddi¥
->
show_cx_±s
 &&

628 
obj
->
·»Á_Ïy”
 !ğ
NULL
 && obj->·»Á_Ïy”->
cÚÃùabË
) {

629 
i
=0;i<
obj
->
num_cÚÃùiÚs
;i++) {

630 
	`cÚÃùiÚpošt_d¿w
(
obj
->
cÚÃùiÚs
[
i
], 
ddi¥
);

633 
	}
}

636 
	$ddi¥Ïy_»nd”_pixm­
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
upd©e
)

638 
GLi¡
 *
li¡
;

639 
DŸObjeù
 *
obj
;

640 
i
;

641 
DŸIÁ”aùiveR’d””IÁ”çû
 *
»nd””
;

642 #ifdeà
TRACES


643 
GTim”
 *
tim”
;

646 ià(
ddi¥
->
»nd””
==
NULL
) {

647 
	`´štf
("ERROR! Renderer was NULL!!\n");

651 
»nd””
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ddi¥
->renderer);

654 
	`g_»tuº_if_ç
 (
»nd””
->
fl_pix–_»ù
 !ğ
NULL
);

655 
	`DIA_RENDERER_GET_CLASS
(
ddi¥
->
»nd””
)->
	`begš_»nd”
(ddisp->renderer);

656 
»nd””
->
	`fl_pix–_»ù
 (
ddi¥
->renderer,

658 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
),

659 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
),

660 &
ddi¥
->
dŸg¿m
->
d©a
->
bg_cŞÜ
);

663 
	`grid_d¿w
(
ddi¥
, 
upd©e
);

664 
	`·geb»ak_d¿w
(
ddi¥
, 
upd©e
);

666 #ifdeà
TRACES


667 
tim”
 = 
	`g_tim”_Ãw
();

669 
	`d©a_»nd”
(
ddi¥
->
dŸg¿m
->
d©a
, ddi¥->
»nd””
, 
upd©e
,

670 
ddi¥Ïy_obj_»nd”
, (
gpoš‹r
è
ddi¥
);

671 #ifdeà
TRACES


672 
	`g_´št
 ("d©a_»nd”(%g%%ètook %g secÚds\n", 
ddi¥
->
zoom_çùÜ
 * 5.0, 
	`g_tim”_–­£d
 (
tim”
, 
NULL
));

673 
	`g_tim”_de¡roy
 (
tim”
);

676 
li¡
 = 
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
;

677 
li¡
!=
NULL
) {

678 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

680 
i
=0;i<
obj
->
num_hªdËs
;i++) {

681 
	`hªdË_d¿w
(
obj
->
hªdËs
[
i
], 
ddi¥
);

683 
li¡
 = 
	`g_li¡_Ãxt
(list);

685 
	`DIA_RENDERER_GET_CLASS
(
ddi¥
->
»nd””
)->
	`’d_»nd”
(ddisp->renderer);

686 
	}
}

689 
	$ddi¥Ïy_upd©e_süŞlb¬s
(
DDi¥Ïy
 *
ddi¥
)

691 
ReùªgË
 *
ex‹Ás
 = &
ddi¥
->
dŸg¿m
->
d©a
->extents;

692 
ReùªgË
 *
visibË
 = &
ddi¥
->visible;

693 
GtkAdju¡m’t
 *
hsbd©a
, *
vsbd©a
;

695 
hsbd©a
 = 
ddi¥
->hsbdata;

697 
hsbd©a
->
low”
 = 
	`MIN
(
ex‹Ás
->
Ëá
, 
visibË
->left);

698 
hsbd©a
->
uµ”
 = 
	`MAX
(
ex‹Ás
->
right
, 
visibË
->right);

699 
hsbd©a
->
·ge_size
 = 
visibË
->
right
 - visibË->
Ëá
 - 0.0001;

701 
hsbd©a
->
·ge_šüem’t
 = (
visibË
->
right
 - visibË->
Ëá
) / 2.0;

702 
hsbd©a
->
¡•_šüem’t
 = (
visibË
->
right
 - visibË->
Ëá
) / 10.0;

703 
hsbd©a
->
v®ue
 = 
visibË
->
Ëá
;

705 
	`g_sigÇl_em™_by_Çme
 (
	`G_OBJECT
 (
ddi¥
->
hsbd©a
), "changed");

708 
vsbd©a
 = 
ddi¥
->vsbdata;

709 
vsbd©a
->
low”
 = 
	`MIN
(
ex‹Ás
->
tİ
, 
visibË
->top);

710 
vsbd©a
->
uµ”
 = 
	`MAX
(
ex‹Ás
->
bÙtom
, 
visibË
->bottom);

711 
vsbd©a
->
·ge_size
 = 
visibË
->
bÙtom
 - visibË->
tİ
 - 0.00001;

713 
vsbd©a
->
·ge_šüem’t
 = (
visibË
->
bÙtom
 - visibË->
tİ
) / 2.0;

714 
vsbd©a
->
¡•_šüem’t
 = (
visibË
->
bÙtom
 - visibË->
tİ
) / 10.0;

715 
vsbd©a
->
v®ue
 = 
visibË
->
tİ
;

717 
	`g_sigÇl_em™_by_Çme
 (
	`G_OBJECT
 (
ddi¥
->
vsbd©a
), "changed");

718 
	}
}

721 
	$ddi¥Ïy_£t_Üigo
(
DDi¥Ïy
 *
ddi¥
, 
coÜd
 
x
, coÜd 
y
)

723 
ReùªgË
 *
ex‹Ás
 = &
ddi¥
->
dŸg¿m
->
d©a
->extents;

724 
ReùªgË
 *
visibË
 = &
ddi¥
->visible;

725 
width
, 
height
;

728 
ddi¥
->
Üigo
.
x
 = x;

729 
ddi¥
->
Üigo
.
y
 = y;

731 ià(
ddi¥
->
zoom_çùÜ
<
DDISPLAY_MIN_ZOOM
)

732 
ddi¥
->
zoom_çùÜ
 = 
DDISPLAY_MIN_ZOOM
;

734 ià(
ddi¥
->
zoom_çùÜ
 > 
DDISPLAY_MAX_ZOOM
)

735 
ddi¥
->
zoom_çùÜ
 = 
DDISPLAY_MAX_ZOOM
;

737 
width
 = 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
);

738 
height
 = 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
);

740 
visibË
->
Ëá
 = 
ddi¥
->
Üigo
.
x
;

741 
visibË
->
tİ
 = 
ddi¥
->
Üigo
.
y
;

742 
visibË
->
right
 = 
ddi¥
->
Üigo
.
x
 + 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(ddi¥, 
width
);

743 
visibË
->
bÙtom
 = 
ddi¥
->
Üigo
.
y
 + 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(ddi¥, 
height
);

745 
	`gtk_ruËr_£t_¿nge
 (
	`GTK_RULER
 (
ddi¥
->
hruË
),

746 
visibË
->
Ëá
,

747 
visibË
->
right
,

749 
	`MAX
(
ex‹Ás
->
right
, 
visibË
->right) );

750 
	`gtk_ruËr_£t_¿nge
 (
	`GTK_RULER
 (
ddi¥
->
vruË
),

751 
visibË
->
tİ
,

752 
visibË
->
bÙtom
,

754 
	`MAX
(
ex‹Ás
->
bÙtom
, 
visibË
->bottom) );

755 
	}
}

758 
	$ddi¥Ïy_zoom
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
pošt
, 
»®
 
magnify
)

760 
ReùªgË
 *
visibË
;

761 
»®
 
width
, 
height
, 
Şd_zoom
;

763 
visibË
 = &
ddi¥
->visible;

765 ià((
ddi¥
->
zoom_çùÜ
 <ğ
DDISPLAY_MIN_ZOOM
è&& (
magnify
<=1.0))

767 ià((
ddi¥
->
zoom_çùÜ
 >ğ
DDISPLAY_MAX_ZOOM
è&& (
magnify
>=1.0))

770 
Şd_zoom
 = 
ddi¥
->
zoom_çùÜ
;

771 
ddi¥
->
zoom_çùÜ
 = 
Şd_zoom
 * 
magnify
;

774 ià(
ddi¥
->
zoom_çùÜ
 < 
DDISPLAY_MIN_ZOOM
)

775 
ddi¥
->
zoom_çùÜ
 = 
DDISPLAY_MIN_ZOOM
;

776 ià(
ddi¥
->
zoom_çùÜ
 > 
DDISPLAY_MAX_ZOOM
)

777 
ddi¥
->
zoom_çùÜ
 = 
DDISPLAY_MAX_ZOOM
;

780 
magnify
 = 
ddi¥
->
zoom_çùÜ
 / 
Şd_zoom
;

781 
width
 = (
visibË
->
right
 - visibË->
Ëá
)/
magnify
;

782 
height
 = (
visibË
->
bÙtom
 - visibË->
tİ
)/
magnify
;

785 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
, 
pošt
->
x
 - 
width
/2.0,…ošt->
y
 - 
height
/2.0);

787 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

788 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

789 
	`ddi¥Ïy_æush
(
ddi¥
);

791 
	`upd©e_zoom_¡©us
 (
ddi¥
);

792 
	}
}

801 
	$ddi¥Ïy_zoom_ûÁ”ed
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
pošt
, 
»®
 
magnify
)

803 
ReùªgË
 *
visibË
;

804 
»®
 
width
, 
height
;

806 
»®
 
rx
,
ry
;

808 ià((
ddi¥
->
zoom_çùÜ
 <ğ
DDISPLAY_MIN_ZOOM
è&& (
magnify
<=1.0))

810 ià((
ddi¥
->
zoom_çùÜ
 >ğ
DDISPLAY_MAX_ZOOM
è&& (
magnify
>=1.0))

813 
visibË
 = &
ddi¥
->visible;

816 
rx
 = (
pošt
->
x
-
visibË
->
Ëá
)/(visibË->
right
 - visible->left);

817 
ry
 = (
pošt
->
y
-
visibË
->
tİ
)/(visibË->
bÙtom
 - visible->top);

819 
width
 = (
visibË
->
right
 - visibË->
Ëá
)/
magnify
;

820 
height
 = (
visibË
->
bÙtom
 - visibË->
tİ
)/
magnify
;

822 
ddi¥
->
zoom_çùÜ
 *ğ
magnify
;

825 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
, 
pošt
->
x
-(
width
*
rx
),pošt->
y
-(
height
*
ry
));

827 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

828 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

829 
	`ddi¥Ïy_æush
(
ddi¥
);

831 
	`upd©e_zoom_¡©us
 (
ddi¥
);

832 
	}
}

837 
	$ddi¥Ïy_£t_¢­_to_grid
(
DDi¥Ïy
 *
ddi¥
, 
gboŞ—n
 
¢­
)

839 
GtkToggËAùiÚ
 *
¢­_to_grid
;

840 
ddi¥
->
grid
.
¢­
 = snap;

842 ià(
ddi¥
->
m’u_b¬
 =ğ
NULL
) {

843 
¢­_to_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`m’us_g‘_aùiÚ
 ("ViewSnaptogrid"));

844 ià(
	`is_š‹g¿‹d_ui
 ())

845 
	`š‹g¿‹d_ui_toŞb¬_grid_¢­_synchrÚize_to_di¥Ïy
 (
ddi¥
);

847 
¢­_to_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
ddi¥
->
aùiÚs
, "ViewSnaptogrid"));

851 
	`gtk_toggË_aùiÚ_£t_aùive
 (
¢­_to_grid
, 
ddi¥
->
grid
.
¢­
);

852 
	`ddi¥Ïy_upd©e_¡©usb¬
(
ddi¥
);

853 
	}
}

857 
	$upd©e_¢­_grid_¡©us
(
DDi¥Ïy
 *
ddi¥
)

859 ià(
ddi¥
->
grid_¡©us
)

861 
	`gtk_toggË_bu‰Ú_£t_aùive
 (
	`GTK_TOGGLE_BUTTON
 (
ddi¥
->
grid_¡©us
),

862 
ddi¥
->
grid
.
¢­
);

864 
	}
}

869 
	$ddi¥Ïy_£t_¢­_to_objeùs
(
DDi¥Ïy
 *
ddi¥
, 
gboŞ—n
 
magÃtic
)

871 
GtkToggËAùiÚ
 *
mašpošt_magÃtism
;

872 
ddi¥
->
mašpošt_magÃtism
 = 
magÃtic
;

874 ià(
ddi¥
->
m’u_b¬
 =ğ
NULL
) {

875 
mašpošt_magÃtism
 = 
	`GTK_TOGGLE_ACTION
 (
	`m’us_g‘_aùiÚ
 ("ViewSnaptoobjects"));

876 ià(
	`is_š‹g¿‹d_ui
 ())

877 
	`š‹g¿‹d_ui_toŞb¬_objeù_¢­_synchrÚize_to_di¥Ïy
 (
ddi¥
);

879 
mašpošt_magÃtism
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
ddi¥
->
aùiÚs
, "ViewSnaptoobjects"));

884 
	`gtk_toggË_aùiÚ_£t_aùive
 (
mašpošt_magÃtism
, 
ddi¥
->mainpoint_magnetism);

885 
	`ddi¥Ïy_upd©e_¡©usb¬
(
ddi¥
);

886 
	}
}

890 
	$upd©e_mašpošt_¡©us
(
DDi¥Ïy
 *
ddi¥
)

892 ià(
ddi¥
->
mašpošt_¡©us
)

894 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
ddi¥
->
mašpošt_¡©us
),

895 
ddi¥
->
mašpošt_magÃtism
);

897 
	}
}

900 
gboŞ—n


901 
	$ddi¥Ïy_autosüŞl
(
DDi¥Ïy
 *
ddi¥
, 
x
, 
y
)

903 
gušt16
 
width
, 
height
;

904 
Pošt
 
süŞl
;

906 ià(! 
ddi¥
->
autosüŞl
)

907  
FALSE
;

909 
süŞl
.
x
 = süŞl.
y
 = 0;

911 
width
 = 
	`GTK_WIDGET
(
ddi¥
->
ÿnvas
)->
®loÿtiÚ
.width;

912 
height
 = 
	`GTK_WIDGET
(
ddi¥
->
ÿnvas
)->
®loÿtiÚ
.height;

914 ià(
x
 < 0)

916 
süŞl
.
x
 = x;

918 iàĞ
x
 > 
width
)

920 
süŞl
.
x
 = x - 
width
;

923 ià(
y
 < 0)

925 
süŞl
.
y
 = y;

927 ià(
y
 > 
height
)

929 
süŞl
.
y
 = y - 
height
;

932 ià((
süŞl
.
x
 !ğ0è|| (süŞl.
y
 != 0))

934 
gboŞ—n
 
süŞËd
;

936 
süŞl
.
x
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, scroll.x);

937 
süŞl
.
y
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, scroll.y);

939 
süŞËd
 = 
	`ddi¥Ïy_süŞl
(
ddi¥
, &
süŞl
);

941 ià(
süŞËd
) {

942 
	`ddi¥Ïy_æush
(
ddi¥
);

943  
TRUE
;

946  
FALSE
;

947 
	}
}

950 
gboŞ—n


951 
	$ddi¥Ïy_süŞl
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
d–
)

953 
ReùªgË
 *
visibË
 = &
ddi¥
->visible;

954 
»®
 
width
 = 
visibË
->
right
 - visibË->
Ëá
;

955 
»®
 
height
 = 
visibË
->
bÙtom
 - visibË->
tİ
;

957 
ReùªgË
 
ex‹Ás
 = 
ddi¥
->
dŸg¿m
->
d©a
->extents;

958 
»®
 
ex_width
 = 
ex‹Ás
.
right
 -ƒx‹Ás.
Ëá
;

959 
»®
 
ex_height
 = 
ex‹Ás
.
bÙtom
 -ƒx‹Ás.
tİ
;

961 
Pošt
 
Ãw_Üigo
 = 
ddi¥
->
Üigo
;

962 
	`pošt_add
(&
Ãw_Üigo
, 
d–
);

964 
	`»ùªgË_uniÚ
(&
ex‹Ás
, 
visibË
);

966 ià(
Ãw_Üigo
.
x
 < 
ex‹Ás
.
Ëá
 - 
ex_width
)

967 
Ãw_Üigo
.
x
 = 
ex‹Ás
.
Ëá
 - 
ex_width
;

969 ià(
Ãw_Üigo
.
x
+
width
 > 
ex‹Ás
.
right
 + 
ex_width
)

970 
Ãw_Üigo
.
x
 = 
ex‹Ás
.
right
 - 
width
 + 
ex_width
;

972 ià(
Ãw_Üigo
.
y
 < 
ex‹Ás
.
tİ
 - 
ex_height
)

973 
Ãw_Üigo
.
y
 = 
ex‹Ás
.
tİ
 - 
ex_height
;

975 ià(
Ãw_Üigo
.
y
+
height
 > 
ex‹Ás
.
bÙtom
 + 
ex_height
)

976 
Ãw_Üigo
.
y
 = 
ex‹Ás
.
bÙtom
 - 
height
 + 
ex_height
;

978 iàĞ(
Ãw_Üigo
.
x
 !ğ
ddi¥
->
Üigo
.x) ||

979 (
Ãw_Üigo
.
y
 !ğ
ddi¥
->
Üigo
.y) ) {

980 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
, 
Ãw_Üigo
.
x
,‚ew_Üigo.
y
);

981 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

982 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

983  
TRUE
;

985  
FALSE
;

986 
	}
}

988 
	$ddi¥Ïy_süŞl_up
(
DDi¥Ïy
 *
ddi¥
)

990 
Pošt
 
d–
;

992 
d–
.
x
 = 0;

993 
d–
.
y
 = -(
ddi¥
->
visibË
.
bÙtom
 - ddi¥->visibË.
tİ
)/4.0;

995 
	`ddi¥Ïy_süŞl
(
ddi¥
, &
d–
);

996 
	}
}

998 
	$ddi¥Ïy_süŞl_down
(
DDi¥Ïy
 *
ddi¥
)

1000 
Pošt
 
d–
;

1002 
d–
.
x
 = 0;

1003 
d–
.
y
 = (
ddi¥
->
visibË
.
bÙtom
 - ddi¥->visibË.
tİ
)/4.0;

1005 
	`ddi¥Ïy_süŞl
(
ddi¥
, &
d–
);

1006 
	}
}

1008 
	$ddi¥Ïy_süŞl_Ëá
(
DDi¥Ïy
 *
ddi¥
)

1010 
Pošt
 
d–
;

1012 
d–
.
x
 = -(
ddi¥
->
visibË
.
right
 - ddi¥->visibË.
Ëá
)/4.0;

1013 
d–
.
y
 = 0;

1015 
	`ddi¥Ïy_süŞl
(
ddi¥
, &
d–
);

1016 
	}
}

1018 
	$ddi¥Ïy_süŞl_right
(
DDi¥Ïy
 *
ddi¥
)

1020 
Pošt
 
d–
;

1022 
d–
.
x
 = (
ddi¥
->
visibË
.
right
 - ddi¥->visibË.
Ëá
)/4.0;

1023 
d–
.
y
 = 0;

1025 
	`ddi¥Ïy_süŞl
(
ddi¥
, &
d–
);

1026 
	}
}

1030 
gboŞ—n


1031 
	$ddi¥Ïy_süŞl_ûÁ”_pošt
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
p
)

1033 
Pošt
 
ûÁ”
;

1036 
ûÁ”
.
x
 = (
ddi¥
->
visibË
.
right
+ddi¥->visibË.
Ëá
)/2;

1037 
ûÁ”
.
y
 = (
ddi¥
->
visibË
.
tİ
+ddi¥->visibË.
bÙtom
)/2;

1039 
	`pošt_sub
(
p
, &
ûÁ”
);

1040  
	`ddi¥Ïy_süŞl
(
ddi¥
, 
p
);

1041 
	}
}

1045 
gboŞ—n


1046 
	$ddi¥Ïy_süŞl_to_objeù
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
)

1048 
ReùªgË
 
r
 = 
obj
->
boundšg_box
;

1050 
Pošt
 
p
;

1051 
p
.
x
 = (
r
.
Ëá
+r.
right
)/2;

1052 
p
.
y
 = (
r
.
tİ
+r.
bÙtom
)/2;

1054 
	`di¥Ïy_£t_aùive
(
ddi¥
);

1055  
	`ddi¥Ïy_süŞl_ûÁ”_pošt
(
ddi¥
, &
p
);

1056 
	}
}

1060 
gboŞ—n


1061 
	$ddi¥Ïy_´e£Á_objeù
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
)

1063 cÚ¡ 
ReùªgË
 *
r
 = 
	`dŸ_objeù_g‘_’şosšg_box
(
obj
);

1064 cÚ¡ 
ReùªgË
 *
v
 = &
ddi¥
->
visibË
;

1066 
	`di¥Ïy_£t_aùive
(
ddi¥
);

1067 ià(!
	`»ùªgË_š_»ùªgË
(
v
, 
r
)) {

1068 
Pošt
 
d–
 = { 0, 0 };

1070 ià((
r
->
right
 -„->
Ëá
è> (
v
->right - v->left))

1071 
d–
.
x
 = (
r
->
Ëá
 - 
v
->Ëá +„->
right
 - v->right) / 2;

1072 ià(
r
->
Ëá
 < 
v
->left)

1073 
d–
.
x
 = 
r
->
Ëá
 - 
v
->left;

1074 ià(
r
->
right
 > 
v
->right)

1075 
d–
.
x
 = 
r
->
right
 - 
v
->right;

1077 ià((
r
->
bÙtom
 -„->
tİ
è> (
v
->bottom - v->top))

1078 
d–
.
y
 = (
r
->
tİ
 - 
v
->tİ +„->
bÙtom
 - v->bottom) / 2;

1079 ià(
r
->
tİ
 < 
v
->top)

1080 
d–
.
y
 = 
r
->
tİ
 - 
v
->top;

1081 ià(
r
->
bÙtom
 > 
v
->bottom)

1082 
d–
.
y
 = 
r
->
bÙtom
 - 
v
->bottom;

1084 
	`ddi¥Ïy_süŞl
(
ddi¥
, &
d–
);

1085  
TRUE
;

1087  
FALSE
;

1088 
	}
}

1096 
DŸR’d””
 *

1097 
	$Ãw_¯_»nd””
 (
DDi¥Ïy
 *
ddi¥
)

1099 
GTy³
 
»nd””_ty³
;

1101 
»nd””_ty³
 = 
	`g_ty³_äom_Çme
 ("DiaLibartRenderer");

1102 ià(
»nd””_ty³
) {

1103 
DŸR’d””
 *
»nd””
 = 
	`g_objeù_Ãw
(
»nd””_ty³
, 
NULL
);

1104 
	`g_objeù_£t
 (
»nd””
,

1105 "ŒªsfÜm", 
	`dŸ_ŒªsfÜm_Ãw
 (&
ddi¥
->
visibË
, &ddi¥->
zoom_çùÜ
),

1106 
NULL
);

1107  
»nd””
;

1110 
»nd””_ty³
 = 
	`g_ty³_äom_Çme
 ("DiaCairoInteractiveRenderer");

1111 ià(
»nd””_ty³
) {

1112 
DŸR’d””
 *
»nd””
 = 
	`g_objeù_Ãw
(
»nd””_ty³
, 
NULL
);

1113 
	`g_objeù_£t
 (
»nd””
,

1114 "zoom", &
ddi¥
->
zoom_çùÜ
,

1115 "»ù", &
ddi¥
->
visibË
,

1116 
NULL
);

1117  
»nd””
;

1121 
	`mes§ge_w¬nšg
 (
	`_
("No‡nti-aliased„enderer found"));

1123  
	`Ãw_gdk_»nd””
 (
ddi¥
);

1124 
	}
}

1127 
	$ddi¥Ïy_£t_»nd””
(
DDi¥Ïy
 *
ddi¥
, 
¯_»nd””
)

1129 
width
, 
height
;

1132 ià(
ddi¥
->
upd©e_id
) {

1133 
	`g_sourû_»move
 (
ddi¥
->
upd©e_id
);

1134 
ddi¥
->
upd©e_id
 = 0;

1137 ià(
ddi¥
->
»nd””
)

1138 
	`g_objeù_uÄef
 (
ddi¥
->
»nd””
);

1140 
ddi¥
->
¯_»nd””
 =‡a_renderer;

1142 
width
 = 
ddi¥
->
ÿnvas
->
®loÿtiÚ
.width;

1143 
height
 = 
ddi¥
->
ÿnvas
->
®loÿtiÚ
.height;

1145 ià(
ddi¥
->
¯_»nd””
){

1146 
ddi¥
->
»nd””
 = 
	`Ãw_¯_»nd””
 (ddisp);

1148 
ddi¥
->
»nd””
 = 
	`Ãw_gdk_»nd””
(ddisp);

1151 
	`dŸ_»nd””_£t_size
(
ddi¥
->
»nd””
, ddi¥->
ÿnvas
->
wšdow
, 
width
, 
height
);

1152 
	}
}

1155 
	$ddi¥Ïy_»size_ÿnvas
(
DDi¥Ïy
 *
ddi¥
,

1156 
width
, 
height
)

1158 ià(
ddi¥
->
»nd””
==
NULL
) {

1159 ià(
ddi¥
->
¯_»nd””
)

1160 
ddi¥
->
»nd””
 = 
	`Ãw_¯_»nd””
 (ddisp);

1162 
ddi¥
->
»nd””
 = 
	`Ãw_gdk_»nd””
(ddisp);

1165 
	`dŸ_»nd””_£t_size
(
ddi¥
->
»nd””
, ddi¥->
ÿnvas
->
wšdow
, 
width
, 
height
);

1167 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
, ddi¥->
Üigo
.
x
, ddi¥->Üigo.
y
);

1169 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

1170 
	`ddi¥Ïy_æush
(
ddi¥
);

1171 
	}
}

1173 
DIAVAR
 
DDi¥Ïy
 *

1174 
	$ddi¥Ïy_aùive
()

1176  
aùive_di¥Ïy
;

1177 
	}
}

1179 
DŸg¿m
 *

1180 
	$ddi¥Ïy_aùive_dŸg¿m
()

1182 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
 ();

1184 ià(!
ddi¥
è 
NULL
;

1185  
ddi¥
->
dŸg¿m
;

1186 
	}
}

1189 
	$ddi¥_de¡roy
(
DDi¥Ïy
 *
ddi¥
)

1191 
	`g_sigÇl_hªdËrs_discÚÃù_by_func
 (
ddi¥
->
dŸg¿m
, 
£ËùiÚ_chªged
, ddisp);

1193 
	`g_objeù_uÄef
 (
	`G_OBJECT
 (
ddi¥
->
im_cÚ‹xt
));

1194 
ddi¥
->
im_cÚ‹xt
 = 
NULL
;

1196 
	`ddi¥Ïy_im_cÚ‹xt_´“d™_»£t
(
ddi¥
, 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *èddi¥->
dŸg¿m
));

1199 ià(
ddi¥
->
is_¡ªd®Úe_wšdow
)

1200 
	`gtk_widg‘_de¡roy
 (
ddi¥
->
sh–l
);

1202 
	`gtk_widg‘_de¡roy
 (
ddi¥
->
cÚš”
);

1203 
	`ddi¥Ïy_»®ly_de¡roy
 (
ddi¥
);

1205 
	}
}

1208 
	$¬e_you_su»_şo£_dŸlog_»¥Úd
(
GtkWidg‘
 *
widg‘
,

1209 
gšt
 
»¥Ú£_id
,

1210 
gpoš‹r
 
u£r_d©a
)

1212 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
u£r_d©a
;

1213 
gboŞ—n
 
şo£_ddi¥
 = 
TRUE
;

1215 
»¥Ú£_id
) {

1216 
GTK_RESPONSE_YES
 :

1218 ià(!
	`dŸg¿m_§ve
(
ddi¥
->
dŸg¿m
, ddi¥->dŸg¿m->
f’ame
))

1219 
şo£_ddi¥
 = 
FALSE
;

1221 ià(
ddi¥
->
upd©e_id
 && 
şo£_ddi¥
) {

1222 
	`g_sourû_»move
 (
ddi¥
->
upd©e_id
);

1223 
ddi¥
->
upd©e_id
 = 0;

1226 
GTK_RESPONSE_NO
 :

1227 ià(
şo£_ddi¥
)

1228 
	`ddi¥_de¡roy
 (
ddi¥
);

1230 
GTK_RESPONSE_CANCEL
 :

1231 
GTK_RESPONSE_NONE
 :

1232 
GTK_RESPONSE_DELETE_EVENT
 :

1233 
	`gtk_widg‘_de¡roy
(
widg‘
);

1236 
	`g_as£¹_nÙ_»ached
();

1238 
	}
}

1241 
	$ddi¥Ïy_şo£
(
DDi¥Ïy
 *
ddi¥
)

1243 
DŸg¿m
 *
dŸ
;

1244 
GtkWidg‘
 *
dŸlog
, *
bu‰Ú
;

1245 
gch¬
 *
âame
;

1247 
	`g_»tuº_if_ç
(
ddi¥
 !ğ
NULL
);

1249 
dŸ
 = 
ddi¥
->
dŸg¿m
;

1251 iàĞ(
	`g_¦i¡_Ëngth
(
dŸ
->
di¥Ïys
) > 1) ||

1252 (!
	`dŸg¿m_is_modif›d
(
dŸ
)) ) {

1253 
	`ddi¥_de¡roy
(
ddi¥
);

1257 
âame
 = 
dŸ
->
f’ame
;

1258 ià(!
âame
)

1259 
âame
 = 
	`_
("<unnamed>");

1261 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
(
	`GTK_WINDOW
 (
ddi¥
->
sh–l
),

1262 
GTK_DIALOG_MODAL
,

1263 
GTK_MESSAGE_QUESTION
,

1264 
GTK_BUTTONS_NONE
,

1265 
	`_
("Closing diagram without saving"));

1266 
	`gtk_mes§ge_dŸlog_fÜm©_£cÚd¬y_‹xt
(
	`GTK_MESSAGE_DIALOG
(
dŸlog
),

1267 
	`_
("The diagram '%s'\n"

1268 "ha nÙ b“À§ved. Savchªge now?"), 
âame
);

1269 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
(
dŸlog
), 
	`_
("Close Diagram"));

1271 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_CANCEL
);

1272 
	`gtk_dŸlog_add_aùiÚ_widg‘
 (
	`GTK_DIALOG
(
dŸlog
), 
bu‰Ú
, 
GTK_RESPONSE_CANCEL
);

1274 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_w™h_mÃmÚic
 (
	`_
("_Discard Changes"));

1275 
	`gtk_dŸlog_add_aùiÚ_widg‘
 (
	`GTK_DIALOG
(
dŸlog
), 
bu‰Ú
, 
GTK_RESPONSE_NO
);

1278 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_SAVE
);

1279 
	`gtk_dŸlog_add_aùiÚ_widg‘
 (
	`GTK_DIALOG
(
dŸlog
), 
bu‰Ú
, 
GTK_RESPONSE_YES
);

1280 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú
, 
GTK_CAN_DEFAULT
);

1281 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
dŸlog
), 
GTK_RESPONSE_YES
);

1283 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
dŸlog
), "response",

1284 
	`G_CALLBACK
(
¬e_you_su»_şo£_dŸlog_»¥Úd
),

1285 
ddi¥
);

1287 
	`gtk_widg‘_show_®l
(
dŸlog
);

1288 
	}
}

1291 
	$di¥Ïy_upd©e_m’u_¡©e
(
DDi¥Ïy
 *
ddi¥
)

1293 
GtkToggËAùiÚ
 *
ruËrs
;

1294 
GtkToggËAùiÚ
 *
visibË_grid
;

1295 
GtkToggËAùiÚ
 *
¢­_to_grid
;

1296 
GtkToggËAùiÚ
 *
show_cx_±s
;

1297 
GtkToggËAùiÚ
 *
ªtŸlŸ£d
;

1299 ià(
ddi¥
->
m’u_b¬
 =ğ
NULL
) {

1300 
ruËrs
 = 
	`GTK_TOGGLE_ACTION
 (
	`m’us_g‘_aùiÚ
 ("ViewShowrulers"));

1301 
visibË_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`m’us_g‘_aùiÚ
 ("ViewShowgrid"));

1302 
¢­_to_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`m’us_g‘_aùiÚ
 ("ViewSnaptogrid"));

1303 
show_cx_±s
 = 
	`GTK_TOGGLE_ACTION
 (
	`m’us_g‘_aùiÚ
 ("ViewShowconnectionpoints"));

1304 
ªtŸlŸ£d
 = 
	`GTK_TOGGLE_ACTION
 (
	`m’us_g‘_aùiÚ
 ("ViewAntialiased"));

1306 
ruËrs
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
ddi¥
->
aùiÚs
, "ViewShowrulers"));

1307 
visibË_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
ddi¥
->
aùiÚs
, "ViewShowgrid"));

1308 
¢­_to_grid
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
ddi¥
->
aùiÚs
, "ViewSnaptogrid"));

1309 
show_cx_±s
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
ddi¥
->
aùiÚs
, "ViewShowconnectionpoints"));

1311 
ªtŸlŸ£d
 = 
	`GTK_TOGGLE_ACTION
 (
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
ddi¥
->
aùiÚs
, "ViewAntialiased"));

1313 
	`gtk_aùiÚ_£t_£ns™ive
 (
	`m’us_g‘_aùiÚ
 ("ViewAntialiased"),

1314 
	`g_ty³_äom_Çme
 ("DiaCairoInteractiveRenderer") != 0 || g_type_from_name ("DiaLibartRenderer") != 0);

1317 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
 (
ddi¥
);

1319 
	`gtk_toggË_aùiÚ_£t_aùive
 (
ruËrs
, 
	`di¥Ïy_g‘_ruËrs_showšg
(
ddi¥
));

1320 
	`gtk_toggË_aùiÚ_£t_aùive
 (
visibË_grid
,

1321 
ddi¥
->
grid
.
visibË
);

1322 
	`gtk_toggË_aùiÚ_£t_aùive
 (
¢­_to_grid
,

1323 
ddi¥
->
grid
.
¢­
);

1324 
	`gtk_toggË_aùiÚ_£t_aùive
 (
show_cx_±s
,

1325 
ddi¥
->
show_cx_±s
);

1327 
	`gtk_toggË_aùiÚ_£t_aùive
 (
ªtŸlŸ£d
,

1328 
ddi¥
->
¯_»nd””
);

1329 
	}
}

1332 
	$ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
 (
DDi¥Ïy
 *
ddi¥
)

1334 
DŸg¿m
 *
dŸ
;

1336 ià(
ddi¥
 =ğ
NULL
) {

1339 
dŸ
 = 
ddi¥
->
dŸg¿m
;

1340 
	`dŸg¿m_upd©e_m’u_£ns™iv™y
 (
dŸ
);

1341 
	}
}

1347 
	$ddi¥Ïy_»®ly_de¡roy
(
DDi¥Ïy
 *
ddi¥
)

1349 ià(
aùive_di¥Ïy
 =ğ
ddi¥
)

1350 
	`di¥Ïy_£t_aùive
(
NULL
);

1353 ià(
ddi¥
->
upd©e_id
) {

1354 
	`g_sourû_»move
 (
ddi¥
->
upd©e_id
);

1355 
ddi¥
->
upd©e_id
 = 0;

1358 ià(
ddi¥
->
dŸg¿m
) {

1359 
	`dŸg¿m_»move_ddi¥Ïy
(
ddi¥
->
dŸg¿m
, ddisp);

1361 
	`g_objeù_uÄef
(
ddi¥
->
dŸg¿m
);

1362 
ddi¥
->
dŸg¿m
 = 
NULL
;

1365 
	`g_objeù_uÄef
 (
ddi¥
->
»nd””
);

1366 
ddi¥
->
»nd””
 = 
NULL
;

1368 
	`g_hash_bË_»move
(
di¥Ïy_ht
, 
ddi¥
->
sh–l
);

1369 
	`g_hash_bË_»move
(
di¥Ïy_ht
, 
ddi¥
->
ÿnvas
);

1372 
	`ddi¥Ïy_ä“_upd©e_¬—s
(
ddi¥
);

1374 
	`ddi¥Ïy_ä“_di¥Ïy_¬—s
(
ddi¥
);

1376 
	`g_ä“
(
ddi¥
);

1377 
	}
}

1381 
	$ddi¥Ïy_£t_t™Ë
(
DDi¥Ïy
 *
ddi¥
, *
t™Ë
)

1383 ià(
ddi¥
->
is_¡ªd®Úe_wšdow
)

1384 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
ddi¥
->
sh–l
), 
t™Ë
);

1387 
GtkNÙebook
 *
nÙebook
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
ddi¥
->
sh–l
),

1388 
DIA_MAIN_NOTEBOOK
);

1390 
gšt
 
num_·ges
 = 
	`gtk_nÙebook_g‘_n_·ges
 (
nÙebook
);

1391 
gšt
 
num
;

1392 
GtkWidg‘
 *
·ge
;

1393 
num
 = 0 ;‚um < 
num_·ges
 ;‚um++)

1395 
·ge
 = 
	`gtk_nÙebook_g‘_Áh_·ge
 (
nÙebook
,
num
);

1396 ià(
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
·ge
), "DDi¥Ïy"è=ğ
ddi¥
)

1398 
GtkLab–
 *
Ïb–
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
·ge
), "tab-label");

1400 
gch¬
 *
Çme
 = 
	`dŸg¿m_g‘_Çme
(
ddi¥
->
dŸg¿m
);

1401 
	`gtk_Ïb–_£t_‹xt
(
Ïb–
,
Çme
);

1402 
	`g_ä“
(
Çme
);

1408 cÚ¡ 
gch¬
 *
²ame
 = 
	`g_g‘_´gÇme
();

1409 
gch¬
 *
fuÎt™Ë
 = 
	`g_¡rdup_´štf
 ("% - %s", 
t™Ë
, 
²ame
 ?…name : "Dia");

1410 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
ddi¥
->
sh–l
), 
fuÎt™Ë
);

1411 
	`g_ä“
(
fuÎt™Ë
);

1414 
	}
}

1417 
	$ddi¥Ïy_£t_®l_cursÜ
(
GdkCursÜ
 *
cursÜ
)

1419 
DŸg¿m
 *
dŸ
;

1420 
DDi¥Ïy
 *
ddi¥
;

1421 
GLi¡
 *
li¡
;

1422 
GSLi¡
 *
¦i¡
;

1424 
cu¼’t_cursÜ
 = 
cursÜ
;

1426 
li¡
 = 
	`dŸ_İ’_dŸg¿ms
();

1427 
li¡
 !ğ
NULL
) {

1428 
dŸ
 = (
DŸg¿m
 *è
li¡
->
d©a
;

1430 
¦i¡
 = 
dŸ
->
di¥Ïys
;

1431 
¦i¡
 !ğ
NULL
) {

1432 
ddi¥
 = (
DDi¥Ïy
 *è
¦i¡
->
d©a
;

1434 
	`ddi¥Ïy_£t_cursÜ
(
ddi¥
, 
cursÜ
);

1436 
¦i¡
 = 
	`g_¦i¡_Ãxt
(slist);

1439 
li¡
 = 
	`g_li¡_Ãxt
(list);

1441 
	}
}

1444 
	$ddi¥Ïy_£t_cursÜ
(
DDi¥Ïy
 *
ddi¥
, 
GdkCursÜ
 *
cursÜ
)

1446 ià(
ddi¥
->
ÿnvas
->
wšdow
)

1447 
	`gdk_wšdow_£t_cursÜ
(
ddi¥
->
ÿnvas
->
wšdow
, 
cursÜ
);

1448 
	}
}

1452 
gboŞ—n
 
	$di¥Ïy_g‘_ruËrs_showšg
(
DDi¥Ïy
 *
ddi¥
) {

1453  
ddi¥
->
ruËrs_¬e_showšg
;

1454 
	}
}

1464 
	$di¥Ïy_ruËrs_show
 (
DDi¥Ïy
 *
ddi¥
)

1466 ià(
ddi¥
)

1468 
GtkWidg‘
 *
·»Á
 = 
	`GTK_WIDGET
 (
ddi¥
->
Üigš
->parent);

1470 
	`gtk_widg‘_show
 (
ddi¥
->
Üigš
);

1471 
	`gtk_widg‘_show
 (
ddi¥
->
hruË
);

1472 
	`gtk_widg‘_show
 (
ddi¥
->
vruË
);

1474 ià(
	`GTK_WIDGET_VISIBLE
 (
·»Á
))

1475 
	`gtk_widg‘_queue_»size
 (
·»Á
);

1477 
ddi¥
->
ruËrs_¬e_showšg
 = 
TRUE
;

1479 
	}
}

1488 
	$di¥Ïy_ruËrs_hide
 (
DDi¥Ïy
 *
ddi¥
)

1490 ià(
ddi¥
)

1492 
GtkWidg‘
 *
·»Á
 = 
	`GTK_WIDGET
 (
ddi¥
->
Üigš
->parent);

1494 
	`gtk_widg‘_hide
 (
ddi¥
->
Üigš
);

1495 
	`gtk_widg‘_hide
 (
ddi¥
->
hruË
);

1496 
	`gtk_widg‘_hide
 (
ddi¥
->
vruË
);

1498 ià(
	`GTK_WIDGET_VISIBLE
 (
·»Á
))

1499 
	`gtk_widg‘_queue_»size
 (
·»Á
);

1501 
ddi¥
->
ruËrs_¬e_showšg
 = 
FALSE
;

1503 
	}
}

1506 
	$ddi¥Ïy_upd©e_¡©usb¬
(
DDi¥Ïy
 *
ddi¥
)

1508 
	`upd©e_zoom_¡©us
 (
ddi¥
);

1509 
	`upd©e_¢­_grid_¡©us
 (
ddi¥
);

1510 
	`upd©e_mašpošt_¡©us
 (
ddi¥
);

1511 
	}
}

1514 
	$di¥Ïy_£t_aùive
(
DDi¥Ïy
 *
ddi¥
)

1516 ià(
ddi¥
 !ğ
aùive_di¥Ïy
) {

1517 
aùive_di¥Ïy
 = 
ddi¥
;

1520 
	`Ïy”_dŸlog_£t_dŸg¿m
(
ddi¥
 ? ddi¥->
dŸg¿m
 : 
NULL
);

1521 
	`dŸg¿m_´İ”t›s_£t_dŸg¿m
(
ddi¥
 ? ddi¥->
dŸg¿m
 : 
NULL
);

1523 ià(
ddi¥
) {

1524 ià(
ddi¥
->
is_¡ªd®Úe_wšdow
)

1526 
	`di¥Ïy_upd©e_m’u_¡©e
(
ddi¥
);

1528 ià(
´efs
.
toŞbox_Ú_tİ
) {

1529 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
	`š‹rçû_g‘_toŞbox_sh–l
()),

1530 
	`GTK_WINDOW
(
ddi¥
->
sh–l
));

1532 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
	`š‹rçû_g‘_toŞbox_sh–l
()),

1533 
NULL
);

1536 
GtkNÙebook
 *
nÙebook
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
ddi¥
->
sh–l
),

1537 
DIA_MAIN_NOTEBOOK
);

1539 
gšt
 
num_·ges
 = 
	`gtk_nÙebook_g‘_n_·ges
 (
nÙebook
);

1540 
gšt
 
num
;

1541 
GtkWidg‘
 *
·ge
;

1542 
num
 = 0 ;‚um < 
num_·ges
 ;‚um++)

1544 
·ge
 = 
	`gtk_nÙebook_g‘_Áh_·ge
 (
nÙebook
,
num
);

1545 ià(
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
·ge
), "DDi¥Ïy"è=ğ
ddi¥
)

1547 
	`gtk_nÙebook_£t_cu¼’t_·ge
 (
nÙebook
,
num
);

1553 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

1556 
	`upd©e_zoom_¡©us
 (
ddi¥
);

1559 
	`ddi¥Ïy_£t_¢­_to_grid
 (
ddi¥
, ddi¥->
grid
.
¢­
);

1562 
	`ddi¥Ïy_£t_¢­_to_objeùs
 (
ddi¥
, ddi¥->
mašpošt_magÃtism
);

1564 
	`di¥Ïy_upd©e_m’u_¡©e
 (
ddi¥
);

1566 
	`gtk_wšdow_´e£Á
 (
	`GTK_WINDOW
(
ddi¥
->
sh–l
));

1570 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
	`š‹rçû_g‘_toŞbox_sh–l
()),

1571 
NULL
);

1574 
	}
}

1577 
	$ddi¥Ïy_im_cÚ‹xt_´“d™_»£t
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
)

1579 ià(
ddi¥
->
´“d™_¡ršg
 !ğ
NULL
) {

1580 ià(
focus
 !ğ
NULL
) {

1581 
i
;

1582 
ObjeùChªge
 *
chªge
;

1584 
i
 = 0; i < 
	`g_utf8_¡¾’
(
ddi¥
->
´“d™_¡ršg
, -1); i++) {

1585 (
focus
->
key_ev’t
)(focus, 
GDK_BackS·û
, 
NULL
, 0, &
chªge
);

1589 
	`g_ä“
(
ddi¥
->
´“d™_¡ršg
);

1590 
ddi¥
->
´“d™_¡ršg
 = 
NULL
;

1592 ià(
ddi¥
->
´“d™_©Œs
 !ğ
NULL
) {

1593 
	`·ngo_©Œ_li¡_uÄef
(
ddi¥
->
´“d™_©Œs
);

1594 
ddi¥
->
´“d™_©Œs
 = 
NULL
;

1596 
	}
}

1605 
Focus
 *

1606 
	$ddi¥Ïy_aùive_focus
(
DDi¥Ïy
 *
ddi¥
)

1608  
ddi¥
 ? ddi¥->
aùive_focus
 : 
NULL
;

1609 
	}
}

1621 
	$ddi¥Ïy_£t_aùive_focus
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
)

1623 
ddi¥
->
aùive_focus
 = 
focus
;

1624 
	}
}

1627 
	$ddi¥Ïy_show_®l
 (
DDi¥Ïy
 *
ddi¥
)

1629 
DŸg¿m
 *
dŸ
;

1630 
»®
 
magnify_x
, 
magnify_y
;

1631 
width
, 
height
;

1632 
Pošt
 
middË
;

1634 
	`g_»tuº_if_ç
 (
ddi¥
 !ğ
NULL
);

1636 
dŸ
 = 
ddi¥
->
dŸg¿m
;

1638 
width
 = 
	`dŸ_»nd””_g‘_width_pix–s
 (
ddi¥
->
»nd””
);

1639 
height
 = 
	`dŸ_»nd””_g‘_height_pix–s
 (
ddi¥
->
»nd””
);

1642 ià(
dŸ
->
d©a
->
£Ëùed
) {

1643 
GLi¡
 *
li¡
 = 
dŸ
->
d©a
->
£Ëùed
;

1644 
ReùªgË
 
ex‹Ás
 = *
	`dŸ_objeù_g‘_’şosšg_box
 ((
DŸObjeù
*)
li¡
->
d©a
);

1645 
li¡
 = 
	`g_li¡_Ãxt
(list);

1646 
li¡
) {

1647 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

1648 
	`»ùªgË_uniÚ
(&
ex‹Ás
, 
	`dŸ_objeù_g‘_’şosšg_box
 (
obj
));

1649 
li¡
 = 
	`g_li¡_Ãxt
(list);

1651 
magnify_x
 = (
»®
)
width
 / (
ex‹Ás
.
right
 -ƒx‹Ás.
Ëá
è/ 
ddi¥
->
zoom_çùÜ
;

1652 
magnify_y
 = (
»®
)
height
 / (
ex‹Ás
.
bÙtom
 -ƒx‹Ás.
tİ
è/ 
ddi¥
->
zoom_çùÜ
;

1653 
middË
.
x
 = 
ex‹Ás
.
Ëá
 + (ex‹Ás.
right
 -ƒxtents.left) / 2.0;

1654 
middË
.
y
 = 
ex‹Ás
.
tİ
 + (ex‹Ás.
bÙtom
 -ƒxtents.top) / 2.0;

1656 
magnify_x
 = (
»®
)
width
 /

1657 (
dŸ
->
d©a
->
ex‹Ás
.
right
 - dŸ->d©a->ex‹Ás.
Ëá
è/ 
ddi¥
->
zoom_çùÜ
;

1658 
magnify_y
 = (
»®
)
height
 /

1659 (
dŸ
->
d©a
->
ex‹Ás
.
bÙtom
 - dŸ->d©a->ex‹Ás.
tİ
è/ 
ddi¥
->
zoom_çùÜ
;

1661 
middË
.
x
 = 
dŸ
->
d©a
->
ex‹Ás
.
Ëá
 +

1662 (
dŸ
->
d©a
->
ex‹Ás
.
right
 - dŸ->d©a->ex‹Ás.
Ëá
) / 2.0;

1663 
middË
.
y
 = 
dŸ
->
d©a
->
ex‹Ás
.
tİ
 +

1664 (
dŸ
->
d©a
->
ex‹Ás
.
bÙtom
 - dŸ->d©a->ex‹Ás.
tİ
) / 2.0;

1667 
	`ddi¥Ïy_zoom
 (
ddi¥
, &
middË
,

1668 ((
magnify_x
<
magnify_y
)?magnify_x:magnify_y)/1.05);

1670 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

1671 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

1672 
	`ddi¥Ïy_æush
(
ddi¥
);

1673 
	}
}

	@O:\tool\dvs50\app\display.h

18 #iâdeà
DDISPLAY_H


19 
	#DDISPLAY_H


	)

21 
	~<gtk/gtk.h
>

22 
	~<gtk/gtkimcÚ‹xt.h
>

24 
_DDi¥Ïy
 
	tDDi¥Ïy
;

25 
	~"dŸty³s.h
"

26 
	~"lib/geom‘ry.h
"

27 
	~"dŸg¿m.h
"

28 
	~"grid.h
"

29 
	~"m’us.h
"

30 
	~"dŸ»nd””.h
"

36 
	#DDISPLAY_MAX_ZOOM
 2000.0

	)

37 
	#DDISPLAY_NORMAL_ZOOM
 20.0

	)

38 
	#DDISPLAY_MIN_ZOOM
 0.2

	)

47 
	s_DDi¥Ïy
 {

48 
DŸg¿m
 *
	mdŸg¿m
;

50 
GtkWidg‘
 *
	msh–l
;

51 
GtkWidg‘
 *
	mÿnvas
;

52 
GtkWidg‘
 *
	mhsb
, *
	mvsb
;

53 
GtkWidg‘
 *
	mhruË
, *
	mvruË
;

54 
GtkWidg‘
 *
	mÜigš
;

55 
GtkWidg‘
 *
	mm’u_b¬
;

56 
GtkUIMªag”
 *
	mui_mªag”
;

57 
GtkAùiÚGroup
 *
	maùiÚs
;

60 
GtkM’uI‹m
 *
	mruËrs
;

62 
GtkWidg‘
 *
	mzoom_¡©us
;

63 
GtkWidg‘
 *
	mgrid_¡©us
;

64 
GtkWidg‘
 *
	mmašpošt_¡©us
;

65 
GtkWidg‘
 *
	mmodif›d_¡©us
;

67 
GtkAcûlGroup
 *
	macûl_group
;

69 
GtkAdju¡m’t
 *
	mhsbd©a
;

70 
GtkAdju¡m’t
 *
	mvsbd©a
;

72 
Pošt
 
	mÜigo
;

73 
»®
 
	mzoom_çùÜ
;

74 
ReùªgË
 
	mvisibË
;

76 
Grid
 
	mgrid
;

78 
gboŞ—n
 
	mshow_cx_±s
;

79 
gboŞ—n
 
	mautosüŞl
;

80 
gboŞ—n
 
	mmašpošt_magÃtism
;

82 
	m¯_»nd””
;

83 
DŸR’d””
 *
	m»nd””
;

85 
GSLi¡
 *
	mupd©e_¬—s
;

86 
GSLi¡
 *
	mdi¥Ïy_¬—s
;

87 
gušt
 
	mupd©e_id
;

89 
GtkIMCÚ‹xt
 *
	mim_cÚ‹xt
;

92 
gch¬
 *
	m´“d™_¡ršg
;

93 
PªgoA‰rLi¡
 *
	m´“d™_©Œs
;

97 
gboŞ—n
 
	mis_¡ªd®Úe_wšdow
;

100 
GtkToŞb¬
 *
	mcommÚ_toŞb¬
;

103 
GtkWidg‘
 *
	mcÚš”
;

106 
gboŞ—n
 
	mruËrs_¬e_showšg
;

109 
Focus
 *
	maùive_focus
;

112 
GdkCursÜ
 *
deçuÉ_cursÜ
;

114 
DDi¥Ïy
 *
Ãw_di¥Ïy
(
DŸg¿m
 *
dŸ
);

115 
DDi¥Ïy
 *
cİy_di¥Ïy
(DDi¥Ïy *
Üig_ddi¥
);

117 
ddi¥Ïy_»®ly_de¡roy
(
DDi¥Ïy
 *
ddi¥
);

118 
ddi¥Ïy_ŒªsfÜm_coÜds_doubË
(
DDi¥Ïy
 *
ddi¥
,

119 
coÜd
 
x
, coÜd 
y
,

120 *
xi
, *
yi
);

121 
ddi¥Ïy_ŒªsfÜm_coÜds
(
DDi¥Ïy
 *
ddi¥
,

122 
coÜd
 
x
, coÜd 
y
,

123 *
xi
, *
yi
);

124 
ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
DDi¥Ïy
 *
ddi¥
,

125 
xi
, 
yi
,

126 
coÜd
 *
x
, coÜd *
y
);

127 
»®
 
ddi¥Ïy_ŒªsfÜm_Ëngth
(
DDi¥Ïy
 *
ddi¥
,„—È
Ën
);

128 
»®
 
ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
DDi¥Ïy
 *
ddi¥
,„—È
Ën
);

129 
ddi¥Ïy_add_upd©e_pix–s
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
pošt
,

130 
pix–_width
, 
pix–_height
);

131 
ddi¥Ïy_add_upd©e_®l
(
DDi¥Ïy
 *
ddi¥
);

132 
ddi¥Ïy_add_upd©e_w™h_bÜd”
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
»ù
,

133 
pix–_bÜd”
);

134 
ddi¥Ïy_add_upd©e
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
»ù
);

135 
ddi¥Ïy_add_di¥Ïy_¬—
(
DDi¥Ïy
 *
ddi¥
,

136 
Ëá
, 
tİ
,

137 
right
, 
bÙtom
);

138 
ddi¥Ïy_æush
(
DDi¥Ïy
 *
ddi¥
);

139 
ddi¥Ïy_upd©e_süŞlb¬s
(
DDi¥Ïy
 *
ddi¥
);

140 
ddi¥Ïy_£t_Üigo
(
DDi¥Ïy
 *
ddi¥
,

141 
coÜd
 
x
, coÜd 
y
);

142 
ddi¥Ïy_zoom
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
pošt
,

143 
»®
 
zoom_çùÜ
);

144 
ddi¥Ïy_zoom_ûÁ”ed
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
pošt
, 
»®
 
magnify
);

145 
ddi¥Ïy_£t_¢­_to_grid
(
DDi¥Ïy
 *
ddi¥
, 
gboŞ—n
 
¢­
);

146 
ddi¥Ïy_£t_¢­_to_objeùs
(
DDi¥Ïy
 *
ddi¥
, 
gboŞ—n
 
magÃtic
);

147 
ddi¥Ïy_£t_»nd””
(
DDi¥Ïy
 *
ddi¥
, 
¯_»nd””
);

148 
ddi¥Ïy_»size_ÿnvas
(
DDi¥Ïy
 *
ddi¥
,

149 
width
,

150 
height
);

152 
ddi¥Ïy_»nd”_pixm­
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
upd©e
);

154 
DIAVAR
 
DDi¥Ïy
 *
ddi¥Ïy_aùive
();

155 
DŸg¿m
 *
ddi¥Ïy_aùive_dŸg¿m
();

157 
ddi¥Ïy_şo£
(
DDi¥Ïy
 *
ddi¥
);

159 
ddi¥Ïy_£t_t™Ë
(
DDi¥Ïy
 *
ddi¥
, *
t™Ë
);

160 
ddi¥Ïy_£t_cursÜ
(
DDi¥Ïy
 *
ddi¥
, 
GdkCursÜ
 *
cursÜ
);

161 
ddi¥Ïy_£t_®l_cursÜ
(
GdkCursÜ
 *
cursÜ
);

163 
gboŞ—n
 
di¥Ïy_g‘_ruËrs_showšg
(
DDi¥Ïy
 *
ddi¥
);

164 
di¥Ïy_ruËrs_show
 (
DDi¥Ïy
 *
ddi¥
);

165 
di¥Ïy_ruËrs_hide
 (
DDi¥Ïy
 *
ddi¥
);

167 
gboŞ—n
 
ddi¥Ïy_süŞl
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
d–
);

168 
gboŞ—n
 
ddi¥Ïy_autosüŞl
(
DDi¥Ïy
 *
ddi¥
, 
x
, 
y
);

169 
ddi¥Ïy_süŞl_up
(
DDi¥Ïy
 *
ddi¥
);

170 
ddi¥Ïy_süŞl_down
(
DDi¥Ïy
 *
ddi¥
);

171 
ddi¥Ïy_süŞl_Ëá
(
DDi¥Ïy
 *
ddi¥
);

172 
ddi¥Ïy_süŞl_right
(
DDi¥Ïy
 *
ddi¥
);

173 
gboŞ—n
 
ddi¥Ïy_süŞl_ûÁ”_pošt
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
p
);

174 
gboŞ—n
 
ddi¥Ïy_süŞl_to_objeù
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
);

175 
gboŞ—n
 
ddi¥Ïy_´e£Á_objeù
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
);

177 
ddi¥Ïy_show_®l
 (
DDi¥Ïy
 *
ddi¥
);

179 
di¥Ïy_upd©e_m’u_¡©e
(
DDi¥Ïy
 *
ddi¥
);

180 
ddi¥Ïy_upd©e_¡©usb¬
(
DDi¥Ïy
 *
ddi¥
);

181 
ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
 (
DDi¥Ïy
 *
ddi¥
);

183 
di¥Ïy_£t_aùive
(
DDi¥Ïy
 *
ddi¥
);

185 
ddi¥Ïy_im_cÚ‹xt_´“d™_»£t
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
);

187 
Focus
 *
ddi¥Ïy_aùive_focus
(
DDi¥Ïy
 *
ddi¥
);

188 
ddi¥Ïy_£t_aùive_focus
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
);

	@O:\tool\dvs50\app\dynamic_refresh.c

21 
	~"dyÇmic_»äesh.h
"

22 
	~"dyÇmic_obj.h
"

23 
	~"dŸg¿m.h
"

24 
	~"dŸg¿md©a.h
"

25 
	~"objeù_İs.h
"

26 
	~"cÚÃùiÚpošt_İs.h
"

27 
	~<glib.h
>

29 
gušt
 
	gtimeout
 = 0;

30 
gušt
 
	gidË_id
 = 0;

31 
gušt
 
	gtim”_id
 = 0;

33 
	$fÜ—ch_dynobj
(
DŸObjeù
* 
obj
, 
gpoš‹r
 
d©a
) {

34 
gboŞ—n
 
moved
 = 
FALSE
;

35 
GLi¡
* 
li¡
 = 
	`dŸ_İ’_dŸg¿ms
();

37 
li¡
 !ğ
NULL
) {

38 
DŸg¿m
* 
dŸ
;

39 
DŸg¿mD©a
* 
obj_dd©a
;

40 
Lay”
* 
Ïy”
;

42 
dŸ
 = (
DŸg¿m
*)
li¡
->
d©a
;

43 
li¡
 = 
	`g_li¡_Ãxt
(list);

45 
Ïy”
 = 
	`dŸ_objeù_g‘_·»Á_Ïy”
(
obj
);

46 ià(!
Ïy”
) ;

48 
obj_dd©a
 = 
	`Ïy”_g‘_·»Á_dŸg¿m
(
Ïy”
);

49 ià(!
obj_dd©a
) ;

51 ià(
dŸ
->
d©a
 =ğ
obj_dd©a
) {

52 ià(!
moved
) {

53 
obj
->
İs
->
	`move
(obj,&obj->
pos™iÚ
);

54 
moved
 = 
TRUE
;

56 
	`objeù_add_upd©es
(
obj
,
dŸ
);

57 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
,
obj
, 
TRUE
);

60 
	}
}

62 
gboŞ—n
 
	$tim”_hªdËr
(
gpoš‹r
 
d©a
) {

63 
GLi¡
* 
li¡
;

65 
	`dynobj_li¡_fÜ—ch
(
fÜ—ch_dynobj
,
d©a
);

67 
li¡
 = 
	`dŸ_İ’_dŸg¿ms
();

68 
li¡
 !ğ
NULL
) {

69 
DŸg¿m
* 
dŸ
 = (DŸg¿m*)
li¡
->
d©a
;

70 
li¡
 = 
	`g_li¡_Ãxt
(list);

72 
	`dŸg¿m_æush
(
dŸ
);

75 
	`dynobj_»äesh_kick
();

76  
TRUE
;

77 
	}
}

79 
gboŞ—n


80 
	$idË_hªdËr
 (
gpoš‹r
 
d©a
)

82 
gušt
 
Ãw_timeout
;

84 
Ãw_timeout
 = 
	`dynobj_li¡_g‘_dynobj_¿‹
();

85 ià(
timeout
 !ğ
Ãw_timeout
) {

86 ià(
tim”_id
) {

87 
	`g_sourû_»move
 (
tim”_id
);

88 
tim”_id
 = 0;

90 
timeout
 = 
Ãw_timeout
;

91 ià(
timeout
) {

92 
tim”_id
 = 
	`g_timeout_add_fuÎ
 (
G_PRIORITY_LOW
, 
timeout
, 
tim”_hªdËr
, 
NULL
, NULL);

95 
idË_id
 = 0;

97  
FALSE
;

98 
	}
}

101 
	$dynobj_»äesh_kick
()

103 ià(!
idË_id
)

104 
idË_id
 = 
	`g_idË_add_fuÎ
 (
G_PRIORITY_LOW
, 
idË_hªdËr
, 
NULL
, NULL);

105 
	}
}

108 
	$dynobj_»äesh_š™
()

111 
	}
}

114 
	$dynobj_»äesh_fšish
 ()

116 ià(
tim”_id
)

117 
	`g_sourû_»move
 (
tim”_id
);

118 ià(
idË_id
)

119 
	`g_sourû_»move
(
idË_id
);

120 
	}
}

	@O:\tool\dvs50\app\dynamic_refresh.h

22 #iâdeà
DYNAMIC_REFRESH_H


23 
	#DYNAMIC_REFRESH_H


	)

26 
dynobj_»äesh_š™
();

29 
dynobj_»äesh_fšish
();

32 
dynobj_»äesh_kick
();

	@O:\tool\dvs50\app\exit_dialog.c

24 
	~<cÚfig.h
>

26 
	~"ex™_dŸlog.h
"

28 
	~"š.h
"

30 
	~<gtk/gtk.h
>

32 
	~<glib.h
>

34 
	#EXIT_DIALOG_TREEVIEW
 "EXIT_DIALOG_TREEVIEW"

	)

37 
	mCHECK_COL
,

38 
	mNAME_COL
,

39 
	mPATH_COL
,

40 
	mDATA_COL
,

41 
	mNUM_COL


44 
£Ëùed_¡©e_£t_®l
 (
GtkT»eV›w
 * 
Œ“v›w
,

45 
gboŞ—n
 
¡©e
);

47 
gšt
 
g‘_£Ëùed_™ems
 (
GtkWidg‘
 * 
dŸlog
,

48 
ex™_dŸlog_™em_¬¿y_t
 ** 
™ems
);

51 
ex™_dŸlog_de¡roy
 (
GtkWidg‘
 * 
ex™_dŸlog
,

52 
gpoš‹r
 
d©a
);

54 
£Ëù_®l_şicked
 (
GtkBu‰Ú
 * 
bu‰Ú
,

55 
gpoš‹r
 
d©a
);

57 
£Ëù_nÚe_şicked
 (
GtkBu‰Ú
 * 
bu‰Ú
,

58 
gpoš‹r
 
d©a
);

60 
toggË_check_bu‰Ú
 (
GtkC–lR’d””ToggË
 * 
»nd””
,

61 
gch¬
 * 
·th
,

62 
GtkT»eV›w
 * 
Œ“v›w
);

71 
GtkWidg‘
 *

72 
	$ex™_dŸlog_make
 (
GtkWšdow
 * 
·»Á_wšdow
,

73 
gch¬
 * 
t™Ë
)

75 
GtkWidg‘
 * 
dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
 (
t™Ë
, 
·»Á_wšdow
,

76 
GTK_DIALOG_MODAL
,

77 
	`_
("Do Not Exit"),

78 
EXIT_DIALOG_EXIT_CANCEL
,

79 
	`_
("Exit Without Save"),

80 
EXIT_DIALOG_EXIT_NO_SAVE
,

81 
	`_
("Save Selected"),

82 
EXIT_DIALOG_EXIT_SAVE_SELECTED
,

83 
NULL
);

85 
GtkBox
 * 
vbox
 = 
	`GTK_BOX
 (
	`GTK_DIALOG
(
dŸlog
)->vbox);

87 
GtkWidg‘
 * 
Ïb–
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("The following‡re‚ot saved:"));

89 
GtkWidg‘
 * 
süŞËd
;

90 
GtkWidg‘
 * 
bu‰Ú
;

91 
GtkWidg‘
 * 
hbox
;

93 
GtkWidg‘
 * 
Œ“v›w
;

94 
GtkLi¡StÜe
 * 
mod–
;

95 
GtkC–lR’d””
 * 
»nd””
;

96 
GtkT»eV›wCŞumn
 * 
cŞumn
;

98 
	`gtk_box_·ck_¡¬t
 (
vbox
, 
Ïb–
, 
FALSE
, FALSE, 0);

100 
	`gtk_widg‘_show
 (
Ïb–
);

103 
süŞËd
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
, NULL);

104 
	`gtk_box_·ck_¡¬t
 (
vbox
, 
süŞËd
, 
TRUE
, TRUE, 0);

105 
	`gtk_widg‘_show
 (
süŞËd
);

107 
mod–
 = 
	`gtk_li¡_¡Üe_Ãw
 (
NUM_COL
, 
G_TYPE_BOOLEAN
, 
G_TYPE_STRING
, G_TYPE_STRING, 
G_TYPE_POINTER
);

109 
Œ“v›w
 = 
	`gtk_Œ“_v›w_Ãw_w™h_mod–
 ( 
	`GTK_TREE_MODEL
(
mod–
));

111 
»nd””
 = 
	`gtk_ûÎ_»nd””_toggË_Ãw
 ();

113 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
 (
	`_
("Save"), 
»nd””
,

114 "aùive", 
CHECK_COL
,

115 
NULL
);

116 
	`gtk_Œ“_v›w_­³nd_cŞumn
 (
	`GTK_TREE_VIEW
 (
Œ“v›w
), 
cŞumn
);

118 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
»nd””
), "toggled",

119 
	`G_CALLBACK
 (
toggË_check_bu‰Ú
),

120 
Œ“v›w
);

122 
»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
 ();

123 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
 (
	`_
("Name"), 
»nd””
,

124 "‹xt", 
NAME_COL
,

125 
NULL
);

126 
	`gtk_Œ“_v›w_­³nd_cŞumn
 (
	`GTK_TREE_VIEW
 (
Œ“v›w
), 
cŞumn
);

128 
»nd””
 = 
	`gtk_ûÎ_»nd””_‹xt_Ãw
 ();

129 
cŞumn
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
 (
	`_
("P©h"), 
»nd””
,

130 "‹xt", 
PATH_COL
,

131 
NULL
);

132 
	`gtk_Œ“_v›w_­³nd_cŞumn
 (
	`GTK_TREE_VIEW
 (
Œ“v›w
), 
cŞumn
);

135 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËd
), 
	`GTK_WIDGET
 (
Œ“v›w
));

138 
hbox
 = 
	`gtk_hbox_Ãw
 (
FALSE
, 3);

139 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, FALSE, 0);

140 
	`gtk_widg‘_show
 (
hbox
);

142 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
 (
	`_
("Select All"));

143 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
bu‰Ú
, 
FALSE
, FALSE, 3);

144 
	`gtk_widg‘_show
 (
bu‰Ú
);

146 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
bu‰Ú
), "clicked",

147 
	`G_CALLBACK
 (
£Ëù_®l_şicked
),

148 
Œ“v›w
);

150 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
 (
	`_
("Select None"));

151 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
bu‰Ú
, 
FALSE
, FALSE, 3);

152 
	`gtk_widg‘_show
 (
bu‰Ú
);

154 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
bu‰Ú
), "clicked",

155 
	`G_CALLBACK
 (
£Ëù_nÚe_şicked
),

156 
Œ“v›w
);

158 
	`g_objeù_uÄef
 (
mod–
);

159 
	`gtk_widg‘_show
 (
	`GTK_WIDGET
 (
Œ“v›w
));

161 
	`gtk_widg‘_show_®l
 (
	`GTK_WIDGET
(
vbox
));

163 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
dŸlog
), 
EXIT_DIALOG_TREEVIEW
, 
Œ“v›w
);

165 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
dŸlog
), "destroy",

166 
	`G_CALLBACK
 (
ex™_dŸlog_de¡roy
),

167 
Œ“v›w
);

169  
dŸlog
;

170 
	}
}

180 
	$ex™_dŸlog_add_™em
 (
GtkWidg‘
 * 
dŸlog
,

181 cÚ¡ 
gch¬
 * 
Çme
,

182 cÚ¡ 
gch¬
 * 
·th
,

183 cÚ¡ 
gpoš‹r
 
İtiÚ®_d©a
)

185 
GtkT»eV›w
 * 
Œ“v›w
;

186 
GtkT»eI‹r
 
™”
;

187 
GtkLi¡StÜe
 * 
mod–
;

188 cÚ¡ 
gch¬
 * 
Çme_cİy
 = 
	`g_¡rdup
 (
Çme
);

189 cÚ¡ 
gch¬
 * 
·th_cİy
 = 
	`g_¡rdup
 (
·th
);

191 
Œ“v›w
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
dŸlog
), 
EXIT_DIALOG_TREEVIEW
);

193 
mod–
 = 
	`GTK_LIST_STORE
 (
	`gtk_Œ“_v›w_g‘_mod–
 (
Œ“v›w
));

195 
	`gtk_li¡_¡Üe_­³nd
 (
mod–
, &
™”
);

197 
	`gtk_li¡_¡Üe_£t
 (
mod–
, &
™”
,

198 
CHECK_COL
, 1,

199 
NAME_COL
, 
Çme_cİy
,

200 
PATH_COL
, 
·th_cİy
,

201 
DATA_COL
, 
İtiÚ®_d©a
,

203 
	}
}

205 
gšt


206 
	$ex™_dŸlog_run
 (
GtkWidg‘
 * 
dŸlog
,

207 
ex™_dŸlog_™em_¬¿y_t
 ** 
™ems
)

209 
gšt
 
»suÉ
;

210 
gšt
 
couÁ
;

212 
TRUE
)

214 
»suÉ
 = 
	`gtk_dŸlog_run
 ( 
	`GTK_DIALOG
(
dŸlog
));

216 
»suÉ
)

218 
EXIT_DIALOG_EXIT_CANCEL
:

219 
EXIT_DIALOG_EXIT_NO_SAVE
:

220 *
™ems
 = 
NULL
;

221  
»suÉ
;

222 
EXIT_DIALOG_EXIT_SAVE_SELECTED
 :

225  
EXIT_DIALOG_EXIT_CANCEL
;

228 
couÁ
 = 
	`g‘_£Ëùed_™ems
 (
dŸlog
, 
™ems
);

230 ià(
couÁ
 == 0)

232 
GtkWidg‘
 * 
msg_dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
 (
	`GTK_WINDOW
 (
dŸlog
),

233 
GTK_DIALOG_MODAL
,

234 
GTK_MESSAGE_WARNING
,

235 
GTK_BUTTONS_YES_NO
,

236 
	`_
("Nothing selected for saving. Would you†ikeory‡gain?"));

238 
gšt
 
yes_Ü_no
 = 
	`gtk_dŸlog_run
 (
	`GTK_DIALOG
 (
msg_dŸlog
));

240 
	`gtk_widg‘_de¡roy
 (
msg_dŸlog
);

242 ià(
yes_Ü_no
 =ğ
GTK_RESPONSE_NO
)

244  
EXIT_DIALOG_EXIT_NO_SAVE
;

249  
EXIT_DIALOG_EXIT_SAVE_SELECTED
;

252 
	}
}

261 
gšt


262 
	$g‘_£Ëùed_™ems
 (
GtkWidg‘
 * 
dŸlog
,

263 
ex™_dŸlog_™em_¬¿y_t
 ** 
™ems
)

265 
GtkT»eV›w
 * 
Œ“v›w
;

266 
GtkT»eI‹r
 
™”
;

267 
GtkLi¡StÜe
 * 
mod–
;

268 
gboŞ—n
 
v®id
;

269 
GSLi¡
 * 
li¡
 = 
NULL
;

270 
GSLi¡
 * 
li¡_™”
;

271 
gšt
 
£Ëùed_couÁ
;

272 
gšt
 
i
;

274 
Œ“v›w
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
dŸlog
), 
EXIT_DIALOG_TREEVIEW
);

276 
mod–
 = 
	`GTK_LIST_STORE
 (
	`gtk_Œ“_v›w_g‘_mod–
 (
Œ“v›w
));

279 
v®id
 = 
	`gtk_Œ“_mod–_g‘_™”_fœ¡
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
);

282 
v®id
)

284 cÚ¡ * 
Çme
;

285 cÚ¡ * 
·th
;

286 
gpoš‹r
 
d©a
;

287 
gboŞ—n
 
is_£Ëùed
;

289 
	`gtk_Œ“_mod–_g‘
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
,

290 
CHECK_COL
, &
is_£Ëùed
,

291 
NAME_COL
, &
Çme
,

292 
PATH_COL
, &
·th
,

293 
DATA_COL
, &
d©a
,

296 ià(
is_£Ëùed
)

298 
ex™_dŸlog_™em_t
 * 
™em
 = 
	`g_Ãw
 (exit_dialog_item_t,1);

299 
™em
->
Çme
 =‚ame;

300 
™em
->
·th
 =…ath;

301 
™em
->
d©a
 = data;

302 
li¡
 = 
	`g_¦i¡_´•’d
 (li¡, 
™em
);

305 
v®id
 = 
	`gtk_Œ“_mod–_™”_Ãxt
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
);

308 
£Ëùed_couÁ
 = 
	`g_¦i¡_Ëngth
 (
li¡
);

310 ià(
£Ëùed_couÁ
 > 0)

312 *
™ems
 = 
	`g_Ãw
 (
ex™_dŸlog_™em_¬¿y_t
,1);

313 (*
™ems
)->
¬¿y_size
 = 
£Ëùed_couÁ
;

314 (*
™ems
)->
¬¿y
 = 
	`g_Ãw
 (
ex™_dŸlog_™em_t
, (*™ems)->
¬¿y_size
);

316 
li¡_™”
 = 
li¡
;

317 
i
 = 0 ; i < 
£Ëùed_couÁ
 ; i++)

319 
ex™_dŸlog_™em_t
 * 
™em
 = 
li¡_™”
->
d©a
;

320 (*
™ems
)->
¬¿y
[
i
].
Çme
 = 
™em
->name;

321 (*
™ems
)->
¬¿y
[
i
].
·th
 = 
™em
->path;

322 (*
™ems
)->
¬¿y
[
i
].
d©a
 = 
™em
->data;

323 
li¡_™”
 = 
	`g_¦i¡_Ãxt
(list_iter);

326 
	`g_¦i¡_ä“
 (
li¡
);

330 *
™ems
 = 
NULL
;

333  
£Ëùed_couÁ
;

334 
	}
}

341 
	$ex™_dŸlog_ä“_™ems
 (
ex™_dŸlog_™em_¬¿y_t
 * 
™ems
)

343 ià(
™ems
)

345 
i
;

346 
i
 = 0 ; i < 
™ems
->
¬¿y_size
 ; i++)

349 
	`g_ä“
 ( (*)
™ems
->
¬¿y
[
i
].
Çme
);

350 
	`g_ä“
 ( (*)
™ems
->
¬¿y
[
i
].
·th
);

353 
	`g_ä“
 (
™ems
);

355 
	}
}

362 
	$toggË_check_bu‰Ú
 (
GtkC–lR’d””ToggË
 * 
»nd””
,

363 
gch¬
 * 
·th
,

364 
GtkT»eV›w
 * 
Œ“v›w
)

366 
GtkT»eMod–
 * 
mod–
;

367 
GtkT»eI‹r
 
™”
;

368 
gboŞ—n
 
v®ue
;

370 
mod–
 = 
	`gtk_Œ“_v›w_g‘_mod–
 (
Œ“v›w
);

371 ià(
	`gtk_Œ“_mod–_g‘_™”_äom_¡ršg
 (
mod–
, &
™”
, 
·th
))

373 
	`gtk_Œ“_mod–_g‘
 (
mod–
, &
™”
, 
CHECK_COL
, &
v®ue
, -1);

374 
	`gtk_li¡_¡Üe_£t
 (
	`GTK_LIST_STORE
 (
mod–
), &
™”
, 
CHECK_COL
, !
v®ue
, -1);

376 
	}
}

384 
	$ex™_dŸlog_de¡roy
 (
GtkWidg‘
 * 
ex™_dŸlog
,

385 
gpoš‹r
 
d©a
)

387 
GtkT»eV›w
 * 
Œ“v›w
;

388 
GtkT»eI‹r
 
™”
;

389 
GtkT»eMod–
 * 
mod–
;

390 
gboŞ—n
 
v®id
;

392 
Œ“v›w
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
ex™_dŸlog
), 
EXIT_DIALOG_TREEVIEW
);

394 
mod–
 = 
	`GTK_TREE_MODEL
 (
	`gtk_Œ“_v›w_g‘_mod–
 (
Œ“v›w
));

397 
v®id
 = 
	`gtk_Œ“_mod–_g‘_™”_fœ¡
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
);

399 
v®id
)

401 
gch¬
 * 
Çme
 = 
NULL
;

402 
gch¬
 * 
·th
 = 
NULL
;

404 
	`gtk_Œ“_mod–_g‘
 (
mod–
, &
™”
,

405 
NAME_COL
, &
Çme
,

406 
PATH_COL
, &
·th
,

409 
	`g_ä“
 (
Çme
);

410 
	`g_ä“
 (
·th
);

412 
v®id
 = 
	`gtk_Œ“_mod–_™”_Ãxt
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
);

414 
	}
}

422 
	$£Ëùed_¡©e_£t_®l
 (
GtkT»eV›w
 * 
Œ“v›w
,

423 
gboŞ—n
 
¡©e
)

425 
GtkT»eI‹r
 
™”
;

426 
GtkLi¡StÜe
 * 
mod–
;

427 
gboŞ—n
 
v®id
;

429 
mod–
 = 
	`GTK_LIST_STORE
 (
	`gtk_Œ“_v›w_g‘_mod–
 (
Œ“v›w
));

432 
v®id
 = 
	`gtk_Œ“_mod–_g‘_™”_fœ¡
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
);

434 
v®id
)

436 
	`gtk_li¡_¡Üe_£t
 (
mod–
, &
™”
,

437 
CHECK_COL
, 
¡©e
,

440 
v®id
 = 
	`gtk_Œ“_mod–_™”_Ãxt
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
);

442 
	}
}

450 
	$£Ëù_®l_şicked
 (
GtkBu‰Ú
 * 
bu‰Ú
,

451 
gpoš‹r
 
d©a
)

453 
	`£Ëùed_¡©e_£t_®l
 (
d©a
, 
TRUE
);

454 
	}
}

462 
	$£Ëù_nÚe_şicked
 (
GtkBu‰Ú
 * 
bu‰Ú
,

463 
gpoš‹r
 
d©a
)

465 
	`£Ëùed_¡©e_£t_®l
 (
d©a
, 
FALSE
);

466 
	}
}

	@O:\tool\dvs50\app\exit_dialog.h

22 #iâdeà
EXIT_DIALOG_H


23 
	#EXIT_DIALOG_H


	)

25 
	~<gtk/gtkwidg‘.h
>

26 
	~<gtk/gtkwšdow.h
>

28 
G_BEGIN_DECLS


31 
	mEXIT_DIALOG_EXIT_NO_SAVE
,

32 
	mEXIT_DIALOG_EXIT_SAVE_SELECTED
,

33 
	mEXIT_DIALOG_EXIT_CANCEL


36 
GtkWidg‘
 *

37 
ex™_dŸlog_make
 (
GtkWšdow
 * 
·»Á_wšdow
,

38 
gch¬
 * 
t™Ë
);

41 
ex™_dŸlog_add_™em
 (
GtkWidg‘
 * 
dŸlog
,

42 cÚ¡ 
gch¬
 * 
Çme
,

43 cÚ¡ 
gch¬
 * 
f•©h
,

44 cÚ¡ 
gpoš‹r
 
İtiÚ®_d©a
);

48 cÚ¡ 
gch¬
 * 
	mÇme
;

49 cÚ¡ 
gch¬
 * 
	m·th
;

50 
gpoš‹r
 
	md©a
;

52 } 
	tex™_dŸlog_™em_t
;

56 
size_t
 
	m¬¿y_size
;

57 
ex™_dŸlog_™em_t
 * 
	m¬¿y
;

59 } 
	tex™_dŸlog_™em_¬¿y_t
;

61 
gšt


62 
ex™_dŸlog_run
 (
GtkWidg‘
 * 
dŸlog
,

63 
ex™_dŸlog_™em_¬¿y_t
 ** 
™ems_to_§ve
);

65 
ex™_dŸlog_ä“_™ems
 (
ex™_dŸlog_™em_¬¿y_t
 *);

67 
	gG_END_DECLS


	@O:\tool\dvs50\app\filedlg.c

22 
	~<cÚfig.h
>

24 
	~<sys/ty³s.h
>

25 
	~<sys/¡©.h
>

26 
	~<¡ršg.h
>

27 #ifdeà
HAVE_UNISTD_H


28 
	~<uni¡d.h
>

30 
	~<¡dio.h
>

31 
	~<glib/g¡dio.h
>

33 #undeà
GTK_DISABLE_DEPRECATED


34 
	~<gtk/gtk.h
>

35 
	~"š.h
"

36 
	~"f‹r.h
"

37 
	~"dŸ_dœs.h
"

38 
	~"³rsi¡’û.h
"

39 
	~"di¥Ïy.h
"

40 
	~"mes§ge.h
"

41 
	~"Ïy”_dŸlog.h
"

42 
	~"lßd_§ve.h
"

43 
	~"´eã»nûs.h
"

44 
	~"š‹rçû.h
"

45 
	~"»ûÁ_fes.h
"

46 
	~"cÚfœm.h
"

48 
	~"fedlg.h
"

50 
GtkWidg‘
 *
	gİ’dlg
 = 
NULL
;

51 
GtkWidg‘
 *
	g§vedlg
 = 
NULL
;

52 
GtkWidg‘
 *
	gexpÜtdlg
 = 
NULL
;

55 
	$toggË_com´ess_ÿÎback
(
GtkWidg‘
 *
widg‘
)

62 
´efs
.
Ãw_dŸg¿m
.
com´ess_§ve
 =

63 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
widg‘
));

64 
	}
}

70 
DŸImpÜtF‹r
 *

71 
	$if‹r_by_šdex
 (
šdex
, cÚ¡ * 
f’ame
)

73 
DŸImpÜtF‹r
 *
if‹r
 = 
NULL
;

75 ià(
šdex
 >= 0)

76 
if‹r
 = 
	`g_li¡_Áh_d©a
 (
	`f‹r_g‘_impÜt_f‹rs
(), 
šdex
);

77 ià(
f’ame
)

78 
if‹r
 = 
	`f‹r_guess_impÜt_f‹r
(
f’ame
);

80  
if‹r
;

81 
	}
}

83 * (* 
	tF‹rGuessFunc
è(cÚ¡ 
	tgch¬
* 
	tf’ame
);

89 
gboŞ—n


90 
	$m©chšg_ex‹nsiÚs_f‹r
 (cÚ¡ 
GtkFeF‹rInfo
* 
fi
,

91 
gpoš‹r
 
d©a
)

93 
F‹rGuessFunc
 
guess_func
 = (F‹rGuessFunc)
d©a
;

95 
	`g_as£¹
 (
guess_func
);

97 ià(!
fi
->
f’ame
)

100 ià(
	`guess_func
 (
fi
->
f’ame
))

104 
	}
}

116 
	$dŸg¿m_»moved
 (
DŸg¿m
* 
dŸ
, 
GtkWidg‘
* 
dŸlog
)

118 
	`g_»tuº_if_ç
 (
	`DIA_IS_DIAGRAM
 (
dŸ
));

119 
	`g_»tuº_if_ç
 (
	`GTK_IS_WIDGET
 (
dŸlog
));

121 
	`gtk_widg‘_de¡roy
 (
dŸlog
);

122 
	}
}

125 
GtkFeF‹r
 *

126 
	$bud_gtk_fe_f‹r_äom_šdex
 (
šdex
)

128 
DŸImpÜtF‹r
 *
if‹r
 = 
NULL
;

129 
GtkFeF‹r
 *
f‹r
 = 
NULL
;

131 
if‹r
 = 
	`g_li¡_Áh_d©a
 (
	`f‹r_g‘_impÜt_f‹rs
(), 
šdex
-1);

132 ià(
if‹r
) {

133 
GSŒšg
 *
·‰”n
 = 
	`g_¡ršg_Ãw
 ("*.");

134 
i
 = 0;

136 
f‹r
 = 
	`gtk_fe_f‹r_Ãw
 ();

138 
if‹r
->
ex‹nsiÚs
[
i
] !ğ
NULL
) {

139 ià(
i
 != 0)

140 
	`g_¡ršg_­³nd
 (
·‰”n
, "|*.");

141 
	`g_¡ršg_­³nd
 (
·‰”n
, 
if‹r
->
ex‹nsiÚs
[
i
]);

142 ++
i
;

144 
	`gtk_fe_f‹r_£t_Çme
 (
f‹r
, 
	`_
("Supported Formats"));

145 
	`gtk_fe_f‹r_add_·‰”n
 (
f‹r
, 
·‰”n
->
¡r
);

147 
	`g_¡ršg_ä“
 (
·‰”n
, 
TRUE
);

151 
f‹r
 = 
	`gtk_fe_f‹r_Ãw
 ();

152 
	`gtk_fe_f‹r_£t_Çme
 (
f‹r
, 
	`_
("Supported Formats"));

153 
	`gtk_fe_f‹r_add_cu¡om
 (
f‹r
, 
GTK_FILE_FILTER_FILENAME
,

154 
m©chšg_ex‹nsiÚs_f‹r
, 
f‹r_guess_impÜt_f‹r
, 
NULL
);

156  
f‹r
;

157 
	}
}

160 
	$impÜt_ad­t_ex‹nsiÚ_ÿÎback
(
GtkWidg‘
 *
widg‘
)

162 
šdex
 = 
	`gtk_combo_box_g‘_aùive
 (
	`GTK_COMBO_BOX
(
widg‘
));

163 
GtkFeF‹r
 *
fÜm”
 = 
NULL
;

164 
GSLi¡
 *
li¡
, *
–em
;

166 
li¡
 = 
	`gtk_fe_choo£r_li¡_f‹rs
 (
	`GTK_FILE_CHOOSER
 (
İ’dlg
));

167 
–em
 = 
li¡
;ƒËm !ğ
NULL
;ƒËm = 
	`g_¦i¡_Ãxt
 (elem))

168 ià(
	`¡rcmp
 (
	`_
("SuµÜ‹d FÜm©s"), 
	`gtk_fe_f‹r_g‘_Çme
 (
	`GTK_FILE_FILTER
(
–em
->
d©a
))) == 0)

169 
fÜm”
 = 
	`GTK_FILE_FILTER
(
–em
->
d©a
);

170 
	`g_¦i¡_ä“
 (
li¡
);

172 ià(
fÜm”
) {

174 
GtkFeF‹r
 *
f‹r
 = 
	`bud_gtk_fe_f‹r_äom_šdex
 (
šdex
);

175 
	`gtk_fe_choo£r_»move_f‹r
 (
	`GTK_FILE_CHOOSER
 (
İ’dlg
), 
fÜm”
);

176 
	`gtk_fe_choo£r_add_f‹r
 (
	`GTK_FILE_CHOOSER
 (
İ’dlg
), 
f‹r
);

177 
	`gtk_fe_choo£r_£t_f‹r
 (
	`GTK_FILE_CHOOSER
 (
İ’dlg
), 
f‹r
);

179 
	}
}

184 
GtkWidg‘
 *

185 
	$ü—‹_İ’_m’u
()

187 
GtkWidg‘
 *
m’u
;

188 
GLi¡
 *
tmp
;

191 
m’u
 = 
	`gtk_combo_box_Ãw_‹xt
 ();

192 
	`gtk_combo_box_­³nd_‹xt
(
	`GTK_COMBO_BOX
(
m’u
), 
	`_
("Byƒxtension"));

194 
tmp
 = 
	`f‹r_g‘_impÜt_f‹rs
();m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

195 
DŸImpÜtF‹r
 *
if‹r
 = 
tmp
->
d©a
;

196 
gch¬
 *
f‹r_Ïb–
;

198 ià(!
if‹r
)

200 
f‹r_Ïb–
 = 
	`f‹r_g‘_impÜt_f‹r_Ïb–
(
if‹r
);

201 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
(
m’u
), 
f‹r_Ïb–
);

202 
	`g_ä“
(
f‹r_Ïb–
);

204 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
m’u
), "changed",

205 
	`G_CALLBACK
(
impÜt_ad­t_ex‹nsiÚ_ÿÎback
), 
NULL
);

206  
m’u
;

207 
	}
}

213 
	$fe_İ’_»¥Ú£_ÿÎback
(
GtkWidg‘
 *
fs
,

214 
gšt
 
»¥Ú£
,

215 
gpoš‹r
 
u£r_d©a
)

217 *
f’ame
;

218 
DŸg¿m
 *
dŸg¿m
 = 
NULL
;

220 ià(
»¥Ú£
 =ğ
GTK_RESPONSE_ACCEPT
) {

221 
gšt
 
šdex
 = 
	`gtk_combo_box_g‘_aùive
 (
	`GTK_COMBO_BOX
(
u£r_d©a
));

223 ià(
šdex
 >= 0)

224 
	`³rsi¡’û_£t_š‹g”
 ("impÜt-f‹r", 
šdex
);

225 
f’ame
 = 
	`gtk_fe_choo£r_g‘_f’ame
(
	`GTK_FILE_CHOOSER
(
fs
));

227 
dŸg¿m
 = 
	`dŸg¿m_lßd
(
f’ame
, 
	`if‹r_by_šdex
 (
šdex
 - 1, filename));

229 
	`g_ä“
 (
f’ame
);

231 ià(
dŸg¿m
 !ğ
NULL
) {

232 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸg¿m
);

233 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸg¿m
);

235 ià(
dŸg¿m
->
di¥Ïys
 =ğ
NULL
) {

247 
	`Ãw_di¥Ïy
(
dŸg¿m
);

251 
	`gtk_widg‘_de¡roy
(
İ’dlg
);

252 
	}
}

260 
	$fe_İ’_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

262 ià(!
İ’dlg
) {

263 
DDi¥Ïy
 *
ddi¥
;

264 
DŸg¿m
 *
dŸ
 = 
NULL
;

265 
GtkWšdow
 *
·»Á_wšdow
;

266 
gch¬
 *
f’ame
 = 
NULL
;

273 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

274 ià(
ddi¥
) {

275 
dŸ
 = 
ddi¥
->
dŸg¿m
;

276 
·»Á_wšdow
 = 
	`GTK_WINDOW
(
ddi¥
->
sh–l
);

278 
·»Á_wšdow
 = 
	`GTK_WINDOW
(
	`š‹rçû_g‘_toŞbox_sh–l
());

280 
	`³rsi¡’û_»gi¡”_š‹g”
 ("import-filter", 0);

281 
İ’dlg
 = 
	`gtk_fe_choo£r_dŸlog_Ãw_w™h_back’d
(
	`_
("O³ÀDŸg¿m"), 
·»Á_wšdow
,

282 
GTK_FILE_CHOOSER_ACTION_OPEN
,

284 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

285 
GTK_STOCK_OPEN
, 
GTK_RESPONSE_ACCEPT
,

286 
NULL
);

287 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
	`GTK_DIALOG
(
İ’dlg
), 
GTK_RESPONSE_ACCEPT
);

288 
	`gtk_wšdow_£t_rŞe
(
	`GTK_WINDOW
(
İ’dlg
), "open_diagram");

289 ià(
dŸ
 && dŸ->
f’ame
)

290 
f’ame
 = 
	`g_f’ame_äom_utf8
(
dŸ
->f’ame, -1, 
NULL
, NULL, NULL);

291 ià(
f’ame
 !ğ
NULL
) {

292 * 
âabs
 = 
	`dŸ_g‘_absŞu‹_f’ame
 (
f’ame
);

293 ià(
âabs
)

294 
	`gtk_fe_choo£r_£t_f’ame
(
	`GTK_FILE_CHOOSER
(
İ’dlg
), 
âabs
);

295 
	`g_ä“
(
âabs
);

296 
	`g_ä“
(
f’ame
);

298 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
İ’dlg
), "destroy",

299 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
İ’dlg
);

301 
	`gtk_widg‘_£t_£ns™ive
(
İ’dlg
, 
TRUE
);

302 ià(
	`GTK_WIDGET_VISIBLE
(
İ’dlg
))

305 ià(!
	`gtk_fe_choo£r_g‘_exŒa_widg‘
(
	`GTK_FILE_CHOOSER
(
İ’dlg
))) {

306 
GtkWidg‘
 *
hbox
, *
Ïb–
, *
om’u
, *
İtiÚs
;

307 
GtkFeF‹r
* 
f‹r
;

309 
İtiÚs
 = 
	`gtk_äame_Ãw
(
	`_
("Open Options"));

310 
	`gtk_äame_£t_shadow_ty³
(
	`GTK_FRAME
(
İtiÚs
), 
GTK_SHADOW_ETCHED_IN
);

312 
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
, 1);

313 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
hbox
), 5);

314 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
İtiÚs
), 
hbox
);

315 
	`gtk_widg‘_show
(
hbox
);

317 
Ïb–
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("Determine fileype:"));

318 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
Ïb–
, 
FALSE
, 
TRUE
, 0);

319 
	`gtk_widg‘_show
 (
Ïb–
);

321 
om’u
 = 
	`ü—‹_İ’_m’u
();

322 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
), 
om’u
, 
TRUE
, TRUE, 0);

323 
	`gtk_widg‘_show
(
om’u
);

325 
	`gtk_fe_choo£r_£t_exŒa_widg‘
(
	`GTK_FILE_CHOOSER
(
İ’dlg
),

326 
İtiÚs
);

328 
	`gtk_widg‘_show
(
İtiÚs
);

329 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
İ’dlg
), "response",

330 
	`G_CALLBACK
(
fe_İ’_»¥Ú£_ÿÎback
), 
om’u
);

334 
	`gtk_fe_choo£r_add_f‹r
 (
	`GTK_FILE_CHOOSER
 (
İ’dlg
),

335 
	`bud_gtk_fe_f‹r_äom_šdex
 (0));

336 
f‹r
 = 
	`gtk_fe_f‹r_Ãw
 ();

337 
	`gtk_fe_f‹r_£t_Çme
 (
f‹r
, 
	`_
("All Files"));

338 
	`gtk_fe_f‹r_add_·‰”n
 (
f‹r
, "*");

339 
	`gtk_fe_choo£r_add_f‹r
 (
	`GTK_FILE_CHOOSER
 (
İ’dlg
), 
f‹r
);

341 
	`gtk_combo_box_£t_aùive
 (
	`GTK_COMBO_BOX
 (
om’u
), 
	`³rsi¡’û_g‘_š‹g”
 ("import-filter"));

344 
	`gtk_widg‘_show
(
İ’dlg
);

345 
	}
}

351 
	$fe_§ve_as_»¥Ú£_ÿÎback
(
GtkWidg‘
 *
fs
,

352 
gšt
 
»¥Ú£
,

353 
gpoš‹r
 
u£r_d©a
)

355 *
f’ame
;

356 
DŸg¿m
 *
dŸ
;

357 
¡©
 
¡©_¡ruù
;

359 ià(
»¥Ú£
 =ğ
GTK_RESPONSE_ACCEPT
) {

360 
dŸ
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
(
fs
), "user_data");

362 
f’ame
 = 
	`gtk_fe_choo£r_g‘_f’ame
(
	`GTK_FILE_CHOOSER
(
fs
));

364 ià(
	`g_¡©
(
f’ame
, &
¡©_¡ruù
) == 0) {

365 
GtkWidg‘
 *
dŸlog
 = 
NULL
;

366 *
utf8f’ame
 = 
NULL
;

367 ià(!
	`g_utf8_v®id©e
(
f’ame
, -1, 
NULL
)) {

368 
utf8f’ame
 = 
	`g_f’ame_to_utf8
(
f’ame
, -1, 
NULL
, NULL, NULL);

369 ià(
utf8f’ame
 =ğ
NULL
) {

370 
	`mes§ge_w¬nšg
(
	`_
("Some characters inhe filename‡re‚either UTF-8\n"

374 ià(
utf8f’ame
 =ğ
NULL
èutf8f’amğ
	`g_¡rdup
(
f’ame
);

377 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
 (
	`GTK_WINDOW
(
fs
),

378 
GTK_DIALOG_MODAL
, 
GTK_MESSAGE_QUESTION
,

379 
GTK_BUTTONS_YES_NO
,

380 
	`_
("File‡lreadyƒxists"));

381 
	`gtk_mes§ge_dŸlog_fÜm©_£cÚd¬y_‹xt
(
	`GTK_MESSAGE_DIALOG
(
dŸlog
),

382 
	`_
("The file '%s'‡lreadyƒxists.\n"

383 "DØyou wªˆtØov”wr™™?"), 
utf8f’ame
);

384 
	`g_ä“
(
utf8f’ame
);

385 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
 (
dŸlog
), 
GTK_RESPONSE_YES
);

387 ià(
	`gtk_dŸlog_run
 (
	`GTK_DIALOG
 (
dŸlog
)è!ğ
GTK_RESPONSE_YES
) {

389 
	`gtk_wšdow_´e£Á
 (
	`GTK_WINDOW
 (
fs
));

390 
	`gtk_widg‘_de¡roy
(
dŸlog
);

391 
	`g_ä“
 (
f’ame
);

394 
	`gtk_widg‘_de¡roy
(
dŸlog
);

398 
dŸ
->
d©a
->
is_com´es£d
 = 0;

400 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸ
);

402 
	`dŸg¿m_£t_f’ame
(
dŸ
, 
f’ame
);

403 ià(
	`dŸg¿m_§ve
(
dŸ
, 
f’ame
))

404 
	`»ûÁ_fe_hi¡Üy_add
(
f’ame
);

406 
	`g_ä“
 (
f’ame
);

409 ià((
dŸ
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
(
fs
), "u£r_d©a")è!ğ
NULL
) {

410 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
(
fs
), "u£r_d©a", 
NULL
);

411 
	`g_objeù_uÄef
 (
dŸ
);

413 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
fs
));

414 
	}
}

424 
	$fe_§ve_as_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

426 
DDi¥Ïy
 *
ddi¥
;

427 
DŸg¿m
 *
dŸ
;

428 
gch¬
 *
f’ame
 = 
NULL
;

430 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

431 ià(!
ddi¥
) ;

432 
dŸ
 = 
ddi¥
->
dŸg¿m
;

434 ià(!
§vedlg
) {

435 
GtkWidg‘
 *
com´essbu‰Ú
;

437 
§vedlg
 = 
	`gtk_fe_choo£r_dŸlog_Ãw_w™h_back’d
(
	`_
("Save Diagram"),

438 
	`GTK_WINDOW
(
ddi¥
->
sh–l
),

439 
GTK_FILE_CHOOSER_ACTION_SAVE
,

441 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

442 
GTK_STOCK_SAVE
, 
GTK_RESPONSE_ACCEPT
,

443 
NULL
);

444 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
	`GTK_DIALOG
(
§vedlg
), 
GTK_RESPONSE_ACCEPT
);

445 
	`gtk_wšdow_£t_rŞe
(
	`GTK_WINDOW
(
§vedlg
), "save_diagram");

448 
com´essbu‰Ú
 = 
	`gtk_check_bu‰Ú_Ãw_w™h_Ïb–
(
	`_
("Compress diagram files"));

449 
	`gtk_fe_choo£r_£t_exŒa_widg‘
(
	`GTK_FILE_CHOOSER
(
§vedlg
),

450 
com´essbu‰Ú
);

452 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
com´essbu‰Ú
),

453 
dŸ
->
d©a
->
is_com´es£d
);

454 
	`gtk_widg‘_£t_£ns™ive
(
com´essbu‰Ú
,
FALSE
);

455 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
com´essbu‰Ú
), "toggled",

456 
	`G_CALLBACK
(
toggË_com´ess_ÿÎback
), 
NULL
);

457 
	`gtk_widg‘_show
(
com´essbu‰Ú
);

458 #ià
	`GTK_CHECK_VERSION
 (2,12,0)

459 
	`gtk_widg‘_£t_toŞt_‹xt
 (
com´essbu‰Ú
,

460 
	`_
("Compression„educes file sizeo†esshan 1/10th "

464 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
com´essbu‰Ú
,

465 
	`_
("Compression„educes file sizeo†esshan 1/10th "

467 "´og¿m ÿÂÙ mªuÏ‹ com´es£d fes."), 
NULL
);

469 
	`g_sigÇl_cÚÃù
 (
	`GTK_FILE_CHOOSER
(
§vedlg
),

470 "»¥Ú£", 
	`G_CALLBACK
(
fe_§ve_as_»¥Ú£_ÿÎback
), 
com´essbu‰Ú
);

471 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
§vedlg
), "destroy",

472 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
§vedlg
);

474 
GtkWidg‘
 *
com´essbu‰Ú
 = 
	`gtk_fe_choo£r_g‘_exŒa_widg‘
(
	`GTK_FILE_CHOOSER
(
§vedlg
));

475 
	`gtk_widg‘_£t_£ns™ive
(
§vedlg
, 
TRUE
);

476 
	`g_sigÇl_hªdËrs_block_by_func
(
	`G_OBJECT
(
com´essbu‰Ú
), 
toggË_com´ess_ÿÎback
, 
NULL
);

477 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
com´essbu‰Ú
),

478 
dŸ
->
d©a
->
is_com´es£d
);

479 
	`g_sigÇl_hªdËrs_unblock_by_func
(
	`G_OBJECT
(
com´essbu‰Ú
), 
toggË_com´ess_ÿÎback
, 
NULL
);

480 ià(
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
§vedlg
), "u£r_d©a"è!ğ
NULL
)

481 
	`g_objeù_uÄef
 (
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
§vedlg
), "user_data"));

482 ià(
	`GTK_WIDGET_VISIBLE
(
§vedlg
)) {

484 
	`g_objeù_»f
(
dŸ
);

485 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
§vedlg
), "u£r_d©a", 
dŸ
);

486 
	`gtk_wšdow_´e£Á
 (
	`GTK_WINDOW
(
§vedlg
));

490 ià(
dŸ
 && dŸ->
f’ame
)

491 
f’ame
 = 
	`g_f’ame_äom_utf8
(
dŸ
->f’ame, -1, 
NULL
, NULL, NULL);

492 ià(
f’ame
 !ğ
NULL
) {

493 * 
âabs
 = 
	`dŸ_g‘_absŞu‹_f’ame
 (
f’ame
);

494 ià(
âabs
) {

495 
gch¬
 *
ba£
 = 
	`g_·th_g‘_ba£Çme
(
dŸ
->
f’ame
);

496 
	`gtk_fe_choo£r_£t_f’ame
(
	`GTK_FILE_CHOOSER
(
§vedlg
), 
âabs
);

499 
	`gtk_fe_choo£r_£t_cu¼’t_Çme
(
	`GTK_FILE_CHOOSER
(
§vedlg
), 
ba£
);

500 
	`g_ä“
(
ba£
);

502 
	`g_ä“
(
âabs
);

503 
	`g_ä“
(
f’ame
);

505 
	`g_objeù_»f
(
dŸ
);

506 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
§vedlg
), "u£r_d©a", 
dŸ
);

508 
	`gtk_widg‘_show
(
§vedlg
);

509 
	}
}

517 
	$fe_§ve_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

519 
DŸg¿m
 *
dŸg¿m
;

521 
dŸg¿m
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

522 ià(!
dŸg¿m
) ;

524 ià(
dŸg¿m
->
un§ved
) {

525 
	`fe_§ve_as_ÿÎback
(
d©a
, 
aùiÚ
, 
widg‘
);

527 
gch¬
 *
f’ame
 = 
	`g_f’ame_äom_utf8
(
dŸg¿m
->f’ame, -1, 
NULL
, NULL, NULL);

528 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸg¿m
);

529 ià(
	`dŸg¿m_§ve
(
dŸg¿m
, 
f’ame
))

530 
	`»ûÁ_fe_hi¡Üy_add
(
f’ame
);

531 
	`g_ä“
 (
f’ame
);

533 
	}
}

538 
DŸExpÜtF‹r
 *

539 
	$ef‹r_by_šdex
 (
šdex
, cÚ¡ 
gch¬
** 
ext
)

541 
DŸExpÜtF‹r
 *
ef‹r
 = 
NULL
;

545 ià(
šdex
 >= 0) {

546 
ef‹r
 = 
	`g_li¡_Áh_d©a
 (
	`f‹r_g‘_expÜt_f‹rs
(), 
šdex
);

547 ià(
ef‹r
) {

548 ià(
ext
)

549 *
ext
 = 
ef‹r
->
ex‹nsiÚs
[0];

550  
ef‹r
;

553 
	`g_w¬nšg
 ("ef‹r_by_šdex(èšdex=%d ouˆoà¿nge", 
šdex
);

556  
ef‹r
;

557 
	}
}

563 
	$expÜt_ad­t_ex‹nsiÚ
 (cÚ¡ 
gch¬
* 
Çme
, 
šdex
)

565 cÚ¡ 
gch¬
* 
ext
 = 
NULL
;

566 
DŸExpÜtF‹r
 *
ef‹r
 = 
	`ef‹r_by_šdex
 (
šdex
, &
ext
);

567 
gch¬
 *
ba£Çme
 = 
	`g_·th_g‘_ba£Çme
 (
Çme
);

568 
gch¬
 *
utf8_Çme
 = 
NULL
;

570 ià(!
ef‹r
 || !
ext
)

571 
utf8_Çme
 = 
	`g_f’ame_to_utf8
 (
ba£Çme
, -1, 
NULL
, NULL, NULL);

573 cÚ¡ 
gch¬
 *
Ï¡_dÙ
 = 
	`¡¼chr
(
ba£Çme
, '.');

574 
GSŒšg
 *
s
 = 
	`g_¡ršg_Ãw
(
ba£Çme
);

575 ià(
Ï¡_dÙ
)

576 
	`g_¡ršg_Œunÿ‹
(
s
, 
Ï¡_dÙ
-
ba£Çme
);

577 
	`g_¡ršg_­³nd
(
s
, ".");

578 
	`g_¡ršg_­³nd
(
s
, 
ext
);

579 
utf8_Çme
 = 
	`g_f’ame_to_utf8
 (
s
->
¡r
, -1, 
NULL
, NULL, NULL);

580 
	`g_¡ršg_ä“
 (
s
, 
TRUE
);

582 
	`gtk_fe_choo£r_£t_cu¼’t_Çme
(
	`GTK_FILE_CHOOSER
(
expÜtdlg
), 
utf8_Çme
);

583 
	`g_ä“
 (
utf8_Çme
);

584 
	`g_ä“
 (
ba£Çme
);

585 
	}
}

587 
	$expÜt_ad­t_ex‹nsiÚ_ÿÎback
(
GtkWidg‘
 *
widg‘
)

589 
šdex
 = 
	`gtk_combo_box_g‘_aùive
 (
	`GTK_COMBO_BOX
(
widg‘
));

590 
gch¬
 *
Çme
 = 
	`gtk_fe_choo£r_g‘_f’ame
(
	`GTK_FILE_CHOOSER
(
expÜtdlg
));

592 ià(
Çme
 && 
šdex
 > 0)

593 
	`expÜt_ad­t_ex‹nsiÚ
 (
Çme
, 
šdex
 - 1);

594 
	`g_ä“
 (
Çme
);

595 
	}
}

600 
GtkWidg‘
 *

601 
	$ü—‹_expÜt_m’u
()

603 
GtkWidg‘
 *
m’u
;

604 
GLi¡
 *
tmp
;

606 
m’u
 = 
	`gtk_combo_box_Ãw_‹xt
 ();

607 
	`gtk_combo_box_­³nd_‹xt
(
	`GTK_COMBO_BOX
(
m’u
), 
	`_
("Byƒxtension"));

609 
tmp
 = 
	`f‹r_g‘_expÜt_f‹rs
();m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

610 
DŸExpÜtF‹r
 *
ef
 = 
tmp
->
d©a
;

611 
gch¬
 *
f‹r_Ïb–
;

613 ià(!
ef
)

615 
f‹r_Ïb–
 = 
	`f‹r_g‘_expÜt_f‹r_Ïb–
(
ef
);

616 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
(
m’u
), 
f‹r_Ïb–
);

617 
	`g_ä“
(
f‹r_Ïb–
);

619 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
m’u
), "changed",

620 
	`G_CALLBACK
(
expÜt_ad­t_ex‹nsiÚ_ÿÎback
), 
NULL
);

621  
m’u
;

622 
	}
}

628 
	$fe_expÜt_»¥Ú£_ÿÎback
(
GtkWidg‘
 *
fs
,

629 
gšt
 
»¥Ú£
,

630 
gpoš‹r
 
u£r_d©a
)

632 *
f’ame
;

633 
DŸg¿m
 *
dŸ
;

634 
DŸExpÜtF‹r
 *
ef
;

635 
¡©
 
¡©buf
;

637 
dŸ
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
fs
), "user_data");

638 
	`g_as£¹
 (
dŸ
);

640 ià(
»¥Ú£
 =ğ
GTK_RESPONSE_ACCEPT
) {

641 
gšt
 
šdex
;

643 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸ
);

645 
f’ame
 = 
	`gtk_fe_choo£r_g‘_f’ame
(
	`GTK_FILE_CHOOSER
(
fs
));

647 ià(
	`g_¡©
(
f’ame
, &
¡©buf
) == 0) {

648 
GtkWidg‘
 *
dŸlog
 = 
NULL
;

650 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
 (
	`GTK_WINDOW
(
fs
),

651 
GTK_DIALOG_MODAL
 | 
GTK_DIALOG_DESTROY_WITH_PARENT
,

652 
GTK_MESSAGE_QUESTION
,

653 
GTK_BUTTONS_YES_NO
,

654 
	`_
("File‡lreadyƒxists"));

655 
	`gtk_mes§ge_dŸlog_fÜm©_£cÚd¬y_‹xt
(
	`GTK_MESSAGE_DIALOG
(
dŸlog
),

656 
	`_
("The file '%s'‡lreadyƒxists.\n"

657 "DØyou wªˆtØov”wr™™?"), 
	`dŸ_mes§ge_f’ame
(
f’ame
));

658 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
 (
dŸlog
), 
GTK_RESPONSE_YES
);

660 ià(
	`gtk_dŸlog_run
 (
	`GTK_DIALOG
 (
dŸlog
)è!ğ
GTK_RESPONSE_YES
) {

662 
	`gtk_widg‘_de¡roy
(
dŸlog
);

663 
	`g_ä“
 (
f’ame
);

666 
	`gtk_widg‘_de¡roy
(
dŸlog
);

669 
šdex
 = 
	`gtk_combo_box_g‘_aùive
 (
	`GTK_COMBO_BOX
(
u£r_d©a
));

670 ià(
šdex
 >= 0)

671 
	`³rsi¡’û_£t_š‹g”
 ("expÜt-f‹r", 
šdex
);

672 
ef
 = 
	`ef‹r_by_šdex
 (
šdex
 - 1, 
NULL
);

673 ià(!
ef
)

674 
ef
 = 
	`f‹r_guess_expÜt_f‹r
(
f’ame
);

675 ià(
ef
) {

676 
	`g_objeù_»f
(
dŸ
->
d©a
);

677 
ef
->
	`expÜt_func
(
dŸ
->
d©a
, 
f’ame
, dŸ->f’ame,ƒf->
u£r_d©a
);

678 
	`g_objeù_uÄef
(
dŸ
->
d©a
);

680 
	`mes§ge_”rÜ
(
	`_
("Could‚ot determine whichƒxport filter\n"

681 "tØu£Ø§v'%s'"), 
	`dŸ_mes§ge_f’ame
(
f’ame
));

682 
	`g_ä“
 (
f’ame
);

684 
	`g_objeù_uÄef
 (
dŸ
);

685 
	`gtk_widg‘_de¡roy
(
expÜtdlg
);

686 
	}
}

692 
	$fe_expÜt_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

694 
DDi¥Ïy
 *
ddi¥
;

695 
DŸg¿m
 *
dŸ
;

696 
gch¬
 *
f’ame
 = 
NULL
;

698 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

699 ià(!
ddi¥
) ;

700 
dŸ
 = 
ddi¥
->
dŸg¿m
;

702 ià(!
	`cÚfœm_expÜt_size
 (
dŸ
, 
	`GTK_WINDOW
(
ddi¥
->
sh–l
), 
CONFIRM_MEMORY
|
CONFIRM_PAGES
))

705 ià(!
expÜtdlg
) {

706 
	`³rsi¡’û_»gi¡”_š‹g”
 ("export-filter", 0);

707 
expÜtdlg
 = 
	`gtk_fe_choo£r_dŸlog_Ãw_w™h_back’d
(
	`_
("Export Diagram"),

708 
	`GTK_WINDOW
(
ddi¥
->
sh–l
),

709 
GTK_FILE_CHOOSER_ACTION_SAVE
,

711 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

712 
GTK_STOCK_SAVE
, 
GTK_RESPONSE_ACCEPT
,

713 
NULL
);

714 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
	`GTK_DIALOG
(
expÜtdlg
), 
GTK_RESPONSE_ACCEPT
);

715 
	`gtk_wšdow_£t_rŞe
(
	`GTK_WINDOW
(
expÜtdlg
), "export_diagram");

716 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
expÜtdlg
), "destroy",

717 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
expÜtdlg
);

719 ià(!
	`gtk_fe_choo£r_g‘_exŒa_widg‘
(
	`GTK_FILE_CHOOSER
(
expÜtdlg
))) {

720 
GtkWidg‘
 *
hbox
, *
Ïb–
, *
om’u
, *
İtiÚs
;

721 
GtkFeF‹r
* 
f‹r
;

723 
İtiÚs
 = 
	`gtk_äame_Ãw
(
	`_
("Export Options"));

724 
	`gtk_äame_£t_shadow_ty³
(
	`GTK_FRAME
(
İtiÚs
), 
GTK_SHADOW_ETCHED_IN
);

726 
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
, 1);

727 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
hbox
), 5);

728 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
İtiÚs
), 
hbox
);

729 
	`gtk_widg‘_show
(
hbox
);

731 
Ïb–
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("Determine fileype:"));

732 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
Ïb–
, 
FALSE
, 
TRUE
, 0);

733 
	`gtk_widg‘_show
 (
Ïb–
);

735 
om’u
 = 
	`ü—‹_expÜt_m’u
();

736 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
), 
om’u
, 
TRUE
, TRUE, 0);

737 
	`gtk_widg‘_show
(
om’u
);

738 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
expÜtdlg
), "expÜt-m’u", 
om’u
);

740 
	`gtk_widg‘_show
(
İtiÚs
);

741 
	`gtk_fe_choo£r_£t_exŒa_widg‘
(
	`GTK_FILE_CHOOSER
(
expÜtdlg
), 
İtiÚs
);

743 
f‹r
 = 
	`gtk_fe_f‹r_Ãw
 ();

744 
	`gtk_fe_f‹r_£t_Çme
 (
f‹r
, 
	`_
("All Files"));

745 
	`gtk_fe_f‹r_add_·‰”n
 (
f‹r
, "*");

746 
	`gtk_fe_choo£r_add_f‹r
 (
	`GTK_FILE_CHOOSER
 (
expÜtdlg
), 
f‹r
);

748 
f‹r
 = 
	`gtk_fe_f‹r_Ãw
 ();

749 
	`gtk_fe_f‹r_£t_Çme
 (
f‹r
, 
	`_
("Supported Formats"));

750 
	`gtk_fe_f‹r_add_cu¡om
 (
f‹r
, 
GTK_FILE_FILTER_FILENAME
,

751 
m©chšg_ex‹nsiÚs_f‹r
, 
f‹r_guess_expÜt_f‹r
, 
NULL
);

752 
	`gtk_fe_choo£r_add_f‹r
 (
	`GTK_FILE_CHOOSER
 (
expÜtdlg
), 
f‹r
);

754 
	`gtk_combo_box_£t_aùive
 (
	`GTK_COMBO_BOX
 (
om’u
), 
	`³rsi¡’û_g‘_š‹g”
 ("export-filter"));

756 
	`g_sigÇl_cÚÃù
(
	`GTK_FILE_CHOOSER
(
expÜtdlg
),

757 "»¥Ú£", 
	`G_CALLBACK
(
fe_expÜt_»¥Ú£_ÿÎback
), 
om’u
);

759 ià(
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
(
expÜtdlg
), "user_data"))

760 
	`g_objeù_uÄef
 (
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
(
expÜtdlg
), "user_data"));

761 
	`g_objeù_»f
(
dŸ
);

762 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
expÜtdlg
), "u£r_d©a", 
dŸ
);

763 
	`gtk_widg‘_£t_£ns™ive
(
expÜtdlg
, 
TRUE
);

765 ià(
dŸ
 && dŸ->
f’ame
)

766 
f’ame
 = 
	`g_f’ame_äom_utf8
(
dŸ
->f’ame, -1, 
NULL
, NULL, NULL);

767 ià(
f’ame
 !ğ
NULL
) {

768 * 
âabs
 = 
	`dŸ_g‘_absŞu‹_f’ame
 (
f’ame
);

769 ià(
âabs
) {

770 *
fŞd”
 = 
	`g_·th_g‘_dœÇme
 (
âabs
);

771 *
ba£Çme
 = 
	`g_·th_g‘_ba£Çme
 (
âabs
);

773 
	`gtk_fe_choo£r_£t_cu¼’t_fŞd”
 (
	`GTK_FILE_CHOOSER
(
expÜtdlg
), 
fŞd”
);

774 
	`expÜt_ad­t_ex‹nsiÚ
 (
ba£Çme
, 
	`³rsi¡’û_g‘_š‹g”
 ("export-filter") - 1);

775 
	`g_ä“
 (
fŞd”
);

776 
	`g_ä“
 (
ba£Çme
);

778 
	`g_ä“
(
âabs
);

779 
	`g_ä“
(
f’ame
);

782 
	`gtk_widg‘_show
(
expÜtdlg
);

783 
	}
}

	@O:\tool\dvs50\app\filedlg.h

22 #iâdeà
FILEDLG_H


23 
	#FILEDLG_H


	)

25 
	~<gtk/gtk.h
>

27 
fe_İ’_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

28 
fe_§ve_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

29 
fe_§ve_as_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

30 
fe_expÜt_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

	@O:\tool\dvs50\app\find-and-replace.c

24 
	~<cÚfig.h
>

26 
	~<gtk/gtk.h
>

28 
	~"š.h
"

30 
	~"dŸg¿m.h
"

31 
	~"di¥Ïy.h
"

32 
	~"objeù.h
"

33 
	~"objeù_İs.h
"

34 
	~"cÚÃùiÚpošt_İs.h
"

35 
	~"undo.h
"

37 
	~"fšd-ªd-»¶aû.h
"

39 
	~"´İš‹º®s.h
"

42 
	mRESPONSE_FIND
 = -20,

43 
	mRESPONSE_REPLACE
 = -21,

44 
	mRESPONSE_REPLACE_ALL
 = -23

48 
	mMATCH_CASE
 = (1<<0),

49 
	mMATCH_WORD
 = (1<<1),

51 
	mMATCH_ALL_PROPERTIES
 = (1<<2)

54 
	s_S—rchD©a
 {

55 cÚ¡ 
gch¬
 *
	mkey
;

56 
gušt
 
	mæags
;

57 
DŸg¿m
 *
	mdŸg¿m
;

58 
DŸObjeù
 *
	mfœ¡
;

59 
DŸObjeù
 *
	mfound
;

60 
DŸObjeù
 *
	mÏ¡
;

61 
gboŞ—n
 
	m£’_Ï¡
;

62 } 
	tS—rchD©a
;

67 
gboŞ—n


68 
	$_m©ch_‹xt_´İ
 (
DŸObjeù
 *
obj
, cÚ¡ 
S—rchD©a
 *
sd
, cÚ¡ 
gch¬
 *
»¶aûm’t
, gch¬ **
v®ue_to_m©ch
)

70 
gboŞ—n
 
is_m©ch
 = 
FALSE
;

71 
gch¬
 *
»¶
 = 
NULL
;

73 ià(!
v®ue_to_m©ch
 || *v®ue_to_m©ch =ğ
NULL
)

74  
FALSE
;

77 ià(
sd
->
æags
 & 
MATCH_CASE
) {

78 cÚ¡ 
gch¬
 *
p
 = 
	`¡r¡r
 (*
v®ue_to_m©ch
, 
sd
->
key
);

79 
is_m©ch
 = 
p
 !ğ
NULL
;

80 ià(
p
 && 
»¶aûm’t
) {

81 
gch¬
 *
a
 = 
	`g_¡ºdup
 (*
v®ue_to_m©ch
, 
p
 - *value_to_match);

82 
gch¬
 *
b
 = 
	`g_¡rdup
 (
p
 + 
	`¡¾’
(
sd
->
key
));

83 
»¶
 = 
	`g_¡rdup_´štf
 ("%s%s%s", 
a
, 
»¶aûm’t
, 
b
);

84 
	`g_ä“
 (
a
);

85 
	`g_ä“
 (
b
);

88 
gch¬
 *
s1
 = 
	`g_utf8_ÿ£fŞd
 (*
v®ue_to_m©ch
, -1);

89 
gch¬
 *
s2
 = 
	`g_utf8_ÿ£fŞd
 (
sd
->
key
, -1);

90 cÚ¡ 
gch¬
 *
p
 = 
	`¡r¡r
 (
s1
, 
s2
);

91 
is_m©ch
 = 
p
 !ğ
NULL
;

92 ià(
p
 && 
»¶aûm’t
) {

93 
gch¬
 *
a
 = 
	`g_¡ºdup
 (*
v®ue_to_m©ch
, 
p
 - 
s1
);

94 
gch¬
 *
b
 = 
	`g_¡rdup
 (*
v®ue_to_m©ch
 + 
	`¡¾’
(
a
è+ sŒËn(
sd
->
key
));

95 
»¶
 = 
	`g_¡rdup_´štf
 ("%s%s%s", 
a
, 
»¶aûm’t
, 
b
);

96 
	`g_ä“
 (
a
);

97 
	`g_ä“
 (
b
);

99 
	`g_ä“
 (
s1
);

100 
	`g_ä“
 (
s2
);

103 ià(
sd
->
æags
 & 
MATCH_WORD
)

104 
is_m©ch
 = (is_m©ch && 
	`¡¾’
(*
v®ue_to_m©ch
è=ğ¡¾’(
sd
->
key
));

107 ià(
is_m©ch
 && 
»¶aûm’t
) {

108 
	`g_ä“
 (*
v®ue_to_m©ch
);

109 *
v®ue_to_m©ch
 = 
»¶
;

111 
	`g_ä“
 (
»¶
);

114  
is_m©ch
;

115 
	}
}

119 
GPŒA¼ay
 *

120 
	$_m©ch_Çme_´İ
 (
DŸObjeù
 *
obj
, cÚ¡ 
S—rchD©a
 *
sd
, cÚ¡ 
gch¬
 *
»¶aûm’t
)

122 
Prİ”ty
 *
´İ
;

123 
gch¬
 **
Çme
;

124 
gboŞ—n
 
is_m©ch
 = 
FALSE
;

125 
GPŒA¼ay
 *
¶i¡
 = 
NULL
;

127 ià((
´İ
 = 
	`objeù_´İ_by_Çme
(
obj
, "Çme")è!ğ
NULL
)

128 
Çme
 = &((
SŒšgPrİ”ty
 *)
´İ
)->
¡ršg_d©a
;

129 ià((
´İ
 = 
	`objeù_´İ_by_Çme
(
obj
, "‹xt")è!ğ
NULL
)

130 
Çme
 = &((
TextPrİ”ty
 *)
´İ
)->
‹xt_d©a
;

132  
NULL
;

134 
is_m©ch
 = 
	`_m©ch_‹xt_´İ
 (
obj
, 
sd
, 
»¶aûm’t
, 
Çme
);

136 ià(!
is_m©ch
) {

137 
´İ
->
İs
->
	`ä“
 (prop);

138  
NULL
;

141 
¶i¡
 = 
	`´İ_li¡_äom_sšgË
 (
´İ
);

143  
¶i¡
;

144 
	}
}

147 
gboŞ—n


148 
	$_m©ch_´İ
 (
DŸObjeù
 *
obj
, cÚ¡ 
S—rchD©a
 *
sd
, cÚ¡ 
gch¬
 *
»¶aûm’t
, 
Prİ”ty
 *
´İ
)

150 
Prİ”tyTy³
 
´İ_ty³
;

151 
gboŞ—n
 
is_m©ch
 = 
FALSE
;

152 
gch¬
 **
‹xt_d©a
;

154 ià(!
´İ
)

155  
FALSE
;

159 
´İ_ty³
 = 
´İ
->
ty³
;

160 ià(!
´İ_ty³
)

161  
FALSE
;

167 iàĞ
	`¡rcmp
 (
´İ_ty³
, 
PROP_TYPE_SARRAY
) == 0

168 || 
	`¡rcmp
 (
´İ_ty³
, 
PROP_TYPE_DARRAY
) == 0) {

169 
GPŒA¼ay
 *
»cÜds
 = ((
A¼ayPrİ”ty
 *è
´İ
)->records;

170 
gušt
 
ºum
;

172 ià(!
»cÜds
)

173  
FALSE
;

175 
ºum
 = 0;„num < 
»cÜds
->
Ën
 && !
is_m©ch
; ++rnum) {

176 
GPŒA¼ay
 *
sub_´İs
 = 
	`g_±r_¬¿y_šdex
 (
»cÜds
, 
ºum
);

177 
gušt
 
sub_num
;

179 
sub_num
 = 0; sub_num < 
sub_´İs
->
Ën
 && !
is_m©ch
; ++sub_num) {

180 
Prİ”ty
 *
sub_´İ
 = 
	`g_±r_¬¿y_šdex
 (
sub_´İs
, 
sub_num
);

182 
is_m©ch
 = 
	`_m©ch_´İ
 (
obj
, 
sd
, 
»¶aûm’t
, 
sub_´İ
);

186  
is_m©ch
;

191 iàĞ
	`¡rcmp
 (
´İ_ty³
, 
PROP_TYPE_MULTISTRING
) == 0

192 || 
	`¡rcmp
 (
´İ_ty³
, 
PROP_TYPE_STRING
) == 0)

194 
‹xt_d©a
 = &((
SŒšgPrİ”ty
 *è
´İ
)->
¡ršg_d©a
;

195 } ià(
	`¡rcmp
 (
´İ_ty³
, 
PROP_TYPE_TEXT
) == 0) {

196 
‹xt_d©a
 = &((
TextPrİ”ty
 *è
´İ
)->text_data;

205  
FALSE
;

208  
	`_m©ch_‹xt_´İ
 (
obj
, 
sd
, 
»¶aûm’t
, 
‹xt_d©a
);

209 
	}
}

212 
GPŒA¼ay
 *

213 
	$_m©ch_®l_´İs
 (
DŸObjeù
 *
obj
, cÚ¡ 
S—rchD©a
 *
sd
, cÚ¡ 
gch¬
 *
»¶aûm’t
)

215 
GPŒA¼ay
 *
®l_¶i¡
 = 
NULL
;

216 
GPŒA¼ay
 *
m©ched_¶i¡
 = 
NULL
;

217 cÚ¡ 
PrİDesütiÚ
 *
desc
;

218 
gušt
 
²um
;

220 ià(!
obj
)

221  
NULL
;

223 
desc
 = 
	`objeù_g‘_´İ_desütiÚs
 (
obj
);

224 ià(!
desc
)

225  
NULL
;

227 
®l_¶i¡
 = 
	`´İ_li¡_äom_descs
 (
desc
, 
pdp_Œue
);

228 ià(!
®l_¶i¡
)

229  
NULL
;

234 
²um
 = 0;…num < 
®l_¶i¡
->
Ën
; ++pnum) {

235 
Prİ”ty
 *
´İ
 = 
	`g_±r_¬¿y_šdex
 (
®l_¶i¡
, 
²um
);

236 
gboŞ—n
 
is_m©ch
 = 
FALSE
;

237 cÚ¡ 
gch¬
 *
´İ_Çme
;

239 ià(!
´İ
 || !´İ->
Çme
)

243 
´İ_Çme
 = 
´İ
->
Çme
;

244 
´İ
->
İs
->
	`ä“
 (prop);

245 
´İ
 = 
	`objeù_´İ_by_Çme
 (
obj
, 
´İ_Çme
);

247 
is_m©ch
 = 
	`_m©ch_´İ
 (
obj
, 
sd
, 
»¶aûm’t
, 
´İ
);

249 ià(!
is_m©ch
) {

250 
´İ
->
İs
->
	`ä“
 (prop);

255 ià(!
m©ched_¶i¡
) {

257 
m©ched_¶i¡
 = 
	`´İ_li¡_äom_sšgË
 (
´İ
);

261 
GPŒA¼ay
 *
­³nd_¶i¡
;

262 
­³nd_¶i¡
 = 
	`´İ_li¡_äom_sšgË
 (
´İ
);

263 
	`´İ_li¡_add_li¡
 (
m©ched_¶i¡
, 
­³nd_¶i¡
);

264 
	`´İ_li¡_ä“
 (
­³nd_¶i¡
);

269  
m©ched_¶i¡
;

270 
	}
}

275 
GPŒA¼ay
 *

276 
	$_m©ch_´İs
 (
DŸObjeù
 *
obj
, cÚ¡ 
S—rchD©a
 *
sd
, cÚ¡ 
gch¬
 *
»¶aûm’t
)

278 
	`g_»tuº_v®_if_ç
 (
obj
 && 
sd
, 
NULL
);

280 ià(
sd
->
æags
 & 
MATCH_ALL_PROPERTIES
)

281  
	`_m©ch_®l_´İs
 (
obj
, 
sd
, 
»¶aûm’t
);

283  
	`_m©ch_Çme_´İ
 (
obj
, 
sd
, 
»¶aûm’t
);

284 
	}
}

288 
gboŞ—n


289 
	$_m©ches
 (
DŸObjeù
 *
obj
, cÚ¡ 
S—rchD©a
 *
sd
)

291 
GPŒA¼ay
 *
¶i¡
 = 
NULL
;

293 ià(!
obj
)

294  
FALSE
;

296 
¶i¡
 = 
	`_m©ch_´İs
 (
obj
, 
sd
, 
NULL
);

297 ià(!
¶i¡
)

298  
FALSE
;

300 
	`´İ_li¡_ä“
 (
¶i¡
);

302  
TRUE
;

303 
	}
}

306 
	$fšd_func
 (
gpoš‹r
 
d©a
, gpoš‹¸
u£r_d©a
)

308 
DŸObjeù
 *
obj
 = 
d©a
;

309 
S—rchD©a
 *
sd
 = (S—rchD©¨*)
u£r_d©a
;

311 ià(!
sd
->
found
) {

312 ià(
	`_m©ches
 (
obj
, 
sd
)) {

313 ià(!
sd
->
fœ¡
)

314 
sd
->
fœ¡
 = 
obj
;

315 ià(
obj
 =ğ
sd
->
Ï¡
)

316 
sd
->
£’_Ï¡
 = 
TRUE
;

317 ià(
sd
->
£’_Ï¡
) {

318 
sd
->
found
 = 
obj
;

322 
	}
}

325 
gboŞ—n


326 
	$_»¶aû
 (
DŸObjeù
 *
obj
, cÚ¡ 
S—rchD©a
 *
sd
, cÚ¡ *
»¶aûm’t
)

328 
ObjeùChªge
 *
obj_chªge
;

329 
GPŒA¼ay
 *
¶i¡
 = 
NULL
;

331 
¶i¡
 = 
	`_m©ch_´İs
 (
obj
, 
sd
, 
»¶aûm’t
);

332 ià(!
¶i¡
)

333  
FALSE
;

336 
obj_chªge
 = 
	`objeù_­¶y_´İs
 (
obj
, 
¶i¡
);

337 
	`´İ_li¡_ä“
 (
¶i¡
);

339 ià(
obj_chªge
)

340 
	`undo_objeù_chªge
(
sd
->
dŸg¿m
, 
obj
, 
obj_chªge
);

342 
	`objeù_add_upd©es
(
obj
, 
sd
->
dŸg¿m
);

343 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
sd
->
dŸg¿m
, 
obj
, 
TRUE
);

344 
	`dŸg¿m_modif›d
(
sd
->
dŸg¿m
);

345 
	`dŸg¿m_objeù_modif›d
(
sd
->
dŸg¿m
, 
obj
);

346 
	`dŸg¿m_upd©e_ex‹Ás
(
sd
->
dŸg¿m
);

347 
	`dŸg¿m_æush
(
sd
->
dŸg¿m
);

349  
TRUE
;

350 
	}
}

352 
gšt


353 
	$âr_»¥Úd
 (
GtkWidg‘
 *
widg‘
, 
gšt
 
»¥Ú£_id
, 
gpoš‹r
 
d©a
)

355 cÚ¡ 
gch¬
 *
£¬ch
 = 
	`gtk_’Œy_g‘_‹xt
 (
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
widg‘
), "search-entry"));

356 cÚ¡ 
gch¬
 *
»¶aû
;

357 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy*)
d©a
;

358 
S—rchD©a
 
sd
 = { 0, };

359 
sd
.
dŸg¿m
 = 
ddi¥
->diagram;

360 
sd
.
æags
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
Ğ
	`GTK_TOGGLE_BUTTON
 (

361 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
widg‘
), "m©ch-ÿ£"))è? 
MATCH_CASE
 : 0;

362 
sd
.
æags
 |ğ
	`gtk_toggË_bu‰Ú_g‘_aùive
Ğ
	`GTK_TOGGLE_BUTTON
 (

363 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
widg‘
), "m©ch-wÜd"))è? 
MATCH_WORD
 : 0;

364 
sd
.
æags
 |ğ
	`gtk_toggË_bu‰Ú_g‘_aùive
Ğ
	`GTK_TOGGLE_BUTTON
 (

365 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
widg‘
), "m©ch-®l-´İ”t›s"))è? 
MATCH_ALL_PROPERTIES
 : 0;

368 
»¥Ú£_id
) {

369 
RESPONSE_FIND
 :

370 
sd
.
key
 = 
£¬ch
;

371 
sd
.
Ï¡
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
widg‘
), "last-found");

372 ià(!
	`_m©ches
 (
sd
.
Ï¡
, &sd))

373 
sd
.
Ï¡
 = 
NULL
;

374 
	`dŸg¿m_»move_®l_£Ëùed
 (
ddi¥
->
dŸg¿m
, 
TRUE
);

375 
	`d©a_fÜ—ch_objeù
 (
ddi¥
->
dŸg¿m
->
d©a
, 
fšd_func
, &
sd
);

377 
sd
.
Ï¡
 = sd.
found
 ? sd.found : sd.
fœ¡
;

378 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
widg‘
), "Ï¡-found", 
sd
.
Ï¡
);

379 ià(
sd
.
Ï¡
) {

380 ià(
	`dŸ_objeù_g‘_·»Á_Ïy”
(
sd
.
Ï¡
è!ğ
ddi¥
->
dŸg¿m
->
d©a
->
aùive_Ïy”
) {

382 
	`d©a_£t_aùive_Ïy”
(
ddi¥
->
dŸg¿m
->
d©a
, 
	`dŸ_objeù_g‘_·»Á_Ïy”
(
sd
.
Ï¡
));

383 
	`dŸg¿m_add_upd©e_®l
(
ddi¥
->
dŸg¿m
);

384 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

386 
	`dŸg¿m_£Ëù
 (
ddi¥
->
dŸg¿m
, 
sd
.
Ï¡
);

387 
	`ddi¥Ïy_´e£Á_objeù
 (
ddi¥
, 
sd
.
Ï¡
);

390 
RESPONSE_REPLACE
 :

391 
»¶aû
 = 
	`gtk_’Œy_g‘_‹xt
 (
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
widg‘
), "replace-entry"));

392 
sd
.
key
 = 
£¬ch
;

393 
sd
.
Ï¡
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
widg‘
), "last-found");

394 ià(!
	`_m©ches
 (
sd
.
Ï¡
, &sd)) {

395 
sd
.
Ï¡
 = 
NULL
;

396 
	`d©a_fÜ—ch_objeù
 (
ddi¥
->
dŸg¿m
->
d©a
, 
fšd_func
, &
sd
);

398 
sd
.
Ï¡
 = sd.
found
 ? sd.found : sd.
fœ¡
;

399 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
widg‘
), "Ï¡-found", 
sd
.
Ï¡
);

400 ià(
sd
.
Ï¡
) {

401 
	`_»¶aû
 (
sd
.
Ï¡
, &sd, 
»¶aû
);

402 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

404 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
widg‘
), "Ï¡-found", 
sd
.
Ï¡
);

406 
RESPONSE_REPLACE_ALL
 :

407 
»¶aû
 = 
	`gtk_’Œy_g‘_‹xt
 (
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
widg‘
), "replace-entry"));

408 
sd
.
key
 = 
£¬ch
;

409 
sd
.
Ï¡
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
widg‘
), "last-found");

411 ià(!
	`_m©ches
 (
sd
.
Ï¡
, &sd)) {

412 
sd
.
Ï¡
 = 
NULL
;

413 
sd
.
fœ¡
 = 
NULL
;

414 
	`d©a_fÜ—ch_objeù
 (
ddi¥
->
dŸg¿m
->
d©a
, 
fšd_func
, &
sd
);

416 
sd
.
Ï¡
 = sd.
found
 ? sd.found : sd.
fœ¡
;

417 ià(
sd
.
Ï¡
)

418 ià(!
	`_»¶aû
 (
sd
.
Ï¡
, &sd, 
»¶aû
))

419 
sd
.
Ï¡
 = 
NULL
;

420 } 
sd
.
Ï¡
);

421 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
widg‘
), "Ï¡-found", 
sd
.
Ï¡
);

422 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

425 
	`gtk_widg‘_hide
 (
widg‘
);

428 
	}
}

431 
	$âr_dŸlog_£tup_commÚ
 (
GtkWidg‘
 *
dŸlog
, 
gboŞ—n
 
is_»¶aû
, 
DDi¥Ïy
 *
ddi¥
)

433 
GtkWidg‘
 *
vbox
;

434 
GtkWidg‘
 *
hbox
;

435 
GtkWidg‘
 *
Ïb–
;

436 
GtkWidg‘
 *
£¬ch_’Œy
;

437 
GtkWidg‘
 *
m©ch_ÿ£
;

438 
GtkWidg‘
 *
m©ch_wÜd
;

439 
GtkWidg‘
 *
m©ch_®l_´İ”t›s
;

441 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
 (
dŸlog
), 
RESPONSE_FIND
);

444 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
dŸlog
), "response",

445 
	`G_CALLBACK
(
âr_»¥Úd
), 
ddi¥
);

446 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
dŸlog
), "delete_event",

447 
	`G_CALLBACK
(
gtk_widg‘_hide
), 
NULL
);

448 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
dŸlog
), "delete_event",

449 
	`G_CALLBACK
(
gtk_Œue
), 
NULL
);

451 
vbox
 = 
	`GTK_DIALOG
(
dŸlog
)->vbox;

453 
hbox
 = 
	`gtk_hbox_Ãw
 (
FALSE
, 12);

454 
Ïb–
 = 
	`gtk_Ïb–_Ãw_w™h_mÃmÚic
 (
	`_
("_Search for:"));

455 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
Ïb–
, 
FALSE
, FALSE, 0);

456 
£¬ch_’Œy
 = 
	`gtk_’Œy_Ãw
 ();

457 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
dŸlog
), "£¬ch-’Œy", 
£¬ch_’Œy
);

458 
	`gtk_Ïb–_£t_mÃmÚic_widg‘
 (
	`GTK_LABEL
 (
Ïb–
), 
£¬ch_’Œy
);

459 
	`gtk_’Œy_£t_width_ch¬s
 (
	`GTK_ENTRY
 (
£¬ch_’Œy
), 30);

460 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
£¬ch_’Œy
, 
TRUE
, TRUE, 0);

461 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, FALSE, 6);

463 ià(
is_»¶aû
) {

464 
GtkWidg‘
 *
»¶aû_’Œy
;

466 
hbox
 = 
	`gtk_hbox_Ãw
 (
FALSE
, 12);

467 
Ïb–
 = 
	`gtk_Ïb–_Ãw_w™h_mÃmÚic
 (
	`_
("Replace _with:"));

468 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
Ïb–
, 
FALSE
, FALSE, 0);

469 
»¶aû_’Œy
 = 
	`gtk_’Œy_Ãw
 ();

470 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
dŸlog
), "»¶aû-’Œy", 
»¶aû_’Œy
);

471 
	`gtk_Ïb–_£t_mÃmÚic_widg‘
 (
	`GTK_LABEL
 (
Ïb–
), 
»¶aû_’Œy
);

472 
	`gtk_’Œy_£t_width_ch¬s
 (
	`GTK_ENTRY
 (
»¶aû_’Œy
), 30);

473 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
»¶aû_’Œy
, 
TRUE
, TRUE, 0);

474 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, FALSE, 6);

477 
m©ch_ÿ£
 = 
	`gtk_check_bu‰Ú_Ãw_w™h_mÃmÚic
 (
	`_
("_Match case"));

478 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
m©ch_ÿ£
, 
FALSE
, FALSE, 6);

479 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
dŸlog
), "m©ch-ÿ£", 
m©ch_ÿ£
);

481 
m©ch_wÜd
 = 
	`gtk_check_bu‰Ú_Ãw_w™h_mÃmÚic
 (
	`_
("Match _entire word only"));

482 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
m©ch_wÜd
, 
FALSE
, FALSE, 6);

483 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
dŸlog
), "m©ch-wÜd", 
m©ch_wÜd
);

485 
m©ch_®l_´İ”t›s
 = 
	`gtk_check_bu‰Ú_Ãw_w™h_mÃmÚic
 (
	`_
("Match _all…roperties (not just object‚ame)"));

486 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
m©ch_®l_´İ”t›s
, 
FALSE
, FALSE, 6);

487 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
dŸlog
), "m©ch-®l-´İ”t›s", 
m©ch_®l_´İ”t›s
);

488 ià(
is_»¶aû
)

489 
	`gtk_widg‘_£t_£ns™ive
 (
	`GTK_WIDGET
 (
m©ch_®l_´İ”t›s
), 
FALSE
);

492 
	`gtk_widg‘_show_®l
 (
vbox
);

493 
	}
}

499 
	$ed™_fšd_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

501 
DDi¥Ïy
 *
ddi¥
;

502 
DŸg¿m
 *
dŸ
;

503 
GtkWidg‘
 *
dŸlog
;

505 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

506 ià(!
ddi¥
) ;

507 
dŸ
 = 
ddi¥
->
dŸg¿m
;

510 
dŸlog
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
ddi¥
->
sh–l
), "edit-find-dialog");

511 ià(!
dŸlog
) {

512 
dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
 (

513 
	`_
("Find"),

514 
	`GTK_WINDOW
 (
ddi¥
->
sh–l
), 
GTK_DIALOG_DESTROY_WITH_PARENT
,

515 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

516 
GTK_STOCK_FIND
, 
RESPONSE_FIND
,

517 
NULL
);

519 
	`âr_dŸlog_£tup_commÚ
 (
dŸlog
, 
FALSE
, 
ddi¥
);

521 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
ddi¥
->
sh–l
), "ed™-fšd-dŸlog", 
dŸlog
);

523 
	`gtk_dŸlog_run
 (
	`GTK_DIALOG
 (
dŸlog
));

524 
	}
}

530 
	$ed™_»¶aû_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

532 
DDi¥Ïy
 *
ddi¥
;

533 
DŸg¿m
 *
dŸ
;

534 
GtkWidg‘
 *
dŸlog
;

536 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

537 ià(!
ddi¥
) ;

538 
dŸ
 = 
ddi¥
->
dŸg¿m
;

541 
dŸlog
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
ddi¥
->
sh–l
), "edit-replace-dialog");

542 ià(!
dŸlog
) {

543 
GtkWidg‘
 *
bu‰Ú
;

544 
dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
 (

545 
	`_
("Replace"),

546 
	`GTK_WINDOW
 (
ddi¥
->
sh–l
), 
GTK_DIALOG_DESTROY_WITH_PARENT
,

547 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

548 
	`_
("R•Ïû _AÎ"), 
RESPONSE_REPLACE_ALL
,

549 
NULL
);

553 
bu‰Ú
 = 
	`gtk_dŸlog_add_bu‰Ú
 (
	`GTK_DIALOG
 (
dŸlog
), 
	`_
("_R•Ïû"), 
RESPONSE_REPLACE
);

554 
	`gtk_bu‰Ú_£t_image
 (
	`GTK_BUTTON
 (
bu‰Ú
),

555 
	`gtk_image_Ãw_äom_¡ock
 (
GTK_STOCK_FIND_AND_REPLACE
, 
GTK_ICON_SIZE_BUTTON
));

557 
	`gtk_dŸlog_add_bu‰Ú
 (
	`GTK_DIALOG
 (
dŸlog
), 
GTK_STOCK_FIND
, 
RESPONSE_FIND
);

559 
	`âr_dŸlog_£tup_commÚ
 (
dŸlog
, 
TRUE
, 
ddi¥
);

561 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
ddi¥
->
sh–l
), "ed™-»¶aû-dŸlog", 
dŸlog
);

563 
	`gtk_dŸlog_run
 (
	`GTK_DIALOG
 (
dŸlog
));

564 
	}
}

	@O:\tool\dvs50\app\find-and-replace.h

23 #iâdeà
FIND_AND_REPLACE_H


24 
	#FIND_AND_REPLACE_H


	)

26 
ed™_fšd_ÿÎback
 (
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

27 
ed™_»¶aû_ÿÎback
 (
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

	@O:\tool\dvs50\app\grid.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<¡dio.h
>

24 
	~<¡dlib.h
>

25 
	~<m©h.h
>

26 
	~<glib.h
>

28 
	~"š.h
"

29 
	~"grid.h
"

30 
	~"´eã»nûs.h
"

36 
	$ÿlcuÏ‹_dyÇmic_grid
(
DDi¥Ïy
 *
ddi¥
, 
»®
 *
width_x
,„—È*
width_y
)

38 
»®
 
zoom
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 1.0);

39 
»®
 
»t
, 
tmp
;

41 
zoom
 *= 5;

42 
»t
 = 
	`pow
(10, 
	`û
(
	`log10
(
zoom
)));

44 
tmp
 = 
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
, 
»t
);

45 ià(
tmp
 < 10.0)

46 
»t
 *= 2.0;

47 ià(
tmp
 > 35.0)

48 
»t
 /= 2.0;

49 *
width_x
 = 
»t
;

50 *
width_y
 = 
»t
;

51 
	}
}

54 
	$grid_d¿w_hÜizÚl_lšes
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
upd©e
, 
»®
 
Ëngth
)

56 
x
, 
y
;

57 
»®
 
pos
;

58 
height
, 
width
;

59 
gušt
 
majÜ_lšes
 = 
ddi¥
->
dŸg¿m
->
grid
.major_lines;

60 
DŸR’d””
 *
»nd””
 = 
ddi¥
->renderer;

61 
DŸIÁ”aùiveR’d””IÁ”çû
 *
œ’d””
;

62 
majÜ_couÁ
 = 0;

64 
œ’d””
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
»nd””
);

66 
pos
 = 
	`û
Ğ
upd©e
->
tİ
 / 
Ëngth
 ) *†ength;

67 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
upd©e
->
Ëá
, 
pos
, &
x
, &
y
);

68 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
upd©e
->
right
, upd©e->
bÙtom
, &
width
, &
height
);

80 ià(
majÜ_lšes
) {

81 
majÜ_couÁ
 = 
	`ROUND
 (
pos
/
Ëngth
);

82 if(
majÜ_couÁ
 < 0èmajÜ_couÁ -ğ
majÜ_lšes
 * major_count;

83 
majÜ_couÁ
 %ğ
majÜ_lšes
;

86 
y
 < 
height
) {

87 ià(
majÜ_lšes
) {

88 ià(
majÜ_couÁ
 == 0)

89 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

91 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_DOTTED
);

92 
majÜ_couÁ
 = (majÜ_couÁ+1)%
majÜ_lšes
;

94 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
, 
x
, 
y
, 
width
, y,

95 &
ddi¥
->
dŸg¿m
->
grid
.
cŞour
);

96 
pos
 +ğ
Ëngth
;

97 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
upd©e
->
Ëá
, 
pos
, &
x
, &
y
);

99 
	}
}

102 
	$grid_d¿w_v”tiÿl_lšes
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
upd©e
, 
»®
 
Ëngth
)

104 
x
 = 0, 
y
 = 0;

105 
»®
 
pos
;

106 
height
, 
width
;

107 
gušt
 
majÜ_lšes
 = 
ddi¥
->
dŸg¿m
->
grid
.major_lines;

108 
DŸR’d””
 *
»nd””
 = 
ddi¥
->renderer;

109 
DŸIÁ”aùiveR’d””IÁ”çû
 *
œ’d””
;

110 
majÜ_couÁ
 = 0;

112 
œ’d””
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
»nd””
);

114 
pos
 = 
	`û
Ğ
upd©e
->
Ëá
 / 
Ëngth
 ) *†ength;

115 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
upd©e
->
right
, upd©e->
bÙtom
, &
width
, &
height
);

117 ià(
majÜ_lšes
) {

118 
majÜ_couÁ
 = 
	`ROUND
 (
pos
/
Ëngth
);

119 if(
majÜ_couÁ
 < 0èmajÜ_couÁ -ğ
majÜ_lšes
 * major_count;

120 
majÜ_couÁ
 %ğ
majÜ_lšes
;

123 
x
 < 
width
) {

124 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
pos
, 
upd©e
->
tİ
, &
x
, &
y
);

125 ià(
majÜ_lšes
) {

126 ià(
majÜ_couÁ
 == 0)

127 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

129 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_DOTTED
);

130 
majÜ_couÁ
 = (majÜ_couÁ+1)%
majÜ_lšes
;

132 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
, 
x
, 
y
, x, 
height
,

133 &
ddi¥
->
dŸg¿m
->
grid
.
cŞour
);

134 
pos
 +ğ
Ëngth
;

136 
	}
}

139 
	$grid_d¿w_hex
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
upd©e
, 
»®
 
Ëngth
)

141 
»®
 
hÜiz_pos
, 
v”t_pos
;

142 
to_x
, 
to_y
, 
x
, 
y
;

143 
DŸR’d””
 *
»nd””
 = 
ddi¥
->renderer;

144 
DŸIÁ”aùiveR’d””IÁ”çû
 *
œ’d””
;

146 
œ’d””
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
»nd””
);

149 
v”t_pos
 = 
	`û
Ğ
upd©e
->
tİ
 / (
Ëngth
 * 
	`sq¹
(3)) ) *†ength * sqrt(3);

150 
v”t_pos
 <ğ
upd©e
->
bÙtom
) {

151 
hÜiz_pos
 = 
	`û
Ğ(
upd©e
->
Ëá
è/ (3 * 
Ëngth
) ) *†ength * 3 -†ength * 2.5;

152 
hÜiz_pos
 <ğ
upd©e
->
right
) {

153 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
, 
v”t_pos
, &
x
, &
y
);

154 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
 + 
Ëngth
, 
v”t_pos
, &
to_x
, &
y
);

156 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
,

157 
x
, 
y
, 
to_x
, y,

158 &
ddi¥
->
dŸg¿m
->
grid
.
cŞour
);

159 
hÜiz_pos
 +ğ3 * 
Ëngth
;

162 
v”t_pos
 +ğ
	`sq¹
(3è* 
Ëngth
;

166 
v”t_pos
 = 
	`û
Ğ
upd©e
->
tİ
 / (
Ëngth
 * 
	`sq¹
(3)) ) *†ength * sqrt(3) - 0.5 * sqrt(3) *†ength;

167 
v”t_pos
 <ğ
upd©e
->
bÙtom
) {

168 
hÜiz_pos
 = 
	`û
Ğ(
upd©e
->
Ëá
è/ (3 * 
Ëngth
) ) *†ength * 3 -†ength;

169 
hÜiz_pos
 <ğ
upd©e
->
right
) {

170 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
, 
v”t_pos
, &
x
, &
y
);

171 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
+
Ëngth
, 
v”t_pos
, &
to_x
, &
y
);

173 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
,

174 
x
, 
y
, 
to_x
, y,

175 &
ddi¥
->
dŸg¿m
->
grid
.
cŞour
);

176 
hÜiz_pos
 +ğ3 * 
Ëngth
;

179 
v”t_pos
 +ğ
	`sq¹
(3è* 
Ëngth
;

183 
v”t_pos
 = 
	`û
Ğ
upd©e
->
tİ
 / (
Ëngth
 * 
	`sq¹
(3)) ) *†ength * sqrt(3) -†ength * sqrt(3);

184 
v”t_pos
 <ğ
upd©e
->
bÙtom
) {

185 
hÜiz_pos
 = 
	`û
Ğ(
upd©e
->
Ëá
è/ (3 * 
Ëngth
) ) *†ength * 3 -†ength * 2.5;

186 
hÜiz_pos
 <ğ
upd©e
->
right
) {

187 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
 + 
Ëngth
, 
v”t_pos
, &
x
, &
y
);

188 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
 + 1.5 * 
Ëngth
, 
v”t_pos
 +†’gth * 
	`sq¹
(3è* 0.5, &
to_x
, &
to_y
);

190 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
,

191 
x
, 
y
, 
to_x
, 
to_y
,

192 &
ddi¥
->
dŸg¿m
->
grid
.
cŞour
);

194 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
, 
v”t_pos
, &
x
, &
y
);

195 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
 - 0.5 * 
Ëngth
, 
v”t_pos
 +†’gth * 
	`sq¹
(3è* 0.5, &
to_x
, &
to_y
);

197 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
,

198 
x
, 
y
, 
to_x
, 
to_y
,

199 &
ddi¥
->
dŸg¿m
->
grid
.
cŞour
);

200 
hÜiz_pos
 +ğ3 * 
Ëngth
;

203 
v”t_pos
 +ğ
	`sq¹
(3è* 
Ëngth
;

207 
v”t_pos
 = 
	`û
Ğ
upd©e
->
tİ
 / (
Ëngth
 * 
	`sq¹
(3)) ) *†ength * sqrt(3) - 0.5 * sqrt(3) *†ength;

208 
v”t_pos
 <ğ
upd©e
->
bÙtom
) {

209 
hÜiz_pos
 = 
	`û
Ğ(
upd©e
->
Ëá
è/ (3 * 
Ëngth
) ) *†ength * 3 -†ength;

210 
hÜiz_pos
 <ğ
upd©e
->
right
) {

211 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
, 
v”t_pos
, &
x
, &
y
);

212 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
 - 0.5 * 
Ëngth
, 
v”t_pos
 + 0.5 * 
	`sq¹
(3è*†’gth, &
to_x
, &
to_y
);

214 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
,

215 
x
, 
y
, 
to_x
, 
to_y
,

216 &
ddi¥
->
dŸg¿m
->
grid
.
cŞour
);

218 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
 + 
Ëngth
, 
v”t_pos
, &
x
, &
y
);

219 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hÜiz_pos
 + 1.5 * 
Ëngth
, 
v”t_pos
 + 0.5 * 
	`sq¹
(3è*†’gth, &
to_x
, &
to_y
);

221 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
,

222 
x
, 
y
, 
to_x
, 
to_y
,

223 &
ddi¥
->
dŸg¿m
->
grid
.
cŞour
);

224 
hÜiz_pos
 +ğ3 * 
Ëngth
;

227 
v”t_pos
 +ğ
	`sq¹
(3è* 
Ëngth
;

230 
	}
}

233 
	$grid_d¿w
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
upd©e
)

235 
Grid
 *
grid
 = &
ddi¥
->grid;

236 
DŸR’d””
 *
»nd””
 = 
ddi¥
->renderer;

238 ià(
grid
->
visibË
) {

240 
»®
 
width_x
 = 
ddi¥
->
dŸg¿m
->
grid
.width_x;

241 
»®
 
width_y
 = 
ddi¥
->
dŸg¿m
->
grid
.width_y;

242 
»®
 
width_w
 = 
ddi¥
->
dŸg¿m
->
grid
.width_w;

243 ià(
ddi¥
->
dŸg¿m
->
grid
.
dyÇmic
) {

244 
	`ÿlcuÏ‹_dyÇmic_grid
(
ddi¥
, &
width_x
, &
width_y
);

246 
width_x
 = 
ddi¥
->
dŸg¿m
->
grid
.width_x *

247 
ddi¥
->
dŸg¿m
->
grid
.
visibË_x
;

248 
width_y
 = 
ddi¥
->
dŸg¿m
->
grid
.width_y *

249 
ddi¥
->
dŸg¿m
->
grid
.
visibË_y
;

252 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
(renderer, 0.0);

253 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_dashËngth
(renderer,

254 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 31));

256 ià(
ddi¥
->
dŸg¿m
->
grid
.
hex
) {

257 
	`grid_d¿w_hex
(
ddi¥
, 
upd©e
, 
width_w
);

259 ià(
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
, 
width_y
) >= 2.0 &&

260 
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
, 
width_x
) >= 2.0) {

262 
	`grid_d¿w_v”tiÿl_lšes
(
ddi¥
, 
upd©e
, 
width_x
);

264 
	`grid_d¿w_hÜizÚl_lšes
(
ddi¥
, 
upd©e
, 
width_y
);

268 
	}
}

271 
	$·geb»ak_d¿w
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
upd©e
)

273 
DŸR’d””
 *
»nd””
 = 
ddi¥
->renderer;

274 
DŸIÁ”aùiveR’d””IÁ”çû
 *
œ’d””
;

276 
width
 = 
	`dŸ_»nd””_g‘_width_pix–s
(
ddi¥
->
»nd””
);

277 
height
 = 
	`dŸ_»nd””_g‘_height_pix–s
(
ddi¥
->
»nd””
);

279 
œ’d””
 = 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
»nd””
);

280 ià(
´efs
.
·geb»ak
.
visibË
) {

281 
DŸg¿m
 *
dŸ
 = 
ddi¥
->
dŸg¿m
;

282 
»®
 
Üigx
 = 0, 
Üigy
 = 0, 
pos
;

283 
»®
 
pwidth
 = 
dŸ
->
d©a
->
·³r
.
width
;

284 
»®
 
pheight
 = 
dŸ
->
d©a
->
·³r
.
height
;

285 
x
,
y
;

287 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
(renderer, 0.0);

288 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_dashËngth
(renderer,

289 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 31));

290 ià(
´efs
.
·geb»ak
.
sŞid
)

291 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

293 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_DOTTED
);

295 ià(
dŸ
->
d©a
->
·³r
.
f™to
) {

296 
Üigx
 = 
dŸ
->
d©a
->
ex‹Ás
.
Ëá
;

297 
Üigy
 = 
dŸ
->
d©a
->
ex‹Ás
.
tİ
;

301 
pos
 = 
Üigx
 + 
	`û
((
upd©e
->
Ëá
 - origxè/ 
pwidth
) *…width;

302 
pos
 <ğ
upd©e
->
right
) {

303 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
pos
,0,&
x
,&
y
);

304 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
,

305 
x
, 0, x, 
height
,

306 &
dŸ
->
·geb»ak_cŞÜ
);

307 
pos
 +ğ
pwidth
;

310 
pos
 = 
Üigy
 + 
	`û
((
upd©e
->
tİ
 - origyè/ 
pheight
) *…height;

311 
pos
 <ğ
upd©e
->
bÙtom
) {

312 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 0,
pos
,&
x
,&
y
);

313 
œ’d””
->
	`d¿w_pix–_lše
(
»nd””
,

314 0, 
y
, 
width
, y,

315 &
dŸ
->
·geb»ak_cŞÜ
);

316 
pos
 +ğ
pheight
;

319 
	}
}

322 
	$¢­_to_grid
(
DDi¥Ïy
 *
ddi¥
, 
coÜd
 *
x
, coÜd *
y
)

324 ià(
ddi¥
->
grid
.
¢­
) {

325 ià(
ddi¥
->
dŸg¿m
->
grid
.
hex
) {

326 
»®
 
width_x
 = 
ddi¥
->
dŸg¿m
->
grid
.
width_w
;

327 
»®
 
x_mod
 = (*
x
 - 1*
width_x
è- 
	`æoÜ
((*x - 1*width_x) / (3*width_x)) * 3 * width_x;

328 
»®
 
y_mod
 = (*
y
 - 0.25*
	`sq¹
(3è* 
width_x
) -

329 
	`æoÜ
((*
y
 - 0.25 * 
	`sq¹
(3è* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x;

331 iàĞ
x_mod
 < (1.5 * 
width_x
) ) {

332 iàĞ
y_mod
 < 0.5 * 
	`sq¹
(3è* 
width_x
 ) {

333 *
x
 = 
	`æoÜ
((*x + 0.5*
width_x
) / (3*width_x)) * 3 * width_x + 2 * width_x;

334 *
y
 = 
	`æoÜ
((*y - 0.25 * 
	`sq¹
(3è* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x + 0.5 * sqrt(3) * width_x;

336 *
x
 = 
	`æoÜ
((*x + 0.5*
width_x
) / (3*width_x)) * 3 * width_x + 1.5 * width_x;

337 *
y
 = 
	`æoÜ
((*y - 0.25 * 
	`sq¹
(3è* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x + sqrt(3) * width_x;

340 iàĞ
y_mod
 < 0.5 * 
	`sq¹
(3è* 
width_x
 ) {

341 *
x
 = 
	`æoÜ
((*x + 0.5*
width_x
) / (3*width_x)) * 3 * width_x ;

342 *
y
 = 
	`æoÜ
((*y - 0.25 * 
	`sq¹
(3è* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x + 0.5 * sqrt(3) * width_x;

344 *
x
 = 
	`æoÜ
((*x + 0.5*
width_x
) / (3*width_x)) * 3 * width_x + 0.5 * width_x;

345 *
y
 = 
	`æoÜ
((*y - 0.25 * 
	`sq¹
(3è* 
width_x
) / (sqrt(3)*width_x)) * sqrt(3) * width_x + sqrt(3) * width_x;

349 
»®
 
width_x
 = 
ddi¥
->
dŸg¿m
->
grid
.width_x;

350 
»®
 
width_y
 = 
ddi¥
->
dŸg¿m
->
grid
.width_y;

351 ià(
ddi¥
->
dŸg¿m
->
grid
.
dyÇmic
) {

352 
	`ÿlcuÏ‹_dyÇmic_grid
(
ddi¥
, &
width_x
, &
width_y
);

354 *
x
 = 
	`ROUND
((*xè/ 
width_x
) * width_x;

355 *
y
 = 
	`ROUND
((*yè/ 
width_y
) * width_y;

358 
	}
}

	@O:\tool\dvs50\app\grid.h

18 #iâdeà
GRID_H


19 
	#GRID_H


	)

21 
	~<gtk/gtk.h
>

23 
_Grid
 
	tGrid
;

25 
	~"geom‘ry.h
"

26 
	s_Grid
 {

27 
gušt
 
	mvisibË
;

28 
gušt
 
	m¢­
;

31 
	~"di¥Ïy.h
"

33 
grid_d¿w
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
upd©e
);

34 
·geb»ak_d¿w
(
DDi¥Ïy
 *
ddi¥
, 
ReùªgË
 *
upd©e
);

35 
¢­_to_grid
(
DDi¥Ïy
 *
ddi¥
, 
coÜd
 *
x
, coÜd *
y
);

	@O:\tool\dvs50\app\gtkhwrapbox.c

23 
	~"cÚfig.h
"

25 
	~"gtkhw¿pbox.h
"

29 
gtk_hw¿p_box_şass_š™
 (
GtkHW¿pBoxCÏss
 *
kÏss
);

30 
gtk_hw¿p_box_š™
 (
GtkHW¿pBox
 *
hwbox
);

31 
gtk_hw¿p_box_size_»que¡
 (
GtkWidg‘
 *
widg‘
,

32 
GtkRequis™iÚ
 *
»quis™iÚ
);

33 
gtk_hw¿p_box_size_®loÿ‹
 (
GtkWidg‘
 *
widg‘
,

34 
GtkAÎoÿtiÚ
 *
®loÿtiÚ
);

35 
GSLi¡
* 
»v”£_li¡_row_chd»n
 (
GtkW¿pBox
 *
wbox
,

36 
GtkW¿pBoxChd
 **
chd_p
,

37 
GtkAÎoÿtiÚ
 *
¬—
,

38 
gušt
 *
max_height
,

39 
gboŞ—n
 *
ÿn_vex·nd
);

43 
gpoš‹r
 
	g·»Á_şass
 = 
NULL
;

47 
GTy³


48 
	$gtk_hw¿p_box_g‘_ty³
 ()

50 
GTy³
 
hw¿p_box_ty³
 = 0;

52 ià(! 
hw¿p_box_ty³
)

54 cÚ¡ 
GTy³Info
 
hw¿p_box_šfo
 =

56  (
GtkHW¿pBoxCÏss
),

57 
NULL
,

58 
NULL
,

59 (
GCÏssIn™Func
è
gtk_hw¿p_box_şass_š™
,

60 
NULL
,

61 
NULL
,

62  (
GtkHW¿pBox
),

64 (
GIn¡ªûIn™Func
è
gtk_hw¿p_box_š™
,

67 
hw¿p_box_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
GTK_TYPE_WRAP_BOX
, "GtkHWrapBox",

68 &
hw¿p_box_šfo
, 0);

71  
hw¿p_box_ty³
;

72 
	}
}

75 
	$gtk_hw¿p_box_şass_š™
 (
GtkHW¿pBoxCÏss
 *
şass
)

77 
GObjeùCÏss
 *
objeù_şass
;

78 
GtkWidg‘CÏss
 *
widg‘_şass
;

79 
GtkCÚš”CÏss
 *
cÚš”_şass
;

80 
GtkW¿pBoxCÏss
 *
w¿p_box_şass
;

82 
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
şass
);

83 
widg‘_şass
 = 
	`GTK_WIDGET_CLASS
 (
şass
);

84 
cÚš”_şass
 = 
	`GTK_CONTAINER_CLASS
 (
şass
);

85 
w¿p_box_şass
 = 
	`GTK_WRAP_BOX_CLASS
 (
şass
);

87 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
şass
);

89 
widg‘_şass
->
size_»que¡
 = 
gtk_hw¿p_box_size_»que¡
;

90 
widg‘_şass
->
size_®loÿ‹
 = 
gtk_hw¿p_box_size_®loÿ‹
;

92 
w¿p_box_şass
->
¾i¡_lše_chd»n
 = 
»v”£_li¡_row_chd»n
;

93 
	}
}

96 
	$gtk_hw¿p_box_š™
 (
GtkHW¿pBox
 *
hwbox
)

98 
hwbox
->
max_chd_width
 = 0;

99 
hwbox
->
max_chd_height
 = 0;

100 
	}
}

102 
GtkWidg‘
*

103 
	$gtk_hw¿p_box_Ãw
 (
gboŞ—n
 
homog’eous
)

105  
	`g_objeù_Ãw
 (
GTK_TYPE_HWRAP_BOX
, "homog’eous", 
homog’eous
, 
NULL
);

106 
	}
}

108 
šlše
 

109 
	$g‘_chd_»quis™iÚ
 (
GtkW¿pBox
 *
wbox
,

110 
GtkWidg‘
 *
chd
,

111 
GtkRequis™iÚ
 *
chd_»quis™iÚ
)

113 ià(
wbox
->
homog’eous
)

115 
GtkHW¿pBox
 *
hwbox
 = 
	`GTK_HWRAP_BOX
 (
wbox
);

117 
chd_»quis™iÚ
->
width
 = 
hwbox
->
max_chd_width
;

118 
chd_»quis™iÚ
->
height
 = 
hwbox
->
max_chd_height
;

121 
	`gtk_widg‘_g‘_chd_»quis™iÚ
 (
chd
, 
chd_»quis™iÚ
);

122 
	}
}

124 
gæßt


125 
	$g‘_Ïyout_size
 (
GtkHW¿pBox
 *
this
,

126 
gušt
 
max_width
,

127 
gušt
 *
width_šc
)

129 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
this
);

130 
GtkW¿pBoxChd
 *
chd
;

131 
gušt
 
n_rows
, 
Ëá_ov”
 = 0, 
tÙ®_height
 = 0;

132 
gboŞ—n
 
Ï¡_row_fËd
 = 
TRUE
;

134 *
width_šc
 = 
this
->
max_chd_width
 + 1;

136 
n_rows
 = 0;

137 
chd
 = 
wbox
->
chd»n
; chd; chd = chd->
Ãxt
)

139 
GtkW¿pBoxChd
 *
row_chd
;

140 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

141 
gušt
 
row_width
, 
row_height
, 
n
 = 1;

143 ià(!
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
))

146 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

147 ià(!
Ï¡_row_fËd
)

148 *
width_šc
 = 
	`MIN
 (*width_šc, 
chd_»quis™iÚ
.
width
 - 
Ëá_ov”
);

149 
row_width
 = 
chd_»quis™iÚ
.
width
;

150 
row_height
 = 
chd_»quis™iÚ
.
height
;

151 
row_chd
 = 
chd
->
Ãxt
;„ow_chd && 
n
 < 
wbox
->
chd_lim™
;„ow_child =„ow_child->next)

153 ià(
	`GTK_WIDGET_VISIBLE
 (
row_chd
->
widg‘
))

155 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
row_chd
->
widg‘
, &
chd_»quis™iÚ
);

156 ià(
row_width
 + 
wbox
->
h¥acšg
 + 
chd_»quis™iÚ
.
width
 > 
max_width
)

158 
row_width
 +ğ
wbox
->
h¥acšg
 + 
chd_»quis™iÚ
.
width
;

159 
row_height
 = 
	`MAX
 (row_height, 
chd_»quis™iÚ
.
height
);

160 
n
++;

162 
chd
 = 
row_chd
;

164 
Ï¡_row_fËd
 = 
n
 >ğ
wbox
->
chd_lim™
;

165 
Ëá_ov”
 = 
Ï¡_row_fËd
 ? 0 : 
max_width
 - (
row_width
 + 
wbox
->
h¥acšg
);

166 
tÙ®_height
 +ğ(
n_rows
 ? 
wbox
->
v¥acšg
 : 0è+ 
row_height
;

167 
n_rows
++;

170 ià(*
width_šc
 > 
this
->
max_chd_width
)

171 *
width_šc
 = 0;

173  
	`MAX
 (
tÙ®_height
, 1);

174 
	}
}

177 
	$gtk_hw¿p_box_size_»que¡
 (
GtkWidg‘
 *
widg‘
,

178 
GtkRequis™iÚ
 *
»quis™iÚ
)

180 
GtkHW¿pBox
 *
this
 = 
	`GTK_HWRAP_BOX
 (
widg‘
);

181 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widg‘
);

182 
GtkW¿pBoxChd
 *
chd
;

183 
gæßt
 
¿tio_di¡
, 
Ïyout_width
 = 0;

184 
gušt
 
row_šc
 = 0;

186 
	`g_»tuº_if_ç
 (
»quis™iÚ
 !ğ
NULL
);

188 
»quis™iÚ
->
width
 = 0;

189 
»quis™iÚ
->
height
 = 0;

190 
this
->
max_chd_width
 = 0;

191 
this
->
max_chd_height
 = 0;

194 
chd
 = 
wbox
->
chd»n
; chd; chd = chd->
Ãxt
)

195 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
))

197 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

199 
	`gtk_widg‘_size_»que¡
 (
chd
->
widg‘
, &
chd_»quis™iÚ
);

201 
this
->
max_chd_width
 = 
	`MAX
 (this->max_chd_width, 
chd_»quis™iÚ
.
width
);

202 
this
->
max_chd_height
 = 
	`MAX
 (this->max_chd_height, 
chd_»quis™iÚ
.
height
);

206 
¿tio_di¡
 = 32768;

207 
Ïyout_width
 = 
this
->
max_chd_width
;

210 
gæßt
 
Ïyout_height
;

211 
gæßt
 
¿tio
, 
di¡
;

213 
Ïyout_width
 +ğ
row_šc
;

214 
Ïyout_height
 = 
	`g‘_Ïyout_size
 (
this
, 
Ïyout_width
, &
row_šc
);

215 
¿tio
 = 
Ïyout_width
 / 
Ïyout_height
;

216 
di¡
 = 
	`MAX
 (
¿tio
, 
wbox
->
a¥eù_¿tio
è- 
	`MIN
 (ratio, wbox->aspect_ratio);

217 ià(
di¡
 < 
¿tio_di¡
)

219 
¿tio_di¡
 = 
di¡
;

220 
»quis™iÚ
->
width
 = 
Ïyout_width
;

221 
»quis™iÚ
->
height
 = 
Ïyout_height
;

230 
row_šc
);

232 
»quis™iÚ
->
width
 +ğ
	`GTK_CONTAINER
 (
wbox
)->
bÜd”_width
 * 2;

233 
»quis™iÚ
->
height
 +ğ
	`GTK_CONTAINER
 (
wbox
)->
bÜd”_width
 * 2;

238 
	}
}

240 
GSLi¡
*

241 
	$»v”£_li¡_row_chd»n
 (
GtkW¿pBox
 *
wbox
,

242 
GtkW¿pBoxChd
 **
chd_p
,

243 
GtkAÎoÿtiÚ
 *
¬—
,

244 
gušt
 *
max_chd_size
,

245 
gboŞ—n
 *
ex·nd_lše
)

247 
GSLi¡
 *
¦i¡
 = 
NULL
;

248 
gušt
 
width
 = 0, 
row_width
 = 
¬—
->width;

249 
GtkW¿pBoxChd
 *
chd
 = *
chd_p
;

251 *
max_chd_size
 = 0;

252 *
ex·nd_lše
 = 
FALSE
;

254 
chd
 && !
	`GTK_WIDGET_VISIBLE
 (chd->
widg‘
))

256 *
chd_p
 = 
chd
->
Ãxt
;

257 
chd
 = *
chd_p
;

260 ià(
chd
)

262 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

263 
gušt
 
n
 = 1;

265 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

266 
width
 +ğ
chd_»quis™iÚ
.width;

267 *
max_chd_size
 = 
	`MAX
 (*max_chd_size, 
chd_»quis™iÚ
.
height
);

268 *
ex·nd_lše
 |ğ
chd
->
vex·nd
;

269 
¦i¡
 = 
	`g_¦i¡_´•’d
 (¦i¡, 
chd
);

270 *
chd_p
 = 
chd
->
Ãxt
;

271 
chd
 = *
chd_p
;

273 
chd
 && 
n
 < 
wbox
->
chd_lim™
)

275 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
))

277 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

278 ià(
width
 + 
wbox
->
h¥acšg
 + 
chd_»quis™iÚ
.width > 
row_width
 ||

279 
chd
->
w¿µed
)

281 
width
 +ğ
wbox
->
h¥acšg
 + 
chd_»quis™iÚ
.width;

282 *
max_chd_size
 = 
	`MAX
 (*max_chd_size, 
chd_»quis™iÚ
.
height
);

283 *
ex·nd_lše
 |ğ
chd
->
vex·nd
;

284 
¦i¡
 = 
	`g_¦i¡_´•’d
 (¦i¡, 
chd
);

285 
n
++;

287 *
chd_p
 = 
chd
->
Ãxt
;

288 
chd
 = *
chd_p
;

292  
¦i¡
;

293 
	}
}

296 
	$Ïyout_row
 (
GtkW¿pBox
 *
wbox
,

297 
GtkAÎoÿtiÚ
 *
¬—
,

298 
GSLi¡
 *
chd»n
,

299 
gušt
 
chd»n_³r_lše
,

300 
gboŞ—n
 
vex·nd
)

302 
GSLi¡
 *
¦i¡
;

303 
gušt
 
n_chd»n
 = 0, 
n_ex·nd_chd»n
 = 0, 
have_ex·nd_chd»n
 = 0;

304 
gšt
 
tÙ®_width
 = 0;

305 
gæßt
 
x
, 
width
, 
exŒa
;

306 
GtkAÎoÿtiÚ
 
chd_®loÿtiÚ
;

308 
¦i¡
 = 
chd»n
; sli¡; sli¡ = sli¡->
Ãxt
)

310 
GtkW¿pBoxChd
 *
chd
 = 
¦i¡
->
d©a
;

311 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

313 
n_chd»n
++;

314 ià(
chd
->
hex·nd
)

315 
n_ex·nd_chd»n
++;

317 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

318 
tÙ®_width
 +ğ
chd_»quis™iÚ
.
width
;

321 
width
 = 
	`MAX
 (1, 
¬—
->width - (
n_chd»n
 - 1è* 
wbox
->
h¥acšg
);

322 ià(
width
 > 
tÙ®_width
)

323 
exŒa
 = 
width
 - 
tÙ®_width
;

325 
exŒa
 = 0;

326 
have_ex·nd_chd»n
 = 
n_ex·nd_chd»n
 && 
exŒa
;

328 
x
 = 
¬—
->x;

329 ià(
wbox
->
homog’eous
)

331 
width
 = 
	`MAX
 (1, 
¬—
->width - (
chd»n_³r_lše
 - 1è* 
wbox
->
h¥acšg
);

332 
width
 /ğ((
gdoubË
è
chd»n_³r_lše
);

333 
exŒa
 = 0;

335 ià(
have_ex·nd_chd»n
 && 
wbox
->
ju¡ify
 !ğ
GTK_JUSTIFY_FILL
)

337 
width
 = 
exŒa
;

338 
exŒa
 /ğ((
gdoubË
è
n_ex·nd_chd»n
);

342 ià(
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_FILL
)

344 
width
 = 
exŒa
;

345 
have_ex·nd_chd»n
 = 
TRUE
;

346 
n_ex·nd_chd»n
 = 
n_chd»n
;

347 
exŒa
 /ğ((
gdoubË
è
n_ex·nd_chd»n
);

349 ià(
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_CENTER
)

351 
x
 +ğ
exŒa
 / 2;

352 
width
 = 0;

353 
exŒa
 = 0;

355 ià(
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_LEFT
)

357 
width
 = 0;

358 
exŒa
 = 0;

360 ià(
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_RIGHT
)

362 
x
 +ğ
exŒa
;

363 
width
 = 0;

364 
exŒa
 = 0;

368 
n_chd»n
 = 0;

369 
¦i¡
 = 
chd»n
; sli¡; sli¡ = sli¡->
Ãxt
)

371 
GtkW¿pBoxChd
 *
chd
 = 
¦i¡
->
d©a
;

373 
chd_®loÿtiÚ
.
x
 = x;

374 
chd_®loÿtiÚ
.
y
 = 
¬—
->y;

375 ià(
wbox
->
homog’eous
)

377 
chd_®loÿtiÚ
.
height
 = 
¬—
->height;

378 
chd_®loÿtiÚ
.
width
 = width;

379 
x
 +ğ
chd_®loÿtiÚ
.
width
 + 
wbox
->
h¥acšg
;

383 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

385 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

387 ià(
chd_»quis™iÚ
.
height
 >ğ
¬—
->height)

388 
chd_®loÿtiÚ
.
height
 = 
¬—
->height;

391 
chd_®loÿtiÚ
.
height
 = 
chd_»quis™iÚ
.height;

392 ià(
wbox
->
lše_ju¡ify
 =ğ
GTK_JUSTIFY_FILL
 || 
chd
->
vfl
)

393 
chd_®loÿtiÚ
.
height
 = 
¬—
->height;

394 ià(
chd
->
vex·nd
 || 
wbox
->
lše_ju¡ify
 =ğ
GTK_JUSTIFY_CENTER
)

395 
chd_®loÿtiÚ
.
y
 +ğ(
¬—
->
height
 - 
chd_»quis™iÚ
.height) / 2;

396 ià(
wbox
->
lše_ju¡ify
 =ğ
GTK_JUSTIFY_BOTTOM
)

397 
chd_®loÿtiÚ
.
y
 +ğ
¬—
->
height
 - 
chd_»quis™iÚ
.height;

400 ià(
have_ex·nd_chd»n
)

402 
chd_®loÿtiÚ
.
width
 = 
chd_»quis™iÚ
.width;

403 ià(
chd
->
hex·nd
 || 
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_FILL
)

405 
gušt
 
¥aû
;

407 
n_ex·nd_chd»n
--;

408 
¥aû
 = 
exŒa
 * 
n_ex·nd_chd»n
;

409 
¥aû
 = 
width
 - space;

410 
width
 -ğ
¥aû
;

411 ià(
chd
->
hfl
)

412 
chd_®loÿtiÚ
.
width
 +ğ
¥aû
;

415 
chd_®loÿtiÚ
.
x
 +ğ
¥aû
 / 2;

416 
x
 +ğ
¥aû
;

424 
chd_®loÿtiÚ
.
x
 +ğ
n_chd»n
 * 
exŒa
;

427 
chd_®loÿtiÚ
.
width
 = 
	`MIN
 (
chd_»quis™iÚ
.width,

428 
¬—
->
width
 - 
chd_®loÿtiÚ
.
x
 +‡rea->x);

432 
x
 +ğ
chd_®loÿtiÚ
.
width
 + 
wbox
->
h¥acšg
;

433 
	`gtk_widg‘_size_®loÿ‹
 (
chd
->
widg‘
, &
chd_®loÿtiÚ
);

434 
n_chd»n
++;

436 
	}
}

438 
_Lše
 
	tLše1
;

439 
	s_Lše


441 
GSLi¡
 *
	mchd»n
;

442 
gušt16
 
	mmš_size
;

443 
gušt
 
	mex·nd
 : 1;

444 
Lše1
 *
	mÃxt
;

448 
	$Ïyout_rows
 (
GtkW¿pBox
 *
wbox
,

449 
GtkAÎoÿtiÚ
 *
¬—
)

451 
GtkW¿pBoxChd
 *
Ãxt_chd
;

452 
gušt
 
mš_height
;

453 
gboŞ—n
 
vex·nd
;

454 
GSLi¡
 *
¦i¡
;

455 
Lše1
 *
lše_li¡
 = 
NULL
;

456 
gušt
 
tÙ®_height
 = 0, 
n_ex·nd_lšes
 = 0, 
n_lšes
 = 0;

457 
gæßt
 
shršk_height
;

458 
gušt
 
chd»n_³r_lše
;

460 
Ãxt_chd
 = 
wbox
->
chd»n
;

461 
¦i¡
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`¾i¡_lše_chd»n
 (wbox,

462 &
Ãxt_chd
,

463 
¬—
,

464 &
mš_height
,

465 &
vex·nd
);

466 
¦i¡
 = 
	`g_¦i¡_»v”£
 (slist);

468 
chd»n_³r_lše
 = 
	`g_¦i¡_Ëngth
 (
¦i¡
);

469 
¦i¡
)

471 #ià
	`GLIB_CHECK_VERSION
(2,10,0)

472 
Lše1
 *
lše
 = 
	`g_¦iû_Ãw
 (Line1);

474 
Lše
 *
lše
 = 
	`g_Ãw
 (Line, 1);

477 
lše
->
chd»n
 = 
¦i¡
;

478 
lše
->
mš_size
 = 
mš_height
;

479 
tÙ®_height
 +ğ
mš_height
;

480 
lše
->
ex·nd
 = 
vex·nd
;

481 ià(
vex·nd
)

482 
n_ex·nd_lšes
++;

483 
lše
->
Ãxt
 = 
lše_li¡
;

484 
lše_li¡
 = 
lše
;

485 
n_lšes
++;

487 
¦i¡
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`¾i¡_lše_chd»n
 (wbox,

488 &
Ãxt_chd
,

489 
¬—
,

490 &
mš_height
,

491 &
vex·nd
);

492 
¦i¡
 = 
	`g_¦i¡_»v”£
 (slist);

495 ià(
tÙ®_height
 > 
¬—
->
height
)

496 
shršk_height
 = 
tÙ®_height
 - 
¬—
->
height
;

498 
shršk_height
 = 0;

502 
Lše1
 *
´ev
 = 
NULL
, *
Ï¡
 = NULL;

503 
gæßt
 
n_shršk_lšes
 = 
n_lšes
;

505 
lše_li¡
)

507 
Lše1
 *
tmp
 = 
lše_li¡
->
Ãxt
;

509 ià(
shršk_height
)

511 
Lše1
 *
lše
 = 
lše_li¡
;

512 
gušt
 
shršk_äaù
 = 
shršk_height
 / 
n_shršk_lšes
 + 0.5;

514 ià(
lše
->
mš_size
 > 
shršk_äaù
)

516 
shršk_height
 -ğ
shršk_äaù
;

517 
lše
->
mš_size
 -ğ
shršk_äaù
;

521 
shršk_height
 -ğ
lše
->
mš_size
 - 1;

522 
lše
->
mš_size
 = 1;

525 
n_shršk_lšes
--;

527 
Ï¡
 = 
lše_li¡
;

528 
lše_li¡
->
Ãxt
 = 
´ev
;

529 
´ev
 = 
lše_li¡
;

530 
lše_li¡
 = 
tmp
;

532 
lše_li¡
 = 
Ï¡
;

535 ià(
n_lšes
)

537 
Lše1
 *
lše
;

538 
gæßt
 
y
, 
height
, 
exŒa
 = 0;

540 
height
 = 
¬—
->height;

541 
height
 = 
	`MAX
 (
n_lšes
, heighˆ- (n_lše - 1è* 
wbox
->
v¥acšg
);

543 ià(
wbox
->
homog’eous
)

544 
height
 /ğ((
gdoubË
è
n_lšes
);

545 ià(
n_ex·nd_lšes
)

547 
height
 = 
	`MAX
 (0, heighˆ- 
tÙ®_height
);

548 
exŒa
 = 
height
 / ((
gdoubË
è
n_ex·nd_lšes
);

551 
height
 = 0;

553 
y
 = 
¬—
->y;

554 
lše
 = 
lše_li¡
;

555 
lše
)

557 
GtkAÎoÿtiÚ
 
row_®loÿtiÚ
;

558 
Lše1
 *
Ãxt_lše
 = 
lše
->
Ãxt
;

560 
row_®loÿtiÚ
.
x
 = 
¬—
->x;

561 
row_®loÿtiÚ
.
width
 = 
¬—
->width;

562 ià(
wbox
->
homog’eous
)

563 
row_®loÿtiÚ
.
height
 = height;

566 
row_®loÿtiÚ
.
height
 = 
lše
->
mš_size
;

568 ià(
lše
->
ex·nd
)

569 
row_®loÿtiÚ
.
height
 +ğ
exŒa
;

572 
row_®loÿtiÚ
.
y
 = y;

574 
y
 +ğ
row_®loÿtiÚ
.
height
 + 
wbox
->
v¥acšg
;

575 
	`Ïyout_row
 (
wbox
,

576 &
row_®loÿtiÚ
,

577 
lše
->
chd»n
,

578 
chd»n_³r_lše
,

579 
lše
->
ex·nd
);

581 
	`g_¦i¡_ä“
 (
lše
->
chd»n
);

582 #ià(!
	`GLIB_CHECK_VERSION
(2,10,0))

583 
	`g_ä“
 (
lše
);

585 
lše
 = 
Ãxt_lše
;

588 #ià
	`GLIB_CHECK_VERSION
(2,10,0)

589 
	`g_¦iû_ä“_chaš
 (
Lše1
, 
lše_li¡
, 
Ãxt
);

592 
	}
}

595 
	$gtk_hw¿p_box_size_®loÿ‹
 (
GtkWidg‘
 *
widg‘
,

596 
GtkAÎoÿtiÚ
 *
®loÿtiÚ
)

598 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widg‘
);

599 
GtkAÎoÿtiÚ
 
¬—
;

600 
gšt
 
bÜd”
 = 
	`GTK_CONTAINER
 (
wbox
)->
bÜd”_width
;

602 
widg‘
->
®loÿtiÚ
 = *allocation;

603 
¬—
.
x
 = 
®loÿtiÚ
->x + 
bÜd”
;

604 
¬—
.
y
 = 
®loÿtiÚ
->y + 
bÜd”
;

605 
¬—
.
width
 = 
	`MAX
 (1, (
gšt
è
®loÿtiÚ
->width - 
bÜd”
 * 2);

606 
¬—
.
height
 = 
	`MAX
 (1, (
gšt
è
®loÿtiÚ
->heighˆ- 
bÜd”
 * 2);

615 
	`Ïyout_rows
 (
wbox
, &
¬—
);

616 
	}
}

	@O:\tool\dvs50\app\gtkhwrapbox.h

23 #iâdeà
__GTK_HWRAP_BOX_H__


24 
	#__GTK_HWRAP_BOX_H__


	)

27 
	~"gtkw¿pbox.h
"

29 
	gG_BEGIN_DECLS


33 
	#GTK_TYPE_HWRAP_BOX
 (
	`gtk_hw¿p_box_g‘_ty³
 ())

	)

34 
	#GTK_HWRAP_BOX
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
GTK_TYPE_HWRAP_BOX
, 
GtkHW¿pBox
))

	)

35 
	#GTK_HWRAP_BOX_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
GTK_TYPE_HWRAP_BOX
, 
GtkHW¿pBoxCÏss
))

	)

36 
	#GTK_IS_HWRAP_BOX
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
GTK_TYPE_HWRAP_BOX
))

	)

37 
	#GTK_IS_HWRAP_BOX_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kÏss), 
GTK_TYPE_HWRAP_BOX
))

	)

38 
	#GTK_HWRAP_BOX_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
GTK_TYPE_HWRAP_BOX
, 
GtkHW¿pBoxCÏss
))

	)

42 
_GtkHW¿pBox
 
	tGtkHW¿pBox
;

43 
_GtkHW¿pBoxCÏss
 
	tGtkHW¿pBoxCÏss
;

47 
	s_GtkHW¿pBox


49 
GtkW¿pBox
 
	m·»Á_widg‘
;

52 
gušt
 
	mmax_chd_width
;

53 
gušt
 
	mmax_chd_height
;

57 
	s_GtkHW¿pBoxCÏss


59 
GtkW¿pBoxCÏss
 
	m·»Á_şass
;

64 
GTy³
 
	$gtk_hw¿p_box_g‘_ty³
 (è
G_GNUC_CONST
;

65 
GtkWidg‘
 * 
	`gtk_hw¿p_box_Ãw
 (
gboŞ—n
 
homog’eous
);

68 
G_END_DECLS


	@O:\tool\dvs50\app\gtkvwrapbox.c

23 
	~"cÚfig.h
"

25 
	~"gtkvw¿pbox.h
"

29 
gtk_vw¿p_box_şass_š™
 (
GtkVW¿pBoxCÏss
 *
kÏss
);

30 
gtk_vw¿p_box_š™
 (
GtkVW¿pBox
 *
vwbox
);

31 
gtk_vw¿p_box_size_»que¡
 (
GtkWidg‘
 *
widg‘
,

32 
GtkRequis™iÚ
 *
»quis™iÚ
);

33 
gtk_vw¿p_box_size_®loÿ‹
 (
GtkWidg‘
 *
widg‘
,

34 
GtkAÎoÿtiÚ
 *
®loÿtiÚ
);

35 
GSLi¡
* 
»v”£_li¡_cŞ_chd»n
 (
GtkW¿pBox
 *
wbox
,

36 
GtkW¿pBoxChd
 **
chd_p
,

37 
GtkAÎoÿtiÚ
 *
¬—
,

38 
gušt
 *
max_width
,

39 
gboŞ—n
 *
ÿn_hex·nd
);

43 
gpoš‹r
 
	g·»Á_şass
 = 
NULL
;

47 
GTy³


48 
	$gtk_vw¿p_box_g‘_ty³
 ()

50 
GTy³
 
vw¿p_box_ty³
 = 0;

52 ià(! 
vw¿p_box_ty³
)

54 cÚ¡ 
GTy³Info
 
vw¿p_box_šfo
 =

56  (
GtkVW¿pBoxCÏss
),

57 
NULL
,

58 
NULL
,

59 (
GCÏssIn™Func
è
gtk_vw¿p_box_şass_š™
,

60 
NULL
,

61 
NULL
,

62  (
GtkVW¿pBox
),

64 (
GIn¡ªûIn™Func
è
gtk_vw¿p_box_š™
,

67 
vw¿p_box_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
GTK_TYPE_WRAP_BOX
, "GtkVWrapBox",

68 &
vw¿p_box_šfo
, 0);

71  
vw¿p_box_ty³
;

72 
	}
}

75 
	$gtk_vw¿p_box_şass_š™
 (
GtkVW¿pBoxCÏss
 *
şass
)

77 
GObjeùCÏss
 *
objeù_şass
;

78 
GtkWidg‘CÏss
 *
widg‘_şass
;

79 
GtkCÚš”CÏss
 *
cÚš”_şass
;

80 
GtkW¿pBoxCÏss
 *
w¿p_box_şass
;

82 
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
şass
);

83 
widg‘_şass
 = 
	`GTK_WIDGET_CLASS
 (
şass
);

84 
cÚš”_şass
 = 
	`GTK_CONTAINER_CLASS
 (
şass
);

85 
w¿p_box_şass
 = 
	`GTK_WRAP_BOX_CLASS
 (
şass
);

87 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
şass
);

89 
widg‘_şass
->
size_»que¡
 = 
gtk_vw¿p_box_size_»que¡
;

90 
widg‘_şass
->
size_®loÿ‹
 = 
gtk_vw¿p_box_size_®loÿ‹
;

92 
w¿p_box_şass
->
¾i¡_lše_chd»n
 = 
»v”£_li¡_cŞ_chd»n
;

93 
	}
}

96 
	$gtk_vw¿p_box_š™
 (
GtkVW¿pBox
 *
vwbox
)

98 
vwbox
->
max_chd_height
 = 0;

99 
vwbox
->
max_chd_width
 = 0;

100 
	}
}

102 
GtkWidg‘
*

103 
	$gtk_vw¿p_box_Ãw
 (
gboŞ—n
 
homog’eous
)

105  
	`g_objeù_Ãw
 (
GTK_TYPE_VWRAP_BOX
, "homog’eous", 
homog’eous
, 
NULL
);

106 
	}
}

108 
šlše
 

109 
	$g‘_chd_»quis™iÚ
 (
GtkW¿pBox
 *
wbox
,

110 
GtkWidg‘
 *
chd
,

111 
GtkRequis™iÚ
 *
chd_»quis™iÚ
)

113 ià(
wbox
->
homog’eous
)

115 
GtkVW¿pBox
 *
vwbox
 = 
	`GTK_VWRAP_BOX
 (
wbox
);

117 
chd_»quis™iÚ
->
height
 = 
vwbox
->
max_chd_height
;

118 
chd_»quis™iÚ
->
width
 = 
vwbox
->
max_chd_width
;

121 
	`gtk_widg‘_g‘_chd_»quis™iÚ
 (
chd
, 
chd_»quis™iÚ
);

122 
	}
}

124 
gæßt


125 
	$g‘_Ïyout_size
 (
GtkVW¿pBox
 *
this
,

126 
gušt
 
max_height
,

127 
gušt
 *
height_šc
)

129 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
this
);

130 
GtkW¿pBoxChd
 *
chd
;

131 
gušt
 
n_cŞs
, 
Ëá_ov”
 = 0, 
tÙ®_width
 = 0;

132 
gboŞ—n
 
Ï¡_cŞ_fËd
 = 
TRUE
;

134 *
height_šc
 = 
this
->
max_chd_height
 + 1;

136 
n_cŞs
 = 0;

137 
chd
 = 
wbox
->
chd»n
; chd; chd = chd->
Ãxt
)

139 
GtkW¿pBoxChd
 *
cŞ_chd
;

140 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

141 
gušt
 
cŞ_height
, 
cŞ_width
, 
n
 = 1;

143 ià(!
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
))

146 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

147 ià(!
Ï¡_cŞ_fËd
)

148 *
height_šc
 = 
	`MIN
 (*height_šc, 
chd_»quis™iÚ
.
height
 - 
Ëá_ov”
);

149 
cŞ_height
 = 
chd_»quis™iÚ
.
height
;

150 
cŞ_width
 = 
chd_»quis™iÚ
.
width
;

151 
cŞ_chd
 = 
chd
->
Ãxt
; cŞ_chd && 
n
 < 
wbox
->
chd_lim™
; col_child = col_child->next)

153 ià(
	`GTK_WIDGET_VISIBLE
 (
cŞ_chd
->
widg‘
))

155 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
cŞ_chd
->
widg‘
, &
chd_»quis™iÚ
);

156 ià(
cŞ_height
 + 
wbox
->
v¥acšg
 + 
chd_»quis™iÚ
.
height
 > 
max_height
)

158 
cŞ_height
 +ğ
wbox
->
v¥acšg
 + 
chd_»quis™iÚ
.
height
;

159 
cŞ_width
 = 
	`MAX
 (cŞ_width, 
chd_»quis™iÚ
.
width
);

160 
n
++;

162 
chd
 = 
cŞ_chd
;

164 
Ï¡_cŞ_fËd
 = 
n
 >ğ
wbox
->
chd_lim™
;

165 
Ëá_ov”
 = 
Ï¡_cŞ_fËd
 ? 0 : 
max_height
 - (
cŞ_height
 + 
wbox
->
v¥acšg
);

166 
tÙ®_width
 +ğ(
n_cŞs
 ? 
wbox
->
h¥acšg
 : 0è+ 
cŞ_width
;

167 
n_cŞs
++;

170 ià(*
height_šc
 > 
this
->
max_chd_height
)

171 *
height_šc
 = 0;

173  
	`MAX
 (
tÙ®_width
, 1);

174 
	}
}

177 
	$gtk_vw¿p_box_size_»que¡
 (
GtkWidg‘
 *
widg‘
,

178 
GtkRequis™iÚ
 *
»quis™iÚ
)

180 
GtkVW¿pBox
 *
this
 = 
	`GTK_VWRAP_BOX
 (
widg‘
);

181 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widg‘
);

182 
GtkW¿pBoxChd
 *
chd
;

183 
gæßt
 
¿tio_di¡
, 
Ïyout_height
 = 0;

184 
gušt
 
cŞ_šc
 = 0;

186 
	`g_»tuº_if_ç
 (
»quis™iÚ
 !ğ
NULL
);

188 
»quis™iÚ
->
height
 = 0;

189 
»quis™iÚ
->
width
 = 0;

190 
this
->
max_chd_height
 = 0;

191 
this
->
max_chd_width
 = 0;

194 
chd
 = 
wbox
->
chd»n
; chd; chd = chd->
Ãxt
)

195 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
))

197 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

199 
	`gtk_widg‘_size_»que¡
 (
chd
->
widg‘
, &
chd_»quis™iÚ
);

201 
this
->
max_chd_height
 = 
	`MAX
 (this->max_chd_height, 
chd_»quis™iÚ
.
height
);

202 
this
->
max_chd_width
 = 
	`MAX
 (this->max_chd_width, 
chd_»quis™iÚ
.
width
);

206 
¿tio_di¡
 = 32768;

207 
Ïyout_height
 = 
this
->
max_chd_height
;

210 
gæßt
 
Ïyout_width
;

211 
gæßt
 
¿tio
, 
di¡
;

213 
Ïyout_height
 +ğ
cŞ_šc
;

214 
Ïyout_width
 = 
	`g‘_Ïyout_size
 (
this
, 
Ïyout_height
, &
cŞ_šc
);

215 
¿tio
 = 
Ïyout_width
 / 
Ïyout_height
;

216 
di¡
 = 
	`MAX
 (
¿tio
, 
wbox
->
a¥eù_¿tio
è- 
	`MIN
 (ratio, wbox->aspect_ratio);

217 ià(
di¡
 < 
¿tio_di¡
)

219 
¿tio_di¡
 = 
di¡
;

220 
»quis™iÚ
->
height
 = 
Ïyout_height
;

221 
»quis™iÚ
->
width
 = 
Ïyout_width
;

230 
cŞ_šc
);

232 
»quis™iÚ
->
width
 +ğ
	`GTK_CONTAINER
 (
wbox
)->
bÜd”_width
 * 2;

233 
»quis™iÚ
->
height
 +ğ
	`GTK_CONTAINER
 (
wbox
)->
bÜd”_width
 * 2;

238 
	}
}

240 
GSLi¡
*

241 
	$»v”£_li¡_cŞ_chd»n
 (
GtkW¿pBox
 *
wbox
,

242 
GtkW¿pBoxChd
 **
chd_p
,

243 
GtkAÎoÿtiÚ
 *
¬—
,

244 
gušt
 *
max_chd_size
,

245 
gboŞ—n
 *
ex·nd_lše
)

247 
GSLi¡
 *
¦i¡
 = 
NULL
;

248 
gušt
 
height
 = 0, 
cŞ_height
 = 
¬—
->height;

249 
GtkW¿pBoxChd
 *
chd
 = *
chd_p
;

251 *
max_chd_size
 = 0;

252 *
ex·nd_lše
 = 
FALSE
;

254 
chd
 && !
	`GTK_WIDGET_VISIBLE
 (chd->
widg‘
))

256 *
chd_p
 = 
chd
->
Ãxt
;

257 
chd
 = *
chd_p
;

260 ià(
chd
)

262 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

263 
gušt
 
n
 = 1;

265 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

266 
height
 +ğ
chd_»quis™iÚ
.height;

267 *
max_chd_size
 = 
	`MAX
 (*max_chd_size, 
chd_»quis™iÚ
.
width
);

268 *
ex·nd_lše
 |ğ
chd
->
hex·nd
;

269 
¦i¡
 = 
	`g_¦i¡_´•’d
 (¦i¡, 
chd
);

270 *
chd_p
 = 
chd
->
Ãxt
;

271 
chd
 = *
chd_p
;

273 
chd
 && 
n
 < 
wbox
->
chd_lim™
)

275 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
))

277 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

278 ià(
height
 + 
wbox
->
v¥acšg
 + 
chd_»quis™iÚ
.heighˆ> 
cŞ_height
 ||

279 
chd
->
w¿µed
)

281 
height
 +ğ
wbox
->
v¥acšg
 + 
chd_»quis™iÚ
.height;

282 *
max_chd_size
 = 
	`MAX
 (*max_chd_size, 
chd_»quis™iÚ
.
width
);

283 *
ex·nd_lše
 |ğ
chd
->
hex·nd
;

284 
¦i¡
 = 
	`g_¦i¡_´•’d
 (¦i¡, 
chd
);

285 
n
++;

287 *
chd_p
 = 
chd
->
Ãxt
;

288 
chd
 = *
chd_p
;

292  
¦i¡
;

293 
	}
}

296 
	$Ïyout_cŞ
 (
GtkW¿pBox
 *
wbox
,

297 
GtkAÎoÿtiÚ
 *
¬—
,

298 
GSLi¡
 *
chd»n
,

299 
gušt
 
chd»n_³r_lše
,

300 
gboŞ—n
 
hex·nd
)

302 
GSLi¡
 *
¦i¡
;

303 
gušt
 
n_chd»n
 = 0, 
n_ex·nd_chd»n
 = 0, 
have_ex·nd_chd»n
 = 0;

304 
gšt
 
tÙ®_height
 = 0;

305 
gæßt
 
y
, 
height
, 
exŒa
;

306 
GtkAÎoÿtiÚ
 
chd_®loÿtiÚ
;

308 
¦i¡
 = 
chd»n
; sli¡; sli¡ = sli¡->
Ãxt
)

310 
GtkW¿pBoxChd
 *
chd
 = 
¦i¡
->
d©a
;

311 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

313 
n_chd»n
++;

314 ià(
chd
->
vex·nd
)

315 
n_ex·nd_chd»n
++;

317 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

318 
tÙ®_height
 +ğ
chd_»quis™iÚ
.
height
;

321 
height
 = 
	`MAX
 (1, 
¬—
->heighˆ- (
n_chd»n
 - 1è* 
wbox
->
v¥acšg
);

322 ià(
height
 > 
tÙ®_height
)

323 
exŒa
 = 
height
 - 
tÙ®_height
;

325 
exŒa
 = 0;

326 
have_ex·nd_chd»n
 = 
n_ex·nd_chd»n
 && 
exŒa
;

328 
y
 = 
¬—
->y;

329 ià(
wbox
->
homog’eous
)

331 
height
 = 
	`MAX
 (1, 
¬—
->heighˆ- (
chd»n_³r_lše
 - 1è* 
wbox
->
v¥acšg
);

332 
height
 /ğ((
gdoubË
è
chd»n_³r_lše
);

333 
exŒa
 = 0;

335 ià(
have_ex·nd_chd»n
 && 
wbox
->
ju¡ify
 !ğ
GTK_JUSTIFY_FILL
)

337 
height
 = 
exŒa
;

338 
exŒa
 /ğ((
gdoubË
è
n_ex·nd_chd»n
);

342 ià(
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_FILL
)

344 
height
 = 
exŒa
;

345 
have_ex·nd_chd»n
 = 
TRUE
;

346 
n_ex·nd_chd»n
 = 
n_chd»n
;

347 
exŒa
 /ğ((
gdoubË
è
n_ex·nd_chd»n
);

349 ià(
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_CENTER
)

351 
y
 +ğ
exŒa
 / 2;

352 
height
 = 0;

353 
exŒa
 = 0;

355 ià(
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_LEFT
)

357 
height
 = 0;

358 
exŒa
 = 0;

360 ià(
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_RIGHT
)

362 
y
 +ğ
exŒa
;

363 
height
 = 0;

364 
exŒa
 = 0;

368 
n_chd»n
 = 0;

369 
¦i¡
 = 
chd»n
; sli¡; sli¡ = sli¡->
Ãxt
)

371 
GtkW¿pBoxChd
 *
chd
 = 
¦i¡
->
d©a
;

373 
chd_®loÿtiÚ
.
y
 = y;

374 
chd_®loÿtiÚ
.
x
 = 
¬—
->x;

375 ià(
wbox
->
homog’eous
)

377 
chd_®loÿtiÚ
.
width
 = 
¬—
->width;

378 
chd_®loÿtiÚ
.
height
 = height;

379 
y
 +ğ
chd_®loÿtiÚ
.
height
 + 
wbox
->
v¥acšg
;

383 
GtkRequis™iÚ
 
chd_»quis™iÚ
;

385 
	`g‘_chd_»quis™iÚ
 (
wbox
, 
chd
->
widg‘
, &
chd_»quis™iÚ
);

387 ià(
chd_»quis™iÚ
.
width
 >ğ
¬—
->width)

388 
chd_®loÿtiÚ
.
width
 = 
¬—
->width;

391 
chd_®loÿtiÚ
.
width
 = 
chd_»quis™iÚ
.width;

392 ià(
wbox
->
lše_ju¡ify
 =ğ
GTK_JUSTIFY_FILL
 || 
chd
->
hfl
)

393 
chd_®loÿtiÚ
.
width
 = 
¬—
->width;

394 ià(
chd
->
hex·nd
 || 
wbox
->
lše_ju¡ify
 =ğ
GTK_JUSTIFY_CENTER
)

395 
chd_®loÿtiÚ
.
x
 +ğ(
¬—
->
width
 - 
chd_»quis™iÚ
.width) / 2;

396 ià(
wbox
->
lše_ju¡ify
 =ğ
GTK_JUSTIFY_BOTTOM
)

397 
chd_®loÿtiÚ
.
x
 +ğ
¬—
->
width
 - 
chd_»quis™iÚ
.width;

400 ià(
have_ex·nd_chd»n
)

402 
chd_®loÿtiÚ
.
height
 = 
chd_»quis™iÚ
.height;

403 ià(
chd
->
vex·nd
 || 
wbox
->
ju¡ify
 =ğ
GTK_JUSTIFY_FILL
)

405 
gušt
 
¥aû
;

407 
n_ex·nd_chd»n
--;

408 
¥aû
 = 
exŒa
 * 
n_ex·nd_chd»n
;

409 
¥aû
 = 
height
 - space;

410 
height
 -ğ
¥aû
;

411 ià(
chd
->
vfl
)

412 
chd_®loÿtiÚ
.
height
 +ğ
¥aû
;

415 
chd_®loÿtiÚ
.
y
 +ğ
¥aû
 / 2;

416 
y
 +ğ
¥aû
;

424 
chd_®loÿtiÚ
.
y
 +ğ
n_chd»n
 * 
exŒa
;

427 
chd_®loÿtiÚ
.
height
 = 
	`MIN
 (
chd_»quis™iÚ
.height,

428 
¬—
->
height
 - 
chd_®loÿtiÚ
.
y
 +‡rea->y);

432 
y
 +ğ
chd_®loÿtiÚ
.
height
 + 
wbox
->
v¥acšg
;

433 
	`gtk_widg‘_size_®loÿ‹
 (
chd
->
widg‘
, &
chd_®loÿtiÚ
);

434 
n_chd»n
++;

436 
	}
}

438 
_Lše
 
	tLše1
;

439 
	s_Lše


441 
GSLi¡
 *
	mchd»n
;

442 
gušt16
 
	mmš_size
;

443 
gušt
 
	mex·nd
 : 1;

444 
Lše1
 *
	mÃxt
;

448 
	$Ïyout_cŞs
 (
GtkW¿pBox
 *
wbox
,

449 
GtkAÎoÿtiÚ
 *
¬—
)

451 
GtkW¿pBoxChd
 *
Ãxt_chd
;

452 
gušt
 
mš_width
;

453 
gboŞ—n
 
hex·nd
;

454 
GSLi¡
 *
¦i¡
;

455 
Lše1
 *
lše_li¡
 = 
NULL
;

456 
gušt
 
tÙ®_width
 = 0, 
n_ex·nd_lšes
 = 0, 
n_lšes
 = 0;

457 
gæßt
 
shršk_width
;

458 
gušt
 
chd»n_³r_lše
;

460 
Ãxt_chd
 = 
wbox
->
chd»n
;

461 
¦i¡
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`¾i¡_lše_chd»n
 (wbox,

462 &
Ãxt_chd
,

463 
¬—
,

464 &
mš_width
,

465 &
hex·nd
);

466 
¦i¡
 = 
	`g_¦i¡_»v”£
 (slist);

468 
chd»n_³r_lše
 = 
	`g_¦i¡_Ëngth
 (
¦i¡
);

469 
¦i¡
)

471 #ià
	`GLIB_CHECK_VERSION
(2,10,0)

472 
Lše1
 *
lše
 = 
	`g_¦iû_Ãw
 (Line1);

474 
Lše
 *
lše
 = 
	`g_Ãw
 (Line, 1);

477 
lše
->
chd»n
 = 
¦i¡
;

478 
lše
->
mš_size
 = 
mš_width
;

479 
tÙ®_width
 +ğ
mš_width
;

480 
lše
->
ex·nd
 = 
hex·nd
;

481 ià(
hex·nd
)

482 
n_ex·nd_lšes
++;

483 
lše
->
Ãxt
 = 
lše_li¡
;

484 
lše_li¡
 = 
lše
;

485 
n_lšes
++;

487 
¦i¡
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`¾i¡_lše_chd»n
 (wbox,

488 &
Ãxt_chd
,

489 
¬—
,

490 &
mš_width
,

491 &
hex·nd
);

492 
¦i¡
 = 
	`g_¦i¡_»v”£
 (slist);

495 ià(
tÙ®_width
 > 
¬—
->
width
)

496 
shršk_width
 = 
tÙ®_width
 - 
¬—
->
width
;

498 
shršk_width
 = 0;

502 
Lše1
 *
´ev
 = 
NULL
, *
Ï¡
 = NULL;

503 
gæßt
 
n_shršk_lšes
 = 
n_lšes
;

505 
lše_li¡
)

507 
Lše1
 *
tmp
 = 
lše_li¡
->
Ãxt
;

509 ià(
shršk_width
)

511 
Lše1
 *
lše
 = 
lše_li¡
;

512 
gušt
 
shršk_äaù
 = 
shršk_width
 / 
n_shršk_lšes
 + 0.5;

514 ià(
lše
->
mš_size
 > 
shršk_äaù
)

516 
shršk_width
 -ğ
shršk_äaù
;

517 
lše
->
mš_size
 -ğ
shršk_äaù
;

521 
shršk_width
 -ğ
lše
->
mš_size
 - 1;

522 
lše
->
mš_size
 = 1;

525 
n_shršk_lšes
--;

527 
Ï¡
 = 
lše_li¡
;

528 
lše_li¡
->
Ãxt
 = 
´ev
;

529 
´ev
 = 
lše_li¡
;

530 
lše_li¡
 = 
tmp
;

532 
lše_li¡
 = 
Ï¡
;

535 ià(
n_lšes
)

537 
Lše1
 *
lše
;

538 
gæßt
 
x
, 
width
, 
exŒa
 = 0;

540 
width
 = 
¬—
->width;

541 
width
 = 
	`MAX
 (
n_lšes
, width - (n_lše - 1è* 
wbox
->
h¥acšg
);

543 ià(
wbox
->
homog’eous
)

544 
width
 /ğ((
gdoubË
è
n_lšes
);

545 ià(
n_ex·nd_lšes
)

547 
width
 = 
	`MAX
 (0, width - 
tÙ®_width
);

548 
exŒa
 = 
width
 / ((
gdoubË
è
n_ex·nd_lšes
);

551 
width
 = 0;

553 
x
 = 
¬—
->x;

554 
lše
 = 
lše_li¡
;

555 
lše
)

557 
GtkAÎoÿtiÚ
 
cŞ_®loÿtiÚ
;

558 
Lše1
 *
Ãxt_lše
 = 
lše
->
Ãxt
;

560 
cŞ_®loÿtiÚ
.
y
 = 
¬—
->y;

561 
cŞ_®loÿtiÚ
.
height
 = 
¬—
->height;

562 ià(
wbox
->
homog’eous
)

563 
cŞ_®loÿtiÚ
.
width
 = width;

566 
cŞ_®loÿtiÚ
.
width
 = 
lše
->
mš_size
;

568 ià(
lše
->
ex·nd
)

569 
cŞ_®loÿtiÚ
.
width
 +ğ
exŒa
;

572 
cŞ_®loÿtiÚ
.
x
 = x;

574 
x
 +ğ
cŞ_®loÿtiÚ
.
width
 + 
wbox
->
h¥acšg
;

575 
	`Ïyout_cŞ
 (
wbox
,

576 &
cŞ_®loÿtiÚ
,

577 
lše
->
chd»n
,

578 
chd»n_³r_lše
,

579 
lše
->
ex·nd
);

581 
	`g_¦i¡_ä“
 (
lše
->
chd»n
);

582 #ià(!
	`GLIB_CHECK_VERSION
(2,10,0))

583 
	`g_ä“
 (
lše
);

585 
lše
 = 
Ãxt_lše
;

588 #ià
	`GLIB_CHECK_VERSION
(2,10,0)

589 
	`g_¦iû_ä“_chaš
 (
Lše1
, 
lše_li¡
, 
Ãxt
);

592 
	}
}

595 
	$gtk_vw¿p_box_size_®loÿ‹
 (
GtkWidg‘
 *
widg‘
,

596 
GtkAÎoÿtiÚ
 *
®loÿtiÚ
)

598 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widg‘
);

599 
GtkAÎoÿtiÚ
 
¬—
;

600 
gšt
 
bÜd”
 = 
	`GTK_CONTAINER
 (
wbox
)->
bÜd”_width
;

602 
widg‘
->
®loÿtiÚ
 = *allocation;

603 
¬—
.
y
 = 
®loÿtiÚ
->y + 
bÜd”
;

604 
¬—
.
x
 = 
®loÿtiÚ
->x + 
bÜd”
;

605 
¬—
.
height
 = 
	`MAX
 (1, (
gšt
è
®loÿtiÚ
->heighˆ- 
bÜd”
 * 2);

606 
¬—
.
width
 = 
	`MAX
 (1, (
gšt
è
®loÿtiÚ
->width - 
bÜd”
 * 2);

615 
	`Ïyout_cŞs
 (
wbox
, &
¬—
);

616 
	}
}

	@O:\tool\dvs50\app\gtkvwrapbox.h

23 #iâdeà
__GTK_VWRAP_BOX_H__


24 
	#__GTK_VWRAP_BOX_H__


	)

27 
	~"gtkw¿pbox.h
"

29 
	gG_BEGIN_DECLS


33 
	#GTK_TYPE_VWRAP_BOX
 (
	`gtk_vw¿p_box_g‘_ty³
 ())

	)

34 
	#GTK_VWRAP_BOX
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
GTK_TYPE_VWRAP_BOX
, 
GtkVW¿pBox
))

	)

35 
	#GTK_VWRAP_BOX_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
GTK_TYPE_VWRAP_BOX
, 
GtkVW¿pBoxCÏss
))

	)

36 
	#GTK_IS_VWRAP_BOX
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
GTK_TYPE_VWRAP_BOX
))

	)

37 
	#GTK_IS_VWRAP_BOX_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kÏss), 
GTK_TYPE_VWRAP_BOX
))

	)

38 
	#GTK_VWRAP_BOX_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
GTK_TYPE_VWRAP_BOX
, 
GtkVW¿pBoxCÏss
))

	)

42 
_GtkVW¿pBox
 
	tGtkVW¿pBox
;

43 
_GtkVW¿pBoxCÏss
 
	tGtkVW¿pBoxCÏss
;

47 
	s_GtkVW¿pBox


49 
GtkW¿pBox
 
	m·»Á_widg‘
;

52 
gušt
 
	mmax_chd_width
;

53 
gušt
 
	mmax_chd_height
;

57 
	s_GtkVW¿pBoxCÏss


59 
GtkW¿pBoxCÏss
 
	m·»Á_şass
;

64 
GTy³
 
	$gtk_vw¿p_box_g‘_ty³
 (è
G_GNUC_CONST
;

65 
GtkWidg‘
 * 
	`gtk_vw¿p_box_Ãw
 (
gboŞ—n
 
homog’eous
);

68 
G_END_DECLS


	@O:\tool\dvs50\app\gtkwrapbox.c

23 
	~"cÚfig.h
"

25 
	~"gtkw¿pbox.h
"

30 
	mPROP_0
,

31 
	mPROP_HOMOGENEOUS
,

32 
	mPROP_JUSTIFY
,

33 
	mPROP_HSPACING
,

34 
	mPROP_VSPACING
,

35 
	mPROP_LINE_JUSTIFY
,

36 
	mPROP_ASPECT_RATIO
,

37 
	mPROP_CURRENT_RATIO
,

38 
	mPROP_CHILD_LIMIT


42 
	mCHILD_PROP_0
,

43 
	mCHILD_PROP_POSITION
,

44 
	mCHILD_PROP_HEXPAND
,

45 
	mCHILD_PROP_HFILL
,

46 
	mCHILD_PROP_VEXPAND
,

47 
	mCHILD_PROP_VFILL
,

48 
	mCHILD_PROP_WRAPPED


53 
gtk_w¿p_box_şass_š™
 (
GtkW¿pBoxCÏss
 *
kÏss
);

54 
gtk_w¿p_box_š™
 (
GtkW¿pBox
 *
wbox
);

55 
gtk_w¿p_box_£t_´İ”ty
 (
GObjeù
 *
objeù
,

56 
gušt
 
´İ”ty_id
,

57 cÚ¡ 
GV®ue
 *
v®ue
,

58 
GP¬amS³c
 *
p¥ec
);

59 
gtk_w¿p_box_g‘_´İ”ty
 (
GObjeù
 *
objeù
,

60 
gušt
 
´İ”ty_id
,

61 
GV®ue
 *
v®ue
,

62 
GP¬amS³c
 *
p¥ec
);

63 
gtk_w¿p_box_£t_chd_´İ”ty
 (
GtkCÚš”
 *
cÚš”
,

64 
GtkWidg‘
 *
chd
,

65 
gušt
 
´İ”ty_id
,

66 cÚ¡ 
GV®ue
 *
v®ue
,

67 
GP¬amS³c
 *
p¥ec
);

68 
gtk_w¿p_box_g‘_chd_´İ”ty
 (
GtkCÚš”
 *
cÚš”
,

69 
GtkWidg‘
 *
chd
,

70 
gušt
 
´İ”ty_id
,

71 
GV®ue
 *
v®ue
,

72 
GP¬amS³c
 *
p¥ec
);

73 
gtk_w¿p_box_m­
 (
GtkWidg‘
 *
widg‘
);

74 
gtk_w¿p_box_unm­
 (
GtkWidg‘
 *
widg‘
);

75 
gšt
 
gtk_w¿p_box_expo£
 (
GtkWidg‘
 *
widg‘
,

76 
GdkEv’tExpo£
 *
ev’t
);

77 
gtk_w¿p_box_add
 (
GtkCÚš”
 *
cÚš”
,

78 
GtkWidg‘
 *
widg‘
);

79 
gtk_w¿p_box_»move
 (
GtkCÚš”
 *
cÚš”
,

80 
GtkWidg‘
 *
widg‘
);

81 
gtk_w¿p_box_fÜ®l
 (
GtkCÚš”
 *
cÚš”
,

82 
gboŞ—n
 
šşude_š‹º®s
,

83 
GtkC®lback
 
ÿÎback
,

84 
gpoš‹r
 
ÿÎback_d©a
);

85 
GTy³
 
gtk_w¿p_box_chd_ty³
 (
GtkCÚš”
 *
cÚš”
);

89 
gpoš‹r
 
	g·»Á_şass
 = 
NULL
;

93 
GTy³


94 
	$gtk_w¿p_box_g‘_ty³
 ()

96 
GTy³
 
w¿p_box_ty³
 = 0;

98 ià(! 
w¿p_box_ty³
)

100 cÚ¡ 
GTy³Info
 
w¿p_box_šfo
 =

102  (
GtkW¿pBoxCÏss
),

103 
NULL
,

104 
NULL
,

105 (
GCÏssIn™Func
è
gtk_w¿p_box_şass_š™
,

106 
NULL
,

107 
NULL
,

108  (
GtkW¿pBox
),

110 (
GIn¡ªûIn™Func
è
gtk_w¿p_box_š™
,

113 
w¿p_box_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
GTK_TYPE_CONTAINER
, "GtkWrapBox",

114 &
w¿p_box_šfo
, 0);

117  
w¿p_box_ty³
;

118 
	}
}

121 
	$gtk_w¿p_box_şass_š™
 (
GtkW¿pBoxCÏss
 *
şass
)

123 
GObjeùCÏss
 *
objeù_şass
;

124 
GtkWidg‘CÏss
 *
widg‘_şass
;

125 
GtkCÚš”CÏss
 *
cÚš”_şass
;

127 
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
şass
);

128 
widg‘_şass
 = 
	`GTK_WIDGET_CLASS
 (
şass
);

129 
cÚš”_şass
 = 
	`GTK_CONTAINER_CLASS
 (
şass
);

131 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
şass
);

133 
objeù_şass
->
£t_´İ”ty
 = 
gtk_w¿p_box_£t_´İ”ty
;

134 
objeù_şass
->
g‘_´İ”ty
 = 
gtk_w¿p_box_g‘_´İ”ty
;

136 
widg‘_şass
->
m­
 = 
gtk_w¿p_box_m­
;

137 
widg‘_şass
->
unm­
 = 
gtk_w¿p_box_unm­
;

138 
widg‘_şass
->
expo£_ev’t
 = 
gtk_w¿p_box_expo£
;

140 
cÚš”_şass
->
add
 = 
gtk_w¿p_box_add
;

141 
cÚš”_şass
->
»move
 = 
gtk_w¿p_box_»move
;

142 
cÚš”_şass
->
fÜ®l
 = 
gtk_w¿p_box_fÜ®l
;

143 
cÚš”_şass
->
chd_ty³
 = 
gtk_w¿p_box_chd_ty³
;

144 
cÚš”_şass
->
£t_chd_´İ”ty
 = 
gtk_w¿p_box_£t_chd_´İ”ty
;

145 
cÚš”_şass
->
g‘_chd_´İ”ty
 = 
gtk_w¿p_box_g‘_chd_´İ”ty
;

147 
şass
->
¾i¡_lše_chd»n
 = 
NULL
;

149 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
,

150 
PROP_HOMOGENEOUS
,

151 
	`g_·¿m_¥ec_boŞ—n
 ("homogeneous",

152 
NULL
,

153 
NULL
,

154 
FALSE
,

155 
G_PARAM_READWRITE
));

156 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
,

157 
PROP_JUSTIFY
,

158 
	`g_·¿m_¥ec_’um
 ("justify",

159 
NULL
,

160 
NULL
,

161 
GTK_TYPE_JUSTIFICATION
,

162 
GTK_JUSTIFY_LEFT
,

163 
G_PARAM_READWRITE
));

164 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
,

165 
PROP_HSPACING
,

166 
	`g_·¿m_¥ec_ušt
 ("hspacing",

167 
NULL
,

168 
NULL
,

170 
G_MAXINT
,

172 
G_PARAM_READWRITE
));

174 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
,

175 
PROP_VSPACING
,

176 
	`g_·¿m_¥ec_ušt
 ("vspacing",

177 
NULL
,

178 
NULL
,

180 
G_MAXINT
,

182 
G_PARAM_READWRITE
));

184 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
,

185 
PROP_LINE_JUSTIFY
,

186 
	`g_·¿m_¥ec_’um
 ("line-justify",

187 
NULL
,

188 
NULL
,

189 
GTK_TYPE_JUSTIFICATION
,

190 
GTK_JUSTIFY_BOTTOM
,

191 
G_PARAM_READWRITE
));

193 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
,

194 
PROP_ASPECT_RATIO
,

195 
	`g_·¿m_¥ec_æßt
 ("aspect-ratio",

196 
NULL
,

197 
NULL
,

199 
G_MAXFLOAT
,

201 
G_PARAM_READWRITE
));

203 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
,

204 
PROP_CURRENT_RATIO
,

205 
	`g_·¿m_¥ec_æßt
 ("current-ratio",

206 
NULL
,

207 
NULL
,

209 
G_MAXFLOAT
,

211 
G_PARAM_READABLE
));

213 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
,

214 
PROP_CHILD_LIMIT
,

215 
	`g_·¿m_¥ec_ušt
 ("max-children-per-line",

216 
NULL
,

217 
NULL
,

221 
G_PARAM_READWRITE
));

223 
	`gtk_cÚš”_şass_š¡®l_chd_´İ”ty
 (
cÚš”_şass
,

224 
CHILD_PROP_POSITION
,

225 
	`g_·¿m_¥ec_št
 ("position",

226 
NULL
,

227 
NULL
,

228 -1, 
G_MAXINT
, 0,

229 
G_PARAM_READWRITE
));

230 
	`gtk_cÚš”_şass_š¡®l_chd_´İ”ty
 (
cÚš”_şass
,

231 
CHILD_PROP_HEXPAND
,

232 
	`g_·¿m_¥ec_boŞ—n
 ("hexpand",

233 
NULL
,

234 
NULL
,

235 
FALSE
,

236 
G_PARAM_READWRITE
));

237 
	`gtk_cÚš”_şass_š¡®l_chd_´İ”ty
 (
cÚš”_şass
,

238 
CHILD_PROP_HFILL
,

239 
	`g_·¿m_¥ec_boŞ—n
 ("hfill",

240 
NULL
,

241 
NULL
,

242 
FALSE
,

243 
G_PARAM_READWRITE
));

244 
	`gtk_cÚš”_şass_š¡®l_chd_´İ”ty
 (
cÚš”_şass
,

245 
CHILD_PROP_VEXPAND
,

246 
	`g_·¿m_¥ec_boŞ—n
 ("vexpand",

247 
NULL
,

248 
NULL
,

249 
FALSE
,

250 
G_PARAM_READWRITE
));

251 
	`gtk_cÚš”_şass_š¡®l_chd_´İ”ty
 (
cÚš”_şass
,

252 
CHILD_PROP_VFILL
,

253 
	`g_·¿m_¥ec_boŞ—n
 ("vfill",

254 
NULL
,

255 
NULL
,

256 
FALSE
,

257 
G_PARAM_READWRITE
));

258 
	`gtk_cÚš”_şass_š¡®l_chd_´İ”ty
 (
cÚš”_şass
,

259 
CHILD_PROP_WRAPPED
,

260 
	`g_·¿m_¥ec_boŞ—n
 ("wrapped",

261 
NULL
,

262 
NULL
,

263 
FALSE
,

264 
G_PARAM_READWRITE
));

265 
	}
}

268 
	$gtk_w¿p_box_š™
 (
GtkW¿pBox
 *
wbox
)

270 
	`GTK_WIDGET_SET_FLAGS
 (
wbox
, 
GTK_NO_WINDOW
);

272 
wbox
->
homog’eous
 = 
FALSE
;

273 
wbox
->
h¥acšg
 = 0;

274 
wbox
->
v¥acšg
 = 0;

275 
wbox
->
ju¡ify
 = 
GTK_JUSTIFY_LEFT
;

276 
wbox
->
lše_ju¡ify
 = 
GTK_JUSTIFY_BOTTOM
;

277 
wbox
->
n_chd»n
 = 0;

278 
wbox
->
chd»n
 = 
NULL
;

279 
wbox
->
a¥eù_¿tio
 = 1.0;

280 
wbox
->
chd_lim™
 = 32767;

281 
	}
}

284 
	$gtk_w¿p_box_£t_´İ”ty
 (
GObjeù
 *
objeù
,

285 
gušt
 
´İ”ty_id
,

286 cÚ¡ 
GV®ue
 *
v®ue
,

287 
GP¬amS³c
 *
p¥ec
)

289 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
objeù
);

291 
´İ”ty_id
)

293 
PROP_HOMOGENEOUS
:

294 
	`gtk_w¿p_box_£t_homog’eous
 (
wbox
, 
	`g_v®ue_g‘_boŞ—n
 (
v®ue
));

296 
PROP_JUSTIFY
:

297 
	`gtk_w¿p_box_£t_ju¡ify
 (
wbox
, 
	`g_v®ue_g‘_’um
 (
v®ue
));

299 
PROP_LINE_JUSTIFY
:

300 
	`gtk_w¿p_box_£t_lše_ju¡ify
 (
wbox
, 
	`g_v®ue_g‘_’um
 (
v®ue
));

302 
PROP_HSPACING
:

303 
	`gtk_w¿p_box_£t_h¥acšg
 (
wbox
, 
	`g_v®ue_g‘_ušt
 (
v®ue
));

305 
PROP_VSPACING
:

306 
	`gtk_w¿p_box_£t_v¥acšg
 (
wbox
, 
	`g_v®ue_g‘_ušt
 (
v®ue
));

308 
PROP_ASPECT_RATIO
:

309 
	`gtk_w¿p_box_£t_a¥eù_¿tio
 (
wbox
, 
	`g_v®ue_g‘_æßt
 (
v®ue
));

311 
PROP_CHILD_LIMIT
:

312 ià(
wbox
->
chd_lim™
 !ğ
	`g_v®ue_g‘_ušt
 (
v®ue
))

313 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
wbox
));

316 
	`G_OBJECT_WARN_INVALID_PROPERTY_ID
 (
objeù
, 
´İ”ty_id
, 
p¥ec
);

319 
	}
}

322 
	$gtk_w¿p_box_g‘_´İ”ty
 (
GObjeù
 *
objeù
,

323 
gušt
 
´İ”ty_id
,

324 
GV®ue
 *
v®ue
,

325 
GP¬amS³c
 *
p¥ec
)

327 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
objeù
);

328 
GtkWidg‘
 *
widg‘
 = 
	`GTK_WIDGET
 (
objeù
);

330 
´İ”ty_id
)

332 
PROP_HOMOGENEOUS
:

333 
	`g_v®ue_£t_boŞ—n
 (
v®ue
, 
wbox
->
homog’eous
);

335 
PROP_JUSTIFY
:

336 
	`g_v®ue_£t_’um
 (
v®ue
, 
wbox
->
ju¡ify
);

338 
PROP_LINE_JUSTIFY
:

339 
	`g_v®ue_£t_’um
 (
v®ue
, 
wbox
->
lše_ju¡ify
);

341 
PROP_HSPACING
:

342 
	`g_v®ue_£t_ušt
 (
v®ue
, 
wbox
->
h¥acšg
);

344 
PROP_VSPACING
:

345 
	`g_v®ue_£t_ušt
 (
v®ue
, 
wbox
->
v¥acšg
);

347 
PROP_ASPECT_RATIO
:

348 
	`g_v®ue_£t_æßt
 (
v®ue
, 
wbox
->
a¥eù_¿tio
);

350 
PROP_CURRENT_RATIO
:

351 
	`g_v®ue_£t_æßt
 (
v®ue
, (((
gæßt
è
widg‘
->
®loÿtiÚ
.
width
) /

352 ((
gæßt
è
widg‘
->
®loÿtiÚ
.
height
)));

354 
PROP_CHILD_LIMIT
:

355 
	`g_v®ue_£t_ušt
 (
v®ue
, 
wbox
->
chd_lim™
);

358 
	`G_OBJECT_WARN_INVALID_PROPERTY_ID
 (
objeù
, 
´İ”ty_id
, 
p¥ec
);

361 
	}
}

364 
	$gtk_w¿p_box_£t_chd_´İ”ty
 (
GtkCÚš”
 *
cÚš”
,

365 
GtkWidg‘
 *
chd
,

366 
gušt
 
´İ”ty_id
,

367 cÚ¡ 
GV®ue
 *
v®ue
,

368 
GP¬amS³c
 *
p¥ec
)

370 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
cÚš”
);

371 
gboŞ—n
 
hex·nd
 = 
FALSE
, 
hfl
 = FALSE;

372 
gboŞ—n
 
vex·nd
 = 
FALSE
, 
vfl
 = FALSE;

373 
gboŞ—n
 
w¿µed
 = 
FALSE
;

375 ià(
´İ”ty_id
 !ğ
CHILD_PROP_POSITION
)

376 
	`gtk_w¿p_box_qu”y_chd_·ckšg
 (
wbox
, 
chd
,

377 &
hex·nd
, &
hfl
,

378 &
vex·nd
, &
vfl
,

379 &
w¿µed
);

381 
´İ”ty_id
)

383 
CHILD_PROP_POSITION
:

384 
	`gtk_w¿p_box_»Üd”_chd
 (
wbox
, 
chd
, 
	`g_v®ue_g‘_št
 (
v®ue
));

386 
CHILD_PROP_HEXPAND
:

387 
	`gtk_w¿p_box_£t_chd_·ckšg
 (
wbox
, 
chd
,

388 
	`g_v®ue_g‘_boŞ—n
 (
v®ue
), 
hfl
,

389 
vex·nd
, 
vfl
,

390 
w¿µed
);

392 
CHILD_PROP_HFILL
:

393 
	`gtk_w¿p_box_£t_chd_·ckšg
 (
wbox
, 
chd
,

394 
hex·nd
, 
	`g_v®ue_g‘_boŞ—n
 (
v®ue
),

395 
vex·nd
, 
vfl
,

396 
w¿µed
);

398 
CHILD_PROP_VEXPAND
:

399 
	`gtk_w¿p_box_£t_chd_·ckšg
 (
wbox
, 
chd
,

400 
hex·nd
, 
hfl
,

401 
	`g_v®ue_g‘_boŞ—n
 (
v®ue
), 
vfl
,

402 
w¿µed
);

404 
CHILD_PROP_VFILL
:

405 
	`gtk_w¿p_box_£t_chd_·ckšg
 (
wbox
, 
chd
,

406 
hex·nd
, 
hfl
,

407 
vex·nd
, 
	`g_v®ue_g‘_boŞ—n
 (
v®ue
),

408 
w¿µed
);

410 
CHILD_PROP_WRAPPED
:

411 
	`gtk_w¿p_box_£t_chd_·ckšg
 (
wbox
, 
chd
,

412 
hex·nd
, 
hfl
,

413 
vex·nd
, 
vfl
,

414 
	`g_v®ue_g‘_boŞ—n
 (
v®ue
));

417 
	`GTK_CONTAINER_WARN_INVALID_CHILD_PROPERTY_ID
 (
cÚš”
, 
´İ”ty_id
, 
p¥ec
);

420 
	}
}

423 
	$gtk_w¿p_box_g‘_chd_´İ”ty
 (
GtkCÚš”
 *
cÚš”
,

424 
GtkWidg‘
 *
chd
,

425 
gušt
 
´İ”ty_id
,

426 
GV®ue
 *
v®ue
,

427 
GP¬amS³c
 *
p¥ec
)

429 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
cÚš”
);

430 
gboŞ—n
 
hex·nd
 = 
FALSE
, 
hfl
 = FALSE;

431 
gboŞ—n
 
vex·nd
 = 
FALSE
, 
vfl
 = FALSE;

432 
gboŞ—n
 
w¿µed
 = 
FALSE
;

434 ià(
´İ”ty_id
 !ğ
CHILD_PROP_POSITION
)

435 
	`gtk_w¿p_box_qu”y_chd_·ckšg
 (
wbox
, 
chd
,

436 &
hex·nd
, &
hfl
,

437 &
vex·nd
, &
vfl
,

438 &
w¿µed
);

440 
´İ”ty_id
)

442 
GtkW¿pBoxChd
 *
chd_šfo
;

443 
gušt
 
i
;

444 
CHILD_PROP_POSITION
:

445 
i
 = 0;

446 
chd_šfo
 = 
wbox
->
chd»n
; chd_šfo; chd_šfØğchd_šfo->
Ãxt
)

448 ià(
chd_šfo
->
widg‘
 =ğ
chd
)

450 
i
 += 1;

452 
	`g_v®ue_£t_št
 (
v®ue
, 
chd_šfo
 ? 
i
 : -1);

454 
CHILD_PROP_HEXPAND
:

455 
	`g_v®ue_£t_boŞ—n
 (
v®ue
, 
hex·nd
);

457 
CHILD_PROP_HFILL
:

458 
	`g_v®ue_£t_boŞ—n
 (
v®ue
, 
hfl
);

460 
CHILD_PROP_VEXPAND
:

461 
	`g_v®ue_£t_boŞ—n
 (
v®ue
, 
vex·nd
);

463 
CHILD_PROP_VFILL
:

464 
	`g_v®ue_£t_boŞ—n
 (
v®ue
, 
vfl
);

466 
CHILD_PROP_WRAPPED
:

467 
	`g_v®ue_£t_boŞ—n
 (
v®ue
, 
w¿µed
);

470 
	`GTK_CONTAINER_WARN_INVALID_CHILD_PROPERTY_ID
 (
cÚš”
, 
´İ”ty_id
, 
p¥ec
);

473 
	}
}

475 
GTy³


476 
	$gtk_w¿p_box_chd_ty³
 (
GtkCÚš”
 *
cÚš”
)

478  
GTK_TYPE_WIDGET
;

479 
	}
}

482 
	$gtk_w¿p_box_£t_homog’eous
 (
GtkW¿pBox
 *
wbox
,

483 
gboŞ—n
 
homog’eous
)

485 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

487 
homog’eous
 = homog’eou !ğ
FALSE
;

488 ià(
wbox
->
homog’eous
 != homogeneous)

490 
wbox
->
homog’eous
 = homogeneous;

491 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
wbox
));

493 
	}
}

496 
	$gtk_w¿p_box_£t_h¥acšg
 (
GtkW¿pBox
 *
wbox
,

497 
gušt
 
h¥acšg
)

499 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

501 ià(
wbox
->
h¥acšg
 != hspacing)

503 
wbox
->
h¥acšg
 = hspacing;

504 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
wbox
));

506 
	}
}

509 
	$gtk_w¿p_box_£t_v¥acšg
 (
GtkW¿pBox
 *
wbox
,

510 
gušt
 
v¥acšg
)

512 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

514 ià(
wbox
->
v¥acšg
 != vspacing)

516 
wbox
->
v¥acšg
 = vspacing;

517 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
wbox
));

519 
	}
}

522 
	$gtk_w¿p_box_£t_ju¡ify
 (
GtkW¿pBox
 *
wbox
,

523 
GtkJu¡ifiÿtiÚ
 
ju¡ify
)

525 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

526 
	`g_»tuº_if_ç
 (
ju¡ify
 <ğ
GTK_JUSTIFY_FILL
);

528 ià(
wbox
->
ju¡ify
 != justify)

530 
wbox
->
ju¡ify
 = justify;

531 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
wbox
));

533 
	}
}

536 
	$gtk_w¿p_box_£t_lše_ju¡ify
 (
GtkW¿pBox
 *
wbox
,

537 
GtkJu¡ifiÿtiÚ
 
lše_ju¡ify
)

539 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

540 
	`g_»tuº_if_ç
 (
lše_ju¡ify
 <ğ
GTK_JUSTIFY_FILL
);

542 ià(
wbox
->
lše_ju¡ify
 !=†ine_justify)

544 
wbox
->
lše_ju¡ify
 =†ine_justify;

545 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
wbox
));

547 
	}
}

550 
	$gtk_w¿p_box_£t_a¥eù_¿tio
 (
GtkW¿pBox
 *
wbox
,

551 
gæßt
 
a¥eù_¿tio
)

553 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

555 
a¥eù_¿tio
 = 
	`CLAMP
 (aspect_ratio, 1.0 / 256.0, 256.0);

557 ià(
wbox
->
a¥eù_¿tio
 !=‡spect_ratio)

559 
wbox
->
a¥eù_¿tio
 =‡spect_ratio;

560 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
wbox
));

562 
	}
}

565 
	$gtk_w¿p_box_·ck
 (
GtkW¿pBox
 *
wbox
,

566 
GtkWidg‘
 *
chd
,

567 
gboŞ—n
 
hex·nd
,

568 
gboŞ—n
 
hfl
,

569 
gboŞ—n
 
vex·nd
,

570 
gboŞ—n
 
vfl
)

572 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

573 
	`g_»tuº_if_ç
 (
	`GTK_IS_WIDGET
 (
chd
));

574 
	`g_»tuº_if_ç
 (
chd
->
·»Á
 =ğ
NULL
);

576 
	`gtk_w¿p_box_·ck_w¿µed
 (
wbox
, 
chd
, 
hex·nd
, 
hfl
, 
vex·nd
, 
vfl
, 
FALSE
);

577 
	}
}

580 
	$gtk_w¿p_box_·ck_w¿µed
 (
GtkW¿pBox
 *
wbox
,

581 
GtkWidg‘
 *
chd
,

582 
gboŞ—n
 
hex·nd
,

583 
gboŞ—n
 
hfl
,

584 
gboŞ—n
 
vex·nd
,

585 
gboŞ—n
 
vfl
,

586 
gboŞ—n
 
w¿µed
)

588 
GtkW¿pBoxChd
 *
chd_šfo
;

590 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

591 
	`g_»tuº_if_ç
 (
	`GTK_IS_WIDGET
 (
chd
));

592 
	`g_»tuº_if_ç
 (
chd
->
·»Á
 =ğ
NULL
);

594 #ià
	`GLIB_CHECK_VERSION
(2,10,0)

595 
chd_šfo
 = 
	`g_¦iû_Ãw
 (
GtkW¿pBoxChd
);

597 
chd_šfo
 = 
	`g_Ãw
 (
GtkW¿pBoxChd
, 1);

600 
chd_šfo
->
widg‘
 = 
chd
;

601 
chd_šfo
->
hex·nd
 = hex·nd ? 
TRUE
 : 
FALSE
;

602 
chd_šfo
->
hfl
 = hfÈ? 
TRUE
 : 
FALSE
;

603 
chd_šfo
->
vex·nd
 = vex·nd ? 
TRUE
 : 
FALSE
;

604 
chd_šfo
->
vfl
 = vfÈ? 
TRUE
 : 
FALSE
;

605 
chd_šfo
->
w¿µed
 = w¿µed ? 
TRUE
 : 
FALSE
;

606 
chd_šfo
->
Ãxt
 = 
NULL
;

607 ià(
wbox
->
chd»n
)

609 
GtkW¿pBoxChd
 *
Ï¡
 = 
wbox
->
chd»n
;

611 
Ï¡
->
Ãxt
)

612 
Ï¡
 =†a¡->
Ãxt
;

613 
Ï¡
->
Ãxt
 = 
chd_šfo
;

616 
wbox
->
chd»n
 = 
chd_šfo
;

617 
wbox
->
n_chd»n
++;

619 
	`gtk_widg‘_£t_·»Á
 (
chd
, 
	`GTK_WIDGET
 (
wbox
));

621 ià(
	`GTK_WIDGET_REALIZED
 (
wbox
))

622 
	`gtk_widg‘_»®ize
 (
chd
);

624 ià(
	`GTK_WIDGET_VISIBLE
 (
wbox
è&& GTK_WIDGET_VISIBLE (
chd
))

626 ià(
	`GTK_WIDGET_MAPPED
 (
wbox
))

627 
	`gtk_widg‘_m­
 (
chd
);

629 
	`gtk_widg‘_queue_»size
 (
chd
);

631 
	}
}

634 
	$gtk_w¿p_box_»Üd”_chd
 (
GtkW¿pBox
 *
wbox
,

635 
GtkWidg‘
 *
chd
,

636 
gšt
 
pos™iÚ
)

638 
GtkW¿pBoxChd
 *
chd_šfo
, *
Ï¡
 = 
NULL
;

640 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

641 
	`g_»tuº_if_ç
 (
	`GTK_IS_WIDGET
 (
chd
));

643 
chd_šfo
 = 
wbox
->
chd»n
; chd_šfo; 
Ï¡
 = chd_šfo, chd_šfØğÏ¡->
Ãxt
)

644 ià(
chd_šfo
->
widg‘
 =ğ
chd
)

647 ià(
chd_šfo
 && 
wbox
->
chd»n
->
Ãxt
)

649 
GtkW¿pBoxChd
 *
tmp
;

651 ià(
Ï¡
)

652 
Ï¡
->
Ãxt
 = 
chd_šfo
->next;

654 
wbox
->
chd»n
 = 
chd_šfo
->
Ãxt
;

656 
Ï¡
 = 
NULL
;

657 
tmp
 = 
wbox
->
chd»n
;

658 
pos™iÚ
 && 
tmp
->
Ãxt
)

660 
pos™iÚ
--;

661 
Ï¡
 = 
tmp
;

662 
tmp
 = 
Ï¡
->
Ãxt
;

665 ià(
pos™iÚ
)

667 
tmp
->
Ãxt
 = 
chd_šfo
;

668 
chd_šfo
->
Ãxt
 = 
NULL
;

672 
chd_šfo
->
Ãxt
 = 
tmp
;

673 ià(
Ï¡
)

674 
Ï¡
->
Ãxt
 = 
chd_šfo
;

676 
wbox
->
chd»n
 = 
chd_šfo
;

679 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
è&& GTK_WIDGET_VISIBLE (
wbox
))

680 
	`gtk_widg‘_queue_»size
 (
chd
);

682 
	}
}

685 
	$gtk_w¿p_box_qu”y_chd_·ckšg
 (
GtkW¿pBox
 *
wbox
,

686 
GtkWidg‘
 *
chd
,

687 
gboŞ—n
 *
hex·nd
,

688 
gboŞ—n
 *
hfl
,

689 
gboŞ—n
 *
vex·nd
,

690 
gboŞ—n
 *
vfl
,

691 
gboŞ—n
 *
w¿µed
)

693 
GtkW¿pBoxChd
 *
chd_šfo
;

695 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

696 
	`g_»tuº_if_ç
 (
	`GTK_IS_WIDGET
 (
chd
));

698 
chd_šfo
 = 
wbox
->
chd»n
; chd_šfo; chd_šfØğchd_šfo->
Ãxt
)

699 ià(
chd_šfo
->
widg‘
 =ğ
chd
)

702 ià(
chd_šfo
)

704 ià(
hex·nd
)

705 *
hex·nd
 = 
chd_šfo
->hexpand;

706 ià(
hfl
)

707 *
hfl
 = 
chd_šfo
->hfill;

708 ià(
vex·nd
)

709 *
vex·nd
 = 
chd_šfo
->vexpand;

710 ià(
vfl
)

711 *
vfl
 = 
chd_šfo
->vfill;

712 ià(
w¿µed
)

713 *
w¿µed
 = 
chd_šfo
->wrapped;

715 
	}
}

718 
	$gtk_w¿p_box_£t_chd_·ckšg
 (
GtkW¿pBox
 *
wbox
,

719 
GtkWidg‘
 *
chd
,

720 
gboŞ—n
 
hex·nd
,

721 
gboŞ—n
 
hfl
,

722 
gboŞ—n
 
vex·nd
,

723 
gboŞ—n
 
vfl
,

724 
gboŞ—n
 
w¿µed
)

726 
GtkW¿pBoxChd
 *
chd_šfo
;

728 
	`g_»tuº_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
));

729 
	`g_»tuº_if_ç
 (
	`GTK_IS_WIDGET
 (
chd
));

731 
hex·nd
 = hex·nd !ğ
FALSE
;

732 
hfl
 = hfÈ!ğ
FALSE
;

733 
vex·nd
 = vex·nd !ğ
FALSE
;

734 
vfl
 = vfÈ!ğ
FALSE
;

735 
w¿µed
 = w¿µed !ğ
FALSE
;

737 
chd_šfo
 = 
wbox
->
chd»n
; chd_šfo; chd_šfØğchd_šfo->
Ãxt
)

738 ià(
chd_šfo
->
widg‘
 =ğ
chd
)

741 ià(
chd_šfo
 &&

742 (
chd_šfo
->
hex·nd
 !ğhex·nd || chd_šfo->
vex·nd
 != vexpand ||

743 
chd_šfo
->
hfl
 !ğhfÈ|| chd_šfo->
vfl
 != vfill ||

744 
chd_šfo
->
w¿µed
 != wrapped))

746 
chd_šfo
->
hex·nd
 = hexpand;

747 
chd_šfo
->
hfl
 = hfill;

748 
chd_šfo
->
vex·nd
 = vexpand;

749 
chd_šfo
->
vfl
 = vfill;

750 
chd_šfo
->
w¿µed
 = wrapped;

752 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
è&& GTK_WIDGET_VISIBLE (
wbox
))

753 
	`gtk_widg‘_queue_»size
 (
chd
);

755 
	}
}

757 
gušt
*

758 
	$gtk_w¿p_box_qu”y_lše_Ëngths
 (
GtkW¿pBox
 *
wbox
,

759 
gušt
 *
_n_lšes
)

761 
GtkW¿pBoxChd
 *
Ãxt_chd
 = 
NULL
;

762 
GtkAÎoÿtiÚ
 
¬—
, *
®loÿtiÚ
;

763 
gboŞ—n
 
ex·nd_lše
;

764 
GSLi¡
 *
¦i¡
;

765 
gušt
 
max_chd_size
, 
bÜd”
, 
n_lšes
 = 0, *
lšes
 = 
NULL
;

767 ià(
_n_lšes
)

768 *
_n_lšes
 = 0;

769 
	`g_»tuº_v®_if_ç
 (
	`GTK_IS_WRAP_BOX
 (
wbox
), 
NULL
);

771 
®loÿtiÚ
 = &
	`GTK_WIDGET
 (
wbox
)->allocation;

772 
bÜd”
 = 
	`GTK_CONTAINER
 (
wbox
)->
bÜd”_width
;

773 
¬—
.
x
 = 
®loÿtiÚ
->x + 
bÜd”
;

774 
¬—
.
y
 = 
®loÿtiÚ
->y + 
bÜd”
;

775 
¬—
.
width
 = 
	`MAX
 (1, (
gšt
è
®loÿtiÚ
->width - 
bÜd”
 * 2);

776 
¬—
.
height
 = 
	`MAX
 (1, (
gšt
è
®loÿtiÚ
->heighˆ- 
bÜd”
 * 2);

778 
Ãxt_chd
 = 
wbox
->
chd»n
;

779 
¦i¡
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`¾i¡_lše_chd»n
 (wbox,

780 &
Ãxt_chd
,

781 &
¬—
,

782 &
max_chd_size
,

783 &
ex·nd_lše
);

784 
¦i¡
)

786 
gušt
 
l
 = 
n_lšes
++;

788 
lšes
 = 
	`g_»Ãw
 (
gušt
,†šes, 
n_lšes
);

789 
lšes
[
l
] = 
	`g_¦i¡_Ëngth
 (
¦i¡
);

790 
	`g_¦i¡_ä“
 (
¦i¡
);

792 
¦i¡
 = 
	`GTK_WRAP_BOX_GET_CLASS
 (
wbox
)->
	`¾i¡_lše_chd»n
 (wbox,

793 &
Ãxt_chd
,

794 &
¬—
,

795 &
max_chd_size
,

796 &
ex·nd_lše
);

799 ià(
_n_lšes
)

800 *
_n_lšes
 = 
n_lšes
;

802  
lšes
;

803 
	}
}

806 
	$gtk_w¿p_box_m­
 (
GtkWidg‘
 *
widg‘
)

808 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widg‘
);

809 
GtkW¿pBoxChd
 *
chd
;

811 
	`GTK_WIDGET_SET_FLAGS
 (
wbox
, 
GTK_MAPPED
);

813 
chd
 = 
wbox
->
chd»n
; chd; chd = chd->
Ãxt
)

814 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
) &&

815 !
	`GTK_WIDGET_MAPPED
 (
chd
->
widg‘
))

816 
	`gtk_widg‘_m­
 (
chd
->
widg‘
);

817 
	}
}

820 
	$gtk_w¿p_box_unm­
 (
GtkWidg‘
 *
widg‘
)

822 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
widg‘
);

823 
GtkW¿pBoxChd
 *
chd
;

825 
	`GTK_WIDGET_UNSET_FLAGS
 (
wbox
, 
GTK_MAPPED
);

827 
chd
 = 
wbox
->
chd»n
; chd; chd = chd->
Ãxt
)

828 ià(
	`GTK_WIDGET_VISIBLE
 (
chd
->
widg‘
) &&

829 
	`GTK_WIDGET_MAPPED
 (
chd
->
widg‘
))

830 
	`gtk_widg‘_unm­
 (
chd
->
widg‘
);

831 
	}
}

833 
gšt


834 
	$gtk_w¿p_box_expo£
 (
GtkWidg‘
 *
widg‘
,

835 
GdkEv’tExpo£
 *
ev’t
)

837  
	`GTK_WIDGET_CLASS
 (
·»Á_şass
)->
	`expo£_ev’t
 (
widg‘
, 
ev’t
);

838 
	}
}

841 
	$gtk_w¿p_box_add
 (
GtkCÚš”
 *
cÚš”
,

842 
GtkWidg‘
 *
widg‘
)

844 
	`gtk_w¿p_box_·ck
 (
	`GTK_WRAP_BOX
 (
cÚš”
), 
widg‘
, 
FALSE
, 
TRUE
, FALSE, TRUE);

845 
	}
}

848 
	$gtk_w¿p_box_»move
 (
GtkCÚš”
 *
cÚš”
,

849 
GtkWidg‘
 *
widg‘
)

851 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
cÚš”
);

852 
GtkW¿pBoxChd
 *
chd
, *
Ï¡
 = 
NULL
;

854 
chd
 = 
wbox
->
chd»n
;

855 
chd
)

857 ià(
chd
->
widg‘
 == widget)

859 
gboŞ—n
 
was_visibË
;

861 
was_visibË
 = 
	`GTK_WIDGET_VISIBLE
 (
widg‘
);

862 
	`gtk_widg‘_uÅ¬’t
 (
widg‘
);

864 ià(
Ï¡
)

865 
Ï¡
->
Ãxt
 = 
chd
->next;

867 
wbox
->
chd»n
 = 
chd
->
Ãxt
;

868 #ià
	`GLIB_CHECK_VERSION
(2,10,0)

869 
	`g_¦iû_ä“
 (
GtkW¿pBoxChd
, 
chd
);

871 
	`g_ä“
 (
chd
);

873 
wbox
->
n_chd»n
--;

875 ià(
was_visibË
)

876 
	`gtk_widg‘_queue_»size
 (
	`GTK_WIDGET
 (
cÚš”
));

881 
Ï¡
 = 
chd
;

882 
chd
 = 
Ï¡
->
Ãxt
;

884 
	}
}

887 
	$gtk_w¿p_box_fÜ®l
 (
GtkCÚš”
 *
cÚš”
,

888 
gboŞ—n
 
šşude_š‹º®s
,

889 
GtkC®lback
 
ÿÎback
,

890 
gpoš‹r
 
ÿÎback_d©a
)

892 
GtkW¿pBox
 *
wbox
 = 
	`GTK_WRAP_BOX
 (
cÚš”
);

893 
GtkW¿pBoxChd
 *
chd
;

895 
chd
 = 
wbox
->
chd»n
;

896 
chd
)

898 
GtkWidg‘
 *
widg‘
 = 
chd
->widget;

900 
chd
 = chd->
Ãxt
;

902 
	`ÿÎback
 (
widg‘
, 
ÿÎback_d©a
);

904 
	}
}

	@O:\tool\dvs50\app\gtkwrapbox.h

23 #iâdeà
__GTK_WRAP_BOX_H__


24 
	#__GTK_WRAP_BOX_H__


	)

27 
	~<gtk/gtkcÚš”.h
>

29 
	gG_BEGIN_DECLS


33 
	#GTK_TYPE_WRAP_BOX
 (
	`gtk_w¿p_box_g‘_ty³
 ())

	)

34 
	#GTK_WRAP_BOX
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
GTK_TYPE_WRAP_BOX
, 
GtkW¿pBox
))

	)

35 
	#GTK_WRAP_BOX_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
GTK_TYPE_WRAP_BOX
, 
GtkW¿pBoxCÏss
))

	)

36 
	#GTK_IS_WRAP_BOX
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
GTK_TYPE_WRAP_BOX
))

	)

37 
	#GTK_IS_WRAP_BOX_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kÏss), 
GTK_TYPE_WRAP_BOX
))

	)

38 
	#GTK_WRAP_BOX_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
GTK_TYPE_WRAP_BOX
, 
GtkW¿pBoxCÏss
))

	)

42 
_GtkW¿pBox
 
	tGtkW¿pBox
;

43 
_GtkW¿pBoxCÏss
 
	tGtkW¿pBoxCÏss
;

44 
_GtkW¿pBoxChd
 
	tGtkW¿pBoxChd
;

47 
	s_GtkW¿pBox


49 
GtkCÚš”
 
	mcÚš”
;

51 
gušt
 
	mhomog’eous
 : 1;

52 
gušt
 
	mju¡ify
 : 4;

53 
gušt
 
	mlše_ju¡ify
 : 4;

54 
gušt8
 
	mh¥acšg
;

55 
gušt8
 
	mv¥acšg
;

56 
gušt16
 
	mn_chd»n
;

57 
GtkW¿pBoxChd
 *
	mchd»n
;

58 
gæßt
 
	ma¥eù_¿tio
;

59 
gušt
 
	mchd_lim™
;

61 
	s_GtkW¿pBoxCÏss


63 
GtkCÚš”CÏss
 
	m·»Á_şass
;

65 
	mGSLi¡
* (*
	m¾i¡_lše_chd»n
è(
GtkW¿pBox
 *
	mwbox
,

66 
GtkW¿pBoxChd
 **
	mchd_p
,

67 
GtkAÎoÿtiÚ
 *
	m¬—
,

68 
gušt
 *
	mmax_chd_size
,

69 
gboŞ—n
 *
	mex·nd_lše
);

71 
	s_GtkW¿pBoxChd


73 
GtkWidg‘
 *
	mwidg‘
;

74 
gušt
 
	mhex·nd
 : 1;

75 
gušt
 
	mhfl
 : 1;

76 
gušt
 
	mvex·nd
 : 1;

77 
gušt
 
	mvfl
 : 1;

78 
gušt
 
	mw¿µed
 : 1;

80 
GtkW¿pBoxChd
 *
	mÃxt
;

82 
	#GTK_JUSTIFY_TOP
 
GTK_JUSTIFY_LEFT


	)

83 
	#GTK_JUSTIFY_BOTTOM
 
GTK_JUSTIFY_RIGHT


	)

87 
GTy³
 
	$gtk_w¿p_box_g‘_ty³
 (è
G_GNUC_CONST
;

88 
	`gtk_w¿p_box_£t_homog’eous
 (
GtkW¿pBox
 *
wbox
,

89 
gboŞ—n
 
homog’eous
);

90 
	`gtk_w¿p_box_£t_h¥acšg
 (
GtkW¿pBox
 *
wbox
,

91 
gušt
 
h¥acšg
);

92 
	`gtk_w¿p_box_£t_v¥acšg
 (
GtkW¿pBox
 *
wbox
,

93 
gušt
 
v¥acšg
);

94 
	`gtk_w¿p_box_£t_ju¡ify
 (
GtkW¿pBox
 *
wbox
,

95 
GtkJu¡ifiÿtiÚ
 
ju¡ify
);

96 
	`gtk_w¿p_box_£t_lše_ju¡ify
 (
GtkW¿pBox
 *
wbox
,

97 
GtkJu¡ifiÿtiÚ
 
lše_ju¡ify
);

98 
	`gtk_w¿p_box_£t_a¥eù_¿tio
 (
GtkW¿pBox
 *
wbox
,

99 
gæßt
 
a¥eù_¿tio
);

100 
	`gtk_w¿p_box_·ck
 (
GtkW¿pBox
 *
wbox
,

101 
GtkWidg‘
 *
chd
,

102 
gboŞ—n
 
hex·nd
,

103 
gboŞ—n
 
hfl
,

104 
gboŞ—n
 
vex·nd
,

105 
gboŞ—n
 
vfl
);

106 
	`gtk_w¿p_box_·ck_w¿µed
 (
GtkW¿pBox
 *
wbox
,

107 
GtkWidg‘
 *
chd
,

108 
gboŞ—n
 
hex·nd
,

109 
gboŞ—n
 
hfl
,

110 
gboŞ—n
 
vex·nd
,

111 
gboŞ—n
 
vfl
,

112 
gboŞ—n
 
w¿µed
);

113 
	`gtk_w¿p_box_»Üd”_chd
 (
GtkW¿pBox
 *
wbox
,

114 
GtkWidg‘
 *
chd
,

115 
gšt
 
pos™iÚ
);

116 
	`gtk_w¿p_box_qu”y_chd_·ckšg
 (
GtkW¿pBox
 *
wbox
,

117 
GtkWidg‘
 *
chd
,

118 
gboŞ—n
 *
hex·nd
,

119 
gboŞ—n
 *
hfl
,

120 
gboŞ—n
 *
vex·nd
,

121 
gboŞ—n
 *
vfl
,

122 
gboŞ—n
 *
w¿µed
);

123 
	`gtk_w¿p_box_£t_chd_·ckšg
 (
GtkW¿pBox
 *
wbox
,

124 
GtkWidg‘
 *
chd
,

125 
gboŞ—n
 
hex·nd
,

126 
gboŞ—n
 
hfl
,

127 
gboŞ—n
 
vex·nd
,

128 
gboŞ—n
 
vfl
,

129 
gboŞ—n
 
w¿µed
);

130 
gušt
* 
	`gtk_w¿p_box_qu”y_lše_Ëngths
 (
GtkW¿pBox
 *
wbox
,

131 
gušt
 *
n_lšes
);

134 
G_END_DECLS


	@O:\tool\dvs50\app\handle_ops.c

18 
	~<cÚfig.h
>

20 
	~"hªdË_İs.h
"

21 
	~"cŞÜ.h
"

24 
	#HANDLE_SIZE
 7

	)

26 cÚ¡ 
CŞÜ
 
	ghªdË_cŞÜ
[
NUM_HANDLE_TYPES
<<1] =

37 cÚ¡ 
CŞÜ
 
	ghªdË_cŞÜ_cÚÃùed
[
NUM_HANDLE_TYPES
<<1] =

49 
	$hªdË_d¿w
(
HªdË
 *
hªdË
, 
DDi¥Ïy
 *
ddi¥
)

51 
gboŞ—n
 
some_£Ëùed
;

52 
x
,
y
;

53 
DŸR’d””
 *
»nd””
 = 
ddi¥
->renderer;

54 
DŸIÁ”aùiveR’d””IÁ”çû
 *
œ’d””
 =

55 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
ddi¥
->
»nd””
);

56 cÚ¡ 
CŞÜ
 *
cŞÜ
;

58 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
, 
hªdË
->
pos
.
x
, hªdË->pos.
y
, &x, &y);

61 
some_£Ëùed
 = 
	`g_li¡_Ëngth
 (
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
) > 1;

63 ià(
hªdË
->
cÚÃùed_to
 !ğ
NULL
) {

64 
cŞÜ
 = &
hªdË_cŞÜ_cÚÃùed
[
hªdË
->
ty³
 + (
some_£Ëùed
 ? 
NUM_HANDLE_TYPES
 : 0)];

66 
cŞÜ
 = &
hªdË_cŞÜ
[
hªdË
->
ty³
 + (
some_£Ëùed
 ? 
NUM_HANDLE_TYPES
 : 0)];

69 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
(renderer, 0.0);

70 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

71 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

72 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_fl¡yË
Ô’d””, 
FILLSTYLE_SOLID
);

75 
œ’d””
->
	`fl_pix–_»ù
(
»nd””
,

76 
x
 - 
HANDLE_SIZE
/2 + 1,

77 
y
 - 
HANDLE_SIZE
/2 + 1,

78 
HANDLE_SIZE
-2, HANDLE_SIZE-2,

80 (
CŞÜ
 *)
cŞÜ
);

82 
œ’d””
->
	`d¿w_pix–_»ù
(
»nd””
,

83 
x
 - 
HANDLE_SIZE
/2,

84 
y
 - 
HANDLE_SIZE
/2,

85 
HANDLE_SIZE
-1, HANDLE_SIZE-1,

86 &
cŞÜ_bÏck
);

90 ià(
hªdË
->
cÚÃù_ty³
 !ğ
HANDLE_NONCONNECTABLE
) {

91 
œ’d””
->
d¿w_pix–_lše


92 (
»nd””
,

93 
x
 - 
HANDLE_SIZE
/2, 
y
 - HANDLE_SIZE/2,

94 
x
 + 
HANDLE_SIZE
/2, 
y
 + HANDLE_SIZE/2,

95 &
cŞÜ_bÏck
);

96 
œ’d””
->
d¿w_pix–_lše


97 (
»nd””
,

98 
x
 - 
HANDLE_SIZE
/2, 
y
 + HANDLE_SIZE/2,

99 
x
 + 
HANDLE_SIZE
/2, 
y
 - HANDLE_SIZE/2,

100 &
cŞÜ_bÏck
);

102 
	}
}

105 
	$hªdË_add_upd©e
(
HªdË
 *
hªdË
, 
DŸg¿m
 *
dŸ
)

107 
	`dŸg¿m_add_upd©e_pix–s
(
dŸ
, &
hªdË
->
pos
,

108 
HANDLE_SIZE
, HANDLE_SIZE);

109 
	}
}

113 
	$hªdË_is_şicked
(
DDi¥Ïy
 *
ddi¥
, 
HªdË
 *
hªdË
, 
Pošt
 *
pos
)

115 
»®
 
dx
, 
dy
;

116 
idx
, 
idy
;

118 ià(
hªdË
==
NULL
)

119  
FALSE
;

121 
dx
 = 
	`ABS
(
hªdË
->
pos
.
x
 -…os->x);

122 
dy
 = 
	`ABS
(
hªdË
->
pos
.
y
 -…os->y);

124 
idx
 = 
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
, 
dx
);

125 
idy
 = 
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
, 
dy
);

127  (
idx
<(
HANDLE_SIZE
+1)/2è&& (
idy
<(HANDLE_SIZE+1)/2);

128 
	}
}

	@O:\tool\dvs50\app\handle_ops.h

18 #iâdeà
HANDLE_OPS_H


19 
	#HANDLE_OPS_H


	)

21 
	~"hªdË.h
"

22 
	~"di¥Ïy.h
"

24 
hªdË_d¿w
(
HªdË
 *
hªdË
, 
DDi¥Ïy
 *
ddi¥
);

25 
hªdË_add_upd©e
(
HªdË
 *
hªdË
, 
DŸg¿m
 *
dŸ
);

26 
hªdË_is_şicked
(
DDi¥Ïy
 *
ddi¥
, 
HªdË
 *
hªdË
, 
Pošt
 *
pos
);

	@O:\tool\dvs50\app\highlight.c

19 
	~"highlight.h
"

21 
	~"glib.h
"

23 
	~"dŸg¿m.h
"

24 
	~"dŸg¿md©a.h
"

25 
	~"objeù.h
"

26 
	~"objeù_İs.h
"

27 
	~"group.h
"

43 
CŞÜ
 
	g»d
 = { 1.0, 0.0, 0.0 };

46 
	$highlight_objeù
(
DŸObjeù
 *
obj
, 
CŞÜ
 *
cŞ
, 
DŸg¿m
 *
dŸ
)

48 ià(
cŞ
)

49 
obj
->
highlight_cŞÜ
 = 
cŞ
;

51 
obj
->
highlight_cŞÜ
 = &
»d
;

53 
	`objeù_add_upd©es
(
obj
, 
dŸ
);

54 
	}
}

57 
	$highlight_objeù_off
(
DŸObjeù
 *
obj
, 
DŸg¿m
 *
dŸ
)

59 ià(
obj
->
highlight_cŞÜ
 !ğ
NULL
) {

61 
	`objeù_add_upd©es
(
obj
, 
dŸ
);

62 
obj
->
highlight_cŞÜ
 = 
NULL
;

64 
	}
}

70 
	$highlight_»£t_objeùs
(
GLi¡
 *
objeùs
, 
DŸg¿m
 *
dŸ
)

72 ; 
objeùs
 !ğ
NULL
; objeù ğ
	`g_li¡_Ãxt
(objects)) {

73 
DŸObjeù
 *
objeù
 = (DŸObjeù*)
objeùs
->
d©a
;

74 
	`highlight_objeù_off
(
objeù
, 
dŸ
);

75 ià(
	`IS_GROUP
(
objeù
)) {

76 
	`highlight_»£t_objeùs
(
	`group_objeùs
(
objeù
), 
dŸ
);

79 
	}
}

88 
	$highlight_»£t_®l
(
DŸg¿m
 *
dŸ
) {

89 
i
;

90 
i
 = 0; i < 
dŸ
->
d©a
->
Ïy”s
->
Ën
; i++) {

91 
	`highlight_»£t_objeùs
(((
Lay”
*)
	`g_±r_¬¿y_šdex
(
dŸ
->
d©a
->
Ïy”s
, 
i
))->
objeùs
, dia);

93 
	}
}

	@O:\tool\dvs50\app\highlight.h

18 #iâdeà
HIGHLIGHT_H


19 
	#HIGHLIGHT_H


	)

21 
	~"glib.h
"

23 
	~"dŸty³s.h
"

24 
	~"dŸg¿m.h
"

25 
	~"cŞÜ.h
"

34 
highlight_objeù
(
DŸObjeù
 *
obj
, 
CŞÜ
 *
cŞ
, 
DŸg¿m
 *
dŸ
);

37 
highlight_objeù_off
(
DŸObjeù
 *
obj
, 
DŸg¿m
 *
dŸ
);

39 
highlight_»£t_®l
(
DŸg¿m
 *
dŸ
);

	@O:\tool\dvs50\app\interface.c

19 
	~<cÚfig.h
>

21 #ifdeà
GNOME


22 #undeà
GTK_DISABLE_DEPRECATED


23 
	~<gnome.h
>

25 #undeà
GTK_DISABLE_DEPRECATED


26 
	~<gtk/gtk.h
>

28 
	~"gtkw¿pbox.h
"

29 
	~"gtkhw¿pbox.h
"

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

34 
	~"dŸg¿m.h
"

35 
	~"objeù.h
"

36 
	~"Ïy”_dŸlog.h
"

37 
	~"š‹rçû.h
"

38 
	~"di¥Ïy.h
"

39 
	~"´eã»nûs.h
"

40 
	~"commªds.h
"

41 
	~"dŸ_dœs.h
"

42 
	~"dŸg¿m_Œ“_wšdow.h
"

43 
	~"š.h
"

44 
	~"Çvig©iÚ.h
"

45 
	~"³rsi¡’û.h
"

46 
	~"dŸ¬rowchoo£r.h
"

47 
	~"dŸlšechoo£r.h
"

48 
	~"widg‘s.h
"

49 
	~"mes§ge.h
"

51 
	~<gdk-pixbuf/gdk-pixbuf.h
>

52 
	~"dŸ-­p-icÚs.h
"

53 
	~"dŸÿnvas.h
"

55 
	~"pixm­s/sw­.xpm
"

56 
	~"pixm­s/deçuÉ.xpm
"

57 
	~"pixm­s/missšg.xpm
"

63 
	mDIA_DND_TYPE_URI_LIST
,

64 
	mDIA_DND_TYPE_TEXT_PLAIN
,

67 
GtkT¬g‘EÁry
 
	gtoŞbox_rg‘_bË
[] =

69 { "‹xt/uri-li¡", 0, 
DIA_DND_TYPE_URI_LIST
 },

70 { "‹xt/¶aš", 0, 
DIA_DND_TYPE_TEXT_PLAIN
 }

73 
gušt
 
	gtoŞbox_n_rg‘s
 = ( (
toŞbox_rg‘_bË
) /

74  (
toŞbox_rg‘_bË
[0]));

77 
u£_š‹g¿‹d_ui_fÜ_di¥Ïy_sh–l
(
DDi¥Ïy
 *
ddi¥
, *
t™Ë
);

80 
	$dŸ_dnd_fe_d¿g_d©a_»ûived
 (
GtkWidg‘
 *
widg‘
,

81 
GdkD¿gCÚ‹xt
 *
cÚ‹xt
,

82 
gšt
 
x
,

83 
gšt
 
y
,

84 
GtkS–eùiÚD©a
 *
d©a
,

85 
gušt
 
šfo
,

86 
gušt
 
time
,

87 
DDi¥Ïy
 *
ddi¥
)

89 
cÚ‹xt
->
aùiÚ
)

91 
GDK_ACTION_DEFAULT
:

92 
GDK_ACTION_COPY
:

93 
GDK_ACTION_MOVE
:

94 
GDK_ACTION_LINK
:

95 
GDK_ACTION_ASK
:

98 
DŸg¿m
 *
dŸg¿m
 = 
NULL
;

99 
gch¬
 *
sP©h
 = 
NULL
, *
pFrom
, *
pTo
;

101 
pFrom
 = 
	`¡r¡r
((
gch¬
 *è
d©a
->data, "file:");

102 
pFrom
) {

103 
GE¼Ü
 *
”rÜ
 = 
NULL
;

105 
pTo
 = 
pFrom
;

106 *
pTo
 != 0 && *pTo != 0xd && *pTo != 0xa)…To ++;

107 
sP©h
 = 
	`g_¡ºdup
(
pFrom
, 
pTo
 -…From);

110 
pFrom
 = 
	`g_f’ame_äom_uri
 (
sP©h
, 
NULL
, &
”rÜ
);

111 ià(!
ddi¥
)

112 
dŸg¿m
 = 
	`dŸg¿m_lßd
 (
pFrom
, 
NULL
);

114 
dŸg¿m
 = 
ddi¥
->diagram;

115 ià(!
	`dŸg¿m_lßd_što
 (
dŸg¿m
, 
pFrom
, 
NULL
)) {

117 
	`gtk_d¿g_fšish
 (
cÚ‹xt
, 
TRUE
, 
FALSE
, 
time
);

122 
	`g_ä“
 (
pFrom
);

123 
	`g_ä“
(
sP©h
);

125 ià(
dŸg¿m
 !ğ
NULL
) {

126 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸg¿m
);

127 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸg¿m
);

129 ià(
dŸg¿m
->
di¥Ïys
 =ğ
NULL
) {

130 
	`Ãw_di¥Ïy
(
dŸg¿m
);

134 
pFrom
 = 
	`¡r¡r
(
pTo
, "file:");

136 
	`gtk_d¿g_fšish
 (
cÚ‹xt
, 
TRUE
, 
FALSE
, 
time
);

141 
	}
}

143 cÚ¡ 
GtkT¬g‘EÁry
 
	gdi¥Ïy_rg‘_bË
[] = {

145 { "‹xt/uri-li¡", 0, 
DIA_DND_TYPE_URI_LIST
 },

146 { "‹xt/¶aš", 0, 
DIA_DND_TYPE_TEXT_PLAIN
 }

148 
	gdi¥Ïy_n_rg‘s
 = (
di¥Ïy_rg‘_bË
)/(display_target_table[0]);

150 
ToŞBu‰Ú
 
	gtoŞ_d©a
[] =

152 { (**è
dŸ_modify_toŞ_icÚ
,

153 
N_
("Modify object(s)\nUse <Space>ooggle betweenhis‡nd otherools"),

154 
NULL
,

156 { 
MODIFY_TOOL
, 
NULL
, NULL}

158 { (**è
dŸ_‹x‹d™_toŞ_icÚ
,

159 
N_
("Textƒdit(s)\nUse <Esc>o†eavehisool"),

162 { 
TEXTEDIT_TOOL
, 
NULL
, NULL}

164 { (**è
dŸ_zoom_toŞ_icÚ
,

165 
N_
("Magnify"),

168 { 
MAGNIFY_TOOL
, 
NULL
, NULL}

170 { (**è
dŸ_süŞl_toŞ_icÚ
,

171 
N_
("Scroll‡roundhe diagram"),

174 { 
SCROLL_TOOL
, 
NULL
, NULL}

252 
	#NUM_TOOLS
 ( (
toŞ_d©a
è/  (
ToŞBu‰Ú
))

	)

253 cÚ¡ 
	gnum_toŞs
 = 
NUM_TOOLS
;

255 
	#COLUMNS
 4

	)

256 
	#ROWS
 3

	)

258 
GtkWidg‘
 *
	gtoŞbox_sh–l
 = 
NULL
;

259 
GtkWidg‘
 *
	gdŸg¿mŒ“
 = 
NULL
;

260 
GtkWidg‘
 *
	gtoŞ_widg‘s
[
NUM_TOOLS
];

264 
GtkWšdow
 * 
	mmaš_wšdow
;

265 
GtkToŞb¬
 * 
	mtoŞb¬
;

266 
GtkNÙebook
 * 
	mdŸg¿m_nÙebook
;

267 
GtkStusb¬
 * 
	m¡©usb¬
;

268 
GtkWidg‘
 * 
	mÏy”_v›w
;

269 } 
	gui
;

271  
GtkToŞts
 *
	gtoŞ_ts
;

272 
GSLi¡
 *
	gtoŞ_group
 = 
NULL
;

274 
GtkWidg‘
 *
	gmodify_toŞ_bu‰Ú
;

282 
	$is_š‹g¿‹d_ui
 ()

284  
ui
.
maš_wšdow
 =ğ
NULL
? 0 : 1;

285 
	}
}

288 
	$grid_toggË_¢­
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

290 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
d©a
;

291 
	`ddi¥Ïy_£t_¢­_to_grid
(
ddi¥
,

292 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
widg‘
)));

293 
	}
}

296 
	$š‹rçû_toggË_mašpošt_magÃtism
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

298 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
d©a
;

299 
	`ddi¥Ïy_£t_¢­_to_objeùs
(
ddi¥
,

300 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
widg‘
)));

301 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

302 
	`ddi¥Ïy_æush
(
ddi¥
);

303 
	}
}

305 
gšt


306 
	$Üigš_bu‰Ú_´ess
(
GtkWidg‘
 *
widg‘
, 
GdkEv’tBu‰Ú
 *
ev’t
, 
gpoš‹r
 
d©a
)

308 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
d©a
;

310 
	`di¥Ïy_£t_aùive
(
ddi¥
);

311 
	`ddi¥Ïy_pİup_m’u
(
ddi¥
, 
ev’t
);

315 
	`gtk_sigÇl_em™_¡İ_by_Çme
(
	`GTK_OBJECT
(
widg‘
), "button_press_event");

317  
FALSE
;

318 
	}
}

321 
	$v›w_zoom_£t
 (
çùÜ
)

323 
DDi¥Ïy
 *
ddi¥
;

324 
»®
 
sÿË
;

325 
Pošt
 
middË
;

326 
ReùªgË
 *
visibË
;

328 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

329 ià(!
ddi¥
) ;

331 
visibË
 = &
ddi¥
->visible;

332 
middË
.
x
 = 
visibË
->
Ëá
*0.5 + visibË->
right
*0.5;

333 
middË
.
y
 = 
visibË
->
tİ
*0.5 + visibË->
bÙtom
*0.5;

335 
sÿË
 = ((
»®
è
çùÜ
)/1000.0 * 
DDISPLAY_NORMAL_ZOOM
;

337 
	`ddi¥Ïy_zoom
(
ddi¥
, &
middË
, 
sÿË
 / ddi¥->
zoom_çùÜ
);

338 
	}
}

341 
	$zoom_aùiv©e_ÿÎback
(
GtkWidg‘
 *
™em
, 
gpoš‹r
 
u£r_d©a
)

343 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
u£r_d©a
;

344 cÚ¡ 
gch¬
 *
zoom_‹xt
 =

345 
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
	`gtk_objeù_g‘_u£r_d©a
(
	`GTK_OBJECT
(
ddi¥
->
zoom_¡©us
))));

346 
zoom_amouÁ
, 
magnify
;

347 
gch¬
 *
zoomamouÁ
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
™em
), "zoomamount");

348 ià(
zoomamouÁ
 !ğ
NULL
) {

349 
zoom_‹xt
 = 
zoomamouÁ
;

352 ià(
	`ssÿnf
(
zoom_‹xt
, "%f", &
zoom_amouÁ
) == 1) {

353 
Pošt
 
middË
;

354 
ReùªgË
 *
visibË
;

357 ià(
zoom_amouÁ
 < .1) {

358 
zoom_amouÁ
 = .1;

359 } ià(
zoom_amouÁ
 > 1e4) {

360 
zoom_amouÁ
 = 1e4;

362 
zoomamouÁ
 = 
	`g_¡rdup_´štf
("%f%%\n", 
zoom_amouÁ
);

363 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
	`gtk_objeù_g‘_u£r_d©a
(
	`GTK_OBJECT
(
ddi¥
->
zoom_¡©us
))), 
zoomamouÁ
);

364 
	`g_ä“
(
zoomamouÁ
);

365 
magnify
 = (
zoom_amouÁ
*
DDISPLAY_NORMAL_ZOOM
/100.0)/
ddi¥
->
zoom_çùÜ
;

366 ià(
	`çbs
(
magnify
 - 1.0) > 0.000001) {

367 
visibË
 = &
ddi¥
->visible;

368 
middË
.
x
 = 
visibË
->
Ëá
*0.5 + visibË->
right
*0.5;

369 
middË
.
y
 = 
visibË
->
tİ
*0.5 + visibË->
bÙtom
*0.5;

370 
	`ddi¥Ïy_zoom
(
ddi¥
, &
middË
, 
magnify
);

373 
	}
}

376 
	$zoom_add_zoom_amouÁ
(
GtkWidg‘
 *
m’u
, 
gch¬
 *
‹xt
, 
DDi¥Ïy
 *
ddi¥
)

378 
GtkWidg‘
 *
m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
‹xt
);

379 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
m’u™em
);

380 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
m’u™em
),

381 "aùiv©e", 
	`G_CALLBACK
(
zoom_aùiv©e_ÿÎback
),

382 
ddi¥
);

383 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
m’u™em
), "zoomamouÁ", 
‹xt
);

384 
	}
}

387 
	$zoom_pİup_m’u
(
GtkWidg‘
 *
bu‰Ú
, 
GdkEv’tBu‰Ú
 *
ev’t
, 
gpoš‹r
 
u£r_d©a
) {

391 
GtkM’u
 *
m’u
 = 
	`GTK_MENU
(
u£r_d©a
);

393 
	`gtk_m’u_pİup
(
m’u
, 
NULL
, NULL, NULL, NULL,

394 
ev’t
->
bu‰Ú
,ƒv’t->
time
);

397 
	`gtk_sigÇl_em™_¡İ_by_Çme
(
	`GTK_OBJECT
(
bu‰Ú
), "button_press_event");

398 
	}
}

400 
GtkWidg‘
*

401 
	$ü—‹_zoom_widg‘
(
DDi¥Ïy
 *
ddi¥
) {

402 
GtkWidg‘
 *
combo
;

403 
GtkWidg‘
 *
’Œy
;

404 
GtkWidg‘
 *
m’u
;

405 
GtkWidg‘
 *
bu‰Ú
;

406 
GtkWidg‘
 *
¬row
;

408 
combo
 = 
	`gtk_hbox_Ãw
(
FALSE
, 0);

409 
’Œy
 = 
	`gtk_’Œy_Ãw
();

410 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
’Œy
), "activate",

411 
	`G_CALLBACK
(
zoom_aùiv©e_ÿÎback
),

412 
ddi¥
);

413 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
combo
), 
’Œy
);

414 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
(
combo
), "u£r_d©a", 
’Œy
);

415 
	`gtk_’Œy_£t_width_ch¬s
(
	`GTK_ENTRY
(
’Œy
), 8);

416 
	`gtk_widg‘_show
(
’Œy
);

418 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw
();

419 
	`GTK_WIDGET_UNSET_FLAGS
(
bu‰Ú
, 
GTK_CAN_FOCUS
);

420 
¬row
 = 
	`gtk_¬row_Ãw
(
GTK_ARROW_DOWN
, 
GTK_SHADOW_OUT
);

421 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
bu‰Ú
), 
¬row
);

422 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
combo
), 
bu‰Ú
);

423 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
(
combo
), "u£r_d©a", 
’Œy
);

424 
	`gtk_widg‘_show_®l
(
bu‰Ú
);

426 
m’u
 = 
	`gtk_m’u_Ãw
();

427 
	`zoom_add_zoom_amouÁ
(
m’u
, "800%", 
ddi¥
);

428 
	`zoom_add_zoom_amouÁ
(
m’u
, "400%", 
ddi¥
);

429 
	`zoom_add_zoom_amouÁ
(
m’u
, "200%", 
ddi¥
);

430 
	`zoom_add_zoom_amouÁ
(
m’u
, "100%", 
ddi¥
);

431 
	`zoom_add_zoom_amouÁ
(
m’u
, "50%", 
ddi¥
);

432 
	`zoom_add_zoom_amouÁ
(
m’u
, "25%", 
ddi¥
);

433 
	`zoom_add_zoom_amouÁ
(
m’u
, "12%", 
ddi¥
);

435 
	`gtk_widg‘_show_®l
(
m’u
);

437 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú
), "button_press_event",

438 
	`G_CALLBACK
(
zoom_pİup_m’u
),

439 
m’u
);

441  
combo
;

442 
	}
}

444 
gboŞ—n


445 
	$di¥Ïy_drİ_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
GdkD¿gCÚ‹xt
 *
cÚ‹xt
,

446 
gšt
 
x
, gšˆ
y
, 
gušt
 
time
)

448 ià(
	`gtk_d¿g_g‘_sourû_widg‘
(
cÚ‹xt
è!ğ
NULL
) {

451  
TRUE
;

453 
	`gtk_d¿g_fšish
 (
cÚ‹xt
, 
FALSE
, FALSE, 
time
);

454  
FALSE
;

455 
	}
}

458 
	$di¥Ïy_d©a_»ûived_ÿÎback
 (
GtkWidg‘
 *
widg‘
,

459 
GdkD¿gCÚ‹xt
 *
cÚ‹xt
,

460 
gšt
 
x
,

461 
gšt
 
y
,

462 
GtkS–eùiÚD©a
 *
d©a
,

463 
gušt
 
šfo
,

464 
gušt
 
time
,

465 
DDi¥Ïy
 *
ddi¥
)

467 ià(
d©a
->
fÜm©
 =ğ8 && d©a->
Ëngth
 =ğ(
ToŞBu‰ÚD©a
 *) &&

468 
	`gtk_d¿g_g‘_sourû_widg‘
(
cÚ‹xt
è!ğ
NULL
) {

469 
ToŞBu‰ÚD©a
 *
toŞd©a
 = *(ToŞBu‰ÚD©¨**)
d©a
->data;

472 
	`ddi¥Ïy_drİ_objeù
(
ddi¥
, 
x
, 
y
,

473 
	`objeù_g‘_ty³
((
gch¬
 *)
toŞd©a
->
exŒa_d©a
),

474 
toŞd©a
->
u£r_d©a
);

476 
	`gtk_d¿g_fšish
 (
cÚ‹xt
, 
TRUE
, 
FALSE
, 
time
);

478 
	`dŸ_dnd_fe_d¿g_d©a_»ûived
 (
widg‘
, 
cÚ‹xt
, 
x
, 
y
, 
d©a
, 
šfo
, 
time
, 
ddi¥
);

479 
	}
}

486 
	$şo£_nÙebook_·ge_ÿÎback
 (
GtkBu‰Ú
 *
bu‰Ú
,

487 
gpoš‹r
 
u£r_d©a
)

489 
GtkBox
 *
·ge
 = 
u£r_d©a
;

490 
DDi¥Ïy
 *
ddi¥
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
·ge
), "DDisplay");

493 
	`ddi¥Ïy_şo£
 (
ddi¥
);

494 
	}
}

501 
	$u£_š‹g¿‹d_ui_fÜ_di¥Ïy_sh–l
(
DDi¥Ïy
 *
ddi¥
, *
t™Ë
)

503 
GtkWidg‘
 *
bË
;

504 
GtkWidg‘
 *
Çvig©iÚ_bu‰Ú
;

507 
GtkWidg‘
 *
Ïb–
;

508 
GtkWidg‘
 *
b_Ïb–_cÚš”
;

509 
width
, 
height
;

510 
GtkWidg‘
 *
image
;

511 
GtkWidg‘
 *
şo£_bu‰Ú
;

513 
GtkRcStyË
 *
rc¡yË
;

514 
gšt
 
nÙebook_·ge_šdex
;

516 
ddi¥
->
is_¡ªd®Úe_wšdow
 = 
FALSE
;

518 
ddi¥
->
sh–l
 = 
	`GTK_WIDGET
 (
ui
.
maš_wšdow
);

521 
ddi¥
->
modif›d_¡©us
 = 
	`GTK_WIDGET
 (
ui
.
¡©usb¬
);

523 
b_Ïb–_cÚš”
 = 
	`gtk_hbox_Ãw
(
FALSE
,3);

525 
Ïb–
 = 
	`gtk_Ïb–_Ãw
Ğ
t™Ë
 );

526 
	`gtk_box_·ck_¡¬t
Ğ
	`GTK_BOX
(
b_Ïb–_cÚš”
), 
Ïb–
, 
FALSE
, FALSE, 0 );

527 
	`gtk_widg‘_show
 (
Ïb–
);

530 
ddi¥
->
cÚš”
 = 
	`gtk_vbox_Ãw
(
FALSE
, 0);

533 
ddi¥
->
cÚš”
 = 
	`gtk_vbox_Ãw
(
FALSE
, 0);

537 
şo£_bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw
();

538 
	`gtk_bu‰Ú_£t_»l›f
 (
	`GTK_BUTTON
 (
şo£_bu‰Ú
), 
GTK_RELIEF_NONE
);

539 
	`gtk_bu‰Ú_£t_focus_Ú_şick
 (
	`GTK_BUTTON
 (
şo£_bu‰Ú
), 
FALSE
);

542 
rc¡yË
 = 
	`gtk_rc_¡yË_Ãw
 ();

543 
rc¡yË
->
xthickÃss
 =„c¡yË->
ythickÃss
 = 0;

544 
	`gtk_widg‘_modify_¡yË
 (
şo£_bu‰Ú
, 
rc¡yË
);

545 
	`gtk_rc_¡yË_uÄef
 (
rc¡yË
),

547 
image
 = 
	`gtk_image_Ãw_äom_¡ock
 (
GTK_STOCK_CLOSE
,

548 
GTK_ICON_SIZE_MENU
);

550 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
(
şo£_bu‰Ú
), 
image
);

551 
	`gtk_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
şo£_bu‰Ú
), "clicked",

552 
	`GTK_SIGNAL_FUNC
 (
şo£_nÙebook_·ge_ÿÎback
), 
ddi¥
->
cÚš”
);

555 
	`gtk_box_·ck_¡¬t
Ğ
	`GTK_BOX
(
b_Ïb–_cÚš”
), 
şo£_bu‰Ú
, 
FALSE
, FALSE, 0 );

556 
	`gtk_widg‘_show
 (
şo£_bu‰Ú
);

557 
	`gtk_widg‘_show
 (
image
);

560 
	`gtk_widg‘_£t_ev’ts
 (
ddi¥
->
cÚš”
,

561 
GDK_POINTER_MOTION_MASK
 |

562 
GDK_POINTER_MOTION_HINT_MASK
 |

563 
GDK_FOCUS_CHANGE_MASK
);

565 
nÙebook_·ge_šdex
 = 
	`gtk_nÙebook_­³nd_·ge
 (
	`GTK_NOTEBOOK
(
ui
.
dŸg¿m_nÙebook
),

566 
ddi¥
->
cÚš”
,

567 
b_Ïb–_cÚš”
);

569 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
ddi¥
->
cÚš”
), "DDisplay", ddisp);

570 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
ddi¥
->
cÚš”
), "b-Ïb–", 
Ïb–
);

571 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
ddi¥
->
cÚš”
), "wšdow", 
ui
.
maš_wšdow
);

574 
bË
 = 
	`gtk_bË_Ãw
 (3, 3, 
FALSE
);

575 
	`gtk_bË_£t_cŞ_¥acšg
 (
	`GTK_TABLE
 (
bË
), 0, 1);

576 
	`gtk_bË_£t_cŞ_¥acšg
 (
	`GTK_TABLE
 (
bË
), 1, 2);

577 
	`gtk_bË_£t_row_¥acšg
 (
	`GTK_TABLE
 (
bË
), 0, 1);

578 
	`gtk_bË_£t_row_¥acšg
 (
	`GTK_TABLE
 (
bË
), 1, 2);

579 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
bË
), 2);

581 
	`gtk_box_·ck_¡¬t
Ğ
	`GTK_BOX
(
ddi¥
->
cÚš”
), 
bË
, 
TRUE
, TRUE, 0 );

584 
ddi¥
->
Üigš
 = 
	`gtk_äame_Ãw
 (
NULL
);

585 
	`gtk_äame_£t_shadow_ty³
 (
	`GTK_FRAME
 (
ddi¥
->
Üigš
), 
GTK_SHADOW_OUT
);

587 
ddi¥
->
hruË
 = 
	`gtk_hruËr_Ãw
 ();

588 
	`g_sigÇl_cÚÃù_sw­³d
 (
	`GTK_OBJECT
 (
ddi¥
->
cÚš”
), "motion_notify_event",

589 
	`G_CALLBACK
(
	`GTK_WIDGET_GET_CLASS
 (
ddi¥
->
hruË
)->
mÙiÚ_nÙify_ev’t
),

590 
	`GTK_OBJECT
 (
ddi¥
->
hruË
));

592 
ddi¥
->
vruË
 = 
	`gtk_vruËr_Ãw
 ();

593 
	`g_sigÇl_cÚÃù_sw­³d
 (
	`GTK_OBJECT
 (
ddi¥
->
cÚš”
), "motion_notify_event",

594 
	`G_CALLBACK
(
	`GTK_WIDGET_GET_CLASS
 (
ddi¥
->
vruË
)->
mÙiÚ_nÙify_ev’t
),

595 
	`GTK_OBJECT
 (
ddi¥
->
vruË
));

599 
width
 = 100;

600 
height
 = 100;

603 
ddi¥
->
hsbd©a
 = 
	`GTK_ADJUSTMENT
 (
	`gtk_adju¡m’t_Ãw
 (0, 0, 
width
, 1, (width-1)/4, width-1));

604 
ddi¥
->
vsbd©a
 = 
	`GTK_ADJUSTMENT
 (
	`gtk_adju¡m’t_Ãw
 (0, 0, 
height
, 1, (height-1)/4, height-1));

606 
ddi¥
->
hsb
 = 
	`gtk_hsüŞlb¬_Ãw
 (ddi¥->
hsbd©a
);

607 
	`GTK_WIDGET_UNSET_FLAGS
 (
ddi¥
->
hsb
, 
GTK_CAN_FOCUS
);

608 
ddi¥
->
vsb
 = 
	`gtk_vsüŞlb¬_Ãw
 (ddi¥->
vsbd©a
);

609 
	`GTK_WIDGET_UNSET_FLAGS
 (
ddi¥
->
vsb
, 
GTK_CAN_FOCUS
);

612 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
hsbd©a
), "value_changed",

613 
	`G_CALLBACK
(
ddi¥Ïy_hsb_upd©e
),

614 
ddi¥
);

615 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
vsbd©a
), "value_changed",

616 
	`G_CALLBACK
(
ddi¥Ïy_vsb_upd©e
),

617 
ddi¥
);

620 
Çvig©iÚ_bu‰Ú
 = 
	`Çvig©iÚ_pİup_Ãw
(
ddi¥
);

621 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
Çvig©iÚ_bu‰Ú
,

622 
	`_
("Pİ u°thNavig©iÚ wšdow."), 
NULL
);

623 
	`gtk_widg‘_show
(
Çvig©iÚ_bu‰Ú
);

626 
ddi¥
->
ÿnvas
 = 
	`dŸ_ÿnvas_Ãw
();

629 
	`gtk_widg‘_£t_doubË_bufã»d
 (
ddi¥
->
ÿnvas
, 
FALSE
);

631 
	`gtk_widg‘_£t_ev’ts
 (
ddi¥
->
ÿnvas
, 
CANVAS_EVENT_MASK
);

632 
	`GTK_WIDGET_SET_FLAGS
 (
ddi¥
->
ÿnvas
, 
GTK_CAN_FOCUS
);

633 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
ÿnvas
), "event",

634 
	`G_CALLBACK
(
ddi¥Ïy_ÿnvas_ev’ts
),

635 
ddi¥
);

637 
	`gtk_d¿g_de¡_£t
(
ddi¥
->
ÿnvas
, 
GTK_DEST_DEFAULT_ALL
,

638 
di¥Ïy_rg‘_bË
, 
di¥Ïy_n_rg‘s
, 
GDK_ACTION_COPY
);

639 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
ÿnvas
), "drag_drop",

640 
	`G_CALLBACK
(
di¥Ïy_drİ_ÿÎback
), 
NULL
);

641 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
ÿnvas
), "drag_data_received",

642 
	`G_CALLBACK
(
di¥Ïy_d©a_»ûived_ÿÎback
), 
ddi¥
);

645 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
Üigš
, 0, 1, 0, 1,

646 
GTK_FILL
, GTK_FILL, 0, 0);

647 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
hruË
, 1, 2, 0, 1,

648 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, GTK_FILL, 0, 0);

649 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
vruË
, 0, 1, 1, 2,

650 
GTK_FILL
, 
GTK_EXPAND
 | 
GTK_SHRINK
 | GTK_FILL, 0, 0);

651 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
ÿnvas
, 1, 2, 1, 2,

652 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
,

653 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, 0, 0);

654 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
hsb
, 0, 2, 2, 3,

655 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, GTK_FILL, 0, 0);

656 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
vsb
, 2, 3, 0, 2,

657 
GTK_FILL
, 
GTK_EXPAND
 | 
GTK_SHRINK
 | GTK_FILL, 0, 0);

658 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
Çvig©iÚ_bu‰Ú
, 2, 3, 2, 3,

659 
GTK_FILL
, GTK_FILL, 0, 0);

661 
ddi¥
->
commÚ_toŞb¬
 = 
ui
.
toŞb¬
;

664 
ddi¥
->
m’u_b¬
 = 
NULL
;

667 
ddi¥
->
zoom_¡©us
 = 
NULL
;

670 
ddi¥
->
grid_¡©us
 = 
NULL
;

673 
ddi¥
->
mašpošt_¡©us
 = 
NULL
;

675 
	`gtk_widg‘_show
 (
ddi¥
->
cÚš”
);

676 
	`gtk_widg‘_show
 (
bË
);

677 
	`gtk_widg‘_show
 (
ddi¥
->
hsb
);

678 
	`gtk_widg‘_show
 (
ddi¥
->
vsb
);

679 
	`di¥Ïy_ruËrs_show
 (
ddi¥
);

680 
	`gtk_widg‘_show
 (
ddi¥
->
ÿnvas
);

683 
	`gtk_nÙebook_£t_cu¼’t_·ge
 (
ui
.
dŸg¿m_nÙebook
, 
nÙebook_·ge_šdex
);

685 
	`š‹g¿‹d_ui_toŞb¬_grid_¢­_synchrÚize_to_di¥Ïy
 (
ddi¥
);

687 
	`š‹g¿‹d_ui_toŞb¬_objeù_¢­_synchrÚize_to_di¥Ïy
 (
ddi¥
);

694 
	`ddi¥Ïy_£t_»nd””
(
ddi¥
, ddi¥->
¯_»nd””
);

697 
	`gtk_widg‘_g¿b_focus
 (
ddi¥
->
ÿnvas
);

698 
	}
}

709 
	$ü—‹_di¥Ïy_sh–l
(
DDi¥Ïy
 *
ddi¥
,

710 
width
, 
height
,

711 *
t™Ë
, 
u£_mb¬
, 
tİ_Ëv–_wšdow
)

713 
GtkWidg‘
 *
bË
, *
widg‘
;

714 
GtkWidg‘
 *
Çvig©iÚ_bu‰Ú
;

715 
GtkWidg‘
 *
¡©us_hbox
;

716 
GtkWidg‘
 *
roÙ_vbox
 = 
NULL
;

717 
GtkWidg‘
 *
zoom_hbox
, *
zoom_Ïb–
;

718 
s_width
, 
s_height
;

720 ià(
	`­p_is_š‹¿ùive
(è&& 
	`is_š‹g¿‹d_ui
())

722 
	`u£_š‹g¿‹d_ui_fÜ_di¥Ïy_sh–l
(
ddi¥
, 
t™Ë
);

726 
ddi¥
->
is_¡ªd®Úe_wšdow
 = 
TRUE
;

727 
ddi¥
->
cÚš”
 = 
NULL
;

730 ià(!
toŞ_ts
)

731 
toŞ_ts
 = 
	`gtk_toŞts_Ãw
 ();

733 
s_width
 = 
	`gdk_sü“n_width
 ();

734 
s_height
 = 
	`gdk_sü“n_height
 ();

735 ià(
width
 > 
s_width
)

736 
width
 = 
s_width
;

737 ià(
height
 > 
s_height
)

738 
height
 = 
s_height
;

741 
ddi¥
->
hsbd©a
 = 
	`GTK_ADJUSTMENT
 (
	`gtk_adju¡m’t_Ãw
 (0, 0, 
width
, 1, (width-1)/4, width-1));

742 
ddi¥
->
vsbd©a
 = 
	`GTK_ADJUSTMENT
 (
	`gtk_adju¡m’t_Ãw
 (0, 0, 
height
, 1, (height-1)/4, height-1));

745 ià(
tİ_Ëv–_wšdow
) {

746 
ddi¥
->
sh–l
 = 
	`gtk_wšdow_Ãw
 (
GTK_WINDOW_TOPLEVEL
);

747 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
ddi¥
->
sh–l
), 
t™Ë
);

748 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
ddi¥
->
sh–l
), "diagram_window");

749 
	`gtk_wšdow_£t_icÚ_Çme
 (
	`GTK_WINDOW
 (
ddi¥
->
sh–l
), "dia");

750 
	`gtk_wšdow_£t_deçuÉ_size
(
	`GTK_WINDOW
 (
ddi¥
->
sh–l
), 
width
, 
height
);

752 ià(!
	`gtk_wšdow_g‘_icÚ
 (
	`GTK_WINDOW
 (
ddi¥
->
sh–l
))) {

753 
GdkPixbuf
 *
pixbuf
 = 
NULL
;

755 ià(!
pixbuf
)

756 
pixbuf
 = 
	`gdk_pixbuf_Ãw_äom_šlše
(-1, 
dŸ_dŸg¿m_icÚ
, 
FALSE
, 
NULL
);

757 ià(
pixbuf
)

758 
	`gtk_wšdow_£t_icÚ
 (
	`GTK_WINDOW
 (
ddi¥
->
sh–l
), 
pixbuf
);

761 
ddi¥
->
sh–l
 = 
	`gtk_ev’t_box_Ãw
 ();

763 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
ddi¥
->
sh–l
), "u£r_d©a", (
gpoš‹r
) ddisp);

765 
	`gtk_widg‘_£t_ev’ts
 (
ddi¥
->
sh–l
,

766 
GDK_POINTER_MOTION_MASK
 |

767 
GDK_POINTER_MOTION_HINT_MASK
 |

768 
GDK_FOCUS_CHANGE_MASK
);

771 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
sh–l
), "delete_event",

772 
	`G_CALLBACK
 (
ddi¥Ïy_d–‘e
),

773 
ddi¥
);

774 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
sh–l
), "destroy",

775 
	`G_CALLBACK
 (
ddi¥Ïy_de¡roy
),

776 
ddi¥
);

777 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
sh–l
), "focus_out_event",

778 
	`G_CALLBACK
 (
ddi¥Ïy_focus_out_ev’t
),

779 
ddi¥
);

780 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
sh–l
), "focus_in_event",

781 
	`G_CALLBACK
 (
ddi¥Ïy_focus_š_ev’t
),

782 
ddi¥
);

783 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
sh–l
), "realize",

784 
	`G_CALLBACK
 (
ddi¥Ïy_»®ize
),

785 
ddi¥
);

786 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
sh–l
), "unrealize",

787 
	`G_CALLBACK
 (
ddi¥Ïy_uÄ—lize
),

788 
ddi¥
);

796 
bË
 = 
	`gtk_bË_Ãw
 (4, 3, 
FALSE
);

797 
	`gtk_bË_£t_cŞ_¥acšg
 (
	`GTK_TABLE
 (
bË
), 0, 1);

798 
	`gtk_bË_£t_cŞ_¥acšg
 (
	`GTK_TABLE
 (
bË
), 1, 2);

799 
	`gtk_bË_£t_row_¥acšg
 (
	`GTK_TABLE
 (
bË
), 0, 1);

800 
	`gtk_bË_£t_row_¥acšg
 (
	`GTK_TABLE
 (
bË
), 1, 2);

801 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
bË
), 2);

802 ià(
u£_mb¬
)

804 
roÙ_vbox
 = 
	`gtk_vbox_Ãw
 (
FALSE
, 1);

805 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
ddi¥
->
sh–l
), 
roÙ_vbox
);

806 
	`gtk_box_·ck_’d
 (
	`GTK_BOX
 (
roÙ_vbox
), 
bË
, 
TRUE
, TRUE, 0);

810 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
ddi¥
->
sh–l
), 
bË
);

815 ià(!
u£_mb¬
) {

816 
ddi¥
->
Üigš
 = 
	`gtk_bu‰Ú_Ãw
();

817 
	`GTK_WIDGET_UNSET_FLAGS
(
ddi¥
->
Üigš
, 
GTK_CAN_FOCUS
);

818 
widg‘
 = 
	`gtk_¬row_Ãw
(
GTK_ARROW_RIGHT
, 
GTK_SHADOW_OUT
);

819 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
ddi¥
->
Üigš
), 
widg‘
);

820 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
widg‘
, 
	`_
("DŸg¿m m’u."), 
NULL
);

821 
	`gtk_widg‘_show
(
widg‘
);

822 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
ddi¥
->
Üigš
), "button_press_event",

823 
	`G_CALLBACK
(
Üigš_bu‰Ú_´ess
), 
ddi¥
);

826 
ddi¥
->
Üigš
 = 
	`gtk_äame_Ãw
 (
NULL
);

827 
	`gtk_äame_£t_shadow_ty³
 (
	`GTK_FRAME
 (
ddi¥
->
Üigš
), 
GTK_SHADOW_OUT
);

831 
ddi¥
->
hruË
 = 
	`gtk_hruËr_Ãw
 ();

832 
	`g_sigÇl_cÚÃù_sw­³d
 (
	`GTK_OBJECT
 (
ddi¥
->
sh–l
), "motion_notify_event",

833 
	`G_CALLBACK
(
	`GTK_WIDGET_GET_CLASS
 (
ddi¥
->
hruË
)->
mÙiÚ_nÙify_ev’t
),

834 
	`GTK_OBJECT
 (
ddi¥
->
hruË
));

836 
ddi¥
->
vruË
 = 
	`gtk_vruËr_Ãw
 ();

837 
	`g_sigÇl_cÚÃù_sw­³d
 (
	`GTK_OBJECT
 (
ddi¥
->
sh–l
), "motion_notify_event",

838 
	`G_CALLBACK
(
	`GTK_WIDGET_GET_CLASS
 (
ddi¥
->
vruË
)->
mÙiÚ_nÙify_ev’t
),

839 
	`GTK_OBJECT
 (
ddi¥
->
vruË
));

841 
ddi¥
->
hsb
 = 
	`gtk_hsüŞlb¬_Ãw
 (ddi¥->
hsbd©a
);

842 
	`GTK_WIDGET_UNSET_FLAGS
 (
ddi¥
->
hsb
, 
GTK_CAN_FOCUS
);

843 
ddi¥
->
vsb
 = 
	`gtk_vsüŞlb¬_Ãw
 (ddi¥->
vsbd©a
);

844 
	`GTK_WIDGET_UNSET_FLAGS
 (
ddi¥
->
vsb
, 
GTK_CAN_FOCUS
);

848 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
hsbd©a
), "value_changed",

849 
	`G_CALLBACK
(
ddi¥Ïy_hsb_upd©e
),

850 
ddi¥
);

851 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
vsbd©a
), "value_changed",

852 
	`G_CALLBACK
(
ddi¥Ïy_vsb_upd©e
),

853 
ddi¥
);

856 
Çvig©iÚ_bu‰Ú
 = 
	`Çvig©iÚ_pİup_Ãw
(
ddi¥
);

857 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
Çvig©iÚ_bu‰Ú
,

858 
	`_
("Pİ u°thNavig©iÚ wšdow."), 
NULL
);

859 
	`gtk_widg‘_show
(
Çvig©iÚ_bu‰Ú
);

863 
ddi¥
->
ÿnvas
 = 
	`dŸ_ÿnvas_Ãw
();

865 
	`gtk_widg‘_£t_doubË_bufã»d
 (
ddi¥
->
ÿnvas
, 
FALSE
);

867 
	`dŸ_ÿnvas_£t_size
(
	`DIA_CANVAS
 (
ddi¥
->
ÿnvas
), 
width
, 
height
);

869 
	`gtk_widg‘_£t_ev’ts
 (
ddi¥
->
ÿnvas
, 
CANVAS_EVENT_MASK
);

870 
	`GTK_WIDGET_SET_FLAGS
 (
ddi¥
->
ÿnvas
, 
GTK_CAN_FOCUS
);

871 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
ÿnvas
), "event",

872 
	`G_CALLBACK
(
ddi¥Ïy_ÿnvas_ev’ts
),

873 
ddi¥
);

875 
	`gtk_d¿g_de¡_£t
(
ddi¥
->
ÿnvas
, 
GTK_DEST_DEFAULT_ALL
,

876 
di¥Ïy_rg‘_bË
, 
di¥Ïy_n_rg‘s
, 
GDK_ACTION_COPY
);

877 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
ÿnvas
), "drag_drop",

878 
	`G_CALLBACK
(
di¥Ïy_drİ_ÿÎback
), 
NULL
);

879 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ddi¥
->
ÿnvas
), "drag_data_received",

880 
	`G_CALLBACK
(
di¥Ïy_d©a_»ûived_ÿÎback
), 
ddi¥
);

882 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
ddi¥
->
ÿnvas
), "u£r_d©a", (
gpoš‹r
) ddisp);

885 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
Üigš
, 0, 1, 0, 1,

886 
GTK_FILL
, GTK_FILL, 0, 0);

887 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
hruË
, 1, 2, 0, 1,

888 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, GTK_FILL, 0, 0);

889 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
vruË
, 0, 1, 1, 2,

890 
GTK_FILL
, 
GTK_EXPAND
 | 
GTK_SHRINK
 | GTK_FILL, 0, 0);

891 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
ÿnvas
, 1, 2, 1, 2,

892 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
,

893 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, 0, 0);

894 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
hsb
, 0, 2, 2, 3,

895 
GTK_EXPAND
 | 
GTK_SHRINK
 | 
GTK_FILL
, GTK_FILL, 0, 0);

896 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
ddi¥
->
vsb
, 2, 3, 0, 2,

897 
GTK_FILL
, 
GTK_EXPAND
 | 
GTK_SHRINK
 | GTK_FILL, 0, 0);

898 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
Çvig©iÚ_bu‰Ú
, 2, 3, 2, 3,

899 
GTK_FILL
, GTK_FILL, 0, 0);

902 
ddi¥
->
acûl_group
 = 
	`m’us_g‘_di¥Ïy_acûls
 ();

903 ià(
tİ_Ëv–_wšdow
)

904 
	`gtk_wšdow_add_acûl_group
(
	`GTK_WINDOW
(
ddi¥
->
sh–l
), ddi¥->
acûl_group
);

905 ià(
u£_mb¬
)

907 
ddi¥
->
m’u_b¬
 = 
	`m’us_ü—‹_di¥Ïy_m’ub¬
 (&ddi¥->
ui_mªag”
, &ddi¥->
aùiÚs
);

908 
	`g_as£¹
 (
ddi¥
->
m’u_b¬
);

909 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
roÙ_vbox
), 
ddi¥
->
m’u_b¬
, 
FALSE
, 
TRUE
, 0);

913 
¡©us_hbox
 = 
	`gtk_hbox_Ãw
 (
FALSE
, 2);

921 
ddi¥
->
zoom_¡©us
 = 
	`ü—‹_zoom_widg‘
(ddisp);

922 
zoom_hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
, 0);

923 
zoom_Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Zoom"));

924 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
(
zoom_hbox
), 
zoom_Ïb–
,

925 
FALSE
, FALSE, 0);

926 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
(
zoom_hbox
), 
ddi¥
->
zoom_¡©us
,

927 
FALSE
, FALSE, 0);

929 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
¡©us_hbox
), 
zoom_hbox
, 
FALSE
, FALSE, 0);

932 
ddi¥
->
grid_¡©us
 = 
	`dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs
(
dŸ_Ú_grid_icÚ
,

933 
dŸ_off_grid_icÚ
);

935 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
ddi¥
->
grid_¡©us
), "toggled",

936 
	`G_CALLBACK
 (
grid_toggË_¢­
), 
ddi¥
);

937 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
ddi¥
->
grid_¡©us
,

938 
	`_
("ToggË ¢­-to-grid fÜhi wšdow."), 
NULL
);

939 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
¡©us_hbox
), 
ddi¥
->
grid_¡©us
,

940 
FALSE
, FALSE, 0);

943 
ddi¥
->
mašpošt_¡©us
 = 
	`dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs
(
dŸ_mašpošts_Ú_icÚ
,

944 
dŸ_mašpošts_off_icÚ
);

946 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
ddi¥
->
mašpošt_¡©us
), "toggled",

947 
	`G_CALLBACK
 (
š‹rçû_toggË_mašpošt_magÃtism
), 
ddi¥
);

948 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
ddi¥
->
mašpošt_¡©us
,

949 
	`_
("ToggË objeù sÇµšg fÜhi wšdow."), 
NULL
);

950 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
¡©us_hbox
), 
ddi¥
->
mašpošt_¡©us
,

951 
FALSE
, FALSE, 0);

955 
ddi¥
->
modif›d_¡©us
 = 
	`gtk_¡©usb¬_Ãw
 ();

957 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
¡©us_hbox
), 
ddi¥
->
modif›d_¡©us
,

958 
TRUE
, TRUE, 0);

960 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË
), 
¡©us_hbox
, 0, 3, 3, 4,

961 
GTK_FILL
, GTK_FILL, 0, 0);

963 
	`gtk_widg‘_show
 (
ddi¥
->
hsb
);

964 
	`gtk_widg‘_show
 (
ddi¥
->
vsb
);

965 
	`di¥Ïy_ruËrs_show
 (
ddi¥
);

966 
	`gtk_widg‘_show
 (
ddi¥
->
zoom_¡©us
);

967 
	`gtk_widg‘_show
 (
zoom_hbox
);

968 
	`gtk_widg‘_show
 (
zoom_Ïb–
);

969 
	`gtk_widg‘_show
 (
ddi¥
->
grid_¡©us
);

970 
	`gtk_widg‘_show
 (
ddi¥
->
mašpošt_¡©us
);

971 
	`gtk_widg‘_show
 (
ddi¥
->
modif›d_¡©us
);

972 
	`gtk_widg‘_show
 (
¡©us_hbox
);

973 
	`gtk_widg‘_show
 (
bË
);

974 ià(
u£_mb¬
)

976 
	`gtk_widg‘_show
 (
ddi¥
->
m’u_b¬
);

977 
	`gtk_widg‘_show
 (
roÙ_vbox
);

979 
	`gtk_widg‘_show
 (
ddi¥
->
sh–l
);

982 ià(
u£_mb¬
 && 
ddi¥
->
hruË
->
®loÿtiÚ
.
width
 > width)

991 
width
 = 
ddi¥
->
hruË
->
®loÿtiÚ
.width;

993 
ddi¥
->
hsbd©a
->
uµ”
 = 
width
;

994 
ddi¥
->
hsbd©a
->
·ge_šüem’t
 = (
width
 - 1) / 4;

995 
ddi¥
->
hsbd©a
->
·ge_size
 = 
width
 - 1;

997 
	`gtk_adju¡m’t_chªged
 (
	`GTK_ADJUSTMENT
(
ddi¥
->
hsbd©a
));

999 
	`gtk_widg‘_show
 (
ddi¥
->
ÿnvas
);

1002 
	`gtk_widg‘_g¿b_focus
 (
ddi¥
->
ÿnvas
);

1003 
	}
}

1006 
	$toŞ_£Ëù_upd©e
 (
GtkWidg‘
 *
w
,

1007 
gpoš‹r
 
d©a
)

1009 
ToŞBu‰ÚD©a
 *
toŞd©a
 = (ToŞBu‰ÚD©¨*è
d©a
;

1011 ià(
toŞd©a
 =ğ
NULL
) {

1012 
	`g_w¬nšg
("NULLooldata inool_select_update");

1016 ià(
toŞd©a
->
ty³
 != -1) {

1017 
gšt
 
x
, 
y
;

1018 
GdkModif›rTy³
 
mask
;

1020 
	`gdk_wšdow_g‘_poš‹r
 (
	`gtk_widg‘_g‘_·»Á_wšdow
(
w
), &
x
, &
y
, &
mask
);

1021 
	`toŞ_£Ëù
 (
toŞd©a
->
ty³
,oŞd©a->
exŒa_d©a
,oŞd©a->
u£r_d©a
,

1022 
w
, 
mask
&1);

1024 
	}
}

1026 
gšt


1027 
	$toŞ_bu‰Ú_´ess
 (
GtkWidg‘
 *
w
,

1028 
GdkEv’tBu‰Ú
 *
ev’t
,

1029 
gpoš‹r
 
d©a
)

1031 
ToŞBu‰ÚD©a
 *
toŞd©a
 = (ToŞBu‰ÚD©¨*è
d©a
;

1033 ià((
ev’t
->
ty³
 =ğ
GDK_2BUTTON_PRESS
) &&

1034 (
ev’t
->
bu‰Ú
 == 1)) {

1037  
TRUE
;

1040  
FALSE
;

1041 
	}
}

1044 
	$toŞ_d¿g_d©a_g‘
 (
GtkWidg‘
 *
widg‘
, 
GdkD¿gCÚ‹xt
 *
cÚ‹xt
,

1045 
GtkS–eùiÚD©a
 *
£ËùiÚ_d©a
, 
gušt
 
šfo
,

1046 
gušt32
 
time
, 
ToŞBu‰ÚD©a
 *
toŞd©a
)

1048 ià(
šfo
 == 0) {

1049 
	`gtk_£ËùiÚ_d©a_£t
(
£ËùiÚ_d©a
, s–eùiÚ_d©a->
rg‘
,

1050 8, (
guch¬
 *)&
toŞd©a
, (
ToŞBu‰ÚD©a
 *));

1052 
	}
}

1055 
	$toŞ_£tup_d¿g_sourû
(
GtkWidg‘
 *
bu‰Ú
, 
ToŞBu‰ÚD©a
 *
toŞd©a
,

1056 
GdkPixm­
 *
pixm­
, 
GdkB™m­
 *
mask
)

1058 
	`g_»tuº_if_ç
(
toŞd©a
->
ty³
 =ğ
CREATE_OBJECT_TOOL
);

1060 
	`gtk_d¿g_sourû_£t
(
bu‰Ú
, 
GDK_BUTTON1_MASK
,

1061 
di¥Ïy_rg‘_bË
, 
di¥Ïy_n_rg‘s
,

1062 
GDK_ACTION_DEFAULT
|
GDK_ACTION_COPY
);

1063 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
bu‰Ú
), "drag_data_get",

1064 
	`G_CALLBACK
(
toŞ_d¿g_d©a_g‘
), 
toŞd©a
);

1065 ià(
pixm­
)

1066 
	`gtk_d¿g_sourû_£t_icÚ
(
bu‰Ú
, 
	`gtk_widg‘_g‘_cŞÜm­
(button),

1067 
pixm­
, 
mask
);

1068 
	}
}

1092 
GtkWidg‘
 *

1093 
	$ü—‹_widg‘_äom_xpm_Ü_gdkp
(
gch¬
 **
icÚ_d©a
, 
GtkWidg‘
 *
bu‰Ú
)

1095 
GtkWidg‘
 *
pixm­widg‘
;

1097 ià(
	`¡ºcmp
((*)
icÚ_d©a
, "GdkP", 4) == 0) {

1098 
GdkPixbuf
 *
p
;

1099 
p
 = 
	`gdk_pixbuf_Ãw_äom_šlše
(-1, (*)
icÚ_d©a
, 
TRUE
, 
NULL
);

1100 
pixm­widg‘
 = 
	`gtk_image_Ãw_äom_pixbuf
(
p
);

1102 
GdkB™m­
 *
mask
 = 
NULL
;

1103 
GtkStyË
 *
¡yË
;

1104 **
pixm­_d©a
;

1105 
GdkPixm­
 *
pixm­
 = 
NULL
;

1107 
pixm­_d©a
 = 
icÚ_d©a
;

1108 
¡yË
 = 
	`gtk_widg‘_g‘_¡yË
(
bu‰Ú
);

1109 
pixm­
 = 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

1110 
	`gtk_widg‘_g‘_cŞÜm­
(
bu‰Ú
), &
mask
,

1111 &
¡yË
->
bg
[
GTK_STATE_NORMAL
], 
pixm­_d©a
);

1112 
pixm­widg‘
 = 
	`gtk_pixm­_Ãw
(
pixm­
, 
mask
);

1114  
pixm­widg‘
;

1115 
	}
}

1118 
	$ü—‹_toŞs
(
GtkWidg‘
 *
·»Á
)

1120 
GtkWidg‘
 *
bu‰Ú
;

1121 
GtkWidg‘
 *
pixm­widg‘
;

1122 
GdkPixm­
 *
pixm­
 = 
NULL
;

1123 
GdkB™m­
 *
mask
 = 
NULL
;

1125 **
pixm­_d©a
;

1126 
i
;

1128 
i
 = 0; i < 
NUM_TOOLS
; i++) {

1129 
toŞ_widg‘s
[
i
] = 
bu‰Ú
 = 
	`gtk_¿dio_bu‰Ú_Ãw
 (
toŞ_group
);

1130 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
bu‰Ú
), 0);

1131 
	`gtk_bu‰Ú_£t_»l›f
(
	`GTK_BUTTON
(
bu‰Ú
), 
GTK_RELIEF_HALF
);

1132 
toŞ_group
 = 
	`gtk_¿dio_bu‰Ú_group
 (
	`GTK_RADIO_BUTTON
 (
bu‰Ú
));

1133 
	`gtk_toggË_bu‰Ú_£t_mode
 (
	`GTK_TOGGLE_BUTTON
 (
bu‰Ú
), 
FALSE
);

1135 
	`gtk_w¿p_box_·ck
(
	`GTK_WRAP_BOX
(
·»Á
), 
bu‰Ú
,

1136 
TRUE
, TRUE, 
FALSE
, TRUE);

1138 ià(
toŞ_d©a
[
i
].
ÿÎback_d©a
.
ty³
 =ğ
MODIFY_TOOL
) {

1139 
modify_toŞ_bu‰Ú
 = 
	`GTK_WIDGET
(
bu‰Ú
);

1142 ià(
toŞ_d©a
[
i
].
icÚ_d©a
==
NULL
) {

1143 
DŸObjeùTy³
 *
ty³
;

1144 
ty³
 =

1145 
	`objeù_g‘_ty³
((*)
toŞ_d©a
[
i
].
ÿÎback_d©a
.
exŒa_d©a
);

1146 ià(
ty³
 =ğ
NULL
)

1147 
pixm­_d©a
 = 
toŞ_d©a
[0].
icÚ_d©a
;

1149 
pixm­_d©a
 = 
ty³
->
pixm­
;

1150 
pixm­widg‘
 = 
	`ü—‹_widg‘_äom_xpm_Ü_gdkp
(
pixm­_d©a
, 
bu‰Ú
);

1152 
pixm­widg‘
 = 
	`ü—‹_widg‘_äom_xpm_Ü_gdkp
(
toŞ_d©a
[
i
].
icÚ_d©a
, 
bu‰Ú
);

1156 
	`gtk_misc_£t_·ddšg
(
	`GTK_MISC
(
pixm­widg‘
), 2, 2);

1158 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
bu‰Ú
), 
pixm­widg‘
);

1160 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú
), "clicked",

1161 
	`G_CALLBACK
 (
toŞ_£Ëù_upd©e
),

1162 &
toŞ_d©a
[
i
].
ÿÎback_d©a
);

1164 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú
), "button_press_event",

1165 
	`G_CALLBACK
 (
toŞ_bu‰Ú_´ess
),

1166 &
toŞ_d©a
[
i
].
ÿÎback_d©a
);

1168 ià(
toŞ_d©a
[
i
].
ÿÎback_d©a
.
ty³
 =ğ
CREATE_OBJECT_TOOL
)

1169 
	`toŞ_£tup_d¿g_sourû
(
bu‰Ú
, &
toŞ_d©a
[
i
].
ÿÎback_d©a
,

1170 
pixm­
, 
mask
);

1172 ià(
pixm­
è
	`gdk_pixm­_uÄef
(pixmap);

1173 ià(
mask
è
	`gdk_b™m­_uÄef
(mask);

1175 
toŞ_d©a
[
i
].
ÿÎback_d©a
.
widg‘
 = 
bu‰Ú
;

1177 ià(
toŞ_d©a
[
i
].
toŞ_acûË¿tÜ
) {

1178 
gušt
 
key
;

1179 
GdkModif›rTy³
 
mods
;

1180 
gch¬
 *
®ab–
, *
©
;

1182 
	`gtk_acûË¿tÜ_·r£
 (
toŞ_d©a
[
i
].
toŞ_acûË¿tÜ
, &
key
, &
mods
);

1184 
®ab–
 = 
	`gtk_acûË¿tÜ_g‘_Ïb–
(
key
, 
mods
);

1185 
©
 = 
	`g_¡rcÚÿt
(
	`g‘‹xt
(
toŞ_d©a
[
i
].
toŞ_desc
), " (", 
®ab–
, ")", 
NULL
);

1186 
	`gtk_toŞts_£t_t
 (
toŞ_ts
, 
bu‰Ú
, 
©
, 
NULL
);

1187 
	`g_ä“
 (
©
);

1188 
	`g_ä“
 (
®ab–
);

1191 
	`gtk_toŞts_£t_t
 (
toŞ_ts
, 
bu‰Ú
,

1192 
	`g‘‹xt
(
toŞ_d©a
[
i
].
toŞ_desc
), 
NULL
);

1195 
	`gtk_widg‘_show
 (
pixm­widg‘
);

1196 
	`gtk_widg‘_show
 (
bu‰Ú
);

1198 
	}
}

1200 
GtkWidg‘
 *
	gsh“t_İtiÚ_m’u
;

1201 
GtkWidg‘
 *
	gsh“t_wbox
;

1203 
gch¬
 *
	gš‹rçû_cu¼’t_sh“t_Çme
;

1205 
Sh“t
 *

1206 
	$g‘_sh“t_by_Çme
(cÚ¡ 
gch¬
 *
Çme
)

1208 
GSLi¡
 *
tmp
;

1209 
tmp
 = 
	`g‘_sh“ts_li¡
();m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

1210 
Sh“t
 *
sh“t
 = 
tmp
->
d©a
;

1214 ià(0 =ğ
	`g_¡rÿ£cmp
(
Çme
, 
sh“t
->Çmeè|| 0 =ğg_¡rÿ£cmpÒame, 
	`g‘‹xt
(sheet->name)))

1215  
sh“t
;

1217  
NULL
;

1218 
	}
}

1221 
	$fl_sh“t_wbox
(
Sh“t
 *
sh“t
)

1223 
rows
;

1224 
GtkStyË
 *
¡yË
;

1225 
GSLi¡
 *
tmp
;

1226 
GtkWidg‘
 *
fœ¡_bu‰Ú
 = 
NULL
;

1228 
	`gtk_cÚš”_fÜ—ch
(
	`GTK_CONTAINER
(
sh“t_wbox
),

1229 (
GtkC®lback
)
gtk_widg‘_de¡roy
, 
NULL
);

1230 
toŞ_group
 = 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(
toŞ_widg‘s
[0]));

1233 
š‹rçû_cu¼’t_sh“t_Çme
 = 
sh“t
->
Çme
;

1236 
rows
 = 
	`û
(
	`g_¦i¡_Ëngth
(
sh“t
->
objeùs
è/ ()
COLUMNS
);

1237 ià(
rows
<1)„ows = 1;

1238 
	`gtk_w¿p_box_£t_a¥eù_¿tio
(
	`GTK_WRAP_BOX
(
sh“t_wbox
),

1239 
COLUMNS
 * 1.0 / 
rows
);

1240 
¡yË
 = 
	`gtk_widg‘_g‘_¡yË
(
sh“t_wbox
);

1241 
tmp
 = 
sh“t
->
objeùs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

1242 
Sh“tObjeù
 *
sh“t_obj
 = 
tmp
->
d©a
;

1243 
GdkPixm­
 *
pixm­
 = 
NULL
;

1244 
GdkB™m­
 *
mask
 = 
NULL
;

1245 
GtkWidg‘
 *
pixm­widg‘
;

1246 
GtkWidg‘
 *
bu‰Ú
;

1247 
ToŞBu‰ÚD©a
 *
d©a
;

1249 ià(
sh“t_obj
->
pixm­
 !ğ
NULL
) {

1250 
pixm­
 = 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

1251 
	`gtk_widg‘_g‘_cŞÜm­
(
sh“t_wbox
), &
mask
,

1252 &
¡yË
->
bg
[
GTK_STATE_NORMAL
], 
sh“t_obj
->
pixm­
);

1253 } ià(
sh“t_obj
->
pixm­_fe
 !ğ
NULL
) {

1254 
GdkPixbuf
 *
pixbuf
;

1255 
GE¼Ü
* 
g”rÜ
 = 
NULL
;

1257 
pixbuf
 = 
	`gdk_pixbuf_Ãw_äom_fe
(
sh“t_obj
->
pixm­_fe
, &
g”rÜ
);

1258 ià(
pixbuf
 !ğ
NULL
) {

1259 
width
 = 
	`gdk_pixbuf_g‘_width
 (
pixbuf
);

1260 
height
 = 
	`gdk_pixbuf_g‘_height
 (
pixbuf
);

1261 ià(
width
 > 22) {

1262 
GdkPixbuf
 *
üİ³d
;

1263 
	`g_w¬nšg
 ("Sh­icÚ '%s' sizwrÚg, crİ³d.", 
sh“t_obj
->
pixm­_fe
);

1264 
üİ³d
 = 
	`gdk_pixbuf_Ãw_subpixbuf
 (
pixbuf
,

1265 (
width
 - 22è/ 2, 
height
 > 22 ? (height - 22) / 2 : 0,

1266 22, 
height
 > 22 ? 22 : height);

1267 
	`g_objeù_uÄef
 (
pixbuf
);

1268 
pixbuf
 = 
üİ³d
;

1270 
	`gdk_pixbuf_»nd”_pixm­_ªd_mask_fÜ_cŞÜm­
(
pixbuf
, 
	`gtk_widg‘_g‘_cŞÜm­
(
sh“t_wbox
), &
pixm­
, &
mask
, 1.0);

1271 
	`gdk_pixbuf_uÄef
(
pixbuf
);

1273 
pixm­
 = 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

1274 
	`gtk_widg‘_g‘_cŞÜm­
(
sh“t_wbox
), &
mask
,

1275 &
¡yË
->
bg
[
GTK_STATE_NORMAL
], 
missšg
);

1277 
	`mes§ge_w¬nšg
("failedo†oad icon for file\n %s\n cause=%s",

1278 
sh“t_obj
->
pixm­_fe
,
g”rÜ
?g”rÜ->
mes§ge
:"[NULL]");

1281 
DŸObjeùTy³
 *
ty³
;

1282 
ty³
 = 
	`objeù_g‘_ty³
(
sh“t_obj
->
objeù_ty³
);

1283 
pixm­
 = 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

1284 
	`gtk_widg‘_g‘_cŞÜm­
(
sh“t_wbox
), &
mask
,

1285 &
¡yË
->
bg
[
GTK_STATE_NORMAL
], 
ty³
->
pixm­
);

1287 ià(
pixm­
) {

1288 
pixm­widg‘
 = 
	`gtk_pixm­_Ãw
(
pixm­
, 
mask
);

1289 
	`gdk_pixm­_uÄef
(
pixm­
);

1290 ià(
mask
è
	`gdk_b™m­_uÄef
(mask);

1292 
pixm­widg‘
 = 
	`gtk_ty³_Ãw
(
	`gtk_pixm­_g‘_ty³
());

1295 
bu‰Ú
 = 
	`gtk_¿dio_bu‰Ú_Ãw
 (
toŞ_group
);

1296 
	`gtk_toggË_bu‰Ú_£t_mode
 (
	`GTK_TOGGLE_BUTTON
 (
bu‰Ú
), 
FALSE
);

1297 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
bu‰Ú
), 0);

1298 
toŞ_group
 = 
	`gtk_¿dio_bu‰Ú_group
 (
	`GTK_RADIO_BUTTON
 (
bu‰Ú
));

1300 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
bu‰Ú
), 
pixm­widg‘
);

1301 
	`gtk_widg‘_show
(
pixm­widg‘
);

1303 
	`gtk_w¿p_box_·ck_w¿µed
(
	`GTK_WRAP_BOX
(
sh“t_wbox
), 
bu‰Ú
,

1304 
FALSE
, 
TRUE
, FALSE, TRUE, 
sh“t_obj
->
lše_b»ak
);

1305 
	`gtk_widg‘_show
(
bu‰Ú
);

1307 
d©a
 = 
	`g_Ãw
(
ToŞBu‰ÚD©a
, 1);

1308 
d©a
->
ty³
 = 
CREATE_OBJECT_TOOL
;

1309 
d©a
->
exŒa_d©a
 = 
sh“t_obj
->
objeù_ty³
;

1310 
d©a
->
u£r_d©a
 = 
sh“t_obj
->user_data;

1311 
	`gtk_objeù_£t_d©a_fuÎ
(
	`GTK_OBJECT
(
bu‰Ú
), "Dia::ToolButtonData",

1312 
d©a
, (
GdkDe¡royNÙify
)
g_ä“
);

1313 ià(
fœ¡_bu‰Ú
 =ğ
NULL
èfœ¡_bu‰Ú = 
bu‰Ú
;

1315 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú
), "clicked",

1316 
	`G_CALLBACK
 (
toŞ_£Ëù_upd©e
), 
d©a
);

1317 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú
), "button_press_event",

1318 
	`G_CALLBACK
 (
toŞ_bu‰Ú_´ess
), 
d©a
);

1320 
	`toŞ_£tup_d¿g_sourû
(
bu‰Ú
, 
d©a
, 
pixm­
, 
mask
);

1322 
	`gtk_toŞts_£t_t
 (
toŞ_ts
, 
bu‰Ú
,

1323 
	`g‘‹xt
(
sh“t_obj
->
desütiÚ
), 
NULL
);

1326 ià(
aùive_toŞ
 !ğ
NULL
 &&

1327 
aùive_toŞ
->
ty³
 =ğ
CREATE_OBJECT_TOOL
 &&

1328 
fœ¡_bu‰Ú
 !ğ
NULL
)

1329 
	`gtk_sigÇl_em™_by_Çme
(
	`GTK_OBJECT
(
fœ¡_bu‰Ú
), "toggled",

1330 
	`GTK_BUTTON
(
fœ¡_bu‰Ú
), 
NULL
);

1331 
	}
}

1334 
	$sh“t_İtiÚ_m’u_chªged
(
DŸDyÇmicM’u
 *
m’u
, 
gpoš‹r
 
u£r_d©a
)

1336 *
¡ršg
 = 
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
m’u
);

1337 
Sh“t
 *
sh“t
 = 
	`g‘_sh“t_by_Çme
(
¡ršg
);

1338 ià(
sh“t
 =ğ
NULL
) {

1339 
	`mes§ge_w¬nšg
(
	`_
("NØsh“ˆÇmed %s"), 
¡ršg
);

1341 
	`³rsi¡’û_£t_¡ršg
("Ï¡-sh“t-£Ëùed", 
¡ršg
);

1342 
	`fl_sh“t_wbox
(
sh“t
);

1344 
	`g_ä“
(
¡ršg
);

1345 
	}
}

1348 
	$cmp_Çmes
 (cÚ¡ *
a
, cÚ¡ *
b
)

1350  
	`g_utf8_cŞÏ‹
(
	`g‘‹xt
Ğ(
gch¬
 *)
a
 ), g‘‹xtĞ(gch¬ *)
b
 ));

1351 
	}
}

1353 
GLi¡
 *

1354 
	$g‘_sh“t_Çmes
()

1356 
GSLi¡
 *
tmp
;

1357 
GLi¡
 *
Çmes
 = 
NULL
;

1358 
tmp
 = 
	`g‘_sh“ts_li¡
();m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

1359 
Sh“t
 *
sh“t
 = 
tmp
->
d©a
;

1360 
Çmes
 = 
	`g_li¡_­³nd
Òames, 
sh“t
->
Çme
);

1363  
	`g_li¡_sÜt
 (
Çmes
, 
cmp_Çmes
);

1364 
	}
}

1367 
	$ü—‹_sh“t_drİdown_m’u
(
GtkWidg‘
 *
·»Á
)

1369 
gch¬
 *
aùiÚ_bŠ
 = 
	`g_loÿË_to_utf8
(
	`_
("ĞĞÎª½á¹¹"),-1,
NULL
,NULL,NULL);

1370 
GtkWidg‘
 *
t™Ë_Ïb
 = 
	`gtk_Ïb–_Ãw
(
aùiÚ_bŠ
);

1371 
GLi¡
 *
sh“t_Çmes
 = 
	`g‘_sh“t_Çmes
();

1373 ià(
sh“t_İtiÚ_m’u
 !ğ
NULL
) {

1374 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
·»Á
), 
sh“t_İtiÚ_m’u
);

1375 
sh“t_İtiÚ_m’u
 = 
NULL
;

1378 
sh“t_İtiÚ_m’u
 =

1379 
	`dŸ_dyÇmic_m’u_Ãw_¡ršgli¡ba£d
(
	`g_¡rdup
(
aùiÚ_bŠ
), 
sh“t_Çmes
,

1380 
NULL
, "sheets");

1397 
	`gtk_w¿p_box_·ck_w¿µed
(
	`GTK_WRAP_BOX
(
·»Á
), 
t™Ë_Ïb
,

1398 
TRUE
, TRUE, 
FALSE
, FALSE, TRUE);

1403 
	`gtk_widg‘_show
(
t™Ë_Ïb
);

1404 
	`g_ä“
(
aùiÚ_bŠ
);

1405 
	}
}

1408 
	$fl_sh“t_m’u
()

1410 
gch¬
 *
£ËùiÚ
 = 
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
	`DIA_DYNAMIC_MENU
(
sh“t_İtiÚ_m’u
));

1411 
	`ü—‹_sh“t_drİdown_m’u
(
	`gtk_widg‘_g‘_·»Á
(
sh“t_İtiÚ_m’u
));

1412 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
	`DIA_DYNAMIC_MENU
(
sh“t_İtiÚ_m’u
), 
£ËùiÚ
);

1414 
	`g_ä“
(
£ËùiÚ
);

1415 
	}
}

1418 
	$ü—‹_sh“ts
(
GtkWidg‘
 *
·»Á
)

1420 
GtkWidg‘
 *
£·¿tÜ
;

1421 
GtkWidg‘
 *
Ïb–
;

1422 
GtkWidg‘
 *
swš
;

1423 
gch¬
 *
sh“Šame
;

1424 
Sh“t
 *
sh“t
;

1426 
£·¿tÜ
 = 
	`gtk_h£·¿tÜ_Ãw
 ();

1428 
Ïb–
 = 
	`gtk_vbox_Ãw
(
FALSE
, 0);

1429 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
Ïb–
), 
£·¿tÜ
, 
TRUE
, TRUE, 3);

1430 
	`gtk_widg‘_show
(
Ïb–
);

1432 
	`gtk_w¿p_box_·ck_w¿µed
 (
	`GTK_WRAP_BOX
(
·»Á
), 
Ïb–
, 
TRUE
,TRUE, 
FALSE
,FALSE, TRUE);

1433 
	`gtk_widg‘_show
(
£·¿tÜ
);

1435 
	`ü—‹_sh“t_drİdown_m’u
(
·»Á
);

1437 
swš
 = 
	`gtk_süŞËd_wšdow_Ãw
(
NULL
, NULL);

1438 
	`gtk_süŞËd_wšdow_£t_pŞicy
(
	`GTK_SCROLLED_WINDOW
(
swš
),

1439 
GTK_POLICY_NEVER
, 
GTK_POLICY_AUTOMATIC
);

1440 
	`gtk_w¿p_box_·ck_w¿µed
(
	`GTK_WRAP_BOX
(
·»Á
), 
swš
, 
TRUE
, TRUE, TRUE, TRUE, TRUE);

1441 
	`gtk_widg‘_show
(
swš
);

1443 
sh“t_wbox
 = 
	`gtk_hw¿p_box_Ãw
(
FALSE
);

1444 
	`gtk_w¿p_box_£t_ju¡ify
(
	`GTK_WRAP_BOX
(
sh“t_wbox
), 
GTK_JUSTIFY_TOP
);

1445 
	`gtk_w¿p_box_£t_lše_ju¡ify
(
	`GTK_WRAP_BOX
(
sh“t_wbox
), 
GTK_JUSTIFY_LEFT
);

1446 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
(
	`GTK_SCROLLED_WINDOW
(
swš
), 
sh“t_wbox
);

1447 
	`gtk_widg‘_show
(
sh“t_wbox
);

1449 
sh“Šame
 = 
	`³rsi¡’û_»gi¡”_¡ršg
("Ï¡-sh“t-£Ëùed", 
	`_
("Flowchart"));

1450 
sh“t
 = 
	`g‘_sh“t_by_Çme
(
sh“Šame
);

1451 ià(
sh“t
 =ğ
NULL
) {

1454 
	`fl_sh“t_wbox
(
sh“t
);

1455 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
	`DIA_DYNAMIC_MENU
(
sh“t_İtiÚ_m’u
),

1456 
sh“Šame
);

1458 
	`g_ä“
(
sh“Šame
);

1459 
GSLi¡
 *
tmp
 = 
	`g‘_sh“ts_li¡
();

1460 if(
tmp
)

1461 
	`fl_sh“t_wbox
(
tmp
->
d©a
);

1462 
	}
}

1467 
	$ü—‹_cŞÜ_¬—
 (
GtkWidg‘
 *
·»Á
)

1469 
GtkWidg‘
 *
äame
;

1470 
GtkWidg‘
 *
®ignm’t
;

1471 
GtkWidg‘
 *
cŞ_¬—
;

1472 
GtkWidg‘
 *
lše_¬—
;

1473 
GdkPixm­
 *
deçuÉ_pixm­
;

1474 
GdkB™m­
 *
deçuÉ_mask
;

1475 
GdkPixm­
 *
sw­_pixm­
;

1476 
GdkB™m­
 *
sw­_mask
;

1477 
GtkStyË
 *
¡yË
;

1478 
GtkWidg‘
 *
hbox
;

1480 
	`gtk_widg‘_’su»_¡yË
(
·»Á
);

1481 
¡yË
 = 
	`gtk_widg‘_g‘_¡yË
(
·»Á
);

1483 
deçuÉ_pixm­
 =

1484 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

1485 
	`gtk_widg‘_g‘_cŞÜm­
(
·»Á
), &
deçuÉ_mask
,

1486 &
¡yË
->
bg
[
GTK_STATE_NORMAL
], 
deçuÉ_xpm
);

1487 
sw­_pixm­
 =

1488 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

1489 
	`gtk_widg‘_g‘_cŞÜm­
(
·»Á
), &
sw­_mask
,

1490 &
¡yË
->
bg
[
GTK_STATE_NORMAL
], 
sw­_xpm
);

1492 
äame
 = 
	`gtk_äame_Ãw
 (
NULL
);

1493 
	`gtk_äame_£t_shadow_ty³
 (
	`GTK_FRAME
 (
äame
), 
GTK_SHADOW_OUT
);

1494 
	`gtk_w¿p_box_·ck_w¿µed
(
	`GTK_WRAP_BOX
(
·»Á
), 
äame
, 
TRUE
, TRUE, 
FALSE
, FALSE, TRUE);

1495 
	`gtk_widg‘_»®ize
 (
äame
);

1497 
hbox
 = 
	`gtk_hbox_Ãw
 (
FALSE
, 1);

1498 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
hbox
), 0);

1499 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
äame
), 
hbox
);

1502 
®ignm’t
 = 
	`gtk_®ignm’t_Ãw
 (0.5, 0.5, 0.0, 0.0);

1503 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
®ignm’t
), 3);

1505 
cŞ_¬—
 = 
	`cŞÜ_¬—_ü—‹
 (54, 42,

1506 
deçuÉ_pixm­
, 
deçuÉ_mask
,

1507 
sw­_pixm­
, 
sw­_mask
);

1508 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
®ignm’t
), 
cŞ_¬—
);

1511 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
®ignm’t
, 
TRUE
, TRUE, 0);

1513 
	`gtk_toŞts_£t_t
 (
toŞ_ts
, 
cŞ_¬—
,

1514 
	`_
("Foreground & background colors for‚ew objects. "

1518 
NULL
);

1520 
	`gtk_widg‘_show
 (
®ignm’t
);

1523 
®ignm’t
 = 
	`gtk_®ignm’t_Ãw
 (0.5, 0.5, 0.0, 0.0);

1524 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
®ignm’t
), 3);

1526 
lše_¬—
 = 
	`lšewidth_¬—_ü—‹
 ();

1527 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
®ignm’t
), 
lše_¬—
);

1528 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
®ignm’t
, 
TRUE
, TRUE, 0);

1529 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
lše_¬—
, 
	`_
("Lšwidths. Click oÀ¨lštØ£ˆthdeçuÉ†šwidth fÜ‚ew objeùs. DoubË-şickØ£ˆthlšwidth mÜ´eci£ly."), 
NULL
);

1530 
	`gtk_widg‘_show
 (
®ignm’t
);

1532 
	`gtk_widg‘_show
 (
cŞ_¬—
);

1533 
	`gtk_widg‘_show
 (
lše_¬—
);

1534 
	`gtk_widg‘_show
 (
hbox
);

1535 
	`gtk_widg‘_show
 (
äame
);

1536 
	}
}

1539 
	$chªge_¡¬t_¬row_¡yË
(
A¼ow
 
¬row
, 
gpoš‹r
 
u£r_d©a
)

1541 
	`©Œibu‹s_£t_deçuÉ_¡¬t_¬row
(
¬row
);

1542 
	}
}

1544 
	$chªge_’d_¬row_¡yË
(
A¼ow
 
¬row
, 
gpoš‹r
 
u£r_d©a
)

1546 
	`©Œibu‹s_£t_deçuÉ_’d_¬row
(
¬row
);

1547 
	}
}

1549 
	$chªge_lše_¡yË
(
LšeStyË
 
l¡yË
, 
»®
 
dash_Ëngth
, 
gpoš‹r
 
u£r_d©a
)

1551 
	`©Œibu‹s_£t_deçuÉ_lše_¡yË
(
l¡yË
, 
dash_Ëngth
);

1552 
	}
}

1555 
	$ü—‹_lš•rİs_¬—
(
GtkWidg‘
 *
·»Á
)

1557 
GtkWidg‘
 *
choo£r
;

1558 
A¼ow
 
¬row
;

1559 
»®
 
dash_Ëngth
;

1560 
LšeStyË
 
¡yË
;

1561 
gch¬
 *
¬row_Çme
;

1563 
choo£r
 = 
	`dŸ_¬row_choo£r_Ãw
(
TRUE
, 
chªge_¡¬t_¬row_¡yË
, 
NULL
, 
toŞ_ts
);

1564 
	`gtk_w¿p_box_·ck_w¿µed
(
	`GTK_WRAP_BOX
(
·»Á
), 
choo£r
, 
FALSE
, 
TRUE
, FALSE, TRUE, TRUE);

1565 
¬row
.
width
 = 
	`³rsi¡’û_»gi¡”_»®
("¡¬t-¬row-width", 
DEFAULT_ARROW_WIDTH
);

1566 
¬row
.
Ëngth
 = 
	`³rsi¡’û_»gi¡”_»®
("¡¬t-¬row-Ëngth", 
DEFAULT_ARROW_LENGTH
);

1567 
¬row_Çme
 = 
	`³rsi¡’û_»gi¡”_¡ršg
("start-arrow-type", "None");

1568 
¬row
.
ty³
 = 
	`¬row_ty³_äom_Çme
(
¬row_Çme
);

1569 
	`g_ä“
(
¬row_Çme
);

1570 
	`dŸ_¬row_choo£r_£t_¬row
(
	`DIA_ARROW_CHOOSER
(
choo£r
), &
¬row
);

1571 
	`©Œibu‹s_£t_deçuÉ_¡¬t_¬row
(
¬row
);

1572 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
choo£r
, 
	`_
("A¼ow styË‡ˆthbegšnšg oàÃw†šes. ClickØpick‡À¬row, o¸£ˆ¬row…¬am‘” w™h D‘as..."), 
NULL
);

1573 
	`gtk_widg‘_show
(
choo£r
);

1575 
choo£r
 = 
	`dŸ_lše_choo£r_Ãw
(
chªge_lše_¡yË
, 
NULL
);

1576 
	`gtk_w¿p_box_·ck
(
	`GTK_WRAP_BOX
(
·»Á
), 
choo£r
, 
TRUE
, TRUE, 
FALSE
, TRUE);

1577 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
choo£r
, 
	`_
("Lš¡yË fÜ‚ew†šes. ClickØpick‡†š¡yË, o¸£ˆlš¡yË…¬am‘” w™h D‘as..."), 
NULL
);

1578 
¡yË
 = 
	`³rsi¡’û_»gi¡”_š‹g”
("lše-¡yË", 
LINESTYLE_SOLID
);

1579 
dash_Ëngth
 = 
	`³rsi¡’û_»gi¡”_»®
("dash-Ëngth", 
DEFAULT_LINESTYLE_DASHLEN
);

1580 
	`dŸ_lše_choo£r_£t_lše_¡yË
(
	`DIA_LINE_CHOOSER
(
choo£r
), 
¡yË
, 
dash_Ëngth
);

1581 
	`gtk_widg‘_show
(
choo£r
);

1583 
choo£r
 = 
	`dŸ_¬row_choo£r_Ãw
(
FALSE
, 
chªge_’d_¬row_¡yË
, 
NULL
, 
toŞ_ts
);

1584 
¬row
.
width
 = 
	`³rsi¡’û_»gi¡”_»®
("’d-¬row-width", 
DEFAULT_ARROW_WIDTH
);

1585 
¬row
.
Ëngth
 = 
	`³rsi¡’û_»gi¡”_»®
("’d-¬row-Ëngth", 
DEFAULT_ARROW_LENGTH
);

1586 
¬row_Çme
 = 
	`³rsi¡’û_»gi¡”_¡ršg
("end-arrow-type", "Filled Concave");

1587 
¬row
.
ty³
 = 
	`¬row_ty³_äom_Çme
(
¬row_Çme
);

1588 
	`g_ä“
(
¬row_Çme
);

1589 
	`dŸ_¬row_choo£r_£t_¬row
(
	`DIA_ARROW_CHOOSER
(
choo£r
), &
¬row
);

1591 
	`©Œibu‹s_£t_deçuÉ_’d_¬row
(
¬row
);

1593 
	`gtk_w¿p_box_·ck
(
	`GTK_WRAP_BOX
(
·»Á
), 
choo£r
, 
FALSE
, 
TRUE
, FALSE, TRUE);

1594 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
choo£r
, 
	`_
("A¼ow styË‡ˆth’d oàÃw†šes. ClickØpick‡À¬row, o¸£ˆ¬row…¬am‘” w™h D‘as..."), 
NULL
);

1595 
	`gtk_widg‘_show
(
choo£r
);

1596 
	}
}

1599 
	$toŞbox_de¡roy
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

1601 
	`­p_ex™
();

1602 
	}
}

1604 
gboŞ—n


1605 
	$toŞbox_d–‘e
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’t
 *
ev’t
, 
gpoš‹r
 
d©a
)

1607 ià(!
	`­p_is_embedded
()) {

1608 
gulÚg
 
hªdËrid
;

1610 
hªdËrid
 = 
	`g_sigÇl_hªdËr_fšd
(
widg‘
, 
G_SIGNAL_MATCH_FUNC
,

1611 0, 0, 
NULL
, 
toŞbox_de¡roy
, NULL);

1612 ià(
hªdËrid
 != 0)

1613 
	`g_sigÇl_hªdËr_discÚÃù
 (
	`GTK_OBJECT
 (
widg‘
), 
hªdËrid
);

1616  (!
	`­p_ex™
());

1618  
FALSE
;

1619 
	}
}

1622 
	$­p_£t_icÚ
 (
GtkWšdow
 *
wšdow
)

1624 
	`gtk_wšdow_£t_icÚ_Çme
 (
wšdow
, "dia");

1625 ià(!
	`gtk_wšdow_g‘_icÚ
 (
wšdow
)) {

1626 
GdkPixbuf
 *
pixbuf
 = 
	`gdk_pixbuf_Ãw_äom_šlše
 (-1, 
dŸ_­p_icÚ
, 
FALSE
, 
NULL
);

1627 ià(
pixbuf
) {

1628 
	`gtk_wšdow_£t_icÚ
 (
wšdow
, 
pixbuf
);

1629 
	`g_objeù_uÄef
 (
pixbuf
);

1632 
	}
}

1638 
	$ü—‹_š‹g¿‹d_ui
 ()

1640 
GtkWidg‘
 *
wšdow
;

1641 
GtkWidg‘
 *
maš_vbox
;

1642 
GtkWidg‘
 *
hbox
;

1643 
GtkWidg‘
 *
w¿pbox
;

1644 
GtkWidg‘
 *
m’ub¬
;

1645 
GtkWidg‘
 *
toŞb¬
;

1646 
GtkWidg‘
 *
nÙebook
;

1647 
GtkWidg‘
 *
¡©usb¬
;

1648 
GtkAcûlGroup
 *
acûl_group
;

1649 
GdkPixbuf
 *
pixbuf
;

1651 
GtkWidg‘
 *
Ïy”_v›w
;

1653 #ifdeà
GNOME


1654 
wšdow
 = 
	`gnome_­p_Ãw
 ("DŸ", 
	`_
("Diagram Editor"));

1656 
wšdow
 = 
	`gtk_wšdow_Ãw
 (
GTK_WINDOW_TOPLEVEL
);

1657 
	`gtk_widg‘_»f
 (
wšdow
);

1658 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
wšdow
), "DŸ v" 
VERSION
);

1663 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
wšdow
), 
DIA_MAIN_WINDOW
);

1665 
	`gtk_wšdow_£t_ty³_hšt
(
wšdow
,
GDK_WINDOW_TYPE_HINT_MENU
);

1668 
	`gtk_wšdow_£t_deçuÉ_size
 (
	`GTK_WINDOW
 (
wšdow
), 146, 349);

1670 
	`­p_£t_icÚ
 (
	`GTK_WINDOW
 (
wšdow
));

1672 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
wšdow
), "delete_event",

1673 
	`G_CALLBACK
 (
toŞbox_d–‘e
),

1674 
wšdow
);

1676 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
wšdow
), "destroy",

1677 
	`G_CALLBACK
 (
toŞbox_de¡roy
),

1678 
wšdow
);

1680 
maš_vbox
 = 
	`gtk_vbox_Ãw
 (
FALSE
, 1);

1681 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
maš_vbox
), 1);

1682 #ifdeà
GNOME


1683 
	`gnome_­p_£t_cÚ‹Ás
 (
	`GNOME_APP
(
wšdow
), 
maš_vbox
);

1685 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
wšdow
), 
maš_vbox
);

1687 
	`gtk_widg‘_show
 (
maš_vbox
);

1690 
¡©usb¬
 = 
	`gtk_¡©usb¬_Ãw
 ();

1691 
	`gtk_box_·ck_’d
 (
	`GTK_BOX
 (
maš_vbox
), 
¡©usb¬
, 
FALSE
, 
TRUE
, 0);

1693 
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
, 0);

1694 
	`gtk_box_·ck_’d
 (
	`GTK_BOX
 (
maš_vbox
), 
hbox
, 
TRUE
, TRUE, 0);

1695 
	`gtk_widg‘_show
 (
hbox
);

1698 
Ïy”_v›w
 = 
	`ü—‹_Ïy”_v›w_widg‘
 ();

1699 
	`gtk_box_·ck_’d
 (
	`GTK_BOX
 (
hbox
), 
Ïy”_v›w
, 
FALSE
, FALSE, 0);

1702 
nÙebook
 = 
	`gtk_nÙebook_Ãw
 ();

1703 
	`gtk_box_·ck_’d
 (
	`GTK_BOX
 (
hbox
), 
nÙebook
, 
TRUE
, TRUE, 0);

1704 
	`gtk_nÙebook_£t_süŞÏbË
 (
	`GTK_NOTEBOOK
 (
nÙebook
), 
TRUE
);

1705 
	`gtk_widg‘_show
 (
nÙebook
);

1708 
toŞ_ts
 = 
	`gtk_toŞts_Ãw
 ();

1710 
w¿pbox
 = 
	`gtk_hw¿p_box_Ãw
(
FALSE
);

1711 
	`gtk_w¿p_box_£t_a¥eù_¿tio
(
	`GTK_WRAP_BOX
(
w¿pbox
), 144.0 / 318.0);

1712 
	`gtk_w¿p_box_£t_ju¡ify
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
GTK_JUSTIFY_TOP
);

1713 
	`gtk_w¿p_box_£t_lše_ju¡ify
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
GTK_JUSTIFY_LEFT
);

1716 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
w¿pbox
, 
FALSE
, 
TRUE
, 0);

1717 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
w¿pbox
), 0);

1718 
	`gtk_widg‘_show
 (
w¿pbox
);

1720 
	`ü—‹_toŞs
 (
w¿pbox
);

1721 
	`ü—‹_sh“ts
 (
w¿pbox
);

1726 
	`gtk_d¿g_de¡_£t
 (
w¿pbox
,

1727 
GTK_DEST_DEFAULT_ALL
,

1728 
toŞbox_rg‘_bË
, 
toŞbox_n_rg‘s
,

1729 
GDK_ACTION_COPY
);

1730 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
w¿pbox
), "drag_data_received",

1731 
	`G_CALLBACK
 (
dŸ_dnd_fe_d¿g_d©a_»ûived
),

1732 
NULL
);

1736 
	`m’us_g‘_š‹g¿‹d_ui_m’ub¬
(&
m’ub¬
, &
toŞb¬
, &
acûl_group
);

1737 
	`gtk_wšdow_add_acûl_group
 (
	`GTK_WINDOW
 (
wšdow
), 
acûl_group
);

1738 #ifdeà
GNOME


1739 
	`gnome_­p_£t_m’us
 (
	`GNOME_APP
 (
wšdow
), 
	`GTK_MENU_BAR
 (
m’ub¬
));

1741 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
maš_vbox
), 
m’ub¬
, 
FALSE
, 
TRUE
, 0);

1742 
	`gtk_widg‘_show
 (
m’ub¬
);

1747 
	`gtk_toŞb¬_£t_¡yË
 (
	`GTK_TOOLBAR
 (
toŞb¬
), 
GTK_TOOLBAR_ICONS
);

1749 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
maš_vbox
), 
toŞb¬
, 
FALSE
, 
TRUE
, 0);

1750 
	`gtk_widg‘_show
 (
toŞb¬
);

1752 
	`³rsi¡’û_»gi¡”_wšdow
(
	`GTK_WINDOW
(
wšdow
));

1754 
ui
.
maš_wšdow
 = 
	`GTK_WINDOW
 (
wšdow
);

1755 
ui
.
toŞb¬
 = 
	`GTK_TOOLBAR
 (toolbar);

1756 
ui
.
dŸg¿m_nÙebook
 = 
	`GTK_NOTEBOOK
 (
nÙebook
);

1757 
ui
.
¡©usb¬
 = 
	`GTK_STATUSBAR
 (statusbar);

1758 
ui
.
Ïy”_v›w
 =†ayer_view;

1762 
	`š‹g¿‹d_ui_maš_toŞb¬_show
 ();

1763 
	`š‹g¿‹d_ui_maš_¡©usb¬_show
 ();

1766 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
ui
.
maš_wšdow
), 
DIA_MAIN_NOTEBOOK
, 
nÙebook
);

1769 
toŞbox_sh–l
 = 
wšdow
;

1770 
	}
}

1776 
	$ü—‹_toŞbox
 ()

1778 
GtkWidg‘
 *
wšdow
;

1779 
GtkWidg‘
 *
maš_vbox
;

1780 
GtkWidg‘
 *
w¿pbox
;

1781 
GtkWidg‘
 *
m’ub¬
;

1782 
GtkAcûlGroup
 *
acûl_group
;

1784 #ifdeà
GNOME


1785 
wšdow
 = 
	`gnome_­p_Ãw
 ("DŸ", 
	`_
("Diagram Editor"));

1787 
wšdow
 = 
	`gtk_wšdow_Ãw
 (
GTK_WINDOW_TOPLEVEL
);

1788 
	`gtk_widg‘_»f
 (
wšdow
);

1789 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
wšdow
), "DŸ v" 
VERSION
);

1791 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
wšdow
), "toolbox_window");

1792 
	`gtk_wšdow_£t_deçuÉ_size
(
	`GTK_WINDOW
(
wšdow
), 146, 349);

1794 
	`­p_£t_icÚ
 (
	`GTK_WINDOW
 (
wšdow
));

1795 ià(!
	`gtk_wšdow_g‘_icÚ
 (
	`GTK_WINDOW
 (
wšdow
))) {

1796 
GdkPixbuf
 *
pixbuf
 = 
	`gdk_pixbuf_Ãw_äom_šlše
 (-1, 
dŸ_­p_icÚ
, 
FALSE
, 
NULL
);

1797 ià(
pixbuf
) {

1798 
	`gtk_wšdow_£t_icÚ
 (
	`GTK_WINDOW
 (
wšdow
), 
pixbuf
);

1799 
	`g_objeù_uÄef
 (
pixbuf
);

1803 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
wšdow
), "delete_event",

1804 
	`G_CALLBACK
 (
toŞbox_d–‘e
),

1805 
wšdow
);

1807 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
wšdow
), "destroy",

1808 
	`G_CALLBACK
 (
toŞbox_de¡roy
),

1809 
wšdow
);

1811 
maš_vbox
 = 
	`gtk_vbox_Ãw
 (
FALSE
, 1);

1812 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
maš_vbox
), 1);

1813 #ifdeà
GNOME


1814 
	`gnome_­p_£t_cÚ‹Ás
(
	`GNOME_APP
(
wšdow
), 
maš_vbox
);

1816 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
wšdow
), 
maš_vbox
);

1818 
	`gtk_widg‘_show
 (
maš_vbox
);

1821 
toŞ_ts
 = 
	`gtk_toŞts_Ãw
 ();

1827 
w¿pbox
 = 
	`gtk_hw¿p_box_Ãw
(
FALSE
);

1828 
	`gtk_w¿p_box_£t_a¥eù_¿tio
(
	`GTK_WRAP_BOX
(
w¿pbox
), 144.0 / 318.0);

1829 
	`gtk_w¿p_box_£t_ju¡ify
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
GTK_JUSTIFY_TOP
);

1830 
	`gtk_w¿p_box_£t_lše_ju¡ify
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
GTK_JUSTIFY_LEFT
);

1834 
	`gtk_box_·ck_’d
 (
	`GTK_BOX
 (
maš_vbox
), 
w¿pbox
, 
TRUE
, TRUE, 0);

1835 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
w¿pbox
), 0);

1836 
	`gtk_widg‘_show
 (
w¿pbox
);

1838 
	`ü—‹_toŞs
 (
w¿pbox
);

1839 
	`ü—‹_sh“ts
 (
w¿pbox
);

1840 
	`ü—‹_cŞÜ_¬—
 (
w¿pbox
);

1841 
	`ü—‹_lš•rİs_¬—
 (
w¿pbox
);

1844 
	`gtk_d¿g_de¡_£t
 (
w¿pbox
,

1845 
GTK_DEST_DEFAULT_ALL
,

1846 
toŞbox_rg‘_bË
, 
toŞbox_n_rg‘s
,

1847 
GDK_ACTION_COPY
);

1848 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
w¿pbox
), "drag_data_received",

1849 
	`G_CALLBACK
 (
dŸ_dnd_fe_d¿g_d©a_»ûived
),

1850 
NULL
);

1854 
	`m’us_g‘_toŞbox_m’ub¬
(&
m’ub¬
, &
acûl_group
);

1855 
	`gtk_wšdow_add_acûl_group
 (
	`GTK_WINDOW
 (
wšdow
), 
acûl_group
);

1856 #ifdeà
GNOME


1857 
	`gnome_­p_£t_m’us
(
	`GNOME_APP
(
wšdow
), 
	`GTK_MENU_BAR
(
m’ub¬
));

1859 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
maš_vbox
), 
m’ub¬
, 
FALSE
, 
TRUE
, 0);

1860 
	`gtk_widg‘_show
 (
m’ub¬
);

1862 
	`³rsi¡’û_»gi¡”_wšdow
(
	`GTK_WINDOW
(
wšdow
));

1864 
toŞbox_sh–l
 = 
wšdow
;

1865 
	}
}

1868 
	$toŞbox_show
()

1870 
	`gtk_widg‘_show
(
toŞbox_sh–l
);

1871 
	}
}

1874 
	$toŞbox_hide
()

1876 
	`gtk_widg‘_hide
(
toŞbox_sh–l
);

1877 
	}
}

1880 
	$ü—‹_Œ“_wšdow
()

1882 
GtkAùiÚ
 *
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 ("FileTree");

1883 
	`ü—‹_dŸg¿m_Œ“_wšdow
(&
´efs
.
dŸ_Œ“
, 
	`GTK_TOGGLE_ACTION
(
aùiÚ
));

1884 
	}
}

1886 
GtkWidg‘
 *

1887 
	$š‹rçû_g‘_toŞbox_sh–l
()

1889 ià(
	`is_š‹g¿‹d_ui
 ())

1890  
	`GTK_WIDGET
(
ui
.
maš_wšdow
);

1892  
toŞbox_sh–l
;

1893 
	}
}

1898 
gboŞ—n
 
	$š‹g¿‹d_ui_maš_toŞb¬_is_showšg
 ()

1900 ià(
ui
.
toŞb¬
)

1902  
	`GTK_WIDGET_VISIBLE
 (
ui
.
toŞb¬
)? 
TRUE
 : 
FALSE
;

1904  
FALSE
;

1905 
	}
}

1908 
	$š‹g¿‹d_ui_maš_toŞb¬_show
 ()

1910 ià(
ui
.
toŞb¬
)

1912 
GtkAùiÚ
 *
aùiÚ
 = 
NULL
;

1913 
	`gtk_widg‘_show
 (
	`GTK_WIDGET
 (
ui
.
toŞb¬
));

1914 
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 (
VIEW_MAIN_TOOLBAR_ACTION
);

1915 ià(
aùiÚ
)

1916 
	`gtk_toggË_aùiÚ_£t_aùive
 (
	`GTK_TOGGLE_ACTION
 (
aùiÚ
), 
TRUE
);

1918 
	}
}

1921 
	$š‹g¿‹d_ui_maš_toŞb¬_hide
 ()

1923 ià(
ui
.
toŞb¬
)

1925 
GtkAùiÚ
 *
aùiÚ
 = 
NULL
;

1926 
	`gtk_widg‘_hide
 (
	`GTK_WIDGET
 (
ui
.
toŞb¬
));

1927 
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 (
VIEW_MAIN_TOOLBAR_ACTION
);

1928 ià(
aùiÚ
)

1929 
	`gtk_toggË_aùiÚ_£t_aùive
 (
	`GTK_TOGGLE_ACTION
 (
aùiÚ
), 
FALSE
);

1931 
	}
}

1936 
gboŞ—n
 
	$š‹g¿‹d_ui_Ïy”_v›w_is_showšg
 ()

1938 ià(
ui
.
Ïy”_v›w
)

1940  
	`GTK_WIDGET_VISIBLE
 (
ui
.
Ïy”_v›w
)? 
TRUE
 : 
FALSE
;

1942  
FALSE
;

1943 
	}
}

1945 
	$š‹g¿‹d_ui_Ïy”_v›w_show
 ()

1947 ià(
ui
.
Ïy”_v›w
)

1949 
GtkAùiÚ
 *
aùiÚ
 = 
NULL
;

1950 
	`gtk_widg‘_show
 (
ui
.
Ïy”_v›w
);

1951 
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 (
VIEW_LAYERS_ACTION
);

1952 ià(
aùiÚ
)

1954 
	`gtk_toggË_aùiÚ_£t_aùive
 (
	`GTK_TOGGLE_ACTION
 (
aùiÚ
), 
TRUE
);

1957 
	}
}

1959 
	$š‹g¿‹d_ui_Ïy”_v›w_hide
 ()

1961 ià(
ui
.
Ïy”_v›w
)

1963 
GtkAùiÚ
 *
aùiÚ
 = 
NULL
;

1964 
	`gtk_widg‘_hide
 (
ui
.
Ïy”_v›w
);

1965 
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 (
VIEW_LAYERS_ACTION
);

1966 ià(
aùiÚ
)

1968 
	`gtk_toggË_aùiÚ_£t_aùive
 (
	`GTK_TOGGLE_ACTION
 (
aùiÚ
), 
FALSE
);

1971 
	}
}

1976 
gboŞ—n
 
	$š‹g¿‹d_ui_maš_¡©usb¬_is_showšg
 ()

1978 ià(
ui
.
¡©usb¬
)

1980  
	`GTK_WIDGET_VISIBLE
 (
ui
.
¡©usb¬
)? 
TRUE
 : 
FALSE
;

1982  
FALSE
;

1983 
	}
}

1986 
	$š‹g¿‹d_ui_maš_¡©usb¬_show
 ()

1988 ià(
ui
.
¡©usb¬
)

1990 
GtkAùiÚ
 *
aùiÚ
 = 
NULL
;

1991 
	`gtk_widg‘_show
 (
	`GTK_WIDGET
 (
ui
.
¡©usb¬
));

1992 
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 (
VIEW_MAIN_STATUSBAR_ACTION
);

1993 ià(
aùiÚ
)

1994 
	`gtk_toggË_aùiÚ_£t_aùive
 (
	`GTK_TOGGLE_ACTION
 (
aùiÚ
), 
TRUE
);

1996 
	}
}

1999 
	$š‹g¿‹d_ui_maš_¡©usb¬_hide
 ()

2001 ià(
ui
.
¡©usb¬
)

2003 
GtkAùiÚ
 *
aùiÚ
 = 
NULL
;

2004 
	`gtk_widg‘_hide
 (
	`GTK_WIDGET
 (
ui
.
¡©usb¬
));

2005 
aùiÚ
 = 
	`m’us_g‘_aùiÚ
 (
VIEW_MAIN_STATUSBAR_ACTION
);

2006 ià(
aùiÚ
)

2007 
	`gtk_toggË_aùiÚ_£t_aùive
 (
	`GTK_TOGGLE_ACTION
 (
aùiÚ
), 
FALSE
);

2009 
	}
}

	@O:\tool\dvs50\app\interface.h

18 #iâdeà
INTERFACE_H


19 
	#INTERFACE_H


	)

21 
	~"di¥Ïy.h
"

23 
	~"m’us.h
"

24 
	~"di¥_ÿÎbacks.h
"

25 
	~"toŞ.h
"

26 
	~"sh“t.h
"

27 
	~"­p_´ocs.h
"

28 
	~"¬rows.h
"

29 
	~"cŞÜ_¬—.h
"

30 
	~"lšewidth_¬—.h
"

31 
	~"©Œibu‹s.h
"

34 
	#DIA_MAIN_WINDOW
 "dŸ-maš-wšdow"

	)

35 
	#DIA_MAIN_NOTEBOOK
 "dŸ-maš-nÙebook"

	)

38 
	#DIA_TOOLBOX
 "dŸ-toŞbox"

	)

40 
ü—‹_š‹g¿‹d_ui
 ();

42 
gboŞ—n
 
š‹g¿‹d_ui_maš_toŞb¬_is_showšg
 ();

43 
š‹g¿‹d_ui_maš_toŞb¬_show
 ();

44 
š‹g¿‹d_ui_maš_toŞb¬_hide
 ();

46 
gboŞ—n
 
š‹g¿‹d_ui_maš_¡©usb¬_is_showšg
 ();

47 
š‹g¿‹d_ui_maš_¡©usb¬_show
 ();

48 
š‹g¿‹d_ui_maš_¡©usb¬_hide
 ();

50 
gboŞ—n
 
š‹g¿‹d_ui_Ïy”_v›w_is_showšg
 ();

51 
š‹g¿‹d_ui_Ïy”_v›w_show
 ();

52 
š‹g¿‹d_ui_Ïy”_v›w_hide
 ();

54 
is_š‹g¿‹d_ui
 ();

56 
ü—‹_di¥Ïy_sh–l
(
DDi¥Ïy
 *
ddi¥
,

57 
width
, 
height
,

58 *
t™Ë
, 
u£_mb¬
, 
tİ_Ëv–_wšdow
);

60 
ü—‹_toŞbox
 ();

61 
	$__deş¥ec
(
dÎexpÜt
è
	`toŞbox_show
();

62 
	`toŞbox_hide
();

64 
GtkWidg‘
 *
	`š‹rçû_g‘_toŞbox_sh–l
();

66 
	`toŞ_£Ëù_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
);

67 
	`ü—‹_š‹g¿‹d_ui
 ();

68 
	`ü—‹_Œ“_wšdow
();

70 
	`ü—‹_sh“ts
(
GtkWidg‘
 *
·»Á
);

71 
GtkWidg‘
 *
modify_toŞ_bu‰Ú
;

73 
	`v›w_zoom_£t
 (
zoom_çùÜ
);

75 
_ToŞBu‰Ú
 
	tToŞBu‰Ú
;

77 
_ToŞBu‰ÚD©a
 
	tToŞBu‰ÚD©a
;

79 
	s_ToŞBu‰ÚD©a


81 
ToŞTy³
 
ty³
;

82 
gpoš‹r
 
exŒa_d©a
;

83 
gpoš‹r
 
u£r_d©a
;

84 
GtkWidg‘
 *
widg‘
;

87 
	s_ToŞBu‰Ú


89 
gch¬
 **
icÚ_d©a
;

90 *
toŞ_desc
;

91 *
toŞ_acûË¿tÜ
;

92 *
aùiÚ_Çme
;

93 
ToŞBu‰ÚD©a
 
ÿÎback_d©a
;

96 cÚ¡ 
num_toŞs
;

97 
ToŞBu‰Ú
 
toŞ_d©a
[];

98 
gch¬
 *
š‹rçû_cu¼’t_sh“t_Çme
;

100 
	`toŞ_£Ëù_upd©e
 (
GtkWidg‘
 *
w
, 
gpoš‹r
 
d©a
);

101 
	`fl_sh“t_m’u
();

103 #iâdeà
GTK_DISABLE_DEPRECATED


104 
GtkToŞts
 *
toŞ_ts
;

107 
	`şo£_nÙebook_·ge_ÿÎback
 (
GtkBu‰Ú
 *
bu‰Ú
, 
gpoš‹r
 
u£r_d©a
);

	@O:\tool\dvs50\app\layer_dialog.c

25 #ifdeà
HAVE_CONFIG_H


26 
	~<cÚfig.h
>

29 
	~<as£¹.h
>

30 
	~<¡ršg.h
>

31 
	~<gdk/gdkkeysyms.h
>

32 #undeà
GTK_DISABLE_DEPRECATED


33 
	~<gtk/gtk.h
>

35 
	~"š.h
"

37 
	~"Ïy”_dŸlog.h
"

38 
	~"³rsi¡’û.h
"

39 
	~"widg‘s.h
"

40 
	~"š‹rçû.h
"

42 
	~"dŸ-­p-icÚs.h
"

45 
	#DIA_LAYER_WIDGET
(
obj
) \

46 
	`GTK_CHECK_CAST
 (
obj
, 
	`dŸ_Ïy”_widg‘_g‘_ty³
 (), 
DŸLay”Widg‘
)

	)

47 
	#DIA_LAYER_WIDGET_CLASS
(
kÏss
) \

48 
	`GTK_CHECK_CLASS_CAST
 (
kÏss
, 
	`dŸ_Ïy”_widg‘_g‘_ty³
 (), 
DŸLay”Widg‘CÏss
)

	)

49 
	#IS_DIA_LAYER_WIDGET
(
obj
) \

50 
	`GTK_CHECK_TYPE
 (
obj
, 
	`dŸ_Ïy”_widg‘_g‘_ty³
 ())

	)

52 
_DŸLay”Widg‘CÏss
 
	tDŸLay”Widg‘CÏss
;

53 
_Ed™Lay”DŸlog
 
	tEd™Lay”DŸlog
;

55 
	s_DŸLay”Widg‘


57 
GtkLi¡I‹m
 
	mli¡_™em
;

59 
DŸg¿m
 *
	mdŸ
;

60 
Lay”
 *
	mÏy”
;

62 
GtkWidg‘
 *
	mvisibË
;

63 
GtkWidg‘
 *
	mcÚÃùabË
;

64 
GtkWidg‘
 *
	mÏb–
;

66 
Ed™Lay”DŸlog
 *
	med™_dŸlog
;

71 
gboŞ—n
 
	mcÚÃù_Ú
;

75 
gboŞ—n
 
	mcÚÃù_off
;

78 
	s_Ed™Lay”DŸlog


80 
GtkWidg‘
 *
	mdŸlog
;

81 
GtkWidg‘
 *
	mÇme_’Œy
;

82 
DŸLay”Widg‘
 *
	mÏy”_widg‘
;

86 
	s_DŸLay”Widg‘CÏss


88 
GtkLi¡I‹mCÏss
 
	m·»Á_şass
;

91 
GtkTy³
 
dŸ_Ïy”_widg‘_g‘_ty³
();

93 
	sLay”DŸlog


95 
GtkWidg‘
 *
	mdŸlog
;

96 
GtkWidg‘
 *
	mdŸg¿m_om’u
;

98 
GtkWidg‘
 *
	mÏy”_li¡
;

100 
DŸg¿m
 *
	mdŸg¿m
;

103 
Lay”DŸlog
 *
	gÏy”_dŸlog
 = 
NULL
;

105 
_Bu‰ÚD©a
 
	tBu‰ÚD©a
;

107 
	s_Bu‰ÚD©a


109 
gch¬
 *
	m¡ock_Çme
;

110 
gpoš‹r
 
	mÿÎback
;

111 *
	mtoŞt
;

114 
	eLay”ChªgeTy³


116 
	mTYPE_DELETE_LAYER
,

117 
	mTYPE_ADD_LAYER
,

118 
	mTYPE_RAISE_LAYER
,

119 
	mTYPE_LOWER_LAYER
,

122 
	sLay”Chªge


124 
Chªge
 
	mchªge
;

126 
Lay”ChªgeTy³
 
	mty³
;

127 
Lay”
 *
	mÏy”
;

128 
	mšdex
;

129 
	m­¶›d
;

132 
	sLay”Visib™yChªge


134 
Chªge
 
	mchªge
;

136 
GLi¡
 *
	mÜigš®_visib™y
;

137 
Lay”
 *
	mÏy”
;

138 
gboŞ—n
 
	mis_exşusive
;

139 
	m­¶›d
;

148 
gboŞ—n
 
	gš‹º®_ÿÎ
 = 
FALSE
;

150 
Chªge
 *

151 
undo_Ïy”
(
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
, 
Lay”ChªgeTy³
, 
šdex
);

152 
Lay”Visib™yChªge
 *

153 
undo_Ïy”_visib™y
(
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
, 
gboŞ—n
 
exşusive
);

155 
Ïy”_visib™y_chªge_­¶y
(
Lay”Visib™yChªge
 *
chªge
,

156 
DŸg¿m
 *
dŸ
);

158 
Ïy”_dŸlog_Ãw_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
gd©a
);

159 
Ïy”_dŸlog_¿i£_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
gd©a
);

160 
Ïy”_dŸlog_low”_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
gd©a
);

161 
Ïy”_dŸlog_d–‘e_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
gd©a
);

162 
Ïy”_dŸlog_ed™_Ïy”
(
DŸLay”Widg‘
 *
Ïy”_widg‘
, 
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
);

164 
Bu‰ÚD©a
 
	gbu‰Ús
[] =

166 { 
GTK_STOCK_ADD
, 
Ïy”_dŸlog_Ãw_ÿÎback
, 
N_
("New Layer") },

167 { 
GTK_STOCK_GO_UP
, 
Ïy”_dŸlog_¿i£_ÿÎback
, 
N_
("Raise Layer") },

168 { 
GTK_STOCK_GO_DOWN
, 
Ïy”_dŸlog_low”_ÿÎback
, 
N_
("Lower Layer") },

169 { 
GTK_STOCK_DELETE
, 
Ïy”_dŸlog_d–‘e_ÿÎback
, 
N_
("Delete Layer") },

174 
	mBUTTON_NEW
 = 0,

175 
	mBUTTON_RAISE
,

176 
	mBUTTON_LOWER
,

177 
	mBUTTON_DELETE


180 
	#BUTTON_EVENT_MASK
 
GDK_EXPOSURE_MASK
 | 
GDK_ENTER_NOTIFY_MASK
 | 
GDK_LEAVE_NOTIFY_MASK
 | \

181 
GDK_BUTTON_PRESS_MASK
 | 
GDK_BUTTON_RELEASE_MASK


	)

183 
	gnum_bu‰Ús
 = (
bu‰Ús
)/(
Bu‰ÚD©a
);

185 
	#NORMAL
 0

	)

186 
	#SELECTED
 1

	)

187 
	#INSENSITIVE
 2

	)

189 
GtkWidg‘
 *

190 
	$ü—‹_bu‰Ú_box
(
GtkWidg‘
 *
·»Á
, 
gboŞ—n
 
show_Ïb–s
)

192 
GtkWidg‘
 *
bu‰Ú
;

193 
GtkWidg‘
 *
bu‰Ú_box
;

194 
i
;

196 
bu‰Ú_box
 = 
	`gtk_hbox_Ãw
 (
TRUE
, 1);

198 
i
=0; i<
num_bu‰Ús
; i++)

200 ià(
show_Ïb–s
 =ğ
TRUE
)

202 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
bu‰Ús
[
i
].
¡ock_Çme
);

206 
GtkWidg‘
 * 
image
;

208 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw
 ();

210 
image
 = 
	`gtk_image_Ãw_äom_¡ock
 (
bu‰Ús
[
i
].
¡ock_Çme
,

211 
GTK_ICON_SIZE_BUTTON
);

213 
	`gtk_bu‰Ú_£t_image
 (
	`GTK_BUTTON
 (
bu‰Ú
), 
image
);

216 
	`g_sigÇl_cÚÃù_sw­³d
 (
	`GTK_OBJECT
 (
bu‰Ú
), "clicked",

217 
	`G_CALLBACK
(
bu‰Ús
[
i
].
ÿÎback
),

218 
	`GTK_OBJECT
 (
·»Á
));

220 ià(
toŞ_ts
 !ğ
NULL
)

221 
	`gtk_toŞts_£t_t
 (
toŞ_ts
, 
bu‰Ú
, 
	`g‘‹xt
(
bu‰Ús
[
i
].
toŞt
), 
NULL
);

223 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
(
bu‰Ú_box
), 
bu‰Ú
, 
TRUE
, TRUE, 0);

225 
	`gtk_widg‘_show
 (
bu‰Ú
);

228  
bu‰Ú_box
;

229 
	}
}

231 
gšt


232 
	$Ïy”_li¡_ev’ts
 (
GtkWidg‘
 *
widg‘
,

233 
GdkEv’t
 *
ev’t
)

235 
GdkEv’tKey
 *
kev’t
;

236 
GdkEv’tBu‰Ú
 *
bev’t
;

237 
GtkWidg‘
 *
ev’t_widg‘
;

238 
DŸLay”Widg‘
 *
Ïy”_widg‘
;

240 
ev’t_widg‘
 = 
	`gtk_g‘_ev’t_widg‘
 (
ev’t
);

242 ià(
	`GTK_IS_LIST_ITEM
 (
ev’t_widg‘
))

244 
Ïy”_widg‘
 = 
	`DIA_LAYER_WIDGET
(
ev’t_widg‘
);

246 
ev’t
->
ty³
)

248 
GDK_BUTTON_PRESS
:

249 
bev’t
 = (
GdkEv’tBu‰Ú
 *è
ev’t
;

252 
GDK_2BUTTON_PRESS
:

253 
bev’t
 = (
GdkEv’tBu‰Ú
 *è
ev’t
;

254 
	`Ïy”_dŸlog_ed™_Ïy”
(
Ïy”_widg‘
, 
NULL
, NULL);

255  
TRUE
;

257 
GDK_KEY_PRESS
:

258 
kev’t
 = (
GdkEv’tKey
 *è
ev’t
;

259 
kev’t
->
keyv®
)

261 
GDK_Up
:

264 
GDK_Down
:

268  
FALSE
;

270  
TRUE
;

277  
FALSE
;

278 
	}
}

280 
gboŞ—n


281 
	$Ïy”_dŸlog_d–‘e
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

283 
	`gtk_widg‘_hide
(
widg‘
);

285  
TRUE
;

286 
	}
}

289 
	$Ïy”_v›w_hide_bu‰Ú_şicked
 (* 
nÙ_u£d
)

291 
	`š‹g¿‹d_ui_Ïy”_v›w_hide
 ();

292 
	}
}

294 
GtkWidg‘
 * 
	$ü—‹_Ïy”_v›w_widg‘
 ()

296 
GtkWidg‘
 *
vbox
;

297 
GtkWidg‘
 *
hbox
;

298 
GtkWidg‘
 *
Ïb–
;

299 
GtkWidg‘
 *
hide_bu‰Ú
;

300 
GtkRcStyË
 *
rc¡yË
;

301 
GtkWidg‘
 *
image
;

302 
GtkWidg‘
 *
li¡
;

303 
GtkWidg‘
 *
£·¿tÜ
;

304 
GtkWidg‘
 *
süŞËd_wš
;

305 
GtkWidg‘
 *
bu‰Ú_box
;

310 
Ïy”_dŸlog
 = 
	`g_Ãw
 (
Lay”DŸlog
, 1);

312 
Ïy”_dŸlog
->
dŸg¿m
 = 
NULL
;

314 
Ïy”_dŸlog
->
dŸlog
 = 
vbox
 = 
	`gtk_vbox_Ãw
 (
FALSE
, 1);

316 
hbox
 = 
	`gtk_hbox_Ãw
 (
FALSE
, 1);

318 
Ïb–
 = 
	`gtk_Ïb–_Ãw
 (
	`_
 ("Layers:"));

319 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
Ïb–
, 
FALSE
, FALSE, 2);

320 
	`gtk_widg‘_show
 (
Ïb–
);

322 
Ïy”_dŸlog
->
dŸg¿m_om’u
 = 
NULL
;

325 
hide_bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw
 ();

326 
	`gtk_bu‰Ú_£t_»l›f
 (
	`GTK_BUTTON
 (
hide_bu‰Ú
), 
GTK_RELIEF_NONE
);

327 
	`gtk_bu‰Ú_£t_focus_Ú_şick
 (
	`GTK_BUTTON
 (
hide_bu‰Ú
), 
FALSE
);

330 
rc¡yË
 = 
	`gtk_rc_¡yË_Ãw
 ();

331 
rc¡yË
->
xthickÃss
 =„c¡yË->
ythickÃss
 = 0;

332 
	`gtk_widg‘_modify_¡yË
 (
hide_bu‰Ú
, 
rc¡yË
);

333 
	`gtk_rc_¡yË_uÄef
 (
rc¡yË
);

335 
image
 = 
	`gtk_image_Ãw_äom_¡ock
 (
GTK_STOCK_CLOSE
,

336 
GTK_ICON_SIZE_MENU
);

338 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
(
hide_bu‰Ú
), 
image
);

339 
	`gtk_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
hide_bu‰Ú
), "clicked",

340 
	`GTK_SIGNAL_FUNC
 (
Ïy”_v›w_hide_bu‰Ú_şicked
), 
NULL
);

342 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
hide_bu‰Ú
, 
FALSE
, FALSE, 2);

344 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
(
vbox
), 
hbox
, 
FALSE
, FALSE, 2);

345 
	`gtk_widg‘_show_®l
 (
hbox
);

347 
bu‰Ú_box
 = 
	`ü—‹_bu‰Ú_box
(
vbox
, 
FALSE
);

349 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
bu‰Ú_box
, 
FALSE
, FALSE, 2);

350 
	`gtk_widg‘_show
 (
bu‰Ú_box
);

352 
£·¿tÜ
 = 
	`gtk_h£·¿tÜ_Ãw
();

353 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
), 
£·¿tÜ
, 
FALSE
, FALSE, 2);

354 
	`gtk_widg‘_show
 (
£·¿tÜ
);

356 
süŞËd_wš
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
, NULL);

357 
	`gtk_süŞËd_wšdow_£t_pŞicy
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËd_wš
),

358 
GTK_POLICY_AUTOMATIC
,

359 
GTK_POLICY_AUTOMATIC
);

360 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
süŞËd_wš
, 
TRUE
, TRUE, 2);

362 
Ïy”_dŸlog
->
Ïy”_li¡
 = 
li¡
 = 
	`gtk_li¡_Ãw
();

364 
	`gtk_li¡_£t_£ËùiÚ_mode
 (
	`GTK_LIST
 (
li¡
), 
GTK_SELECTION_BROWSE
);

365 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËd_wš
), 
li¡
);

366 
	`gtk_cÚš”_£t_focus_vadju¡m’t
 (
	`GTK_CONTAINER
 (
li¡
),

367 
	`gtk_süŞËd_wšdow_g‘_vadju¡m’t
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËd_wš
)));

368 
	`gtk_widg‘_show
 (
süŞËd_wš
);

369 
	`gtk_widg‘_show
 (
li¡
);

371 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
li¡
), "event",

372 (
GtkSigÇlFunc
è
Ïy”_li¡_ev’ts
,

373 
NULL
);

375  
vbox
;

376 
	}
}

379 
	$ü—‹_Ïy”_dŸlog
()

381 
GtkWidg‘
 *
dŸlog
;

382 
GtkWidg‘
 *
vbox
;

383 
GtkWidg‘
 *
hbox
;

384 
GtkWidg‘
 *
Ïb–
;

385 
GtkWidg‘
 *
om’u
;

386 
GtkWidg‘
 *
m’u
;

387 
GtkWidg‘
 *
li¡
;

388 
GtkWidg‘
 *
£·¿tÜ
;

389 
GtkWidg‘
 *
süŞËd_wš
;

390 
GtkWidg‘
 *
bu‰Ú_box
;

391 
GtkWidg‘
 *
bu‰Ú
;

393 
Ïy”_dŸlog
 = 
	`g_Ãw
(
Lay”DŸlog
, 1);

395 
Ïy”_dŸlog
->
dŸg¿m
 = 
NULL
;

397 
Ïy”_dŸlog
->
dŸlog
 = dŸlog = 
	`gtk_dŸlog_Ãw
 ();

398 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
dŸlog
), 
	`_
("Layers"));

399 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
dŸlog
), "layer_window");

400 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
dŸlog
), 
TRUE
);

402 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
dŸlog
), "delete_event",

403 
	`G_CALLBACK
(
Ïy”_dŸlog_d–‘e
), 
NULL
);

404 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
dŸlog
), "destroy",

405 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
),

406 &(
Ïy”_dŸlog
->
dŸlog
));

408 
vbox
 = 
	`GTK_DIALOG
(
dŸlog
)->vbox;

410 
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
, 1);

412 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Diagram:"));

413 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
), 
Ïb–
, 
FALSE
, FALSE, 2);

414 
	`gtk_widg‘_show
 (
Ïb–
);

416 
Ïy”_dŸlog
->
dŸg¿m_om’u
 = 
om’u
 = 
	`gtk_İtiÚ_m’u_Ãw
();

417 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
), 
om’u
, 
TRUE
, TRUE, 2);

418 
	`gtk_widg‘_show
 (
om’u
);

420 
m’u
 = 
	`gtk_m’u_Ãw
();

421 
	`gtk_İtiÚ_m’u_£t_m’u
(
	`GTK_OPTION_MENU
(
om’u
), 
m’u
);

423 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
), 
hbox
, 
FALSE
, FALSE, 2);

424 
	`gtk_widg‘_show
 (
hbox
);

426 
£·¿tÜ
 = 
	`gtk_h£·¿tÜ_Ãw
();

427 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
), 
£·¿tÜ
, 
FALSE
, FALSE, 2);

428 
	`gtk_widg‘_show
 (
£·¿tÜ
);

430 
süŞËd_wš
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
, NULL);

431 
	`gtk_süŞËd_wšdow_£t_pŞicy
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËd_wš
),

432 
GTK_POLICY_AUTOMATIC
,

433 
GTK_POLICY_AUTOMATIC
);

434 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
süŞËd_wš
, 
TRUE
, TRUE, 2);

436 
Ïy”_dŸlog
->
Ïy”_li¡
 = 
li¡
 = 
	`gtk_li¡_Ãw
();

438 
	`gtk_li¡_£t_£ËùiÚ_mode
 (
	`GTK_LIST
 (
li¡
), 
GTK_SELECTION_BROWSE
);

439 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËd_wš
), 
li¡
);

440 
	`gtk_cÚš”_£t_focus_vadju¡m’t
 (
	`GTK_CONTAINER
 (
li¡
),

441 
	`gtk_süŞËd_wšdow_g‘_vadju¡m’t
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËd_wš
)));

442 
	`gtk_widg‘_show
 (
süŞËd_wš
);

443 
	`gtk_widg‘_show
 (
li¡
);

445 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
li¡
), "event",

446 (
GtkSigÇlFunc
è
Ïy”_li¡_ev’ts
,

447 
NULL
);

449 
bu‰Ú_box
 = 
	`ü—‹_bu‰Ú_box
(
dŸlog
, 
TRUE
);

451 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
bu‰Ú_box
, 
FALSE
, FALSE, 2);

452 
	`gtk_widg‘_show
 (
bu‰Ú_box
);

454 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dŸlog
)->
aùiÚ_¬—
),

457 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_CLOSE
);

458 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
	`GTK_DIALOG
 (
dŸlog
)->
aùiÚ_¬—
),

459 
bu‰Ú
, 
TRUE
, TRUE, 0);

460 
	`g_sigÇl_cÚÃù_sw­³d
(
	`GTK_OBJECT
 (
bu‰Ú
), "clicked",

461 
	`G_CALLBACK
(
gtk_widg‘_hide
),

462 
	`GTK_OBJECT
(
dŸlog
));

464 
	`gtk_widg‘_show
 (
bu‰Ú
);

466 
	`³rsi¡’û_»gi¡”_wšdow
(
	`GTK_WINDOW
(
dŸlog
));

468 
	`Ïy”_dŸlog_upd©e_dŸg¿m_li¡
();

469 
	}
}

472 
	$dŸ_Ïy”_£Ëù_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

474 
DŸLay”Widg‘
 *
lw
;

475 
lw
 = 
	`DIA_LAYER_WIDGET
(
widg‘
);

479 ià(
lw
->
dŸ
->
d©a
->
aùive_Ïy”
 !ğlw->
Ïy”
)

481 
	`dŸg¿m_»move_®l_£Ëùed
(
lw
->
dŸ
, 
TRUE
);

483 
	`dŸg¿m_upd©e_ex‹Ás
(
lw
->
dŸ
);

484 
	`d©a_£t_aùive_Ïy”
(
lw
->
dŸ
->
d©a
,†w->
Ïy”
);

485 
	`dŸg¿m_add_upd©e_®l
(
lw
->
dŸ
);

486 
	`dŸg¿m_æush
(
lw
->
dŸ
);

488 
š‹º®_ÿÎ
 = 
TRUE
;

489 ià(
lw
->
cÚÃù_off
)

491 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
lw
->
cÚÃùabË
), 
FALSE
);

495 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
lw
->
cÚÃùabË
), 
TRUE
);

497 
š‹º®_ÿÎ
 = 
FALSE
;

498 
	}
}

501 
	$dŸ_Ïy”_de£Ëù_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

503 
DŸLay”Widg‘
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
widg‘
);

506 ià(
Ïy”_dŸlog
 =ğ
NULL
 ||†ay”_dŸlog->
dŸg¿m
 == NULL) ;

508 
š‹º®_ÿÎ
 = 
TRUE
;

510 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
lw
->
cÚÃùabË
),

511 
lw
->
cÚÃù_Ú
);

512 
š‹º®_ÿÎ
 = 
FALSE
;

513 
	}
}

517 
	$Ïy”_dŸlog_Ãw_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
gd©a
)

519 
Lay”
 *
Ïy”
;

520 
DŸg¿m
 *
dŸ
;

521 
GtkWidg‘
 *
£Ëùed
;

522 
GLi¡
 *
li¡
 = 
NULL
;

523 
GtkWidg‘
 *
Ïy”_widg‘
;

524 
pos
;

525 
Ãxt_Ïy”_num
 = 1;

527 
dŸ
 = 
Ïy”_dŸlog
->
dŸg¿m
;

529 ià(
dŸ
 !ğ
NULL
)

531 
gch¬
* 
Ãw_Ïy”_Çme
 = 
	`g_¡rdup_´štf
(
	`_
("New†ayer %d"),

532 
Ãxt_Ïy”_num
++);

533 
Ïy”
 = 
	`Ãw_Ïy”
(
Ãw_Ïy”_Çme
, 
dŸ
->
d©a
);

535 
	`as£¹
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
)->
£ËùiÚ
 !ğ
NULL
);

536 
£Ëùed
 = 
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
)->
£ËùiÚ
->
d©a
;

537 
pos
 = 
	`gtk_li¡_chd_pos™iÚ
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
£Ëùed
);

539 
	`d©a_add_Ïy”_©
(
dŸ
->
d©a
, 
Ïy”
, dŸ->d©a->
Ïy”s
->
Ën
 - 
pos
);

541 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

542 
	`dŸg¿m_æush
(
dŸ
);

544 
Ïy”_widg‘
 = 
	`dŸ_Ïy”_widg‘_Ãw
(
dŸ
, 
Ïy”
);

545 
	`gtk_widg‘_show
(
Ïy”_widg‘
);

547 
li¡
 = 
	`g_li¡_´•’d
Öi¡, 
Ïy”_widg‘
);

549 
	`gtk_li¡_š£¹_™ems
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
li¡
, 
pos
);

551 
	`gtk_li¡_£Ëù_™em
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
pos
);

553 
	`undo_Ïy”
(
dŸ
, 
Ïy”
, 
TYPE_ADD_LAYER
, dŸ->
d©a
->
Ïy”s
->
Ën
 - 
pos
);

554 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

556 
	}
}

559 
	$Ïy”_dŸlog_d–‘e_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
gd©a
)

561 
DŸg¿m
 *
dŸ
;

562 
GtkWidg‘
 *
£Ëùed
;

563 
Lay”
 *
Ïy”
;

564 
pos
;

566 
dŸ
 = 
Ïy”_dŸlog
->
dŸg¿m
;

568 ià((
dŸ
 !ğ
NULL
è&& (dŸ->
d©a
->
Ïy”s
->
Ën
>1))

570 
	`as£¹
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
)->
£ËùiÚ
 !ğ
NULL
);

571 
£Ëùed
 = 
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
)->
£ËùiÚ
->
d©a
;

573 
Ïy”
 = 
dŸ
->
d©a
->
aùive_Ïy”
;

575 
	`d©a_d–‘e_Ïy”
(
dŸ
->
d©a
, 
Ïy”
);

576 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

577 
	`dŸg¿m_æush
(
dŸ
);

579 
pos
 = 
	`gtk_li¡_chd_pos™iÚ
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
£Ëùed
);

580 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
£Ëùed
);

582 
	`undo_Ïy”
(
dŸ
, 
Ïy”
, 
TYPE_DELETE_LAYER
,

583 
dŸ
->
d©a
->
Ïy”s
->
Ën
 - 
pos
);

584 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

586 ià(--
pos
<0)

587 
pos
 = 0;

589 
	`gtk_li¡_£Ëù_™em
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
pos
);

591 
	}
}

594 
	$Ïy”_dŸlog_¿i£_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
gd©a
)

596 
Lay”
 *
Ïy”
;

597 
DŸg¿m
 *
dŸ
;

598 
GtkWidg‘
 *
£Ëùed
;

599 
GLi¡
 *
li¡
 = 
NULL
;

600 
pos
;

602 
dŸ
 = 
Ïy”_dŸlog
->
dŸg¿m
;

604 ià((
dŸ
 !ğ
NULL
è&& (dŸ->
d©a
->
Ïy”s
->
Ën
>1))

606 
	`as£¹
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
)->
£ËùiÚ
 !ğ
NULL
);

607 
£Ëùed
 = 
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
)->
£ËùiÚ
->
d©a
;

609 
pos
 = 
	`gtk_li¡_chd_pos™iÚ
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
£Ëùed
);

611 ià(
pos
 > 0)

613 
Ïy”
 = 
	`DIA_LAYER_WIDGET
(
£Ëùed
)->layer;

614 
	`d©a_¿i£_Ïy”
(
dŸ
->
d©a
, 
Ïy”
);

616 
li¡
 = 
	`g_li¡_´•’d
Öi¡, 
£Ëùed
);

618 
	`gtk_widg‘_»f
(
£Ëùed
);

620 
	`gtk_li¡_»move_™ems
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
),

621 
li¡
);

623 
	`gtk_li¡_š£¹_™ems
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
),

624 
li¡
, 
pos
 - 1);

626 
	`gtk_widg‘_uÄef
(
£Ëùed
);

628 
	`gtk_li¡_£Ëù_™em
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
pos
-1);

630 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

631 
	`dŸg¿m_æush
(
dŸ
);

633 
	`undo_Ïy”
(
dŸ
, 
Ïy”
, 
TYPE_RAISE_LAYER
, 0);

634 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

638 
	}
}

641 
	$Ïy”_dŸlog_low”_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
gd©a
)

643 
Lay”
 *
Ïy”
;

644 
DŸg¿m
 *
dŸ
;

645 
GtkWidg‘
 *
£Ëùed
;

646 
GLi¡
 *
li¡
 = 
NULL
;

647 
pos
;

649 
dŸ
 = 
Ïy”_dŸlog
->
dŸg¿m
;

651 ià((
dŸ
 !ğ
NULL
è&& (dŸ->
d©a
->
Ïy”s
->
Ën
>1))

653 
	`as£¹
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
)->
£ËùiÚ
 !ğ
NULL
);

654 
£Ëùed
 = 
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
)->
£ËùiÚ
->
d©a
;

656 
pos
 = 
	`gtk_li¡_chd_pos™iÚ
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
£Ëùed
);

658 ià(
pos
 < 
dŸ
->
d©a
->
Ïy”s
->
Ën
-1)

660 
Ïy”
 = 
	`DIA_LAYER_WIDGET
(
£Ëùed
)->layer;

661 
	`d©a_low”_Ïy”
(
dŸ
->
d©a
, 
Ïy”
);

663 
li¡
 = 
	`g_li¡_´•’d
Öi¡, 
£Ëùed
);

665 
	`gtk_widg‘_»f
(
£Ëùed
);

667 
	`gtk_li¡_»move_™ems
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
),

668 
li¡
);

670 
	`gtk_li¡_š£¹_™ems
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
),

671 
li¡
, 
pos
 + 1);

673 
	`gtk_widg‘_uÄef
(
£Ëùed
);

675 
	`gtk_li¡_£Ëù_™em
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
pos
+1);

677 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

678 
	`dŸg¿m_æush
(
dŸ
);

680 
	`undo_Ïy”
(
dŸ
, 
Ïy”
, 
TYPE_LOWER_LAYER
, 0);

681 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

685 
	}
}

689 
	$Ïy”_dŸlog_£Ëù_dŸg¿m_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
gd©a
)

691 
DŸg¿m
 *
dŸ
 = (DŸg¿m *è
gd©a
;

693 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸ
);

694 
	}
}

697 
	$Ïy”_dŸlog_upd©e_dŸg¿m_li¡
()

699 
GtkWidg‘
 *
Ãw_m’u
;

700 
GtkWidg‘
 *
m’u_™em
;

701 
GLi¡
 *
dŸ_li¡
;

702 
DŸg¿m
 *
dŸ
;

703 *
f’ame
;

704 
i
;

705 
cu¼’t_Ä
;

707 ià(
Ïy”_dŸlog
 =ğ
NULL
 ||†ay”_dŸlog->
dŸlog
 == NULL)

709 ià(!
	`dŸ_İ’_dŸg¿ms
())

712 
	`ü—‹_Ïy”_dŸlog
();

715 ià(!
Ïy”_dŸlog
->
dŸg¿m_om’u
)

718 
Ãw_m’u
 = 
	`gtk_m’u_Ãw
();

720 
cu¼’t_Ä
 = -1;

722 
i
 = 0;

723 
dŸ_li¡
 = 
	`dŸ_İ’_dŸg¿ms
();

724 
dŸ_li¡
 !ğ
NULL
)

726 
dŸ
 = (
DŸg¿m
 *è
dŸ_li¡
->
d©a
;

728 ià(
dŸ
 =ğ
Ïy”_dŸlog
->
dŸg¿m
)

730 
cu¼’t_Ä
 = 
i
;

733 
f’ame
 = 
	`¡¼chr
(
dŸ
->f’ame, 
G_DIR_SEPARATOR
);

734 ià(
f’ame
==
NULL
)

736 
f’ame
 = 
dŸ
->filename;

740 
f’ame
++;

743 
m’u_™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
f’ame
);

745 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
m’u_™em
), "activate",

746 (
GtkSigÇlFunc
è
Ïy”_dŸlog_£Ëù_dŸg¿m_ÿÎback
,

747 (
gpoš‹r
è
dŸ
);

749 
	`gtk_m’u_­³nd
Ğ
	`GTK_MENU
(
Ãw_m’u
), 
m’u_™em
);

750 
	`gtk_widg‘_show
 (
m’u_™em
);

752 
dŸ_li¡
 = 
	`g_li¡_Ãxt
(dia_list);

753 
i
++;

756 ià(
	`dŸ_İ’_dŸg¿ms
()==
NULL
)

758 
m’u_™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
 (
	`_
("none"));

759 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
m’u_™em
), "activate",

760 (
GtkSigÇlFunc
è
Ïy”_dŸlog_£Ëù_dŸg¿m_ÿÎback
,

761 (
gpoš‹r
è
NULL
);

762 
	`gtk_m’u_­³nd
Ğ
	`GTK_MENU
(
Ãw_m’u
), 
m’u_™em
);

763 
	`gtk_widg‘_show
 (
m’u_™em
);

766 
	`gtk_İtiÚ_m’u_»move_m’u
(
	`GTK_OPTION_MENU
(
Ïy”_dŸlog
->
dŸg¿m_om’u
));

768 
	`gtk_İtiÚ_m’u_£t_m’u
(
	`GTK_OPTION_MENU
(
Ïy”_dŸlog
->
dŸg¿m_om’u
),

769 
Ãw_m’u
);

771 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
(
	`GTK_OPTION_MENU
(
Ïy”_dŸlog
->
dŸg¿m_om’u
),

772 
cu¼’t_Ä
);

773 
	`gtk_m’u_£t_aùive
(
	`GTK_MENU
(
Ãw_m’u
), 
cu¼’t_Ä
);

775 ià(
cu¼’t_Ä
 == -1)

777 
dŸ
 = 
NULL
;

778 ià(
	`dŸ_İ’_dŸg¿ms
()!=
NULL
)

780 
dŸ
 = (
DŸg¿m
 *è
	`dŸ_İ’_dŸg¿ms
()->
d©a
;

782 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸ
);

784 
	}
}

787 
	$Ïy”_dŸlog_show
()

789 ià(
	`is_š‹g¿‹d_ui
 (è=ğ
FALSE
)

791 ià(
Ïy”_dŸlog
 =ğ
NULL
 ||†ay”_dŸlog->
dŸlog
 == NULL)

792 
	`ü—‹_Ïy”_dŸlog
();

793 
	`gtk_wšdow_´e£Á
(
	`GTK_WINDOW
(
Ïy”_dŸlog
->
dŸlog
));

795 
	}
}

804 
	$_Ïy”_widg‘_ş—r_Ïy”
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
u£r_d©a
)

806 
DŸLay”Widg‘
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
widg‘
);

807 
lw
->
Ïy”
 = 
NULL
;

808 
	}
}

811 
	$Ïy”_dŸlog_£t_dŸg¿m
(
DŸg¿m
 *
dŸ
)

813 
DŸg¿mD©a
 *
d©a
;

814 
GtkWidg‘
 *
Ïy”_widg‘
;

815 
Lay”
 *
Ïy”
;

816 
Lay”
 *
aùive_Ïy”
 = 
NULL
;

817 
£l_pos
;

818 
i
,
j
;

820 ià(
dŸ
!=
NULL
)

821 
aùive_Ïy”
 = 
dŸ
->
d©a
->active_layer;

823 ià(
Ïy”_dŸlog
 =ğ
NULL
 ||†ay”_dŸlog->
dŸlog
 == NULL)

824 
	`ü—‹_Ïy”_dŸlog
();

826 
	`gtk_cÚš”_fÜ—ch
 (
	`GTK_CONTAINER
(
Ïy”_dŸlog
->
Ïy”_li¡
),

827 
_Ïy”_widg‘_ş—r_Ïy”
, 
NULL
);

828 
	`gtk_li¡_ş—r_™ems
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 0, -1);

829 
Ïy”_dŸlog
->
dŸg¿m
 = 
dŸ
;

830 ià(
dŸ
 !ğ
NULL
)

832 
i
 = 
	`g_li¡_šdex
(
	`dŸ_İ’_dŸg¿ms
(), 
dŸ
);

833 ià(
i
 >ğ0 && 
Ïy”_dŸlog
->
dŸg¿m_om’u
 !ğ
NULL
)

834 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
(
	`GTK_OPTION_MENU
(
Ïy”_dŸlog
->
dŸg¿m_om’u
),

835 
i
);

838 ià(
dŸ
 !ğ
NULL
)

840 
d©a
 = 
dŸ
->data;

842 
£l_pos
 = 0;

843 
i
=
d©a
->
Ïy”s
->
Ën
-1,
j
=0; i>=0; i--,j++)

845 
Ïy”
 = (
Lay”
 *è
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
);

846 
Ïy”_widg‘
 = 
	`dŸ_Ïy”_widg‘_Ãw
(
dŸ
, 
Ïy”
);

847 
	`gtk_widg‘_show
(
Ïy”_widg‘
);

848 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
Ïy”_widg‘
);

849 ià(
Ïy”
==
aùive_Ïy”
)

850 
£l_pos
 = 
j
;

852 
	`gtk_li¡_£Ëù_™em
(
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
), 
£l_pos
);

854 
	}
}

869 
	$dŸ_Ïy”_widg‘_uÄ—lize
(
GtkWidg‘
 *
widg‘
)

871 
DŸLay”Widg‘
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
widg‘
);

873 ià(
lw
->
ed™_dŸlog
 !ğ
NULL
)

875 
	`gtk_widg‘_de¡roy
(
lw
->
ed™_dŸlog
->
dŸlog
);

876 
	`g_ä“
(
lw
->
ed™_dŸlog
);

877 
lw
->
ed™_dŸlog
 = 
NULL
;

880 (* 
	`GTK_WIDGET_CLASS
 (
	`gtk_ty³_şass
(
	`gtk_li¡_™em_g‘_ty³
 ()))->
uÄ—lize
è(
widg‘
);

881 
	}
}

884 
	$dŸ_Ïy”_widg‘_şass_š™
(
DŸLay”Widg‘CÏss
 *
kÏss
)

886 
GtkObjeùCÏss
 *
objeù_şass
;

887 
GtkWidg‘CÏss
 *
widg‘_şass
;

889 
objeù_şass
 = (
GtkObjeùCÏss
*è
kÏss
;

890 
widg‘_şass
 = (
GtkWidg‘CÏss
*è
kÏss
;

892 
widg‘_şass
->
uÄ—lize
 = 
dŸ_Ïy”_widg‘_uÄ—lize
;

893 
	}
}

896 
	$dŸ_Ïy”_widg‘_£t_cÚÃùabË
(
DŸLay”Widg‘
 *
widg‘
, 
gboŞ—n
 
Ú
)

898 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
widg‘
->
cÚÃùabË
), 
Ú
);

899 
	}
}

902 
	$dŸ_Ïy”_widg‘_exşusive_cÚÃùabË
(
DŸLay”Widg‘
 *
Ïy”_widg‘
)

904 
GLi¡
 *
li¡
;

905 
DŸLay”Widg‘
 *
lw
;

906 
Lay”
 *
Ïy”
;

907 
cÚÃùabË
 = 
FALSE
;

908 
i
;

911 
i
=0; i<
Ïy”_widg‘
->
dŸ
->
d©a
->
Ïy”s
->
Ën
; i++)

913 
Ïy”
 = 
	`g_±r_¬¿y_šdex
(
Ïy”_widg‘
->
dŸ
->
d©a
->
Ïy”s
, 
i
);

914 ià(
Ïy”_widg‘
->
Ïy”
 !=†ayer)

916 
cÚÃùabË
 |ğ
Ïy”
->connectable;

921 
li¡
 = 
	`GTK_LIST
(
Ïy”_dŸlog
->
Ïy”_li¡
)->
chd»n
;

922 
li¡
)

924 
lw
 = 
	`DIA_LAYER_WIDGET
(
li¡
->
d©a
);

925 ià(
lw
 !ğ
Ïy”_widg‘
)

926 
	`dŸ_Ïy”_widg‘_£t_cÚÃùabË
(
lw
, !
cÚÃùabË
);

929 
	`dŸ_Ïy”_widg‘_£t_cÚÃùabË
(
lw
, 
TRUE
);

931 
	`gtk_widg‘_queue_d¿w
(
	`GTK_WIDGET
(
lw
));

933 
li¡
 = 
	`g_li¡_Ãxt
(list);

935 
	}
}

937 
gboŞ—n
 
	gshiáed
 = 
FALSE
;

939 
gboŞ—n


940 
	$dŸ_Ïy”_widg‘_bu‰Ú_ev’t
(
GtkWidg‘
 *
widg‘
,

941 
GdkEv’tBu‰Ú
 *
ev’t
,

942 
gpoš‹r
 
u£rd©a
)

944 
DŸLay”Widg‘
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
u£rd©a
);

946 
shiáed
 = 
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
;

947 
š‹º®_ÿÎ
 = 
FALSE
;

949 
	`gtk_widg‘_queue_d¿w
(
	`GTK_WIDGET
(
lw
));

950  
FALSE
;

951 
	}
}

954 
	$dŸ_Ïy”_widg‘_cÚÃùabË_toggËd
(
GtkToggËBu‰Ú
 *
widg‘
,

955 
gpoš‹r
 
u£rd©a
)

957 
DŸLay”Widg‘
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
u£rd©a
);

958 ià(!
lw
->
Ïy”
)

960 ià(
shiáed
)

962 
shiáed
 = 
FALSE
;

963 
š‹º®_ÿÎ
 = 
TRUE
;

964 
	`dŸ_Ïy”_widg‘_exşusive_cÚÃùabË
(
lw
);

965 
š‹º®_ÿÎ
 = 
FALSE
;

969 
lw
->
Ïy”
->
cÚÃùabË
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
widg‘
);

971 ià(
lw
->
Ïy”
 =ğlw->
dŸ
->
d©a
->
aùive_Ïy”
)

973 
lw
->
cÚÃù_off
 = !
	`gtk_toggË_bu‰Ú_g‘_aùive
(
widg‘
);

974 ià(
lw
->
cÚÃù_off
èlw->
cÚÃù_Ú
 = 
FALSE
;

978 
lw
->
cÚÃù_Ú
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
widg‘
);

979 ià(
lw
->
cÚÃù_Ú
èlw->
cÚÃù_off
 = 
FALSE
;

981 
	`gtk_widg‘_queue_d¿w
(
	`GTK_WIDGET
(
lw
));

982 ià(!
š‹º®_ÿÎ
)

984 
	`dŸg¿m_add_upd©e_®l
(
lw
->
dŸ
);

985 
	`dŸg¿m_æush
(
lw
->
dŸ
);

987 
	}
}

990 
	$dŸ_Ïy”_widg‘_visibË_şicked
(
GtkToggËBu‰Ú
 *
widg‘
,

991 
gpoš‹r
 
u£rd©a
)

993 
DŸLay”Widg‘
 *
lw
 = 
	`DIA_LAYER_WIDGET
(
u£rd©a
);

994 
Lay”Visib™yChªge
 *
chªge
;

999 ià(!
š‹º®_ÿÎ
)

1001 
DŸg¿m
 *
dŸ
 = 
lw
->dia;

1002 
chªge
 = 
	`undo_Ïy”_visib™y
(
dŸ
, 
lw
->
Ïy”
, 
shiáed
);

1004 
	`Ïy”_visib™y_chªge_­¶y
(
chªge
, 
dŸ
);

1005 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1007 
	}
}

1010 
	$dŸ_Ïy”_widg‘_š™
(
DŸLay”Widg‘
 *
lw
)

1012 
GtkWidg‘
 *
hbox
;

1013 
GtkWidg‘
 *
visibË
;

1014 
GtkWidg‘
 *
cÚÃùabË
;

1015 
GtkWidg‘
 *
Ïb–
;

1017 
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
, 0);

1019 
lw
->
dŸ
 = 
NULL
;

1020 
lw
->
Ïy”
 = 
NULL
;

1021 
lw
->
ed™_dŸlog
 = 
NULL
;

1023 
lw
->
cÚÃù_Ú
 = 
FALSE
;

1024 
lw
->
cÚÃù_off
 = 
FALSE
;

1026 
lw
->
visibË
 = visible =

1027 
	`dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs
(
dŸ_visibË_icÚ
, 
dŸ_visibË_em±y_icÚ
);

1029 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
visibË
), "button-release-event",

1030 
	`G_CALLBACK
(
dŸ_Ïy”_widg‘_bu‰Ú_ev’t
), 
lw
);

1031 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
visibË
), "button-press-event",

1032 
	`G_CALLBACK
(
dŸ_Ïy”_widg‘_bu‰Ú_ev’t
), 
lw
);

1033 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
visibË
), "clicked",

1034 
	`G_CALLBACK
(
dŸ_Ïy”_widg‘_visibË_şicked
), 
lw
);

1035 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
visibË
, 
FALSE
, 
TRUE
, 2);

1036 
	`gtk_widg‘_show
(
visibË
);

1040 
lw
->
cÚÃùabË
 = connectable =

1041 
	`dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs
(
dŸ_cÚÃùabË_icÚ
,

1042 
dŸ_cÚÃùabË_em±y_icÚ
);

1044 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
cÚÃùabË
), "button-release-event",

1045 
	`G_CALLBACK
(
dŸ_Ïy”_widg‘_bu‰Ú_ev’t
), 
lw
);

1046 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
cÚÃùabË
), "button-press-event",

1047 
	`G_CALLBACK
(
dŸ_Ïy”_widg‘_bu‰Ú_ev’t
), 
lw
);

1048 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
cÚÃùabË
), "clicked",

1049 
	`G_CALLBACK
(
dŸ_Ïy”_widg‘_cÚÃùabË_toggËd
), 
lw
);

1051 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
cÚÃùabË
, 
FALSE
, 
TRUE
, 2);

1052 
	`gtk_widg‘_show
(
cÚÃùabË
);

1054 
lw
->
Ïb–
 =†ab– = 
	`gtk_Ïb–_Ãw
("layer_default_label");

1055 
	`gtk_Ïb–_£t_ju¡ify
(
	`GTK_LABEL
(
Ïb–
), 
GTK_JUSTIFY_LEFT
);

1056 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
), 
Ïb–
, 
FALSE
, 
TRUE
, 0);

1057 
	`gtk_widg‘_show
(
Ïb–
);

1059 
	`gtk_widg‘_show
(
hbox
);

1061 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
lw
), 
hbox
);

1063 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
lw
), "select",

1064 (
GtkSigÇlFunc
è
dŸ_Ïy”_£Ëù_ÿÎback
,

1065 (
gpoš‹r
è
NULL
);

1066 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
lw
), "deselect",

1067 (
GtkSigÇlFunc
è
dŸ_Ïy”_de£Ëù_ÿÎback
,

1068 (
gpoš‹r
è
NULL
);

1069 
	}
}

1071 
GtkTy³


1072 
	$dŸ_Ïy”_widg‘_g‘_ty³
()

1074 
GtkTy³
 
dlw_ty³
 = 0;

1076 ià(!
dlw_ty³
)

1078 cÚ¡ 
GtkTy³Info
 
dlw_šfo
 =

1081  (
DŸLay”Widg‘
),

1082  (
DŸLay”Widg‘CÏss
),

1083 (
GtkCÏssIn™Func
è
dŸ_Ïy”_widg‘_şass_š™
,

1084 (
GtkObjeùIn™Func
è
dŸ_Ïy”_widg‘_š™
,

1085 
NULL
,

1086 
NULL
,

1087 (
GtkCÏssIn™Func
è
NULL
,

1090 
dlw_ty³
 = 
	`gtk_ty³_unique
 (
	`gtk_li¡_™em_g‘_ty³
 (), &
dlw_šfo
);

1093  
dlw_ty³
;

1094 
	}
}

1096 
GtkWidg‘
 *

1097 
	$dŸ_Ïy”_widg‘_Ãw
(
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
)

1099 
GtkWidg‘
 *
widg‘
;

1101 
widg‘
 = 
	`GTK_WIDGET
 ( 
	`gtk_ty³_Ãw
 (
	`dŸ_Ïy”_widg‘_g‘_ty³
 ()));

1102 
	`dŸ_Ïy”_£t_Ïy”
(
	`DIA_LAYER_WIDGET
(
widg‘
), 
dŸ
, 
Ïy”
);

1106 
	`DIA_LAYER_WIDGET
(
widg‘
)->
cÚÃù_Ú
 = 
FALSE
;

1107 
	`DIA_LAYER_WIDGET
(
widg‘
)->
cÚÃù_off
 = 
FALSE
;

1109  
widg‘
;

1110 
	}
}

1114 
	$dŸ_Ïy”_£t_Ïy”
(
DŸLay”Widg‘
 *
widg‘
, 
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
)

1116 
widg‘
->
dŸ
 = dia;

1117 
widg‘
->
Ïy”
 =†ayer;

1119 
	`dŸ_Ïy”_upd©e_äom_Ïy”
(
widg‘
);

1120 
	}
}

1123 
	$dŸ_Ïy”_upd©e_äom_Ïy”
 (
DŸLay”Widg‘
 *
widg‘
)

1125 
š‹º®_ÿÎ
 = 
TRUE
;

1126 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
widg‘
->
visibË
),

1127 
widg‘
->
Ïy”
->
visibË
);

1129 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
widg‘
->
cÚÃùabË
),

1130 
widg‘
->
Ïy”
->
cÚÃùabË
);

1131 
š‹º®_ÿÎ
 = 
FALSE
;

1133 
	`gtk_Ïb–_£t_‹xt
 (
	`GTK_LABEL
 (
widg‘
->
Ïb–
), widg‘->
Ïy”
->
Çme
);

1134 
	}
}

1142 
	$ed™_Ïy”_ok_ÿÎback
 (
GtkWidg‘
 *
w
, 
gpoš‹r
 
ş›Á_d©a
)

1144 
Ed™Lay”DŸlog
 *
dŸlog
 = (Ed™Lay”DŸlog *è
ş›Á_d©a
;

1145 
Lay”
 *
Ïy”
;

1147 
	`g_»tuº_if_ç
 (
dŸlog
->
Ïy”_widg‘
 !ğ
NULL
);

1149 
Ïy”
 = 
dŸlog
->
Ïy”_widg‘
->layer;

1151 
	`g_ä“
 (
Ïy”
->
Çme
);

1152 
Ïy”
->
Çme
 = 
	`g_¡rdup
 (
	`gtk_’Œy_g‘_‹xt
 (
	`GTK_ENTRY
 (
dŸlog
->
Çme_’Œy
)));

1154 
	`dŸg¿m_add_upd©e_®l
 (
dŸlog
->
Ïy”_widg‘
->
dŸ
);

1155 
	`dŸg¿m_æush
 (
dŸlog
->
Ïy”_widg‘
->
dŸ
);

1157 
	`dŸ_Ïy”_upd©e_äom_Ïy”
 (
dŸlog
->
Ïy”_widg‘
);

1159 
dŸlog
->
Ïy”_widg‘
->
ed™_dŸlog
 = 
NULL
;

1160 
	`gtk_widg‘_de¡roy
 (
dŸlog
->dialog);

1161 
	`g_ä“
 (
dŸlog
);

1162 
	}
}

1165 
	$ed™_Ïy”_add_ok_ÿÎback
 (
GtkWidg‘
 *
w
, 
gpoš‹r
 
ş›Á_d©a
)

1167 
Ed™Lay”DŸlog
 *
dŸlog
 = (Ed™Lay”DŸlog *è
ş›Á_d©a
;

1168 
DŸg¿m
 *
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

1169 
Lay”
 *
Ïy”
;

1170 
pos
 = 
	`d©a_Ïy”_g‘_šdex
 (
dŸ
->
d©a
, dŸ->d©a->
aùive_Ïy”
) + 1;

1172 
Ïy”
 = 
	`Ãw_Ïy”
(
	`g_¡rdup
 (
	`gtk_’Œy_g‘_‹xt
 (
	`GTK_ENTRY
 (
dŸlog
->
Çme_’Œy
))), 
dŸ
->
d©a
);

1173 
	`d©a_add_Ïy”_©
(
dŸ
->
d©a
, 
Ïy”
, 
pos
);

1174 
	`d©a_£t_aùive_Ïy”
(
dŸ
->
d©a
, 
Ïy”
);

1176 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

1177 
	`dŸg¿m_æush
(
dŸ
);

1179 
	`undo_Ïy”
(
dŸ
, 
Ïy”
, 
TYPE_ADD_LAYER
, 
pos
);

1180 
	`undo_£t_Œª§ùiÚpošt
(
dŸ
->
undo
);

1182 
	`gtk_widg‘_de¡roy
 (
dŸlog
->dialog);

1183 
	`g_ä“
 (
dŸlog
);

1184 
	}
}

1187 
	$ed™_Ïy”_»Çme_ok_ÿÎback
 (
GtkWidg‘
 *
w
, 
gpoš‹r
 
ş›Á_d©a
)

1189 
Ed™Lay”DŸlog
 *
dŸlog
 = (Ed™Lay”DŸlog *è
ş›Á_d©a
;

1190 
DŸg¿m
 *
dŸ
 = 
	`ddi¥Ïy_aùive_dŸg¿m
();

1191 
Lay”
 *
Ïy”
 = 
dŸ
->
d©a
->
aùive_Ïy”
;

1193 
	`g_ä“
 (
Ïy”
->
Çme
);

1194 
Ïy”
->
Çme
 = 
	`g_¡rdup
 (
	`gtk_’Œy_g‘_‹xt
 (
	`GTK_ENTRY
 (
dŸlog
->
Çme_’Œy
)));

1196 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

1197 
	`dŸg¿m_æush
(
dŸ
);

1200 
	`gtk_widg‘_de¡roy
 (
dŸlog
->dialog);

1201 
	`g_ä“
 (
dŸlog
);

1202 
	}
}

1204 
	$ed™_Ïy”_ÿnûl_ÿÎback
 (
GtkWidg‘
 *
w
,

1205 
gpoš‹r
 
ş›Á_d©a
)

1207 
Ed™Lay”DŸlog
 *
dŸlog
;

1209 
dŸlog
 = (
Ed™Lay”DŸlog
 *è
ş›Á_d©a
;

1211 ià(
dŸlog
->
Ïy”_widg‘
)

1212 
dŸlog
->
Ïy”_widg‘
->
ed™_dŸlog
 = 
NULL
;

1213 ià(
dŸlog
->dŸlog !ğ
NULL
)

1214 
	`gtk_widg‘_de¡roy
 (
dŸlog
->dialog);

1215 
	`g_ä“
 (
dŸlog
);

1216 
	}
}

1218 
gšt


1219 
	$ed™_Ïy”_d–‘e_ÿÎback
 (
GtkWidg‘
 *
w
,

1220 
GdkEv’t
 *
e
,

1221 
gpoš‹r
 
ş›Á_d©a
)

1223 
	`ed™_Ïy”_ÿnûl_ÿÎback
 (
w
, 
ş›Á_d©a
);

1225  
TRUE
;

1226 
	}
}

1229 
	$Ïy”_dŸlog_ed™_Ïy”
 (
DŸLay”Widg‘
 *
Ïy”_widg‘
, 
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
)

1231 
Ed™Lay”DŸlog
 *
dŸlog
;

1232 
GtkWidg‘
 *
vbox
;

1233 
GtkWidg‘
 *
hbox
;

1234 
GtkWidg‘
 *
Ïb–
;

1235 
GtkWidg‘
 *
bu‰Ú
;

1238 
dŸlog
 = (
Ed™Lay”DŸlog
 *è
	`g_m®loc
 ( (EditLayerDialog));

1239 
dŸlog
->
Ïy”_widg‘
 =†ayer_widget;

1242 
dŸlog
->dŸlog = 
	`gtk_dŸlog_Ãw
 ();

1243 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
dŸlog
->dialog), "edit_layer_attrributes");

1244 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
dŸlog
->dialog),

1245 (
Ïy”_widg‘
 || 
Ïy”
è? 
	`_
("Edit Layer") : _("Add Layer"));

1246 
	`gtk_wšdow_£t_pos™iÚ
 (
	`GTK_WINDOW
 (
dŸlog
->dŸlog), 
GTK_WIN_POS_MOUSE
);

1249 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
dŸlog
->dialog), "delete_event",

1250 
	`G_CALLBACK
 (
ed™_Ïy”_d–‘e_ÿÎback
),

1251 
dŸlog
);

1252 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
dŸlog
->dialog), "destroy",

1253 
	`G_CALLBACK
 (
gtk_widg‘_de¡roy
),

1254 &
dŸlog
->dialog);

1257 
vbox
 = 
	`gtk_vbox_Ãw
 (
FALSE
, 1);

1258 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
vbox
), 2);

1259 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
	`GTK_DIALOG
 (
dŸlog
->dŸlog)->
vbox
), vbox, 
TRUE
, TRUE, 0);

1262 
hbox
 = 
	`gtk_hbox_Ãw
 (
FALSE
, 1);

1263 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
hbox
, 
FALSE
, FALSE, 0);

1264 
Ïb–
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("Layer‚ame:"));

1265 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
Ïb–
, 
FALSE
, FALSE, 0);

1266 
	`gtk_widg‘_show
 (
Ïb–
);

1267 
dŸlog
->
Çme_’Œy
 = 
	`gtk_’Œy_Ãw
 ();

1268 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
dŸlog
->
Çme_’Œy
, 
TRUE
, TRUE, 0);

1269 ià(
Ïy”_widg‘
)

1270 
	`gtk_’Œy_£t_‹xt
 (
	`GTK_ENTRY
 (
dŸlog
->
Çme_’Œy
), 
Ïy”_widg‘
->
Ïy”
->
Çme
);

1271 ià(
Ïy”
)

1272 
	`gtk_’Œy_£t_‹xt
 (
	`GTK_ENTRY
 (
dŸlog
->
Çme_’Œy
), 
Ïy”
->
Çme
);

1273 ià(
dŸ
)

1275 
gch¬
 *
Çme
 = 
	`g_¡rdup_´štf
 (
	`_
("New†ay” %d"), 
dŸ
->
d©a
->
Ïy”s
->
Ën
);

1276 
	`gtk_’Œy_£t_‹xt
 (
	`GTK_ENTRY
 (
dŸlog
->
Çme_’Œy
), 
Çme
);

1277 
	`g_ä“
 (
Çme
);

1280 
	`gtk_widg‘_show
 (
dŸlog
->
Çme_’Œy
);

1281 
	`gtk_widg‘_show
 (
hbox
);

1283 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_OK
);

1284 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú
, 
GTK_CAN_DEFAULT
);

1285 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
	`GTK_DIALOG
 (
dŸlog
->dŸlog)->
aùiÚ_¬—
),

1286 
bu‰Ú
, 
TRUE
, TRUE, 0);

1287 ià(
Ïy”_widg‘
)

1288 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú
), "clicked",

1289 
	`G_CALLBACK
(
ed™_Ïy”_ok_ÿÎback
), 
dŸlog
);

1290 ià(
Ïy”
)

1291 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú
), "clicked",

1292 
	`G_CALLBACK
(
ed™_Ïy”_»Çme_ok_ÿÎback
), 
dŸlog
);

1293 ià(
dŸ
)

1294 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú
), "clicked",

1295 
	`G_CALLBACK
(
ed™_Ïy”_add_ok_ÿÎback
), 
dŸlog
);

1297 
	`gtk_widg‘_g¿b_deçuÉ
 (
bu‰Ú
);

1298 
	`gtk_widg‘_show
 (
bu‰Ú
);

1300 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_CANCEL
);

1301 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú
, 
GTK_CAN_DEFAULT
);

1302 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
	`GTK_DIALOG
 (
dŸlog
->dŸlog)->
aùiÚ_¬—
),

1303 
bu‰Ú
, 
TRUE
, TRUE, 0);

1304 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú
), "clicked",

1305 
	`G_CALLBACK
(
ed™_Ïy”_ÿnûl_ÿÎback
),

1306 
dŸlog
);

1307 
	`gtk_widg‘_show
 (
bu‰Ú
);

1309 
	`gtk_widg‘_show
 (
vbox
);

1310 
	`gtk_widg‘_show
 (
dŸlog
->dialog);

1312 ià(
Ïy”_widg‘
)

1313 
Ïy”_widg‘
->
ed™_dŸlog
 = 
dŸlog
;

1314 
	}
}

1320 
	$Ïy”_chªge_­¶y
(
Lay”Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

1322 
chªge
->
­¶›d
 = 1;

1324 
chªge
->
ty³
)

1326 
TYPE_DELETE_LAYER
:

1327 
	`d©a_d–‘e_Ïy”
(
dŸ
->
d©a
, 
chªge
->
Ïy”
);

1329 
TYPE_ADD_LAYER
:

1330 
	`d©a_add_Ïy”_©
(
dŸ
->
d©a
, 
chªge
->
Ïy”
, chªge->
šdex
);

1332 
TYPE_RAISE_LAYER
:

1333 
	`d©a_¿i£_Ïy”
(
dŸ
->
d©a
, 
chªge
->
Ïy”
);

1335 
TYPE_LOWER_LAYER
:

1336 
	`d©a_low”_Ïy”
(
dŸ
->
d©a
, 
chªge
->
Ïy”
);

1340 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

1342 ià(
Ïy”_dŸlog
->
dŸg¿m
 =ğ
dŸ
)

1344 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸ
);

1346 
	}
}

1349 
	$Ïy”_chªge_»v”t
(
Lay”Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

1351 
chªge
->
ty³
)

1353 
TYPE_DELETE_LAYER
:

1354 
	`d©a_add_Ïy”_©
(
dŸ
->
d©a
, 
chªge
->
Ïy”
, chªge->
šdex
);

1356 
TYPE_ADD_LAYER
:

1357 
	`d©a_d–‘e_Ïy”
(
dŸ
->
d©a
, 
chªge
->
Ïy”
);

1359 
TYPE_RAISE_LAYER
:

1360 
	`d©a_low”_Ïy”
(
dŸ
->
d©a
, 
chªge
->
Ïy”
);

1362 
TYPE_LOWER_LAYER
:

1363 
	`d©a_¿i£_Ïy”
(
dŸ
->
d©a
, 
chªge
->
Ïy”
);

1367 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

1369 ià(
Ïy”_dŸlog
->
dŸg¿m
 =ğ
dŸ
)

1371 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸ
);

1374 
chªge
->
­¶›d
 = 0;

1375 
	}
}

1378 
	$Ïy”_chªge_ä“
(
Lay”Chªge
 *
chªge
)

1380 
chªge
->
ty³
)

1382 
TYPE_DELETE_LAYER
:

1383 ià(
chªge
->
­¶›d
)

1385 
	`Ïy”_de¡roy
(
chªge
->
Ïy”
);

1388 
TYPE_ADD_LAYER
:

1389 ià(!
chªge
->
­¶›d
)

1391 
	`Ïy”_de¡roy
(
chªge
->
Ïy”
);

1394 
TYPE_RAISE_LAYER
:

1396 
TYPE_LOWER_LAYER
:

1399 
	}
}

1401 
Chªge
 *

1402 
	$undo_Ïy”
(
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
, 
Lay”ChªgeTy³
 
ty³
, 
šdex
)

1404 
Lay”Chªge
 *
chªge
;

1406 
chªge
 = 
	`g_Ãw0
(
Lay”Chªge
, 1);

1408 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
Ïy”_chªge_­¶y
;

1409 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
Ïy”_chªge_»v”t
;

1410 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
Ïy”_chªge_ä“
;

1412 
chªge
->
ty³
 =ype;

1413 
chªge
->
Ïy”
 =†ayer;

1414 
chªge
->
šdex
 = index;

1415 
chªge
->
­¶›d
 = 1;

1417 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

1418  (
Chªge
 *)
chªge
;

1419 
	}
}

1422 
	$Ïy”_visib™y_chªge_­¶y
(
Lay”Visib™yChªge
 *
chªge
,

1423 
DŸg¿m
 *
dŸ
)

1425 
GPŒA¼ay
 *
Ïy”s
;

1426 
Lay”
 *
Ïy”
 = 
chªge
->layer;

1427 
visibË
 = 
FALSE
;

1428 
i
;

1430 ià(
chªge
->
is_exşusive
)

1434 
i
=0; i<
dŸ
->
d©a
->
Ïy”s
->
Ën
; i++)

1436 
Lay”
 *
‹mp_Ïy”
 = 
	`g_±r_¬¿y_šdex
(
dŸ
->
d©a
->
Ïy”s
, 
i
);

1437 ià(
‹mp_Ïy”
 !ğ
Ïy”
)

1439 
visibË
 |ğ
‹mp_Ïy”
->visible;

1444 
Ïy”s
 = 
dŸ
->
d©a
->layers;

1445 
i
 = 0; i < 
Ïy”s
->
Ën
; i++)

1447 
Lay”
 *
‹mp_Ïy”
 = (Lay” *è
	`g_±r_¬¿y_šdex
(
Ïy”s
, 
i
);

1448 ià(
‹mp_Ïy”
 =ğ
Ïy”
)

1450 
‹mp_Ïy”
->
visibË
 = 
TRUE
;

1454 
‹mp_Ïy”
->
visibË
 = !visible;

1460 
Ïy”
->
visibË
 = !layer->visible;

1462 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

1464 ià(
Ïy”_dŸlog
->
dŸg¿m
 =ğ
dŸ
)

1466 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸ
);

1468 
	}
}

1473 
	$Ïy”_visib™y_chªge_»v”t
(
Lay”Visib™yChªge
 *
chªge
,

1474 
DŸg¿m
 *
dŸ
)

1476 
GLi¡
 *
vis
 = 
chªge
->
Üigš®_visib™y
;

1477 
GPŒA¼ay
 *
Ïy”s
 = 
dŸ
->
d©a
->layers;

1478 
i
;

1480 
i
 = 0; 
vis
 !ğ
NULL
 && i < 
Ïy”s
->
Ën
; vi ğ
	`g_li¡_Ãxt
(vis), i++)

1482 
Lay”
 *
Ïy”
 = (Lay”*è
	`g_±r_¬¿y_šdex
(
Ïy”s
, 
i
);

1483 
Ïy”
->
visibË
 = (
gboŞ—n
)
vis
->
d©a
;

1486 ià(
vis
 !ğ
NULL
 || 
i
 < 
Ïy”s
->
Ën
)

1488 
	`´štf
("Internalƒrror: visibility undo has %d visibilities, but %d†ayers\n",

1489 
	`g_li¡_Ëngth
(
chªge
->
Üigš®_visib™y
), 
Ïy”s
->
Ën
);

1492 
	`dŸg¿m_add_upd©e_®l
(
dŸ
);

1494 ià(
Ïy”_dŸlog
->
dŸg¿m
 =ğ
dŸ
)

1496 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸ
);

1498 
	}
}

1501 
	$Ïy”_visib™y_chªge_ä“
(
Lay”Visib™yChªge
 *
chªge
)

1503 
	`g_li¡_ä“
(
chªge
->
Üigš®_visib™y
);

1504 
	}
}

1506 
Lay”Visib™yChªge
 *

1507 
	$undo_Ïy”_visib™y
(
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
, 
gboŞ—n
 
exşusive
)

1509 
Lay”Visib™yChªge
 *
chªge
;

1510 
GLi¡
 *
visib™›s
 = 
NULL
;

1511 
i
;

1512 
GPŒA¼ay
 *
Ïy”s
 = 
dŸ
->
d©a
->layers;

1514 
chªge
 = 
	`g_Ãw0
(
Lay”Visib™yChªge
, 1);

1516 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
Ïy”_visib™y_chªge_­¶y
;

1517 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
Ïy”_visib™y_chªge_»v”t
;

1518 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
Ïy”_visib™y_chªge_ä“
;

1520 
i
 = 0; i < 
Ïy”s
->
Ën
; i++)

1522 
Lay”
 *
‹mp_Ïy”
 = (Lay” *è
	`g_±r_¬¿y_šdex
(
Ïy”s
, 
i
);

1523 
visib™›s
 = 
	`g_li¡_­³nd
(visib™›s, (
gpoš‹r
)
‹mp_Ïy”
->
visibË
);

1526 
chªge
->
Üigš®_visib™y
 = 
visib™›s
;

1527 
chªge
->
Ïy”
 =†ayer;

1528 
chªge
->
is_exşusive
 = 
exşusive
;

1530 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

1531  
chªge
;

1532 
	}
}

1538 
	$dŸg¿m_ed™_Ïy”
(
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
)

1540 
	`g_»tuº_if_ç
(
dŸ
 !ğ
NULL
);

1542 
	`Ïy”_dŸlog_ed™_Ïy”
 (
NULL
, 
Ïy”
 ? NULL : 
dŸ
,†ayer);

1543 
	}
}

	@O:\tool\dvs50\app\layer_dialog.h

18 #iâdeà
LAYER_DIALOG_H


19 
	#LAYER_DIALOG_H


	)

21 
	~<gtk/gtk.h
>

22 
	~"dŸg¿m.h
"

25 
ü—‹_Ïy”_dŸlog
();

26 
Ïy”_dŸlog_upd©e_dŸg¿m_li¡
();

27 
Ïy”_dŸlog_show
();

28 
Ïy”_dŸlog_£t_dŸg¿m
(
DŸg¿m
 *
dŸ
);

31 
GtkWidg‘
 * 
ü—‹_Ïy”_v›w_widg‘
 ();

33 
_DŸLay”Widg‘
 
	tDŸLay”Widg‘
;

35 
GtkWidg‘
* 
dŸ_Ïy”_widg‘_Ãw
(
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
);

36 
dŸ_Ïy”_£t_Ïy”
(
DŸLay”Widg‘
 *
widg‘
, 
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
);

37 
dŸ_Ïy”_upd©e_äom_Ïy”
(
DŸLay”Widg‘
 *
widg‘
);

39 
dŸg¿m_ed™_Ïy”
(
DŸg¿m
 *
dŸ
, 
Lay”
 *
Ïy”
);

	@O:\tool\dvs50\app\linewidth_area.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~"lšewidth_¬—.h
"

24 
	~"©Œibu‹s.h
"

25 
	~"³rsi¡’û.h
"

26 
	~"š‹rçû.h
"

27 
	~"š.h
"

29 #ià!
defšed
(
ršt
)

30 
	~<m©h.h
>

31 
	#ršt
(
x
è
	`æoÜ
 ((xè+ 0.5)

	)

34 
	#BASE_WIDTH
 0.05

	)

35 
	#PIXELS_BETWEEN_LINES
 6

	)

36 
	#NUMLINES
 5

	)

38 
	#X_OFFSET
(
i
è(
PIXELS_BETWEEN_LINES
*(i)+((i)-1)*(i)/2)

	)

40 
	#AREA_WIDTH
 
	`X_OFFSET
(
NUMLINES
+1)

	)

41 
	#AREA_HEIGHT
 42

	)

43 
lšewidth_ü—‹_dŸlog
();

45 
	gaùive_lšewidth
 = 2;

46 
GdkGC
 *
	glšewidth_¬—_gc
 = 
NULL
;

47 
GdkPixm­
 *
	glšewidth_¬—_pixm­
 = 
NULL
;

49 
GtkWidg‘
 *
	glšewidth_¬—_widg‘
 = 
NULL
;

50 
GtkWidg‘
 *
	glšewidth_dŸlog
 = 
NULL
;

51 
GtkWidg‘
 *
	glšewidth_bu‰Ú
 = 
NULL
;

54 
	$lšewidth_¬—_rg‘
 (
x
, 
y
)

56 
i
;

57 
x_offs
;

58 
i
=1;i<=
NUMLINES
;i++) {

59 
x_offs
 = 
	`X_OFFSET
(
i
);

60 ià((
x
>=
x_offs
-
PIXELS_BETWEEN_LINES
/2) &&

61 (
x
<
x_offs
+
i
+
PIXELS_BETWEEN_LINES
/2))

62  
i
;

65 
	}
}

68 
	$lšewidth_¬—_d¿w
 (
GtkWidg‘
 *
lšewidth_¬—
)

70 
GdkCŞÜ
 *
wš_bg
;

71 
GdkCŞÜ
 
lše
;

72 
width
, 
height
;

73 
i
;

74 
x_offs
;

76 ià(!
lšewidth_¬—_pixm­
)

81 ià(!
lšewidth_¬—_gc
) {

82 
lšewidth_¬—_gc
 = 
	`gdk_gc_Ãw
 (
lšewidth_¬—_pixm­
);

83 
	`gdk_gc_£t_lše_©Œibu‹s
(
lšewidth_¬—_gc
, 1,

84 
GDK_LINE_ON_OFF_DASH
,

85 
GDK_CAP_BUTT
,

86 
GDK_JOIN_MITER
);

89 
	`gdk_wšdow_g‘_size
 (
lšewidth_¬—_pixm­
, &
width
, &
height
);

91 
wš_bg
 = &(
lšewidth_¬—
->
¡yË
->
bg
[
GTK_STATE_NORMAL
]);

92 
lše
 = 
cŞÜ_gdk_bÏck
;

94 
	`gdk_gc_£t_fÜeground
 (
lšewidth_¬—_gc
, 
wš_bg
);

95 
	`gdk_d¿w_»ùªgË
 (
lšewidth_¬—_pixm­
, 
lšewidth_¬—_gc
, 1,

96 0, 0, 
width
, 
height
);

98 
	`gdk_gc_£t_fÜeground
 (
lšewidth_¬—_gc
, &
lše
);

100 
i
=0;i<=
NUMLINES
;i++) {

101 
x_offs
 = 
	`X_OFFSET
(
i
);

103 
	`gdk_d¿w_»ùªgË
 (
lšewidth_¬—_pixm­
, 
lšewidth_¬—_gc
, 1,

104 
x_offs
, 2, 
i
, 
height
-4);

108 ià(
aùive_lšewidth
 != 0) {

109 
	`gdk_d¿w_»ùªgË
 (
lšewidth_¬—_pixm­
, 
lšewidth_¬—_gc
, 0,

110 
	`X_OFFSET
(
aùive_lšewidth
)-2, 0,

111 
aùive_lšewidth
+4, 
height
-1);

114 
	`gdk_d¿w_pixm­
 (
lšewidth_¬—
->
wšdow
, 
lšewidth_¬—_gc
, 
lšewidth_¬—_pixm­
,

115 0, 0, 0, 0, 
width
, 
height
);

116 
	}
}

118 
gšt


119 
	$lšewidth_¬—_ev’ts
 (
GtkWidg‘
 *
widg‘
,

120 
GdkEv’t
 *
ev’t
)

122 
GdkEv’tBu‰Ú
 *
bev’t
;

123 
GdkEv’tCÚfigu»
 *
ûv’t
;

124 
rg‘
;

126 
ev’t
->
ty³
)

128 
GDK_CONFIGURE
:

129 
ûv’t
 = (
GdkEv’tCÚfigu»
 *è
ev’t
;

130 ià(
ûv’t
->
width
 > 1) {

131 
lšewidth_¬—_pixm­
 = 
	`gdk_pixm­_Ãw
 (
widg‘
->
wšdow
,

132 
ûv’t
->
width
,

133 
ûv’t
->
height
, -1);

136 
GDK_EXPOSE
:

137 
	`lšewidth_¬—_d¿w
 (
lšewidth_¬—_widg‘
);

140 
GDK_BUTTON_PRESS
:

141 
bev’t
 = (
GdkEv’tBu‰Ú
 *è
ev’t
;

142 ià(
bev’t
->
bu‰Ú
 == 1) {

143 
rg‘
 = 
	`lšewidth_¬—_rg‘
 (
bev’t
->
x
, bev’t->
y
);

145 ià(
rg‘
 != 0) {

146 
aùive_lšewidth
 = 
rg‘
;

147 
	`lšewidth_¬—_d¿w
(
lšewidth_¬—_widg‘
);

148 
	`©Œibu‹s_£t_deçuÉ_lšewidth
(
BASE_WIDTH
*(
rg‘
-1));

153 
GDK_2BUTTON_PRESS
:

154 ià(
lšewidth_dŸlog
 =ğ
NULL
)

155 
	`lšewidth_ü—‹_dŸlog
();

157 
	`gtk_widg‘_g¿b_focus
(
lšewidth_bu‰Ú
);

158 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
lšewidth_bu‰Ú
), 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
());

160 
	`gtk_widg‘_show
(
lšewidth_dŸlog
);

167  
FALSE
;

168 
	}
}

172 
	$lšewidth_numb”_äom_width
(
»®
 
width
)

174 ià(
	`çbs
(
width
/
BASE_WIDTH
-
	`ršt
(width/BASE_WIDTH)) > 0.0005 ||

175 (
width
/
BASE_WIDTH
 > 
NUMLINES
)) {

178  
width
/
BASE_WIDTH
+1.0005;

180 
	}
}

182 
GtkWidg‘
 *

183 
	$lšewidth_¬—_ü—‹
 ()

185 
GtkWidg‘
 *
lšewidth_¬—
;

186 
GtkWidg‘
 *
ev’t_box
;

188 
	`©Œibu‹s_£t_deçuÉ_lšewidth
(
	`³rsi¡’û_»gi¡”_»®
("linewidth", 0.1));

189 
aùive_lšewidth
 = 
	`lšewidth_numb”_äom_width
(
	`©Œibu‹s_g‘_deçuÉ_lšewidth
());

191 
ev’t_box
 = 
	`gtk_ev’t_box_Ãw
();

192 
lšewidth_¬—
 = 
	`gtk_d¿wšg_¬—_Ãw
 ();

193 
	`gtk_widg‘_£t_size_»que¡
 (
lšewidth_¬—
, 
AREA_WIDTH
, 
AREA_HEIGHT
);

194 
	`gtk_widg‘_£t_ev’ts
 (
lšewidth_¬—
, 
GDK_EXPOSURE_MASK
 | 
GDK_BUTTON_PRESS_MASK
);

195 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
lšewidth_¬—
), "event",

196 
	`G_CALLBACK
(
lšewidth_¬—_ev’ts
),

197 
NULL
);

199 
lšewidth_¬—_widg‘
 = 
lšewidth_¬—
;

201 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
ev’t_box
), 
lšewidth_¬—
);

202 
	`gtk_widg‘_show
(
lšewidth_¬—
);

203  
ev’t_box
;

204 
	}
}

207 
	$g‘_cu¼’t_lše_width
()

209 
Ãwv®ue
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue
 (
	`GTK_SPIN_BUTTON
 (
lšewidth_bu‰Ú
));

210 
aùive_lšewidth
 = 
	`lšewidth_numb”_äom_width
(
Ãwv®ue
);

211 
	`lšewidth_¬—_d¿w
(
	`GTK_WIDGET
(
lšewidth_¬—_widg‘
));

212 
	`©Œibu‹s_£t_deçuÉ_lšewidth
(
Ãwv®ue
);

213 
	}
}

216 
	$lšewidth_dŸlog_»¥Úd
(
GtkWidg‘
 *
widg‘
, 
gšt
 
»¥Ú£_id
, 
gpoš‹r
 
d©a
)

218 ià(
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
) {

219 
	`g‘_cu¼’t_lše_width
();

221 
	`gtk_widg‘_hide
(
lšewidth_dŸlog
);

222 
	}
}

225 
	$lšewidth_dŸlog_ok
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

227 
	`gtk_dŸlog_»¥Ú£
(
	`GTK_DIALOG
(
lšewidth_dŸlog
), 
GTK_RESPONSE_OK
);

228 
	}
}

232 
	$dŸlog_de¡royed
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

234 
GtkWidg‘
 **
wid
 = (GtkWidg‘**)
d©a
;

235 ià(
wid
è*wid = 
NULL
;

236 
	}
}

239 
	$lšewidth_ü—‹_dŸlog
()

241 
GtkWidg‘
 *
hbox
;

242 
GtkWidg‘
 *
Ïb–
;

243 
GtkAdju¡m’t
 *
adj
;

245 
lšewidth_dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(

246 
	`_
("Lšwidth"), 
	`GTK_WINDOW
(
	`š‹rçû_g‘_toŞbox_sh–l
()),

248 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

249 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

250 
NULL
);

252 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
lšewidth_dŸlog
), 
GTK_RESPONSE_OK
);

253 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
lšewidth_dŸlog
), "linewidth_window");

254 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
lšewidth_dŸlog
), 
TRUE
);

255 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
lšewidth_dŸlog
), 2);

257 
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
, 5);

258 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Line width:"));

259 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox
), 
Ïb–
, 
FALSE
, 
TRUE
, 0);

260 
	`gtk_widg‘_show
 (
Ïb–
);

261 
adj
 = (
GtkAdju¡m’t
 *è
	`gtk_adju¡m’t_Ãw
(0.1, 0.00, 10.0, 0.01, 0.05, 0.0);

262 
lšewidth_bu‰Ú
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
(), 2);

263 
	`gtk_¥š_bu‰Ú_£t_w¿p
(
	`GTK_SPIN_BUTTON
(
lšewidth_bu‰Ú
), 
TRUE
);

264 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
lšewidth_bu‰Ú
), 
TRUE
);

265 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
 (
hbox
), 
lšewidth_bu‰Ú
, 
TRUE
, TRUE, 0);

266 
	`gtk_widg‘_show
 (
lšewidth_bu‰Ú
);

267 
	`gtk_widg‘_show
(
hbox
);

268 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
(
	`GTK_DIALOG
 (
lšewidth_dŸlog
)->
vbox
), 
hbox
, 
TRUE
, TRUE, 0);

270 
	`gtk_widg‘_show
 (
lšewidth_bu‰Ú
);

272 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
lšewidth_dŸlog
), "response",

273 
	`G_CALLBACK
 (
lšewidth_dŸlog_»¥Úd
), 
NULL
);

274 
	`g_sigÇl_cÚÃù_aá”
(
	`G_OBJECT
 (
lšewidth_bu‰Ú
), "activate",

275 
	`G_CALLBACK
 (
lšewidth_dŸlog_ok
), 
NULL
);

277 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
lšewidth_dŸlog
), "delete_event",

278 
	`G_CALLBACK
(
gtk_widg‘_hide
), 
NULL
);

279 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
lšewidth_dŸlog
), "destroy",

280 
	`G_CALLBACK
(
dŸlog_de¡royed
), &
lšewidth_dŸlog
);

282 
	`³rsi¡’û_»gi¡”_wšdow
 (
	`GTK_WINDOW
 (
lšewidth_dŸlog
));

283 
	}
}

	@O:\tool\dvs50\app\linewidth_area.h

18 #iâdeà
LINEWDITH_AREA_H


19 
	#LINEWDITH_AREA_H


	)

21 
	~<gtk/gtk.h
>

23 
GtkWidg‘
 *
lšewidth_¬—_ü—‹
 ();

	@O:\tool\dvs50\app\load_save.c

18 
	~<cÚfig.h
>

20 
	#_BSD_SOURCE
 1

	)

21 
	#_POSIX_C_SOURCE
 2

	)

22 
	~<sys/¡©.h
>

23 #ifdeà
HAVE_UNISTD_H


24 
	~<uni¡d.h
>

26 
	~<¡dlib.h
>

27 
	~<sys/ty³s.h
>

28 
	~<¡dio.h
>

29 
	~<fú.h
>

30 
	~<¡ršg.h
>

32 
	~<glib.h
>

33 
	~<glib/g¡dio.h
>

34 
	~<”ºo.h
>

36 #iâdeà
W_OK


37 
	#W_OK
 2

	)

40 
	~"š.h
"

42 
	~<libxml/Œ“.h
>

43 
	~<libxml/·r£r.h
>

44 
	~<libxml/xmlmemÜy.h
>

45 
	~"dŸ_xml_libxml.h
"

46 
	~"dŸ_xml.h
"

48 
	~"lßd_§ve.h
"

49 
	~"group.h
"

50 
	~"dŸg¿md©a.h
"

51 
	~"objeù.h
"

52 
	~"mes§ge.h
"

53 
	~"´eã»nûs.h
"

54 
	~"dŸ·g–ayout.h
"

55 
	~"auto§ve.h
"

56 
	~"Ãwgroup.h
"

58 #ifdeà
G_OS_WIN32


59 
	~<io.h
>

61 
FaùÜySŒuùI‹mAÎ
 *
çùÜyCÚš”
;

62 
»ad_cÚÃùiÚs
(
GLi¡
 *
objeùs
, 
xmlNodePŒ
 
Ïy”_node
,

63 
GHashTabË
 *
objeùs_hash
);

64 
GHFuncUnknownObjeùs
(
gpoš‹r
 
key
,

65 
gpoš‹r
 
v®ue
,

66 
gpoš‹r
 
u£r_d©a
);

67 
GLi¡
 *
»ad_objeùs
(
xmlNodePŒ
 
objeùs
,

68 
GHashTabË
 *
objeùs_hash
,

69 cÚ¡ *
f’ame
, 
DŸObjeù
 *
·»Á
,

70 
GHashTabË
 *
unknown_objeùs_hash
);

71 
hash_ä“_¡ršg
(
gpoš‹r
 
key
,

72 
gpoš‹r
 
v®ue
,

73 
gpoš‹r
 
u£r_d©a
);

74 
xmlNodePŒ
 
fšd_node_Çmed
 (xmlNodePŒ 
p
, cÚ¡ *
Çme
);

75 
gboŞ—n
 
dŸg¿m_d©a_lßd
(cÚ¡ *
f’ame
, 
DŸg¿mD©a
 *
d©a
,

76 * 
u£r_d©a
);

77 
gboŞ—n
 
wr™e_objeùs
(
GLi¡
 *
objeùs
, 
xmlNodePŒ
 
objeùs_node
,

78 
GHashTabË
 *
objeùs_hash
, *
obj_Ä
,

79 cÚ¡ *
f’ame
);

80 
gboŞ—n
 
wr™e_cÚÃùiÚs
(
GLi¡
 *
objeùs
, 
xmlNodePŒ
 
Ïy”_node
,

81 
GHashTabË
 *
objeùs_hash
);

82 
xmlDocPŒ
 
dŸg¿m_d©a_wr™e_doc
(
DŸg¿mD©a
 *
d©a
, cÚ¡ *
f’ame
);

83 
dŸg¿m_d©a_¿w_§ve
(
DŸg¿mD©a
 *
d©a
, cÚ¡ *
f’ame
);

84 
dŸg¿m_d©a_§ve
(
DŸg¿mD©a
 *
d©a
, cÚ¡ *
f’ame
);

88 
	$GHFuncUnknownObjeùs
(
gpoš‹r
 
key
,

89 
gpoš‹r
 
v®ue
,

90 
gpoš‹r
 
u£r_d©a
)

92 
GSŒšg
* 
s
 = (GSŒšg*)
u£r_d©a
;

93 
	`g_¡ršg_­³nd
(
s
, "\n");

94 
	`g_¡ršg_­³nd
(
s
, (
gch¬
*)
key
);

95 
	`g_ä“
(
key
);

96 
	}
}

115 
GLi¡
 *

116 
	$»ad_objeùs
(
xmlNodePŒ
 
objeùs
,

117 
GHashTabË
 *
objeùs_hash
,cÚ¡ *
f’ame
, 
DŸObjeù
 *
·»Á
,

118 
GHashTabË
 *
unknown_objeùs_hash
)

120 
GLi¡
 *
li¡
;

121 
DŸObjeùTy³
 *
ty³
;

122 
DŸObjeù
 *
obj
;

123 
ObjeùNode
 
obj_node
;

124 *
ty³¡r
;

125 *
v”siÚ¡r
;

126 *
idd
;

127 *
objÇme
;

128 
v”siÚ
;

129 
xmlNodePŒ
 
chd_node
;

131 
li¡
 = 
NULL
;

133 
obj_node
 = 
objeùs
->
xmlChd»nNode
;

135  
obj_node
 !ğ
NULL
)

137 ià(
	`xmlIsBÏnkNode
(
obj_node
))

139 
obj_node
 = obj_node->
Ãxt
;

143 ià(!
obj_node
) ;

145 ià(
	`xmlSŒcmp
(
obj_node
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"object")==0)

147 
ty³¡r
 = (*è
	`xmlG‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"type");

148 
v”siÚ¡r
 = (*è
	`xmlG‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"version");

149 
idd
 = (*è
	`xmlG‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"id");

159 
v”siÚ
 = 0;

160 ià(
v”siÚ¡r
 !ğ
NULL
 && 
	`g_ascii_¡ºÿ£cmp
(v”siÚ¡r,
çùÜyCÚš”
->
fe_v”siÚ
,
	`¡¾’
(versionstr)))

163 
gch¬
 *
msg_”r
 = 
	`g_loÿË_to_utf8
(
	`_
("½á¹¹ÌåÎÄ¼şµÄ°æ±¾´íÎó!ÎŞ·¨´ò¿ª."),-1,
NULL
,NULL,NULL);

164 
	`mes§ge_”rÜ
(
msg_”r
);

165 
	`g_ä“
(
msg_”r
);

166 
	`xmlF»e
(
v”siÚ¡r
);

167  
NULL
;

170 
ty³
 = 
	`objeù_g‘_ty³
((*)
ty³¡r
);

172 ià(!
ty³
)

174 ià(
	`g_utf8_v®id©e
 (
ty³¡r
, -1, 
NULL
) &&

175 
NULL
 =ğ
	`g_hash_bË_lookup
(
unknown_objeùs_hash
, 
ty³¡r
))

176 
	`g_hash_bË_š£¹
(
unknown_objeùs_hash
, 
	`g_¡rdup
(
ty³¡r
), 0);

180 
obj
 = 
ty³
->
İs
->
	`lßd
(
obj_node
, 
v”siÚ
, 
f’ame
);

181 
objÇme
 = (
gch¬
*)
	`xmlG‘Prİ
(
obj_node
,(cÚ¡ 
xmlCh¬
*)"name");

182 if(
objÇme
)

184 if(
	`çùÜy_is_¥ecŸl_objeù
(
objÇme
))

186 
obj_node
 = obj_node->
Ãxt
;

190 
li¡
 = 
	`g_li¡_­³nd
Öi¡, 
obj
);

192 ià(
·»Á
)

194 
obj
->
·»Á
 =…arent;

195 
·»Á
->
chd»n
 = 
	`g_li¡_­³nd
Õ¬’t->chd»n, 
obj
);

198 
	`g_hash_bË_š£¹
(
objeùs_hash
, 
	`g_¡rdup
((*)
idd
), 
obj
);

200 
chd_node
 = 
obj_node
->
chd»n
;

202 
chd_node
)

204 ià(
	`xmlSŒcmp
(
chd_node
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"children") == 0)

206 
GLi¡
 *
chd»n_»ad
 = 
	`»ad_objeùs
(
chd_node
, 
objeùs_hash
, 
f’ame
, 
obj
, 
unknown_objeùs_hash
);

207 
li¡
 = 
	`g_li¡_cÚÿt
Öi¡, 
chd»n_»ad
);

210 
chd_node
 = chd_node->
Ãxt
;

213 ià(
ty³¡r
è
	`xmlF»e
(typestr);

214 ià(
idd
è
	`xmlF»e
 (idd);

216 ià(
	`xmlSŒcmp
(
obj_node
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"group")==0

217 && 
obj_node
->
chd»n
)

220 
GLi¡
 *
šÃr_objeùs
 = 
	`»ad_objeùs
(
obj_node
, 
objeùs_hash
, 
f’ame
, 
NULL
, 
unknown_objeùs_hash
);

222 ià(
šÃr_objeùs
)

224 
obj
 = 
	`group_ü—‹
(
šÃr_objeùs
);

226 #ifdeà
USE_NEWGROUP


233 
DŸObjeù
 *
Ãwgroup
;

234 
GLi¡
 *
objeùs
;

235 
Pošt
 
low”_right
;

236 
ty³
 = 
	`objeù_g‘_ty³
("Misc - NewGroup");

237 
low”_right
 = 
obj
->
pos™iÚ
;

238 
Ãwgroup
 = 
ty³
->
İs
->
	`ü—‹
(&
low”_right
,

239 
NULL
,

240 
NULL
,

241 
NULL
);

242 
li¡
 = 
	`g_li¡_­³nd
Öi¡, 
Ãwgroup
);

244 
objeùs
 = 
	`group_objeùs
(
obj
); objeù !ğ
NULL
; objeù ğ
	`g_li¡_Ãxt
(objects))

246 
DŸObjeù
 *
subobj
 = (DŸObjeù *è
objeùs
->
d©a
;

247 
li¡
 = 
	`g_li¡_­³nd
Öi¡, 
subobj
);

248 
subobj
->
·»Á
 = 
Ãwgroup
;

249 
Ãwgroup
->
chd»n
 = 
	`g_li¡_­³nd
Òewgroup->chd»n, 
subobj
);

250 ià(
subobj
->
boundšg_box
.
right
 > 
low”_right
.
x
)

252 
low”_right
.
x
 = 
subobj
->
boundšg_box
.
right
;

254 ià(
subobj
->
boundšg_box
.
bÙtom
 > 
low”_right
.
y
)

256 
low”_right
.
y
 = 
subobj
->
boundšg_box
.
bÙtom
;

259 
Ãwgroup
->
İs
->
	`move_hªdË
Òewgroup,‚ewgroup->
hªdËs
[7],

260 &
low”_right
, 
NULL
,

261 
HANDLE_MOVE_CREATE_FINAL
, 0);

263 
	`group_de¡roy_sh®low
(
obj
);

266 
li¡
 = 
	`g_li¡_­³nd
Öi¡, 
obj
);

275 
obj_node
 = obj_node->
Ãxt
;

277  
li¡
;

278 
	}
}

281 
	$»ad_cÚÃùiÚs
(
GLi¡
 *
objeùs
, 
xmlNodePŒ
 
Ïy”_node
,

282 
GHashTabË
 *
objeùs_hash
)

284 
ObjeùNode
 
obj_node
;

285 
GLi¡
 *
li¡
;

286 
xmlNodePŒ
 
cÚÃùiÚs
;

287 
xmlNodePŒ
 
cÚÃùiÚ
;

288 *
hªdË¡r
;

289 *
to¡r
;

290 *
cÚn¡r
;

291 
hªdË
, 
cÚn
;

292 
DŸObjeù
 *
to
;

294 
li¡
 = 
objeùs
;

295 
obj_node
 = 
Ïy”_node
->
xmlChd»nNode
;

296 (
li¡
 !ğ
NULL
è&& (
obj_node
 != NULL))

298 
DŸObjeù
 *
obj
 = (DŸObjeù *è
li¡
->
d©a
;

301 
obj_node
 && (
	`xmlIsBÏnkNode
(obj_nodeè|| 
XML_COMMENT_NODE
 =ğobj_node->
ty³
))

302 
obj_node
 = obj_node->
Ãxt
;

303 ià(!
obj_node
) ;

305 
	`IS_GROUP
(
obj
)

307 
	`»ad_cÚÃùiÚs
(
	`group_objeùs
(
obj
), 
obj_node
, 
objeùs_hash
);

311 
gboŞ—n
 
brok’
 = 
FALSE
;

313 
gboŞ—n
 
wªts_upd©e
 = 
obj
->
boundšg_box
.
right
 >ğobj->boundšg_box.
Ëá


314 || 
obj
->
boundšg_box
.
tİ
 >ğobj->boundšg_box.
bÙtom
;

315 
cÚÃùiÚs
 = 
obj_node
->
xmlChd»nNode
;

316 (
cÚÃùiÚs
!=
NULL
) &&

317 (
	`xmlSŒcmp
(
cÚÃùiÚs
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"connections")!=0))

318 
cÚÃùiÚs
 = cÚÃùiÚs->
Ãxt
;

319 ià(
cÚÃùiÚs
 !ğ
NULL
)

321 
cÚÃùiÚ
 = 
cÚÃùiÚs
->
xmlChd»nNode
;

322 
cÚÃùiÚ
 !ğ
NULL
)

324 *
dÚe¡r
;

325 ià(
	`xmlIsBÏnkNode
(
cÚÃùiÚ
))

327 
cÚÃùiÚ
 = cÚÃùiÚ->
Ãxt
;

330 
hªdË¡r
 = (* )
	`xmlG‘Prİ
(
cÚÃùiÚ
, (cÚ¡ 
xmlCh¬
 *)"handle");

331 
to¡r
 = (*è
	`xmlG‘Prİ
(
cÚÃùiÚ
, (cÚ¡ 
xmlCh¬
 *)"to");

332 
cÚn¡r
 = (*è
	`xmlG‘Prİ
(
cÚÃùiÚ
, (cÚ¡ 
xmlCh¬
 *)"connection");

334 
hªdË
 = 
	`©oi
(
hªdË¡r
);

335 
cÚn
 = 
	`¡¹Ş
(
cÚn¡r
, &
dÚe¡r
, 10);

336 ià(*
dÚe¡r
 != '\0')

338 
cÚn
 = -1;

341 
to
 = 
	`g_hash_bË_lookup
(
objeùs_hash
, 
to¡r
);

343 ià(
to
 =ğ
NULL
)

345 
	`mes§ge_”rÜ
(
	`_
("Error†oading diagram.\n"

347 
brok’
 = 
TRUE
;

349 ià(
hªdË
 < 0 || hªdË >ğ
obj
->
num_hªdËs
)

351 
	`mes§ge_”rÜ
(
	`_
("Error†oading diagram.\n"

353 
hªdË
, 
to
->
ty³
->
Çme
);

354 
brok’
 = 
TRUE
;

358 ià(
cÚn
 == -1)

360 
i
;

361 
i
 = 0; i < 
to
->
num_cÚÃùiÚs
; i++)

363 ià(
to
->
cÚÃùiÚs
[
i
]->
Çme
 !ğ
NULL
 &&

364 
	`¡rcmp
(
to
->
cÚÃùiÚs
[
i
]->
Çme
, 
cÚn¡r
) == 0)

366 
cÚn
 = 
i
;

371 ià(
cÚn
 >ğ0 && cÚÀ< 
to
->
num_cÚÃùiÚs
)

373 
	`objeù_cÚÃù
(
obj
, obj->
hªdËs
[
hªdË
],

374 
to
->
cÚÃùiÚs
[
cÚn
]);

376 ià(
wªts_upd©e
)

378 
obj
->
hªdËs
[
hªdË
]->
pos
 =

379 
to
->
cÚÃùiÚs
[
cÚn
]->
Ï¡_pos
 =o->cÚÃùiÚs[cÚn]->
pos
;

381 
obj
->
İs
->
	`move_hªdË
(obj, obj->
hªdËs
[
hªdË
], &
to
->
cÚÃùiÚs
[
cÚn
]->
pos
,

382 
to
->
cÚÃùiÚs
[
cÚn
], 
HANDLE_MOVE_CONNECTED
,0);

388 
	`mes§ge_”rÜ
(
	`_
("Error†oading diagram.\n"

390 
cÚn
, 
to
->
ty³
->
Çme
);

391 
brok’
 = 
TRUE
;

395 ià(
hªdË¡r
è
	`xmlF»e
(handlestr);

396 ià(
to¡r
è
	`xmlF»e
(tostr);

397 ià(
cÚn¡r
è
	`xmlF»e
(connstr);

399 
cÚÃùiÚ
 = cÚÃùiÚ->
Ãxt
;

405 ià(!
brok’
 && 
obj
 && obj->
İs
->
£t_´İs
 && 
wªts_upd©e
)

408 
obj
->
İs
->
	`move
(obj,&obj->
pos™iÚ
);

410 
hªdË
 = 0; hªdË < 
obj
->
num_hªdËs
; ++handle)

412 ià(
obj
->
hªdËs
[
hªdË
]->
cÚÃùed_to
)

413 
obj
->
İs
->
	`move_hªdË
(obj, obj->
hªdËs
[
hªdË
], &obj->hªdËs[hªdË]->
pos
,

414 
obj
->
hªdËs
[
hªdË
]->
cÚÃùed_to
, 
HANDLE_MOVE_CONNECTED
,0);

421 
cÚÃùiÚs
 = 
obj_node
->
xmlChd»nNode
;

422 (
cÚÃùiÚs
!=
NULL
) &&

423 (
	`xmlSŒcmp
(
cÚÃùiÚs
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"childnode")!=0))

424 
cÚÃùiÚs
 = cÚÃùiÚs->
Ãxt
;

425 ià(
cÚÃùiÚs
 !ğ
NULL
)

427 
to¡r
 = (*)
	`xmlG‘Prİ
(
cÚÃùiÚs
, (cÚ¡ 
xmlCh¬
 *)"parent");

428 ià(
to¡r
)

430 
obj
->
·»Á
 = 
	`g_hash_bË_lookup
(
objeùs_hash
, 
to¡r
);

431 ià(
obj
->
·»Á
 =ğ
NULL
)

433 
	`mes§ge_”rÜ
(
	`_
("Can't find…arent %s of %s object\n"),

434 
to¡r
, 
obj
->
ty³
->
Çme
);

438 
obj
->
·»Á
->
chd»n
 = 
	`g_li¡_´•’d
(obj->parent->children, obj);

443 
li¡
 = 
	`g_li¡_Ãxt
(list);

444 
obj_node
 = obj_node->
Ãxt
;

446 
	}
}

449 
	$hash_ä“_¡ršg
(
gpoš‹r
 
key
,

450 
gpoš‹r
 
v®ue
,

451 
gpoš‹r
 
u£r_d©a
)

453 
	`g_ä“
(
key
);

454 
	}
}

456 
xmlNodePŒ


457 
	$fšd_node_Çmed
 (
xmlNodePŒ
 
p
, cÚ¡ *
Çme
)

459 
p
 && 0 !ğ
	`xmlSŒcmp
Õ->
Çme
, (
xmlCh¬
 *)name))

460 
p
 =…->
Ãxt
;

461  
p
;

462 
	}
}

464 
gboŞ—n


465 
	$dŸg¿m_d©a_lßd
(cÚ¡ *
f’ame
, 
DŸg¿mD©a
 *
d©a
, * 
u£r_d©a
)

467 
GHashTabË
 *
objeùs_hash
;

468 
fd
;

469 
GLi¡
 *
li¡
;

470 
xmlDocPŒ
 
doc
;

471 
xmlNodePŒ
 
dŸg¿md©a
;

472 
xmlNodePŒ
 
·³ršfo
, 
gridšfo
, 
guidešfo
;

473 
xmlNodePŒ
 
Ïy”_node
;

474 
A‰ribu‹Node
 
©Œ
;

475 
Lay”
 *
Ïy”
;

476 
xmlNsPŒ
 
Çme¥aû
;

477 
gch¬
 
fœ¡ch¬
;

478 
DŸg¿m
 *
dŸg¿m
 = 
	`DIA_IS_DIAGRAM
 (
d©a
è? 
	`DIA_DIAGRAM
 (d©aè: 
NULL
;

479 
Lay”
 *
aùive_Ïy”
 = 
NULL
;

480 
GHashTabË
* 
unknown_objeùs_hash
 = 
	`g_hash_bË_Ãw
(
g_¡r_hash
, 
g_¡r_equ®
);

483 ià(
	`g_fe_‹¡
 (
f’ame
, 
G_FILE_TEST_IS_DIR
))

485 
	`mes§ge_”rÜ
(
	`_
("You must specify‡ file,‚ot‡ directory.\n"));

486  
FALSE
;

489 
fd
 = 
	`g_İ’
(
f’ame
, 
O_RDONLY
, 0);

491 ià(
fd
==-1)

493 
	`mes§ge_”rÜ
(
	`_
("Couldn't open: '%s' for„eading.\n"),

494 
	`dŸ_mes§ge_f’ame
(
f’ame
));

495  
FALSE
;

498 ià(
	`»ad
(
fd
, &
fœ¡ch¬
, 1))

500 
d©a
->
is_com´es£d
 = (
fœ¡ch¬
 != '<');

505 
d©a
->
is_com´es£d
 = 
´efs
.
Ãw_dŸg¿m
.
com´ess_§ve
;

509 
	`şo£
(
fd
);

511 
doc
 = 
	`xmlDŸP¬£Fe
(
f’ame
);

513 ià(
doc
 =ğ
NULL
)

515 
	`mes§ge_”rÜ
(
	`_
("Error†oading diagram %s.\nUnknown fileype."),

516 
	`dŸ_mes§ge_f’ame
(
f’ame
));

517  
FALSE
;

520 ià(
doc
->
xmlRoÙNode
 =ğ
NULL
)

522 
	`mes§ge_”rÜ
(
	`_
("Error†oading diagram %s.\nUnknown fileype."),

523 
	`dŸ_mes§ge_f’ame
(
f’ame
));

524 
	`xmlF»eDoc
 (
doc
);

525  
FALSE
;

528 
Çme¥aû
 = 
	`xmlS—rchNs
(
doc
, doc->
xmlRoÙNode
, (cÚ¡ 
xmlCh¬
 *)"dia");

529 ià(
	`xmlSŒcmp
 (
doc
->
xmlRoÙNode
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"dŸg¿m"è|| (
Çme¥aû
 =ğ
NULL
))

531 
	`mes§ge_”rÜ
(
	`_
("Error†oading diagram %s.\nNot‡ Dia file."),

532 
	`dŸ_mes§ge_f’ame
(
f’ame
));

533 
	`xmlF»eDoc
 (
doc
);

534  
FALSE
;

538 
	`g_±r_¬¿y_»move
(
d©a
->
Ïy”s
, d©a->
aùive_Ïy”
);

539 
	`Ïy”_de¡roy
(
d©a
->
aùive_Ïy”
);

541 
dŸg¿md©a
 =

542 
	`fšd_node_Çmed
 (
doc
->
xmlRoÙNode
->
xmlChd»nNode
, "diagramdata");

545 
d©a
->
bg_cŞÜ
 = 
´efs
.
Ãw_dŸg¿m
.bg_color;

546 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
dŸg¿md©a
, "background");

547 ià(
©Œ
 !ğ
NULL
)

548 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
d©a
->
bg_cŞÜ
);

550 ià(
dŸg¿m
)

552 
dŸg¿m
->
·geb»ak_cŞÜ
 = 
´efs
.
Ãw_dŸg¿m
.pagebreak_color;

553 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
dŸg¿md©a
, "pagebreak");

554 ià(
©Œ
 !ğ
NULL
)

555 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
dŸg¿m
->
·geb»ak_cŞÜ
);

558 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
dŸg¿md©a
, "paper");

559 ià(
©Œ
 !ğ
NULL
)

561 
·³ršfo
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

563 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "name");

564 ià(
©Œ
 !ğ
NULL
)

566 
	`g_ä“
(
d©a
->
·³r
.
Çme
);

567 
d©a
->
·³r
.
Çme
 = 
	`d©a_¡ršg
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

569 ià(
d©a
->
·³r
.
Çme
 =ğ
NULL
 || data->paper.name[0] == '\0')

571 
d©a
->
·³r
.
Çme
 = 
	`g_¡rdup
(
´efs
.
Ãw_dŸg¿m
.
·³¹y³
);

574 
	`dŸ_·ge_Ïyout_g‘_deçuÉ_m¬gšs
(
d©a
->
·³r
.
Çme
,

575 &
d©a
->
·³r
.
tm¬gš
,

576 &
d©a
->
·³r
.
bm¬gš
,

577 &
d©a
->
·³r
.
lm¬gš
,

578 &
d©a
->
·³r
.
rm¬gš
);

580 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "tmargin");

581 ià(
©Œ
 !ğ
NULL
)

582 
d©a
->
·³r
.
tm¬gš
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

583 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "bmargin");

584 ià(
©Œ
 !ğ
NULL
)

585 
d©a
->
·³r
.
bm¬gš
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

586 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "lmargin");

587 ià(
©Œ
 !ğ
NULL
)

588 
d©a
->
·³r
.
lm¬gš
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

589 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "rmargin");

590 ià(
©Œ
 !ğ
NULL
)

591 
d©a
->
·³r
.
rm¬gš
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

593 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "is_portrait");

594 
d©a
->
·³r
.
is_pÜŒa™
 = 
TRUE
;

595 ià(
©Œ
 !ğ
NULL
)

596 
d©a
->
·³r
.
is_pÜŒa™
 = 
	`d©a_boŞ—n
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

598 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "scaling");

599 
d©a
->
·³r
.
sÿlšg
 = 1.0;

600 ià(
©Œ
 !ğ
NULL
)

601 
d©a
->
·³r
.
sÿlšg
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

603 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "fitto");

604 
d©a
->
·³r
.
f™to
 = 
FALSE
;

605 ià(
©Œ
 !ğ
NULL
)

606 
d©a
->
·³r
.
f™to
 = 
	`d©a_boŞ—n
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

608 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "fitwidth");

609 
d©a
->
·³r
.
f™width
 = 1;

610 ià(
©Œ
 !ğ
NULL
)

611 
d©a
->
·³r
.
f™width
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

613 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
·³ršfo
, "fitheight");

614 
d©a
->
·³r
.
f™height
 = 1;

615 ià(
©Œ
 !ğ
NULL
)

616 
d©a
->
·³r
.
f™height
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

619 
	`dŸ_·ge_Ïyout_g‘_·³r_size
(
d©a
->
·³r
.
Çme
,

620 &
d©a
->
·³r
.
width
,

621 &
d©a
->
·³r
.
height
);

622 ià(!
d©a
->
·³r
.
is_pÜŒa™
)

624 
gæßt
 
tmp
 = 
d©a
->
·³r
.
width
;

626 
d©a
->
·³r
.
width
 = d©a->·³r.
height
;

627 
d©a
->
·³r
.
height
 = 
tmp
;

629 
d©a
->
·³r
.
width
 -ğd©a->·³r.
lm¬gš
;

630 
d©a
->
·³r
.
width
 -ğd©a->·³r.
rm¬gš
;

631 
d©a
->
·³r
.
height
 -ğd©a->·³r.
tm¬gš
;

632 
d©a
->
·³r
.
height
 -ğd©a->·³r.
bm¬gš
;

633 
d©a
->
·³r
.
width
 /ğd©a->·³r.
sÿlšg
;

634 
d©a
->
·³r
.
height
 /ğd©a->·³r.
sÿlšg
;

637 ià(
dŸg¿m
)

639 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
dŸg¿md©a
, "grid");

640 ià(
©Œ
 !ğ
NULL
)

642 
gridšfo
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

644 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
gridšfo
, "width_x");

645 ià(
©Œ
 !ğ
NULL
)

646 
dŸg¿m
->
grid
.
width_x
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

647 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
gridšfo
, "width_y");

648 ià(
©Œ
 !ğ
NULL
)

649 
dŸg¿m
->
grid
.
width_y
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

650 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
gridšfo
, "visible_x");

651 ià(
©Œ
 !ğ
NULL
)

652 
dŸg¿m
->
grid
.
visibË_x
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

653 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
gridšfo
, "visible_y");

654 ià(
©Œ
 !ğ
NULL
)

655 
dŸg¿m
->
grid
.
visibË_y
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

657 
dŸg¿m
->
grid
.
cŞour
 = 
´efs
.
Ãw_dŸg¿m
.
grid_cŞÜ
;

658 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
dŸg¿md©a
, "color");

659 ià(
©Œ
 !ğ
NULL
)

660 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
dŸg¿m
->
grid
.
cŞour
);

663 ià(
dŸg¿m
)

665 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
dŸg¿md©a
, "guides");

666 ià(
©Œ
 !ğ
NULL
)

668 
gušt
 
i
;

669 
D©aNode
 
guide
;

671 
guidešfo
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

673 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
guidešfo
, "hguides");

674 ià(
©Œ
 !ğ
NULL
)

676 
dŸg¿m
->
guides
.
nhguides
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

677 
	`g_ä“
(
dŸg¿m
->
guides
.
hguides
);

678 
dŸg¿m
->
guides
.
hguides
 = 
	`g_Ãw
(
»®
, dŸg¿m->guides.
nhguides
);

680 
guide
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

681 
i
 = 0; i < 
dŸg¿m
->
guides
.
nhguides
; i++, 
guide
 = 
	`d©a_Ãxt
(guide))

682 
dŸg¿m
->
guides
.
hguides
[
i
] = 
	`d©a_»®
(
guide
);

684 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
guidešfo
, "vguides");

685 ià(
©Œ
 !ğ
NULL
)

687 
dŸg¿m
->
guides
.
nvguides
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

688 
	`g_ä“
(
dŸg¿m
->
guides
.
vguides
);

689 
dŸg¿m
->
guides
.
vguides
 = 
	`g_Ãw
(
»®
, dŸg¿m->guides.
nvguides
);

691 
guide
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

692 
i
 = 0; i < 
dŸg¿m
->
guides
.
nvguides
; i++, 
guide
 = 
	`d©a_Ãxt
(guide))

693 
dŸg¿m
->
guides
.
vguides
[
i
] = 
	`d©a_»®
(
guide
);

699 
Ïy”_node
 =

700 
	`fšd_node_Çmed
 (
doc
->
xmlRoÙNode
->
xmlChd»nNode
, "layer");

702 
objeùs_hash
 = 
	`g_hash_bË_Ãw
(
g_¡r_hash
, 
g_¡r_equ®
);

704 
Ïy”_node
 !ğ
NULL
)

706 
gch¬
 *
Çme
;

707 *
visibË
;

708 *
aùive
;

710 ià(
	`xmlIsBÏnkNode
(
Ïy”_node
))

712 
Ïy”_node
 =†ay”_node->
Ãxt
;

716 ià(!
Ïy”_node
) ;

718 
Çme
 = (*)
	`xmlG‘Prİ
(
Ïy”_node
, (cÚ¡ 
xmlCh¬
 *)"name");

719 ià(!
Çme
) ;

721 
Ïy”
 = 
	`Ãw_Ïy”
(
	`g_¡rdup
(
Çme
), 
d©a
);

722 ià(
Çme
è
	`xmlF»e
(name);

724 
Ïy”
->
visibË
 = 
FALSE
;

725 
visibË
 = (*)
	`xmlG‘Prİ
(
Ïy”_node
, (cÚ¡ 
xmlCh¬
 *)"visible");

726 ià(
visibË
)

728 ià(
	`¡rcmp
(
visibË
, "true")==0)

729 
Ïy”
->
visibË
 = 
TRUE
;

730 
	`xmlF»e
(
visibË
);

731 
çùÜyCÚš”
->
curLay”
 = 
Ïy”
;

735 
li¡
 = 
	`»ad_objeùs
(
Ïy”_node
, 
objeùs_hash
, 
f’ame
, 
NULL
, 
unknown_objeùs_hash
);

736 
	`Ïy”_add_objeùs
 (
Ïy”
, 
li¡
);

737 
	`»ad_cÚÃùiÚs
Ğ
li¡
, 
Ïy”_node
, 
objeùs_hash
);

739 
	`d©a_add_Ïy”
(
d©a
, 
Ïy”
);

741 
aùive
 = (*)
	`xmlG‘Prİ
(
Ïy”_node
, (cÚ¡ 
xmlCh¬
 *)"active");

742 ià(
aùive
)

744 ià(
	`¡rcmp
(
aùive
, "true")==0)

745 
aùive_Ïy”
 = 
Ïy”
;

746 
	`xmlF»e
(
aùive
);

749 
Ïy”_node
 =†ay”_node->
Ãxt
;

752 ià(!
aùive_Ïy”
)

753 
d©a
->
aùive_Ïy”
 = (
Lay”
 *è
	`g_±r_¬¿y_šdex
(d©a->
Ïy”s
, 0);

755 
	`d©a_£t_aùive_Ïy”
(
d©a
, 
aùive_Ïy”
);

757 
	`xmlF»eDoc
(
doc
);

759 
	`g_hash_bË_fÜ—ch
(
objeùs_hash
, 
hash_ä“_¡ršg
, 
NULL
);

761 
	`g_hash_bË_de¡roy
(
objeùs_hash
);

763 ià(
d©a
->
Ïy”s
->
Ën
 < 1)

765 
	`mes§ge_”rÜ
 (
	`_
("Error†oading diagram:\n%s.\n"

767 
	`dŸ_mes§ge_f’ame
(
f’ame
));

768  
FALSE
;

770 ià(0 < 
	`g_hash_bË_size
(
unknown_objeùs_hash
))

772 
GSŒšg
* 
unknown_¡r
 = 
	`g_¡ršg_Ãw
("Unknownypes while„eading diagram file");

775 
	`g_hash_bË_fÜ—ch
(
unknown_objeùs_hash
,

776 
GHFuncUnknownObjeùs
,

777 
unknown_¡r
);

778 
	`mes§ge_w¬nšg
("%s", 
unknown_¡r
->
¡r
);

779 
	`g_¡ršg_ä“
(
unknown_¡r
, 
TRUE
);

781 
	`g_hash_bË_de¡roy
(
unknown_objeùs_hash
);

783  
TRUE
;

784 
	}
}

786 
gboŞ—n


787 
	$wr™e_objeùs
(
GLi¡
 *
objeùs
, 
xmlNodePŒ
 
objeùs_node
,

788 
GHashTabË
 *
objeùs_hash
, *
obj_Ä
, cÚ¡ *
f’ame
)

790 
bufãr
[31];

791 
ObjeùNode
 
obj_node
;

792 
xmlNodePŒ
 
group_node
;

793 
GLi¡
 *
li¡
;

795 
li¡
 = 
objeùs
;

797 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("STRUCT - Class");

798 
FaùÜySŒuùI‹mLi¡
 *
fs
ğ
	`g_hash_bË_lookup
(
çùÜyCÚš”
->
¡ruùTabË
,"FILELST");

799 
Pošt
 
¡¬ošt
 = {0.0,0.0};

800 
HªdË
 *
h1
,*
h2
;

801 
DŸObjeù
 *
feobj
 = 
Ùy³
->
İs
->
	`ü—‹
(&
¡¬ošt
,&
fs
->
numb”
,&
h1
,&
h2
);

802 
FaùÜySŒuùI‹mLi¡
 *
fs2
ğ
	`g_hash_bË_lookup
(
çùÜyCÚš”
->
¡ruùTabË
,"IDLST");

803 
DŸObjeù
 *
idobj
 = 
Ùy³
->
İs
->
	`ü—‹
(&
¡¬ošt
,&
fs2
->
numb”
,&
h1
,&
h2
);

804 
feobj
->
Çme
 = 
	`g_¡rdup
(
fs
->
¢ame
);

805 
idobj
->
Çme
 = 
	`g_¡rdup
(
fs2
->
¢ame
);

806 
li¡
 = 
	`g_li¡_­³nd
Öi¡,
feobj
);

807 
li¡
 = 
	`g_li¡_­³nd
Öi¡,
idobj
);

808 
li¡
 !ğ
NULL
)

810 
DŸObjeù
 *
obj
 = (DŸObjeù *è
li¡
->
d©a
;

812 ià(
	`g_hash_bË_lookup
(
objeùs_hash
, 
obj
))

814 
li¡
 = 
	`g_li¡_Ãxt
(list);

818 ià(
	`IS_GROUP
(
obj
è&& 
	`group_objeùs
(objè!ğ
NULL
)

820 
group_node
 = 
	`xmlNewChd
(
objeùs_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"group", NULL);

821 
	`wr™e_objeùs
(
	`group_objeùs
(
obj
), 
group_node
,

822 
objeùs_hash
, 
obj_Ä
, 
f’ame
);

826 
obj_node
 = 
	`xmlNewChd
(
objeùs_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"object", NULL);

828 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"ty³", (xmlCh¬ *)
obj
->
ty³
->
Çme
);

833 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"v”siÚ", (xmlCh¬ *)
	`g_¡rdup
(
çùÜyCÚš”
->
fe_v”siÚ
));

838 
	`g_¢´štf
(
bufãr
, 30, "O%d", *
obj_Ä
);

839 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"id", (xmlCh¬ *)
bufãr
);

840 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
obj
->
Çme
);

842 (*
obj
->
ty³
->
İs
->
§ve
)(obj, 
obj_node
, 
f’ame
);

845 
	`g_hash_bË_š£¹
(
objeùs_hash
, 
obj
, 
	`GINT_TO_POINTER
(*
obj_Ä
));

846 (*
obj_Ä
)++;

860 
li¡
 = 
	`g_li¡_Ãxt
(list);

862 
objeùs
 = 
	`g_li¡_»move
(objeùs,
feobj
);

863 
feobj
->
İs
->
	`de¡roy
(fileobj);

864 
objeùs
 = 
	`g_li¡_»move
(objeùs,
idobj
);

865 
idobj
->
İs
->
	`de¡roy
(idobj);

866  
TRUE
;

867 
	}
}

873 
gboŞ—n


874 
	$wr™e_cÚÃùiÚs
(
GLi¡
 *
objeùs
, 
xmlNodePŒ
 
Ïy”_node
,

875 
GHashTabË
 *
objeùs_hash
)

877 
ObjeùNode
 
obj_node
;

878 
GLi¡
 *
li¡
;

879 
xmlNodePŒ
 
cÚÃùiÚs
;

880 
xmlNodePŒ
 
cÚÃùiÚ
;

881 
bufãr
[31];

882 
i
;

884 
li¡
 = 
objeùs
;

885 
obj_node
 = 
Ïy”_node
->
xmlChd»nNode
;

886 (
li¡
 !ğ
NULL
è&& (
obj_node
 != NULL))

888 
DŸObjeù
 *
obj
 = (DŸObjeù *è
li¡
->
d©a
;

890 
obj_node
 && 
	`xmlIsBÏnkNode
(obj_node)èobj_nodğobj_node->
Ãxt
;

891 ià(!
obj_node
) ;

893 
	`IS_GROUP
(
obj
)

895 
	`wr™e_cÚÃùiÚs
(
	`group_objeùs
(
obj
), 
obj_node
, 
objeùs_hash
);

899 
cÚÃùiÚs
 = 
NULL
;

901 
i
=0; i<
obj
->
num_hªdËs
; i++)

903 
CÚÃùiÚPošt
 *
cÚ_pošt
;

904 
HªdË
 *
hªdË
;

906 
hªdË
 = 
obj
->
hªdËs
[
i
];

907 
cÚ_pošt
 = 
hªdË
->
cÚÃùed_to
;

909 iàĞ
cÚ_pošt
 !ğ
NULL
 )

911 
DŸObjeù
 *
Ùh”_obj
;

912 
cÚ_pošt_Ä
;

914 
Ùh”_obj
 = 
cÚ_pošt
->
objeù
;

916 
cÚ_pošt_Ä
=0;

917 
Ùh”_obj
->
cÚÃùiÚs
[
cÚ_pošt_Ä
] !ğ
cÚ_pošt
)

919 
cÚ_pošt_Ä
++;

920 ià(
cÚ_pošt_Ä
>=
Ùh”_obj
->
num_cÚÃùiÚs
)

922 
	`mes§ge_”rÜ
("Internalƒrror saving diagram\n con_point_nr >= other_obj->num_connections\n");

923  
FALSE
;

927 ià(
cÚÃùiÚs
 =ğ
NULL
)

928 
cÚÃùiÚs
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"connections", NULL);

930 
cÚÃùiÚ
 = 
	`xmlNewChd
(
cÚÃùiÚs
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"connection", NULL);

932 
	`g_¢´štf
(
bufãr
, 30, "%d", 
i
);

933 
	`xmlS‘Prİ
(
cÚÃùiÚ
, (cÚ¡ 
xmlCh¬
 *)"hªdË", (xmlCh¬ *)
bufãr
);

935 
	`g_¢´štf
(
bufãr
, 30, "O%d",

936 
	`GPOINTER_TO_INT
(
	`g_hash_bË_lookup
(
objeùs_hash
,

937 
Ùh”_obj
)));

939 
	`xmlS‘Prİ
(
cÚÃùiÚ
, (cÚ¡ 
xmlCh¬
 *)"to", (xmlCh¬ *è
bufãr
);

941 ià(
Ùh”_obj
->
cÚÃùiÚs
[
cÚ_pošt_Ä
]->
Çme
 !ğ
NULL
)

943 
	`g_¢´štf
(
bufãr
, 30, "%s", 
Ùh”_obj
->
cÚÃùiÚs
[
cÚ_pošt_Ä
]->
Çme
);

947 
	`g_¢´štf
(
bufãr
, 30, "%d", 
cÚ_pošt_Ä
);

949 
	`xmlS‘Prİ
(
cÚÃùiÚ
, (cÚ¡ 
xmlCh¬
 *)"cÚÃùiÚ", (xmlCh¬ *è
bufãr
);

954 ià(
obj
->
·»Á
)

956 
DŸObjeù
 *
Ùh”_obj
 = 
obj
->
·»Á
;

957 
xmlNodePŒ
 
·»Á
;

958 
	`g_¢´štf
(
bufãr
, 30, "O%d",

959 
	`GPOINTER_TO_INT
(
	`g_hash_bË_lookup
(
objeùs_hash
, 
Ùh”_obj
)));

960 
·»Á
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"childnode", NULL);

961 
	`xmlS‘Prİ
(
·»Á
, (cÚ¡ 
xmlCh¬
 *)"·»Á", (xmlCh¬ *)
bufãr
);

964 
li¡
 = 
	`g_li¡_Ãxt
(list);

965 
obj_node
 = obj_node->
Ãxt
;

967  
TRUE
;

968 
	}
}

971 
xmlDocPŒ


972 
	$dŸg¿m_d©a_wr™e_doc
(
DŸg¿mD©a
 *
d©a
, cÚ¡ *
f’ame
)

974 
xmlDocPŒ
 
doc
;

975 
xmlNodePŒ
 
Œ“
;

976 
xmlNodePŒ
 
·gešfo
, 
gridšfo
, 
guidešfo
;

977 
xmlNodePŒ
 
Ïy”_node
;

978 
GHashTabË
 *
objeùs_hash
;

979 
gboŞ—n
 
»s
;

980 
obj_Ä
;

981 
gušt
 
i
;

982 
Lay”
 *
Ïy”
;

983 
A‰ribu‹Node
 
©Œ
;

984 
xmlNs
 *
Çme_¥aû
;

985 
DŸg¿m
 *
dŸg¿m
 = 
	`DIA_IS_DIAGRAM
 (
d©a
è? 
	`DIA_DIAGRAM
 (d©aè: 
NULL
;

987 
doc
 = 
	`xmlNewDoc
((cÚ¡ 
xmlCh¬
 *)"1.0");

988 
doc
->
’codšg
 = 
	`xmlSŒdup
((cÚ¡ 
xmlCh¬
 *)"UTF-8");

990 
doc
->
xmlRoÙNode
 = 
	`xmlNewDocNode
(doc, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"diagram", NULL);

992 
Çme_¥aû
 = 
	`xmlNewNs
(
doc
->
xmlRoÙNode
,

993 (cÚ¡ 
xmlCh¬
 *)
DIA_XML_NAME_SPACE_BASE
,

994 (cÚ¡ 
xmlCh¬
 *)"dia");

995 
	`xmlS‘Ns
(
doc
->
xmlRoÙNode
, 
Çme_¥aû
);

997 
Œ“
 = 
	`xmlNewChd
(
doc
->
xmlRoÙNode
, 
Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"dŸg¿md©a", 
NULL
);

999 
©Œ
 = 
	`Ãw_©Œibu‹
((
ObjeùNode
)
Œ“
, "background");

1000 
	`d©a_add_cŞÜ
(
©Œ
, &
d©a
->
bg_cŞÜ
);

1002 ià(
dŸg¿m
)

1004 
©Œ
 = 
	`Ãw_©Œibu‹
((
ObjeùNode
)
Œ“
, "pagebreak");

1005 
	`d©a_add_cŞÜ
(
©Œ
, &
dŸg¿m
->
·geb»ak_cŞÜ
);

1007 
©Œ
 = 
	`Ãw_©Œibu‹
((
ObjeùNode
)
Œ“
, "paper");

1008 
·gešfo
 = 
	`d©a_add_compos™e
(
©Œ
, "paper");

1009 
	`d©a_add_¡ršg
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "name"),

1010 
d©a
->
·³r
.
Çme
);

1011 
	`d©a_add_»®
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "tmargin"),

1012 
d©a
->
·³r
.
tm¬gš
);

1013 
	`d©a_add_»®
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "bmargin"),

1014 
d©a
->
·³r
.
bm¬gš
);

1015 
	`d©a_add_»®
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "lmargin"),

1016 
d©a
->
·³r
.
lm¬gš
);

1017 
	`d©a_add_»®
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "rmargin"),

1018 
d©a
->
·³r
.
rm¬gš
);

1019 
	`d©a_add_boŞ—n
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "is_portrait"),

1020 
d©a
->
·³r
.
is_pÜŒa™
);

1021 
	`d©a_add_»®
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "scaling"),

1022 
d©a
->
·³r
.
sÿlšg
);

1023 
	`d©a_add_boŞ—n
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "fitto"),

1024 
d©a
->
·³r
.
f™to
);

1025 ià(
d©a
->
·³r
.
f™to
)

1027 
	`d©a_add_št
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "fitwidth"),

1028 
d©a
->
·³r
.
f™width
);

1029 
	`d©a_add_št
(
	`compos™e_add_©Œibu‹
(
·gešfo
, "fitheight"),

1030 
d©a
->
·³r
.
f™height
);

1033 ià(
dŸg¿m
)

1035 
©Œ
 = 
	`Ãw_©Œibu‹
((
ObjeùNode
)
Œ“
, "grid");

1036 
gridšfo
 = 
	`d©a_add_compos™e
(
©Œ
, "grid");

1037 
	`d©a_add_»®
(
	`compos™e_add_©Œibu‹
(
gridšfo
, "width_x"),

1038 
dŸg¿m
->
grid
.
width_x
);

1039 
	`d©a_add_»®
(
	`compos™e_add_©Œibu‹
(
gridšfo
, "width_y"),

1040 
dŸg¿m
->
grid
.
width_y
);

1041 
	`d©a_add_št
(
	`compos™e_add_©Œibu‹
(
gridšfo
, "visible_x"),

1042 
dŸg¿m
->
grid
.
visibË_x
);

1043 
	`d©a_add_št
(
	`compos™e_add_©Œibu‹
(
gridšfo
, "visible_y"),

1044 
dŸg¿m
->
grid
.
visibË_y
);

1045 
©Œ
 = 
	`Ãw_©Œibu‹
((
ObjeùNode
)
Œ“
, "color");

1046 
	`d©a_add_compos™e
(
gridšfo
, "color");

1047 
	`d©a_add_cŞÜ
(
©Œ
, &
dŸg¿m
->
grid
.
cŞour
);

1049 
©Œ
 = 
	`Ãw_©Œibu‹
((
ObjeùNode
)
Œ“
, "guides");

1050 
guidešfo
 = 
	`d©a_add_compos™e
(
©Œ
, "guides");

1051 
©Œ
 = 
	`compos™e_add_©Œibu‹
(
guidešfo
, "hguides");

1052 
i
 = 0; i < 
dŸg¿m
->
guides
.
nhguides
; i++)

1053 
	`d©a_add_»®
(
©Œ
, 
dŸg¿m
->
guides
.
hguides
[
i
]);

1054 
©Œ
 = 
	`compos™e_add_©Œibu‹
(
guidešfo
, "vguides");

1055 
i
 = 0; i < 
dŸg¿m
->
guides
.
nvguides
; i++)

1056 
	`d©a_add_»®
(
©Œ
, 
dŸg¿m
->
guides
.
vguides
[
i
]);

1059 
objeùs_hash
 = 
	`g_hash_bË_Ãw
(
g_dœeù_hash
, 
g_dœeù_equ®
);

1061 
obj_Ä
 = 0;

1063 
i
 = 0; i < 
d©a
->
Ïy”s
->
Ën
; i++)

1065 
Ïy”_node
 = 
	`xmlNewChd
(
doc
->
xmlRoÙNode
, 
Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"Ïy”", 
NULL
);

1066 
Ïy”
 = (
Lay”
 *è
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
);

1067 
	`xmlS‘Prİ
(
Ïy”_node
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
Ïy”
->
Çme
);

1069 ià(
Ïy”
->
visibË
)

1070 
	`xmlS‘Prİ
(
Ïy”_node
, (cÚ¡ 
xmlCh¬
 *)"visible", (const xmlChar *)"true");

1072 
	`xmlS‘Prİ
(
Ïy”_node
, (cÚ¡ 
xmlCh¬
 *)"visible", (const xmlChar *)"false");

1074 ià(
Ïy”
 =ğ
d©a
->
aùive_Ïy”
)

1075 
	`xmlS‘Prİ
(
Ïy”_node
, (cÚ¡ 
xmlCh¬
 *)"active", (const xmlChar *)"true");

1077 
	`wr™e_objeùs
(
Ïy”
->
objeùs
, 
Ïy”_node
,

1078 
objeùs_hash
, &
obj_Ä
, 
f’ame
);

1080 
»s
 = 
	`wr™e_cÚÃùiÚs
(
Ïy”
->
objeùs
, 
Ïy”_node
, 
objeùs_hash
);

1082 ià(!
»s
)

1083  
NULL
;

1085 
	`g_hash_bË_de¡roy
(
objeùs_hash
);

1087 ià(
d©a
->
is_com´es£d
)

1088 
	`xmlS‘DocCom´essMode
(
doc
, 9);

1090 
	`xmlS‘DocCom´essMode
(
doc
, 0);

1092  
doc
;

1093 
	}
}

1099 
	$dŸg¿m_d©a_¿w_§ve
(
DŸg¿mD©a
 *
d©a
, cÚ¡ *
f’ame
)

1101 
xmlDocPŒ
 
doc
;

1102 
»t
;

1104 
doc
 = 
	`dŸg¿m_d©a_wr™e_doc
(
d©a
, 
f’ame
);

1106 
»t
 = 
	`xmlDŸSaveFe
 (
f’ame
, 
doc
);

1107 
	`xmlF»eDoc
(
doc
);

1109  
»t
;

1110 
	}
}

1119 
	$dŸg¿m_d©a_§ve
(
DŸg¿mD©a
 *
d©a
, cÚ¡ *
u£r_f’ame
)

1121 
FILE
 *
fe
;

1122 *
bakÇme
=
NULL
,*
tm²ame
=NULL,*
dœÇme
=NULL,*
p
;

1123 *
f’ame
 = (*)
u£r_f’ame
;

1124 
mode
,
_umask
;

1125 
fdes
;

1126 
»t
 = 0;

1129 #ià
	`GLIB_CHECK_VERSION
(2,8,0è&& !
defšed
 
G_OS_WIN32


1132 iàĞ
	`g_fe_‹¡
(
f’ame
, 
G_FILE_TEST_EXISTS
)

1133 && 
	`g_acûss
(
f’ame
, 
W_OK
) != 0)

1135 
	`mes§ge_”rÜ
(
	`_
("Not‡llowedo writeo output file %s\n"),

1136 
	`dŸ_mes§ge_f’ame
(
f’ame
));

1137 
CLEANUP
;

1141 ià(
	`g_fe_‹¡
(
u£r_f’ame
, 
G_FILE_TEST_IS_SYMLINK
))

1143 
GE¼Ü
 *
”rÜ
 = 
NULL
;

1144 
f’ame
 = 
	`g_fe_»ad_lšk
(
u£r_f’ame
, &
”rÜ
);

1145 ià(!
f’ame
)

1147 
	`mes§ge_”rÜ
("%s", 
”rÜ
->
mes§ge
);

1148 
	`g_”rÜ_ä“
(
”rÜ
);

1149 
CLEANUP
;

1154 
dœÇme
 = 
	`g_¡rdup
(
f’ame
);

1155 
p
 = 
	`¡¼chr
((*)
dœÇme
,
G_DIR_SEPARATOR
);

1156 ià(
p
)

1158 *(
p
+1) = 0;

1162 
	`g_ä“
(
dœÇme
);

1163 
dœÇme
 = 
	`g_¡rdup
("." 
G_DIR_SEPARATOR_S
);

1165 
tm²ame
 = 
	`g_¡rcÚÿt
(
dœÇme
,"__dŸXXXXXX",
NULL
);

1166 
bakÇme
 = 
	`g_¡rcÚÿt
(
f’ame
,"~",
NULL
);

1168 #ià
	`GLIB_CHECK_VERSION
(2,8,0è&& !
defšed
 
G_OS_WIN32


1170 iàĞ
	`g_fe_‹¡
(
dœÇme
, 
G_FILE_TEST_EXISTS
)

1171 && 
	`g_acûss
(
dœÇme
, 
W_OK
) != 0)

1173 
	`mes§ge_”rÜ
(
	`_
("Not‡llowedo writeemporary files in %s\n"),

1174 
	`dŸ_mes§ge_f’ame
(
dœÇme
));

1175 
CLEANUP
;

1181 
fdes
 = 
	`g_mk¡emp
(
tm²ame
);

1183 
_umask
 = 
	`umask
(0);

1184 
	`umask
(
_umask
);

1185 
mode
 = 0666 & ~
_umask
;

1186 #iâdeà
G_OS_WIN32


1187 
»t
 = 
	`fchmod
(
fdes
,
mode
);

1189 
»t
 = 0;

1191 
fe
 = 
	`fdİ’
(
fdes
,"wb");

1195 ià(
fe
==
NULL
)

1197 
	`mes§ge_”rÜ
(
	`_
("Can't open output file %s: %s\n"),

1198 
	`dŸ_mes§ge_f’ame
(
tm²ame
), 
	`¡»¼Ü
(
”ºo
));

1199 
CLEANUP
;

1201 
	`fşo£
(
fe
);

1203 
»t
 = 
	`dŸg¿m_d©a_¿w_§ve
(
d©a
, 
tm²ame
);

1205 ià(
»t
 < 0)

1209 
	`mes§ge_”rÜ
(
	`_
("Internalƒrror %d writing file %s\n"),

1210 
»t
, 
	`dŸ_mes§ge_f’ame
(
tm²ame
));

1211 
	`g_uÆšk
(
tm²ame
);

1212 
CLEANUP
;

1216 
	`g_uÆšk
(
bakÇme
);

1217 
	`g_»Çme
(
f’ame
,
bakÇme
);

1218 
»t
 = 
	`g_»Çme
(
tm²ame
,
f’ame
);

1219 ià(
»t
 < 0)

1221 
	`mes§ge_”rÜ
(
	`_
("Can't„ename %so final output file %s: %s\n"),

1222 
	`dŸ_mes§ge_f’ame
(
f’ame
),

1223 
	`dŸ_mes§ge_f’ame
(
f’ame
), 
	`¡»¼Ü
(
”ºo
));

1225 
CLEANUP
:

1226 ià(
f’ame
 !ğ
u£r_f’ame
)

1227 
	`g_ä“
(
f’ame
);

1228 
	`g_ä“
(
tm²ame
);

1229 
	`g_ä“
(
dœÇme
);

1230 
	`g_ä“
(
bakÇme
);

1234 
gch¬
 *
exefe
 = 
	`dŸ_g‘_lib_dœeùÜy
("bin");

1235 
gch¬
 *
fuÎ·th
 = 
	`g_¡rcÚÿt
(
exefe
,
G_DIR_SEPARATOR_S
"makebš.exe",
NULL
);

1236 if(!
	`g_fe_‹¡
(
fuÎ·th
, 
G_FILE_TEST_EXISTS
))

1238 
gch¬
 *
msg_utf8
 = 
	`g_loÿË_to_utf8
 (
	`_
("makebš.exÕÒ²»µ½,Ã»ÓĞÉú³ÉbšÎÄ¼ş."), -1, 
NULL
, NULL, NULL);

1239 
	`mes§ge_”rÜ
(
msg_utf8
);

1240 
	`g_ä“
(
msg_utf8
);

1244 
gch¬
 *
šput
 = 
	`g_¡rdup_´štf
("-i=\"%s\"",
u£r_f’ame
);

1245 
n
 = 
	`¡¾’
(
u£r_f’ame
);

1246 
gch¬
 *
Ãwfe
 = 
	`g_¡rdup
(
u£r_f’ame
);

1247 
Ãwfe
[
n
-1] = 'n';

1248 
Ãwfe
[
n
-2] = 'i';

1249 
Ãwfe
[
n
-3] = 'b';

1250 
gch¬
 *
outfe
 = 
	`g_¡rdup_´štf
("-o=\"%s\"",
Ãwfe
);

1252 
gch¬
 *
utf8f
 = 
	`g_cÚv”t
(
fuÎ·th
,-1,"GB2312","UTF-8",
NULL
,NULL,NULL);

1253 
gch¬
 *
utf8i
 = 
	`g_cÚv”t
(
šput
,-1,"GB2312","UTF-8",
NULL
,NULL,NULL);

1254 
gch¬
 *
utf8o
 = 
	`g_cÚv”t
(
outfe
,-1,"GB2312","UTF-8",
NULL
,NULL,NULL);

1255 
gch¬
 *
¬g
 = 
	`g_¡rjoš
(" ",
utf8f
,
utf8i
,
utf8o
,
NULL
);

1256 
	`sy¡em
(
¬g
);

1257 
	`g_ä“
(
outfe
);

1258 
	`g_ä“
(
Ãwfe
);

1259 
	`g_ä“
(
šput
);

1260 
	`g_ä“
(
¬g
);

1261 
	`g_ä“
(
utf8f
);

1262 
	`g_ä“
(
utf8i
);

1263 
	`g_ä“
(
utf8o
);

1265 
	`g_ä“
(
fuÎ·th
);

1266 
	`g_ä“
(
exefe
);

1267  (
»t
?
FALSE
:
TRUE
);

1268 
	}
}

1271 
	$dŸg¿m_§ve
(
DŸg¿m
 *
dŸ
, cÚ¡ *
f’ame
)

1273 
gboŞ—n
 
»s
 = 
	`dŸg¿m_d©a_§ve
(
dŸ
->
d©a
, 
f’ame
);

1275 ià(!
»s
)

1277  
»s
;

1280 
dŸ
->
un§ved
 = 
FALSE
;

1281 
	`undo_m¬k_§ve
(
dŸ
->
undo
);

1282 
	`dŸg¿m_£t_modif›d
 (
dŸ
, 
FALSE
);

1284 
	`dŸg¿m_ş—nup_auto§ve
(
dŸ
);

1286  
TRUE
;

1287 
	}
}

1291 
	$dŸg¿m_ş—nup_auto§ve
(
DŸg¿m
 *
dŸ
)

1293 
gch¬
 *
§vefe
;

1294 
¡©
 
¡©buf
;

1296 
§vefe
 = 
dŸ
->
auto§vef’ame
;

1297 ià(
§vefe
 =ğ
NULL
) ;

1298 #ifdeà
TRACES


1299 
	`g_´št
("Cleaning up‡utosave %s for %s\n",

1300 
§vefe
, 
dŸ
->
f’ame
 ? dia->filename : "<no‚ame>");

1302 ià(
	`g_¡©
(
§vefe
, &
¡©buf
) == 0)

1304 
	`g_uÆšk
(
§vefe
);

1306 
	`g_ä“
(
§vefe
);

1307 
dŸ
->
auto§vef’ame
 = 
NULL
;

1308 
dŸ
->
auto§ved
 = 
FALSE
;

1309 
	}
}

1315 
	$dŸg¿m_auto§ve
(
DŸg¿m
 *
dŸ
)

1317 
gch¬
 *
§ve_f’ame
;

1320 
GLi¡
 *
dŸg¿ms
 = 
	`dŸ_İ’_dŸg¿ms
();

1321 
DŸg¿m
 *
dŸg¿m
;

1322 
dŸg¿ms
 !ğ
NULL
)

1324 
dŸg¿m
 = (
DŸg¿m
 *)
dŸg¿ms
->
d©a
;

1325 ià(
dŸg¿m
 =ğ
dŸ
 &&

1326 
	`dŸg¿m_is_modif›d
(
dŸg¿m
) &&

1327 !
dŸg¿m
->
auto§ved
)

1329 
§ve_f’ame
 = 
	`g_¡rdup_´štf
("%s.auto§ve", 
dŸ
->
f’ame
);

1331 ià(
dŸ
->
auto§vef’ame
 !ğ
NULL
)

1332 
	`g_ä“
(
dŸ
->
auto§vef’ame
);

1333 
dŸ
->
auto§vef’ame
 = 
§ve_f’ame
;

1334 
	`dŸg¿m_d©a_¿w_§ve
(
dŸ
->
d©a
, 
§ve_f’ame
);

1335 
dŸ
->
auto§ved
 = 
TRUE
;

1338 
dŸg¿ms
 = 
	`g_li¡_Ãxt
(diagrams);

1340 
	}
}

1344 
	$expÜt_Çtive
(
DŸg¿mD©a
 *
d©a
, cÚ¡ 
gch¬
 *
f’ame
,

1345 cÚ¡ 
gch¬
 *
dŸf’ame
, * 
u£r_d©a
)

1347 
	`dŸg¿m_d©a_§ve
(
d©a
, 
f’ame
);

1348 
	}
}

1350 cÚ¡ 
gch¬
 *
	gex‹nsiÚs
[] = { "dŸ", 
NULL
 };

1351 
DŸExpÜtF‹r
 
	gdŸ_expÜt_f‹r
 =

1353 
N_
("Dia Diagram File"),

1354 
ex‹nsiÚs
,

1355 
expÜt_Çtive


1357 
DIAVAR
 
DŸImpÜtF‹r
 
	gdŸ_impÜt_f‹r
 =

1359 
N_
("Dia Diagram File"),

1360 
ex‹nsiÚs
,

1361 
dŸg¿m_d©a_lßd


	@O:\tool\dvs50\app\load_save.h

18 #iâdeà
LOAD_SAVE_H


19 
	#LOAD_SAVE_H


	)

21 
	~"dŸg¿m.h
"

22 
	~"f‹r.h
"

24 
dŸg¿m_§ve
(
DŸg¿m
 *
dŸ
, cÚ¡ *
f’ame
);

25 
dŸg¿m_auto§ve
(
DŸg¿m
 *
dŸ
);

26 
dŸg¿m_ş—nup_auto§ve
(
DŸg¿m
 *
dŸ
);

28 
DŸExpÜtF‹r
 
dŸ_expÜt_f‹r
;

29 
DŸImpÜtF‹r
 
dŸ_impÜt_f‹r
;

	@O:\tool\dvs50\app\magnify.c

18 
	~<cÚfig.h
>

19 
	~<¡dlib.h
>

20 
	~<m©h.h
>

22 
	~"magnify.h
"

23 
	~"cursÜ.h
"

26 
	$magnify_bu‰Ú_´ess
(
MagnifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

27 
DDi¥Ïy
 *
ddi¥
)

29 
toŞ
->
x
 =oŞ->
Şdx
 = 
ev’t
->x;

30 
toŞ
->
y
 =oŞ->
Şdy
 = 
ev’t
->y;

31 
toŞ
->
box_aùive
 = 
TRUE
;

32 
toŞ
->
moved
 = 
FALSE
;

33 
	`gdk_poš‹r_g¿b
 (
ddi¥
->
ÿnvas
->
wšdow
, 
FALSE
,

34 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

35 
NULL
, NULL, 
ev’t
->
time
);

36 
	}
}

39 
	$magnify_bu‰Ú_»Ëa£
(
MagnifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

40 
DDi¥Ïy
 *
ddi¥
)

42 
ReùªgË
 *
visibË
;

43 
Pošt
 
p1
, 
p2
, 

;

44 
»®
 
diff
;

45 
idiff
;

46 
»®
 
çùÜ
;

48 
toŞ
->
box_aùive
 = 
FALSE
;

50 
visibË
 = &
ddi¥
->visible;

52 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
, 
toŞ
->
x
,oŞ->
y
, &
p1
.x, &p1.y);

53 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
, 
ev’t
->
x
,ƒv’t->
y
, &
p2
.x, &p2.y);

55 

.
x
 = 
	`MIN
(
p1
.x, 
p2
.x);

56 

.
y
 = 
	`MIN
(
p1
.y, 
p2
.y);

58 
diff
 = 
	`MAX
(
	`çbs
(
p2
.
x
 - 
p1
.x), fabsÕ2.
y
 -…1.y));

59 
idiff
 = 
	`MAX
(
	`abs
(
toŞ
->
x
 - 
ev’t
->x),‡bsÑoŞ->
y
 -ƒvent->y));

61 ià(
toŞ
->
moved
) {

62 ià(
idiff
 <= 4) {

63 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

64 
	`ddi¥Ïy_æush
(
ddi¥
);

65 } ià(!(
ev’t
->
¡©e
 & 
GDK_CONTROL_MASK
)) {

66 
çùÜ
 = (
visibË
->
right
 - visibË->
Ëá
è/ 
diff
;

67 

.
x
 +ğ(
visibË
->
right
 - visibË->
Ëá
)/(2.0*
çùÜ
);

68 

.
y
 +ğ(
visibË
->
bÙtom
 - visibË->
tİ
)/(2.0*
çùÜ
);

69 
	`ddi¥Ïy_zoom
(
ddi¥
, &

, 
çùÜ
);

71 
çùÜ
 = 
diff
 / (
visibË
->
right
 - visibË->
Ëá
);

72 

.
x
 =l.x * 
çùÜ
 +l.x;

73 

.
y
 =l.y * 
çùÜ
 +l.y;

74 
	`ddi¥Ïy_zoom
(
ddi¥
, &

, 
çùÜ
);

77 ià(
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
)

78 
	`ddi¥Ïy_zoom
(
ddi¥
, &

, 0.5);

80 
	`ddi¥Ïy_zoom
(
ddi¥
, &

, 2.0);

83 
	`gdk_poš‹r_ung¿b
 (
ev’t
->
time
);

84 
	}
}

86 
	sštPošt
 { 
	mx
,
	my
; } 
	tštPošt
;

89 
	$magnify_mÙiÚ
(
MagnifyToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

90 
DDi¥Ïy
 *
ddi¥
)

92 
štPošt
 

, 
br
;

94 ià(
toŞ
->
box_aùive
) {

95 
toŞ
->
moved
 = 
TRUE
;

97 ià(
toŞ
->
gc
 =ğ
NULL
) {

98 
toŞ
->
gc
 = 
	`gdk_gc_Ãw
(
ddi¥
->
ÿnvas
->
wšdow
);

99 
	`gdk_gc_£t_lše_©Œibu‹s
(
toŞ
->
gc
, 1, 
GDK_LINE_ON_OFF_DASH
,

100 
GDK_CAP_BUTT
, 
GDK_JOIN_MITER
);

101 
	`gdk_gc_£t_fÜeground
(
toŞ
->
gc
, &
cŞÜ_gdk_wh™e
);

102 
	`gdk_gc_£t_funùiÚ
(
toŞ
->
gc
, 
GDK_XOR
);

105 

.
x
 = 
	`MIN
(
toŞ
->x,oŞ->
Şdx
);l.
y
 = MINÑoŞ->y,oŞ->
Şdy
);

106 
br
.
x
 = 
	`MAX
(
toŞ
->x,oŞ->
Şdx
); br.
y
 = MAXÑoŞ->y,oŞ->
Şdy
);

108 
	`gdk_d¿w_»ùªgË
 (
ddi¥
->
ÿnvas
->
wšdow
,

109 
toŞ
->
gc
, 
FALSE
, 

.
x
,l.
y
, 
br
.x -l.x, br.y -l.y);

111 

.
x
 = 
	`MIN
(
toŞ
->x, 
ev’t
->x);l.
y
 = MIN(tool->y,ƒvent->y);

112 
br
.
x
 = 
	`MAX
(
toŞ
->x, 
ev’t
->x); br.
y
 = MAX(tool->y,ƒvent->y);

114 
	`gdk_d¿w_»ùªgË
 (
ddi¥
->
ÿnvas
->
wšdow
,

115 
toŞ
->
gc
, 
FALSE
, 

.
x
,l.
y
, 
br
.x -l.x, br.y -l.y);

117 
toŞ
->
Şdx
 = 
ev’t
->
x
;

118 
toŞ
->
Şdy
 = 
ev’t
->
y
;

120 
	}
}

123 
	$£t_zoom_out
(
ToŞ
 *
toŞ
)

125 ((
MagnifyToŞ
 *)
toŞ
)->
zoom_out
 = 
TRUE
;

126 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_ZOOM_OUT
));

127 
	}
}

130 
	$£t_zoom_š
(
ToŞ
 *
toŞ
)

132 ((
MagnifyToŞ
 *)
toŞ
)->
zoom_out
 = 
FALSE
;

133 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_ZOOM_IN
));

134 
	}
}

136 
ToŞ
 *

137 
	$ü—‹_magnify_toŞ
()

139 
MagnifyToŞ
 *
toŞ
;

141 
toŞ
 = 
	`g_Ãw0
(
MagnifyToŞ
, 1);

142 
toŞ
->toŞ.
ty³
 = 
MAGNIFY_TOOL
;

143 
toŞ
->toŞ.
bu‰Ú_´ess_func
 = (
Bu‰ÚP»ssFunc
è&
magnify_bu‰Ú_´ess
;

144 
toŞ
->toŞ.
bu‰Ú_»Ëa£_func
 = (
Bu‰ÚP»ssFunc
è&
magnify_bu‰Ú_»Ëa£
;

145 
toŞ
->toŞ.
mÙiÚ_func
 = (
MÙiÚFunc
è&
magnify_mÙiÚ
;

146 
toŞ
->toŞ.
doubË_şick_func
 = 
NULL
;

148 
toŞ
->
gc
 = 
NULL
;

149 
toŞ
->
box_aùive
 = 
FALSE
;

150 
toŞ
->
zoom_out
 = 
FALSE
;

152 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_ZOOM_IN
));

154  (
ToŞ
 *è
toŞ
;

155 
	}
}

158 
	$ä“_magnify_toŞ
(
ToŞ
 *
toŞ
)

160 
	`g_ä“
(
toŞ
);

161 
	`ddi¥Ïy_£t_®l_cursÜ
(
deçuÉ_cursÜ
);

162 
	}
}

	@O:\tool\dvs50\app\magnify.h

18 #iâdeà
MAGNIFY_H


19 
	#MAGNIFY_H


	)

21 
	~"toŞ.h
"

23 
_MagnifyToŞ
 
	tMagnifyToŞ
;

25 
	s_MagnifyToŞ
 {

26 
ToŞ
 
	mtoŞ
;

28 
GdkGC
 *
	mgc
;

30 
	mbox_aùive
;

31 
	mmoved
;

32 
	mx
, 
	my
;

33 
	mŞdx
, 
	mŞdy
;

35 
gboŞ—n
 
	mzoom_out
;

38 
DIAVAR
 
ToŞ
 *
ü—‹_magnify_toŞ
();

39 
DIAVAR
 
ä“_magnify_toŞ
(
ToŞ
 *
toŞ
);

40 
DIAVAR
 
£t_zoom_out
(
ToŞ
 *
toŞ
);

41 
DIAVAR
 
£t_zoom_š
(
ToŞ
 *
toŞ
);

	@O:\tool\dvs50\app\main.c

19 
	~<cÚfig.h
>

20 
	~"­p_´ocs.h
"

21 
	~"š‹rçû.h
"

24 
	$maš
(
¬gc
, *
¬gv
[])

27 
	`­p_š™
(
¬gc
, 
¬gv
);

29 ià(!
	`­p_is_š‹¿ùive
())

32 
	`toŞbox_show
();

34 
	`­p_¥Ïsh_dÚe
();

36 
	`gtk_maš
 ();

38 
	}
}

	@O:\tool\dvs50\app\menus.c

20 #ifdeà
HAVE_CONFIG_H


21 
	~<cÚfig.h
>

24 #undeà
GTK_DISABLE_DEPRECATED


25 
	~<gtk/gtk.h
>

26 
	~<gdk/gdkkeysyms.h
>

27 
	~<¡ršg.h
>

29 
	~"š.h
"

30 
	~"m’us.h
"

31 
	~"toŞ.h
"

32 
	~"commªds.h
"

33 
	~"mes§ge.h
"

34 
	~"š‹rçû.h
"

35 
	~"di¥Ïy.h
"

36 
	~"fedlg.h
"

37 
	~"fšd-ªd-»¶aû.h
"

38 
	~"¶ugš-mªag”.h
"

39 
	~"£Ëù.h
"

40 
	~"dŸ_dœs.h
"

41 
	~"dŸg¿m_Œ“_wšdow.h
"

42 
	~"objeù_İs.h
"

43 
	~"sh“ts.h
"

44 
	~"dŸ-­p-icÚs.h
"

45 
	~"widg‘s.h
"

46 
	~"´eã»nûs.h
"

48 
	#DIA_STOCK_GROUP
 "dŸ-¡ock-group"

	)

49 
	#DIA_STOCK_UNGROUP
 "dŸ-¡ock-ungroup"

	)

50 
	#DIA_STOCK_LAYER_ADD
 "dŸ-¡ock-Ïy”-add"

	)

51 
	#DIA_STOCK_LAYER_RENAME
 "dŸ-¡ock-Ïy”-»Çme"

	)

52 
	#DIA_STOCK_OBJECTS_LAYER_ABOVE
 "dŸ-¡ock-objeùs-Ïy”-above"

	)

53 
	#DIA_STOCK_OBJECTS_LAYER_BELOW
 "dŸ-¡ock-objeùs-Ïy”-b–ow"

	)

54 
	#DIA_STOCK_LAYERS
 "dŸ-¡ock-Ïy”s"

	)

56 
	#DIA_SHOW_TEAROFFS
 
TRUE


	)

59 
	#DIA_INTEGRATED_TOOLBAR_ZOOM_COMBO
 "dŸ-š‹g¿‹d-toŞb¬-zoom-combo_’Œy"

	)

60 
	#DIA_INTEGRATED_TOOLBAR_SNAP_GRID
 "dŸ-š‹g¿‹d-toŞb¬-¢­-grid"

	)

61 
	#DIA_INTEGRATED_TOOLBAR_OBJECT_SNAP
 "dŸ-š‹g¿‹d-toŞb¬-objeù-¢­"

	)

63 
	#ZOOM_FIT
 
	`_
("F™")

	)

65 
¶ugš_ÿÎback
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
);

67 
GtkWidg‘
 *

68 
ü—‹_š‹g¿‹d_ui_toŞb¬
 ();

70 
add_¶ugš_aùiÚs
 (
GtkUIMªag”
 *
ui_mªag”
, cÚ¡ *
ba£_·th
);

72 
gch¬
*

73 
bud_ui_f’ame
 (cÚ¡ 
gch¬
* 
Çme
);

79 cÚ¡ 
GtkAùiÚEÁry
 
	gcommÚ_’Œ›s
[] =

81 { "Fe", 
NULL
, 
N_
("_File"), NULL, NULL, NULL },

82 { "FeNew", 
GTK_STOCK_NEW
, 
NULL
, "<cÚŒŞ>N", NULL, 
G_CALLBACK
 (
fe_Ãw_ÿÎback
) },

83 { "FeO³n", 
GTK_STOCK_OPEN
, 
NULL
,"<cÚŒŞ>O", NULL, 
G_CALLBACK
 (
fe_İ’_ÿÎback
) },

84 { "FeQu™", 
GTK_STOCK_QUIT
, 
NULL
, "<cÚŒŞ>Q", NULL, 
G_CALLBACK
 (
fe_qu™_ÿÎback
) },

85 { "H–p", 
NULL
, 
N_
("_Help"), NULL, NULL, NULL },

86 { "H–pCÚ‹Ás", 
GTK_STOCK_HELP
, 
NULL
, "F1", NULL, 
G_CALLBACK
 (
h–p_mªu®_ÿÎback
) },

87 { "H–pAbout", 
GTK_STOCK_ABOUT
, 
NULL
, NULL, NULL, 
G_CALLBACK
 (
h–p_about_ÿÎback
) }

91 cÚ¡ 
GtkAùiÚEÁry
 
	gtoŞbox_’Œ›s
[] =

95 { "FeSh“ts", 
NULL
, 
N_
("Sheets‡nd Objects..."), "F9", NULL, NULL },

96 { "FeP»fs", 
GTK_STOCK_PREFERENCES
, 
NULL
, NULL, NULL, 
G_CALLBACK
 (
fe_´eã»nûs_ÿÎback
) },

97 { "FePlugšs", 
NULL
, 
N_
("Plugšs..."),NULL, NULL, 
G_CALLBACK
 (
fe_¶ugšs_ÿÎback
) }

102 cÚ¡ 
GtkToggËAùiÚEÁry
 
	gtoŞbox_toggË_’Œ›s
[] =

104 { "FeT»e", 
NULL
, 
N_
("_DŸg¿m»e..."), "F8", NULL, 
G_CALLBACK
 (
dŸgŒ“_show_ÿÎback
) }

108 cÚ¡ 
GtkToggËAùiÚEÁry
 
	gš‹g¿‹d_ui_v›w_toggË_’Œ›s
[] =

110 { 
VIEW_MAIN_TOOLBAR_ACTION
, 
NULL
, 
N_
("Show ToŞb¬"), NULL, NULL, 
G_CALLBACK
 (
v›w_maš_toŞb¬_ÿÎback
) },

111 { 
VIEW_MAIN_STATUSBAR_ACTION
, 
NULL
, 
N_
("Show Stusb¬"), NULL, NULL, 
G_CALLBACK
 (
v›w_maš_¡©usb¬_ÿÎback
) },

112 { 
VIEW_LAYERS_ACTION
, 
NULL
, 
N_
("Show Lay”s"), "<cÚŒŞ>L", NULL, 
G_CALLBACK
 (
v›w_Ïy”s_ÿÎback
) }

116 cÚ¡ 
GtkAùiÚEÁry
 
	gdi¥Ïy_’Œ›s
[] =

118 { "FeSave", 
GTK_STOCK_SAVE
, 
NULL
, "<cÚŒŞ>S", NULL, 
G_CALLBACK
 (
fe_§ve_ÿÎback
) },

119 { "FeSav—s", 
GTK_STOCK_SAVE_AS
, 
NULL
, "<cÚŒŞ><shiá>S", NULL, 
G_CALLBACK
 (
fe_§ve_as_ÿÎback
) },

124 { "FeClo£", 
GTK_STOCK_CLOSE
, 
NULL
, "<cÚŒŞ>W", NULL, 
G_CALLBACK
 (
fe_şo£_ÿÎback
) },

126 { "Ed™", 
NULL
, 
N_
("_Edit"), NULL, NULL, NULL },

128 { "Ed™Undo", 
GTK_STOCK_UNDO
, 
NULL
, "<control>Z", NULL, NULL },

130 { "Ed™Redo", 
GTK_STOCK_REDO
, 
NULL
, "<control><shift>Z", NULL, NULL },

132 { "Ed™Cİy", 
GTK_STOCK_COPY
, 
NULL
, "<cÚŒŞ>C", NULL, 
G_CALLBACK
 (
ed™_cİy_ÿÎback
) },

133 { "Ed™Cut", 
GTK_STOCK_CUT
, 
NULL
, "<cÚŒŞ>X", NULL, 
G_CALLBACK
 (
ed™_cut_ÿÎback
) },

134 { "Ed™Pa¡e", 
GTK_STOCK_PASTE
, 
NULL
, "<cÚŒŞ>V", NULL, 
G_CALLBACK
 (
ed™_·¡e_ÿÎback
) },

135 { "Ed™Du¶iÿ‹", 
NULL
, 
N_
("_Du¶iÿ‹"), "<cÚŒŞ>D", NULL, 
G_CALLBACK
 (
ed™_du¶iÿ‹_ÿÎback
) },

136 { "Ed™D–‘e", 
GTK_STOCK_DELETE
, 
NULL
, "D–‘e", NULL, 
G_CALLBACK
 (
ed™_d–‘e_ÿÎback
) },

138 { "Ed™Fšd", 
GTK_STOCK_FIND
, 
NULL
, "<cÚŒŞ>F", NULL, 
G_CALLBACK
 (
ed™_fšd_ÿÎback
) },

139 { "Ed™R•Ïû", 
GTK_STOCK_FIND_AND_REPLACE
, 
NULL
, "<cÚŒŞ>H", NULL, 
G_CALLBACK
 (
ed™_»¶aû_ÿÎback
) },

143 { "Ed™Cİy‹xt", 
NULL
, 
N_
("Cİy Text"), NULL, NULL, 
G_CALLBACK
 (
ed™_cİy_‹xt_ÿÎback
) },

144 { "Ed™Cu‰ext", 
NULL
, 
N_
("CuˆText"), "<cÚŒŞ><shiá>X", NULL, 
G_CALLBACK
 (
ed™_cut_‹xt_ÿÎback
) },

145 { "Ed™Pa¡‘ext", 
NULL
, 
N_
("Pa¡_Text"), "<cÚŒŞ><shiá>V", NULL, 
G_CALLBACK
 (
ed™_·¡e_‹xt_ÿÎback
) },

209 { "S–eù", 
NULL
, 
N_
("_Select"), NULL, NULL, NULL },

210 { "S–eùAÎ", 
NULL
, 
N_
("AÎ"), "<cÚŒŞ>A", NULL, 
G_CALLBACK
 (
£Ëù_®l_ÿÎback
) },

211 { "S–eùNÚe", 
NULL
, 
N_
("NÚe"), "<cÚŒŞ><shiá>A", NULL, 
G_CALLBACK
 (
£Ëù_nÚe_ÿÎback
) },

212 { "S–eùInv”t", 
NULL
, 
N_
("Inv”t"), "<cÚŒŞ>I", NULL, 
G_CALLBACK
 (
£Ëù_šv”t_ÿÎback
) },

214 { "S–eùT¿ns™ive", 
NULL
, 
N_
("T¿ns™ive"), "<cÚŒŞ>T", NULL, 
G_CALLBACK
 (
£Ëù_Œªs™ive_ÿÎback
) },

215 { "S–eùCÚÃùed", 
NULL
, 
N_
("CÚÃùed"), "<cÚŒŞ><shiá>T", NULL, 
G_CALLBACK
 (
£Ëù_cÚÃùed_ÿÎback
) },

216 { "S–eùSam‘y³", 
NULL
, 
N_
("SamTy³"), NULL, NULL, 
G_CALLBACK
 (
£Ëù_§me_ty³_ÿÎback
) },

220 { "S–eùBy", 
NULL
, 
N_
("Select By"), NULL, NULL, NULL },

222 { "IÅutM‘hods", 
NULL
, 
N_
("_Input Methods"), NULL, NULL, NULL },

224 { "DŸlogs", 
NULL
, 
N_
("D_ialogs"), NULL, NULL, NULL },

226 { "Debug", 
NULL
, 
N_
("D_ebug"), NULL, NULL, NULL }

230 cÚ¡ 
GtkAùiÚEÁry
 
	gtoŞ_’Œ›s
[] =

232 { "ToŞs", 
NULL
, 
N_
("_Tools"), NULL, NULL, NULL },

233 { "ToŞsModify", 
NULL
, 
N_
("Modify"), "N", NULL, NULL },

234 { "ToŞsMagnify", 
NULL
, 
N_
("Magnify"), "M", NULL, NULL },

235 { "ToŞsTex‹d™", 
NULL
, 
N_
("Editext"), "F2", NULL, NULL },

236 { "ToŞsSüŞl", 
NULL
, 
N_
("Scroll"), "S", NULL, NULL },

237 { "ToŞsText", 
NULL
, 
N_
("Text"), "T", NULL, NULL },

238 { "ToŞsBox", 
NULL
, 
N_
("Box"), "R", NULL, NULL },

239 { "ToŞsEÎ£", 
NULL
, 
N_
("Ellipse"), "E", NULL, NULL },

240 { "ToŞsPŞygÚ", 
NULL
, 
N_
("Polygon"), "P", NULL, NULL },

241 { "ToŞsBez›rgÚ", 
NULL
, 
N_
("Beziergon"), "B", NULL, NULL },

243 { "ToŞsLše", 
NULL
, 
N_
("Line"), "L", NULL, NULL },

244 { "ToŞsArc", 
NULL
, 
N_
("Arc"), "A", NULL, NULL },

245 { "ToŞsZigzaglše", 
NULL
, 
N_
("Zigzagline"), "Z", NULL, NULL },

246 { "ToŞsPŞylše", 
NULL
, 
N_
("Polyline"), "Y", NULL },

247 { "ToŞsBez›¾še", 
NULL
, 
N_
("Bezierline"), "C", NULL, NULL },

248 { "ToŞsOuše", 
NULL
, 
N_
("Outline"), "O", NULL, NULL },

250 { "ToŞsImage", 
NULL
, 
N_
("Image"), "I", NULL, NULL },

254 cÚ¡ 
GtkToggËAùiÚEÁry
 
	gdi¥Ïy_toggË_’Œ›s
[] =

256 #ifdeà
GTK_STOCK_FULLSCREEN


257 { "V›wFuÎsü“n", 
GTK_STOCK_FULLSCREEN
, 
NULL
, "F11", NULL, 
G_CALLBACK
 (
v›w_fuÎsü“n_ÿÎback
) },

259 { "V›wFuÎsü“n", 
NULL
, 
N_
("FuÎsü_“n"), "F11", NULL, 
G_CALLBACK
 (
v›w_fuÎsü“n_ÿÎback
) },

261 { "V›wAÁŸlŸ£d", 
NULL
, 
N_
("_AÁiAlŸ£d"), NULL, NULL, 
G_CALLBACK
 (
v›w_¯_ÿÎback
) },

262 { "V›wShowgrid", 
NULL
, 
N_
("Show _Grid"), NULL, NULL, 
G_CALLBACK
 (
v›w_visibË_grid_ÿÎback
) },

263 { "V›wSÇ±ogrid", 
NULL
, 
N_
("_SÇ°TØGrid"), NULL, NULL, 
G_CALLBACK
 (
v›w_¢­_to_grid_ÿÎback
) },

264 { "V›wSÇ±oobjeùs", 
NULL
, 
N_
("SÇ°TØ_Objeùs"), NULL, NULL, 
G_CALLBACK
 (
v›w_¢­_to_objeùs_ÿÎback
) },

265 { "V›wShowruËrs", 
NULL
, 
N_
("Show _RuËrs"), NULL, NULL, 
G_CALLBACK
 (
v›w_toggË_ruËrs_ÿÎback
) },

266 { "V›wShowcÚÃùiÚpošts", 
NULL
, 
N_
("Show _CÚÃùiÚ Pošts"), NULL, NULL, 
G_CALLBACK
 (
v›w_show_cx_±s_ÿÎback
) }

270 cÚ¡ 
GtkRadioAùiÚEÁry
 
	gdi¥Ïy_£Ëù_¿dio_’Œ›s
[] =

272 { "S–eùR•Ïû", 
NULL
, 
N_
("R•Ïû"), NULL, NULL, 
SELECT_REPLACE
 },

273 { "S–eùUniÚ", 
NULL
, 
N_
("UniÚ"), NULL, NULL, 
SELECT_UNION
 },

274 { "S–eùIÁ”£ùiÚ", 
NULL
, 
N_
("IÁ”£ùiÚ"), NULL, NULL, 
SELECT_INTERSECTION
 },

275 { "S–eùRemove", 
NULL
, 
N_
("Remove"), NULL, NULL, 
SELECT_REMOVE
 },

277 { "S–eùInv”£", 
NULL
, 
N_
("Inv”£"), NULL, NULL, 
SELECT_INVERT
 }

281 
gboŞ—n
 
	gš™Ÿli£
 = 
TRUE
;

284 
GtkUIMªag”
 *
	gš‹g¿‹d_ui_mªag”
 = 
NULL
;

285 
GtkAùiÚGroup
 *
	gš‹g¿‹d_ui_aùiÚs
 = 
NULL
;

286 
GtkAùiÚGroup
 *
	gš‹g¿‹d_ui_toŞ_aùiÚs
 = 
NULL
;

287 
GtkAcûlGroup
 *
	gš‹g¿‹d_ui_acûls
 = 
NULL
;

288 
GtkWidg‘
 *
	gš‹g¿‹d_ui_m’ub¬
 = 
NULL
;

289 
GtkWidg‘
 *
	gš‹g¿‹d_ui_toŞb¬
 = 
NULL
;

292 
GtkUIMªag”
 *
	gtoŞbox_ui_mªag”
 = 
NULL
;

293 
GtkAùiÚGroup
 *
	gtoŞbox_aùiÚs
 = 
NULL
;

294 
GtkAcûlGroup
 *
	gtoŞbox_acûls
 = 
NULL
;

295 
GtkWidg‘
 *
	gtoŞbox_m’ub¬
 = 
NULL
;

297 
GtkAùiÚGroup
 *
	g»ûÁ_aùiÚs
 = 
NULL
;

298 
GSLi¡
 *
	g»ûÁ_m”ge_ids
 = 
NULL
;

301 
GtkUIMªag”
 *
	gdi¥Ïy_ui_mªag”
 = 
NULL
;

302 
GtkAùiÚGroup
 *
	gdi¥Ïy_aùiÚs
 = 
NULL
;

303 
GtkAùiÚGroup
 *
	gdi¥Ïy_toŞ_aùiÚs
 = 
NULL
;

304 
GtkAcûlGroup
 *
	gdi¥Ïy_acûls
 = 
NULL
;

305 
GtkWidg‘
 *
	gdi¥Ïy_m’ub¬
 = 
NULL
;

307 
gch¬
*

308 
	$_dŸ_Œª¦©e
 (cÚ¡ 
gch¬
* 
‹rm
, 
gpoš‹r
 
d©a
)

310 
gch¬
* 
Œªs
 = (gch¬*è
‹rm
;

312 ià(
‹rm
 && *term)

315 
Œªs
 = 
	`dg‘‹xt
 (
GETTEXT_PACKAGE
, 
‹rm
);

317 ià(
‹rm
 =ğ
Œªs
)

318 
Œªs
 = 
	`dg‘‹xt
 ("gtk20", 
‹rm
);

321 ià(
‹rm
 =ğ
Œªs
)

323 
gch¬
* 
kludge
 = 
	`g_¡rdup_´štf
 ("/%s", 
‹rm
);

324 
Œªs
 = 
	`dg‘‹xt
 (
GETTEXT_PACKAGE
, 
kludge
);

325 ià(
kludge
 =ğ
Œªs
)

326 
Œªs
 = 
‹rm
;

328 ++
Œªs
;

329 
	`g_ä“
 (
kludge
);

331 ià(
‹rm
 =ğ
Œªs
)

332 
Œªs
 = 
	`g_¡rdup_´štf
 ("XXX: %s", 
‹rm
);

335  
Œªs
;

336 
	}
}

339 
	$toŞ_m’u_£Ëù
(
GtkWidg‘
 *
w
, 
gpoš‹r
 
d©a
)

341 
ToŞBu‰ÚD©a
 *
toŞd©a
 = (ToŞBu‰ÚD©¨*è
d©a
;

343 ià(
toŞd©a
 =ğ
NULL
)

345 
	`g_w¬nšg
(
	`_
("NULLooldata inool_menu_select"));

349 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
toŞd©a
->
widg‘
),
TRUE
);

350 
	}
}

352 
gšt


353 
	$§ve_acûls
(
gpoš‹r
 
d©a
)

355 
gch¬
 *
acûlf’ame
;

357 
acûlf’ame
 = 
	`dŸ_cÚfig_f’ame
("menurc");

358 ià(
acûlf’ame
)

360 
	`gtk_acûl_m­_§ve
 (
acûlf’ame
);

361 
	`g_ä“
 (
acûlf’ame
);

363  
TRUE
;

364 
	}
}

371 
	$š‹g¿‹d_ui_toŞb¬_objeù_¢­_synchrÚize_to_di¥Ïy
(
gpoš‹r
 
·¿m
)

373 
DDi¥Ïy
 *
ddi¥
 = 
·¿m
;

374 ià(
ddi¥
 && ddi¥->
commÚ_toŞb¬
)

376 
GtkToggËBu‰Ú
 *
b
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
ddi¥
->
commÚ_toŞb¬
),

377 
DIA_INTEGRATED_TOOLBAR_OBJECT_SNAP
);

378 
gboŞ—n
 
aùive
 = 
ddi¥
->
mašpošt_magÃtism
? 
TRUE
 : 
FALSE
;

379 
	`gtk_toggË_bu‰Ú_£t_aùive
 (
b
, 
aùive
);

381 
	}
}

389 
	$š‹g¿‹d_ui_toŞb¬_objeù_¢­_toggË
(
GtkToggËBu‰Ú
 *
b
, 
gpoš‹r
 *
nÙ_u£d
)

391 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
 ();

392 ià(
ddi¥
)

394 
	`ddi¥Ïy_£t_¢­_to_objeùs
 (
ddi¥
, 
	`gtk_toggË_bu‰Ú_g‘_aùive
 (
b
));

396 
	}
}

403 
	$š‹g¿‹d_ui_toŞb¬_grid_¢­_synchrÚize_to_di¥Ïy
(
gpoš‹r
 
·¿m
)

405 
DDi¥Ïy
 *
ddi¥
 = 
·¿m
;

406 ià(
ddi¥
 && ddi¥->
commÚ_toŞb¬
)

408 
GtkToggËBu‰Ú
 *
b
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
ddi¥
->
commÚ_toŞb¬
),

409 
DIA_INTEGRATED_TOOLBAR_SNAP_GRID
);

410 
gboŞ—n
 
aùive
 = 
ddi¥
->
grid
.
¢­
? 
TRUE
 : 
FALSE
;

411 
	`gtk_toggË_bu‰Ú_£t_aùive
 (
b
, 
aùive
);

413 
	}
}

421 
	$š‹g¿‹d_ui_toŞb¬_grid_¢­_toggË
(
GtkToggËBu‰Ú
 *
b
, 
gpoš‹r
 *
nÙ_u£d
)

423 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
 ();

424 ià(
ddi¥
)

426 
	`ddi¥Ïy_£t_¢­_to_grid
 (
ddi¥
, 
	`gtk_toggË_bu‰Ú_g‘_aùive
 (
b
));

428 
	}
}

435 
	$š‹g¿‹d_ui_toŞb¬_£t_zoom_‹xt
 (
GtkToŞb¬
 *
toŞb¬
, cÚ¡ 
gch¬
 * 
‹xt
)

437 ià(
toŞb¬
)

439 
GtkComboBoxEÁry
 *
combo_’Œy
 = 
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
toŞb¬
),

440 
DIA_INTEGRATED_TOOLBAR_ZOOM_COMBO
);

442 ià(
combo_’Œy
)

444 
GtkWidg‘
 * 
’Œy
 = 
	`gtk_bš_g‘_chd
 (
	`GTK_BIN
 (
combo_’Œy
));

446 
	`gtk_’Œy_£t_‹xt
 (
	`GTK_ENTRY
 (
’Œy
), 
‹xt
);

449 
	}
}

457 
	$š‹g¿‹d_ui_toŞb¬_add_cu¡om_™em
 (
GtkToŞb¬
 *
toŞb¬
, 
GtkWidg‘
 *
w
)

459 
GtkToŞI‹m
 *
toŞ_™em
;

460 
GtkWidg‘
 *
c
;

462 
toŞ_™em
 = 
	`gtk_toŞ_™em_Ãw
 ();

463 
c
 = 
	`gtk_vbox_Ãw
 (
FALSE
, 0);

464 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
toŞ_™em
), 
c
);

465 
	`gtk_box_£t_homog’eous
 (
	`GTK_BOX
 (
c
), 
TRUE
);

466 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
c
), 
w
, 
FALSE
, FALSE, 0);

467 
	`gtk_toŞb¬_š£¹
 (
toŞb¬
, 
toŞ_™em
, -1);

468 
	`gtk_widg‘_show
 (
	`GTK_WIDGET
 (
toŞ_™em
));

469 
	`gtk_widg‘_show
 (
c
);

470 
	`gtk_widg‘_show
 (
w
);

471 
	}
}

474 
	$š‹g¿‹d_ui_toŞb¬_zoom_aùiv©e
 (
GtkWidg‘
 *
™em
,

475 
gpoš‹r
 
u£r_d©a
)

477 cÚ¡ 
gch¬
 *
‹xt
 = 
	`gtk_’Œy_g‘_‹xt
 (
	`GTK_ENTRY
 (
™em
));

478 
zoom_³rûÁ
;

480 ià(
	`ssÿnf
 (
‹xt
, "%f", &
zoom_³rûÁ
) == 1)

482 
	`v›w_zoom_£t
 (10.0 * 
zoom_³rûÁ
);

484 
	}
}

487 
	$š‹g¿‹d_ui_toŞb¬_zoom_combo_£ËùiÚ_chªged
 (
GtkComboBox
 *
combo
,

488 
gpoš‹r
 
u£r_d©a
)

494 ià(
	`gtk_combo_box_g‘_aùive
 (
combo
) != -1)

496 
zoom_³rûÁ
;

497 
gch¬
 * 
‹xt
 = 
	`gtk_combo_box_g‘_aùive_‹xt
 (
combo
);

499 ià(
	`ssÿnf
 (
‹xt
, "%f", &
zoom_³rûÁ
) == 1)

501 
	`v›w_zoom_£t
 (
zoom_³rûÁ
 * 10.0);

503 ià(
	`g_¡rÿ£cmp
 (
‹xt
, 
ZOOM_FIT
) == 0)

505 
	`v›w_show_®l_ÿÎback
 (
NULL
);

508 
	`g_ä“
 (
‹xt
);

510 
	}
}

512 
gušt


513 
	$’su»_m’u_·th
 (
GtkUIMªag”
 *
ui_mªag”
, 
GtkAùiÚGroup
 *
aùiÚs
, cÚ¡ 
gch¬
 *
·th
, 
gboŞ—n
 
’d
)

515 
gušt
 
id
 = 
	`gtk_ui_mªag”_Ãw_m”ge_id
 (
ui_mªag”
);

517 ià(!
	`gtk_ui_mªag”_g‘_widg‘
 (
ui_mªag”
, 
·th
))

519 
gch¬
 *
sub·th
 = 
	`g_¡rdup
 (
·th
);

521 ià(
	`¡¼chr
 (
sub·th
, '/'))

523 cÚ¡ 
gch¬
 *
aùiÚ_Çme
;

524 
gch¬
 *
£p
;

526 
GtkAùiÚ
 *
aùiÚ
;

528 
£p
 = 
	`¡¼chr
 (
sub·th
, '/');

529 *
£p
 = '\0';

530 
aùiÚ_Çme
 = 
£p
 + 1;

532 
	`’su»_m’u_·th
 (
ui_mªag”
, 
aùiÚs
, 
sub·th
, 
FALSE
);

534 
aùiÚ
 = 
	`gtk_aùiÚ_Ãw
 (
aùiÚ_Çme
, 
£p
 + 1, 
NULL
, NULL);

535 ià(!
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
aùiÚs
, 
aùiÚ_Çme
))

536 
	`gtk_aùiÚ_group_add_aùiÚ
 (
aùiÚs
, 
aùiÚ
);

537 
	`g_objeù_uÄef
 (
	`G_OBJECT
 (
aùiÚ
));

539 
	`gtk_ui_mªag”_add_ui
 (
ui_mªag”
, 
id
, 
sub·th
,

540 
aùiÚ_Çme
,‡ction_name,

541 
’d
 ? 
GTK_UI_MANAGER_SEPARATOR
 : 
GTK_UI_MANAGER_MENU
,

542 
FALSE
);

546 
	`g_w¬nšg
 ("’su»_m’u_·th(èšv®id m’u…©h: %s.", 
sub·th
 ? subpath : "NULL");

548 
	`g_ä“
 (
sub·th
);

550  
id
;

551 
	}
}

560 
GtkWidg‘
 *

561 
	$ü—‹_š‹g¿‹d_ui_toŞb¬
 ()

563 
GtkToŞb¬
 *
toŞb¬
;

564 
GtkToŞI‹m
 *
£p
;

565 
GtkWidg‘
 *
w
;

566 
GE¼Ü
 *
”rÜ
 = 
NULL
;

567 
gch¬
 *
uife
;

569 
uife
 = 
	`bud_ui_f’ame
 ("ui/toolbar-ui.xml");

570 ià(!
	`gtk_ui_mªag”_add_ui_äom_fe
 (
š‹g¿‹d_ui_mªag”
, 
uife
, &
”rÜ
))

572 
	`g_w¬nšg
 ("budšg m’u çed: %s", 
”rÜ
->
mes§ge
);

573 
	`g_”rÜ_ä“
 (
”rÜ
);

574 
”rÜ
 = 
NULL
;

575 
toŞb¬
 = 
	`GTK_TOOLBAR
 (
	`gtk_toŞb¬_Ãw
 ());

579 
toŞb¬
 = 
	`GTK_TOOLBAR
(
	`gtk_ui_mªag”_g‘_widg‘
 (
š‹g¿‹d_ui_mªag”
, "/Toolbar"));

581 
	`g_ä“
 (
uife
);

584 
w
 = 
	`gtk_combo_box_’Œy_Ãw_‹xt
 ();

586 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
toŞb¬
),

587 
DIA_INTEGRATED_TOOLBAR_ZOOM_COMBO
,

588 
w
);

589 
	`š‹g¿‹d_ui_toŞb¬_add_cu¡om_™em
 (
toŞb¬
, 
w
);

591 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
ZOOM_FIT
);

592 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("800%"));

593 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("400%"));

594 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("300%"));

595 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("200%"));

596 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("150%"));

597 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("100%"));

598 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("75%"));

599 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("50%"));

600 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("25%"));

601 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
w
), 
	`_
("10%"));

603 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
w
),

605 
	`G_CALLBACK
 (
š‹g¿‹d_ui_toŞb¬_zoom_combo_£ËùiÚ_chªged
),

606 
NULL
);

609 
w
 = 
	`gtk_bš_g‘_chd
 (
	`GTK_BIN
 (w));

610 
	`gtk_’Œy_£t_width_ch¬s
 (
	`GTK_ENTRY
 (
w
), 6);

612 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
w
), "activate",

613 
	`G_CALLBACK
(
š‹g¿‹d_ui_toŞb¬_zoom_aùiv©e
),

614 
NULL
);

617 
£p
 = 
	`gtk_£·¿tÜ_toŞ_™em_Ãw
 ();

618 
	`gtk_toŞb¬_š£¹
 (
toŞb¬
, 
£p
, -1);

619 
	`gtk_widg‘_show
 (
	`GTK_WIDGET
 (
£p
));

622 
w
 = 
	`dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs
 (
dŸ_Ú_grid_icÚ
,

623 
dŸ_off_grid_icÚ
);

624 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
w
), "toggled",

625 
	`G_CALLBACK
 (
š‹g¿‹d_ui_toŞb¬_grid_¢­_toggË
), 
toŞb¬
);

626 
	`gtk_toŞts_£t_t
 (
toŞ_ts
, 
w
,

627 
	`_
("ToggË ¢­-to-grid."), 
NULL
);

628 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
toŞb¬
),

629 
DIA_INTEGRATED_TOOLBAR_SNAP_GRID
,

630 
w
);

631 
	`š‹g¿‹d_ui_toŞb¬_add_cu¡om_™em
 (
toŞb¬
, 
w
);

634 
w
 = 
	`dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs
 (
dŸ_mašpošts_Ú_icÚ
,

635 
dŸ_mašpošts_off_icÚ
);

636 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
w
), "toggled",

637 
	`G_CALLBACK
 (
š‹g¿‹d_ui_toŞb¬_objeù_¢­_toggË
), 
toŞb¬
);

638 
	`gtk_toŞts_£t_t
 (
toŞ_ts
, 
w
,

639 
	`_
("ToggË objeù sÇµšg."), 
NULL
);

640 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
toŞb¬
),

641 
DIA_INTEGRATED_TOOLBAR_OBJECT_SNAP
,

642 
w
);

643 
	`š‹g¿‹d_ui_toŞb¬_add_cu¡om_™em
 (
toŞb¬
, 
w
);

645 
£p
 = 
	`gtk_£·¿tÜ_toŞ_™em_Ãw
 ();

646 
	`gtk_toŞb¬_š£¹
 (
toŞb¬
, 
£p
, -1);

649 
GtkWidg‘
 *
bŠ
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
	`çùÜy_utf8
("ÒôÀÖ×ª»»"));

650 
	`š‹g¿‹d_ui_toŞb¬_add_cu¡om_™em
(
toŞb¬
,
bŠ
);

659 
	`gtk_widg‘_show
 (
	`GTK_WIDGET
 (
£p
));

661  
	`GTK_WIDGET
 (
toŞb¬
);

662 
	}
}

669 
GtkAùiÚGroup
 *

670 
	$ü—‹_toŞ_aùiÚs
 ()

672 
GtkAùiÚGroup
 *
aùiÚs
;

673 
GtkAùiÚ
 *
aùiÚ
;

674 
i
;

675 
gch¬
 *
Çme
;

676 
gušt
 
út
 = 0;

678 
Çme
 = 
	`g_¡rdup_´štf
 ("toŞ-aùiÚs-%d", 
út
);

679 
aùiÚs
 = 
	`gtk_aùiÚ_group_Ãw
 (
Çme
);

680 
	`gtk_aùiÚ_group_£t_Œª¦©iÚ_domaš
 (
aùiÚs
, 
NULL
);

681 
	`gtk_aùiÚ_group_£t_Œª¦©e_func
 (
aùiÚs
, 
_dŸ_Œª¦©e
, 
NULL
, NULL);

682 
	`g_ä“
 (
Çme
);

683 
Çme
 = 
NULL
;

684 
út
++;

689 
i
 = 0; i < 
num_toŞs
; i++)

691 
aùiÚ
 = 
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
aùiÚs
, 
toŞ_d©a
[
i
].
aùiÚ_Çme
);

692 ià(
aùiÚ
 !ğ
NULL
)

694 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
aùiÚ
), "activate",

695 
	`G_CALLBACK
 (
toŞ_m’u_£Ëù
),

696 &
toŞ_d©a
[
i
].
ÿÎback_d©a
);

700 
	`g_w¬nšg
 ("couldn'ˆfšdoŞ m’u i‹m %s", 
toŞ_d©a
[
i
].
aùiÚ_Çme
);

703  
aùiÚs
;

704 
	}
}

708 
	$add_¶ugš_aùiÚs
 (
GtkUIMªag”
 *
ui_mªag”
, cÚ¡ 
gch¬
 *
ba£_·th
)

710 
GtkAùiÚGroup
 *
aùiÚs
;

711 
GtkAùiÚ
 *
aùiÚ
;

712 
GLi¡
 *
cbli¡
;

713 
DŸC®lbackF‹r
 *
cbf
 = 
NULL
;

714 
gch¬
 *
Çme
;

715 
gušt
 
id
;

716 
gušt
 
út
 = 0;

718 
Çme
 = 
	`g_¡rdup_´štf
 ("¶ugš-aùiÚs-%d", 
út
);

719 
aùiÚs
 = 
	`gtk_aùiÚ_group_Ãw
 (
Çme
);

720 
	`gtk_aùiÚ_group_£t_Œª¦©iÚ_domaš
 (
aùiÚs
, 
NULL
);

721 
	`gtk_aùiÚ_group_£t_Œª¦©e_func
 (
aùiÚs
, 
_dŸ_Œª¦©e
, 
NULL
, NULL);

722 
	`g_ä“
 (
Çme
);

723 
Çme
 = 
NULL
;

724 
út
++;

726 
	`gtk_ui_mªag”_š£¹_aùiÚ_group
 (
ui_mªag”
, 
aùiÚs
, 5 );

727 
	`g_objeù_uÄef
 (
aùiÚs
);

729 
cbli¡
 = 
	`f‹r_g‘_ÿÎbacks
(); cbli¡; cbli¡ = cbli¡->
Ãxt
)

731 
gch¬
 *
m’u_·th
 = 
NULL
;

733 
cbf
 = 
cbli¡
->
d©a
;

735 ià(
cbf
 =ğ
NULL
)

737 
	`g_w¬nšg
 ("missing DiaCallbackFilter instance");

741 ià(
cbf
->
aùiÚ
 =ğ
NULL
)

743 
	`g_w¬nšg
 ("Plugin '%s': doesn't specify‡ction. Loading failed.",

744 
cbf
->
desütiÚ
);

748 iàĞ
ba£_·th
 !ğ
NULL


749 && 
	`¡ºcmp
 (
cbf
->
m’u·th
, 
ba£_·th
, 
	`¡¾’
 (base_path)) != 0)

754 ià(!
ba£_·th
)

757 ià(
	`¡ºcmp
 (
cbf
->
m’u·th
, 
DISPLAY_MENU
, 
	`¡¾’
 (DISPLAY_MENU)) == 0)

758 
m’u_·th
 = 
	`g_¡rdup_´štf
 ("%s%s", 
INTEGRATED_MENU
, 
cbf
->
m’u·th
 + 
	`¡¾’
 (
DISPLAY_MENU
));

759 ià(
	`¡ºcmp
 (
cbf
->
m’u·th
, 
TOOLBOX_MENU
, 
	`¡¾’
 (TOOLBOX_MENU)) == 0)

760 
m’u_·th
 = 
	`g_¡rdup_´štf
 ("%s%s", 
INTEGRATED_MENU
, 
cbf
->
m’u·th
 + 
	`¡¾’
 (
TOOLBOX_MENU
));

763 
aùiÚ
 = 
	`gtk_aùiÚ_Ãw
 (
cbf
->aùiÚ, cbf->
desütiÚ
, 
NULL
, NULL);

764 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
aùiÚ
), "activate",

765 
	`G_CALLBACK
 (
¶ugš_ÿÎback
), (
gpoš‹r
è
cbf
);

767 
	`gtk_aùiÚ_group_add_aùiÚ
 (
aùiÚs
, 
aùiÚ
);

768 
	`g_objeù_uÄef
 (
	`G_OBJECT
 (
aùiÚ
));

770 
id
 = 
	`’su»_m’u_·th
 (
ui_mªag”
, 
aùiÚs
, 
m’u_·th
 ? m’u_·th : 
cbf
->
m’u·th
, 
TRUE
);

771 
	`gtk_ui_mªag”_add_ui
 (
ui_mªag”
, 
id
,

772 
m’u_·th
 ? m’u_·th : 
cbf
->
m’u·th
,

773 
cbf
->
desütiÚ
,

774 
cbf
->
aùiÚ
,

775 
GTK_UI_MANAGER_AUTO
,

776 
FALSE
);

777 
	`g_ä“
 (
m’u_·th
);

779 
	}
}

782 
	$_add_¡ock_icÚ
 (
GtkIcÚFaùÜy
 *
çùÜy
, cÚ¡ *
Çme
, cÚ¡ 
gušt8
 *
d©a
, cÚ¡ 
size_t
 
size
)

784 
GdkPixbuf
 *
pixbuf
;

785 
GtkIcÚS‘
 *
£t
;

786 
GE¼Ü
 *
”r
 = 
NULL
;

788 
pixbuf
 = 
	`gdk_pixbuf_Ãw_äom_šlše
 (
size
, 
d©a
, 
FALSE
, &
”r
);

789 ià(
”r
)

791 
	`g_w¬nšg
 ("%s", 
”r
->
mes§ge
);

792 
	`g_”rÜ_ä“
 (
”r
);

793 
”r
 = 
NULL
;

795 
£t
 = 
	`gtk_icÚ_£t_Ãw_äom_pixbuf
 (
pixbuf
);

796 
	`gtk_icÚ_çùÜy_add
 (
çùÜy
, 
Çme
, 
£t
);

797 
	`g_objeù_uÄef
 (
pixbuf
);

798 
pixbuf
 = 
NULL
;

799 
	}
}

802 
	$»gi¡”_¡ock_icÚs
 ()

804 
GtkIcÚFaùÜy
 *
çùÜy
;

806 
çùÜy
 = 
	`gtk_icÚ_çùÜy_Ãw
 ();

808 
	`_add_¡ock_icÚ
 (
çùÜy
, 
DIA_STOCK_GROUP
, 
dŸ_group_icÚ
, (dia_group_icon));

809 
	`_add_¡ock_icÚ
 (
çùÜy
, 
DIA_STOCK_UNGROUP
, 
dŸ_ungroup_icÚ
, (dia_ungroup_icon));

811 
	`_add_¡ock_icÚ
 (
çùÜy
, 
DIA_STOCK_LAYER_ADD
, 
dŸ_Ïy”_add
, (dia_layer_add));

812 
	`_add_¡ock_icÚ
 (
çùÜy
, 
DIA_STOCK_LAYER_RENAME
, 
dŸ_Ïy”_»Çme
, (dia_layer_rename));

813 
	`_add_¡ock_icÚ
 (
çùÜy
, 
DIA_STOCK_OBJECTS_LAYER_ABOVE
, 
dŸ_objeùs_Ïy”_above
, (dia_objects_layer_above));

814 
	`_add_¡ock_icÚ
 (
çùÜy
, 
DIA_STOCK_OBJECTS_LAYER_BELOW
, 
dŸ_objeùs_Ïy”_b–ow
, (dia_objects_layer_below));

815 
	`_add_¡ock_icÚ
 (
çùÜy
, 
DIA_STOCK_LAYERS
, 
dŸ_Ïy”s
, (dia_layers));

817 
	`gtk_icÚ_çùÜy_add_deçuÉ
 (
çùÜy
);

818 
	`g_objeù_uÄef
 (
çùÜy
);

819 
çùÜy
 = 
NULL
;

820 
	}
}

822 
gch¬
*

823 
	$bud_ui_f’ame
 (cÚ¡ 
gch¬
* 
Çme
)

825 
gch¬
* 
uife
;

827 ià(
	`g_g‘’v
 ("DIA_BASE_PATH"è!ğ
NULL
)

830 cÚ¡ 
gch¬
* 
p
 = 
	`¡¼chr
 (
Çme
, '/');

831 ià(
p
 !ğ
NULL
)

832 
Çme
 = 
p
+1;

833 
uife
 = 
	`g_bud_f’ame
 (
	`g_g‘’v
 ("DIA_BASE_PATH"), "d©a", 
Çme
, 
NULL
);

836 
uife
 = 
	`dŸ_g‘_d©a_dœeùÜy
 (
Çme
);

838  
uife
;

839 
	}
}

847 
	$_ui_mªag”_cÚÃù_´oxy
 (
GtkUIMªag”
 *
mªag”
,

848 
GtkAùiÚ
 *
aùiÚ
,

849 
GtkWidg‘
 *
´oxy
)

851 ià(
	`GTK_IS_MENU_ITEM
 (
´oxy
))

853 
gch¬
 *
toŞt
;

855 
	`g_objeù_g‘
 (
aùiÚ
, "toŞt", &
toŞt
, 
NULL
);

857 ià(
toŞt
)

859 
	`gtk_toŞts_£t_t
 (
toŞ_ts
, 
´oxy
, 
toŞt
, 
NULL
);

860 
	`g_ä“
 (
toŞt
);

863 
	}
}

865 
GtkAùiÚGroup
 *

866 
	$ü—‹_Ü_»f_di¥Ïy_aùiÚs
 ()

868 ià(
di¥Ïy_aùiÚs
)

869  
	`g_objeù_»f
 (
di¥Ïy_aùiÚs
);

870 
di¥Ïy_aùiÚs
 = 
	`gtk_aùiÚ_group_Ãw
 ("display-actions");

871 
	`gtk_aùiÚ_group_£t_Œª¦©iÚ_domaš
 (
di¥Ïy_aùiÚs
, 
NULL
);

872 
	`gtk_aùiÚ_group_£t_Œª¦©e_func
 (
di¥Ïy_aùiÚs
, 
_dŸ_Œª¦©e
, 
NULL
, NULL);

873 
	`gtk_aùiÚ_group_add_aùiÚs
 (
toŞbox_aùiÚs
, 
toŞbox_’Œ›s
,

874 
	`G_N_ELEMENTS
 (
toŞbox_’Œ›s
), 
NULL
);

875 
	`gtk_aùiÚ_group_add_aùiÚs
 (
di¥Ïy_aùiÚs
, 
commÚ_’Œ›s
,

876 
	`G_N_ELEMENTS
 (
commÚ_’Œ›s
), 
NULL
);

879 
	`gtk_aùiÚ_group_add_aùiÚs
 (
di¥Ïy_aùiÚs
, 
di¥Ïy_’Œ›s
,

880 
	`G_N_ELEMENTS
 (
di¥Ïy_’Œ›s
), 
NULL
);

882 
	`gtk_aùiÚ_group_add_¿dio_aùiÚs
 (
di¥Ïy_aùiÚs
,

883 
di¥Ïy_£Ëù_¿dio_’Œ›s
,

884 
	`G_N_ELEMENTS
 (
di¥Ïy_£Ëù_¿dio_’Œ›s
),

886 
	`G_CALLBACK
 (
£Ëù_¡yË_ÿÎback
),

887 
NULL
);

889  
di¥Ïy_aùiÚs
;

890 
	}
}

894 cÚ¡ 
gch¬
 *
	gui_šfo
 =

905 
	$m’us_š™
()

907 
gch¬
 *
acûlf’ame
;

908 
GE¼Ü
 *
”rÜ
 = 
NULL
;

909 
gch¬
 *
uife
;

911 ià(!
š™Ÿli£
)

914 
š™Ÿli£
 = 
FALSE
;

916 
	`»gi¡”_¡ock_icÚs
 ();

919 
toŞbox_aùiÚs
 = 
	`gtk_aùiÚ_group_Ãw
 ("toolbox-actions");

920 
	`gtk_aùiÚ_group_£t_Œª¦©iÚ_domaš
 (
toŞbox_aùiÚs
, 
NULL
);

921 
	`gtk_aùiÚ_group_£t_Œª¦©e_func
 (
toŞbox_aùiÚs
, 
_dŸ_Œª¦©e
, 
NULL
, NULL);

922 
	`gtk_aùiÚ_group_add_aùiÚs
 (
toŞbox_aùiÚs
, 
commÚ_’Œ›s
,

923 
	`G_N_ELEMENTS
 (
commÚ_’Œ›s
), 
NULL
);

925 
	`gtk_aùiÚ_group_add_aùiÚs
 (
toŞbox_aùiÚs
, 
toŞbox_’Œ›s
,

926 
	`G_N_ELEMENTS
 (
toŞbox_’Œ›s
), 
NULL
);

931 
toŞbox_ui_mªag”
 = 
	`gtk_ui_mªag”_Ãw
 ();

932 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
toŞbox_ui_mªag”
),

934 
	`G_CALLBACK
 (
_ui_mªag”_cÚÃù_´oxy
),

935 
NULL
);

936 
	`gtk_ui_mªag”_£t_add_‹¬offs
 (
toŞbox_ui_mªag”
, 
DIA_SHOW_TEAROFFS
);

937 
	`gtk_ui_mªag”_š£¹_aùiÚ_group
 (
toŞbox_ui_mªag”
, 
toŞbox_aùiÚs
, 0);

938 
uife
 = 
	`bud_ui_f’ame
 ("ui/toolbox-ui.xml");

939 ià(!
	`gtk_ui_mªag”_add_ui_äom_fe
 (
toŞbox_ui_mªag”
, 
uife
, &
”rÜ
))

941 
	`g_w¬nšg
 ("budšg m’u çed: %s", 
”rÜ
->
mes§ge
);

942 
	`g_”rÜ_ä“
 (
”rÜ
);

943 
”rÜ
 = 
NULL
;

945 
	`g_ä“
 (
uife
);

947 
toŞbox_acûls
 = 
	`gtk_ui_mªag”_g‘_acûl_group
 (
toŞbox_ui_mªag”
);

948 
toŞbox_m’ub¬
 = 
	`gtk_ui_mªag”_g‘_widg‘
 (
toŞbox_ui_mªag”
, 
TOOLBOX_MENU
);

951 
di¥Ïy_aùiÚs
 = 
	`ü—‹_Ü_»f_di¥Ïy_aùiÚs
 ();

952 
di¥Ïy_toŞ_aùiÚs
 = 
	`ü—‹_toŞ_aùiÚs
 ();

954 
di¥Ïy_ui_mªag”
 = 
	`gtk_ui_mªag”_Ãw
 ();

955 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
di¥Ïy_ui_mªag”
),

957 
	`G_CALLBACK
 (
_ui_mªag”_cÚÃù_´oxy
),

958 
NULL
);

959 
	`gtk_ui_mªag”_£t_add_‹¬offs
 (
di¥Ïy_ui_mªag”
, 
DIA_SHOW_TEAROFFS
);

960 
	`gtk_ui_mªag”_š£¹_aùiÚ_group
 (
di¥Ïy_ui_mªag”
, 
di¥Ïy_aùiÚs
, 0);

961 
	`gtk_ui_mªag”_š£¹_aùiÚ_group
 (
di¥Ïy_ui_mªag”
, 
di¥Ïy_toŞ_aùiÚs
, 0);

962 ià(!
	`gtk_ui_mªag”_add_ui_äom_¡ršg
 (
di¥Ïy_ui_mªag”
, 
ui_šfo
, -1, &
”rÜ
))

964 
	`g_w¬nšg
 ("but-š m’u çed: %s", 
”rÜ
->
mes§ge
);

965 
	`g_”rÜ_ä“
 (
”rÜ
);

966 
”rÜ
 = 
NULL
;

969 
uife
 = 
	`bud_ui_f’ame
 ("ui/popup-ui.xml");

972 ià(!
	`gtk_ui_mªag”_add_ui_äom_fe
 (
di¥Ïy_ui_mªag”
, 
uife
, &
”rÜ
))

974 
	`g_w¬nšg
 ("budšg m’u çed: %s", 
”rÜ
->
mes§ge
);

975 
	`g_”rÜ_ä“
 (
”rÜ
);

976 
”rÜ
 = 
NULL
;

978 
	`g_ä“
 (
uife
);

980 
di¥Ïy_acûls
 = 
	`gtk_ui_mªag”_g‘_acûl_group
 (
di¥Ïy_ui_mªag”
);

981 
di¥Ïy_m’ub¬
 = 
	`gtk_ui_mªag”_g‘_widg‘
 (
di¥Ïy_ui_mªag”
, 
DISPLAY_MENU
);

982 
	`g_as£¹
 (
di¥Ïy_m’ub¬
);

984 
	`add_¶ugš_aùiÚs
 (
toŞbox_ui_mªag”
, 
TOOLBOX_MENU
);

985 
	`add_¶ugš_aùiÚs
 (
di¥Ïy_ui_mªag”
, 
DISPLAY_MENU
);

986 
	`add_¶ugš_aùiÚs
 (
di¥Ïy_ui_mªag”
, 
INVISIBLE_MENU
);

989 
acûlf’ame
 = 
	`dŸ_cÚfig_f’ame
("menurc");

991 ià(
acûlf’ame
)

993 
	`gtk_acûl_m­_lßd
(
acûlf’ame
);

994 
	`g_ä“
(
acûlf’ame
);

996 
	`gtk_qu™_add
(1, 
§ve_acûls
, 
NULL
);

997 
	}
}

1000 
	$m’us_g‘_š‹g¿‹d_ui_m’ub¬
 (
GtkWidg‘
 **
m’ub¬
,

1001 
GtkWidg‘
 **
toŞb¬
,

1002 
GtkAcûlGroup
 **
acûl_group
)

1004 
GE¼Ü
 *
”rÜ
 = 
NULL
;

1005 
gch¬
 *
uife
;

1007 ià(
š™Ÿli£
)

1008 
	`m’us_š™
();

1011 
š‹g¿‹d_ui_aùiÚs
 = 
	`gtk_aùiÚ_group_Ãw
 ("integrated-ui-actions");

1012 
	`gtk_aùiÚ_group_£t_Œª¦©iÚ_domaš
 (
š‹g¿‹d_ui_aùiÚs
, 
NULL
);

1013 
	`gtk_aùiÚ_group_£t_Œª¦©e_func
 (
š‹g¿‹d_ui_aùiÚs
, 
_dŸ_Œª¦©e
, 
NULL
, NULL);

1014 
	`gtk_aùiÚ_group_add_aùiÚs
 (
š‹g¿‹d_ui_aùiÚs
, 
commÚ_’Œ›s
,

1015 
	`G_N_ELEMENTS
 (
commÚ_’Œ›s
), 
NULL
);

1017 
	`gtk_aùiÚ_group_add_aùiÚs
 (
š‹g¿‹d_ui_aùiÚs
, 
toŞbox_’Œ›s
,

1018 
	`G_N_ELEMENTS
 (
toŞbox_’Œ›s
), 
NULL
);

1019 
	`gtk_aùiÚ_group_add_aùiÚs
 (
š‹g¿‹d_ui_aùiÚs
, 
di¥Ïy_’Œ›s
,

1020 
	`G_N_ELEMENTS
 (
di¥Ïy_’Œ›s
), 
NULL
);

1021 
	`gtk_aùiÚ_group_add_toggË_aùiÚs
 (
š‹g¿‹d_ui_aùiÚs
, 
š‹g¿‹d_ui_v›w_toggË_’Œ›s
,

1022 
	`G_N_ELEMENTS
 (
š‹g¿‹d_ui_v›w_toggË_’Œ›s
), 
NULL
);

1026 
	`gtk_aùiÚ_group_add_toggË_aùiÚs
 (
š‹g¿‹d_ui_aùiÚs
, 
di¥Ïy_toggË_’Œ›s
,

1027 
	`G_N_ELEMENTS
 (
di¥Ïy_toggË_’Œ›s
),

1028 
NULL
);

1029 
	`gtk_aùiÚ_group_add_¿dio_aùiÚs
 (
š‹g¿‹d_ui_aùiÚs
,

1030 
di¥Ïy_£Ëù_¿dio_’Œ›s
,

1031 
	`G_N_ELEMENTS
 (
di¥Ïy_£Ëù_¿dio_’Œ›s
),

1033 
	`G_CALLBACK
 (
£Ëù_¡yË_ÿÎback
),

1034 
NULL
);

1036 
š‹g¿‹d_ui_toŞ_aùiÚs
 = 
	`ü—‹_toŞ_aùiÚs
 ();

1038 
š‹g¿‹d_ui_mªag”
 = 
	`gtk_ui_mªag”_Ãw
 ();

1039 
	`gtk_ui_mªag”_£t_add_‹¬offs
 (
š‹g¿‹d_ui_mªag”
, 
DIA_SHOW_TEAROFFS
);

1040 
	`gtk_ui_mªag”_š£¹_aùiÚ_group
 (
š‹g¿‹d_ui_mªag”
, 
š‹g¿‹d_ui_aùiÚs
, 0);

1041 
	`gtk_ui_mªag”_š£¹_aùiÚ_group
 (
š‹g¿‹d_ui_mªag”
, 
š‹g¿‹d_ui_toŞ_aùiÚs
, 0);

1043 
uife
 = 
	`bud_ui_f’ame
 ("ui/integrated-ui.xml");

1044 ià(!
	`gtk_ui_mªag”_add_ui_äom_fe
 (
š‹g¿‹d_ui_mªag”
, 
uife
, &
”rÜ
))

1046 
	`g_w¬nšg
 ("budšg iÁeg¿‹d u˜m’u çed: %s", 
”rÜ
->
mes§ge
);

1047 
	`g_”rÜ_ä“
 (
”rÜ
);

1048 
”rÜ
 = 
NULL
;

1050 
	`g_ä“
 (
uife
);

1051 ià(!
	`gtk_ui_mªag”_add_ui_äom_¡ršg
 (
š‹g¿‹d_ui_mªag”
, 
ui_šfo
, -1, &
”rÜ
))

1053 
	`g_w¬nšg
 ("but-š m’u çed: %s", 
”rÜ
->
mes§ge
);

1054 
	`g_”rÜ_ä“
 (
”rÜ
);

1055 
”rÜ
 = 
NULL
;

1058 
	`add_¶ugš_aùiÚs
 (
š‹g¿‹d_ui_mªag”
, 
NULL
);

1060 
š‹g¿‹d_ui_acûls
 = 
	`gtk_ui_mªag”_g‘_acûl_group
 (
š‹g¿‹d_ui_mªag”
);

1061 
š‹g¿‹d_ui_m’ub¬
 = 
	`gtk_ui_mªag”_g‘_widg‘
 (
š‹g¿‹d_ui_mªag”
, 
INTEGRATED_MENU
);

1062 
š‹g¿‹d_ui_toŞb¬
 = 
	`ü—‹_š‹g¿‹d_ui_toŞb¬
 ();

1064 ià(
m’ub¬
)

1065 *
m’ub¬
 = 
š‹g¿‹d_ui_m’ub¬
;

1066 ià(
toŞb¬
)

1067 *
toŞb¬
 = 
š‹g¿‹d_ui_toŞb¬
;

1068 ià(
acûl_group
)

1069 *
acûl_group
 = 
š‹g¿‹d_ui_acûls
;

1070 
	}
}

1073 
	$m’us_g‘_toŞbox_m’ub¬
 (
GtkWidg‘
 **
m’ub¬
,

1074 
GtkAcûlGroup
 **
acûl_group
)

1076 ià(
š™Ÿli£
)

1077 
	`m’us_š™
();

1079 ià(
m’ub¬
)

1080 *
m’ub¬
 = 
toŞbox_m’ub¬
;

1081 ià(
acûl_group
)

1082 *
acûl_group
 = 
toŞbox_acûls
;

1083 
	}
}

1085 
GtkWidg‘
 *

1086 
	$m’us_g‘_di¥Ïy_pİup
 ()

1088 ià(
š™Ÿli£
)

1089 
	`m’us_š™
();

1091  
di¥Ïy_m’ub¬
;

1092 
	}
}

1094 
GtkAcûlGroup
 *

1095 
	$m’us_g‘_di¥Ïy_acûls
 ()

1097 ià(
š™Ÿli£
)

1098 
	`m’us_š™
();

1100 ià(
	`is_š‹g¿‹d_ui
 ())

1101  
š‹g¿‹d_ui_acûls
;

1103  
di¥Ïy_acûls
;

1104 
	}
}

1106 
GtkWidg‘
 *

1107 
	$m’us_ü—‹_di¥Ïy_m’ub¬
 (
GtkUIMªag”
 **
ui_mªag”
,

1108 
GtkAùiÚGroup
 **
aùiÚs
)

1110 
GtkAùiÚGroup
 *
toŞ_aùiÚs
;

1111 
GtkWidg‘
 *
m’u_b¬
;

1112 
GE¼Ü
 *
”rÜ
 = 
NULL
;

1113 
gch¬
 *
uife
;

1116 *
aùiÚs
 = 
	`ü—‹_Ü_»f_di¥Ïy_aùiÚs
 ();

1117 
toŞ_aùiÚs
 = 
	`ü—‹_toŞ_aùiÚs
 ();

1119 *
ui_mªag”
 = 
	`gtk_ui_mªag”_Ãw
 ();

1120 
	`gtk_ui_mªag”_£t_add_‹¬offs
 (*
ui_mªag”
, 
DIA_SHOW_TEAROFFS
);

1121 
	`gtk_ui_mªag”_š£¹_aùiÚ_group
 (*
ui_mªag”
, *
aùiÚs
, 0);

1122 
	`gtk_ui_mªag”_š£¹_aùiÚ_group
 (*
ui_mªag”
, 
toŞ_aùiÚs
, 0);

1123 
	`g_objeù_uÄef
 (
	`G_OBJECT
 (
toŞ_aùiÚs
));

1125 
uife
 = 
	`bud_ui_f’ame
 ("ui/display-ui.xml");

1126 ià(!
	`gtk_ui_mªag”_add_ui_äom_fe
 (*
ui_mªag”
, 
uife
, &
”rÜ
))

1128 
	`g_w¬nšg
 ("budšg m’u çed: %s", 
”rÜ
->
mes§ge
);

1129 
	`g_”rÜ_ä“
 (
”rÜ
);

1130 
	`g_ä“
 (
uife
);

1131  
NULL
;

1133 
	`g_ä“
 (
uife
);

1135 
	`add_¶ugš_aùiÚs
 (*
ui_mªag”
, 
DISPLAY_MENU
);

1136 
m’u_b¬
 = 
	`gtk_ui_mªag”_g‘_widg‘
 (*
ui_mªag”
, 
DISPLAY_MENU
);

1137  
m’u_b¬
;

1138 
	}
}

1140 
GtkAcûlGroup
 *

1141 
	$m’us_g‘_acûl_group
 ()

1143  
	`is_š‹g¿‹d_ui
 ()? 
š‹g¿‹d_ui_acûls
 : 
toŞbox_acûls
;

1144 
	}
}

1146 
GtkAùiÚGroup
 *

1147 
	$m’us_g‘_aùiÚ_group
 ()

1149  
	`is_š‹g¿‹d_ui
 ()? 
š‹g¿‹d_ui_aùiÚs
 : 
toŞbox_aùiÚs
;

1150 
	}
}

1152 
GtkAùiÚ
 *

1153 
	$m’us_g‘_aùiÚ
 (cÚ¡ 
gch¬
 *
Çme
)

1155 
GtkAùiÚ
 *
aùiÚ
;

1157 ià(
	`is_š‹g¿‹d_ui
 ())

1159 
aùiÚ
 = 
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
š‹g¿‹d_ui_aùiÚs
, 
Çme
);

1160 ià(
aùiÚ
 =ğ
NULL
)

1162 
aùiÚ
 = 
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
š‹g¿‹d_ui_toŞ_aùiÚs
, 
Çme
);

1167 
aùiÚ
 = 
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
toŞbox_aùiÚs
, 
Çme
);

1168 ià(
aùiÚ
 =ğ
NULL
)

1170 
aùiÚ
 = 
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
di¥Ïy_aùiÚs
, 
Çme
);

1172 ià(
aùiÚ
 =ğ
NULL
)

1174 
aùiÚ
 = 
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
di¥Ïy_toŞ_aùiÚs
, 
Çme
);

1177 ià(!
aùiÚ
)

1179 
GLi¡
 *
groups
, *
li¡
;

1182 
groups
 = 
	`gtk_ui_mªag”_g‘_aùiÚ_groups
 (
di¥Ïy_ui_mªag”
);

1183 
li¡
 = 
groups
;†i¡ !ğ
NULL
;†i¡ =†i¡->
Ãxt
)

1185 
aùiÚ
 = 
	`gtk_aùiÚ_group_g‘_aùiÚ
 (
	`GTK_ACTION_GROUP
 (
li¡
->
d©a
), 
Çme
);

1186 ià(
aùiÚ
)

1191  
aùiÚ
;

1192 
	}
}

1195 
	$m’us_£t_»ûÁ
 (
GtkAùiÚGroup
 *
aùiÚs
)

1197 
GLi¡
 *
li¡
;

1198 
gušt
 
id
;

1199 
GtkUIMªag”
 *
ui_mªag”
;

1200 cÚ¡ *
»ûÁ_·th
;

1202 ià(
	`is_š‹g¿‹d_ui
 ())

1204 
ui_mªag”
 = 
š‹g¿‹d_ui_mªag”
;

1205 
»ûÁ_·th
 = 
INTEGRATED_MENU
 "/File/FileRecentEnd";

1209 
ui_mªag”
 = 
toŞbox_ui_mªag”
;

1210 
»ûÁ_·th
 = 
TOOLBOX_MENU
 "/File/FileRecentEnd";

1213 ià(
»ûÁ_aùiÚs
)

1215 
	`m’us_ş—r_»ûÁ
 ();

1218 
li¡
 = 
	`gtk_aùiÚ_group_li¡_aùiÚs
 (
aùiÚs
);

1219 
	`g_»tuº_if_ç
 (
li¡
);

1221 
»ûÁ_aùiÚs
 = 
aùiÚs
;

1222 
	`g_objeù_»f
 (
	`G_OBJECT
 (
»ûÁ_aùiÚs
));

1223 
	`gtk_ui_mªag”_š£¹_aùiÚ_group
 (
ui_mªag”
,

1224 
»ûÁ_aùiÚs
,

1229 
id
 = 
	`gtk_ui_mªag”_Ãw_m”ge_id
 (
ui_mªag”
);

1230 
»ûÁ_m”ge_ids
 = 
	`g_¦i¡_´•’d
 (»ûÁ_m”ge_ids, (
gpoš‹r
è
id
);

1232 
	`gtk_ui_mªag”_add_ui
 (
ui_mªag”
, 
id
,

1233 
»ûÁ_·th
,

1234 
	`gtk_aùiÚ_g‘_Çme
 (
	`GTK_ACTION
 (
li¡
->
d©a
)),

1235 
	`gtk_aùiÚ_g‘_Çme
 (
	`GTK_ACTION
 (
li¡
->
d©a
)),

1236 
GTK_UI_MANAGER_AUTO
,

1237 
TRUE
);

1240 
NULL
 !ğ(
li¡
 =†i¡->
Ãxt
));

1241 
	}
}

1244 
	$m’us_ş—r_»ûÁ
 ()

1246 
GSLi¡
 *
id
;

1247 
GtkUIMªag”
 *
ui_mªag”
;

1249 ià(
	`is_š‹g¿‹d_ui
 ())

1250 
ui_mªag”
 = 
š‹g¿‹d_ui_mªag”
;

1252 
ui_mªag”
 = 
toŞbox_ui_mªag”
;

1254 ià(
»ûÁ_m”ge_ids
)

1256 
id
 = 
»ûÁ_m”ge_ids
;

1259 
	`gtk_ui_mªag”_»move_ui
 (
ui_mªag”
, (
gušt
è
id
->
d©a
);

1262 
NULL
 !ğ(
id
 = id->
Ãxt
));

1264 
	`g_¦i¡_ä“
 (
»ûÁ_m”ge_ids
);

1265 
»ûÁ_m”ge_ids
 = 
NULL
;

1268 ià(
»ûÁ_aùiÚs
)

1270 
	`gtk_ui_mªag”_»move_aùiÚ_group
 (
ui_mªag”
, 
»ûÁ_aùiÚs
);

1271 
	`g_objeù_uÄef
 (
	`G_OBJECT
 (
»ûÁ_aùiÚs
));

1272 
»ûÁ_aùiÚs
 = 
NULL
;

1274 
	}
}

1277 
	$¶ugš_ÿÎback
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

1279 
DŸC®lbackF‹r
 *
cbf
 = 
d©a
;

1282 ià(
cbf
->
ÿÎback
)

1284 
DDi¥Ïy
 *
ddi¥
 = 
NULL
;

1285 
DŸg¿mD©a
* 
dŸd©a
 = 
NULL
;

1287 ià(
	`¡ºcmp
 (
cbf
->
m’u·th
, 
TOOLBOX_MENU
, 
	`¡¾’
 (TOOLBOX_MENU)) != 0)

1289 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

1290 
dŸd©a
 = 
ddi¥
 ? ddi¥->
dŸg¿m
->
d©a
 : 
NULL
;

1292 
cbf
->
	`ÿÎback
 (
dŸd©a
, 
ddi¥
 ? ddi¥->
dŸg¿m
->
f’ame
 : 
NULL
, 0, cbf->
u£r_d©a
);

1294 
	}
}

	@O:\tool\dvs50\app\menus.h

18 #iâdeà
MENUS_H


19 
	#MENUS_H


	)

21 
	~<gtk/gtk.h
>

23 
	#TOOLBOX_MENU
 "/ToŞboxM’u"

	)

24 
	#DISPLAY_MENU
 "/Di¥ÏyM’u"

	)

25 
	#INTEGRATED_MENU
 "/IÁeg¿‹dUIM’u"

	)

26 
	#INVISIBLE_MENU
 "/InvisibËM’u"

	)

28 
	szoom_·œ
 { cÚ¡ 
gch¬
 *
	m¡ršg
; cÚ¡ 
gšt
 
	mv®ue
; };

30 cÚ¡ 
zoom_·œ
 
zooms
[10];

32 
š‹g¿‹d_ui_toŞb¬_£t_zoom_‹xt
 (
GtkToŞb¬
 *
toŞb¬
, cÚ¡ 
gch¬
 * 
‹xt
);

34 
š‹g¿‹d_ui_toŞb¬_grid_¢­_synchrÚize_to_di¥Ïy
 (
gpoš‹r
 
ddi¥
);

36 
š‹g¿‹d_ui_toŞb¬_objeù_¢­_synchrÚize_to_di¥Ïy
 (
gpoš‹r
 
ddi¥
);

39 
m’us_g‘_š‹g¿‹d_ui_m’ub¬
 (
GtkWidg‘
 **
m’ub¬
, GtkWidg‘ **
toŞb¬
,

40 
GtkAcûlGroup
 **
acûl
);

41 
m’us_g‘_toŞbox_m’ub¬
 (
GtkWidg‘
 **
m’ub¬
, 
GtkAcûlGroup
 **
acûl
);

42 
GtkWidg‘
 * 
m’us_g‘_di¥Ïy_pİup
 ();

43 
GtkAcûlGroup
 * 
m’us_g‘_di¥Ïy_acûls
 ();

44 
GtkWidg‘
 * 
m’us_ü—‹_di¥Ïy_m’ub¬
 (
GtkUIMªag”
 **
ui_mªag”
, 
GtkAùiÚGroup
 **
aùiÚs
);

46 
GtkAcûlGroup
 * 
m’us_g‘_acûl_group
 ();

47 
GtkAùiÚGroup
 * 
m’us_g‘_aùiÚ_group
 ();

49 
GtkAùiÚ
 * 
m’us_g‘_aùiÚ
 (cÚ¡ 
gch¬
 *
Çme
);

50 
m’us_£t_»ûÁ
 (
GtkAùiÚGroup
 *
aùiÚs
);

51 
m’us_ş—r_»ûÁ
 ();

53 
	#VIEW_MAIN_TOOLBAR_ACTION
 "V›wMašToŞb¬"

	)

54 
	#VIEW_MAIN_STATUSBAR_ACTION
 "V›wMašStusb¬"

	)

55 
	#VIEW_LAYERS_ACTION
 "V›wLay”s"

	)

	@O:\tool\dvs50\app\modify_tool.c

18 
	~<cÚfig.h
>

20 
	~<¡dio.h
>

21 
	~<m©h.h
>

23 
	~"modify_toŞ.h
"

24 
	~"hªdË_İs.h
"

25 
	~"objeù_İs.h
"

26 
	~"cÚÃùiÚpošt_İs.h
"

27 
	~"mes§ge.h
"

28 
	~"´İ”t›s-dŸlog.h
"

29 
	~"£Ëù.h
"

30 
	~"´eã»nûs.h
"

31 
	~"cursÜ.h
"

32 
	~"highlight.h
"

33 
	~"‹x‹d™.h
"

34 
	~"‹xše.h
"

36 
	~"·»Á.h
"

37 
	~"dŸÿnvas.h
"

38 
	~"´İ_‹xt.h
"

39 
	~"gtk/gtk.h
"

42 
DŸObjeù
 *
şick_£Ëù_objeù
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
şickedpošt
,

43 
GdkEv’tBu‰Ú
 *
ev’t
);

44 
do_if_şicked_hªdË
(
DDi¥Ïy
 *
ddi¥
, 
ModifyToŞ
 *
toŞ
,

45 
Pošt
 *
şickedpošt
,

46 
GdkEv’tBu‰Ú
 *
ev’t
);

47 
modify_bu‰Ú_´ess
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

48 
DDi¥Ïy
 *
ddi¥
);

49 
modify_bu‰Ú_hŞd
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

50 
DDi¥Ïy
 *
ddi¥
);

51 
modify_bu‰Ú_»Ëa£
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

52 
DDi¥Ïy
 *
ddi¥
);

53 
modify_mÙiÚ
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

54 
DDi¥Ïy
 *
ddi¥
);

55 
modify_doubË_şick
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

56 
DDi¥Ïy
 *
ddi¥
);

57 
modify_make_‹xt_ed™
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
,

58 
Pošt
 *
şickedpošt
);

59 
modify_¡¬t_‹xt_ed™
(
DDi¥Ïy
 *
ddi¥
, 
Text
 *
‹xt
, 
DŸObjeù
 *
obj
,

60 
Pošt
 *
şickedpošt
);

63 
ToŞ
 *

64 
	$ü—‹_modify_toŞ
()

66 
ModifyToŞ
 *
toŞ
;

68 
toŞ
 = 
	`g_Ãw0
(
ModifyToŞ
, 1);

69 
toŞ
->toŞ.
ty³
 = 
MODIFY_TOOL
;

70 
toŞ
->toŞ.
bu‰Ú_´ess_func
 = (
Bu‰ÚP»ssFunc
è&
modify_bu‰Ú_´ess
;

71 
toŞ
->toŞ.
bu‰Ú_hŞd_func
 = (
Bu‰ÚHŞdFunc
è&
modify_bu‰Ú_hŞd
;

72 
toŞ
->toŞ.
bu‰Ú_»Ëa£_func
 = (
Bu‰ÚR–—£Func
è&
modify_bu‰Ú_»Ëa£
;

73 
toŞ
->toŞ.
mÙiÚ_func
 = (
MÙiÚFunc
è&
modify_mÙiÚ
;

74 
toŞ
->toŞ.
doubË_şick_func
 = (
DoubËClickFunc
è&
modify_doubË_şick
;

75 
toŞ
->
gc
 = 
NULL
;

76 
toŞ
->
¡©e
 = 
STATE_NONE
;

77 
toŞ
->
b»ak_cÚÃùiÚs
 = 0;

78 
toŞ
->
auto_süŞËd
 = 
FALSE
;

80 
toŞ
->
Üig_pos
 = 
NULL
;

82  (
ToŞ
 *)
toŞ
;

83 
	}
}

85 
Modif›rKeys


86 
	$gdk_ev’t_to_dŸ_Modif›rKeys
(
gušt
 
ev’t_¡©e
)

88 
Modif›rKeys
 
mod
 = 
MODIFIER_NONE
;

89 ià(
ev’t_¡©e
 & 
GDK_SHIFT_MASK
)

90 
mod
 |ğ
MODIFIER_SHIFT
;

95  
mod
;

96 
	}
}

100 
	$ä“_modify_toŞ
(
ToŞ
 *
toŞ
)

102 
ModifyToŞ
 *
mtoŞ
 = (ModifyToŞ *)
toŞ
;

103 ià(
mtoŞ
->
gc
)

104 
	`gdk_gc_uÄef
(
mtoŞ
->
gc
);

105 
	`g_ä“
(
mtoŞ
);

106 
	}
}

131 
DŸObjeù
 *

132 
	$şick_£Ëù_objeù
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
şickedpošt
,

133 
GdkEv’tBu‰Ú
 *
ev’t
)

135 
DŸg¿m
 *
dŸg¿m
;

136 
»®
 
şick_di¡ªû
;

137 
DŸObjeù
 *
obj
;

139 
dŸg¿m
 = 
ddi¥
->diagram;

143 
şick_di¡ªû
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 3.0);

145 
obj
 = 
	`dŸg¿m_fšd_şicked_objeù
(
dŸg¿m
, 
şickedpošt
,

146 
şick_di¡ªû
);

148 ià(
obj
!=
NULL
) {

150 
GLi¡
 *
®»ady
;

153 
®»ady
 = 
	`g_li¡_fšd
(
dŸg¿m
->
d©a
->
£Ëùed
, 
obj
);

154 ià(
®»ady
 =ğ
NULL
) {

157 ià(!(
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
)) {

159 
	`dŸg¿m_»move_®l_£Ëùed
(
dŸg¿m
, 
TRUE
);

162 
	`dŸg¿m_£Ëù
(
dŸg¿m
, 
obj
);

175 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

176 
	`objeù_add_upd©es_li¡
(
dŸg¿m
->
d©a
->
£Ëùed
, diagram);

177 
	`dŸg¿m_æush
(
dŸg¿m
);

179  
obj
;

186 
	`objeù_add_upd©es_li¡
(
dŸg¿m
->
d©a
->
£Ëùed
, diagram);

187 
	`dŸg¿m_æush
(
dŸg¿m
);

189 ià(
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
) {

191 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

192 
	`dŸg¿m_un£Ëù_objeù
(
dŸg¿m
, (
DŸObjeù
 *)
®»ady
->
d©a
);

193 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

196 #ifdeà
NEW_TEXT_EDIT


197 
	`modify_make_‹xt_ed™
(
ddi¥
, 
obj
, 
şickedpošt
);

199  
obj
;

204  
NULL
;

205 
	}
}

207 
glÚg


208 
	$time_miüo
()

210 
GTimeV®
 
tv
;

212 
	`g_g‘_cu¼’t_time
(&
tv
);

213  
tv
.
tv_£c
*
G_USEC_PER_SEC
+tv.
tv_u£c
;

214 
	}
}

216 
	$do_if_şicked_hªdË
(
DDi¥Ïy
 *
ddi¥
, 
ModifyToŞ
 *
toŞ
,

217 
Pošt
 *
şickedpošt
, 
GdkEv’tBu‰Ú
 *
ev’t
)

219 
DŸObjeù
 *
obj
;

220 
HªdË
 *
hªdË
;

221 
»®
 
di¡
;

223 
hªdË
 = 
NULL
;

224 
di¡
 = 
	`dŸg¿m_fšd_şo£¡_hªdË
(
ddi¥
->
dŸg¿m
, &
hªdË
,

225 &
obj
, 
şickedpošt
);

226 ià(
	`hªdË_is_şicked
(
ddi¥
, 
hªdË
, 
şickedpošt
)) {

227 
toŞ
->
¡©e
 = 
STATE_MOVE_HANDLE
;

228 
toŞ
->
b»ak_cÚÃùiÚs
 = 
TRUE
;

229 
toŞ
->
Ï¡_to
 = 
hªdË
->
pos
;

230 
toŞ
->
hªdË
 = handle;

231 
toŞ
->
objeù
 = 
obj
;

232 
	`gdk_poš‹r_g¿b
 (
ddi¥
->
ÿnvas
->
wšdow
, 
FALSE
,

233 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

234 
NULL
, NULL, 
ev’t
->
time
);

235 
toŞ
->
¡¬t_©
 = 
hªdË
->
pos
;

236 
toŞ
->
¡¬t_time
 = 
	`time_miüo
();

237 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_SCROLL
));

238  
TRUE
;

240  
FALSE
;

241 
	}
}

244 
	$modify_bu‰Ú_´ess
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

245 
DDi¥Ïy
 *
ddi¥
)

247 
Pošt
 
şickedpošt
;

248 
DŸObjeù
 *
şicked_obj
;

249 
gboŞ—n
 
some_£Ëùed
;

251 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
,

252 ()
ev’t
->
x
, (ëv’t->
y
,

253 &
şickedpošt
.
x
, &şickedpošt.
y
);

256 
some_£Ëùed
 = 
	`g_li¡_Ëngth
 (
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
) > 1;

257 ià(!
some_£Ëùed
 && 
	`do_if_şicked_hªdË
(
ddi¥
, 
toŞ
, &
şickedpošt
, 
ev’t
))

260 
şicked_obj
 = 
	`şick_£Ëù_objeù
(
ddi¥
, &
şickedpošt
, 
ev’t
);

261 ià(!
some_£Ëùed
 && 
	`do_if_şicked_hªdË
(
ddi¥
, 
toŞ
, &
şickedpošt
, 
ev’t
))

264 iàĞ
şicked_obj
 !ğ
NULL
 ) {

265 
toŞ
->
¡©e
 = 
STATE_MOVE_OBJECT
;

266 
toŞ
->
objeù
 = 
şicked_obj
;

267 
toŞ
->
move_com³n§‹
 = 
şicked_obj
->
pos™iÚ
;

268 
	`pošt_sub
(&
toŞ
->
move_com³n§‹
, &
şickedpošt
);

269 
toŞ
->
b»ak_cÚÃùiÚs
 = 
TRUE
;

270 
	`gdk_poš‹r_g¿b
 (
ddi¥
->
ÿnvas
->
wšdow
, 
FALSE
,

271 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

272 
NULL
, NULL, 
ev’t
->
time
);

273 
toŞ
->
¡¬t_©
 = 
şickedpošt
;

274 
toŞ
->
¡¬t_time
 = 
	`time_miüo
();

275 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_SCROLL
));

277 
toŞ
->
¡©e
 = 
STATE_BOX_SELECT
;

278 
toŞ
->
¡¬t_box
 = 
şickedpošt
;

279 
toŞ
->
’d_box
 = 
şickedpošt
;

280 
toŞ
->
x1
 =oŞ->
x2
 = (è
ev’t
->
x
;

281 
toŞ
->
y1
 =oŞ->
y2
 = (è
ev’t
->
y
;

283 ià(
toŞ
->
gc
 =ğ
NULL
) {

284 
toŞ
->
gc
 = 
	`gdk_gc_Ãw
(
ddi¥
->
ÿnvas
->
wšdow
);

285 
	`gdk_gc_£t_lše_©Œibu‹s
(
toŞ
->
gc
, 1, 
GDK_LINE_ON_OFF_DASH
,

286 
GDK_CAP_BUTT
, 
GDK_JOIN_MITER
);

287 
	`gdk_gc_£t_fÜeground
(
toŞ
->
gc
, &
cŞÜ_gdk_wh™e
);

288 
	`gdk_gc_£t_funùiÚ
(
toŞ
->
gc
, 
GDK_XOR
);

291 
	`gdk_d¿w_»ùªgË
 (
ddi¥
->
ÿnvas
->
wšdow
, 
toŞ
->
gc
, 
FALSE
,

292 
toŞ
->
x1
,oŞ->
y1
,

293 
toŞ
->
x2
 -oŞ->
x1
,oŞ->
y2
 -oŞ->
y1
);

295 
	`gdk_poš‹r_g¿b
 (
ddi¥
->
ÿnvas
->
wšdow
, 
FALSE
,

296 
GDK_POINTER_MOTION_HINT_MASK
 | 
GDK_BUTTON1_MOTION_MASK
 | 
GDK_BUTTON_RELEASE_MASK
,

297 
NULL
, NULL, 
ev’t
->
time
);

299 
	}
}

303 
	$modify_bu‰Ú_hŞd
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

304 
DDi¥Ïy
 *
ddi¥
)

306 
Pošt
 
şickedpošt
;

308 
toŞ
->
¡©e
) {

309 
STATE_MOVE_OBJECT
:

312 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
,

313 ()
ev’t
->
x
, (ëv’t->
y
,

314 &
şickedpošt
.
x
, &şickedpošt.
y
);

316 ià(
toŞ
->
objeù
 !ğ
NULL
 &&

317 
	`dŸg¿m_is_£Ëùed
(
ddi¥
->
dŸg¿m
, 
toŞ
->
objeù
)) {

318 ià(
	`‹x‹d™_aùiv©e_objeù
(
ddi¥
, 
toŞ
->
objeù
, &
şickedpošt
)) {

320 
	`gdk_poš‹r_ung¿b
 (
ev’t
->
time
);

321 
toŞ
->
Üig_pos
 = 
NULL
;

322 
toŞ
->
¡©e
 = 
STATE_NONE
;

324 
	`gtk_aùiÚ_aùiv©e
 (
	`m’us_g‘_aùiÚ
 ("ToolsTextedit"));

328 
STATE_MOVE_HANDLE
:

330 
STATE_BOX_SELECT
:

332 
STATE_NONE
:

335 
	`mes§ge_”rÜ
("Internalƒrror: Strange state in modify_tool (button_hold)\n");

337 
	}
}

340 
	$modify_doubË_şick
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

341 
DDi¥Ïy
 *
ddi¥
)

343 
Pošt
 
şickedpošt
;

344 
DŸObjeù
 *
şicked_obj
;

346 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
,

347 ()
ev’t
->
x
, (ëv’t->
y
,

348 &
şickedpošt
.
x
, &şickedpošt.
y
);

350 
şicked_obj
 = 
	`şick_£Ëù_objeù
(
ddi¥
, &
şickedpošt
, 
ev’t
);

352 iàĞ
şicked_obj
 !ğ
NULL
 ) {

353 
	`objeù_li¡_´İ”t›s_show
(
ddi¥
->
dŸg¿m
, ddi¥->dŸg¿m->
d©a
->
£Ëùed
);

356 ià(!(
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
)) {

358 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

359 
	`dŸg¿m_»move_®l_£Ëùed
(
ddi¥
->
dŸg¿m
, 
TRUE
);

360 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

363 
	}
}

365 
	#MIN_PIXELS
 10

	)

378 
gboŞ—n


379 
	$modify_move_®»ady
(
ModifyToŞ
 *
toŞ
, 
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
to
)

381 
gboŞ—n
 
£‰šgs_k’
 = 
FALSE
;

382 
doubË_şick_time
 = 250;

383 
»®
 
di¡
;

385 ià(!
£‰šgs_k’
) {

390 
GtkS‘tšgs
 *
£‰šgs
 = 
	`gtk_£‰šgs_g‘_deçuÉ
();

391 ià(
£‰šgs
 =ğ
NULL
) {

392 
	`g_mes§ge
(
	`_
("Couldn't get GTK settings"));

394 
	`g_objeù_g‘
(
	`G_OBJECT
(
£‰šgs
),

395 "gtk-doubË-şick-time", &
doubË_şick_time
, 
NULL
);

397 
£‰šgs_k’
 = 
TRUE
;

399 ià(
toŞ
->
¡¬t_time
 < 
	`time_miüo
()-
doubË_şick_time
*1000) {

400  
TRUE
;

402 
di¡
 = 
	`di¡ªû_pošt_pošt_mªh©n
(&
toŞ
->
¡¬t_©
, 
to
);

403 ià(
ddi¥
->
grid
.
¢­
) {

404 
»®
 
grid_x
 = 
ddi¥
->
dŸg¿m
->
grid
.
width_x
;

405 
»®
 
grid_y
 = 
ddi¥
->
dŸg¿m
->
grid
.
width_y
;

406 ià(
di¡
 > 
grid_x
 || di¡ > 
grid_y
) {

407  
TRUE
;

410 ià(
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
, 
di¡
è> 
MIN_PIXELS
) {

411  (
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
, 
di¡
è> 
MIN_PIXELS
);

413  
FALSE
;

415 
	}
}

418 
CŞÜ
 
	gmašpošt_cŞÜ
 = { 1.0, 0.8, 0.0 };

420 
CŞÜ
 
	gı_cŞÜ
 = { 1.0, 0.0, 0.0 };

423 
	$modify_mÙiÚ
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

424 
DDi¥Ïy
 *
ddi¥
)

426 
Pošt
 
to
;

427 
Pošt
 
now
, 
d–
, 
fuÎ_d–
;

428 
gboŞ—n
 
auto_süŞl
, 
v”tiÿl
 = 
FALSE
;

429 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
 = 
NULL
;

430 
ObjeùChªge
 *
objchªge
;

432 ià(
toŞ
->
¡©e
==
STATE_NONE
)

435 
auto_süŞl
 = 
	`ddi¥Ïy_autosüŞl
(
ddi¥
, 
ev’t
->
x
,ƒv’t->
y
);

437 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
, 
ev’t
->
x
,ƒv’t->
y
, &
to
.x, &to.y);

439 ià(!
	`modify_move_®»ady
(
toŞ
, 
ddi¥
, &
to
)) ;

441 
toŞ
->
¡©e
) {

442 
STATE_MOVE_OBJECT
:

444 ià(
toŞ
->
Üig_pos
 =ğ
NULL
) {

445 
GLi¡
 *
li¡
;

446 
i
;

447 
DŸObjeù
 *
obj
;

450 
li¡
 = 
	`·»Á_li¡_afãùed
(
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
);

451 
toŞ
->
Üig_pos
 = 
	`g_Ãw
(
Pošt
, 
	`g_li¡_Ëngth
(
li¡
));

452 
i
=0;

453 
li¡
 !ğ
NULL
) {

454 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

455 
toŞ
->
Üig_pos
[
i
] = 
obj
->
pos™iÚ
;

456 
li¡
 = 
	`g_li¡_Ãxt
Öi¡); 
i
++;

460 ià(
toŞ
->
b»ak_cÚÃùiÚs
)

461 
	`dŸg¿m_uncÚÃù_£Ëùed
(
ddi¥
->
dŸg¿m
);

463 ià(
ev’t
->
¡©e
 & 
GDK_CONTROL_MASK
) {

464 
fuÎ_d–
 = 
to
;

465 
	`pošt_sub
(&
fuÎ_d–
, &
toŞ
->
¡¬t_©
);

466 
v”tiÿl
 = (
	`çbs
(
fuÎ_d–
.
x
è< fabs(fuÎ_d–.
y
));

469 
	`pošt_add
(&
to
, &
toŞ
->
move_com³n§‹
);

470 
	`¢­_to_grid
(
ddi¥
, &
to
.
x
, &to.
y
);

472 
now
 = 
toŞ
->
objeù
->
pos™iÚ
;

474 
d–
 = 
to
;

475 
	`pošt_sub
(&
d–
, &
now
);

477 ià(
ev’t
->
¡©e
 & 
GDK_CONTROL_MASK
) {

479 ià(
v”tiÿl
) {

480 
d–
.
x
 = 
toŞ
->
¡¬t_©
.x +oŞ->
move_com³n§‹
.x - 
now
.x;

482 
d–
.
y
 = 
toŞ
->
¡¬t_©
.y +oŞ->
move_com³n§‹
.y - 
now
.y;

486 
	`objeù_add_upd©es_li¡
(
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
, ddisp->diagram);

487 
objchªge
 = 
	`objeù_li¡_move_d–
(
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
, &
d–
);

488 ià(
objchªge
 !ğ
NULL
) {

489 
	`undo_objeù_chªge
(
ddi¥
->
dŸg¿m
, 
toŞ
->
objeù
, 
objchªge
);

491 
	`objeù_add_upd©es_li¡
(
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
, ddisp->diagram);

493 
	`objeù_add_upd©es
(
toŞ
->
objeù
, 
ddi¥
->
dŸg¿m
);

497 
gch¬
 *
po¡ext
;

498 
GtkStusb¬
 *
¡©usb¬
 = 
	`GTK_STATUSBAR
 (
ddi¥
->
modif›d_¡©us
);

499 
gušt
 
cÚ‹xt_id
 = 
	`gtk_¡©usb¬_g‘_cÚ‹xt_id
 (
¡©usb¬
, "ObjectPos");

500 
	`gtk_¡©usb¬_pİ
 (
¡©usb¬
, 
cÚ‹xt_id
);

501 
po¡ext
 = 
	`g_¡rdup_´štf
("%.3f, %.3f - %.3f, %.3f",

502 
toŞ
->
objeù
->
boundšg_box
.
Ëá
,

503 
toŞ
->
objeù
->
boundšg_box
.
tİ
,

504 
toŞ
->
objeù
->
boundšg_box
.
right
,

505 
toŞ
->
objeù
->
boundšg_box
.
bÙtom
);

507 
	`gtk_¡©usb¬_pİ
 (
¡©usb¬
, 
cÚ‹xt_id
);

508 
	`gtk_¡©usb¬_push
 (
¡©usb¬
, 
cÚ‹xt_id
, 
po¡ext
);

510 
	`g_ä“
(
po¡ext
);

513 
	`dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
ddi¥
->
dŸg¿m
);

514 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

516 
STATE_MOVE_HANDLE
:

517 
fuÎ_d–
 = 
to
;

518 
	`pošt_sub
(&
fuÎ_d–
, &
toŞ
->
¡¬t_©
);

526 ià(!
	`·»Á_hªdË_move_out_check
(
toŞ
->
objeù
, &
to
))

527 
	`·»Á_hªdË_move_š_check
(
toŞ
->
objeù
, &
to
, &toŞ->
¡¬t_©
);

529 ià(
ev’t
->
¡©e
 & 
GDK_CONTROL_MASK
)

530 
v”tiÿl
 = (
	`çbs
(
fuÎ_d–
.
x
è< fabs(fuÎ_d–.
y
));

532 
	`highlight_»£t_®l
(
ddi¥
->
dŸg¿m
);

533 ià((
toŞ
->
hªdË
->
cÚÃù_ty³
 !ğ
HANDLE_NONCONNECTABLE
)) {

535 
cÚÃùiÚpošt
 =

536 
	`objeù_fšd_cÚÃùpošt_di¥Ïy
(
ddi¥
, &
to
, 
toŞ
->
objeù
, 
TRUE
);

537 ià(
cÚÃùiÚpošt
 !ğ
NULL
) {

538 
CŞÜ
 *
hi_cŞÜ
;

539 
to
 = 
cÚÃùiÚpošt
->
pos
;

540 ià(
cÚÃùiÚpošt
->
æags
 & 
CP_FLAGS_MAIN
) {

541 
hi_cŞÜ
 = &
mašpošt_cŞÜ
;

543 
hi_cŞÜ
 = &
ı_cŞÜ
;

545 
	`highlight_objeù
(
cÚÃùiÚpošt
->
objeù
, 
hi_cŞÜ
, 
ddi¥
->
dŸg¿m
);

546 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_CONNECT
));

549 ià(
cÚÃùiÚpošt
 =ğ
NULL
) {

551 
	`¢­_to_grid
(
ddi¥
, &
to
.
x
, &to.
y
);

552 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_SCROLL
));

555 ià(
toŞ
->
b»ak_cÚÃùiÚs
) {

557 ià(
toŞ
->
hªdË
->
cÚÃùed_to
!=
NULL
) {

558 
Chªge
 *
chªge
 = 
	`undo_uncÚÃù
(
ddi¥
->
dŸg¿m
, 
toŞ
->
objeù
,

559 
toŞ
->
hªdË
);

561 (
chªge
->
­¶y
)(chªge, 
ddi¥
->
dŸg¿m
);

565 ià(
ev’t
->
¡©e
 & 
GDK_CONTROL_MASK
) {

567 ià(
v”tiÿl
) {

568 
to
.
x
 = 
toŞ
->
¡¬t_©
.x;

570 
to
.
y
 = 
toŞ
->
¡¬t_©
.y;

574 ià(
toŞ
->
Üig_pos
 =ğ
NULL
) {

575 
toŞ
->
Üig_pos
 = 
	`g_Ãw
(
Pošt
, 1);

576 *
toŞ
->
Üig_pos
 =oŞ->
hªdË
->
pos
;

581 
gch¬
 *
po¡ext
;

582 
GtkStusb¬
 *
¡©usb¬
 = 
	`GTK_STATUSBAR
 (
ddi¥
->
modif›d_¡©us
);

583 
gušt
 
cÚ‹xt_id
 = 
	`gtk_¡©usb¬_g‘_cÚ‹xt_id
 (
¡©usb¬
, "ObjectPos");

585 ià(
toŞ
->
objeù
) {

586 
»®
 
w
 = 
toŞ
->
objeù
->
boundšg_box
.
right
 -oŞ->objeù->boundšg_box.
Ëá
;

587 
»®
 
h
 = 
toŞ
->
objeù
->
boundšg_box
.
bÙtom
 -oŞ->objeù->boundšg_box.
tİ
;

588 
po¡ext
 = 
	`g_¡rdup_´štf
("%.3f, %.3à(%.3fx%.3f)", 
to
.
x
,o.
y
, 
w
, 
h
);

590 
po¡ext
 = 
	`g_¡rdup_´štf
("%.3f, %.3f", 
to
.
x
,o.
y
);

593 
	`gtk_¡©usb¬_pİ
 (
¡©usb¬
, 
cÚ‹xt_id
);

594 
	`gtk_¡©usb¬_push
 (
¡©usb¬
, 
cÚ‹xt_id
, 
po¡ext
);

596 
	`g_ä“
(
po¡ext
);

599 
	`objeù_add_upd©es
(
toŞ
->
objeù
, 
ddi¥
->
dŸg¿m
);

602 
objchªge
 = 
toŞ
->
objeù
->
İs
->
	`move_hªdË
ÑoŞ->objeù,oŞ->
hªdË
,

603 &
to
, 
cÚÃùiÚpošt
,

604 
HANDLE_MOVE_USER
, 
	`gdk_ev’t_to_dŸ_Modif›rKeys
(
ev’t
->
¡©e
));

605 ià(
objchªge
 !ğ
NULL
) {

606 
	`undo_objeù_chªge
(
ddi¥
->
dŸg¿m
, 
toŞ
->
objeù
, 
objchªge
);

608 
	`objeù_add_upd©es
(
toŞ
->
objeù
, 
ddi¥
->
dŸg¿m
);

610 
	`dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
ddi¥
->
dŸg¿m
);

611 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

613 
STATE_BOX_SELECT
:

615 ià(!
auto_süŞl
 && !
toŞ
->
auto_süŞËd
)

617 
	`gdk_d¿w_»ùªgË
 (
ddi¥
->
ÿnvas
->
wšdow
, 
toŞ
->
gc
, 
FALSE
,

618 
toŞ
->
x1
,oŞ->
y1
,

619 
toŞ
->
x2
 -oŞ->
x1
,oŞ->
y2
 -oŞ->
y1
);

622 
toŞ
->
’d_box
 = 
to
;

624 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
,

625 
	`MIN
(
toŞ
->
¡¬t_box
.
x
,oŞ->
’d_box
.x),

626 
	`MIN
(
toŞ
->
¡¬t_box
.
y
,oŞ->
’d_box
.y),

627 &
toŞ
->
x1
, &toŞ->
y1
);

628 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
,

629 
	`MAX
(
toŞ
->
¡¬t_box
.
x
,oŞ->
’d_box
.x),

630 
	`MAX
(
toŞ
->
¡¬t_box
.
y
,oŞ->
’d_box
.y),

631 &
toŞ
->
x2
, &toŞ->
y2
);

633 
	`gdk_d¿w_»ùªgË
 (
ddi¥
->
ÿnvas
->
wšdow
, 
toŞ
->
gc
, 
FALSE
,

634 
toŞ
->
x1
,oŞ->
y1
,

635 
toŞ
->
x2
 -oŞ->
x1
,oŞ->
y2
 -oŞ->
y1
);

637 
STATE_NONE
:

641 
	`mes§ge_”rÜ
("Internalƒrror: Strange state in modify_tool\n");

644 
toŞ
->
Ï¡_to
 = 
to
;

645 
toŞ
->
auto_süŞËd
 = 
auto_süŞl
;

646 
	}
}

650 
GLi¡
 *

651 
	$fšd_£Ëùed_objeùs
(
DDi¥Ïy
 *
ddi¥
, 
ModifyToŞ
 *
toŞ
)

653 
ReùªgË
 
r
;

654 
r
.
Ëá
 = 
	`MIN
(
toŞ
->
¡¬t_box
.
x
,oŞ->
’d_box
.x);

655 
r
.
right
 = 
	`MAX
(
toŞ
->
¡¬t_box
.
x
,oŞ->
’d_box
.x);

656 
r
.
tİ
 = 
	`MIN
(
toŞ
->
¡¬t_box
.
y
,oŞ->
’d_box
.y);

657 
r
.
bÙtom
 = 
	`MAX
(
toŞ
->
¡¬t_box
.
y
,oŞ->
’d_box
.y);

659 ià(
´efs
.
»v”£_rubb”bªdšg_š‹r£ùs
 &&

660 
toŞ
->
¡¬t_box
.
x
 >oŞ->
’d_box
.x) {

662 
	`Ïy”_fšd_objeùs_š‹r£ùšg_»ùªgË
(
ddi¥
->
dŸg¿m
->
d©a
->
aùive_Ïy”
, &
r
);

665 
	`Ïy”_fšd_objeùs_š_»ùªgË
(
ddi¥
->
dŸg¿m
->
d©a
->
aùive_Ïy”
, &
r
);

667 
	}
}

670 
	$modify_bu‰Ú_»Ëa£
(
ModifyToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

671 
DDi¥Ïy
 *
ddi¥
)

673 
Pošt
 *
de¡_pos
, 
to
;

674 
GLi¡
 *
li¡
;

675 
i
;

676 
DŸObjeù
 *
aùive_obj
 = 
NULL
;

677 
ObjeùChªge
 *
objchªge
;

678 
Focus
 *
aùive_focus
;

680 
toŞ
->
b»ak_cÚÃùiÚs
 = 
FALSE
;

681 
	`ddi¥Ïy_£t_®l_cursÜ
(
deçuÉ_cursÜ
);

685 
GtkStusb¬
 *
¡©usb¬
 = 
	`GTK_STATUSBAR
 (
ddi¥
->
modif›d_¡©us
);

686 
gušt
 
cÚ‹xt_id
 = 
	`gtk_¡©usb¬_g‘_cÚ‹xt_id
 (
¡©usb¬
, "ObjectPos");

687 
	`gtk_¡©usb¬_pİ
 (
¡©usb¬
, 
cÚ‹xt_id
);

689 
toŞ
->
¡©e
) {

690 
STATE_MOVE_OBJECT
:

692 
	`gdk_poš‹r_ung¿b
 (
ev’t
->
time
);

694 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
, 
ev’t
->
x
,ƒv’t->
y
, &
to
.x, &to.y);

695 ià(!
	`modify_move_®»ady
(
toŞ
, 
ddi¥
, &
to
)) {

696 
toŞ
->
Üig_pos
 = 
NULL
;

697 
toŞ
->
¡©e
 = 
STATE_NONE
;

701 
	`dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
ddi¥
->
dŸg¿m
);

703 ià(
toŞ
->
Üig_pos
 !ğ
NULL
) {

705 
li¡
 = 
	`·»Á_li¡_afãùed
(
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
);

706 
de¡_pos
 = 
	`g_Ãw
(
Pošt
, 
	`g_li¡_Ëngth
(
li¡
));

707 
i
=0;

708 
li¡
 !ğ
NULL
) {

709 
DŸObjeù
 *
obj
 = (DŸObjeù *è
li¡
->
d©a
;

710 
de¡_pos
[
i
] = 
obj
->
pos™iÚ
;

711 
li¡
 = 
	`g_li¡_Ãxt
Öi¡); 
i
++;

714 
	`undo_move_objeùs
(
ddi¥
->
dŸg¿m
, 
toŞ
->
Üig_pos
, 
de¡_pos
,

715 
	`·»Á_li¡_afãùed
(
ddi¥
->
dŸg¿m
->
d©a
->
£Ëùed
));

718 
	`ddi¥Ïy_cÚÃù_£Ëùed
(
ddi¥
);

719 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

720 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

721 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

723 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

725 
toŞ
->
Üig_pos
 = 
NULL
;

726 
toŞ
->
¡©e
 = 
STATE_NONE
;

728 
STATE_MOVE_HANDLE
:

729 
	`gdk_poš‹r_ung¿b
 (
ev’t
->
time
);

730 
toŞ
->
¡©e
 = 
STATE_NONE
;

732 ià(
toŞ
->
Üig_pos
 !ğ
NULL
) {

733 
	`undo_move_hªdË
(
ddi¥
->
dŸg¿m
, 
toŞ
->
hªdË
,oŞ->
objeù
,

734 *
toŞ
->
Üig_pos
,oŞ->
Ï¡_to
);

738 
	`objeù_add_upd©es
(
toŞ
->
objeù
, 
ddi¥
->
dŸg¿m
);

739 
objchªge
 = 
toŞ
->
objeù
->
İs
->
	`move_hªdË
ÑoŞ->objeù,oŞ->
hªdË
,

740 &
toŞ
->
Ï¡_to
, 
NULL
,

741 
HANDLE_MOVE_USER_FINAL
,
	`gdk_ev’t_to_dŸ_Modif›rKeys
(
ev’t
->
¡©e
));

742 ià(
objchªge
 !ğ
NULL
) {

743 
	`undo_objeù_chªge
(
ddi¥
->
dŸg¿m
, 
toŞ
->
objeù
, 
objchªge
);

746 
	`objeù_add_upd©es
(
toŞ
->
objeù
, 
ddi¥
->
dŸg¿m
);

749 ià(
toŞ
->
hªdË
->
cÚÃù_ty³
 !ğ
HANDLE_NONCONNECTABLE
) {

750 
	`objeù_cÚÃù_di¥Ïy
(
ddi¥
, 
toŞ
->
objeù
,oŞ->
hªdË
, 
TRUE
);

751 
	`dŸg¿m_upd©e_cÚÃùiÚs_£ËùiÚ
(
ddi¥
->
dŸg¿m
);

754 
	`highlight_»£t_®l
(
ddi¥
->
dŸg¿m
);

755 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

757 
	`dŸg¿m_modif›d
(
ddi¥
->
dŸg¿m
);

758 
	`dŸg¿m_upd©e_ex‹Ás
(
ddi¥
->
dŸg¿m
);

760 
	`undo_£t_Œª§ùiÚpošt
(
ddi¥
->
dŸg¿m
->
undo
);

762 ià(
toŞ
->
Üig_pos
 !ğ
NULL
) {

763 
	`g_ä“
(
toŞ
->
Üig_pos
);

764 
toŞ
->
Üig_pos
 = 
NULL
;

768 
STATE_BOX_SELECT
:

770 
	`gdk_poš‹r_ung¿b
 (
ev’t
->
time
);

772 
aùive_focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

773 
aùive_obj
 = 
aùive_focus
!=
NULL
?
	`focus_g‘_objeù
(active_focus):NULL;

775 ià(!
toŞ
->
auto_süŞËd
) {

776 
	`gdk_d¿w_»ùªgË
 (
ddi¥
->
ÿnvas
->
wšdow
, 
toŞ
->
gc
, 
FALSE
,

777 
toŞ
->
x1
,oŞ->
y1
,

778 
toŞ
->
x2
 -oŞ->
x1
,oŞ->
y2
 -oŞ->
y1
);

782 
GLi¡
 *
li¡
, *
li¡_to_ä“
;

784 
li¡
 = 
li¡_to_ä“
 = 
	`fšd_£Ëùed_objeùs
(
ddi¥
, 
toŞ
);

786 ià(
£ËùiÚ_¡yË
 =ğ
SELECT_REPLACE
 &&

787 !(
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
)) {

789 
	`dŸg¿m_»move_®l_£Ëùed
(
ddi¥
->
dŸg¿m
, 
TRUE
);

792 ià(
£ËùiÚ_¡yË
 =ğ
SELECT_INTERSECTION
) {

793 
GLi¡
 *
š‹r£ùiÚ
 = 
NULL
;

795 
li¡
 !ğ
NULL
) {

796 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

798 ià(
	`dŸg¿m_is_£Ëùed
(
ddi¥
->
dŸg¿m
, 
obj
)) {

799 
š‹r£ùiÚ
 = 
	`g_li¡_­³nd
(š‹r£ùiÚ, 
obj
);

802 
li¡
 = 
	`g_li¡_Ãxt
(list);

804 
li¡
 = 
š‹r£ùiÚ
;

805 
	`dŸg¿m_»move_®l_£Ëùed
(
ddi¥
->
dŸg¿m
, 
TRUE
);

806 
li¡
 !ğ
NULL
) {

807 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

809 
	`dŸg¿m_£Ëù
(
ddi¥
->
dŸg¿m
, 
obj
);

811 
li¡
 = 
	`g_li¡_Ãxt
(list);

813 
	`g_li¡_ä“
(
š‹r£ùiÚ
);

815 
li¡
 !ğ
NULL
) {

816 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

818 ià(
£ËùiÚ_¡yË
 =ğ
SELECT_REMOVE
) {

819 ià(
	`dŸg¿m_is_£Ëùed
(
ddi¥
->
dŸg¿m
, 
obj
))

820 
	`dŸg¿m_un£Ëù_objeù
(
ddi¥
->
dŸg¿m
, 
obj
);

821 } ià(
£ËùiÚ_¡yË
 =ğ
SELECT_INVERT
) {

822 ià(
	`dŸg¿m_is_£Ëùed
(
ddi¥
->
dŸg¿m
, 
obj
))

823 
	`dŸg¿m_un£Ëù_objeù
(
ddi¥
->
dŸg¿m
, 
obj
);

825 
	`dŸg¿m_£Ëù
(
ddi¥
->
dŸg¿m
, 
obj
);

827 ià(!
	`dŸg¿m_is_£Ëùed
(
ddi¥
->
dŸg¿m
, 
obj
))

828 
	`dŸg¿m_£Ëù
(
ddi¥
->
dŸg¿m
, 
obj
);

831 
li¡
 = 
	`g_li¡_Ãxt
(list);

835 
	`g_li¡_ä“
(
li¡_to_ä“
);

848 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

849 
	`ddi¥Ïy_æush
(
ddi¥
);

851 
toŞ
->
¡©e
 = 
STATE_NONE
;

853 
STATE_NONE
:

856 
	`mes§ge_”rÜ
("Internalƒrror: Strange state in modify_tool\n");

859 
	}
}

861 
	#EDIT_BORDER_WIDTH
 5

	)

863 
gboŞ—n


864 
	$modify_ed™_’d
(
GtkWidg‘
 *
widg‘
, 
GdkEv’tFocus
 *
ev’t
, 
gpoš‹r
 
d©a
)

866 
GtkTextV›w
 *
v›w
 = 
	`GTK_TEXT_VIEW
(
widg‘
);

867 
DŸObjeù
 *
obj
 = (DŸObjeù*)
d©a
;

868 
GQu¬k
 
qu¬k
 = 
	`g_qu¬k_äom_¡ršg
(
PROP_TYPE_TEXT
);

869 cÚ¡ 
PrİDesütiÚ
 *
´İs
 = 
obj
->
İs
->
	`desüibe_´İs
(obj);

870 
i
;

872 
	`´štf
("Ending focus\n");

874 
i
 = 0; 
´İs
[i].
Çme
 !ğ
NULL
; i++) {

875 
	`´štf
("Te¡šgØ»move: %s\n", 
´İs
[
i
].
Çme
);

876 ià(
´İs
[
i
].
ty³_qu¬k
 =ğ
qu¬k
) {

877 
GPŒA¼ay
 *
‹xrİs
 = 
	`g_±r_¬¿y_sized_Ãw
(1);

878 
TextPrİ”ty
 *
‹xrİ
;

879 
Prİ”ty
 *
´İ
 = 
´İs
[
i
].
İs
->
	`Ãw_´İ
(&´İs[i], 
pdp_Œue
);

880 
GtkTextBufãr
 *
buf
;

881 
GtkTextI‹r
 
¡¬t
, 
’d
;

883 
	`´štf
("GošgØ¡İ %d\n", 
i
);

884 
buf
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
v›w
);

885 
	`g_±r_¬¿y_add
(
‹xrİs
, 
´İ
);

886 
obj
->
İs
->
	`g‘_´İs
(obj, 
‹xrİs
);

887 
‹xrİ
 = (
TextPrİ”ty
*)
´İ
;

888 ià(
‹xrİ
->
‹xt_d©a
 !ğ
NULL
è
	`g_ä“
(textprop->text_data);

889 
	`gtk_‹xt_bufãr_g‘_bounds
(
buf
, &
¡¬t
, &
’d
);

890 
‹xrİ
->
‹xt_d©a
 = 
	`gtk_‹xt_bufãr_g‘_‹xt
(
buf
, &
¡¬t
, &
’d
, 
TRUE
);

891 
	`´štf
("S‘tšgexˆ%s\n", 
‹xrİ
->
‹xt_d©a
);

892 
obj
->
İs
->
	`£t_´İs
(obj, 
‹xrİs
);

893 
	`gtk_widg‘_de¡roy
(
widg‘
);

896  
FALSE
;

897 
	}
}

900 
	$modify_¡¬t_‹xt_ed™
(
DDi¥Ïy
 *
ddi¥
, 
Text
 *
‹xt
, 
DŸObjeù
 *
obj
, 
Pošt
 *
şickedpošt
)

902 
GtkWidg‘
 *
v›w
 = 
	`gtk_‹xt_v›w_Ãw
();

903 
x
, 
y
, 
i
;

904 
GtkTextBufãr
 *
buf
;

905 
GtkTextTag
 *
fÚ‰ag
;

906 
GtkTextI‹r
 
¡¬t
, 
’d
;

907 
ReùªgË
 
‹xt_bbox
;

909 
	`´štf
("modify_start_text_edit\n");

911 
	`‹xt_ÿlc_boundšgbox
(
‹xt
, &
‹xt_bbox
);

912 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
,

913 
‹xt_bbox
.
Ëá
,

914 
‹xt_bbox
.
tİ
,

915 &
x
, &
y
);

916 
	`dŸ_ÿnvas_put
(
	`DIA_CANVAS
(
ddi¥
->
ÿnvas
), 
v›w
,

917 
x
-
EDIT_BORDER_WIDTH
, 
y
-EDIT_BORDER_WIDTH);

918 
buf
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
	`GTK_TEXT_VIEW
(
v›w
));

919 
i
 = 0; i < 
‹xt
->
numlšes
; i++) {

920 
	`gtk_‹xt_bufãr_š£¹_©_cursÜ
(
buf
, 
	`‹xt_g‘_lše
(
‹xt
, 
i
), -1);

922 
fÚ‰ag
 =

923 
	`gtk_‹xt_bufãr_ü—‹_g
(
buf
,

924 
NULL
,

926 
	`dŸ_fÚt_g‘_desütiÚ
(
‹xt
->
fÚt
),

927 
NULL
);

928 
	`gtk_‹xt_bufãr_g‘_bounds
(
buf
, &
¡¬t
, &
’d
);

929 
	`gtk_‹xt_bufãr_­¶y_g
(
buf
, 
fÚ‰ag
, &
¡¬t
, &
’d
);

931 
	`´štf
("Above†ines %d below %d\n",

932 
	`gtk_‹xt_v›w_g‘_pix–s_above_lšes
(
	`GTK_TEXT_VIEW
(
v›w
)),

933 
	`gtk_‹xt_v›w_g‘_pix–s_b–ow_lšes
(
	`GTK_TEXT_VIEW
(
v›w
)));

935 
	`gtk_‹xt_v›w_£t_bÜd”_wšdow_size
(
	`GTK_TEXT_VIEW
(
v›w
),

936 
GTK_TEXT_WINDOW_LEFT
,

937 
EDIT_BORDER_WIDTH
);

938 
	`gtk_‹xt_v›w_£t_bÜd”_wšdow_size
(
	`GTK_TEXT_VIEW
(
v›w
),

939 
GTK_TEXT_WINDOW_RIGHT
,

940 
EDIT_BORDER_WIDTH
);

941 
	`gtk_‹xt_v›w_£t_bÜd”_wšdow_size
(
	`GTK_TEXT_VIEW
(
v›w
),

942 
GTK_TEXT_WINDOW_TOP
,

943 
EDIT_BORDER_WIDTH
);

944 
	`gtk_‹xt_v›w_£t_bÜd”_wšdow_size
(
	`GTK_TEXT_VIEW
(
v›w
),

945 
GTK_TEXT_WINDOW_BOTTOM
,

946 
EDIT_BORDER_WIDTH
);

949 #ifdeà
NEW_TEXT_EDIT


950 
	`gtk_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
v›w
), "focus-out-event",

951 
modify_ed™_’d
, 
obj
);

953 
	`gtk_widg‘_g¿b_focus
(
v›w
);

954 
	`gtk_widg‘_show
(
v›w
);

955 
	}
}

958 
	$modify_make_‹xt_ed™
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
, 
Pošt
 *
şickedpošt
)

960 cÚ¡ 
PrİDesütiÚ
 *
´İs
 = 
obj
->
İs
->
	`desüibe_´İs
(obj);

961 
i
;

962 
i
 = 0; 
´İs
[i].
Çme
 !ğ
NULL
; i++) {

963 
GQu¬k
 
ty³
 = 
	`g_qu¬k_äom_¡ršg
(
PROP_TYPE_TEXT
);

964 
	`´štf
("Te¡šg %s\n", 
´İs
[
i
].
ty³
);

965 ià(
´İs
[
i
].
ty³_qu¬k
 =ğ
ty³
) {

966 
GtkWidg‘
 *
v›w
 = 
	`gtk_‹xt_v›w_Ãw
();

967 
GPŒA¼ay
 *
‹xrİs
 = 
	`g_±r_¬¿y_sized_Ãw
(1);

968 
TextPrİ”ty
 *
‹xrİ
;

969 
Prİ”ty
 *
´İ
 = 
´İs
[
i
].
İs
->
	`Ãw_´İ
(&´İs[i], 
pdp_Œue
);

970 
x
, 
y
;

971 
GtkTextBufãr
 *
buf
;

972 
GtkTextTag
 *
fÚ‰ag
;

973 
GtkTextI‹r
 
¡¬t
, 
’d
;

974 
»®
 
asûÁ
;

975 
asûÁ_pix–s
;

976 
TextLše
 *
‹mp_lše
;

978 
	`g_±r_¬¿y_add
(
‹xrİs
, 
´İ
);

980 
	`´štf
("Foundexˆ´İ %d\n", 
i
);

981 
obj
->
İs
->
	`g‘_´İs
(obj, 
‹xrİs
);

982 
‹xrİ
 = (
TextPrİ”ty
*)
´İ
;

983 
	`ddi¥Ïy_ŒªsfÜm_coÜds
(
ddi¥
,

984 
‹xrİ
->
©Œ
.
pos™iÚ
.
x
,

985 
‹xrİ
->
©Œ
.
pos™iÚ
.
y
,

986 &
x
, &
y
);

987 
‹mp_lše
 = 
	`‹xt_lše_Ãw
(
‹xrİ
->
‹xt_d©a
,

988 
‹xrİ
->
©Œ
.
fÚt
,

989 
‹xrİ
->
©Œ
.
height
);

991 
asûÁ
 = 
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
,

992 
	`‹xt_lše_g‘_asûÁ
(
‹mp_lše
));

993 
	`‹xt_lše_de¡roy
(
‹mp_lše
);

994 
	`´štf
("Text…rop string %s…os %d, %d‡scent %f\n",

995 
‹xrİ
->
‹xt_d©a
, 
x
, 
y
, 
asûÁ
);

996 
asûÁ_pix–s
 = 
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
, 
asûÁ
);

997 
y
 -ğ
asûÁ_pix–s
;

998 
	`dŸ_ÿnvas_put
(
	`DIA_CANVAS
(
ddi¥
->
ÿnvas
), 
v›w
,

999 
x
-
EDIT_BORDER_WIDTH
, 
y
-EDIT_BORDER_WIDTH);

1000 
buf
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
	`GTK_TEXT_VIEW
(
v›w
));

1001 
	`gtk_‹xt_bufãr_š£¹_©_cursÜ
(
buf
, 
‹xrİ
->
‹xt_d©a
, -1);

1002 
fÚ‰ag
 =

1003 
	`gtk_‹xt_bufãr_ü—‹_g
(
buf
,

1004 
NULL
,

1006 
	`dŸ_fÚt_g‘_desütiÚ
(
‹xrİ
->
©Œ
.
fÚt
),

1007 
NULL
);

1008 
	`gtk_‹xt_bufãr_g‘_bounds
(
buf
, &
¡¬t
, &
’d
);

1009 
	`gtk_‹xt_bufãr_­¶y_g
(
buf
, 
fÚ‰ag
, &
¡¬t
, &
’d
);

1011 
	`´štf
("Above†ines %d below %d\n",

1012 
	`gtk_‹xt_v›w_g‘_pix–s_above_lšes
(
	`GTK_TEXT_VIEW
(
v›w
)),

1013 
	`gtk_‹xt_v›w_g‘_pix–s_b–ow_lšes
(
	`GTK_TEXT_VIEW
(
v›w
)));

1015 
	`gtk_‹xt_v›w_£t_bÜd”_wšdow_size
(
	`GTK_TEXT_VIEW
(
v›w
),

1016 
GTK_TEXT_WINDOW_LEFT
,

1017 
EDIT_BORDER_WIDTH
);

1018 
	`gtk_‹xt_v›w_£t_bÜd”_wšdow_size
(
	`GTK_TEXT_VIEW
(
v›w
),

1019 
GTK_TEXT_WINDOW_RIGHT
,

1020 
EDIT_BORDER_WIDTH
);

1021 
	`gtk_‹xt_v›w_£t_bÜd”_wšdow_size
(
	`GTK_TEXT_VIEW
(
v›w
),

1022 
GTK_TEXT_WINDOW_TOP
,

1023 
EDIT_BORDER_WIDTH
);

1024 
	`gtk_‹xt_v›w_£t_bÜd”_wšdow_size
(
	`GTK_TEXT_VIEW
(
v›w
),

1025 
GTK_TEXT_WINDOW_BOTTOM
,

1026 
EDIT_BORDER_WIDTH
);

1029 #ifdeà
NEW_TEXT_EDIT


1030 
	`gtk_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
v›w
), "focus-out-event",

1031 
modify_ed™_’d
, 
obj
);

1033 
	`gtk_widg‘_g¿b_focus
(
v›w
);

1034 
	`gtk_widg‘_show
(
v›w
);

1037 
	}
}

	@O:\tool\dvs50\app\modify_tool.h

18 #iâdeà
MODIFY_TOOL_H


19 
	#MODIFY_TOOL_H


	)

21 
	~"geom‘ry.h
"

22 
	~"toŞ.h
"

23 
	~"time.h
"

25 
_ModifyToŞ
 
	tModifyToŞ
;

27 
	eModifyToŞS‹
 {

28 
	mSTATE_NONE
,

29 
	mSTATE_MOVE_OBJECT
,

30 
	mSTATE_MOVE_HANDLE
,

31 
	mSTATE_BOX_SELECT


34 
	s_ModifyToŞ
 {

35 
ToŞ
 
	mtoŞ
;

37 
ModifyToŞS‹
 
	m¡©e
;

38 
	mb»ak_cÚÃùiÚs
;

39 
Pošt
 
	mmove_com³n§‹
;

40 
DŸObjeù
 *
	mobjeù
;

41 
HªdË
 *
	mhªdË
;

42 
Pošt
 
	mÏ¡_to
;

43 
Pošt
 
	m¡¬t_©
;

44 
time_t
 
	m¡¬t_time
;

46 
GdkGC
 *
	mgc
;

48 
	mx1
, 
	my1
, 
	mx2
, 
	my2
;

49 
Pošt
 
	m¡¬t_box
;

50 
Pošt
 
	m’d_box
;

52 
gboŞ—n
 
	mauto_süŞËd
;

55 
Pošt
 *
	mÜig_pos
;

58 
ToŞ
 *
ü—‹_modify_toŞ
();

59 
ä“_modify_toŞ
(
ToŞ
 *
toŞ
);

	@O:\tool\dvs50\app\navigation.c

25 
	~<gtk/gtk.h
>

27 
	~"dŸg¿m.h
"

28 
	~"di¥Ïy.h
"

29 
	~"dŸgdk»nd””.h
"

31 
	~"Çvig©iÚ.h
"

34 
	#THUMBNAIL_MAX_SIZE
 150

	)

37 
	s_Navig©iÚWšdow


39 
GtkWidg‘
 * 
	mpİup_wšdow
;

42 
	mwidth
;

43 
	mheight
;

44 
	mmax_size
;

46 
gboŞ—n
 
	mis_fœ¡_expo£
;

49 
	mäame_w
;

50 
	mäame_h
;

51 
GdkGC
 * 
	mgc
;

52 
GdkCursÜ
 * 
	mcursÜ
;

55 
gdoubË
 
	mhadj_cÛf
;

56 
gdoubË
 
	mvadj_cÛf
;

59 
GdkPixm­
 * 
	mbufãr
;

62 
DDi¥Ïy
 * 
	mddi¥
;

65 
_Navig©iÚWšdow
 
	tNavig©iÚWšdow
;

67 
Navig©iÚWšdow
 
	g_Çv
;

68 
Navig©iÚWšdow
 * 
	gÇv
 = &
_Çv
;

71 
	#DIAGRAM_OFFSET
 1

	)

72 
	#FRAME_THICKNESS
 2

	)

73 
	#STD_CURSOR_MIN
 16

	)

76 
Ú_bu‰Ú_Çvig©iÚ_pİup_´es£d
 (
GtkBu‰Ú
 * 
bu‰Ú
, 
gpoš‹r
 
_ddi¥
);

77 
Ú_bu‰Ú_Çvig©iÚ_pİup_»Ëa£d
 (
GtkBu‰Ú
 * 
bu‰Ú
, 
gpoš‹r
 
unu£d
);

79 
»£t_sc_adj
 (
GtkAdju¡m’t
 * 
adj
, 
gdoubË
 
low”
, gdoubË 
uµ”
, gdoubË 
·ge
);

81 
gboŞ—n
 
Ú_da_expo£_ev’t
 (
GtkWidg‘
 * 
widg‘
, 
GdkEv’tExpo£
 * 
ev’t
, 
gpoš‹r
 
unu£d
);

82 
gboŞ—n
 
Ú_da_mÙiÚ_nÙify_ev’t
 (
GtkWidg‘
 * 
widg‘
, 
GdkEv’tMÙiÚ
 * 
ev’t
, 
gpoš‹r
 
unu£d
);

83 
gboŞ—n
 
Ú_da_bu‰Ú_»Ëa£_ev’t
 (
GtkWidg‘
 * 
widg‘
, 
GdkEv’tBu‰Ú
 * 
ev’t
, 
gpoš‹r
 
pİup_wšdow
);

86 * 
	gÇv_xpm
[] = {

102 
GtkWidg‘
 *

103 
	$Çvig©iÚ_pİup_Ãw
 (
DDi¥Ïy
 *
ddi¥
)

105 
GtkWidg‘
 * 
bu‰Ú
;

107 
GtkWidg‘
 * 
image
;

108 
GdkPixm­
 * 
pixm­
;

109 
GdkB™m­
 * 
mask
 = 
NULL
;

111 
bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw
 ();

112 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
bu‰Ú
), 0);

113 
	`gtk_bu‰Ú_£t_»l›f
 (
	`GTK_BUTTON
(
bu‰Ú
), 
GTK_RELIEF_NONE
);

114 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
bu‰Ú
), "pressed",

115 
	`G_CALLBACK
 (
Ú_bu‰Ú_Çvig©iÚ_pİup_´es£d
), 
ddi¥
);

117 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
bu‰Ú
), "released",

118 
	`G_CALLBACK
 (
Ú_bu‰Ú_Çvig©iÚ_pİup_»Ëa£d
), 
NULL
);

120 
pixm­
 = 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

121 
	`gtk_widg‘_g‘_cŞÜm­
(
bu‰Ú
),

122 &
mask
,

123 &(
bu‰Ú
->
¡yË
->
bg
[
GTK_STATE_NORMAL
]),

124 
Çv_xpm
);

126 
image
 = 
	`gtk_image_Ãw_äom_pixm­
 (
pixm­
, 
mask
);

127 
	`g_objeù_uÄef
(
pixm­
);

128 
	`g_objeù_uÄef
(
mask
);

130 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
bu‰Ú
), 
image
);

131 
	`gtk_widg‘_show
(
image
);

134  
bu‰Ú
;

135 
	}
}

139 
	$Ú_bu‰Ú_Çvig©iÚ_pİup_´es£d
 (
GtkBu‰Ú
 * 
bu‰Ú
, 
gpoš‹r
 
_ddi¥
)

141 
GtkWidg‘
 * 
pİup_wšdow
;

142 
GtkWidg‘
 * 
äame
;

144 
GtkWidg‘
 * 
d¿wšg_¬—
;

146 
DŸg¿mD©a
 * 
d©a
;

148 
ReùªgË
 
»ù
;

149 
»®
 
zoom
;

152 
	`mem£t
 (
Çv
, 0, (
Navig©iÚWšdow
));

154 
Çv
->
ddi¥
 = (
DDi¥Ïy
 *è
_ddi¥
;

155 
d©a
 = 
Çv
->
ddi¥
->
dŸg¿m
->data;

159 
ÿnvas_width
, 
ÿnvas_height
;

160 
dŸg¿m_width
, 
dŸg¿m_height
;

161 
GtkAdju¡m’t
 * 
adj
;

163 
Çv
->
max_size
 = 
THUMBNAIL_MAX_SIZE
;

166 
»ù
.
tİ
 = 
d©a
->
ex‹Ás
.tİ - 
DIAGRAM_OFFSET
;

167 
»ù
.
Ëá
 = 
d©a
->
ex‹Ás
.Ëá - 
DIAGRAM_OFFSET
;

168 
»ù
.
bÙtom
 = 
d©a
->
ex‹Ás
.bÙtom + 
DIAGRAM_OFFSET
 + 1;

169 
»ù
.
right
 = 
d©a
->
ex‹Ás
.righˆ+ 
DIAGRAM_OFFSET
 + 1;

171 
zoom
 = 
Çv
->
max_size
 / 
	`MAX
Ğ(
»ù
.
right
 -„eù.
Ëá
è, (»ù.
bÙtom
 -„eù.
tİ
) );

173 
Çv
->
width
 = 
	`MIN
ĞÇv->
max_size
, (
»ù
.
right
 -„eù.
Ëá
è* 
zoom
);

174 
Çv
->
height
 = 
	`MIN
ĞÇv->
max_size
, (
»ù
.
bÙtom
 -„eù.
tİ
è* 
zoom
);

177 
dŸg¿m_width
 = (è
	`ddi¥Ïy_ŒªsfÜm_Ëngth
 (
Çv
->
ddi¥
, (
»ù
.
right
 -„eù.
Ëá
));

178 
dŸg¿m_height
 = (è
	`ddi¥Ïy_ŒªsfÜm_Ëngth
 (
Çv
->
ddi¥
, (
»ù
.
bÙtom
 -„eù.
tİ
));

180 ià(
dŸg¿m_width
 * 
dŸg¿m_height
 == 0)

183 
ÿnvas_width
 = 
Çv
->
ddi¥
->
ÿnvas
->
®loÿtiÚ
.
width
;

184 
ÿnvas_height
 = 
Çv
->
ddi¥
->
ÿnvas
->
®loÿtiÚ
.
height
;

186 
Çv
->
äame_w
 =‚av->
width
 * 
ÿnvas_width
 / 
dŸg¿m_width
;

187 
Çv
->
äame_h
 =‚av->
height
 * 
ÿnvas_height
 / 
dŸg¿m_height
;

192 
adj
 = 
Çv
->
ddi¥
->
hsbd©a
;

193 
	`»£t_sc_adj
 (
adj
, 
»ù
.
Ëá
,„eù.
right
, 
ÿnvas_width
 / 
Çv
->
ddi¥
->
zoom_çùÜ
);

194 
Çv
->
hadj_cÛf
 = (
adj
->
uµ”
 -‡dj->
·ge_size
 -‡dj->
low”
è/ (Çv->
width
 -‚av->
äame_w
);

196 
adj
 = 
Çv
->
ddi¥
->
vsbd©a
;

197 
	`»£t_sc_adj
 (
adj
, 
»ù
.
tİ
,„eù.
bÙtom
, 
ÿnvas_height
 / 
Çv
->
ddi¥
->
zoom_çùÜ
);

198 
Çv
->
vadj_cÛf
 = (
adj
->
uµ”
 -‡dj->
·ge_size
 -‡dj->
low”
è/ (Çv->
height
 -‚av->
äame_h
);

203 
pİup_wšdow
 = 
	`gtk_wšdow_Ãw
 (
GTK_WINDOW_POPUP
);

204 
Çv
->
pİup_wšdow
 =…opup_window;

205 
	`gtk_wšdow_£t_pos™iÚ
 (
	`GTK_WINDOW
 (
pİup_wšdow
), 
GTK_WIN_POS_MOUSE
);

207 
äame
 = 
	`gtk_äame_Ãw
 (
NULL
);

208 
	`gtk_äame_£t_shadow_ty³
 (
	`GTK_FRAME
 (
äame
), 
GTK_SHADOW_ETCHED_OUT
);

211 
d¿wšg_¬—
 = 
	`gtk_d¿wšg_¬—_Ãw
 ();

212 
	`gtk_widg‘_£t_size_»que¡
 (
d¿wšg_¬—
, 
Çv
->
width
,‚av->
height
);

214 
	`gtk_widg‘_£t_ev’ts
 (
d¿wšg_¬—
, 0

215 | 
GDK_EXPOSURE_MASK


216 | 
GDK_POINTER_MOTION_MASK


217 | 
GDK_BUTTON_RELEASE_MASK


220 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
d¿wšg_¬—
), "expose_event",

221 
	`G_CALLBACK
 (
Ú_da_expo£_ev’t
), 
NULL
);

222 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
d¿wšg_¬—
), "motion_notify_event",

223 
	`G_CALLBACK
 (
Ú_da_mÙiÚ_nÙify_ev’t
), 
NULL
);

224 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
d¿wšg_¬—
), "button_release_event",

225 
	`G_CALLBACK
 (
Ú_da_bu‰Ú_»Ëa£_ev’t
), 
NULL
);

228 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
äame
), 
d¿wšg_¬—
);

229 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
pİup_wšdow
), 
äame
);

230 
	`gtk_widg‘_show
 (
d¿wšg_¬—
);

231 
	`gtk_widg‘_show
 (
äame
);

232 
	`gtk_widg‘_show
 (
pİup_wšdow
);

235 
Çv
->
gc
 = 
	`gdk_gc_Ãw
 (
d¿wšg_¬—
->
wšdow
);

236 
	`gdk_gc_£t_lše_©Œibu‹s
 (
Çv
->
gc
,

237 
FRAME_THICKNESS
,

238 
GDK_LINE_SOLID
, 
GDK_CAP_BUTT
, 
GDK_JOIN_MITER
);

241 if(
	`MIN
(
Çv
->
äame_h
,‚av->
äame_w
è> 
STD_CURSOR_MIN
){

242 
Çv
->
cursÜ
 = 
	`gdk_cursÜ_Ãw
 (
GDK_FLEUR
);

245 
cursÜ_nÚe_d©a
[] = { 0x00 };

246 
GdkB™m­
 * 
b™m­
;

247 
GdkCŞÜ
 
fg
 = { 0, 65535, 65535, 65535};

248 
GdkCŞÜ
 
bg
 = { 0, 0, 0, 0 };

250 
b™m­
 = 
	`gdk_b™m­_ü—‹_äom_d©a
(
NULL
, 
cursÜ_nÚe_d©a
, 1, 1);

251 
Çv
->
cursÜ
 = 
	`gdk_cursÜ_Ãw_äom_pixm­
(
b™m­
, b™m­, &
fg
, &
bg
, 1, 1);

252 
	`g_objeù_uÄef
(
b™m­
);

256 
	`gdk_poš‹r_g¿b
 (
d¿wšg_¬—
->
wšdow
, 
TRUE
,

257 
GDK_BUTTON_RELEASE_MASK
 | 
GDK_BUTTON_MOTION_MASK
,

258 
d¿wšg_¬—
->
wšdow
,

259 
Çv
->
cursÜ
,

260 
GDK_CURRENT_TIME
);

263 
Çv
->
bufãr
 = 
	`gdk_pixm­_Ãw
 (
d¿wšg_¬—
->
wšdow
,

264 
Çv
->
width
,‚av->
height
, -1);

265 
	`gdk_d¿w_»ùªgË
 (
Çv
->
bufãr
,

266 
d¿wšg_¬—
->
¡yË
->
bÏck_gc
, 
TRUE
,

267 0, 0, 
Çv
->
width
,‚av->
height
);

270 
DŸGdkR’d””
 *
»nd””
;

271 
GdkCŞÜ
 
cŞÜ
;

273 
»nd””
 = 
	`g_objeù_Ãw
 (
DIA_TYPE_GDK_RENDERER
, 
NULL
);

274 
»nd””
->
ŒªsfÜm
 = 
	`dŸ_ŒªsfÜm_Ãw
 (&
»ù
, &
zoom
);

275 
»nd””
->
pixm­
 = 
Çv
->
bufãr
;

276 
»nd””
->
gc
 = 
	`gdk_gc_Ãw
 (
Çv
->
bufãr
);

279 
	`cŞÜ_cÚv”t
 (&
d©a
->
bg_cŞÜ
, &
cŞÜ
);

280 
	`gdk_gc_£t_fÜeground
 (
»nd””
->
gc
, &
cŞÜ
);

281 
	`gdk_d¿w_»ùªgË
 (
»nd””
->
pixm­
,„’d””->
gc
, 1, 0, 0, 
Çv
->
width
,‚av->
height
);

284 
	`d©a_»nd”
 (
d©a
, 
	`DIA_RENDERER
 (
»nd””
), 
NULL
, NULL, NULL);

286 
	`g_objeù_»f
 (
»nd””
->
pixm­
);

287 
	`g_objeù_uÄef
 (
»nd””
);

290 
Çv
->
is_fœ¡_expo£
 = 
TRUE
;

291 
	}
}

296 
	$»£t_sc_adj
 (
GtkAdju¡m’t
 * 
adj
, 
gdoubË
 
low”
, gdoubË 
uµ”
, gdoubË 
·ge
)

298 
adj
->
·ge_size
 = 
·ge
;

300 
adj
->
low”
 =†ower;

301 
adj
->
uµ”
 = upper;

303 ià(
adj
->
v®ue
 < 
low”
)‡dj->value =†ower;

304 ià(
adj
->
v®ue
 > (
uµ”
 - 
·ge
))‡dj->value = upper -…age;

306 
	`gtk_adju¡m’t_chªged
(
adj
);

307 
	}
}

310 
gboŞ—n


311 
	$Ú_da_expo£_ev’t
 (
GtkWidg‘
 * 
widg‘
, 
GdkEv’tExpo£
 * 
ev’t
, 
gpoš‹r
 
unu£d
)

314 
	`gdk_d¿w_pixm­
 (
widg‘
->
wšdow
,

315 
widg‘
->
¡yË
->
fg_gc
[
	`GTK_WIDGET_STATE
 (widget)],

316 
	`GDK_PIXMAP
(
Çv
->
bufãr
),

317 
ev’t
->
¬—
.
x
,ƒv’t->¬—.
y
,

318 
ev’t
->
¬—
.
x
,ƒv’t->¬—.
y
,

319 
ev’t
->
¬—
.
width
,ƒv’t->¬—.
height
);

322 if(
Çv
->
is_fœ¡_expo£
){

324 
GtkAdju¡m’t
 * 
adj
;

325 
x
, 
y
;

327 
adj
 = 
Çv
->
ddi¥
->
hsbd©a
;

328 
x
 = (
adj
->
v®ue
 -‡dj->
low”
è/ (adj->
uµ”
 -‡dj->low”è* (
Çv
->
width
) +1;

330 
adj
 = 
Çv
->
ddi¥
->
vsbd©a
;

331 
y
 = (
adj
->
v®ue
 -‡dj->
low”
è/ (adj->
uµ”
 -‡dj->low”è* (
Çv
->
height
) +1;

334 
	`gdk_d¿w_»ùªgË
 (
widg‘
->
wšdow
,

335 
Çv
->
gc
, 
FALSE
,

336 
x
, 
y
, 
Çv
->
äame_w
,‚av->
äame_h
);

338 
Çv
->
is_fœ¡_expo£
 = 
FALSE
;

340  
FALSE
;

341 
	}
}

344 
gboŞ—n


345 
	$Ú_da_mÙiÚ_nÙify_ev’t
 (
GtkWidg‘
 * 
d¿wšg_¬—
, 
GdkEv’tMÙiÚ
 * 
ev’t
, 
gpoš‹r
 
unu£d
)

347 
GtkAdju¡m’t
 * 
adj
;

348 
gboŞ—n
 
v®ue_chªged
;

350 
w
 = 
Çv
->
äame_w
;

351 
h
 = 
Çv
->
äame_h
;

353 
x
, 
y
;

356 ià(
w
 >ğ
Çv
->
width
-1 && 
h
 >ğÇv->
height
-1è 
FALSE
;

358 
x
 = 
	`CLAMP
 (
ev’t
->x - 
w
/2 , 0, 
Çv
->
width
 - w);

359 
y
 = 
	`CLAMP
 (
ev’t
->y - 
h
/2 , 0, 
Çv
->
height
 - h);

361 
adj
 = 
Çv
->
ddi¥
->
hsbd©a
;

362 
v®ue_chªged
 = 
FALSE
;

363 ià(
w
/2 <ğ
ev’t
->
x
 &&ƒv’t->x <ğ(
Çv
->
width
 - w/2)){

364 
adj
->
v®ue
 =‡dj->
low”
 + 
x
 * 
Çv
->
hadj_cÛf
;

365 
v®ue_chªged
 = 
TRUE
;

367 ià(
x
 =ğ0 && 
adj
->
v®ue
 !ğadj->
low”
){

368 
adj
->
v®ue
 =‡dj->
low”
;

369 
v®ue_chªged
 = 
TRUE
;

371 ià(
x
 =ğ(
Çv
->
width
 - 
w
è&& 
adj
->
v®ue
 !ğ×dj->
uµ”
 -‡dj->
·ge_size
)){

372 
adj
->
v®ue
 =‡dj->
uµ”
 -‡dj->
·ge_size
;

373 
v®ue_chªged
 = 
TRUE
;

375 ià(
v®ue_chªged
è
	`gtk_adju¡m’t_v®ue_chªged
(
adj
);

377 
adj
 = 
Çv
->
ddi¥
->
vsbd©a
;

378 
v®ue_chªged
 = 
FALSE
;

379 ià(
h
/2 <ğ
ev’t
->
y
 &&ƒv’t->y <ğ(
Çv
->
height
 - h/2)){

380 
adj
->
v®ue
 =‡dj->
low”
 + 
y
 * 
Çv
->
vadj_cÛf
;

381 
v®ue_chªged
 = 
TRUE
;

383 ià(
y
 =ğ0 && 
adj
->
v®ue
 !ğadj->
low”
){

384 
adj
->
v®ue
 =‡dj->
low”
;

385 
v®ue_chªged
 = 
TRUE
;

387 ià(
y
 =ğ(
Çv
->
height
 - 
h
è&& 
adj
->
v®ue
 !ğ×dj->
uµ”
 -‡dj->
·ge_size
)){

388 
adj
->
v®ue
 =‡dj->
uµ”
 -‡dj->
·ge_size
;

389 
v®ue_chªged
 = 
TRUE
;

391 ià(
v®ue_chªged
è
	`gtk_adju¡m’t_v®ue_chªged
(
adj
);

396 
	`gdk_d¿w_pixm­
 (
d¿wšg_¬—
->
wšdow
,

397 
d¿wšg_¬—
->
¡yË
->
fg_gc
[
	`GTK_WIDGET_STATE
 (drawing_area)],

398 
	`GDK_PIXMAP
(
Çv
->
bufãr
),

399 0, 0, 0, 0, 
Çv
->
width
,‚av->
height
);

401 
	`gdk_d¿w_»ùªgË
 (
d¿wšg_¬—
->
wšdow
,

402 
Çv
->
gc
, 
FALSE
,

403 
x
, 
y
, 
w
, 
h
);

404  
FALSE
;

405 
	}
}

408 
gboŞ—n


409 
	$Ú_da_bu‰Ú_»Ëa£_ev’t
 (
GtkWidg‘
 * 
widg‘
, 
GdkEv’tBu‰Ú
 * 
ev’t
, 
gpoš‹r
 
unu£d
)

414 ià(
Çv
->
bufãr
)

415 
	`g_objeù_uÄef
 (
Çv
->
bufãr
);

416 
Çv
->
bufãr
 = 
NULL
;

418 ià(
Çv
->
gc
)

419 
	`g_objeù_uÄef
 (
Çv
->
gc
);

420 
Çv
->
gc
 = 
NULL
;

422 ià(
Çv
->
cursÜ
)

423 
	`gdk_cursÜ_uÄef
 (
Çv
->
cursÜ
);

424 
Çv
->
cursÜ
 = 
NULL
;

426 ià(
Çv
->
pİup_wšdow
)

427 
	`gtk_widg‘_de¡roy
 (
Çv
->
pİup_wšdow
);

428 
Çv
->
pİup_wšdow
 = 
NULL
;

431 
	`gtk_widg‘_g¿b_focus
(
Çv
->
ddi¥
->
ÿnvas
);

432  
FALSE
;

433 
	}
}

436 
	$Ú_bu‰Ú_Çvig©iÚ_pİup_»Ëa£d
 (
GtkBu‰Ú
 * 
bu‰Ú
, 
gpoš‹r
 
z
)

439 ià(!
Çv
->
is_fœ¡_expo£
)

440 
	`Ú_da_bu‰Ú_»Ëa£_ev’t
 (
NULL
, NULL, NULL);

441 
	}
}

	@O:\tool\dvs50\app\navigation.h

25 #iâdeà
NAVIGATION_H


26 
	#NAVIGATION_H


	)

28 
	~<gtk/gtk.h
>

29 
	~"di¥Ïy.h
"

43 
GtkWidg‘
 * 
Çvig©iÚ_pİup_Ãw
 (
DDi¥Ïy
 *
ddi¥
);

	@O:\tool\dvs50\app\object_ops.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<¡dlib.h
>

25 
	~"objeù_İs.h
"

26 
	~"cÚÃùiÚpošt_İs.h
"

27 
	~"hªdË_İs.h
"

28 
	~"mes§ge.h
"

30 
	#OBJECT_CONNECT_DISTANCE
 4.5

	)

33 
	$objeù_add_upd©es
(
DŸObjeù
 *
obj
, 
DŸg¿m
 *
dŸ
)

35 
i
;

38 ià(
obj
->
highlight_cŞÜ
 !ğ
NULL
) {

39 
	`dŸg¿m_add_upd©e_w™h_bÜd”
(
dŸ
, &
obj
->
boundšg_box
, 5);

41 
	`dŸg¿m_add_upd©e
(
dŸ
, 
	`dŸ_objeù_g‘_’şosšg_box
 (
obj
));

45 
i
=0;i<
obj
->
num_hªdËs
;i++) {

46 
	`hªdË_add_upd©e
(
obj
->
hªdËs
[
i
], 
dŸ
);

50 
i
=0;i<
obj
->
num_cÚÃùiÚs
;i++) {

51 
	`cÚÃùiÚpošt_add_upd©e
(
obj
->
cÚÃùiÚs
[
i
], 
dŸ
);

54 
	}
}

57 
	$objeù_add_upd©es_li¡
(
GLi¡
 *
li¡
, 
DŸg¿m
 *
dŸ
)

59 
DŸObjeù
 *
obj
;

61 
li¡
 !ğ
NULL
) {

62 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

64 
	`objeù_add_upd©es
(
obj
, 
dŸ
);

66 
li¡
 = 
	`g_li¡_Ãxt
(list);

68 
	}
}

79 
CÚÃùiÚPošt
 *

80 
	$objeù_fšd_cÚÃùpošt_di¥Ïy
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
pos
,

81 
DŸObjeù
 *
nÙthis
, 
gboŞ—n
 
¢­_to_objeùs
)

83 
»®
 
di¡ªû
;

84 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
;

85 
GLi¡
 *
avoid
 = 
NULL
;

86 
DŸObjeù
 *
obj_h”e
;

88 
di¡ªû
 =

89 
	`dŸg¿m_fšd_şo£¡_cÚÃùiÚpošt
(
ddi¥
->
dŸg¿m
, &
cÚÃùiÚpošt
,

90 
pos
, 
nÙthis
);

92 
di¡ªû
 = 
	`ddi¥Ïy_ŒªsfÜm_Ëngth
(
ddi¥
, distance);

93 ià(
di¡ªû
 < 
OBJECT_CONNECT_DISTANCE
) {

94  
cÚÃùiÚpošt
;

96 ià(
ddi¥
->
mašpošt_magÃtism
 && 
¢­_to_objeùs
) {

97 
DŸObjeù
 *
·»Á
;

100 
avoid
 = 
	`g_li¡_´•’d
×void, 
nÙthis
);

101 
·»Á
 = 
nÙthis
->·»Á;…¬’ˆ!ğ
NULL
;…arent =…arent->parent) {

102 
avoid
 = 
	`g_li¡_´•’d
×void, 
·»Á
);

104 
obj_h”e
 = 
	`dŸg¿m_fšd_şicked_objeù_exû±
(
ddi¥
->
dŸg¿m
, 
pos
, 0.00001, 
avoid
);

105 ià(
obj_h”e
 !ğ
NULL
) {

106 
i
;

107 
i
 = 0; i < 
obj_h”e
->
num_cÚÃùiÚs
; i++) {

108 ià(
obj_h”e
->
cÚÃùiÚs
[
i
]->
æags
 & 
CP_FLAG_ANYPLACE
) {

109 
	`g_li¡_ä“
(
avoid
);

110  
obj_h”e
->
cÚÃùiÚs
[
i
];

116  
NULL
;

117 
	}
}

121 
	$objeù_cÚÃù_di¥Ïy
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
,

122 
gboŞ—n
 
¢­_to_objeùs
)

124 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
;

126 ià(
hªdË
 =ğ
NULL
)

129 ià(
hªdË
->
cÚÃùed_to
 =ğ
NULL
) {

130 
cÚÃùiÚpošt
 = 
	`objeù_fšd_cÚÃùpošt_di¥Ïy
(
ddi¥
, &
hªdË
->
pos
,

131 
obj
, 
¢­_to_objeùs
);

133 ià(
cÚÃùiÚpošt
 !ğ
NULL
) {

134 
Chªge
 *
chªge
 = 
	`undo_cÚÃù
(
ddi¥
->
dŸg¿m
, 
obj
, 
hªdË
,

135 
cÚÃùiÚpošt
);

136 (
chªge
->
­¶y
)(chªge, 
ddi¥
->
dŸg¿m
);

139 
	}
}

141 
Pošt


142 
	$objeù_li¡_cÜÃr
(
GLi¡
 *
li¡
)

144 
Pošt
 
p
 = {0.0,0.0};

145 
DŸObjeù
 *
obj
;

147 ià(
li¡
 =ğ
NULL
)

148  
p
;

150 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

151 
p
.
x
 = 
obj
->
boundšg_box
.
Ëá
;

152 
p
.
y
 = 
obj
->
boundšg_box
.
tİ
;

154 
li¡
 = 
	`g_li¡_Ãxt
(list);

156 
li¡
 !ğ
NULL
) {

157 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

159 ià(
p
.
x
 > 
obj
->
boundšg_box
.
Ëá
)

160 
p
.
x
 = 
obj
->
boundšg_box
.
Ëá
;

161 ià(
p
.
y
 > 
obj
->
boundšg_box
.
tİ
)

162 
p
.
y
 = 
obj
->
boundšg_box
.
tİ
;

164 
li¡
 = 
	`g_li¡_Ãxt
(list);

167  
p
;

168 
	}
}

171 
	$objeù_li¡_sÜt_v”tiÿl
(cÚ¡ *
o1
, cÚ¡ *
o2
) {

172 
DŸObjeù
 *
obj1
 = *(DŸObjeù **)
o1
;

173 
DŸObjeù
 *
obj2
 = *(DŸObjeù **)
o2
;

175  (
obj1
->
boundšg_box
.
bÙtom
+obj1->boundšg_box.
tİ
)/2 -

176 (
obj2
->
boundšg_box
.
bÙtom
+obj2->boundšg_box.
tİ
)/2;

177 
	}
}

183 
	$objeù_li¡_®ign_v
(
GLi¡
 *
objeùs
, 
DŸg¿m
 *
dŸ
, 
®ign
)

185 
GLi¡
 *
li¡
;

186 
Pošt
 *
Üig_pos
;

187 
Pošt
 *
de¡_pos
;

188 
»®
 
y_pos
 = 0;

189 
DŸObjeù
 *
obj
;

190 
Pošt
 
pos
;

191 
»®
 
tİ
, 
bÙtom
, 
ä“¥c
;

192 
nobjs
;

193 
i
;

194 
gboŞ—n
 
sÜt_®loc
 = 
FALSE
;

196 ià(
objeùs
==
NULL
)

199 
obj
 = (
DŸObjeù
 *è
objeùs
->
d©a
;

201 
tİ
 = 
obj
->
boundšg_box
.top;

202 
bÙtom
 = 
obj
->
boundšg_box
.bottom;

203 
ä“¥c
 = 
bÙtom
 - 
tİ
;

205 
nobjs
 = 1;

206 
li¡
 = 
objeùs
->
Ãxt
;

207 
li¡
 !ğ
NULL
) {

208 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

210 ià(
obj
->
boundšg_box
.
tİ
 <op)

211 
tİ
 = 
obj
->
boundšg_box
.top;

212 ià(
obj
->
boundšg_box
.
bÙtom
 > bottom)

213 
bÙtom
 = 
obj
->
boundšg_box
.bottom;

215 
ä“¥c
 +ğ
obj
->
boundšg_box
.
bÙtom
 - obj->boundšg_box.
tİ
;

216 
nobjs
++;

218 
li¡
 = 
	`g_li¡_Ãxt
(list);

225 ià(
®ign
 =ğ
DIA_ALIGN_EQUAL
 ||‡ligÀ=ğ
DIA_ALIGN_ADJACENT
) {

226 
DŸObjeù
 **
objeù_¬¿y
 = (DŸObjeù **)
	`g_m®loc
((DŸObjeù*)*
nobjs
);

227 
i
 = 0;

229 
li¡
 = 
objeùs
;

230 
li¡
 !ğ
NULL
) {

231 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

232 
objeù_¬¿y
[
i
] = 
obj
;

233 
i
++;

234 
li¡
 = 
	`g_li¡_Ãxt
(list);

236 
	`qsÜt
(
objeù_¬¿y
, 
nobjs
, (
DŸObjeù
*), 
objeù_li¡_sÜt_v”tiÿl
);

237 
li¡
 = 
NULL
;

238 
i
 = 0; i < 
nobjs
; i++) {

239 
li¡
 = 
	`g_li¡_­³nd
Öi¡, 
objeù_¬¿y
[
i
]);

241 
objeùs
 = 
li¡
;

242 
sÜt_®loc
 = 
TRUE
;

243 
	`g_ä“
(
objeù_¬¿y
);

246 
®ign
) {

247 
DIA_ALIGN_TOP
:

248 
y_pos
 = 
tİ
;

250 
DIA_ALIGN_CENTER
:

251 
y_pos
 = (
tİ
 + 
bÙtom
)/2.0;

253 
DIA_ALIGN_BOTTOM
:

254 
y_pos
 = 
bÙtom
;

256 
DIA_ALIGN_POSITION
:

257 
y_pos
 = (
tİ
 + 
bÙtom
)/2.0;

259 
DIA_ALIGN_EQUAL
:

260 
ä“¥c
 = (
bÙtom
 - 
tİ
 - f»e¥c)/()(
nobjs
 - 1);

261 
y_pos
 = 
tİ
;

263 
DIA_ALIGN_ADJACENT
:

264 
y_pos
 = 
tİ
;

267 
	`mes§ge_w¬nšg
("Wrong‡rgumento object_list_align_v()\n");

270 
de¡_pos
 = 
	`g_Ãw
(
Pošt
, 
nobjs
);

271 
Üig_pos
 = 
	`g_Ãw
(
Pošt
, 
nobjs
);

273 
i
 = 0;

274 
li¡
 = 
objeùs
;

275 
li¡
 !ğ
NULL
) {

276 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

278 
pos
.
x
 = 
obj
->
pos™iÚ
.x;

280 
®ign
) {

281 
DIA_ALIGN_TOP
:

282 
pos
.
y
 = 
y_pos
 + 
obj
->
pos™iÚ
.y - obj->
boundšg_box
.
tİ
;

284 
DIA_ALIGN_CENTER
:

285 
pos
.
y
 = 
y_pos
 + 
obj
->
pos™iÚ
.y - (obj->
boundšg_box
.
tİ
 + obj->boundšg_box.
bÙtom
)/2.0;

287 
DIA_ALIGN_BOTTOM
:

288 
pos
.
y
 = 
y_pos
 - (
obj
->
boundšg_box
.
bÙtom
 - obj->
pos™iÚ
.y);

290 
DIA_ALIGN_POSITION
:

291 
pos
.
y
 = 
y_pos
;

293 
DIA_ALIGN_EQUAL
:

294 
pos
.
y
 = 
y_pos
 + 
obj
->
pos™iÚ
.y - obj->
boundšg_box
.
tİ
;

295 
y_pos
 +ğ
obj
->
boundšg_box
.
bÙtom
 - obj->boundšg_box.
tİ
 + 
ä“¥c
;

297 
DIA_ALIGN_ADJACENT
:

298 
pos
.
y
 = 
y_pos
 + 
obj
->
pos™iÚ
.y - obj->
boundšg_box
.
tİ
;

299 
y_pos
 +ğ
obj
->
boundšg_box
.
bÙtom
 - obj->boundšg_box.
tİ
;

303 
pos
.
x
 = 
obj
->
pos™iÚ
.x;

305 
Üig_pos
[
i
] = 
obj
->
pos™iÚ
;

306 
de¡_pos
[
i
] = 
pos
;

308 
obj
->
İs
->
	`move
(obj, &
pos
);

310 
i
++;

311 
li¡
 = 
	`g_li¡_Ãxt
(list);

314 
	`undo_move_objeùs
(
dŸ
, 
Üig_pos
, 
de¡_pos
, 
	`g_li¡_cİy
(
objeùs
));

315 ià(
sÜt_®loc
)

316 
	`g_li¡_ä“
(
objeùs
);

317 
	}
}

321 
	$objeù_li¡_sÜt_hÜizÚl
(cÚ¡ *
o1
, cÚ¡ *
o2
) {

322 
DŸObjeù
 *
obj1
 = *(DŸObjeù **)
o1
;

323 
DŸObjeù
 *
obj2
 = *(DŸObjeù **)
o2
;

325  (
obj1
->
boundšg_box
.
right
+obj1->boundšg_box.
Ëá
)/2 -

326 (
obj2
->
boundšg_box
.
right
+obj2->boundšg_box.
Ëá
)/2;

327 
	}
}

333 
	$objeù_li¡_®ign_h
(
GLi¡
 *
objeùs
, 
DŸg¿m
 *
dŸ
, 
®ign
)

335 
GLi¡
 *
li¡
;

336 
Pošt
 *
Üig_pos
;

337 
Pošt
 *
de¡_pos
;

338 
»®
 
x_pos
 = 0;

339 
DŸObjeù
 *
obj
;

340 
Pošt
 
pos
;

341 
»®
 
Ëá
, 
right
, 
ä“¥c
 = 0;

342 
nobjs
;

343 
i
;

344 
gboŞ—n
 
sÜt_®loc
 = 
FALSE
;

346 ià(
objeùs
==
NULL
)

349 
obj
 = (
DŸObjeù
 *è
objeùs
->
d©a
;

351 
Ëá
 = 
obj
->
boundšg_box
.left;

352 
right
 = 
obj
->
boundšg_box
.right;

353 
ä“¥c
 = 
right
 - 
Ëá
;

355 
nobjs
 = 1;

356 
li¡
 = 
objeùs
->
Ãxt
;

357 
li¡
 !ğ
NULL
) {

358 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

360 ià(
obj
->
boundšg_box
.
Ëá
 <†eft)

361 
Ëá
 = 
obj
->
boundšg_box
.left;

362 ià(
obj
->
boundšg_box
.
right
 >„ight)

363 
right
 = 
obj
->
boundšg_box
.right;

365 
ä“¥c
 +ğ
obj
->
boundšg_box
.
right
 - obj->boundšg_box.
Ëá
;

366 
nobjs
++;

368 
li¡
 = 
	`g_li¡_Ãxt
(list);

375 ià(
®ign
 =ğ
DIA_ALIGN_EQUAL
 ||‡ligÀ=ğ
DIA_ALIGN_ADJACENT
) {

376 
DŸObjeù
 **
objeù_¬¿y
 = (DŸObjeù **)
	`g_m®loc
((DŸObjeù*)*
nobjs
);

377 
i
 = 0;

379 
li¡
 = 
objeùs
;

380 
li¡
 !ğ
NULL
) {

381 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

382 
objeù_¬¿y
[
i
] = 
obj
;

383 
i
++;

384 
li¡
 = 
	`g_li¡_Ãxt
(list);

386 
	`qsÜt
(
objeù_¬¿y
, 
nobjs
, (
DŸObjeù
*), 
objeù_li¡_sÜt_hÜizÚl
);

387 
li¡
 = 
NULL
;

388 
i
 = 0; i < 
nobjs
; i++) {

389 
li¡
 = 
	`g_li¡_­³nd
Öi¡, 
objeù_¬¿y
[
i
]);

391 
objeùs
 = 
li¡
;

392 
sÜt_®loc
 = 
TRUE
;

393 
	`g_ä“
(
objeù_¬¿y
);

396 
®ign
) {

397 
DIA_ALIGN_LEFT
:

398 
x_pos
 = 
Ëá
;

400 
DIA_ALIGN_CENTER
:

401 
x_pos
 = (
Ëá
 + 
right
)/2.0;

403 
DIA_ALIGN_RIGHT
:

404 
x_pos
 = 
right
;

406 
DIA_ALIGN_POSITION
:

407 
x_pos
 = (
Ëá
 + 
right
)/2.0;

409 
DIA_ALIGN_EQUAL
:

410 
ä“¥c
 = (
right
 - 
Ëá
 - f»e¥c)/()(
nobjs
 - 1);

411 
x_pos
 = 
Ëá
;

413 
DIA_ALIGN_ADJACENT
:

414 
x_pos
 = 
Ëá
;

417 
	`mes§ge_w¬nšg
("Wrong‡rgumento object_list_align_h()\n");

420 
de¡_pos
 = 
	`g_Ãw
(
Pošt
, 
nobjs
);

421 
Üig_pos
 = 
	`g_Ãw
(
Pošt
, 
nobjs
);

423 
i
 = 0;

424 
li¡
 = 
objeùs
;

425 
li¡
 !ğ
NULL
) {

426 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

428 
®ign
) {

429 
DIA_ALIGN_LEFT
:

430 
pos
.
x
 = 
x_pos
 + 
obj
->
pos™iÚ
.x - obj->
boundšg_box
.
Ëá
;

432 
DIA_ALIGN_CENTER
:

433 
pos
.
x
 = 
x_pos
 + 
obj
->
pos™iÚ
.x - (obj->
boundšg_box
.
Ëá
 + obj->boundšg_box.
right
)/2.0;

435 
DIA_ALIGN_RIGHT
:

436 
pos
.
x
 = 
x_pos
 - (
obj
->
boundšg_box
.
right
 - obj->
pos™iÚ
.x);

438 
DIA_ALIGN_POSITION
:

439 
pos
.
x
 = 
x_pos
;

441 
DIA_ALIGN_EQUAL
:

442 
pos
.
x
 = 
x_pos
 + 
obj
->
pos™iÚ
.x - obj->
boundšg_box
.
Ëá
;

443 
x_pos
 +ğ
obj
->
boundšg_box
.
right
 - obj->boundšg_box.
Ëá
 + 
ä“¥c
;

445 
DIA_ALIGN_ADJACENT
:

446 
pos
.
x
 = 
x_pos
 + 
obj
->
pos™iÚ
.x - obj->
boundšg_box
.
Ëá
;

447 
x_pos
 +ğ
obj
->
boundšg_box
.
right
 - obj->boundšg_box.
Ëá
;

451 
pos
.
y
 = 
obj
->
pos™iÚ
.y;

453 
Üig_pos
[
i
] = 
obj
->
pos™iÚ
;

454 
de¡_pos
[
i
] = 
pos
;

456 
obj
->
İs
->
	`move
(obj, &
pos
);

458 
i
++;

459 
li¡
 = 
	`g_li¡_Ãxt
(list);

462 
	`undo_move_objeùs
(
dŸ
, 
Üig_pos
, 
de¡_pos
, 
	`g_li¡_cİy
(
objeùs
));

463 ià(
sÜt_®loc
)

464 
	`g_li¡_ä“
(
objeùs
);

465 
	}
}

475 
	$objeù_li¡_nudge
(
GLi¡
 *
objeùs
, 
DŸg¿m
 *
dŸ
, 
DœeùiÚ
 
dœ
, 
»®
 
¡•
)

477 
Pošt
 *
Üig_pos
;

478 
Pošt
 *
de¡_pos
;

479 
gušt
 
nobjs
, 
i
;

480 
»®
 
šc_x
, 
šc_y
;

481 
GLi¡
 *
li¡
;

482 
DŸObjeù
 *
obj
;

484 ià(!
objeùs
)

486 
	`g_»tuº_if_ç
 (
¡•
 > 0);

488 
nobjs
 = 
	`g_li¡_Ëngth
 (
objeùs
);

489 
	`g_»tuº_if_ç
 (
nobjs
 > 0);

491 
de¡_pos
 = 
	`g_Ãw
(
Pošt
, 
nobjs
);

492 
Üig_pos
 = 
	`g_Ãw
(
Pošt
, 
nobjs
);

494 
šc_x
 = 
DIR_RIGHT
 =ğ
dœ
 ? 
¡•
 : (
DIR_LEFT
 == dir ? -step : 0);

495 
šc_y
 = 
DIR_DOWN
 =ğ
dœ
 ? 
¡•
 : (
DIR_UP
 == dir ? -step : 0);

498 
i
 = 0;

499 
li¡
 = 
objeùs
;

500 
li¡
 !ğ
NULL
) {

501 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

503 
Üig_pos
[
i
] = 
obj
->
pos™iÚ
;

504 
de¡_pos
[
i
].
x
 = 
Üig_pos
[i].x + 
šc_x
;

505 
de¡_pos
[
i
].
y
 = 
Üig_pos
[i].y + 
šc_y
;

507 
obj
->
İs
->
	`move
(obj, &
de¡_pos
[
i
]);

508 ++
i
;

509 
li¡
 = 
	`g_li¡_Ãxt
(list);

511 
	`undo_move_objeùs
(
dŸ
, 
Üig_pos
, 
de¡_pos
, 
	`g_li¡_cİy
(
objeùs
));

512 
	}
}

	@O:\tool\dvs50\app\object_ops.h

18 #iâdeà
OBJECT_OPS_H


19 
	#OBJECT_OPS_H


	)

21 
	~"objeù.h
"

22 
	~"di¥Ïy.h
"

23 
	~"dŸg¿m.h
"

26 
	#DIA_ALIGN_TOP
 0

	)

27 
	#DIA_ALIGN_LEFT
 0

	)

28 
	#DIA_ALIGN_CENTER
 1

	)

29 
	#DIA_ALIGN_BOTTOM
 2

	)

30 
	#DIA_ALIGN_RIGHT
 2

	)

31 
	#DIA_ALIGN_POSITION
 3

	)

32 
	#DIA_ALIGN_EQUAL
 4

	)

33 
	#DIA_ALIGN_ADJACENT
 5

	)

35 
DIAVAR
 
objeù_add_upd©es
(
DŸObjeù
 *
obj
, 
DŸg¿m
 *
dŸ
);

36 
objeù_add_upd©es_li¡
(
GLi¡
 *
li¡
, 
DŸg¿m
 *
dŸ
);

37 
DIAVAR
 
CÚÃùiÚPošt
 *
objeù_fšd_cÚÃùpošt_di¥Ïy
(
DDi¥Ïy
 *
ddi¥
,

38 
Pošt
 *
pos
,

39 
DŸObjeù
 *
nÙthis
,

40 
gboŞ—n
 
¢­_to_objeùs
);

42 
DIAVAR
 
objeù_cÚÃù_di¥Ïy
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
,

43 
HªdË
 *
hªdË
, 
gboŞ—n
 
¢­_to_objeùs
);

46 
Pošt
 
objeù_li¡_cÜÃr
(
GLi¡
 *
li¡
);

47 
objeù_li¡_®ign_h
(
GLi¡
 *
objeùs
, 
DŸg¿m
 *
dŸ
, 
®ign
);

48 
objeù_li¡_®ign_v
(
GLi¡
 *
objeùs
, 
DŸg¿m
 *
dŸ
, 
®ign
);

51 
	mDIR_UP
 = 1,

52 
	mDIR_DOWN
,

53 
	mDIR_LEFT
,

54 
	mDIR_RIGHT


55 } 
	tDœeùiÚ
;

57 
objeù_li¡_nudge
(
GLi¡
 *
objeùs
, 
DŸg¿m
 *
dŸ
, 
DœeùiÚ
 
dœ
, 
»®
 
¡•
);

	@O:\tool\dvs50\app\pagesetup.c

22 #ifdeà
HAVE_CONFIG_H


23 
	~<cÚfig.h
>

26 
	~<gtk/gtk.h
>

28 
	~<m©h.h
>

30 
	~"·ge£tup.h
"

31 
	~"š.h
"

32 
	~"dŸ·g–ayout.h
"

34 
_PageS‘up
 
	tPageS‘up
;

35 
	s_PageS‘up
 {

36 
DŸg¿m
 *
	mdŸ
;

37 
GtkWidg‘
 *
	mwšdow
;

38 
GtkWidg‘
 *
	m·³r
;

39 
gboŞ—n
 
	mchªged
;

42 
·ge£tup_chªged
 (
GtkWidg‘
 *
wid
, 
PageS‘up
 *
ps
);

43 
·ge£tup_­¶y
 (
GtkWidg‘
 *
wid
, 
PageS‘up
 *
ps
);

45 
gšt


46 
	$·ge£tup_»¥Úd
(
GtkWidg‘
 *
widg‘
,

47 
gšt
 
»¥Ú£_id
,

48 
gpoš‹r
 
d©a
)

50 
PageS‘up
 *
ps
 = (PageS‘u°*)
d©a
;

52 iàĞ
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


53 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
) {

54 ià(
ps
->
chªged
)

55 
	`·ge£tup_­¶y
(
widg‘
, 
ps
);

58 ià(
»¥Ú£_id
 !ğ
GTK_RESPONSE_APPLY
) {

59 
	`g_objeù_uÄef
(
ps
->
dŸ
);

60 
	`gtk_widg‘_de¡roy
(
ps
->
wšdow
);

64 
	}
}

67 
	$ü—‹_·ge_£tup_dlg
(
DŸg¿m
 *
dŸ
)

69 
PageS‘up
 *
ps
;

70 
GtkWidg‘
 *
vbox
;

72 
ps
 = 
	`g_Ãw
(
PageS‘up
, 1);

73 
ps
->
dŸ
 = dia;

74 
	`g_objeù_»f
(
ps
->
dŸ
);

75 
ps
->
wšdow
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(

76 
	`_
("Page Setup"),

77 
	`GTK_WINDOW
 (
	`ddi¥Ïy_aùive
()->
sh–l
),

78 
GTK_DIALOG_DESTROY_WITH_PARENT
,

79 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

80 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

81 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

82 
NULL
);

83 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
ps
->
wšdow
), 
GTK_RESPONSE_OK
);

84 
vbox
 = 
	`GTK_DIALOG
(
ps
->
wšdow
)->vbox;

85 
	`gtk_dŸlog_£t_»¥Ú£_£ns™ive
(
	`GTK_DIALOG
(
ps
->
wšdow
), 
GTK_RESPONSE_APPLY
, 
FALSE
);

86 
ps
->
chªged
 = 
FALSE
;

88 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
ps
->
wšdow
), "response",

89 
	`G_CALLBACK
 (
·ge£tup_»¥Úd
), 
ps
);

92 
	`g_d©®i¡_£t_d©a_fuÎ
 (&
	`G_OBJECT
 (
ps
->
wšdow
)->
qd©a
, "·ge£tup",…s, 
g_ä“
);

94 
ps
->
·³r
 = 
	`dŸ_·ge_Ïyout_Ãw
();

95 
	`dŸ_·ge_Ïyout_£t_·³r
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
), 
dŸ
->
d©a
->·³r.
Çme
);

96 
	`dŸ_·ge_Ïyout_£t_m¬gšs
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

97 
dŸ
->
d©a
->
·³r
.
tm¬gš
,

98 
dŸ
->
d©a
->
·³r
.
bm¬gš
,

99 
dŸ
->
d©a
->
·³r
.
lm¬gš
,

100 
dŸ
->
d©a
->
·³r
.
rm¬gš
);

101 
	`dŸ_·ge_Ïyout_£t_Ü›Á©iÚ
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

102 
dŸ
->
d©a
->
·³r
.
is_pÜŒa™
 ? 
DIA_PAGE_ORIENT_PORTRAIT
 :

103 
DIA_PAGE_ORIENT_LANDSCAPE
);

104 
	`dŸ_·ge_Ïyout_£t_sÿlšg
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

105 
dŸ
->
d©a
->
·³r
.
sÿlšg
);

106 
	`dŸ_·ge_Ïyout_£t_f™to
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

107 
dŸ
->
d©a
->
·³r
.
f™to
);

108 
	`dŸ_·ge_Ïyout_£t_f™_dims
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

109 
dŸ
->
d©a
->
·³r
.
f™width
,

110 
dŸ
->
d©a
->
·³r
.
f™height
);

112 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
ps
->
·³r
), 5);

113 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
), 
ps
->
·³r
, 
TRUE
, TRUE, 0);

114 
	`gtk_widg‘_show
(
ps
->
·³r
);

116 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
ps
->
·³r
), "changed",

117 
	`G_CALLBACK
(
·ge£tup_chªged
), 
ps
);

119 
	`gtk_widg‘_show
(
ps
->
wšdow
);

120 
	}
}

123 
	$·ge£tup_chªged
(
GtkWidg‘
 *
wid
, 
PageS‘up
 *
ps
)

125 
gæßt
 
dwidth
, 
dheight
;

126 
gæßt
 
pwidth
, 
pheight
;

127 
gæßt
 
xsÿË
, 
ysÿË
;

128 
gšt
 
f™w
 = 0, 
f™h
 = 0;

129 
gæßt
 
cur_sÿlšg
;

132 
	`gtk_dŸlog_£t_»¥Ú£_£ns™ive
(
	`GTK_DIALOG
(
ps
->
wšdow
), 
GTK_RESPONSE_APPLY
, 
TRUE
);

133 
ps
->
chªged
 = 
TRUE
;

135 
dwidth
 = 
ps
->
dŸ
->
d©a
->
ex‹Ás
.
right
 -…s->dŸ->d©a->ex‹Ás.
Ëá
;

136 
dheight
 = 
ps
->
dŸ
->
d©a
->
ex‹Ás
.
bÙtom
 -…s->dŸ->d©a->ex‹Ás.
tİ
;

138 ià(
dwidth
 <ğ0.0 || 
dheight
 <= 0.0)

141 
	`dŸ_·ge_Ïyout_£t_chªged
 (
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
), 
TRUE
);

143 
cur_sÿlšg
 = 
	`dŸ_·ge_Ïyout_g‘_sÿlšg
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
));

144 
	`dŸ_·ge_Ïyout_g‘_efãùive_¬—
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

145 &
pwidth
, &
pheight
);

146 
	`g_»tuº_if_ç
 (
pwidth
 > 0.0 && 
pheight
 > 0.0);

147 
pwidth
 *ğ
cur_sÿlšg
;

148 
pheight
 *ğ
cur_sÿlšg
;

150 ià(
	`dŸ_·ge_Ïyout_g‘_f™to
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
))) {

151 
	`dŸ_·ge_Ïyout_g‘_f™_dims
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
), &
f™w
, &
f™h
);

152 
xsÿË
 = 
f™w
 * 
pwidth
 / 
dwidth
;

153 
ysÿË
 = 
f™h
 * 
pheight
 / 
dheight
;

154 
	`dŸ_·ge_Ïyout_£t_sÿlšg
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

155 
	`MIN
(
xsÿË
, 
ysÿË
));

157 
f™w
 = 
	`û
(
dwidth
 * 
cur_sÿlšg
 / 
pwidth
);

158 
f™h
 = 
	`û
(
dheight
 * 
cur_sÿlšg
 / 
pheight
);

159 
	`dŸ_·ge_Ïyout_£t_f™_dims
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
), 
f™w
, 
f™h
);

162 
	`dŸ_·ge_Ïyout_£t_chªged
 (
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
), 
FALSE
);

163 
	}
}

169 
	$·ge£tup_­¶y
(
GtkWidg‘
 *
wid
, 
PageS‘up
 *
ps
)

171 
	`g_ä“
(
ps
->
dŸ
->
d©a
->
·³r
.
Çme
);

172 
ps
->
dŸ
->
d©a
->
·³r
.
Çme
 =

173 
	`g_¡rdup
(
	`dŸ_·ge_Ïyout_g‘_·³r
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
)));

175 
	`dŸ_·ge_Ïyout_g‘_m¬gšs
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

176 &
ps
->
dŸ
->
d©a
->
·³r
.
tm¬gš
,

177 &
ps
->
dŸ
->
d©a
->
·³r
.
bm¬gš
,

178 &
ps
->
dŸ
->
d©a
->
·³r
.
lm¬gš
,

179 &
ps
->
dŸ
->
d©a
->
·³r
.
rm¬gš
);

181 
ps
->
dŸ
->
d©a
->
·³r
.
is_pÜŒa™
 =

182 
	`dŸ_·ge_Ïyout_g‘_Ü›Á©iÚ
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
)) ==

183 
DIA_PAGE_ORIENT_PORTRAIT
;

184 
ps
->
dŸ
->
d©a
->
·³r
.
sÿlšg
 =

185 
	`dŸ_·ge_Ïyout_g‘_sÿlšg
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
));

187 
ps
->
dŸ
->
d©a
->
·³r
.
f™to
 = 
	`dŸ_·ge_Ïyout_g‘_f™to
(

188 
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
));

189 
	`dŸ_·ge_Ïyout_g‘_f™_dims
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

190 &
ps
->
dŸ
->
d©a
->
·³r
.
f™width
,

191 &
ps
->
dŸ
->
d©a
->
·³r
.
f™height
);

193 
	`dŸ_·ge_Ïyout_g‘_efãùive_¬—
(
	`DIA_PAGE_LAYOUT
(
ps
->
·³r
),

194 &
ps
->
dŸ
->
d©a
->
·³r
.
width
,

195 &
ps
->
dŸ
->
d©a
->
·³r
.
height
);

198 
	`gtk_dŸlog_£t_»¥Ú£_£ns™ive
(
	`GTK_DIALOG
(
ps
->
wšdow
), 
GTK_RESPONSE_APPLY
, 
FALSE
);

199 
ps
->
chªged
 = 
FALSE
;

202 
	`dŸg¿m_£t_modif›d
(
ps
->
dŸ
, 
TRUE
);

203 
	`dŸg¿m_add_upd©e_®l
(
ps
->
dŸ
);

204 
	`dŸg¿m_æush
(
ps
->
dŸ
);

205 
	}
}

	@O:\tool\dvs50\app\pagesetup.h

22 #iâdeà
PAGESETUP_H


23 
	#PAGESETUP_H


	)

25 
	~"dŸg¿m.h
"

27 
ü—‹_·ge_£tup_dlg
 (
DŸg¿m
 *
dŸ
);

	@O:\tool\dvs50\app\plugin-manager.c

24 #ifdeà
HAVE_CONFIG_H


25 
	~<cÚfig.h
>

28 
	~<¡ršg.h
>

30 
	~<gtk/gtk.h
>

32 
	~"¶ugš-mªag”.h
"

33 
	~"š.h
"

34 
	~"¶ug-šs.h
"

35 
	~"mes§ge.h
"

37 
gšt


38 
	$pm_»¥Úd
(
GtkWidg‘
 *
widg‘
, 
gšt
 
»¥Ú£_id
, 
gpoš‹r
 
d©a
)

40 ià(
»¥Ú£_id
 !ğ
GTK_RESPONSE_APPLY
)

41 
	`gtk_widg‘_hide
(
widg‘
);

43 
	}
}

47 
	mLOADED_COLUMN
,

48 
	mNAME_COLUMN
,

49 
	mDESC_COLUMN
,

50 
	mFILENAME_COLUMN
,

51 
	mAUTOLOAD_COLUMN
,

52 
	mPLUGIN_COLUMN
,

53 
	mNUM_COLUMNS


57 
	$toggË_lßded_ÿÎback
 (
GtkC–lR’d””ToggË
 *
ûÎtoggË
,

58 
gch¬
 *
·th_¡ršg
,

59 
GtkT»eV›w
 *
Œ“_v›w
)

61 
GtkT»eMod–
 *
mod–
 = 
	`gtk_Œ“_v›w_g‘_mod–
 (
Œ“_v›w
);

62 
GtkT»eP©h
 *
·th
;

63 
GtkT»eI‹r
 
™”
;

64 
gboŞ—n
 
lßded
;

65 
PlugšInfo
 *
šfo
;

67 
·th
 = 
	`gtk_Œ“_·th_Ãw_äom_¡ršg
 (
·th_¡ršg
);

68 ià(!
	`gtk_Œ“_mod–_g‘_™”
 (
mod–
, &
™”
, 
·th
))

70 
	`g_w¬nšg
 ("%s: bad…©h?", 
G_STRLOC
);

73 
	`gtk_Œ“_·th_ä“
 (
·th
);

75 
	`gtk_Œ“_mod–_g‘
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
,

76 
LOADED_COLUMN
, &
lßded
, -1);

77 
	`gtk_Œ“_mod–_g‘
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
,

78 
PLUGIN_COLUMN
, &
šfo
, -1);

80 ià(
lßded
 && 
	`dŸ_¶ugš_ÿn_uÆßd
(
šfo
))

82 
	`dŸ_¶ugš_uÆßd
(
šfo
);

83 
lßded
 = 
FALSE
;

85 ià(!
lßded
)

87 
	`dŸ_¶ugš_lßd
(
šfo
);

88 
lßded
 = 
TRUE
;

91 
	`mes§ge_nÙiû
("Cª'ˆuÆßd…lug-š '%s'!", 
	`dŸ_¶ugš_g‘_Çme
(
šfo
));

92 
	`gtk_li¡_¡Üe_£t
 (
	`GTK_LIST_STORE
 (
mod–
), &
™”
,

93 
LOADED_COLUMN
, 
lßded
, -1);

94 
	}
}

97 
	$ÿn_uÆßd
 (
GtkT»eV›wCŞumn
 *
Œ“_cŞumn
,

98 
GtkC–lR’d””
 *
ûÎ
,

99 
GtkT»eMod–
 *
Œ“_mod–
,

100 
GtkT»eI‹r
 *
™”
,

101 
gpoš‹r
 
d©a
)

103 
PlugšInfo
 *
šfo
;

104 
gboŞ—n
 
lßded
;

106 
	`gtk_Œ“_mod–_g‘
(
Œ“_mod–
, 
™”
,

107 
PLUGIN_COLUMN
, &
šfo
, -1);

108 
	`gtk_Œ“_mod–_g‘
(
Œ“_mod–
, 
™”
,

109 
LOADED_COLUMN
, &
lßded
, -1);

110 ià(!
lßded
 || (lßded && 
	`dŸ_¶ugš_ÿn_uÆßd
(
šfo
)))

112 
ûÎ
->
mode
 = 
GTK_CELL_RENDERER_MODE_ACTIVATABLE
;

113 
	`GTK_CELL_RENDERER_TOGGLE
(
ûÎ
)->
aùiv©abË
 = 
TRUE
;

117 
ûÎ
->
mode
 = 
GTK_CELL_RENDERER_MODE_INERT
;

118 
	`GTK_CELL_RENDERER_TOGGLE
(
ûÎ
)->
aùiv©abË
 = 
FALSE
;

120 
	}
}

123 
	$toggË_autŞßd_ÿÎback
 (
GtkC–lR’d””ToggË
 *
ûÎtoggË
,

124 
gch¬
 *
·th_¡ršg
,

125 
GtkT»eV›w
 *
Œ“_v›w
)

127 
GtkT»eMod–
 *
mod–
 = 
	`gtk_Œ“_v›w_g‘_mod–
 (
Œ“_v›w
);

128 
GtkT»eP©h
 *
·th
;

129 
GtkT»eI‹r
 
™”
;

130 
gboŞ—n
 
lßd
;

131 
PlugšInfo
 *
šfo
;

133 
·th
 = 
	`gtk_Œ“_·th_Ãw_äom_¡ršg
 (
·th_¡ršg
);

134 ià(!
	`gtk_Œ“_mod–_g‘_™”
 (
mod–
, &
™”
, 
·th
))

136 
	`g_w¬nšg
 ("%s: bad…©h?", 
G_STRLOC
);

139 
	`gtk_Œ“_·th_ä“
 (
·th
);

141 
	`gtk_Œ“_mod–_g‘
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
,

142 
AUTOLOAD_COLUMN
, &
lßd
, -1);

143 
	`gtk_Œ“_mod–_g‘
 (
	`GTK_TREE_MODEL
 (
mod–
), &
™”
,

144 
PLUGIN_COLUMN
, &
šfo
, -1);

149 iàĞ0 =ğ
	`¡rcmp
(
	`dŸ_¶ugš_g‘_Çme
(
šfo
), "Standard")

150 || 0 =ğ
	`¡rcmp
(
	`dŸ_¶ugš_g‘_Çme
(
šfo
), "Internal"))

151 
	`mes§ge_nÙiû
("You don't wanto inhibit†oading\n"

152 "oà¶ug-š '%s'!", 
	`dŸ_¶ugš_g‘_Çme
(
šfo
));

154 
	`dŸ_¶ugš_£t_šhib™_lßd
(
šfo
, 
lßd
);

155 
	`gtk_li¡_¡Üe_£t
 (
	`GTK_LIST_STORE
 (
mod–
), &
™”
,

156 
AUTOLOAD_COLUMN
, !
lßd
, -1);

158 
	}
}

161 
	$ÿn_šhib™
 (
GtkT»eV›wCŞumn
 *
Œ“_cŞumn
,

162 
GtkC–lR’d””
 *
ûÎ
,

163 
GtkT»eMod–
 *
Œ“_mod–
,

164 
GtkT»eI‹r
 *
™”
,

165 
gpoš‹r
 
d©a
)

167 
PlugšInfo
 *
šfo
;

169 
	`gtk_Œ“_mod–_g‘
(
Œ“_mod–
, 
™”
,

170 
PLUGIN_COLUMN
, &
šfo
, -1);

171 iàĞ0 =ğ
	`¡rcmp
(
	`dŸ_¶ugš_g‘_Çme
(
šfo
), "Standard")

172 || 0 =ğ
	`¡rcmp
(
	`dŸ_¶ugš_g‘_Çme
(
šfo
), "Internal"))

174 
ûÎ
->
mode
 = 
GTK_CELL_RENDERER_MODE_INERT
;

175 
	`GTK_CELL_RENDERER_TOGGLE
(
ûÎ
)->
aùiv©abË
 = 
FALSE
;

179 
ûÎ
->
mode
 = 
GTK_CELL_RENDERER_MODE_ACTIVATABLE
;

180 
	`GTK_CELL_RENDERER_TOGGLE
(
ûÎ
)->
aùiv©abË
 = 
TRUE
;

182 
	}
}

184 
GtkWidg‘
 *

185 
	$g‘_¶ugš_mªag”
()

187 
GtkWidg‘
 *
dŸlog
 = 
NULL
;

188 
GtkWidg‘
 *
vbox
, *
süŞËd_wšdow
, *
Œ“_v›w
;

189 
GtkLi¡StÜe
 *
¡Üe
;

190 
GtkC–lR’d””
 *
»nd””
;

191 
GtkT»eV›wCŞumn
 *
cŞ
;

192 
GtkT»eI‹r
 
™”
;

193 
GLi¡
 *
tmp
;

195 ià(
dŸlog
)

196  
dŸlog
;

199 
dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(

200 
	`_
("Plug-ins"),

201 
NULL
, 0,

202 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

203 
NULL
);

205 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
dŸlog
), 
GTK_RESPONSE_CLOSE
);

207 
vbox
 = 
	`GTK_DIALOG
(
dŸlog
)->vbox;

210 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
dŸlog
), "response",

211 
	`G_CALLBACK
(
pm_»¥Úd
), 
NULL
);

212 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
dŸlog
), "delete_event",

213 
	`G_CALLBACK
(
gtk_widg‘_hide
), 
NULL
);

214 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
dŸlog
), "delete_event",

215 
	`G_CALLBACK
(
gtk_Œue
), 
NULL
);

216 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
dŸlog
), "destroy",

217 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
dŸlog
);

219 
süŞËd_wšdow
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
, NULL);

220 
	`gtk_süŞËd_wšdow_£t_shadow_ty³
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËd_wšdow
), 
GTK_SHADOW_ETCHED_IN
);

221 
	`gtk_süŞËd_wšdow_£t_pŞicy
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËd_wšdow
), 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

222 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox
), 
süŞËd_wšdow
, 
TRUE
, TRUE, 0);

225 
¡Üe
 = 
	`gtk_li¡_¡Üe_Ãw
 (
NUM_COLUMNS
,

226 
G_TYPE_BOOLEAN
,

227 
G_TYPE_STRING
,

228 
G_TYPE_STRING
,

229 
G_TYPE_STRING
,

230 
G_TYPE_BOOLEAN
,

231 
G_TYPE_POINTER
);

232 
Œ“_v›w
 = 
	`gtk_Œ“_v›w_Ãw_w™h_mod–
 (
	`GTK_TREE_MODEL
 (
¡Üe
));

233 
	`gtk_Œ“_v›w_£t_ruËs_hšt
 (
	`GTK_TREE_VIEW
 (
Œ“_v›w
), 
TRUE
);

236 
tmp
 = 
	`dŸ_li¡_¶ugšs
();m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

237 
PlugšInfo
 *
šfo
 = 
tmp
->
d©a
;

239 
	`gtk_li¡_¡Üe_­³nd
 (
¡Üe
, &
™”
);

240 
	`gtk_li¡_¡Üe_£t
 (
¡Üe
, &
™”
,

241 
LOADED_COLUMN
, 
	`dŸ_¶ugš_is_lßded
(
šfo
),

242 
NAME_COLUMN
, 
	`dŸ_¶ugš_g‘_Çme
(
šfo
),

243 
DESC_COLUMN
, 
	`dŸ_¶ugš_g‘_desütiÚ
(
šfo
),

244 
FILENAME_COLUMN
, 
	`dŸ_¶ugš_g‘_f’ame
(
šfo
),

245 
AUTOLOAD_COLUMN
, !
	`dŸ_¶ugš_g‘_šhib™_lßd
(
šfo
),

246 
PLUGIN_COLUMN
, 
šfo
,

251 
»nd””
 = 
	`gtk_ûÎ_»nd””_toggË_Ãw
 ();

252 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
»nd””
), "toggled",

253 
	`G_CALLBACK
 (
toggË_lßded_ÿÎback
), 
Œ“_v›w
);

254 
cŞ
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
(

255 
	`_
("Lßded"), 
»nd””
,

256 "aùive", 
LOADED_COLUMN
, 
NULL
);

257 
	`gtk_Œ“_v›w_cŞumn_£t_ûÎ_d©a_func
 (

258 
cŞ
, 
»nd””
, 
ÿn_uÆßd
, 
NULL
, NULL);

259 
	`gtk_Œ“_v›w_­³nd_cŞumn
 (
	`GTK_TREE_VIEW
 (
Œ“_v›w
), 
cŞ
);

261 
cŞ
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
(

262 
	`_
("Name"), 
	`gtk_ûÎ_»nd””_‹xt_Ãw
 (),

263 "‹xt", 
NAME_COLUMN
, 
NULL
);

264 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
 (
cŞ
, 
NAME_COLUMN
);

265 
	`gtk_Œ“_v›w_­³nd_cŞumn
 (
	`GTK_TREE_VIEW
 (
Œ“_v›w
), 
cŞ
);

267 
cŞ
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
(

268 
	`_
("DesütiÚ"), 
	`gtk_ûÎ_»nd””_‹xt_Ãw
 (),

269 "‹xt", 
DESC_COLUMN
, 
NULL
);

270 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
 (
cŞ
, 
DESC_COLUMN
);

271 
	`gtk_Œ“_v›w_­³nd_cŞumn
 (
	`GTK_TREE_VIEW
 (
Œ“_v›w
), 
cŞ
);

273 
»nd””
 = 
	`gtk_ûÎ_»nd””_toggË_Ãw
 ();

274 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
»nd””
), "toggled",

275 
	`G_CALLBACK
 (
toggË_autŞßd_ÿÎback
), 
Œ“_v›w
);

276 
cŞ
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
(

277 
	`_
("Lßd‡ˆS¹up"), 
»nd””
,

278 "aùive", 
AUTOLOAD_COLUMN
, 
NULL
);

279 
	`gtk_Œ“_v›w_cŞumn_£t_ûÎ_d©a_func
 (

280 
cŞ
, 
»nd””
, 
ÿn_šhib™
, 
NULL
, NULL);

281 
	`gtk_Œ“_v›w_­³nd_cŞumn
 (
	`GTK_TREE_VIEW
 (
Œ“_v›w
), 
cŞ
);

283 
cŞ
 = 
	`gtk_Œ“_v›w_cŞumn_Ãw_w™h_©Œibu‹s
(

284 
	`_
("FName"), 
	`gtk_ûÎ_»nd””_‹xt_Ãw
 (),

285 "‹xt", 
FILENAME_COLUMN
, 
NULL
);

286 
	`gtk_Œ“_v›w_cŞumn_£t_sÜt_cŞumn_id
 (
cŞ
, 
FILENAME_COLUMN
);

287 
	`gtk_Œ“_v›w_­³nd_cŞumn
 (
	`GTK_TREE_VIEW
 (
Œ“_v›w
), 
cŞ
);

289 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
süŞËd_wšdow
), 
Œ“_v›w
);

290 
	`gtk_wšdow_£t_deçuÉ_size
 (
	`GTK_WINDOW
 (
dŸlog
), 480, 400);

291 
	`gtk_widg‘_show_®l
 (
dŸlog
);

293  
dŸlog
;

294 
	}
}

297 
	$fe_¶ugšs_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

299 
GtkWidg‘
 *
pm
 = 
	`g‘_¶ugš_mªag”
();

301 
	`gtk_widg‘_show
(
pm
);

302 
	}
}

	@O:\tool\dvs50\app\plugin-manager.h

22 #iâdeà
PLUGIN_MANAGER_H


23 
	#PLUGIN_MANAGER_H


	)

25 
	~<gtk/gtk.h
>

27 
fe_¶ugšs_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

	@O:\tool\dvs50\app\preferences.c

18 
	~<cÚfig.h
>

20 
	~<¡dlib.h
>

21 
	~<¡dio.h
>

22 
	~<¡ršg.h
>

23 
	~<sys/ty³s.h
>

24 #ifdeà
HAVE_UNISTD_H


25 
	~<uni¡d.h
>

27 #ifdeà
HAVE_STDDEF_H


28 
	~<¡ddef.h
>

31 
	~<gtk/gtk.h
>

33 
	~"š.h
"

34 
	~"widg‘s.h
"

35 
	~"dŸg¿m.h
"

36 
	~"mes§ge.h
"

37 
	~"´eã»nûs.h
"

38 
	~"dŸ_dœs.h
"

39 
	~"dŸg¿md©a.h
"

40 
	~"·³r.h
"

41 
	~"š‹rçû.h
"

42 
	~"lib/´efs.h
"

43 
	~"³rsi¡’û.h
"

45 #ifdeà
G_OS_WIN32


46 
	~<io.h
>

49 
DŸP»ã»nûs
 
	g´efs
;

51 
	eDŸP»fTy³
 {

52 
	mPREF_NONE
,

53 
	mPREF_BOOLEAN
,

54 
	mPREF_INT
,

55 
	mPREF_UINT
,

56 
	mPREF_REAL
,

57 
	mPREF_UREAL
,

58 
	mPREF_COLOUR
,

59 
	mPREF_CHOICE
,

60 
	mPREF_STRING
,

61 
	mPREF_END_GROUP


64 
	s_DŸP»fD©a
 {

65 *
	mÇme
;

66 
DŸP»fTy³
 
	mty³
;

67 
	moff£t
;

68 cÚ¡ *
	mdeçuÉ_v®ue
;

69 
	mb
;

70 *
	mÏb–_‹xt
;

71 
GtkWidg‘
 *
	mwidg‘
;

72 
gboŞ—n
 
	mhidd’
;

73 
	mGLi¡
 *(*
	mchoiû_li¡_funùiÚ
)(
_DŸP»fD©a
 *
	m´ef
);

75 (*
	mupd©e_funùiÚ
)(
_DŸP»fD©a
 *
	m´ef
, 
gpoš‹r
 
	m±r
);

76 cÚ¡ *
	mkey
;

77 } 
	tDŸP»fD©a
;

79 
upd©e_æßtšg_toŞbox
(
DŸP»fD©a
 *
´ef
, 
gpoš‹r
 
±r
);

80 
upd©e_š‹º®_´efs
(
DŸP»fD©a
 *
´ef
, 
gpoš‹r
 
±r
);

82 
	gdeçuÉ_Œue
 = 1;

83 
	gdeçuÉ_çl£
 = 0;

84 
	gdeçuÉ_majÜ_lšes
 = 5;

85 
»®
 
	gdeçuÉ_»®_Úe
 = 1.0;

86 
»®
 
	gdeçuÉ_»®_zoom
 = 100.0;

87 
	gdeçuÉ_št_w
 = 500;

88 
	gdeçuÉ_št_h
 = 400;

89 
	gdeçuÉ_undo_d•th
 = 15;

90 
gušt
 
	gdeçuÉ_»ûÁ_docum’ts
 = 5;

91 
CŞÜ
 
	gdeçuÉ_cŞour
 = 
DEFAULT_GRID_COLOR
;

92 
CŞÜ
 
	gpb»ak_cŞour
 = 
DEFAULT_PAGEBREAK_COLOR
;

93 
gušt
 
	gdeçuÉ_dŒ“_dŸ_sÜt
 = 
DIA_TREE_SORT_INSERT
;

94 
gušt
 
	gdeçuÉ_dŒ“_obj_sÜt
 = 
DIA_TREE_SORT_INSERT
;

95 cÚ¡ 
gch¬
 *
	gdeçuÉ_·³r_Çme
 = 
NULL
;

96 cÚ¡ 
gch¬
 *
	gdeçuÉ_Ëngth_un™
 = "Centimeter";

97 cÚ¡ 
gch¬
 *
	gdeçuÉ_fÚtsize_un™
 = "Point";

99 cÚ¡ *
	gdeçuÉ_çvÜed_f‹r
 = 
N_
("any");

101 
	sDŸP»fsTab
 {

102 *
	mt™Ë
;

103 
GtkTabË
 *
	mbË
;

104 
	mrow
;

108 
	mUI_TAB
,

109 
	mDIA_TAB
,

110 
	mVIEW_TAB
,

111 
	mFAVOR_TAB
,

112 
	mGRID_TAB
,

113 
	mTREE_TAB


114 } 
	tTabIndex
;

116 
DŸP»fsTab
 
	g´efs_bs
[] =

118 {
N_
("U£¸IÁ”çû"), 
NULL
, 0},

119 {
N_
("DŸg¿m DeçuÉs"), 
NULL
, 0},

120 {
N_
("V›w DeçuÉs"), 
NULL
, 0},

121 {
N_
("FavÜ™es"), 
NULL
, 0},

122 {
N_
("Grid Lšes"), 
NULL
, 0},

123 {
N_
("DŸg¿m T»e"), 
NULL
, 0},

126 
	#NUM_PREFS_TABS
 ((
´efs_bs
)/(
DŸP»fsTab
))

	)

128 
GLi¡
 *

129 
	$_g‘_un™s_Çme_li¡
(
DŸP»fD©a
 *
´ef
)

131 
	`g_»tuº_v®_if_ç
(
´ef
->
key
 =ğ
NULL
, NULL);

132  
	`g‘_un™s_Çme_li¡
();

133 
	}
}

134 
GLi¡
 *

135 
	$_g‘_·³r_Çme_li¡
(
DŸP»fD©a
 *
´ef
)

137 
	`g_»tuº_v®_if_ç
(
´ef
->
key
 =ğ
NULL
, NULL);

138  
	`g‘_·³r_Çme_li¡
();

139 
	}
}

140 
GLi¡
 *

141 
	$g‘_expÜ‹r_Çmes
 (
DŸP»fD©a
 *
´ef
)

143 
GLi¡
 *
li¡
 = 
	`f‹r_g‘_unique_expÜt_Çmes
(
´ef
->
key
);

144 
li¡
 = 
	`g_li¡_´•’d
 (li¡, 
	`N_
("any"));

145  
li¡
;

146 
	}
}

149 
	$£t_çvÜed_expÜ‹r
 (
DŸP»fD©a
 *
´ef
, 
gpoš‹r
 
±r
)

151 *
v®
 = *((
gch¬
 **)
±r
);

152 
	`f‹r_£t_çvÜed_expÜt
(
´ef
->
key
, 
v®
);

153 
	}
}

156 #ifdeà
off£tof


157 
	#PREF_OFFSET
(
f›ld
è((è
	`off£tof
 (
DŸP»ã»nûs
, f›ld))

	)

159 
	#PREF_OFFSET
(
f›ld
è((è((*è&((
DŸP»ã»nûs
 *è0)->f›ld))

	)

162 
DŸP»fD©a
 
	g´efs_d©a
[] =

164 { "»£t_toŞs_aá”_ü—‹", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
»£t_toŞs_aá”_ü—‹
),

165 &
deçuÉ_Œue
, 
UI_TAB
, 
N_
("Resetools‡fter create") },

167 { "undo_d•th", 
PREF_UINT
, 
PREF_OFFSET
(
undo_d•th
),

168 &
deçuÉ_undo_d•th
, 
UI_TAB
, 
N_
("Number of undo†evels:") },

170 { "»v”£_rubb”bªdšg_š‹r£ùs", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
»v”£_rubb”bªdšg_š‹r£ùs
),

171 &
deçuÉ_Œue
, 
UI_TAB
, 
N_
("Reverse dragging selects\nintersecting objects") },

173 { "»ûÁ_docum’ts_li¡_size", 
PREF_UINT
, 
PREF_OFFSET
(
»ûÁ_docum’ts_li¡_size
),

174 &
deçuÉ_»ûÁ_docum’ts
, 0, 
N_
("Recent documents†ist size:") },

176 { "u£_m’u_b¬", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
Ãw_v›w
.
u£_m’u_b¬
),

177 &
deçuÉ_Œue
, 
UI_TAB
, 
N_
("Use menu bar") },

179 { "toŞbox_Ú_tİ", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
toŞbox_Ú_tİ
),

180 &
deçuÉ_çl£
, 
UI_TAB
, 
N_
("Keepool box onop of diagram windows"),

181 
NULL
, 
FALSE
, NULL, 
upd©e_æßtšg_toŞbox
},

182 { "Ëngth_un™", 
PREF_CHOICE
, 
PREF_OFFSET
(
Ëngth_un™
),

183 &
deçuÉ_Ëngth_un™
, 
UI_TAB
, 
N_
("L’gth un™:"), 
NULL
, 
FALSE
,

184 
_g‘_un™s_Çme_li¡
, 
upd©e_š‹º®_´efs
 },

185 { "fÚtsize_un™", 
PREF_CHOICE
, 
PREF_OFFSET
(
fÚtsize_un™
),

186 &
deçuÉ_fÚtsize_un™
, 
UI_TAB
, 
N_
("FÚt-sizun™:"), 
NULL
, 
FALSE
,

187 
_g‘_un™s_Çme_li¡
, 
upd©e_š‹º®_´efs
 },

189 { 
NULL
, 
PREF_NONE
, 0, NULL, 
DIA_TAB
, 
N_
("New diagram:") },

190 { "is_pÜŒa™", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
Ãw_dŸg¿m
.
is_pÜŒa™
), &
deçuÉ_Œue
, 
DIA_TAB
, 
N_
("Portrait") },

191 { "Ãw_dŸg¿m_·³¹y³", 
PREF_CHOICE
, 
PREF_OFFSET
(
Ãw_dŸg¿m
.
·³¹y³
),

192 &
deçuÉ_·³r_Çme
, 
DIA_TAB
, 
N_
("P­”y³:"), 
NULL
, 
FALSE
, 
_g‘_·³r_Çme_li¡
 },

193 { "Ãw_dŸg¿m_bgcŞour", 
PREF_COLOUR
, 
PREF_OFFSET
(
Ãw_dŸg¿m
.
bg_cŞÜ
),

194 &
cŞÜ_wh™e
, 
DIA_TAB
, 
N_
("Background Color:") },

195 { "com´ess_§ve", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
Ãw_dŸg¿m
.
com´ess_§ve
),

196 &
deçuÉ_Œue
, 
DIA_TAB
, 
N_
("Compress saved files") },

197 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
DIA_TAB
, NULL },

199 { 
NULL
, 
PREF_NONE
, 0, NULL, 
DIA_TAB
, 
N_
("Connection Points:") },

200 { "show_cx_±s", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
show_cx_±s
), &
deçuÉ_Œue
, 
DIA_TAB
, 
N_
("Visible") },

201 { "¢­_objeù", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
¢­_objeù
), &
deçuÉ_Œue
, 
DIA_TAB
, 
N_
("Snapo object") },

202 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
DIA_TAB
, NULL },

204 { 
NULL
, 
PREF_NONE
, 0, NULL, 
VIEW_TAB
, 
N_
("New window:") },

205 { "Ãw_v›w_width", 
PREF_UINT
, 
PREF_OFFSET
(
Ãw_v›w
.
width
), &
deçuÉ_št_w
, 
VIEW_TAB
, 
N_
("Width:") },

206 { "Ãw_v›w_height", 
PREF_UINT
, 
PREF_OFFSET
(
Ãw_v›w
.
height
), &
deçuÉ_št_h
, 
VIEW_TAB
, 
N_
("Height:") },

207 { "Ãw_v›w_zoom", 
PREF_UREAL
, 
PREF_OFFSET
(
Ãw_v›w
.
zoom
), &
deçuÉ_»®_zoom
, 
VIEW_TAB
, 
N_
("Magnify:") },

208 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 1, NULL },

210 { 
NULL
, 
PREF_NONE
, 0, NULL, 
VIEW_TAB
, 
N_
("Page breaks:") },

211 { "·geb»ak_visibË", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
·geb»ak
.
visibË
), &
deçuÉ_Œue
, 
VIEW_TAB
, 
N_
("Visible") },

212 { "·geb»ak_cŞour", 
PREF_COLOUR
, 
PREF_OFFSET
(
Ãw_dŸg¿m
.
·geb»ak_cŞÜ
), &
pb»ak_cŞour
, 
VIEW_TAB
, 
N_
("Color:") },

213 { "·geb»ak_sŞid", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
·geb»ak
.
sŞid
), &
deçuÉ_Œue
, 
VIEW_TAB
, 
N_
("Solid†ines") },

214 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
VIEW_TAB
, NULL },

216 { 
NULL
, 
PREF_NONE
, 0, NULL, 
VIEW_TAB
, 
N_
("Antialias:") },

217 { "v›w_ªtŸli£d", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
v›w_ªtŸli£d
), &
deçuÉ_çl£
, 
VIEW_TAB
, 
N_
("view‡ntialised") },

218 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
VIEW_TAB
, NULL },

221 { 
NULL
, 
PREF_NONE
, 0, NULL, 
FAVOR_TAB
, 
N_
("Export") },

222 { "çvÜed_²g_expÜt", 
PREF_CHOICE
, 
PREF_OFFSET
(
çvÜed_f‹r
.
²g
), &
deçuÉ_çvÜed_f‹r
,

223 
FAVOR_TAB
, 
N_
("PÜbË N‘wÜk G¿phics"), 
NULL
, 
FALSE
, 
g‘_expÜ‹r_Çmes
, 
£t_çvÜed_expÜ‹r
, "PNG" },

224 { "çvÜed_svg_expÜt", 
PREF_CHOICE
, 
PREF_OFFSET
(
çvÜed_f‹r
.
svg
), &
deçuÉ_çvÜed_f‹r
,

225 
FAVOR_TAB
, 
N_
("SÿÏbË VeùÜ G¿phics"), 
NULL
, 
FALSE
, 
g‘_expÜ‹r_Çmes
, 
£t_çvÜed_expÜ‹r
, "SVG" },

226 { "çvÜed_ps_expÜt", 
PREF_CHOICE
, 
PREF_OFFSET
(
çvÜed_f‹r
.
ps
), &
deçuÉ_çvÜed_f‹r
,

227 
FAVOR_TAB
, 
N_
("Po¡Süt"), 
NULL
, 
FALSE
, 
g‘_expÜ‹r_Çmes
, 
£t_çvÜed_expÜ‹r
, "PS" },

228 { "çvÜed_wmf_expÜt", 
PREF_CHOICE
, 
PREF_OFFSET
(
çvÜed_f‹r
.
wmf
), &
deçuÉ_çvÜed_f‹r
,

229 
FAVOR_TAB
, 
N_
("Wšdow M‘aFe"), 
NULL
, 
FALSE
, 
g‘_expÜ‹r_Çmes
, 
£t_çvÜed_expÜ‹r
, "WMF" },

230 { "çvÜed_emf_expÜt", 
PREF_CHOICE
, 
PREF_OFFSET
(
çvÜed_f‹r
.
emf
), &
deçuÉ_çvÜed_f‹r
,

231 
FAVOR_TAB
, 
N_
("Enhªûd M‘aFe"), 
NULL
, 
FALSE
, 
g‘_expÜ‹r_Çmes
, 
£t_çvÜed_expÜ‹r
, "EMF" },

232 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
FAVOR_TAB
, NULL },

235 { "grid_visibË", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
grid
.
visibË
), &
deçuÉ_Œue
, 
GRID_TAB
, 
N_
("Visible") },

236 { "grid_¢­", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
grid
.
¢­
), &
deçuÉ_çl£
, 
GRID_TAB
, 
N_
("Snapo") },

237 { "grid_dyÇmic", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
grid
.
dyÇmic
), &
deçuÉ_Œue
, 
GRID_TAB
, 
N_
("Dynamic grid„esizing") },

238 { "grid_x", 
PREF_UREAL
, 
PREF_OFFSET
(
grid
.
x
), &
deçuÉ_»®_Úe
, 
GRID_TAB
, 
N_
("X Size:") },

239 { "grid_y", 
PREF_UREAL
, 
PREF_OFFSET
(
grid
.
y
), &
deçuÉ_»®_Úe
, 
GRID_TAB
, 
N_
("Y Size:") },

240 { "grid_cŞour", 
PREF_COLOUR
, 
PREF_OFFSET
(
Ãw_dŸg¿m
.
grid_cŞÜ
), &
deçuÉ_cŞour
, 
GRID_TAB
, 
N_
("Color:") },

241 { "grid_majÜ", 
PREF_UINT
, 
PREF_OFFSET
(
grid
.
majÜ_lšes
), &
deçuÉ_majÜ_lšes
, 
GRID_TAB
, 
N_
("Lines…er major†ine") },

242 { "grid_hex", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
grid
.
hex
), &
deçuÉ_çl£
, 
GRID_TAB
, 
N_
("Hex grid") },

243 { "grid_w", 
PREF_UREAL
, 
PREF_OFFSET
(
grid
.
w
), &
deçuÉ_»®_Úe
, 
GRID_TAB
, 
N_
("Hex Size:") },

246 { "»nd”_boundšg_boxes", 
PREF_BOOLEAN
,
PREF_OFFSET
(
»nd”_boundšg_boxes
),

247 &
deçuÉ_çl£
,0,"»nd” boundšg boxes",
NULL
, 
TRUE
},

255 { 
NULL
, 
PREF_NONE
, 0, NULL, 
TREE_TAB
, 
N_
("Diagramree window:") },

256 { "dŸg¿m_Œ“_§ve_hidd’", 
PREF_BOOLEAN
, 
PREF_OFFSET
(
dŸ_Œ“
.
§ve_hidd’
),

257 &
deçuÉ_çl£
, 
TREE_TAB
, 
N_
("Save hidden objectypes")},

258 { "dŸg¿m_Œ“_dŸ_sÜt", 
PREF_UINT
, 
PREF_OFFSET
(
dŸ_Œ“
.
dŸ_sÜt
),

259 &
deçuÉ_dŒ“_dŸ_sÜt
, 
TREE_TAB
, "deçuÉ dŸg¿m sÜˆÜd”", 
NULL
, 
TRUE
},

260 { "dŸg¿m_Œ“_obj_sÜt", 
PREF_UINT
, 
PREF_OFFSET
(
dŸ_Œ“
.
obj_sÜt
),

261 &
deçuÉ_dŒ“_obj_sÜt
, 
TREE_TAB
, "deçuÉ objeù sÜˆÜd”", 
NULL
, 
TRUE
},

262 { 
NULL
, 
PREF_END_GROUP
, 0, NULL, 
TREE_TAB
, NULL },

265 
	#NUM_PREFS_DATA
 ((
´efs_d©a
)/(
DŸP»fD©a
))

	)

267 
´efs_ü—‹_dŸlog
();

268 
´efs_£t_v®ue_š_widg‘
(
GtkWidg‘
 * 
widg‘
, 
DŸP»fD©a
 *
d©a
, 
gpoš‹r
 
±r
);

269 
´efs_g‘_v®ue_äom_widg‘
(
GtkWidg‘
 * 
widg‘
, 
DŸP»fD©a
 *
d©a
, 
gpoš‹r
 
±r
);

270 
´efs_upd©e_dŸlog_äom_´efs
();

271 
´efs_upd©e_´efs_äom_dŸlog
();

275 
GtkWidg‘
 *
	g´efs_dŸlog
 = 
NULL
;

278 
	$´efs_show
()

280 
	`´efs_ü—‹_dŸlog
();

281 
	`gtk_widg‘_show
(
´efs_dŸlog
);

283 
	`´efs_upd©e_dŸlog_äom_´efs
();

284 
	}
}

287 
	$´efs_£t_deçuÉs
()

289 
i
;

290 
gpoš‹r
 
±r
;

295 ià(
deçuÉ_·³r_Çme
 =ğ
NULL
)

296 
deçuÉ_·³r_Çme
 = 
	`g‘_·³r_Çme
(
	`g‘_deçuÉ_·³r
());

298 
i
=0;i<
NUM_PREFS_DATA
;i++) {

299 
±r
 = (*)&
´efs
 + 
´efs_d©a
[
i
].
off£t
;

301 
´efs_d©a
[
i
].
ty³
) {

302 
PREF_BOOLEAN
:

303 *(*)
±r
 = *(*)
´efs_d©a
[
i
].
deçuÉ_v®ue
;

304 *(*)
±r
 = 
	`³rsi¡’û_»gi¡”_boŞ—n
(
´efs_d©a
[
i
].
Çme
, *(*)ptr);

306 
PREF_INT
:

307 
PREF_UINT
:

308 *(*)
±r
 = *(*)
´efs_d©a
[
i
].
deçuÉ_v®ue
;

309 *(*)
±r
 = 
	`³rsi¡’û_»gi¡”_š‹g”
(
´efs_d©a
[
i
].
Çme
, *(*)ptr);

311 
PREF_REAL
:

312 
PREF_UREAL
:

313 *(
»®
 *)
±r
 = *Ô—È*)
´efs_d©a
[
i
].
deçuÉ_v®ue
;

314 *(
»®
 *)
±r
 = 
	`³rsi¡’û_»gi¡”_»®
(
´efs_d©a
[
i
].
Çme
, *(real *)ptr);

316 
PREF_COLOUR
:

317 *(
CŞÜ
 *)
±r
 = *(CŞÜ *)
´efs_d©a
[
i
].
deçuÉ_v®ue
;

318 *(
CŞÜ
 *)
±r
 = *
	`³rsi¡’û_»gi¡”_cŞÜ
(
´efs_d©a
[
i
].
Çme
, (Color *)ptr);

320 
PREF_CHOICE
:

321 
PREF_STRING
:

322 *(
gch¬
 **)
±r
 = *(gch¬ **)
´efs_d©a
[
i
].
deçuÉ_v®ue
;

323 *(
gch¬
 **)
±r
 = 
	`³rsi¡’û_»gi¡”_¡ršg
(
´efs_d©a
[
i
].
Çme
, *(gchar **)ptr);

325 
PREF_NONE
:

326 
PREF_END_GROUP
:

330 ià(
´efs_d©a
[
i
].
upd©e_funùiÚ
)

331 (
´efs_d©a
[
i
].
upd©e_funùiÚ
)(&´efs_d©a[i], 
±r
);

333 
	`upd©e_š‹º®_´efs
(&
´efs_d©a
[
i
], 
NULL
);

334 
	}
}

337 
	$´efs_§ve
()

339 
i
;

340 
gpoš‹r
 
±r
;

341 
i
=0;i<
NUM_PREFS_DATA
;i++) {

342 ià((
´efs_d©a
[
i
].
ty³
 =ğ
PREF_NONE
è|| (´efs_d©a[i].ty³ =ğ
PREF_END_GROUP
))

345 
±r
 = (*)&
´efs
 + 
´efs_d©a
[
i
].
off£t
;

347 
´efs_d©a
[
i
].
ty³
) {

348 
PREF_BOOLEAN
:

349 
	`³rsi¡’û_£t_boŞ—n
(
´efs_d©a
[
i
].
Çme
, *(
gšt
 *)
±r
);

351 
PREF_INT
:

352 
PREF_UINT
:

353 
	`³rsi¡’û_£t_š‹g”
(
´efs_d©a
[
i
].
Çme
, *(
gšt
 *)
±r
);

355 
PREF_REAL
:

356 
PREF_UREAL
:

358 
	`³rsi¡’û_£t_»®
(
´efs_d©a
[
i
].
Çme
, *(
»®
 *)
±r
);

360 
PREF_COLOUR
:

361 
	`³rsi¡’û_£t_cŞÜ
(
´efs_d©a
[
i
].
Çme
, (
CŞÜ
 *)
±r
);

363 
PREF_CHOICE
:

364 
PREF_STRING
:

365 
	`³rsi¡’û_£t_¡ršg
(
´efs_d©a
[
i
].
Çme
, *(
gch¬
 **)
±r
);

367 
PREF_NONE
:

368 
PREF_END_GROUP
:

372 
	}
}

377 
	$´efs_š™
()

379 
	`´efs_£t_deçuÉs
();

381 
»nd”_boundšg_boxes
 = 
´efs
.render_bounding_boxes;

382 
	}
}

385 
	$´efs_£t_v®ue_š_widg‘
(
GtkWidg‘
 * 
widg‘
, 
DŸP»fD©a
 *
d©a
,

386 
gpoš‹r
 
±r
)

388 
d©a
->
ty³
) {

389 
PREF_BOOLEAN
:

390 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
widg‘
), *((*)
±r
));

392 
PREF_INT
:

393 
PREF_UINT
:

394 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
widg‘
),

395 (
gæßt
è(*((*)
±r
)));

397 
PREF_REAL
:

398 
PREF_UREAL
:

399 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
widg‘
),

400 (
gæßt
è(*((
»®
 *)
±r
)));

402 
PREF_COLOUR
:

403 
	`dŸ_cŞÜ_£ËùÜ_£t_cŞÜ
(
widg‘
, (
CŞÜ
 *)
±r
);

405 
PREF_CHOICE
: {

406 
GLi¡
 *
Çmes
 = (
d©a
->
choiû_li¡_funùiÚ
)(data);

407 
šdex
;

408 *
v®
 = *((
gch¬
**)
±r
);

409 
šdex
 = 0; 
Çmes
 !ğ
NULL
;‚ame ğ
	`g_li¡_Ãxt
(names), index++) {

410 ià(!
v®
 || !
	`¡rcmp
(v®, (
gch¬
 *)
Çmes
->
d©a
))

413 ià(
Çmes
 =ğ
NULL
) ;

414 
	`gtk_combo_box_£t_aùive
 (
	`GTK_COMBO_BOX
 (
widg‘
), 
šdex
);

417 
PREF_STRING
:

418 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
widg‘
), (
gch¬
 *)(*((gch¬ **)
±r
)));

420 
PREF_NONE
:

421 
PREF_END_GROUP
:

424 
	}
}

427 
	$´efs_g‘_v®ue_äom_widg‘
(
GtkWidg‘
 * 
widg‘
, 
DŸP»fD©a
 *
d©a
,

428 
gpoš‹r
 
±r
)

430 
gboŞ—n
 
chªged
 = 
FALSE
;

431 
d©a
->
ty³
) {

432 
PREF_BOOLEAN
: {

433 
´ev
 = *((*)
±r
);

434 *((*)
±r
èğ
	`GTK_TOGGLE_BUTTON
(
widg‘
)->
aùive
;

435 
chªged
 = (
´ev
 !ğ*((*)
±r
));

438 
PREF_INT
:

439 
PREF_UINT
: {

440 
´ev
 = *((*)
±r
);

441 *((*)
±r
èğ
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
	`GTK_SPIN_BUTTON
(
widg‘
));

442 
chªged
 = (
´ev
 !ğ*((*)
±r
));

445 
PREF_REAL
:

446 
PREF_UREAL
: {

447 
»®
 
´ev
 = *(Ô—È*)
±r
);

448 *((
»®
 *)
±r
) = (real)

449 
	`gtk_¥š_bu‰Ú_g‘_v®ue
 (
	`GTK_SPIN_BUTTON
(
widg‘
));

450 
chªged
 = (
´ev
 !ğ*((
»®
 *)
±r
));

453 
PREF_COLOUR
: {

454 
CŞÜ
 
´ev
 = *(CŞÜ *)
±r
;

455 
	`dŸ_cŞÜ_£ËùÜ_g‘_cŞÜ
(
widg‘
, (
CŞÜ
 *)
±r
);

456 
chªged
 = 
	`memcmp
 (&
´ev
, 
±r
, (
CŞÜ
));

459 
PREF_CHOICE
: {

460 
šdex
 = 
	`gtk_combo_box_g‘_aùive
 (
	`GTK_COMBO_BOX
 (
widg‘
));

461 
GLi¡
 *
Çmes
 = (
d©a
->
choiû_li¡_funùiÚ
)(data);

462 *((
gch¬
 **)
±r
èğ
	`g_¡rdup
((gch¬ *)
	`g_li¡_Áh_d©a
(
Çmes
, 
šdex
));

464 
chªged
 = 
TRUE
;

467 
PREF_STRING
:

468 *((
gch¬
 **)
±r
èğ(gch¬ *)
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
widg‘
));

470 
chªged
 = 
TRUE
;

472 
PREF_NONE
:

473 
PREF_END_GROUP
:

476 ià(
chªged
 && 
d©a
->
upd©e_funùiÚ
 !ğ
NULL
) {

477 (
d©a
->
upd©e_funùiÚ
)(d©a, 
±r
);

479 
	}
}

482 
	$´efs_boŞ—n_toggË
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

484 
gušt
 
aùive
 = 
	`GTK_TOGGLE_BUTTON
(
widg‘
)->active;

485 
	`gtk_bu‰Ú_£t_Ïb–
(
	`GTK_BUTTON
(
widg‘
), 
aùive
 ? 
	`_
("Yes") : _("No"));

486 
	}
}

488 
GtkWidg‘
 *

489 
	$´efs_g‘_´İ”ty_widg‘
(
DŸP»fD©a
 *
d©a
)

491 
GtkWidg‘
 *
widg‘
 = 
NULL
;

492 
GtkAdju¡m’t
 *
adj
;

494 
d©a
->
ty³
) {

495 
PREF_BOOLEAN
:

496 
widg‘
 = 
	`gtk_toggË_bu‰Ú_Ãw_w™h_Ïb–
 (
	`_
("No"));

497 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
widg‘
), "toggled",

498 
	`G_CALLBACK
 (
´efs_boŞ—n_toggË
), 
NULL
);

500 
PREF_INT
:

501 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(0.0,

502 
G_MININT
, 
G_MAXINT
,

504 
widg‘
 = 
	`gtk_¥š_bu‰Ú_Ãw
 (
adj
, 1.0, 0);

505 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
widg‘
), 
TRUE
);

506 
	`gtk_widg‘_£t_size_»que¡
 (
widg‘
, 80, -1);

508 
PREF_UINT
:

509 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(0.0,

510 0.0, 
G_MAXINT
,

512 
widg‘
 = 
	`gtk_¥š_bu‰Ú_Ãw
 (
adj
, 1.0, 0);

513 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
widg‘
), 
TRUE
);

514 
	`gtk_widg‘_£t_size_»que¡
 (
widg‘
, 80, -1);

516 
PREF_REAL
:

517 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(0.0,

518 
G_MINFLOAT
, 
G_MAXFLOAT
,

520 
widg‘
 = 
	`gtk_¥š_bu‰Ú_Ãw
 (
adj
, 1.0, 3);

521 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
widg‘
), 
TRUE
);

522 
	`gtk_widg‘_£t_size_»que¡
 (
widg‘
, 80, -1);

524 
PREF_UREAL
:

525 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(0.0,

526 0.0, 
G_MAXFLOAT
,

528 
widg‘
 = 
	`gtk_¥š_bu‰Ú_Ãw
 (
adj
, 1.0, 3);

529 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
widg‘
), 
TRUE
);

530 
	`gtk_widg‘_£t_size_»que¡
 (
widg‘
, 80, -1);

532 
PREF_COLOUR
:

533 
widg‘
 = 
	`dŸ_cŞÜ_£ËùÜ_Ãw
();

535 
PREF_STRING
:

536 
widg‘
 = 
	`gtk_’Œy_Ãw
();

538 
PREF_CHOICE
: {

539 
GLi¡
 *
Çmes
;

540 
widg‘
 = 
	`gtk_combo_box_Ãw_‹xt
 ();

541 
Çmes
 = (
d©a
->
choiû_li¡_funùiÚ
)(data);

542 
Çmes
 !ğ
NULL
;

543 
Çmes
 = 
	`g_li¡_Ãxt
(names)) {

544 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
widg‘
), (
gch¬
 *)
Çmes
->
d©a
);

548 
PREF_NONE
:

549 
PREF_END_GROUP
:

550 
widg‘
 = 
NULL
;

553 ià(
widg‘
 !ğ
NULL
)

554 
	`gtk_widg‘_show
(
widg‘
);

555  
widg‘
;

556 
	}
}

558 
gšt


559 
	$´efs_»¥Úd
(
GtkWidg‘
 *
widg‘
,

560 
gšt
 
»¥Ú£_id
,

561 
gpoš‹r
 
d©a
)

563 iàĞ
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


564 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
) {

565 
	`´efs_upd©e_´efs_äom_dŸlog
();

566 
	`´efs_§ve
();

567 
	`dŸg¿m_»d¿w_®l
();

570 ià(
»¥Ú£_id
 !ğ
GTK_RESPONSE_APPLY
)

571 
	`gtk_widg‘_hide
(
widg‘
);

574 
	}
}

577 
	$´efs_ü—‹_dŸlog
()

579 
GtkWidg‘
 *
Ïb–
;

580 
GtkWidg‘
 *
dŸlog_vbox
;

581 
GtkWidg‘
 *
nÙebook
;

582 
GtkTabË
 *
tİ_bË
 = 
NULL
;

583 
GtkTabË
 *
cu¼’t_bË
 = 
NULL
;

584 
i
;

585 
b_idx
 = -1;

587 ià(
´efs_dŸlog
 !ğ
NULL
)

590 
´efs_dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(

591 
	`_
("Preferences"),

592 
	`GTK_WINDOW
(
	`š‹rçû_g‘_toŞbox_sh–l
()),

593 
GTK_DIALOG_DESTROY_WITH_PARENT
,

594 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

595 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

596 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

597 
NULL
);

598 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
´efs_dŸlog
), 
GTK_RESPONSE_OK
);

599 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
´efs_dŸlog
), 
TRUE
);

601 
dŸlog_vbox
 = 
	`GTK_DIALOG
 (
´efs_dŸlog
)->
vbox
;

603 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
´efs_dŸlog
), "preferences_window");

605 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
´efs_dŸlog
), "response",

606 
	`G_CALLBACK
 (
´efs_»¥Úd
), 
NULL
);

608 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
´efs_dŸlog
), "delete_event",

609 
	`G_CALLBACK
(
gtk_widg‘_hide
), 
NULL
);

610 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
´efs_dŸlog
), "destroy",

611 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
´efs_dŸlog
);

613 
nÙebook
 = 
	`gtk_nÙebook_Ãw
 ();

614 
	`gtk_nÙebook_£t_b_pos
 (
	`GTK_NOTEBOOK
 (
nÙebook
), 
GTK_POS_TOP
);

615 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
dŸlog_vbox
), 
nÙebook
, 
TRUE
, TRUE, 0);

616 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
nÙebook
), 2);

617 
	`gtk_widg‘_show
 (
nÙebook
);

619 
i
=0;i<
NUM_PREFS_TABS
;i++) {

620 
GtkWidg‘
 *
bË
;

621 
GtkWidg‘
 *
nÙebook_·ge
;

623 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`g‘‹xt
(
´efs_bs
[
i
].
t™Ë
));

624 
	`gtk_widg‘_show
(
Ïb–
);

626 
bË
 = 
	`gtk_bË_Ãw
 (9, 2, 
FALSE
);

627 
´efs_bs
[
i
].
bË
 = 
	`GTK_TABLE
(table);

628 
	`gtk_widg‘_£t_size_»que¡
(
bË
, -1, -1);

629 
	`gtk_widg‘_show
(
bË
);

631 #ifdeà
SCROLLED_PAGES


632 
nÙebook_·ge
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
, NULL);

633 
	`gtk_süŞËd_wšdow_£t_pŞicy
 (
	`GTK_SCROLLED_WINDOW
 (
nÙebook_·ge
),

634 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

635 
	`gtk_widg‘_show
(
nÙebook_·ge
);

637 
nÙebook_·ge
 = 
bË
;

640 
	`gtk_nÙebook_­³nd_·ge
(
	`GTK_NOTEBOOK
(
nÙebook
), 
nÙebook_·ge
, 
Ïb–
);

642 #ifdeà
SCROLLED_PAGES


643 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
(
	`GTK_SCROLLED_WINDOW
(
nÙebook_·ge
),

644 
bË
);

645 
	`gtk_v›wpÜt_£t_shadow_ty³
(
	`GTK_VIEWPORT
(
	`GTK_BIN
(
nÙebook_·ge
)->
chd
),

646 
GTK_SHADOW_NONE
);

650 
	`gtk_nÙebook_£t_b_pos
(
	`GTK_NOTEBOOK
(
nÙebook
), 
GTK_POS_LEFT
);

652 
b_idx
 = -1;

653 
i
=0;i<
NUM_PREFS_DATA
;i++) {

654 
GtkWidg‘
 *
widg‘
 = 
NULL
;

655 
row
;

657 ià(
´efs_d©a
[
i
].
hidd’
)

660 ià(
b_idx
 !ğ
´efs_d©a
[
i
].
b
) {

661 
b_idx
 = 
´efs_d©a
[
i
].
b
;

662 
tİ_bË
 = 
´efs_bs
[
´efs_d©a
[
i
].
b
].
bË
;

663 
cu¼’t_bË
 = 
tİ_bË
;

665 
row
 = 
´efs_bs
[
b_idx
].row++;

666 
´efs_d©a
[
i
].
ty³
) {

667 
PREF_NONE
:

668 
widg‘
 = 
	`gtk_äame_Ãw
(
	`g‘‹xt
(
´efs_d©a
[
i
].
Ïb–_‹xt
));

669 
	`gtk_widg‘_show
 (
widg‘
);

670 
	`gtk_bË_©ch
 (
cu¼’t_bË
, 
widg‘
, 0, 2,

671 
row
,„ow + 1,

672 
GTK_FILL
 | 
GTK_EXPAND
, GTK_FILL, 1, 1);

673 
cu¼’t_bË
 = 
	`GTK_TABLE
(
	`gtk_bË_Ãw
 (9, 2, 
FALSE
));

674 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
widg‘
), 
	`GTK_WIDGET
(
cu¼’t_bË
));

675 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
cu¼’t_bË
));

677 
PREF_END_GROUP
:

678 
cu¼’t_bË
 = 
tİ_bË
;

680 
PREF_BOOLEAN
:

681 
widg‘
 = 
	`gtk_check_bu‰Ú_Ãw_w™h_Ïb–
 (
	`g‘‹xt
(
´efs_d©a
[
i
].
Ïb–_‹xt
));

682 
	`gtk_widg‘_show
 (
widg‘
);

683 
	`gtk_bË_©ch
 (
cu¼’t_bË
, 
widg‘
, 0, 2,

684 
row
,„ow + 1,

685 
GTK_FILL
 | 
GTK_EXPAND
, GTK_FILL, 1, 1);

688 
Ïb–
 = 
	`gtk_Ïb–_Ãw
 (
	`g‘‹xt
(
´efs_d©a
[
i
].
Ïb–_‹xt
));

689 
	`gtk_misc_£t_®ignm’t
 (
	`GTK_MISC
 (
Ïb–
), 0.0, 0.3);

690 
	`gtk_widg‘_show
 (
Ïb–
);

692 
	`gtk_bË_©ch
 (
cu¼’t_bË
, 
Ïb–
, 0, 1,

693 
row
,„ow + 1,

694 
GTK_FILL
 | 
GTK_EXPAND
, GTK_FILL, 1, 1);

696 
widg‘
 = 
	`´efs_g‘_´İ”ty_widg‘
(&
´efs_d©a
[
i
]);

697 ià(
widg‘
 !ğ
NULL
) {

698 
	`gtk_bË_©ch
 (
cu¼’t_bË
, 
widg‘
, 1, 2,

699 
row
,„ow + 1,

700 
GTK_FILL
, GTK_FILL, 1, 1);

704 
´efs_d©a
[
i
].
widg‘
 = widget;

708 
	`gtk_widg‘_show
 (
´efs_dŸlog
);

709 
	}
}

712 
	$´efs_upd©e_´efs_äom_dŸlog
()

714 
GtkWidg‘
 *
widg‘
;

715 
i
;

716 
gpoš‹r
 
±r
;

718 
i
=0;i<
NUM_PREFS_DATA
;i++) {

719 ià(
´efs_d©a
[
i
].
hidd’
) ;

720 
widg‘
 = 
´efs_d©a
[
i
].widget;

721 
±r
 = (*)&
´efs
 + 
´efs_d©a
[
i
].
off£t
;

723 
	`´efs_g‘_v®ue_äom_widg‘
(
widg‘
, &
´efs_d©a
[
i
], 
±r
);

725 
	}
}

728 
	$´efs_upd©e_dŸlog_äom_´efs
()

730 
GtkWidg‘
 *
widg‘
;

731 
i
;

732 
gpoš‹r
 
±r
;

734 
i
=0;i<
NUM_PREFS_DATA
;i++) {

735 ià(
´efs_d©a
[
i
].
hidd’
) ;

736 
widg‘
 = 
´efs_d©a
[
i
].widget;

737 
±r
 = (*)&
´efs
 + 
´efs_d©a
[
i
].
off£t
;

739 
	`´efs_£t_v®ue_š_widg‘
(
widg‘
, &
´efs_d©a
[
i
], 
±r
);

741 
	}
}

747 
	$upd©e_š‹º®_´efs
(
DŸP»fD©a
 *
´ef
, 
gpoš‹r
 
±r
)

749 *
v®
 = 
NULL
;

751 ià(!
±r
)

753 
v®
 = *(**)
±r
;

754 ià(
´efs
.
Ëngth_un™
)

755 
	`´efs_£t_Ëngth_un™
(
´efs
.
Ëngth_un™
);

756 ià(
´efs
.
fÚtsize_un™
)

757 
	`´efs_£t_fÚtsize_un™
(
´efs
.
fÚtsize_un™
);

758 
	}
}

761 
	$upd©e_æßtšg_toŞbox
(
DŸP»fD©a
 *
´ef
, 
gpoš‹r
 
±r
)

763 
	`g_»tuº_if_ç
 (
´ef
->
key
 =ğ
NULL
);

765 ià(!
	`­p_is_š‹¿ùive
())

768 ià(
´efs
.
toŞbox_Ú_tİ
) {

770 
GLi¡
 *
dŸg¿ms
;

771 
dŸg¿ms
 = 
	`dŸ_İ’_dŸg¿ms
(); dŸg¿m !ğ
NULL
;

772 
dŸg¿ms
 = 
	`g_li¡_Ãxt
(diagrams)) {

773 
DŸg¿m
 *
dŸg¿m
 = (DŸg¿m *)
dŸg¿ms
->
d©a
;

774 
GSLi¡
 *
di¥Ïys
;

775 
di¥Ïys
 = 
dŸg¿m
->di¥Ïys; di¥Ïy !ğ
NULL
;

776 
di¥Ïys
 = 
	`g_¦i¡_Ãxt
(displays)) {

777 
DDi¥Ïy
 *
ddi¥
 = (DDi¥Ïy *)
di¥Ïys
->
d©a
;

778 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
	`š‹rçû_g‘_toŞbox_sh–l
()),

779 
	`GTK_WINDOW
(
ddi¥
->
sh–l
));

783 
GtkWšdow
 *
sh–l
 = 
	`GTK_WINDOW
(
	`š‹rçû_g‘_toŞbox_sh–l
());

784 ià(
sh–l
)

785 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
sh–l
, 
NULL
);

787 
	}
}

	@O:\tool\dvs50\app\preferences.h

18 #iâdeà
PREFERENCES_H


19 
	#PREFERENCES_H


	)

21 
	~"geom‘ry.h
"

22 
	~"cŞÜ.h
"

23 
	~"dŸg¿m_Œ“_wšdow.h
"

24 
	~"dŸg¿md©a.h
"

25 
	~"lib/widg‘s.h
"

27 
	#DEFAULT_GRID_COLOR
 { 0.85, .90, .90 }

	)

28 
	#DEFAULT_PAGEBREAK_COLOR
 { 0.0, 0.0, 0.6 }

	)

30 
	sDŸP»ã»nûs
 {

32 
	mvisibË
;

33 
	m¢­
;

34 
gboŞ—n
 
	mdyÇmic
;

35 
»®
 
	mx
;

36 
»®
 
	my
;

37 
	mmajÜ_lšes
;

38 
	mhex
;

39 
»®
 
	mw
;

40 } 
	mgrid
;

43 
	mwidth
;

44 
	mheight
;

45 
»®
 
	mzoom
;

46 
	mu£_m’u_b¬
;

47 } 
	mÃw_v›w
;

49 
NewDŸg¿mD©a
 
	mÃw_dŸg¿m
;

51 
	mshow_cx_±s
;

52 
	m¢­_objeù
;

53 
	mv›w_ªtŸli£d
;

55 
	m»£t_toŞs_aá”_ü—‹
;

56 
	mundo_d•th
;

57 
	m»v”£_rubb”bªdšg_š‹r£ùs
;

58 
gušt
 
	m»ûÁ_docum’ts_li¡_size
;

60 
gch¬
* 
	mËngth_un™
;

61 
gch¬
* 
	mfÚtsize_un™
;

64 
	mvisibË
;

65 
	msŞid
;

66 } 
	m·geb»ak
;

68 
	m»nd”_boundšg_boxes
;

70 
	mtoŞbox_Ú_tİ
;

72 
DŸg¿mT»eCÚfig
 
	mdŸ_Œ“
;

74 
	mu£_š‹g¿‹d_ui
;

78 *
	m²g
;

79 *
	msvg
;

80 *
	mps
;

81 *
	mwmf
;

82 *
	memf
;

83 *
	m´št
;

84 } 
	mçvÜed_f‹r
;

87 
DŸP»ã»nûs
 
´efs
;

89 
´efs_show
();

90 
´efs_£t_deçuÉs
();

91 
´efs_§ve
();

92 
´efs_š™
();

	@O:\tool\dvs50\app\properties-dialog.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<gtk/gtk.h
>

24 
	~<gdk/gdkkeysyms.h
>

26 
	~"š.h
"

27 
	~"´İ”t›s-dŸlog.h
"

28 
	~"objeù_İs.h
"

29 
	~"cÚÃùiÚpošt_İs.h
"

30 
	~"undo.h
"

31 
	~"mes§ge.h
"

32 
	~<¡ršg.h
>

34 
GtkWidg‘
 *
	gdŸlog
 = 
NULL
;

35 
GtkWidg‘
 *
	gdŸlog_vbox
 = 
NULL
;

36 
GtkWidg‘
 *
	gobjeù_·¹
 = 
NULL
;

37 
GLi¡
 *
	gcu¼’t_objeùs
 = 
NULL
;

38 
DŸg¿m
 *
	gcu¼’t_dŸ
 = 
NULL
;

40 
GtkWidg‘
 *
	gno_´İ”t›s_dŸlog
 = 
NULL
;

42 
gšt
 
´İ”t›s_»¥Úd
(
GtkWidg‘
 *
widg‘
,

43 
gšt
 
»¥Ú£_id
,

44 
gpoš‹r
 
d©a
);

45 
gboŞ—n
 
´İ”t›s_key_ev’t
(
GtkWidg‘
 *
widg‘
,

46 
GdkEv’tKey
 *
ev’t
,

47 
gpoš‹r
 
d©a
);

48 
´İ”t›s_dŸlog_hide
();

50 
	$ü—‹_dŸlog
()

55 
dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(

56 
	`_
("Object…roperties"),

57 
	`GTK_WINDOW
 (
	`ddi¥Ïy_aùive
()->
sh–l
),

58 
GTK_DIALOG_DESTROY_WITH_PARENT
,

59 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

60 
GTK_STOCK_APPLY
, 
GTK_RESPONSE_APPLY
,

61 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,

62 
NULL
);

64 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
dŸlog
), 
GTK_RESPONSE_OK
);

66 
dŸlog_vbox
 = 
	`GTK_DIALOG
(
dŸlog
)->
vbox
;

68 
	`gtk_wšdow_£t_rŞe
(
	`GTK_WINDOW
 (
dŸlog
), "properties_window");

70 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
dŸlog
), "response",

71 
	`G_CALLBACK
 (
´İ”t›s_»¥Úd
), 
NULL
);

72 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
dŸlog
), "delete_event",

73 
	`G_CALLBACK
(
´İ”t›s_dŸlog_hide
), 
NULL
);

74 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
dŸlog
), "destroy",

75 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
dŸlog
);

76 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
dŸlog
), "destroy",

77 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
dŸlog_vbox
);

78 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
dŸlog
), "key-release-event",

79 
	`G_CALLBACK
(
´İ”t›s_key_ev’t
), 
NULL
);

81 
no_´İ”t›s_dŸlog
 = 
	`gtk_Ïb–_Ãw
(
	`_
("This object has‚o…roperties."));

82 
	`gtk_widg‘_show
 (
no_´İ”t›s_dŸlog
);

83 #ià
	`GLIB_CHECK_VERSION
(2,10,0)

84 
	`g_objeù_»f_sšk
 (
	`G_OBJECT
 (
no_´İ”t›s_dŸlog
));

86 
	`g_objeù_»f
 (
	`G_OBJECT
 (
no_´İ”t›s_dŸlog
));

87 
	`gtk_objeù_sšk
 (
	`GTK_OBJECT
 (
no_´İ”t›s_dŸlog
));

90 
	}
}

93 
gšt


94 
	$´İ”t›s_·¹_de¡royed
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

96 ià(
widg‘
 =ğ
objeù_·¹
)

98 
objeù_·¹
 = 
NULL
;

99 
cu¼’t_objeùs
 = 
NULL
;

100 
cu¼’t_dŸ
 = 
NULL
;

103 
	}
}

105 
gboŞ—n


106 
	$´İ”t›s_key_ev’t
(
GtkWidg‘
 *
widg‘
, 
GdkEv’tKey
 *
ev’t
, 
gpoš‹r
 
d©a
)

121  
FALSE
;

122 
	}
}

124 
gšt


125 
	$´İ”t›s_»¥Úd
(
GtkWidg‘
 *
widg‘
,

126 
gšt
 
»¥Ú£_id
,

127 
gpoš‹r
 
d©a
)

129 
ObjeùChªge
 *
obj_chªge
 = 
NULL
;

130 
gboŞ—n
 
£t_
 = 
TRUE
;

131 
GLi¡
 *
tmp
;

133 iàĞ
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


134 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
)

136 ià((
cu¼’t_objeùs
 !ğ
NULL
è&& (
cu¼’t_dŸ
 != NULL))

138 
	`objeù_add_upd©es_li¡
(
cu¼’t_objeùs
, 
cu¼’t_dŸ
);

140 
tmp
 = 
cu¼’t_objeùs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
)

142 
DŸObjeù
 *
cu¼’t_obj
 = (DŸObjeù*)
tmp
->
d©a
;

143 
obj_chªge
 = 
cu¼’t_obj
->
İs
->
	`­¶y_´İ”t›s_äom_dŸlog
(cu¼’t_obj, 
objeù_·¹
);

145 
	`objeù_add_upd©es
(
cu¼’t_obj
, 
cu¼’t_dŸ
);

146 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
cu¼’t_dŸ
, 
cu¼’t_obj
, 
TRUE
);

148 ià(
obj_chªge
 !ğ
NULL
)

150 
	`undo_objeù_chªge
(
cu¼’t_dŸ
, 
cu¼’t_obj
, 
obj_chªge
);

151 
£t_
 = s‘_ && 
TRUE
;

154 
£t_
 = 
FALSE
;

156 
	`dŸg¿m_objeù_modif›d
(
cu¼’t_dŸ
, 
cu¼’t_obj
);

159 
	`dŸg¿m_modif›d
(
cu¼’t_dŸ
);

160 
	`dŸg¿m_upd©e_ex‹Ás
(
cu¼’t_dŸ
);

162 ià(
£t_
)

164 
	`undo_£t_Œª§ùiÚpošt
(
cu¼’t_dŸ
->
undo
);

170 
	`undo_ş—r
(
cu¼’t_dŸ
->
undo
);

173 
	`dŸg¿m_æush
(
cu¼’t_dŸ
);

177 ià(
»¥Ú£_id
 !ğ
GTK_RESPONSE_APPLY
)

179 #ifdeà
G_OS_WIN32


182 
	`gtk_widg‘_de¡roy
 (
dŸlog
);

184 
	`´İ”t›s_dŸlog_hide
();

189 
	}
}

195 
	$´İ”t›s_give_focus
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

197 ià(
	`GTK_WIDGET_CAN_FOCUS
(
widg‘
))

199 
	`gtk_widg‘_g¿b_focus
(
widg‘
);

203 ià(
	`GTK_IS_CONTAINER
(
widg‘
))

205 
	`gtk_cÚš”_fÜ—ch
(
	`GTK_CONTAINER
(
widg‘
), 
´İ”t›s_give_focus
, 
d©a
);

208 
	}
}

211 
	$ş—r_dŸlog_glob®s
()

213 ià(
objeù_·¹
 !ğ
NULL
)

215 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
dŸlog_vbox
), 
objeù_·¹
);

216 
objeù_·¹
 = 
NULL
;

218 
	`g_li¡_ä“
(
cu¼’t_objeùs
);

219 
cu¼’t_objeùs
 = 
NULL
;

220 
cu¼’t_dŸ
 = 
NULL
;

221 
	}
}

224 
	$objeù_´İ”t›s_show
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
)

226 
GLi¡
 *
tmp
 = 
NULL
;

227 
tmp
 = 
	`g_li¡_­³nd
Ñmp, 
obj
);

228 
	`objeù_li¡_´İ”t›s_show
(
dŸ
, 
tmp
);

229 
	`g_li¡_ä“
(
tmp
);

230 
	}
}

233 
	$objeù_li¡_´İ”t›s_show
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
objeùs
)

235 
GtkWidg‘
 *
´İ”t›s
;

236 
DŸObjeù
 *
Úe_obj
;

237 ià(!
dŸlog
)

238 
	`ü—‹_dŸlog
();

239 
	`ş—r_dŸlog_glob®s
();

241 ià(!
objeùs
)

244 
	`´İ”t›s_dŸlog_hide
();

249 
Úe_obj
 = (
	`g_li¡_Ëngth
(
objeùs
è=ğ1è? objeùs->
d©a
 : 
NULL
;

251 ià(
Úe_obj
)

252 
´İ”t›s
 = 
Úe_obj
->
İs
->
	`g‘_´İ”t›s
(Úe_obj, 
FALSE
);

254 
´İ”t›s
 = 
	`objeù_li¡_ü—‹_´İs_dŸlog
(
Úe_obj
, 
FALSE
);

255 ià(
´İ”t›s
 =ğ
NULL
)

257 
´İ”t›s
 = 
no_´İ”t›s_dŸlog
;

260 ià(
Úe_obj
)

262 
DŸObjeùTy³
 *
Ùy³
 = 
Úe_obj
->
ty³
;

263 
gch¬
 *
buf
;

265 
buf
 = 
	`g_¡rcÚÿt
(
	`_
("Prİ”t›s: "), 
Ùy³
->
Çme
, 
NULL
);

266 
	`gtk_wšdow_£t_t™Ë
(
	`GTK_WINDOW
(
dŸlog
), 
	`gtk_widg‘_g‘_Çme
(
´İ”t›s
));

267 
	`g_ä“
(
buf
);

271 
	`gtk_wšdow_£t_t™Ë
(
	`GTK_WINDOW
(
dŸlog
),
	`gtk_widg‘_g‘_Çme
(
´İ”t›s
));

274 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
´İ”t›s
), "destroy",

275 
	`G_CALLBACK
(
´İ”t›s_·¹_de¡royed
), 
NULL
);

276 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
dŸlog_vbox
), 
´İ”t›s
, 
TRUE
, TRUE, 0);

278 
	`gtk_widg‘_show
 (
´İ”t›s
);

280 
	`´İ”t›s_give_focus
(
´İ”t›s
, 
NULL
);

284 
	`gtk_wšdow_»size
 (
	`GTK_WINDOW
(
dŸlog
), 1, 1);

285 
	`gtk_wšdow_£t_Œªs›Á_fÜ
(
	`GTK_WINDOW
(
dŸlog
),

286 
	`GTK_WINDOW
 (
	`ddi¥Ïy_aùive
()->
sh–l
));

287 
	`gtk_wšdow_´e£Á
 (
	`GTK_WINDOW
 (
dŸlog
));

288 
objeù_·¹
 = 
´İ”t›s
;

289 
cu¼’t_objeùs
 = 
	`g_li¡_cİy
(
objeùs
);

290 
cu¼’t_dŸ
 = 
dŸ
;

291 
	}
}

294 
	$´İ”t›s_dŸlog_hide
()

296 ià(!
dŸlog
)

298 
	`ş—r_dŸlog_glob®s
();

299 
	`gtk_widg‘_hide
(
dŸlog
);

300 
	}
}

303 
	$´İ”t›s_hide_if_shown
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
)

305 ià(
	`g_li¡_fšd
(
cu¼’t_objeùs
, 
obj
))

307 ià(
	`g_li¡_Ëngth
(
cu¼’t_objeùs
) == 1)

309 
	`´İ”t›s_dŸlog_hide
();

313 
GLi¡
 *
tmp
 = 
	`g_li¡_cİy
(
cu¼’t_objeùs
);

314 
tmp
 = 
	`g_li¡_»move
Ñmp, 
obj
);

315 
	`objeù_li¡_´İ”t›s_show
(
dŸ
, 
tmp
);

316 
	`g_li¡_ä“
(
tmp
);

319 
	}
}

322 
	$´İ”t›s_upd©e_if_shown
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
)

327 ià(
	`g_li¡_Ëngth
(
cu¼’t_objeùs
) != 1)

333 
	`objeù_´İ”t›s_show
(
dŸ
, (
DŸObjeù
*)
cu¼’t_objeùs
->
d©a
);

335 
	}
}

	@O:\tool\dvs50\app\properties-dialog.h

18 #iâdeà
PROPERTIES_H


19 
	#PROPERTIES_H


	)

21 
	~"objeù.h
"

22 
	~"dŸg¿m.h
"

24 
objeù_´İ”t›s_show
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
);

25 
objeù_li¡_´İ”t›s_show
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
objeùs
);

26 
´İ”t›s_upd©e_if_shown
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
);

27 
´İ”t›s_hide_if_shown
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
);

	@O:\tool\dvs50\app\recent_files.c

22 #ifdeà
HAVE_CONFIG_H


23 
	~<cÚfig.h
>

26 #ifdeà
GNOME


27 #undeà
GTK_DISABLE_DEPRECATED


28 
	~<gnome.h
>

30 
	~<gdk/gdkkeysyms.h
>

33 
	~<glib.h
>

34 
	~<gtk/gtk.h
>

35 
	~<¡dio.h
>

36 
	~<¡ršg.h
>

38 
	~"dŸ_dœs.h
"

39 
	~"»ûÁ_fes.h
"

40 
	~"m’us.h
"

41 
	~"dŸg¿m.h
"

42 
	~"di¥Ïy.h
"

43 
	~"š‹rçû.h
"

44 
	~"Ïy”_dŸlog.h
"

45 
	~"´eã»nûs.h
"

46 
	~"../lib/f‹r.h
"

47 
	~"../lib/š.h
"

48 
	~"mes§ge.h
"

49 
	~"³rsi¡’û.h
"

51 
İ’_»ûÁ_fe_ÿÎback
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
);

52 
»ûÁ_fe_hi¡Üy_»move
 (cÚ¡ *
âame
);

55 
	$»ûÁ_fe_hi¡Üy_ş—r_m’u
()

57 
	`m’us_ş—r_»ûÁ
 ();

58 
	}
}

64 
	$»ûÁ_fe_hi¡Üy_make_m’u
()

66 
GLi¡
 *
™ems
;

67 
GtkAùiÚGroup
 *
group
;

68 
GtkAùiÚ
 *
aùiÚ
;

69 
gšt
 
i
 = 0;

71 
™ems
 = 
	`³rsi¡’t_li¡_g‘_gli¡
 ("recent-files");

72 ià(!
™ems
)

75 
group
 = 
	`gtk_aùiÚ_group_Ãw
 ("recent-files");

76 
	`gtk_aùiÚ_group_£t_Œª¦©iÚ_domaš
 (
group
, 
NULL
);

78 
i
 = 0;

79 
™ems
 !ğ
NULL
 && 
i
 < 
´efs
.
»ûÁ_docum’ts_li¡_size
;

80 
™ems
 = 
	`g_li¡_Ãxt
(™ems), 
i
++) {

82 
gch¬
 *
Çme
 = 
	`g_¡rdup_´štf
 ("FeReûÁ_%d", 
i
);

83 
gch¬
 *
fe
 = 
	`g_·th_g‘_ba£Çme
 ((cÚ¡ gch¬ *è
™ems
->
d©a
);

84 
gch¬
 **
¥l™
 = 
	`g_¡r¥l™
 (
fe
, "_", -1);

85 
gch¬
 *
fe_esÿ³d
 = 
	`g_¡rjošv
 ("__", 
¥l™
);

86 
gch¬
 *
Ïb–
 = 
	`g_¡rdup_´štf
 ("_%d. %s", 
i
 + 1, 
fe_esÿ³d
);

87 
gch¬
 *
acûl
 = 
	`g_¡rdup_´štf
 ("<cÚŒŞ>%d", 
i
 + 1);

89 
aùiÚ
 = 
	`gtk_aùiÚ_Ãw
 (
Çme
, 
Ïb–
,

90 (cÚ¡ 
gch¬
 *è
™ems
->
d©a
,

91 
NULL
);

92 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
aùiÚ
), "activate",

93 
	`G_CALLBACK
 (
İ’_»ûÁ_fe_ÿÎback
),

94 
™ems
->
d©a
);

96 
	`gtk_aùiÚ_group_add_aùiÚ_w™h_acûl
 (
group
, 
aùiÚ
, 
acûl
);

98 
	`g_ä“
 (
Çme
);

99 
	`g_ä“
 (
fe
);

100 
	`g_¡rä“v
 (
¥l™
);

101 
	`g_ä“
 (
fe_esÿ³d
);

102 
	`g_ä“
 (
Ïb–
);

103 
	`g_ä“
 (
acûl
);

106 
	}
}

113 
	$»ûÁ_fe_hi¡Üy_add
(cÚ¡ *
âame
)

115 
gch¬
 *
ab¢ame
 = 
	`dŸ_g‘_absŞu‹_f’ame
(
âame
);

116 
gch¬
 *
f’ame
 = 
	`g_f’ame_to_utf8
(
ab¢ame
, -1, 
NULL
, NULL, NULL);

117 
	`»ûÁ_fe_hi¡Üy_ş—r_m’u
();

118 
	`³rsi¡’t_li¡_add
("»ûÁ-fes", 
f’ame
);

119 
	`g_ä“
(
ab¢ame
);

120 
	`g_ä“
(
f’ame
);

123 
	}
}

127 
	$»ûÁ_fe_hi¡Üy_š™
()

129 
´efs
.
»ûÁ_docum’ts_li¡_size
 = 
	`CLAMP
(prefs.recent_documents_list_size, 0, 16);

131 
	`³rsi¡’û_»gi¡”_li¡
("recent-files");

134 
	}
}

139 
	$»ûÁ_fe_hi¡Üy_»move
 (cÚ¡ *
âame
)

141 
gch¬
 *
ab¢ame
 = 
	`dŸ_g‘_absŞu‹_f’ame
(
âame
);

142 
gch¬
 *
f’ame
 = 
	`g_f’ame_to_utf8
(
ab¢ame
, -1, 
NULL
, NULL, NULL);

144 
	`»ûÁ_fe_hi¡Üy_ş—r_m’u
();

146 
	`³rsi¡’t_li¡_»move
("»ûÁ-fes", 
f’ame
);

147 
	`g_ä“
(
ab¢ame
);

148 
	`g_ä“
(
f’ame
);

151 
	}
}

154 
	$İ’_»ûÁ_fe_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

156 
DŸImpÜtF‹r
 *
if‹r
 = 
NULL
;

157 
DŸg¿m
 *
dŸg¿m
 = 
NULL
;

158 
gch¬
 *
f’ame
 = 
	`g_f’ame_äom_utf8
((gch¬ *)
d©a
, -1, 
NULL
, NULL, NULL);

160 
if‹r
 = 
	`f‹r_guess_impÜt_f‹r
(
f’ame
);

162 
dŸg¿m
 = 
	`dŸg¿m_lßd
(
f’ame
, 
if‹r
);

163 ià(
dŸg¿m
 !ğ
NULL
) {

164 
	`dŸg¿m_upd©e_ex‹Ás
(
dŸg¿m
);

165 
	`Ïy”_dŸlog_£t_dŸg¿m
(
dŸg¿m
);

166 ià(
dŸg¿m
->
di¥Ïys
 =ğ
NULL
) {

167 
	`Ãw_di¥Ïy
(
dŸg¿m
);

170 
	`»ûÁ_fe_hi¡Üy_»move
 (
f’ame
);

171 
	`g_ä“
(
f’ame
);

172 
	}
}

	@O:\tool\dvs50\app\recent_files.h

22 #iâdeà
RECENT_FILES_H


23 
	#RECENT_FILES_H


	)

25 
»ûÁ_fe_hi¡Üy_add
(cÚ¡ *
âame
);

26 
»ûÁ_fe_hi¡Üy_š™
();

	@O:\tool\dvs50\app\render_gdk.c

19 
	~<cÚfig.h
>

21 
	~<m©h.h
>

22 
	~<¡dlib.h
>

23 
	~<¡ršg.h
>

24 
	~<gdk/gdk.h
>

26 
	~"mes§ge.h
"

27 
	~"»nd”_gdk.h
"

28 
	~"dŸgdk»nd””.h
"

30 
ş_»giÚ_ş—r
(
DŸR’d””
 *
»nd””
);

31 
ş_»giÚ_add_»ù
(
DŸR’d””
 *
»nd””
,

32 
ReùªgË
 *
»ù
);

34 
d¿w_pix–_lše
(
DŸR’d””
 *
»nd””
,

35 
x1
, 
y1
,

36 
x2
, 
y2
,

37 
CŞÜ
 *
cŞÜ
);

38 
d¿w_pix–_»ù
(
DŸR’d””
 *
»nd””
,

39 
x
, 
y
,

40 
width
, 
height
,

41 
CŞÜ
 *
cŞÜ
);

42 
fl_pix–_»ù
(
DŸR’d””
 *
»nd””
,

43 
x
, 
y
,

44 
width
, 
height
,

45 
CŞÜ
 *
cŞÜ
);

46 
£t_size
 (
DŸR’d””
 *
»nd””
,

47 
gpoš‹r
 
wšdow
,

48 
width
, 
height
);

49 
cİy_to_wšdow
 (
DŸR’d””
 *
»nd””
,

50 
gpoš‹r
 
wšdow
,

51 
x
, 
y
, 
width
, 
height
);

53 
	$dŸ_gdk_»nd””_içû_š™
 (
DŸIÁ”aùiveR’d””IÁ”çû
* 
içû
)

55 
içû
->
ş_»giÚ_ş—r
 = clip_region_clear;

56 
içû
->
ş_»giÚ_add_»ù
 = clip_region_add_rect;

57 
içû
->
d¿w_pix–_lše
 = draw_pixel_line;

58 
içû
->
d¿w_pix–_»ù
 = draw_pixel_rect;

59 
içû
->
fl_pix–_»ù
 = fill_pixel_rect;

60 
içû
->
cİy_to_wšdow
 = copy_to_window;

61 
içû
->
£t_size
 = set_size;

62 
	}
}

64 
DŸR’d””
 *

65 
	$Ãw_gdk_»nd””
(
DDi¥Ïy
 *
ddi¥
)

67 
DŸGdkR’d””
 *
»nd””
;

68 
GTy³
 
»nd””_ty³
 = 0;

70 
»nd””
 = 
	`g_objeù_Ãw
 (
DIA_TYPE_GDK_RENDERER
, 
NULL
);

71 
»nd””
->
ŒªsfÜm
 = 
	`dŸ_ŒªsfÜm_Ãw
 (&
ddi¥
->
visibË
, &ddi¥->
zoom_çùÜ
);

72 ià(!
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
»nd””
))

74 cÚ¡ 
GIÁ”çûInfo
 
œ’d””_içû_šfo
 =

76 (
GIÁ”çûIn™Func
è
dŸ_gdk_»nd””_içû_š™
,

77 
NULL
,

78 
NULL


81 
»nd””_ty³
 = 
DIA_TYPE_GDK_RENDERER
;

83 
	`g_ty³_add_š‹rçû_¡©ic
 (
»nd””_ty³
,

84 
DIA_TYPE_INTERACTIVE_RENDERER_INTERFACE
,

85 &
œ’d””_içû_šfo
);

88 
»nd””
->
·»Á_š¡ªû
.
is_š‹¿ùive
 = 1;

89 
»nd””
->
gc
 = 
NULL
;

91 
»nd””
->
pixm­
 = 
NULL
;

92 
»nd””
->
ş_»giÚ
 = 
NULL
;

94  
	`DIA_RENDERER
(
»nd””
);

95 
	}
}

98 
	$£t_size
(
DŸR’d””
 *
objeù
, 
gpoš‹r
 
wšdow
,

99 
width
, 
height
)

101 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

103 ià(
»nd””
->
pixm­
 !ğ
NULL
)

104 
	`gdk_d¿wabË_uÄef
(
»nd””
->
pixm­
);

106 ià(
wšdow
)

107 
»nd””
->
pixm­
 = 
	`gdk_pixm­_Ãw
(
	`GDK_WINDOW
(
wšdow
), 
width
, 
height
, -1);

109 
»nd””
->
pixm­
 = 
	`gdk_pixm­_Ãw
(
NULL
, 
width
, 
height
, 24);

111 ià(
»nd””
->
gc
 =ğ
NULL
) {

112 
»nd””
->
gc
 = 
	`gdk_gc_Ãw
Ô’d””->
pixm­
);

114 
	`gdk_gc_£t_lše_©Œibu‹s
(
»nd””
->
gc
,

115 
»nd””
->
lše_width
,

116 
»nd””
->
lše_¡yË
,

117 
»nd””
->
ÿp_¡yË
,

118 
»nd””
->
još_¡yË
);

120 
	}
}

123 
	$cİy_to_wšdow
 (
DŸR’d””
 *
objeù
, 
gpoš‹r
 
wšdow
,

124 
x
, 
y
, 
width
, 
height
)

126 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

127 
GdkGC
 *
cİy_gc
 = 
NULL
;

129 ià(!
cİy_gc
)

130 
cİy_gc
 = 
	`gdk_gc_Ãw
(
wšdow
);

132 
	`gdk_d¿w_pixm­
 (
	`GDK_WINDOW
(
wšdow
),

133 
cİy_gc
,

134 
»nd””
->
pixm­
,

135 
x
, 
y
,

136 
x
, 
y
,

137 
width
, 
height
);

138 
	}
}

141 
	$ş_»giÚ_ş—r
(
DŸR’d””
 *
objeù
)

143 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

145 ià(
»nd””
->
ş_»giÚ
 !ğ
NULL
)

146 
	`gdk_»giÚ_de¡roy
(
»nd””
->
ş_»giÚ
);

148 
»nd””
->
ş_»giÚ
 = 
	`gdk_»giÚ_Ãw
();

150 
	`gdk_gc_£t_ş_»giÚ
(
»nd””
->
gc
,„’d””->
ş_»giÚ
);

151 
	}
}

154 
	$ş_»giÚ_add_»ù
(
DŸR’d””
 *
objeù
,

155 
ReùªgË
 *
»ù
)

157 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

158 
GdkReùªgË
 
ş_»ù
;

159 
x1
,
y1
;

160 
x2
,
y2
;

162 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
, 
»ù
->
Ëá
,„eù->
tİ
, &
x1
, &
y1
);

163 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
, 
»ù
->
right
,„eù->
bÙtom
, &
x2
, &
y2
);

165 
ş_»ù
.
x
 = 
x1
;

166 
ş_»ù
.
y
 = 
y1
;

167 
ş_»ù
.
width
 = 
x2
 - 
x1
 + 1;

168 
ş_»ù
.
height
 = 
y2
 - 
y1
 + 1;

170 
	`gdk_»giÚ_uniÚ_w™h_»ù
Ğ
»nd””
->
ş_»giÚ
, &
ş_»ù
 );

172 
	`gdk_gc_£t_ş_»giÚ
(
»nd””
->
gc
,„’d””->
ş_»giÚ
);

173 
	}
}

176 
	$d¿w_pix–_lše
(
DŸR’d””
 *
objeù
,

177 
x1
, 
y1
,

178 
x2
, 
y2
,

179 
CŞÜ
 *
cŞÜ
)

181 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

182 
GdkGC
 *
gc
 = 
»nd””
->gc;

183 
GdkCŞÜ
 
gdkcŞÜ
;

184 
rg‘_width
, 
rg‘_height
;

186 
	`dŸ_gdk_»nd””_£t_dashes
(
»nd””
, 
x1
+
y1
);

188 
	`gdk_d¿wabË_g‘_size
 (
	`GDK_DRAWABLE
 (
»nd””
->
pixm­
), &
rg‘_width
, &
rg‘_height
);

190 iàĞ(
x1
 < 0 && 
x2
 < 0)

191 || (
y1
 < 0 && 
y2
 < 0)

192 || (
x1
 > 
rg‘_width
 && 
x2
 >arget_width)

193 || (
y1
 > 
rg‘_height
 && 
y2
 >arget_height))

196 
	`cŞÜ_cÚv”t
(
cŞÜ
, &
gdkcŞÜ
);

197 
	`gdk_gc_£t_fÜeground
(
gc
, &
gdkcŞÜ
);

199 
	`gdk_d¿w_lše
(
»nd””
->
pixm­
, 
gc
, 
x1
, 
y1
, 
x2
, 
y2
);

200 
	}
}

203 
	$d¿w_pix–_»ù
(
DŸR’d””
 *
objeù
,

204 
x
, 
y
,

205 
width
, 
height
,

206 
CŞÜ
 *
cŞÜ
)

208 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

209 
GdkGC
 *
gc
 = 
»nd””
->gc;

210 
GdkCŞÜ
 
gdkcŞÜ
;

211 
rg‘_width
, 
rg‘_height
;

213 
	`dŸ_gdk_»nd””_£t_dashes
(
»nd””
, 
x
+
y
);

215 
	`gdk_d¿wabË_g‘_size
 (
	`GDK_DRAWABLE
 (
»nd””
->
pixm­
), &
rg‘_width
, &
rg‘_height
);

217 ià(
x
 + 
width
 < 0 || 
y
 + 
height
 < 0 || x > 
rg‘_width
 || y > 
rg‘_height
)

220 
	`cŞÜ_cÚv”t
(
cŞÜ
, &
gdkcŞÜ
);

221 
	`gdk_gc_£t_fÜeground
(
gc
, &
gdkcŞÜ
);

223 
	`gdk_d¿w_»ùªgË
 (
»nd””
->
pixm­
, 
gc
, 
FALSE
,

224 
x
, 
y
, 
width
, 
height
);

225 
	}
}

228 
	$fl_pix–_»ù
(
DŸR’d””
 *
objeù
,

229 
x
, 
y
,

230 
width
, 
height
,

231 
CŞÜ
 *
cŞÜ
)

233 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

234 
GdkGC
 *
gc
 = 
»nd””
->gc;

235 
GdkCŞÜ
 
gdkcŞÜ
;

236 
rg‘_width
, 
rg‘_height
;

238 
	`gdk_d¿wabË_g‘_size
 (
	`GDK_DRAWABLE
 (
»nd””
->
pixm­
), &
rg‘_width
, &
rg‘_height
);

240 ià(
x
 + 
width
 < 0 || 
y
 + 
height
 < 0 || x > 
rg‘_width
 || y > 
rg‘_height
)

243 
	`cŞÜ_cÚv”t
(
cŞÜ
, &
gdkcŞÜ
);

244 
	`gdk_gc_£t_fÜeground
(
gc
, &
gdkcŞÜ
);

246 
	`gdk_d¿w_»ùªgË
 (
»nd””
->
pixm­
, 
gc
, 
TRUE
,

247 
x
, 
y
, 
width
, 
height
);

248 
	}
}

	@O:\tool\dvs50\app\render_gdk.h

18 #iâdeà
RENDER_GDK_H


19 
	#RENDER_GDK_H


	)

21 
	~"di¥Ïy.h
"

23 
DŸR’d””
 *
Ãw_gdk_»nd””
(
DDi¥Ïy
 *
ddi¥
);

24 
gdk_»nd””_£t_size
(
DŸR’d””
 *
»nd””
, 
GdkWšdow
 *
wšdow
,

25 
width
, 
height
);

26 
»nd””_gdk_cİy_to_wšdow
(
DŸR’d””
 *
»nd””
,

27 
GdkWšdow
 *
wšdow
,

28 
x
, 
y
,

29 
width
, 
height
);

	@O:\tool\dvs50\app\scroll_tool.c

18 
	~<cÚfig.h
>

20 
	~"süŞl_toŞ.h
"

21 
	~"hªdË_İs.h
"

22 
	~"objeù_İs.h
"

23 
	~"cÚÃùiÚpošt_İs.h
"

24 
	~"mes§ge.h
"

25 
	~"cursÜ.h
"

27 
süŞl_bu‰Ú_´ess
(
SüŞlToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

28 
DDi¥Ïy
 *
ddi¥
);

29 
süŞl_bu‰Ú_»Ëa£
(
SüŞlToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

30 
DDi¥Ïy
 *
ddi¥
);

31 
süŞl_mÙiÚ
(
SüŞlToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

32 
DDi¥Ïy
 *
ddi¥
);

33 
süŞl_doubË_şick
(
SüŞlToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

34 
DDi¥Ïy
 *
ddi¥
);

36 
ToŞ
 *

37 
	$ü—‹_süŞl_toŞ
()

39 
SüŞlToŞ
 *
toŞ
;

41 
toŞ
 = 
	`g_Ãw0
(
SüŞlToŞ
, 1);

42 
toŞ
->toŞ.
ty³
 = 
SCROLL_TOOL
;

43 
toŞ
->toŞ.
bu‰Ú_´ess_func
 = (
Bu‰ÚP»ssFunc
è&
süŞl_bu‰Ú_´ess
;

44 
toŞ
->toŞ.
bu‰Ú_»Ëa£_func
 = (
Bu‰ÚR–—£Func
è&
süŞl_bu‰Ú_»Ëa£
;

45 
toŞ
->toŞ.
mÙiÚ_func
 = (
MÙiÚFunc
è&
süŞl_mÙiÚ
;

46 
toŞ
->toŞ.
doubË_şick_func
 = (
DoubËClickFunc
è&
süŞl_doubË_şick
;

48 
toŞ
->
süŞlšg
 = 
FALSE
;

49 
toŞ
->
u£_hªd
 = 
TRUE
;

51 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_GRAB
));

53  (
ToŞ
 *)
toŞ
;

54 
	}
}

57 
	$ä“_süŞl_toŞ
(
ToŞ
 *
toŞ
)

59 
	`g_ä“
(
toŞ
);

60 
	`ddi¥Ïy_£t_®l_cursÜ
(
deçuÉ_cursÜ
);

62 
	}
}

65 
	$süŞl_doubË_şick
(
SüŞlToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

66 
DDi¥Ïy
 *
ddi¥
)

69 
	}
}

72 
	$süŞl_bu‰Ú_´ess
(
SüŞlToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

73 
DDi¥Ïy
 *
ddi¥
)

75 
Pošt
 
şickedpošt
;

77 
toŞ
->
u£_hªd
 = (
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
) == 0;

78 ià(
toŞ
->
u£_hªd
)

79 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_GRABBING
));

81 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_SCROLL
));

83 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
,

84 ()
ev’t
->
x
, (ëv’t->
y
,

85 &
şickedpošt
.
x
, &şickedpošt.
y
);

87 
toŞ
->
süŞlšg
 = 
TRUE
;

88 
toŞ
->
Ï¡_pos
 = 
şickedpošt
;

89 
	}
}

95 
	$süŞl_mÙiÚ
(
SüŞlToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

96 
DDi¥Ïy
 *
ddi¥
)

98 
Pošt
 
to
;

99 
Pošt
 
d–
;

102 ià(!
toŞ
->
süŞlšg
) {

104 ià((
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
) == 0) {

105 ià(!
toŞ
->
u£_hªd
) {

106 
toŞ
->
u£_hªd
 = 
TRUE
;

107 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_GRAB
));

110 ià(
toŞ
->
u£_hªd
) {

111 
toŞ
->
u£_hªd
 = 
FALSE
;

112 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_SCROLL
));

117 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
, 
ev’t
->
x
,ƒv’t->
y
, &
to
.x, &to.y);

119 ià(
toŞ
->
u£_hªd
) {

120 
d–
 = 
toŞ
->
Ï¡_pos
;

121 
	`pošt_sub
(&
d–
, &
to
);

123 
toŞ
->
Ï¡_pos
 = 
to
;

124 
	`pošt_add
(&
toŞ
->
Ï¡_pos
, &
d–
);

127 
	`pošt_add
(&
d–
, &
ddi¥
->
Üigo
);

128 
	`ddi¥Ïy_£t_Üigo
(
ddi¥
, 
d–
.
x
, d–.
y
);

129 
	`ddi¥Ïy_upd©e_süŞlb¬s
(
ddi¥
);

130 
	`ddi¥Ïy_add_upd©e_®l
(
ddi¥
);

132 
d–
 = 
to
;

133 
	`pošt_sub
(&
d–
, &
toŞ
->
Ï¡_pos
);

134 
	`pošt_sÿË
(&
d–
, 0.5);

136 
	`ddi¥Ïy_süŞl
(
ddi¥
, &
d–
);

137 
toŞ
->
Ï¡_pos
 = 
to
;

139 
	`ddi¥Ïy_æush
(
ddi¥
);

140 
	}
}

144 
	$süŞl_bu‰Ú_»Ëa£
(
SüŞlToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

145 
DDi¥Ïy
 *
ddi¥
)

147 
toŞ
->
u£_hªd
 = (
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
) == 0;

148 ià(
toŞ
->
u£_hªd
) {

149 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_GRAB
));

151 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_SCROLL
));

153 
toŞ
->
süŞlšg
 = 
FALSE
;

154 
	}
}

	@O:\tool\dvs50\app\scroll_tool.h

18 #iâdeà
SCROLL_TOOL_H


19 
	#SCROLL_TOOL_H


	)

21 
	~"geom‘ry.h
"

22 
	~"toŞ.h
"

24 
_SüŞlToŞ
 
	tSüŞlToŞ
;

26 
	s_SüŞlToŞ
 {

27 
ToŞ
 
	mtoŞ
;

29 
	msüŞlšg
;

30 
	mu£_hªd
;

31 
Pošt
 
	mÏ¡_pos
;

34 
ToŞ
 *
ü—‹_süŞl_toŞ
();

35 
ä“_süŞl_toŞ
(
ToŞ
 *
toŞ
);

	@O:\tool\dvs50\app\select.c

20 
	~<cÚfig.h
>

22 
	~<as£¹.h
>

24 
	~"£Ëù.h
"

25 
	~"m’us.h
"

26 
	~"š.h
"

27 
	~"objeù_İs.h
"

28 
	~"‹x‹d™.h
"

30 
S–eùiÚStyË
 
	g£ËùiÚ_¡yË
 = 
SELECT_REPLACE
;

33 
	$£Ëù_®l_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

35 
DŸg¿m
 *
dŸ
;

36 
GLi¡
 *
objeùs
;

37 
DDi¥Ïy
 * 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

39 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

40 
dŸ
 = 
ddi¥
->
dŸg¿m
;

42 
objeùs
 = 
dŸ
->
d©a
->
aùive_Ïy”
->objects;

44 
objeùs
 !ğ
NULL
)

46 
DŸObjeù
 *
obj
 = (DŸObjeù *)
objeùs
->
d©a
;

48 ià(!
	`dŸg¿m_is_£Ëùed
(
dŸ
, 
obj
))

50 
	`dŸg¿m_£Ëù
(
dŸ
, 
obj
);

53 
objeùs
 = 
	`g_li¡_Ãxt
(objects);

56 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

57 
	`objeù_add_upd©es_li¡
(
dŸ
->
d©a
->
£Ëùed
, dia);

58 
	`dŸg¿m_æush
(
dŸ
);

59 
	}
}

62 
	$£Ëù_nÚe_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

64 
DŸg¿m
 * 
dŸ
;

65 
DDi¥Ïy
 * 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

67 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

68 
dŸ
 = 
ddi¥
->
dŸg¿m
;

70 
	`dŸg¿m_»move_®l_£Ëùed
(
dŸ
, 
TRUE
);

72 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

73 
	`objeù_add_upd©es_li¡
(
dŸ
->
d©a
->
£Ëùed
, dia);

74 
	`dŸg¿m_æush
(
dŸ
);

75 
	}
}

78 
	$£Ëù_šv”t_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

80 
DŸg¿m
 *
dŸ
;

81 
GLi¡
 *
tmp
;

82 
DDi¥Ïy
 * 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

84 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

85 
dŸ
 = 
ddi¥
->
dŸg¿m
;

87 
tmp
 = 
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
;

89 ; 
tmp
 !ğ
NULL
;m°ğ
	`g_li¡_Ãxt
(tmp))

91 
DŸObjeù
 *
obj
 = (DŸObjeù *)
tmp
->
d©a
;

93 ià(!
	`dŸg¿m_is_£Ëùed
(
dŸ
, 
obj
))

95 
	`dŸg¿m_£Ëù
(
dŸ
, 
obj
);

99 
	`dŸg¿m_un£Ëù_objeù
(
dŸ
, 
obj
);

103 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

104 
	`objeù_add_upd©es_li¡
(
dŸ
->
d©a
->
£Ëùed
, dia);

105 
	`dŸg¿m_æush
(
dŸ
);

107 
	}
}

113 
	$£Ëù_cÚÃùed_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

115 
DŸg¿m
 *
dŸ
;

116 
DDi¥Ïy
 * 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

117 
GLi¡
 *
objeùs
, *
tmp
;

119 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

120 
dŸ
 = 
ddi¥
->
dŸg¿m
;

122 
objeùs
 = 
dŸ
->
d©a
->
£Ëùed
;

124 
tmp
 = 
objeùs
;m°!ğ
NULL
;m°ğ
	`g_li¡_Ãxt
(tmp))

126 
DŸObjeù
 *
obj
 = (DŸObjeù *)
tmp
->
d©a
;

127 
i
;

129 
i
 = 0; i < 
obj
->
num_hªdËs
; i++)

131 
HªdË
 *
hªdË
 = 
obj
->
hªdËs
[
i
];

133 ià(
hªdË
->
cÚÃùed_to
 !ğ
NULL


134 && 
	`dŸ_objeù_is_£ËùabË
(
hªdË
->
cÚÃùed_to
->
objeù
)

135 && !
	`dŸg¿m_is_£Ëùed
(
dŸ
, 
hªdË
->
cÚÃùed_to
->
objeù
))

137 
	`dŸg¿m_£Ëù
(
dŸ
, 
hªdË
->
cÚÃùed_to
->
objeù
);

142 
tmp
 = 
objeùs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
)

144 
DŸObjeù
 *
obj
 = (DŸObjeù *)
tmp
->
d©a
;

145 
i
;

147 
i
 = 0; i < 
obj
->
num_cÚÃùiÚs
; i++)

149 
CÚÃùiÚPošt
 *
cÚÃùiÚ
 = 
obj
->
cÚÃùiÚs
[
i
];

150 
GLi¡
 *
cÚns
 = 
cÚÃùiÚ
->
cÚÃùed
;

152 ; 
cÚns
 !ğ
NULL
; cÚn ğ
	`g_li¡_Ãxt
(conns))

154 
DŸObjeù
 *
obj2
 = (DŸObjeù *)
cÚns
->
d©a
;

156 ià(
	`dŸ_objeù_is_£ËùabË
(
obj2
)

157 && !
	`dŸg¿m_is_£Ëùed
(
dŸ
, 
obj2
))

159 
	`dŸg¿m_£Ëù
(
dŸ
, 
obj2
);

165 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

166 
	`objeù_add_upd©es_li¡
(
dŸ
->
d©a
->
£Ëùed
, dia);

167 
	`dŸg¿m_æush
(
dŸ
);

168 
	}
}

171 
	$£Ëù_Œªs™iv–y
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
)

173 
i
;

175 
GLi¡
 *
Ãwly_£Ëùed
 = 
NULL
;

177 
i
 = 0; i < 
obj
->
num_hªdËs
; i++)

179 
HªdË
 *
hªdË
 = 
obj
->
hªdËs
[
i
];

181 ià(
hªdË
->
cÚÃùed_to
 !ğ
NULL
 &&

182 
	`dŸ_objeù_is_£ËùabË
(
hªdË
->
cÚÃùed_to
->
objeù
))

184 
DŸObjeù
 *
cÚÃùed_objeù
 = 
hªdË
->
cÚÃùed_to
->
objeù
;

185 ià(!
	`dŸg¿m_is_£Ëùed
(
dŸ
, 
cÚÃùed_objeù
))

187 
	`dŸg¿m_£Ëù
(
dŸ
, 
cÚÃùed_objeù
);

188 
Ãwly_£Ëùed
 = 
	`g_li¡_´•’d
Òewly_£Ëùed, 
cÚÃùed_objeù
);

193 
i
 = 0; i < 
obj
->
num_cÚÃùiÚs
; i++)

195 
CÚÃùiÚPošt
 *
cÚÃùiÚ
 = 
obj
->
cÚÃùiÚs
[
i
];

196 
GLi¡
 *
cÚns
 = 
cÚÃùiÚ
->
cÚÃùed
;

198 ; 
cÚns
 !ğ
NULL
; cÚn ğ
	`g_li¡_Ãxt
(conns))

200 
DŸObjeù
 *
obj2
 = (DŸObjeù *)
cÚns
->
d©a
;

202 ià(
	`dŸ_objeù_is_£ËùabË
(
obj2
è&& !
	`dŸg¿m_is_£Ëùed
(
dŸ
, obj2))

204 
	`dŸg¿m_£Ëù
(
dŸ
, 
obj2
);

205 
Ãwly_£Ëùed
 = 
	`g_li¡_´•’d
Òewly_£Ëùed, 
obj2
);

210 
Ãwly_£Ëùed
 !ğ
NULL
)

212 
	`£Ëù_Œªs™iv–y
(
dŸ
, (
DŸObjeù
 *)
Ãwly_£Ëùed
->
d©a
);

213 
Ãwly_£Ëùed
 = 
	`g_li¡_Ãxt
(newly_selected);

215 
	}
}

221 
	$£Ëù_Œªs™ive_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

223 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

224 
DŸg¿m
 *
dŸ
;

225 
GLi¡
 *
objeùs
, *
tmp
;

227 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

228 
dŸ
 = 
ddi¥
->
dŸg¿m
;

230 
objeùs
 = 
dŸ
->
d©a
->
£Ëùed
;

232 
tmp
 = 
objeùs
;m°!ğ
NULL
;m°ğ
	`g_li¡_Ãxt
(tmp))

234 
	`£Ëù_Œªs™iv–y
(
dŸ
, (
DŸObjeù
 *)
tmp
->
d©a
);

237 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

238 
	`objeù_add_upd©es_li¡
(
dŸ
->
d©a
->
£Ëùed
, dia);

239 
	`dŸg¿m_æush
(
dŸ
);

240 
	}
}

243 
	$£Ëù_§me_ty³_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

247 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

248 
DŸg¿m
 *
dŸ
;

249 
GLi¡
 *
objeùs
, *
tmp
, *
tmp2
;

251 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

252 
dŸ
 = 
ddi¥
->
dŸg¿m
;

254 
tmp
 = 
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
;

256 
objeùs
 = 
dŸ
->
d©a
->
£Ëùed
;

258 ; 
tmp
 !ğ
NULL
;m°ğ
	`g_li¡_Ãxt
(tmp))

260 
DŸObjeù
 *
obj
 = (DŸObjeù *)
tmp
->
d©a
;

262 ià(!
	`dŸg¿m_is_£Ëùed
(
dŸ
, 
obj
))

264 
tmp2
 = 
objeùs
;mp2 !ğ
NULL
;mp2 = 
	`g_li¡_Ãxt
(tmp2))

266 
DŸObjeù
 *
obj2
 = (DŸObjeù *)
tmp2
->
d©a
;

268 ià(
obj
->
ty³
 =ğ
obj2
->type)

270 
	`dŸg¿m_£Ëù
(
dŸ
, 
obj
);

277 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

278 
	`objeù_add_upd©es_li¡
(
dŸ
->
d©a
->
£Ëùed
, dia);

279 
	`dŸg¿m_æush
(
dŸ
);

280 
	}
}

283 
	$£Ëù_¡yË_ÿÎback
(
GtkAùiÚ
 *
aùiÚ
, 
GtkRadioAùiÚ
 *
cu¼’t
, 
gpoš‹r
 
u£r_d©a
)

285 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

286 ià(!
ddi¥
 || 
	`‹x‹d™_mode
(ddisp)) ;

289 
£ËùiÚ_¡yË
 = 
	`gtk_¿dio_aùiÚ_g‘_cu¼’t_v®ue
 (
cu¼’t
);

290 
	}
}

	@O:\tool\dvs50\app\select.h

18 #iâdeà
SELECT_H


19 
	#SELECT_H


	)

21 
	~"dŸg¿m.h
"

22 
	~"di¥Ïy.h
"

25 
	mSELECT_REPLACE
,

26 
	mSELECT_UNION
,

27 
	mSELECT_INTERSECTION
,

28 
	mSELECT_REMOVE
,

29 
	mSELECT_INVERT


30 } 
	tS–eùiÚStyË
;

32 
S–eùiÚStyË
 
£ËùiÚ_¡yË
;

34 
£Ëù_®l_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

35 
£Ëù_nÚe_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

36 
£Ëù_šv”t_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

37 
£Ëù_cÚÃùed_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

38 
£Ëù_Œªs™ive_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
*
widg‘
);

39 
£Ëù_§me_ty³_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
);

40 
£Ëù_¡yË_ÿÎback
(
GtkAùiÚ
 *
aùiÚ
, 
GtkRadioAùiÚ
 *
cu¼’t
, 
gpoš‹r
 
u£r_d©a
);

	@O:\tool\dvs50\app\sheets.c

23 
	~<¡ršg.h
>

25 #undeà
GTK_DISABLE_DEPRECATED


26 #ifdeà
GNOME


27 
	~<gnome.h
>

29 
	~<gtk/gtk.h
>

32 
	~<gdk-pixbuf/gdk-pixbuf.h
>

33 
	~<gmoduË.h
>

35 
	~"../lib/¶ug-šs.h
"

36 
	~"../lib/sh“t.h
"

37 
	~"../lib/mes§ge.h
"

38 
	~"../lib/objeù.h
"

39 
	~"../­p/pixm­s/missšg.xpm
"

41 
	~"š‹rçû.h
"

42 
	~"sh“ts.h
"

43 
	~"sh“ts_dŸlog.h
"

44 
	~"gtkhw¿pbox.h
"

46 
GtkWidg‘
 *
	gsh“ts_dŸlog
 = 
NULL
;

47 
GSLi¡
 *
	gsh“ts_mods_li¡
 = 
NULL
;

48 
GtkToŞts
 *
	gsh“ts_dŸlog_toŞts
 = 
NULL
;

49 
gpoš‹r
 
	gcu¡om_ty³_symbŞ
 = 
NULL
;

57 
Sh“tObjeùMod
 *

58 
	$sh“ts_­³nd_sh“t_objeù_mod
(
Sh“tObjeù
 *
so
, 
Sh“tMod
 *
sm
)

60 
Sh“tObjeùMod
 *
sh“t_objeù_mod
;

61 
DŸObjeùTy³
 *
Ù
;

63 
	`g_»tuº_v®_if_ç
 (
so
 !ğ
NULL
 && 
sm
 != NULL, NULL);

64 
	`g_»tuº_v®_if_ç
 (
cu¡om_ty³_symbŞ
 !ğ
NULL
, NULL);

66 
sh“t_objeù_mod
 = 
	`g_Ãw0
(
Sh“tObjeùMod
, 1);

67 
sh“t_objeù_mod
->
sh“t_objeù
 = *
so
;

68 
sh“t_objeù_mod
->
mod
 = 
SHEET_OBJECT_MOD_NONE
;

70 
Ù
 = 
	`objeù_g‘_ty³
(
so
->
objeù_ty³
);

71 
	`g_as£¹
(
Ù
);

72 ià(
Ù
->
İs
 =ğ((
DŸObjeùTy³
 *)(
cu¡om_ty³_symbŞ
))->ops)

73 
sh“t_objeù_mod
->
ty³
 = 
OBJECT_TYPE_SVG
;

75 
sh“t_objeù_mod
->
ty³
 = 
OBJECT_TYPE_PROGRAMMED
;

77 
sm
->
sh“t
.
objeùs
 = 
	`g_¦i¡_­³nd
(sm->sh“t.objeùs, 
sh“t_objeù_mod
);

79  
sh“t_objeù_mod
;

80 
	}
}

84 
Sh“tMod
 *

85 
	$sh“ts_­³nd_sh“t_mods
(
Sh“t
 *
sh“t
)

87 
Sh“tMod
 *
sh“t_mod
;

88 
GSLi¡
 *
sh“t_objeùs_li¡
;

90 
	`g_»tuº_v®_if_ç
 (
sh“t
 !ğ
NULL
, NULL);

92 
sh“t_mod
 = 
	`g_Ãw0
(
Sh“tMod
, 1);

93 
sh“t_mod
->
sh“t
 = *sheet;

94 
sh“t_mod
->
ty³
 = 
SHEETMOD_TYPE_NORMAL
;

95 
sh“t_mod
->
mod
 = 
SHEETMOD_MOD_NONE
;

96 
sh“t_mod
->
sh“t
.
objeùs
 = 
NULL
;

98 
sh“t_objeùs_li¡
 = 
sh“t
->
objeùs
; sheet_objects_list;

99 
sh“t_objeùs_li¡
 = 
	`g_¦i¡_Ãxt
(sheet_objects_list))

100 
	`sh“ts_­³nd_sh“t_objeù_mod
(
sh“t_objeùs_li¡
->
d©a
, 
sh“t_mod
);

102 
sh“ts_mods_li¡
 = 
	`g_¦i¡_­³nd
(sh“ts_mods_li¡, 
sh“t_mod
);

104  
sh“t_mod
;

105 
	}
}

107 
gšt


108 
	$m’u_™em_com·»_Ïb–s
(
gcÚ¡poš‹r
 
a
, gcÚ¡poš‹¸
b
)

110 
GLi¡
 *
a_li¡
;

111 
gch¬
 *
Ïb–
;

113 
a_li¡
 = 
	`gtk_cÚš”_g‘_chd»n
(
	`GTK_CONTAINER
(
	`GTK_MENU_ITEM
(
a
)));

114 
	`g_as£¹
(
	`g_li¡_Ëngth
(
a_li¡
) == 1);

116 
	`gtk_Ïb–_g‘
(
	`GTK_LABEL
(
a_li¡
->
d©a
), &
Ïb–
);

117 
	`g_li¡_ä“
(
a_li¡
);

119 ià(!
	`¡rcmp
(
Ïb–
, (
gch¬
 *)
b
))

123 
	}
}

126 
	$sh“ts_İtiÚm’u_ü—‹
(
GtkWidg‘
 *
İtiÚ_m’u
, GtkWidg‘ *
w¿pbox
,

127 
gch¬
 *
sh“t_Çme
)

129 
GtkWidg‘
 *
İtiÚm’u_m’u
;

130 
GSLi¡
 *
sh“ts_li¡
;

131 
GLi¡
 *
m’u_™em_li¡
;

135 
İtiÚm’u_m’u
 = 
	`gtk_İtiÚ_m’u_g‘_m’u
(
	`GTK_OPTION_MENU
(
İtiÚ_m’u
));

136 
	`gtk_cÚš”_fÜ—ch
(
	`GTK_CONTAINER
(
İtiÚm’u_m’u
),

137 (
GtkC®lback
)
gtk_widg‘_de¡roy
, 
NULL
);

139 ià(!
sh“ts_dŸlog_toŞts
)

140 
sh“ts_dŸlog_toŞts
 = 
	`gtk_toŞts_Ãw
();

142 
sh“ts_li¡
 = 
sh“ts_mods_li¡
; sheets_list;

143 
sh“ts_li¡
 = 
	`g_¦i¡_Ãxt
(sheets_list))

145 
Sh“tMod
 *
sh“t_mod
;

146 
GtkWidg‘
 *
m’u_™em
;

147 
gch¬
 *
t
;

149 
sh“t_mod
 = 
sh“ts_li¡
->
d©a
;

153 ià(
sh“t_mod
->
mod
 =ğ
SHEETMOD_MOD_DELETED
)

157 
m’u_™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
	`g‘‹xt
(
sh“t_mod
->
sh“t
.
Çme
));

159 
	`gtk_m’u_­³nd
(
	`GTK_MENU
(
İtiÚm’u_m’u
), 
m’u_™em
);

161 ià(
sh“t_mod
->
sh“t
.
scİe
 =ğ
SHEET_SCOPE_SYSTEM
)

162 
t
 = 
	`g_¡rdup_´štf
(
	`_
("%s\nSy¡em sh“t"), 
sh“t_mod
->
sh“t
.
desütiÚ
);

164 
t
 = 
	`g_¡rdup_´štf
(
	`_
("%s\nU£¸sh“t"), 
sh“t_mod
->
sh“t
.
desütiÚ
);

166 
	`gtk_toŞts_£t_t
(
	`GTK_TOOLTIPS
(
sh“ts_dŸlog_toŞts
), 
m’u_™em
, 
t
,

167 
NULL
);

168 
	`g_ä“
(
t
);

171 
	`gtk_widg‘_show
(
m’u_™em
);

173 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
m’u_™em
), "w¿pbox", 
w¿pbox
);

175 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
m’u_™em
), "activate",

176 
	`G_CALLBACK
(
Ú_sh“ts_dŸlog_İtiÚm’u_aùiv©e
),

177 (
gpoš‹r
)
sh“t_mod
);

180 
m’u_™em_li¡
 = 
	`gtk_cÚš”_g‘_chd»n
(
	`GTK_CONTAINER
(
İtiÚm’u_m’u
));

185 ià(
sh“t_Çme
)

187 
gšt
 
šdex
 = 0;

188 
GLi¡
 *
li¡
;

190 
li¡
 = 
	`g_li¡_fšd_cu¡om
(
m’u_™em_li¡
, 
sh“t_Çme
,

191 
m’u_™em_com·»_Ïb–s
);

192 ià(
li¡
)

193 
šdex
 = 
	`g_li¡_pos™iÚ
(
m’u_™em_li¡
, 
li¡
);

194 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
(
	`GTK_OPTION_MENU
(
İtiÚ_m’u
), 
šdex
);

195 
	`gtk_m’u_™em_aùiv©e
(
	`GTK_MENU_ITEM
(
	`g_li¡_Áh_d©a
(
m’u_™em_li¡
,

196 
šdex
)));

200 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
(
	`GTK_OPTION_MENU
(
İtiÚ_m’u
), 0);

201 
	`gtk_m’u_™em_aùiv©e
(
	`GTK_MENU_ITEM
(
m’u_™em_li¡
->
d©a
));

204 
	`g_li¡_ä“
(
m’u_™em_li¡
);

205 
	}
}

207 
gboŞ—n


208 
	$sh“ts_dŸlog_ü—‹
()

210 
GLi¡
 *
¶ugš_li¡
;

211 
GSLi¡
 *
sh“ts_li¡
;

212 
GtkWidg‘
 *
İtiÚ_m’u
;

213 
GtkWidg‘
 *
sw
;

214 
GtkWidg‘
 *
w¿pbox
;

215 
gch¬
 *
sh“t_Ëá
;

216 
gch¬
 *
sh“t_right
;

218 ià(
sh“ts_mods_li¡
)

223 
	`g_¦i¡_fÜ—ch
(
sh“ts_mods_li¡
, (
GFunc
)
g_ä“
, 
NULL
);

224 
	`g_¦i¡_ä“
(
sh“ts_mods_li¡
);

226 
sh“ts_mods_li¡
 = 
NULL
;

228 ià(
sh“ts_dŸlog
 =ğ
NULL
)

230 
sh“ts_dŸlog
 = 
	`ü—‹_sh“ts_maš_dŸlog
();

232 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
sh“ts_dŸlog
), "destroy",

233 
	`G_CALLBACK
 (
gtk_widg‘_de¡royed
),

234 &
sh“ts_dŸlog
);

235 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
sh“ts_dŸlog
), "destroy",

236 
	`G_CALLBACK
 (
gtk_widg‘_de¡royed
),

237 &
sh“ts_dŸlog_toŞts
);

239 
sh“t_Ëá
 = 
NULL
;

240 
sh“t_right
 = 
NULL
;

244 
İtiÚ_m’u
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "optionmenu_left");

245 
sh“t_Ëá
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
İtiÚ_m’u
),

248 
İtiÚ_m’u
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "optionmenu_right");

249 
sh“t_right
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
İtiÚ_m’u
),

252 
w¿pbox
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "wrapbox_left");

253 
	`gtk_widg‘_de¡roy
(
w¿pbox
);

255 
w¿pbox
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "wrapbox_right");

256 
	`gtk_widg‘_de¡roy
(
w¿pbox
);

259 ià(
cu¡om_ty³_symbŞ
 =ğ
NULL
)

264 
cu¡om_ty³_symbŞ
 = 
NULL
;

265 
¶ugš_li¡
 = 
	`dŸ_li¡_¶ugšs
();…lugš_li¡ !ğ
NULL
;

266 
¶ugš_li¡
 = 
	`g_li¡_Ãxt
(plugin_list))

268 
PlugšInfo
 *
šfo
 = 
¶ugš_li¡
->
d©a
;

270 
cu¡om_ty³_symbŞ
 = (
gpoš‹r
)
	`dŸ_¶ugš_g‘_symbŞ
 (
šfo
,"custom_type");

271 ià(
cu¡om_ty³_symbŞ
)

276 ià(!
cu¡om_ty³_symbŞ
)

278 
	`mes§ge_w¬nšg
 (
	`_
("Can't get symbol 'custom_type' from‡ny module.\n"

280  
FALSE
;

283 
sh“ts_li¡
 = 
	`g‘_sh“ts_li¡
(); sheets_list;

284 
sh“ts_li¡
 = 
	`g_¦i¡_Ãxt
(sheets_list))

285 
	`sh“ts_­³nd_sh“t_mods
(
sh“ts_li¡
->
d©a
);

287 
sw
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "scrolledwindow_right");

288 
w¿pbox
 = 
	`gtk_hw¿p_box_Ãw
(
FALSE
);

289 
	`gtk_widg‘_»f
(
w¿pbox
);

290 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
sh“ts_dŸlog
), "w¿pbox_right", 
w¿pbox
);

291 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
(
	`GTK_SCROLLED_WINDOW
(
sw
), 
w¿pbox
);

292 
	`gtk_w¿p_box_£t_ju¡ify
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
GTK_JUSTIFY_TOP
);

293 
	`gtk_w¿p_box_£t_lše_ju¡ify
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
GTK_JUSTIFY_LEFT
);

294 
	`gtk_widg‘_show
(
w¿pbox
);

295 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "is_Ëá", 
FALSE
);

296 
İtiÚ_m’u
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "optionmenu_right");

297 
	`sh“ts_İtiÚm’u_ü—‹
(
İtiÚ_m’u
, 
w¿pbox
, 
sh“t_right
);

299 
sw
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "scrolledwindow_left");

300 
w¿pbox
 = 
	`gtk_hw¿p_box_Ãw
(
FALSE
);

301 
	`gtk_widg‘_»f
(
w¿pbox
);

302 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
sh“ts_dŸlog
), "w¿pbox_Ëá", 
w¿pbox
);

303 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
(
	`GTK_SCROLLED_WINDOW
(
sw
), 
w¿pbox
);

304 
	`gtk_w¿p_box_£t_ju¡ify
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
GTK_JUSTIFY_TOP
);

305 
	`gtk_w¿p_box_£t_lše_ju¡ify
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
GTK_JUSTIFY_LEFT
);

306 
	`gtk_widg‘_show
(
w¿pbox
);

307 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "is_Ëá", (
gpoš‹r
)
TRUE
);

308 
İtiÚ_m’u
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "optionmenu_left");

309 
	`sh“ts_İtiÚm’u_ü—‹
(
İtiÚ_m’u
, 
w¿pbox
, 
sh“t_Ëá
);

311  
TRUE
;

312 
	}
}

315 
	$ü—‹_objeù_pixm­
(
Sh“tObjeù
 *
so
, 
GtkWidg‘
 *
·»Á
,

316 
GdkPixm­
 **
pixm­
, 
GdkB™m­
 **
mask
)

318 
GtkStyË
 *
¡yË
;

320 
	`g_as£¹
(
so
);

321 
	`g_as£¹
(
pixm­
);

322 
	`g_as£¹
(
mask
);

324 
¡yË
 = 
	`gtk_widg‘_g‘_¡yË
(
·»Á
);

326 ià(
so
->
pixm­
 !ğ
NULL
)

328 *
pixm­
 =

329 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

330 
	`gtk_widg‘_g‘_cŞÜm­
(
·»Á
),

331 
mask
,

332 &
¡yË
->
bg
[
GTK_STATE_NORMAL
],

333 
so
->
pixm­
);

337 ià(
so
->
pixm­_fe
 !ğ
NULL
)

339 
GdkPixbuf
 *
pixbuf
;

340 
GE¼Ü
 *
”rÜ
 = 
NULL
;

342 
pixbuf
 = 
	`gdk_pixbuf_Ãw_äom_fe
(
so
->
pixm­_fe
, &
”rÜ
);

343 ià(
pixbuf
 !ğ
NULL
)

345 
width
 = 
	`gdk_pixbuf_g‘_width
 (
pixbuf
);

346 
height
 = 
	`gdk_pixbuf_g‘_height
 (
pixbuf
);

347 ià(
width
 > 22)

349 
GdkPixbuf
 *
üİ³d
;

350 
	`g_w¬nšg
 ("Sh­icÚ '%s' sizwrÚg, crİ³d.", 
so
->
pixm­_fe
);

351 
üİ³d
 = 
	`gdk_pixbuf_Ãw_subpixbuf
 (
pixbuf
,

352 (
width
 - 22è/ 2, 
height
 > 22 ? (height - 22) / 2 : 0,

353 22, 
height
 > 22 ? 22 : height);

354 
	`g_objeù_uÄef
 (
pixbuf
);

355 
pixbuf
 = 
üİ³d
;

357 
	`gdk_pixbuf_»nd”_pixm­_ªd_mask
(
pixbuf
, 
pixm­
, 
mask
, 1.0);

358 
	`gdk_pixbuf_uÄef
(
pixbuf
);

362 
	`mes§ge_w¬nšg
 ("%s", 
”rÜ
->
mes§ge
);

363 
	`g_”rÜ_ä“
 (
”rÜ
);

364 *
pixm­
 = 
gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d


365 (
NULL
,

366 
	`gtk_widg‘_g‘_cŞÜm­
(
·»Á
),

367 
mask
,

368 &
¡yË
->
bg
[
GTK_STATE_NORMAL
],

369 
missšg
);

374 *
pixm­
 = 
NULL
;

375 *
mask
 = 
NULL
;

378 
	}
}

380 
GtkWidg‘
*

381 
	$lookup_widg‘
 (
GtkWidg‘
 *
widg‘
,

382 cÚ¡ 
gch¬
 *
widg‘_Çme
)

384 
GtkWidg‘
 *
·»Á
, *
found_widg‘
;

388 ià(
	`GTK_IS_MENU
 (
widg‘
))

389 
·»Á
 = 
	`gtk_m’u_g‘_©ch_widg‘
 (
	`GTK_MENU
 (
widg‘
));

391 
·»Á
 = 
widg‘
->parent;

392 ià(
·»Á
 =ğ
NULL
)

394 
widg‘
 = 
·»Á
;

397 
found_widg‘
 = (
GtkWidg‘
*è
	`gtk_objeù_g‘_d©a
 (
	`GTK_OBJECT
 (
widg‘
),

398 
widg‘_Çme
);

399 ià(!
found_widg‘
)

400 
	`g_w¬nšg
 (
	`_
("Widg‘‚Ù found: %s"), 
widg‘_Çme
);

401  
found_widg‘
;

402 
	}
}

404 
	~"pixm­s/n_a.xpm
"

405 
	~"pixm­s/lše_b»ak.xpm
"

410 
GtkWidg‘
 *

411 
	$ü—‹_pixm­
(
GtkWidg‘
 *
dŸlog
, 
gch¬
 *
f’ame
, 
gboŞ—n
 
¬g3
)

413 
GdkPixm­
 *
pixm­
, *
mask
;

414 
GtkWidg‘
 *
bu‰Ú
;

415 
GtkWidg‘
 *
w¿pbox
;

416 
GLi¡
 *
bu‰Ú_li¡
;

417 
Sh“tObjeùMod
 *
som
;

419 
bu‰Ú
 = 
	`sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

420 
som
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
bu‰Ú
), "sheet_object_mod");

422 ià(
som
)

423 
	`ü—‹_objeù_pixm­
(&
som
->
sh“t_objeù
, 
w¿pbox
, &
pixm­
, &
mask
);

426 
GtkStyË
 *
¡yË
;

427 
gch¬
 **
icÚ
;

429 
¡yË
 = 
	`gtk_widg‘_g‘_¡yË
(
w¿pbox
);

431 ià((
gboŞ—n
)
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
bu‰Ú
), "is_hidden_button")

432 =ğ
TRUE
)

433 
icÚ
 = 
n_a_xpm
;

435 
icÚ
 = 
lše_b»ak_xpm
;

437 
pixm­
 =

438 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

439 
	`gtk_widg‘_g‘_cŞÜm­
(
w¿pbox
),

440 &
mask
,

441 &
¡yË
->
bg
[
GTK_STATE_NORMAL
],

442 
icÚ
);

445  
	`gtk_pixm­_Ãw
(
pixm­
, 
mask
);

446 
	}
}

451 
	$sh“ts_dŸlog_show_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
, 
GtkWidg‘
 *
widg‘
)

453 
GtkWidg‘
 *
w¿pbox
;

454 
GtkWidg‘
 *
İtiÚ_m’u
;

456 ià(!
sh“ts_dŸlog
)

457 
	`sh“ts_dŸlog_ü—‹
();

458 ià(!
sh“ts_dŸlog
)

461 
w¿pbox
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
sh“ts_dŸlog
), "wrapbox_left");

462 
İtiÚ_m’u
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "optionmenu_left");

463 
	`sh“ts_İtiÚm’u_ü—‹
(
İtiÚ_m’u
, 
w¿pbox
, 
š‹rçû_cu¼’t_sh“t_Çme
);

465 
	`g_as£¹
(
	`GTK_IS_WIDGET
(
sh“ts_dŸlog
));

466 
	`gtk_widg‘_show
(
sh“ts_dŸlog
);

467 
	}
}

469 
gch¬
 *

470 
	$sh“t_objeù_mod_g‘_ty³_¡ršg
(
Sh“tObjeùMod
 *
som
)

472 
som
->
ty³
)

474 
OBJECT_TYPE_SVG
:

475  
	`_
("SVG Shape");

476 
OBJECT_TYPE_PROGRAMMED
:

477  
	`_
("Programmed DiaObject");

479 
	`g_as£¹_nÙ_»ached
();

482 
	}
}

	@O:\tool\dvs50\app\sheets.h

23 #iâdeà
SHEETS_H


25 #ifdeà
GNOME


26 
	~<gnome.h
>

28 
	~<gtk/gtk.h
>

31 
	~"../lib/sh“t.h
"

33 
	~"sh“ts_dŸlog_ÿÎbacks.h
"

41 
_Sh“tObjeùMod
 
	tSh“tObjeùMod
;

42 
_Sh“tMod
 
	tSh“tMod
;

44 
	s_Sh“tObjeùMod


46 
Sh“tObjeù
 
	msh“t_objeù
;

48 ’um { 
	mOBJECT_TYPE_SVG
,

49 
	mOBJECT_TYPE_PROGRAMMED
,

50 
	mOBJECT_TYPE_UNASSIGNED
 } 
	mty³
;

52 ’um { 
	mSHEET_OBJECT_MOD_NONE
,

53 
	mSHEET_OBJECT_MOD_NEW
,

54 
	mSHEET_OBJECT_MOD_CHANGED
,

55 
	mSHEET_OBJECT_MOD_DELETED
 } 
	mmod
;

57 
gch¬
 *
	msvg_f’ame
;

60 
	s_Sh“tMod


62 
Sh“t
 
	msh“t
;

64 ’um { 
	mSHEETMOD_TYPE_NORMAL
,

65 
	mSHEETMOD_TYPE_UNASSIGNED
 } 
	mty³
;

67 ’um { 
	mSHEETMOD_MOD_NONE
,

68 
	mSHEETMOD_MOD_NEW
,

69 
	mSHEETMOD_MOD_CHANGED
,

70 
	mSHEETMOD_MOD_DELETED
 } 
	mmod
;

73 
GtkWidg‘
 *
sh“ts_dŸlog
;

74 
GtkWidg‘
 *
sh“ts_dŸlog_İtiÚm’u_m’u
;

75 #iâdeà
GTK_DISABLE_DEPRECATED


76 
GtkToŞts
 *
sh“ts_dŸlog_toŞts
;

79 
Sh“tObjeùMod
 *
sh“ts_­³nd_sh“t_objeù_mod
(
Sh“tObjeù
 *
so
, 
Sh“tMod
 *
sm
);

80 
Sh“tMod
 *
sh“ts_­³nd_sh“t_mods
(
Sh“t
 *
sh“t
);

81 
sh“ts_İtiÚm’u_ü—‹
(
GtkWidg‘
 *
İtiÚ_m’u
, GtkWidg‘ *
w¿pbox
,

82 
gch¬
 *
sh“t_Çme
);

83 
ü—‹_objeù_pixm­
(
Sh“tObjeù
 *
so
, 
GtkWidg‘
 *
·»Á
,

84 
GdkPixm­
 **
pixm­
, 
GdkB™m­
 **
mask
);

86 
gch¬
 *
sh“t_objeù_mod_g‘_ty³_¡ršg
(
Sh“tObjeùMod
 *
som
);

88 
gboŞ—n
 
sh“ts_dŸlog_ü—‹
();

89 
sh“ts_dŸlog_show_ÿÎback
(
gpoš‹r
 
d©a
, 
gušt
 
aùiÚ
,

90 
GtkWidg‘
 *
widg‘
);

91 
GtkWidg‘
 *
lookup_widg‘
(GtkWidg‘ *
widg‘
,

92 cÚ¡ 
gch¬
 *
widg‘_Çme
);

93 
GtkWidg‘
 *
ü—‹_pixm­
(GtkWidg‘ *
dŸlog
, 
gch¬
 *
f’ame
, 
gboŞ—n
 
¬g3
);

	@O:\tool\dvs50\app\sheets_dialog.c

29 #ifdeà
HAVE_CONFIG_H


30 
	~<cÚfig.h
>

33 
	~<sys/ty³s.h
>

34 #ifdeà
HAVE_UNISTD_H


35 
	~<uni¡d.h
>

37 
	~<¡ršg.h
>

39 #undeà
GTK_DISABLE_DEPRECATED


40 
	~<gtk/gtk.h
>

41 
	~<gdk/gdkkeysyms.h
>

43 
	~"sh“ts.h
"

44 
	~"sh“ts_dŸlog_ÿÎbacks.h
"

45 
	~"sh“ts_dŸlog.h
"

47 
	~"š.h
"

48 
	~"³rsi¡’û.h
"

50 
GtkWidg‘
*

51 
	$ü—‹_sh“ts_maš_dŸlog
 ()

53 
GtkWidg‘
 *
sh“ts_maš_dŸlog
;

54 
GtkWidg‘
 *
dŸlog_vbox1
;

55 
GtkWidg‘
 *
bË_sh“ts
;

56 
GtkWidg‘
 *
vbu‰Úbox
;

57 
GtkWidg‘
 *
bu‰Ú_cİy
;

58 
GtkWidg‘
 *
bu‰Ú_cİy_®l
;

59 
GtkWidg‘
 *
bu‰Ú_move
;

60 
GtkWidg‘
 *
bu‰Ú_move_®l
;

61 
GtkWidg‘
 *
İtiÚm’u_right
;

62 
GtkWidg‘
 *
İtiÚm’u_right_m’u
;

63 
GtkWidg‘
 *
İtiÚm’u_Ëá
;

64 
GtkWidg‘
 *
İtiÚm’u_Ëá_m’u
;

65 
GtkWidg‘
 *
gÏde_m’u™em
;

66 
GtkWidg‘
 *
süŞËdwšdow_Ëá
;

67 
GtkWidg‘
 *
süŞËdwšdow_right
;

68 
GtkWidg‘
 *
dŸlog_aùiÚ_¬—1
;

69 
GtkWidg‘
 *
hbox1
;

70 
GtkWidg‘
 *
bu‰Ú_Ãw
;

71 
GtkWidg‘
 *
bu‰Ú_move_up
;

72 
GtkWidg‘
 *
bu‰Ú_move_down
;

73 
GtkWidg‘
 *
bu‰Ú_ed™
;

74 
GtkWidg‘
 *
bu‰Ú_»move
;

75 
GtkWidg‘
 *
bu‰Ú_­¶y
;

76 
GtkWidg‘
 *
bu‰Ú_»v”t
;

77 
GtkWidg‘
 *
bu‰Ú_şo£
;

78 
GtkAcûlGroup
 *
acûl_group
;

80 
acûl_group
 = 
	`gtk_acûl_group_Ãw
 ();

82 
sh“ts_maš_dŸlog
 = 
	`gtk_dŸlog_Ãw
 ();

83 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "sheets_main_dialog", sheets_main_dialog);

84 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
sh“ts_maš_dŸlog
), 
	`_
("Sheets‡nd Objects"));

85 
	`gtk_wšdow_£t_rŞe
(
	`GTK_WINDOW
(
sh“ts_maš_dŸlog
), "sheets_main_dialog");

86 
	`gtk_wšdow_£t_deçuÉ_size
 (
	`GTK_WINDOW
 (
sh“ts_maš_dŸlog
), 506, 261);

87 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
sh“ts_maš_dŸlog
), 
TRUE
);

89 
dŸlog_vbox1
 = 
	`GTK_DIALOG
 (
sh“ts_maš_dŸlog
)->
vbox
;

90 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "dŸlog_vbox1", 
dŸlog_vbox1
);

91 
	`gtk_widg‘_show
 (
dŸlog_vbox1
);

93 
bË_sh“ts
 = 
	`gtk_bË_Ãw
 (2, 3, 
FALSE
);

94 
	`gtk_widg‘_»f
 (
bË_sh“ts
);

95 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bË_sh“ts", 
bË_sh“ts
,

96 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

97 
	`gtk_widg‘_show
 (
bË_sh“ts
);

98 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
dŸlog_vbox1
), 
bË_sh“ts
, 
TRUE
, TRUE, 0);

100 
vbu‰Úbox
 = 
	`gtk_vbu‰Ú_box_Ãw
 ();

101 
	`gtk_widg‘_»f
 (
vbu‰Úbox
);

102 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "vbu‰Úbox", 
vbu‰Úbox
,

103 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

104 
	`gtk_widg‘_show
 (
vbu‰Úbox
);

105 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË_sh“ts
), 
vbu‰Úbox
, 1, 2, 1, 2,

106 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

107 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
), 17, 0);

108 
	`gtk_bu‰Ú_box_£t_Ïyout
 (
	`GTK_BUTTON_BOX
 (
vbu‰Úbox
), 
GTK_BUTTONBOX_SPREAD
);

110 
bu‰Ú_cİy
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
 (
	`_
("<- Copy"));

111 
	`gtk_widg‘_»f
 (
bu‰Ú_cİy
);

112 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_cİy", 
bu‰Ú_cİy
,

113 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

114 
	`gtk_widg‘_show
 (
bu‰Ú_cİy
);

115 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
vbu‰Úbox
), 
bu‰Ú_cİy
);

116 
	`gtk_widg‘_add_acûË¿tÜ
 (
bu‰Ú_cİy
, "şicked", 
acûl_group
,

117 
GDK_c
, 
GDK_CONTROL_MASK
,

118 
GTK_ACCEL_VISIBLE
);

120 
bu‰Ú_cİy_®l
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
 (
	`_
("<- Copy All"));

121 
	`gtk_widg‘_»f
 (
bu‰Ú_cİy_®l
);

122 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_cİy_®l", 
bu‰Ú_cİy_®l
,

123 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

124 
	`gtk_widg‘_show
 (
bu‰Ú_cİy_®l
);

125 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
vbu‰Úbox
), 
bu‰Ú_cİy_®l
);

127 
bu‰Ú_move
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
 (
	`_
("<- Move"));

128 
	`gtk_widg‘_»f
 (
bu‰Ú_move
);

129 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_move", 
bu‰Ú_move
,

130 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

131 
	`gtk_widg‘_show
 (
bu‰Ú_move
);

132 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
vbu‰Úbox
), 
bu‰Ú_move
);

133 
	`gtk_widg‘_add_acûË¿tÜ
 (
bu‰Ú_move
, "şicked", 
acûl_group
,

134 
GDK_m
, 
GDK_CONTROL_MASK
,

135 
GTK_ACCEL_VISIBLE
);

137 
bu‰Ú_move_®l
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
 (
	`_
("<- Move All"));

138 
	`gtk_widg‘_»f
 (
bu‰Ú_move_®l
);

139 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_move_®l", 
bu‰Ú_move_®l
,

140 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

141 
	`gtk_widg‘_show
 (
bu‰Ú_move_®l
);

142 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
vbu‰Úbox
), 
bu‰Ú_move_®l
);

144 
İtiÚm’u_right
 = 
	`gtk_İtiÚ_m’u_Ãw
 ();

145 
	`gtk_widg‘_»f
 (
İtiÚm’u_right
);

146 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "İtiÚm’u_right", 
İtiÚm’u_right
,

147 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

148 
	`gtk_widg‘_show
 (
İtiÚm’u_right
);

149 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË_sh“ts
), 
İtiÚm’u_right
, 2, 3, 0, 1,

150 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

151 (
GtkA‰achO±iÚs
è(
GTK_FILL
), 0, 0);

152 
İtiÚm’u_right_m’u
 = 
	`gtk_m’u_Ãw
 ();

153 
	`gtk_İtiÚ_m’u_£t_m’u
 (
	`GTK_OPTION_MENU
 (
İtiÚm’u_right
), 
İtiÚm’u_right_m’u
);

155 
İtiÚm’u_Ëá
 = 
	`gtk_İtiÚ_m’u_Ãw
 ();

156 
	`gtk_widg‘_»f
 (
İtiÚm’u_Ëá
);

157 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "İtiÚm’u_Ëá", 
İtiÚm’u_Ëá
,

158 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

159 
	`gtk_widg‘_show
 (
İtiÚm’u_Ëá
);

160 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË_sh“ts
), 
İtiÚm’u_Ëá
, 0, 1, 0, 1,

161 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

162 (
GtkA‰achO±iÚs
è(
GTK_FILL
), 0, 0);

163 
İtiÚm’u_Ëá_m’u
 = 
	`gtk_m’u_Ãw
 ();

164 
gÏde_m’u™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
 ("");

165 
	`gtk_widg‘_show
 (
gÏde_m’u™em
);

166 
	`gtk_m’u_­³nd
 (
	`GTK_MENU
 (
İtiÚm’u_Ëá_m’u
), 
gÏde_m’u™em
);

167 
	`gtk_İtiÚ_m’u_£t_m’u
 (
	`GTK_OPTION_MENU
 (
İtiÚm’u_Ëá
), 
İtiÚm’u_Ëá_m’u
);

169 
süŞËdwšdow_Ëá
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
, NULL);

170 
	`gtk_widg‘_»f
 (
süŞËdwšdow_Ëá
);

171 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "süŞËdwšdow_Ëá", 
süŞËdwšdow_Ëá
,

172 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

173 
	`gtk_widg‘_show
 (
süŞËdwšdow_Ëá
);

174 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË_sh“ts
), 
süŞËdwšdow_Ëá
, 0, 1, 1, 2,

175 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

176 (
GtkA‰achO±iÚs
è(
GTK_FILL
), 0, 0);

177 
	`gtk_süŞËd_wšdow_£t_pŞicy
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËdwšdow_Ëá
), 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

179 
süŞËdwšdow_right
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
, NULL);

180 
	`gtk_widg‘_»f
 (
süŞËdwšdow_right
);

181 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "süŞËdwšdow_right", 
süŞËdwšdow_right
,

182 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

183 
	`gtk_widg‘_show
 (
süŞËdwšdow_right
);

184 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË_sh“ts
), 
süŞËdwšdow_right
, 2, 3, 1, 2,

185 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

186 (
GtkA‰achO±iÚs
è(
GTK_FILL
), 0, 0);

187 
	`gtk_süŞËd_wšdow_£t_pŞicy
 (
	`GTK_SCROLLED_WINDOW
 (
süŞËdwšdow_right
), 
GTK_POLICY_AUTOMATIC
, GTK_POLICY_AUTOMATIC);

189 
dŸlog_aùiÚ_¬—1
 = 
	`GTK_DIALOG
 (
sh“ts_maš_dŸlog
)->
aùiÚ_¬—
;

190 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "dŸlog_aùiÚ_¬—1", 
dŸlog_aùiÚ_¬—1
);

191 
	`gtk_widg‘_show
 (
dŸlog_aùiÚ_¬—1
);

192 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
dŸlog_aùiÚ_¬—1
), 10);

194 
hbox1
 = 
	`gtk_hbox_Ãw
 (
TRUE
, 0);

195 
	`gtk_widg‘_»f
 (
hbox1
);

196 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "hbox1", 
hbox1
,

197 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

198 
	`gtk_widg‘_show
 (
hbox1
);

199 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
dŸlog_aùiÚ_¬—1
), 
hbox1
, 
TRUE
, TRUE, 0);

201 
bu‰Ú_Ãw
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_NEW
);

202 
	`gtk_widg‘_»f
 (
bu‰Ú_Ãw
);

203 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_Ãw", 
bu‰Ú_Ãw
,

204 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

205 
	`gtk_widg‘_show
 (
bu‰Ú_Ãw
);

206 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox1
), 
bu‰Ú_Ãw
, 
FALSE
, 
TRUE
, 0);

207 
	`gtk_widg‘_add_acûË¿tÜ
 (
bu‰Ú_Ãw
, "şicked", 
acûl_group
,

208 
GDK_n
, 
GDK_CONTROL_MASK
,

209 
GTK_ACCEL_VISIBLE
);

211 
bu‰Ú_move_up
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_GO_UP
);

212 
	`gtk_widg‘_»f
 (
bu‰Ú_move_up
);

213 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_move_up", 
bu‰Ú_move_up
,

214 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

215 
	`gtk_widg‘_show
 (
bu‰Ú_move_up
);

216 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox1
), 
bu‰Ú_move_up
, 
FALSE
, 
TRUE
, 0);

217 
	`gtk_widg‘_add_acûË¿tÜ
 (
bu‰Ú_move_up
, "şicked", 
acûl_group
,

218 
GDK_u
, 
GDK_CONTROL_MASK
,

219 
GTK_ACCEL_VISIBLE
);

220 
bu‰Ú_move_down
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_GO_DOWN
);

221 
	`gtk_widg‘_»f
 (
bu‰Ú_move_down
);

222 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_move_down", 
bu‰Ú_move_down
,

223 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

224 
	`gtk_widg‘_show
 (
bu‰Ú_move_down
);

225 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox1
), 
bu‰Ú_move_down
, 
FALSE
, 
TRUE
, 0);

226 
	`gtk_widg‘_add_acûË¿tÜ
 (
bu‰Ú_move_down
, "şicked", 
acûl_group
,

227 
GDK_d
, 
GDK_CONTROL_MASK
,

228 
GTK_ACCEL_VISIBLE
);

230 
bu‰Ú_ed™
 = 
	`gtk_bu‰Ú_Ãw
();

232 
GtkWidg‘
 *
Ïb–
;

234 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Edit"));

235 
	`gtk_widg‘_»f
(
Ïb–
);

236 
	`gtk_Ïb–_·r£_ulše
(
	`GTK_LABEL
(
Ïb–
), 
	`_
("_Edit"));

237 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
bu‰Ú_ed™
), 
Ïb–
);

238 
	`gtk_widg‘_show
(
Ïb–
);

240 
	`gtk_widg‘_»f
 (
bu‰Ú_ed™
);

241 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_ed™", 
bu‰Ú_ed™
,

242 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

243 
	`gtk_widg‘_show
 (
bu‰Ú_ed™
);

244 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox1
), 
bu‰Ú_ed™
, 
FALSE
, 
TRUE
, 0);

245 
	`gtk_widg‘_add_acûË¿tÜ
 (
bu‰Ú_ed™
, "şicked", 
acûl_group
,

246 
GDK_e
, 
GDK_CONTROL_MASK
,

247 
GTK_ACCEL_VISIBLE
);

249 
bu‰Ú_»move
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_REMOVE
);

250 
	`gtk_widg‘_»f
 (
bu‰Ú_»move
);

251 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_»move", 
bu‰Ú_»move
,

252 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

253 
	`gtk_widg‘_show
 (
bu‰Ú_»move
);

254 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox1
), 
bu‰Ú_»move
, 
FALSE
, 
TRUE
, 0);

255 
	`gtk_widg‘_add_acûË¿tÜ
 (
bu‰Ú_»move
, "şicked", 
acûl_group
,

256 
GDK_r
, 
GDK_CONTROL_MASK
,

257 
GTK_ACCEL_VISIBLE
);

259 
bu‰Ú_­¶y
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_APPLY
);

260 
	`gtk_widg‘_»f
 (
bu‰Ú_­¶y
);

261 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_­¶y", 
bu‰Ú_­¶y
,

262 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

263 
	`gtk_widg‘_show
 (
bu‰Ú_­¶y
);

264 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox1
), 
bu‰Ú_­¶y
, 
FALSE
, 
TRUE
, 0);

265 
	`gtk_widg‘_£t_£ns™ive
 (
bu‰Ú_­¶y
, 
FALSE
);

267 
bu‰Ú_»v”t
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
	`_
("Revert"));

268 
	`gtk_widg‘_»f
 (
bu‰Ú_»v”t
);

269 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_»v”t", 
bu‰Ú_»v”t
,

270 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

271 
	`gtk_widg‘_show
 (
bu‰Ú_»v”t
);

272 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox1
), 
bu‰Ú_»v”t
, 
FALSE
, 
TRUE
, 0);

273 
	`gtk_widg‘_£t_£ns™ive
 (
bu‰Ú_»v”t
, 
FALSE
);

275 
bu‰Ú_şo£
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_CLOSE
);

276 
	`gtk_widg‘_»f
 (
bu‰Ú_şo£
);

277 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "bu‰Ú_şo£", 
bu‰Ú_şo£
,

278 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

279 
	`gtk_widg‘_show
 (
bu‰Ú_şo£
);

280 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
hbox1
), 
bu‰Ú_şo£
, 
FALSE
, 
TRUE
, 0);

282 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
sh“ts_maš_dŸlog
), "delete_event",

283 
	`G_CALLBACK
 (
Ú_sh“ts_maš_dŸlog_d–‘e_ev’t
),

284 
NULL
);

285 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_cİy
), "clicked",

286 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_cİy_şicked
),

287 
NULL
);

288 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_cİy_®l
), "clicked",

289 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_cİy_®l_şicked
),

290 
NULL
);

291 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_move
), "clicked",

292 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_move_şicked
),

293 
NULL
);

294 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_move_®l
), "clicked",

295 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_move_®l_şicked
),

296 
NULL
);

297 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_Ãw
), "clicked",

298 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_Ãw_şicked
),

299 
NULL
);

300 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_move_up
), "clicked",

301 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_move_up_şicked
),

302 
NULL
);

303 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_move_down
), "clicked",

304 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_move_down_şicked
),

305 
NULL
);

306 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_ed™
), "clicked",

307 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_ed™_şicked
),

308 
NULL
);

309 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_»move
), "clicked",

310 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_»move_şicked
),

311 
NULL
);

312 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_­¶y
), "clicked",

313 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_­¶y_şicked
),

314 
NULL
);

315 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_»v”t
), "clicked",

316 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_»v”t_şicked
),

317 
NULL
);

318 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_şo£
), "clicked",

319 
	`G_CALLBACK
 (
Ú_sh“ts_dŸlog_bu‰Ú_şo£_şicked
),

320 
NULL
);

322 
	`gtk_wšdow_add_acûl_group
 (
	`GTK_WINDOW
 (
sh“ts_maš_dŸlog
), 
acûl_group
);

324 
	`³rsi¡’û_»gi¡”_wšdow
(
	`GTK_WINDOW
(
sh“ts_maš_dŸlog
));

326  
sh“ts_maš_dŸlog
;

327 
	}
}

329 
GtkWidg‘
*

330 
	$ü—‹_sh“ts_Ãw_dŸlog
 ()

332 
GtkWidg‘
 *
sh“ts_Ãw_dŸlog
;

333 
GtkWidg‘
 *
dŸlog_vbox2
;

334 
GtkWidg‘
 *
Ty³fg
;

335 
GtkWidg‘
 *
bË1
;

336 
GtkWidg‘
 *
bu‰Ú_brow£
;

337 
GSLi¡
 *
bË1_group
 = 
NULL
;

338 
GtkWidg‘
 *
¿diobu‰Ú_svg_sh­e
;

339 
GtkWidg‘
 *
combo_äom_fe
;

340 
GtkWidg‘
 *
combo_’Œy_äom_fe
;

341 
GtkWidg‘
 *
Ïb–_desütiÚ
;

342 
GtkWidg‘
 *
¿diobu‰Ú_sh“t
;

343 
GtkWidg‘
 *
’Œy_sh“t_Çme
;

344 
GtkWidg‘
 *
¿diobu‰Ú_lše_b»ak
;

345 
GtkWidg‘
 *
’Œy_svg_desütiÚ
;

346 
GtkWidg‘
 *
’Œy_sh“t_desütiÚ
;

347 
GtkWidg‘
 *
Ïb–_svg_desütiÚ
;

348 
GtkWidg‘
 *
dŸlog_aùiÚ_¬—2
;

349 
GtkWidg‘
 *
hbu‰Úbox1
;

350 
GtkWidg‘
 *
bu‰Ú_ok
;

351 
GtkWidg‘
 *
bu‰Ú_ÿnûl
;

353 
sh“ts_Ãw_dŸlog
 = 
	`gtk_dŸlog_Ãw
 ();

354 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "sheets_new_dialog", sheets_new_dialog);

355 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
sh“ts_Ãw_dŸlog
), 
	`_
("New"));

356 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
sh“ts_Ãw_dŸlog
), "sheets_new_dialog");

357 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
sh“ts_Ãw_dŸlog
), 
FALSE
);

359 
dŸlog_vbox2
 = 
	`GTK_DIALOG
 (
sh“ts_Ãw_dŸlog
)->
vbox
;

360 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "dŸlog_vbox2", 
dŸlog_vbox2
);

361 
	`gtk_widg‘_show
 (
dŸlog_vbox2
);

363 
Ty³fg
 = 
	`gtk_äame_Ãw
 (
	`_
("Type"));

364 
	`gtk_widg‘_»f
 (
Ty³fg
);

365 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "Ty³fg", 
Ty³fg
,

366 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

367 
	`gtk_widg‘_show
 (
Ty³fg
);

368 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
dŸlog_vbox2
), 
Ty³fg
, 
TRUE
, TRUE, 0);

369 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
Ty³fg
), 5);

371 
bË1
 = 
	`gtk_bË_Ãw
 (5, 4, 
FALSE
);

372 
	`gtk_widg‘_»f
 (
bË1
);

373 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "bË1", 
bË1
,

374 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

375 
	`gtk_widg‘_show
 (
bË1
);

376 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
Ty³fg
), 
bË1
);

378 
bu‰Ú_brow£
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
 (
	`_
("Browse..."));

379 
	`gtk_widg‘_»f
 (
bu‰Ú_brow£
);

380 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "bu‰Ú_brow£", 
bu‰Ú_brow£
,

381 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

382 
	`gtk_widg‘_show
 (
bu‰Ú_brow£
);

383 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
bu‰Ú_brow£
, 3, 4, 0, 1,

384 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

385 (
GtkA‰achO±iÚs
) (0), 3, 0);

387 
¿diobu‰Ú_svg_sh­e
 = 
	`gtk_¿dio_bu‰Ú_Ãw_w™h_Ïb–
 (
bË1_group
, 
	`_
("SVG Shape:"));

388 
bË1_group
 = 
	`gtk_¿dio_bu‰Ú_group
 (
	`GTK_RADIO_BUTTON
 (
¿diobu‰Ú_svg_sh­e
));

389 
	`gtk_widg‘_»f
 (
¿diobu‰Ú_svg_sh­e
);

390 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "¿diobu‰Ú_svg_sh­e", 
¿diobu‰Ú_svg_sh­e
,

391 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

392 
	`gtk_widg‘_show
 (
¿diobu‰Ú_svg_sh­e
);

393 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
¿diobu‰Ú_svg_sh­e
, 0, 1, 0, 1,

394 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

395 (
GtkA‰achO±iÚs
) (0), 0, 0);

396 
	`gtk_toggË_bu‰Ú_£t_aùive
 (
	`GTK_TOGGLE_BUTTON
 (
¿diobu‰Ú_svg_sh­e
), 
TRUE
);

398 
combo_äom_fe
 = 
	`gtk_combo_Ãw
 ();

399 
	`gtk_widg‘_»f
 (
combo_äom_fe
);

400 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "combo_äom_fe", 
combo_äom_fe
,

401 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

402 
	`gtk_widg‘_show
 (
combo_äom_fe
);

403 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
combo_äom_fe
, 1, 3, 0, 1,

404 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

405 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
), 0, 0);

406 
	`gtk_combo_£t_ÿ£_£ns™ive
 (
	`GTK_COMBO
 (
combo_äom_fe
), 
TRUE
);

408 
combo_’Œy_äom_fe
 = 
	`GTK_COMBO
 (
combo_äom_fe
)->
’Œy
;

409 
	`gtk_widg‘_»f
 (
combo_’Œy_äom_fe
);

410 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "combo_’Œy_äom_fe", 
combo_’Œy_äom_fe
,

411 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

412 
	`gtk_widg‘_show
 (
combo_’Œy_äom_fe
);

414 
Ïb–_desütiÚ
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("description:"));

415 
	`gtk_widg‘_»f
 (
Ïb–_desütiÚ
);

416 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "Ïb–_desütiÚ", 
Ïb–_desütiÚ
,

417 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

418 
	`gtk_widg‘_show
 (
Ïb–_desütiÚ
);

419 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
Ïb–_desütiÚ
, 0, 1, 4, 5,

420 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

421 (
GtkA‰achO±iÚs
) (0), 0, 0);

422 
	`gtk_widg‘_£t_£ns™ive
 (
Ïb–_desütiÚ
, 
FALSE
);

423 
	`gtk_Ïb–_£t_ju¡ify
 (
	`GTK_LABEL
 (
Ïb–_desütiÚ
), 
GTK_JUSTIFY_RIGHT
);

424 
	`gtk_misc_£t_®ignm’t
 (
	`GTK_MISC
 (
Ïb–_desütiÚ
), 0.77, 0.5);

426 
¿diobu‰Ú_sh“t
 = 
	`gtk_¿dio_bu‰Ú_Ãw_w™h_Ïb–
 (
bË1_group
, 
	`_
("Sheet‚ame:"));

427 
bË1_group
 = 
	`gtk_¿dio_bu‰Ú_group
 (
	`GTK_RADIO_BUTTON
 (
¿diobu‰Ú_sh“t
));

428 
	`gtk_widg‘_»f
 (
¿diobu‰Ú_sh“t
);

429 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "¿diobu‰Ú_sh“t", 
¿diobu‰Ú_sh“t
,

430 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

431 
	`gtk_widg‘_show
 (
¿diobu‰Ú_sh“t
);

432 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
¿diobu‰Ú_sh“t
, 0, 1, 3, 4,

433 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

434 (
GtkA‰achO±iÚs
) (0), 0, 0);

436 
’Œy_sh“t_Çme
 = 
	`gtk_’Œy_Ãw
 ();

437 
	`gtk_widg‘_»f
 (
’Œy_sh“t_Çme
);

438 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "’Œy_sh“t_Çme", 
’Œy_sh“t_Çme
,

439 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

440 
	`gtk_widg‘_show
 (
’Œy_sh“t_Çme
);

441 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
’Œy_sh“t_Çme
, 1, 3, 3, 4,

442 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

443 (
GtkA‰achO±iÚs
) (0), 0, 0);

444 
	`gtk_widg‘_£t_usize
 (
’Œy_sh“t_Çme
, 255, -2);

445 
	`gtk_widg‘_£t_£ns™ive
 (
’Œy_sh“t_Çme
, 
FALSE
);

447 
¿diobu‰Ú_lše_b»ak
 = 
	`gtk_¿dio_bu‰Ú_Ãw_w™h_Ïb–
 (
bË1_group
, 
	`_
("Line Break"));

448 
bË1_group
 = 
	`gtk_¿dio_bu‰Ú_group
 (
	`GTK_RADIO_BUTTON
 (
¿diobu‰Ú_lše_b»ak
));

449 
	`gtk_widg‘_»f
 (
¿diobu‰Ú_lše_b»ak
);

450 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "¿diobu‰Ú_lše_b»ak", 
¿diobu‰Ú_lše_b»ak
,

451 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

452 
	`gtk_widg‘_show
 (
¿diobu‰Ú_lše_b»ak
);

453 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
¿diobu‰Ú_lše_b»ak
, 0, 1, 2, 3,

454 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

455 (
GtkA‰achO±iÚs
) (0), 0, 0);

457 
’Œy_svg_desütiÚ
 = 
	`gtk_’Œy_Ãw
 ();

458 
	`gtk_widg‘_»f
 (
’Œy_svg_desütiÚ
);

459 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "’Œy_svg_desütiÚ", 
’Œy_svg_desütiÚ
,

460 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

461 
	`gtk_widg‘_show
 (
’Œy_svg_desütiÚ
);

462 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
’Œy_svg_desütiÚ
, 1, 3, 1, 2,

463 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

464 (
GtkA‰achO±iÚs
) (0), 0, 0);

466 
’Œy_sh“t_desütiÚ
 = 
	`gtk_’Œy_Ãw
 ();

467 
	`gtk_widg‘_»f
 (
’Œy_sh“t_desütiÚ
);

468 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "’Œy_sh“t_desütiÚ", 
’Œy_sh“t_desütiÚ
,

469 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

470 
	`gtk_widg‘_show
 (
’Œy_sh“t_desütiÚ
);

471 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
’Œy_sh“t_desütiÚ
, 1, 3, 4, 5,

472 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

473 (
GtkA‰achO±iÚs
) (0), 0, 0);

474 
	`gtk_widg‘_£t_usize
 (
’Œy_sh“t_desütiÚ
, 255, -2);

475 
	`gtk_widg‘_£t_£ns™ive
 (
’Œy_sh“t_desütiÚ
, 
FALSE
);

477 
Ïb–_svg_desütiÚ
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("description:"));

478 
	`gtk_widg‘_»f
 (
Ïb–_svg_desütiÚ
);

479 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "Ïb–_svg_desütiÚ", 
Ïb–_svg_desütiÚ
,

480 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

481 
	`gtk_widg‘_show
 (
Ïb–_svg_desütiÚ
);

482 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË1
), 
Ïb–_svg_desütiÚ
, 0, 1, 1, 2,

483 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

484 (
GtkA‰achO±iÚs
) (0), 0, 0);

485 
	`gtk_Ïb–_£t_ju¡ify
 (
	`GTK_LABEL
 (
Ïb–_svg_desütiÚ
), 
GTK_JUSTIFY_RIGHT
);

486 
	`gtk_misc_£t_®ignm’t
 (
	`GTK_MISC
 (
Ïb–_svg_desütiÚ
), 0.77, 0.5);

488 
dŸlog_aùiÚ_¬—2
 = 
	`GTK_DIALOG
 (
sh“ts_Ãw_dŸlog
)->
aùiÚ_¬—
;

489 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "dŸlog_aùiÚ_¬—2", 
dŸlog_aùiÚ_¬—2
);

490 
	`gtk_widg‘_show
 (
dŸlog_aùiÚ_¬—2
);

491 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
dŸlog_aùiÚ_¬—2
), 10);

493 
hbu‰Úbox1
 = 
	`gtk_hbu‰Ú_box_Ãw
 ();

494 
	`gtk_widg‘_»f
 (
hbu‰Úbox1
);

495 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "hbu‰Úbox1", 
hbu‰Úbox1
,

496 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

497 
	`gtk_widg‘_show
 (
hbu‰Úbox1
);

498 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
dŸlog_aùiÚ_¬—2
), 
hbu‰Úbox1
, 
TRUE
, TRUE, 0);

499 
	`gtk_bu‰Ú_box_£t_Ïyout
 (
	`GTK_BUTTON_BOX
 (
hbu‰Úbox1
), 
GTK_BUTTONBOX_END
);

500 
	`gtk_bu‰Ú_box_£t_¥acšg
 (
	`GTK_BUTTON_BOX
 (
hbu‰Úbox1
), 0);

502 
bu‰Ú_ok
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_OK
);

503 
	`gtk_widg‘_»f
 (
bu‰Ú_ok
);

504 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "bu‰Ú_ok", 
bu‰Ú_ok
,

505 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

506 
	`gtk_widg‘_show
 (
bu‰Ú_ok
);

507 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
hbu‰Úbox1
), 
bu‰Ú_ok
);

508 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú_ok
, 
GTK_CAN_DEFAULT
);

510 
bu‰Ú_ÿnûl
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_CANCEL
);

511 
	`gtk_widg‘_»f
 (
bu‰Ú_ÿnûl
);

512 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_Ãw_dŸlog
), "bu‰Ú_ÿnûl", 
bu‰Ú_ÿnûl
,

513 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

514 
	`gtk_widg‘_show
 (
bu‰Ú_ÿnûl
);

515 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
hbu‰Úbox1
), 
bu‰Ú_ÿnûl
);

516 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú_ÿnûl
, 
GTK_CAN_DEFAULT
);

518 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_brow£
), "clicked",

519 
	`G_CALLBACK
 (
Ú_sh“ts_Ãw_dŸlog_bu‰Ú_brow£_şicked
),

520 
NULL
);

521 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
¿diobu‰Ú_svg_sh­e
), "toggled",

522 
	`G_CALLBACK
 (
Ú_sh“ts_Ãw_dŸlog_¿diobu‰Ú_svg_sh­e_toggËd
),

523 
NULL
);

524 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
¿diobu‰Ú_sh“t
), "toggled",

525 
	`G_CALLBACK
 (
Ú_sh“ts_Ãw_dŸlog_¿diobu‰Ú_sh“t_toggËd
),

526 
NULL
);

527 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
¿diobu‰Ú_lše_b»ak
), "toggled",

528 
	`G_CALLBACK
 (
Ú_sh“ts_Ãw_dŸlog_¿diobu‰Ú_lše_b»ak_toggËd
),

529 
NULL
);

530 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_ok
), "clicked",

531 
	`G_CALLBACK
 (
Ú_sh“ts_Ãw_dŸlog_bu‰Ú_ok_şicked
),

532 
NULL
);

533 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_ÿnûl
), "clicked",

534 
	`G_CALLBACK
 (
Ú_sh“ts_Ãw_dŸlog_bu‰Ú_ÿnûl_şicked
),

535 
NULL
);

537 
	`gtk_widg‘_g¿b_deçuÉ
 (
bu‰Ú_ok
);

538  
sh“ts_Ãw_dŸlog
;

539 
	}
}

541 
GtkWidg‘
*

542 
	$ü—‹_sh“ts_ed™_dŸlog
 ()

544 
GtkWidg‘
 *
sh“ts_ed™_dŸlog
;

545 
GtkWidg‘
 *
dŸlog_vbox3
;

546 
GtkWidg‘
 *
vbox1
;

547 
GtkWidg‘
 *
äame_objeù
;

548 
GtkWidg‘
 *
bË6
;

549 
GtkWidg‘
 *
Ïb–_objeù_desütiÚ
;

550 
GtkWidg‘
 *
’Œy_objeù_desütiÚ
;

551 
GtkWidg‘
 *
Ïb–_objeù_ty³
;

552 
GtkWidg‘
 *
’Œy_objeù_ty³
;

553 
GtkWidg‘
 *
äame_objeù_pixm­
;

554 
GtkWidg‘
 *
pixm­_objeù
;

555 
GtkWidg‘
 *
äame_sh“t
;

556 
GtkWidg‘
 *
bË3
;

557 
GtkWidg‘
 *
Ïb–_sh“t_Çme
;

558 
GtkWidg‘
 *
’Œy_sh“t_desütiÚ
;

559 
GtkWidg‘
 *
Ïb–_sh“t_desütiÚ
;

560 
GtkWidg‘
 *
’Œy_sh“t_Çme
;

561 
GtkWidg‘
 *
dŸlog_aùiÚ_¬—3
;

562 
GtkWidg‘
 *
hbu‰Úbox2
;

563 
GtkWidg‘
 *
bu‰Ú_ok
;

564 
GtkWidg‘
 *
bu‰Ú_ÿnûl
;

566 
sh“ts_ed™_dŸlog
 = 
	`gtk_dŸlog_Ãw
 ();

567 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "sheets_edit_dialog", sheets_edit_dialog);

568 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
sh“ts_ed™_dŸlog
), 5);

569 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
sh“ts_ed™_dŸlog
), 
	`_
("Edit Attributes"));

570 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
sh“ts_ed™_dŸlog
), "sheets_edit_dialog");

571 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
sh“ts_ed™_dŸlog
), 
FALSE
);

573 
dŸlog_vbox3
 = 
	`GTK_DIALOG
 (
sh“ts_ed™_dŸlog
)->
vbox
;

574 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "dŸlog_vbox3", 
dŸlog_vbox3
);

575 
	`gtk_widg‘_show
 (
dŸlog_vbox3
);

577 
vbox1
 = 
	`gtk_vbox_Ãw
 (
FALSE
, 0);

578 
	`gtk_widg‘_»f
 (
vbox1
);

579 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "vbox1", 
vbox1
,

580 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

581 
	`gtk_widg‘_show
 (
vbox1
);

582 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
dŸlog_vbox3
), 
vbox1
, 
TRUE
, TRUE, 0);

584 
äame_objeù
 = 
	`gtk_äame_Ãw
 (
	`_
("DiaObject"));

585 
	`gtk_widg‘_»f
 (
äame_objeù
);

586 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "äame_objeù", 
äame_objeù
,

587 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

588 
	`gtk_widg‘_show
 (
äame_objeù
);

589 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox1
), 
äame_objeù
, 
TRUE
, TRUE, 0);

591 
bË6
 = 
	`gtk_bË_Ãw
 (3, 2, 
FALSE
);

592 
	`gtk_widg‘_»f
 (
bË6
);

593 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "bË6", 
bË6
,

594 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

595 
	`gtk_widg‘_show
 (
bË6
);

596 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
äame_objeù
), 
bË6
);

597 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
bË6
), 5);

598 
	`gtk_bË_£t_cŞ_¥acšgs
 (
	`GTK_TABLE
 (
bË6
), 6);

600 
Ïb–_objeù_desütiÚ
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("Description:"));

601 
	`gtk_widg‘_»f
 (
Ïb–_objeù_desütiÚ
);

602 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "Ïb–_objeù_desütiÚ", 
Ïb–_objeù_desütiÚ
,

603 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

604 
	`gtk_widg‘_show
 (
Ïb–_objeù_desütiÚ
);

605 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË6
), 
Ïb–_objeù_desütiÚ
, 0, 1, 1, 2,

606 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

607 (
GtkA‰achO±iÚs
) (0), 0, 0);

608 
	`gtk_misc_£t_®ignm’t
 (
	`GTK_MISC
 (
Ïb–_objeù_desütiÚ
), 0, 0.5);

610 
’Œy_objeù_desütiÚ
 = 
	`gtk_’Œy_Ãw
 ();

611 
	`gtk_widg‘_»f
 (
’Œy_objeù_desütiÚ
);

612 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "’Œy_objeù_desütiÚ", 
’Œy_objeù_desütiÚ
,

613 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

614 
	`gtk_widg‘_show
 (
’Œy_objeù_desütiÚ
);

615 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË6
), 
’Œy_objeù_desütiÚ
, 1, 2, 1, 2,

616 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

617 (
GtkA‰achO±iÚs
) (0), 0, 0);

619 
Ïb–_objeù_ty³
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("Type:"));

620 
	`gtk_widg‘_»f
 (
Ïb–_objeù_ty³
);

621 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "Ïb–_objeù_ty³", 
Ïb–_objeù_ty³
,

622 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

623 
	`gtk_widg‘_show
 (
Ïb–_objeù_ty³
);

624 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË6
), 
Ïb–_objeù_ty³
, 0, 1, 2, 3,

625 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

626 (
GtkA‰achO±iÚs
) (0), 0, 0);

627 
	`gtk_misc_£t_®ignm’t
 (
	`GTK_MISC
 (
Ïb–_objeù_ty³
), 0, 0.5);

629 
’Œy_objeù_ty³
 = 
	`gtk_’Œy_Ãw
 ();

630 
	`gtk_widg‘_»f
 (
’Œy_objeù_ty³
);

631 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "’Œy_objeù_ty³", 
’Œy_objeù_ty³
,

632 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

633 
	`gtk_widg‘_show
 (
’Œy_objeù_ty³
);

634 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË6
), 
’Œy_objeù_ty³
, 1, 2, 2, 3,

635 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

636 (
GtkA‰achO±iÚs
) (0), 0, 0);

637 
	`gtk_widg‘_£t_£ns™ive
 (
’Œy_objeù_ty³
, 
FALSE
);

638 
	`gtk_’Œy_£t_ed™abË
 (
	`GTK_ENTRY
 (
’Œy_objeù_ty³
), 
FALSE
);

640 
äame_objeù_pixm­
 = 
	`gtk_äame_Ãw
 (
NULL
);

641 
	`gtk_widg‘_»f
 (
äame_objeù_pixm­
);

642 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "äame_objeù_pixm­", 
äame_objeù_pixm­
,

643 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

644 
	`gtk_widg‘_show
 (
äame_objeù_pixm­
);

645 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË6
), 
äame_objeù_pixm­
, 0, 1, 0, 1,

646 (
GtkA‰achO±iÚs
) (0),

647 (
GtkA‰achO±iÚs
) (0), 0, 0);

648 
	`gtk_äame_£t_shadow_ty³
 (
	`GTK_FRAME
 (
äame_objeù_pixm­
), 
GTK_SHADOW_ETCHED_OUT
);

650 
pixm­_objeù
 = 
	`ü—‹_pixm­
 (
sh“ts_ed™_dŸlog
, 
NULL
, 
FALSE
);

651 
	`gtk_widg‘_»f
 (
pixm­_objeù
);

652 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "pixm­_objeù", 
pixm­_objeù
,

653 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

654 
	`gtk_widg‘_show
 (
pixm­_objeù
);

655 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
äame_objeù_pixm­
), 
pixm­_objeù
);

657 
äame_sh“t
 = 
	`gtk_äame_Ãw
 (
	`_
("Sheet"));

658 
	`gtk_widg‘_»f
 (
äame_sh“t
);

659 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "äame_sh“t", 
äame_sh“t
,

660 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

661 
	`gtk_widg‘_show
 (
äame_sh“t
);

662 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
vbox1
), 
äame_sh“t
, 
TRUE
, TRUE, 0);

664 
bË3
 = 
	`gtk_bË_Ãw
 (2, 2, 
FALSE
);

665 
	`gtk_widg‘_»f
 (
bË3
);

666 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "bË3", 
bË3
,

667 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

668 
	`gtk_widg‘_show
 (
bË3
);

669 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
äame_sh“t
), 
bË3
);

670 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
bË3
), 5);

671 
	`gtk_bË_£t_cŞ_¥acšgs
 (
	`GTK_TABLE
 (
bË3
), 6);

673 
Ïb–_sh“t_Çme
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("Name:"));

674 
	`gtk_widg‘_»f
 (
Ïb–_sh“t_Çme
);

675 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "Ïb–_sh“t_Çme", 
Ïb–_sh“t_Çme
,

676 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

677 
	`gtk_widg‘_show
 (
Ïb–_sh“t_Çme
);

678 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË3
), 
Ïb–_sh“t_Çme
, 0, 1, 0, 1,

679 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

680 (
GtkA‰achO±iÚs
) (0), 0, 0);

681 
	`gtk_Ïb–_£t_ju¡ify
 (
	`GTK_LABEL
 (
Ïb–_sh“t_Çme
), 
GTK_JUSTIFY_RIGHT
);

682 
	`gtk_misc_£t_®ignm’t
 (
	`GTK_MISC
 (
Ïb–_sh“t_Çme
), 0, 0.5);

684 
’Œy_sh“t_desütiÚ
 = 
	`gtk_’Œy_Ãw
 ();

685 
	`gtk_widg‘_»f
 (
’Œy_sh“t_desütiÚ
);

686 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "’Œy_sh“t_desütiÚ", 
’Œy_sh“t_desütiÚ
,

687 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

688 
	`gtk_widg‘_show
 (
’Œy_sh“t_desütiÚ
);

689 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË3
), 
’Œy_sh“t_desütiÚ
, 1, 2, 1, 2,

690 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

691 (
GtkA‰achO±iÚs
) (0), 0, 0);

693 
Ïb–_sh“t_desütiÚ
 = 
	`gtk_Ïb–_Ãw
 (
	`_
("Description:"));

694 
	`gtk_widg‘_»f
 (
Ïb–_sh“t_desütiÚ
);

695 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "Ïb–_sh“t_desütiÚ", 
Ïb–_sh“t_desütiÚ
,

696 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

697 
	`gtk_widg‘_show
 (
Ïb–_sh“t_desütiÚ
);

698 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË3
), 
Ïb–_sh“t_desütiÚ
, 0, 1, 1, 2,

699 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

700 (
GtkA‰achO±iÚs
) (0), 0, 0);

701 
	`gtk_misc_£t_®ignm’t
 (
	`GTK_MISC
 (
Ïb–_sh“t_desütiÚ
), 0, 0.5);

703 
’Œy_sh“t_Çme
 = 
	`gtk_’Œy_Ãw
 ();

704 
	`gtk_widg‘_»f
 (
’Œy_sh“t_Çme
);

705 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "’Œy_sh“t_Çme", 
’Œy_sh“t_Çme
,

706 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

707 
	`gtk_widg‘_show
 (
’Œy_sh“t_Çme
);

708 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË3
), 
’Œy_sh“t_Çme
, 1, 2, 0, 1,

709 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

710 (
GtkA‰achO±iÚs
) (0), 0, 0);

711 
	`gtk_widg‘_£t_usize
 (
’Œy_sh“t_Çme
, 220, -2);

713 
dŸlog_aùiÚ_¬—3
 = 
	`GTK_DIALOG
 (
sh“ts_ed™_dŸlog
)->
aùiÚ_¬—
;

714 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "dŸlog_aùiÚ_¬—3", 
dŸlog_aùiÚ_¬—3
);

715 
	`gtk_widg‘_show
 (
dŸlog_aùiÚ_¬—3
);

716 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
dŸlog_aùiÚ_¬—3
), 10);

718 
hbu‰Úbox2
 = 
	`gtk_hbu‰Ú_box_Ãw
 ();

719 
	`gtk_widg‘_»f
 (
hbu‰Úbox2
);

720 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "hbu‰Úbox2", 
hbu‰Úbox2
,

721 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

722 
	`gtk_widg‘_show
 (
hbu‰Úbox2
);

723 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
dŸlog_aùiÚ_¬—3
), 
hbu‰Úbox2
, 
TRUE
, TRUE, 0);

724 
	`gtk_bu‰Ú_box_£t_Ïyout
 (
	`GTK_BUTTON_BOX
 (
hbu‰Úbox2
), 
GTK_BUTTONBOX_END
);

725 
	`gtk_bu‰Ú_box_£t_¥acšg
 (
	`GTK_BUTTON_BOX
 (
hbu‰Úbox2
), 0);

727 
bu‰Ú_ok
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_OK
);

728 
	`gtk_widg‘_»f
 (
bu‰Ú_ok
);

729 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "bu‰Ú_ok", 
bu‰Ú_ok
,

730 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

731 
	`gtk_widg‘_show
 (
bu‰Ú_ok
);

732 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
hbu‰Úbox2
), 
bu‰Ú_ok
);

733 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú_ok
, 
GTK_CAN_DEFAULT
);

735 
bu‰Ú_ÿnûl
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_CANCEL
);

736 
	`gtk_widg‘_»f
 (
bu‰Ú_ÿnûl
);

737 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_ed™_dŸlog
), "bu‰Ú_ÿnûl", 
bu‰Ú_ÿnûl
,

738 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

739 
	`gtk_widg‘_show
 (
bu‰Ú_ÿnûl
);

740 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
hbu‰Úbox2
), 
bu‰Ú_ÿnûl
);

741 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú_ÿnûl
, 
GTK_CAN_DEFAULT
);

743 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
’Œy_objeù_desütiÚ
), "changed",

744 
	`G_CALLBACK
 (
Ú_sh“ts_ed™_dŸlog_’Œy_objeù_desütiÚ_chªged
),

745 
NULL
);

746 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
’Œy_sh“t_desütiÚ
), "changed",

747 
	`G_CALLBACK
 (
Ú_sh“ts_ed™_dŸlog_’Œy_sh“t_desütiÚ_chªged
),

748 
NULL
);

749 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
’Œy_sh“t_Çme
), "changed",

750 
	`G_CALLBACK
 (
Ú_sh“ts_ed™_dŸlog_’Œy_sh“t_Çme_chªged
),

751 
NULL
);

752 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_ok
), "clicked",

753 
	`G_CALLBACK
 (
Ú_sh“ts_ed™_dŸlog_bu‰Ú_ok_şicked
),

754 
NULL
);

755 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_ÿnûl
), "clicked",

756 
	`G_CALLBACK
 (
Ú_sh“ts_ed™_dŸlog_bu‰Ú_ÿnûl_şicked
),

757 
NULL
);

759 
	`gtk_widg‘_g¿b_deçuÉ
 (
bu‰Ú_ok
);

760  
sh“ts_ed™_dŸlog
;

761 
	}
}

763 
GtkWidg‘
*

764 
	$ü—‹_sh“ts_»move_dŸlog
 ()

766 
GtkWidg‘
 *
sh“ts_»move_dŸlog
;

767 
GtkWidg‘
 *
dŸlog_vbox4
;

768 
GtkWidg‘
 *
äame
;

769 
GtkWidg‘
 *
bË7
;

770 
GSLi¡
 *
bË7_group
 = 
NULL
;

771 
GtkWidg‘
 *
¿diobu‰Ú_objeù
;

772 
GtkWidg‘
 *
äame_objeù_pixm­
;

773 
GtkWidg‘
 *
pixm­_objeù
;

774 
GtkWidg‘
 *
¿diobu‰Ú_sh“t
;

775 
GtkWidg‘
 *
’Œy_objeù
;

776 
GtkWidg‘
 *
’Œy_sh“t
;

777 
GtkWidg‘
 *
dŸlog_aùiÚ_¬—4
;

778 
GtkWidg‘
 *
hbu‰Úbox3
;

779 
GtkWidg‘
 *
bu‰Ú_ok
;

780 
GtkWidg‘
 *
bu‰Ú_ÿnûl
;

782 
sh“ts_»move_dŸlog
 = 
	`gtk_dŸlog_Ãw
 ();

783 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
),

784 "sh“ts_»move_dŸlog", 
sh“ts_»move_dŸlog
);

785 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
sh“ts_»move_dŸlog
), 
	`_
("Remove"));

786 
	`gtk_wšdow_£t_deçuÉ_size
 (
	`GTK_WINDOW
 (
sh“ts_»move_dŸlog
), 316, -1);

787 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
sh“ts_»move_dŸlog
),

789 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
sh“ts_»move_dŸlog
), 
TRUE
);

791 
dŸlog_vbox4
 = 
	`GTK_DIALOG
 (
sh“ts_»move_dŸlog
)->
vbox
;

792 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "dŸlog_vbox4", 
dŸlog_vbox4
);

793 
	`gtk_widg‘_show
 (
dŸlog_vbox4
);

795 
äame
 = 
	`gtk_äame_Ãw
 (
	`_
("Type"));

796 
	`gtk_widg‘_»f
 (
äame
);

797 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "äame", 
äame
,

798 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

799 
	`gtk_widg‘_show
 (
äame
);

800 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
dŸlog_vbox4
), 
äame
, 
TRUE
, TRUE, 0);

801 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
äame
), 5);

803 
bË7
 = 
	`gtk_bË_Ãw
 (3, 2, 
FALSE
);

804 
	`gtk_widg‘_»f
 (
bË7
);

805 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "bË7", 
bË7
,

806 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

807 
	`gtk_widg‘_show
 (
bË7
);

808 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
äame
), 
bË7
);

810 
¿diobu‰Ú_objeù
 = 
	`gtk_¿dio_bu‰Ú_Ãw_w™h_Ïb–
 (
bË7_group
, 
	`_
("DiaObject:"));

811 
bË7_group
 = 
	`gtk_¿dio_bu‰Ú_group
 (
	`GTK_RADIO_BUTTON
 (
¿diobu‰Ú_objeù
));

812 
	`gtk_widg‘_»f
 (
¿diobu‰Ú_objeù
);

813 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "¿diobu‰Ú_objeù", 
¿diobu‰Ú_objeù
,

814 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

815 
	`gtk_widg‘_show
 (
¿diobu‰Ú_objeù
);

816 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË7
), 
¿diobu‰Ú_objeù
, 0, 1, 1, 2,

817 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

818 (
GtkA‰achO±iÚs
) (0), 0, 0);

820 
äame_objeù_pixm­
 = 
	`gtk_äame_Ãw
 (
NULL
);

821 
	`gtk_widg‘_»f
 (
äame_objeù_pixm­
);

822 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "äame_objeù_pixm­", 
äame_objeù_pixm­
,

823 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

824 
	`gtk_widg‘_show
 (
äame_objeù_pixm­
);

825 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË7
), 
äame_objeù_pixm­
, 0, 1, 0, 1,

826 (
GtkA‰achO±iÚs
) (0),

827 (
GtkA‰achO±iÚs
) (0), 0, 0);

828 
	`gtk_äame_£t_shadow_ty³
 (
	`GTK_FRAME
 (
äame_objeù_pixm­
), 
GTK_SHADOW_ETCHED_OUT
);

830 
pixm­_objeù
 = 
	`ü—‹_pixm­
 (
sh“ts_»move_dŸlog
, 
NULL
, 
FALSE
);

831 
	`gtk_widg‘_»f
 (
pixm­_objeù
);

832 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "pixm­_objeù", 
pixm­_objeù
,

833 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

834 
	`gtk_widg‘_show
 (
pixm­_objeù
);

835 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
äame_objeù_pixm­
), 
pixm­_objeù
);

837 
¿diobu‰Ú_sh“t
 = 
	`gtk_¿dio_bu‰Ú_Ãw_w™h_Ïb–
 (
bË7_group
, 
	`_
("Sheet:"));

838 
bË7_group
 = 
	`gtk_¿dio_bu‰Ú_group
 (
	`GTK_RADIO_BUTTON
 (
¿diobu‰Ú_sh“t
));

839 
	`gtk_widg‘_»f
 (
¿diobu‰Ú_sh“t
);

840 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "¿diobu‰Ú_sh“t", 
¿diobu‰Ú_sh“t
,

841 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

842 
	`gtk_widg‘_show
 (
¿diobu‰Ú_sh“t
);

843 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË7
), 
¿diobu‰Ú_sh“t
, 0, 1, 2, 3,

844 (
GtkA‰achO±iÚs
è(
GTK_FILL
),

845 (
GtkA‰achO±iÚs
) (0), 0, 0);

847 
’Œy_objeù
 = 
	`gtk_’Œy_Ãw
 ();

848 
	`gtk_widg‘_»f
 (
’Œy_objeù
);

849 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "’Œy_objeù", 
’Œy_objeù
,

850 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

851 
	`gtk_widg‘_show
 (
’Œy_objeù
);

852 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË7
), 
’Œy_objeù
, 1, 2, 1, 2,

853 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

854 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
), 0, 0);

855 
	`gtk_’Œy_£t_ed™abË
 (
	`GTK_ENTRY
 (
’Œy_objeù
), 
FALSE
);

857 
’Œy_sh“t
 = 
	`gtk_’Œy_Ãw
 ();

858 
	`gtk_widg‘_»f
 (
’Œy_sh“t
);

859 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "’Œy_sh“t", 
’Œy_sh“t
,

860 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

861 
	`gtk_widg‘_show
 (
’Œy_sh“t
);

862 
	`gtk_bË_©ch
 (
	`GTK_TABLE
 (
bË7
), 
’Œy_sh“t
, 1, 2, 2, 3,

863 (
GtkA‰achO±iÚs
è(
GTK_EXPAND
 | 
GTK_FILL
),

864 (
GtkA‰achO±iÚs
) (0), 0, 0);

865 
	`gtk_’Œy_£t_ed™abË
 (
	`GTK_ENTRY
 (
’Œy_sh“t
), 
FALSE
);

867 
dŸlog_aùiÚ_¬—4
 = 
	`GTK_DIALOG
 (
sh“ts_»move_dŸlog
)->
aùiÚ_¬—
;

868 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "dŸlog_aùiÚ_¬—4", 
dŸlog_aùiÚ_¬—4
);

869 
	`gtk_widg‘_show
 (
dŸlog_aùiÚ_¬—4
);

870 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
dŸlog_aùiÚ_¬—4
), 10);

872 
hbu‰Úbox3
 = 
	`gtk_hbu‰Ú_box_Ãw
 ();

873 
	`gtk_widg‘_»f
 (
hbu‰Úbox3
);

874 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "hbu‰Úbox3", 
hbu‰Úbox3
,

875 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

876 
	`gtk_widg‘_show
 (
hbu‰Úbox3
);

877 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
 (
dŸlog_aùiÚ_¬—4
), 
hbu‰Úbox3
, 
TRUE
, TRUE, 0);

878 
	`gtk_bu‰Ú_box_£t_Ïyout
 (
	`GTK_BUTTON_BOX
 (
hbu‰Úbox3
), 
GTK_BUTTONBOX_END
);

879 
	`gtk_bu‰Ú_box_£t_¥acšg
 (
	`GTK_BUTTON_BOX
 (
hbu‰Úbox3
), 0);

881 
bu‰Ú_ok
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_OK
);

882 
	`gtk_widg‘_»f
 (
bu‰Ú_ok
);

883 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "bu‰Ú_ok", 
bu‰Ú_ok
,

884 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

885 
	`gtk_widg‘_show
 (
bu‰Ú_ok
);

886 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
hbu‰Úbox3
), 
bu‰Ú_ok
);

887 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú_ok
, 
GTK_CAN_DEFAULT
);

889 
bu‰Ú_ÿnûl
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
GTK_STOCK_CANCEL
);

890 
	`gtk_widg‘_»f
 (
bu‰Ú_ÿnûl
);

891 
	`gtk_objeù_£t_d©a_fuÎ
 (
	`GTK_OBJECT
 (
sh“ts_»move_dŸlog
), "bu‰Ú_ÿnûl", 
bu‰Ú_ÿnûl
,

892 (
GtkDe¡royNÙify
è
gtk_widg‘_uÄef
);

893 
	`gtk_widg‘_show
 (
bu‰Ú_ÿnûl
);

894 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
 (
hbu‰Úbox3
), 
bu‰Ú_ÿnûl
);

895 
	`GTK_WIDGET_SET_FLAGS
 (
bu‰Ú_ÿnûl
, 
GTK_CAN_DEFAULT
);

897 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
¿diobu‰Ú_objeù
), "toggled",

898 
	`G_CALLBACK
 (
Ú_sh“ts_»move_dŸlog_¿diobu‰Ú_objeù_toggËd
),

899 
NULL
);

900 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
¿diobu‰Ú_sh“t
), "toggled",

901 
	`G_CALLBACK
 (
Ú_sh“ts_»move_dŸlog_¿diobu‰Ú_sh“t_toggËd
),

902 
NULL
);

903 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_ok
), "clicked",

904 
	`G_CALLBACK
 (
Ú_sh“ts_»move_dŸlog_bu‰Ú_ok_şicked
),

905 
NULL
);

906 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
bu‰Ú_ÿnûl
), "clicked",

907 
	`G_CALLBACK
 (
Ú_sh“ts_»move_dŸlog_bu‰Ú_ÿnûl_şicked
),

908 
NULL
);

910 
	`gtk_widg‘_g¿b_deçuÉ
 (
bu‰Ú_ok
);

911  
sh“ts_»move_dŸlog
;

912 
	}
}

914 
GtkWidg‘
*

915 
	$ü—‹_sh“ts_sh­e£ËùiÚ_dŸlog
 ()

917 
GtkWidg‘
 *
sh“ts_sh­e£ËùiÚ_dŸlog
;

918 
GtkWidg‘
 *
ok_bu‰Ú
;

919 
GtkWidg‘
 *
ÿnûl_bu‰Ú1
;

921 
sh“ts_sh­e£ËùiÚ_dŸlog
 = 
	`gtk_fe_£ËùiÚ_Ãw
 (
	`_
("Select SVG Shape File"));

922 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_sh­e£ËùiÚ_dŸlog
), "sheets_shapeselection_dialog", sheets_shapeselection_dialog);

923 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
sh“ts_sh­e£ËùiÚ_dŸlog
), 10);

925 
ok_bu‰Ú
 = 
	`GTK_FILE_SELECTION
 (
sh“ts_sh­e£ËùiÚ_dŸlog
)->ok_button;

926 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_sh­e£ËùiÚ_dŸlog
), "ok_bu‰Ú", 
ok_bu‰Ú
);

927 
	`gtk_widg‘_show
 (
ok_bu‰Ú
);

928 
	`GTK_WIDGET_SET_FLAGS
 (
ok_bu‰Ú
, 
GTK_CAN_DEFAULT
);

930 
ÿnûl_bu‰Ú1
 = 
	`GTK_FILE_SELECTION
 (
sh“ts_sh­e£ËùiÚ_dŸlog
)->
ÿnûl_bu‰Ú
;

931 
	`gtk_objeù_£t_d©a
 (
	`GTK_OBJECT
 (
sh“ts_sh­e£ËùiÚ_dŸlog
), "ÿnûl_bu‰Ú1", 
ÿnûl_bu‰Ú1
);

932 
	`gtk_widg‘_show
 (
ÿnûl_bu‰Ú1
);

933 
	`GTK_WIDGET_SET_FLAGS
 (
ÿnûl_bu‰Ú1
, 
GTK_CAN_DEFAULT
);

935 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ok_bu‰Ú
), "clicked",

936 
	`G_CALLBACK
 (
Ú_sh“ts_sh­e£ËùiÚ_dŸlog_bu‰Ú_ok_şicked
),

937 
NULL
);

938 
	`g_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ÿnûl_bu‰Ú1
), "clicked",

939 
	`G_CALLBACK
 (
Ú_sh“ts_sh­e£ËùiÚ_dŸlog_bu‰Ú_ÿnûl_şicked
),

940 
NULL
);

942  
sh“ts_sh­e£ËùiÚ_dŸlog
;

943 
	}
}

	@O:\tool\dvs50\app\sheets_dialog.h

5 
GtkWidg‘
* 
ü—‹_sh“ts_maš_dŸlog
 ();

6 
GtkWidg‘
* 
ü—‹_sh“ts_Ãw_dŸlog
 ();

7 
GtkWidg‘
* 
ü—‹_sh“ts_ed™_dŸlog
 ();

8 
GtkWidg‘
* 
ü—‹_sh“ts_»move_dŸlog
 ();

9 
GtkWidg‘
* 
ü—‹_sh“ts_sh­e£ËùiÚ_dŸlog
 ();

	@O:\tool\dvs50\app\sheets_dialog_callbacks.c

24 #ifdeà
HAVE_CONFIG_H


25 
	~<cÚfig.h
>

28 
	~<”ºo.h
>

29 
	~<¡ršg.h
>

30 
	~<sys/ty³s.h
>

31 
	~<sys/¡©.h
>

32 #ifdeà
HAVE_UNISTD_H


33 
	~<uni¡d.h
>

35 
	~<time.h
>

36 #ifdeà
HAVE_UTIME_H


37 
	~<utime.h
>

40 
	~<sys/utime.h
>

41 #ifdeà
G_OS_WIN32


42 
	#utime
(
n
,
b
è
	`_utime
Ò,b)

	)

43 
	#utim_buf
 
_utimbuf


	)

47 
	~<glib/g¡dio.h
>

48 
	~<gmoduË.h
>

50 #undeà
GTK_DISABLE_DEPRECATED


51 #ifdeà
GNOME


52 
	~<gnome.h
>

54 
	~<gtk/gtk.h
>

57 
	~<libxml/Œ“.h
>

58 
	~<libxml/·r£r.h
>

59 
	~<libxml/xmlmemÜy.h
>

61 
	~"gtkw¿pbox.h
"

63 
	~"dŸ_dœs.h
"

64 
	~"dŸ_xml_libxml.h
"

65 
	~"¶ug-šs.h
"

66 
	~"objeù.h
"

68 
	~"š‹rçû.h
"

69 
	~"mes§ge.h
"

70 
	~"sh“ts.h
"

71 
	~"sh“ts_dŸlog_ÿÎbacks.h
"

72 
	~"sh“ts_dŸlog.h
"

74 
	~"pixm­s/lše_b»ak.xpm
"

75 
	~"š.h
"

77 
GSLi¡
 *
	g¿dio_group
 = 
NULL
;

80 
	$sh“ts_dŸlog_hide
()

82 
	`gtk_widg‘_hide
(
sh“ts_dŸlog
);

83 
	}
}

85 
gboŞ—n


86 
	$Ú_sh“ts_maš_dŸlog_d–‘e_ev’t
 (
GtkWidg‘
 *
widg‘
,

87 
GdkEv’t
 *
ev’t
,

88 
gpoš‹r
 
u£r_d©a
)

90 
	`sh“ts_dŸlog_hide
();

91  
TRUE
;

92 
	}
}

96 
	$sh“ts_dŸlog_up_down_£t_£ns™ive
(
GLi¡
 *
w¿pbox_bu‰Ú_li¡
,

97 
GtkToggËBu‰Ú
 *
toggËbu‰Ú
)

99 
GtkWidg‘
 *
bu‰Ú
;

101 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move_up");

107 ià(!
w¿pbox_bu‰Ú_li¡


108 || 
	`GTK_TOGGLE_BUTTON
(
	`g_li¡_fœ¡
(
w¿pbox_bu‰Ú_li¡
)->
d©a
è=ğ
toggËbu‰Ú


109 || (!
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
toggËbu‰Ú
), "sheet_object_mod")

110 && 
	`g_li¡_Áh
(
w¿pbox_bu‰Ú_li¡
, 1)

111 && 
	`GTK_TOGGLE_BUTTON
(
	`g_li¡_Áh
(
w¿pbox_bu‰Ú_li¡
, 1)->
d©a
)

112 =ğ
toggËbu‰Ú
))

113 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

115 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
TRUE
);

117 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move_down");

118 ià(!
w¿pbox_bu‰Ú_li¡


119 || 
	`GTK_TOGGLE_BUTTON
(
	`g_li¡_Ï¡
(
w¿pbox_bu‰Ú_li¡
)->
d©a
è=ğ
toggËbu‰Ú


120 || (!
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
toggËbu‰Ú
), "sheet_object_mod")

121 && 
	`g_li¡_´evious
(
	`g_li¡_Ï¡
(
w¿pbox_bu‰Ú_li¡
))

122 && 
	`GTK_TOGGLE_BUTTON
(
	`g_li¡_´evious
(
	`g_li¡_Ï¡
(
w¿pbox_bu‰Ú_li¡
))

123 ->
d©a
)

124 =ğ
toggËbu‰Ú
))

125 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

127 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
TRUE
);

128 
	}
}

131 
	$Ú_sh“ts_dŸlog_objeù_bu‰Ú_toggËd
(
GtkToggËBu‰Ú
 *
toggËbu‰Ú
,

132 
gpoš‹r
 
ud_w¿pbox
)

134 
GLi¡
 *
w¿pbox_bu‰Ú_li¡
;

135 
GtkWidg‘
 *
bu‰Ú
;

136 
GtkWidg‘
 *
bË_sh“ts
;

137 
GtkWidg‘
 *
İtiÚm’u_Ëá
;

138 
GtkWidg‘
 *
İtiÚm’u_right
;

139 
gch¬
 *
sh“t_Ëá
;

140 
gch¬
 *
sh“t_right
;

142 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
toggËbu‰Ú
)è=ğ
FALSE
)

147 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
ud_w¿pbox
), "aùive_bu‰Ú", 
toggËbu‰Ú
);

151 
bË_sh“ts
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "table_sheets");

152 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
bË_sh“ts
), "aùive_w¿pbox", 
ud_w¿pbox
);

154 
İtiÚm’u_Ëá
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "optionmenu_left");

155 
sh“t_Ëá
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
İtiÚm’u_Ëá
),

158 
İtiÚm’u_right
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "optionmenu_right");

159 
sh“t_right
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
İtiÚm’u_right
),

162 ià((
gboŞ—n
)
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
ud_w¿pbox
), "is_Ëá"è==
TRUE
)

164 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
bË_sh“ts
), "active_optionmenu",

165 
İtiÚm’u_Ëá
);

166 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_copy");

167 
	`gtk_objeù_£t
(
	`GTK_OBJECT
(
bu‰Ú
), "Ïb–", 
	`_
("Cİy ->"), 
NULL
);

168 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_copy_all");

169 
	`gtk_objeù_£t
(
	`GTK_OBJECT
(
bu‰Ú
), "Ïb–", 
	`_
("Cİy AÎ ->"), 
NULL
);

170 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move");

171 
	`gtk_objeù_£t
(
	`GTK_OBJECT
(
bu‰Ú
), "Ïb–", 
	`_
("Mov->"), 
NULL
);

172 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move_all");

173 
	`gtk_objeù_£t
(
	`GTK_OBJECT
(
bu‰Ú
), "Ïb–", 
	`_
("MovAÎ ->"), 
NULL
);

177 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
bË_sh“ts
), "active_optionmenu",

178 
İtiÚm’u_right
);

179 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_copy");

180 
	`gtk_objeù_£t
(
	`GTK_OBJECT
(
bu‰Ú
), "Ïb–", 
	`_
("<- Cİy"), 
NULL
);

181 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_copy_all");

182 
	`gtk_objeù_£t
(
	`GTK_OBJECT
(
bu‰Ú
), "Ïb–", 
	`_
("<- Cİy AÎ"), 
NULL
);

183 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move");

184 
	`gtk_objeù_£t
(
	`GTK_OBJECT
(
bu‰Ú
), "Ïb–", 
	`_
("<- Move"), 
NULL
);

185 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move_all");

186 
	`gtk_objeù_£t
(
	`GTK_OBJECT
(
bu‰Ú
), "Ïb–", 
	`_
("<- MovAÎ"), 
NULL
);

189 
sh“t_Ëá
 = sheet_left ? sheet_left : "";

191 ià(!
	`¡rcmp
(
sh“t_Ëá
, 
sh“t_right
)

192 || 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
toggËbu‰Ú
), "is_hidden_button")

193 || !
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
toggËbu‰Ú
), "sheet_object_mod"))

195 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_copy");

196 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

197 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_copy_all");

198 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

199 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move");

200 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

201 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move_all");

202 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

206 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_copy");

207 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
TRUE
);

208 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_copy_all");

209 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
TRUE
);

210 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move");

211 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
TRUE
);

212 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move_all");

213 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
TRUE
);

216 
w¿pbox_bu‰Ú_li¡
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(
ud_w¿pbox
));

218 ià(
	`g_li¡_Ëngth
(
w¿pbox_bu‰Ú_li¡
))

220 
Sh“tMod
 *
sm
;

222 
	`sh“ts_dŸlog_up_down_£t_£ns™ive
(
w¿pbox_bu‰Ú_li¡
, 
toggËbu‰Ú
);

224 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
toggËbu‰Ú
), "sheet_mod");

226 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_edit");

227 ià(!
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
toggËbu‰Ú
), "sheet_object_mod")

228 && 
sm
->
sh“t
.
scİe
 =ğ
SHEET_SCOPE_SYSTEM
)

229 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

231 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
TRUE
);

233 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_remove");

234 ià(
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
toggËbu‰Ú
), "is_hidden_button")

235 && 
sm
->
sh“t
.
shadowšg
 =ğ
NULL


236 && 
sm
->
sh“t
.
scİe
 =ğ
SHEET_SCOPE_SYSTEM
)

237 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

239 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
TRUE
);

243 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move_up");

244 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

245 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_move_down");

246 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

247 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_edit");

248 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

249 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_remove");

250 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
FALSE
);

252 
	`g_li¡_ä“
(
w¿pbox_bu‰Ú_li¡
);

253 
	}
}

256 
	$sh“ts_dŸlog_w¿pbox_add_lše_b»ak
(
GtkWidg‘
 *
w¿pbox
)

258 
Sh“tMod
 *
sm
;

259 
GtkWidg‘
 *
bu‰Ú
;

260 
GtkStyË
 *
¡yË
;

261 
GdkPixm­
 *
pixm­
, *
mask
;

262 
GtkWidg‘
 *
gtkpixm­
;

264 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "sheet_mod");

265 
	`g_as£¹
(
sm
);

267 
bu‰Ú
 = 
	`gtk_¿dio_bu‰Ú_Ãw
(
¿dio_group
);

268 
	`gtk_bu‰Ú_£t_»l›f
(
	`GTK_BUTTON
(
bu‰Ú
), 
GTK_RELIEF_NONE
);

270 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
bu‰Ú
), "sh“t_mod", 
sm
);

272 
¿dio_group
 = 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(
bu‰Ú
));

274 
	`gtk_toggË_bu‰Ú_£t_mode
(
	`GTK_TOGGLE_BUTTON
(
bu‰Ú
), 
FALSE
);

275 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
bu‰Ú
), 0);

277 
¡yË
 = 
	`gtk_widg‘_g‘_¡yË
(
w¿pbox
);

278 
pixm­
 =

279 
	`gdk_pixm­_cŞÜm­_ü—‹_äom_xpm_d
(
NULL
,

280 
	`gtk_widg‘_g‘_cŞÜm­
(
w¿pbox
),

281 &
mask
,

282 &
¡yË
->
bg
[
GTK_STATE_NORMAL
],

283 
lše_b»ak_xpm
);

285 
gtkpixm­
 = 
	`gtk_pixm­_Ãw
(
pixm­
, 
mask
);

286 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
bu‰Ú
), 
gtkpixm­
);

287 
	`gtk_widg‘_show
(
gtkpixm­
);

289 
	`gtk_w¿p_box_·ck
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
bu‰Ú
, 
FALSE
, 
TRUE
, FALSE, TRUE);

290 
	`gtk_widg‘_show
(
bu‰Ú
);

292 
	`gtk_toŞts_£t_t
(
sh“ts_dŸlog_toŞts
, 
bu‰Ú
, 
	`_
("LšB»ak"), 
NULL
);

294 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
bu‰Ú
), "toggled",

295 
	`G_CALLBACK
(
Ú_sh“ts_dŸlog_objeù_bu‰Ú_toggËd
),

296 
w¿pbox
);

297 
	}
}

300 
	$sh“ts_dŸlog_objeù_£t_toŞt
(
Sh“tObjeùMod
 *
som
, 
GtkWidg‘
 *
bu‰Ú
)

302 
gch¬
 *
t
;

304 
som
->
ty³
){

305 
OBJECT_TYPE_SVG
:

306 
t
 = 
	`g_¡rdup_´štf
(
	`_
("%s\nSh­e"), 
som
->
sh“t_objeù
.
desütiÚ
);

308 
OBJECT_TYPE_PROGRAMMED
:

309 
t
 = 
	`g_¡rdup_´štf
(
	`_
("%s\nObjeù"), 
som
->
sh“t_objeù
.
desütiÚ
);

312 
t
 = 
	`g_¡rdup_´štf
(
	`_
("%s\nUÇssigÃdy³"), 
som
->
sh“t_objeù
.
desütiÚ
);

316 
	`gtk_toŞts_£t_t
(
sh“ts_dŸlog_toŞts
, 
bu‰Ú
, 
t
, 
NULL
);

317 
	`g_ä“
(
t
);

318 
	}
}

320 
GtkWidg‘
 *

321 
	$sh“ts_dŸlog_ü—‹_objeù_bu‰Ú
(
Sh“tObjeùMod
 *
som
, 
Sh“tMod
 *
sm
,

322 
GtkWidg‘
 *
w¿pbox
)

324 
GtkWidg‘
 *
bu‰Ú
;

325 
GdkPixm­
 *
pixm­
, *
mask
;

326 
GtkWidg‘
 *
gtkpixm­
;

328 
bu‰Ú
 = 
	`gtk_¿dio_bu‰Ú_Ãw
(
¿dio_group
);

329 
¿dio_group
 = 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(
bu‰Ú
));

331 
	`gtk_toggË_bu‰Ú_£t_mode
(
	`GTK_TOGGLE_BUTTON
(
bu‰Ú
), 
FALSE
);

332 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
bu‰Ú
), 0);

334 
	`ü—‹_objeù_pixm­
(&
som
->
sh“t_objeù
, 
w¿pbox
, &
pixm­
, &
mask
);

335 
gtkpixm­
 = 
	`gtk_pixm­_Ãw
(
pixm­
, 
mask
);

336 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
bu‰Ú
), 
gtkpixm­
);

337 
	`gtk_widg‘_show
(
gtkpixm­
);

339 
	`sh“ts_dŸlog_objeù_£t_toŞt
(
som
, 
bu‰Ú
);

341 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
bu‰Ú
), "sh“t_mod", 
sm
);

342 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
bu‰Ú
), "sh“t_objeù_mod", 
som
);

344 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
bu‰Ú
), "toggled",

345 
	`G_CALLBACK
(
Ú_sh“ts_dŸlog_objeù_bu‰Ú_toggËd
),

346 
w¿pbox
);

347  
bu‰Ú
;

348 
	}
}

350 
gboŞ—n
 
	gİtiÚm’u_aùiv©e_fœ¡_·ss
 = 
TRUE
;

353 
	$Ú_sh“ts_dŸlog_İtiÚm’u_aùiv©e
 (
GtkM’uI‹m
 *
m’u™em
,

354 
gpoš‹r
 
u£r_d©a
)

356 
GtkWidg‘
 *
w¿pbox
;

357 
Sh“t
 *
sh“t
;

358 
GtkWidg‘
 *
İtiÚm’u
;

359 
GSLi¡
 *
objeù_mod_li¡
;

360 
GtkWidg‘
 *
hidd’_bu‰Ú
;

361 
GLi¡
 *
bu‰Ú_li¡
;

363 
sh“t
 = &(((
Sh“tMod
 *)(
u£r_d©a
))->sheet);

365 
w¿pbox
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
m’u™em
), "wrapbox");

366 
	`g_as£¹
(
w¿pbox
);

371 ià(
İtiÚm’u_aùiv©e_fœ¡_·ss
)

373 
hidd’_bu‰Ú
 = 
	`gtk_¿dio_bu‰Ú_Ãw
(
NULL
);

374 
İtiÚm’u_aùiv©e_fœ¡_·ss
 = 
FALSE
;

378 
hidd’_bu‰Ú
 = 
	`gtk_¿dio_bu‰Ú_Ãw
(
¿dio_group
);

379 
¿dio_group
 = 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(
hidd’_bu‰Ú
));

382 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
hidd’_bu‰Ú
), "toggled",

383 
	`G_CALLBACK
(
Ú_sh“ts_dŸlog_objeù_bu‰Ú_toggËd
),

384 
w¿pbox
);

385 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
hidd’_bu‰Ú
), "is_hidden_button",

386 (
gpoš‹r
)
TRUE
);

387 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "hidd’_bu‰Ú", 
hidd’_bu‰Ú
);

388 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
hidd’_bu‰Ú
), "sh“t_mod", 
u£r_d©a
);

390 ià(
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "is_left"))

391 
İtiÚm’u
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "optionmenu_left");

393 
İtiÚm’u
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "optionmenu_right");

394 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
İtiÚm’u
), "aùive_sh“t_Çme", 
sh“t
->
Çme
);

396 
	`gtk_cÚš”_fÜ—ch
(
	`GTK_CONTAINER
(
w¿pbox
),

397 (
GtkC®lback
)
gtk_widg‘_de¡roy
, 
NULL
);

399 
¿dio_group
 = 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(
hidd’_bu‰Ú
));

401 
	`gtk_w¿p_box_£t_a¥eù_¿tio
(
	`GTK_WRAP_BOX
(
w¿pbox
), 4 * 1.0 / 9);

403 #ifdeà
CHANGE_COLOUR_OF_MODIFIED_SHEETS


405 
GtkRcStyË
 *
¡yË
;

407 
¡yË
->
fg
[0].
»d
 = styË->
bg
[0].red = 56000;

408 
¡yË
->
fg
[1].
»d
 = styË->
bg
[1].red = 56000;

409 
¡yË
->
fg
[2].
»d
 = styË->
bg
[2].red = 56000;

410 
¡yË
->
fg
[3].
»d
 = styË->
bg
[3].red = 56000;

411 
¡yË
->
fg
[4].
»d
 = styË->
bg
[4].red = 56000;

412 
¡yË
->
cŞÜ_æags
[0] |= 0x0f;

413 
¡yË
->
cŞÜ_æags
[1] |= 0x0f;

414 
¡yË
->
cŞÜ_æags
[2] |= 0x0f;

415 
¡yË
->
cŞÜ_æags
[3] |= 0x0f;

416 
¡yË
->
cŞÜ_æags
[4] |= 0x0f;

418 
sw
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "scrolledwindow_right");

419 
	`gtk_widg‘_modify_¡yË
(
w¿pbox
, 
¡yË
);

423 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "sh“t_mod", 
u£r_d©a
);

425 
objeù_mod_li¡
 = 
sh“t
->
objeùs
; object_mod_list;

426 
objeù_mod_li¡
 = 
	`g_¦i¡_Ãxt
(object_mod_list))

428 
GtkWidg‘
 *
bu‰Ú
;

429 
Sh“tObjeùMod
 *
som
;

431 
som
 = 
objeù_mod_li¡
->
d©a
;

432 ià(
som
->
mod
 =ğ
SHEET_OBJECT_MOD_DELETED
)

435 ià(
som
->
sh“t_objeù
.
lše_b»ak
 =ğ
TRUE
)

436 
	`sh“ts_dŸlog_w¿pbox_add_lše_b»ak
(
w¿pbox
);

438 
bu‰Ú
 = 
	`sh“ts_dŸlog_ü—‹_objeù_bu‰Ú
(
som
, 
u£r_d©a
, 
w¿pbox
);

440 
	`gtk_w¿p_box_·ck_w¿µed
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
bu‰Ú
,

441 
FALSE
, 
TRUE
, FALSE, TRUE, 
som
->
sh“t_objeù
.
lše_b»ak
);

443 
	`gtk_widg‘_show
(
bu‰Ú
);

446 
bu‰Ú_li¡
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(
w¿pbox
));

448 ià(
	`g_li¡_Ëngth
(
bu‰Ú_li¡
))

450 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
hidd’_bu‰Ú
), 
TRUE
);

451 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
bu‰Ú_li¡
->
d©a
), 
TRUE
);

454 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
hidd’_bu‰Ú
), 
TRUE
);

456 
	`g_li¡_ä“
(
bu‰Ú_li¡
);

457 
	}
}

460 
	$sh“ts_dŸlog_­¶y_»v”t_£t_£ns™ive
(
gboŞ—n
 
is_£ns™ive
)

462 
GtkWidg‘
 *
bu‰Ú
;

464 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_apply");

465 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
is_£ns™ive
);

467 
bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "button_revert");

468 
	`gtk_widg‘_£t_£ns™ive
(
bu‰Ú
, 
is_£ns™ive
);

469 
	}
}

473 
	mSHEETS_DIALOG_MOVE_UP
 = -1,

474 
	mSHEETS_DIALOG_MOVE_DOWN
 = +1

476 
	tSh“tsDŸlogMoveDœ
;

478 
SHEETS_DIALOG_MOVE_NONE
 
SHEETS_DIALOG_MOVE_UP


481 
	$_gtk_w¿p_box_£t_chd_fÜûd_b»ak
 (
GtkW¿pBox
* 
box
, 
GtkWidg‘
* 
chd
,

482 
gboŞ—n
 
w¿µed
)

484 
gboŞ—n
 
hex·nd
, 
hfl
, 
vex·nd
, 
vfl
, 
dummy
;

486 
	`gtk_w¿p_box_qu”y_chd_·ckšg
 (
box
, 
chd
, &
hex·nd
, &
hfl
,

487 &
vex·nd
, &
vfl
, &
dummy
);

488 
	`gtk_w¿p_box_£t_chd_·ckšg
 (
box
, 
chd
, 
hex·nd
, 
hfl
,

489 
vex·nd
, 
vfl
, 
w¿µed
);

490 
	}
}

492 
	$sh“ts_dŸlog_nÜm®ize_lše_b»aks
(
GtkWidg‘
 *
w¿pbox
, 
Sh“tsDŸlogMoveDœ
 
dœ
)

494 
GLi¡
 *
bu‰Ú_li¡
;

495 
GLi¡
 *
™”_li¡
;

496 
gboŞ—n
 
is_lše_b»ak
;

498 
bu‰Ú_li¡
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(
w¿pbox
));

500 
is_lše_b»ak
 = 
FALSE
;

501 
™”_li¡
 = 
bu‰Ú_li¡
; i‹r_li¡; i‹r_li¡ = 
	`g_li¡_Ãxt
(iter_list))

503 
Sh“tMod
 *
sm
;

504 
Sh“tObjeùMod
 *
som
;

506 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
™”_li¡
->
d©a
), "sheet_mod");

507 
som
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
™”_li¡
->
d©a
), "sheet_object_mod");

508 ià(
som
)

510 ià(
is_lše_b»ak
)

512 ià(
som
->
sh“t_objeù
.
lše_b»ak
 =ğ
FALSE
)

514 ià(
sm
->
mod
 =ğ
SHEETMOD_MOD_NONE
)

515 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

517 
som
->
mod
 = 
SHEET_OBJECT_MOD_CHANGED
;

520 
som
->
sh“t_objeù
.
lše_b»ak
 = 
TRUE
;

521 
	`_gtk_w¿p_box_£t_chd_fÜûd_b»ak
(
	`GTK_WRAP_BOX
(
w¿pbox
),

522 
	`GTK_WIDGET
(
™”_li¡
->
d©a
), 
TRUE
);

526 ià(
som
->
sh“t_objeù
.
lše_b»ak
 =ğ
TRUE
)

528 ià(
sm
->
mod
 =ğ
SHEETMOD_MOD_NONE
)

529 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

530 
som
->
mod
 = 
SHEET_OBJECT_MOD_CHANGED
;

533 
som
->
sh“t_objeù
.
lše_b»ak
 = 
FALSE
;

534 
	`_gtk_w¿p_box_£t_chd_fÜûd_b»ak
(
	`GTK_WRAP_BOX
(
w¿pbox
),

535 
	`GTK_WIDGET
(
™”_li¡
->
d©a
), 
FALSE
);

537 
is_lše_b»ak
 = 
FALSE
;

541 ià(
is_lše_b»ak
)

543 ià(
dœ
 =ğ
SHEETS_DIALOG_MOVE_UP
)

545 
™”_li¡
 = 
	`g_li¡_´evious
(iter_list);

546 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
™”_li¡
->
d©a
));

547 
™”_li¡
 = 
	`g_li¡_Ãxt
(iter_list);

548 
¿dio_group
 = 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(
™”_li¡


549 ->
d©a
));

553 
GLi¡
 *
tmp_li¡
;

555 
tmp_li¡
 = 
	`g_li¡_´evious
(
™”_li¡
);

556 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
™”_li¡
->
d©a
));

557 
¿dio_group
 = 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(
tmp_li¡


558 ->
d©a
));

562 
is_lše_b»ak
 = 
TRUE
;

568 
™”_li¡
 = 
	`g_li¡_Ï¡
(
bu‰Ú_li¡
);

569 ià(
™”_li¡
 && !
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(™”_li¡->
d©a
),

572 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
™”_li¡
->
d©a
));

573 ià(
	`g_li¡_´evious
(
™”_li¡
))

575 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`g_li¡_´evious
(
™”_li¡
)->
d©a
, 
TRUE
);

576 
¿dio_group
 = 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(

577 
	`g_li¡_´evious
(
™”_li¡
)->
d©a
));

581 
	`g_li¡_ä“
(
bu‰Ú_li¡
);

582 
	}
}

584 
GtkWidg‘
 *

585 
	$sh“ts_dŸlog_g‘_aùive_bu‰Ú
(
GtkWidg‘
 **
w¿pbox
, 
GLi¡
 **
bu‰Ú_li¡
)

587 
GtkWidg‘
 *
bË_sh“ts
;

589 
bË_sh“ts
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "table_sheets");

590 *
w¿pbox
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
bË_sh“ts
), "active_wrapbox");

591 *
bu‰Ú_li¡
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(*
w¿pbox
));

592  
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(*
w¿pbox
), "active_button");

593 
	}
}

597 
	$sh“ts_dŸlog_move_up_Ü_down
(
Sh“tsDŸlogMoveDœ
 
dœ
)

599 
GtkWidg‘
 *
bË_sh“ts
;

600 
GtkWidg‘
 *
w¿pbox
;

601 
GLi¡
 *
bu‰Ú_li¡
;

602 
GtkWidg‘
 *
aùive_bu‰Ú
;

603 
gšt
 
bu‰Ú_pos
;

604 
Sh“tObjeùMod
 *
som
;

605 
Sh“tObjeùMod
 *
som_Ãxt
;

606 
GLi¡
 *
Ãxt_bu‰Ú_li¡
;

608 
bË_sh“ts
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "table_sheets");

609 
w¿pbox
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
bË_sh“ts
), "active_wrapbox");

611 
bu‰Ú_li¡
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(
w¿pbox
));

612 
aùive_bu‰Ú
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "active_button");

614 
bu‰Ú_pos
 = 
	`g_li¡_šdex
(
bu‰Ú_li¡
, 
aùive_bu‰Ú
);

615 
	`gtk_w¿p_box_»Üd”_chd
(
	`GTK_WRAP_BOX
(
w¿pbox
),

616 
	`GTK_WIDGET
(
aùive_bu‰Ú
), 
bu‰Ú_pos
 + 
dœ
);

617 
	`g_li¡_ä“
(
bu‰Ú_li¡
);

619 
	`sh“ts_dŸlog_nÜm®ize_lše_b»aks
(
w¿pbox
, 
dœ
);

623 
bu‰Ú_li¡
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(
w¿pbox
));

624 
aùive_bu‰Ú
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "active_button");

626 
som
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_object_mod");

628 
Ãxt_bu‰Ú_li¡
 = 
	`g_li¡_Ãxt
(
	`g_li¡_fšd
(
bu‰Ú_li¡
, 
aùive_bu‰Ú
));

629 ià(
Ãxt_bu‰Ú_li¡
)

630 
som_Ãxt
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
Ãxt_bu‰Ú_li¡
->
d©a
),

633 
som_Ãxt
 = 
NULL
;

641 ià(
som
 && (((
dœ
 =ğ
SHEETS_DIALOG_MOVE_DOWN
)

642 && (
som
->
sh“t_objeù
.
lše_b»ak
 =ğ
FALSE
))

643 || (((
dœ
 =ğ
SHEETS_DIALOG_MOVE_UP
)

644 && 
som_Ãxt
))))

646 
Sh“tMod
 *
sm
;

647 
GSLi¡
 *
objeù_li¡
;

648 
gšt
 
objeù_pos
;

650 
som
->
mod
 = 
SHEET_OBJECT_MOD_CHANGED
;

652 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod");

653 ià(
sm
->
mod
 =ğ
SHEETMOD_MOD_NONE
)

654 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

656 
objeù_li¡
 = 
	`g_¦i¡_fšd
(
sm
->
sh“t
.
objeùs
, 
som
);

657 
	`g_as£¹
(
objeù_li¡
);

659 
objeù_pos
 = 
	`g_¦i¡_pos™iÚ
(
sm
->
sh“t
.
objeùs
, 
objeù_li¡
);

660 
sm
->
sh“t
.
objeùs
 = 
	`g_¦i¡_»move_lšk
(sm->sh“t.objeùs, 
objeù_li¡
);

661 
sm
->
sh“t
.
objeùs
 = 
	`g_¦i¡_š£¹
(sm->sh“t.objeùs, 
objeù_li¡
->
d©a
,

662 
objeù_pos
 + 
dœ
);

665 
	`sh“ts_dŸlog_­¶y_»v”t_£t_£ns™ive
(
TRUE
);

667 
	`sh“ts_dŸlog_up_down_£t_£ns™ive
(
bu‰Ú_li¡
,

668 
	`GTK_TOGGLE_BUTTON
(
aùive_bu‰Ú
));

669 
	`g_li¡_ä“
(
bu‰Ú_li¡
);

670 
	}
}

673 
	$Ú_sh“ts_dŸlog_bu‰Ú_move_up_şicked
(
GtkBu‰Ú
 *
bu‰Ú
, 
gpoš‹r
 
u£r_d©a
)

675 
	`sh“ts_dŸlog_move_up_Ü_down
(
SHEETS_DIALOG_MOVE_UP
);

676 
	}
}

679 
	$Ú_sh“ts_dŸlog_bu‰Ú_move_down_şicked
(
GtkBu‰Ú
 *
bu‰Ú
, 
gpoš‹r
 
u£r_d©a
)

681 
	`sh“ts_dŸlog_move_up_Ü_down
(
SHEETS_DIALOG_MOVE_DOWN
);

682 
	}
}

685 
	$Ú_sh“ts_dŸlog_bu‰Ú_şo£_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

686 
gpoš‹r
 
u£r_d©a
)

688 
	`sh“ts_dŸlog_hide
();

689 
	}
}

691 
GtkWidg‘
 *
	gsh“ts_Ãw_dŸlog
;

695 
	mSHEETS_NEW_DIALOG_TYPE_SVG_SHAPE
 = 1,

696 
	mSHEETS_NEW_DIALOG_TYPE_LINE_BREAK
,

697 
	mSHEETS_NEW_DIALOG_TYPE_SHEET


699 
	tSh“tsNewDŸlogTy³
;

701 
GLi¡
 *
	gsh“ts_Ãw_dŸlog_combo_li¡
 = 
NULL
;

704 
	$Ú_sh“ts_dŸlog_bu‰Ú_Ãw_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

705 
gpoš‹r
 
u£r_d©a
)

707 
GtkWidg‘
 *
combo
;

708 
GtkWidg‘
 *
w¿pbox
;

709 
GLi¡
 *
bu‰Ú_li¡
;

710 
GtkWidg‘
 *
aùive_bu‰Ú
;

711 
gboŞ—n
 
is_lše_b»ak_£ns™ive
;

713 
sh“ts_Ãw_dŸlog
 = 
	`ü—‹_sh“ts_Ãw_dŸlog
();

715 ià(
sh“ts_Ãw_dŸlog_combo_li¡
)

717 
combo
 = 
	`lookup_widg‘
(
sh“ts_Ãw_dŸlog
, "combo_from_file");

718 
	`gtk_combo_£t_pİdown_¡ršgs
(
	`GTK_COMBO
(
combo
),

719 
sh“ts_Ãw_dŸlog_combo_li¡
);

724 
aùive_bu‰Ú
 = 
	`sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

725 
is_lše_b»ak_£ns™ive
 = 
TRUE
;

726 ià(
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod"))

728 
bu‰Ú_li¡
 = 
	`g_li¡_Ãxt
(
	`g_li¡_fšd
(bu‰Ú_li¡, 
aùive_bu‰Ú
));

729 ià(!
bu‰Ú_li¡
 || !
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(bu‰Ú_li¡->
d©a
),

731 
is_lše_b»ak_£ns™ive
 = 
FALSE
;

732 
	`g_li¡_ä“
(
bu‰Ú_li¡
);

735 
is_lše_b»ak_£ns™ive
 = 
FALSE
;

737 
aùive_bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_Ãw_dŸlog
, "radiobutton_line_break");

738 
	`gtk_widg‘_£t_£ns™ive
(
aùive_bu‰Ú
, 
is_lše_b»ak_£ns™ive
);

742 
aùive_bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_Ãw_dŸlog
, "button_ok");

743 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "active_type",

744 (
gpoš‹r
)
SHEETS_NEW_DIALOG_TYPE_SVG_SHAPE
);

746 
	`gtk_widg‘_show
(
sh“ts_Ãw_dŸlog
);

747 
	}
}

750 
	gÚ_sh“ts_Ãw_dŸlog_bu‰Ú_ÿnûl_şicked


751 (
GtkBu‰Ú
 *
	gbu‰Ú
,

752 
gpoš‹r
 
	gu£r_d©a
)

754 
gtk_widg‘_de¡roy
(
sh“ts_Ãw_dŸlog
);

755 
	gsh“ts_Ãw_dŸlog
 = 
NULL
;

759 
	$Ú_sh“ts_Ãw_dŸlog_bu‰Ú_ok_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

760 
gpoš‹r
 
u£r_d©a
)

762 
Sh“tsNewDŸlogTy³
 
aùive_ty³
;

763 
GtkWidg‘
 *
bË_sh“ts
;

764 
GtkWidg‘
 *
w¿pbox
;

765 
GLi¡
 *
bu‰Ú_li¡
;

766 
GtkWidg‘
 *
aùive_bu‰Ú
;

768 
bË_sh“ts
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "table_sheets");

769 
w¿pbox
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
bË_sh“ts
), "active_wrapbox");

771 
aùive_ty³
 = (
Sh“tsNewDŸlogTy³
)
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
bu‰Ú
),

773 
	`g_as£¹
(
aùive_ty³
);

775 
aùive_ty³
)

777 
GtkWidg‘
 *
’Œy
;

778 
gch¬
 *
fe_Çme
;

779 
gch¬
 *
p
;

780 
¡©
 
¡©_buf
;

781 
GLi¡
 *
¶ugš_li¡
;

782 
DŸObjeùTy³
 *
Ù
;

783 
	`gboŞ—n
 (*
	tCu¡omObjeùLßdFunc
è(
	tgch¬
*, 
	tDŸObjeùTy³
 **);

784 
Cu¡omObjeùLßdFunc
 
cu¡om_objeù_lßd_â
;

785 
gšt
 
pos
;

786 
GtkWidg‘
 *
aùive_bu‰Ú
;

787 
GLi¡
 *
bu‰Ú_li¡
;

788 
Sh“tObjeùMod
 *
som
;

789 
Sh“tMod
 *
sm
;

790 
Sh“tObjeù
 *
sh“t_obj
;

791 
Sh“t
 *
sh“t
;

792 
GtkWidg‘
 *
İtiÚm’u
;

794 
SHEETS_NEW_DIALOG_TYPE_SVG_SHAPE
:

796 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_Ãw_dŸlog
, "combo_entry_from_file");

798 
fe_Çme
 = 
	`gtk_ed™abË_g‘_ch¬s
(
	`GTK_EDITABLE
(
’Œy
), 0, -1);

800 
p
 = 
fe_Çme
 + 
	`¡¾’
(file_name) - 6;

801 ià(
	`¡rcmp
(
p
, ".shape"))

803 
	`mes§ge_”rÜ
(
	`_
("Filename mustƒnd with '%s': '%s'"),

804 ".sh­e", 
	`dŸ_mes§ge_f’ame
(
fe_Çme
));

805 
	`g_ä“
(
fe_Çme
);

809 ià(
	`g_¡©
(
fe_Çme
, &
¡©_buf
) == -1)

811 
	`mes§ge_”rÜ
(
	`_
("Errorƒxamining %s: %s"),

812 
	`dŸ_mes§ge_f’ame
(
fe_Çme
), 
	`¡»¼Ü
(
”ºo
));

813 
	`g_ä“
(
fe_Çme
);

817 
cu¡om_objeù_lßd_â
 = 
NULL
;

818 
¶ugš_li¡
 = 
	`dŸ_li¡_¶ugšs
();…lugš_li¡ !ğ
NULL
;

819 
¶ugš_li¡
 = 
	`g_li¡_Ãxt
(plugin_list))

821 
PlugšInfo
 *
šfo
 = 
¶ugš_li¡
->
d©a
;

823 
cu¡om_objeù_lßd_â
 =

824 (
Cu¡omObjeùLßdFunc
)
	`dŸ_¶ugš_g‘_symbŞ
 (
šfo
, "custom_object_load");

825 ià(
cu¡om_objeù_lßd_â
)

828 
	`g_as£¹
(
cu¡om_objeù_lßd_â
);

830 ià(!(*
cu¡om_objeù_lßd_â
)(
fe_Çme
, &
Ù
))

832 
xmlDoc
 *
doc
 = 
NULL
;

833 
xmlNode
 *
roÙ_–em’t
 = 
NULL
;

836 
doc
 = 
	`xmlR—dFe
(
fe_Çme
, 
NULL
, 0);

837 if(
doc
 !ğ
NULL
)

839 
roÙ_–em’t
 = 
	`xmlDocG‘RoÙEËm’t
(
doc
);

840 if(0 =ğ
	`g_¡ºÿ£cmp
((
gch¬
 *)
roÙ_–em’t
->
Çme
, "dia", 3))

841 
	`mes§ge_”rÜ
(

842 
	`_
("Pleaseƒxporthe diagram‡s‡ shape."));

843 
	`xmlF»eDoc
(
doc
);

845 
	`mes§ge_”rÜ
(
	`_
("Could‚ot interpret shape file: '%s'"),

846 
	`dŸ_mes§ge_f’ame
(
fe_Çme
));

847 
	`xmlCËªupP¬£r
();

848 
	`g_ä“
(
fe_Çme
);

851 
	`objeù_»gi¡”_ty³
(
Ù
);

853 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_Ãw_dŸlog
, "entry_svg_description");

854 
sh“t_obj
 = 
	`g_Ãw0
(
Sh“tObjeù
, 1);

855 
sh“t_obj
->
objeù_ty³
 = 
	`g_¡rdup
(
Ù
->
Çme
);

857 
sh“t_obj
->
desütiÚ
 =

858 
	`gtk_ed™abË_g‘_ch¬s
(
	`GTK_EDITABLE
(
’Œy
), 0, -1);

860 
sh“t_obj
->
pixm­
 = 
Ù
->pixmap;

861 
sh“t_obj
->
u£r_d©a
 = 
Ù
->
deçuÉ_u£r_d©a
;

862 
sh“t_obj
->
u£r_d©a_ty³
 = 
USER_DATA_IS_OTHER
;

863 
sh“t_obj
->
lše_b»ak
 = 
FALSE
;

864 
sh“t_obj
->
pixm­_fe
 = 
	`g_¡rdup
(
Ù
->pixmap_file);

865 
sh“t_obj
->
has_icÚ_Ú_sh“t
 = 
FALSE
;

867 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "sheet_mod");

868 
som
 = 
	`sh“ts_­³nd_sh“t_objeù_mod
(
sh“t_obj
, 
sm
);

869 
som
->
mod
 = 
SHEET_OBJECT_MOD_NEW
;

870 
som
->
svg_f’ame
 = 
	`g_¡rdup
(
fe_Çme
);

871 ià(
sm
->
mod
 =ğ
SHEETMOD_MOD_NONE
)

872 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

874 
aùive_bu‰Ú
 = 
	`sh“ts_dŸlog_ü—‹_objeù_bu‰Ú
(
som
, 
sm
, 
w¿pbox
);

875 
	`gtk_w¿p_box_·ck
(
	`GTK_WRAP_BOX
(
w¿pbox
), 
aùive_bu‰Ú
,

876 
FALSE
, 
TRUE
, FALSE, TRUE);

877 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
aùive_bu‰Ú
), 
TRUE
);

878 
	`gtk_widg‘_show
(
aùive_bu‰Ú
);

880 
sh“ts_Ãw_dŸlog_combo_li¡
 = 
	`g_li¡_­³nd
(sheets_new_dialog_combo_list,

881 
fe_Çme
);

884 
SHEETS_NEW_DIALOG_TYPE_LINE_BREAK
:

886 
	`sh“ts_dŸlog_w¿pbox_add_lše_b»ak
(
w¿pbox
);

888 
bu‰Ú_li¡
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(
w¿pbox
));

889 
aùive_bu‰Ú
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "active_button");

890 
pos
 = 
	`g_li¡_šdex
(
bu‰Ú_li¡
, 
aùive_bu‰Ú
);

891 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
	`g_li¡_Ï¡
(
bu‰Ú_li¡
)

892 ->
d©a
), 
TRUE
);

893 
	`gtk_w¿p_box_»Üd”_chd
(
	`GTK_WRAP_BOX
(
w¿pbox
),

894 
	`g_li¡_Ï¡
(
bu‰Ú_li¡
)->
d©a
, 
pos
 + 1);

896 
	`sh“ts_dŸlog_nÜm®ize_lše_b»aks
(
w¿pbox
, 
SHEETS_DIALOG_MOVE_NONE
);

898 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "sheet_mod");

899 ià(
sm
->
mod
 =ğ
SHEETMOD_MOD_NONE
)

900 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

902 
	`g_li¡_ä“
(
bu‰Ú_li¡
);

905 
SHEETS_NEW_DIALOG_TYPE_SHEET
:

907 
gch¬
 *
sh“t_Çme
;

908 
gch¬
 *
sh“t_desü
;

910 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_Ãw_dŸlog
, "entry_sheet_name");

911 
sh“t_Çme
 = 
	`gtk_ed™abË_g‘_ch¬s
(
	`GTK_EDITABLE
(
’Œy
), 0, -1);

913 
sh“t_Çme
 = 
	`g_¡rchug
(
	`g_¡rchomp
(sheet_name));

914 ià(!*
sh“t_Çme
)

916 
	`mes§ge_”rÜ
(
	`_
("Sheet must have‡ Name"));

920 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_Ãw_dŸlog
, "entry_sheet_description");

921 
sh“t_desü
 = 
	`gtk_ed™abË_g‘_ch¬s
(
	`GTK_EDITABLE
(
’Œy
), 0, -1);

923 
sh“t
 = 
	`g_Ãw0
(
Sh“t
, 1);

924 
sh“t
->
Çme
 = 
sh“t_Çme
;

925 
sh“t
->
f’ame
 = "";

926 
sh“t
->
desütiÚ
 = 
sh“t_desü
;

927 
sh“t
->
scİe
 = 
SHEET_SCOPE_USER
;

928 
sh“t
->
shadowšg
 = 
NULL
;

929 
sh“t
->
objeùs
 = 
NULL
;

931 
sm
 = 
	`sh“ts_­³nd_sh“t_mods
(
sh“t
);

932 
sm
->
mod
 = 
SHEETMOD_MOD_NEW
;

934 
bË_sh“ts
 = 
	`lookup_widg‘
(
sh“ts_dŸlog
, "table_sheets");

935 
İtiÚm’u
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
bË_sh“ts
),

937 
	`g_as£¹
(
İtiÚm’u
);

938 
	`sh“ts_İtiÚm’u_ü—‹
(
İtiÚm’u
, 
w¿pbox
, 
sh“t_Çme
);

943 
	`g_as£¹_nÙ_»ached
();

946 
	`sh“ts_dŸlog_­¶y_»v”t_£t_£ns™ive
(
TRUE
);

948 
bu‰Ú_li¡
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(
w¿pbox
));

949 
aùive_bu‰Ú
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "active_button");

950 
	`sh“ts_dŸlog_up_down_£t_£ns™ive
(
bu‰Ú_li¡
,

951 
	`GTK_TOGGLE_BUTTON
(
aùive_bu‰Ú
));

952 
	`g_li¡_ä“
(
bu‰Ú_li¡
);

954 
	`gtk_widg‘_de¡roy
(
sh“ts_Ãw_dŸlog
);

955 
sh“ts_Ãw_dŸlog
 = 
NULL
;

956 
	}
}

958 
GtkWidg‘
 *
	gsh“ts_sh­e£ËùiÚ_dŸlog
;

961 
	gÚ_sh“ts_Ãw_dŸlog_bu‰Ú_brow£_şicked


962 (
GtkBu‰Ú
 *
	gbu‰Ú
,

963 
gpoš‹r
 
	gu£r_d©a
)

965 
	gsh“ts_sh­e£ËùiÚ_dŸlog
 = 
ü—‹_sh“ts_sh­e£ËùiÚ_dŸlog
();

966 
gtk_widg‘_show
(
sh“ts_sh­e£ËùiÚ_dŸlog
);

970 
	gÚ_sh“ts_sh­e£ËùiÚ_dŸlog_bu‰Ú_ÿnûl_şicked


971 (
GtkBu‰Ú
 *
	gbu‰Ú
,

972 
gpoš‹r
 
	gu£r_d©a
)

974 
gtk_widg‘_de¡roy
(
sh“ts_sh­e£ËùiÚ_dŸlog
);

975 
	gsh“ts_sh­e£ËùiÚ_dŸlog
 = 
NULL
;

979 
	gÚ_sh“ts_sh­e£ËùiÚ_dŸlog_bu‰Ú_ok_şicked


980 (
GtkBu‰Ú
 *
	gbu‰Ú
,

981 
gpoš‹r
 
	gu£r_d©a
)

983 cÚ¡ 
gch¬
 *
	gf’ame
;

984 
GtkWidg‘
 *
	g’Œy
;

986 
	gf’ame
 =

987 
gtk_fe_£ËùiÚ_g‘_f’ame
(

988 
GTK_FILE_SELECTION
(
sh“ts_sh­e£ËùiÚ_dŸlog
));

990 
	g’Œy
 = 
lookup_widg‘
(
sh“ts_Ãw_dŸlog
, "combo_entry_from_file");

992 
gtk_’Œy_£t_‹xt
(
GTK_ENTRY
(
’Œy
), 
f’ame
);

994 
gtk_widg‘_de¡roy
(
sh“ts_sh­e£ËùiÚ_dŸlog
);

995 
	gsh“ts_sh­e£ËùiÚ_dŸlog
 = 
NULL
;

998 
GtkWidg‘
 *
	gsh“ts_ed™_dŸlog
;

1001 
	$Ú_sh“ts_dŸlog_bu‰Ú_ed™_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

1002 
gpoš‹r
 
u£r_d©a
)

1004 
GtkWidg‘
 *
w¿pbox
;

1005 
GLi¡
 *
bu‰Ú_li¡
;

1006 
GtkWidg‘
 *
aùive_bu‰Ú
;

1007 
Sh“tObjeùMod
 *
som
;

1008 
gch¬
 *
desü
 = "";

1009 
gch¬
 *
ty³
 = "";

1010 
GtkWidg‘
 *
’Œy
;

1011 
Sh“tMod
 *
sm
;

1012 
gch¬
 *
Çme
 = "";

1014 ià(
sh“ts_ed™_dŸlog
 =ğ
NULL
)

1015 
sh“ts_ed™_dŸlog
 = 
	`ü—‹_sh“ts_ed™_dŸlog
();

1017 
aùive_bu‰Ú
 = 
	`sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

1018 
som
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_object_mod");

1019 ià(
som
)

1021 
desü
 = 
som
->
sh“t_objeù
.
desütiÚ
;

1022 
ty³
 = 
	`sh“t_objeù_mod_g‘_ty³_¡ršg
(
som
);

1025 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_ed™_dŸlog
, "entry_object_description");

1026 ià(
som
)

1027 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
’Œy
), 
desü
);

1029 
	`gtk_widg‘_£t_£ns™ive
(
’Œy
, 
FALSE
);

1031 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_ed™_dŸlog
, "entry_object_type");

1032 ià(
som
)

1033 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
’Œy
), 
ty³
);

1035 
	`gtk_widg‘_£t_£ns™ive
(
’Œy
, 
FALSE
);

1037 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod");

1038 ià(
sm
)

1040 
Çme
 = 
sm
->
sh“t
.name;

1041 
desü
 = 
sm
->
sh“t
.
desütiÚ
;

1044 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_ed™_dŸlog
, "entry_sheet_name");

1045 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
’Œy
), 
Çme
);

1046 #ià
CAN_EDIT_SHEET_NAME


1047 ià(
sm
->
sh“t
.
scİe
 =ğ
SHEET_SCOPE_SYSTEM
)

1049 
	`gtk_widg‘_£t_£ns™ive
(
’Œy
, 
FALSE
);

1051 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_ed™_dŸlog
, "entry_sheet_description");

1052 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
’Œy
), 
desü
);

1054 
	`gtk_widg‘_show
(
sh“ts_ed™_dŸlog
);

1055 
	}
}

1058 
	gÚ_sh“ts_ed™_dŸlog_bu‰Ú_ÿnûl_şicked


1059 (
GtkBu‰Ú
 *
	gbu‰Ú
,

1060 
gpoš‹r
 
	gu£r_d©a
)

1062 
gtk_widg‘_de¡roy
(
sh“ts_ed™_dŸlog
);

1063 
	gsh“ts_ed™_dŸlog
 = 
NULL
;

1066 
GtkWidg‘
 *
	gsh“ts_»move_dŸlog
;

1070 
	mSHEETS_REMOVE_DIALOG_TYPE_OBJECT
 = 1,

1071 
	mSHEETS_REMOVE_DIALOG_TYPE_SHEET


1073 
	tSh“tsRemoveDŸlogTy³
;

1076 
	$Ú_sh“ts_dŸlog_bu‰Ú_»move_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

1077 
gpoš‹r
 
u£r_d©a
)

1079 
GtkWidg‘
 *
w¿pbox
;

1080 
GLi¡
 *
bu‰Ú_li¡
;

1081 
GtkWidg‘
 *
aùive_bu‰Ú
;

1082 
Sh“tMod
 *
sm
;

1083 
GtkWidg‘
 *
’Œy
;

1084 
GtkWidg‘
 *
¿dio_bu‰Ú
;

1086 
sh“ts_»move_dŸlog
 = 
	`ü—‹_sh“ts_»move_dŸlog
();

1088 
aùive_bu‰Ú
 = 
	`sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

1089 
	`g_as£¹
(
aùive_bu‰Ú
);

1093 
¿dio_bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_»move_dŸlog
, "radiobutton_sheet");

1094 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
¿dio_bu‰Ú
), 
TRUE
);

1096 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_»move_dŸlog
, "entry_object");

1097 ià(
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "is_hidden_button"))

1099 
¿dio_bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_»move_dŸlog
, "radiobutton_object");

1100 
	`gtk_widg‘_£t_£ns™ive
(
¿dio_bu‰Ú
, 
FALSE
);

1101 
	`gtk_widg‘_£t_£ns™ive
(
’Œy
, 
FALSE
);

1105 
Sh“tObjeùMod
 *
som
;

1107 
som
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_object_mod");

1108 ià(!
som
)

1109 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
’Œy
), 
	`_
("Line Break"));

1111 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
’Œy
), 
som
->
sh“t_objeù
.
desütiÚ
);

1113 
¿dio_bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_»move_dŸlog
, "radiobutton_object");

1114 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
¿dio_bu‰Ú
), 
TRUE
);

1117 
’Œy
 = 
	`lookup_widg‘
(
sh“ts_»move_dŸlog
, "entry_sheet");

1118 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod");

1127 ià(
sm
->
sh“t
.
shadowšg
 =ğ
NULL
 && sm->sh“t.
scİe
 =ğ
SHEET_SCOPE_SYSTEM
)

1129 
GtkWidg‘
 *
¿dio_bu‰Ú
;

1131 
¿dio_bu‰Ú
 = 
	`lookup_widg‘
(
sh“ts_»move_dŸlog
, "radiobutton_sheet");

1132 
	`gtk_widg‘_£t_£ns™ive
(
¿dio_bu‰Ú
, 
FALSE
);

1133 
	`gtk_widg‘_£t_£ns™ive
(
’Œy
, 
FALSE
);

1135 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
’Œy
), 
sm
->
sh“t
.
Çme
);

1137 
	`gtk_widg‘_show
(
sh“ts_»move_dŸlog
);

1138 
	}
}

1141 
	gÚ_sh“ts_»move_dŸlog_bu‰Ú_ÿnûl_şicked


1142 (
GtkBu‰Ú
 *
	gbu‰Ú
,

1143 
gpoš‹r
 
	gu£r_d©a
)

1145 
gtk_widg‘_de¡roy
(
sh“ts_»move_dŸlog
);

1146 
	gsh“ts_»move_dŸlog
 = 
NULL
;

1150 
	$sh“ts_dŸlog_toggËbu‰Ú_£t_£ns™ive
(
GtkToggËBu‰Ú
 *
toggËbu‰Ú
,

1151 
GtkWidg‘
 *
dŸlog
,

1152 
gch¬
 *
widg‘_Çmes
[], 
gšt
 
ty³
)

1154 
gboŞ—n
 
is_£ns™ive
;

1155 
gušt
 
i
;

1156 
GtkWidg‘
 *
tmp
;

1158 
is_£ns™ive
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
toggËbu‰Ú
));

1159 ià(
is_£ns™ive
)

1161 
tmp
 = 
	`lookup_widg‘
(
dŸlog
, "button_ok");

1162 
	`gtk_objeù_£t_d©a
(
	`GTK_OBJECT
(
tmp
), "aùive_ty³", (
gpoš‹r
)
ty³
);

1165 
i
 = 0; 
widg‘_Çmes
[i]; i++)

1167 
tmp
 = 
	`lookup_widg‘
(
dŸlog
, 
widg‘_Çmes
[
i
]);

1168 
	`gtk_widg‘_£t_£ns™ive
(
tmp
, 
is_£ns™ive
);

1170 
	}
}

1173 
	gÚ_sh“ts_Ãw_dŸlog_¿diobu‰Ú_svg_sh­e_toggËd


1174 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

1175 
gpoš‹r
 
	gu£r_d©a
)

1177 
gch¬
 *
	gwidg‘_Çmes
[] =

1183 
NULL


1186 
sh“ts_dŸlog_toggËbu‰Ú_£t_£ns™ive
(
toggËbu‰Ú
, 
sh“ts_Ãw_dŸlog
,

1187 
widg‘_Çmes
,

1188 
SHEETS_NEW_DIALOG_TYPE_SVG_SHAPE
);

1192 
	gÚ_sh“ts_Ãw_dŸlog_¿diobu‰Ú_sh“t_toggËd


1193 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

1194 
gpoš‹r
 
	gu£r_d©a
)

1196 
gch¬
 *
	gwidg‘_Çmes
[] =

1201 
NULL


1204 
sh“ts_dŸlog_toggËbu‰Ú_£t_£ns™ive
(
toggËbu‰Ú
, 
sh“ts_Ãw_dŸlog
,

1205 
widg‘_Çmes
,

1206 
SHEETS_NEW_DIALOG_TYPE_SHEET
);

1210 
	gÚ_sh“ts_Ãw_dŸlog_¿diobu‰Ú_lše_b»ak_toggËd


1211 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

1212 
gpoš‹r
 
	gu£r_d©a
)

1214 
gch¬
 *
	gwidg‘_Çmes
[] =

1216 
NULL


1219 
sh“ts_dŸlog_toggËbu‰Ú_£t_£ns™ive
(
toggËbu‰Ú
, 
sh“ts_Ãw_dŸlog
,

1220 
widg‘_Çmes
,

1221 
SHEETS_NEW_DIALOG_TYPE_LINE_BREAK
);

1225 
	gÚ_sh“ts_»move_dŸlog_¿diobu‰Ú_objeù_toggËd


1226 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

1227 
gpoš‹r
 
	gu£r_d©a
)

1229 
gch¬
 *
	gwidg‘_Çmes
[] =

1233 
NULL


1236 
sh“ts_dŸlog_toggËbu‰Ú_£t_£ns™ive
(
toggËbu‰Ú
, 
sh“ts_»move_dŸlog
,

1237 
widg‘_Çmes
,

1238 
SHEETS_REMOVE_DIALOG_TYPE_OBJECT
);

1242 
	gÚ_sh“ts_»move_dŸlog_¿diobu‰Ú_sh“t_toggËd


1243 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

1244 
gpoš‹r
 
	gu£r_d©a
)

1246 
gch¬
 *
	gwidg‘_Çmes
[] =

1249 
NULL


1252 
sh“ts_dŸlog_toggËbu‰Ú_£t_£ns™ive
(
toggËbu‰Ú
, 
sh“ts_»move_dŸlog
,

1253 
widg‘_Çmes
,

1254 
SHEETS_REMOVE_DIALOG_TYPE_SHEET
);

1257 
GtkWidg‘
 *

1258 
	$sh“ts_dŸlog_£t_Ãw_aùive_bu‰Ú
()

1260 
GtkWidg‘
 *
aùive_bu‰Ú
;

1261 
GtkWidg‘
 *
w¿pbox
;

1262 
GLi¡
 *
bu‰Ú_li¡
;

1263 
GLi¡
 *
aùive_bu‰Ú_li¡
;

1264 
GtkWidg‘
 *
Ãw_aùive_bu‰Ú
;

1266 
aùive_bu‰Ú
 = 
	`sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

1268 
aùive_bu‰Ú_li¡
 = 
	`g_li¡_fšd
(
bu‰Ú_li¡
, 
aùive_bu‰Ú
);

1269 
	`g_as£¹
(
aùive_bu‰Ú_li¡
);

1270 ià(
	`g_li¡_Ãxt
(
aùive_bu‰Ú_li¡
))

1271 
Ãw_aùive_bu‰Ú
 = 
	`g_li¡_Ãxt
(
aùive_bu‰Ú_li¡
)->
d©a
;

1274 ià(
	`g_li¡_´evious
(
aùive_bu‰Ú_li¡
))

1275 
Ãw_aùive_bu‰Ú
 = 
	`g_li¡_´evious
(
aùive_bu‰Ú_li¡
)->
d©a
;

1277 
Ãw_aùive_bu‰Ú
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
),

1280 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
Ãw_aùive_bu‰Ú
), 
TRUE
);

1282  
Ãw_aùive_bu‰Ú
;

1283 
	}
}

1286 
	gÚ_sh“ts_»move_dŸlog_bu‰Ú_ok_şicked


1287 (
GtkBu‰Ú
 *
	gbu‰Ú
,

1288 
gpoš‹r
 
	gu£r_d©a
)

1290 
Sh“tsRemoveDŸlogTy³
 
	gty³
;

1291 
GtkWidg‘
 *
	gw¿pbox
;

1292 
GLi¡
 *
	gbu‰Ú_li¡
;

1293 
GtkWidg‘
 *
	gaùive_bu‰Ú
;

1295 
	gty³
 = (
Sh“tsRemoveDŸlogTy³
)
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
bu‰Ú
),

1298 
	gaùive_bu‰Ú
 = 
sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

1300 
	gty³
)

1302 
Sh“tObjeùMod
 *
	gsom
;

1303 
GtkWidg‘
 *
	gÃw_aùive_bu‰Ú
;

1304 
Sh“tMod
 *
	gsm
;

1305 
GtkWidg‘
 *
	gbË_sh“ts
;

1306 
GtkWidg‘
 *
	gİtiÚm’u
;

1308 
	gSHEETS_REMOVE_DIALOG_TYPE_OBJECT
:

1310 
som
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_object_mod");

1311 ià(
	gsom
)

1313 
	gsm
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod");

1314 
	gsm
->
	gmod
 = 
SHEETMOD_MOD_CHANGED
;

1315 
	gsom
->
	gmod
 = 
SHEET_OBJECT_MOD_DELETED
;

1317 
	gÃw_aùive_bu‰Ú
 = 
sh“ts_dŸlog_£t_Ãw_aùive_bu‰Ú
();

1319 
gtk_widg‘_de¡roy
(
aùive_bu‰Ú
);

1320 
	g¿dio_group
 = 
gtk_¿dio_bu‰Ú_group
(
GTK_RADIO_BUTTON
(
Ãw_aùive_bu‰Ú
));

1322 
sh“ts_dŸlog_nÜm®ize_lše_b»aks
(
w¿pbox
, 
SHEETS_DIALOG_MOVE_NONE
);

1325 
	gSHEETS_REMOVE_DIALOG_TYPE_SHEET
:

1327 
sm
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod");

1328 
	gsm
->
	gmod
 = 
SHEETMOD_MOD_DELETED
;

1330 ià(
	gsm
->
	gsh“t
.
	gshadowšg
 && sm->sh“t.
	gscİe
 =ğ
SHEET_SCOPE_USER
)

1331 
sh“ts_­³nd_sh“t_mods
(
sm
->
sh“t
.
shadowšg
);

1333 
	gbË_sh“ts
 = 
lookup_widg‘
(
sh“ts_dŸlog
, "table_sheets");

1334 
	gİtiÚm’u
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
bË_sh“ts
),

1336 
g_as£¹
(
İtiÚm’u
);

1337 
sh“ts_İtiÚm’u_ü—‹
(
İtiÚm’u
, 
w¿pbox
, 
NULL
);

1342 
g_as£¹_nÙ_»ached
();

1345 
g_li¡_ä“
(
bu‰Ú_li¡
);

1347 
sh“ts_dŸlog_­¶y_»v”t_£t_£ns™ive
(
TRUE
);

1348 
gtk_widg‘_de¡roy
(
sh“ts_»move_dŸlog
);

1349 
	gsh“ts_»move_dŸlog
 = 
NULL
;

1353 
	gÚ_sh“ts_ed™_dŸlog_bu‰Ú_ok_şicked


1354 (
GtkBu‰Ú
 *
	gbu‰Ú
,

1355 
gpoš‹r
 
	gu£r_d©a
)

1357 
GtkWidg‘
 *
	gaùive_bu‰Ú
;

1358 
GtkWidg‘
 *
	gw¿pbox
;

1359 
GLi¡
 *
	gbu‰Ú_li¡
;

1360 
GtkWidg‘
 *
	g’Œy
;

1361 
gboŞ—n
 
	gsom‘hšg_chªged
 = 
FALSE
;

1363 
	gaùive_bu‰Ú
 = 
sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

1364 
g_as£¹
(
aùive_bu‰Ú
);

1366 
	g’Œy
 = 
lookup_widg‘
(
sh“ts_ed™_dŸlog
, "entry_object_description");

1367 ià((
	ggboŞ—n
)
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
’Œy
), "chªged"è=ğ
TRUE
)

1369 
Sh“tMod
 *
sm
;

1370 
Sh“tObjeùMod
 *
	gsom
;

1372 
	gsom
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_object_mod");

1373 
	gsom
->
	gsh“t_objeù
.
	gdesütiÚ
 =

1374 
gtk_ed™abË_g‘_ch¬s
(
GTK_EDITABLE
(
’Œy
), 0, -1);

1375 
sh“ts_dŸlog_objeù_£t_toŞt
(
som
, 
aùive_bu‰Ú
);

1377 
	gsom
->
	gmod
 = 
SHEET_OBJECT_MOD_CHANGED
;

1379 
	gsm
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod");

1380 ià(
	gsm
->
	gmod
 =ğ
SHEETMOD_MOD_NONE
)

1381 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1383 
	gsom‘hšg_chªged
 = 
TRUE
;

1386 
	g’Œy
 = 
lookup_widg‘
(
sh“ts_ed™_dŸlog
, "entry_sheet_description");

1387 ià((
	ggboŞ—n
)
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
’Œy
), "chªged"è=ğ
TRUE
)

1389 
Sh“tMod
 *
sm
;

1391 
	gsm
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod");

1392 
	gsm
->
	gsh“t
.
	gdesütiÚ
 =

1393 
gtk_ed™abË_g‘_ch¬s
(
GTK_EDITABLE
(
’Œy
), 0, -1);

1395 ià(
	gsm
->
	gmod
 =ğ
SHEETMOD_MOD_NONE
)

1396 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1397 
	gsom‘hšg_chªged
 = 
TRUE
;

1400 #ifdeà
CAN_EDIT_SHEET_NAME


1403 
	g’Œy
 = 
lookup_widg‘
(
sh“ts_ed™_dŸlog
, "entry_sheet_name");

1404 ià((
	ggboŞ—n
)
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
’Œy
), "chªged"è=ğ
TRUE
)

1406 
Sh“tMod
 *
sm
;

1407 
GtkWidg‘
 *
	gbË_sh“ts
;

1408 
GtkWidg‘
 *
	gİtiÚm’u
;

1410 
	gsm
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod");

1411 
	gsm
->
	gsh“t
.
	gÇme
 = 
gtk_ed™abË_g‘_ch¬s
(
GTK_EDITABLE
(
’Œy
), 0, -1);

1412 ià(
	gsm
->
	gmod
 =ğ
SHEETMOD_MOD_NONE
)

1413 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1415 
	gbË_sh“ts
 = 
lookup_widg‘
(
sh“ts_dŸlog
, "table_sheets");

1416 
	gİtiÚm’u
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
bË_sh“ts
),

1418 
sh“ts_İtiÚm’u_ü—‹
(
İtiÚm’u
, 
w¿pbox
, 
NULL
);

1420 
	gsom‘hšg_chªged
 = 
TRUE
;

1423 ià(
	gsom‘hšg_chªged
 =ğ
TRUE
)

1424 
sh“ts_dŸlog_­¶y_»v”t_£t_£ns™ive
(
TRUE
);

1426 
gtk_widg‘_de¡roy
(
sh“ts_ed™_dŸlog
);

1427 
	gsh“ts_ed™_dŸlog
 = 
NULL
;

1431 
	gÚ_sh“ts_ed™_dŸlog_’Œy_objeù_desütiÚ_chªged


1432 (
GtkEd™abË
 *
	ged™abË
,

1433 
gpoš‹r
 
	gu£r_d©a
)

1435 
gtk_objeù_£t_d©a
(
GTK_OBJECT
(
ed™abË
), "chªged", (
gpoš‹r
)
TRUE
);

1440 
	gÚ_sh“ts_ed™_dŸlog_’Œy_sh“t_desütiÚ_chªged


1441 (
GtkEd™abË
 *
	ged™abË
,

1442 
gpoš‹r
 
	gu£r_d©a
)

1444 
gtk_objeù_£t_d©a
(
GTK_OBJECT
(
ed™abË
), "chªged", (
gpoš‹r
)
TRUE
);

1448 
	gÚ_sh“ts_ed™_dŸlog_’Œy_sh“t_Çme_chªged


1449 (
GtkEd™abË
 *
	ged™abË
,

1450 
gpoš‹r
 
	gu£r_d©a
)

1452 
gtk_objeù_£t_d©a
(
GTK_OBJECT
(
ed™abË
), "chªged", (
gpoš‹r
)
TRUE
);

1455 
GtkWidg‘
 *

1456 
	$sh“ts_dŸlog_g‘_rg‘_w¿pbox
(
GtkWidg‘
 *
w¿pbox
)

1458 ià(
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
w¿pbox
), "is_left"))

1459  
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
sh“ts_dŸlog
), "wrapbox_right");

1461  
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
sh“ts_dŸlog
), "wrapbox_left");

1462 
	}
}

1465 
	$sh“ts_dŸlog_cİy_objeù
(
GtkWidg‘
 *
aùive_bu‰Ú
, GtkWidg‘ *
rg‘_w¿pbox
)

1467 
GtkWidg‘
 *
bu‰Ú
;

1468 
Sh“tMod
 *
sm
;

1469 
Sh“tObjeùMod
 *
som
;

1470 
Sh“tObjeùMod
 *
som_Ãw
;

1472 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
rg‘_w¿pbox
), "sheet_mod");

1473 
som
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_object_mod");

1475 ià(!
som
)

1479 
som_Ãw
 = 
	`g_Ãw0
(
Sh“tObjeùMod
, 1);

1481 
Sh“tObjeù
 *
so
 = &
som_Ãw
->
sh“t_objeù
;

1483 
so
->
objeù_ty³
 = 
	`g_¡rdup
(
som
->
sh“t_objeù
.object_type);

1484 
so
->
desütiÚ
 = 
	`g_¡rdup
(
som
->
sh“t_objeù
.description);

1485 
so
->
pixm­
 = 
som
->
sh“t_objeù
.pixmap;

1486 
so
->
u£r_d©a
 = 
som
->
sh“t_objeù
.user_data;

1487 
so
->
u£r_d©a_ty³
 = 
som
->
sh“t_objeù
.user_data_type;

1488 
so
->
lše_b»ak
 = 
FALSE
;

1489 
so
->
pixm­_fe
 = 
	`g_¡rdup
(
som
->
sh“t_objeù
.pixmap_file);

1490 
so
->
has_icÚ_Ú_sh“t
 = 
som
->
sh“t_objeù
.has_icon_on_sheet;

1493 
som_Ãw
->
ty³
 = 
som
->type;

1494 
som_Ãw
->
mod
 = 
SHEET_OBJECT_MOD_NONE
;

1496 
sm
->
sh“t
.
objeùs
 = 
	`g_¦i¡_­³nd
(sm->sh“t.objeùs, 
som_Ãw
);

1497 ià(
sm
->
mod
 =ğ
SHEETMOD_MOD_NONE
)

1498 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1500 
bu‰Ú
 = 
	`sh“ts_dŸlog_ü—‹_objeù_bu‰Ú
(
som_Ãw
, 
sm
, 
rg‘_w¿pbox
);

1501 
	`gtk_w¿p_box_·ck
(
	`GTK_WRAP_BOX
(
rg‘_w¿pbox
), 
bu‰Ú
,

1502 
FALSE
, 
TRUE
, FALSE, TRUE);

1503 
	`gtk_widg‘_show
(
bu‰Ú
);

1505 
	`sh“ts_dŸlog_­¶y_»v”t_£t_£ns™ive
(
TRUE
);

1506 
	}
}

1509 
	$Ú_sh“ts_dŸlog_bu‰Ú_cİy_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

1510 
gpoš‹r
 
u£r_d©a
)

1512 
GtkWidg‘
 *
aùive_bu‰Ú
;

1513 
GtkWidg‘
 *
w¿pbox
;

1514 
GLi¡
 *
bu‰Ú_li¡
;

1515 
GtkWidg‘
 *
rg‘_w¿pbox
;

1517 
aùive_bu‰Ú
 = 
	`sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

1519 
rg‘_w¿pbox
 = 
	`sh“ts_dŸlog_g‘_rg‘_w¿pbox
(
w¿pbox
);

1521 
	`sh“ts_dŸlog_cİy_objeù
(
aùive_bu‰Ú
, 
rg‘_w¿pbox
);

1522 
	}
}

1525 
	gÚ_sh“ts_dŸlog_bu‰Ú_cİy_®l_şicked


1526 (
GtkBu‰Ú
 *
	gbu‰Ú
,

1527 
gpoš‹r
 
	gu£r_d©a
)

1529 
GtkWidg‘
 *
	gaùive_bu‰Ú
;

1530 
GtkWidg‘
 *
	gw¿pbox
;

1531 
GLi¡
 *
	gbu‰Ú_li¡
, *
	g™”_li¡
;

1532 
GtkWidg‘
 *
	grg‘_w¿pbox
;

1534 
	gaùive_bu‰Ú
 = 
sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

1536 
	grg‘_w¿pbox
 = 
sh“ts_dŸlog_g‘_rg‘_w¿pbox
(
w¿pbox
);

1538 
	g™”_li¡
 = 
bu‰Ú_li¡
; i‹r_li¡; i‹r_li¡ = 
g_li¡_Ãxt
(
™”_li¡
))

1539 
sh“ts_dŸlog_cİy_objeù
(
™”_li¡
->
d©a
, 
rg‘_w¿pbox
);

1543 
	$Ú_sh“ts_dŸlog_bu‰Ú_move_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

1544 
gpoš‹r
 
u£r_d©a
)

1546 
GtkWidg‘
 *
aùive_bu‰Ú
;

1547 
GtkWidg‘
 *
w¿pbox
;

1548 
GLi¡
 *
bu‰Ú_li¡
;

1549 
GtkWidg‘
 *
rg‘_w¿pbox
;

1550 
Sh“tObjeùMod
 *
som
;

1551 
GtkWidg‘
 *
Ãw_aùive_bu‰Ú
;

1553 
aùive_bu‰Ú
 = 
	`sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

1555 
rg‘_w¿pbox
 = 
	`sh“ts_dŸlog_g‘_rg‘_w¿pbox
(
w¿pbox
);

1557 
	`sh“ts_dŸlog_cİy_objeù
(
aùive_bu‰Ú
, 
rg‘_w¿pbox
);

1559 
som
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_object_mod");

1560 ià(
som
) {

1561 
Sh“tMod
 *
sm
;

1563 
som
->
mod
 = 
SHEET_OBJECT_MOD_DELETED
;

1565 
sm
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
aùive_bu‰Ú
), "sheet_mod");

1566 
sm
->
mod
 = 
SHEETMOD_MOD_CHANGED
;

1569 
Ãw_aùive_bu‰Ú
 = 
	`sh“ts_dŸlog_£t_Ãw_aùive_bu‰Ú
();

1571 
	`gtk_widg‘_de¡roy
(
aùive_bu‰Ú
);

1572 
¿dio_group
 = 
	`gtk_¿dio_bu‰Ú_group
(
	`GTK_RADIO_BUTTON
(
Ãw_aùive_bu‰Ú
));

1574 
	`sh“ts_dŸlog_nÜm®ize_lše_b»aks
(
w¿pbox
, 
SHEETS_DIALOG_MOVE_NONE
);

1575 
	}
}

1578 
	gÚ_sh“ts_dŸlog_bu‰Ú_move_®l_şicked


1579 (
GtkBu‰Ú
 *
	gbu‰Ú
,

1580 
gpoš‹r
 
	gu£r_d©a
)

1582 
GtkWidg‘
 *
	gaùive_bu‰Ú
;

1583 
GtkWidg‘
 *
	gw¿pbox
;

1584 
GLi¡
 *
	gbu‰Ú_li¡
;

1585 
GLi¡
 *
	g™”_li¡
;

1586 
GtkWidg‘
 *
	grg‘_w¿pbox
;

1587 
Sh“tObjeùMod
 *
	gsom
;

1589 
	gaùive_bu‰Ú
 = 
sh“ts_dŸlog_g‘_aùive_bu‰Ú
(&
w¿pbox
, &
bu‰Ú_li¡
);

1591 
	grg‘_w¿pbox
 = 
sh“ts_dŸlog_g‘_rg‘_w¿pbox
(
w¿pbox
);

1593 
	g™”_li¡
 = 
bu‰Ú_li¡
; i‹r_li¡; i‹r_li¡ = 
g_li¡_Ãxt
(
™”_li¡
))

1595 
sh“ts_dŸlog_cİy_objeù
(
™”_li¡
->
d©a
, 
rg‘_w¿pbox
);

1597 
	gsom
 = 
gtk_objeù_g‘_d©a
(
GTK_OBJECT
(
™”_li¡
->
d©a
), "sheet_object_mod");

1598 ià(
	gsom
)

1599 
	gsom
->
	gmod
 = 
SHEET_OBJECT_MOD_DELETED
;

1601 
gtk_widg‘_de¡roy
(
™”_li¡
->
d©a
);

1608 
	gbu‰Ú_li¡
 = 
gtk_cÚš”_chd»n
(
GTK_CONTAINER
(
rg‘_w¿pbox
));

1609 
gtk_toggË_bu‰Ú_£t_aùive
(
GTK_TOGGLE_BUTTON
(
bu‰Ú_li¡
->
d©a
), 
TRUE
);

1612 
gboŞ—n


1613 
	$cİy_fe
(
gch¬
 *
¤c
, gch¬ *
d¡
)

1615 
FILE
 *
å_¤c
;

1616 
FILE
 *
å_d¡
;

1617 
c
;

1619 ià((
å_¤c
 = 
	`g_fİ’
(
¤c
, "rb")è=ğ
NULL
)

1621 
	`mes§ge_”rÜ
(
	`_
("Couldn't open '%s': %s"),

1622 
	`dŸ_mes§ge_f’ame
(
¤c
), 
	`¡»¼Ü
(
”ºo
));

1623  
FALSE
;

1626 ià((
å_d¡
 = 
	`g_fİ’
(
d¡
, "wb")è=ğ
NULL
)

1628 
	`mes§ge_”rÜ
(
	`_
("Couldn't open '%s': %s"),

1629 
	`dŸ_mes§ge_f’ame
(
d¡
), 
	`¡»¼Ü
(
”ºo
));

1630  
FALSE
;

1633 (
c
 = 
	`fg‘c
(
å_¤c
)è!ğ
EOF
)

1634 
	`åutc
(
c
, 
å_d¡
);

1636 
	`fşo£
(
å_¤c
);

1637 
	`fşo£
(
å_d¡
);

1639  
TRUE
;

1640 
	}
}

1643 
gboŞ—n


1644 
	$wr™e_u£r_sh“t
(
Sh“t
 *
sh“t
)

1646 
FILE
 *
fe
;

1647 
xmlDocPŒ
 
doc
;

1648 
xmlNodePŒ
 
roÙ
;

1649 
xmlNodePŒ
 
node
;

1650 
xmlNodePŒ
 
objeù_node
;

1651 
xmlNodePŒ
 
desc_node
;

1652 
xmlNodePŒ
 
icÚ_node
;

1653 
gch¬
 
buf
[512];

1654 
time_t
 
time_now
;

1655 cÚ¡ *
u£ºame
;

1656 
gch¬
 *
dœ_u£r_sh“ts
;

1657 
gch¬
 *
f’ame
;

1658 
Sh“tObjeù
 *
sh“tobjeù
;

1659 
GSLi¡
 *
sh“t_objeùs
;

1661 
dœ_u£r_sh“ts
 = 
	`dŸ_cÚfig_f’ame
("sheets");

1662 ià(!*(
sh“t
->
f’ame
))

1664 
gch¬
 *
ba£Çme
;

1666 
ba£Çme
 = 
	`g_¡rdup
(
sh“t
->
Çme
);

1667 
ba£Çme
 = 
	`g_¡rd–im™
(ba£Çme, 
G_STR_DELIMITERS
 
G_DIR_SEPARATOR_S
, '_');

1668 
f’ame
 = 
	`g_¡rdup_´štf
("%s%s%s.sh“t", 
dœ_u£r_sh“ts
,

1669 
G_DIR_SEPARATOR_S
, 
ba£Çme
);

1670 
	`g_ä“
(
ba£Çme
);

1673 
f’ame
 = 
	`g_¡rdup_´štf
("%s%s%s", 
dœ_u£r_sh“ts
,

1674 
G_DIR_SEPARATOR_S
, 
	`g_ba£Çme
(
sh“t
->
f’ame
));

1676 
fe
 = 
	`g_fİ’
(
f’ame
, "w");

1678 ià(
fe
==
NULL
)

1680 
	`mes§ge_”rÜ
(
	`_
("Couldn't open: '%s' for writing"),

1681 
	`dŸ_mes§ge_f’ame
(
f’ame
));

1682 
	`g_ä“
(
f’ame
);

1683  
FALSE
;

1685 
	`fşo£
(
fe
);

1687 
time_now
 = 
	`time
(
NULL
);

1688 
u£ºame
 = 
	`g_g‘_u£r_Çme
();

1689 ià(
u£ºame
==
NULL
)

1690 
u£ºame
 = 
	`_
("a user");

1692 
doc
 = 
	`xmlNewDoc
((cÚ¡ 
xmlCh¬
 *)"1.0");

1693 
doc
->
’codšg
 = 
	`xmlSŒdup
((cÚ¡ 
xmlCh¬
 *)"UTF-8");

1695 
doc
->
¡ªd®Úe
 = 
FALSE
;

1696 
roÙ
 = 
	`xmlNewDocNode
(
doc
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"sheet", NULL);

1697 
doc
->
xmlRoÙNode
 = 
roÙ
;

1698 
	`xmlS‘Prİ
(
roÙ
, (cÚ¡ 
xmlCh¬
 *)"xmÊs", (cÚ¡ xmlCh¬ *è
DIA_XML_NAME_SPACE_BASE
 "dia-sheet-ns");

1701 
	`xmlAddChd
(
roÙ
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1702 
	`xmlAddChd
(
roÙ
, 
	`xmlNewComm’t
((cÚ¡ 
xmlCh¬
 *)"DŸ-V”siÚ: "
VERSION
));

1703 
	`xmlAddChd
(
roÙ
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1704 
	`g_¢´štf
(
buf
, (buf), 
	`_
("Fe: %s"), 
f’ame
);

1705 
	`xmlAddChd
(
roÙ
, 
	`xmlNewComm’t
((
xmlCh¬
 *)
buf
));

1706 
	`xmlAddChd
(
roÙ
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1707 
	`g_¢´štf
(
buf
, (buf), 
	`_
("D©e: %s"), 
	`ùime
(&
time_now
));

1708 
buf
[
	`¡¾’
(buf)-1] = '\0';

1709 
	`xmlAddChd
(
roÙ
, 
	`xmlNewComm’t
((
xmlCh¬
 *)
buf
));

1710 
	`xmlAddChd
(
roÙ
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1711 
	`g_¢´štf
(
buf
, (buf), 
	`_
("FÜ: %s"), 
u£ºame
);

1712 
	`xmlAddChd
(
roÙ
, 
	`xmlNewComm’t
((
xmlCh¬
 *)
buf
));

1713 
	`xmlAddChd
(
roÙ
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n\n"));

1716 
node
 = 
	`xmlNewChd
(
roÙ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"name", NULL);

1717 
	`xmlAddChd
(
node
, 
	`xmlNewText
((
xmlCh¬
 *)
sh“t
->
Çme
));

1718 
	`xmlAddChd
(
roÙ
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1721 
node
 = 
	`xmlNewChd
(
roÙ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"description", NULL);

1722 
	`xmlAddChd
(
node
, 
	`xmlNewText
((
xmlCh¬
 *)
sh“t
->
desütiÚ
));

1723 
	`xmlAddChd
(
roÙ
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1726 
node
 = 
	`xmlNewChd
(
roÙ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"contents", NULL);

1727 
	`xmlAddChd
(
node
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1728 
	`xmlAddChd
(
node
, 
	`xmlNewComm’t
((cÚ¡ 
xmlCh¬
 *è
	`_
("add shapes here")));

1729 
	`xmlAddChd
(
node
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1732 
sh“t_objeùs
 = 
sh“t
->
objeùs
; sheet_objects;

1733 
sh“t_objeùs
 = 
	`g_¦i¡_Ãxt
(sheet_objects))

1735 
Sh“tObjeùMod
 *
som
;

1737 
som
 = 
sh“t_objeùs
->
d©a
;

1739 ià(
som
->
mod
 =ğ
SHEET_OBJECT_MOD_DELETED
)

1745 ià(
som
->
mod
 =ğ
SHEET_OBJECT_MOD_NEW
)

1747 
gch¬
 *
dŸ_u£r_sh­es
;

1748 
gch¬
 *
de¡
;

1750 
dŸ_u£r_sh­es
 = 
	`dŸ_cÚfig_f’ame
("shapes");

1752 
de¡
 = 
	`g_¡rdup_´štf
("%s%s%s", 
dŸ_u£r_sh­es
, 
G_DIR_SEPARATOR_S
,

1753 
	`g_ba£Çme
(
som
->
svg_f’ame
));

1754 
	`cİy_fe
(
som
->
svg_f’ame
, 
de¡
);

1755 
	`g_ä“
(
de¡
);

1757 
de¡
 = 
	`g_¡rdup_´štf
("%s%s%s", 
dŸ_u£r_sh­es
, 
G_DIR_SEPARATOR_S
,

1758 
	`g_ba£Çme
(
som
->
sh“t_objeù
.
pixm­_fe
));

1759 
	`cİy_fe
(
som
->
sh“t_objeù
.
pixm­_fe
, 
de¡
);

1760 
	`g_ä“
(
de¡
);

1763 
sh“tobjeù
 = &
som
->
sh“t_objeù
;

1764 
objeù_node
 = 
	`xmlNewChd
(
node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"object", NULL);

1766 
	`xmlS‘Prİ
(
objeù_node
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
sh“tobjeù
->
objeù_ty³
);

1768 ià(
sh“tobjeù
->
u£r_d©a_ty³
 =ğ
USER_DATA_IS_INTDATA
)

1770 
gch¬
 *
u£r_d©a
;

1772 
u£r_d©a
 = 
	`g_¡rdup_´štf
("%u", (
gušt
)(
sh“tobjeù
->user_data));

1773 
	`xmlS‘Prİ
(
objeù_node
, (cÚ¡ 
xmlCh¬
 *)"štd©a", (xmlCh¬ *è
u£r_d©a
);

1774 
	`g_ä“
(
u£r_d©a
);

1777 
	`xmlAddChd
(
objeù_node
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1778 
desc_node
 = 
	`xmlNewChd
(
objeù_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"description", NULL);

1779 
	`xmlAddChd
(
desc_node
, 
	`xmlNewText
((
xmlCh¬
 *è
sh“tobjeù
->
desütiÚ
));

1782 ià(
sh“tobjeù
->
has_icÚ_Ú_sh“t
 =ğ
TRUE
)

1784 
gch¬
 *
ÿnÚiÿl_icÚ
;

1785 
gch¬
 *
ÿnÚiÿl_u£r_sh“ts
;

1786 
gch¬
 *
ÿnÚiÿl_sh“ts
;

1787 
gch¬
 *
icÚ
;

1789 
	`xmlAddChd
(
objeù_node
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1790 
icÚ_node
 = 
	`xmlNewChd
(
objeù_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"icon", NULL);

1791 
ÿnÚiÿl_icÚ
 = 
	`dŸ_g‘_ÿnÚiÿl_·th
(
sh“tobjeù
->
pixm­_fe
);

1792 
icÚ
 = 
ÿnÚiÿl_icÚ
;

1793 
ÿnÚiÿl_u£r_sh“ts
 = 
	`dŸ_g‘_ÿnÚiÿl_·th
(
dœ_u£r_sh“ts
);

1794 
ÿnÚiÿl_sh“ts
 = 
	`dŸ_g‘_ÿnÚiÿl_·th
(
	`dŸ_g‘_d©a_dœeùÜy
("sheets"));

1795 if(
	`g_¡r_has_´efix
(
icÚ
, 
ÿnÚiÿl_u£r_sh“ts
))

1796 
icÚ
 +ğ
	`¡¾’
(
ÿnÚiÿl_u£r_sh“ts
) + 1;

1797 if(
	`g_¡r_has_´efix
(
icÚ
, 
ÿnÚiÿl_sh“ts
))

1798 
icÚ
 +ğ
	`¡¾’
(
ÿnÚiÿl_sh“ts
) + 1;

1799 
	`xmlAddChd
(
icÚ_node
, 
	`xmlNewText
((
xmlCh¬
 *è
icÚ
));

1800 
	`xmlAddChd
(
objeù_node
, 
	`xmlNewText
((cÚ¡ 
xmlCh¬
 *)"\n"));

1801 
	`g_ä“
(
ÿnÚiÿl_icÚ
);

1802 
	`g_ä“
(
ÿnÚiÿl_u£r_sh“ts
);

1803 
	`g_ä“
(
ÿnÚiÿl_sh“ts
);

1806 
	`xmlS‘DocCom´essMode
(
doc
, 0);

1807 
	`xmlDŸSaveFe
(
f’ame
, 
doc
);

1808 
	`xmlF»eDoc
(
doc
);

1809  
TRUE
;

1810 
	}
}

1813 
	$touch_fe
(
gch¬
 *
f’ame
)

1815 
¡©
 
¡©_buf
;

1816 
utimbuf
 
utim_buf
;

1818 
	`g_¡©
(
f’ame
, &
¡©_buf
);

1819 
utim_buf
.
aùime
 = 
¡©_buf
.
¡_©ime
;

1820 
utim_buf
.
modtime
 = 
	`time
(
NULL
);

1821 
	`utime
(
f’ame
, &
utim_buf
);

1822 
	}
}

1824 
gšt


1825 
	$sh“ts_fšd_sh“t
(
gcÚ¡poš‹r
 
a
, gcÚ¡poš‹¸
b
)

1827 ià(!
	`¡rcmp
(((
Sh“t
 *)
a
)->
Çme
, ((Sh“ˆ*)
b
)->name))

1831 
	}
}

1833 
GSLi¡
 *
sh“ts_mods_li¡
;

1836 
	$Ú_sh“ts_dŸlog_bu‰Ú_­¶y_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

1837 
gpoš‹r
 
u£r_d©a
)

1839 
GSLi¡
 *
™”_li¡
;

1841 
™”_li¡
 = 
sh“ts_mods_li¡
; iter_list;

1842 
™”_li¡
 = 
	`g_¦i¡_Ãxt
(iter_list))

1844 
Sh“tMod
 *
sm
;

1845 
GSLi¡
 *
sh“ts_li¡
;

1846 
GSLi¡
 *
fšd_li¡
;

1848 
sm
 = 
™”_li¡
->
d©a
;

1849 
sm
->
mod
)

1851 
GSLi¡
 *
sh“t_objeù_mods_li¡
;

1852 
GSLi¡
 *
li¡
;

1853 
Sh“t
 *
Ãw_sh“t
 = 
NULL
;

1855 
SHEETMOD_MOD_NEW
:

1856 
	`wr™e_u£r_sh“t
(&
sm
->
sh“t
);

1858 
sh“t_objeù_mods_li¡
 = 
sm
->
sh“t
.
objeùs
;

1859 
sm
->
sh“t
.
objeùs
 = 
NULL
;

1861 
Ãw_sh“t
 = 
	`g_Ãw0
 (
Sh“t
, 1);

1862 *
Ãw_sh“t
 = 
sm
->
sh“t
;

1863 
	`»gi¡”_sh“t
(
Ãw_sh“t
);

1865 
li¡
 = 
sh“t_objeù_mods_li¡
;†i¡;†i¡ = 
	`g_¦i¡_Ãxt
(list))

1867 
Sh“tObjeùMod
 *
som
;

1868 
Sh“tObjeù
 *
Ãw_objeù
;

1870 
som
 = 
li¡
->
d©a
;

1871 ià(
som
->
mod
 =ğ
SHEET_OBJECT_MOD_DELETED
)

1874 
Ãw_objeù
 = 
	`g_Ãw0
(
Sh“tObjeù
, 1);

1875 *
Ãw_objeù
 = 
som
->
sh“t_objeù
;

1876 
	`sh“t_­³nd_sh“t_obj
(
Ãw_sh“t
, 
Ãw_objeù
);

1879 
	`dŸ_sÜt_sh“ts
();

1880 
	`fl_sh“t_m’u
();

1883 
SHEETMOD_MOD_CHANGED
:

1884 
	`wr™e_u£r_sh“t
(&
sm
->
sh“t
);

1886 
sh“t_objeù_mods_li¡
 = 
sm
->
sh“t
.
objeùs
;

1887 
sh“ts_li¡
 = 
	`g‘_sh“ts_li¡
();

1889 
sh“ts_li¡
 = 
	`g_¦i¡_fšd_cu¡om
(sh“ts_li¡, &
sm
->
sh“t
,

1890 
sh“ts_fšd_sh“t
);

1891 
	`g_as£¹
(
sh“ts_li¡
);

1892 ((
Sh“t
 *)(
sh“ts_li¡
->
d©a
))->
objeùs
 = 
NULL
;

1894 
li¡
 = 
sh“t_objeù_mods_li¡
;†i¡;†i¡ = 
	`g_¦i¡_Ãxt
(list))

1896 
Sh“tObjeùMod
 *
som
;

1897 
Sh“tObjeù
 *
Ãw_objeù
;

1899 
som
 = 
li¡
->
d©a
;

1900 ià(
som
->
mod
 =ğ
SHEET_OBJECT_MOD_DELETED
)

1903 
Ãw_objeù
 = 
	`g_Ãw0
(
Sh“tObjeù
, 1);

1904 *
Ãw_objeù
 = 
som
->
sh“t_objeù
;

1905 
	`sh“t_­³nd_sh“t_obj
(
sh“ts_li¡
->
d©a
, 
Ãw_objeù
);

1907 
	`fl_sh“t_m’u
();

1910 
SHEETMOD_MOD_DELETED
:

1911 ià(
sm
->
sh“t
.
scİe
 =ğ
SHEET_SCOPE_SYSTEM
)

1912 
	`touch_fe
(
sm
->
sh“t
.
shadowšg
->
f’ame
);

1914 
	`g_uÆšk
(
sm
->
sh“t
.
f’ame
);

1916 
sh“ts_li¡
 = 
	`g‘_sh“ts_li¡
();

1917 
fšd_li¡
 = 
	`g_¦i¡_fšd_cu¡om
(
sh“ts_li¡
, &
sm
->
sh“t
,

1918 
sh“ts_fšd_sh“t
);

1919 
	`g_as£¹
(
sh“ts_li¡
);

1920 ià(!
	`g_¦i¡_»move_lšk
(
sh“ts_li¡
, 
fšd_li¡
))

1921 
	`g_w¬nšg
 ("No sheets†eft?");

1923 
	`dŸ_sÜt_sh“ts
();

1924 
	`fl_sh“t_m’u
();

1927 
SHEETMOD_MOD_NONE
:

1931 
	`g_as£¹_nÙ_»ached
();

1935 
İtiÚm’u_aùiv©e_fœ¡_·ss
 = 
TRUE
;

1937 
	`sh“ts_dŸlog_­¶y_»v”t_£t_£ns™ive
(
FALSE
);

1938 
	`sh“ts_dŸlog_ü—‹
();

1940 
	}
}

1943 
	$Ú_sh“ts_dŸlog_bu‰Ú_»v”t_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

1944 
gpoš‹r
 
u£r_d©a
)

1946 
İtiÚm’u_aùiv©e_fœ¡_·ss
 = 
TRUE
;

1948 
	`sh“ts_dŸlog_­¶y_»v”t_£t_£ns™ive
(
FALSE
);

1949 
	`sh“ts_dŸlog_ü—‹
();

1950 
	}
}

	@O:\tool\dvs50\app\sheets_dialog_callbacks.h

23 #ifdeà
GNOME


24 
	~<gnome.h
>

26 
	~<gtk/gtk.h
>

29 
gboŞ—n


30 
Ú_sh“ts_maš_dŸlog_d–‘e_ev’t
 (
GtkWidg‘
 *
widg‘
,

31 
GdkEv’t
 *
ev’t
,

32 
gpoš‹r
 
u£r_d©a
);

35 
Ú_sh“ts_dŸlog_İtiÚm’u_aùiv©e
 (
GtkM’uI‹m
 *
m’u™em
,

36 
gpoš‹r
 
u£r_d©a
);

40 
	gÚ_sh“ts_dŸlog_bu‰Ú_move_up_şicked


41 (
GtkBu‰Ú
 *
	gbu‰Ú
,

42 
gpoš‹r
 
	gu£r_d©a
);

45 
	gÚ_sh“ts_dŸlog_bu‰Ú_move_up_şicked


46 (
GtkBu‰Ú
 *
	gbu‰Ú
,

47 
gpoš‹r
 
	gu£r_d©a
);

50 
Ú_sh“ts_dŸlog_bu‰Ú_Ãw_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

51 
gpoš‹r
 
u£r_d©a
);

54 
Ú_sh“ts_dŸlog_bu‰Ú_Ãw_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

55 
gpoš‹r
 
u£r_d©a
);

58 
Ú_sh“ts_dŸlog_bu‰Ú_şo£_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

59 
gpoš‹r
 
u£r_d©a
);

62 
Ú_sh“ts_dŸlog_bu‰Ú_şo£_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

63 
gpoš‹r
 
u£r_d©a
);

66 
	gÚ_sh“ts_Ãw_dŸlog_bu‰Ú_brow£_şicked


67 (
GtkBu‰Ú
 *
	gbu‰Ú
,

68 
gpoš‹r
 
	gu£r_d©a
);

71 
	gÚ_sh“ts_sh­e£ËùiÚ_dŸlog_ÿnûl_bu‰Ú1_şicked


72 (
GtkBu‰Ú
 *
	gbu‰Ú
,

73 
gpoš‹r
 
	gu£r_d©a
);

76 
	gÚ_sh“ts_Ãw_dŸlog_bu‰Ú_ÿnûl_şicked


77 (
GtkBu‰Ú
 *
	gbu‰Ú
,

78 
gpoš‹r
 
	gu£r_d©a
);

81 
Ú_sh“ts_dŸlog_bu‰Ú_ed™_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

82 
gpoš‹r
 
u£r_d©a
);

85 
	gÚ_sh“ts_ed™_dŸlog_bu‰Ú_ÿnûl_şicked


86 (
GtkBu‰Ú
 *
	gbu‰Ú
,

87 
gpoš‹r
 
	gu£r_d©a
);

90 
Ú_sh“ts_dŸlog_bu‰Ú_»move_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

91 
gpoš‹r
 
u£r_d©a
);

94 
Ú_sh“ts_dŸlog_bu‰Ú_»move_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

95 
gpoš‹r
 
u£r_d©a
);

98 
	gÚ_sh“ts_»move_dŸlog_bu‰Ú_ÿnûl_şicked


99 (
GtkBu‰Ú
 *
	gbu‰Ú
,

100 
gpoš‹r
 
	gu£r_d©a
);

103 
	gÚ_sh“ts_Ãw_dŸlog_¿diobu‰Ú_sh“t_Çme_toggËd


104 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

105 
gpoš‹r
 
	gu£r_d©a
);

108 
	gÚ_sh“ts_Ãw_dŸlog_¿diobu‰Ú_svg_sh­e_toggËd


109 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

110 
gpoš‹r
 
	gu£r_d©a
);

113 
	gÚ_sh“ts_Ãw_dŸlog_¿diobu‰Ú_lše_b»ak_toggËd


114 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

115 
gpoš‹r
 
	gu£r_d©a
);

118 
	gÚ_sh“ts_Ãw_dŸlog_¿diobu‰Ú_sh“t_toggËd


119 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

120 
gpoš‹r
 
	gu£r_d©a
);

123 
	gÚ_sh“ts_»move_dŸlog_¿diobu‰Ú_objeù_toggËd


124 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

125 
gpoš‹r
 
	gu£r_d©a
);

128 
	gÚ_sh“ts_»move_dŸlog_¿diobu‰Ú_sh“t_toggËd


129 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

130 
gpoš‹r
 
	gu£r_d©a
);

133 
	gÚ_sh“ts_dŸlog_bu‰Ú_move_down_şicked


134 (
GtkBu‰Ú
 *
	gbu‰Ú
,

135 
gpoš‹r
 
	gu£r_d©a
);

138 
Ú_sh“ts_Ãw_dŸlog_bu‰Ú_ok_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

139 
gpoš‹r
 
u£r_d©a
);

142 
	gÚ_sh“ts_Ãw_dŸlog_¿diobu‰Ú_lše_b»ak_toggËd


143 (
GtkToggËBu‰Ú
 *
	gtoggËbu‰Ú
,

144 
gpoš‹r
 
	gu£r_d©a
);

147 
	gÚ_sh“ts_»move_dŸlog_ok_bu‰Ú_şicked


148 (
GtkBu‰Ú
 *
	gbu‰Ú
,

149 
gpoš‹r
 
	gu£r_d©a
);

152 
	gÚ_sh“ts_»move_dŸlog_bu‰Ú_ok_şicked


153 (
GtkBu‰Ú
 *
	gbu‰Ú
,

154 
gpoš‹r
 
	gu£r_d©a
);

157 
	gÚ_sh“ts_ed™_dŸlog_bu‰Ú_ok_şicked


158 (
GtkBu‰Ú
 *
	gbu‰Ú
,

159 
gpoš‹r
 
	gu£r_d©a
);

162 
	gÚ_sh“ts_ed™_dŸlog_’Œy_objeù_desütiÚ_chªged


163 (
GtkEd™abË
 *
	ged™abË
,

164 
gpoš‹r
 
	gu£r_d©a
);

167 
	gÚ_sh“ts_ed™_dŸlog_’Œy_sh“t_desütiÚ_chªged


168 (
GtkEd™abË
 *
	ged™abË
,

169 
gpoš‹r
 
	gu£r_d©a
);

172 
	gÚ_sh“ts_ed™_dŸlog_’Œy_sh“t_Çme_chªged


173 (
GtkEd™abË
 *
	ged™abË
,

174 
gpoš‹r
 
	gu£r_d©a
);

177 
Ú_sh“ts_dŸlog_bu‰Ú_cİy_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

178 
gpoš‹r
 
u£r_d©a
);

181 
	gÚ_sh“ts_dŸlog_bu‰Ú_cİy_®l_şicked


182 (
GtkBu‰Ú
 *
	gbu‰Ú
,

183 
gpoš‹r
 
	gu£r_d©a
);

186 
Ú_sh“ts_dŸlog_bu‰Ú_move_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

187 
gpoš‹r
 
u£r_d©a
);

190 
	gÚ_sh“ts_dŸlog_bu‰Ú_move_®l_şicked


191 (
GtkBu‰Ú
 *
	gbu‰Ú
,

192 
gpoš‹r
 
	gu£r_d©a
);

195 
Ú_sh“ts_dŸlog_bu‰Ú_­¶y_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

196 
gpoš‹r
 
u£r_d©a
);

199 
Ú_sh“ts_dŸlog_bu‰Ú_»v”t_şicked
 (
GtkBu‰Ú
 *
bu‰Ú
,

200 
gpoš‹r
 
u£r_d©a
);

203 
	gÚ_sh“ts_sh­e£ËùiÚ_dŸlog_bu‰Ú_ok_şicked


204 (
GtkBu‰Ú
 *
	gbu‰Ú
,

205 
gpoš‹r
 
	gu£r_d©a
);

208 
	gÚ_sh“ts_sh­e£ËùiÚ_dŸlog_bu‰Ú_ÿnûl_şicked


209 (
GtkBu‰Ú
 *
	gbu‰Ú
,

210 
gpoš‹r
 
	gu£r_d©a
);

212 
GtkWidg‘
 *

213 
sh“ts_dŸlog_g‘_aùive_bu‰Ú
(
GtkWidg‘
 **
w¿pbox
, 
GLi¡
 **
bu‰Ú_li¡
);

	@O:\tool\dvs50\app\splash.c

1 
	~<cÚfig.h
>

3 #undeà
GTK_DISABLE_DEPRECATED


4 
	~<gtk/gtk.h
>

5 
	~<gdk-pixbuf/gdk-pixbuf.h
>

7 
	~"š.h
"

8 
	~"dŸ_dœs.h
"

9 
	~"­p_´ocs.h
"

11 
GtkWidg‘
*

12 
	$g‘_logo_pixm­
 ()

14 
GdkPixbuf
 *
logo
 = 
NULL
;

15 
GtkWidg‘
* 
gpixm­
 = 
NULL
;

16 
gch¬
 
¡r
[512];

18 
gch¬
* 
d©adœ
 = 
	`dŸ_g‘_d©a_dœeùÜy
("");

19 
	`g_¢´štf
(
¡r
, (¡r), "%s/dŸ-¥Ïsh.²g", 
d©adœ
);

20 
logo
 = 
	`gdk_pixbuf_Ãw_äom_fe
(
¡r
, 
NULL
);

21 
	`g_ä“
(
d©adœ
);

23 ià(
logo
) {

24 
GdkPixm­
 *
pixm­
;

25 
GdkB™m­
 *
b™m­
;

27 
	`gdk_pixbuf_»nd”_pixm­_ªd_mask
(
logo
, &
pixm­
, &
b™m­
, 128);

28 
gpixm­
 = 
	`gtk_pixm­_Ãw
(
pixm­
, 
b™m­
);

29 
	`gdk_pixm­_uÄef
(
pixm­
);

30 ià(
b™m­
è
	`gdk_b™m­_uÄef
(bitmap);

31 
	`g_objeù_uÄef
 (
logo
);

33  
gpixm­
;

34 
	}
}

36 
GtkWidg‘
* 
	g¥Ïsh
 = 
NULL
;

39 
	$¥Ïsh_expo£
 (
GtkWidg‘
 *
widg‘
, 
GdkEv’tExpo£
 *
ev’t
)

42 
	`gtk_maš_qu™
();

43 
	}
}

46 
	$­p_¥Ïsh_š™
 (cÚ¡ 
gch¬
* 
âame
)

48 
GtkWidg‘
 *
vbox
;

49 
GtkWidg‘
* 
gpixm­
;

50 
GtkWidg‘
 *
Ïb–
;

51 
GtkWidg‘
 *
äame
;

52 
gch¬
 
¡r
[256];

53 
gulÚg
 
sigÇl_id
;

55 
¥Ïsh
 = 
	`gtk_wšdow_Ãw
 (
GTK_WINDOW_TOPLEVEL
);

56 
	`gtk_wšdow_£t_rŞe
 (
	`GTK_WINDOW
 (
¥Ïsh
), "start_dialog");

57 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
 (
¥Ïsh
), 
	`_
("Loading ..."));

58 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
¥Ïsh
), 
FALSE
);

59 
	`gtk_wšdow_£t_pos™iÚ
 (
	`GTK_WINDOW
 (
¥Ïsh
), 
GTK_WIN_POS_CENTER
);

61 
vbox
 = 
	`gtk_vbox_Ãw
 (
FALSE
, 2);

62 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
vbox
), 5);

63 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
(
¥Ïsh
), 
vbox
);

65 
gpixm­
 = 
	`g‘_logo_pixm­
();

67 
äame
 = 
	`gtk_äame_Ãw
 (
NULL
);

68 
	`gtk_äame_£t_shadow_ty³
 (
	`GTK_FRAME
 (
äame
), 
GTK_SHADOW_IN
);

69 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
 (
äame
), 1);

70 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
), 
äame
, 
FALSE
, 
TRUE
, 1);

72 ià(
gpixm­
)

73 
	`gtk_cÚš”_add
 (
	`GTK_CONTAINER
(
äame
), 
gpixm­
);

75 
	`g_¢´štf
(
¡r
, (¡r), 
	`_
("DŸ v %s"), 
VERSION
);

76 
Ïb–
 = 
	`gtk_Ïb–_Ãw
 (
¡r
);

77 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
), 
Ïb–
, 
FALSE
, 
TRUE
, 1);

79 
	`gtk_widg‘_show_®l
 (
¥Ïsh
);

81 
sigÇl_id
 = 
	`g_sigÇl_cÚÃù_aá”
(
	`GTK_OBJECT
(
¥Ïsh
), "expose_event",

82 
	`GTK_SIGNAL_FUNC
(
¥Ïsh_expo£
), 
NULL
);

85 
	`gtk_maš
();

86 
	`g_sigÇl_hªdËr_discÚÃù
(
	`GTK_OBJECT
(
¥Ïsh
), 
sigÇl_id
);

87 
	}
}

90 
	$­p_¥Ïsh_dÚe
 ()

92 ià(
¥Ïsh
)

94 
	`gtk_widg‘_de¡roy
 (
¥Ïsh
);

95 
¥Ïsh
 = 
NULL
;

97 
	}
}

	@O:\tool\dvs50\app\textedit.c

35 
	~<cÚfig.h
>

37 
	~"objeù.h
"

38 
	~"focus.h
"

39 
	~"di¥Ïy.h
"

40 
	~"highlight.h
"

41 
	~"‹x‹d™.h
"

42 
	~"objeù_İs.h
"

43 
	~"‹xt.h
"

45 
	sTextEd™Chªge
 {

46 
Chªge
 
	mobj_chªge
;

49 
gch¬
 *
	mÜig_‹xt
;

51 
gch¬
 *
	mÃw_‹xt
;

54 
Text
 *
	m‹xt
;

55 } 
	tTextEd™Chªge
;

57 
Chªge
 *
‹xt_ed™_ü—‹_chªge
(
Text
 *
‹xt
);

58 
‹xt_ed™_upd©e
(
TextEd™Chªge
 *
chªge
);

59 
‹xt_ed™_­¶y
(
Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
);

60 
‹x‹d™_’d_ed™
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
);

63 
gboŞ—n


64 
	$‹x‹d™_mode
(
DDi¥Ïy
 *
ddi¥
)

66  
	`ddi¥Ïy_aùive_focus
(
ddi¥
è!ğ
NULL
;

67 
	}
}

77 
	$‹x‹d™_di¥Ïy_chªge
(
DDi¥Ïy
 *
ddi¥
)

79 
	}
}

87 
	$‹x‹d™_’‹r
(
DDi¥Ïy
 *
ddi¥
)

89 ià(
	`‹x‹d™_mode
(
ddi¥
)) {

94 
	`‹x‹d™_di¥Ïy_chªge
(
ddi¥
);

95 
	}
}

104 
	$‹x‹d™_ex™
(
DDi¥Ïy
 *
ddi¥
)

106 ià(!
	`‹x‹d™_mode
(
ddi¥
)) {

109 ià(
	`ddi¥Ïy_aùive_focus
(
ddi¥
è!ğ
NULL
) {

110 
	`‹x‹d™_’d_ed™
(
ddi¥
, 
	`ddi¥Ïy_aùive_focus
(ddisp));

114 
	`‹x‹d™_di¥Ïy_chªge
(
ddi¥
);

115 
	}
}

125 
	$‹x‹d™_begš_ed™
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
)

127 
CŞÜ
 *
focus_cŞ
 = 
	`cŞÜ_Ãw_rgb
(1.0, 1.0, 0.0);

129 
	`g_as£¹
(
	`dŸ_objeù_is_£Ëùed
(
	`focus_g‘_objeù
(
focus
)));

130 ià(!
	`‹x‹d™_mode
(
ddi¥
)) {

131 
	`‹x‹d™_’‹r
(
ddi¥
);

133 
	`ddi¥Ïy_£t_aùive_focus
(
ddi¥
, 
focus
);

134 
	`highlight_objeù
(
focus
->
obj
, 
focus_cŞ
, 
ddi¥
->
dŸg¿m
);

135 
	`objeù_add_upd©es
(
focus
->
obj
, 
ddi¥
->
dŸg¿m
);

139 
	}
}

148 
	$‹x‹d™_’d_ed™
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
)

152 ià(!
ddi¥
)

155 
	`g_as£¹
(
	`‹x‹d™_mode
(
ddi¥
));

160 
	`highlight_objeù_off
(
focus
->
obj
, 
ddi¥
->
dŸg¿m
);

161 
	`objeù_add_upd©es
(
focus
->
obj
, 
ddi¥
->
dŸg¿m
);

169 
	`ddi¥Ïy_£t_aùive_focus
(
ddi¥
, 
NULL
);

170 
	}
}

173 
Focus
 *

174 
	$‹x‹d™_move_focus
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
, 
gboŞ—n
 
fÜw¬ds
)

176 ià(
focus
 !ğ
NULL
) {

177 
	`‹x‹d™_’d_ed™
(
ddi¥
, 
focus
);

179 ià(
fÜw¬ds
) {

180 
Focus
 *
Ãw_focus
 = 
	`focus_Ãxt_Ú_dŸg¿m
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

181 ià(
Ãw_focus
 !ğ
NULL
è
	`give_focus
(new_focus);

183 
Focus
 *
Ãw_focus
 = 
	`focus_´evious_Ú_dŸg¿m
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

184 ià(
Ãw_focus
 !ğ
NULL
è
	`give_focus
(new_focus);

186 
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

188 ià(
focus
 !ğ
NULL
) {

189 
	`‹x‹d™_begš_ed™
(
ddi¥
, 
focus
);

191 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

192  
focus
;

193 
	}
}

199 
	$‹x‹d™_aùiv©e_focus
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
, 
Pošt
 *
şicked
)

201 
Focus
 *
Şd_focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

202 ià(
Şd_focus
 !ğ
NULL
) {

203 
	`‹x‹d™_’d_ed™
(
ddi¥
, 
Şd_focus
);

205 ià(
şicked
) {

206 
	`‹xt_£t_cursÜ
((
Text
*)
focus
->
u£r_d©a
, 
şicked
, 
ddi¥
->
»nd””
);

208 
	`‹x‹d™_begš_ed™
(
ddi¥
, 
focus
);

209 
	`give_focus
(
focus
);

210 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

211 
	}
}

219 
gboŞ—n


220 
	$‹x‹d™_aùiv©e_objeù
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
)

222 
Focus
 *
Ãw_focus
;

224 
Ãw_focus
 = 
	`focus_g‘_fœ¡_Ú_objeù
(
obj
);

225 ià(
Ãw_focus
 !ğ
NULL
) {

226 
Focus
 *
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

227 ià(
focus
 !ğ
NULL
) {

228 
	`‹x‹d™_’d_ed™
(
ddi¥
, 
focus
);

230 
	`give_focus
(
Ãw_focus
);

231 ià(
şicked
) {

232 
	`‹xt_£t_cursÜ
((
Text
*)
Ãw_focus
->
u£r_d©a
, 
şicked
, 
ddi¥
->
»nd””
);

234 
	`‹x‹d™_begš_ed™
(
ddi¥
, 
Ãw_focus
);

235 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

236  
TRUE
;

238 
	`‹x‹d™_ex™
(
ddi¥
);

239  
FALSE
;

241 
	}
}

249 
	$‹x‹d™_aùiv©e_fœ¡
(
DDi¥Ïy
 *
ddi¥
)

251 
Focus
 *
Ãw_focus
 = 
NULL
;

252 
GLi¡
 *
tmp
, *
£Ëùed
 = 
	`dŸg¿m_g‘_sÜ‹d_£Ëùed
(
ddi¥
->
dŸg¿m
);

253 
Focus
 *
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
ddi¥
->
dŸg¿m
);

255 ià(
focus
 !ğ
NULL
) {

256 
	`‹x‹d™_’d_ed™
(
ddi¥
, 
focus
);

258 
tmp
 = 
£Ëùed
;

259 
Ãw_focus
 =ğ
NULL
 && 
tmp
 != NULL) {

260 
DŸObjeù
 *
obj
 = (DŸObjeù*è
£Ëùed
->
d©a
;

261 
Ãw_focus
 = 
	`focus_g‘_fœ¡_Ú_objeù
(
obj
);

262 
tmp
 = 
	`g_li¡_Ãxt
(tmp);

264 
	`g_li¡_ä“
 (
£Ëùed
);

265 ià(
Ãw_focus
 !ğ
NULL
) {

266 
	`give_focus
(
Ãw_focus
);

267 
	`‹x‹d™_begš_ed™
(
ddi¥
, 
Ãw_focus
);

268 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

270 
	`‹x‹d™_ex™
(
ddi¥
);

272 
	}
}

282 
	$‹x‹d™_d—ùiv©e_focus
()

284 ià(
	`ddi¥Ïy_aùive
(è!ğ
NULL
) {

285 
DŸg¿mD©a
 *
dŸ
 = (DŸg¿mD©¨*è
	`ddi¥Ïy_aùive
()->
dŸg¿m
;

286 
Focus
 *
focus
 = 
	`g‘_aùive_focus
(
dŸ
);

287 ià(
focus
 !ğ
NULL
) {

288 
	`»move_focus_Ú_dŸg¿m
(
dŸ
);

291 
	`‹x‹d™_ex™
(
	`ddi¥Ïy_aùive
());

293 
	}
}

299 
	$‹x‹d™_»move_focus
(
DŸObjeù
 *
obj
, 
DŸg¿m
 *
dŸg¿m
)

302 ià(
	`»move_focus_objeù
(
obj
)) {

306 ià(
	`ddi¥Ïy_aùive
(è!ğ
NULL
) {

307 
	`‹x‹d™_ex™
(
	`ddi¥Ïy_aùive
());

309 
	}
}

315 
	$‹x‹d™_»move_focus_®l
(
DŸg¿m
 *
dŸg¿m
)

317 
Focus
 *
focus
 = 
	`g‘_aùive_focus
((
DŸg¿mD©a
 *è
dŸg¿m
);

318 ià(
focus
 !ğ
NULL
) {

321 
	`»£t_foci_Ú_dŸg¿m
((
DŸg¿mD©a
 *è
dŸg¿m
);

323 ià(
	`ddi¥Ïy_aùive
(è!ğ
NULL
) {

324 
	`‹x‹d™_ex™
(
	`ddi¥Ïy_aùive
());

326 
	}
}

339 
	$‹xt_ed™_­¶y
(
Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

341 
TextEd™Chªge
 *
‹_chªge
 = (TextEd™Chªg*è
chªge
;

342 
	`‹xt_£t_¡ršg
(
‹_chªge
->
‹xt
,e_chªge->
Ãw_‹xt
);

343 
	}
}

346 
	$‹xt_ed™_»v”t
(
TextEd™Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

348 ià(
	`‹x‹d™_mode
(
	`ddi¥Ïy_aùive
())) {

349 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

350 
	`‹x‹d™_ex™
(
ddi¥
);

352 
	`‹xt_£t_¡ršg
(
chªge
->
‹xt
, chªge->
Üig_‹xt
);

353 
	}
}

356 
	$‹xt_ed™_ä“
(
TextEd™Chªge
 *
chªge
)

358 
	`g_ä“
(
chªge
->
Üig_‹xt
);

359 ià(
chªge
->
Ãw_‹xt
) {

360 
	`g_ä“
(
chªge
->
Ãw_‹xt
);

362 
	}
}

367 
Chªge
 *

368 
	$‹xt_ed™_ü—‹_chªge
(
Text
 *
‹xt
)

370 
TextEd™Chªge
 *
chªge
;

372 
chªge
 = 
	`g_Ãw0
(
TextEd™Chªge
, 1);

374 
chªge
->
obj_chªge
.
­¶y
 = (
UndoAµlyFunc
è
‹xt_ed™_­¶y
;

375 
chªge
->
obj_chªge
.
»v”t
 = (
UndoRev”tFunc
è
‹xt_ed™_»v”t
;

376 
chªge
->
obj_chªge
.
ä“
 = (
UndoF»eFunc
è
‹xt_ed™_ä“
;

378 
chªge
->
‹xt
 =ext;

379 ià(
	`‹xt_is_em±y
(
‹xt
)) {

380 
chªge
->
Üig_‹xt
 = 
	`g_¡rdup
("");

382 
chªge
->
Üig_‹xt
 = 
	`‹xt_g‘_¡ršg_cİy
(
‹xt
);

386  (
Chªge
 *)
chªge
;

387 
	}
}

392 
	$‹xt_ed™_upd©e
(
TextEd™Chªge
 *
chªge
)

394 
chªge
->
Ãw_‹xt
 = 
	`‹xt_g‘_¡ršg_cİy
(chªge->
‹xt
);

395 
	}
}

	@O:\tool\dvs50\app\textedit.h

19 #iâdeà
TEXTEDIT_H


20 
	#TEXTEDIT_H


	)

21 
	~<sys/ty³s.h
>

22 
	~<glib.h
>

24 
	~"dŸty³s.h
"

25 
	~"di¥Ïy.h
"

27 
Focus
 *
‹x‹d™_move_focus
(
DDi¥Ïy
 *
ddi¥
, Focu *
focus
, 
gboŞ—n
 
fÜw¬ds
);

29 
gboŞ—n
 
‹x‹d™_mode
(
DDi¥Ïy
 *
ddi¥
);

30 
‹x‹d™_aùiv©e_focus
(
DDi¥Ïy
 *
ddi¥
, 
Focus
 *
focus
, 
Pošt
 *
şicked
);

31 
gboŞ—n
 
‹x‹d™_aùiv©e_objeù
(
DDi¥Ïy
 *
ddi¥
, 
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
);

32 
‹x‹d™_aùiv©e_fœ¡
(
DDi¥Ïy
 *
ddi¥
);

33 
‹x‹d™_d—ùiv©e_focus
();

34 
‹x‹d™_»move_focus
(
DŸObjeù
 *
obj
, 
DŸg¿m
 *
dŸg¿m
);

35 
‹x‹d™_»move_focus_®l
(
DŸg¿m
 *
dŸg¿m
);

	@O:\tool\dvs50\app\textedit_tool.c

18 
	~<cÚfig.h
>

20 
	~"‹x‹d™_toŞ.h
"

22 
	~"dŸg¿m.h
"

23 
	~"‹x‹d™.h
"

24 
	~"cursÜ.h
"

25 
	~"objeù_İs.h
"

33 
DŸObjeù
 *

34 
	$şick_£Ëù_objeù
(
DDi¥Ïy
 *
ddi¥
, 
Pošt
 *
şickedpošt
,

35 
GdkEv’tBu‰Ú
 *
ev’t
)

37 
»®
 
şick_di¡ªû
 = 
	`ddi¥Ïy_uÁ¿nsfÜm_Ëngth
(
ddi¥
, 3.0);

38 
DŸg¿m
 *
dŸg¿m
 = 
ddi¥
->diagram;

39 
DŸObjeù
 *
obj
;

41 
	`ddi¥Ïy_uÁ¿nsfÜm_coÜds
(
ddi¥
,

42 ()
ev’t
->
x
, (ëv’t->
y
,

43 &
şickedpošt
->
x
, &şickedpošt->
y
);

45 
obj
 = 
	`dŸg¿m_fšd_şicked_objeù
 (
dŸg¿m
, 
şickedpošt
, 
şick_di¡ªû
);

47 ià(
obj
) {

49 
GLi¡
 *
®»ady
;

52 
®»ady
 = 
	`g_li¡_fšd
(
dŸg¿m
->
d©a
->
£Ëùed
, 
obj
);

53 ià(
®»ady
 =ğ
NULL
) {

54 ià(!(
ev’t
->
¡©e
 & 
GDK_SHIFT_MASK
)) {

56 
	`dŸg¿m_»move_®l_£Ëùed
(
dŸg¿m
, 
TRUE
);

58 
	`dŸg¿m_£Ëù
(
dŸg¿m
, 
obj
);

60 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

61 
	`objeù_add_upd©es_li¡
(
dŸg¿m
->
d©a
->
£Ëùed
, diagram);

62 
	`dŸg¿m_æush
(
dŸg¿m
);

64  
obj
;

67  
obj
;

68 
	}
}

71 
	$‹x‹d™_bu‰Ú_´ess
(
Tex‹d™ToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

72 
DDi¥Ïy
 *
ddi¥
)

74 
Pošt
 
şickedpošt
;

75 
DŸg¿m
 *
dŸg¿m
 = 
ddi¥
->diagram;

76 
DŸObjeù
 *
obj
 = 
	`şick_£Ëù_objeù
 (
ddi¥
, &
şickedpošt
, 
ev’t
);

78 ià(
obj
) {

79 ià(
obj
 !ğ
toŞ
->
objeù
)

80 
	`‹x‹d™_d—ùiv©e_focus
 ();

83 ià(
	`‹x‹d™_aùiv©e_objeù
(
ddi¥
, 
obj
, &
şickedpošt
)) {

84 
toŞ
->
objeù
 = 
obj
;

85 
toŞ
->
¡¬t_©
 = 
şickedpošt
;

86 
toŞ
->
¡©e
 = 
STATE_TEXT_SELECT
;

89 
	`toŞ_»£t
();

92 
	`‹x‹d™_d—ùiv©e_focus
 ();

93 
	`dŸg¿m_»move_®l_£Ëùed
(
dŸg¿m
, 
TRUE
);

94 
	`toŞ_»£t
();

96 
	}
}

99 
	$‹x‹d™_bu‰Ú_»Ëa£
(
Tex‹d™ToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

100 
DDi¥Ïy
 *
ddi¥
)

102 
Pošt
 
şickedpošt
;

103 
DŸg¿m
 *
dŸg¿m
 = 
ddi¥
->diagram;

104 
DŸObjeù
 *
obj
 = 
	`şick_£Ëù_objeù
 (
ddi¥
, &
şickedpošt
, 
ev’t
);

106 ià(
obj
) {

107 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

109 
toŞ
->
¡©e
 = 
STATE_TEXT_EDIT
;

113 
	`‹x‹d™_d—ùiv©e_focus
();

114 
	`toŞ_»£t
 ();

116 
	}
}

119 
	$‹x‹d™_mÙiÚ
(
Tex‹d™ToŞ
 *
toŞ
, 
GdkEv’tMÙiÚ
 *
ev’t
,

120 
DDi¥Ïy
 *
ddi¥
)

123 
	}
}

126 
	$‹x‹d™_doubË_şick
(
Tex‹d™ToŞ
 *
toŞ
, 
GdkEv’tBu‰Ú
 *
ev’t
,

127 
DDi¥Ïy
 *
ddi¥
)

130 
	}
}

132 
ToŞ
 *

133 
	$ü—‹_‹x‹d™_toŞ
()

135 
Tex‹d™ToŞ
 *
toŞ
;

136 
DDi¥Ïy
 *
ddi¥
;

138 
toŞ
 = 
	`g_Ãw0
(
Tex‹d™ToŞ
, 1);

139 
toŞ
->toŞ.
ty³
 = 
TEXTEDIT_TOOL
;

140 
toŞ
->toŞ.
bu‰Ú_´ess_func
 = (
Bu‰ÚP»ssFunc
è&
‹x‹d™_bu‰Ú_´ess
;

141 
toŞ
->toŞ.
bu‰Ú_»Ëa£_func
 = (
Bu‰ÚR–—£Func
è&
‹x‹d™_bu‰Ú_»Ëa£
;

142 
toŞ
->toŞ.
mÙiÚ_func
 = (
MÙiÚFunc
è&
‹x‹d™_mÙiÚ
;

143 
toŞ
->toŞ.
doubË_şick_func
 = (
DoubËClickFunc
è&
‹x‹d™_doubË_şick
;

145 
	`ddi¥Ïy_£t_®l_cursÜ
(
	`g‘_cursÜ
(
CURSOR_XTERM
));

147 
ddi¥
 = 
	`ddi¥Ïy_aùive
();

148 ià(
ddi¥
) {

149 
	`‹x‹d™_aùiv©e_fœ¡
 (
ddi¥
);

150 
	`ddi¥Ïy_æush
(
ddi¥
);

152 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
ddi¥
);

155  (
ToŞ
 *)
toŞ
;

156 
	}
}

159 
	$ä“_‹x‹d™_toŞ
 (
ToŞ
 *
toŞ
)

161 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

162 ià(
ddi¥
) {

163 
	`‹x‹d™_d—ùiv©e_focus
 ();

164 
	`ddi¥Ïy_æush
(
ddi¥
);

166 
	`ddi¥Ïy_£t_®l_cursÜ
(
deçuÉ_cursÜ
);

168 
	`g_ä“
 (
toŞ
);

169 
	}
}

	@O:\tool\dvs50\app\textedit_tool.h

18 #iâdeà
TEXTEDIT_TOOL_H


19 
	#TEXTEDIT_TOOL_H


	)

21 
	~"toŞ.h
"

22 
	~"dŸty³s.h
"

24 
	eTex‹d™ToŞS‹
 {

25 
	mSTATE_TEXT_SELECT
,

26 
	mSTATE_TEXT_EDIT


29 
_Tex‹d™ToŞ
 
	tTex‹d™ToŞ
;

31 
	s_Tex‹d™ToŞ
 {

32 
ToŞ
 
	mtoŞ
;

34 
Tex‹d™ToŞS‹
 
	m¡©e
;

35 
DŸObjeù
 *
	mobjeù
;

36 
Pošt
 
	m¡¬t_©
;

39 
ToŞ
 *
ü—‹_‹x‹d™_toŞ
();

40 
ä“_‹x‹d™_toŞ
(
ToŞ
 *
toŞ
);

	@O:\tool\dvs50\app\tool.c

18 
	~<cÚfig.h
>

20 
	~"toŞ.h
"

21 
	~"ü—‹_objeù.h
"

22 
	~"magnify.h
"

23 
	~"modify_toŞ.h
"

24 
	~"süŞl_toŞ.h
"

25 
	~"‹x‹d™_toŞ.h
"

26 
	~"š‹rçû.h
"

27 
	~"deçuÉs.h
"

29 
ToŞ
 *
	gaùive_toŞ
 = 
NULL
;

30 
ToŞ
 *
	gŒªs›Á_toŞ
 = 
NULL
;

31 
GtkWidg‘
 *
	gaùive_bu‰Ú
 = 
NULL
;

32 
GtkWidg‘
 *
	gfÜm”_bu‰Ú
 = 
NULL
;

35 
	$toŞ_£Ëù_fÜm”
()

37 ià(
fÜm”_bu‰Ú
) {

38 
	`g_sigÇl_em™_by_Çme
(
	`GTK_OBJECT
(
fÜm”_bu‰Ú
), "clicked",

39 
	`GTK_BUTTON
(
fÜm”_bu‰Ú
), 
NULL
);

41 
	}
}

44 
	$toŞ_»£t
()

46 
	`g_sigÇl_em™_by_Çme
(
	`GTK_OBJECT
(
modify_toŞ_bu‰Ú
), "clicked",

47 
	`GTK_BUTTON
(
modify_toŞ_bu‰Ú
), 
NULL
);

48 
	}
}

51 
	$toŞ_g‘
(
ToŞS‹
 *
¡©e
)

53 
¡©e
->
ty³
 = 
aùive_toŞ
->type;

54 
¡©e
->
bu‰Ú
 = 
aùive_bu‰Ú
;

55 ià(
¡©e
->
ty³
 =ğ
CREATE_OBJECT_TOOL
) {

56 
¡©e
->
u£r_d©a
 = ((
C»©eObjeùToŞ
 *)
aùive_toŞ
)->user_data;

57 
¡©e
->
exŒa_d©a
 = ((
C»©eObjeùToŞ
 *)
aùive_toŞ
)->
objty³
->
Çme
;

58 
¡©e
->
šv”t_³rsi¡’û
 = ((
C»©eObjeùToŞ
 *)
aùive_toŞ
)->invert_persistence;

62 
¡©e
->
u£r_d©a
 = 
NULL
;

63 
¡©e
->
exŒa_d©a
 = 
NULL
;

64 
¡©e
->
šv”t_³rsi¡’û
 = 0;

66 
	}
}

69 
	$toŞ_»¡Üe
(cÚ¡ 
ToŞS‹
 *
¡©e
)

71 
	`toŞ_£Ëù
(
¡©e
->
ty³
, s‹->
exŒa_d©a
, s‹->
u£r_d©a
, s‹->
bu‰Ú
,

72 
¡©e
->
šv”t_³rsi¡’û
);

73 
	}
}

76 
	$toŞ_ä“
(
ToŞ
 *
toŞ
)

78 
toŞ
->
ty³
) {

79 
MODIFY_TOOL
:

80 
	`ä“_modify_toŞ
(
toŞ
);

82 
CREATE_OBJECT_TOOL
:

83 
	`ä“_ü—‹_objeù_toŞ
(
toŞ
);

85 
MAGNIFY_TOOL
:

86 
	`ä“_magnify_toŞ
(
toŞ
);

88 
SCROLL_TOOL
:

89 
	`ä“_süŞl_toŞ
(
toŞ
);

91 
TEXTEDIT_TOOL
 :

92 
	`ä“_‹x‹d™_toŞ
(
toŞ
);

95 
	`g_as£¹
(0);

97 
	}
}

100 
	$toŞ_£Ëù
(
ToŞTy³
 
ty³
, 
gpoš‹r
 
exŒa_d©a
,

101 
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 *
bu‰Ú
,

102 
šv”t_³rsi¡’û
)

104 ià(
bu‰Ú
)

105 
fÜm”_bu‰Ú
 = 
aùive_bu‰Ú
;

107 
	`toŞ_ä“
(
aùive_toŞ
);

108 
ty³
) {

109 
MODIFY_TOOL
:

110 
aùive_toŞ
 = 
	`ü—‹_modify_toŞ
();

112 
CREATE_OBJECT_TOOL
:

113 
aùive_toŞ
 =

114 
	`ü—‹_ü—‹_objeù_toŞ
(
	`objeù_g‘_ty³
((*)
exŒa_d©a
),

115 (*è
u£r_d©a
, 
šv”t_³rsi¡’û
);

117 
MAGNIFY_TOOL
:

118 
aùive_toŞ
 = 
	`ü—‹_magnify_toŞ
();

120 
SCROLL_TOOL
:

121 
aùive_toŞ
 = 
	`ü—‹_süŞl_toŞ
();

123 
TEXTEDIT_TOOL
 :

124 
aùive_toŞ
 = 
	`ü—‹_‹x‹d™_toŞ
();

127 
	`g_as£¹
(0);

129 ià(
bu‰Ú
)

130 
aùive_bu‰Ú
 = 
bu‰Ú
;

131 
	}
}

134 
	$toŞ_İtiÚs_dŸlog_show
(
ToŞTy³
 
ty³
, 
gpoš‹r
 
exŒa_d©a
,

135 
gpoš‹r
 
u£r_d©a
, 
GtkWidg‘
 *
bu‰Ú
,

136 
šv”t_³rsi¡’û
)

138 
DŸObjeùTy³
 *
objty³
;

140 ià(
aùive_toŞ
->
ty³
 !=ype)

141 
	`toŞ_£Ëù
(
ty³
,
exŒa_d©a
,
u£r_d©a
,
bu‰Ú
,
šv”t_³rsi¡’û
);

143 
ty³
) {

144 
MODIFY_TOOL
:

146 
CREATE_OBJECT_TOOL
:

147 
objty³
 = 
	`objeù_g‘_ty³
((*)
exŒa_d©a
);

148 
	`deçuÉs_show
(
objty³
, 
u£r_d©a
);

150 
MAGNIFY_TOOL
:

152 
SCROLL_TOOL
:

154 
TEXTEDIT_TOOL
 :

157 
	}
}

	@O:\tool\dvs50\app\tool.h

18 #iâdeà
TOOL_H


19 
	#TOOL_H


	)

21 
	~<gdk/gdk.h
>

23 
_ToŞ
 
	tToŞ
;

24 
_ToŞS‹
 
	tToŞS‹
;

26 
_ToŞTy³
 
	tToŞTy³
;

28 
	~"di¥Ïy.h
"

30 (* 
	tBu‰ÚP»ssFunc
è(
	tToŞ
 *, 
	tGdkEv’tBu‰Ú
 *, 
	tDDi¥Ïy
 *
	tddi¥
);

31 (* 
	tBu‰ÚHŞdFunc
è(
	tToŞ
 *, 
	tGdkEv’tBu‰Ú
 *, 
	tDDi¥Ïy
 *
	tddi¥
);

32 (* 
	tDoubËClickFunc
è(
	tToŞ
 *, 
	tGdkEv’tBu‰Ú
 *, 
	tDDi¥Ïy
 *
	tddi¥
);

33 (* 
	tBu‰ÚR–—£Func
è(
	tToŞ
 *, 
	tGdkEv’tBu‰Ú
 *, 
	tDDi¥Ïy
 *
	tddi¥
);

34 (* 
	tMÙiÚFunc
è(
	tToŞ
 *, 
	tGdkEv’tMÙiÚ
 *, 
	tDDi¥Ïy
 *
	tddi¥
);

36 
	e_ToŞTy³
 {

37 
CREATE_OBJECT_TOOL
,

38 
MAGNIFY_TOOL
,

39 
MODIFY_TOOL
,

40 
SCROLL_TOOL
,

41 
TEXTEDIT_TOOL


44 
	s_ToŞ
 {

45 
ToŞTy³
 
ty³
;

48 
Bu‰ÚP»ssFunc
 
bu‰Ú_´ess_func
;

49 
Bu‰ÚHŞdFunc
 
bu‰Ú_hŞd_func
;

50 
Bu‰ÚR–—£Func
 
bu‰Ú_»Ëa£_func
;

51 
MÙiÚFunc
 
mÙiÚ_func
;

52 
DoubËClickFunc
 
doubË_şick_func
;

55 
	s_ToŞS‹
 {

56 
ToŞTy³
 
ty³
;

57 
gpoš‹r
 
exŒa_d©a
;

58 
gpoš‹r
 
u£r_d©a
;

59 
GtkWidg‘
 *
bu‰Ú
;

60 
šv”t_³rsi¡’û
;

63 
ToŞ
 *
aùive_toŞ
, *
Œªs›Á_toŞ
;

65 
	`toŞ_g‘
(
ToŞS‹
 *
¡©e
);

66 
	`toŞ_»¡Üe
(cÚ¡ 
ToŞS‹
 *
¡©e
);

67 
	`toŞ_ä“
(
ToŞ
 *
toŞ
);

68 
	`toŞ_£Ëù
(
ToŞTy³
 
ty³
, 
gpoš‹r
 
exŒa_d©a
, gpoš‹¸
u£r_d©e
,

69 
GtkWidg‘
 *
bu‰Ú
, 
šv”t_³rsi¡’û
);

70 
	`toŞ_£Ëù_fÜm”
();

71 
	`toŞ_»£t
();

72 
	`toŞ_İtiÚs_dŸlog_show
(
ToŞTy³
 
ty³
, 
gpoš‹r
 
exŒa_d©a
,

73 
gpoš‹r
 
u£r_d©a
,
GtkWidg‘
 *
bu‰Ú
,

74 
šv”t_³rsi¡’û
);

	@O:\tool\dvs50\app\undo.c

19 
	~<cÚfig.h
>

21 
	~"undo.h
"

22 
	~"objeù_İs.h
"

23 
	~"´İ”t›s-dŸlog.h
"

24 
	~"cÚÃùiÚpošt_İs.h
"

25 
	~"focus.h
"

26 
	~"group.h
"

27 
	~"´eã»nûs.h
"

28 
	~"dŸg¿m_Œ“_wšdow.h
"

29 
	~"‹x‹d™.h
"

30 
	~"·»Á.h
"

33 
	#DEBUG_PRINTF
(
¬gs
è
´štf
 
	)
args

35 
	#DEBUG_PRINTF
(
¬gs
)

	)

38 
undo_upd©e_m’us
(
UndoSck
 *
¡ack
);

41 
	$Œª§ùiÚ_pošt_poš‹r
(
Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

44 
	}
}

47 
	$is_Œª§ùiÚpošt
(
Chªge
 *
chªge
)

49  
chªge
->
­¶y
 =ğ
Œª§ùiÚ_pošt_poš‹r
;

50 
	}
}

52 
Chªge
 *

53 
	$Ãw_Œª§ùiÚpošt
()

55 
Chªge
 *
Œª§ùiÚ
 = 
	`g_Ãw0
(Change, 1);

57 ià(
Œª§ùiÚ
) {

58 
Œª§ùiÚ
->
­¶y
 = 
Œª§ùiÚ_pošt_poš‹r
;

59 
Œª§ùiÚ
->
»v”t
 = 
Œª§ùiÚ_pošt_poš‹r
;

60 
Œª§ùiÚ
->
ä“
 = 
NULL
;

63  
Œª§ùiÚ
;

64 
	}
}

66 
UndoSck
 *

67 
	$Ãw_undo_¡ack
(
DŸg¿m
 *
dŸ
)

69 
UndoSck
 *
¡ack
;

70 
Chªge
 *
Œª§ùiÚ
;

72 
¡ack
 = 
	`g_Ãw
(
UndoSck
, 1);

73 ià(
¡ack
!=
NULL
){

74 
¡ack
->
dŸ
 = dia;

75 
Œª§ùiÚ
 = 
	`Ãw_Œª§ùiÚpošt
();

76 
Œª§ùiÚ
->
Ãxt
 =¿n§ùiÚ->
´ev
 = 
NULL
;

77 
¡ack
->
Ï¡_chªge
 = 
Œª§ùiÚ
;

78 
¡ack
->
cu¼’t_chªge
 = 
Œª§ùiÚ
;

79 
¡ack
->
Ï¡_§ve
 = 
Œª§ùiÚ
;

80 
¡ack
->
d•th
 = 0;

82  
¡ack
;

83 
	}
}

86 
	$undo_de¡roy
(
UndoSck
 *
¡ack
)

88 
	`undo_ş—r
(
¡ack
);

89 
	`g_ä“
(
¡ack
->
cu¼’t_chªge
);

90 
	`g_ä“
(
¡ack
);

91 
	}
}

94 
	$undo_»move_»do_šfo
(
UndoSck
 *
¡ack
)

96 
Chªge
 *
chªge
;

97 
Chªge
 *
Ãxt_chªge
;

99 
	`DEBUG_PRINTF
(("UNDO: Removing„edo info\n"));

101 
chªge
 = 
¡ack
->
cu¼’t_chªge
->
Ãxt
;

102 
¡ack
->
cu¼’t_chªge
->
Ãxt
 = 
NULL
;

103 
¡ack
->
Ï¡_chªge
 = sck->
cu¼’t_chªge
;

105 
chªge
 !ğ
NULL
) {

106 
Ãxt_chªge
 = 
chªge
->
Ãxt
;

107 ià(
chªge
->
ä“
)

108 (
chªge
->
ä“
)(change);

109 
	`g_ä“
(
chªge
);

110 
chªge
 = 
Ãxt_chªge
;

112 
	`undo_upd©e_m’us
(
¡ack
);

113 
	}
}

116 
	$undo_push_chªge
(
UndoSck
 *
¡ack
, 
Chªge
 *
chªge
)

118 ià(
¡ack
->
cu¼’t_chªge
 !ğ¡ack->
Ï¡_chªge
)

119 
	`undo_»move_»do_šfo
(
¡ack
);

121 
	`DEBUG_PRINTF
(("UNDO: Push‚ew chªg© %d\n", 
	`d•th
(
¡ack
)));

123 
chªge
->
´ev
 = 
¡ack
->
Ï¡_chªge
;

124 
chªge
->
Ãxt
 = 
NULL
;

125 
¡ack
->
Ï¡_chªge
->
Ãxt
 = 
chªge
;

126 
¡ack
->
Ï¡_chªge
 = 
chªge
;

127 
¡ack
->
cu¼’t_chªge
 = 
chªge
;

128 
	`undo_upd©e_m’us
(
¡ack
);

129 
	}
}

132 
	$undo_d–‘e_lowe¡_Œª§ùiÚ
(
UndoSck
 *
¡ack
)

134 
Chªge
 *
chªge
;

135 
Chªge
 *
Ãxt_chªge
;

138 
chªge
 = 
¡ack
->
cu¼’t_chªge
;

139 
chªge
->
´ev
 !ğ
NULL
) {

140 
chªge
 = chªge->
´ev
;

148 iàĞ(
chªge
 =ğ
NULL
è|| (chªg=ğ
¡ack
->
cu¼’t_chªge
))

151 
Ãxt_chªge
 = 
chªge
->
Ãxt
;

152 
	`DEBUG_PRINTF
(("freeing one change fromhe bottom.\n"));

153 ià(
chªge
->
ä“
)

154 (
chªge
->
ä“
)(change);

155 
	`g_ä“
(
chªge
);

156 
chªge
 = 
Ãxt_chªge
;

157 } !
	`is_Œª§ùiÚpošt
(
chªge
));

159 ià(
	`is_Œª§ùiÚpošt
(
chªge
)) {

160 
¡ack
->
d•th
--;

161 
	`DEBUG_PRINTF
(("Deü—sšg sck d•tho: %d\n", 
¡ack
->
d•th
));

163 
chªge
->
´ev
 = 
NULL
;

164 
	}
}

167 
	$undo_£t_Œª§ùiÚpošt
(
UndoSck
 *
¡ack
)

169 
Chªge
 *
Œª§ùiÚ
;

171 ià(
	`is_Œª§ùiÚpošt
(
¡ack
->
cu¼’t_chªge
))

174 
	`DEBUG_PRINTF
(("UNDO: Push‚ew¿n§ùiÚpošˆ© %d\n", 
	`d•th
(
¡ack
)));

176 
Œª§ùiÚ
 = 
	`Ãw_Œª§ùiÚpošt
();

178 
	`undo_push_chªge
(
¡ack
, 
Œª§ùiÚ
);

179 
¡ack
->
d•th
++;

180 
	`DEBUG_PRINTF
(("Inü—sšg sck d•tho: %d\n", 
¡ack
->
d•th
));

182 ià(
´efs
.
undo_d•th
 > 0) {

183 
¡ack
->
d•th
 > 
´efs
.
undo_d•th
){

184 
	`undo_d–‘e_lowe¡_Œª§ùiÚ
(
¡ack
);

187 
	}
}

190 
	$undo_»v”t_to_Ï¡_
(
UndoSck
 *
¡ack
)

192 
Chªge
 *
chªge
;

193 
Chªge
 *
´ev_chªge
;

195 ià(
¡ack
->
cu¼’t_chªge
->
´ev
 =ğ
NULL
)

198 
chªge
 = 
¡ack
->
cu¼’t_chªge
;

200 
´ev_chªge
 = 
chªge
->
´ev
;

201 (
chªge
->
»v”t
)(chªge, 
¡ack
->
dŸ
);

202 
chªge
 = 
´ev_chªge
;

203 } !
	`is_Œª§ùiÚpošt
(
chªge
));

204 
¡ack
->
cu¼’t_chªge
 = 
chªge
;

205 
¡ack
->
d•th
--;

206 
	`undo_upd©e_m’us
(
¡ack
);

207 
	`DEBUG_PRINTF
(("Deü—sšg sck d•tho: %d\n", 
¡ack
->
d•th
));

208 
	}
}

211 
	$undo_­¶y_to_Ãxt_
(
UndoSck
 *
¡ack
)

213 
Chªge
 *
chªge
;

214 
Chªge
 *
Ãxt_chªge
;

216 
chªge
 = 
¡ack
->
cu¼’t_chªge
;

218 ià(
chªge
->
Ãxt
 =ğ
NULL
)

222 
Ãxt_chªge
 = 
chªge
->
Ãxt
;

223 (
chªge
->
­¶y
)(chªge, 
¡ack
->
dŸ
);

224 
chªge
 = 
Ãxt_chªge
;

225 }  (
chªge
 !ğ
NULL
) &&

226 (!
	`is_Œª§ùiÚpošt
(
chªge
)) );

227 ià(
chªge
 =ğ
NULL
)

228 
chªge
 = 
¡ack
->
Ï¡_chªge
;

229 
¡ack
->
cu¼’t_chªge
 = 
chªge
;

230 
¡ack
->
d•th
++;

231 
	`undo_upd©e_m’us
(
¡ack
);

232 
	`DEBUG_PRINTF
(("Inü—sšg sck d•tho: %d\n", 
¡ack
->
d•th
));

233 
	}
}

237 
	$undo_ş—r
(
UndoSck
 *
¡ack
)

239 
Chªge
 *
chªge
;

241 
	`DEBUG_PRINTF
(("undo_clear()\n"));

243 
chªge
 = 
¡ack
->
cu¼’t_chªge
;

245 
chªge
->
´ev
 !ğ
NULL
) {

246 
chªge
 = chªge->
´ev
;

249 
¡ack
->
cu¼’t_chªge
 = 
chªge
;

250 
¡ack
->
d•th
 = 0;

251 
	`undo_»move_»do_šfo
(
¡ack
);

252 
	`undo_upd©e_m’us
(
¡ack
);

253 
	}
}

260 
	$undo_upd©e_m’us
(
UndoSck
 *
¡ack
)

262 
	`ddi¥Ïy_do_upd©e_m’u_£ns™iv™y
(
	`ddi¥Ïy_aùive
());

263 
	}
}

268 
	$undo_m¬k_§ve
(
UndoSck
 *
¡ack
)

270 
¡ack
->
Ï¡_§ve
 = sck->
cu¼’t_chªge
;

271 
	}
}

276 
gboŞ—n


277 
	$undo_is_§ved
(
UndoSck
 *
¡ack
)

279  
¡ack
->
Ï¡_§ve
 =ğ¡ack->
cu¼’t_chªge
;

280 
	}
}

286 
gboŞ—n


287 
	$undo_avaabË
(
UndoSck
 *
¡ack
, 
gboŞ—n
 
undo
)

289 ià(
undo
) {

290  
¡ack
->
cu¼’t_chªge
 !ğ
NULL
;

292  
¡ack
->
cu¼’t_chªge
 !ğ
NULL
 && sck->cu¼’t_chªge->
Ãxt
 != NULL;

294 
	}
}

306 
Chªge
*

307 
	$undo_»move_to
(
UndoSck
 *
¡ack
, 
UndoAµlyFunc
 *
ty³
)

309 
Chªge
 *
cu¼’t_chªge
 = 
¡ack
->current_change;

310 ià(
cu¼’t_chªge
 =ğ
NULL
)

311  
NULL
;

312 
cu¼’t_chªge
 && cu¼’t_chªge->
­¶y
 !ğ*
ty³
) {

313 
cu¼’t_chªge
 = cu¼’t_chªge->
´ev
;

315 ià(
cu¼’t_chªge
 !ğ
NULL
) {

316 
¡ack
->
cu¼’t_chªge
 = current_change;

317 
	`undo_»move_»do_šfo
(
¡ack
);

318  
cu¼’t_chªge
;

320 
	`undo_ş—r
(
¡ack
);

321  
NULL
;

323 
	}
}

336 
	sMoveObjeùsChªge
 {

337 
Chªge
 
	mchªge
;

339 
Pošt
 *
	mÜig_pos
;

340 
Pošt
 *
	mde¡_pos
;

341 
GLi¡
 *
	mobj_li¡
;

345 
	$move_objeùs_­¶y
(
MoveObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

347 
GLi¡
 *
li¡
;

348 
i
;

349 
DŸObjeù
 *
obj
;

351 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

353 
li¡
 = 
chªge
->
obj_li¡
;

354 
i
=0;

355 
li¡
 !ğ
NULL
) {

356 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

358 
obj
->
İs
->
	`move
(obj, &
chªge
->
de¡_pos
[
i
]);

360 
li¡
 = 
	`g_li¡_Ãxt
Öi¡); 
i
++;

363 
li¡
 = 
chªge
->
obj_li¡
;

364 
li¡
!=
NULL
) {

365 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

367 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
, 
obj
, 
TRUE
);

369 
li¡
 = 
	`g_li¡_Ãxt
(list);

372 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

373 
	}
}

376 
	$move_objeùs_»v”t
(
MoveObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

378 
GLi¡
 *
li¡
;

379 
i
;

380 
DŸObjeù
 *
obj
;

382 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

384 
li¡
 = 
chªge
->
obj_li¡
;

385 
i
=0;

386 
li¡
 !ğ
NULL
) {

387 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

389 
obj
->
İs
->
	`move
(obj, &
chªge
->
Üig_pos
[
i
]);

391 
li¡
 = 
	`g_li¡_Ãxt
Öi¡); 
i
++;

394 
li¡
 = 
chªge
->
obj_li¡
;

395 
li¡
!=
NULL
) {

396 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

398 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
, 
obj
, 
TRUE
);

400 
li¡
 = 
	`g_li¡_Ãxt
(list);

403 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

404 
	}
}

407 
	$move_objeùs_ä“
(
MoveObjeùsChªge
 *
chªge
)

409 
	`g_ä“
(
chªge
->
Üig_pos
);

410 
	`g_ä“
(
chªge
->
de¡_pos
);

411 
	`g_li¡_ä“
(
chªge
->
obj_li¡
);

412 
	}
}

414 
Chªge
 *

415 
	$undo_move_objeùs
(
DŸg¿m
 *
dŸ
, 
Pošt
 *
Üig_pos
, Pošˆ*
de¡_pos
,

416 
GLi¡
 *
obj_li¡
)

418 
MoveObjeùsChªge
 *
chªge
;

420 
chªge
 = 
	`g_Ãw0
(
MoveObjeùsChªge
, 1);

422 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
move_objeùs_­¶y
;

423 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
move_objeùs_»v”t
;

424 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
move_objeùs_ä“
;

426 
chªge
->
Üig_pos
 = orig_pos;

427 
chªge
->
de¡_pos
 = dest_pos;

428 
chªge
->
obj_li¡
 = obj_list;

430 
	`DEBUG_PRINTF
(("UNDO: Push‚ew movobjeù © %d\n", 
	`d•th
(
dŸ
->
undo
)));

431 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

432  (
Chªge
 *)
chªge
;

433 
	}
}

437 
	sMoveHªdËChªge
 {

438 
Chªge
 
chªge
;

440 
Pošt
 
Üig_pos
;

441 
Pošt
 
de¡_pos
;

442 
HªdË
 *
hªdË
;

443 
DŸObjeù
 *
obj
;

447 
	$move_hªdË_­¶y
(
MoveHªdËChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

449 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

450 
chªge
->
obj
->
İs
->
	`move_hªdË
(chªge->obj, chªge->
hªdË
,

451 &
chªge
->
de¡_pos
, 
NULL
,

452 
HANDLE_MOVE_USER_FINAL
, 0);

453 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

454 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
, 
chªge
->
obj
, 
TRUE
);

455 
	}
}

458 
	$move_hªdË_»v”t
(
MoveHªdËChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

460 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

461 
chªge
->
obj
->
İs
->
	`move_hªdË
(chªge->obj, chªge->
hªdË
,

462 &
chªge
->
Üig_pos
, 
NULL
,

463 
HANDLE_MOVE_USER_FINAL
, 0);

464 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

465 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
, 
chªge
->
obj
, 
TRUE
);

466 
	}
}

469 
	$move_hªdË_ä“
(
MoveHªdËChªge
 *
chªge
)

471 
	}
}

474 
Chªge
 *

475 
	$undo_move_hªdË
(
DŸg¿m
 *
dŸ
,

476 
HªdË
 *
hªdË
, 
DŸObjeù
 *
obj
,

477 
Pošt
 
Üig_pos
, Pošˆ
de¡_pos
)

479 
MoveHªdËChªge
 *
chªge
;

481 
chªge
 = 
	`g_Ãw0
(
MoveHªdËChªge
, 1);

483 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
move_hªdË_­¶y
;

484 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
move_hªdË_»v”t
;

485 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
move_hªdË_ä“
;

487 
chªge
->
Üig_pos
 = orig_pos;

488 
chªge
->
de¡_pos
 = dest_pos;

489 
chªge
->
hªdË
 = handle;

490 
chªge
->
obj
 = obj;

492 
	`DEBUG_PRINTF
(("UNDO: Push‚ew movhªdË‡ˆ%d\n", 
	`d•th
(
dŸ
->
undo
)));

494 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

495  (
Chªge
 *)
chªge
;

496 
	}
}

500 
	sCÚÃùChªge
 {

501 
Chªge
 
	mchªge
;

503 
DŸObjeù
 *
	mobj
;

504 
HªdË
 *
	mhªdË
;

505 
CÚÃùiÚPošt
 *
	mcÚÃùiÚpošt
;

506 
Pošt
 
	mhªdË_pos
;

510 
	$cÚÃù_­¶y
(
CÚÃùChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

512 
	`objeù_cÚÃù
(
chªge
->
obj
, chªge->
hªdË
, chªge->
cÚÃùiÚpošt
);

514 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

515 
chªge
->
obj
->
İs
->
	`move_hªdË
(chªge->obj, chªge->
hªdË
 ,

516 &
chªge
->
cÚÃùiÚpošt
->
pos
,

517 
chªge
->
cÚÃùiÚpošt
,

518 
HANDLE_MOVE_CONNECTED
, 0);

520 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

521 
	}
}

524 
	$cÚÃù_»v”t
(
CÚÃùChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

526 
	`objeù_uncÚÃù
(
chªge
->
obj
, chªge->
hªdË
);

528 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

529 
chªge
->
obj
->
İs
->
	`move_hªdË
(chªge->obj, chªge->
hªdË
 ,

530 &
chªge
->
hªdË_pos
, 
NULL
,

531 
HANDLE_MOVE_CONNECTED
, 0);

533 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

534 
	}
}

537 
	$cÚÃù_ä“
(
CÚÃùChªge
 *
chªge
)

539 
	}
}

541 
Chªge
 *

542 
	$undo_cÚÃù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
,

543 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
)

545 
CÚÃùChªge
 *
chªge
;

547 
chªge
 = 
	`g_Ãw0
(
CÚÃùChªge
, 1);

549 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
cÚÃù_­¶y
;

550 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
cÚÃù_»v”t
;

551 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
cÚÃù_ä“
;

553 
chªge
->
obj
 = obj;

554 
chªge
->
hªdË
 = handle;

555 
chªge
->
hªdË_pos
 = 
hªdË
->
pos
;

556 
chªge
->
cÚÃùiÚpošt
 = connectionpoint;

558 
	`DEBUG_PRINTF
(("UNDO: Push‚ew cÚÃù‡ˆ%d\n", 
	`d•th
(
dŸ
->
undo
)));

559 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

560  (
Chªge
 *)
chªge
;

561 
	}
}

565 
	sUncÚÃùChªge
 {

566 
Chªge
 
chªge
;

568 
DŸObjeù
 *
obj
;

569 
HªdË
 *
hªdË
;

570 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
;

574 
	$uncÚÃù_­¶y
(
UncÚÃùChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

576 
	`objeù_uncÚÃù
(
chªge
->
obj
, chªge->
hªdË
);

578 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

579 
	}
}

582 
	$uncÚÃù_»v”t
(
UncÚÃùChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

584 
	`objeù_cÚÃù
(
chªge
->
obj
, chªge->
hªdË
, chªge->
cÚÃùiÚpošt
);

586 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

587 
	}
}

590 
	$uncÚÃù_ä“
(
UncÚÃùChªge
 *
chªge
)

592 
	}
}

594 
Chªge
 *

595 
	$undo_uncÚÃù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
)

597 
UncÚÃùChªge
 *
chªge
;

599 
chªge
 = 
	`g_Ãw0
(
UncÚÃùChªge
, 1);

601 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
uncÚÃù_­¶y
;

602 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
uncÚÃù_»v”t
;

603 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
uncÚÃù_ä“
;

605 
chªge
->
obj
 = obj;

606 
chªge
->
hªdË
 = handle;

607 
chªge
->
cÚÃùiÚpošt
 = 
hªdË
->
cÚÃùed_to
;

609 
	`DEBUG_PRINTF
(("UNDO: Push‚ew uncÚÃù‡ˆ%d\n", 
	`d•th
(
dŸ
->
undo
)));

610 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

611  (
Chªge
 *)
chªge
;

612 
	}
}

617 
	sD–‘eObjeùsChªge
 {

618 
Chªge
 
chªge
;

620 
Lay”
 *
Ïy”
;

621 
GLi¡
 *
obj_li¡
;

622 
GLi¡
 *
Üigš®_objeùs
;

623 
­¶›d
;

626 
	$upd©e_objeùs_šdex
(
GLi¡
 *
Şi¡
, 
DŸg¿m
 *
dŸ
)

629 
Şi¡
)

631 
DŸObjeù
 *
obj
 = 
Şi¡
->
d©a
;

632 *
n1
;

633 
n1
 = 
	`g_¡rdup
("STRUCT - Class");

634 if(!
	`g_ascii_¡ºÿ£cmp
(
obj
->
ty³
->
Çme
,
n1
,
	`¡¾’
(n1)))

638 
obj
->
İs
->
	`upd©e_šdex
(obj);

639 
	`objeù_add_upd©es
(
obj
, 
dŸ
);

641 
	`g_ä“
(
n1
);

642 
Şi¡
 = oli¡->
Ãxt
;

644 
	}
}

648 
	$d–‘e_objeùs_­¶y
(
D–‘eObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

650 
GLi¡
 *
li¡
;

652 
	`DEBUG_PRINTF
(("delete_objects_apply()\n"));

653 
chªge
->
­¶›d
 = 1;

654 
	`dŸg¿m_un£Ëù_objeùs
(
dŸ
, 
chªge
->
obj_li¡
);

656 
	`Ïy”_»move_objeùs
(
chªge
->
Ïy”
, chªge->
obj_li¡
);

657 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

659 
li¡
 = 
chªge
->
obj_li¡
;

660 
li¡
 !ğ
NULL
) {

661 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

665 
	`´İ”t›s_hide_if_shown
(
dŸ
, 
obj
);

667 ià(
obj
->
·»Á
)

668 
obj
->
·»Á
->
chd»n
 = 
	`g_li¡_»move
(obj->parent->children, obj);

670 
li¡
 = 
	`g_li¡_Ãxt
(list);

673 
	`dŸg¿m_Œ“_»move_objeùs
(
	`dŸg¿m_Œ“
(), 
chªge
->
obj_li¡
);

675 
	`upd©e_objeùs_šdex
(
chªge
->
Ïy”
->
objeùs
,
dŸ
);

676 
	}
}

678 
	$d–‘e_objeùs_»v”t
(
D–‘eObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

680 
GLi¡
 *
li¡
;

681 
	`DEBUG_PRINTF
(("delete_objects_revert()\n"));

682 
chªge
->
­¶›d
 = 0;

683 
	`Ïy”_£t_objeù_li¡
(
chªge
->
Ïy”
,

684 
	`g_li¡_cİy
(
chªge
->
Üigš®_objeùs
));

685 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

687 
li¡
 = 
chªge
->
obj_li¡
;

688 
li¡
)

690 
DŸObjeù
 *
obj
 = (DŸObjeù *è
li¡
->
d©a
;

691 ià(
obj
->
·»Á
)

692 
obj
->
·»Á
->
chd»n
 = 
	`g_li¡_­³nd
(obj->parent->children, obj);

695 
	`d©a_em™
(
	`Ïy”_g‘_·»Á_dŸg¿m
(
chªge
->
Ïy”
),chªge->Ïy”,
obj
,"object_add");

697 
li¡
 = 
	`g_li¡_Ãxt
(list);

700 
	`dŸg¿m_Œ“_add_objeùs
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
chªge
->
obj_li¡
);

701 
	`upd©e_objeùs_šdex
(
chªge
->
Ïy”
->
objeùs
,
dŸ
);

702 
	}
}

705 
	$d–‘e_objeùs_ä“
(
D–‘eObjeùsChªge
 *
chªge
)

707 
	`DEBUG_PRINTF
(("delete_objects_free()\n"));

708 ià(
chªge
->
­¶›d
)

709 
	`de¡roy_objeù_li¡
(
chªge
->
obj_li¡
);

711 
	`g_li¡_ä“
(
chªge
->
obj_li¡
);

712 
	`g_li¡_ä“
(
chªge
->
Üigš®_objeùs
);

713 
	}
}

720 
Chªge
 *

721 
	$undo_d–‘e_objeùs_chd»n
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
)

723  
	`undo_d–‘e_objeùs
(
dŸ
, 
	`·»Á_li¡_afãùed
(
obj_li¡
));

724 
	}
}

726 
Chªge
 *

727 
	$undo_d–‘e_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
)

729 
D–‘eObjeùsChªge
 *
chªge
;

731 
chªge
 = 
	`g_Ãw0
(
D–‘eObjeùsChªge
, 1);

733 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
d–‘e_objeùs_­¶y
;

734 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
d–‘e_objeùs_»v”t
;

735 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
d–‘e_objeùs_ä“
;

737 
chªge
->
Ïy”
 = 
dŸ
->
d©a
->
aùive_Ïy”
;

738 
chªge
->
obj_li¡
 = obj_list;

739 
chªge
->
Üigš®_objeùs
 = 
	`g_li¡_cİy
(
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
);

740 
chªge
->
­¶›d
 = 0;

742 
	`DEBUG_PRINTF
(("UNDO: Push‚ew d–‘objeù © %d\n", 
	`d•th
(
dŸ
->
undo
)));

743 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

744  (
Chªge
 *)
chªge
;

745 
	}
}

749 
	sIn£¹ObjeùsChªge
 {

750 
Chªge
 
	mchªge
;

752 
Lay”
 *
	mÏy”
;

753 
GLi¡
 *
	mobj_li¡
;

754 
	m­¶›d
;

758 
	$š£¹_objeùs_­¶y
(
In£¹ObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

760 
	`DEBUG_PRINTF
(("insert_objects_apply()\n"));

761 
chªge
->
­¶›d
 = 1;

762 
	`Ïy”_add_objeùs
(
chªge
->
Ïy”
, 
	`g_li¡_cİy
(chªge->
obj_li¡
));

763 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

764 
	`dŸg¿m_Œ“_add_objeùs
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
chªge
->
obj_li¡
);

765 
	`upd©e_objeùs_šdex
(
chªge
->
Ïy”
->
objeùs
,
dŸ
);

766 
	}
}

769 
	$š£¹_objeùs_»v”t
(
In£¹ObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

771 
GLi¡
 *
li¡
;

773 
	`DEBUG_PRINTF
(("insert_objects_revert()\n"));

774 
chªge
->
­¶›d
 = 0;

775 
	`dŸg¿m_un£Ëù_objeùs
(
dŸ
, 
chªge
->
obj_li¡
);

776 
	`Ïy”_»move_objeùs
(
chªge
->
Ïy”
, chªge->
obj_li¡
);

777 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

779 
li¡
 = 
chªge
->
obj_li¡
;

780 
li¡
 !ğ
NULL
) {

781 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

785 
	`´İ”t›s_hide_if_shown
(
dŸ
, 
obj
);

787 
li¡
 = 
	`g_li¡_Ãxt
(list);

790 
	`dŸg¿m_Œ“_»move_objeùs
(
	`dŸg¿m_Œ“
(), 
chªge
->
obj_li¡
);

791 
	}
}

794 
	$š£¹_objeùs_ä“
(
In£¹ObjeùsChªge
 *
chªge
)

796 
	`DEBUG_PRINTF
(("insert_objects_free()\n"));

797 ià(!
chªge
->
­¶›d
)

798 
	`de¡roy_objeù_li¡
(
chªge
->
obj_li¡
);

800 
	`g_li¡_ä“
(
chªge
->
obj_li¡
);

801 
	}
}

803 
Chªge
 *

804 
	$undo_š£¹_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
, 
­¶›d
)

806 
In£¹ObjeùsChªge
 *
chªge
;

808 
chªge
 = 
	`g_Ãw0
(
In£¹ObjeùsChªge
, 1);

810 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
š£¹_objeùs_­¶y
;

811 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
š£¹_objeùs_»v”t
;

812 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
š£¹_objeùs_ä“
;

814 
chªge
->
Ïy”
 = 
dŸ
->
d©a
->
aùive_Ïy”
;

815 
chªge
->
obj_li¡
 = obj_list;

816 
chªge
->
­¶›d
 =‡pplied;

818 
	`DEBUG_PRINTF
(("UNDO: Push‚ew in£¹ objeù © %d\n", 
	`d•th
(
dŸ
->
undo
)));

819 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

820  (
Chªge
 *)
chªge
;

821 
	}
}

825 
	sReÜd”ObjeùsChªge
 {

826 
Chªge
 
	mchªge
;

828 
Lay”
 *
	mÏy”
;

829 
GLi¡
 *
	mchªged_li¡
;

830 
GLi¡
 *
	mÜigš®_objeùs
;

831 
GLi¡
 *
	m»Üd”ed_objeùs
;

835 
	$»Üd”_objeùs_­¶y
(
ReÜd”ObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

837 
	`DEBUG_PRINTF
(("reorder_objects_apply()\n"));

838 
	`Ïy”_£t_objeù_li¡
(
chªge
->
Ïy”
,

839 
	`g_li¡_cİy
(
chªge
->
»Üd”ed_objeùs
));

840 
	`objeù_add_upd©es_li¡
(
chªge
->
chªged_li¡
, 
dŸ
);

841 
	}
}

844 
	$»Üd”_objeùs_»v”t
(
ReÜd”ObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

846 
	`DEBUG_PRINTF
(("reorder_objects_revert()\n"));

847 
	`Ïy”_£t_objeù_li¡
(
chªge
->
Ïy”
,

848 
	`g_li¡_cİy
(
chªge
->
Üigš®_objeùs
));

849 
	`objeù_add_upd©es_li¡
(
chªge
->
chªged_li¡
, 
dŸ
);

850 
	}
}

853 
	$»Üd”_objeùs_ä“
(
ReÜd”ObjeùsChªge
 *
chªge
)

855 
	`DEBUG_PRINTF
(("reorder_objects_free()\n"));

856 
	`g_li¡_ä“
(
chªge
->
chªged_li¡
);

857 
	`g_li¡_ä“
(
chªge
->
Üigš®_objeùs
);

858 
	`g_li¡_ä“
(
chªge
->
»Üd”ed_objeùs
);

859 
	}
}

861 
Chªge
 *

862 
	$undo_»Üd”_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
chªged_li¡
, GLi¡ *
Üig_li¡
)

864 
ReÜd”ObjeùsChªge
 *
chªge
;

866 
chªge
 = 
	`g_Ãw0
(
ReÜd”ObjeùsChªge
, 1);

868 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
»Üd”_objeùs_­¶y
;

869 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
»Üd”_objeùs_»v”t
;

870 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
»Üd”_objeùs_ä“
;

872 
chªge
->
Ïy”
 = 
dŸ
->
d©a
->
aùive_Ïy”
;

873 
chªge
->
chªged_li¡
 = changed_list;

874 
chªge
->
Üigš®_objeùs
 = 
Üig_li¡
;

875 
chªge
->
»Üd”ed_objeùs
 = 
	`g_li¡_cİy
(
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
);

877 
	`DEBUG_PRINTF
(("UNDO: Push‚ew„eÜd” objeù © %d\n", 
	`d•th
(
dŸ
->
undo
)));

878 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

879  (
Chªge
 *)
chªge
;

880 
	}
}

884 
	sObjeùChªgeChªge
 {

885 
Chªge
 
	mchªge
;

887 
DŸObjeù
 *
	mobj
;

888 
ObjeùChªge
 *
	mobj_chªge
;

893 
	$objeù_chªge_­¶y
(
ObjeùChªgeChªge
 *
chªge
,

894 
DŸg¿m
 *
dŸ
)

896 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

897 
chªge
->
obj_chªge
->
	`­¶y
(chªge->obj_chªge, chªge->
obj
);

899 
Pošt
 
p
 = 
chªge
->
obj
->
pos™iÚ
;

900 (
chªge
->
obj
->
İs
->
move
)(chªge->obj,&
p
);

902 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

904 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
, 
chªge
->
obj
, 
TRUE
);

906 
	`´İ”t›s_upd©e_if_shown
(
dŸ
, 
chªge
->
obj
);

907 
	}
}

910 
	$objeù_chªge_»v”t
(
ObjeùChªgeChªge
 *
chªge
,

911 
DŸg¿m
 *
dŸ
)

913 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

915 
chªge
->
obj_chªge
->
	`»v”t
(chªge->obj_chªge, chªge->
obj
);

917 
Pošt
 
p
 = 
chªge
->
obj
->
pos™iÚ
;

918 (
chªge
->
obj
->
İs
->
move
)(chªge->obj,&
p
);

920 
	`objeù_add_upd©es
(
chªge
->
obj
, 
dŸ
);

922 
	`dŸg¿m_upd©e_cÚÃùiÚs_objeù
(
dŸ
, 
chªge
->
obj
, 
TRUE
);

924 
	`´İ”t›s_upd©e_if_shown
(
dŸ
, 
chªge
->
obj
);

925 
	}
}

928 
	$objeù_chªge_ä“
(
ObjeùChªgeChªge
 *
chªge
)

930 
	`DEBUG_PRINTF
(("state_change_free()\n"));

931 ià(
chªge
->
obj_chªge
->
ä“
)

932 (*
chªge
->
obj_chªge
->
ä“
)(change->obj_change);

933 
	`g_ä“
(
chªge
->
obj_chªge
);

934 
	}
}

936 
Chªge
 *

937 
	$undo_objeù_chªge
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
,

938 
ObjeùChªge
 *
obj_chªge
)

940 
ObjeùChªgeChªge
 *
chªge
;

942 
chªge
 = 
	`g_Ãw0
(
ObjeùChªgeChªge
, 1);

944 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
objeù_chªge_­¶y
;

945 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
objeù_chªge_»v”t
;

946 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
objeù_chªge_ä“
;

948 
chªge
->
obj
 = obj;

949 
chªge
->
obj_chªge
 = obj_change;

951 
	`DEBUG_PRINTF
(("UNDO: Push‚ew obj_chªg© %d\n", 
	`d•th
(
dŸ
->
undo
)));

952 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

953  (
Chªge
 *)
chªge
;

954 
	}
}

964 
	sGroupObjeùsChªge
 {

965 
Chªge
 
	mchªge
;

967 
Lay”
 *
	mÏy”
;

968 
DŸObjeù
 *
	mgroup
;

969 
GLi¡
 *
	mobj_li¡
;

971 
GLi¡
 *
	mÜig_li¡
;

974 
	m­¶›d
;

978 
	$group_objeùs_­¶y
(
GroupObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

980 
GLi¡
 *
li¡
;

982 
	`DEBUG_PRINTF
(("group_objects_apply()\n"));

984 
chªge
->
­¶›d
 = 1;

986 
	`dŸg¿m_un£Ëù_objeùs
(
dŸ
, 
chªge
->
obj_li¡
);

987 
	`Ïy”_»move_objeùs
(
chªge
->
Ïy”
, chªge->
obj_li¡
);

988 
	`Ïy”_add_objeù
(
chªge
->
Ïy”
, chªge->
group
);

989 
	`objeù_add_upd©es
(
chªge
->
group
, 
dŸ
);

991 
li¡
 = 
chªge
->
obj_li¡
;

992 
li¡
 !ğ
NULL
) {

993 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

997 
	`´İ”t›s_hide_if_shown
(
dŸ
, 
obj
);

999 
	`objeù_add_upd©es
(
obj
, 
dŸ
);

1001 
li¡
 = 
	`g_li¡_Ãxt
(list);

1004 
	`dŸg¿m_Œ“_add_objeù
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
chªge
->
group
);

1005 
	`dŸg¿m_Œ“_»move_objeùs
(
	`dŸg¿m_Œ“
(), 
chªge
->
obj_li¡
);

1006 
	}
}

1009 
	$group_objeùs_»v”t
(
GroupObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

1011 
	`DEBUG_PRINTF
(("group_objects_revert()\n"));

1012 
chªge
->
­¶›d
 = 0;

1014 
	`dŸg¿m_un£Ëù_objeù
(
dŸ
, 
chªge
->
group
);

1015 
	`objeù_add_upd©es
(
chªge
->
group
, 
dŸ
);

1017 
	`Ïy”_£t_objeù_li¡
(
chªge
->
Ïy”
, 
	`g_li¡_cİy
(chªge->
Üig_li¡
));

1019 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

1021 
	`´İ”t›s_hide_if_shown
(
dŸ
, 
chªge
->
group
);

1023 
	`dŸg¿m_Œ“_add_objeùs
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
chªge
->
obj_li¡
);

1024 
	`dŸg¿m_Œ“_»move_objeù
(
	`dŸg¿m_Œ“
(), 
chªge
->
group
);

1025 
	}
}

1028 
	$group_objeùs_ä“
(
GroupObjeùsChªge
 *
chªge
)

1030 
	`DEBUG_PRINTF
(("group_objects_free()\n"));

1031 ià(!
chªge
->
­¶›d
) {

1032 
	`group_de¡roy_sh®low
(
chªge
->
group
);

1033 
chªge
->
group
 = 
NULL
;

1034 
chªge
->
obj_li¡
 = 
NULL
;

1037 
	`g_li¡_ä“
(
chªge
->
Üig_li¡
);

1038 
	}
}

1040 
Chªge
 *

1041 
	$undo_group_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
, 
DŸObjeù
 *
group
,

1042 
GLi¡
 *
Üig_li¡
)

1044 
GroupObjeùsChªge
 *
chªge
;

1046 
chªge
 = 
	`g_Ãw0
(
GroupObjeùsChªge
, 1);

1048 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
group_objeùs_­¶y
;

1049 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
group_objeùs_»v”t
;

1050 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
group_objeùs_ä“
;

1052 
chªge
->
Ïy”
 = 
dŸ
->
d©a
->
aùive_Ïy”
;

1053 
chªge
->
group
 = group;

1054 
chªge
->
obj_li¡
 = obj_list;

1055 
chªge
->
Üig_li¡
 = orig_list;

1056 
chªge
->
­¶›d
 = 1;

1058 
	`DEBUG_PRINTF
(("UNDO: Push‚ew grou°objeù © %d\n", 
	`d•th
(
dŸ
->
undo
)));

1059 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

1060  (
Chªge
 *)
chªge
;

1061 
	}
}

1065 
	sUngroupObjeùsChªge
 {

1066 
Chªge
 
	mchªge
;

1068 
Lay”
 *
	mÏy”
;

1069 
DŸObjeù
 *
	mgroup
;

1070 
GLi¡
 *
	mobj_li¡
;

1071 
	mgroup_šdex
;

1072 
	m­¶›d
;

1076 
	$ungroup_objeùs_­¶y
(
UngroupObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

1078 
	`DEBUG_PRINTF
(("ungroup_objects_apply()\n"));

1080 
chªge
->
­¶›d
 = 1;

1082 
	`dŸg¿m_un£Ëù_objeù
(
dŸ
, 
chªge
->
group
);

1083 
	`objeù_add_upd©es
(
chªge
->
group
, 
dŸ
);

1084 
	`Ïy”_»¶aû_objeù_w™h_li¡
(
chªge
->
Ïy”
, chªge->
group
,

1085 
	`g_li¡_cİy
(
chªge
->
obj_li¡
));

1086 
	`objeù_add_upd©es_li¡
(
chªge
->
obj_li¡
, 
dŸ
);

1088 
	`´İ”t›s_hide_if_shown
(
dŸ
, 
chªge
->
group
);

1090 
	`dŸg¿m_Œ“_add_objeùs
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
chªge
->
obj_li¡
);

1091 
	`dŸg¿m_Œ“_»move_objeù
(
	`dŸg¿m_Œ“
(), 
chªge
->
group
);

1092 
	}
}

1095 
	$ungroup_objeùs_»v”t
(
UngroupObjeùsChªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

1097 
GLi¡
 *
li¡
;

1099 
	`DEBUG_PRINTF
(("ungroup_objects_revert()\n"));

1100 
chªge
->
­¶›d
 = 0;

1103 
	`dŸg¿m_un£Ëù_objeùs
(
dŸ
, 
chªge
->
obj_li¡
);

1104 
	`Ïy”_»move_objeùs
(
chªge
->
Ïy”
, chªge->
obj_li¡
);

1105 
	`Ïy”_add_objeù_©
(
chªge
->
Ïy”
, chªge->
group
, chªge->
group_šdex
);

1106 
	`objeù_add_upd©es
(
chªge
->
group
, 
dŸ
);

1108 
li¡
 = 
chªge
->
obj_li¡
;

1109 
li¡
 !ğ
NULL
) {

1110 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

1114 
	`´İ”t›s_hide_if_shown
(
dŸ
, 
obj
);

1116 
li¡
 = 
	`g_li¡_Ãxt
(list);

1119 
	`dŸg¿m_Œ“_add_objeù
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
chªge
->
group
);

1120 
	`dŸg¿m_Œ“_»move_objeùs
(
	`dŸg¿m_Œ“
(), 
chªge
->
obj_li¡
);

1121 
	}
}

1124 
	$ungroup_objeùs_ä“
(
UngroupObjeùsChªge
 *
chªge
)

1126 
	`DEBUG_PRINTF
(("ungroup_objects_free()\n"));

1127 ià(
chªge
->
­¶›d
) {

1128 
	`group_de¡roy_sh®low
(
chªge
->
group
);

1129 
chªge
->
group
 = 
NULL
;

1130 
chªge
->
obj_li¡
 = 
NULL
;

1132 
	}
}

1134 
Chªge
 *

1135 
	$undo_ungroup_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
, 
DŸObjeù
 *
group
,

1136 
group_šdex
)

1138 
UngroupObjeùsChªge
 *
chªge
;

1140 
chªge
 = 
	`g_Ãw0
(
UngroupObjeùsChªge
, 1);

1142 
chªge
->chªge.
­¶y
 = (
UndoAµlyFunc
è
ungroup_objeùs_­¶y
;

1143 
chªge
->chªge.
»v”t
 = (
UndoRev”tFunc
è
ungroup_objeùs_»v”t
;

1144 
chªge
->chªge.
ä“
 = (
UndoF»eFunc
è
ungroup_objeùs_ä“
;

1146 
chªge
->
Ïy”
 = 
dŸ
->
d©a
->
aùive_Ïy”
;

1147 
chªge
->
group
 = group;

1148 
chªge
->
obj_li¡
 = obj_list;

1149 
chªge
->
group_šdex
 = group_index;

1150 
chªge
->
­¶›d
 = 1;

1152 
	`DEBUG_PRINTF
(("UNDO: Push‚ew ungrou°objeù © %d\n", 
	`d•th
(
dŸ
->
undo
)));

1153 
	`undo_push_chªge
(
dŸ
->
undo
, (
Chªge
 *è
chªge
);

1154  (
Chªge
 *)
chªge
;

1155 
	}
}

1159 
	sP¬’tChªge
 {

1160 
Chªge
 
	mchªge
;

1161 
DŸObjeù
 *
	m·»Áobj
, *
	mchdobj
;

1162 
gboŞ—n
 
	m·»Á
;

1168 
	$·»Á_objeù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
·»Á
, DŸObjeù *
chd
)

1170 
chd
->
·»Á
 =…arent;

1171 
·»Á
->
chd»n
 = 
	`g_li¡_´•’d
Õ¬’t->chd»n, 
chd
);

1172 
	}
}

1177 
	$uÅ¬’t_objeù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
·»Á
, DŸObjeù *
chd
)

1179 
chd
->
·»Á
 = 
NULL
;

1180 
·»Á
->
chd»n
 = 
	`g_li¡_»move
Õ¬’t->chd»n, 
chd
);

1181 
	}
}

1185 
	$·»Á_chªge_­¶y
(
Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

1187 
P¬’tChªge
 *
·»Áchªge
 = (P¬’tChªge*)
chªge
;

1188 ià(
·»Áchªge
->
·»Á
) {

1189 
	`·»Á_objeù
(
dŸ
, 
·»Áchªge
->
·»Áobj
,…¬’tchªge->
chdobj
);

1191 
	`uÅ¬’t_objeù
(
dŸ
, 
·»Áchªge
->
·»Áobj
,…¬’tchªge->
chdobj
);

1193 
	}
}

1197 
	$·»Á_chªge_»v”t
(
Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

1199 
P¬’tChªge
 *
·»Áchªge
 = (P¬’tChªge*)
chªge
;

1200 ià(!
·»Áchªge
->
·»Á
) {

1201 
	`·»Á_objeù
(
dŸ
, 
·»Áchªge
->
·»Áobj
,…¬’tchªge->
chdobj
);

1203 
	`uÅ¬’t_objeù
(
dŸ
, 
·»Áchªge
->
·»Áobj
,…¬’tchªge->
chdobj
);

1205 
	}
}

1209 
	$·»Á_chªge_ä“
(
Chªge
 *
chªge
)

1211 
	}
}

1217 
Chªge
 *

1218 
	$undo_·»Ášg
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
* 
·»Áobj
, DŸObjeù* 
chdobj
,

1219 
gboŞ—n
 
·»Á
)

1221 
P¬’tChªge
 *
·»Áchªge
 = 
	`g_Ãw0
(ParentChange, 1);

1222 
Chªge
 *
chªge
 = (Chªge*)
·»Áchªge
;

1223 
chªge
->
­¶y
 = 
·»Á_chªge_­¶y
;

1224 
chªge
->
»v”t
 = 
·»Á_chªge_»v”t
;

1225 
chªge
->
ä“
 = 
·»Á_chªge_ä“
;

1227 
·»Áchªge
->
·»Áobj
 =…arentobj;

1228 
·»Áchªge
->
chdobj
 = childobj;

1229 
·»Áchªge
->
·»Á
 =…arent;

1231 
	`DEBUG_PRINTF
(("UNDO: Push‚ew obj_chªg© %d\n", 
	`d•th
(
dŸ
->
undo
)));

1232 
	`undo_push_chªge
(
dŸ
->
undo
, 
chªge
);

1233  
chªge
;

1234 
	}
}

1237 
	s_MoveObjeùToLay”Chªge
 {

1238 
Chªge
 
	mchªge
;

1240 
GLi¡
 *
	mobjeùs
;

1242 
GLi¡
 *
	mÜig_li¡
;

1244 
Lay”
 *
	mÜig_Ïy”
;

1245 
gboŞ—n
 
	mmovšg_up
;

1246 } 
	tMoveObjeùToLay”Chªge
;

1253 
	$move_objeù_Ïy”_»Ïtive
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
objeùs
, 
gšt
 
di¡
)

1256 
Lay”
 *
aùive
, *
rg‘
;

1257 
gušt
 
pos
;

1259 
	`g_»tuº_if_ç
(
dŸ
->
d©a
->
aùive_Ïy”
);

1261 
aùive
 = 
dŸ
->
d©a
->
aùive_Ïy”
;

1262 
pos
 = 0;…o < 
dŸ
->
d©a
->
Ïy”s
->
Ën
; ++pos)

1263 ià(
aùive
 =ğ
	`g_±r_¬¿y_šdex
(
dŸ
->
d©a
->
Ïy”s
, 
pos
))

1266 
pos
 = (po + 
dŸ
->
d©a
->
Ïy”s
->
Ën
 + 
di¡
) % dia->data->layers->len;

1267 
rg‘
 = 
	`g_±r_¬¿y_šdex
(
dŸ
->
d©a
->
Ïy”s
, 
pos
);

1268 
	`objeù_add_upd©es_li¡
(
objeùs
, 
dŸ
);

1269 
	`Ïy”_»move_objeùs
(
aùive
, 
objeùs
);

1270 
	`dŸg¿m_Œ“_add_objeùs
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
objeùs
);

1271 
	`Ïy”_add_objeùs
(
rg‘
, 
	`g_li¡_cİy
(
objeùs
));

1272 
	`d©a_£t_aùive_Ïy”
(
dŸ
->
d©a
, 
rg‘
);

1273 
	`dŸg¿m_Œ“_add_objeùs
(
	`dŸg¿m_Œ“
(), 
dŸ
, 
objeùs
);

1274 
	}
}

1277 
	$move_objeù_to_Ïy”_­¶y
(
MoveObjeùToLay”Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

1279 ià(
chªge
->
movšg_up
) {

1280 
	`move_objeù_Ïy”_»Ïtive
(
dŸ
, 
chªge
->
objeùs
, 1);

1282 
	`move_objeù_Ïy”_»Ïtive
(
dŸ
, 
chªge
->
objeùs
, -1);

1284 
	}
}

1287 
	$move_objeù_to_Ïy”_»v”t
(
MoveObjeùToLay”Chªge
 *
chªge
, 
DŸg¿m
 *
dŸ
)

1289 ià(
chªge
->
movšg_up
) {

1290 
	`move_objeù_Ïy”_»Ïtive
(
dŸ
, 
chªge
->
objeùs
, -1);

1292 
	`dŸg¿m_un£Ëù_objeùs
(
dŸ
, 
chªge
->
objeùs
);

1293 
	`move_objeù_Ïy”_»Ïtive
(
dŸ
, 
chªge
->
objeùs
, 1);

1295 
	`Ïy”_£t_objeù_li¡
(
chªge
->
Üig_Ïy”
, 
	`g_li¡_cİy
(chªge->
Üig_li¡
));

1296 
	`objeù_add_upd©es_li¡
(
chªge
->
Üig_li¡
, 
dŸ
);

1298 
	}
}

1301 
	$move_objeù_to_Ïy”_ä“
(
MoveObjeùToLay”Chªge
 *
chªge
)

1303 
	`g_li¡_ä“
(
chªge
->
objeùs
);

1304 
	`g_li¡_ä“
(
chªge
->
Üig_li¡
);

1305 
chªge
->
objeùs
 = 
NULL
;

1306 
chªge
->
Üig_li¡
 = 
NULL
;

1307 
	}
}

1309 
Chªge
 *

1310 
	$undo_move_objeù_Ùh”_Ïy”
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
£Ëùed_li¡
,

1311 
gboŞ—n
 
movšg_up
)

1313 
MoveObjeùToLay”Chªge
 *
mov‘Şay”chªge


1314 ğ
	`g_Ãw0
(
MoveObjeùToLay”Chªge
, 1);

1315 
Chªge
 *
chªge
 = (Chªge*)
mov‘Şay”chªge
;

1316 
chªge
->
­¶y
 = (
UndoAµlyFunc
è
move_objeù_to_Ïy”_­¶y
;

1317 
chªge
->
»v”t
 = (
UndoRev”tFunc
è
move_objeù_to_Ïy”_»v”t
;

1318 
chªge
->
ä“
 = (
UndoF»eFunc
è
move_objeù_to_Ïy”_ä“
;

1320 
mov‘Şay”chªge
->
Üig_Ïy”
 = 
dŸ
->
d©a
->
aùive_Ïy”
;

1321 
mov‘Şay”chªge
->
Üig_li¡
 = 
	`g_li¡_cİy
(
dŸ
->
d©a
->
aùive_Ïy”
->
objeùs
);

1322 
mov‘Şay”chªge
->
objeùs
 = 
	`g_li¡_cİy
(
£Ëùed_li¡
);

1323 
mov‘Şay”chªge
->
movšg_up
 = moving_up;

1325 
	`DEBUG_PRINTF
(("UNDO: Push‚ew obj_Ïy”_chªg© %d\n", 
	`d•th
(
dŸ
->
undo
)));

1326 
	`undo_push_chªge
(
dŸ
->
undo
, 
chªge
);

1327  
chªge
;

1328 
	}
}

	@O:\tool\dvs50\app\undo.h

18 #iâdeà
UNDO_H


19 
	#UNDO_H


	)

22 
_UndoSck
 
	tUndoSck
;

23 
_Chªge
 
	tChªge
;

25 
	~"dŸg¿m.h
"

26 
	~"objchªge.h
"

28 (*
	tUndoAµlyFunc
)(
	tChªge
 *
	tchªge
, 
	tDŸg¿m
 *
	tdŸ
);

29 (*
	tUndoRev”tFunc
)(
	tChªge
 *
	tchªge
, 
	tDŸg¿m
 *
	tdŸ
);

30 (*
	tUndoF»eFunc
)(
	tChªge
 *
	tchªge
);

32 
	s_Chªge
 {

35 
UndoAµlyFunc
 
­¶y
;

36 
UndoRev”tFunc
 
»v”t
;

37 
UndoF»eFunc
 
ä“
;

38 
Chªge
 *
´ev
, *
Ãxt
;

41 
	s_UndoSck
 {

42 
DŸg¿m
 *
dŸ
;

43 
Chªge
 *
Ï¡_chªge
;

44 
Chªge
 *
cu¼’t_chªge
;

45 
Chªge
 *
Ï¡_§ve
;

46 
d•th
;

49 
UndoSck
 *
	`Ãw_undo_¡ack
(
DŸg¿m
 *
dŸ
);

50 
	`undo_de¡roy
(
UndoSck
 *
¡ack
);

51 
	`undo_push_chªge
(
UndoSck
 *
¡ack
, 
Chªge
 *
chªge
);

52 
DIAVAR
 
	`undo_£t_Œª§ùiÚpošt
(
UndoSck
 *
¡ack
);

53 
	`undo_»v”t_to_Ï¡_
(
UndoSck
 *
¡ack
);

54 
	`undo_­¶y_to_Ãxt_
(
UndoSck
 *
¡ack
);

55 
	`undo_ş—r
(
UndoSck
 *
¡ack
);

56 
	`undo_m¬k_§ve
(
UndoSck
 *
¡ack
);

57 
gboŞ—n
 
	`undo_is_§ved
(
UndoSck
 *
¡ack
);

58 
gboŞ—n
 
	`undo_avaabË
(
UndoSck
 *
¡ack
, gboŞ—À
undo
);

59 
Chªge
* 
	`undo_»move_to
(
UndoSck
 *
¡ack
, 
UndoAµlyFunc
 *
ty³
);

63 
Chªge
 *
	`undo_move_objeùs
(
DŸg¿m
 *
dŸ
, 
Pošt
 *
Üig_pos
,

64 
Pošt
 *
de¡_pos
, 
GLi¡
 *
obj_li¡
);

65 
Chªge
 *
	`undo_move_hªdË
(
DŸg¿m
 *
dŸ
,

66 
HªdË
 *
hªdË
, 
DŸObjeù
 *
obj
,

67 
Pošt
 
Üig_pos
, Pošˆ
de¡_pos
);

68 
Chªge
 *
	`undo_cÚÃù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
,

69 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
);

70 
Chªge
 *
	`undo_uncÚÃù
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
);

71 
Chªge
 *
	`undo_d–‘e_objeùs_chd»n
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
);

72 
Chªge
 *
	`undo_d–‘e_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
);

73 
Chªge
 *
	`undo_š£¹_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
,

74 
­¶›d
);

75 
Chªge
 *
	`undo_»Üd”_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
chªged_li¡
,

76 
GLi¡
 *
Üig_li¡
);

77 
Chªge
 *
	`undo_objeù_chªge
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
obj
,

78 
ObjeùChªge
 *
obj_chªge
);

79 
Chªge
 *
	`undo_group_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
,

80 
DŸObjeù
 *
group
, 
GLi¡
 *
Üig_li¡
);

81 
Chªge
 *
	`undo_ungroup_objeùs
(
DŸg¿m
 *
dŸ
, 
GLi¡
 *
obj_li¡
,

82 
DŸObjeù
 *
group
, 
group_šdex
);

83 
Chªge
 *
	`undo_·»Ášg
(
DŸg¿m
 *
dŸ
, 
DŸObjeù
 *
·»Áobj
, DŸObjeù *
chdobj
,

84 
gboŞ—n
 
·»Á
);

85 
Chªge
 *
	`undo_move_objeù_Ùh”_Ïy”
(
DŸg¿m
 *
dŸg¿m
, 
GLi¡
 *
£Ëùed_li¡
,

86 
gboŞ—n
 
movšg_up
);

	@O:\tool\dvs50\app\winmain.c

1 
	~<cÚfig.h
>

3 
	~<¡dlib.h
>

4 
	~<glib.h
>

5 
	~<gtk/gtk.h
>

7 #ifdeà
G_OS_WIN32


8 
	#ReùªgË
 
Wš32ReùªgË


	)

9 
	#WIN32_LEAN_AND_MEAN


	)

10 
	~<wšdows.h
>

11 #undeà
ReùªgË


13 
	~"­p_´ocs.h
"

14 
	~"š‹rçû.h
"

18 #ifdeà
__GNUC__


19 #iâdeà
_¡dÿÎ


20 
	#_¡dÿÎ
 
	`__©Œibu‹__
((
¡dÿÎ
))

	)

24 
_¡dÿÎ


25 
	$WšMaš
 (
HINSTANCE__
 *
hIn¡ªû
,

26 
HINSTANCE__
 *
hP»vIn¡ªû
,

27 *
ÍszCmdLše
,

28 
nCmdShow
)

30 
	`dŸ_»dœeù_cÚsŞe
 ();

32 
	`­p_š™
 (
__¬gc
, 
__¬gv
);

34 ià(!
	`­p_is_š‹¿ùive
())

37 
	`toŞbox_show
();

39 
	`­p_¥Ïsh_dÚe
();

41 
	`gtk_maš
 ();

44 
	}
}

47 
	$dŸ_log_func
 (cÚ¡ 
gch¬
 *
log_domaš
,

48 
GLogLev–FÏgs
 
æags
,

49 cÚ¡ 
gch¬
 *
mes§ge
,

50 
gpoš‹r
 
d©a
)

52 
HANDLE
 
fe
 = (HANDLE)
d©a
;

53 cÚ¡ * 
Ëv–
;

54 * 
Ï¡_mes§ge
 = 
NULL
;

55 
gušt32
 
dwWr™‹n
;

58 ià(
Ï¡_mes§ge
 && (0 =ğ
	`¡rcmp
 (Ï¡_mes§ge, 
mes§ge
)))

61 ià(
Ï¡_mes§ge
)

62 
	`ä“
 (
Ï¡_mes§ge
);

63 
Ï¡_mes§ge
 = 
	`¡rdup
 (
mes§ge
);

65 
	`Wr™eFe
 (
fe
, 
log_domaš
 ?†og_domaš : "?",†og_domaš ? 
	`¡¾’
Öog_domašè: 1, &
dwWr™‹n
, 0);

66 
	`Wr™eFe
 (
fe
, "-", 1, &
dwWr™‹n
, 0);

67 
Ëv–
 = 
æags
 & 
G_LOG_LEVEL_ERROR
 ? "Error" :

68 
æags
 & 
G_LOG_LEVEL_CRITICAL
 ? "Critical" :

69 
æags
 & 
G_LOG_LEVEL_WARNING
 ? "Warning" :

70 
æags
 & 
G_LOG_LEVEL_INFO
 ? "Info" :

71 
æags
 & 
G_LOG_LEVEL_DEBUG
 ? "Debug" :

72 
æags
 & 
G_LOG_LEVEL_MESSAGE
 ? "Message" : "?";

73 
	`Wr™eFe
 (
fe
, 
Ëv–
, 
	`¡¾’
Öev–), &
dwWr™‹n
, 0);

74 
	`Wr™eFe
 (
fe
, ": ", 2, &
dwWr™‹n
, 0);

75 
	`Wr™eFe
 (
fe
, 
mes§ge
, 
	`¡¾’
(mes§ge), &
dwWr™‹n
, 0);

76 
	`Wr™eFe
 (
fe
, "\r\n", 2, &
dwWr™‹n
, 0);

77 
	`FlushFeBufãrs
 (
fe
);

79 ià(
æags
 & 
G_LOG_FATAL_MASK
)

83 
	}
}

86 
	$dŸ_´št_func
 (cÚ¡ * 
¡ršg
)

89 
	}
}

92 
	$dŸ_»dœeù_cÚsŞe
 ()

94 cÚ¡ 
gch¬
 *
log_domašs
[] =

100 
NULL
,

102 
MAX_TRIES
 = 16;

103 
i
 = 0;

104 
HANDLE
 
fe
 = 
INVALID_HANDLE_VALUE
;

105 
logÇme
[] = "dŸ--" 
VERSION
 ".log";

106 * 
»dœeùed
;

107 
gboŞ—n
 
v”bo£
 = 
FALSE
;

108 
BY_HANDLE_FILE_INFORMATION
 
fi
 = { 0, };

110 iàĞĞ((
fe
 = 
	`G‘StdHªdË
 (
STD_OUTPUT_HANDLE
)è!ğ
INVALID_HANDLE_VALUE
)

111 || ((
fe
 = 
	`G‘StdHªdË
 (
STD_ERROR_HANDLE
)è!ğ
INVALID_HANDLE_VALUE
))

112 && (
	`G‘FeInfÜm©iÚByHªdË
 (
fe
, &
fi
è&& (fi.
dwFeA‰ribu‹s
 != 0)))

113 
v”bo£
 = 
FALSE
;

117 
»dœeùed
 = 
	`g_bud_f’ame
 (
	`g_g‘_tmp_dœ
 (), 
logÇme
, 
NULL
);

121 
fe
 = 
	`C»©eFe
 (
»dœeùed
, 
GENERIC_WRITE
, 
FILE_SHARE_READ
, 
NULL
, 
CREATE_ALWAYS
, 
FILE_FLAG_WRITE_THROUGH
, 0);

122 ià(
fe
 =ğ
INVALID_HANDLE_VALUE
)

124 
i
++;

125 
	`g_ä“
 (
»dœeùed
);

126 
logÇme
[3] = '0' + 
i
;

128 } 
fe
 =ğ
INVALID_HANDLE_VALUE
 && 
i
 < 
MAX_TRIES
);

130 ià(
fe
 !ğ
INVALID_HANDLE_VALUE
)

132 * 
log2
 = 
	`g_¡rjošv
("\r\n", 
_’vœÚ
);

133 * 
log
 = 
	`g_¡rdup_´štf
 ("Dia (%s) instance %d started "

135 
VERSION
, 
i
 + 1,

136 
gtk_majÜ_v”siÚ
, 
gtk_mšÜ_v”siÚ
, 
gtk_miüo_v”siÚ
, 
gtk_bš¬y_age
,

137 
log2
);

138 
gušt32
 
dwWr™‹n
;

139 
	`g_ä“
 (
log2
);

141 ià(!
v”bo£
 || 
	`Wr™eFe
 (
fe
, 
log
, 
	`¡¾’
Öog), &
dwWr™‹n
, 0))

143 
i
 = 0; i < 
	`G_N_ELEMENTS
 (
log_domašs
); i++)

144 
	`g_log_£t_hªdËr
 (
log_domašs
[
i
],

145 
G_LOG_LEVEL_MESSAGE
 | 
G_LOG_LEVEL_INFO
 | 
G_LOG_LEVEL_WARNING
 | 
G_LOG_LEVEL_CRITICAL
 | 
G_LOG_LEVEL_ERROR
,

146 
dŸ_log_func
,

147 
fe
);

149 
	`g_£t_´št_hªdËr
 (
dŸ_´št_func
);

153 * 
emsg
 = 
	`g_wš32_”rÜ_mes§ge
 (
	`G‘La¡E¼Ü
 ());

154 
	`g_´š‹¼
 ("Logf% wr™šg faed: %s", 
»dœeùed
, 
emsg
);

155 
	`g_ä“
 (
emsg
);

157 
	`g_ä“
 (
log
);

159 
	}
}

	@O:\tool\dvs50\config.h

5 
	#ENABLE_NLS
 1

	)

7 
	#LIBDIA_COMPILATION
 1

	)

9 
	#GETTEXT_PACKAGE
 "dŸ"

	)

18 
	#HAVE_BIND_TEXTDOMAIN_CODESET
 1

	)

21 
	#HAVE_CAIRO
 1

	)

24 
	#HAVE_DCGETTEXT
 1

	)

27 
	#HAVE_DLFCN_H
 1

	)

31 
	#HAVE_FCNTL_H
 1

	)

34 
	#HAVE_FREETYPE
 1

	)

37 
	#HAVE_GETTEXT
 1

	)

43 
	#HAVE_INTTYPES_H
 1

	)

46 
	#HAVE_ISINF
 1

	)

49 
	#HAVE_LC_MESSAGES
 1

	)

58 
	#HAVE_LIBPNG


	)

61 
	#HAVE_LIBZ


	)

64 
	#HAVE_LOCALE_H
 1

	)

67 
	#HAVE_MATH_H
 1

	)

70 
	#HAVE_MEMORY_H
 1

	)

73 
	#HAVE_PANGOCAIRO_H
 1

	)

76 
	#HAVE_SELECT
 1

	)

79 
	#HAVE_STDDEF_H
 1

	)

82 
	#HAVE_STDINT_H
 1

	)

85 
	#HAVE_STDLIB_H
 1

	)

88 
	#HAVE_STRCSPN
 1

	)

91 
	#HAVE_STRDUP
 1

	)

94 
	#HAVE_STRINGS_H
 1

	)

97 
	#HAVE_STRING_H
 1

	)

100 
	#HAVE_STRTOL
 1

	)

103 
	#HAVE_SYS_STAT_H
 1

	)

106 
	#HAVE_SYS_TYPES_H
 1

	)

109 
	#HAVE_UNISTD_H
 1

	)

112 
	#HAVE_UTIME_H
 1

	)

115 
	#HAVE_ZLIB_H
 1

	)

118 
	#LIBXSLT_PREFIX
 "/u¤/lib"

	)

125 
	#PACKAGE
 "dŸ"

	)

128 
	#PACKAGE_BUGREPORT
 "h‰p://bugzÏ.gnome.Üg/’‹r_bug.cgi?´oduù=dŸ"

	)

131 
	#PACKAGE_NAME
 "dŸ"

	)

134 
	#PACKAGE_STRING
 "dŸ 0.97.4"

	)

137 
	#PACKAGE_TARNAME
 "dŸ"

	)

140 
	#PACKAGE_URL
 ""

	)

143 
	#PACKAGE_VERSION
 "0.97.4"

	)

146 
	#STDC_HEADERS
 1

	)

149 
	#VERSION
 "0.97.4"

	)

	@O:\tool\dvs50\dia.rc

1 
MAINICON
 
	gICON
 "dia.ico"

	@O:\tool\dvs50\lib\arrows.c

19 
	~<cÚfig.h
>

21 
	#_BSD_SOURCE
 1

	)

22 
	~<m©h.h
>

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

26 
	~<glib.h
>

27 
	~"mes§ge.h
"

28 
	~"boundšgbox.h
"

30 #ifdeà
G_OS_WIN32


31 
	~<æßt.h
>

32 
	#fš™e
(
d
è
	`_fš™e
(d)

	)

35 #ifdeà
__EMX__


36 
	#fš™e
(
d
è
	`isfš™e
(d)

	)

39 
	~"¬rows.h
"

40 
	~"dŸ»nd””.h
"

41 
	~"©Œibu‹s.h
"

42 
	~"widg‘s.h
"

43 
	~"š.h
"

47 
d¿w_em±y_–l£
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

48 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

49 
CŞÜ
 *
fg_cŞÜ
);

51 
ÿlcuÏ‹_doubË_¬row
(
Pošt
 *
£cÚd_to
, Pošˆ*
£cÚd_äom
,

52 cÚ¡ 
Pošt
 *
to
, cÚ¡ Pošˆ*
äom
, 
»®
 
Ëngth
);

55 
d¿w_üow_foÙ
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

56 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

57 
CŞÜ
 *
fg_cŞÜ
,CŞÜ *
bg_cŞÜ
);

59 
ÿlcuÏ‹_dŸmÚd
(
Pošt
 *
pŞy
 , cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

60 
»®
 
Ëngth
,„—È
width
);

77 
	$ÿlcuÏ‹_¬row_pošt
(cÚ¡ 
A¼ow
 *
¬row
, cÚ¡ 
Pošt
 *
to
, cÚ¡ Pošˆ*
äom
,

78 
Pošt
 *
move_¬row
, Pošˆ*
move_lše
,

79 
»®
 
lšewidth
)

81 
»®
 
add_Ën
;

82 
»®
 
ªgË
;

83 
Pošt
 
tmp
;

84 
A¼owTy³
 
¬row_ty³
 = 
¬row
->
ty³
;

88 ià(
lšewidth
 == 0.0)

89 
lšewidth
 = 0.0001;

94 ià(
¬row
->
Ëngth
 < 
MIN_ARROW_DIMENSION
 ||

95 
¬row
->
width
 < 
MIN_ARROW_DIMENSION
) {

96 
¬row_ty³
 = 
ARROW_NONE
;

104 
¬row_ty³
) {

105 
ARROW_LINES
:

106 
ARROW_HOLLOW_TRIANGLE
:

107 
ARROW_UNFILLED_TRIANGLE
:

108 
ARROW_FILLED_CONCAVE
:

109 
ARROW_BLANKED_CONCAVE
:

110 
ARROW_DOUBLE_HOLLOW_TRIANGLE
:

111 ià(
¬row
->
width
 < 0.0000001) ;

112 
ªgË
 = 
	`©ª
(
¬row
->
Ëngth
/×¼ow->
width
/2));

113 ià(
ªgË
 < 75*2*
G_PI
/360.0) {

114 
add_Ën
 = .5*
lšewidth
/
	`cos
(
ªgË
);

116 
add_Ën
 = 0;

119 *
move_¬row
 = *
to
;

120 
	`pošt_sub
(
move_¬row
, 
äom
);

121 
	`pošt_nÜm®ize
(
move_¬row
);

122 
	`pošt_sÿË
(
move_¬row
, 
add_Ën
);

124 
ARROW_HALF_HEAD
:

125 ià(
¬row
->
width
 < 0.0000001) ;

126 
ªgË
 = 
	`©ª
(
¬row
->
Ëngth
/×¼ow->
width
/2));

127 ià(
ªgË
 < 60*2*
G_PI
/360.0) {

128 
add_Ën
 = 
lšewidth
/
	`cos
(
ªgË
);

130 
add_Ën
 = 0;

133 *
move_¬row
 = *
to
;

134 
	`pošt_sub
(
move_¬row
, 
äom
);

135 
	`pošt_nÜm®ize
(
move_¬row
);

136 
	`pošt_sÿË
(
move_¬row
, 
add_Ën
);

138 
ARROW_FILLED_TRIANGLE
:

139 
ARROW_HOLLOW_ELLIPSE
:

140 
ARROW_ROUNDED
:

141 
ARROW_DIMENSION_ORIGIN
:

142 
ARROW_BLANKED_DOT
:

143 
ARROW_BLANKED_BOX
:

144 
add_Ën
 = .5*
lšewidth
;

146 *
move_¬row
 = *
to
;

147 
	`pošt_sub
(
move_¬row
, 
äom
);

148 
	`pošt_nÜm®ize
(
move_¬row
);

149 
	`pošt_sÿË
(
move_¬row
, 
add_Ën
);

151 
ARROW_ONE_EXACTLY
:

152 
ARROW_ONE_OR_NONE
:

153 
ARROW_ONE_OR_MANY
:

154 
ARROW_NONE_OR_MANY
:

156 
move_¬row
->
x
 = 0.0;

157 
move_¬row
->
y
 = 0.0;

162 
¬row_ty³
) {

163 
ARROW_LINES
:

164 
ARROW_HALF_HEAD
:

165 *
move_lše
 = *
move_¬row
;

166 
	`pošt_sÿË
(
move_lše
, 2.0);

168 
ARROW_HOLLOW_TRIANGLE
:

169 
ARROW_UNFILLED_TRIANGLE
:

170 
ARROW_FILLED_TRIANGLE
:

171 
ARROW_FILLED_ELLIPSE
:

172 
ARROW_HOLLOW_ELLIPSE
:

173 
ARROW_ROUNDED
:

174 *
move_lše
 = *
move_¬row
;

175 
	`pošt_nÜm®ize
(
move_lše
);

176 
	`pošt_sÿË
(
move_lše
, 
¬row
->
Ëngth
);

177 
	`pošt_add
(
move_lše
, 
move_¬row
);

179 
ARROW_HALF_DIAMOND
:

180 
ARROW_OPEN_ROUNDED
:

182 *
move_lše
 = *
to
;

183 
	`pošt_sub
(
move_lše
, 
äom
);

184 
	`pošt_nÜm®ize
(
move_lše
);

185 
	`pošt_sÿË
(
move_lše
, 
¬row
->
Ëngth
);

186 
	`pošt_add
(
move_lše
, 
move_¬row
);

188 
ARROW_HOLLOW_DIAMOND
:

189 
ARROW_FILLED_DIAMOND
:

191 *
move_lše
 = *
to
;

192 
	`pošt_sub
(
move_lše
, 
äom
);

193 
	`pošt_nÜm®ize
(
move_lše
);

196 
tmp
 = *
move_lše
;

197 
	`pošt_sÿË
(
move_lše
, 
¬row
->
Ëngth
);

198 
	`pošt_sÿË
(&
tmp
, 
G_SQRT2
*
lšewidth
);

199 
	`pošt_sub
(
move_lše
, &
tmp
);

201 
ARROW_DIMENSION_ORIGIN
:

202 
ARROW_BLANKED_DOT
:

203 
ARROW_BLANKED_BOX
:

204 *
move_lše
 = *
move_¬row
;

205 
	`pošt_nÜm®ize
(
move_lše
);

206 
	`pošt_sÿË
(
move_lše
, .5*
¬row
->
Ëngth
);

208 
ARROW_FILLED_DOT
:

209 
ARROW_FILLED_BOX
:

210 *
move_lše
 = *
to
;

211 
	`pošt_sub
(
move_lše
, 
äom
);

212 
	`pošt_nÜm®ize
(
move_lše
);

213 
	`pošt_sÿË
(
move_lše
, .5*
¬row
->
Ëngth
);

215 
ARROW_FILLED_CONCAVE
:

216 
ARROW_BLANKED_CONCAVE
:

217 *
move_lše
 = *
move_¬row
;

218 
	`pošt_nÜm®ize
(
move_lše
);

219 
	`pošt_sÿË
(
move_lše
, .75*
¬row
->
Ëngth
);

220 
	`pošt_add
(
move_lše
, 
move_¬row
);

222 
ARROW_DOUBLE_HOLLOW_TRIANGLE
:

223 *
move_lše
 = *
move_¬row
;

224 
	`pošt_nÜm®ize
(
move_lše
);

225 
tmp
 = *
move_lše
;

226 
	`pošt_sÿË
(
move_lše
, 2.0*
¬row
->
Ëngth
);

227 
	`pošt_add
(
move_lše
, 
move_¬row
);

228 
	`pošt_sÿË
(&
tmp
, 
lšewidth
);

229 
	`pošt_add
(
move_lše
, &
tmp
);

231 
ARROW_DOUBLE_FILLED_TRIANGLE
:

232 *
move_lše
 = *
to
;

233 
	`pošt_sub
(
move_lše
, 
äom
);

234 
	`pošt_nÜm®ize
(
move_lše
);

235 
	`pošt_sÿË
(
move_lše
, 2*
¬row
->
Ëngth
);

237 
ARROW_FILLED_DOT_N_TRIANGLE
:

238 *
move_lše
 = *
to
;

239 
	`pošt_sub
(
move_lše
, 
äom
);

240 
	`pošt_nÜm®ize
(
move_lše
);

241 
	`pošt_sÿË
(
move_lše
, 
¬row
->
Ëngth
 +‡¼ow->
width
);

243 
ARROW_THREE_DOTS
:

244 *
move_lše
 = *
to
;

245 
	`pošt_sub
(
move_lše
, 
äom
);

246 
add_Ën
 = 
	`pošt_Ën
(
move_lše
);

247 
	`pošt_nÜm®ize
(
move_lše
);

248 ià(
add_Ën
 > 4*
¬row
->
Ëngth
)

249 
	`pošt_sÿË
(
move_lše
, 2*
¬row
->
Ëngth
);

251 
	`pošt_sÿË
(
move_lše
, 
¬row
->
Ëngth
);

253 
ARROW_SLASH_ARROW
:

254 
ARROW_INTEGRAL_SYMBOL
:

255 *
move_lše
 = *
to
;

256 
	`pošt_sub
(
move_lše
, 
äom
);

257 
add_Ën
 = 
	`pošt_Ën
(
move_lše
);

258 
	`pošt_nÜm®ize
(
move_lše
);

259 
	`pošt_sÿË
(
move_lše
, 
¬row
->
Ëngth
 / 2);

261 
ARROW_ONE_EXACTLY
:

262 
ARROW_ONE_OR_NONE
:

263 
ARROW_ONE_OR_MANY
:

264 
ARROW_NONE_OR_MANY
:

266 
move_¬row
->
x
 = 0.0;

267 
move_¬row
->
y
 = 0.0;

268 
move_lše
->
x
 = 0.0;

269 
move_lše
->
y
 = 0.0;

272 
	}
}

285 
	$ÿlcuÏ‹_¬row
(
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

286 
»®
 
Ëngth
,„—È
width
)

288 
Pošt
 
d–
;

289 
Pošt
 
Üth_d–
;

290 
»®
 
Ën
;

292 
d–
 = *
to
;

293 
	`pošt_sub
(&
d–
, 
äom
);

294 
Ën
 = 
	`pošt_Ën
(&
d–
);

295 ià(
Ën
 <= 0.0001) {

296 
d–
.
x
=1.0;

297 
d–
.
y
=0.0;

299 
d–
.
x
/=
Ën
;

300 
d–
.
y
/=
Ën
;

303 
Üth_d–
.
x
 = 
d–
.
y
;

304 
Üth_d–
.
y
 = -
d–
.
x
;

306 
	`pošt_sÿË
(&
d–
, 
Ëngth
);

307 
	`pošt_sÿË
(&
Üth_d–
, 
width
/2.0);

309 
pŞy
[0] = *
to
;

310 
	`pošt_sub
(&
pŞy
[0], &
d–
);

311 
	`pošt_sub
(&
pŞy
[0], &
Üth_d–
);

312 
pŞy
[1] = *
to
;

313 
pŞy
[2] = *
to
;

314 
	`pošt_sub
(&
pŞy
[2], &
d–
);

315 
	`pošt_add
(&
pŞy
[2], &
Üth_d–
);

318 
	}
}

330 
	$ÿlcuÏ‹_üow
(
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

331 
»®
 
Ëngth
,„—È
width
)

333 
Pošt
 
d–
;

334 
Pošt
 
Üth_d–
;

335 
»®
 
Ën
;

337 
d–
 = *
to
;

338 
	`pošt_sub
(&
d–
, 
äom
);

339 
Ën
 = 
	`pošt_Ën
(&
d–
);

340 ià(
Ën
 <= 0.0001) {

341 
d–
.
x
=1.0;

342 
d–
.
y
=0.0;

344 
d–
.
x
/=
Ën
;

345 
d–
.
y
/=
Ën
;

348 
Üth_d–
.
x
 = 
d–
.
y
;

349 
Üth_d–
.
y
 = -
d–
.
x
;

351 
	`pošt_sÿË
(&
d–
, 
Ëngth
);

352 
	`pošt_sÿË
(&
Üth_d–
, 
width
/2.0);

354 
pŞy
[0] = *
to
;

355 
	`pošt_sub
(&
pŞy
[0], &
d–
);

356 
pŞy
[1] = *
to
;

357 
	`pošt_sub
(&
pŞy
[1], &
Üth_d–
);

358 
pŞy
[2] = *
to
;

359 
	`pošt_add
(&
pŞy
[2], &
Üth_d–
);

362 
	}
}

377 
	$d¿w_nÚe_Ü_mªy
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

378 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

379 
CŞÜ
 *
fg_cŞÜ
,CŞÜ *
bg_cŞÜ
)

381 
Pošt
 
£cÚd_äom
, 
£cÚd_to
;

383 
	`d¿w_üow_foÙ
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
,

384 
lšewidth
, 
fg_cŞÜ
, 
bg_cŞÜ
);

386 
	`ÿlcuÏ‹_doubË_¬row
(&
£cÚd_to
, &
£cÚd_äom
, 
to
, 
äom
, 
Ëngth
);

389 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

390 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

391 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

392 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

394 
	`d¿w_em±y_–l£
(
»nd””
, &
£cÚd_to
, &
£cÚd_äom
, 
Ëngth
/2,

395 
width
, 
lšewidth
, 
fg_cŞÜ
);

396 
	}
}

410 
	$d¿w_Úe_exaùly
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

411 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

412 
CŞÜ
 *
fg_cŞÜ
,CŞÜ *
bg_cŞÜ
)

414 
Pošt
 
vl
,
vt
;

415 
Pošt
 
bs
,
be
;

418 
	`pošt_cİy
(&
vl
,
äom
); 
	`pošt_sub
(&vl,
to
);

419 ià(
	`pošt_Ën
(&
vl
) > 0)

420 
	`pošt_nÜm®ize
(&
vl
);

422 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

424 ià(!
	`fš™e
(
vl
.
x
)) {

425 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

427 
	`pošt_g‘_³½
(&
vt
,&
vl
);

428 
	`pošt_cİy_add_sÿËd
(&
bs
,
to
,&
vl
,
Ëngth
/2);

429 
	`pošt_cİy_add_sÿËd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

430 
	`pošt_add_sÿËd
(&
bs
,&
vt
,
width
/2.0);

432 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””,&
bs
,&
be
,
fg_cŞÜ
);

434 
	`pošt_cİy_add_sÿËd
(&
bs
,
to
,&
vl
,
Ëngth
);

436 
	`pošt_cİy_add_sÿËd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

437 
	`pošt_add_sÿËd
(&
bs
,&
vt
,
width
/2.0);

439 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””,&
bs
,&
be
,
fg_cŞÜ
);

440 
	}
}

454 
	$d¿w_Úe_Ü_mªy
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

455 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

456 
CŞÜ
 *
fg_cŞÜ
,CŞÜ *
bg_cŞÜ
)

459 
Pošt
 
pŞy
[6];

461 
	`d¿w_üow_foÙ
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
,

462 
lšewidth
, 
fg_cŞÜ
, 
bg_cŞÜ
);

464 
	`ÿlcuÏ‹_¬row
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

466 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

467 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

468 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

469 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

471 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
pŞy
[0],&pŞy[2], 
fg_cŞÜ
);

472 
	}
}

486 
	$d¿w_Úe_Ü_nÚe
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

487 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

488 
CŞÜ
 *
fg_cŞÜ
,CŞÜ *
bg_cŞÜ
)

490 
Pošt
 
vl
,
vt
;

491 
Pošt
 
bs
,
be
;

492 
Pošt
 
£cÚd_äom
, 
£cÚd_to
;

495 
	`pošt_cİy
(&
vl
,
äom
); 
	`pošt_sub
(&vl,
to
);

496 ià(
	`pošt_Ën
(&
vl
) > 0)

497 
	`pošt_nÜm®ize
(&
vl
);

499 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

501 ià(!
	`fš™e
(
vl
.
x
)) {

502 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

504 
	`pošt_g‘_³½
(&
vt
,&
vl
);

505 
	`pošt_cİy_add_sÿËd
(&
bs
,
to
,&
vl
,
Ëngth
/2);

506 
	`pošt_cİy_add_sÿËd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

507 
	`pošt_add_sÿËd
(&
bs
,&
vt
,
width
/2.0);

509 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””,&
bs
,&
be
,
fg_cŞÜ
);

511 
	`ÿlcuÏ‹_doubË_¬row
(&
£cÚd_to
, &
£cÚd_äom
, 
to
, 
äom
, 
Ëngth
);

512 
	`d¿w_em±y_–l£
(
»nd””
, &
£cÚd_to
, &
£cÚd_äom
, 
Ëngth
/2, 
width
, 
lšewidth
, 
fg_cŞÜ
);

513 
	}
}

526 
	$d¿w_üow_foÙ
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

527 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

528 
CŞÜ
 *
fg_cŞÜ
,CŞÜ *
bg_cŞÜ
)

531 
Pošt
 
pŞy
[3];

533 
	`ÿlcuÏ‹_üow
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

535 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

536 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

537 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

539 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””,&
pŞy
[0],&pŞy[1],
fg_cŞÜ
);

540 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””,&
pŞy
[0],&pŞy[2],
fg_cŞÜ
);

541 
	}
}

553 
	$d¿w_lšes
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

554 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

555 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

557 
Pošt
 
pŞy
[3];

559 
	`ÿlcuÏ‹_¬row
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

561 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

562 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

563 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

564 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

566 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞylše
Ô’d””, 
pŞy
, 3, 
fg_cŞÜ
);

567 
	}
}

570 
	$ÿlcuÏ‹_–l£
 (
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

571 
»®
 
Ëngth
,„—È
width
)

573  
	`ÿlcuÏ‹_dŸmÚd
 (
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

574 
	}
}

589 
	$d¿w_fl_–l£
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

590 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

591 
CŞÜ
 *
fg_cŞÜ
,CŞÜ *
bg_cŞÜ
)

593 
BezPošt
 
bp
[5];

594 
Pošt
 
vl
,
vt
;

596 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

597 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

598 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

599 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

601 ià(!
bg_cŞÜ
) {

604 
Ëngth
 +ğ
lšewidth
;

605 
width
 +ğ
lšewidth
;

607 
	`pošt_cİy
(&
vl
,
äom
); 
	`pošt_sub
(&vl,
to
);

608 ià(
	`pošt_Ën
(&
vl
) > 0)

609 
	`pošt_nÜm®ize
(&
vl
);

611 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

613 ià(!
	`fš™e
(
vl
.
x
)) {

614 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

616 
	`pošt_g‘_³½
(&
vt
,&
vl
);

620 
bp
[0].
ty³
 = 
BEZ_MOVE_TO
;

621 
	`pošt_cİy
(&
bp
[0].
p1
,
to
);

622 
bp
[1].
ty³
 = bp[2].ty³ = bp[3].ty³ = bp[4].ty³ = 
BEZ_CURVE_TO
;

623 
	`pošt_cİy
(&
bp
[4].
p3
,&bp[0].
p1
);

625 
	`pošt_cİy_add_sÿËd
(&
bp
[2].
p3
,&bp[0].
p1
,&
vl
,
Ëngth
);

626 
	`pošt_cİy_add_sÿËd
(&
bp
[2].
p2
,&bp[2].
p3
,&
vt
,-
width
 / 4.0);

627 
	`pošt_cİy_add_sÿËd
(&
bp
[3].
p1
,&bp[2].
p3
,&
vt
,
width
 / 4.0);

628 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p1
,&bp[0].p1,&
vt
,-
width
 / 4.0);

629 
	`pošt_cİy_add_sÿËd
(&
bp
[4].
p2
,&bp[0].
p1
,&
vt
,
width
 / 4.0);

630 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p3
,&bp[0].
p1
,&
vl
,
Ëngth
 / 2.0);

631 
	`pošt_cİy_add_sÿËd
(&
bp
[3].
p3
,&bp[1].p3,&
vt
,
width
 / 2.0);

632 
	`pošt_add_sÿËd
(&
bp
[1].
p3
,&
vt
,-
width
 / 2.0);

633 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p2
,&bp[1].
p3
,&
vl
,-
Ëngth
 / 4.0);

634 
	`pošt_cİy_add_sÿËd
(&
bp
[4].
p1
,&bp[3].
p3
,&
vl
,-
Ëngth
 / 4.0);

635 
	`pošt_cİy_add_sÿËd
(&
bp
[2].
p1
,&bp[1].
p3
,&
vl
,
Ëngth
 / 4.0);

636 
	`pošt_cİy_add_sÿËd
(&
bp
[3].
p2
,&bp[3].
p3
,&
vl
,
Ëngth
 / 4.0);

637 ià(
bg_cŞÜ
) {

638 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_bez›r
Ô’d””,
bp
,(bp)/(bp[0]),
bg_cŞÜ
);

639 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_bez›r
Ô’d””,
bp
,(bp)/(bp[0]),
fg_cŞÜ
);

641 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_bez›r
Ô’d””,
bp
,(bp)/(bp[0]),
fg_cŞÜ
);

643 
	}
}

655 
	$d¿w_em±y_–l£
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

656 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

657 
CŞÜ
 *
fg_cŞÜ
)

659 
BezPošt
 
bp
[5];

660 
Pošt
 
vl
,
vt
;

661 
Pošt
 
di¥
;

663 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

664 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

665 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

666 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

668 
	`pošt_cİy
(&
vl
,
äom
);

669 
	`pošt_sub
(&
vl
,
to
);

670 ià(
	`pošt_Ën
(&
vl
) > 0)

671 
	`pošt_nÜm®ize
(&
vl
);

673 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

675 ià(!
	`fš™e
(
vl
.
x
)) {

676 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

679 
	`pošt_g‘_³½
(&
vt
,&
vl
);

681 
	`pošt_cİy
(&
di¥
, &
vl
);

682 
di¥
.
x
 *ğ
Ëngth
/2;

683 
di¥
.
y
 *ğ
Ëngth
/2;

686 
bp
[0].
ty³
 = 
BEZ_MOVE_TO
;

687 
	`pošt_cİy
(&
bp
[0].
p1
,
to
);

688 
	`pošt_add
(&
bp
[0].
p1
,&
di¥
);

689 
bp
[1].
ty³
 = bp[2].ty³ = bp[3].ty³ = bp[4].ty³ = 
BEZ_CURVE_TO
;

690 
	`pošt_cİy
(&
bp
[4].
p3
,&bp[0].
p1
);

692 
	`pošt_cİy_add_sÿËd
(&
bp
[2].
p3
,&bp[0].
p1
,&
vl
,
Ëngth
);

693 
	`pošt_cİy_add_sÿËd
(&
bp
[2].
p2
,&bp[2].
p3
,&
vt
,-
width
 / 4.0);

694 
	`pošt_cİy_add_sÿËd
(&
bp
[3].
p1
,&bp[2].
p3
,&
vt
,
width
 / 4.0);

695 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p1
,&bp[0].p1,&
vt
,-
width
 / 4.0);

696 
	`pošt_cİy_add_sÿËd
(&
bp
[4].
p2
,&bp[0].
p1
,&
vt
,
width
 / 4.0);

697 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p3
,&bp[0].
p1
,&
vl
,
Ëngth
 / 2.0);

698 
	`pošt_cİy_add_sÿËd
(&
bp
[3].
p3
,&bp[1].p3,&
vt
,
width
 / 2.0);

699 
	`pošt_add_sÿËd
(&
bp
[1].
p3
,&
vt
,-
width
 / 2.0);

700 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p2
,&bp[1].
p3
,&
vl
,-
Ëngth
 / 4.0);

701 
	`pošt_cİy_add_sÿËd
(&
bp
[4].
p1
,&bp[3].
p3
,&
vl
,-
Ëngth
 / 4.0);

702 
	`pošt_cİy_add_sÿËd
(&
bp
[2].
p1
,&bp[1].
p3
,&
vl
,
Ëngth
 / 4.0);

703 
	`pošt_cİy_add_sÿËd
(&
bp
[3].
p2
,&bp[3].
p3
,&
vl
,
Ëngth
 / 4.0);

705 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_bez›r
Ô’d””,
bp
,(bp)/(bp[0]),
fg_cŞÜ
);

706 
	}
}

709 
	$ÿlcuÏ‹_box
 (
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

710 
»®
 
Ëngth
,„—È
width
)

712 
Pošt
 
vl
, 
vt
;

713 
Pošt
 
bs
, 
be
;

715 
	`pošt_cİy
(&
vl
,
äom
); 
	`pošt_sub
(&vl,
to
);

716 ià(
	`pošt_Ën
(&
vl
) > 0)

717 
	`pošt_nÜm®ize
(&
vl
);

719 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

721 ià(!
	`fš™e
(
vl
.
x
)) {

722 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

724 
	`pošt_g‘_³½
(&
vt
,&
vl
);

726 
	`pošt_cİy_add_sÿËd
(&
bs
,
to
,&
vl
,
Ëngth
/4);

727 
	`pošt_cİy_add_sÿËd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

728 
	`pošt_add_sÿËd
(&
bs
,&
vt
,
width
/2.0);

730 
	`pošt_cİy
(&
pŞy
[0],
to
);

731 
	`pošt_cİy
(&
pŞy
[1],&poly[0]);

732 
	`pošt_add_sÿËd
(&
pŞy
[0],&
vt
,
width
/4.0);

733 
	`pošt_add_sÿËd
(&
pŞy
[1],&
vt
,-
width
/4.0);

734 
	`pošt_cİy_add_sÿËd
(&
pŞy
[2],&pŞy[1],&
vl
,
Ëngth
/2.0);

735 
	`pošt_cİy_add_sÿËd
(&
pŞy
[3],&pŞy[0],&
vl
,
Ëngth
/2.0);

737 
pŞy
[4] = 
bs
;

738 
pŞy
[5] = 
be
;

741 
	}
}

755 
	$d¿w_fl_box
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

756 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

757 
CŞÜ
 *
fg_cŞÜ
,CŞÜ *
bg_cŞÜ
)

759 
Pošt
 
pŞy
[6];

760 
»®
 
lw_çùÜ
,
ş’gth
,
cwidth
;

762 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

763 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

764 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

765 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

767 ià(
fg_cŞÜ
 =ğ
bg_cŞÜ
) {

769 
lw_çùÜ
 = 
lšewidth
;

772 
lw_çùÜ
 = 0.0;

774 
ş’gth
 = 
Ëngth
 + 
lw_çùÜ
;

775 
cwidth
 = 
width
 + 
lw_çùÜ
;

777 
	`ÿlcuÏ‹_box
 (
pŞy
, 
to
, 
äom
, 
ş’gth
, 
cwidth
);

779 ià(
fg_cŞÜ
 =ğ
bg_cŞÜ
) {

780 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_pŞygÚ
Ô’d””, 
pŞy
, 4, 
fg_cŞÜ
);

782 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_pŞygÚ
Ô’d””, 
pŞy
, 4, 
bg_cŞÜ
);

783 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞygÚ
Ô’d””, 
pŞy
, 4, 
fg_cŞÜ
);

785 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””,&
pŞy
[4],&pŞy[5],
fg_cŞÜ
);

786 
	}
}

788 
	$ÿlcuÏ‹_dÙ
 (
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

789 
»®
 
Ëngth
,„—È
width
)

791  
	`ÿlcuÏ‹_dŸmÚd
 (
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

792 
	}
}

805 
	$d¿w_fl_dÙ
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

806 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

807 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

809 
BezPošt
 
bp
[5];

810 
Pošt
 
vl
,
vt
;

811 
Pošt
 
bs
,
be
;

812 
»®
 
lw_çùÜ
,
ş’gth
,
cwidth
;

814 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

815 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

816 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

817 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

819 ià(
fg_cŞÜ
 =ğ
bg_cŞÜ
) {

821 
lw_çùÜ
 = 
lšewidth
;

824 
lw_çùÜ
 = 0.0;

826 
ş’gth
 = 
Ëngth
 + 
lw_çùÜ
;

827 
cwidth
 = 
width
 + 
lw_çùÜ
;

829 
	`pošt_cİy
(&
vl
,
äom
); 
	`pošt_sub
(&vl,
to
);

830 ià(
	`pošt_Ën
(&
vl
) > 0)

831 
	`pošt_nÜm®ize
(&
vl
);

833 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

835 ià(!
	`fš™e
(
vl
.
x
)) {

836 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

838 
	`pošt_g‘_³½
(&
vt
,&
vl
);

840 
	`pošt_cİy_add_sÿËd
(&
bs
,
to
,&
vl
,
Ëngth
/4);

841 
	`pošt_cİy_add_sÿËd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

842 
	`pošt_add_sÿËd
(&
bs
,&
vt
,
width
/2.0);

845 
bp
[0].
ty³
 = 
BEZ_MOVE_TO
;

846 
	`pošt_cİy
(&
bp
[0].
p1
,
to
);

847 
bp
[1].
ty³
 = bp[2].ty³ = bp[3].ty³ = bp[4].ty³ = 
BEZ_CURVE_TO
;

848 
	`pošt_cİy
(&
bp
[4].
p3
,&bp[0].
p1
);

850 
	`pošt_cİy_add_sÿËd
(&
bp
[2].
p3
,&bp[0].
p1
,&
vl
,
ş’gth
/2);

851 
	`pošt_cİy_add_sÿËd
(&
bp
[2].
p2
,&bp[2].
p3
,&
vt
,-
cwidth
 / 8.0);

852 
	`pošt_cİy_add_sÿËd
(&
bp
[3].
p1
,&bp[2].
p3
,&
vt
,
cwidth
 / 8.0);

853 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p1
,&bp[0].p1,&
vt
,-
cwidth
 / 8.0);

854 
	`pošt_cİy_add_sÿËd
(&
bp
[4].
p2
,&bp[0].
p1
,&
vt
,
cwidth
 / 8.0);

855 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p3
,&bp[0].
p1
,&
vl
,
ş’gth
 / 4.0);

856 
	`pošt_cİy_add_sÿËd
(&
bp
[3].
p3
,&bp[1].p3,&
vt
,
cwidth
 / 4.0);

857 
	`pošt_add_sÿËd
(&
bp
[1].
p3
,&
vt
,-
cwidth
 / 4.0);

858 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p2
,&bp[1].
p3
,&
vl
,-
ş’gth
 / 8.0);

859 
	`pošt_cİy_add_sÿËd
(&
bp
[4].
p1
,&bp[3].
p3
,&
vl
,-
ş’gth
 / 8.0);

860 
	`pošt_cİy_add_sÿËd
(&
bp
[2].
p1
,&bp[1].
p3
,&
vl
,
ş’gth
 / 8.0);

861 
	`pošt_cİy_add_sÿËd
(&
bp
[3].
p2
,&bp[3].
p3
,&
vl
,
ş’gth
 / 8.0);

863 ià(!
bg_cŞÜ
) {

865 
Pošt
 
dos
,
dÛ
;

867 
	`pošt_cİy_add_sÿËd
(&
dÛ
,
to
,&
vl
,
Ëngth
);

868 
	`pošt_cİy_add_sÿËd
(&
dos
,
to
,&
vl
,
Ëngth
/2);

870 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””,&
dos
,&
dÛ
,
fg_cŞÜ
);

872 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_bez›r
Ô’d””,
bp
,(bp)/(bp[0]),
bg_cŞÜ
);

874 ià(
fg_cŞÜ
 !ğ
bg_cŞÜ
) {

875 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_bez›r
Ô’d””,
bp
,(bp)/(bp[0]),
fg_cŞÜ
);

877 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””,&
bs
,&
be
,
fg_cŞÜ
);

878 
	}
}

893 
	$d¿w_š‹g¿l
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

894 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

895 
CŞÜ
 *
fg_cŞÜ
)

897 
BezPošt
 
bp
[2];

898 
Pošt
 
vl
,
vt
;

899 
Pošt
 
bs
,
be
, 
bs2
,
be2
;

900 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

901 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

902 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

903 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

905 
	`pošt_cİy
(&
vl
,
äom
); 
	`pošt_sub
(&vl,
to
);

906 ià(
	`pošt_Ën
(&
vl
) > 0)

907 
	`pošt_nÜm®ize
(&
vl
);

909 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

911 ià(!
	`fš™e
(
vl
.
x
)) {

912 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

914 
	`pošt_g‘_³½
(&
vt
,&
vl
);

916 
	`pošt_cİy_add_sÿËd
(&
bs
,
to
,&
vl
,
Ëngth
/2);

917 
	`pošt_cİy_add_sÿËd
(&
be
,&
bs
,&
vt
,-
width
/2.0);

918 
	`pošt_add_sÿËd
(&
bs
,&
vt
,
width
/2.0);

920 
	`pošt_cİy_add_sÿËd
(&
bs2
,
to
,&
vl
,
Ëngth
/2);

921 
	`pošt_cİy_add_sÿËd
(&
be2
,&
bs2
,&
vl
,
Ëngth
/2);

923 
bp
[0].
ty³
 = 
BEZ_MOVE_TO
;

924 
bp
[1].
ty³
 = 
BEZ_CURVE_TO
;

925 
	`pošt_cİy_add_sÿËd
(&
bp
[0].
p1
,
to
,&
vl
,.1*
Ëngth
);

926 
	`pošt_add_sÿËd
(&
bp
[0].
p1
,&
vt
,.4*
width
);

927 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p3
,
to
,&
vl
,.9*
Ëngth
);

928 
	`pošt_add_sÿËd
(&
bp
[1].
p3
,&
vt
,-.4*
width
);

929 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p1
,&bp[0].p1,&
vl
,.35*
Ëngth
);

930 
	`pošt_cİy_add_sÿËd
(&
bp
[1].
p2
,&bp[1].
p3
,&
vl
,-.35*
Ëngth
);

932 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
bs2
, &
be2
, 
fg_cŞÜ
);

933 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
bs
, &
be
, 
fg_cŞÜ
);

934 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_bez›r
Ô’d””,
bp
,(bp)/(bp[0]),
fg_cŞÜ
);

935 
	}
}

937 
	$ÿlcuÏ‹_¦ashed
 (
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

938 
»®
 
Ëngth
,„—È
width
)

940 
Pošt
 
vl
,
vt
;

942 
	`pošt_cİy
(&
vl
,
äom
);

943 
	`pošt_sub
(&
vl
,
to
);

944 ià(
	`pošt_Ën
(&
vl
) > 0)

945 
	`pošt_nÜm®ize
(&
vl
);

947 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

949 ià(!
	`fš™e
(
vl
.
x
)) {

950 
vl
.
x
 = 1.0; vl.
y
 = 0.0;

952 
	`pošt_g‘_³½
(&
vt
,&
vl
);

954 
	`pošt_cİy_add_sÿËd
(&
pŞy
[2],
to
,&
vl
,
Ëngth
/2);

955 
	`pošt_cİy_add_sÿËd
(&
pŞy
[3],&pŞy[2],&
vt
,-
width
/2.0);

956 
	`pošt_add_sÿËd
(&
pŞy
[2],&
vt
,
width
/2.0);

958 
	`pošt_cİy_add_sÿËd
(&
pŞy
[0],
to
,&
vl
,
Ëngth
/2);

959 
	`pošt_cİy_add_sÿËd
(&
pŞy
[1],&pŞy[0],&
vl
,
Ëngth
/2);

961 
	`pošt_cİy_add_sÿËd
(&
pŞy
[4],
to
,&
vl
,.1*
Ëngth
);

962 
	`pošt_add_sÿËd
(&
pŞy
[4],&
vt
,.4*
width
);

963 
	`pošt_cİy_add_sÿËd
(&
pŞy
[5],
to
,&
vl
,.9*
Ëngth
);

964 
	`pošt_add_sÿËd
(&
pŞy
[5],&
vt
,-.4*
width
);

967 
	}
}

982 
	$d¿w_¦ashed
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

983 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

984 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

986 
Pošt
 
pŞy
[6];

988 
	`ÿlcuÏ‹_¦ashed
 (
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

990 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

991 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

992 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

993 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

995 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
pŞy
[0], &pŞy[1], 
fg_cŞÜ
);

996 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
pŞy
[2], &pŞy[3], 
fg_cŞÜ
);

997 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
pŞy
[4], &pŞy[5], 
fg_cŞÜ
);

998 
	}
}

1010 
	$ÿlcuÏ‹_h®fh—d
(
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

1011 
»®
 
Ëngth
,„—È
width
)

1013 
Pošt
 
d–
;

1014 
Pošt
 
Üth_d–
;

1015 
»®
 
Ën
;

1016 
»®
 
ªgË
;

1018 ià(
width
 > 0.0000001) {

1019 
ªgË
 = 
	`©ª
(
Ëngth
/(
width
/2));

1021 
ªgË
 = 0;

1024 
d–
 = *
to
;

1025 
	`pošt_sub
(&
d–
, 
äom
);

1026 
Ën
 = 
	`pošt_Ën
(&
d–
);

1027 ià(
Ën
 <= 0.0001) {

1028 
d–
.
x
=1.0;

1029 
d–
.
y
=0.0;

1031 
d–
.
x
/=
Ën
;

1032 
d–
.
y
/=
Ën
;

1035 
Üth_d–
.
x
 = 
d–
.
y
;

1036 
Üth_d–
.
y
 = -
d–
.
x
;

1038 
	`pošt_sÿË
(&
d–
, 
Ëngth
);

1039 
	`pošt_sÿË
(&
Üth_d–
, 
width
/2.0);

1041 
pŞy
[0] = *
to
;

1042 
	`pošt_sub
(&
pŞy
[0], &
d–
);

1043 
	`pošt_sub
(&
pŞy
[0], &
Üth_d–
);

1044 
pŞy
[1] = *
to
;

1045 
pŞy
[2] = *
to
;

1046 
	`pošt_nÜm®ize
(&
d–
);

1047 
	`pošt_sÿË
(&
d–
, 0);

1048 
	`pošt_sub
(&
pŞy
[2], &
d–
);

1051 
	}
}

1063 
	$d¿w_h®fh—d
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1064 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1065 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1067 
Pošt
 
pŞy
[3];

1069 
	`ÿlcuÏ‹_h®fh—d
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1071 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1072 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1073 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1074 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1076 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞylše
Ô’d””, 
pŞy
, 3, 
fg_cŞÜ
);

1077 
	}
}

1089 
	$d¿w_ŒŸngË
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1090 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1091 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1093 
Pošt
 
pŞy
[3];

1095 
	`ÿlcuÏ‹_¬row
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1097 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1098 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1099 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1101 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞygÚ
Ô’d””, 
pŞy
, 3, 
fg_cŞÜ
);

1102 
	}
}

1114 
	$fl_ŒŸngË
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1115 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1116 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1118 
Pošt
 
pŞy
[3];

1120 
	`ÿlcuÏ‹_¬row
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1122 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_fl¡yË
Ô’d””, 
FILLSTYLE_SOLID
);

1123 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1125 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_pŞygÚ
Ô’d””, 
pŞy
, 3, 
bg_cŞÜ
);

1126 
	}
}

1140 
	$ÿlcuÏ‹_dŸmÚd
(
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

1141 
»®
 
Ëngth
,„—È
width
)

1143 
Pošt
 
d–
;

1144 
Pošt
 
Üth_d–
;

1145 
»®
 
Ën
;

1147 
d–
 = *
to
;

1148 
	`pošt_sub
(&
d–
, 
äom
);

1149 
Ën
 = 
	`sq¹
(
	`pošt_dÙ
(&
d–
, &delta));

1150 ià(
Ën
 <= 0.0001) {

1151 
d–
.
x
=1.0;

1152 
d–
.
y
=0.0;

1154 
d–
.
x
/=
Ën
;

1155 
d–
.
y
/=
Ën
;

1158 
Üth_d–
.
x
 = 
d–
.
y
;

1159 
Üth_d–
.
y
 = -
d–
.
x
;

1161 
	`pošt_sÿË
(&
d–
, 
Ëngth
/2.0);

1162 
	`pošt_sÿË
(&
Üth_d–
, 
width
/2.0);

1164 
pŞy
[0] = *
to
;

1165 
pŞy
[1] = *
to
;

1166 
	`pošt_sub
(&
pŞy
[1], &
d–
);

1167 
	`pošt_sub
(&
pŞy
[1], &
Üth_d–
);

1168 
pŞy
[2] = *
to
;

1169 
	`pošt_sub
(&
pŞy
[2], &
d–
);

1170 
	`pošt_sub
(&
pŞy
[2], &
d–
);

1171 
pŞy
[3] = *
to
;

1172 
	`pošt_sub
(&
pŞy
[3], &
d–
);

1173 
	`pošt_add
(&
pŞy
[3], &
Üth_d–
);

1176 
	}
}

1188 
	$d¿w_dŸmÚd
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1189 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1190 
CŞÜ
 *
cŞÜ
)

1192 
Pošt
 
pŞy
[4];

1194 
	`ÿlcuÏ‹_dŸmÚd
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1196 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1197 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1198 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1199 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1201 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞygÚ
Ô’d””, 
pŞy
, 4, 
cŞÜ
);

1202 
	}
}

1214 
	$d¿w_h®f_dŸmÚd
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1215 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1216 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1218 
Pošt
 
pŞy
[4];

1220 
	`ÿlcuÏ‹_dŸmÚd
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1222 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1223 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1224 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1225 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1227 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞylše
Ô’d””, 
pŞy
+1, 3, 
fg_cŞÜ
);

1228 
	}
}

1239 
	$fl_dŸmÚd
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1240 
»®
 
Ëngth
,„—È
width
,

1241 
CŞÜ
 *
cŞÜ
)

1243 
Pošt
 
pŞy
[4];

1245 
	`ÿlcuÏ‹_dŸmÚd
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1247 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1248 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1249 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1251 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_pŞygÚ
Ô’d””, 
pŞy
, 4, 
cŞÜ
);

1252 
	}
}

1263 
	$ÿlcuÏ‹_¦ashed_üoss
(
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

1264 
»®
 
Ëngth
,„—È
width
)

1266 
Pošt
 
d–
;

1267 
Pošt
 
Üth_d–
;

1268 
»®
 
Ën
;

1269 
i
;

1271 
d–
 = *
to
;

1272 
	`pošt_sub
(&
d–
, 
äom
);

1273 
Ën
 = 
	`sq¹
(
	`pošt_dÙ
(&
d–
, &delta));

1274 ià(
Ën
 <= 0.0001) {

1275 
d–
.
x
=1.0;

1276 
d–
.
y
=0.0;

1278 
d–
.
x
/=
Ën
;

1279 
d–
.
y
/=
Ën
;

1282 
Üth_d–
.
x
 = 
d–
.
y
;

1283 
Üth_d–
.
y
 = -
d–
.
x
;

1285 
	`pošt_sÿË
(&
d–
, 
Ëngth
/2.0);

1286 
	`pošt_sÿË
(&
Üth_d–
, 
width
/2.0);

1288 
i
=0; i<6;i++)
pŞy
[i] = *
to
;

1290 
	`pošt_add
(&
pŞy
[1], &
d–
);

1292 
	`pošt_add
(&
pŞy
[2], &
d–
);

1293 
	`pošt_add
(&
pŞy
[2], &
Üth_d–
);

1295 
	`pošt_sub
(&
pŞy
[3], &
d–
);

1296 
	`pošt_sub
(&
pŞy
[3], &
Üth_d–
);

1298 
	`pošt_add
(&
pŞy
[4], &
Üth_d–
);

1299 
	`pošt_sub
(&
pŞy
[5], &
Üth_d–
);

1302 
	}
}

1314 
	$d¿w_¦ashed_üoss
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1315 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1316 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1318 
Pošt
 
pŞy
[6];

1320 
	`ÿlcuÏ‹_¦ashed_üoss
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1322 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1323 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1324 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1325 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1327 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
pŞy
[0],&pŞy[1], 
fg_cŞÜ
);

1328 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
pŞy
[2],&pŞy[3], 
fg_cŞÜ
);

1329 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
pŞy
[4],&pŞy[5], 
fg_cŞÜ
);

1330 
	}
}

1332 
	$ÿlcuÏ‹_back¦ash
 (
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

1333 
»®
 
Ëngth
,„—È
width
)

1335 
Pošt
 
d–
;

1336 
Pošt
 
Üth_d–
;

1337 
»®
 
Ën
;

1339 
d–
 = *
to
;

1340 
	`pošt_sub
(&
d–
, 
äom
);

1341 
Ën
 = 
	`sq¹
(
	`pošt_dÙ
(&
d–
, &delta));

1342 ià(
Ën
 <= 0.0001) {

1343 
d–
.
x
=1.0;

1344 
d–
.
y
=0.0;

1346 
d–
.
x
/=
Ën
;

1347 
d–
.
y
/=
Ën
;

1350 
Üth_d–
.
x
 = 
d–
.
y
;

1351 
Üth_d–
.
y
 = -
d–
.
x
;

1353 
	`pošt_sÿË
(&
d–
, 
Ëngth
/2.0);

1354 
	`pošt_sÿË
(&
Üth_d–
, 
width
/2.0);

1356 
pŞy
[0] = *
to
;

1357 
	`pošt_sub
(&
pŞy
[0], &
d–
);

1358 
	`pošt_sub
(&
pŞy
[0], &
d–
);

1359 
	`pošt_sub
(&
pŞy
[0], &
d–
);

1360 
	`pošt_add
(&
pŞy
[0], &
Üth_d–
);

1362 
pŞy
[1] = *
to
;

1363 
	`pošt_sub
(&
pŞy
[1], &
d–
);

1364 
	`pošt_sub
(&
pŞy
[1], &
Üth_d–
);

1367 
	}
}

1378 
	$d¿w_back¦ash
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1379 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1380 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1382 
Pošt
 
pŞy
[2];

1384 
	`ÿlcuÏ‹_back¦ash
 (
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1386 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1387 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1388 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1389 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1391 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
pŞy
[0], &pŞy[1], 
fg_cŞÜ
);

1392 
	}
}

1404 
	$d¿w_üoss
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1405 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1406 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1408 
Pošt
 
pŞy
[6];

1410 
	`ÿlcuÏ‹_¬row
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1412 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1413 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1414 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1415 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1417 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
pŞy
[0],&pŞy[2], 
fg_cŞÜ
);

1419 
	}
}

1431 
	$ÿlcuÏ‹_doubË_¬row
(
Pošt
 *
£cÚd_to
, Pošˆ*
£cÚd_äom
,

1432 cÚ¡ 
Pošt
 *
to
, cÚ¡ Pošˆ*
äom
, 
»®
 
Ëngth
)

1434 
Pošt
 
d–
;

1435 
»®
 
Ën
;

1437 
d–
 = *
to
;

1438 
	`pošt_sub
(&
d–
, 
äom
);

1439 
Ën
 = 
	`sq¹
(
	`pošt_dÙ
(&
d–
, &delta));

1440 ià(
Ën
 <= 0.0001) {

1441 
d–
.
x
=1.0;

1442 
d–
.
y
=0.0;

1444 
d–
.
x
/=
Ën
;

1445 
d–
.
y
/=
Ën
;

1448 
	`pošt_sÿË
(&
d–
, 
Ëngth
/2);

1450 *
£cÚd_to
 = *
to
;

1451 
	`pošt_sub
(
£cÚd_to
, &
d–
);

1452 
	`pošt_sub
(
£cÚd_to
, &
d–
);

1453 *
£cÚd_äom
 = *
äom
;

1454 
	`pošt_add
(
£cÚd_äom
, &
d–
);

1455 
	`pošt_add
(
£cÚd_äom
, &
d–
);

1456 
	}
}

1468 
	$d¿w_doubË_ŒŸngË
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1469 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1470 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1472 
Pošt
 
£cÚd_äom
, 
£cÚd_to
;

1474 
	`d¿w_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
, 
bg_cŞÜ
);

1475 
	`ÿlcuÏ‹_doubË_¬row
(&
£cÚd_to
, &
£cÚd_äom
, 
to
, 
äom
, 
Ëngth
+
lšewidth
);

1476 
	`d¿w_ŒŸngË
(
»nd””
, &
£cÚd_to
, &
£cÚd_äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
, 
bg_cŞÜ
);

1477 
	}
}

1489 
	$fl_doubË_ŒŸngË
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1490 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1491 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1493 
Pošt
 
£cÚd_äom
, 
£cÚd_to
;

1495 
	`fl_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
NULL
, 
bg_cŞÜ
);

1496 
	`ÿlcuÏ‹_doubË_¬row
(&
£cÚd_to
, &
£cÚd_äom
, 
to
, 
äom
, 
Ëngth
);

1497 
	`fl_ŒŸngË
(
»nd””
, &
£cÚd_to
, &
£cÚd_äom
, 
Ëngth
, 
width
, 
lšewidth
, 
NULL
, 
bg_cŞÜ
);

1498 
	}
}

1512 
	$ÿlcuÏ‹_cÚÿve
(
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

1513 
»®
 
Ëngth
,„—È
width
)

1515 
Pošt
 
d–
;

1516 
Pošt
 
Üth_d–
;

1517 
»®
 
Ën
;

1519 
d–
 = *
to
;

1520 
	`pošt_sub
(&
d–
, 
äom
);

1521 
Ën
 = 
	`sq¹
(
	`pošt_dÙ
(&
d–
, &delta));

1522 ià(
Ën
 <= 0.0001) {

1523 
d–
.
x
=1.0;

1524 
d–
.
y
=0.0;

1526 
d–
.
x
/=
Ën
;

1527 
d–
.
y
/=
Ën
;

1530 
Üth_d–
.
x
 = 
d–
.
y
;

1531 
Üth_d–
.
y
 = -
d–
.
x
;

1533 
	`pošt_sÿË
(&
d–
, 
Ëngth
/4.0);

1534 
	`pošt_sÿË
(&
Üth_d–
, 
width
/2.0);

1536 
pŞy
[0] = *
to
;

1537 
pŞy
[1] = *
to
;

1538 
	`pošt_sub
(&
pŞy
[1], &
d–
);

1539 
	`pošt_sub
(&
pŞy
[1], &
d–
);

1540 
	`pošt_sub
(&
pŞy
[1], &
d–
);

1541 
	`pošt_sub
(&
pŞy
[1], &
d–
);

1542 
	`pošt_sub
(&
pŞy
[1], &
Üth_d–
);

1543 
pŞy
[2] = *
to
;

1544 
	`pošt_sub
(&
pŞy
[2], &
d–
);

1545 
	`pošt_sub
(&
pŞy
[2], &
d–
);

1546 
	`pošt_sub
(&
pŞy
[2], &
d–
);

1547 
pŞy
[3] = *
to
;

1548 
	`pošt_add
(&
pŞy
[3], &
Üth_d–
);

1549 
	`pošt_sub
(&
pŞy
[3], &
d–
);

1550 
	`pošt_sub
(&
pŞy
[3], &
d–
);

1551 
	`pošt_sub
(&
pŞy
[3], &
d–
);

1552 
	`pošt_sub
(&
pŞy
[3], &
d–
);

1555 
	}
}

1568 
	$d¿w_cÚÿve_ŒŸngË
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1569 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1570 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1572 
Pošt
 
pŞy
[4];

1574 
	`ÿlcuÏ‹_cÚÿve
(
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1576 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1577 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1578 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1580 ià(
fg_cŞÜ
 =ğ
bg_cŞÜ
)

1581 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_pŞygÚ
Ô’d””, 
pŞy
, 4, 
bg_cŞÜ
);

1582 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞygÚ
Ô’d””, 
pŞy
, 4, 
fg_cŞÜ
);

1583 
	}
}

1596 
	$d¿w_rounded
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1597 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1598 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1600 
Pošt
 
p
 = *
to
;

1601 
Pošt
 
d–
;

1602 
»®
 
Ën
, 
¿yÚ
;

1603 
»®
 
¿µÜt
;

1604 
»®
 
ªgË_¡¬t
;

1606 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1607 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1608 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1609 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1611 
d–
 = *
äom
;

1613 
	`pošt_sub
(&
d–
, 
to
);

1615 
Ën
 = 
	`sq¹
(
	`pošt_dÙ
(&
d–
, &delta));

1616 
¿yÚ
 = (
Ëngth
 / 2.0);

1617 ià(
Ën
 > 0.0) {

1619 
¿µÜt
 = 
¿yÚ
 / 
Ën
;

1621 
p
.
x
 +ğ
d–
.x * 
¿µÜt
;

1622 
p
.
y
 +ğ
d–
.y * 
¿µÜt
;

1624 
ªgË_¡¬t
 = 90.0 - 
	`asš
((
p
.
y
 - 
to
->yè/ 
¿yÚ
) * (180.0 / 3.14);

1625 ià(
p
.
x
 - 
to
->x < 0è{ 
ªgË_¡¬t
 = 360.0 -‡ngle_start; }

1627 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_¬c
Ô’d””, &
p
, 
width
, 
Ëngth
, 
ªgË_¡¬t
,‡ngË_¡¬ˆ- 180.0, 
fg_cŞÜ
);

1629 ià(
Ën
 > 0.0) {

1630 
p
.
x
 +ğ
d–
.x * 
¿µÜt
;

1631 
p
.
y
 +ğ
d–
.y * 
¿µÜt
;

1633 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
p
, 
to
, 
fg_cŞÜ
);

1634 
	}
}

1648 
	$d¿w_İ’_rounded
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1649 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1650 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1652 
Pošt
 
p
 = *
to
;

1653 
Pošt
 
d–
;

1654 
»®
 
Ën
, 
¿yÚ
;

1655 
»®
 
¿µÜt
;

1656 
»®
 
ªgË_¡¬t
;

1657 
Pošt
 
p_lše
;

1659 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1660 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1661 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1663 
d–
 = *
äom
;

1665 
	`pošt_sub
(&
d–
, 
to
);

1667 
Ën
 = 
	`sq¹
(
	`pošt_dÙ
(&
d–
, &delta));

1668 
¿yÚ
 = (
Ëngth
 / 2.0);

1669 ià(
Ën
 > 0.0) {

1671 
¿µÜt
 = 
¿yÚ
 / 
Ën
;

1673 
p
.
x
 +ğ
d–
.x * 
¿µÜt
;

1674 
p
.
y
 +ğ
d–
.y * 
¿µÜt
;

1676 
ªgË_¡¬t
 = 90.0 - 
	`asš
((
p
.
y
 - 
to
->yè/ 
¿yÚ
) * (180.0 / 3.14);

1677 ià(
p
.
x
 - 
to
->x < 0è{ 
ªgË_¡¬t
 = 360.0 -‡ngle_start; }

1679 
p_lše
 = 
p
;

1680 ià(
Ën
 > 0.0) {

1681 
p_lše
.
x
 +ğ
d–
.x * 
¿µÜt
;

1682 
p_lše
.
y
 +ğ
d–
.y * 
¿µÜt
;

1688 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1689 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_¬c
Ô’d””, &
p
, 
width
, 
Ëngth
, 
ªgË_¡¬t
 - 180.0,‡ngË_¡¬t, 
fg_cŞÜ
);

1690 
	}
}

1703 
	$d¿w_fËd_dÙ_n_ŒŸngË
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1704 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1705 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1707 
Pošt
 
p_dÙ
 = *
to
, 
p_Œi
 = *to, 
d–
;

1708 
»®
 
Ën
, 
¿yÚ
;

1709 
»®
 
¿µÜt
;

1710 
Pošt
 
pŞy
[3];

1712 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

1713 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

1714 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1715 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1717 
d–
 = *
äom
;

1719 
	`pošt_sub
(&
d–
, 
to
);

1721 
Ën
 = 
	`sq¹
(
	`pošt_dÙ
(&
d–
, &delta));

1724 
¿yÚ
 = (
width
 / 2.0);

1726 ià(
Ën
 > 0.0) {

1728 
¿µÜt
 = 
¿yÚ
 / 
Ën
;

1729 
p_dÙ
.
x
 +ğ
d–
.x * 
¿µÜt
;

1730 
p_dÙ
.
y
 +ğ
d–
.y * 
¿µÜt
;

1732 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_–l£
Ô’d””, &
p_dÙ
,

1733 
width
, width, 
fg_cŞÜ
);

1735 ià(
Ën
 > 0.0) {

1736 
¿µÜt
 = 
width
 / 
Ën
;

1737 
p_Œi
.
x
 +ğ
d–
.x * 
¿µÜt
;

1738 
p_Œi
.
y
 +ğ
d–
.y * 
¿µÜt
;

1740 
	`ÿlcuÏ‹_¬row
(
pŞy
, &
p_Œi
, 
äom
, 
Ëngth
, 
width
);

1741 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_pŞygÚ
Ô’d””, 
pŞy
, 3, 
fg_cŞÜ
);

1742 
	}
}

1754 
	$d¿w_th»e_dÙs
(
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1755 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
, 
CŞÜ
 *
fg_cŞÜ
)

1758 
gdoubË
 
dÙ_width
;

1759 
gdoubË
 
hŞe_width
;

1760 
gdoubË
 
Ën
;

1761 
gšt
 
i
;

1762 
Pošt
 
d–
, 
dÙ_äom
, 
dÙ_to
;

1764 
d–
 = *
to
;

1765 
	`pošt_sub
(&
d–
, 
äom
);

1766 
Ën
 = 
	`pošt_Ën
(&
d–
);

1767 
	`pošt_nÜm®ize
(&
d–
);

1769 ià(
Ën
 > 4 * 
width
)

1770 
width
 *= 2;

1771 
dÙ_width
 = 
width
 * 0.2;

1772 
hŞe_width
 = 
width
 / 3 - 
dÙ_width
;

1774 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
lšewidth
);

1775 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

1777 
i
 = 0; i < 3; i++) {

1778 
dÙ_äom
.
x
 = 
to
->x - 
i
 * (
dÙ_width
 + 
hŞe_width
è* 
d–
.x;

1779 
dÙ_äom
.
y
 = 
to
->y - 
i
 * (
dÙ_width
 + 
hŞe_width
è* 
d–
.y;

1780 
dÙ_to
.
x
 = 
to
->x - ((
i
 + 1è* 
dÙ_width
 + i * 
hŞe_width
è* 
d–
.x;

1781 
dÙ_to
.
y
 = 
to
->y - ((
i
 + 1è* 
dÙ_width
 + i * 
hŞe_width
è* 
d–
.y;

1782 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
dÙ_äom
, &
dÙ_to
, 
fg_cŞÜ
);

1784 
	}
}

1787 
	$d¿w_hŞlow_ŒŸngË
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1788 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1789 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1791 
	`fl_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
NULL
, 
bg_cŞÜ
);

1792 
	`d¿w_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
, 
NULL
);

1793 
	}
}

1795 
	$d¿w_fËd_ŒŸngË
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1796 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1797 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1799 
	`fl_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
NULL
, 
fg_cŞÜ
);

1800 
	`d¿w_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
, 
NULL
);

1801 
	}
}

1803 
	$d¿w_unfËd_ŒŸngË
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1804 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1805 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1807 
	`d¿w_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
, 
bg_cŞÜ
);

1808 
	}
}

1810 
	$d¿w_hŞlow_dŸmÚd
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1811 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1812 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1814 
	`fl_dŸmÚd
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
bg_cŞÜ
);

1815 
	`d¿w_dŸmÚd
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
);

1816 
	}
}

1818 
	$d¿w_fËd_dŸmÚd
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1819 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1820 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1822 
	`fl_dŸmÚd
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
fg_cŞÜ
);

1823 
	`d¿w_dŸmÚd
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
);

1824 
	}
}

1826 
	$d¿w_fËd_–l£
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1827 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1828 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1830 
	`d¿w_fl_–l£
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
,fg_color);

1831 
	}
}

1833 
	$d¿w_fËd_dÙ
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1834 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1835 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1837 
	`d¿w_fl_dÙ
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
,fg_color);

1838 
	}
}

1840 
	$d¿w_fËd_box
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1841 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1842 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1844 
	`d¿w_fl_box
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
,fg_color);

1845 
	}
}

1847 
	$d¿w_fËd_cÚÿve
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1848 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1849 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1851 
	`d¿w_cÚÿve_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
, fg_color);

1852 
	}
}

1854 
	$ÿlcuÏ‹_doubË_ŒŸngË
 (
Pošt
 *
pŞy
, cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
äom
,

1855 
»®
 
Ëngth
,„—È
width
)

1857 
Pošt
 
£cÚd_äom
, 
£cÚd_to
;

1859 
	`ÿlcuÏ‹_¬row
 (
pŞy
, 
to
, 
äom
, 
Ëngth
, 
width
);

1860 
	`ÿlcuÏ‹_doubË_¬row
(&
£cÚd_to
, &
£cÚd_äom
, 
to
, 
äom
, 
Ëngth
);

1861 
	`ÿlcuÏ‹_¬row
 (
pŞy
+3, &
£cÚd_to
, &
£cÚd_äom
, 
Ëngth
, 
width
);

1863 
	}
}

1865 
	$d¿w_doubË_hŞlow_ŒŸngË
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1866 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1867 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1869 
	`fl_doubË_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
+(
lšewidth
/2), 
width
,†šewidth, 
fg_cŞÜ
, 
bg_cŞÜ
);

1870 
	`d¿w_doubË_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
, 
bg_cŞÜ
);

1871 
	}
}

1873 
	$d¿w_doubË_fËd_ŒŸngË
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
to
, Pošˆ*
äom
,

1874 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1875 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1877 
	`fl_doubË_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
, fg_color);

1878 
	}
}

1879 
	sA¼owDesc
 {

1880 cÚ¡ *
	mÇme
;

1881 
A¼owTy³
 
	m’um_v®ue
;

1883 (*
	mÿlcuÏ‹
è(
Pošt
 *
	mpŞy
,

1884 cÚ¡ 
Pošt
 *
	mto
,

1885 cÚ¡ 
Pošt
 *
	mäom
,

1886 
»®
 
	mËngth
,

1887 
»®
 
	mwidth
);

1889 (*
	md¿w
è(
DŸR’d””
 *
	m»nd””
,

1890 
Pošt
 *
	mto
,

1891 
Pošt
 *
	mäom
,

1892 
»®
 
	mËngth
,

1893 
»®
 
	mwidth
,

1894 
»®
 
	mlšewidth
,

1895 
CŞÜ
 *
	mfg_cŞÜ
,

1896 
CŞÜ
 *
	mbg_cŞÜ
);

1897 } 
	g¬row_ty³s
[] =

1898 {{
N_
("NÚe"),
ARROW_NONE
},

1899 {
N_
("Lšes"),
ARROW_LINES
, 
ÿlcuÏ‹_¬row
, 
d¿w_lšes
},

1900 {
N_
("HŞlow TrŸngË"), 
ARROW_HOLLOW_TRIANGLE
, 
ÿlcuÏ‹_¬row
, 
d¿w_hŞlow_ŒŸngË
},

1901 {
N_
("FËd TrŸngË"), 
ARROW_FILLED_TRIANGLE
, 
ÿlcuÏ‹_¬row
, 
d¿w_fËd_ŒŸngË
},

1902 {
N_
("UnfËd TrŸngË"), 
ARROW_UNFILLED_TRIANGLE
, 
ÿlcuÏ‹_¬row
, 
d¿w_unfËd_ŒŸngË
},

1903 {
N_
("HŞlow DŸmÚd"),
ARROW_HOLLOW_DIAMOND
, 
ÿlcuÏ‹_dŸmÚd
, 
d¿w_hŞlow_dŸmÚd
},

1904 {
N_
("FËd DŸmÚd"),
ARROW_FILLED_DIAMOND
, 
ÿlcuÏ‹_dŸmÚd
, 
d¿w_fËd_dŸmÚd
},

1905 {
N_
("H®àDŸmÚd"), 
ARROW_HALF_DIAMOND
, 
ÿlcuÏ‹_dŸmÚd
, 
d¿w_h®f_dŸmÚd
},

1906 {
N_
("H®àH—d"), 
ARROW_HALF_HEAD
, 
ÿlcuÏ‹_h®fh—d
, 
d¿w_h®fh—d
},

1907 {
N_
("SÏshed Cross"), 
ARROW_SLASHED_CROSS
, 
ÿlcuÏ‹_¦ashed_üoss
, 
d¿w_¦ashed_üoss
},

1908 {
N_
("FËd EÎ£"), 
ARROW_FILLED_ELLIPSE
, 
ÿlcuÏ‹_–l£
, 
d¿w_fËd_–l£
},

1909 {
N_
("HŞlow EÎ£"), 
ARROW_HOLLOW_ELLIPSE
, 
ÿlcuÏ‹_–l£
, 
d¿w_fl_–l£
},

1910 {
N_
("FËd DÙ"), 
ARROW_FILLED_DOT
, 
ÿlcuÏ‹_dÙ
, 
d¿w_fËd_dÙ
},

1911 {
N_
("Dim’siÚ Origš"),
ARROW_DIMENSION_ORIGIN
},

1912 {
N_
("BÏnked DÙ"),
ARROW_BLANKED_DOT
, 
ÿlcuÏ‹_dÙ
, 
d¿w_fl_dÙ
},

1913 {
N_
("DoubË HŞlow TrŸngË"),
ARROW_DOUBLE_HOLLOW_TRIANGLE
, 
ÿlcuÏ‹_doubË_ŒŸngË
, 
d¿w_doubË_hŞlow_ŒŸngË
},

1914 {
N_
("DoubË FËd TrŸngË"),
ARROW_DOUBLE_FILLED_TRIANGLE
, 
ÿlcuÏ‹_doubË_ŒŸngË
, 
d¿w_doubË_fËd_ŒŸngË
},

1915 {
N_
("FËd DÙ‡nd TrŸngË"), 
ARROW_FILLED_DOT_N_TRIANGLE
},

1916 {
N_
("FËd Box"), 
ARROW_FILLED_BOX
, 
ÿlcuÏ‹_box
, 
d¿w_fËd_box
},

1917 {
N_
("BÏnked Box"),
ARROW_BLANKED_BOX
, 
ÿlcuÏ‹_box
, 
d¿w_fl_box
},

1918 {
N_
("SÏshed"), 
ARROW_SLASH_ARROW
, 
ÿlcuÏ‹_¦ashed
, 
d¿w_¦ashed
},

1919 {
N_
("IÁeg¿ÈSymbŞ"),
ARROW_INTEGRAL_SYMBOL
},

1920 {
N_
("Crow FoÙ"), 
ARROW_CROW_FOOT
, 
ÿlcuÏ‹_üow
, 
d¿w_üow_foÙ
},

1921 {
N_
("Cross"),
ARROW_CROSS
, 
ÿlcuÏ‹_¬row
, 
d¿w_üoss
},

1922 {
N_
("1-Ü-mªy"),
ARROW_ONE_OR_MANY
},

1923 {
N_
("0-Ü-mªy"),
ARROW_NONE_OR_MANY
},

1924 {
N_
("1-Ü-0"),
ARROW_ONE_OR_NONE
},

1925 {
N_
("1ƒxaùly"),
ARROW_ONE_EXACTLY
},

1926 {
N_
("FËd CÚÿve"),
ARROW_FILLED_CONCAVE
, 
ÿlcuÏ‹_cÚÿve
, 
d¿w_fËd_cÚÿve
},

1927 {
N_
("BÏnked CÚÿve"),
ARROW_BLANKED_CONCAVE
, 
ÿlcuÏ‹_cÚÿve
, 
d¿w_cÚÿve_ŒŸngË
},

1928 {
N_
("Round"), 
ARROW_ROUNDED
},

1929 {
N_
("O³ÀRound"), 
ARROW_OPEN_ROUNDED
},

1930 {
N_
("Back¦ash"), 
ARROW_BACKSLASH
, 
ÿlcuÏ‹_back¦ash
, 
d¿w_back¦ash
},

1931 {
N_
("Infš™Lše"),
ARROW_THREE_DOTS
},

1932 {
NULL
,0}

1944 
	$¬row_bbox
 (cÚ¡ 
A¼ow
 *
¬row
, 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
to
, cÚ¡ Pošˆ*
äom
,

1945 
ReùªgË
 *
»ù
)

1947 
Pošt
 
pŞy
[6];

1948 
PŞyBBExŒas
 
³xŒa
;

1949 
n_pošts
 = 0;

1950 
idx
 = 
	`¬row_šdex_äom_ty³
(
¬row
->
ty³
);

1952 ià(
ARROW_NONE
 =ğ
¬row
->
ty³
)

1956 ià(
¬row_ty³s
[
idx
].
ÿlcuÏ‹
)

1957 
n_pošts
 = 
¬row_ty³s
[
idx
].
	`ÿlcuÏ‹
 (
pŞy
, 
to
, 
äom
, 
¬row
->
Ëngth
,‡¼ow->
width
);

1959 
n_pošts
 = 
	`ÿlcuÏ‹_¬row
(
pŞy
, 
to
, 
äom
, 
¬row
->
Ëngth
,‡¼ow->
width
);

1960 
	`g_as£¹
 (
n_pošts
 > 0 &&‚_pošt <ğ(
pŞy
)/(
Pošt
));

1962 
³xŒa
.
¡¬t_Œªs
 =…exŒa.
’d_Œªs
 =

1963 
³xŒa
.
¡¬t_lÚg
 =…exŒa.
’d_lÚg
 =

1964 
³xŒa
.
middË_Œªs
 = 
lše_width
/2.0;

1966 
	`pŞylše_bbox
 (
pŞy
, 
n_pošts
, &
³xŒa
, 
TRUE
, 
»ù
);

1967 
	}
}

1981 
	$¬row_d¿w
(
DŸR’d””
 *
»nd””
, 
A¼owTy³
 
ty³
,

1982 
Pošt
 *
to
, Pošˆ*
äom
,

1983 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

1984 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
)

1986 
ty³
) {

1987 
ARROW_NONE
:

1989 
ARROW_DIMENSION_ORIGIN
:

1990 
	`d¿w_fl_dÙ
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
,
NULL
);

1992 
ARROW_INTEGRAL_SYMBOL
:

1993 
	`d¿w_š‹g¿l
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
);

1995 
ARROW_ONE_OR_MANY
:

1996 
	`d¿w_Úe_Ü_mªy
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
,
bg_cŞÜ
);

1998 
ARROW_NONE_OR_MANY
:

1999 
	`d¿w_nÚe_Ü_mªy
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
,
bg_cŞÜ
);

2001 
ARROW_ONE_EXACTLY
:

2002 
	`d¿w_Úe_exaùly
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
,
bg_cŞÜ
);

2004 
ARROW_ONE_OR_NONE
:

2005 
	`d¿w_Úe_Ü_nÚe
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
,
bg_cŞÜ
);

2007 
ARROW_ROUNDED
:

2008 
	`d¿w_rounded
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
, 
fg_cŞÜ
, 
bg_cŞÜ
);

2010 
ARROW_OPEN_ROUNDED
:

2011 
	`d¿w_İ’_rounded
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
,

2012 
fg_cŞÜ
, 
bg_cŞÜ
);

2014 
ARROW_FILLED_DOT_N_TRIANGLE
:

2015 
	`d¿w_fËd_dÙ_n_ŒŸngË
(
»nd””
, 
to
, 
äom
, 
Ëngth
, 
width
, 
lšewidth
,

2016 
fg_cŞÜ
, 
bg_cŞÜ
);

2018 
ARROW_THREE_DOTS
:

2019 
	`d¿w_th»e_dÙs
(
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
);

2021 
MAX_ARROW_TYPE
:

2025 
idx
 = 
	`¬row_šdex_äom_ty³
(
ty³
);

2026 
	`g_»tuº_if_ç
 (
¬row_ty³s
[
idx
].
d¿w
 !ğ
NULL
);

2027 
¬row_ty³s
[
idx
].
	`d¿w
 (
»nd””
,
to
,
äom
,
Ëngth
,
width
,
lšewidth
,
fg_cŞÜ
,
bg_cŞÜ
);

2031 ià((
ty³
 !ğ
ARROW_NONE
è&& (
»nd”_boundšg_boxes
è&& (
»nd””
->
is_š‹¿ùive
)) {

2032 
A¼ow
 
¬row
 = {
ty³
, 
Ëngth
, 
width
};

2033 
ReùªgË
 
bbox
 = {0, };

2034 
Pošt
 
p1
, 
p2
;

2035 
CŞÜ
 
cŞ
 = {1.0, 0.0, 1.0};

2037 
	`¬row_bbox
 (&
¬row
, 
lšewidth
, 
to
, 
äom
, &
bbox
);

2039 
p1
.
x
 = 
bbox
.
Ëá
;

2040 
p1
.
y
 = 
bbox
.
tİ
;

2041 
p2
.
x
 = 
bbox
.
right
;

2042 
p2
.
y
 = 
bbox
.
bÙtom
;

2044 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
(renderer,0.01);

2045 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_»ù
Ô’d””, &
p1
, &
p2
, &
cŞ
);

2047 
	}
}

2056 
	$§n™ize_¬row
(
A¼ow
 *
¬row
)

2058 ià(
¬row
->
ty³
 < 0 ||‡¼ow->ty³ > 
MAX_ARROW_TYPE
) {

2059 
	`mes§ge_w¬nšg
(
	`_
("Arrow head of unknownype"));

2060 
¬row
->
ty³
 = 
ARROW_NONE
;

2061 
¬row
->
width
 = 
DEFAULT_ARROW_WIDTH
;

2062 
¬row
->
Ëngth
 = 
DEFAULT_ARROW_LENGTH
;

2065 ià(
¬row
->
Ëngth
 < 
MIN_ARROW_DIMENSION
 ||

2066 
¬row
->
width
 < 
MIN_ARROW_DIMENSION
) {

2067 
	`mes§ge_w¬nšg
(
	`_
("Arrow head ofype %s hasoo small dimensions,„emoving.\n"),

2068 
	`¬row_g‘_Çme_äom_ty³
(
¬row
->
ty³
));

2069 
¬row
->
ty³
 = 
ARROW_NONE
;

2070 
¬row
->
width
 = 
DEFAULT_ARROW_WIDTH
;

2071 
¬row
->
Ëngth
 = 
DEFAULT_ARROW_LENGTH
;

2073 
	}
}

2083 
	$§ve_¬row
(
ObjeùNode
 
obj_node
, 
A¼ow
 *
¬row
, 
gch¬
 *
ty³_©Œibu‹
,

2084 
gch¬
 *
Ëngth_©Œibu‹
, gch¬ *
width_©Œibu‹
)

2086 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, 
ty³_©Œibu‹
),

2087 
¬row
->
ty³
);

2088 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, 
Ëngth_©Œibu‹
),

2089 
¬row
->
Ëngth
);

2090 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, 
width_©Œibu‹
),

2091 
¬row
->
width
);

2092 
	}
}

2102 
	$lßd_¬row
(
ObjeùNode
 
obj_node
, 
A¼ow
 *
¬row
, 
gch¬
 *
ty³_©Œibu‹
,

2103 
gch¬
 *
Ëngth_©Œibu‹
, gch¬ *
width_©Œibu‹
)

2105 
A‰ribu‹Node
 
©Œ
;

2107 
¬row
->
ty³
 = 
ARROW_NONE
;

2108 
¬row
->
Ëngth
 = 
DEFAULT_ARROW_LENGTH
;

2109 
¬row
->
width
 = 
DEFAULT_ARROW_WIDTH
;

2110 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
ty³_©Œibu‹
);

2111 ià(
©Œ
 !ğ
NULL
)

2112 
¬row
->
ty³
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

2113 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
Ëngth_©Œibu‹
);

2114 ià(
©Œ
 !ğ
NULL
)

2115 
¬row
->
Ëngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

2116 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
width_©Œibu‹
);

2117 ià(
©Œ
 !ğ
NULL
)

2118 
¬row
->
width
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

2120 
	`§n™ize_¬row
(
¬row
);

2121 
	}
}

2128 
A¼owTy³


2129 
	$¬row_ty³_äom_Çme
(cÚ¡ 
gch¬
 *
Çme
)

2131 
i
;

2132 
i
 = 0; 
¬row_ty³s
[i].
Çme
 !ğ
NULL
; i++) {

2133 ià(!
	`¡rcmp
(
¬row_ty³s
[
i
].
Çme
,‚ame)) {

2134  
¬row_ty³s
[
i
].
’um_v®ue
;

2137 
	`´štf
("UnknowÀ¬rowy³ %s\n", 
Çme
);

2139 
	}
}

2146 
gšt


2147 
	$¬row_šdex_äom_ty³
(
A¼owTy³
 
©y³
)

2149 
i
 = 0;

2151 
i
 = 0; 
¬row_ty³s
[i].
Çme
 !ğ
NULL
; i++) {

2152 ià(
¬row_ty³s
[
i
].
’um_v®ue
 =ğ
©y³
) {

2153  
i
;

2156 
	`´štf
("Cª'ˆfšd‡¼ow index fÜy³ %d\n", 
©y³
);

2158 
	}
}

2163 
A¼owTy³


2164 
	$¬row_ty³_äom_šdex
 (
gšt
 
šdex
)

2166 ià(
šdex
 >ğ0 && index < 
MAX_ARROW_TYPE
) {

2167  
¬row_ty³s
[
šdex
].
’um_v®ue
;

2169  
MAX_ARROW_TYPE
;

2170 
	}
}

2176 
GLi¡
 *

2177 
	$g‘_¬row_Çmes
()

2179 
i
 = 0;

2180 
GLi¡
 *
¬rows
 = 
NULL
;

2182 
i
 = 0; 
¬row_ty³s
[i].
Çme
 !ğ
NULL
; i++) {

2183 
¬rows
 = 
	`g_li¡_­³nd
×¼ows, (*)
¬row_ty³s
[
i
].
Çme
);

2185  
¬rows
;

2186 
	}
}

2194 cÚ¡ 
gch¬
 *

2195 
	$¬row_g‘_Çme_äom_ty³
(
A¼owTy³
 
ty³
)

2197 ià(
ty³
 >ğ0 &&y³ < 
MAX_ARROW_TYPE
) {

2198  
¬row_ty³s
[
	`¬row_šdex_äom_ty³
(
ty³
)].
Çme
;

2200  
	`_
("unknown‡rrow");

2201 
	}
}

	@O:\tool\dvs50\lib\arrows.h

18 #iâdeà
ARROWS_H


19 
	#ARROWS_H


	)

21 
	~"dŸty³s.h
"

22 
	~"geom‘ry.h
"

23 
	~"cŞÜ.h
"

24 
	~"dŸ_xml.h
"

32 
	mARROW_NONE
 = 0,

33 
	mARROW_LINES
,

34 
	mARROW_HOLLOW_TRIANGLE
,

35 
	mARROW_FILLED_TRIANGLE
,

36 
	mARROW_HOLLOW_DIAMOND
,

37 
	mARROW_FILLED_DIAMOND
,

38 
	mARROW_HALF_HEAD
,

39 
	mARROW_SLASHED_CROSS
,

40 
	mARROW_FILLED_ELLIPSE
,

41 
	mARROW_HOLLOW_ELLIPSE
,

42 
	mARROW_DOUBLE_HOLLOW_TRIANGLE
,

43 
	mARROW_DOUBLE_FILLED_TRIANGLE
,

44 
	mARROW_UNFILLED_TRIANGLE
,

45 
	mARROW_FILLED_DOT
,

46 
	mARROW_DIMENSION_ORIGIN
,

47 
	mARROW_BLANKED_DOT
,

48 
	mARROW_FILLED_BOX
,

49 
	mARROW_BLANKED_BOX
,

50 
	mARROW_SLASH_ARROW
,

51 
	mARROW_INTEGRAL_SYMBOL
,

52 
	mARROW_CROW_FOOT
,

53 
	mARROW_CROSS
,

54 
	mARROW_FILLED_CONCAVE
,

55 
	mARROW_BLANKED_CONCAVE
,

56 
	mARROW_ROUNDED
,

57 
	mARROW_HALF_DIAMOND
,

58 
	mARROW_OPEN_ROUNDED
,

59 
	mARROW_FILLED_DOT_N_TRIANGLE
,

60 
	mARROW_ONE_OR_MANY
,

61 
	mARROW_NONE_OR_MANY
,

62 
	mARROW_ONE_OR_NONE
,

63 
	mARROW_ONE_EXACTLY
,

64 
	mARROW_BACKSLASH
,

65 
	mARROW_THREE_DOTS
,

67 
	mMAX_ARROW_TYPE


68 } 
	tA¼owTy³
;

76 
	#DEFAULT_ARROW_SIZE
 0.5

	)

81 
	#MIN_ARROW_DIMENSION
 0.001

	)

83 
	s_A¼ow
 {

84 
A¼owTy³
 
	mty³
;

85 
»®
 
	mËngth
;

86 
»®
 
	mwidth
;

90 
	$__deş¥ec
(
dÎexpÜt
è
	`¬row_d¿w
(
DŸR’d””
 *
»nd””
, 
A¼owTy³
 
ty³
,

91 
Pošt
 *
to
, Pošˆ*
äom
,

92 
»®
 
Ëngth
,„—È
width
,„—È
lšewidth
,

93 
CŞÜ
 *
fg_cŞÜ
, CŞÜ *
bg_cŞÜ
);

97 
	$__deş¥ec
(
dÎexpÜt
è
	`¬row_bbox
 (cÚ¡ 
A¼ow
 *
¬row
, 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
to
, cÚ¡ Pošˆ*
äom
,

98 
ReùªgË
 *
»ù
);

100 
	$__deş¥ec
(
dÎexpÜt
) 

101 
	`ÿlcuÏ‹_¬row_pošt
(cÚ¡ 
A¼ow
 *
¬row
, cÚ¡ 
Pošt
 *
to
, cÚ¡ Pošˆ*
äom
,

102 
Pošt
 *
move_¬row
, Pošˆ*
move_lše
,

103 
»®
 
lšewidth
);

105 
DIAVAR
 
	`§ve_¬row
(
ObjeùNode
 
obj_node
, 
A¼ow
 *
¬row
, 
gch¬
 *
ty³_©Œibu‹
,

106 
gch¬
 *
Ëngth_©Œibu‹
, gch¬ *
width_©Œibu‹
);

107 
DIAVAR
 
	`lßd_¬row
(
ObjeùNode
 
obj_node
, 
A¼ow
 *
¬row
, 
gch¬
 *
ty³_©Œibu‹
,

108 
gch¬
 *
Ëngth_©Œibu‹
, gch¬ *
width_©Œibu‹
);

111 
DIAVAR
 
A¼owTy³
 
	`¬row_ty³_äom_Çme
(cÚ¡ 
gch¬
 *
Çme
);

113 
gšt
 
	`¬row_šdex_äom_ty³
(
A¼owTy³
 
ty³
);

114 
A¼owTy³
 
	`¬row_ty³_äom_šdex
(
gšt
 
šdex
);

115 
DIAVAR
 cÚ¡ 
gch¬
 *
	`¬row_g‘_Çme_äom_ty³
(
A¼owTy³
 
ty³
);

116 
DIAVAR
 
GLi¡
 *
	`g‘_¬row_Çmes
();

	@O:\tool\dvs50\lib\attributes.c

18 
	~<cÚfig.h
>

20 
	~"©Œibu‹s.h
"

21 
	~"š.h
"

22 
	~"³rsi¡’û.h
"

24 
CŞÜ
 
	g©Œibu‹s_fÜeground
 = { 0.0f, 0.0f, 0.0f };

25 
CŞÜ
 
	g©Œibu‹s_background
 = { 1.0f, 1.0f, 1.0f };

27 
»®
 
	g©Œibu‹s_deçuÉ_lšewidth
 = 0.1;

29 
A¼ow
 
	g©Œibu‹s_¡¬t_¬row
 = { 
ARROW_NONE
,

30 
DEFAULT_ARROW_SIZE
,

31 
DEFAULT_ARROW_SIZE
 };

32 
A¼ow
 
	g©Œibu‹s_’d_¬row
 = { 
ARROW_FILLED_CONCAVE
,

33 
DEFAULT_ARROW_SIZE
,

34 
DEFAULT_ARROW_SIZE
 };

36 
LšeStyË
 
	g©Œibu‹s_lše¡yË
 = 
LINESTYLE_SOLID
;

37 
»®
 
	g©Œibu‹s_dash_Ëngth
 = 1.0;

39 
DŸFÚt
 *
	g©Œibu‹s_fÚt
 = 
NULL
;

40 
»®
 
	g©Œibu‹s_fÚt_height
 = 0.8;

45 
CŞÜ


46 
	$©Œibu‹s_g‘_fÜeground
()

48  
©Œibu‹s_fÜeground
;

49 
	}
}

54 
CŞÜ


55 
	$©Œibu‹s_g‘_background
()

57  
©Œibu‹s_background
;

58 
	}
}

65 
	$©Œibu‹s_£t_fÜeground
(
CŞÜ
 *
cŞÜ
)

67 
©Œibu‹s_fÜeground
 = *
cŞÜ
;

68 
	`³rsi¡’û_£t_cŞÜ
("fg_cŞÜ", 
cŞÜ
);

69 
	}
}

76 
	$©Œibu‹s_£t_background
(
CŞÜ
 *
cŞÜ
)

78 
©Œibu‹s_background
 = *
cŞÜ
;

79 
	`³rsi¡’û_£t_cŞÜ
("bg_cŞÜ", 
cŞÜ
);

80 
	}
}

85 
	$©Œibu‹s_sw­_fgbg
()

87 
CŞÜ
 
‹mp
;

88 
‹mp
 = 
©Œibu‹s_fÜeground
;

89 
	`©Œibu‹s_£t_fÜeground
(&
©Œibu‹s_background
);

90 
	`©Œibu‹s_£t_background
(&
‹mp
);

91 
	}
}

96 
	$©Œibu‹s_deçuÉ_fgbg
()

98 
	`©Œibu‹s_£t_fÜeground
(&
cŞÜ_bÏck
);

99 
	`©Œibu‹s_£t_background
(&
cŞÜ_wh™e
);

100 
	}
}

106 
»®


107 
	$©Œibu‹s_g‘_deçuÉ_lšewidth
()

109  
©Œibu‹s_deçuÉ_lšewidth
;

110 
	}
}

116 
	$©Œibu‹s_£t_deçuÉ_lšewidth
(
»®
 
width
)

118 
©Œibu‹s_deçuÉ_lšewidth
 = 
width
;

119 
	`³rsi¡’û_£t_»®
("lšewidth", 
width
);

120 
	}
}

125 
A¼ow


126 
	$©Œibu‹s_g‘_deçuÉ_¡¬t_¬row
()

128  
©Œibu‹s_¡¬t_¬row
;

129 
	}
}

135 
	$©Œibu‹s_£t_deçuÉ_¡¬t_¬row
(
A¼ow
 
¬row
)

137 
©Œibu‹s_¡¬t_¬row
 = 
¬row
;

138 
	`³rsi¡’û_£t_¡ršg
("start-arrow-type",

139 
	`¬row_g‘_Çme_äom_ty³
(
¬row
.
ty³
));

140 
	`³rsi¡’û_£t_»®
("¡¬t-¬row-width", 
¬row
.
width
);

141 
	`³rsi¡’û_£t_»®
("¡¬t-¬row-Ëngth", 
¬row
.
Ëngth
);

142 
	}
}

147 
A¼ow


148 
	$©Œibu‹s_g‘_deçuÉ_’d_¬row
()

150  
©Œibu‹s_’d_¬row
;

151 
	}
}

157 
	$©Œibu‹s_£t_deçuÉ_’d_¬row
(
A¼ow
 
¬row
)

159 
©Œibu‹s_’d_¬row
 = 
¬row
;

160 
	`³rsi¡’û_£t_¡ršg
("end-arrow-type",

161 
	`¬row_g‘_Çme_äom_ty³
(
¬row
.
ty³
));

162 
	`³rsi¡’û_£t_»®
("’d-¬row-width", 
¬row
.
width
);

163 
	`³rsi¡’û_£t_»®
("’d-¬row-Ëngth", 
¬row
.
Ëngth
);

164 
	}
}

173 
	$©Œibu‹s_g‘_deçuÉ_lše_¡yË
(
LšeStyË
 *
¡yË
, 
»®
 *
dash_Ëngth
)

175 ià(
¡yË
)

176 *
¡yË
 = 
©Œibu‹s_lše¡yË
;

177 ià(
dash_Ëngth
)

178 *
dash_Ëngth
 = 
©Œibu‹s_dash_Ëngth
;

179 
	}
}

187 
	$©Œibu‹s_£t_deçuÉ_lše_¡yË
(
LšeStyË
 
¡yË
, 
»®
 
dash_Ëngth
)

189 
©Œibu‹s_lše¡yË
 = 
¡yË
;

190 
©Œibu‹s_dash_Ëngth
 = 
dash_Ëngth
;

191 
	`³rsi¡’û_£t_š‹g”
("lše-¡yË", 
¡yË
);

192 
	`³rsi¡’û_£t_»®
("dash-Ëngth", 
dash_Ëngth
);

193 
	}
}

201 
	$©Œibu‹s_g‘_deçuÉ_fÚt
(
DŸFÚt
 **
fÚt
, 
»®
 *
fÚt_height
)

203 ià(!
©Œibu‹s_fÚt
) {

204 
©Œibu‹s_fÚt
 = 
	`dŸ_fÚt_Ãw_äom_¡yË
(
DIA_FONT_SANS
,

205 
©Œibu‹s_fÚt_height
);

207 ià(
fÚt
)

208 *
fÚt
 = 
	`dŸ_fÚt_»f
(
©Œibu‹s_fÚt
);

209 ià(
fÚt_height
)

210 *
fÚt_height
 = 
©Œibu‹s_fÚt_height
;

211 
	}
}

220 
	$©Œibu‹s_£t_deçuÉ_fÚt
(
DŸFÚt
 *
fÚt
, 
»®
 
fÚt_height
)

222 ià(
©Œibu‹s_fÚt
 !ğ
NULL
)

223 
	`dŸ_fÚt_uÄef
(
©Œibu‹s_fÚt
);

224 
©Œibu‹s_fÚt
 = 
	`dŸ_fÚt_»f
(
fÚt
);

225 
©Œibu‹s_fÚt_height
 = 
fÚt_height
;

226 
	}
}

	@O:\tool\dvs50\lib\attributes.h

18 #iâdeà
ATTRIBUTES_H


19 
	#ATTRIBUTES_H


	)

21 
	~"dŸ-’ums.h
"

22 
	~"geom‘ry.h
"

23 
	~"cŞÜ.h
"

24 
	~"¬rows.h
"

25 
	~"fÚt.h
"

27 
DIAVAR
 
CŞÜ
 
©Œibu‹s_g‘_fÜeground
();

28 
DIAVAR
 
CŞÜ
 
©Œibu‹s_g‘_background
();

29 
DIAVAR
 
©Œibu‹s_£t_fÜeground
(
CŞÜ
 *
cŞÜ
);

30 
DIAVAR
 
©Œibu‹s_£t_background
(
CŞÜ
 *
cŞÜ
);

31 
DIAVAR
 
©Œibu‹s_sw­_fgbg
();

32 
DIAVAR
 
©Œibu‹s_deçuÉ_fgbg
();

33 
DIAVAR
 
»®
 
©Œibu‹s_g‘_deçuÉ_lšewidth
();

34 
DIAVAR
 
©Œibu‹s_£t_deçuÉ_lšewidth
(
»®
 
width
);

36 
DIAVAR
 
A¼ow
 
©Œibu‹s_g‘_deçuÉ_¡¬t_¬row
();

37 
DIAVAR
 
©Œibu‹s_£t_deçuÉ_¡¬t_¬row
(
A¼ow
 
¬row
);

39 
DIAVAR
 
A¼ow
 
©Œibu‹s_g‘_deçuÉ_’d_¬row
();

40 
DIAVAR
 
©Œibu‹s_£t_deçuÉ_’d_¬row
(
A¼ow
 
¬row
);

42 
DIAVAR
 
©Œibu‹s_g‘_deçuÉ_lše_¡yË
(
LšeStyË
 *
¡yË
, 
»®
 *
dash_Ëngth
);

43 
DIAVAR
 
©Œibu‹s_£t_deçuÉ_lše_¡yË
(
LšeStyË
 
¡yË
, 
»®
 
dash_Ëngth
);

45 
DIAVAR
 
©Œibu‹s_g‘_deçuÉ_fÚt
(
DŸFÚt
 **
fÚt
, 
»®
 *
fÚt_height
);

46 
DIAVAR
 
©Œibu‹s_£t_deçuÉ_fÚt
(
DŸFÚt
 *
fÚt
, 
»®
 
fÚt_height
);

	@O:\tool\dvs50\lib\autoroute.c

22 
	~"cÚfig.h
"

24 
	~"objeù.h
"

25 
	~"cÚÃùiÚpošt.h
"

26 
	~"Üth_cÚn.h
"

27 
	~"autÜou‹.h
"

29 
	#MAX_BADNESS
 10000.0

	)

31 
	#MIN_DIST
 1.0

	)

33 
	#MAX_SMALL_BADNESS
 10.0

	)

35 
	#EXTRA_SEGMENT_BADNESS
 10.0

	)

37 
»®
 
ÿlcuÏ‹_badÃss
(
Pošt
 *
ps
, 
gušt
 
num_pošts
);

39 
»®
 
autÜou‹_Ïyout_·¿Î–
(
Pošt
 *
to
,

40 
gušt
 *
num_pošts
, 
Pošt
 **
pošts
);

41 
»®
 
autÜou‹_Ïyout_ÜthogÚ®
(
Pošt
 *
to
,

42 
’ddœ
,

43 
gušt
 *
num_pošts
, 
Pošt
 **
pošts
);

44 
»®
 
autÜou‹_Ïyout_İpos™e
(
Pošt
 *
to
,

45 
gušt
 *
num_pošts
, 
Pošt
 **
pošts
);

46 
Pošt
 
autŞayout_adju¡_fÜ_g­
(Pošˆ*
pos
, 
dœ
, 
CÚÃùiÚPošt
 *
ı
);

47 
autŞayout_adju¡_fÜ_¬row
(
Pošt
 *
pos
, 
dœ
, 
»®
 
adju¡
);

48 
gušt
 
autŞayout_nÜm®ize_pošts
(gušˆ
¡¬tdœ
, gušˆ
’ddœ
,

49 
Pošt
 
¡¬t
, Pošˆ
’d
,

50 
Pošt
 *
Ãw’d
);

51 
Pošt
 *
autŞayout_uÂÜm®ize_pošts
(
gušt
 
dœ
,

52 
Pošt
 
¡¬t
,

53 
Pošt
 *
pošts
,

54 
gušt
 
num_pošts
);

68 
gboŞ—n


69 
	$autÜou‹_Ïyout_ÜthcÚn
(
O¹hCÚn
 *
cÚn
,

70 
CÚÃùiÚPošt
 *
¡¬tcÚn
, CÚÃùiÚPošˆ*
’dcÚn
)

72 
»®
 
mš_badÃss
 = 
MAX_BADNESS
;

73 
Pošt
 *
be¡_Ïyout
 = 
NULL
;

74 
gušt
 
be¡_num_pošts
 = 0;

75 
¡¬tdœ
, 
’ddœ
;

77 
äomdœ
, 
todœ
;

78 
Pošt
 
äompos
, 
tİos
;

80 
äompos
 = 
cÚn
->
pošts
[0];

81 
tİos
 = 
cÚn
->
pošts
[cÚn->
numpošts
-1];

82 ià(
¡¬tcÚn
 !ğ
NULL
) {

83 
äomdœ
 = 
¡¬tcÚn
->
dœeùiÚs
;

84 
äompos
 = 
¡¬tcÚn
->
pos
;

86 
äomdœ
 = 
DIR_NORTH
|
DIR_EAST
|
DIR_SOUTH
|
DIR_WEST
;

87 ià(
’dcÚn
 !ğ
NULL
) {

88 
todœ
 = 
’dcÚn
->
dœeùiÚs
;

89 
tİos
 = 
’dcÚn
->
pos
;

91 
todœ
 = 
DIR_NORTH
|
DIR_EAST
|
DIR_SOUTH
|
DIR_WEST
;

93 
¡¬tdœ
 = 
DIR_NORTH
; s¹dœ <ğ
DIR_WEST
; startdir *= 2) {

94 
’ddœ
 = 
DIR_NORTH
;ƒnddœ <ğ
DIR_WEST
;ƒnddir *= 2) {

95 ià((
äomdœ
 & 
¡¬tdœ
) &&

96 (
todœ
 & 
’ddœ
)) {

97 
»®
 
this_badÃss
;

98 
Pošt
 *
this_Ïyout
 = 
NULL
;

99 
gušt
 
this_num_pošts
;

100 
gušt
 
nÜm®_’ddœ
;

101 
Pošt
 
¡¬ošt
, 
’dpošt
;

102 
Pošt
 
Ùh”pošt
;

103 
¡¬ošt
 = 
	`autŞayout_adju¡_fÜ_g­
(&
äompos
, 
¡¬tdœ
, 
¡¬tcÚn
);

104 
	`autŞayout_adju¡_fÜ_¬row
(&
¡¬ošt
, 
¡¬tdœ
, 
cÚn
->
exŒa_¥acšg
.
¡¬t_Œªs
);

105 
’dpošt
 = 
	`autŞayout_adju¡_fÜ_g­
(&
tİos
, 
’ddœ
, 
’dcÚn
);

106 
	`autŞayout_adju¡_fÜ_¬row
(&
’dpošt
, 
’ddœ
, 
cÚn
->
exŒa_¥acšg
.
’d_Œªs
);

115 
nÜm®_’ddœ
 = 
	`autŞayout_nÜm®ize_pošts
(
¡¬tdœ
, 
’ddœ
,

116 
¡¬ošt
, 
’dpošt
,

117 &
Ùh”pošt
);

118 ià(
nÜm®_’ddœ
 =ğ
DIR_NORTH
 ) {

119 
this_badÃss
 = 
	`autÜou‹_Ïyout_·¿Î–
(&
Ùh”pošt
,

120 &
this_num_pošts
,

121 &
this_Ïyout
);

122 } ià(
nÜm®_’ddœ
 =ğ
DIR_SOUTH
) {

123 
this_badÃss
 = 
	`autÜou‹_Ïyout_İpos™e
(&
Ùh”pošt
,

124 &
this_num_pošts
,

125 &
this_Ïyout
);

127 
this_badÃss
 = 
	`autÜou‹_Ïyout_ÜthogÚ®
(&
Ùh”pošt
,

128 
nÜm®_’ddœ
,

129 &
this_num_pošts
,

130 &
this_Ïyout
);

132 ià(
this_Ïyout
 !ğ
NULL
) {

133 ià(
this_badÃss
-
mš_badÃss
 < -0.00001) {

138 
mš_badÃss
 = 
this_badÃss
;

139 ià(
be¡_Ïyout
 !ğ
NULL
è
	`g_ä“
(best_layout);

140 
be¡_Ïyout
 = 
	`autŞayout_uÂÜm®ize_pošts
(
¡¬tdœ
, 
¡¬ošt
,

141 
this_Ïyout
,

142 
this_num_pošts
);

143 
be¡_num_pošts
 = 
this_num_pošts
;

145 
	`autŞayout_adju¡_fÜ_¬row
(&
be¡_Ïyout
[0], 
¡¬tdœ
,

146 -
cÚn
->
exŒa_¥acšg
.
¡¬t_Œªs
);

147 
	`autŞayout_adju¡_fÜ_¬row
(&
be¡_Ïyout
[
be¡_num_pošts
-1], 
’ddœ
,

148 -
cÚn
->
exŒa_¥acšg
.
’d_Œªs
);

150 
	`g_ä“
(
this_Ïyout
);

157 ià(
mš_badÃss
 < 
MAX_BADNESS
) {

158 
	`ÜthcÚn_£t_pošts
(
cÚn
, 
be¡_num_pošts
, 
be¡_Ïyout
);

159 
	`g_ä“
(
be¡_Ïyout
);

160  
TRUE
;

162 
	`g_ä“
(
be¡_Ïyout
);

163  
FALSE
;

165 
	}
}

172 
»®


173 
	$Ëngth_badÃss
(
»®
 
Ën
)

175 ià(
Ën
 < 
MIN_DIST
) {

177  2*
MAX_SMALL_BADNESS
/(1.0+
Ën
/
MIN_DIST
) - MAX_SMALL_BADNESS;

179  
Ën
-
MIN_DIST
;

181 
	}
}

190 
»®


191 
	$ÿlcuÏ‹_badÃss
(
Pošt
 *
ps
, 
gušt
 
num_pošts
)

193 
»®
 
badÃss
;

194 
gušt
 
i
;

195 
badÃss
 = (
num_pošts
-1)*
EXTRA_SEGMENT_BADNESS
;

196 
i
 = 0; i < 
num_pošts
-1; i++) {

197 
»®
 
this_badÃss
;

198 
»®
 
Ën
 = 
	`di¡ªû_pošt_pošt_mªh©n
(&
ps
[
i
], &ps[i+1]);

199 
this_badÃss
 = 
	`Ëngth_badÃss
(
Ën
);

200 
badÃss
 +ğ
this_badÃss
;

202  
badÃss
;

203 
	}
}

212 
Pošt


213 
	$autŞayout_adju¡_fÜ_g­
(
Pošt
 *
pos
, 
dœ
, 
CÚÃùiÚPošt
 *
ı
)

215 
DŸObjeù
 *
objeù
;

216 
Pošt
 
dœ_Ùh”
;

219 ià(!
	`cÚÅošt_is_autog­
(
ı
)) {

220  *
pos
;

223 
objeù
 = 
ı
->object;

225 
dœ_Ùh”
.
x
 = 
pos
->x;

226 
dœ_Ùh”
.
y
 = 
pos
->y;

227 
dœ
) {

228 
DIR_NORTH
:

229 
dœ_Ùh”
.
y
 +ğ2 * (
objeù
->
boundšg_box
.
tİ
 - 
pos
->y);

231 
DIR_SOUTH
:

232 
dœ_Ùh”
.
y
 +ğ2 * (
objeù
->
boundšg_box
.
bÙtom
 - 
pos
->y);

234 
DIR_EAST
:

235 
dœ_Ùh”
.
x
 +ğ2 * (
objeù
->
boundšg_box
.
right
 - 
pos
->x);

237 
DIR_WEST
:

238 
dœ_Ùh”
.
x
 +ğ2 * (
objeù
->
boundšg_box
.
Ëá
 - 
pos
->x);

241 
	`g_w¬nšg
("ImpossibË dœeùiÚ %d\n", 
dœ
);

243  
	`ÿlcuÏ‹_objeù_edge
(
pos
, &
dœ_Ùh”
, 
objeù
);

244 
	}
}

255 
	$autŞayout_adju¡_fÜ_¬row
(
Pošt
 *
pos
, 
dœ
, 
»®
 
adju¡
)

257 
dœ
) {

258 
DIR_NORTH
:

259 
pos
->
y
 -ğ
adju¡
;

261 
DIR_EAST
:

262 
pos
->
x
 +ğ
adju¡
;

264 
DIR_SOUTH
:

265 
pos
->
y
 +ğ
adju¡
;

267 
DIR_WEST
:

268 
pos
->
x
 -ğ
adju¡
;

271 
	}
}

282 
»®


283 
	$autÜou‹_Ïyout_·¿Î–
(
Pošt
 *
to
, 
gušt
 *
num_pošts
, Pošˆ**
pošts
)

285 
Pošt
 *
ps
 = 
NULL
;

286 ià(
	`çbs
(
to
->
x
è> 
MIN_DIST
) {

287 
»®
 
tİ
 = 
	`MIN
(-
MIN_DIST
, 
to
->
y
-MIN_DIST);

291 *
num_pošts
 = 4;

292 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

294 
ps
[1].
y
 = 
tİ
;

295 
ps
[2].
x
 = 
to
->x;

296 
ps
[2].
y
 = 
tİ
;

297 
ps
[3] = *
to
;

298 } ià(
to
->
y
 > 0) {

299 
»®
 
tİ
 = -
MIN_DIST
;

300 
»®
 
off
 = 
to
->
x
+
MIN_DIST
*(to->x>0?1.0:-1.0);

301 
»®
 
bÙtom
 = 
to
->
y
-
MIN_DIST
;

305 *
num_pošts
 = 6;

306 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

308 
ps
[1].
y
 = 
tİ
;

309 
ps
[2].
x
 = 
off
;

310 
ps
[2].
y
 = 
tİ
;

311 
ps
[3].
x
 = 
off
;

312 
ps
[3].
y
 = 
bÙtom
;

313 
ps
[4].
x
 = 
to
->x;

314 
ps
[4].
y
 = 
bÙtom
;

315 
ps
[5] = *
to
;

317 
»®
 
tİ
 = 
to
->
y
-
MIN_DIST
;

318 
»®
 
off
 = 
MIN_DIST
*(
to
->
x
>0?-1.0:1.0);

319 
»®
 
bÙtom
 = -
MIN_DIST
;

323 *
num_pošts
 = 6;

324 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

326 
ps
[1].
y
 = 
bÙtom
;

327 
ps
[2].
x
 = 
off
;

328 
ps
[2].
y
 = 
bÙtom
;

329 
ps
[3].
x
 = 
off
;

330 
ps
[3].
y
 = 
tİ
;

331 
ps
[4].
x
 = 
to
->x;

332 
ps
[4].
y
 = 
tİ
;

333 
ps
[5] = *
to
;

335 *
pošts
 = 
ps
;

336  
	`ÿlcuÏ‹_badÃss
(
ps
, *
num_pošts
);

337 
	}
}

349 
»®


350 
	$autÜou‹_Ïyout_ÜthogÚ®
(
Pošt
 *
to
, 
’ddœ
,

351 
gušt
 *
num_pošts
, 
Pošt
 **
pošts
)

354 
Pošt
 *
ps
 = 
NULL
;

355 
»®
 
dœmuÉ
 = (
’ddœ
==
DIR_WEST
?1.0:-1.0);

356 ià(
to
->
y
 < -
MIN_DIST
) {

357 ià(
dœmuÉ
*
to
->
x
 > 
MIN_DIST
) {

361 *
num_pošts
 = 3;

362 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

364 
ps
[1].
y
 = 
to
->y;

365 
ps
[2] = *
to
;

367 
»®
 
off
;

368 ià(
dœmuÉ
*
to
->
x
 > 0è
off
 = -dœmuÉ*
MIN_DIST
;

369 
off
 = -
dœmuÉ
*(
MIN_DIST
+
	`çbs
(
to
->
x
));

370 *
num_pošts
 = 5;

371 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

372 
ps
[1].
y
 = -
MIN_DIST
;

373 
ps
[2].
x
 = 
off
;

374 
ps
[2].
y
 = -
MIN_DIST
;

375 
ps
[3].
x
 = 
off
;

376 
ps
[3].
y
 = 
to
->y;

377 
ps
[4] = *
to
;

380 ià(
dœmuÉ
*
to
->
x
 > 2*
MIN_DIST
) {

381 
»®
 
mid
 = 
to
->
x
/2;

382 *
num_pošts
 = 5;

383 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

384 
ps
[1].
y
 = -
MIN_DIST
;

385 
ps
[2].
x
 = 
mid
;

386 
ps
[2].
y
 = -
MIN_DIST
;

387 
ps
[3].
x
 = 
mid
;

388 
ps
[3].
y
 = 
to
->y;

389 
ps
[4] = *
to
;

391 
»®
 
off
;

392 ià(
dœmuÉ
*
to
->
x
 > 0è
off
 = -dœmuÉ*
MIN_DIST
;

393 
off
 = -
dœmuÉ
*(
MIN_DIST
+
	`çbs
(
to
->
x
));

394 *
num_pošts
 = 5;

395 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

396 
ps
[1].
y
 = -
MIN_DIST
;

397 
ps
[2].
x
 = 
off
;

398 
ps
[2].
y
 = -
MIN_DIST
;

399 
ps
[3].
x
 = 
off
;

400 
ps
[3].
y
 = 
to
->y;

401 
ps
[4] = *
to
;

407 *
pošts
 = 
ps
;

408  
	`ÿlcuÏ‹_badÃss
(
ps
, *
num_pošts
);

409 
	}
}

420 
»®


421 
	$autÜou‹_Ïyout_İpos™e
(
Pošt
 *
to
, 
gušt
 *
num_pošts
, Pošˆ**
pošts
)

423 
Pošt
 *
ps
 = 
NULL
;

424 ià(
to
->
y
 < -
MIN_DIST
) {

425 *
num_pošts
 = 4;

426 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

427 ià(
	`çbs
(
to
->
x
) < 0.00000001) {

428 
ps
[2] =…s[3] = *
to
;

429 *
pošts
 = 
ps
;

430  
	`Ëngth_badÃss
(
	`çbs
(
to
->
y
))+2*
EXTRA_SEGMENT_BADNESS
;

432 
»®
 
mid
 = 
to
->
y
/2;

437 
ps
[1].
y
 = 
mid
;

438 
ps
[2].
x
 = 
to
->x;

439 
ps
[2].
y
 = 
mid
;

440 
ps
[3] = *
to
;

441 *
pošts
 = 
ps
;

442  2*
	`Ëngth_badÃss
(
	`çbs
(
mid
))+2*
EXTRA_SEGMENT_BADNESS
;

444 } ià(
	`çbs
(
to
->
x
è> 2*
MIN_DIST
) {

445 
»®
 
mid
 = 
to
->
x
/2;

449 *
num_pošts
 = 6;

450 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

452 
ps
[1].
y
 = -
MIN_DIST
;

453 
ps
[2].
x
 = 
mid
;

454 
ps
[2].
y
 = -
MIN_DIST
;

455 
ps
[3].
x
 = 
mid
;

456 
ps
[3].
y
 = 
to
->y+
MIN_DIST
;

457 
ps
[4].
x
 = 
to
->x;

458 
ps
[4].
y
 = 
to
->y+
MIN_DIST
;

459 
ps
[5] = *
to
;

461 
»®
 
off
 = 
MIN_DIST
*(
to
->
x
>0?-1.0:1.0);

465 *
num_pošts
 = 6;

466 
ps
 = 
	`g_Ãw0
(
Pošt
, *
num_pošts
);

467 
ps
[1].
y
 = -
MIN_DIST
;

468 
ps
[2].
x
 = 
off
;

469 
ps
[2].
y
 = -
MIN_DIST
;

470 
ps
[3].
x
 = 
off
;

471 
ps
[3].
y
 = 
to
->y+
MIN_DIST
;

472 
ps
[4].
x
 = 
to
->x;

473 
ps
[4].
y
 = 
to
->y+
MIN_DIST
;

474 
ps
[5] = *
to
;

476 *
pošts
 = 
ps
;

477  
	`ÿlcuÏ‹_badÃss
(
ps
, *
num_pošts
);

478 
	}
}

484 
	$pošt_rÙ©e_cw
(
Pošt
 *
p
)

486 
»®
 
tmp
 = 
p
->
x
;

487 
p
->
x
 = -p->
y
;

488 
p
->
y
 = 
tmp
;

489 
	}
}

495 
	$pošt_rÙ©e_ccw
(
Pošt
 *
p
)

497 
»®
 
tmp
 = 
p
->
x
;

498 
p
->
x
 =…->
y
;

499 
p
->
y
 = -
tmp
;

500 
	}
}

506 
	$pošt_rÙ©e_180
(
Pošt
 *
p
)

508 
p
->
x
 = -p->x;

509 
p
->
y
 = -p->y;

510 
	}
}

521 
gušt


522 
	$autŞayout_nÜm®ize_pošts
(
gušt
 
¡¬tdœ
, gušˆ
’ddœ
,

523 
Pošt
 
¡¬t
, Pošˆ
’d
, Pošˆ*
Ãw’d
)

525 
Ãw’d
->
x
 = 
’d
.x-
¡¬t
.x;

526 
Ãw’d
->
y
 = 
’d
.y-
¡¬t
.y;

527 ià(
¡¬tdœ
 =ğ
DIR_NORTH
) {

528  
’ddœ
;

529 } ià(
¡¬tdœ
 =ğ
DIR_EAST
) {

530 
	`pošt_rÙ©e_ccw
(
Ãw’d
);

531 ià(
’ddœ
 =ğ
DIR_NORTH
è 
DIR_WEST
;

532  
’ddœ
/2;

533 } ià(
¡¬tdœ
 =ğ
DIR_WEST
) {

534 
	`pošt_rÙ©e_cw
(
Ãw’d
);

535 ià(
’ddœ
 =ğ
DIR_WEST
è 
DIR_NORTH
;

536  
’ddœ
*2;

538 
	`pošt_rÙ©e_180
(
Ãw’d
);

539 ià(
’ddœ
 < 
DIR_SOUTH
) ƒnddir*4;

540  
’ddœ
/4;

543  
’ddœ
;

544 
	}
}

557 
Pošt
 *

558 
	$autŞayout_uÂÜm®ize_pošts
(
gušt
 
¡¬tdœ
,

559 
Pošt
 
¡¬t
,

560 
Pošt
 *
pošts
,

561 
gušt
 
num_pošts
)

563 
Pošt
 *
Ãwpošts
 = 
	`g_Ãw
(Pošt, 
num_pošts
);

564 
gušt
 
i
;

565 ià(
¡¬tdœ
 =ğ
DIR_NORTH
) {

566 
i
 = 0; i < 
num_pošts
; i++) {

567 
Ãwpošts
[
i
] = 
pošts
[i];

568 
	`pošt_add
(&
Ãwpošts
[
i
], &
¡¬t
);

570 } ià(
¡¬tdœ
 =ğ
DIR_WEST
) {

571 
i
 = 0; i < 
num_pošts
; i++) {

572 
Ãwpošts
[
i
] = 
pošts
[i];

573 
	`pošt_rÙ©e_ccw
(&
Ãwpošts
[
i
]);

574 
	`pošt_add
(&
Ãwpošts
[
i
], &
¡¬t
);

576 } ià(
¡¬tdœ
 =ğ
DIR_SOUTH
) {

577 
i
 = 0; i < 
num_pošts
; i++) {

578 
Ãwpošts
[
i
] = 
pošts
[i];

579 
	`pošt_rÙ©e_180
(&
Ãwpošts
[
i
]);

580 
	`pošt_add
(&
Ãwpošts
[
i
], &
¡¬t
);

582 } ià(
¡¬tdœ
 =ğ
DIR_EAST
) {

583 
i
 = 0; i < 
num_pošts
; i++) {

584 
Ãwpošts
[
i
] = 
pošts
[i];

585 
	`pošt_rÙ©e_cw
(&
Ãwpošts
[
i
]);

586 
	`pošt_add
(&
Ãwpošts
[
i
], &
¡¬t
);

589 
	`g_ä“
(
pošts
);

590  
Ãwpošts
;

591 
	}
}

	@O:\tool\dvs50\lib\autoroute.h

21 #iâdeà
AUTOROUTE_H


22 
	#AUTOROUTE_H


	)

24 
	~"dŸty³s.h
"

25 
	~<gdk/gdk.h
>

27 
gboŞ—n
 
autÜou‹_Ïyout_ÜthcÚn
(
O¹hCÚn
 *
cÚn
,

28 
CÚÃùiÚPošt
 *
¡¬tcÚn
, CÚÃùiÚPošˆ*
’dcÚn
);

	@O:\tool\dvs50\lib\bezier_conn.c

23 
	~<cÚfig.h
>

25 
	~<¡dio.h
>

26 
	~<¡dlib.h
>

27 
	~<m©h.h
>

28 
	~<¡ršg.h
>

30 
	~"bez›r_cÚn.h
"

31 
	~"š.h
"

32 
	~"mes§ge.h
"

33 
	~"dŸ»nd””.h
"

35 
	#HANDLE_BEZMAJOR
 (
HANDLE_CUSTOM1
)

	)

36 
	#HANDLE_LEFTCTRL
 (
HANDLE_CUSTOM2
)

	)

37 
	#HANDLE_RIGHTCTRL
 (
HANDLE_CUSTOM3
)

	)

39 
	echªge_ty³
 {

40 
	mTYPE_ADD_POINT
,

41 
	mTYPE_REMOVE_POINT


44 
	sPoštChªge
 {

45 
ObjeùChªge
 
	mobj_chªge
;

47 
chªge_ty³
 
	mty³
;

48 
	m­¶›d
;

50 
BezPošt
 
	mpošt
;

51 
BezCÜÃrTy³
 
	mcÜÃr_ty³
;

52 
	mpos
;

55 
HªdË
 *
	mhªdË1
, *
	mhªdË2
, *
	mhªdË3
;

57 
CÚÃùiÚPošt
 *
	mcÚÃùed_to1
, *
	mcÚÃùed_to2
, *
	mcÚÃùed_to3
;

60 
	sCÜÃrChªge
 {

61 
ObjeùChªge
 
	mobj_chªge
;

63 
	m­¶›d
;

65 
HªdË
 *
	mhªdË
;

67 
Pošt
 
	mpošt_Ëá
, 
	mpošt_right
;

68 
BezCÜÃrTy³
 
	mŞd_ty³
, 
	mÃw_ty³
;

71 
ObjeùChªge
 *

72 
bez›rcÚn_ü—‹_pošt_chªge
(
Bez›rCÚn
 *
bez
, 
chªge_ty³
 
ty³
,

73 
BezPošt
 *
pošt
, 
BezCÜÃrTy³
 
cÜÃr_ty³
,

74 
£gm’t
,

75 
HªdË
 *
hªdË1
, 
CÚÃùiÚPošt
 *
cÚÃùed_to1
,

76 
HªdË
 *
hªdË2
, 
CÚÃùiÚPošt
 *
cÚÃùed_to2
,

77 
HªdË
 *
hªdË3
, 
CÚÃùiÚPošt
 *
cÚÃùed_to3
);

78 
ObjeùChªge
 *

79 
bez›rcÚn_ü—‹_cÜÃr_chªge
(
Bez›rCÚn
 *
bez
, 
HªdË
 *
hªdË
,

80 
Pošt
 *
pošt_Ëá
, Pošˆ*
pošt_right
,

81 
BezCÜÃrTy³
 
Şd_cÜÃr_ty³
,

82 
BezCÜÃrTy³
 
Ãw_cÜÃr_ty³
);

89 
	$£tup_hªdË
(
HªdË
 *
hªdË
, 
HªdËId
 
id
)

91 
hªdË
->
id
 = id;

92 
hªdË
->
ty³
 = 
HANDLE_MINOR_CONTROL
;

93 
hªdË
->
cÚÃù_ty³
 = (
id
 =ğ
HANDLE_BEZMAJOR
) ?

94 
HANDLE_CONNECTABLE
 : 
HANDLE_NONCONNECTABLE
;

95 
hªdË
->
cÚÃùed_to
 = 
NULL
;

96 
	}
}

105 
	$g‘_hªdË_Ä
(
Bez›rCÚn
 *
bez
, 
HªdË
 *
hªdË
)

107 
i
 = 0;

108 
i
=0;i<
bez
->
objeù
.
num_hªdËs
;i++) {

109 ià(
bez
->
objeù
.
hªdËs
[
i
] =ğ
hªdË
)

110  
i
;

113 
	}
}

115 
Ãw_hªdËs
(
Bez›rCÚn
 *
bez
, 
num_pošts
);

117 
	#g‘_comp_Ä
(
hnum
è((()(hnum)+2)/3)

	)

118 
	#g‘_majÜ_Ä
(
hnum
è((()(hnum)+1)/3)

	)

132 
ObjeùChªge
*

133 
	$bez›rcÚn_move_hªdË
(
Bez›rCÚn
 *
bez
, 
HªdË
 *
hªdË
,

134 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

135 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

137 
hªdË_Ä
, 
comp_Ä
;

138 
Pošt
 
d–
, 
±
;

140 
d–
 = *
to
;

141 
	`pošt_sub
(&
d–
, &
hªdË
->
pos
);

143 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
bez
, 
hªdË
);

144 
comp_Ä
 = 
	`g‘_comp_Ä
(
hªdË_Ä
);

145 
hªdË
->
id
) {

146 
HANDLE_MOVE_STARTPOINT
:

147 
bez
->
pošts
[0].
p1
 = *
to
;

149 
	`pošt_add
(&
bez
->
pošts
[1].
p1
, &
d–
);

151 
HANDLE_MOVE_ENDPOINT
:

152 
bez
->
pošts
[bez->
numpošts
-1].
p3
 = *
to
;

154 
	`pošt_add
(&
bez
->
pošts
[bez->
numpošts
-1].
p2
, &
d–
);

156 
HANDLE_BEZMAJOR
:

157 
bez
->
pošts
[
comp_Ä
].
p3
 = *
to
;

159 
	`pošt_add
(&
bez
->
pošts
[
comp_Ä
].
p2
, &
d–
);

160 
	`pošt_add
(&
bez
->
pošts
[
comp_Ä
+1].
p1
, &
d–
);

162 
HANDLE_LEFTCTRL
:

163 
bez
->
pošts
[
comp_Ä
].
p2
 = *
to
;

164 ià(
comp_Ä
 < 
bez
->
numpošts
 - 1) {

165 
bez
->
cÜÃr_ty³s
[
comp_Ä
]) {

166 
BEZ_CORNER_SYMMETRIC
:

167 
±
 = 
bez
->
pošts
[
comp_Ä
].
p3
;

168 
	`pošt_sub
(&
±
, &
bez
->
pošts
[
comp_Ä
].
p2
);

169 
	`pošt_add
(&
±
, &
bez
->
pošts
[
comp_Ä
].
p3
);

170 
bez
->
pošts
[
comp_Ä
+1].
p1
 = 
±
;

172 
BEZ_CORNER_SMOOTH
: {

173 
»®
 
Ën
;

174 
±
 = 
bez
->
pošts
[
comp_Ä
+1].
p1
;

175 
	`pošt_sub
(&
±
, &
bez
->
pošts
[
comp_Ä
].
p3
);

176 
Ën
 = 
	`pošt_Ën
(&
±
);

177 
±
 = 
bez
->
pošts
[
comp_Ä
].
p2
;

178 
	`pošt_sub
(&
±
, &
bez
->
pošts
[
comp_Ä
].
p3
);

179 ià(
	`pošt_Ën
(&
±
) > 0)

180 
	`pošt_nÜm®ize
(&
±
);

181 { 
±
.
x
 = 1.0;…t.
y
 = 0.0; }

182 
	`pošt_sÿË
(&
±
, -
Ën
);

183 
	`pošt_add
(&
±
, &
bez
->
pošts
[
comp_Ä
].
p3
);

184 
bez
->
pošts
[
comp_Ä
+1].
p1
 = 
±
;

187 
BEZ_CORNER_CUSP
:

193 
HANDLE_RIGHTCTRL
:

194 
bez
->
pošts
[
comp_Ä
].
p1
 = *
to
;

195 ià(
comp_Ä
 > 1) {

196 
bez
->
cÜÃr_ty³s
[
comp_Ä
-1]) {

197 
BEZ_CORNER_SYMMETRIC
:

198 
±
 = 
bez
->
pošts
[
comp_Ä
 - 1].
p3
;

199 
	`pošt_sub
(&
±
, &
bez
->
pošts
[
comp_Ä
].
p1
);

200 
	`pošt_add
(&
±
, &
bez
->
pošts
[
comp_Ä
 - 1].
p3
);

201 
bez
->
pošts
[
comp_Ä
-1].
p2
 = 
±
;

203 
BEZ_CORNER_SMOOTH
: {

204 
»®
 
Ën
;

205 
±
 = 
bez
->
pošts
[
comp_Ä
-1].
p2
;

206 
	`pošt_sub
(&
±
, &
bez
->
pošts
[
comp_Ä
-1].
p3
);

207 
Ën
 = 
	`pošt_Ën
(&
±
);

208 
±
 = 
bez
->
pošts
[
comp_Ä
].
p1
;

209 
	`pošt_sub
(&
±
, &
bez
->
pošts
[
comp_Ä
-1].
p3
);

210 ià(
	`pošt_Ën
(&
±
) > 0)

211 
	`pošt_nÜm®ize
(&
±
);

212 { 
±
.
x
 = 1.0;…t.
y
 = 0.0; }

213 
	`pošt_sÿË
(&
±
, -
Ën
);

214 
	`pošt_add
(&
±
, &
bez
->
pošts
[
comp_Ä
-1].
p3
);

215 
bez
->
pošts
[
comp_Ä
-1].
p2
 = 
±
;

218 
BEZ_CORNER_CUSP
:

225 
	`mes§ge_”rÜ
("Internalƒrror in bezierconn_move_handle.\n");

228  
NULL
;

229 
	}
}

238 
ObjeùChªge
*

239 
	$bez›rcÚn_move
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
to
)

241 
Pošt
 
p
;

242 
i
;

244 
p
 = *
to
;

245 
	`pošt_sub
(&
p
, &
bez
->
pošts
[0].
p1
);

247 
bez
->
pošts
[0].
p1
 = *
to
;

248 
i
 = 1; i < 
bez
->
numpošts
; i++) {

249 
	`pošt_add
(&
bez
->
pošts
[
i
].
p1
, &
p
);

250 
	`pošt_add
(&
bez
->
pošts
[
i
].
p2
, &
p
);

251 
	`pošt_add
(&
bez
->
pošts
[
i
].
p3
, &
p
);

253  
NULL
;

254 
	}
}

264 
	$bez›rcÚn_şo£¡_£gm’t
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

266 
Pošt
 
Ï¡
;

267 
i
;

268 
»®
 
di¡
 = 
G_MAXDOUBLE
;

269 
şo£¡
;

271 
şo£¡
 = 0;

272 
Ï¡
 = 
bez
->
pošts
[0].
p1
;

273 
i
 = 0; i < 
bez
->
numpošts
 - 1; i++) {

274 
»®
 
Ãw_di¡
 = 
	`di¡ªû_bez_£g_pošt
(&
Ï¡
, &
bez
->
pošts
[
i
+1].
p1
,

275 &
bez
->
pošts
[
i
+1].
p2
, &bez->pošts[i+1].
p3
,

276 
lše_width
, 
pošt
);

277 ià(
Ãw_di¡
 < 
di¡
) {

278 
di¡
 = 
Ãw_di¡
;

279 
şo£¡
 = 
i
;

281 
Ï¡
 = 
bez
->
pošts
[
i
+1].
p3
;

283  
şo£¡
;

284 
	}
}

292 
HªdË
 *

293 
	$bez›rcÚn_şo£¡_hªdË
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
pošt
)

295 
i
, 
hn
;

296 
»®
 
di¡
;

297 
HªdË
 *
şo£¡
;

299 
şo£¡
 = 
bez
->
objeù
.
hªdËs
[0];

300 
di¡
 = 
	`di¡ªû_pošt_pošt
Ğ
pošt
, &
şo£¡
->
pos
);

301 
i
 = 1, 
hn
 = 1; i < 
bez
->
numpošts
; i++, hn++) {

302 
»®
 
Ãw_di¡
;

304 
Ãw_di¡
 = 
	`di¡ªû_pošt_pošt
(
pošt
, &
bez
->
pošts
[
i
].
p1
);

305 ià(
Ãw_di¡
 < 
di¡
) {

306 
di¡
 = 
Ãw_di¡
;

307 
şo£¡
 = 
bez
->
objeù
.
hªdËs
[
hn
];

309 
hn
++;

311 
Ãw_di¡
 = 
	`di¡ªû_pošt_pošt
(
pošt
, &
bez
->
pošts
[
i
].
p2
);

312 ià(
Ãw_di¡
 < 
di¡
) {

313 
di¡
 = 
Ãw_di¡
;

314 
şo£¡
 = 
bez
->
objeù
.
hªdËs
[
hn
];

316 
hn
++;

318 
Ãw_di¡
 = 
	`di¡ªû_pošt_pošt
(
pošt
, &
bez
->
pošts
[
i
].
p3
);

319 ià(
Ãw_di¡
 < 
di¡
) {

320 
di¡
 = 
Ãw_di¡
;

321 
şo£¡
 = 
bez
->
objeù
.
hªdËs
[
hn
];

324  
şo£¡
;

325 
	}
}

338 
HªdË
 *

339 
	$bez›rcÚn_şo£¡_majÜ_hªdË
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
pošt
)

341 
HªdË
 *
şo£¡
 = 
	`bez›rcÚn_şo£¡_hªdË
(
bez
, 
pošt
);

343  
bez
->
objeù
.
hªdËs
[3*
	`g‘_majÜ_Ä
(
	`g‘_hªdË_Ä
(bez, 
şo£¡
))];

344 
	}
}

352 
»®


353 
	$bez›rcÚn_di¡ªû_äom
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

355  
	`di¡ªû_bez_lše_pošt
(
bez
->
pošts
, bez->
numpošts
,

356 
lše_width
, 
pošt
);

357 
	}
}

371 
	$add_hªdËs
(
Bez›rCÚn
 *
bez
, 
pos
, 
BezPošt
 *
pošt
,

372 
BezCÜÃrTy³
 
cÜÃr_ty³
, 
HªdË
 *
hªdË1
,

373 
HªdË
 *
hªdË2
, HªdË *
hªdË3
)

375 
i
;

376 
DŸObjeù
 *
obj
;

378 
	`g_as£¹
(
pos
 > 0);

380 
obj
 = (
DŸObjeù
 *)
bez
;

381 
bez
->
numpošts
++;

382 
bez
->
pošts
 = 
	`g_»®loc
(bez->pošts, bez->
numpošts
*(
BezPošt
));

383 
bez
->
cÜÃr_ty³s
 = 
	`g_»®loc
(bez->corner_types,

384 
bez
->
numpošts
 * (
BezCÜÃrTy³
));

386 
i
 = 
bez
->
numpošts
-1; i > 
pos
; i--) {

387 
bez
->
pošts
[
i
] = bez->points[i-1];

388 
bez
->
cÜÃr_ty³s
[
i
] = bez->corner_types[i-1];

390 
bez
->
pošts
[
pos
] = *
pošt
;

391 
bez
->
pošts
[
pos
].
p1
 = bez->points[pos+1].p1;

392 
bez
->
pošts
[
pos
+1].
p1
 = 
pošt
->p1;

393 
bez
->
cÜÃr_ty³s
[
pos
] = 
cÜÃr_ty³
;

394 
	`objeù_add_hªdË_©
(
obj
, 
hªdË1
, 3*
pos
-2);

395 
	`objeù_add_hªdË_©
(
obj
, 
hªdË2
, 3*
pos
-1);

396 
	`objeù_add_hªdË_©
(
obj
, 
hªdË3
, 3*
pos
);

398 ià(
pos
==
bez
->
numpošts
-1) {

399 
obj
->
hªdËs
[obj->
num_hªdËs
-4]->
ty³
 = 
HANDLE_MINOR_CONTROL
;

400 
obj
->
hªdËs
[obj->
num_hªdËs
-4]->
id
 = 
HANDLE_BEZMAJOR
;

402 
	}
}

410 
	$»move_hªdËs
(
Bez›rCÚn
 *
bez
, 
pos
)

412 
i
;

413 
DŸObjeù
 *
obj
;

414 
HªdË
 *
Şd_hªdË1
, *
Şd_hªdË2
, *
Şd_hªdË3
;

415 
Pošt
 
tmµošt
;

417 
	`g_as£¹
(
pos
 > 0);

419 
obj
 = (
DŸObjeù
 *)
bez
;

421 ià(
pos
==
obj
->
num_hªdËs
-1) {

422 
obj
->
hªdËs
[obj->
num_hªdËs
-4]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

423 
obj
->
hªdËs
[obj->
num_hªdËs
-4]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

427 
bez
->
numpošts
--;

428 
tmµošt
 = 
bez
->
pošts
[
pos
].
p1
;

429 
i
 = 
pos
; i < 
bez
->
numpošts
; i++) {

430 
bez
->
pošts
[
i
] = bez->points[i+1];

431 
bez
->
cÜÃr_ty³s
[
i
] = bez->corner_types[i+1];

433 
bez
->
pošts
[
pos
].
p1
 = 
tmµošt
;

434 
bez
->
pošts
 = 
	`g_»®loc
(bez->pošts, bez->
numpošts
*(
BezPošt
));

435 
bez
->
cÜÃr_ty³s
 = 
	`g_»®loc
(bez->corner_types,

436 
bez
->
numpošts
 * (
BezCÜÃrTy³
));

438 
Şd_hªdË1
 = 
obj
->
hªdËs
[3*
pos
-2];

439 
Şd_hªdË2
 = 
obj
->
hªdËs
[3*
pos
-1];

440 
Şd_hªdË3
 = 
obj
->
hªdËs
[3*
pos
];

441 
	`objeù_»move_hªdË
(&
bez
->
objeù
, 
Şd_hªdË1
);

442 
	`objeù_»move_hªdË
(&
bez
->
objeù
, 
Şd_hªdË2
);

443 
	`objeù_»move_hªdË
(&
bez
->
objeù
, 
Şd_hªdË3
);

444 
	}
}

455 
ObjeùChªge
 *

456 
	$bez›rcÚn_add_£gm’t
(
Bez›rCÚn
 *
bez
, 
£gm’t
, 
Pošt
 *
pošt
)

458 
BezPošt
 
»®pošt
;

459 
BezCÜÃrTy³
 
cÜÃr_ty³
 = 
BEZ_CORNER_SYMMETRIC
;

460 
HªdË
 *
Ãw_hªdË1
, *
Ãw_hªdË2
, *
Ãw_hªdË3
;

461 
Pošt
 
¡¬ošt
;

463 ià(
£gm’t
 == 0)

464 
¡¬ošt
 = 
bez
->
pošts
[0].
p1
;

466 
¡¬ošt
 = 
bez
->
pošts
[
£gm’t
].
p3
;

468 ià(
pošt
 =ğ
NULL
) {

469 
»®pošt
.
p1
.
x
 = (
¡¬ošt
.x + 
bez
->
pošts
[
£gm’t
+1].
p3
.x) / 6;

470 
»®pošt
.
p1
.
y
 = (
¡¬ošt
.y + 
bez
->
pošts
[
£gm’t
+1].
p3
.y) / 6;

471 
»®pošt
.
p2
.
x
 = (
¡¬ošt
.x + 
bez
->
pošts
[
£gm’t
+1].
p3
.x) / 3;

472 
»®pošt
.
p2
.
y
 = (
¡¬ošt
.y + 
bez
->
pošts
[
£gm’t
+1].
p3
.y) / 3;

473 
»®pošt
.
p3
.
x
 = (
¡¬ošt
.x + 
bez
->
pošts
[
£gm’t
+1].p3.x) / 2;

474 
»®pošt
.
p3
.
y
 = (
¡¬ošt
.y + 
bez
->
pošts
[
£gm’t
+1].p3.y) / 2;

476 
»®pošt
.
p2
.
x
 = 
pošt
->x+(
¡¬ošt
.x - 
bez
->
pošts
[
£gm’t
+1].
p3
.x)/6;

477 
»®pošt
.
p2
.
y
 = 
pošt
->y+(
¡¬ošt
.y - 
bez
->
pošts
[
£gm’t
+1].
p3
.y)/6;

478 
»®pošt
.
p3
 = *
pošt
;

480 
»®pošt
.
p1
.
x
 = 
pošt
->x-(
¡¬ošt
.x - 
bez
->
pošts
[
£gm’t
+1].
p3
.x)/6;

481 
»®pošt
.
p1
.
y
 = 
pošt
->y-(
¡¬ošt
.y - 
bez
->
pošts
[
£gm’t
+1].
p3
.y)/6;

483 
»®pošt
.
ty³
 = 
BEZ_CURVE_TO
;

485 
Ãw_hªdË1
 = 
	`g_Ãw0
(
HªdË
,1);

486 
Ãw_hªdË2
 = 
	`g_Ãw0
(
HªdË
,1);

487 
Ãw_hªdË3
 = 
	`g_Ãw0
(
HªdË
,1);

488 
	`£tup_hªdË
(
Ãw_hªdË1
, 
HANDLE_RIGHTCTRL
);

489 
	`£tup_hªdË
(
Ãw_hªdË2
, 
HANDLE_LEFTCTRL
);

490 
	`£tup_hªdË
(
Ãw_hªdË3
, 
HANDLE_BEZMAJOR
);

491 
	`add_hªdËs
(
bez
, 
£gm’t
+1, &
»®pošt
, 
cÜÃr_ty³
,

492 
Ãw_hªdË1
, 
Ãw_hªdË2
, 
Ãw_hªdË3
);

493  
	`bez›rcÚn_ü—‹_pošt_chªge
(
bez
, 
TYPE_ADD_POINT
,

494 &
»®pošt
, 
cÜÃr_ty³
, 
£gm’t
+1,

495 
Ãw_hªdË1
, 
NULL
,

496 
Ãw_hªdË2
, 
NULL
,

497 
Ãw_hªdË3
, 
NULL
);

498 
	}
}

505 
ObjeùChªge
 *

506 
	$bez›rcÚn_»move_£gm’t
(
Bez›rCÚn
 *
bez
, 
pos
)

508 
HªdË
 *
Şd_hªdË1
, *
Şd_hªdË2
, *
Şd_hªdË3
;

509 
CÚÃùiÚPošt
 *
ıt1
, *
ıt2
, *
ıt3
;

510 
BezPošt
 
Şd_pošt
;

511 
BezCÜÃrTy³
 
Şd_ùy³
;

513 
	`g_as£¹
(
pos
 > 0);

514 
	`g_as£¹
(
bez
->
numpošts
 > 2);

516 ià(
pos
 =ğ
bez
->
numpošts
-1)…os--;

518 
Şd_hªdË1
 = 
bez
->
objeù
.
hªdËs
[3*
pos
-2];

519 
Şd_hªdË2
 = 
bez
->
objeù
.
hªdËs
[3*
pos
-1];

520 
Şd_hªdË3
 = 
bez
->
objeù
.
hªdËs
[3*
pos
];

521 
Şd_pošt
 = 
bez
->
pošts
[
pos
];

522 
Şd_ùy³
 = 
bez
->
cÜÃr_ty³s
[
pos
];

524 
ıt1
 = 
Şd_hªdË1
->
cÚÃùed_to
;

525 
ıt2
 = 
Şd_hªdË2
->
cÚÃùed_to
;

526 
ıt3
 = 
Şd_hªdË3
->
cÚÃùed_to
;

528 
	`objeù_uncÚÃù
((
DŸObjeù
 *)
bez
, 
Şd_hªdË1
);

529 
	`objeù_uncÚÃù
((
DŸObjeù
 *)
bez
, 
Şd_hªdË2
);

530 
	`objeù_uncÚÃù
((
DŸObjeù
 *)
bez
, 
Şd_hªdË3
);

532 
	`»move_hªdËs
(
bez
, 
pos
);

534 
	`bez›rcÚn_upd©e_d©a
(
bez
);

536  
	`bez›rcÚn_ü—‹_pošt_chªge
(
bez
, 
TYPE_REMOVE_POINT
,

537 &
Şd_pošt
, 
Şd_ùy³
, 
pos
,

538 
Şd_hªdË1
, 
ıt1
,

539 
Şd_hªdË2
, 
ıt2
,

540 
Şd_hªdË3
, 
ıt3
);

541 
	}
}

551 
	$bez›rcÚn_¡¿igh‹n_cÜÃr
(
Bez›rCÚn
 *
bez
, 
comp_Ä
)

556 
bez
->
cÜÃr_ty³s
[
comp_Ä
]) {

557 
BEZ_CORNER_SYMMETRIC
: {

558 
Pošt
 
±1
, 
±2
;

559 
±1
 = 
bez
->
pošts
[
comp_Ä
].
p3
;

560 
	`pošt_sub
(&
±1
, &
bez
->
pošts
[
comp_Ä
].
p2
);

561 
±2
 = 
bez
->
pošts
[
comp_Ä
].
p3
;

562 
	`pošt_sub
(&
±2
, &
bez
->
pošts
[
comp_Ä
+1].
p1
);

563 
	`pošt_sÿË
(&
±2
, -1.0);

564 
	`pošt_add
(&
±1
, &
±2
);

565 
	`pošt_sÿË
(&
±1
, 0.5);

566 
±2
 = 
±1
;

567 
	`pošt_sÿË
(&
±1
, -1.0);

568 
	`pošt_add
(&
±1
, &
bez
->
pošts
[
comp_Ä
].
p3
);

569 
	`pošt_add
(&
±2
, &
bez
->
pošts
[
comp_Ä
].
p3
);

570 
bez
->
pošts
[
comp_Ä
].
p2
 = 
±1
;

571 
bez
->
pošts
[
comp_Ä
+1].
p1
 = 
±2
;

572 
	`bez›rcÚn_upd©e_d©a
(
bez
);

575 
BEZ_CORNER_SMOOTH
: {

576 
Pošt
 
±1
, 
±2
;

577 
»®
 
Ën1
, 
Ën2
;

578 
±1
 = 
bez
->
pošts
[
comp_Ä
].
p3
;

579 
	`pošt_sub
(&
±1
, &
bez
->
pošts
[
comp_Ä
].
p2
);

580 
±2
 = 
bez
->
pošts
[
comp_Ä
].
p3
;

581 
	`pošt_sub
(&
±2
, &
bez
->
pošts
[
comp_Ä
+1].
p1
);

582 
Ën1
 = 
	`pošt_Ën
(&
±1
);

583 
Ën2
 = 
	`pošt_Ën
(&
±2
);

584 
	`pošt_sÿË
(&
±2
, -1.0);

585 ià(
Ën1
 > 0)

586 
	`pošt_nÜm®ize
(&
±1
);

587 ià(
Ën2
 > 0)

588 
	`pošt_nÜm®ize
(&
±2
);

589 
	`pošt_add
(&
±1
, &
±2
);

590 
	`pošt_sÿË
(&
±1
, 0.5);

591 
±2
 = 
±1
;

592 
	`pošt_sÿË
(&
±1
, -
Ën1
);

593 
	`pošt_add
(&
±1
, &
bez
->
pošts
[
comp_Ä
].
p3
);

594 
	`pošt_sÿË
(&
±2
, 
Ën2
);

595 
	`pošt_add
(&
±2
, &
bez
->
pošts
[
comp_Ä
].
p3
);

596 
bez
->
pošts
[
comp_Ä
].
p2
 = 
±1
;

597 
bez
->
pošts
[
comp_Ä
+1].
p1
 = 
±2
;

598 
	`bez›rcÚn_upd©e_d©a
(
bez
);

601 
BEZ_CORNER_CUSP
:

604 
	}
}

612 
ObjeùChªge
 *

613 
	$bez›rcÚn_£t_cÜÃr_ty³
(
Bez›rCÚn
 *
bez
, 
HªdË
 *
hªdË
,

614 
BezCÜÃrTy³
 
cÜÃr_ty³
)

616 
HªdË
 *
mid_hªdË
;

617 
Pošt
 
Şd_Ëá
, 
Şd_right
;

618 
Şd_ty³
;

619 
hªdË_Ä
, 
comp_Ä
;

621 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
bez
, 
hªdË
);

623 
hªdË
->
id
) {

624 
HANDLE_BEZMAJOR
:

625 
mid_hªdË
 = 
hªdË
;

627 
HANDLE_LEFTCTRL
:

628 
hªdË_Ä
++;

629 
mid_hªdË
 = 
bez
->
objeù
.
hªdËs
[
hªdË_Ä
];

631 
HANDLE_RIGHTCTRL
:

632 
hªdË_Ä
--;

633 
mid_hªdË
 = 
bez
->
objeù
.
hªdËs
[
hªdË_Ä
];

636 
	`mes§ge_w¬nšg
(
	`_
("Internalƒrror: Setting cornerype ofƒndpoint of bezier"));

637  
NULL
;

640 
comp_Ä
 = 
	`g‘_majÜ_Ä
(
hªdË_Ä
);

642 
Şd_ty³
 = 
bez
->
cÜÃr_ty³s
[
comp_Ä
];

643 
Şd_Ëá
 = 
bez
->
pošts
[
comp_Ä
].
p2
;

644 
Şd_right
 = 
bez
->
pošts
[
comp_Ä
+1].
p1
;

646 
bez
->
cÜÃr_ty³s
[
comp_Ä
] = 
cÜÃr_ty³
;

648 
	`bez›rcÚn_¡¿igh‹n_cÜÃr
(
bez
, 
comp_Ä
);

650  
	`bez›rcÚn_ü—‹_cÜÃr_chªge
(
bez
, 
mid_hªdË
, &
Şd_Ëá
, &
Şd_right
,

651 
Şd_ty³
, 
cÜÃr_ty³
);

652 
	}
}

658 
	$bez›rcÚn_upd©e_d©a
(
Bez›rCÚn
 *
bez
)

660 
i
;

661 
DŸObjeù
 *
obj
 = &
bez
->
objeù
;

664 ià(3*
bez
->
numpošts
-2 !ğ
obj
->
num_hªdËs
) {

665 
	`g_as£¹
(0 =ğ
obj
->
num_cÚÃùiÚs
);

667 
i
 = 0; i < 
obj
->
num_hªdËs
; i++)

668 
	`g_ä“
(
obj
->
hªdËs
[
i
]);

669 
	`g_ä“
(
obj
->
hªdËs
);

671 
obj
->
num_hªdËs
 = 3*
bez
->
numpošts
-2;

672 
obj
->
hªdËs
 = 
	`g_Ãw
(
HªdË
*, obj->
num_hªdËs
);

674 
	`Ãw_hªdËs
(
bez
, bez->
numpošts
);

678 
bez
->
objeù
.
hªdËs
[0]->
pos
 = bez->
pošts
[0].
p1
;

679 
i
 = 1; i < 
bez
->
numpošts
; i++) {

680 
bez
->
objeù
.
hªdËs
[3*
i
-2]->
pos
 = bez->
pošts
[i].
p1
;

681 
bez
->
objeù
.
hªdËs
[3*
i
-1]->
pos
 = bez->
pošts
[i].
p2
;

682 
bez
->
objeù
.
hªdËs
[3*
i
]->
pos
 = bez->
pošts
[i].
p3
;

684 
	}
}

690 
	$bez›rcÚn_upd©e_boundšgbox
(
Bez›rCÚn
 *
bez
)

692 
	`g_as£¹
(
bez
 !ğ
NULL
);

694 
	`pŞybez›r_bbox
(&
bez
->
pošts
[0],

695 
bez
->
numpošts
,

696 &
bez
->
exŒa_¥acšg
, 
FALSE
,

697 &
bez
->
objeù
.
boundšg_box
);

698 
	}
}

708 
	$bez›rcÚn_sim¶e_d¿w
(
Bez›rCÚn
 *
bez
, 
DŸR’d””
 *
»nd””
, 
»®
 
width
)

710 
BezPošt
 *
pošts
;

712 
	`g_as£¹
(
bez
 !ğ
NULL
);

713 
	`g_as£¹
(
»nd””
 !ğ
NULL
);

715 
pošts
 = &
bez
->points[0];

717 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
width
);

718 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

719 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_ROUND
);

720 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

722 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_bez›r
Ô’d””, 
pošts
, 
bez
->
numpošts
, &
cŞÜ_bÏck
);

723 
	}
}

731 
	$bez›rcÚn_d¿w_cÚŒŞ_lšes
(
Bez›rCÚn
 *
bez
, 
DŸR’d””
 *
»nd””
)

733 
CŞÜ
 
lše_cŞour
 = {0.0, 0.0, 0.6};

734 
Pošt
 
¡¬ošt
;

735 
i
;

738 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
(renderer, 0);

739 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_DOTTED
);

740 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_dashËngth
(renderer, 1);

741 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

742 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

744 
¡¬ošt
 = 
bez
->
pošts
[0].
p1
;

745 
i
 = 1; i < 
bez
->
numpošts
; i++) {

746 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
¡¬ošt
, &
bez
->
pošts
[
i
].
p1
,

747 &
lše_cŞour
);

748 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
bez
->
pošts
[
i
].
p2
, &bez->pošts[i].
p3
,

749 &
lše_cŞour
);

750 
¡¬ošt
 = 
bez
->
pošts
[
i
].
p3
;

752 
	}
}

760 
	$Ãw_hªdËs
(
Bez›rCÚn
 *
bez
, 
num_pošts
)

762 
DŸObjeù
 *
obj
;

763 
i
;

765 
obj
 = &
bez
->
objeù
;

767 
obj
->
hªdËs
[0] = 
	`g_Ãw0
(
HªdË
,1);

768 
obj
->
hªdËs
[0]->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

769 
obj
->
hªdËs
[0]->
cÚÃùed_to
 = 
NULL
;

770 
obj
->
hªdËs
[0]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

771 
obj
->
hªdËs
[0]->
id
 = 
HANDLE_MOVE_STARTPOINT
;

773 
i
 = 1; i < 
num_pošts
; i++) {

774 
obj
->
hªdËs
[3*
i
-2] = 
	`g_Ãw0
(
HªdË
,1);

775 
obj
->
hªdËs
[3*
i
-1] = 
	`g_Ãw0
(
HªdË
,1);

776 
obj
->
hªdËs
[3*
i
] = 
	`g_Ãw0
(
HªdË
,1);

778 
	`£tup_hªdË
(
obj
->
hªdËs
[3*
i
-2], 
HANDLE_RIGHTCTRL
);

779 
	`£tup_hªdË
(
obj
->
hªdËs
[3*
i
-1], 
HANDLE_LEFTCTRL
);

781 
obj
->
hªdËs
[3*
i
]->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

782 
obj
->
hªdËs
[3*
i
]->
cÚÃùed_to
 = 
NULL
;

783 
obj
->
hªdËs
[3*
i
]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

784 
obj
->
hªdËs
[3*
i
]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

786 
	}
}

796 
	$bez›rcÚn_š™
(
Bez›rCÚn
 *
bez
, 
num_pošts
)

798 
DŸObjeù
 *
obj
;

799 
i
;

801 
obj
 = &
bez
->
objeù
;

803 
	`objeù_š™
(
obj
, 3*
num_pošts
-2, 0);

805 
bez
->
numpošts
 = 
num_pošts
;

807 
bez
->
pošts
 = 
	`g_Ãw
(
BezPošt
, 
num_pošts
);

808 
bez
->
cÜÃr_ty³s
 = 
	`g_Ãw
(
BezCÜÃrTy³
, 
num_pošts
);

809 
bez
->
pošts
[0].
ty³
 = 
BEZ_MOVE_TO
;

810 
bez
->
cÜÃr_ty³s
[0] = 
BEZ_CORNER_SYMMETRIC
;

811 
i
 = 1; i < 
num_pošts
; i++) {

812 
bez
->
pošts
[
i
].
ty³
 = 
BEZ_CURVE_TO
;

813 
bez
->
cÜÃr_ty³s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

816 
	`Ãw_hªdËs
(
bez
, 
num_pošts
);

818 
	`bez›rcÚn_upd©e_d©a
(
bez
);

819 
	}
}

828 
	$bez›rcÚn_£t_pošts
(
Bez›rCÚn
 *
bez
, 
num_pošts
, 
BezPošt
 *
pošts
)

830 
i
;

832 
bez
->
numpošts
 = 
num_pošts
;

834 ià(
bez
->
pošts
)

835 
	`g_ä“
(
bez
->
pošts
);

837 
bez
->
pošts
 = 
	`g_m®loc
((bez->
numpošts
)*(
BezPošt
));

839 
i
=0;i<
bez
->
numpošts
;i++) {

840 
bez
->
pošts
[
i
] =…oints[i];

842 
	}
}

850 
	$bez›rcÚn_cİy
(
Bez›rCÚn
 *
äom
, Bez›rCÚÀ*
to
)

852 
i
;

853 
DŸObjeù
 *
toobj
, *
äomobj
;

855 
toobj
 = &
to
->
objeù
;

856 
äomobj
 = &
äom
->
objeù
;

858 
	`objeù_cİy
(
äomobj
, 
toobj
);

860 
to
->
numpošts
 = 
äom
->numpoints;

862 
to
->
pošts
 = 
	`g_Ãw
(
BezPošt
,o->
numpošts
);

863 
to
->
cÜÃr_ty³s
 = 
	`g_Ãw
(
BezCÜÃrTy³
,o->
numpošts
);

865 
i
 = 0; i < 
to
->
numpošts
; i++) {

866 
to
->
pošts
[
i
] = 
äom
->points[i];

867 
to
->
cÜÃr_ty³s
[
i
] = 
äom
->corner_types[i];

870 
to
->
objeù
.
hªdËs
[0] = 
	`g_Ãw0
(
HªdË
,1);

871 *
to
->
objeù
.
hªdËs
[0] = *
äom
->object.handles[0];

872 
i
 = 1; i < 
to
->
objeù
.
num_hªdËs
 - 1; i++) {

873 
to
->
objeù
.
hªdËs
[
i
] = 
	`g_Ãw0
(
HªdË
,1);

874 
	`£tup_hªdË
(
to
->
objeù
.
hªdËs
[
i
], 
äom
->objeù.hªdËs[i]->
id
);

876 
to
->
objeù
.
hªdËs
[to->objeù.
num_hªdËs
-1] = 
	`g_Ãw0
(
HªdË
,1);

877 *
to
->
objeù
.
hªdËs
[to->objeù.
num_hªdËs
-1] =

878 *
äom
->
objeù
.
hªdËs
[
to
->objeù.
num_hªdËs
-1];

880 
	`memıy
(&
to
->
exŒa_¥acšg
,&
äom
->extra_spacing,(to->extra_spacing));

881 
	`bez›rcÚn_upd©e_d©a
(
to
);

882 
	}
}

889 
	$bez›rcÚn_de¡roy
(
Bez›rCÚn
 *
bez
)

891 
i
, 
nh
;

892 
HªdË
 **
‹mp_hªdËs
;

896 
nh
 = 
bez
->
objeù
.
num_hªdËs
;

897 
‹mp_hªdËs
 = 
	`g_Ãw
(
HªdË
 *, 
nh
);

898 
i
 = 0; i < 
nh
; i++)

899 
‹mp_hªdËs
[
i
] = 
bez
->
objeù
.
hªdËs
[i];

901 
	`objeù_de¡roy
(&
bez
->
objeù
);

903 
i
 = 0; i < 
nh
; i++)

904 
	`g_ä“
(
‹mp_hªdËs
[
i
]);

905 
	`g_ä“
(
‹mp_hªdËs
);

907 
	`g_ä“
(
bez
->
pošts
);

908 
	`g_ä“
(
bez
->
cÜÃr_ty³s
);

909 
	}
}

918 
	$bez›rcÚn_§ve
(
Bez›rCÚn
 *
bez
, 
ObjeùNode
 
obj_node
)

920 
i
;

921 
A‰ribu‹Node
 
©Œ
;

923 
	`objeù_§ve
(&
bez
->
objeù
, 
obj_node
);

925 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "bez_points");

927 
	`d©a_add_pošt
(
©Œ
, &
bez
->
pošts
[0].
p1
);

928 
i
 = 1; i < 
bez
->
numpošts
; i++) {

929 
	`d©a_add_pošt
(
©Œ
, &
bez
->
pošts
[
i
].
p1
);

930 
	`d©a_add_pošt
(
©Œ
, &
bez
->
pošts
[
i
].
p2
);

931 
	`d©a_add_pošt
(
©Œ
, &
bez
->
pošts
[
i
].
p3
);

934 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "corner_types");

935 
i
 = 0; i < 
bez
->
numpošts
; i++)

936 
	`d©a_add_’um
(
©Œ
, 
bez
->
cÜÃr_ty³s
[
i
]);

937 
	}
}

947 
	$bez›rcÚn_lßd
(
Bez›rCÚn
 *
bez
, 
ObjeùNode
 
obj_node
)

949 
i
;

950 
A‰ribu‹Node
 
©Œ
;

951 
D©aNode
 
d©a
;

953 
DŸObjeù
 *
obj
 = &
bez
->
objeù
;

955 
	`objeù_lßd
(
obj
, 
obj_node
);

957 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "bez_points");

959 ià(
©Œ
 !ğ
NULL
)

960 
bez
->
numpošts
 = (
	`©Œibu‹_num_d©a
(
©Œ
) + 2)/3;

962 
bez
->
numpošts
 = 0;

964 
	`objeù_š™
(
obj
, 3 * 
bez
->
numpošts
 - 2, 0);

966 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

967 ià(
bez
->
numpošts
 != 0) {

968 
bez
->
pošts
 = 
	`g_Ãw
(
BezPošt
, bez->
numpošts
);

969 
bez
->
pošts
[0].
ty³
 = 
BEZ_MOVE_TO
;

970 
	`d©a_pošt
(
d©a
, &
bez
->
pošts
[0].
p1
);

971 
d©a
 = 
	`d©a_Ãxt
(data);

973 
i
 = 1; i < 
bez
->
numpošts
; i++) {

974 
bez
->
pošts
[
i
].
ty³
 = 
BEZ_CURVE_TO
;

975 
	`d©a_pošt
(
d©a
, &
bez
->
pošts
[
i
].
p1
);

976 
d©a
 = 
	`d©a_Ãxt
(data);

977 
	`d©a_pošt
(
d©a
, &
bez
->
pošts
[
i
].
p2
);

978 
d©a
 = 
	`d©a_Ãxt
(data);

979 
	`d©a_pošt
(
d©a
, &
bez
->
pošts
[
i
].
p3
);

980 
d©a
 = 
	`d©a_Ãxt
(data);

984 
bez
->
cÜÃr_ty³s
 = 
	`g_Ãw
(
BezCÜÃrTy³
, bez->
numpošts
);

986 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "corner_types");

988 ià(!
©Œ
 || 
	`©Œibu‹_num_d©a
×‰rè!ğ
bez
->
numpošts
) {

989 
i
 = 0; i < 
bez
->
numpošts
; i++) {

990 
bez
->
cÜÃr_ty³s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

993 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

994 
i
 = 0; i < 
bez
->
numpošts
; i++) {

995 
bez
->
cÜÃr_ty³s
[
i
] = 
	`d©a_’um
(
d©a
);

996 
d©a
 = 
	`d©a_Ãxt
(data);

1000 
obj
->
hªdËs
[0] = 
	`g_Ãw0
(
HªdË
,1);

1001 
obj
->
hªdËs
[0]->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

1002 
obj
->
hªdËs
[0]->
cÚÃùed_to
 = 
NULL
;

1003 
obj
->
hªdËs
[0]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

1004 
obj
->
hªdËs
[0]->
id
 = 
HANDLE_MOVE_STARTPOINT
;

1006 
i
 = 1; i < 
bez
->
numpošts
; i++) {

1007 
obj
->
hªdËs
[3*
i
-2] = 
	`g_Ãw0
(
HªdË
,1);

1008 
	`£tup_hªdË
(
obj
->
hªdËs
[3*
i
-2], 
HANDLE_RIGHTCTRL
);

1009 
obj
->
hªdËs
[3*
i
-1] = 
	`g_Ãw0
(
HªdË
,1);

1010 
	`£tup_hªdË
(
obj
->
hªdËs
[3*
i
-1], 
HANDLE_LEFTCTRL
);

1011 
obj
->
hªdËs
[3*
i
] = 
	`g_Ãw0
(
HªdË
,1);

1012 
	`£tup_hªdË
(
obj
->
hªdËs
[3*
i
], 
HANDLE_BEZMAJOR
);

1015 
obj
->
hªdËs
[obj->
num_hªdËs
-1]->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

1016 
obj
->
hªdËs
[obj->
num_hªdËs
-1]->
cÚÃùed_to
 = 
NULL
;

1017 
obj
->
hªdËs
[obj->
num_hªdËs
-1]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

1018 
obj
->
hªdËs
[obj->
num_hªdËs
-1]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

1020 
	`bez›rcÚn_upd©e_d©a
(
bez
);

1021 
	}
}

1029 
	$bez›rcÚn_pošt_chªge_ä“
(
PoštChªge
 *
chªge
)

1031 iàĞ(
chªge
->
ty³
==
TYPE_ADD_POINT
 && !chªge->
­¶›d
) ||

1032 (
chªge
->
ty³
==
TYPE_REMOVE_POINT
 && chªge->
­¶›d
) ){

1033 
	`g_ä“
(
chªge
->
hªdË1
);

1034 
	`g_ä“
(
chªge
->
hªdË2
);

1035 
	`g_ä“
(
chªge
->
hªdË3
);

1036 
chªge
->
hªdË1
 = 
NULL
;

1037 
chªge
->
hªdË2
 = 
NULL
;

1038 
chªge
->
hªdË3
 = 
NULL
;

1040 
	}
}

1047 
	$bez›rcÚn_pošt_chªge_­¶y
(
PoštChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1049 
chªge
->
­¶›d
 = 1;

1050 
chªge
->
ty³
) {

1051 
TYPE_ADD_POINT
:

1052 
	`add_hªdËs
((
Bez›rCÚn
 *)
obj
, 
chªge
->
pos
, &chªge->
pošt
,

1053 
chªge
->
cÜÃr_ty³
,

1054 
chªge
->
hªdË1
, chªge->
hªdË2
, chªge->
hªdË3
);

1056 
TYPE_REMOVE_POINT
:

1057 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË1
);

1058 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË2
);

1059 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË3
);

1060 
	`»move_hªdËs
((
Bez›rCÚn
 *)
obj
, 
chªge
->
pos
);

1063 
	}
}

1070 
	$bez›rcÚn_pošt_chªge_»v”t
(
PoštChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1072 
chªge
->
ty³
) {

1073 
TYPE_ADD_POINT
:

1074 
	`»move_hªdËs
((
Bez›rCÚn
 *)
obj
, 
chªge
->
pos
);

1076 
TYPE_REMOVE_POINT
:

1077 
	`add_hªdËs
((
Bez›rCÚn
 *)
obj
, 
chªge
->
pos
, &chªge->
pošt
,

1078 
chªge
->
cÜÃr_ty³
,

1079 
chªge
->
hªdË1
, chªge->
hªdË2
, chªge->
hªdË3
);

1081 ià(
chªge
->
cÚÃùed_to1
)

1082 
	`objeù_cÚÃù
(
obj
, 
chªge
->
hªdË1
, chªge->
cÚÃùed_to1
);

1083 ià(
chªge
->
cÚÃùed_to2
)

1084 
	`objeù_cÚÃù
(
obj
, 
chªge
->
hªdË2
, chªge->
cÚÃùed_to2
);

1085 ià(
chªge
->
cÚÃùed_to3
)

1086 
	`objeù_cÚÃù
(
obj
, 
chªge
->
hªdË3
, chªge->
cÚÃùed_to3
);

1090 
chªge
->
­¶›d
 = 0;

1091 
	}
}

1109 
ObjeùChªge
 *

1110 
	$bez›rcÚn_ü—‹_pošt_chªge
(
Bez›rCÚn
 *
bez
, 
chªge_ty³
 
ty³
,

1111 
BezPošt
 *
pošt
, 
BezCÜÃrTy³
 
cÜÃr_ty³
,

1112 
pos
,

1113 
HªdË
 *
hªdË1
, 
CÚÃùiÚPošt
 *
cÚÃùed_to1
,

1114 
HªdË
 *
hªdË2
, 
CÚÃùiÚPošt
 *
cÚÃùed_to2
,

1115 
HªdË
 *
hªdË3
, 
CÚÃùiÚPošt
 *
cÚÃùed_to3
)

1117 
PoštChªge
 *
chªge
;

1119 
chªge
 = 
	`g_Ãw
(
PoštChªge
, 1);

1121 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
bez›rcÚn_pošt_chªge_­¶y
;

1122 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
bez›rcÚn_pošt_chªge_»v”t
;

1123 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
bez›rcÚn_pošt_chªge_ä“
;

1125 
chªge
->
ty³
 =ype;

1126 
chªge
->
­¶›d
 = 1;

1127 
chªge
->
pošt
 = *point;

1128 
chªge
->
cÜÃr_ty³
 = corner_type;

1129 
chªge
->
pos
 =…os;

1130 
chªge
->
hªdË1
 = handle1;

1131 
chªge
->
cÚÃùed_to1
 = connected_to1;

1132 
chªge
->
hªdË2
 = handle2;

1133 
chªge
->
cÚÃùed_to2
 = connected_to2;

1134 
chªge
->
hªdË3
 = handle3;

1135 
chªge
->
cÚÃùed_to3
 = connected_to3;

1137  (
ObjeùChªge
 *)
chªge
;

1138 
	}
}

1146 
	$bez›rcÚn_cÜÃr_chªge_­¶y
(
CÜÃrChªge
 *
chªge
,

1147 
DŸObjeù
 *
obj
)

1149 
Bez›rCÚn
 *
bez
 = (Bez›rCÚÀ*)
obj
;

1150 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
bez
, 
chªge
->
hªdË
);

1151 
comp_Ä
 = 
	`g‘_majÜ_Ä
(
hªdË_Ä
);

1153 
	`bez›rcÚn_¡¿igh‹n_cÜÃr
(
bez
, 
comp_Ä
);

1155 
bez
->
cÜÃr_ty³s
[
comp_Ä
] = 
chªge
->
Ãw_ty³
;

1157 
chªge
->
­¶›d
 = 1;

1158 
	}
}

1166 
	$bez›rcÚn_cÜÃr_chªge_»v”t
(
CÜÃrChªge
 *
chªge
,

1167 
DŸObjeù
 *
obj
)

1169 
Bez›rCÚn
 *
bez
 = (Bez›rCÚÀ*)
obj
;

1170 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
bez
, 
chªge
->
hªdË
);

1171 
comp_Ä
 = 
	`g‘_majÜ_Ä
(
hªdË_Ä
);

1173 
bez
->
pošts
[
comp_Ä
].
p2
 = 
chªge
->
pošt_Ëá
;

1174 
bez
->
pošts
[
comp_Ä
+1].
p1
 = 
chªge
->
pošt_right
;

1175 
bez
->
cÜÃr_ty³s
[
comp_Ä
] = 
chªge
->
Şd_ty³
;

1177 
chªge
->
­¶›d
 = 0;

1178 
	}
}

1191 
ObjeùChªge
 *

1192 
	$bez›rcÚn_ü—‹_cÜÃr_chªge
(
Bez›rCÚn
 *
bez
, 
HªdË
 *
hªdË
,

1193 
Pošt
 *
pošt_Ëá
, Pošˆ*
pošt_right
,

1194 
BezCÜÃrTy³
 
Şd_cÜÃr_ty³
,

1195 
BezCÜÃrTy³
 
Ãw_cÜÃr_ty³
)

1197 
CÜÃrChªge
 *
chªge
;

1199 
chªge
 = 
	`g_Ãw
(
CÜÃrChªge
, 1);

1201 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
bez›rcÚn_cÜÃr_chªge_­¶y
;

1202 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
bez›rcÚn_cÜÃr_chªge_»v”t
;

1203 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
NULL
;

1205 
chªge
->
Şd_ty³
 = 
Şd_cÜÃr_ty³
;

1206 
chªge
->
Ãw_ty³
 = 
Ãw_cÜÃr_ty³
;

1207 
chªge
->
­¶›d
 = 1;

1209 
chªge
->
hªdË
 = handle;

1210 
chªge
->
pošt_Ëá
 = *point_left;

1211 
chªge
->
pošt_right
 = *point_right;

1213  (
ObjeùChªge
 *)
chªge
;

1214 
	}
}

	@O:\tool\dvs50\lib\bezier_conn.h

23 #iâdeà
BEZIER_CONN_H


24 
	#BEZIER_CONN_H


	)

26 
	~"dŸty³s.h
"

27 
	~"objeù.h
"

28 
	~"boundšgbox.h
"

31 
	mBEZ_CORNER_SYMMETRIC
,

32 
	mBEZ_CORNER_SMOOTH
,

33 
	mBEZ_CORNER_CUSP


34 } 
	tBezCÜÃrTy³
;

39 
	s_Bez›rCÚn
 {

40 
DŸObjeù
 
	mobjeù
;

42 
	mnumpošts
;

43 
BezPošt
 *
	mpošts
;

44 
BezCÜÃrTy³
 *
	mcÜÃr_ty³s
;

45 
PŞyBBExŒas
 
	mexŒa_¥acšg
;

48 
DIAVAR
 
bez›rcÚn_upd©e_d©a
(
Bez›rCÚn
 *
bez
);

49 
DIAVAR
 
bez›rcÚn_upd©e_boundšgbox
(
Bez›rCÚn
 *
bez
);

50 
bez›rcÚn_sim¶e_d¿w
(
Bez›rCÚn
 *
bez
, 
DŸR’d””
 *
»nd””
,

51 
»®
 
width
);

52 
DIAVAR
 
bez›rcÚn_d¿w_cÚŒŞ_lšes
(
Bez›rCÚn
 *
bez
, 
DŸR’d””
 *
»nd””
);

53 
DIAVAR
 
bez›rcÚn_š™
(
Bez›rCÚn
 *
bez
, 
num_pošts
);

54 
DIAVAR
 
bez›rcÚn_£t_pošts
(
Bez›rCÚn
 *
pŞy
, 
num_pošts
, 
BezPošt
 *
pošts
);

55 
DIAVAR
 
bez›rcÚn_de¡roy
(
Bez›rCÚn
 *
bez
);

56 
DIAVAR
 
bez›rcÚn_cİy
(
Bez›rCÚn
 *
äom
, Bez›rCÚÀ*
to
);

57 
DIAVAR
 
bez›rcÚn_§ve
(
Bez›rCÚn
 *
bez
, 
ObjeùNode
 
obj_node
);

58 
DIAVAR
 
bez›rcÚn_lßd
(
Bez›rCÚn
 *
bez
, 
ObjeùNode
 
obj_node
);

59 
DIAVAR
 
ObjeùChªge
 *
bez›rcÚn_add_£gm’t
(
Bez›rCÚn
 *
bez
, 
£gm’t
, 
Pošt
 *
pošt
);

60 
DIAVAR
 
ObjeùChªge
 *
bez›rcÚn_»move_£gm’t
(
Bez›rCÚn
 *
bez
, 
pošt
);

61 
DIAVAR
 
ObjeùChªge
 *
bez›rcÚn_£t_cÜÃr_ty³
(
Bez›rCÚn
 *
bez
,

62 
HªdË
 *
hªdË
,

63 
BezCÜÃrTy³
 
¡yË
);

64 
DIAVAR
 
ObjeùChªge
 *
bez›rcÚn_move_hªdË
(
Bez›rCÚn
 *
bez
, 
HªdË
 *
id
,

65 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

66 
HªdËMoveR—sÚ
 
»asÚ
,

67 
Modif›rKeys
 
modif›rs
);

68 
DIAVAR
 
ObjeùChªge
 *
bez›rcÚn_move
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
to
);

69 
DIAVAR
 
»®
 
bez›rcÚn_di¡ªû_äom
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
pošt
,

70 
»®
 
lše_width
);

71 
DIAVAR
 
HªdË
 *
bez›rcÚn_şo£¡_hªdË
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
pošt
);

72 
DIAVAR
 
HªdË
 *
bez›rcÚn_şo£¡_majÜ_hªdË
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
pošt
);

73 
DIAVAR
 
bez›rcÚn_şo£¡_£gm’t
(
Bez›rCÚn
 *
bez
, 
Pošt
 *
pošt
,

74 
»®
 
lše_width
);

76 
	#BEZCONN_COMMON_PROPERTIES
 \

77 
OBJECT_COMMON_PROPERTIES
, \

78 { "bez_pošts", 
PROP_TYPE_BEZPOINTARRAY
, 0, "bez›rcÚÀpošts", 
NULL
} \

79 

	)

80 
	#BEZCONN_COMMON_PROPERTIES_OFFSETS
 \

81 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

82 { "bez_pošts", 
PROP_TYPE_BEZPOINTARRAY
, \

83 
	`off£tof
(
Bez›rCÚn
,
pošts
), off£tof(Bez›rCÚn,
numpošts
)} \

84 

	)

	@O:\tool\dvs50\lib\beziershape.c

22 
	~<cÚfig.h
>

24 
	~<¡dio.h
>

25 
	~<¡dlib.h
>

26 
	~<m©h.h
>

27 
	~<¡ršg.h
>

29 
	~"bez›rsh­e.h
"

30 
	~"mes§ge.h
"

31 
	~"dŸ»nd””.h
"

33 
	#HANDLE_BEZMAJOR
 (
HANDLE_CUSTOM1
)

	)

34 
	#HANDLE_LEFTCTRL
 (
HANDLE_CUSTOM2
)

	)

35 
	#HANDLE_RIGHTCTRL
 (
HANDLE_CUSTOM3
)

	)

37 
	echªge_ty³
 {

38 
	mTYPE_ADD_POINT
,

39 
	mTYPE_REMOVE_POINT


47 
	sBezPoštChªge
 {

48 
ObjeùChªge
 
	mobj_chªge
;

50 
chªge_ty³
 
	mty³
;

51 
	m­¶›d
;

53 
BezPošt
 
	mpošt
;

54 
BezCÜÃrTy³
 
	mcÜÃr_ty³
;

55 
	mpos
;

59 
HªdË
 *
	mhªdË1
, *
	mhªdË2
, *
	mhªdË3
;

60 
CÚÃùiÚPošt
 *
	mı1
, *
	mı2
;

63 
	sCÜÃrChªge
 {

64 
ObjeùChªge
 
	mobj_chªge
;

66 
	m­¶›d
;

68 
HªdË
 *
	mhªdË
;

70 
Pošt
 
	mpošt_Ëá
, 
	mpošt_right
;

71 
BezCÜÃrTy³
 
	mŞd_ty³
, 
	mÃw_ty³
;

74 
ObjeùChªge
 *

75 
bez›rsh­e_ü—‹_pošt_chªge
(
Bez›rSh­e
 *
bez›r
, 
chªge_ty³
 
ty³
,

76 
BezPošt
 *
pošt
, 
BezCÜÃrTy³
 
cÜÃr_ty³
,

77 
£gm’t
,

78 
HªdË
 *
hªdË1
, HªdË *
hªdË2
, HªdË *
hªdË3
,

79 
CÚÃùiÚPošt
 *
ı1
, CÚÃùiÚPošˆ*
ı2
);

80 
ObjeùChªge
 *

81 
bez›rsh­e_ü—‹_cÜÃr_chªge
(
Bez›rSh­e
 *
bez›r
, 
HªdË
 *
hªdË
,

82 
Pošt
 *
pošt_Ëá
, Pošˆ*
pošt_right
,

83 
BezCÜÃrTy³
 
Şd_cÜÃr_ty³
,

84 
BezCÜÃrTy³
 
Ãw_cÜÃr_ty³
);

86 
Ãw_hªdËs_ªd_cÚÃùiÚs
(
Bez›rSh­e
 *
bez›r
, 
num_pošts
);

88 
	$£tup_hªdË
(
HªdË
 *
hªdË
, 
hªdË_id
)

90 
hªdË
->
id
 = 
hªdË_id
;

91 
hªdË
->
ty³
 =

92 (
hªdË_id
 =ğ
HANDLE_BEZMAJOR
) ?

93 
HANDLE_MAJOR_CONTROL
 :

94 
HANDLE_MINOR_CONTROL
;

95 
hªdË
->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

96 
hªdË
->
cÚÃùed_to
 = 
NULL
;

97 
	}
}

100 
	$g‘_hªdË_Ä
(
Bez›rSh­e
 *
bez›r
, 
HªdË
 *
hªdË
)

102 
i
 = 0;

103 
i
 = 0; i < 
bez›r
->
objeù
.
num_hªdËs
; i++) {

104 ià(
bez›r
->
objeù
.
hªdËs
[
i
] =ğ
hªdË
)

105  
i
;

108 
	}
}

110 
	#g‘_comp_Ä
(
hnum
è(()(hnum)/3+1)

	)

111 
	#g‘_majÜ_Ä
(
hnum
è((()(hnum)+2)/3)

	)

113 
ObjeùChªge
 *

114 
	$bez›rsh­e_move_hªdË
(
Bez›rSh­e
 *
bez›r
, 
HªdË
 *
hªdË
,

115 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

116 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

118 
hªdË_Ä
, 
comp_Ä
, 
Ãxt_Ä
, 
´ev_Ä
;

119 
Pošt
 
d–
, 
±
;

121 
d–
 = *
to
;

122 
	`pošt_sub
(&
d–
, &
hªdË
->
pos
);

124 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
bez›r
, 
hªdË
);

125 
comp_Ä
 = 
	`g‘_comp_Ä
(
hªdË_Ä
);

126 
Ãxt_Ä
 = 
comp_Ä
 + 1;

127 
´ev_Ä
 = 
comp_Ä
 - 1;

128 ià(
comp_Ä
 =ğ
bez›r
->
numpošts
 - 1)

129 
Ãxt_Ä
 = 1;

130 ià(
comp_Ä
 == 1)

131 
´ev_Ä
 = 
bez›r
->
numpošts
 - 1;

133 
hªdË
->
id
) {

134 
HANDLE_BEZMAJOR
:

135 ià(
comp_Ä
 =ğ
bez›r
->
numpošts
 - 1) {

136 
bez›r
->
pošts
[
comp_Ä
].
p3
 = *
to
;

137 
bez›r
->
pošts
[0].
p1
 = bez›r->pošts[0].
p3
 = *
to
;

138 
	`pošt_add
(&
bez›r
->
pošts
[
comp_Ä
].
p2
, &
d–
);

139 
	`pošt_add
(&
bez›r
->
pošts
[1].
p1
, &
d–
);

141 
bez›r
->
pošts
[
comp_Ä
].
p3
 = *
to
;

142 
	`pošt_add
(&
bez›r
->
pošts
[
comp_Ä
].
p2
, &
d–
);

143 
	`pošt_add
(&
bez›r
->
pošts
[
comp_Ä
+1].
p1
, &
d–
);

146 
HANDLE_LEFTCTRL
:

147 
bez›r
->
pošts
[
comp_Ä
].
p2
 = *
to
;

148 
bez›r
->
cÜÃr_ty³s
[
comp_Ä
]) {

149 
BEZ_CORNER_SYMMETRIC
:

150 
±
 = 
bez›r
->
pošts
[
comp_Ä
].
p3
;

151 
	`pošt_sub
(&
±
, &
bez›r
->
pošts
[
comp_Ä
].
p2
);

152 
	`pošt_add
(&
±
, &
bez›r
->
pošts
[
comp_Ä
].
p3
);

153 
bez›r
->
pošts
[
Ãxt_Ä
].
p1
 = 
±
;

155 
BEZ_CORNER_SMOOTH
: {

156 
»®
 
Ën
;

158 
±
 = 
bez›r
->
pošts
[
Ãxt_Ä
].
p1
;

159 
	`pošt_sub
(&
±
, &
bez›r
->
pošts
[
comp_Ä
].
p3
);

160 
Ën
 = 
	`pošt_Ën
(&
±
);

162 
±
 = 
bez›r
->
pošts
[
comp_Ä
].
p3
;

163 
	`pošt_sub
(&
±
, &
bez›r
->
pošts
[
comp_Ä
].
p2
);

164 ià(
	`pošt_Ën
(&
±
) > 0)

165 
	`pošt_nÜm®ize
(&
±
);

167 
±
.
x
 = 1.0;…t.
y
 = 0.0;

169 
	`pošt_sÿË
(&
±
, 
Ën
);

170 
	`pošt_add
(&
±
, &
bez›r
->
pošts
[
comp_Ä
].
p3
);

171 
bez›r
->
pošts
[
Ãxt_Ä
].
p1
 = 
±
;

174 
BEZ_CORNER_CUSP
:

179 
HANDLE_RIGHTCTRL
:

180 
bez›r
->
pošts
[
comp_Ä
].
p1
 = *
to
;

181 
bez›r
->
cÜÃr_ty³s
[
´ev_Ä
]) {

182 
BEZ_CORNER_SYMMETRIC
:

183 
±
 = 
bez›r
->
pošts
[
´ev_Ä
].
p3
;

184 
	`pošt_sub
(&
±
, &
bez›r
->
pošts
[
comp_Ä
].
p1
);

185 
	`pošt_add
(&
±
, &
bez›r
->
pošts
[
´ev_Ä
].
p3
);

186 
bez›r
->
pošts
[
´ev_Ä
].
p2
 = 
±
;

188 
BEZ_CORNER_SMOOTH
: {

189 
»®
 
Ën
;

191 
±
 = 
bez›r
->
pošts
[
´ev_Ä
].
p2
;

192 
	`pošt_sub
(&
±
, &
bez›r
->
pošts
[
´ev_Ä
].
p3
);

193 
Ën
 = 
	`pošt_Ën
(&
±
);

195 
±
 = 
bez›r
->
pošts
[
´ev_Ä
].
p3
;

196 
	`pošt_sub
(&
±
, &
bez›r
->
pošts
[
comp_Ä
].
p1
);

197 ià(
	`pošt_Ën
(&
±
) > 0)

198 
	`pošt_nÜm®ize
(&
±
);

200 
±
.
x
 = 1.0;…t.
y
 = 0.0;

202 
	`pošt_sÿË
(&
±
, 
Ën
);

203 
	`pošt_add
(&
±
, &
bez›r
->
pošts
[
´ev_Ä
].
p3
);

204 
bez›r
->
pošts
[
´ev_Ä
].
p2
 = 
±
;

207 
BEZ_CORNER_CUSP
:

213 
	`mes§ge_”rÜ
("Internalƒrror in beziershape_move_handle.");

216  
NULL
;

217 
	}
}

219 
ObjeùChªge
*

220 
	$bez›rsh­e_move
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
to
)

222 
Pošt
 
p
;

223 
i
;

225 
p
 = *
to
;

226 
	`pošt_sub
(&
p
, &
bez›r
->
pošts
[0].
p1
);

228 
bez›r
->
pošts
[0].
p1
 = bez›r->pošts[0].
p3
 = *
to
;

229 
i
 = 1; i < 
bez›r
->
numpošts
; i++) {

230 
	`pošt_add
(&
bez›r
->
pošts
[
i
].
p1
, &
p
);

231 
	`pošt_add
(&
bez›r
->
pošts
[
i
].
p2
, &
p
);

232 
	`pošt_add
(&
bez›r
->
pošts
[
i
].
p3
, &
p
);

235  
NULL
;

236 
	}
}

239 
	$bez›rsh­e_şo£¡_£gm’t
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

241 
Pošt
 
Ï¡
;

242 
i
;

243 
»®
 
di¡
 = 
G_MAXDOUBLE
;

244 
şo£¡
;

246 
şo£¡
 = 0;

247 
Ï¡
 = 
bez›r
->
pošts
[0].
p1
;

249 
i
 = 1; i < 
bez›r
->
numpošts
; i++) {

250 
»®
 
Ãw_di¡
 = 
	`di¡ªû_bez_£g_pošt
(&
Ï¡
, &
bez›r
->
pošts
[
i
].
p1
,

251 &
bez›r
->
pošts
[
i
].
p2
, &bez›r->pošts[i].
p3
,

252 
lše_width
, 
pošt
);

253 ià(
Ãw_di¡
 < 
di¡
) {

254 
di¡
 = 
Ãw_di¡
;

255 
şo£¡
 = 
i
;

257 
Ï¡
 = 
bez›r
->
pošts
[
i
].
p3
;

259  
şo£¡
;

260 
	}
}

262 
HªdË
 *

263 
	$bez›rsh­e_şo£¡_hªdË
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
pošt
)

265 
i
, 
hn
;

266 
»®
 
di¡
 = 
G_MAXDOUBLE
;

267 
HªdË
 *
şo£¡
 = 
NULL
;

269 
i
 = 1, 
hn
 = 0; i < 
bez›r
->
numpošts
; i++, hn++) {

270 
»®
 
Ãw_di¡
;

272 
Ãw_di¡
 = 
	`di¡ªû_pošt_pošt
Ğ
pošt
, &
bez›r
->
pošts
[
i
].
p1
);

273 ià(
Ãw_di¡
 < 
di¡
) {

274 
di¡
 = 
Ãw_di¡
;

275 
şo£¡
 = 
bez›r
->
objeù
.
hªdËs
[
hn
];

277 
hn
++;

279 
Ãw_di¡
 = 
	`di¡ªû_pošt_pošt
Ğ
pošt
, &
bez›r
->
pošts
[
i
].
p2
);

280 ià(
Ãw_di¡
 < 
di¡
) {

281 
di¡
 = 
Ãw_di¡
;

282 
şo£¡
 = 
bez›r
->
objeù
.
hªdËs
[
hn
];

285 
hn
++;

286 
Ãw_di¡
 = 
	`di¡ªû_pošt_pošt
Ğ
pošt
, &
bez›r
->
pošts
[
i
].
p3
);

287 ià(
Ãw_di¡
 < 
di¡
) {

288 
di¡
 = 
Ãw_di¡
;

289 
şo£¡
 = 
bez›r
->
objeù
.
hªdËs
[
hn
];

292  
şo£¡
;

293 
	}
}

295 
HªdË
 *

296 
	$bez›rsh­e_şo£¡_majÜ_hªdË
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
pošt
)

298 
HªdË
 *
şo£¡
 = 
	`bez›rsh­e_şo£¡_hªdË
(
bez›r
, 
pošt
);

299 
pos
 = 
	`g‘_majÜ_Ä
(
	`g‘_hªdË_Ä
(
bez›r
, 
şo£¡
));

301 ià(
pos
 == 0)

302 
pos
 = 
bez›r
->
numpošts
 - 1;

303  
bez›r
->
objeù
.
hªdËs
[3*
pos
 - 1];

304 
	}
}

306 
»®


307 
	$bez›rsh­e_di¡ªû_äom
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

309  
	`di¡ªû_bez_sh­e_pošt
(
bez›r
->
pošts
, bez›r->
numpošts
,

310 
lše_width
, 
pošt
);

311 
	}
}

314 
	$add_hªdËs
(
Bez›rSh­e
 *
bez›r
, 
pos
, 
BezPošt
 *
pošt
,

315 
BezCÜÃrTy³
 
cÜÃr_ty³
, 
HªdË
 *
hªdË1
,

316 
HªdË
 *
hªdË2
, HªdË *
hªdË3
,

317 
CÚÃùiÚPošt
 *
ı1
, CÚÃùiÚPošˆ*
ı2
)

319 
i
, 
Ãxt
;

320 
DŸObjeù
 *
obj
;

322 
	`g_as£¹
(
pos
 >= 1);

323 
	`g_as£¹
(
pos
 <ğ
bez›r
->
numpošts
);

325 
obj
 = (
DŸObjeù
 *)
bez›r
;

326 
bez›r
->
numpošts
++;

327 
Ãxt
 = 
pos
 + 1;

328 ià(
pos
 =ğ
bez›r
->
numpošts
 - 1)

329 
Ãxt
 = 1;

330 
bez›r
->
pošts
 = 
	`g_»®loc
(bezier->points,

331 
bez›r
->
numpošts
 * (
BezPošt
));

332 
bez›r
->
cÜÃr_ty³s
 = 
	`g_»®loc
(bezier->corner_types,

333 
bez›r
->
numpošts
 * (
BezCÜÃrTy³
));

335 
i
 = 
bez›r
->
numpošts
 - 1; i > 
pos
; i--) {

336 
bez›r
->
pošts
[
i
] = bezier->points[i-1];

337 
bez›r
->
cÜÃr_ty³s
[
i
] =bezier->corner_types[i-1];

339 
bez›r
->
pošts
[
pos
] = *
pošt
;

340 
bez›r
->
pošts
[
pos
].
p1
 = bez›r->pošts[
Ãxt
].p1;

341 
bez›r
->
pošts
[
Ãxt
].
p1
 = 
pošt
->p1;

342 ià(
pos
 =ğ
bez›r
->
numpošts
 - 1)

343 
bez›r
->
pošts
[0].
p1
 = bez›r->pošts[0].
p3
 = bez›r->pošts[
pos
].p3;

344 
bez›r
->
cÜÃr_ty³s
[
pos
] = 
cÜÃr_ty³
;

345 
	`objeù_add_hªdË_©
((
DŸObjeù
*)
bez›r
, 
hªdË1
, 3*
pos
-3);

346 
	`objeù_add_hªdË_©
((
DŸObjeù
*)
bez›r
, 
hªdË2
, 3*
pos
-2);

347 
	`objeù_add_hªdË_©
((
DŸObjeù
*)
bez›r
, 
hªdË3
, 3*
pos
-1);

348 
	`objeù_add_cÚÃùiÚpošt_©
((
DŸObjeù
 *)
bez›r
, 
ı1
, 2*
pos
-2);

349 
	`objeù_add_cÚÃùiÚpošt_©
((
DŸObjeù
 *)
bez›r
, 
ı2
, 2*
pos
-1);

350 
	}
}

353 
	$»move_hªdËs
(
Bez›rSh­e
 *
bez›r
, 
pos
)

355 
i
;

356 
DŸObjeù
 *
obj
;

357 
HªdË
 *
Şd_hªdË1
, *
Şd_hªdË2
, *
Şd_hªdË3
;

358 
CÚÃùiÚPošt
 *
Şd_ı1
, *
Şd_ı2
;

359 
Pošt
 
tmµošt
;

360 
Pošt
 
cÚŒŞveùÜ
;

361 
cÚŒŞveùÜ
.
x
=0;

362 
cÚŒŞveùÜ
.
y
=0;

364 
	`g_as£¹
(
pos
 > 0);

365 
	`g_as£¹
(
pos
 < 
bez›r
->
numpošts
);

367 
obj
 = (
DŸObjeù
 *)
bez›r
;

370 
bez›r
->
numpošts
--;

371 
tmµošt
 = 
bez›r
->
pošts
[
pos
].
p1
;

372 ià(
pos
 =ğ
bez›r
->
numpošts
) {

373 
cÚŒŞveùÜ
 = 
bez›r
->
pošts
[
pos
-1].
p3
;

374 
	`pošt_sub
(&
cÚŒŞveùÜ
, &
bez›r
->
pošts
[
pos
].
p1
);

376 
i
 = 
pos
; i < 
bez›r
->
numpošts
; i++) {

377 
bez›r
->
pošts
[
i
] = bezier->points[i+1];

378 
bez›r
->
cÜÃr_ty³s
[
i
] = bezier->corner_types[i+1];

380 
bez›r
->
pošts
[
pos
].
p1
 = 
tmµošt
;

381 ià(
pos
 =ğ
bez›r
->
numpošts
) {

384 
bez›r
->
pošts
[0].
p1
 = bez›r->pošts[bez›r->
numpošts
-1].
p3
;

385 
bez›r
->
pošts
[1].
p1
 = bezier->points[0].p1;

386 
	`pošt_sub
(&
bez›r
->
pošts
[1].
p1
, &
cÚŒŞveùÜ
);

388 
bez›r
->
pošts
 = 
	`g_»®loc
(bezier->points,

389 
bez›r
->
numpošts
 * (
BezPošt
));

390 
bez›r
->
cÜÃr_ty³s
 = 
	`g_»®loc
(bezier->corner_types,

391 
bez›r
->
numpošts
 * (
BezCÜÃrTy³
));

393 
Şd_hªdË1
 = 
obj
->
hªdËs
[3*
pos
-3];

394 
Şd_hªdË2
 = 
obj
->
hªdËs
[3*
pos
-2];

395 
Şd_hªdË3
 = 
obj
->
hªdËs
[3*
pos
-1];

396 
	`objeù_»move_hªdË
(&
bez›r
->
objeù
, 
Şd_hªdË1
);

397 
	`objeù_»move_hªdË
(&
bez›r
->
objeù
, 
Şd_hªdË2
);

398 
	`objeù_»move_hªdË
(&
bez›r
->
objeù
, 
Şd_hªdË3
);

399 
Şd_ı1
 = 
obj
->
cÚÃùiÚs
[2*
pos
-2];

400 
Şd_ı2
 = 
obj
->
cÚÃùiÚs
[2*
pos
-1];

401 
	`objeù_»move_cÚÃùiÚpošt
(&
bez›r
->
objeù
, 
Şd_ı1
);

402 
	`objeù_»move_cÚÃùiÚpošt
(&
bez›r
->
objeù
, 
Şd_ı2
);

403 
	}
}

408 
ObjeùChªge
 *

409 
	$bez›rsh­e_add_£gm’t
(
Bez›rSh­e
 *
bez›r
, 
£gm’t
, 
Pošt
 *
pošt
)

411 
BezPošt
 
»®pošt
;

412 
BezCÜÃrTy³
 
cÜÃr_ty³
 = 
BEZ_CORNER_SYMMETRIC
;

413 
HªdË
 *
Ãw_hªdË1
, *
Ãw_hªdË2
, *
Ãw_hªdË3
;

414 
CÚÃùiÚPošt
 *
Ãw_ı1
, *
Ãw_ı2
;

415 
Pošt
 
¡¬ošt
;

416 
Pošt
 
Ùh”
;

418 ià(
£gm’t
 != 1)

419 
¡¬ošt
 = 
bez›r
->
pošts
[
£gm’t
-1].
p3
;

421 
¡¬ošt
 = 
bez›r
->
pošts
[0].
p1
;

422 
Ùh”
 = 
bez›r
->
pošts
[
£gm’t
].
p3
;

423 ià(
pošt
 =ğ
NULL
) {

424 
»®pošt
.
p1
.
x
 = (
¡¬ošt
.x + 
Ùh”
.x)/6;

425 
»®pošt
.
p1
.
y
 = (
¡¬ošt
.y + 
Ùh”
.y)/6;

426 
»®pošt
.
p2
.
x
 = (
¡¬ošt
.x + 
Ùh”
.x)/3;

427 
»®pošt
.
p2
.
y
 = (
¡¬ošt
.y + 
Ùh”
.y)/3;

428 
»®pošt
.
p3
.
x
 = (
¡¬ošt
.x + 
Ùh”
.x)/2;

429 
»®pošt
.
p3
.
y
 = (
¡¬ošt
.y + 
Ùh”
.y)/2;

431 
»®pošt
.
p2
.
x
 = 
pošt
->x+(
¡¬ošt
.x-
Ùh”
.x)/6;

432 
»®pošt
.
p2
.
y
 = 
pošt
->y+(
¡¬ošt
.y-
Ùh”
.y)/6;

434 
»®pošt
.
p3
 = *
pošt
;

436 
»®pošt
.
p1
.
x
 = 
pošt
->x-(
¡¬ošt
.x-
Ùh”
.x)/6;

437 
»®pošt
.
p1
.
y
 = 
pošt
->y-(
¡¬ošt
.y-
Ùh”
.y)/6;

439 
»®pošt
.
ty³
 = 
BEZ_CURVE_TO
;

441 
Ãw_hªdË1
 = 
	`g_Ãw0
(
HªdË
,1);

442 
Ãw_hªdË2
 = 
	`g_Ãw0
(
HªdË
,1);

443 
Ãw_hªdË3
 = 
	`g_Ãw0
(
HªdË
,1);

444 
	`£tup_hªdË
(
Ãw_hªdË1
, 
HANDLE_RIGHTCTRL
);

445 
	`£tup_hªdË
(
Ãw_hªdË2
, 
HANDLE_LEFTCTRL
);

446 
	`£tup_hªdË
(
Ãw_hªdË3
, 
HANDLE_BEZMAJOR
);

447 
Ãw_ı1
 = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

448 
Ãw_ı2
 = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

449 
Ãw_ı1
->
objeù
 = &
bez›r
->object;

450 
Ãw_ı2
->
objeù
 = &
bez›r
->object;

451 
	`add_hªdËs
(
bez›r
, 
£gm’t
, &
»®pošt
, 
cÜÃr_ty³
,

452 
Ãw_hªdË1
, 
Ãw_hªdË2
, 
Ãw_hªdË3
, 
Ãw_ı1
, 
Ãw_ı2
);

453  
	`bez›rsh­e_ü—‹_pošt_chªge
(
bez›r
, 
TYPE_ADD_POINT
,

454 &
»®pošt
, 
cÜÃr_ty³
, 
£gm’t
,

455 
Ãw_hªdË1
, 
Ãw_hªdË2
, 
Ãw_hªdË3
,

456 
Ãw_ı1
, 
Ãw_ı2
);

457 
	}
}

459 
ObjeùChªge
 *

460 
	$bez›rsh­e_»move_£gm’t
(
Bez›rSh­e
 *
bez›r
, 
pos
)

462 
HªdË
 *
Şd_hªdË1
, *
Şd_hªdË2
, *
Şd_hªdË3
;

463 
CÚÃùiÚPošt
 *
Şd_ı1
, *
Şd_ı2
;

464 
BezPošt
 
Şd_pošt
;

465 
BezCÜÃrTy³
 
Şd_ùy³
;

466 
Ãxt
 = 
pos
+1;

468 
	`g_as£¹
(
pos
 > 0);

469 
	`g_as£¹
(
bez›r
->
numpošts
 > 2);

470 
	`g_as£¹
(
pos
 < 
bez›r
->
numpošts
);

472 ià(
pos
 =ğ
bez›r
->
numpošts
 - 1)

473 
Ãxt
 = 1;

475 
Şd_hªdË1
 = 
bez›r
->
objeù
.
hªdËs
[3*
pos
-3];

476 
Şd_hªdË2
 = 
bez›r
->
objeù
.
hªdËs
[3*
pos
-2];

477 
Şd_hªdË3
 = 
bez›r
->
objeù
.
hªdËs
[3*
pos
-1];

478 
Şd_pošt
 = 
bez›r
->
pošts
[
pos
];

480 
Şd_pošt
.
p1
 = 
bez›r
->
pošts
[
Ãxt
].p1;

481 
Şd_ùy³
 = 
bez›r
->
cÜÃr_ty³s
[
pos
];

483 
Şd_ı1
 = 
bez›r
->
objeù
.
cÚÃùiÚs
[2*
pos
-2];

484 
Şd_ı2
 = 
bez›r
->
objeù
.
cÚÃùiÚs
[2*
pos
-1];

486 
	`objeù_uncÚÃù
((
DŸObjeù
 *)
bez›r
, 
Şd_hªdË1
);

487 
	`objeù_uncÚÃù
((
DŸObjeù
 *)
bez›r
, 
Şd_hªdË2
);

488 
	`objeù_uncÚÃù
((
DŸObjeù
 *)
bez›r
, 
Şd_hªdË3
);

490 
	`»move_hªdËs
(
bez›r
, 
pos
);

492 
	`bez›rsh­e_upd©e_d©a
(
bez›r
);

494  
	`bez›rsh­e_ü—‹_pošt_chªge
(
bez›r
, 
TYPE_REMOVE_POINT
,

495 &
Şd_pošt
, 
Şd_ùy³
, 
pos
,

496 
Şd_hªdË1
, 
Şd_hªdË2
, 
Şd_hªdË3
,

497 
Şd_ı1
, 
Şd_ı2
);

498 
	}
}

501 
	$bez›rsh­e_¡¿igh‹n_cÜÃr
(
Bez›rSh­e
 *
bez
, 
comp_Ä
) {

502 
Ãxt_Ä
;

504 ià(
comp_Ä
 =ğ0ècomp_Ä = 
bez
->
numpošts
 - 1;

505 
Ãxt_Ä
 = 
comp_Ä
 + 1;

506 ià(
comp_Ä
 =ğ
bez
->
numpošts
 - 1)

507 
Ãxt_Ä
 = 1;

511 
bez
->
pošts
[0].
p3
 = bez->pošts[0].
p1
;

512 
bez
->
cÜÃr_ty³s
[
comp_Ä
]) {

513 
BEZ_CORNER_SYMMETRIC
: {

514 
Pošt
 
±1
, 
±2
;

516 
±1
 = 
bez
->
pošts
[
comp_Ä
].
p3
;

517 
	`pošt_sub
(&
±1
, &
bez
->
pošts
[
comp_Ä
].
p2
);

518 
±2
 = 
bez
->
pošts
[
comp_Ä
].
p3
;

519 
	`pošt_sub
(&
±2
, &
bez
->
pošts
[
Ãxt_Ä
].
p1
);

520 
	`pošt_sÿË
(&
±2
, -1.0);

521 
	`pošt_add
(&
±1
, &
±2
);

522 
	`pošt_sÿË
(&
±1
, 0.5);

523 
±2
 = 
±1
;

524 
	`pošt_sÿË
(&
±1
, -1.0);

525 
	`pošt_add
(&
±1
, &
bez
->
pošts
[
comp_Ä
].
p3
);

526 
	`pošt_add
(&
±2
, &
bez
->
pošts
[
comp_Ä
].
p3
);

527 
bez
->
pošts
[
comp_Ä
].
p2
 = 
±1
;

528 
bez
->
pošts
[
Ãxt_Ä
].
p1
 = 
±2
;

529 
	`bez›rsh­e_upd©e_d©a
(
bez
);

532 
BEZ_CORNER_SMOOTH
: {

533 
Pošt
 
±1
, 
±2
;

534 
»®
 
Ën1
, 
Ën2
;

535 
±1
 = 
bez
->
pošts
[
comp_Ä
].
p3
;

536 
	`pošt_sub
(&
±1
, &
bez
->
pošts
[
comp_Ä
].
p2
);

537 
±2
 = 
bez
->
pošts
[
comp_Ä
].
p3
;

538 
	`pošt_sub
(&
±2
, &
bez
->
pošts
[
Ãxt_Ä
].
p1
);

539 
Ën1
 = 
	`pošt_Ën
(&
±1
);

540 
Ën2
 = 
	`pošt_Ën
(&
±2
);

541 
	`pošt_sÿË
(&
±2
, -1.0);

542 ià(
Ën1
 > 0)

543 
	`pošt_nÜm®ize
(&
±1
);

544 ià(
Ën2
 > 0)

545 
	`pošt_nÜm®ize
(&
±2
);

546 
	`pošt_add
(&
±1
, &
±2
);

547 
	`pošt_sÿË
(&
±1
, 0.5);

548 
±2
 = 
±1
;

549 
	`pošt_sÿË
(&
±1
, -
Ën1
);

550 
	`pošt_add
(&
±1
, &
bez
->
pošts
[
comp_Ä
].
p3
);

551 
	`pošt_sÿË
(&
±2
, 
Ën2
);

552 
	`pošt_add
(&
±2
, &
bez
->
pošts
[
comp_Ä
].
p3
);

553 
bez
->
pošts
[
comp_Ä
].
p2
 = 
±1
;

554 
bez
->
pošts
[
Ãxt_Ä
].
p1
 = 
±2
;

555 
	`bez›rsh­e_upd©e_d©a
(
bez
);

558 
BEZ_CORNER_CUSP
:

561 
bez
->
pošts
[0].
p1
 = bez->pošts[0].
p3
;

562 
	}
}

564 
ObjeùChªge
 *

565 
	$bez›rsh­e_£t_cÜÃr_ty³
(
Bez›rSh­e
 *
bez
, 
HªdË
 *
hªdË
,

566 
BezCÜÃrTy³
 
cÜÃr_ty³
)

568 
HªdË
 *
mid_hªdË
 = 
NULL
;

569 
Pošt
 
Şd_Ëá
, 
Şd_right
;

570 
Şd_ty³
;

571 
hªdË_Ä
, 
comp_Ä
;

573 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
bez
, 
hªdË
);

575 
hªdË
->
id
) {

576 
HANDLE_BEZMAJOR
:

577 
mid_hªdË
 = 
hªdË
;

579 
HANDLE_LEFTCTRL
:

580 
hªdË_Ä
++;

581 ià(
hªdË_Ä
 =ğ
bez
->
objeù
.
num_hªdËs
) handle_nr = 0;

582 
mid_hªdË
 = 
bez
->
objeù
.
hªdËs
[
hªdË_Ä
];

584 
HANDLE_RIGHTCTRL
:

585 
hªdË_Ä
--;

586 ià(
hªdË_Ä
 < 0èhªdË_Ä = 
bez
->
objeù
.
num_hªdËs
 - 1;

587 
mid_hªdË
 = 
bez
->
objeù
.
hªdËs
[
hªdË_Ä
];

590 
	`g_as£¹_nÙ_»ached
();

594 
comp_Ä
 = 
	`g‘_majÜ_Ä
(
hªdË_Ä
);

596 
Şd_ty³
 = 
bez
->
cÜÃr_ty³s
[
comp_Ä
];

597 
Şd_Ëá
 = 
bez
->
pošts
[
comp_Ä
].
p2
;

598 ià(
comp_Ä
 =ğ
bez
->
numpošts
 - 1)

599 
Şd_right
 = 
bez
->
pošts
[1].
p1
;

601 
Şd_right
 = 
bez
->
pošts
[
comp_Ä
+1].
p1
;

604 
	`g_mes§ge
("S‘tšg cÜÃ¸ty³ oÀ£gm’ˆ%dØ%s", 
comp_Ä
,

605 
cÜÃr_ty³
 =ğ
BEZ_CORNER_SYMMETRIC
 ? "symmetric" :

606 
cÜÃr_ty³
 =ğ
BEZ_CORNER_SMOOTH
 ? "smooth" : "cusp");

608 
bez
->
cÜÃr_ty³s
[
comp_Ä
] = 
cÜÃr_ty³
;

609 ià(
comp_Ä
 == 0)

610 
bez
->
cÜÃr_ty³s
[bez->
numpošts
-1] = 
cÜÃr_ty³
;

611 ià(
comp_Ä
 =ğ
bez
->
numpošts
 - 1)

612 
bez
->
cÜÃr_ty³s
[0] = 
cÜÃr_ty³
;

614 
	`bez›rsh­e_¡¿igh‹n_cÜÃr
(
bez
, 
comp_Ä
);

616  
	`bez›rsh­e_ü—‹_cÜÃr_chªge
(
bez
, 
mid_hªdË
, &
Şd_Ëá
,

617 &
Şd_right
, 
Şd_ty³
, 
cÜÃr_ty³
);

618 
	}
}

621 
	$bez›rsh­e_upd©e_d©a
(
Bez›rSh­e
 *
bez›r
)

623 
i
;

624 
Pošt
 
Ï¡
;

625 
Pošt
 
mšp
, 
maxp
;

627 
DŸObjeù
 *
obj
 = &
bez›r
->
objeù
;

630 ià(3*(
bez›r
->
numpošts
-1è!ğ
obj
->
num_hªdËs
 ||

631 2*(
bez›r
->
numpošts
-1è+ 1 !ğ
obj
->
num_cÚÃùiÚs
) {

632 
	`objeù_uncÚÃù_®l
(
obj
);

635 
i
 = 0; i < 
obj
->
num_hªdËs
; i++)

636 
	`g_ä“
(
obj
->
hªdËs
[
i
]);

637 
	`g_ä“
(
obj
->
hªdËs
);

638 
i
 = 0; i < 
obj
->
num_cÚÃùiÚs
; i++)

639 
	`g_ä“
(
obj
->
cÚÃùiÚs
[
i
]);

640 
	`g_ä“
(
obj
->
cÚÃùiÚs
);

642 
obj
->
num_hªdËs
 = 3*(
bez›r
->
numpošts
-1);

643 
obj
->
hªdËs
 = 
	`g_Ãw
(
HªdË
*, obj->
num_hªdËs
);

644 
obj
->
num_cÚÃùiÚs
 = 2*(
bez›r
->
numpošts
-1) + 1;

645 
obj
->
cÚÃùiÚs
 = 
	`g_Ãw
(
CÚÃùiÚPošt
 *, obj->
num_cÚÃùiÚs
);

647 
	`Ãw_hªdËs_ªd_cÚÃùiÚs
(
bez›r
, bez›r->
numpošts
);

649 
bez›r
->
cÜÃr_ty³s
 = 
	`g_»®loc
(bez›r->cÜÃr_ty³s, bez›r->
numpošts
*(
BezCÜÃrTy³
));

650 
i
 = 0; i < 
bez›r
->
numpošts
; i++)

651 
bez›r
->
cÜÃr_ty³s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

655 
bez›r
->
pošts
[0].
p3
 = bez›r->pošts[0].
p1
;

656 
i
 = 1; i < 
bez›r
->
numpošts
; i++) {

657 
obj
->
hªdËs
[3*
i
-3]->
pos
 = 
bez›r
->
pošts
[i].
p1
;

658 
obj
->
hªdËs
[3*
i
-2]->
pos
 = 
bez›r
->
pošts
[i].
p2
;

659 
obj
->
hªdËs
[3*
i
-1]->
pos
 = 
bez›r
->
pošts
[i].
p3
;

663 
Ï¡
 = 
bez›r
->
pošts
[0].
p1
;

664 
i
 = 1; i < 
bez›r
->
numpošts
; i++) {

665 
Pošt
 
¦İ•ošt1
, 
¦İ•ošt2
;

666 
¦İ•ošt1
 = 
bez›r
->
pošts
[
i
].
p1
;

667 
	`pošt_sub
(&
¦İ•ošt1
, &
Ï¡
);

668 
	`pošt_sÿË
(&
¦İ•ošt1
, .5);

669 
	`pošt_add
(&
¦İ•ošt1
, &
Ï¡
);

670 
¦İ•ošt2
 = 
bez›r
->
pošts
[
i
].
p2
;

671 
	`pošt_sub
(&
¦İ•ošt2
, &
bez›r
->
pošts
[
i
].
p3
);

672 
	`pošt_sÿË
(&
¦İ•ošt2
, .5);

673 
	`pošt_add
(&
¦İ•ošt2
, &
bez›r
->
pošts
[
i
].
p3
);

675 
obj
->
cÚÃùiÚs
[2*
i
-2]->
pos
 = 
Ï¡
;

676 
obj
->
cÚÃùiÚs
[2*
i
-2]->
dœeùiÚs
 =

677 
	`fšd_¦İe_dœeùiÚs
(
Ï¡
, 
bez›r
->
pošts
[
i
].
p1
);

678 
obj
->
cÚÃùiÚs
[2*
i
-1]->
pos
.
x
 =

679 (
Ï¡
.
x
 + 3*
bez›r
->
pošts
[
i
].
p1
.x + 3*bez›r->pošts[i].
p2
.x +

680 
bez›r
->
pošts
[
i
].
p3
.
x
)/8;

681 
obj
->
cÚÃùiÚs
[2*
i
-1]->
pos
.
y
 =

682 (
Ï¡
.
y
 + 3*
bez›r
->
pošts
[
i
].
p1
.y + 3*bez›r->pošts[i].
p2
.y +

683 
bez›r
->
pošts
[
i
].
p3
.
y
)/8;

684 
obj
->
cÚÃùiÚs
[2*
i
-1]->
dœeùiÚs
 =

685 
	`fšd_¦İe_dœeùiÚs
(
¦İ•ošt1
, 
¦İ•ošt2
);

686 
Ï¡
 = 
bez›r
->
pošts
[
i
].
p3
;

690 
mšp
 = 
maxp
 = 
bez›r
->
pošts
[0].
p1
;

691 
i
 = 1; i < 
bez›r
->
numpošts
; i++) {

692 
Pošt
 
p
 = 
bez›r
->
pošts
[
i
].
p3
;

693 ià(
p
.
x
 < 
mšp
.x) minp.x =….x;

694 ià(
p
.
x
 > 
maxp
.x) maxp.x =….x;

695 ià(
p
.
y
 < 
mšp
.y) minp.y =….y;

696 ià(
p
.
y
 > 
maxp
.y) maxp.y =….y;

698 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1]->
pos
.
x
 = (
mšp
.x + 
maxp
.x) / 2;

699 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1]->
pos
.
y
 = (
mšp
.y + 
maxp
.y) / 2;

700 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1]->
dœeùiÚs
 = 
DIR_ALL
;

701 
	}
}

704 
	$bez›rsh­e_upd©e_boundšgbox
(
Bez›rSh­e
 *
bez›r
)

706 
EËm’tBBExŒas
 *
exŒa
;

707 
PŞyBBExŒas
 
³xŒa
;

709 
	`g_as£¹
(
bez›r
 !ğ
NULL
);

711 
exŒa
 = &
bez›r
->
exŒa_¥acšg
;

712 
³xŒa
.
¡¬t_Œªs
 =…exŒa.
’d_Œªs
 =

713 
³xŒa
.
¡¬t_lÚg
 =…exŒa.
’d_lÚg
 = 0;

714 
³xŒa
.
middË_Œªs
 = 
exŒa
->
bÜd”_Œªs
;

716 
	`pŞybez›r_bbox
(&
bez›r
->
pošts
[0],

717 
bez›r
->
numpošts
,

718 &
³xŒa
, 
TRUE
,

719 &
bez›r
->
objeù
.
boundšg_box
);

720 
	}
}

723 
	$bez›rsh­e_sim¶e_d¿w
(
Bez›rSh­e
 *
bez›r
, 
DŸR’d””
 *
»nd””
, 
»®
 
width
)

725 
BezPošt
 *
pošts
;

727 
	`g_as£¹
(
bez›r
 !ğ
NULL
);

728 
	`g_as£¹
(
»nd””
 !ğ
NULL
);

730 
pošts
 = &
bez›r
->points[0];

732 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
width
);

733 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

734 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_ROUND
);

735 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

737 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`fl_bez›r
Ô’d””, 
pošts
, 
bez›r
->
numpošts
,&
cŞÜ_wh™e
);

738 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_bez›r
Ô’d””, 
pošts
, 
bez›r
->
numpošts
,&
cŞÜ_bÏck
);

739 
	}
}

742 
	$bez›rsh­e_d¿w_cÚŒŞ_lšes
(
Bez›rSh­e
 *
bez
, 
DŸR’d””
 *
»nd””
)

744 
CŞÜ
 
lše_cŞour
 = {0.0, 0.0, 0.6};

745 
Pošt
 
¡¬ošt
;

746 
i
;

749 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
(renderer, 0);

750 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_DOTTED
);

751 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_dashËngth
(renderer, 1);

752 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

753 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

755 
¡¬ošt
 = 
bez
->
pošts
[0].
p1
;

756 
i
 = 1; i < 
bez
->
numpošts
; i++) {

757 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
¡¬ošt
, &
bez
->
pošts
[
i
].
p1
,

758 &
lše_cŞour
);

759 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
bez
->
pošts
[
i
].
p2
, &bez->pošts[i].
p3
,

760 &
lše_cŞour
);

761 
¡¬ošt
 = 
bez
->
pošts
[
i
].
p3
;

763 
	}
}

766 
	$Ãw_hªdËs_ªd_cÚÃùiÚs
(
Bez›rSh­e
 *
bez›r
, 
num_pošts
)

768 
DŸObjeù
 *
obj
;

769 
i
;

771 
obj
 = &
bez›r
->
objeù
;

773 
i
 = 0; i < 
num_pošts
-1; i++) {

774 
obj
->
hªdËs
[3*
i
] = 
	`g_Ãw0
(
HªdË
,1);

775 
obj
->
hªdËs
[3*
i
+1] = 
	`g_Ãw0
(
HªdË
,1);

776 
obj
->
hªdËs
[3*
i
+2] = 
	`g_Ãw0
(
HªdË
,1);

778 
obj
->
hªdËs
[3*
i
]->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

779 
obj
->
hªdËs
[3*
i
]->
cÚÃùed_to
 = 
NULL
;

780 
obj
->
hªdËs
[3*
i
]->
ty³
 = 
HANDLE_MINOR_CONTROL
;

781 
obj
->
hªdËs
[3*
i
]->
id
 = 
HANDLE_RIGHTCTRL
;

783 
obj
->
hªdËs
[3*
i
+1]->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

784 
obj
->
hªdËs
[3*
i
+1]->
cÚÃùed_to
 = 
NULL
;

785 
obj
->
hªdËs
[3*
i
+1]->
ty³
 = 
HANDLE_MINOR_CONTROL
;

786 
obj
->
hªdËs
[3*
i
+1]->
id
 = 
HANDLE_LEFTCTRL
;

788 
obj
->
hªdËs
[3*
i
+2]->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

789 
obj
->
hªdËs
[3*
i
+2]->
cÚÃùed_to
 = 
NULL
;

790 
obj
->
hªdËs
[3*
i
+2]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

791 
obj
->
hªdËs
[3*
i
+2]->
id
 = 
HANDLE_BEZMAJOR
;

793 
obj
->
cÚÃùiÚs
[2*
i
] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

794 
obj
->
cÚÃùiÚs
[2*
i
+1] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

795 
obj
->
cÚÃùiÚs
[2*
i
]->
objeù
 = obj;

796 
obj
->
cÚÃùiÚs
[2*
i
+1]->
objeù
 = obj;

797 
obj
->
cÚÃùiÚs
[2*
i
]->
æags
 = 0;

798 
obj
->
cÚÃùiÚs
[2*
i
+1]->
æags
 = 0;

802 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

803 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1]->
objeù
 = obj;

804 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1]->
æags
 = 
CP_FLAGS_MAIN
;

805 
	}
}

808 
	$bez›rsh­e_š™
(
Bez›rSh­e
 *
bez›r
, 
num_pošts
)

810 
DŸObjeù
 *
obj
;

811 
i
;

813 
obj
 = &
bez›r
->
objeù
;

815 
	`objeù_š™
(
obj
, 3*(
num_pošts
-1), 2*(num_points-1) + 1);

817 
bez›r
->
numpošts
 = 
num_pošts
;

819 
bez›r
->
pošts
 = 
	`g_Ãw
(
BezPošt
, 
num_pošts
);

820 
bez›r
->
pošts
[0].
ty³
 = 
BEZ_MOVE_TO
;

821 
bez›r
->
cÜÃr_ty³s
 = 
	`g_Ãw
(
BezCÜÃrTy³
, 
num_pošts
);

822 
i
 = 1; i < 
num_pošts
; i++) {

823 
bez›r
->
pošts
[
i
].
ty³
 = 
BEZ_CURVE_TO
;

824 
bez›r
->
cÜÃr_ty³s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

827 
	`Ãw_hªdËs_ªd_cÚÃùiÚs
(
bez›r
, 
num_pošts
);

832 
	}
}

837 
	$bez›rsh­e_£t_pošts
(
Bez›rSh­e
 *
bez
, 
num_pošts
, 
BezPošt
 *
pošts
)

839 
i
;

841 
bez
->
numpošts
 = 
num_pošts
;

843 ià(
bez
->
pošts
)

844 
	`g_ä“
(
bez
->
pošts
);

846 
bez
->
pošts
 = 
	`g_m®loc
((bez->
numpošts
)*(
BezPošt
));

848 
i
=0;i<
bez
->
numpošts
;i++) {

849 
bez
->
pošts
[
i
] =…oints[i];

851 
	}
}

854 
	$bez›rsh­e_cİy
(
Bez›rSh­e
 *
äom
, Bez›rSh­*
to
)

856 
i
;

857 
DŸObjeù
 *
toobj
, *
äomobj
;

859 
toobj
 = &
to
->
objeù
;

860 
äomobj
 = &
äom
->
objeù
;

862 
	`objeù_cİy
(
äomobj
, 
toobj
);

864 
to
->
numpošts
 = 
äom
->numpoints;

866 
to
->
pošts
 = 
	`g_Ãw
(
BezPošt
,o->
numpošts
);

867 
to
->
cÜÃr_ty³s
 = 
	`g_Ãw
(
BezCÜÃrTy³
,o->
numpošts
);

869 
i
 = 0; i < 
to
->
numpošts
; i++) {

870 
to
->
pošts
[
i
] = 
äom
->points[i];

871 
to
->
cÜÃr_ty³s
[
i
] = 
äom
->corner_types[i];

874 
i
 = 0; i < 
toobj
->
num_hªdËs
; i++) {

875 
toobj
->
hªdËs
[
i
] = 
	`g_Ãw0
(
HªdË
,1);

876 
	`£tup_hªdË
(
toobj
->
hªdËs
[
i
], 
äomobj
->hªdËs[i]->
id
);

878 
i
 = 0; i < 
toobj
->
num_cÚÃùiÚs
; i++) {

879 
toobj
->
cÚÃùiÚs
[
i
] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

880 
toobj
->
cÚÃùiÚs
[
i
]->
objeù
 = &
to
->object;

881 
toobj
->
cÚÃùiÚs
[
i
]->
æags
 = 
äomobj
->connections[i]->flags;

884 
	`memıy
(&
to
->
exŒa_¥acšg
,&
äom
->extra_spacing,(to->extra_spacing));

885 
	`bez›rsh­e_upd©e_d©a
(
to
);

886 
	}
}

889 
	$bez›rsh­e_de¡roy
(
Bez›rSh­e
 *
bez›r
)

891 
i
;

892 
HªdË
 **
‹mp_hªdËs
;

893 
CÚÃùiÚPošt
 **
‹mp_ıs
;

897 
‹mp_hªdËs
 = 
	`g_Ãw
(
HªdË
 *, 
bez›r
->
objeù
.
num_hªdËs
);

898 
i
 = 0; i < 
bez›r
->
objeù
.
num_hªdËs
; i++)

899 
‹mp_hªdËs
[
i
] = 
bez›r
->
objeù
.
hªdËs
[i];

901 
‹mp_ıs
 = 
	`g_Ãw
(
CÚÃùiÚPošt
 *, 
bez›r
->
objeù
.
num_cÚÃùiÚs
);

902 
i
 = 0; i < 
bez›r
->
objeù
.
num_cÚÃùiÚs
; i++)

903 
‹mp_ıs
[
i
] = 
bez›r
->
objeù
.
cÚÃùiÚs
[i];

905 
	`objeù_de¡roy
(&
bez›r
->
objeù
);

907 
i
 = 0; i < 
bez›r
->
objeù
.
num_hªdËs
; i++)

908 
	`g_ä“
(
‹mp_hªdËs
[
i
]);

909 
	`g_ä“
(
‹mp_hªdËs
);

911 
i
 = 0; i < 
bez›r
->
objeù
.
num_cÚÃùiÚs
; i++)

912 
	`g_ä“
(
‹mp_ıs
[
i
]);

913 
	`g_ä“
(
‹mp_ıs
);

915 
	`g_ä“
(
bez›r
->
pošts
);

916 
	`g_ä“
(
bez›r
->
cÜÃr_ty³s
);

917 
	}
}

921 
	$bez›rsh­e_§ve
(
Bez›rSh­e
 *
bez›r
, 
ObjeùNode
 
obj_node
)

923 
i
;

924 
A‰ribu‹Node
 
©Œ
;

926 
	`objeù_§ve
(&
bez›r
->
objeù
, 
obj_node
);

928 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "bez_points");

930 
	`d©a_add_pošt
(
©Œ
, &
bez›r
->
pošts
[0].
p1
);

931 
i
 = 1; i < 
bez›r
->
numpošts
; i++) {

932 
	`d©a_add_pošt
(
©Œ
, &
bez›r
->
pošts
[
i
].
p1
);

933 
	`d©a_add_pošt
(
©Œ
, &
bez›r
->
pošts
[
i
].
p2
);

934 ià(
i
 < 
bez›r
->
numpošts
 - 1)

935 
	`d©a_add_pošt
(
©Œ
, &
bez›r
->
pošts
[
i
].
p3
);

938 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "corner_types");

939 
i
 = 0; i < 
bez›r
->
numpošts
; i++)

940 
	`d©a_add_’um
(
©Œ
, 
bez›r
->
cÜÃr_ty³s
[
i
]);

941 
	}
}

944 
	$bez›rsh­e_lßd
(
Bez›rSh­e
 *
bez›r
, 
ObjeùNode
 
obj_node
)

946 
i
;

947 
A‰ribu‹Node
 
©Œ
;

948 
D©aNode
 
d©a
;

950 
DŸObjeù
 *
obj
 = &
bez›r
->
objeù
;

952 
	`objeù_lßd
(
obj
, 
obj_node
);

954 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "bez_points");

956 ià(
©Œ
 !ğ
NULL
)

957 
bez›r
->
numpošts
 = 
	`©Œibu‹_num_d©a
(
©Œ
) / 3 + 1;

959 
bez›r
->
numpošts
 = 0;

961 
	`objeù_š™
(
obj
, 3 * (
bez›r
->
numpošts
 - 1),

962 2 * (
bez›r
->
numpošts
 - 1) + 1);

964 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

965 ià(
bez›r
->
numpošts
 != 0) {

966 
bez›r
->
pošts
 = 
	`g_Ãw
(
BezPošt
, bez›r->
numpošts
);

967 
bez›r
->
pošts
[0].
ty³
 = 
BEZ_MOVE_TO
;

968 
	`d©a_pošt
(
d©a
, &
bez›r
->
pošts
[0].
p1
);

969 
bez›r
->
pošts
[0].
p3
 = bez›r->pošts[0].
p1
;

970 
d©a
 = 
	`d©a_Ãxt
(data);

972 
i
 = 1; i < 
bez›r
->
numpošts
; i++) {

973 
bez›r
->
pošts
[
i
].
ty³
 = 
BEZ_CURVE_TO
;

974 
	`d©a_pošt
(
d©a
, &
bez›r
->
pošts
[
i
].
p1
);

975 
d©a
 = 
	`d©a_Ãxt
(data);

976 
	`d©a_pošt
(
d©a
, &
bez›r
->
pošts
[
i
].
p2
);

977 
d©a
 = 
	`d©a_Ãxt
(data);

978 ià(
i
 < 
bez›r
->
numpošts
 - 1) {

979 
	`d©a_pošt
(
d©a
, &
bez›r
->
pošts
[
i
].
p3
);

980 
d©a
 = 
	`d©a_Ãxt
(data);

982 
bez›r
->
pošts
[
i
].
p3
 = bez›r->pošts[0].
p1
;

986 
bez›r
->
cÜÃr_ty³s
 = 
	`g_Ãw
(
BezCÜÃrTy³
, bez›r->
numpošts
);

987 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "corner_types");

988 ià(!
©Œ
 || 
	`©Œibu‹_num_d©a
×‰rè!ğ
bez›r
->
numpošts
) {

989 
i
 = 0; i < 
bez›r
->
numpošts
; i++)

990 
bez›r
->
cÜÃr_ty³s
[
i
] = 
BEZ_CORNER_SYMMETRIC
;

992 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

993 
i
 = 0; i < 
bez›r
->
numpošts
; i++) {

994 
bez›r
->
cÜÃr_ty³s
[
i
] = 
	`d©a_’um
(
d©a
);

995 
d©a
 = 
	`d©a_Ãxt
(data);

999 
i
 = 0; i < 
bez›r
->
numpošts
 - 1; i++) {

1000 
obj
->
hªdËs
[3*
i
] = 
	`g_Ãw0
(
HªdË
,1);

1001 
obj
->
hªdËs
[3*
i
+1] = 
	`g_Ãw0
(
HªdË
,1);

1002 
obj
->
hªdËs
[3*
i
+2] = 
	`g_Ãw0
(
HªdË
,1);

1004 
	`£tup_hªdË
(
obj
->
hªdËs
[3*
i
], 
HANDLE_RIGHTCTRL
);

1005 
	`£tup_hªdË
(
obj
->
hªdËs
[3*
i
+1], 
HANDLE_LEFTCTRL
);

1006 
	`£tup_hªdË
(
obj
->
hªdËs
[3*
i
+2], 
HANDLE_BEZMAJOR
);

1008 
i
 = 0; i < 
obj
->
num_cÚÃùiÚs
; i++) {

1009 
obj
->
cÚÃùiÚs
[
i
] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

1010 
obj
->
cÚÃùiÚs
[
i
]->
objeù
 = obj;

1012 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1]->
æags
 = 
CP_FLAGS_MAIN
;

1014 
	`bez›rsh­e_upd©e_d©a
(
bez›r
);

1015 
	}
}

1018 
	$bez›rsh­e_pošt_chªge_ä“
(
BezPoštChªge
 *
chªge
)

1020 iàĞ(
chªge
->
ty³
==
TYPE_ADD_POINT
 && !chªge->
­¶›d
) ||

1021 (
chªge
->
ty³
==
TYPE_REMOVE_POINT
 && chªge->
­¶›d
) ){

1022 
	`g_ä“
(
chªge
->
hªdË1
);

1023 
	`g_ä“
(
chªge
->
hªdË2
);

1024 
	`g_ä“
(
chªge
->
hªdË3
);

1025 
	`g_ä“
(
chªge
->
ı1
);

1026 
	`g_ä“
(
chªge
->
ı2
);

1027 
chªge
->
hªdË1
 = 
NULL
;

1028 
chªge
->
hªdË2
 = 
NULL
;

1029 
chªge
->
hªdË3
 = 
NULL
;

1030 
chªge
->
ı1
 = 
NULL
;

1031 
chªge
->
ı2
 = 
NULL
;

1033 
	}
}

1036 
	$bez›rsh­e_pošt_chªge_­¶y
(
BezPoštChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1038 
chªge
->
­¶›d
 = 1;

1039 
chªge
->
ty³
) {

1040 
TYPE_ADD_POINT
:

1041 
	`add_hªdËs
((
Bez›rSh­e
 *)
obj
, 
chªge
->
pos
, &chªge->
pošt
,

1042 
chªge
->
cÜÃr_ty³
,

1043 
chªge
->
hªdË1
, chªge->
hªdË2
, chªge->
hªdË3
,

1044 
chªge
->
ı1
, chªge->
ı2
);

1046 
TYPE_REMOVE_POINT
:

1047 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË1
);

1048 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË2
);

1049 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË3
);

1050 
	`»move_hªdËs
((
Bez›rSh­e
 *)
obj
, 
chªge
->
pos
);

1053 
	}
}

1056 
	$bez›rsh­e_pošt_chªge_»v”t
(
BezPoštChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1058 
chªge
->
ty³
) {

1059 
TYPE_ADD_POINT
:

1060 
	`»move_hªdËs
((
Bez›rSh­e
 *)
obj
, 
chªge
->
pos
);

1062 
TYPE_REMOVE_POINT
:

1063 
	`add_hªdËs
((
Bez›rSh­e
 *)
obj
, 
chªge
->
pos
, &chªge->
pošt
,

1064 
chªge
->
cÜÃr_ty³
,

1065 
chªge
->
hªdË1
, chªge->
hªdË2
, chªge->
hªdË3
,

1066 
chªge
->
ı1
, chªge->
ı2
);

1069 
chªge
->
­¶›d
 = 0;

1070 
	}
}

1072 
ObjeùChªge
 *

1073 
	$bez›rsh­e_ü—‹_pošt_chªge
(
Bez›rSh­e
 *
bez›r
, 
chªge_ty³
 
ty³
,

1074 
BezPošt
 *
pošt
, 
BezCÜÃrTy³
 
cÜÃr_ty³
,

1075 
pos
,

1076 
HªdË
 *
hªdË1
, HªdË *
hªdË2
,

1077 
HªdË
 *
hªdË3
,

1078 
CÚÃùiÚPošt
 *
ı1
, CÚÃùiÚPošˆ*
ı2
)

1080 
BezPoštChªge
 *
chªge
;

1082 
chªge
 = 
	`g_Ãw
(
BezPoštChªge
, 1);

1084 
chªge
->
obj_chªge
.
­¶y
 =

1085 (
ObjeùChªgeAµlyFunc
)
bez›rsh­e_pošt_chªge_­¶y
;

1086 
chªge
->
obj_chªge
.
»v”t
 =

1087 (
ObjeùChªgeRev”tFunc
)
bez›rsh­e_pošt_chªge_»v”t
;

1088 
chªge
->
obj_chªge
.
ä“
 =

1089 (
ObjeùChªgeF»eFunc
)
bez›rsh­e_pošt_chªge_ä“
;

1091 
chªge
->
ty³
 =ype;

1092 
chªge
->
­¶›d
 = 1;

1093 
chªge
->
pošt
 = *point;

1094 
chªge
->
cÜÃr_ty³
 = corner_type;

1095 
chªge
->
pos
 =…os;

1096 
chªge
->
hªdË1
 = handle1;

1097 
chªge
->
hªdË2
 = handle2;

1098 
chªge
->
hªdË3
 = handle3;

1099 
chªge
->
ı1
 = cp1;

1100 
chªge
->
ı2
 = cp2;

1102  (
ObjeùChªge
 *)
chªge
;

1103 
	}
}

1106 
	$bez›rsh­e_cÜÃr_chªge_­¶y
(
CÜÃrChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1108 
Bez›rSh­e
 *
bez
 = (Bez›rSh­*)
obj
;

1109 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
bez
, 
chªge
->
hªdË
);

1110 
comp_Ä
 = 
	`g‘_majÜ_Ä
(
hªdË_Ä
);

1112 
	`bez›rsh­e_¡¿igh‹n_cÜÃr
(
bez
, 
comp_Ä
);

1114 
bez
->
cÜÃr_ty³s
[
comp_Ä
] = 
chªge
->
Ãw_ty³
;

1115 ià(
comp_Ä
 == 0)

1116 
bez
->
cÜÃr_ty³s
[bez->
numpošts
-1] = 
chªge
->
Ãw_ty³
;

1117 ià(
comp_Ä
 =ğ
bez
->
numpošts
 - 1)

1118 
bez
->
cÜÃr_ty³s
[0] = 
chªge
->
Ãw_ty³
;

1120 
chªge
->
­¶›d
 = 1;

1121 
	}
}

1124 
	$bez›rsh­e_cÜÃr_chªge_»v”t
(
CÜÃrChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1126 
Bez›rSh­e
 *
bez
 = (Bez›rSh­*)
obj
;

1127 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
bez
, 
chªge
->
hªdË
);

1128 
comp_Ä
 = 
	`g‘_majÜ_Ä
(
hªdË_Ä
);

1130 
bez
->
pošts
[
comp_Ä
].
p2
 = 
chªge
->
pošt_Ëá
;

1131 ià(
comp_Ä
 =ğ
bez
->
numpošts
 - 1)

1132 
bez
->
pošts
[1].
p1
 = 
chªge
->
pošt_right
;

1134 
bez
->
pošts
[
comp_Ä
+1].
p1
 = 
chªge
->
pošt_right
;

1135 
bez
->
cÜÃr_ty³s
[
comp_Ä
] = 
chªge
->
Şd_ty³
;

1136 ià(
comp_Ä
 == 0)

1137 
bez
->
cÜÃr_ty³s
[bez->
numpošts
-1] = 
chªge
->
Ãw_ty³
;

1138 ià(
comp_Ä
 =ğ
bez
->
numpošts
 - 1)

1139 
bez
->
cÜÃr_ty³s
[0] = 
chªge
->
Ãw_ty³
;

1141 
chªge
->
­¶›d
 = 0;

1142 
	}
}

1144 
ObjeùChªge
 *

1145 
	$bez›rsh­e_ü—‹_cÜÃr_chªge
(
Bez›rSh­e
 *
bez
, 
HªdË
 *
hªdË
,

1146 
Pošt
 *
pošt_Ëá
, Pošˆ*
pošt_right
,

1147 
BezCÜÃrTy³
 
Şd_cÜÃr_ty³
,

1148 
BezCÜÃrTy³
 
Ãw_cÜÃr_ty³
)

1150 
CÜÃrChªge
 *
chªge
;

1152 
chªge
 = 
	`g_Ãw
(
CÜÃrChªge
, 1);

1154 
chªge
->
obj_chªge
.
­¶y
 =

1155 (
ObjeùChªgeAµlyFunc
)
bez›rsh­e_cÜÃr_chªge_­¶y
;

1156 
chªge
->
obj_chªge
.
»v”t
 =

1157 (
ObjeùChªgeRev”tFunc
)
bez›rsh­e_cÜÃr_chªge_»v”t
;

1158 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
)
NULL
;

1160 
chªge
->
Şd_ty³
 = 
Şd_cÜÃr_ty³
;

1161 
chªge
->
Ãw_ty³
 = 
Ãw_cÜÃr_ty³
;

1162 
chªge
->
­¶›d
 = 1;

1164 
chªge
->
hªdË
 = handle;

1165 
chªge
->
pošt_Ëá
 = *point_left;

1166 
chªge
->
pošt_right
 = *point_right;

1168  (
ObjeùChªge
 *)
chªge
;

1169 
	}
}

	@O:\tool\dvs50\lib\beziershape.h

24 #iâdeà
BEZIERSHAPE_H


25 
	#BEZIERSHAPE_H


	)

27 
	~"dŸty³s.h
"

28 
	~"objeù.h
"

30 
	~"bez›r_cÚn.h
"

32 
	#HANDLE_CORNER
 (
HANDLE_CUSTOM1
)

	)

37 
	s_Bez›rSh­e
 {

39 
DŸObjeù
 
	mobjeù
;

41 
	mnumpošts
;

42 
BezPošt
 *
	mpošts
;

43 
BezCÜÃrTy³
 *
	mcÜÃr_ty³s
;

44 
EËm’tBBExŒas
 
	mexŒa_¥acšg
;

47 
DIAVAR
 
bez›rsh­e_upd©e_d©a
(
Bez›rSh­e
 *
bez›r
);

48 
DIAVAR
 
bez›rsh­e_upd©e_boundšgbox
(
Bez›rSh­e
 *
bez›r
);

49 
bez›rsh­e_sim¶e_d¿w
(
Bez›rSh­e
 *
bez›r
, 
DŸR’d””
 *
»nd””
,

50 
»®
 
width
);

51 
DIAVAR
 
bez›rsh­e_š™
(
Bez›rSh­e
 *
bez›r
, 
num_pošts
);

52 
DIAVAR
 
bez›rsh­e_£t_pošts
(
Bez›rSh­e
 *
bez›r
, 
num_pošts
, 
BezPošt
 *
pošts
);

53 
DIAVAR
 
bez›rsh­e_de¡roy
(
Bez›rSh­e
 *
bez›r
);

54 
DIAVAR
 
bez›rsh­e_cİy
(
Bez›rSh­e
 *
äom
, Bez›rSh­*
to
);

55 
DIAVAR
 
bez›rsh­e_§ve
(
Bez›rSh­e
 *
bez›r
, 
ObjeùNode
 
obj_node
);

57 
DIAVAR
 
bez›rsh­e_lßd
(
Bez›rSh­e
 *
bez›r
, 
ObjeùNode
 
obj_node
);

58 
DIAVAR
 
ObjeùChªge
 *
bez›rsh­e_add_£gm’t
(
Bez›rSh­e
 *
bez›r
, 
£gm’t
,

59 
Pošt
 *
pošt
);

60 
DIAVAR
 
ObjeùChªge
 *
bez›rsh­e_»move_£gm’t
(
Bez›rSh­e
 *
bez›r
, 
pošt
);

61 
DIAVAR
 
ObjeùChªge
 *
bez›rsh­e_£t_cÜÃr_ty³
(
Bez›rSh­e
 *
bez
, 
HªdË
 *
hªdË
,

62 
BezCÜÃrTy³
 
cÜÃr_ty³
);

63 
DIAVAR
 
ObjeùChªge
 *
bez›rsh­e_move_hªdË
(
Bez›rSh­e
 *
bez›r
, 
HªdË
 *
id
,

64 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

65 
HªdËMoveR—sÚ
 
»asÚ
,

66 
Modif›rKeys
 
modif›rs
);

67 
DIAVAR
 
ObjeùChªge
 *
bez›rsh­e_move
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
to
);

68 
DIAVAR
 
»®
 
bez›rsh­e_di¡ªû_äom
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
pošt
,

69 
»®
 
lše_width
);

70 
DIAVAR
 
HªdË
 *
bez›rsh­e_şo£¡_hªdË
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
pošt
);

71 
DIAVAR
 
HªdË
 *
bez›rsh­e_şo£¡_majÜ_hªdË
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
pošt
);

72 
DIAVAR
 
bez›rsh­e_şo£¡_£gm’t
(
Bez›rSh­e
 *
bez›r
, 
Pošt
 *
pošt
,

73 
»®
 
lše_width
);

74 
DIAVAR
 
bez›rsh­e_d¿w_cÚŒŞ_lšes
(
Bez›rSh­e
 *
bez
, 
DŸR’d””
 *
»nd””
);

76 
	#BEZSHAPE_COMMON_PROPERTIES
 \

77 
OBJECT_COMMON_PROPERTIES
, \

78 { "bez_pošts", 
PROP_TYPE_BEZPOINTARRAY
, 0, "bez›rsh­pošts", 
NULL
} \

79 

	)

80 
	#BEZSHAPE_COMMON_PROPERTIES_OFFSETS
 \

81 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

82 { "bez_pošts", 
PROP_TYPE_BEZPOINTARRAY
, \

83 
	`off£tof
(
Bez›rSh­e
,
pošts
), off£tof(Bez›rSh­e,
numpošts
)} \

84 

	)

	@O:\tool\dvs50\lib\boundingbox.c

22 
	~<cÚfig.h
>

24 
	#_BSD_SOURCE
 1

	)

25 
	~<m©h.h
>

26 
	~<¡ršg.h
>

28 
	~<glib.h
>

30 
	~"geom‘ry.h
"

31 
	~"boundšgbox.h
"

43 
	$b”n¡eš_dev–İ
(cÚ¡ 
»®
 
p
[4],„—È*
A
,„—È*
B
,„—È*
C
,„—È*
D
)

45 *
A
 = -
p
[0]+3*p[1]-3*p[2]+p[3];

46 *
B
 = 3*
p
[0]-6*p[1]+3*p[2];

47 *
C
 = -3*
p
[0]+3*p[1];

48 *
D
 = 
p
[0];

51 
	}
}

58 
»®


59 
	$bez›r_ev®
(cÚ¡ 
»®
 
p
[4],„—È
u
)

61 
»®
 
A
,
B
,
C
,
D
;

62 
	`b”n¡eš_dev–İ
(
p
,&
A
,&
B
,&
C
,&
D
);

63  
A
*
u
*u*u+
B
*u*u+
C
*u+
D
;

64 
	}
}

71 
»®


72 
	$bez›r_ev®_ng’t
(cÚ¡ 
»®
 
p
[4],„—È
u
)

74 
»®
 
A
,
B
,
C
,
D
;

75 
	`b”n¡eš_dev–İ
(
p
,&
A
,&
B
,&
C
,&
D
);

76  3*
A
*
u
*u+2*
B
*u+
C
;

77 
	}
}

86 
	$bicubicbez›r_exŒema
(cÚ¡ 
»®
 
p
[4],»® 
u
[2])

88 
»®
 
A
,
B
,
C
,
D
,
d–
;

90 
	`b”n¡eš_dev–İ
(
p
,&
A
,&
B
,&
C
,&
D
);

91 
d–
 = 4*
B
*B - 12*
A
*
C
;

93 
u
[0] = u[1] = 0.0;

94 ià(
d–
<0)  0;

97 ià(
	`çbs
(
A
) < 1e-6) {

98 
u
[0] = -
C
/(2*
B
);

102 
u
[0] = (-2*
B
 + 
	`sq¹
(
d–
)è/ (6*
A
);

103 ià(
d–
==0)  1;

104 
u
[1] = (-2*
B
 - 
	`sq¹
(
d–
)è/ (6*
A
);

106 
	}
}

118 
	$add_¬row_»ùªgË
(
ReùªgË
 *
»ù
,

119 cÚ¡ 
Pošt
 *
v”‹x
,

120 cÚ¡ 
Pošt
 *
nÜmed_dœ
,

121 
»®
 
exŒa_lÚg
,»® 
exŒa_Œªs
)

123 
Pošt
 
vl
,
vt
,
±
;

124 
vl
 = *
nÜmed_dœ
;

126 
	`pošt_g‘_³½
(&
vt
,&
vl
);

127 
	`pošt_cİy_add_sÿËd
(&
±
,
v”‹x
,&
vl
,
exŒa_lÚg
);

128 
	`pošt_add_sÿËd
(&
±
,&
vt
,
exŒa_Œªs
);

129 
	`»ùªgË_add_pošt
(
»ù
,&
±
);

130 
	`pošt_add_sÿËd
(&
±
,&
vt
,-2.0 * 
exŒa_Œªs
);

131 
	`»ùªgË_add_pošt
(
»ù
,&
±
);

132 
	`pošt_add_sÿËd
(&
±
,&
vl
,-2.0 * 
exŒa_lÚg
);

133 
	`»ùªgË_add_pošt
(
»ù
,&
±
);

134 
	`pošt_add_sÿËd
(&
±
,&
vt
,2.0 * 
exŒa_Œªs
);

135 
	`»ùªgË_add_pošt
(
»ù
,&
±
);

136 
	}
}

147 
	$bicubicbez›r2D_bbox
(cÚ¡ 
Pošt
 *
p0
,cÚ¡ Pošˆ*
p1
,

148 cÚ¡ 
Pošt
 *
p2
,cÚ¡ Pošˆ*
p3
,

149 cÚ¡ 
PŞyBBExŒas
 *
exŒa
,

150 
ReùªgË
 *
»ù
)

152 
»®
 
x
[4],
y
[4];

153 
Pošt
 
vl
,
vt
,
p
,
‰
;

154 
»®
 *
xy
;

155 
i
,
exŒ
;

156 
»®
 
u
[2];

158 
»ù
->
Ëá
 =„eù->
right
 = 
p0
->
x
;

159 
»ù
->
tİ
 =„eù->
bÙtom
 = 
p0
->
y
;

161 
	`»ùªgË_add_pošt
(
»ù
,
p3
);

163 
	`pošt_cİy_add_sÿËd
(&
vl
,
p0
,
p1
,-1);

164 
	`pošt_nÜm®ize
(&
vl
);

165 
	`add_¬row_»ùªgË
(
»ù
,
p0
,&
vl
,
exŒa
->
¡¬t_lÚg
,
	`MAX
ÓxŒa->
¡¬t_Œªs
,

166 
exŒa
->
middË_Œªs
));

169 
	`pošt_cİy_add_sÿËd
(&
vl
,
p3
,
p2
,-1);

170 
	`pošt_nÜm®ize
(&
vl
);

171 
	`add_¬row_»ùªgË
(
»ù
,
p3
,&
vl
,
exŒa
->
’d_lÚg
,
	`MAX
ÓxŒa->
’d_Œªs
,

172 
exŒa
->
middË_Œªs
));

175 
x
[0] = 
p0
->x; x[1] = 
p1
->x; x[2] = 
p2
->x; x[3] = 
p3
->x;

176 
y
[0] = 
p0
->y; y[1] = 
p1
->y; y[2] = 
p2
->y; y[3] = 
p3
->y;

178 
xy
 = 
x
; xy ; xy=(xy==x?
y
:
NULL
) ) {

179 
exŒ
 = 
	`bicubicbez›r_exŒema
(
xy
,
u
);

180 
i
=0;i<
exŒ
;i++) {

181 ià((
u
[
i
]<0) || (u[i]>1)) ;

182 
p
.
x
 = 
	`bez›r_ev®
(x,
u
[
i
]);

183 
vl
.
x
 = 
	`bez›r_ev®_ng’t
(x,
u
[
i
]);

184 
p
.
y
 = 
	`bez›r_ev®
(y,
u
[
i
]);

185 
vl
.
y
 = 
	`bez›r_ev®_ng’t
(y,
u
[
i
]);

186 
	`pošt_nÜm®ize
(&
vl
);

187 
	`pošt_g‘_³½
(&
vt
,&
vl
);

189 
	`pošt_cİy_add_sÿËd
(&
‰
,&
p
,&
vt
,
exŒa
->
middË_Œªs
);

190 
	`»ùªgË_add_pošt
(
»ù
,&
‰
);

191 
	`pošt_cİy_add_sÿËd
(&
‰
,&
p
,&
vt
,-
exŒa
->
middË_Œªs
);

192 
	`»ùªgË_add_pošt
(
»ù
,&
‰
);

195 
	}
}

204 
	$lše_bbox
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
,

205 cÚ¡ 
LšeBBExŒas
 *
exŒa
,

206 
ReùªgË
 *
»ù
)

208 
Pošt
 
vl
;

210 
»ù
->
Ëá
 =„eù->
right
 = 
p1
->
x
;

211 
»ù
->
tİ
 =„eù->
bÙtom
 = 
p1
->
y
;

213 
	`»ùªgË_add_pošt
(
»ù
,
p2
);

215 
	`pošt_cİy_add_sÿËd
(&
vl
,
p1
,
p2
,-1);

216 
	`pošt_nÜm®ize
(&
vl
);

217 
	`add_¬row_»ùªgË
(
»ù
,
p1
,&
vl
,
exŒa
->
¡¬t_lÚg
,exŒa->
¡¬t_Œªs
);

218 
	`pošt_sÿË
(&
vl
,-1);

219 
	`add_¬row_»ùªgË
(
»ù
,
p2
,&
vl
,
exŒa
->
’d_lÚg
,exŒa->
’d_Œªs
);

220 
	}
}

231 
	$–l£_bbox
(cÚ¡ 
Pošt
 *
ûÁ»
, 
»®
 
width
,„—È
height
,

232 cÚ¡ 
EËm’tBBExŒas
 *
exŒa
,

233 
ReùªgË
 *
»ù
)

235 
ReùªgË
 
rš
;

236 
rš
.
Ëá
 = 
ûÁ»
->
x
 - 
width
/2;

237 
rš
.
right
 = 
ûÁ»
->
x
 + 
width
/2;

238 
rš
.
tİ
 = 
ûÁ»
->
y
 - 
height
/2;

239 
rš
.
bÙtom
 = 
ûÁ»
->
y
 + 
height
/2;

241 
	`»ùªgË_bbox
(&
rš
,
exŒa
,
»ù
);

242 
	}
}

250 
BezPošt
 *

251 
	$®loc_pŞybez›r_¥aû
(
numpošts
)

253 
®loc_Å
 = 0;

254 
BezPošt
 *
®loûd
 = 
NULL
;

256 ià(
®loc_Å
 < 
numpošts
) {

257 
	`g_ä“
(
®loûd
);

258 
®loc_Å
 = 
numpošts
;

259 
®loûd
 = 
	`g_Ãw0
(
BezPošt
,
numpošts
);

261  
®loûd
;

262 
	}
}

270 
	$ä“_pŞybez›r_¥aû
(
BezPošt
 *
pošts
)

271 { 
	}
}

283 
	$pŞylše_bbox
(cÚ¡ 
Pošt
 *
±s
, 
numpošts
,

284 cÚ¡ 
PŞyBBExŒas
 *
exŒa
, 
gboŞ—n
 
şo£d
,

285 
ReùªgË
 *
»ù
)

288 
i
;

289 
BezPošt
 *
b±s
 = 
	`®loc_pŞybez›r_¥aû
(
numpošts
 + 1);

291 
b±s
[0].
ty³
 = 
BEZ_MOVE_TO
;

292 
b±s
[0].
p1
 = 
±s
[0];

294 
i
=1;i<
numpošts
;i++) {

295 
b±s
[
i
].
ty³
 = 
BEZ_LINE_TO
;

296 
b±s
[
i
].
p1
 = 
±s
[i];

299 
b±s
[
numpošts
].
ty³
 = 
BEZ_LINE_TO
;

300 
b±s
[
numpošts
].
p1
 = 
±s
[0];

302 
	`pŞybez›r_bbox
(
b±s
,
numpošts
 + (
şo£d
?1:0),
exŒa
,şo£d,
»ù
);

303 
	`ä“_pŞybez›r_¥aû
(
b±s
);

304 
	}
}

315 
	$pŞybez›r_bbox
(cÚ¡ 
BezPošt
 *
±s
, 
numpošts
,

316 cÚ¡ 
PŞyBBExŒas
 *
exŒa
, 
gboŞ—n
 
şo£d
,

317 
ReùªgË
 *
»ù
)

319 
Pošt
 
vx
,
vn
,
vsc
,
vp
;

320 
i
,
´ev
,
Ãxt
;

321 
ReùªgË
 
¹
;

322 
PŞyBBExŒas
 
bexŒa
,
¡¬t_bexŒa
,
’d_bexŒa
;

323 
LšeBBExŒas
 
ËxŒa
,
¡¬t_ËxŒa
,
’d_ËxŒa
,
fuÎ_ËxŒa
;

324 
gboŞ—n
 
¡¬t
,
’d
;

326 
vp
.
x
=0;

327 
vp
.
y
=0;

329 
	`g_as£¹
(
±s
[0].
ty³
 =ğ
BEZ_MOVE_TO
);

331 
»ù
->
Ëá
 =„eù->
right
 = 
±s
[0].
p1
.
x
;

332 
»ù
->
tİ
 =„eù->
bÙtom
 = 
±s
[0].
p1
.
y
;

336 ià(!
şo£d
) {

337 
¡¬t_ËxŒa
.
¡¬t_lÚg
 = 
exŒa
->start_long;

338 
¡¬t_ËxŒa
.
¡¬t_Œªs
 = 
	`MAX
(
exŒa
->¡¬t_Œªs,exŒa->
middË_Œªs
);

339 
¡¬t_ËxŒa
.
’d_lÚg
 = 0;

340 
¡¬t_ËxŒa
.
’d_Œªs
 = 
exŒa
->
middË_Œªs
;

342 
’d_ËxŒa
.
¡¬t_lÚg
 = 0;

343 
’d_ËxŒa
.
¡¬t_Œªs
 = 
exŒa
->
middË_Œªs
;

344 
’d_ËxŒa
.
’d_lÚg
 = 
exŒa
->end_long;

345 
’d_ËxŒa
.
’d_Œªs
 = 
	`MAX
(
exŒa
->’d_Œªs,exŒa->
middË_Œªs
);

348 
fuÎ_ËxŒa
.
¡¬t_lÚg
 = 
exŒa
->start_long;

349 
fuÎ_ËxŒa
.
¡¬t_Œªs
 = 
	`MAX
(
exŒa
->¡¬t_Œªs,exŒa->
middË_Œªs
);

350 
fuÎ_ËxŒa
.
’d_lÚg
 = 
exŒa
->end_long;

351 
fuÎ_ËxŒa
.
’d_Œªs
 = 
	`MAX
(
exŒa
->’d_Œªs,exŒa->
middË_Œªs
);

353 ià(!
şo£d
) {

354 
ËxŒa
.
¡¬t_lÚg
 = 0;

355 
ËxŒa
.
¡¬t_Œªs
 = 
exŒa
->
middË_Œªs
;

356 
ËxŒa
.
’d_lÚg
 = 0;

357 
ËxŒa
.
’d_Œªs
 = 
exŒa
->
middË_Œªs
;

359 
¡¬t_bexŒa
.
¡¬t_lÚg
 = 
exŒa
->start_long;

360 
¡¬t_bexŒa
.
¡¬t_Œªs
 = 
exŒa
->start_trans;

361 
¡¬t_bexŒa
.
middË_Œªs
 = 
exŒa
->middle_trans;

362 
¡¬t_bexŒa
.
’d_lÚg
 = 0;

363 
¡¬t_bexŒa
.
’d_Œªs
 = 
exŒa
->
middË_Œªs
;

365 
’d_bexŒa
.
¡¬t_lÚg
 = 0;

366 
’d_bexŒa
.
¡¬t_Œªs
 = 
exŒa
->
middË_Œªs
;

367 
’d_bexŒa
.
middË_Œªs
 = 
exŒa
->middle_trans;

368 
’d_bexŒa
.
’d_lÚg
 = 
exŒa
->end_long;

369 
’d_bexŒa
.
’d_Œªs
 = 
exŒa
->end_trans;

372 
bexŒa
.
¡¬t_lÚg
 = 0;

373 
bexŒa
.
¡¬t_Œªs
 = 
exŒa
->
middË_Œªs
;

374 
bexŒa
.
middË_Œªs
 = 
exŒa
->middle_trans;

375 
bexŒa
.
’d_lÚg
 = 0;

376 
bexŒa
.
’d_Œªs
 = 
exŒa
->
middË_Œªs
;

379 
i
=1;i<
numpošts
;i++) {

380 
Ãxt
 = (
i
+1è% 
numpošts
;

381 
´ev
 = (
i
-1è% 
numpošts
;

382 ià(
şo£d
 && (
Ãxt
 == 0))‚ext=1;

383 ià(
şo£d
 && (
´ev
 =ğ0)è´ev=
numpošts
-1;

399 ià(
±s
[
i
].
ty³
 =ğ
BEZ_MOVE_TO
) {

403 
±s
[
i
].
ty³
) {

404 
BEZ_MOVE_TO
:

405 
	`g_as£¹_nÙ_»ached
();

407 
BEZ_LINE_TO
:

408 
	`pošt_cİy
(&
vx
,&
±s
[
i
].
p1
);

409 
±s
[
´ev
].
ty³
) {

410 
BEZ_MOVE_TO
:

411 
BEZ_LINE_TO
:

412 
	`pošt_cİy
(&
vsc
,&
±s
[
´ev
].
p1
);

413 
	`pošt_cİy
(&
vp
,&
±s
[
´ev
].
p1
);

415 
BEZ_CURVE_TO
:

416 
	`pošt_cİy
(&
vsc
,&
±s
[
´ev
].
p3
);

417 
	`pošt_cİy
(&
vp
,&
±s
[
´ev
].
p3
);

421 
BEZ_CURVE_TO
:

422 
	`pošt_cİy
(&
vx
,&
±s
[
i
].
p3
);

423 
	`pošt_cİy
(&
vp
,&
±s
[
i
].
p2
);

424 
±s
[
´ev
].
ty³
) {

425 
BEZ_MOVE_TO
:

426 
BEZ_LINE_TO
:

427 
	`pošt_cİy
(&
vsc
,&
±s
[
´ev
].
p1
);

429 
BEZ_CURVE_TO
:

430 
	`pošt_cİy
(&
vsc
,&
±s
[
´ev
].
p3
);

436 
¡¬t
 = (
±s
[
´ev
].
ty³
 =ğ
BEZ_MOVE_TO
);

437 
’d
 = (
±s
[
Ãxt
].
ty³
 =ğ
BEZ_MOVE_TO
);

438 
	`pošt_cİy
(&
vn
,&
±s
[
Ãxt
].
p1
);

443 ià(
şo£d
) {

444 ià(
±s
[
i
].
ty³
 =ğ
BEZ_LINE_TO
) {

445 
	`lše_bbox
(&
vsc
,&
vx
,&
fuÎ_ËxŒa
,&
¹
);

447 
	`bicubicbez›r2D_bbox
(&
vsc
,

448 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

449 &
bexŒa
,

450 &
¹
);

452 } ià(
¡¬t
) {

453 ià(
±s
[
i
].
ty³
 =ğ
BEZ_LINE_TO
) {

454 ià(
’d
) {

455 
	`lše_bbox
(&
vsc
,&
vx
,&
fuÎ_ËxŒa
,&
¹
);

457 
	`lše_bbox
(&
vsc
,&
vx
,&
¡¬t_ËxŒa
,&
¹
);

460 ià(
’d
) {

461 
	`bicubicbez›r2D_bbox
(&
vsc
,

462 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

463 
exŒa
,

464 &
¹
);

466 
	`bicubicbez›r2D_bbox
(&
vsc
,

467 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

468 &
¡¬t_bexŒa
,

469 &
¹
);

472 } ià(
’d
) {

473 ià(
±s
[
i
].
ty³
 =ğ
BEZ_LINE_TO
) {

474 
	`lše_bbox
(&
vsc
,&
vx
,&
’d_ËxŒa
,&
¹
);

476 
	`bicubicbez›r2D_bbox
(&
vsc
,

477 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

478 &
’d_bexŒa
,

479 &
¹
);

482 ià(
±s
[
i
].
ty³
 =ğ
BEZ_LINE_TO
) {

483 
	`lše_bbox
(&
vsc
,&
vx
,&
ËxŒa
,&
¹
);

485 
	`bicubicbez›r2D_bbox
(&
vsc
,

486 &
±s
[
i
].
p1
,&±s[i].
p2
,&±s[i].
p3
,

487 &
bexŒa
,

488 &
¹
);

491 
	`»ùªgË_uniÚ
(
»ù
,&
¹
);

497 ià((!
¡¬t
è&& (!
’d
)) {

498 
Pošt
 
vpx
,
vxn
;

499 
»®
 
co
,
®pha
;

501 
	`pošt_cİy_add_sÿËd
(&
vpx
,&
vx
,&
vp
,-1);

502 
	`pošt_nÜm®ize
(&
vpx
);

503 
	`pošt_cİy_add_sÿËd
(&
vxn
,&
vn
,&
vx
,-1);

504 
	`pošt_nÜm®ize
(&
vxn
);

506 
co
 = 
	`pošt_dÙ
(&
vpx
,&
vxn
);

507 
®pha
 = 
	`acos
(-
co
);

508 ià(
co
 > -0.9816) {

510 
»®
 
ov”shoÙ
;

511 
Pošt
 
vovs
,
±o
;

513 ià(
	`fš™e
(
®pha
))

514 
ov”shoÙ
 = 
exŒa
->
middË_Œªs
 / 
	`sš
(
®pha
/2.0);

516 
ov”shoÙ
 = 
exŒa
->
middË_Œªs
;

518 
	`pošt_cİy_add_sÿËd
(&
vovs
,&
vpx
,&
vxn
,-1);

519 
	`pošt_nÜm®ize
(&
vovs
);

520 
	`pošt_cİy_add_sÿËd
(&
±o
,&
vx
,&
vovs
,
ov”shoÙ
);

522 
	`»ùªgË_add_pošt
(
»ù
,&
±o
);

525 
Pošt
 
vpxt
,
vxÁ
,
tmp
;

527 
	`pošt_g‘_³½
(&
vpxt
,&
vpx
);

528 
	`pošt_g‘_³½
(&
vxÁ
,&
vxn
);

530 
	`pošt_cİy_add_sÿËd
(&
tmp
,&
vx
,&
vpxt
,1);

531 
	`»ùªgË_add_pošt
(
»ù
,&
tmp
);

532 
	`pošt_cİy_add_sÿËd
(&
tmp
,&
vx
,&
vpxt
,-1);

533 
	`»ùªgË_add_pošt
(
»ù
,&
tmp
);

534 
	`pošt_cİy_add_sÿËd
(&
tmp
,&
vx
,&
vxÁ
,1);

535 
	`»ùªgË_add_pošt
(
»ù
,&
tmp
);

536 
	`pošt_cİy_add_sÿËd
(&
tmp
,&
vx
,&
vxÁ
,-1);

537 
	`»ùªgË_add_pošt
(
»ù
,&
tmp
);

541 
	}
}

550 
	$»ùªgË_bbox
(cÚ¡ 
ReùªgË
 *
rš
,

551 cÚ¡ 
EËm’tBBExŒas
 *
exŒa
,

552 
ReùªgË
 *
rout
)

554 
rout
->
Ëá
 = 
rš
->Ëá - 
exŒa
->
bÜd”_Œªs
;

555 
rout
->
tİ
 = 
rš
->tİ - 
exŒa
->
bÜd”_Œªs
;

556 
rout
->
right
 = 
rš
->righˆ+ 
exŒa
->
bÜd”_Œªs
;

557 
rout
->
bÙtom
 = 
rš
->bÙtom + 
exŒa
->
bÜd”_Œªs
;

558 
	}
}

	@O:\tool\dvs50\lib\boundingbox.h

22 #iâdeà
BOUNDINGBOX_H


23 
	#BOUNDINGBOX_H


	)

25 
	~"dŸty³s.h
"

26 
	~"geom‘ry.h
"

28 
	s_PŞyBBExŒas
 {

29 
»®
 
	m¡¬t_lÚg
, 
	m¡¬t_Œªs
;

30 
»®
 
	mmiddË_Œªs
;

31 
»®
 
	m’d_lÚg
, 
	m’d_Œªs
;

34 
	s_LšeBBExŒas
 {

35 
»®
 
	m¡¬t_lÚg
, 
	m¡¬t_Œªs
;

36 
»®
 
	m’d_lÚg
, 
	m’d_Œªs
;

39 
	s_EËm’tBBExŒas
 {

40 
»®
 
	mbÜd”_Œªs
;

43 
bicubicbez›r2D_bbox
(cÚ¡ 
Pošt
 *
p0
,cÚ¡ Pošˆ*
p1
,

44 cÚ¡ 
Pošt
 *
p2
,cÚ¡ Pošˆ*
p3
,

45 cÚ¡ 
PŞyBBExŒas
 *
exŒa
,

46 
ReùªgË
 *
»ù
);

48 
DIAVAR
 
lše_bbox
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
,

49 cÚ¡ 
LšeBBExŒas
 *
exŒa
,

50 
ReùªgË
 *
»ù
);

52 
DIAVAR
 
»ùªgË_bbox
(cÚ¡ 
ReùªgË
 *
rš
,

53 cÚ¡ 
EËm’tBBExŒas
 *
exŒa
,

54 
ReùªgË
 *
rout
);

56 
DIAVAR
 
cœşe_bbox
(cÚ¡ 
Pošt
 *
ûÁ»
, 
»®
 
¿dius
,

57 
ReùªgË
 *
»ù
);

59 
DIAVAR
 
–l£_bbox
(cÚ¡ 
Pošt
 *
ûÁ»
, 
»®
 
width
,„—È
height
,

60 cÚ¡ 
EËm’tBBExŒas
 *
exŒa
,

61 
ReùªgË
 *
»ù
);

62 
DIAVAR
 
pŞylše_bbox
(cÚ¡ 
Pošt
 *
±s
, 
numpošts
,

63 cÚ¡ 
PŞyBBExŒas
 *
exŒa
, 
gboŞ—n
 
şo£d
,

64 
ReùªgË
 *
»ù
);

65 
DIAVAR
 
pŞybez›r_bbox
(cÚ¡ 
BezPošt
 *
±s
, 
numpošts
,

66 cÚ¡ 
PŞyBBExŒas
 *
exŒa
, 
gboŞ—n
 
şo£d
,

67 
ReùªgË
 *
»ù
);

70 
DIAVAR
 
b”n¡eš_dev–İ
(cÚ¡ 
»®
 
p
[4],»® *
A
,»® *
B
,»® *
C
,»® *
D
);

71 
DIAVAR
 
»®
 
bez›r_ev®
(cÚ¡„—È
p
[4],»® 
u
);

72 
DIAVAR
 
»®
 
bez›r_ev®_ng’t
(cÚ¡„—È
p
[4],»® 
u
);

	@O:\tool\dvs50\lib\color.c

21 
	~<cÚfig.h
>

23 
	~<¡dio.h
>

24 
	~<gtk/gtk.h
>

25 
	~<gdk/gdk.h
>

27 
	~"cŞÜ.h
"

29 
GdkCŞÜm­
 *
	gcŞÜm­
 = 
NULL
;

31 #iâdeà
G_OS_WIN32


32 
CŞÜ
 
	gcŞÜ_bÏck
 = { 0.0f, 0.0f, 0.0f };

33 
CŞÜ
 
	gcŞÜ_wh™e
 = { 1.0f, 1.0f, 1.0f };

36 
GdkCŞÜ
 
	gcŞÜ_gdk_bÏck
, 
	gcŞÜ_gdk_wh™e
;

38 
gboŞ—n
 
	g_cŞÜ_š™Ÿlized
 = 
FALSE
;

43 
	$cŞÜ_š™
()

45 ià(!
_cŞÜ_š™Ÿlized
) {

46 
GdkVisu®
 *
visu®
 = 
	`gtk_widg‘_g‘_deçuÉ_visu®
();

47 
cŞÜm­
 = 
	`gdk_cŞÜm­_Ãw
 (
visu®
, 
FALSE
);

49 
_cŞÜ_š™Ÿlized
 = 
TRUE
;

51 
	`cŞÜ_cÚv”t
(&
cŞÜ_bÏck
, &
cŞÜ_gdk_bÏck
);

52 
	`cŞÜ_cÚv”t
(&
cŞÜ_wh™e
, &
cŞÜ_gdk_wh™e
);

54 
	}
}

62 
CŞÜ
 *

63 
	$cŞÜ_Ãw_rgb
(
r
, 
g
, 
b
)

65 
CŞÜ
 *
cŞ
 = 
	`g_Ãw
(Color, 1);

66 
cŞ
->
»d
 = 
r
;

67 
cŞ
->
g»’
 = 
g
;

68 
cŞ
->
blue
 = 
b
;

69  
cŞ
;

70 
	}
}

77 
	$cŞÜ_cÚv”t
(
CŞÜ
 *
cŞÜ
, 
GdkCŞÜ
 *
gdkcŞÜ
)

79 
gdkcŞÜ
->
»d
 = (
gušt16
)(
cŞÜ
->red*65535);

80 
gdkcŞÜ
->
g»’
 = (
gušt16
)(
cŞÜ
->green*65535);

81 
gdkcŞÜ
->
blue
 = (
gušt16
)(
cŞÜ
->blue*65535);

83 ià(
_cŞÜ_š™Ÿlized
) {

84 ià(!
	`gdk_cŞÜm­_®loc_cŞÜ
 (
cŞÜm­
, 
gdkcŞÜ
, 
TRUE
, TRUE))

85 
	`g_w¬nšg
 ("color_convert failed.");

87 
	`g_w¬nšg
("Can't color_convert in‚on-interactive‡pp (w/o color_init())");

89 
	}
}

96 
gboŞ—n


97 
	$cŞÜ_equ®s
(
CŞÜ
 *
cŞÜ1
, CŞÜ *
cŞÜ2
)

99  (
cŞÜ1
->
»d
 =ğ
cŞÜ2
->red) &&

100 (
cŞÜ1
->
g»’
 =ğ
cŞÜ2
->green) &&

101 (
cŞÜ1
->
blue
 =ğ
cŞÜ2
->blue);

102 
	}
}

	@O:\tool\dvs50\lib\color.h

21 #iâdeà
COLOR_H


22 
	#COLOR_H


	)

24 
	~"dŸty³s.h
"

25 
	~<gdk/gdk.h
>

26 
	~"dŸv¬.h
"

28 
	s_CŞÜ
 {

29 
	m»d
;

30 
	mg»’
;

31 
	mblue
;

34 
DIAVAR
 
cŞÜ_š™
();

35 
DIAVAR
 
CŞÜ
 *
cŞÜ_Ãw_rgb
(
r
, 
g
, 
b
);

36 
DIAVAR
 
cŞÜ_cÚv”t
(
CŞÜ
 *
cŞÜ
, 
GdkCŞÜ
 *
gdkcŞÜ
);

37 
DIAVAR
 
gboŞ—n
 
cŞÜ_equ®s
(
CŞÜ
 *
cŞÜ1
, CŞÜ *
cŞÜ2
);

39 #ifdeà
G_OS_WIN32


40 
CŞÜ
 
	gcŞÜ_bÏck
 = { 0.0f, 0.0f, 0.0f };

41 
CŞÜ
 
	gcŞÜ_wh™e
 = { 1.0f, 1.0f, 1.0f };

43 
DIAVAR
 
CŞÜ
 
	gcŞÜ_bÏck
, 
	gcŞÜ_wh™e
;

45 
DIAVAR
 
GdkCŞÜ
 
	gcŞÜ_gdk_bÏck
, 
	gcŞÜ_gdk_wh™e
;

47 
	#DIA_COLOR_TO_GDK
(
äom
, 
to
) \

48 (
to
).
pix–
 = 0; \

49 (
to
).
»d
 = (
äom
).red*65535; \

50 (
to
).
g»’
 = (
äom
).green*65535; \

51 (
to
).
blue
 = (
äom
).blue*65535;

	)

52 
	#GDK_COLOR_TO_DIA
(
äom
, 
to
) \

53 (
to
).
»d
 = (
äom
).red/65535.0; \

54 (
to
).
g»’
 = (
äom
).green/65535.0; \

55 (
to
).
blue
 = (
äom
).blue/65535.0;

	)

	@O:\tool\dvs50\lib\connection.c

20 
	~<cÚfig.h
>

22 
	~<¡dio.h
>

23 
	~<¡ršg.h
>

24 
	~<as£¹.h
>

26 
	~"cÚÃùiÚ.h
"

27 
	~"mes§ge.h
"

34 
	$cÚÃùiÚ_adju¡_fÜ_autog­
(
CÚÃùiÚ
 *
cÚÃùiÚ
)

36 
Pošt
 
’dpošts
[2];

37 
CÚÃùiÚPošt
 *
¡¬t_ı
, *
’d_ı
;

39 
¡¬t_ı
 = 
cÚÃùiÚ
->
’dpošt_hªdËs
[0].
cÚÃùed_to
;

40 
’d_ı
 = 
cÚÃùiÚ
->
’dpošt_hªdËs
[1].
cÚÃùed_to
;

42 
’dpošts
[0] = 
cÚÃùiÚ
->endpoints[0];

43 
’dpošts
[1] = 
cÚÃùiÚ
->endpoints[1];

45 ià(
	`cÚÅošt_is_autog­
(
¡¬t_ı
)) {

46 
’dpošts
[0] = 
¡¬t_ı
->
pos
;

48 ià(
	`cÚÅošt_is_autog­
(
’d_ı
)) {

49 
’dpošts
[1] = 
’d_ı
->
pos
;

52 ià(
	`cÚÅošt_is_autog­
(
¡¬t_ı
)) {

53 
cÚÃùiÚ
->
’dpošts
[0] = 
	`ÿlcuÏ‹_objeù_edge
(&endpoints[0],

54 &
’dpošts
[1],

55 
¡¬t_ı
->
objeù
);

57 ià(
	`cÚÅošt_is_autog­
(
’d_ı
)) {

58 
cÚÃùiÚ
->
’dpošts
[1] = 
	`ÿlcuÏ‹_objeù_edge
(&endpoints[1],

59 &
’dpošts
[0],

60 
’d_ı
->
objeù
);

62 
	}
}

87 
ObjeùChªge
*

88 
	$cÚÃùiÚ_move_hªdË
(
CÚÃùiÚ
 *
cÚn
, 
HªdËId
 
id
,

89 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

90 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

92 
id
) {

93 
HANDLE_MOVE_STARTPOINT
:

94 
cÚn
->
’dpošts
[0] = *
to
;

96 
HANDLE_MOVE_ENDPOINT
:

97 
cÚn
->
’dpošts
[1] = *
to
;

100 
	`mes§ge_”rÜ
("Internalƒrror in connection_move_handle.\n");

103  
NULL
;

104 
	}
}

111 
	$cÚÃùiÚ_upd©e_hªdËs
(
CÚÃùiÚ
 *
cÚn
)

113 
cÚn
->
’dpošt_hªdËs
[0].
id
 = 
HANDLE_MOVE_STARTPOINT
;

114 
cÚn
->
’dpošt_hªdËs
[0].
pos
 = cÚn->
’dpošts
[0];

116 
cÚn
->
’dpošt_hªdËs
[1].
id
 = 
HANDLE_MOVE_ENDPOINT
;

117 
cÚn
->
’dpošt_hªdËs
[1].
pos
 = cÚn->
’dpošts
[1];

118 
	}
}

124 
	$cÚÃùiÚ_upd©e_boundšgbox
(
CÚÃùiÚ
 *
cÚn
)

126 
	`as£¹
(
cÚn
 !ğ
NULL
);

128 
	`lše_bbox
(&
cÚn
->
’dpošts
[0],&conn->endpoints[1],

129 &
cÚn
->
exŒa_¥acšg
,&cÚn->
objeù
.
boundšg_box
);

130 
	}
}

139 
	$cÚÃùiÚ_š™
(
CÚÃùiÚ
 *
cÚn
, 
num_hªdËs
, 
num_cÚÃùiÚs
)

141 
DŸObjeù
 *
obj
;

142 
i
;

144 
obj
 = &
cÚn
->
objeù
;

146 
	`as£¹
(
num_hªdËs
>=2);

148 
	`objeù_š™
(
obj
, 
num_hªdËs
, 
num_cÚÃùiÚs
);

150 
	`as£¹
(
obj
->
hªdËs
!=
NULL
);

152 
i
=0;i<2;i++) {

153 
obj
->
hªdËs
[
i
] = &
cÚn
->
’dpošt_hªdËs
[i];

154 
obj
->
hªdËs
[
i
]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

155 
obj
->
hªdËs
[
i
]->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

156 
obj
->
hªdËs
[
i
]->
cÚÃùed_to
 = 
NULL
;

158 
	}
}

165 
	$cÚÃùiÚ_cİy
(
CÚÃùiÚ
 *
äom
, CÚÃùiÚ *
to
)

167 
i
;

168 
DŸObjeù
 *
toobj
;

169 
DŸObjeù
 *
äomobj
;

171 
toobj
 = &
to
->
objeù
;

172 
äomobj
 = &
äom
->
objeù
;

174 
	`objeù_cİy
(
äomobj
, 
toobj
);

176 
i
=0;i<2;i++) {

177 
to
->
’dpošts
[
i
] = 
äom
->endpoints[i];

180 
i
=0;i<2;i++) {

182 
to
->
’dpošt_hªdËs
[
i
] = 
äom
->endpoint_handles[i];

183 
to
->
’dpošt_hªdËs
[
i
].
cÚÃùed_to
 = 
NULL
;

184 
toobj
->
hªdËs
[
i
] = &
to
->
’dpošt_hªdËs
[i];

186 
	`memıy
(&
to
->
exŒa_¥acšg
,&
äom
->extra_spacing,(to->extra_spacing));

187 
	}
}

198 
	$cÚÃùiÚ_de¡roy
(
CÚÃùiÚ
 *
cÚn
)

200 
	`objeù_de¡roy
(&
cÚn
->
objeù
);

201 
	}
}

208 
	$cÚÃùiÚ_§ve
(
CÚÃùiÚ
 *
cÚn
, 
ObjeùNode
 
obj_node
)

210 
A‰ribu‹Node
 
©Œ
;

212 
	`objeù_§ve
(&
cÚn
->
objeù
, 
obj_node
);

214 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "conn_endpoints");

215 
	`d©a_add_pošt
(
©Œ
, &
cÚn
->
’dpošts
[0]);

216 
	`d©a_add_pošt
(
©Œ
, &
cÚn
->
’dpošts
[1]);

217 
	}
}

224 
	$cÚÃùiÚ_lßd
(
CÚÃùiÚ
 *
cÚn
, 
ObjeùNode
 
obj_node
)

226 
A‰ribu‹Node
 
©Œ
;

227 
D©aNode
 
d©a
;

229 
	`objeù_lßd
(&
cÚn
->
objeù
, 
obj_node
);

231 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "conn_endpoints");

232 ià(
©Œ
 !ğ
NULL
) {

233 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

234 
	`d©a_pošt
Ğ
d©a
 , &
cÚn
->
’dpošts
[0] );

235 
d©a
 = 
	`d©a_Ãxt
(data);

236 
	`d©a_pošt
Ğ
d©a
 , &
cÚn
->
’dpošts
[1] );

238 
	}
}

	@O:\tool\dvs50\lib\connection.h

20 #iâdeà
CONNECTION_H


21 
	#CONNECTION_H


	)

23 
	~"dŸty³s.h
"

24 
	~"objeù.h
"

25 
	~"boundšgbox.h
"

33 
	s_CÚÃùiÚ
 {

34 
DŸObjeù
 
	mobjeù
;

36 
Pošt
 
	m’dpošts
[2];

37 
HªdË
 
	m’dpošt_hªdËs
[2];

38 
LšeBBExŒas
 
	mexŒa_¥acšg
;

41 
DIAVAR
 
cÚÃùiÚ_upd©e_hªdËs
(
CÚÃùiÚ
 *
cÚn
);

42 
DIAVAR
 
cÚÃùiÚ_upd©e_boundšgbox
(
CÚÃùiÚ
 *
cÚn
);

43 
DIAVAR
 
cÚÃùiÚ_š™
(
CÚÃùiÚ
 *
cÚn
,

44 
num_hªdËs
, 
num_cÚÃùiÚs
);

45 
DIAVAR
 
cÚÃùiÚ_de¡roy
(
CÚÃùiÚ
 *
cÚn
);

46 
DIAVAR
 
cÚÃùiÚ_cİy
(
CÚÃùiÚ
 *
äom
, CÚÃùiÚ *
to
);

47 
DIAVAR
 
cÚÃùiÚ_§ve
(
CÚÃùiÚ
 *
cÚn
, 
ObjeùNode
 
obj_node
);

48 
DIAVAR
 
cÚÃùiÚ_lßd
(
CÚÃùiÚ
 *
cÚn
, 
ObjeùNode
 
obj_node
);

49 
DIAVAR
 
ObjeùChªge
* 
cÚÃùiÚ_move_hªdË
(
CÚÃùiÚ
 *
cÚn
, 
HªdËId
 
id
,

50 
Pošt
 *
to
, 
CÚÃùiÚPošt
* 
ı
,

51 
HªdËMoveR—sÚ
 
»asÚ
,

52 
Modif›rKeys
 
modif›rs
);

54 
DIAVAR
 
cÚÃùiÚ_adju¡_fÜ_autog­
(
CÚÃùiÚ
 *
cÚn
);

57 
	#CONNECTION_COMMON_PROPERTIES
 \

58 
OBJECT_COMMON_PROPERTIES
, \

59 { "cÚn_’dpošts", 
PROP_TYPE_ENDPOINTS
, 0, "CÚÃùiÚƒndpošts", 
NULL
}

	)

61 
	#CONNECTION_COMMON_PROPERTIES_OFFSETS
 \

62 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

63 { "cÚn_’dpošts", 
PROP_TYPE_ENDPOINTS
, 
	`off£tof
(
CÚÃùiÚ
,
’dpošts
)}

	)

	@O:\tool\dvs50\lib\connectionpoint.c

21 
	~"cÚfig.h
"

22 
	~"cÚÃùiÚpošt.h
"

32 
gšt


33 
	$fšd_¦İe_dœeùiÚs
(
Pošt
 
äom
, Pošˆ
to
)

35 
gšt
 
dœs
;

36 
gšt
 
¦İe
;

38 ià(
	`çbs
(
äom
.
y
-
to
.y) < 0.0000001)

39  (
äom
.
x
 > 
to
.x?
DIR_SOUTH
:
DIR_NORTH
);

40 ià(
	`çbs
(
äom
.
x
-
to
.x) < 0.0000001)

41  (
äom
.
y
 > 
to
.y?
DIR_WEST
:
DIR_EAST
);

43 
	`pošt_sub
(&
to
, &
äom
);

44 
¦İe
 = 
	`çbs
(
to
.
y
/to.
x
);

46 
dœs
 = 0;

47 ià(
¦İe
 < 2) {

48 ià(
to
.
x
 > 0) {

49 
dœs
 |ğ
DIR_NORTH
;

51 
dœs
 |ğ
DIR_SOUTH
;

54 ià(
¦İe
 > .5) {

55 ià(
to
.
y
 > 0) {

56 
dœs
 |ğ
DIR_EAST
;

58 
dœs
 |ğ
DIR_WEST
;

61  
dœs
;

62 
	}
}

72 
	$cÚÅošt_upd©e
(
CÚÃùiÚPošt
 *
p
, 
»®
 
x
,„—È
y
, 
gšt
 
dœs
)

74 
p
->
pos
.
x
 = x;

75 
p
->
pos
.
y
 = y;

76 
p
->
dœeùiÚs
 = 
dœs
;

77 
	}
}

85 
gboŞ—n


86 
	$cÚÅošt_is_autog­
(
CÚÃùiÚPošt
 *
ı
)

88  
ı
 !ğ
NULL
 && (ı->
æags
 & 
CP_FLAG_AUTOGAP
è&& (ı->
cÚÃùed
 != NULL);

89 
	}
}

	@O:\tool\dvs50\lib\connectionpoint.h

19 #iâdeà
CONNECTIONPOINT_H


20 
	#CONNECTIONPOINT_H


	)

22 
	~"dŸty³s.h
"

23 
	~<glib.h
>

24 
	~"geom‘ry.h
"

26 
	#CONNECTIONPOINT_SIZE
 5

	)

27 
	#CHANGED_TRESHOLD
 0.001

	)

33 
	mDIR_NONE
 = 0,

34 
	mDIR_NORTH
 = (1<<0),

35 
	mDIR_EAST
 = (1<<1),

36 
	mDIR_SOUTH
 = (1<<2),

37 
	mDIR_WEST
 = (1<<3),

39 
	mDIR_NORTHEAST
 = (
DIR_NORTH
|
DIR_EAST
),

40 
	mDIR_SOUTHEAST
 = (
DIR_SOUTH
|
DIR_EAST
),

41 
	mDIR_NORTHWEST
 = (
DIR_NORTH
|
DIR_WEST
),

42 
	mDIR_SOUTHWEST
 = (
DIR_SOUTH
|
DIR_WEST
),

43 
	mDIR_ALL
 = (
DIR_NORTH
|
DIR_SOUTH
|
DIR_EAST
|
DIR_WEST
)

44 } 
	tCÚÃùiÚPoštDœeùiÚ
;

48 
	mCP_FLAG_ANYPLACE
 = (1<<0),

51 
	mCP_FLAG_AUTOGAP
 = (1<<1),

55 
	mCP_FLAGS_MAIN
 = (
CP_FLAG_ANYPLACE
|
CP_FLAG_AUTOGAP
)

58 } 
	tCÚÃùiÚPoštFÏgs
;

63 
	s_CÚÃùiÚPošt
 {

64 
Pošt
 
	mpos
;

65 
Pošt
 
	mÏ¡_pos
;

66 
DŸObjeù
 *
	mobjeù
;

67 
GLi¡
 *
	mcÚÃùed
;

68 
gch¬
 
	mdœeùiÚs
;

69 
gch¬
 *
	mÇme
;

70 
gušt8
 
	mæags
;

78 
DIAVAR
 
gšt
 
fšd_¦İe_dœeùiÚs
(
Pošt
 
äom
, Pošˆ
to
);

85 
DIAVAR
 
cÚÅošt_upd©e
(
CÚÃùiÚPošt
 *
p
, 
»®
 
x
,„—È
y
, 
gšt
 
dœs
);

87 
DIAVAR
 
gboŞ—n
 
cÚÅošt_is_autog­
(
CÚÃùiÚPošt
 *
ı
);

	@O:\tool\dvs50\lib\connpoint_line.c

20 
	~<cÚfig.h
>

22 
	~<¡ršg.h
>

23 
	~"cÚÅošt_lše.h
"

24 
	~"cÚÃùiÚpošt.h
"

25 
	~"dŸ_xml.h
"

27 
	#DEBUG_PARENT
 0

	)

28 
	#DEBUG_ORDER
 0

	)

30 
ıl_»Üd”_cÚÃùiÚs
(
CÚnPoštLše
 *
ıl
);

32 
šlše
 
CÚÃùiÚPošt
 *
	$Ãw_cÚÅošt
(
DŸObjeù
 *
obj
)

34 
CÚÃùiÚPošt
 *
ı
 = 
	`g_Ãw0
(ConnectionPoint,1);

35 
ı
->
objeù
 = 
obj
;

36  
ı
;

37 
	}
}

39 
šlše
 
	$d–_cÚÅošt
(
CÚÃùiÚPošt
 *
ı
)

41 
	`g_ä“
(
ı
);

42 
	}
}

44 
CÚÃùiÚPošt
 *

45 
	$ıl_»move_cÚÅošt
(
CÚnPoštLše
 *
ıl
,
pos
)

47 
CÚÃùiÚPošt
 *
ı
;

49 
	`g_as£¹
 (
ıl
->
num_cÚÃùiÚs
 > 0);

51 ià(
pos
 >ğ
ıl
->
num_cÚÃùiÚs
) {

52 
pos
 = 
ıl
->
num_cÚÃùiÚs
 - 1;

54 
pos
 < 0èpo +ğ
ıl
->
num_cÚÃùiÚs
;

57 
ı
 = (
CÚÃùiÚPošt
 *)(
	`g_¦i¡_Áh
(
ıl
->
cÚÃùiÚs
,
pos
)->
d©a
);

58 
	`g_as£¹
(
ı
);

60 
ıl
->
cÚÃùiÚs
 = 
	`g_¦i¡_»move
(ıl->cÚÃùiÚs,(
gpoš‹r
)
ı
);

61 
	`objeù_»move_cÚÃùiÚpošt
(
ıl
->
·»Á
,
ı
);

63 
ıl
->
num_cÚÃùiÚs
--;

67  
ı
;

68 
	}
}

71 
	$ıl_add_cÚÃùiÚpošt_©
(
CÚnPoštLše
 *
ıl
, 
pos
,
CÚÃùiÚPošt
 *
ı
)

73 ià(
pos
 == 0) {

76 
åos
,
i
;

77 
CÚÃùiÚPošt
 *
fı
;

78 
	`g_as£¹
(
ıl
->
cÚÃùiÚs
);

79 
åos
 = -1;

80 
fı
 = (
CÚÃùiÚPošt
 *)(
ıl
->
cÚÃùiÚs
->
d©a
);

81 
	`g_as£¹
(
fı
);

82 
i
=0; i<
ıl
->
·»Á
->
num_cÚÃùiÚs
; i++) {

83 ià(
ıl
->
·»Á
->
cÚÃùiÚs
[
i
] =ğ
fı
) {

84 
åos
 = 
i
;

88 
	`g_as£¹
(
åos
 >= 0);

89 
	`objeù_add_cÚÃùiÚpošt_©
(
ıl
->
·»Á
,
ı
,
åos
);

93 
	`objeù_add_cÚÃùiÚpošt
(
ıl
->
·»Á
,
ı
);

95 ià(
pos
 < 0) {

96 
ıl
->
cÚÃùiÚs
 = 
	`g_¦i¡_­³nd
(ıl->cÚÃùiÚs,(
gpoš‹r
)
ı
);

99 
ıl
->
cÚÃùiÚs
 = 
	`g_¦i¡_š£¹
(ıl->cÚÃùiÚs,(
gpoš‹r
)
ı
,
pos
);

101 
ıl
->
num_cÚÃùiÚs
++;

107 
	}
}

109 
šlše
 

110 
	$ıl_add_cÚÃùiÚpošt
(
CÚnPoštLše
 *
ıl
,
CÚÃùiÚPošt
 *
ı
)

112 
	`ıl_add_cÚÃùiÚpošt_©
(
ıl
,-1,
ı
);

113 
	}
}

115 
CÚnPoštLše
 *

116 
	$cÚÅošše_ü—‹
(
DŸObjeù
 *
·»Á
, 
num_cÚÃùiÚs
)

118 
CÚnPoštLše
 *
ıl
;

119 
i
;

121 
ıl
 = 
	`g_Ãw0
(
CÚnPoštLše
,1);

122 
ıl
->
·»Á
 =…arent;

124 
ıl
->
cÚÃùiÚs
 = 
NULL
;

125 
i
=0; i<
num_cÚÃùiÚs
; i++) {

126 
	`ıl_add_cÚÃùiÚpošt
(
ıl
,
	`Ãw_cÚÅošt
(ıl->
·»Á
));

128 
	`ıl_»Üd”_cÚÃùiÚs
(
ıl
);

129  
ıl
;

130 
	}
}

133 
	$cÚÅošše_de¡roy
(
CÚnPoštLše
 *
ıl
)

135 
ıl
->
num_cÚÃùiÚs
 > 0è
	`d–_cÚÅošt
(
	`ıl_»move_cÚÅošt
(cpl,0));

136 
	`g_ä“
(
ıl
);

137 
	}
}

139 
CÚnPoštLše
 *

140 
	$ıl_š¶aûü—‹
(
DŸObjeù
 *
obj
, 
nc
, *
»®cÚncouÁ
)

142 
i
;

143 
CÚnPoštLše
 *
Ãwıl
;

144 
CÚÃùiÚPošt
 *
ı
;

148 
Ãwıl
 = 
	`g_Ãw0
(
CÚnPoštLše
,1);

149 
Ãwıl
->
·»Á
 = 
obj
;

151 
i
=0; i < 
nc
; i++,(*
»®cÚncouÁ
)++) {

152 
ı
 = 
	`g_Ãw0
(
CÚÃùiÚPošt
,1);

153 
ı
->
objeù
 = 
Ãwıl
->
·»Á
;

154 
obj
->
cÚÃùiÚs
[*
»®cÚncouÁ
] = 
ı
;

155 
Ãwıl
->
cÚÃùiÚs
 = 
	`g_¦i¡_­³nd
Òewıl->cÚÃùiÚs,
ı
);

157 
Ãwıl
->
num_cÚÃùiÚs
 = 
nc
;

158  
Ãwıl
;

159 
	}
}

161 
CÚnPoštLše
 *

162 
	$cÚÅošše_lßd
(
DŸObjeù
 *
obj
,
ObjeùNode
 
obj_node
,

163 cÚ¡ 
gch¬
 *
Çme
, 
deçuÉ_nc
,*
»®cÚncouÁ
)

165 
CÚnPoštLše
 *
ıl
;

166 
nc
 = 
deçuÉ_nc
;

167 
A‰ribu‹Node
 
©Œ
;

169 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
Çme
);

170 ià(
©Œ
 !ğ
NULL
)

171 
nc
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

172 
ıl
 = 
	`cÚÅošše_ü—‹
(
obj
,
nc
);

174 ià(
»®cÚncouÁ
è(*»®cÚncouÁè+ğ
ıl
->
num_cÚÃùiÚs
;

175  
ıl
;

181 
	}
}

184 
	$cÚÅošše_§ve
(
CÚnPoštLše
 *
ıl
,
ObjeùNode
 
obj_node
,

185 cÚ¡ 
gch¬
 *
Çme
)

187 
	`d©a_add_št
(
	`Ãw_©Œibu‹
(
obj_node
, 
Çme
),
ıl
->
num_cÚÃùiÚs
);

188 
	}
}

190 
CÚnPoštLše
 *

191 
	$cÚÅošše_cİy
(
DŸObjeù
 *
Ãwobj
,
CÚnPoštLše
 *
ıl
, *
»®cÚncouÁ
)

193 
	`g_as£¹
(
»®cÚncouÁ
);

194  
	`ıl_š¶aûü—‹
(
Ãwobj
,
ıl
->
num_cÚÃùiÚs
,
»®cÚncouÁ
);

195 
	}
}

197 
	$cÚÅošše_upd©e
(
CÚnPoštLše
 *
ıl
)

200 
	}
}

203 
	$cÚÅošše_putÚ®še
(
CÚnPoštLše
 *
ıl
,
Pošt
 *
¡¬t
,Pošˆ*
’d
)

205 
Pošt
 
£_veùÜ
;

206 
»®
 
£_Ën
,
p£udİošts
;

207 
i
;

208 
GSLi¡
 *
–em
;

209 
gšt
 
dœs
;

211 
	`pošt_cİy
(&
£_veùÜ
, 
’d
);

212 
	`pošt_sub
(&
£_veùÜ
, 
¡¬t
);

214 
£_Ën
 = 
	`pošt_Ën
(&
£_veùÜ
);

216 ià(
£_Ën
 > 0)

217 
	`pošt_nÜm®ize
(&
£_veùÜ
);

219 
ıl
->
¡¬t
 = *start;

220 
ıl
->
’d
 = *end;

222 ià(
	`çbs
(
£_veùÜ
.
x
è> fabs(£_veùÜ.
y
))

223 
dœs
 = 
DIR_NORTH
|
DIR_SOUTH
;

225 
dœs
 = 
DIR_EAST
|
DIR_WEST
;

227 
p£udİošts
 = 
ıl
->
num_cÚÃùiÚs
 + 1;

229 
i
=0, 
–em
=
ıl
->
cÚÃùiÚs
;

230 
i
<
ıl
->
num_cÚÃùiÚs
;

231 
i
++,
–em
=
	`g_¦i¡_Ãxt
(elem)) {

232 
CÚÃùiÚPošt
 *
ı
 = (CÚÃùiÚPošˆ*)(
–em
->
d©a
);

233 
ı
->
pos
 = 
£_veùÜ
;

234 
ı
->
dœeùiÚs
 = 
dœs
;

235 
	`pošt_sÿË
(&
ı
->
pos
,
£_Ën
 * (
i
+1.0)/
p£udİošts
);

236 
	`pošt_add
(&
ı
->
pos
,
¡¬t
);

238 
	}
}

244 
	$objeù_move_cÚÃùiÚ
(
DŸObjeù
 *
obj
,
sourûpos
,
de¡pos
)

246 
CÚÃùiÚPošt
 *
ı
;

247 
	`g_as£¹
(
de¡pos
 < 
sourûpos
);

248 
ı
 = 
obj
->
cÚÃùiÚs
[
sourûpos
];

250 
	`memmove
(&(
obj
->
cÚÃùiÚs
[
de¡pos
+1]),&(obj->connections[destpos]),

251 (
CÚÃùiÚPošt
 *)*(
sourûpos
-
de¡pos
));

252 
obj
->
cÚÃùiÚs
[
de¡pos
] = 
ı
;

253 
	}
}

256 
	$objeù_fšd_cÚÃùiÚ
(
DŸObjeù
 *
obj
, 
CÚÃùiÚPošt
 *
ı
, 
¡¬os
)

258 
i
;

259 
i
 = 
¡¬os
; i < 
obj
->
num_cÚÃùiÚs
; i++) {

260 ià(
obj
->
cÚÃùiÚs
[
i
] =ğ
ı
)  i;

263 
	}
}

266 #ià
DEBUG_ORDER


267 
	$obj_fšd_cÚÃùiÚ
(
DŸObjeù
 *
obj
,
CÚÃùiÚPošt
 *
ı
)

269 
i
;

270 
i
=0;i<
obj
->
num_cÚÃùiÚs
;i++)

271 ià(
ı
 =ğ
obj
->
cÚÃùiÚs
[
i
])  i;

273 
	}
}

276 
	$ıl_dump_cÚÃùiÚs
(
CÚnPoštLše
 *
ıl
)

278 
DŸObjeù
 *
obj
 = 
ıl
->
·»Á
;

279 
i
;

280 
GSLi¡
 *
–em
;

281 
CÚÃùiÚPošt
 *
ı
;

283 
	`g_mes§ge
("CPL order dump");

284 
i
=0,
–em
 = 
ıl
->
cÚÃùiÚs
;

285 
i
<
ıl
->
num_cÚÃùiÚs
;

286 
i
++,
–em
 = 
	`g_¦i¡_Ãxt
(elem)) {

287 
ı
 = (
CÚÃùiÚPošt
 *)(
–em
->
d©a
);

288 
	`g_mes§ge
("connection %p %d@CPL %d@OBJ",

289 
ı
,
i
,
	`obj_fšd_cÚÃùiÚ
(
obj
,cp));

291 
	}
}

295 
	$ıl_»Üd”_cÚÃùiÚs
(
CÚnPoštLše
 *
ıl
)

310 
i
,
j
,
fœ¡
;

311 
CÚÃùiÚPošt
 *
ı
;

312 
GSLi¡
 *
–em
;

313 
DŸObjeù
 *
obj
;

315 ià(!
ıl
->
cÚÃùiÚs
) ;

316 #ià
DEBUG_ORDER


317 
	`g_mes§ge
("before cpl_reorder");

318 
	`ıl_dump_cÚÃùiÚs
(
ıl
);

321 
fœ¡
 = -1;

322 
ı
 = (
CÚÃùiÚPošt
 *)(
ıl
->
cÚÃùiÚs
->
d©a
);

323 
obj
 = 
ıl
->
·»Á
;

324 
i
=0; i<
obj
->
num_cÚÃùiÚs
; i++){

325 ià(
obj
->
cÚÃùiÚs
[
i
] =ğ
ı
) {

326 
fœ¡
 = 
i
;

330 
	`g_as£¹
(
fœ¡
 >= 0);

331 
i
=0,
j
=
fœ¡
,
–em
=
ıl
->
cÚÃùiÚs
;

332 
i
<
ıl
->
num_cÚÃùiÚs
;

333 
–em
=
	`g_¦i¡_Ãxt
ÓËm),
i
++,
j
++) {

334 
ı
 = (
CÚÃùiÚPošt
 *)(
–em
->
d©a
);

335 iàĞ
ı
 !ğ
obj
->
cÚÃùiÚs
[
j
]) {

337 
	`objeù_move_cÚÃùiÚ
(
obj
,
	`objeù_fšd_cÚÃùiÚ
(obj,
ı
,
j
),j);

340 #ià
DEBUG_ORDER


341 
	`g_mes§ge
("after cpl_reorder");

342 
	`ıl_dump_cÚÃùiÚs
(
ıl
);

344 #ià
DEBUG_PARENT


345 
j
 = 0;

346 
i
=0; i<
ıl
->
·»Á
->
num_cÚÃùiÚs
;i++)

347 ià(!
ıl
->
·»Á
->
cÚÃùiÚs
[
i
]è
j
++;

349 ià(
j
è
	`g_w¬nšg
("in cpl_reorder_connectionshere‡re %d holes inhe…arent's ConnectionPoint†ist !",j);

351 
	}
}

356 
	$cÚÅošše_ÿn_add_pošt
(
CÚnPoštLše
 *
ıl
, 
Pošt
 *
şicked
)

359 
	}
}

362 
	$cÚÅošše_ÿn_»move_pošt
(
CÚnPoštLše
 *
ıl
, 
Pošt
 *
şicked
)

364 ià(
ıl
->
num_cÚÃùiÚs
 <= 1)

368 
	}
}

371 
	$ıl_g‘_poštbefÜe
(
CÚnPoštLše
 *
ıl
, 
Pošt
 *
şickedpošt
)

373 
i
, 
pos
 = -1;

374 
GSLi¡
 *
–em
;

375 
CÚÃùiÚPošt
 *
ı
;

376 
»®
 
di¡
 = 65536.0;

377 
»®
 
tmpdi¡
;

379 ià(!
şickedpošt
)  0;

381 
i
=0,
–em
=
ıl
->
cÚÃùiÚs
;

382 
i
<
ıl
->
num_cÚÃùiÚs
;

383 
i
++,
–em
=
	`g_¦i¡_Ãxt
(elem)) {

384 
ı
 = (
CÚÃùiÚPošt
 *)(
–em
->
d©a
);

386 
tmpdi¡
 = 
	`di¡ªû_pošt_pošt
(&
ı
->
pos
,
şickedpošt
);

387 ià(
tmpdi¡
 < 
di¡
) {

388 
di¡
 = 
tmpdi¡
;

389 
pos
 = 
i
;

392 
tmpdi¡
 = 
	`di¡ªû_pošt_pošt
(&
ıl
->
’d
,
şickedpošt
);

393 ià(
tmpdi¡
 < 
di¡
) {

395 
pos
 = -1;

397  
pos
;

398 
	}
}

401 
ObjeùChªge
 
	mobj_chªge
;

403 
	madd
;

404 
	m­¶›d
;

406 
CÚnPoštLše
 *
	mıl
;

407 
	mpos
;

408 
CÚÃùiÚPošt
 **
	mı
;

409 } 
	tCPLChªge
;

412 
	$ıl_chªge_add»move
(
CPLChªge
 *
chªge
, 
CÚnPoštLše
 *
ıl
,

413 
aùiÚ
, 
»suÉšg­¶›d
)

415 ià(
aùiÚ
 != 0) {

416 ià(
aùiÚ
 > 0) {

417 
aùiÚ
--) {

418 
	`ıl_add_cÚÃùiÚpošt_©
(
ıl
,
chªge
->
pos
,chªge->
ı
[
aùiÚ
]);

419 
chªge
->
ı
[
aùiÚ
] = 
NULL
;

421 
	`ıl_»Üd”_cÚÃùiÚs
(
ıl
);

423 
aùiÚ
++) {

424 
chªge
->
ı
[-
aùiÚ
] = 
	`ıl_»move_cÚÅošt
(
ıl
,chªge->
pos
);

428 
	`g_w¬nšg
("cpl_change_addremove():‚ull‡ction !");

430 
chªge
->
­¶›d
 = 
»suÉšg­¶›d
;

431 
	}
}

434 
	$ıl_chªge_­¶y
(
CPLChªge
 *
chªge
, 
CÚnPoštLše
 *
´obablynÙıl
)

436 
	`ıl_chªge_add»move
(
chªge
,chªge->
ıl
,chªge->
add
,1);

437 
	}
}

440 
	$ıl_chªge_»v”t
(
CPLChªge
 *
chªge
, 
CÚnPoštLše
 *
´obablynÙıl
)

442 
	`ıl_chªge_add»move
(
chªge
,chªge->
ıl
,-(chªge->
add
),0);

443 
	}
}

445 
	$ıl_chªge_ä“
(
CPLChªge
 *
chªge
)

447 
i
 = 
	`ABS
(
chªge
->
add
);

449 
i
--) {

450 ià(
chªge
->
ı
[
i
]) {

451 
	`d–_cÚÅošt
(
chªge
->
ı
[
i
]);

454 
	`g_ä“
(
chªge
->
ı
); chªge->ı = (
CÚÃùiÚPošt
 **)(0xDEADBEEF);

455 
	}
}

457 
ObjeùChªge
 *

458 
	$ıl_ü—‹_chªge
(
CÚnPoštLše
 *
ıl
, 
pos
, 
add
)

460 
CPLChªge
 *
chªge
;

462 
chªge
 = 
	`g_Ãw0
(
CPLChªge
,1);

464 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
ıl_chªge_­¶y
;

465 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
ıl_chªge_»v”t
;

466 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
ıl_chªge_ä“
;

468 
chªge
->
ıl
 = cpl;

469 
chªge
->
­¶›d
 = 0;

470 
chªge
->
add
 =‡dd;

471 
chªge
->
pos
 =…os;

473 
chªge
->
ı
 = 
	`g_m®loc0
((
CÚÃùiÚPošt
 *è* 
	`ABS
(
add
));

474 
add
-- > 0) {

475 
chªge
->
ı
[
add
] = 
	`Ãw_cÚÅošt
(
ıl
->
·»Á
);

478  (
ObjeùChªge
 *)
chªge
;

479 
	}
}

481 
ObjeùChªge
 *

482 
	$cÚÅošše_add_pošts
(
CÚnPoštLše
 *
ıl
,

483 
Pošt
 *
şickedpošt
, 
couÁ
)

485 
pos
;

486 
ObjeùChªge
 *
chªge
;

488 
pos
 = 
	`ıl_g‘_poštbefÜe
(
ıl
,
şickedpošt
);

489 
chªge
 = 
	`ıl_ü—‹_chªge
(
ıl
,
pos
,
couÁ
);

491 
chªge
->
	`­¶y
(chªge, (
DŸObjeù
 *)
ıl
);

492  
chªge
;

493 
	}
}

496 
ObjeùChªge
 *

497 
	$cÚÅošše_»move_pošts
(
CÚnPoštLše
 *
ıl
,

498 
Pošt
 *
şickedpošt
, 
couÁ
)

500 
pos
;

501 
ObjeùChªge
 *
chªge
;

503 
pos
 = 
	`ıl_g‘_poštbefÜe
(
ıl
,
şickedpošt
);

504 
chªge
 = 
	`ıl_ü—‹_chªge
(
ıl
,
pos
,-
couÁ
);

506 
chªge
->
	`­¶y
(chªge, (
DŸObjeù
 *)
ıl
);

507  
chªge
;

508 
	}
}

511 
	$cÚÅošše_adju¡_couÁ
(
CÚnPoštLše
 *
ıl
,

512 
ÃwcouÁ
, 
Pošt
 *
wh”e
)

514 
ŞdcouÁ
,
d–
;

516 
ŞdcouÁ
 = 
ıl
->
num_cÚÃùiÚs
;

518 ià(
ÃwcouÁ
 < 0)‚ewcount = 0;

520 
d–
 = 
ÃwcouÁ
 - 
ŞdcouÁ
;

521 ià(
d–
 != 0) {

522 
ObjeùChªge
 *
chªge
;

525 ià(
d–
 > 0) {

526 
chªge
 = 
	`cÚÅošše_add_pošts
(
ıl
, 
wh”e
, 
d–
);

528 
chªge
 = 
	`cÚÅošše_»move_pošts
(
ıl
, 
wh”e
, -
d–
);

530 ià(
chªge
->
ä“
èchªge->
	`ä“
(change);

531 
	`g_ä“
(
chªge
);

535  
ŞdcouÁ
;

536 
	}
}

	@O:\tool\dvs50\lib\connpoint_line.h

24 #iâdeà
__CONNPOINT_LINE_H


25 
	#__CONNPOINT_LINE_H


	)

27 
	~<¡dio.h
>

28 
	~<¡dlib.h
>

29 
	~<as£¹.h
>

30 
	~<m©h.h
>

31 
	~<glib.h
>

33 
	~"geom‘ry.h
"

34 
	~"cÚÃùiÚpošt.h
"

35 
	~"objeù.h
"

36 
	~"dŸ_xml.h
"

39 
Pošt
 
	m¡¬t
,
	m’d
;

40 
DŸObjeù
 *
	m·»Á
;

42 
	mnum_cÚÃùiÚs
;

43 
GSLi¡
 *
	mcÚÃùiÚs
;

44 } 
	tCÚnPoštLše
;

47 
DIAVAR
 
CÚnPoštLše
 *
cÚÅošše_ü—‹
(
DŸObjeù
 *
·»Á
,

48 
num_cÚÃùiÚs
);

49 
DIAVAR
 
cÚÅošše_de¡roy
(
CÚnPoštLše
 *
ıl
);

50 
DIAVAR
 
cÚÅošše_upd©e
(
CÚnPoštLše
 *
ıl
);

51 
DIAVAR
 
cÚÅošše_putÚ®še
(
CÚnPoštLše
 *
ıl
,
Pošt
 *
¡¬t
,Pošˆ*
’d
);

52 
DIAVAR
 
cÚÅošše_ÿn_add_pošt
(
CÚnPoštLše
 *
ıl
,

53 
Pošt
 *
şicked
);

54 
DIAVAR
 
cÚÅošše_ÿn_»move_pošt
(
CÚnPoštLše
 *
ıl
,

55 
Pošt
 *
şicked
);

57 
DIAVAR
 
ObjeùChªge
 *
cÚÅošše_add_pošts
(
CÚnPoštLše
 *
ıl
,

58 
Pošt
 *
şickedpošt
,

59 
couÁ
);

60 
DIAVAR
 
ObjeùChªge
 *
cÚÅošše_»move_pošts
(
CÚnPoštLše
 *
ıl
,

61 
Pošt
 *
şickedpošt
,

62 
couÁ
);

63 
DIAVAR
 
CÚnPoštLše
 *
cÚÅošše_lßd
(
DŸObjeù
 *
obj
,
ObjeùNode
 
obj_node
,

64 cÚ¡ 
gch¬
 *
Çme
, 
deçuÉ_nc
,

65 *
»®cÚncouÁ
);

66 
DIAVAR
 
cÚÅošše_§ve
(
CÚnPoštLše
 *
ıl
,
ObjeùNode
 
obj_node
,

67 cÚ¡ 
gch¬
 *
Çme
);

68 
DIAVAR
 
CÚnPoštLše
 *
cÚÅošše_cİy
(
DŸObjeù
 *
Ãwobj
,CÚnPoštLš*
ıl
,

69 *
»®cÚncouÁ
);

71 
	#cÚÅošše_add_pošt
(
ıl
, 
şickedpošt
) \

72 
	`cÚÅošše_add_pošts
(
ıl
, 
şickedpošt
, 1)

	)

73 
	#cÚÅošše_»move_pošt
(
ıl
, 
şickedpošt
) \

74 
	`cÚÅošše_»move_pošts
(
ıl
, 
şickedpošt
, 1)

	)

76 
DIAVAR
 
cÚÅošše_adju¡_couÁ
(
CÚnPoštLše
 *
ıl
,

77 
ÃwcouÁ
, 
Pošt
 *
wh”e
);

	@O:\tool\dvs50\lib\create.c

23 #ifdeà
HAVE_CONFIG_H


24 
	~<cÚfig.h
>

27 
	~<¡ršg.h
>

28 
	~<m©h.h
>

29 
	~<glib.h
>

30 
	~<¡dlib.h
>

32 
	~"š.h
"

33 
	~"mes§ge.h
"

34 
	~"geom‘ry.h
"

35 
	~"f‹r.h
"

36 
	~"objeù.h
"

37 
	~"´İ”t›s.h
"

38 
	~"´İš‹º®s.h
"

39 
	~"group.h
"

40 
	~"ü—‹.h
"

42 
DŸObjeù
 *

43 
	$ü—‹_¡ªd¬d_‹xt
(
»®
 
xpos
,„—È
ypos
) {

44 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("Standard - Text");

45 
DŸObjeù
 *
Ãw_obj
;

46 
HªdË
 *
h1
, *
h2
;

47 
Pošt
 
pošt
;

49 ià(
Ùy³
 =ğ
NULL
){

50 
	`mes§ge_”rÜ
(
	`_
("Can't find standard object"));

51  
NULL
;

54 
pošt
.
x
 = 
xpos
;

55 
pošt
.
y
 = 
ypos
;

57 
Ãw_obj
 = 
Ùy³
->
İs
->
	`ü—‹
(&
pošt
, oty³->
deçuÉ_u£r_d©a
,

58 &
h1
, &
h2
);

60  
Ãw_obj
;

61 
	}
}

63 
PrİDesütiÚ
 
	gü—‹_–em’t_´İ_descs
[] = {

64 { "–em_cÜÃr", 
PROP_TYPE_POINT
 },

65 { "–em_width", 
PROP_TYPE_REAL
 },

66 { "–em_height", 
PROP_TYPE_REAL
 },

67 
PROP_DESC_END
};

69 
GPŒA¼ay
 *
	$make_–em’t_´İs
(
»®
 
xpos
,„—È
ypos
,

70 
»®
 
width
,„—È
height
)

72 
GPŒA¼ay
 *
´İs
;

73 
PoštPrİ”ty
 *
µrİ
;

74 
R—lPrİ”ty
 *
½rİ
;

76 
´İs
 = 
	`´İ_li¡_äom_descs
(
ü—‹_–em’t_´İ_descs
,
pdp_Œue
);

77 
	`g_as£¹
(
´İs
->
Ën
 == 3);

79 
µrİ
 = 
	`g_±r_¬¿y_šdex
(
´İs
,0);

80 
µrİ
->
pošt_d©a
.
x
 = 
xpos
;

81 
µrİ
->
pošt_d©a
.
y
 = 
ypos
;

82 
½rİ
 = 
	`g_±r_¬¿y_šdex
(
´İs
,1);

83 
½rİ
->
»®_d©a
 = 
width
;

84 
½rİ
 = 
	`g_±r_¬¿y_šdex
(
´İs
,2);

85 
½rİ
->
»®_d©a
 = 
height
;

87  
´İs
;

88 
	}
}

90 
DŸObjeù
 *

91 
	$ü—‹_¡ªd¬d_–l£
(
»®
 
xpos
,„—È
ypos
,„—È
width
,„—È
height
) {

92 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("Standard - Ellipse");

93 
DŸObjeù
 *
Ãw_obj
;

94 
HªdË
 *
h1
, *
h2
;

96 
GPŒA¼ay
 *
´İs
;

97 
Pošt
 
pošt
;

99 ià(
Ùy³
 =ğ
NULL
){

100 
	`mes§ge_”rÜ
(
	`_
("Can't find standard object"));

101  
NULL
;

104 
pošt
.
x
 = 
xpos
;

105 
pošt
.
y
 = 
ypos
;

107 
Ãw_obj
 = 
Ùy³
->
İs
->
	`ü—‹
(&
pošt
, oty³->
deçuÉ_u£r_d©a
,

108 &
h1
, &
h2
);

110 
´İs
 = 
	`make_–em’t_´İs
(
xpos
,
ypos
,
width
,
height
);

111 
Ãw_obj
->
İs
->
	`£t_´İs
Òew_obj, 
´İs
);

112 
	`´İ_li¡_ä“
(
´İs
);

114  
Ãw_obj
;

115 
	}
}

118 
DŸObjeù
 *

119 
	$ü—‹_¡ªd¬d_box
(
»®
 
xpos
,„—È
ypos
,„—È
width
,„—È
height
) {

120 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("Standard - Box");

121 
DŸObjeù
 *
Ãw_obj
;

122 
HªdË
 *
h1
, *
h2
;

123 
Pošt
 
pošt
;

124 
GPŒA¼ay
 *
´İs
;

126 ià(
Ùy³
 =ğ
NULL
){

127 
	`mes§ge_”rÜ
(
	`_
("Can't find standard object"));

128  
NULL
;

131 
pošt
.
x
 = 
xpos
;

132 
pošt
.
y
 = 
ypos
;

134 
Ãw_obj
 = 
Ùy³
->
İs
->
	`ü—‹
(&
pošt
, oty³->
deçuÉ_u£r_d©a
,

135 &
h1
, &
h2
);

137 
´İs
 = 
	`make_–em’t_´İs
(
xpos
,
ypos
,
width
,
height
);

138 
Ãw_obj
->
İs
->
	`£t_´İs
Òew_obj, 
´İs
);

139 
	`´İ_li¡_ä“
(
´İs
);

141  
Ãw_obj
;

142 
	}
}

144 
PrİDesütiÚ
 
	gü—‹_lše_´İ_descs
[] = {

145 
PROP_STD_START_ARROW
,

146 
PROP_STD_END_ARROW
,

147 
PROP_DESC_END
};

149 
DŸObjeù
 *

150 
	$ü—‹_¡ªd¬d_pŞylše
(
num_pošts
,

151 
Pošt
 *
pošts
,

152 
A¼ow
 *
’d_¬row
,

153 
A¼ow
 *
¡¬t_¬row
) {

154 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("Standard - PolyLine");

155 
DŸObjeù
 *
Ãw_obj
;

156 
HªdË
 *
h1
, *
h2
;

157 
MuÉoštC»©eD©a
 *
pcd
;

158 
GPŒA¼ay
 *
´İs
;

160 ià(
Ùy³
 =ğ
NULL
){

161 
	`mes§ge_”rÜ
(
	`_
("Can't find standard object"));

162  
NULL
;

165 
pcd
 = 
	`g_Ãw
(
MuÉoštC»©eD©a
, 1);

166 
pcd
->
num_pošts
 =‚um_points;

167 
pcd
->
pošts
 =…oints;

169 
Ãw_obj
 = 
Ùy³
->
İs
->
	`ü—‹
(
NULL
, 
pcd
,

170 &
h1
, &
h2
);

172 
	`g_ä“
(
pcd
);

174 
´İs
 = 
	`´İ_li¡_äom_descs
(
ü—‹_lše_´İ_descs
,
pdp_Œue
);

175 
	`g_as£¹
(
´İs
->
Ën
 == 2);

177 ià(
¡¬t_¬row
 !ğ
NULL
)

178 ((
A¼owPrİ”ty
 *)
	`g_±r_¬¿y_šdex
(
´İs
, 0))->
¬row_d©a
 = *
¡¬t_¬row
;

179 ià(
’d_¬row
 !ğ
NULL
)

180 ((
A¼owPrİ”ty
 *)
	`g_±r_¬¿y_šdex
(
´İs
, 1))->
¬row_d©a
 = *
’d_¬row
;

182 
Ãw_obj
->
İs
->
	`£t_´İs
Òew_obj, 
´İs
);

183 
	`´İ_li¡_ä“
(
´İs
);

185  
Ãw_obj
;

186 
	}
}

188 
DŸObjeù
 *

189 
	$ü—‹_¡ªd¬d_pŞygÚ
(
num_pošts
,

190 
Pošt
 *
pošts
) {

191 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("Standard - Polygon");

192 
DŸObjeù
 *
Ãw_obj
;

193 
HªdË
 *
h1
, *
h2
;

194 
MuÉoštC»©eD©a
 *
pcd
;

196 ià(
Ùy³
 =ğ
NULL
){

197 
	`mes§ge_”rÜ
(
	`_
("Can't find standard object"));

198  
NULL
;

201 
pcd
 = 
	`g_Ãw
(
MuÉoštC»©eD©a
, 1);

202 
pcd
->
num_pošts
 =‚um_points;

203 
pcd
->
pošts
 =…oints;

205 
Ãw_obj
 = 
Ùy³
->
İs
->
	`ü—‹
(
NULL
, 
pcd
, &
h1
, &
h2
);

207 
	`g_ä“
(
pcd
);

209  
Ãw_obj
;

210 
	}
}

212 
DŸObjeù
 *

213 
	$ü—‹_¡ªd¬d_bez›¾še
(
num_pošts
,

214 
BezPošt
 *
pošts
,

215 
A¼ow
 *
’d_¬row
,

216 
A¼ow
 *
¡¬t_¬row
) {

217 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("Standard - BezierLine");

218 
DŸObjeù
 *
Ãw_obj
;

219 
HªdË
 *
h1
, *
h2
;

220 
Bez›rC»©eD©a
 *
bcd
;

221 
GPŒA¼ay
 *
´İs
;

223 ià(
Ùy³
 =ğ
NULL
){

224 
	`mes§ge_”rÜ
(
	`_
("Can't find standard object"));

225  
NULL
;

228 
bcd
 = 
	`g_Ãw
(
Bez›rC»©eD©a
, 1);

229 
bcd
->
num_pošts
 =‚um_points;

230 
bcd
->
pošts
 =…oints;

232 
Ãw_obj
 = 
Ùy³
->
İs
->
	`ü—‹
(
NULL
, 
bcd
,

233 &
h1
, &
h2
);

235 
	`g_ä“
(
bcd
);

237 
´İs
 = 
	`´İ_li¡_äom_descs
(
ü—‹_lše_´İ_descs
,
pdp_Œue
);

238 
	`g_as£¹
(
´İs
->
Ën
 == 2);

240 ià(
¡¬t_¬row
 !ğ
NULL
)

241 ((
A¼owPrİ”ty
 *)
	`g_±r_¬¿y_šdex
(
´İs
, 0))->
¬row_d©a
 = *
¡¬t_¬row
;

242 ià(
’d_¬row
 !ğ
NULL
)

243 ((
A¼owPrİ”ty
 *)
	`g_±r_¬¿y_šdex
(
´İs
, 1))->
¬row_d©a
 = *
’d_¬row
;

245 
Ãw_obj
->
İs
->
	`£t_´İs
Òew_obj, 
´İs
);

246 
	`´İ_li¡_ä“
(
´İs
);

248  
Ãw_obj
;

249 
	}
}

251 
DŸObjeù
 *

252 
	$ü—‹_¡ªd¬d_bez›rgÚ
(
num_pošts
,

253 
BezPošt
 *
pošts
) {

254 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("Standard - Beziergon");

255 
DŸObjeù
 *
Ãw_obj
;

256 
HªdË
 *
h1
, *
h2
;

257 
Bez›rC»©eD©a
 *
bcd
;

259 ià(
Ùy³
 =ğ
NULL
){

260 
	`mes§ge_”rÜ
(
	`_
("Can't find standard object"));

261  
NULL
;

264 
bcd
 = 
	`g_Ãw
(
Bez›rC»©eD©a
, 1);

265 
bcd
->
num_pošts
 =‚um_points;

266 
bcd
->
pošts
 =…oints;

268 
Ãw_obj
 = 
Ùy³
->
İs
->
	`ü—‹
(
NULL
, 
bcd
,

269 &
h1
, &
h2
);

271 
	`g_ä“
(
bcd
);

273  
Ãw_obj
;

274 
	}
}

277 
PrİDesütiÚ
 
	gü—‹_¬c_´İ_descs
[] = {

278 { "curve_di¡ªû", 
PROP_TYPE_REAL
 },

279 
PROP_STD_START_ARROW
,

280 
PROP_STD_END_ARROW
,

281 
PROP_DESC_END
};

283 
DŸObjeù
 *

284 
	$ü—‹_¡ªd¬d_¬c
(
»®
 
x1
,„—È
y1
,„—È
x2
,„—È
y2
,

285 
»®
 
di¡ªû
,

286 
A¼ow
 *
’d_¬row
,

287 
A¼ow
 *
¡¬t_¬row
) {

288 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("Standard - Arc");

289 
DŸObjeù
 *
Ãw_obj
;

290 
HªdË
 *
h1
, *
h2
;

291 
Pošt
 
p1
, 
p2
;

292 
GPŒA¼ay
 *
´İs
;

294 ià(
Ùy³
 =ğ
NULL
){

295 
	`mes§ge_”rÜ
(
	`_
("Can't find standard object"));

296  
NULL
;

299 
p1
.
x
 = 
x1
;

300 
p1
.
y
 = 
y1
;

301 
p2
.
x
 = 
x2
;

302 
p2
.
y
 = 
y2
;

305 
Ãw_obj
 = 
Ùy³
->
İs
->
	`ü—‹
(&
p1
, oty³->
deçuÉ_u£r_d©a
,

306 &
h1
, &
h2
);

307 
Ãw_obj
->
İs
->
	`move_hªdË
Òew_obj, 
h2
, &
p2
, 
NULL
, 
HANDLE_MOVE_USER_FINAL
,0);

308 
´İs
 = 
	`´İ_li¡_äom_descs
(
ü—‹_¬c_´İ_descs
,
pdp_Œue
);

309 
	`g_as£¹
(
´İs
->
Ën
 == 3);

311 ((
R—lPrİ”ty
 *)
	`g_±r_¬¿y_šdex
(
´İs
,0))->
»®_d©a
 = 
di¡ªû
;

312 ià(
¡¬t_¬row
 !ğ
NULL
)

313 ((
A¼owPrİ”ty
 *)
	`g_±r_¬¿y_šdex
(
´İs
, 1))->
¬row_d©a
 = *
¡¬t_¬row
;

314 ià(
’d_¬row
 !ğ
NULL
)

315 ((
A¼owPrİ”ty
 *)
	`g_±r_¬¿y_šdex
(
´İs
, 2))->
¬row_d©a
 = *
’d_¬row
;

317 
Ãw_obj
->
İs
->
	`£t_´İs
Òew_obj, 
´İs
);

318 
	`´İ_li¡_ä“
(
´İs
);

320  
Ãw_obj
;

321 
	}
}

323 
PrİDesütiÚ
 
	gü—‹_fe_´İ_descs
[] = {

324 { "image_fe", 
PROP_TYPE_FILE
 },

325 
PROP_DESC_END
};

327 
DŸObjeù
 *

328 
	$ü—‹_¡ªd¬d_image
(
»®
 
xpos
,„—È
ypos
,„—È
width
,„—È
height
,

329 *
fe
) {

330 
DŸObjeùTy³
 *
Ùy³
 = 
	`objeù_g‘_ty³
("Standard - Image");

331 
DŸObjeù
 *
Ãw_obj
;

332 
HªdË
 *
h1
, *
h2
;

333 
Pošt
 
pošt
;

334 
GPŒA¼ay
 *
´İs
;

335 
SŒšgPrİ”ty
 *
¥rİ
;

337 ià(
Ùy³
 =ğ
NULL
){

338 
	`mes§ge_”rÜ
(
	`_
("Can't find standard object"));

339  
NULL
;

342 
pošt
.
x
 = 
xpos
;

343 
pošt
.
y
 = 
ypos
;

345 
Ãw_obj
 = 
Ùy³
->
İs
->
	`ü—‹
(&
pošt
, oty³->
deçuÉ_u£r_d©a
,

346 &
h1
, &
h2
);

348 
´İs
 = 
	`make_–em’t_´İs
(
xpos
,
ypos
,
width
,
height
);

349 
Ãw_obj
->
İs
->
	`£t_´İs
Òew_obj, 
´İs
);

350 
	`´İ_li¡_ä“
(
´İs
);

353 
´İs
 = 
	`´İ_li¡_äom_descs
(
ü—‹_fe_´İ_descs
,
pdp_Œue
);

354 
	`g_as£¹
(
´İs
->
Ën
 == 1);

355 
¥rİ
 = 
	`g_±r_¬¿y_šdex
(
´İs
,0);

356 
	`g_ä“
(
¥rİ
->
¡ršg_d©a
);

357 
¥rİ
->
¡ršg_d©a
 = 
	`g_¡rdup
(
fe
);

358 
Ãw_obj
->
İs
->
	`£t_´İs
Òew_obj, 
´İs
);

359 
	`´İ_li¡_ä“
(
´İs
);

361  
Ãw_obj
;

362 
	}
}

364 
DŸObjeù
 *

365 
	$ü—‹_¡ªd¬d_group
(
GLi¡
 *
™ems
) {

366 
DŸObjeù
 *
Ãw_obj
;

368 
Ãw_obj
 = 
	`group_ü—‹
((
GLi¡
*)
™ems
);

370  
Ãw_obj
;

371 
	}
}

	@O:\tool\dvs50\lib\create.h

23 #iâdeà
STANDARD_OBJECT_CREATE_H


24 
	#STANDARD_OBJECT_CREATE_H


	)

26 
	~"dŸty³s.h
"

29 
	s_MuÉoštC»©eD©a
 {

30 
	mnum_pošts
;

31 
Pošt
 *
	mpošts
;

35 
	s_Bez›rC»©eD©a
 {

36 
	mnum_pošts
;

37 
BezPošt
 *
	mpošts
;

45 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_‹xt
(
»®
 
xpos
,„—È
ypos
);

46 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_–l£
(
»®
 
xpos
,„—È
ypos
,„—È
width
,„—È
height
);

47 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_box
(
»®
 
xpos
,„—È
ypos
,„—È
width
,„—È
height
);

48 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_pŞylše
(
num_pošts
, 
Pošt
 *
pošts
,

49 
A¼ow
 *
’d_¬row
, A¼ow *
¡¬t_¬row
);

50 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_pŞygÚ
(
num_pošts
, 
Pošt
 *
pošts
);

51 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_bez›¾še
(
num_pošts
, 
BezPošt
 *
pošts
,

52 
A¼ow
 *
’d_¬row
, A¼ow *
¡¬t_¬row
);

53 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_bez›rgÚ
(
num_pošts
, 
BezPošt
 *
pošts
);

54 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_¬c
(
»®
 
x1
,„—È
y1
,„—È
x2
,„—È
y2
,

55 
»®
 
curve_di¡ªû
,

56 
A¼ow
 *
’d_¬row
, A¼ow *
¡¬t_¬row
);

57 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_image
(
»®
 
xpos
,„—È
ypos
,„—È
width
,„—È
height
,

58 *
fe
);

59 
DIAVAR
 
DŸObjeù
 * 
ü—‹_¡ªd¬d_group
(
GLi¡
 *
™ems
);

	@O:\tool\dvs50\lib\debug.c

21 
	~<cÚfig.h
>

23 
	~<¡dio.h
>

24 
	~<glib/g´štf.h
>

25 
	~<¡d¬g.h
>

27 
	~"debug.h
"

34 
gboŞ—n


35 
	$dŸ_as£¹_Œue
(
gboŞ—n
 
v®
, 
gch¬
 *
fÜm©
, ...) {

36 
va_li¡
 
¬gs
;

37 ià(!
v®
) {

38 
	`va_¡¬t
(
¬gs
, 
fÜm©
);

39 
	`g_v´štf
(
fÜm©
, 
¬gs
);

40 
	`va_’d
(
¬gs
);

42  
v®
;

43 
	}
}

	@O:\tool\dvs50\lib\debug.h

21 #iâdeà
DEBUG_H


22 
	#DEBUG_H


	)

24 
	~<cÚfig.h
>

26 
	~<¡dio.h
>

27 
	~<gtk/gtk.h
>

28 
	~<¡d¬g.h
>

29 
	~"dŸv¬.h
"

31 
DIAVAR
 
gboŞ—n
 
dŸ_as£¹_Œue
(gboŞ—À
v®
, 
gch¬
 *
fÜm©
, ...);

	@O:\tool\dvs50\lib\dia-enums.h

1 #iâdeà
DIA_ENUMS_H


2 
	#DIA_ENUMS_H


	)

5 
	mLINECAPS_BUTT
,

6 
	mLINECAPS_ROUND
,

7 
	mLINECAPS_PROJECTING


8 } 
	tLšeC­s
;

11 
	mLINEJOIN_MITER
,

12 
	mLINEJOIN_ROUND
,

13 
	mLINEJOIN_BEVEL


14 } 
	tLšeJoš
;

17 
	mLINESTYLE_SOLID
,

18 
	mLINESTYLE_DASHED
,

19 
	mLINESTYLE_DASH_DOT
,

20 
	mLINESTYLE_DASH_DOT_DOT
,

21 
	mLINESTYLE_DOTTED


22 } 
	tLšeStyË
;

25 
	mFILLSTYLE_SOLID


26 } 
	tFlStyË
;

29 
	mALIGN_LEFT
,

30 
	mALIGN_CENTER
,

31 
	mALIGN_RIGHT


32 } 
	tAlignm’t
;

	@O:\tool\dvs50\lib\dia-lib-icons.h

3 #ifdeà
__SUNPRO_C


4 #´agm¨
®ign
 4 (
dŸ_brok’_icÚ
)

6 #ifdeà
__GNUC__


7 cÚ¡ 
gušt8
 
	gdŸ_brok’_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

9 cÚ¡ 
gušt8
 
dŸ_brok’_icÚ
[] =

365 #ifdeà
__SUNPRO_C


366 #´agm¨
®ign
 4 (
dŸ_brok’_chaš_icÚ
)

368 #ifdeà
__GNUC__


369 cÚ¡ 
gušt8
 
	gdŸ_brok’_chaš_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

371 cÚ¡ 
gušt8
 
dŸ_brok’_chaš_icÚ
[] =

415 #ifdeà
__SUNPRO_C


416 #´agm¨
®ign
 4 (
dŸ_unbrok’_chaš_icÚ
)

418 #ifdeà
__GNUC__


419 cÚ¡ 
gušt8
 
	gdŸ_unbrok’_chaš_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

421 cÚ¡ 
gušt8
 
dŸ_unbrok’_chaš_icÚ
[] =

	@O:\tool\dvs50\lib\dia_dirs.c

19 
	~<cÚfig.h
>

21 
	~<¡ršg.h
>

23 
	~"dŸ_dœs.h
"

24 
	~"š.h
"

25 
	~"mes§ge.h
"

26 #ifdeà
G_OS_WIN32


27 
	#WIN32_LEAN_AND_MEAN


	)

28 
	~<wšdows.h
>

30 
	~<sys/¡©.h
>

31 
	~<sys/ty³s.h
>

33 
	~<glib/g¡dio.h
>

41 
gch¬
 *

42 
	$dŸ_g‘_d©a_dœeùÜy
(cÚ¡ 
gch¬
* 
subdœ
)

44 #ifdeà
G_OS_WIN32


48 
gch¬
 
sLoc
 [
MAX_PATH
+1];

49 
HINSTANCE
 
hIn¡
 = 
	`G‘ModuËHªdË
(
NULL
);

51 ià(0 !ğ
	`G‘ModuËFeName
(
hIn¡
, 
sLoc
, 
MAX_PATH
))

54 ià(
	`¡¼chr
(
sLoc
, 
G_DIR_SEPARATOR
))

55 
	`¡¼chr
(
sLoc
, 
G_DIR_SEPARATOR
)[0] = 0;

57 ià(
	`¡¼chr
(
sLoc
, 
G_DIR_SEPARATOR
))

58 
	`¡¼chr
(
sLoc
, 
G_DIR_SEPARATOR
)[1] = 0;

60  
	`g_¡rcÚÿt
 (
sLoc
 , 
subdœ
, 
NULL
);

63 ià(
	`¡¾’
 (
subdœ
) == 0)

64  
	`g_¡rcÚÿt
 (
DATADIR
, 
NULL
);

66  
	`g_¡rcÚÿt
 (
DATADIR
, 
G_DIR_SEPARATOR_S
, 
subdœ
, 
NULL
);

68 
	}
}

76 
gch¬
*

77 
	$dŸ_g‘_lib_dœeùÜy
(cÚ¡ 
gch¬
* 
subdœ
)

79 #ifdeà
G_OS_WIN32


83 
gch¬
 
sLoc
 [
MAX_PATH
+1];

84 
HINSTANCE
 
hIn¡
 = 
	`G‘ModuËHªdË
(
NULL
);

86 ià(0 !ğ
	`G‘ModuËFeName
(
hIn¡
, 
sLoc
, 
MAX_PATH
))

89 ià(
	`¡¼chr
(
sLoc
, 
G_DIR_SEPARATOR
))

90 
	`¡¼chr
(
sLoc
, 
G_DIR_SEPARATOR
)[0] = 0;

92 ià(
	`¡¼chr
(
sLoc
, 
G_DIR_SEPARATOR
))

93 
	`¡¼chr
(
sLoc
, 
G_DIR_SEPARATOR
)[1] = 0;

95  
	`g_¡rcÚÿt
 (
sLoc
 , 
subdœ
, 
NULL
);

98  
	`g_¡rcÚÿt
 (
LIBDIR
, 
G_DIR_SEPARATOR_S
, 
subdœ
, 
NULL
);

100 
	}
}

108 
gch¬
 *

109 
	$dŸ_cÚfig_f’ame
(cÚ¡ 
gch¬
 *
subfe
)

111 cÚ¡ 
gch¬
 *
homedœ
;

113 
homedœ
 = 
	`g_g‘_home_dœ
();

114 ià(!
homedœ
) {

115 
homedœ
 = 
	`g_g‘_tmp_dœ
();

118  
	`g_¡rcÚÿt
(
homedœ
, 
G_DIR_SEPARATOR_S
 ".dia" G_DIR_SEPARATOR_S,

119 
subfe
, 
NULL
);

120 
	}
}

127 
gboŞ—n


128 
	$dŸ_cÚfig_’su»_dœ
(cÚ¡ 
gch¬
 *
f’ame
)

130 
gch¬
 *
dœ
 = 
	`g_·th_g‘_dœÇme
(
f’ame
);

131 
gboŞ—n
 
exi¡s
;

132 ià(
dœ
 =ğ
NULL
è 
FALSE
;

133 ià(
	`¡rcmp
(
dœ
, ".")) {

134 ià(
	`g_fe_‹¡
(
dœ
, 
G_FILE_TEST_IS_DIR
)) {

135 
exi¡s
 = 
TRUE
;

137 ià(
	`dŸ_cÚfig_’su»_dœ
(
dœ
)) {

138 
exi¡s
 = (
	`g_mkdœ
(
dœ
, 0755) == 0);

140 
exi¡s
 = 
FALSE
;

144 
exi¡s
 = 
FALSE
;

146 
	`g_ä“
(
dœ
);

147  
exi¡s
;

148 
	}
}

155 
gch¬
 *

156 
	$dŸ_g‘_ÿnÚiÿl_·th
(cÚ¡ 
gch¬
 *
·th
)

158 
gch¬
 *
»t
 = 
NULL
;

159 
gch¬
 **
li¡
;

160 
i
 = 0, 
n
 = 0;

163 ià(!
	`¡r¡r
(
·th
, ".."è&& !¡r¡rÕ©h, "." 
G_DIR_SEPARATOR_S
))

164  
	`g_¡rdup
(
·th
);

166 
li¡
 = 
	`g_¡r¥l™
 (
·th
, 
G_DIR_SEPARATOR_S
, -1);

167 
li¡
[
i
] !ğ
NULL
) {

168 ià(0 =ğ
	`¡rcmp
 (
li¡
[
i
], ".")) {

170 
	`g_ä“
 (
li¡
[
i
]);

171 
li¡
[
i
] = 
	`g_¡rdup
 ("");

173 ià(0 =ğ
	`¡rcmp
 (
li¡
[
i
], "..")) {

175 
n
 = 
i
;

176 
	`g_ä“
 (
li¡
[
i
]);

177 
li¡
[
i
] = 
	`g_¡rdup
 ("");

178 
n
 >= 0) {

179 ià(0 !ğ
	`¡¾’
(
li¡
[
n
])) {

181 
	`g_ä“
 (
li¡
[
n
]);

182 
li¡
[
n
] = 
	`g_¡rdup
 ("");

185 
n
--;

188 ià(
n
 < 0)

191 
i
++;

193 ià(
n
 >= 0) {

195 
GSŒšg
 *
¡r
 = 
	`g_¡ršg_Ãw
 (
NULL
);

197 
i
 = 0;

198 
li¡
[
i
] !ğ
NULL
) {

199 ià(
	`¡¾’
(
li¡
[
i
]) > 0) {

204 ià(
i
 !ğ0 || 
li¡
[i][1] != ':')

205 
	`g_¡ršg_­³nd
 (
¡r
, 
G_DIR_SEPARATOR_S
);

206 
	`g_¡ršg_­³nd
 (
¡r
, 
li¡
[
i
]);

208 
i
++;

210 
»t
 = 
	`g_¡ršg_ä“
 (
¡r
, 
FALSE
);

213 
	`g_¡rä“v
(
li¡
);

215  
»t
;

216 
	}
}

226 cÚ¡ 
gch¬
 *

227 
	$dŸ_mes§ge_f’ame
(cÚ¡ 
gch¬
 *
f’ame
)

229 
gch¬
 *
tmp
;

230 
GQu¬k
 
msg_qu¬k
;

232 #ià
	`GLIB_CHECK_VERSION
(2,6,0)

233 
tmp
 = 
	`g_f’ame_di¥Ïy_Çme
(
f’ame
);

235 
gsize
 
num_»ad
;

236 
tmp
 = 
	`g_f’ame_to_utf8
(
f’ame
, -1, &
num_»ad
, 
NULL
, NULL);

237 ià(
tmp
 =ğ
NULL
) {

238 
gch¬
 *
–lsis
;

240 
	`g_utf8_v®id©e
(
f’ame
, -1, &
–lsis
);

241 
tmp
 = 
	`g_f’ame_to_utf8
(
f’ame
, 
–lsis
-f’ame, 
NULL
, NULL, NULL);

242 
–lsis
 = 
	`g_¡rdup_´štf
(
	`_
("%s<Ëg® ch¬aù”s>..."), 
tmp
);

243 
	`g_ä“
(
tmp
);

244 
tmp
 = 
–lsis
;

249 
msg_qu¬k
 = 
	`g_qu¬k_äom_¡ršg
 (
tmp
);

250 
	`g_ä“
 (
tmp
);

251 
tmp
 = (
gch¬
 *è
	`g_qu¬k_to_¡ršg
 (
msg_qu¬k
);

252  
tmp
;

253 
	}
}

259 
gch¬
 *

260 
	$dŸ_g‘_absŞu‹_f’ame
 (cÚ¡ 
gch¬
 *
f’ame
)

262 
gch¬
 *
cu¼’t_dœ
;

263 
gch¬
 *
fuÎÇme
;

264 
gch¬
 *
ÿnÚiÿl
;

265 ià(
f’ame
 =ğ
NULL
)  NULL;

266 ià(
	`g_·th_is_absŞu‹
(
f’ame
)è 
	`dŸ_g‘_ÿnÚiÿl_·th
(filename);

267 
cu¼’t_dœ
 = 
	`g_g‘_cu¼’t_dœ
();

268 
fuÎÇme
 = 
	`g_bud_f’ame
(
cu¼’t_dœ
, 
f’ame
, 
NULL
);

269 
	`g_ä“
(
cu¼’t_dœ
);

270 ià(
	`¡rchr
(
fuÎÇme
, '.'è=ğ
NULL
)  fullname;

271 
ÿnÚiÿl
 = 
	`dŸ_g‘_ÿnÚiÿl_·th
(
fuÎÇme
);

272 ià(
ÿnÚiÿl
 =ğ
NULL
) {

273 
	`mes§ge_w¬nšg
(
	`_
("Too many ..'s in filename %s\n"),

274 
	`dŸ_mes§ge_f’ame
(
f’ame
));

275  
	`g_¡rdup
(
f’ame
);

277 
	`g_ä“
(
fuÎÇme
);

278  
ÿnÚiÿl
;

279 
	}
}

	@O:\tool\dvs50\lib\dia_dirs.h

19 #iâdeà
DIA_DIRS_H


20 
	#DIA_DIRS_H


	)

22 
	~<glib.h
>

23 
	~"dŸv¬.h
"

24 #ifdeà
G_OS_WIN32


25 
	#DIA_SHEETDIR
 "sh“ts"

	)

26 
	#DIA_SHAPEDIR
 "sh­es"

	)

27 
	#DIA_INT_SHAPEDIR
 
DIA_SHEETDIR
 
G_DIR_SEPARATOR_S
 "št"

	)

30 
DIAVAR
 
gch¬
 *
dŸ_g‘_d©a_dœeùÜy
 (cÚ¡ gch¬* 
subdœ
);

31 
DIAVAR
 
gch¬
 *
dŸ_g‘_lib_dœeùÜy
 (cÚ¡ gch¬* 
subdœ
);

32 
DIAVAR
 
gch¬
 *
dŸ_cÚfig_f’ame
 (cÚ¡ gch¬* 
fe
);

33 
gboŞ—n
 
dŸ_cÚfig_’su»_dœ
 (cÚ¡ 
gch¬
* 
f’ame
);

34 
DIAVAR
 
gch¬
 *
dŸ_g‘_absŞu‹_f’ame
 (cÚ¡ gch¬ *
f’ame
);

35 
DIAVAR
 
gch¬
 *
dŸ_g‘_ÿnÚiÿl_·th
 (cÚ¡ gch¬ *
·th
);

36 
DIAVAR
 cÚ¡ 
gch¬
 *
dŸ_mes§ge_f’ame
 (cÚ¡ gch¬ *
f’ame
);

	@O:\tool\dvs50\lib\dia_image.c

19 
	~<cÚfig.h
>

20 
	~<¡ršg.h
>

22 
	~"geom‘ry.h
"

23 
	~"dŸ_image.h
"

24 
	~"mes§ge.h
"

25 
	~<gtk/gtkwidg‘.h
>

26 
	~<gdk-pixbuf/gdk-pixbuf.h
>

28 
	~"dŸ-lib-icÚs.h
"

30 
	#SCALING_CACHE


	)

32 
GTy³
 
dŸ_image_g‘_ty³
 ();

33 
	#DIA_TYPE_IMAGE
 (
	`dŸ_image_g‘_ty³
())

	)

34 
	#DIA_IMAGE
(
objeù
è(
	`G_TYPE_CHECK_INSTANCE_CAST
((objeù), 
DIA_TYPE_IMAGE
, 
DŸImage
))

	)

35 
	#DIA_IMAGE_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_IMAGE
, 
DŸImageCÏss
))

	)

37 
_DŸImageCÏss
 
	tDŸImageCÏss
;

38 
	s_DŸImageCÏss
 {

39 
GObjeùCÏss
 
	m·»Á_şass
;

42 
	s_DŸImage
 {

43 
GObjeù
 
	m·»Á_š¡ªû
;

44 
GdkPixbuf
 *
	mimage
;

45 
gch¬
 *
	mf’ame
;

46 #ifdeà
SCALING_CACHE


47 
GdkPixbuf
 *
	msÿËd
;

48 
	msÿËd_width
, 
	msÿËd_height
;

52 
dŸ_image_şass_š™
(
DŸImageCÏss
* 
şass
);

53 
dŸ_image_fš®ize
(
GObjeù
* 
objeù
);

54 
dŸ_image_š™_š¡ªû
(
DŸImage
*);

56 
GTy³


57 
	$dŸ_image_g‘_ty³
 ()

59 
GTy³
 
objeù_ty³
 = 0;

61 ià(!
objeù_ty³
) {

62 cÚ¡ 
GTy³Info
 
objeù_šfo
 =

64  (
DŸImageCÏss
),

65 (
GBa£In™Func
è
NULL
,

66 (
GBa£Fš®izeFunc
è
NULL
,

67 (
GCÏssIn™Func
è
dŸ_image_şass_š™
,

68 
NULL
,

69 
NULL
,

70  (
DŸImage
),

72 (
GIn¡ªûIn™Func
)
dŸ_image_š™_š¡ªû


74 
objeù_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
G_TYPE_OBJECT
,

76 &
objeù_šfo
, 0);

78  
objeù_ty³
;

79 
	}
}

81 
gpoš‹r
 
	g·»Á_şass
;

84 
	$dŸ_image_şass_š™
(
DŸImageCÏss
* 
kÏss
)

86 
GObjeùCÏss
* 
objeù_şass
 = 
	`G_OBJECT_CLASS
(
kÏss
);

87 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
(
kÏss
);

88 
objeù_şass
->
fš®ize
 = 
dŸ_image_fš®ize
;

89 
	}
}

92 
	$dŸ_image_š™_š¡ªû
(
DŸImage
 *
image
)

96 
	}
}

99 
	$dŸ_image_fš®ize
(
GObjeù
* 
objeù
)

101 
DŸImage
 *
image
 = 
	`DIA_IMAGE
(
objeù
);

102 ià(
image
->image)

103 
	`gdk_pixbuf_uÄef
 (
image
->image);

104 
image
->imagğ
NULL
;

105 
	`g_ä“
 (
image
->
f’ame
);

106 
image
->
f’ame
 = 
NULL
;

107 
	}
}

109 
gboŞ—n
 
	g_dŸ_image_š™Ÿlized
 = 
FALSE
;

115 
	$dŸ_image_š™
()

117 ià(!
_dŸ_image_š™Ÿlized
) {

118 
	`gtk_widg‘_£t_deçuÉ_cŞÜm­
(
	`gdk_rgb_g‘_cm­
());

119 
_dŸ_image_š™Ÿlized
 = 
TRUE
;

121 
	}
}

126 
DŸImage
 *

127 
	$dŸ_image_g‘_brok’
()

129 
GdkPixbuf
 *
brok’
 = 
NULL
;

130 
DŸImage
 *
image
;

132 
image
 = 
	`DIA_IMAGE
(
	`g_objeù_Ãw
(
DIA_TYPE_IMAGE
, 
NULL
));

133 ià(
brok’
 =ğ
NULL
) {

135 
brok’
 = 
	`gdk_pixbuf_Ãw_äom_šlše
(-1, 
dŸ_brok’_icÚ
, 
FALSE
, 
NULL
);

137 
image
->imagğ
	`g_objeù_»f
 (
brok’
);

139 
image
->
f’ame
 = 
	`g_¡rdup
("<broken>");

140 #ifdeà
SCALING_CACHE


141 
image
->
sÿËd
 = 
NULL
;

143  
image
;

144 
	}
}

151 
DŸImage
 *

152 
	$dŸ_image_lßd
(cÚ¡ 
gch¬
 *
f’ame
)

154 
DŸImage
 *
dŸ_img
;

155 
GdkPixbuf
 *
image
;

156 
GE¼Ü
 *
”rÜ
 = 
NULL
;

158 
image
 = 
	`gdk_pixbuf_Ãw_äom_fe
(
f’ame
, &
”rÜ
);

159 ià(
image
 =ğ
NULL
) {

164 ià(
	`g_fe_‹¡
(
f’ame
, 
G_FILE_TEST_EXISTS
))

165 
	`mes§ge_w¬nšg
 ("%s", 
”rÜ
->
mes§ge
);

166 
	`g_”rÜ_ä“
 (
”rÜ
);

167  
NULL
;

170 
dŸ_img
 = 
	`DIA_IMAGE
(
	`g_objeù_Ãw
(
DIA_TYPE_IMAGE
, 
NULL
));

171 
dŸ_img
->
image
 = image;

173 
dŸ_img
->
f’ame
 = 
	`g_¡rdup
(filename);

174 #ifdeà
SCALING_CACHE


175 
dŸ_img
->
sÿËd
 = 
NULL
;

177  
dŸ_img
;

178 
	}
}

184 
	$dŸ_image_add_»f
(
DŸImage
 *
image
)

186 
	`g_objeù_»f
(
image
);

187 
	}
}

193 
	$dŸ_image_uÄef
(
DŸImage
 *
image
)

195 
	`g_objeù_uÄef
(
image
);

196 
	}
}

207 
	$dŸ_image_d¿w
(
DŸImage
 *
image
, 
GdkWšdow
 *
wšdow
, 
GdkGC
 *
gc
,

208 
x
, 
y
, 
width
, 
height
)

210 
GdkPixbuf
 *
sÿËd
;

212 ià(
width
 < 1 || 
height
 < 1)

214 ià(
	`gdk_pixbuf_g‘_width
(
image
->imageè!ğ
width
 ||

215 
	`gdk_pixbuf_g‘_height
(
image
->imageè!ğ
height
) {

217 #ifdeà
SCALING_CACHE


218 ià(
image
->
sÿËd
 =ğ
NULL
 ||

219 
image
->
sÿËd_width
 !ğ
width
 || image->
sÿËd_height
 !ğ
height
) {

220 ià(
image
->
sÿËd
)

221 
	`gdk_pixbuf_uÄef
(
image
->
sÿËd
);

222 
image
->
sÿËd
 = 
	`gdk_pixbuf_sÿË_sim¶e
(image->image, 
width
, 
height
,

223 
GDK_INTERP_TILES
);

224 
image
->
sÿËd_width
 = 
width
;

225 
image
->
sÿËd_height
 = 
height
;

227 
sÿËd
 = 
image
->scaled;

229 
sÿËd
 = 
	`gdk_pixbuf_sÿË_sim¶e
(
image
->image, 
width
, 
height
,

230 
GDK_INTERP_TILES
);

233 
sÿËd
 = 
image
->image;

237 
	`gdk_d¿w_pixbuf
(
wšdow
, 
gc
, 
sÿËd
,

238 0, 0, 
x
, 
y
, 
width
, 
height
,

239 
GDK_RGB_DITHER_NORMAL
, 0, 0);

241 #iâdeà
SCALING_CACHE


242 
	`gdk_pixbuf_uÄef
(
sÿËd
);

244 
	}
}

251 
	$dŸ_image_width
(cÚ¡ 
DŸImage
 *
image
)

253  
	`gdk_pixbuf_g‘_width
(
image
->image);

254 
	}
}

261 
	$dŸ_image_height
(cÚ¡ 
DŸImage
 *
image
)

263  
	`gdk_pixbuf_g‘_height
(
image
->image);

264 
	}
}

271 
	$dŸ_image_row¡ride
(cÚ¡ 
DŸImage
 *
image
)

273  
	`gdk_pixbuf_g‘_row¡ride
(
image
->image);

274 
	}
}

279 cÚ¡ 
GdkPixbuf
*

280 
	$dŸ_image_pixbuf
 (cÚ¡ 
DŸImage
 *
image
)

282  
image
->image;

283 
	}
}

290 
gušt8
 *

291 
	$dŸ_image_rgb_d©a
(cÚ¡ 
DŸImage
 *
image
)

293 
width
 = 
	`dŸ_image_width
(
image
);

294 
height
 = 
	`dŸ_image_height
(
image
);

295 
row¡ride
 = 
	`dŸ_image_row¡ride
(
image
);

296 
size
 = 
height
*
row¡ride
;

297 
gušt8
 *
rgb_pix–s
 = 
	`g_m®loc
(
size
);

299 ià(
	`gdk_pixbuf_g‘_has_®pha
(
image
->image)) {

300 
gušt8
 *
pix–s
 = 
	`gdk_pixbuf_g‘_pix–s
(
image
->image);

301 
i
, 
j
;

302 
i
 = 0; i < 
height
; i++) {

303 
j
 = 0; j < 
width
; j++) {

304 
rgb_pix–s
[
i
*
row¡ride
+
j
*3] = 
pix–s
[i*rowstride+j*4];

305 
rgb_pix–s
[
i
*
row¡ride
+
j
*3+1] = 
pix–s
[i*rowstride+j*4+1];

306 
rgb_pix–s
[
i
*
row¡ride
+
j
*3+2] = 
pix–s
[i*rowstride+j*4+2];

309  
rgb_pix–s
;

311 
gušt8
 *
pix–s
 = 
	`gdk_pixbuf_g‘_pix–s
(
image
->image);

313 
	`g_memmove
(
rgb_pix–s
, 
pix–s
, 
height
*
row¡ride
);

314  
rgb_pix–s
;

316 
	}
}

323 
gušt8
 *

324 
	$dŸ_image_mask_d©a
(cÚ¡ 
DŸImage
 *
image
)

326 
gušt8
 *
pix–s
;

327 
gušt8
 *
mask
;

328 
i
, 
size
;

330 ià(!
	`gdk_pixbuf_g‘_has_®pha
(
image
->image)) {

331  
NULL
;

334 
pix–s
 = 
	`gdk_pixbuf_g‘_pix–s
(
image
->image);

336 
size
 = 
	`gdk_pixbuf_g‘_width
(
image
->image)*

337 
	`gdk_pixbuf_g‘_height
(
image
->image);

339 
mask
 = 
	`g_m®loc
(
size
);

342 
i
 = 0; i < 
size
; i++)

343 
mask
[
i
] = 
pix–s
[i*4+3];

345  
mask
;

346 
	}
}

353 cÚ¡ 
gušt8
 *

354 
	$dŸ_image_rgba_d©a
(cÚ¡ 
DŸImage
 *
image
)

356 ià(
	`gdk_pixbuf_g‘_has_®pha
(
image
->image)) {

357 cÚ¡ 
gušt8
 *
pix–s
 = 
	`gdk_pixbuf_g‘_pix–s
(
image
->image);

359  
pix–s
;

361  
NULL
;

363 
	}
}

371 
	$dŸ_image_f’ame
(cÚ¡ 
DŸImage
 *
image
)

373 ià(!
image
->
f’ame
)

375  
image
->
f’ame
;

376 
	}
}

	@O:\tool\dvs50\lib\dia_image.h

18 #iâdeà
DIA_IMAGE_H


19 
	#DIA_IMAGE_H


	)

21 
	~"dŸty³s.h
"

22 
	~<gdk/gdkty³s.h
>

23 
	~<gdk-pixbuf/gdk-pixbuf.h
>

25 
	~"geom‘ry.h
"

27 
G_BEGIN_DECLS


29 
dŸ_image_š™
();

31 
DIAVAR
 
DŸImage
 *
dŸ_image_g‘_brok’
();

33 
DIAVAR
 
DŸImage
 *
dŸ_image_lßd
(cÚ¡ 
gch¬
 *
f’ame
);

34 
DIAVAR
 
dŸ_image_add_»f
(
DŸImage
 *
image
);

35 
DIAVAR
 
dŸ_image_uÄef
(
DŸImage
 *
image
);

36 
DIAVAR
 
dŸ_image_d¿w
(
DŸImage
 *
image
, 
GdkWšdow
 *
wšdow
, 
GdkGC
 *
gc
,

37 
x
, 
y
, 
width
, 
height
);

39 
DIAVAR
 
dŸ_image_width
(cÚ¡ 
DŸImage
 *
image
);

40 
DIAVAR
 
dŸ_image_row¡ride
(cÚ¡ 
DŸImage
 *
image
);

41 
DIAVAR
 
dŸ_image_height
(cÚ¡ 
DŸImage
 *
image
);

46 
DIAVAR
 
gušt8
 *
dŸ_image_rgb_d©a
(cÚ¡ 
DŸImage
 *
image
);

51 
DIAVAR
 
gušt8
 *
dŸ_image_mask_d©a
(cÚ¡ 
DŸImage
 *
image
);

55 
DIAVAR
 cÚ¡ 
gušt8
 *
dŸ_image_rgba_d©a
(cÚ¡ 
DŸImage
 *
image
);

56 
DIAVAR
 cÚ¡ *
dŸ_image_f’ame
(cÚ¡ 
DŸImage
 *
image
);

57 cÚ¡ 
GdkPixbuf
* 
dŸ_image_pixbuf
 (cÚ¡ 
DŸImage
 *
image
);

59 
	gG_END_DECLS


	@O:\tool\dvs50\lib\dia_svg.c

24 
	~"cÚfig.h
"

26 
	~<¡ršg.h
>

27 
	~<¡dlib.h
>

29 
	~<·ngo/·ngo-©Œibu‹s.h
>

31 
	~"dŸ_svg.h
"

39 
	$dŸ_svg_¡yË_š™
(
DŸSvgStyË
 *
gs
, DŸSvgStyË *
·»Á_¡yË
)

41 
	`g_»tuº_if_ç
 (
gs
);

42 
gs
->
¡roke
 = 
·»Á_¡yË
 ?…¬’t_¡yË->¡rok: 
DIA_SVG_COLOUR_NONE
;

43 
gs
->
lše_width
 = 
·»Á_¡yË
 ?…arent_style->line_width : 0.0;

44 
gs
->
lše¡yË
 = 
·»Á_¡yË
 ?…¬’t_¡yË->lše¡yË : 
LINESTYLE_SOLID
;

45 
gs
->
dashËngth
 = 
·»Á_¡yË
 ?…arent_style->dashlength : 1;

46 
gs
->
fl
 = 
·»Á_¡yË
 ?…¬’t_¡yË->fÈ: 
DIA_SVG_COLOUR_NONE
;

47 
gs
->
lšeÿp
 = 
·»Á_¡yË
 ?…¬’t_¡yË->lšeÿ°: 
DIA_SVG_LINECAPS_DEFAULT
;

48 
gs
->
lšejoš
 = 
·»Á_¡yË
 ?…¬’t_¡yË->lšejoš : 
DIA_SVG_LINEJOIN_DEFAULT
;

49 
gs
->
lše¡yË
 = 
·»Á_¡yË
 ?…¬’t_¡yË->lše¡yË : 
DIA_SVG_LINESTYLE_DEFAULT
;

50 
gs
->
fÚt
 = (
·»Á_¡yË
 &&…¬’t_¡yË->fÚtè? 
	`dŸ_fÚt_»f
Õ¬’t_¡yË->fÚtè: 
NULL
;

51 
gs
->
fÚt_height
 = 
·»Á_¡yË
 ?…arent_style->font_height : 0.8;

52 
gs
->
®ignm’t
 = 
·»Á_¡yË
 ?…¬’t_¡yË->®ignm’ˆ: 
ALIGN_LEFT
;

53 
	}
}

60 
	$dŸ_svg_¡yË_cİy
(
DŸSvgStyË
 *
de¡
, DŸSvgStyË *
¤c
)

62 
	`g_»tuº_if_ç
 (
de¡
 && 
¤c
);

64 
de¡
->
¡roke
 = 
¤c
->stroke;

65 
de¡
->
lše_width
 = 
¤c
->line_width;

66 
de¡
->
lše¡yË
 = 
¤c
->linestyle;

67 
de¡
->
dashËngth
 = 
¤c
->dashlength;

68 
de¡
->
fl
 = 
¤c
->fill;

69 ià(
de¡
->
fÚt
)

70 
	`dŸ_fÚt_uÄef
 (
de¡
->
fÚt
);

71 
de¡
->
fÚt
 = 
¤c
->fÚˆ? 
	`dŸ_fÚt_»f
(¤c->fÚtè: 
NULL
;

72 
de¡
->
fÚt_height
 = 
¤c
->font_height;

73 
de¡
->
®ignm’t
 = 
¤c
->alignment;

74 
	}
}

86 
gboŞ—n


87 
	$_·r£_cŞÜ
(
gšt32
 *
cŞÜ
, cÚ¡ *
¡r
)

89 ià(
¡r
[0] == '#')

90 *
cŞÜ
 = 
	`¡¹Ş
(
¡r
+1, 
NULL
, 16) & 0xffffff;

91 ià(0 =ğ
	`¡ºcmp
(
¡r
, "none", 4))

92 *
cŞÜ
 = 
DIA_SVG_COLOUR_NONE
;

93 ià(0 =ğ
	`¡ºcmp
(
¡r
, "foreground", 10) || 0 == strncmp(str, "fg", 2) ||

94 0 =ğ
	`¡ºcmp
(
¡r
, "inverse", 7))

95 *
cŞÜ
 = 
DIA_SVG_COLOUR_FOREGROUND
;

96 ià(0 =ğ
	`¡ºcmp
(
¡r
, "background", 10) || 0 == strncmp(str, "bg", 2) ||

97 0 =ğ
	`¡ºcmp
(
¡r
, "default", 7))

98 *
cŞÜ
 = 
DIA_SVG_COLOUR_BACKGROUND
;

99 ià(0 =ğ
	`¡rcmp
(
¡r
, "text"))

100 *
cŞÜ
 = 
DIA_SVG_COLOUR_TEXT
;

101 ià(0 =ğ
	`¡ºcmp
(
¡r
, "rgb(", 4)) {

102 
r
 = 0, 
g
 = 0, 
b
 = 0;

103 ià(3 =ğ
	`ssÿnf
 (
¡r
+4, "%d,%d,%d", &
r
, &
g
, &
b
))

104 *
cŞÜ
 = ((
r
<<16è& 0xFF0000è| ((
g
<<8è& 0xFF00è| (
b
 & 0xFF);

106  
FALSE
;

109 
PªgoCŞÜ
 
pc
;

110 * 
£
 = 
	`¡rchr
 (
¡r
, ';');

112 ià(!
£
) {

113 ià(
	`·ngo_cŞÜ_·r£
 (&
pc
, 
¡r
))

114 *
cŞÜ
 = ((
pc
.
»d
 >> 8è<< 16è| (Õc.
g»’
 >> 8è<< 8è| (pc.
blue
 >> 8);

116  
FALSE
;

118 
gch¬
* 
sz
 = 
	`g_¡ºdup
 (
¡r
, 
£
 - str);

119 
gboŞ—n
 
»t
 = 
	`·ngo_cŞÜ_·r£
 (&
pc
, 
¡r
);

121 ià(
»t
)

122 *
cŞÜ
 = ((
pc
.
»d
 >> 8è<< 16è| (Õc.
g»’
 >> 8è<< 8è| (pc.
blue
 >> 8);

123 
	`g_ä“
 (
sz
);

124  
»t
;

127  
TRUE
;

128 
	}
}

132 
	mFONT_NAME_LENGTH_MAX
 = 40

144 
	$dŸ_svg_·r£_¡yË
(
xmlNodePŒ
 
node
, 
DŸSvgStyË
 *
s
, 
»®
 
u£r_sÿË
)

146 
xmlCh¬
 *
¡r
;

147 
gch¬
 
‹mp
[
FONT_NAME_LENGTH_MAX
+1];

148 
i
 = 0;

149 
gboŞ—n
 
ov”
 = 
FALSE
;

150 *
çmy
 = 
NULL
, *
¡yË
 = NULL, *
weight
 = NULL;

152 
¡r
 = 
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"style");

154 ià(
¡r
) {

155 
gch¬
 *
±r
 = (gch¬ *)
¡r
;

156 
±r
[0] != '\0') {

158 
±r
[0] !ğ'\0' && 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

159 ià(
±r
[0] == '\0') ;

161 ià(!
	`¡ºcmp
("fÚt-çmy:", 
±r
, 12)) {

162 
±r
 += 12;

163 (
±r
[0] !ğ'\0'è&& 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

164 
i
 = 0; 
ov”
 = 
FALSE
;

165 
±r
[0] !ğ'\0' &&…Œ[0] !ğ';' && !
ov”
) {

166 ià(
i
 < 
FONT_NAME_LENGTH_MAX
) {

167 
‹mp
[
i
] = 
±r
[0];

168 } 
ov”
 = 
TRUE
;

169 
i
++;

170 
±r
++;

172 
‹mp
[
i
] = '\0';

174 ià(!
ov”
) {

175 ià(
	`¡rcmp
 (
‹mp
, "sanserif") == 0 || strcmp (temp, "sans-serif") == 0)

176 
çmy
 = 
	`g_¡rdup
 ("sans");

178 
çmy
 = 
	`g_¡rdup
(
‹mp
);

180 } ià(!
	`¡ºcmp
("fÚt-weight:", 
±r
, 12)) {

181 
±r
 += 12;

182 (
±r
[0] !ğ'\0'è&& 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

183 
i
 = 0; 
ov”
 = 
FALSE
;

184 
±r
[0] !ğ'\0' &&…Œ[0] !ğ';' && !
ov”
) {

185 ià(
i
 < 
FONT_NAME_LENGTH_MAX
) {

186 
‹mp
[
i
] = 
±r
[0];

187 } 
ov”
 = 
TRUE
;

188 
i
++;

189 
±r
++;

191 
‹mp
[
i
] = '\0';

193 ià(!
ov”
è
weight
 = 
	`g_¡rdup
(
‹mp
);

194 } ià(!
	`¡ºcmp
("fÚt-¡yË:", 
±r
, 11)) {

195 
±r
 += 11;

196 (
±r
[0] !ğ'\0'è&& 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

197 
i
 = 0; 
ov”
 = 
FALSE
;

198 
±r
[0] !ğ'\0' &&…Œ[0] !ğ';' && !
ov”
) {

199 ià(
i
 < 
FONT_NAME_LENGTH_MAX
) {

200 
‹mp
[
i
] = 
±r
[0];

201 } 
ov”
 = 
TRUE
;

202 
i
++;

203 
±r
++;

205 
‹mp
[
i
] = '\0';

207 ià(!
ov”
è
¡yË
 = 
	`g_¡rdup
(
‹mp
);

208 } ià(!
	`¡ºcmp
("fÚt-size:", 
±r
, 10)) {

209 
±r
 += 10;

210 (
±r
[0] !ğ'\0'è&& 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

211 
i
 = 0; 
ov”
 = 
FALSE
;

212 
±r
[0] !ğ'\0' &&…Œ[0] !ğ';' && !
ov”
) {

213 ià(
i
 < 
FONT_NAME_LENGTH_MAX
) {

214 
‹mp
[
i
] = 
±r
[0];

215 } 
ov”
 = 
TRUE
;

216 
i
++;

217 
±r
++;

219 
‹mp
[
i
] = '\0';

221 ià(!
ov”
) {

222 
s
->
fÚt_height
 = 
	`g_ascii_¡¹od
(
‹mp
, 
NULL
);

223 ià(
u£r_sÿË
 > 0)

224 
s
->
fÚt_height
 /ğ
u£r_sÿË
;

226 } ià(!
	`¡ºcmp
("‹xt-ªchÜ:", 
±r
, 12)) {

227 
±r
 += 12;

228 (
±r
[0] !ğ'\0'è&& 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

229 ià(!
	`¡ºcmp
(
±r
, "start", 5))

230 
s
->
®ignm’t
 = 
ALIGN_LEFT
;

231 ià(!
	`¡ºcmp
(
±r
, "end", 3))

232 
s
->
®ignm’t
 = 
ALIGN_RIGHT
;

233 ià(!
	`¡ºcmp
(
±r
, "middle", 6))

234 
s
->
®ignm’t
 = 
ALIGN_CENTER
;

236 } ià(!
	`¡ºcmp
("¡roke-width:", 
±r
, 13)) {

237 
±r
 += 13;

238 
s
->
lše_width
 = 
	`g_ascii_¡¹od
(
±r
, &ptr);

239 ià(
u£r_sÿË
 > 0)

240 
s
->
lše_width
 /ğ
u£r_sÿË
;

241 } ià(!
	`¡ºcmp
("¡roke:", 
±r
, 7)) {

242 
±r
 += 7;

243 (
±r
[0] !ğ'\0'è&& 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

244 ià(
±r
[0] == '\0') ;

246 
	`_·r£_cŞÜ
 (&
s
->
¡roke
, 
±r
);

247 } ià(!
	`¡ºcmp
("fl:", 
±r
, 5)) {

248 
±r
 += 5;

249 
±r
[0] !ğ'\0' && 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

250 ià(
±r
[0] == '\0') ;

252 
	`_·r£_cŞÜ
 (&
s
->
fl
, 
±r
);

253 } ià(!
	`¡ºcmp
("¡roke-lšeÿp:", 
±r
, 15)) {

254 
±r
 += 15;

255 
±r
[0] !ğ'\0' && 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

256 ià(
±r
[0] == '\0') ;

258 ià(!
	`¡ºcmp
(
±r
, "butt", 4))

259 
s
->
lšeÿp
 = 
LINECAPS_BUTT
;

260 ià(!
	`¡ºcmp
(
±r
, "round", 5))

261 
s
->
lšeÿp
 = 
LINECAPS_ROUND
;

262 ià(!
	`¡ºcmp
(
±r
, "square", 6) || !strncmp(ptr, "projecting", 10))

263 
s
->
lšeÿp
 = 
LINECAPS_PROJECTING
;

264 ià(!
	`¡ºcmp
(
±r
, "default", 7))

265 
s
->
lšeÿp
 = 
DIA_SVG_LINECAPS_DEFAULT
;

266 } ià(!
	`¡ºcmp
("¡roke-lšejoš:", 
±r
, 16)) {

267 
±r
 += 16;

268 
±r
[0] !ğ'\0' && 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

269 ià(
±r
[0] == '\0') ;

271 ià(!
	`¡ºcmp
(
±r
, "miter", 5))

272 
s
->
lšejoš
 = 
LINEJOIN_MITER
;

273 ià(!
	`¡ºcmp
(
±r
, "round", 5))

274 
s
->
lšejoš
 = 
LINEJOIN_ROUND
;

275 ià(!
	`¡ºcmp
(
±r
, "bevel", 5))

276 
s
->
lšejoš
 = 
LINEJOIN_BEVEL
;

277 ià(!
	`¡ºcmp
(
±r
, "default", 7))

278 
s
->
lšejoš
 = 
DIA_SVG_LINEJOIN_DEFAULT
;

279 } ià(!
	`¡ºcmp
("¡roke-·‰”n:", 
±r
, 15)) {

280 
±r
 += 15;

281 
±r
[0] !ğ'\0' && 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

282 ià(
±r
[0] == '\0') ;

284 ià(!
	`¡ºcmp
(
±r
, "solid", 5))

285 
s
->
lše¡yË
 = 
LINESTYLE_SOLID
;

286 ià(!
	`¡ºcmp
(
±r
, "dashed", 6))

287 
s
->
lše¡yË
 = 
LINESTYLE_DASHED
;

288 ià(!
	`¡ºcmp
(
±r
, "dash-dot", 8))

289 
s
->
lše¡yË
 = 
LINESTYLE_DASH_DOT
;

290 ià(!
	`¡ºcmp
(
±r
, "dash-dot-dot", 12))

291 
s
->
lše¡yË
 = 
LINESTYLE_DASH_DOT_DOT
;

292 ià(!
	`¡ºcmp
(
±r
, "dotted", 6))

293 
s
->
lše¡yË
 = 
LINESTYLE_DOTTED
;

294 ià(!
	`¡ºcmp
(
±r
, "default", 7))

295 
s
->
lše¡yË
 = 
DIA_SVG_LINESTYLE_DEFAULT
;

297 } ià(!
	`¡ºcmp
("¡roke-dashËngth:", 
±r
, 18)) {

298 
±r
 += 18;

299 
±r
[0] !ğ'\0' && 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

300 ià(
±r
[0] == '\0') ;

302 ià(!
	`¡ºcmp
(
±r
, "default", 7))

303 
s
->
dashËngth
 = 1.0;

305 
s
->
dashËngth
 = 
	`g_ascii_¡¹od
(
±r
, &ptr);

306 ià(
u£r_sÿË
 > 0)

307 
s
->
dashËngth
 /ğ
u£r_sÿË
;

309 } ià(!
	`¡ºcmp
("¡roke-dash¬¿y:", 
±r
, 17)) {

314 
s
->
lše¡yË
 = 
LINESTYLE_DASHED
;

315 
±r
 += 17;

316 
±r
[0] !ğ'\0' && 
	`g_ascii_is¥aû
(ptr[0]))…tr++;

317 ià(
±r
[0] == '\0') ;

319 ià(!
	`¡ºcmp
(
±r
, "default", 7))

320 
s
->
dashËngth
 = 1.0;

322 
s
->
dashËngth
 = 
	`g_ascii_¡¹od
(
±r
, &ptr);

323 ià(
u£r_sÿË
 > 0)

324 
s
->
dashËngth
 /ğ
u£r_sÿË
;

329 
±r
[0] != '\0' &&…tr[0] != ';' &&…tr[0] != '\n')…tr++;

330 ià(
±r
[0] != '\0')…tr++;

332 
	`xmlF»e
(
¡r
);

338 
¡r
 = 
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"fill");

339 ià(
¡r
) {

340 
	`_·r£_cŞÜ
 (&
s
->
fl
, (*è
¡r
);

341 
	`xmlF»e
(
¡r
);

343 
¡r
 = 
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"stroke");

344 ià(
¡r
) {

345 
	`_·r£_cŞÜ
 (&
s
->
¡roke
, (*è
¡r
);

346 
	`xmlF»e
(
¡r
);

348 
¡r
 = 
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"stroke-width");

349 ià(
¡r
) {

350 
s
->
lše_width
 = 
	`g_ascii_¡¹od
((*è
¡r
, 
NULL
);

351 
	`xmlF»e
(
¡r
);

352 ià(
u£r_sÿË
 > 0)

353 
s
->
lše_width
 /ğ
u£r_sÿË
;

356 ià(
çmy
 || 
¡yË
 || 
weight
) {

357 ià(
s
->
fÚt
)

358 
	`dŸ_fÚt_uÄef
 (
s
->
fÚt
);

359 
s
->
fÚt
 = 
	`dŸ_fÚt_Ãw_äom_¡yË
(
DIA_FONT_SANS
,s->
fÚt_height
 );

360 ià(
çmy
) {

361 
	`dŸ_fÚt_£t_ªy_çmy
(
s
->
fÚt
,
çmy
);

362 
	`g_ä“
(
çmy
);

364 ià(
¡yË
) {

365 
	`dŸ_fÚt_£t_¦ªt_äom_¡ršg
(
s
->
fÚt
,
¡yË
);

366 
	`g_ä“
(
¡yË
);

368 ià(
weight
) {

369 
	`dŸ_fÚt_£t_weight_äom_¡ršg
(
s
->
fÚt
,
weight
);

370 
	`g_ä“
(
weight
);

373 
	}
}

391 
	$_·th_¬c_£gm’t
(
GA¼ay
* 
pošts
,

392 
»®
 
xc
,„—È
yc
,

393 
»®
 
th0
,„—È
th1
,

394 
»®
 
rx
,„—È
ry
,

395 
»®
 
x_axis_rÙ©iÚ
,

396 
Pošt
 *
Ï¡_p2
)

398 
BezPošt
 
bez
;

399 
»®
 
sš_th
, 
cos_th
;

400 
»®
 
a00
, 
a01
, 
a10
, 
a11
;

401 
»®
 
x1
, 
y1
, 
x2
, 
y2
, 
x3
, 
y3
;

402 
»®
 
t
;

403 
»®
 
th_h®f
;

405 
sš_th
 = 
	`sš
 (
x_axis_rÙ©iÚ
 * (
M_PI
 / 180.0));

406 
cos_th
 = 
	`cos
 (
x_axis_rÙ©iÚ
 * (
M_PI
 / 180.0));

408 
a00
 = 
cos_th
 * 
rx
;

409 
a01
 = -
sš_th
 * 
ry
;

410 
a10
 = 
sš_th
 * 
rx
;

411 
a11
 = 
cos_th
 * 
ry
;

413 
th_h®f
 = 0.5 * (
th1
 - 
th0
);

414 
t
 = (8.0 / 3.0è* 
	`sš
(
th_h®f
 * 0.5) * sin(th_half * 0.5) / sin(th_half);

415 
x1
 = 
xc
 + 
	`cos
 (
th0
è- 
t
 * 
	`sš
 (th0);

416 
y1
 = 
yc
 + 
	`sš
 (
th0
è+ 
t
 * 
	`cos
 (th0);

417 
x3
 = 
xc
 + 
	`cos
 (
th1
);

418 
y3
 = 
yc
 + 
	`sš
 (
th1
);

419 
x2
 = 
x3
 + 
t
 * 
	`sš
 (
th1
);

420 
y2
 = 
y3
 - 
t
 * 
	`cos
 (
th1
);

422 
bez
.
ty³
 = 
BEZ_CURVE_TO
;

423 
bez
.
p1
.
x
 = 
a00
 * 
x1
 + 
a01
 * 
y1
;

424 
bez
.
p1
.
y
 = 
a10
 * 
x1
 + 
a11
 * 
y1
;

425 
bez
.
p2
.
x
 = 
a00
 * 
x2
 + 
a01
 * 
y2
;

426 
bez
.
p2
.
y
 = 
a10
 * 
x2
 + 
a11
 * 
y2
;

427 
bez
.
p3
.
x
 = 
a00
 * 
x3
 + 
a01
 * 
y3
;

428 
bez
.
p3
.
y
 = 
a10
 * 
x3
 + 
a11
 * 
y3
;

430 *
Ï¡_p2
 = 
bez
.
p2
;

432 
	`g_¬¿y_­³nd_v®
(
pošts
, 
bez
);

433 
	}
}

450 
	$_·th_¬c
(
GA¼ay
 *
pošts
, 
ıx
, 
ıy
,

451 
rx
, 
ry
, 
x_axis_rÙ©iÚ
,

452 
Ïrge_¬c_æag
, 
sw“p_æag
,

453 
x
, 
y
,

454 
Pošt
 *
Ï¡_p2
)

456 
sš_th
, 
cos_th
;

457 
a00
, 
a01
, 
a10
, 
a11
;

458 
x0
, 
y0
, 
x1
, 
y1
, 
xc
, 
yc
;

459 
d
, 
sçùÜ
, 
sçùÜ_sq
;

460 
th0
, 
th1
, 
th_¬c
;

461 
px
, 
py
, 
¶
;

462 
i
, 
n_£gs
;

464 
sš_th
 = 
	`sš
 (
x_axis_rÙ©iÚ
 * (
M_PI
 / 180.0));

465 
cos_th
 = 
	`cos
 (
x_axis_rÙ©iÚ
 * (
M_PI
 / 180.0));

474 if(
rx
 < 0.0)„x = -rx;

475 if(
ry
 < 0.0)„y = -ry;

477 
px
 = 
cos_th
 * (
ıx
 - 
x
è* 0.5 + 
sš_th
 * (
ıy
 - 
y
) * 0.5;

478 
py
 = 
cos_th
 * (
ıy
 - 
y
è* 0.5 - 
sš_th
 * (
ıx
 - 
x
) * 0.5;

479 
¶
 = (
px
 *…xè/ (
rx
 *„xè+ (
py
 *…yè/ (
ry
 *„y);

481 if(
¶
 > 1.0)

483 
¶
 = 
	`sq¹
(pl);

484 
rx
 *ğ
¶
;

485 
ry
 *ğ
¶
;

490 
a00
 = 
cos_th
 / 
rx
;

491 
a01
 = 
sš_th
 / 
rx
;

492 
a10
 = -
sš_th
 / 
ry
;

493 
a11
 = 
cos_th
 / 
ry
;

494 
x0
 = 
a00
 * 
ıx
 + 
a01
 * 
ıy
;

495 
y0
 = 
a10
 * 
ıx
 + 
a11
 * 
ıy
;

496 
x1
 = 
a00
 * 
x
 + 
a01
 * 
y
;

497 
y1
 = 
a10
 * 
x
 + 
a11
 * 
y
;

503 
d
 = (
x1
 - 
x0
è* (x1 - x0è+ (
y1
 - 
y0
) * (y1 - y0);

504 
sçùÜ_sq
 = 1.0 / 
d
 - 0.25;

505 ià(
sçùÜ_sq
 < 0) sfactor_sq = 0;

506 
sçùÜ
 = 
	`sq¹
 (
sçùÜ_sq
);

507 ià(
sw“p_æag
 =ğ
Ïrge_¬c_æag
è
sçùÜ
 = -sfactor;

508 
xc
 = 0.5 * (
x0
 + 
x1
è- 
sçùÜ
 * (
y1
 - 
y0
);

509 
yc
 = 0.5 * (
y0
 + 
y1
è+ 
sçùÜ
 * (
x1
 - 
x0
);

512 
th0
 = 
	`©ª2
 (
y0
 - 
yc
, 
x0
 - 
xc
);

513 
th1
 = 
	`©ª2
 (
y1
 - 
yc
, 
x1
 - 
xc
);

515 
th_¬c
 = 
th1
 - 
th0
;

516 ià(
th_¬c
 < 0 && 
sw“p_æag
)

517 
th_¬c
 +ğ2 * 
M_PI
;

518 ià(
th_¬c
 > 0 && !
sw“p_æag
)

519 
th_¬c
 -ğ2 * 
M_PI
;

521 
n_£gs
 = (è
	`û
 (
	`çbs
 (
th_¬c
 / (
M_PI
 * 0.5 + 0.001)));

523 
i
 = 0; i < 
n_£gs
; i++) {

524 
	`_·th_¬c_£gm’t
(
pošts
, 
xc
, 
yc
,

525 
th0
 + 
i
 * 
th_¬c
 / 
n_£gs
,

526 
th0
 + (
i
 + 1è* 
th_¬c
 / 
n_£gs
,

527 
rx
, 
ry
, 
x_axis_rÙ©iÚ
,

528 
Ï¡_p2
);

530 
	}
}

533 
	#·th_chomp
(
·th
è·th[0]!='\0'&&
	`¡rchr
(" \t\n\r,",…©h[0])è·th++

	)

555 
GA¼ay
*

556 
	$dŸ_svg_·r£_·th
(cÚ¡ 
gch¬
 *
·th_¡r
, gch¬ **
uÅ¬£d
, 
gboŞ—n
 *
şo£d
)

559 
PATH_MOVE
, 
PATH_LINE
, 
PATH_HLINE
, 
PATH_VLINE
, 
PATH_CURVE
,

560 
PATH_SMOOTHCURVE
, 
PATH_ARC
, 
PATH_CLOSE
 } 
Ï¡_ty³
 = 
PATH_MOVE
;

561 
Pošt
 
Ï¡_İ’
 = {0.0, 0.0};

562 
Pošt
 
Ï¡_pošt
 = {0.0, 0.0};

563 
Pošt
 
Ï¡_cÚŒŞ
 = {0.0, 0.0};

564 
gboŞ—n
 
Ï¡_»Ïtive
 = 
FALSE
;

565 
GA¼ay
 *
pošts
;

566 
BezPošt
 
bez
 = { 0, };

567 
gch¬
 *
·th
 = (gch¬ *)
·th_¡r
;

568 
gboŞ—n
 
Ãed_Ãxt_–em’t
 = 
FALSE
;

570 *
şo£d
 = 
FALSE
;

571 *
uÅ¬£d
 = 
NULL
;

573 
pošts
 = 
	`g_¬¿y_Ãw
(
FALSE
, FALSE, (
BezPošt
));

574 
	`g_¬¿y_£t_size
(
pošts
, 0);

576 
	`·th_chomp
(
·th
);

577 
·th
[0] != '\0') {

578 #ifdeà
DEBUG_CUSTOM


579 
	`g_´št
("P©h: %s\n", 
·th
);

582 
·th
[0]) {

584 ià(
pošts
->
Ën
 > 0) {

585 
Ãed_Ãxt_–em’t
 = 
TRUE
;

586 
MORETOPARSE
;

588 
·th
++;

589 
	`·th_chomp
(
·th
);

590 
Ï¡_ty³
 = 
PATH_MOVE
;

591 
Ï¡_»Ïtive
 = 
FALSE
;

594 ià(
pošts
->
Ën
 > 0) {

595 
Ãed_Ãxt_–em’t
 = 
TRUE
;

596 
MORETOPARSE
;

598 
·th
++;

599 
	`·th_chomp
(
·th
);

600 
Ï¡_ty³
 = 
PATH_MOVE
;

601 
Ï¡_»Ïtive
 = 
TRUE
;

604 
·th
++;

605 
	`·th_chomp
(
·th
);

606 
Ï¡_ty³
 = 
PATH_LINE
;

607 
Ï¡_»Ïtive
 = 
FALSE
;

610 
·th
++;

611 
	`·th_chomp
(
·th
);

612 
Ï¡_ty³
 = 
PATH_LINE
;

613 
Ï¡_»Ïtive
 = 
TRUE
;

616 
·th
++;

617 
	`·th_chomp
(
·th
);

618 
Ï¡_ty³
 = 
PATH_HLINE
;

619 
Ï¡_»Ïtive
 = 
FALSE
;

622 
·th
++;

623 
	`·th_chomp
(
·th
);

624 
Ï¡_ty³
 = 
PATH_HLINE
;

625 
Ï¡_»Ïtive
 = 
TRUE
;

628 
·th
++;

629 
	`·th_chomp
(
·th
);

630 
Ï¡_ty³
 = 
PATH_VLINE
;

631 
Ï¡_»Ïtive
 = 
FALSE
;

634 
·th
++;

635 
	`·th_chomp
(
·th
);

636 
Ï¡_ty³
 = 
PATH_VLINE
;

637 
Ï¡_»Ïtive
 = 
TRUE
;

640 
·th
++;

641 
	`·th_chomp
(
·th
);

642 
Ï¡_ty³
 = 
PATH_CURVE
;

643 
Ï¡_»Ïtive
 = 
FALSE
;

646 
·th
++;

647 
	`·th_chomp
(
·th
);

648 
Ï¡_ty³
 = 
PATH_CURVE
;

649 
Ï¡_»Ïtive
 = 
TRUE
;

652 
·th
++;

653 
	`·th_chomp
(
·th
);

654 
Ï¡_ty³
 = 
PATH_SMOOTHCURVE
;

655 
Ï¡_»Ïtive
 = 
FALSE
;

658 
·th
++;

659 
	`·th_chomp
(
·th
);

660 
Ï¡_ty³
 = 
PATH_SMOOTHCURVE
;

661 
Ï¡_»Ïtive
 = 
TRUE
;

665 
·th
++;

666 
	`·th_chomp
(
·th
);

667 
Ï¡_ty³
 = 
PATH_CLOSE
;

668 
Ï¡_»Ïtive
 = 
FALSE
;

671 
·th
++;

672 
	`·th_chomp
(
·th
);

673 
Ï¡_ty³
 = 
PATH_ARC
;

674 
Ï¡_»Ïtive
 = 
FALSE
;

677 
·th
++;

678 
	`·th_chomp
(
·th
);

679 
Ï¡_ty³
 = 
PATH_ARC
;

680 
Ï¡_»Ïtive
 = 
TRUE
;

695 ià(
Ï¡_ty³
 =ğ
PATH_CLOSE
) {

696 
	`g_w¬nšg
("parse_path:‡rgument given for implicite close…ath");

698 
·th
 !ğ'\0' && 
	`¡rchr
("0123456789.+-",…ath[0]))…ath++;

699 
	`·th_chomp
(
·th
);

700 *
şo£d
 = 
TRUE
;

701 
Ãed_Ãxt_–em’t
 = 
TRUE
;

702 
MORETOPARSE
;

706 
	`g_w¬nšg
("unsuµÜ‹d…©h cod'%c'", 
·th
[0]);

707 
·th
++;

708 
	`·th_chomp
(
·th
);

713 
Ï¡_ty³
) {

714 
PATH_MOVE
:

715 
bez
.
ty³
 = 
BEZ_MOVE_TO
;

716 
bez
.
p1
.
x
 = 
	`g_ascii_¡¹od
(
·th
, &path);

717 
	`·th_chomp
(
·th
);

718 
bez
.
p1
.
y
 = 
	`g_ascii_¡¹od
(
·th
, &path);

719 
	`·th_chomp
(
·th
);

720 ià(
Ï¡_»Ïtive
) {

721 
bez
.
p1
.
x
 +ğ
Ï¡_pošt
.x;

722 
bez
.
p1
.
y
 +ğ
Ï¡_pošt
.y;

724 
Ï¡_pošt
 = 
bez
.
p1
;

725 
Ï¡_cÚŒŞ
 = 
bez
.
p1
;

726 
Ï¡_İ’
 = 
bez
.
p1
;

727 
	`g_¬¿y_­³nd_v®
(
pošts
, 
bez
);

729 
PATH_LINE
:

730 
bez
.
ty³
 = 
BEZ_LINE_TO
;

731 
bez
.
p1
.
x
 = 
	`g_ascii_¡¹od
(
·th
, &path);

732 
	`·th_chomp
(
·th
);

733 
bez
.
p1
.
y
 = 
	`g_ascii_¡¹od
(
·th
, &path);

734 
	`·th_chomp
(
·th
);

735 ià(
Ï¡_»Ïtive
) {

736 
bez
.
p1
.
x
 +ğ
Ï¡_pošt
.x;

737 
bez
.
p1
.
y
 +ğ
Ï¡_pošt
.y;

743 
	#INIT_LINE_TO_AS_CURVE_TO
 
bez
.
p3
 = bez.
p1
; bez.
p2
 = 
Ï¡_pošt


	)

745 
INIT_LINE_TO_AS_CURVE_TO
;

747 
Ï¡_pošt
 = 
bez
.
p1
;

748 
Ï¡_cÚŒŞ
 = 
bez
.
p1
;

750 
	`g_¬¿y_­³nd_v®
(
pošts
, 
bez
);

752 
PATH_HLINE
:

753 
bez
.
ty³
 = 
BEZ_LINE_TO
;

754 
bez
.
p1
.
x
 = 
	`g_ascii_¡¹od
(
·th
, &path);

755 
	`·th_chomp
(
·th
);

756 
bez
.
p1
.
y
 = 
Ï¡_pošt
.y;

757 ià(
Ï¡_»Ïtive
)

758 
bez
.
p1
.
x
 +ğ
Ï¡_pošt
.x;

760 
INIT_LINE_TO_AS_CURVE_TO
;

762 
Ï¡_pošt
 = 
bez
.
p1
;

763 
Ï¡_cÚŒŞ
 = 
bez
.
p1
;

765 
	`g_¬¿y_­³nd_v®
(
pošts
, 
bez
);

767 
PATH_VLINE
:

768 
bez
.
ty³
 = 
BEZ_LINE_TO
;

769 
bez
.
p1
.
x
 = 
Ï¡_pošt
.x;

770 
bez
.
p1
.
y
 = 
	`g_ascii_¡¹od
(
·th
, &path);

771 
	`·th_chomp
(
·th
);

772 ià(
Ï¡_»Ïtive
)

773 
bez
.
p1
.
y
 +ğ
Ï¡_pošt
.y;

775 
INIT_LINE_TO_AS_CURVE_TO
;

777 #undeà
INIT_LINE_TO_AS_CURVE_TO


779 
Ï¡_pošt
 = 
bez
.
p1
;

780 
Ï¡_cÚŒŞ
 = 
bez
.
p1
;

782 
	`g_¬¿y_­³nd_v®
(
pošts
, 
bez
);

784 
PATH_CURVE
:

785 
bez
.
ty³
 = 
BEZ_CURVE_TO
;

786 
bez
.
p1
.
x
 = 
	`g_ascii_¡¹od
(
·th
, &path);

787 
	`·th_chomp
(
·th
);

788 
bez
.
p1
.
y
 = 
	`g_ascii_¡¹od
(
·th
, &path);

789 
	`·th_chomp
(
·th
);

790 
bez
.
p2
.
x
 = 
	`g_ascii_¡¹od
(
·th
, &path);

791 
	`·th_chomp
(
·th
);

792 
bez
.
p2
.
y
 = 
	`g_ascii_¡¹od
(
·th
, &path);

793 
	`·th_chomp
(
·th
);

794 
bez
.
p3
.
x
 = 
	`g_ascii_¡¹od
(
·th
, &path);

795 
	`·th_chomp
(
·th
);

796 
bez
.
p3
.
y
 = 
	`g_ascii_¡¹od
(
·th
, &path);

797 
	`·th_chomp
(
·th
);

798 ià(
Ï¡_»Ïtive
) {

799 
bez
.
p1
.
x
 +ğ
Ï¡_pošt
.x;

800 
bez
.
p1
.
y
 +ğ
Ï¡_pošt
.y;

801 
bez
.
p2
.
x
 +ğ
Ï¡_pošt
.x;

802 
bez
.
p2
.
y
 +ğ
Ï¡_pošt
.y;

803 
bez
.
p3
.
x
 +ğ
Ï¡_pošt
.x;

804 
bez
.
p3
.
y
 +ğ
Ï¡_pošt
.y;

806 
Ï¡_pošt
 = 
bez
.
p3
;

807 
Ï¡_cÚŒŞ
 = 
bez
.
p2
;

809 
	`g_¬¿y_­³nd_v®
(
pošts
, 
bez
);

811 
PATH_SMOOTHCURVE
:

812 
bez
.
ty³
 = 
BEZ_CURVE_TO
;

813 
bez
.
p1
.
x
 = 2 * 
Ï¡_pošt
.x - 
Ï¡_cÚŒŞ
.x;

814 
bez
.
p1
.
y
 = 2 * 
Ï¡_pošt
.y - 
Ï¡_cÚŒŞ
.y;

815 
bez
.
p2
.
x
 = 
	`g_ascii_¡¹od
(
·th
, &path);

816 
	`·th_chomp
(
·th
);

817 
bez
.
p2
.
y
 = 
	`g_ascii_¡¹od
(
·th
, &path);

818 
	`·th_chomp
(
·th
);

819 
bez
.
p3
.
x
 = 
	`g_ascii_¡¹od
(
·th
, &path);

820 
	`·th_chomp
(
·th
);

821 
bez
.
p3
.
y
 = 
	`g_ascii_¡¹od
(
·th
, &path);

822 
	`·th_chomp
(
·th
);

823 ià(
Ï¡_»Ïtive
) {

824 
bez
.
p2
.
x
 +ğ
Ï¡_pošt
.x;

825 
bez
.
p2
.
y
 +ğ
Ï¡_pošt
.y;

826 
bez
.
p3
.
x
 +ğ
Ï¡_pošt
.x;

827 
bez
.
p3
.
y
 +ğ
Ï¡_pošt
.y;

829 
Ï¡_pošt
 = 
bez
.
p3
;

830 
Ï¡_cÚŒŞ
 = 
bez
.
p2
;

832 
	`g_¬¿y_­³nd_v®
(
pošts
, 
bez
);

834 
PATH_ARC
 :

836 
»®
 
rx
, 
ry
;

837 
»®
 
xrÙ
;

838 
Ïrg—rc
, 
sw“p
;

839 
Pošt
 
de¡
, 
de¡_c
;

840 
de¡_c
.
x
=0;

841 
de¡_c
.
y
=0;

843 
rx
 = 
	`g_ascii_¡¹od
(
·th
, &path);

844 
	`·th_chomp
(
·th
);

845 
ry
 = 
	`g_ascii_¡¹od
(
·th
, &path);

846 
	`·th_chomp
(
·th
);

847 
xrÙ
 = 
	`g_ascii_¡¹od
(
·th
, &path);

848 
	`·th_chomp
(
·th
);

850 
Ïrg—rc
 = ()
	`g_ascii_¡¹od
(
·th
, &path);

851 
	`·th_chomp
(
·th
);

852 
sw“p
 = ()
	`g_ascii_¡¹od
(
·th
, &path);

853 
	`·th_chomp
(
·th
);

855 
de¡
.
x
 = 
	`g_ascii_¡¹od
(
·th
, &path);

856 
	`·th_chomp
(
·th
);

857 
de¡
.
y
 = 
	`g_ascii_¡¹od
(
·th
, &path);

858 
	`·th_chomp
(
·th
);

860 ià(
Ï¡_»Ïtive
) {

861 
de¡
.
x
 +ğ
Ï¡_pošt
.x;

862 
de¡
.
y
 +ğ
Ï¡_pošt
.y;

865 
	`_·th_¬c
 (
pošts
, 
Ï¡_pošt
.
x
,†a¡_pošt.
y
,

866 
rx
, 
ry
, 
xrÙ
, 
Ïrg—rc
, 
sw“p
, 
de¡
.
x
, de¡.
y
,

867 &
de¡_c
);

868 
Ï¡_pošt
 = 
de¡
;

869 
Ï¡_cÚŒŞ
 = 
de¡_c
;

872 
PATH_CLOSE
:

874 ià(
Ï¡_İ’
.
x
 !ğ
Ï¡_pošt
.x ||†a¡_İ’.
y
 !=†ast_point.y) {

875 
bez
.
ty³
 = 
BEZ_LINE_TO
;

876 
bez
.
p1
 = 
Ï¡_İ’
;

877 
	`g_¬¿y_­³nd_v®
(
pošts
, 
bez
);

879 *
şo£d
 = 
TRUE
;

880 
Ãed_Ãxt_–em’t
 = 
TRUE
;

883 
	`·th_chomp
(
·th
);

884 
MORETOPARSE
:

885 ià(
Ãed_Ãxt_–em’t
) {

887 ià(
·th
[0] != 0)

888 *
uÅ¬£d
 = 
·th
;

897 ià(
pošts
->
Ën
 < 2) {

898 
	`g_¬¿y_£t_size
(
pošts
, 0);

900  
pošts
;

901 
	}
}

	@O:\tool\dvs50\lib\dia_svg.h

19 #iâdeà
DIA_SVG_H


20 
	#DIA_SVG_H


	)

22 
	~"dŸ_xml.h
"

23 
	~"fÚt.h
"

26 
	eDŸSvgCŞours


28 
	mDIA_SVG_COLOUR_NONE
 = -1,

29 
	mDIA_SVG_COLOUR_FOREGROUND
 = -2,

30 
	mDIA_SVG_COLOUR_BACKGROUND
 = -3,

31 
	mDIA_SVG_COLOUR_TEXT
 = -4

35 
	eDŸSvgLšeDeçuÉs


37 
	mDIA_SVG_LINECAPS_DEFAULT
 = 20,

38 
	mDIA_SVG_LINEJOIN_DEFAULT
 = 20,

39 
	mDIA_SVG_LINESTYLE_DEFAULT
 = 20

42 
_DŸSvgStyË
 
	tDŸSvgStyË
;

43 
	s_DŸSvgStyË
 {

44 
»®
 
	mlše_width
;

45 
gšt32
 
	m¡roke
;

46 
gšt32
 
	mfl
;

48 
LšeC­s
 
	mlšeÿp
;

49 
LšeJoš
 
	mlšejoš
;

50 
LšeStyË
 
	mlše¡yË
;

51 
»®
 
	mdashËngth
;

53 
DŸFÚt
 *
	mfÚt
;

54 
»®
 
	mfÚt_height
;

55 
Alignm’t
 
	m®ignm’t
;

58 
DIAVAR
 
dŸ_svg_¡yË_š™
 (
DŸSvgStyË
 *
gs
, DŸSvgStyË *
·»Á_¡yË
);

59 
DIAVAR
 
dŸ_svg_¡yË_cİy
 (
DŸSvgStyË
 *
de¡
, DŸSvgStyË *
¤c
);

60 
DIAVAR
 
dŸ_svg_·r£_¡yË
(
xmlNodePŒ
 
node
, 
DŸSvgStyË
 *
s
, 
»®
 
u£r_sÿË
);

62 
DIAVAR
 
GA¼ay
* 
dŸ_svg_·r£_·th
(cÚ¡ 
gch¬
 *
·th_¡r
, gch¬ **
uÅ¬£d
, 
gboŞ—n
 *
şo£d
);

	@O:\tool\dvs50\lib\dia_xml.c

19 
	~<cÚfig.h
>

21 
	~<¡dio.h
>

22 
	~<¡dlib.h
>

23 
	~<¡ršg.h
>

24 
	~<m©h.h
>

25 
	~<fú.h
>

27 
	~<glib.h
>

28 
	~<glib/g¡dio.h
>

30 
	~<libxml/·r£r.h
>

31 
	~<libxml/·r£rIÁ”Çls.h
>

32 
	~<libxml/xmlmemÜy.h
>

34 #ifdeà
HAVE_UNISTD_H


35 
	~<uni¡d.h
>

38 
	~<zlib.h
>

40 
	~"š.h
"

41 
	~"uts.h
"

42 
	~"dŸ_xml_libxml.h
"

43 
	~"dŸ_xml.h
"

44 
	~"geom‘ry.h
"

45 
	~"mes§ge.h
"

47 #ifdeà
G_OS_WIN32


48 
	~<io.h
>

51 #ifdeà
G_OS_WIN32


52 
	~<æßt.h
>

53 #iâdeà
isšf


54 
	#isšf
(
a
è(!
	`_fš™e
×))

	)

58 
	#BUFLEN
 1024

	)

65 #iâdeà
i¢ª


66 
	#i¢ª
(
x
) \

67 ( (
x
è=ğ (è? 
	`i¢ª_ld
 (x) \

68 :  (
x
è=ğ (è? 
	`i¢ª_d
 (x) \

69 : 
	`i¢ª_f
 (
x
))

	)

70 
šlše
 
	$i¢ª_f
 (
x
è{  x !ğx; 
	}
}

71 
šlše
 
	$i¢ª_d
 (
x
è{  x !ğx; 
	}
}

72 
šlše
 
	$i¢ª_ld
 (
x
è{  x !ğx; 
	}
}

75 #iâdeà
isšf


76 
	#isšf
(
x
) \

77 ( (
x
è=ğ (è? 
	`isšf_ld
 (x) \

78 :  (
x
è=ğ (è? 
	`isšf_d
 (x) \

79 : 
	`isšf_f
 (
x
))

	)

80 
šlše
 
	$isšf_f
 (
x
è{  
	`i¢ª
 (x - x); 
	}
}

81 
šlše
 
	$isšf_d
 (
x
è{  
	`i¢ª
 (x - x); 
	}
}

82 
šlše
 
	$isšf_ld
 (
x
è{  
	`i¢ª
 (x - x); 
	}
}

104 cÚ¡ 
gch¬
 *

105 
	$xml_fe_check_’codšg
(cÚ¡ 
gch¬
 *
f’ame
, cÚ¡ gch¬ *
deçuÉ_’c
)

107 
fd
 = 
	`g_İ’
 (
f’ame
, 
O_RDONLY
, 0);

108 
gzFe
 
zf
 = 
	`gzdİ’
(
fd
,"rb");

109 
gch¬
 *
buf
;

110 
gch¬
 *
p
,*
pmax
;

111 
Ën
;

112 
gch¬
 *
tmp
,*
»s
;

113 
uf
;

114 
gboŞ—n
 
w–l_fÜmed_utf8
;

116 
magic_xml
[] =

119 ià(!
zf
) {

120 
	`dŸ_log_mes§ge
("% ÿÀnÙ bİ’ed fÜƒncodšg check (%s)", 
f’ame
, 
fd
 > 0 ? "gzdopen" : "g_open");

122  
f’ame
;

124 
p
 = 
buf
 = 
	`g_m®loc0
(
BUFLEN
);

125 
Ën
 = 
	`gz»ad
(
zf
,
buf
,
BUFLEN
);

126 
pmax
 = 
p
 + 
Ën
;

129 ià((0 !ğ
	`¡ºcmp
(
p
,
magic_xml
,5)è|| (
Ën
 < 5)) {

130 
	`gzşo£
(
zf
);

131 
	`g_ä“
(
buf
);

132  
f’ame
;

135 
p
 += 5;

136 ((*
p
 == 0x20)||(*p == 0x09)||(*p == 0x0d)||(*p == 0x0a))

137 && (
p
<
pmax
))…++;

138 ià(
p
>=
pmax
) {

139 
	`gzşo£
(
zf
);

140 
	`g_ä“
(
buf
);

141  
f’ame
;

143 ià(0 !ğ
	`¡ºcmp
(
p
,"version=\"",9)) {

144 
	`gzşo£
(
zf
);

145 
	`g_ä“
(
buf
);

146  
f’ame
;

148 
p
 += 9;

150 ià(
p
>=
pmax
) {

151 
	`gzşo£
(
zf
);

152 
	`g_ä“
(
buf
);

153  
f’ame
;

155 (*
p
 !ğ'"'è&& (°< 
pmax
))…++;

156 
p
++;

157 ((*
p
 == 0x20)||(*p == 0x09)||(*p == 0x0d)||(*p == 0x0a))

158 && (
p
<
pmax
))…++;

159 ià(
p
>=
pmax
) {

160 
	`gzşo£
(
zf
);

161 
	`g_ä“
(
buf
);

162  
f’ame
;

164 ià(0 =ğ
	`¡ºcmp
(
p
,"encoding=\"",10)) {

165 
	`gzşo£
(
zf
);

166 
	`g_ä“
(
buf
);

167  
f’ame
;

172 
w–l_fÜmed_utf8
 = 
TRUE
;

174 
i
;

175 
i
 = 0; i < 
Ën
; i++)

176 ià(
buf
[
i
] & 0x80 || buf[i] == '&')

177 
w–l_fÜmed_utf8
 = 
FALSE
;

178 
Ën
 = 
	`gz»ad
(
zf
,
buf
,
BUFLEN
);

179 } 
Ën
 > 0 && 
w–l_fÜmed_utf8
);

180 ià(
w–l_fÜmed_utf8
) {

181 
	`gzşo£
(
zf
);

182 
	`g_ä“
(
buf
);

183  
f’ame
;

185 
	`gzşo£
(
zf
);

186 
fd
 = 
	`g_İ’
 (
f’ame
, 
O_RDONLY
, 0);

187 
zf
 = 
	`gzdİ’
(
fd
,"rb");

188 
Ën
 = 
	`gz»ad
(
zf
,
buf
,
BUFLEN
);

191 ià(0 !ğ
	`¡rcmp
(
deçuÉ_’c
,"UTF-8")) {

192 
	`mes§ge_w¬nšg
(
	`_
("The file %s has‚oƒncoding specification;\n"

194 
	`dŸ_mes§ge_f’ame
(
f’ame
), 
deçuÉ_’c
);

196 
	`gzşo£
(
zf
);

197 
	`g_ä“
(
buf
);

198  
f’ame
;

201 
tmp
 = 
	`g‘’v
("TMP");

202 ià(!
tmp
ètm°ğ
	`g‘’v
("TEMP");

203 ià(!
tmp
)mp = "/tmp";

205 
»s
 = 
	`g_¡rcÚÿt
(
tmp
,
G_DIR_SEPARATOR_S
,"dŸ-xml-fix-’codšgXXXXXX",
NULL
);

206 
uf
 = 
	`g_mk¡emp
(
»s
);

207 
	`wr™e
(
uf
,
buf
,
p
-buf);

208 
	`wr™e
(
uf
,"ƒncoding=\"",11);

209 
	`wr™e
(
uf
,
deçuÉ_’c
,
	`¡¾’
(default_enc));

210 
	`wr™e
(
uf
,"\" ",2);

211 
	`wr™e
(
uf
,
p
,
pmax
 -…);

214 
Ën
 = 
	`gz»ad
(
zf
,
buf
,
BUFLEN
);

215 ià(
Ën
 <= 0) ;

216 
	`wr™e
(
uf
,
buf
,
Ën
);

218 
	`gzşo£
(
zf
);

219 
	`şo£
(
uf
);

220 
	`g_ä“
(
buf
);

221  
»s
;

222 
	}
}

229 
xmlDocPŒ


230 
	$xmlDŸP¬£Fe
(cÚ¡ *
f’ame
)

232 
G_CONST_RETURN
 *
loÿl_ch¬£t
 = 
NULL
;

234 iàĞ!
	`g_g‘_ch¬£t
(&
loÿl_ch¬£t
)

235 && 
loÿl_ch¬£t
) {

237 cÚ¡ 
gch¬
 *
âame
 = 
	`xml_fe_check_’codšg
(
f’ame
,
loÿl_ch¬£t
);

238 ià(
âame
 !ğ
f’ame
) {

240 
xmlDocPŒ
 
»t
 = 
	`xmlDoP¬£Fe
(
âame
);

241 
	`uÆšk
(
âame
);

243 
	`g_ä“
((*)
âame
);

244  
»t
;

248  
	`xmlDoP¬£Fe
(
f’ame
);

251  
	`xmlDoP¬£Fe
(
f’ame
);

253 
	}
}

259 
xmlDocPŒ


260 
	$xmlDoP¬£Fe
(cÚ¡ *
f’ame
)

262  
	`xmlP¬£Fe
(
f’ame
);

263 
	}
}

273 
A‰ribu‹Node


274 
	$çùÜy_fšd_cu¡om_node
(
ObjeùNode
 
obj_node
,

275 cÚ¡ *
nod’ame
)

277 
A‰ribu‹Node
 
©Œ
;

278 
obj_node
 && 
	`xmlIsBÏnkNode
(obj_node))

279 
obj_node
 = obj_node->
Ãxt
;

280 ià(!
obj_node
è 
NULL
;

282 
©Œ
 = 
obj_node
->
xmlChd»nNode
;

283 
©Œ
 !ğ
NULL
) {

284 ià(
	`xmlIsBÏnkNode
(
©Œ
)) {

285 
©Œ
 =‡‰r->
Ãxt
;

288 iàĞ
©Œ
 && (
	`¡rcmp
((*è©Œ->
Çme
, 
nod’ame
)==0) ) {

289  
©Œ
;

291 
©Œ
 =‡‰r->
Ãxt
;

293  
NULL
;

294 
	}
}

296 
A‰ribu‹Node


297 
	$objeù_fšd_©Œibu‹
(
ObjeùNode
 
obj_node
,

298 cÚ¡ *
©ŒÇme
)

300 
A‰ribu‹Node
 
©Œ
;

301 
xmlCh¬
 *
Çme
;

303 
obj_node
 && 
	`xmlIsBÏnkNode
(obj_node))

304 
obj_node
 = obj_node->
Ãxt
;

305 ià(!
obj_node
è 
NULL
;

307 
©Œ
 = 
obj_node
->
xmlChd»nNode
;

308 
©Œ
 !ğ
NULL
) {

309 ià(
	`xmlIsBÏnkNode
(
©Œ
)) {

310 
©Œ
 =‡‰r->
Ãxt
;

314 
Çme
 = 
	`xmlG‘Prİ
(
©Œ
, (cÚ¡ 
xmlCh¬
 *)"name");

315 iàĞ(
Çme
!=
NULL
è&& (
	`¡rcmp
((*èÇme, 
©ŒÇme
)==0) ) {

316 
	`xmlF»e
(
Çme
);

317  
©Œ
;

319 ià(
Çme
è
	`xmlF»e
(name);

321 
©Œ
 =‡‰r->
Ãxt
;

323  
NULL
;

324 
	}
}

333 
A‰ribu‹Node


334 
	$compos™e_fšd_©Œibu‹
(
D©aNode
 
compos™e_node
,

335 cÚ¡ *
©ŒÇme
)

337 
A‰ribu‹Node
 
©Œ
;

338 
xmlCh¬
 *
Çme
;

340 
compos™e_node
 && 
	`xmlIsBÏnkNode
(composite_node))

341 
compos™e_node
 = compos™e_node->
Ãxt
;

342 ià(!
compos™e_node
è 
NULL
;

344 
©Œ
 = 
compos™e_node
->
xmlChd»nNode
;

345 
©Œ
 !ğ
NULL
) {

346 ià(
	`xmlIsBÏnkNode
(
©Œ
)) {

347 
©Œ
 =‡‰r->
Ãxt
;

351 
Çme
 = 
	`xmlG‘Prİ
(
©Œ
, (cÚ¡ 
xmlCh¬
 *)"name");

352 iàĞ(
Çme
!=
NULL
è&& (
	`¡rcmp
((*èÇme, 
©ŒÇme
)==0) ) {

353 
	`xmlF»e
(
Çme
);

354  
©Œ
;

356 ià(
Çme
è
	`xmlF»e
(name);

358 
©Œ
 =‡‰r->
Ãxt
;

360  
NULL
;

361 
	}
}

368 
	$©Œibu‹_num_d©a
(
A‰ribu‹Node
 
©Œibu‹
)

370 
xmlNode
 *
d©a
;

371 
Ä
=0;

373 
d©a
 = 
©Œibu‹
 ?‡‰ribu‹->
xmlChd»nNode
 : 
NULL
;

374 
d©a
 !ğ
NULL
) {

375 ià(
	`xmlIsBÏnkNode
(
d©a
)) {

376 
d©a
 = d©a->
Ãxt
;

379 
Ä
++;

380 
d©a
 = d©a->
Ãxt
;

382  
Ä
;

383 
	}
}

389 
D©aNode


390 
	$©Œibu‹_fœ¡_d©a
(
A‰ribu‹Node
 
©Œibu‹
)

392 
xmlNode
 *
d©a
 = 
©Œibu‹
 ?‡‰ribu‹->
xmlChd»nNode
 : 
NULL
;

393 
d©a
 && 
	`xmlIsBÏnkNode
(d©a)èd©¨ğd©a->
Ãxt
;

394  (
D©aNode
è
d©a
;

395 
	}
}

401 
D©aNode


402 
	$d©a_Ãxt
(
D©aNode
 
d©a
)

405 ià(
d©a
) {

406 
d©a
 = d©a->
Ãxt
;

407 
d©a
 && 
	`xmlIsBÏnkNode
(d©a)èd©¨ğd©a->
Ãxt
;

409  (
D©aNode
è
d©a
;

410 
	}
}

421 
D©aTy³


422 
	$d©a_ty³
(
D©aNode
 
d©a
)

424 cÚ¡ *
Çme
;

426 
Çme
 = 
d©a
 ? (const *)data->name : (const *)"";

427 ià(
	`¡rcmp
(
Çme
, "composite")==0) {

428  
DATATYPE_COMPOSITE
;

429 } ià(
	`¡rcmp
(
Çme
, "int")==0) {

430  
DATATYPE_INT
;

431 } ià(
	`¡rcmp
(
Çme
, "enum")==0) {

432  
DATATYPE_ENUM
;

433 } ià(
	`¡rcmp
(
Çme
, "real")==0) {

434  
DATATYPE_REAL
;

435 } ià(
	`¡rcmp
(
Çme
, "boolean")==0) {

436  
DATATYPE_BOOLEAN
;

437 } ià(
	`¡rcmp
(
Çme
, "color")==0) {

438  
DATATYPE_COLOR
;

439 } ià(
	`¡rcmp
(
Çme
, "point")==0) {

440  
DATATYPE_POINT
;

441 } ià(
	`¡rcmp
(
Çme
, "rectangle")==0) {

442  
DATATYPE_RECTANGLE
;

443 } ià(
	`¡rcmp
(
Çme
, "string")==0) {

444  
DATATYPE_STRING
;

445 } ià(
	`¡rcmp
(
Çme
, "font")==0) {

446  
DATATYPE_FONT
;

447 } ià(
	`¡rcmp
(
Çme
, "bezpoint")==0) {

448  
DATATYPE_BEZPOINT
;

449 } ià(
	`¡rcmp
(
Çme
, "dict")==0) {

450  
DATATYPE_DICT
;

453 
	`mes§ge_”rÜ
("Unknownype of DataNode");

455 
	}
}

463 
	$d©a_št
(
D©aNode
 
d©a
)

465 
xmlCh¬
 *
v®
;

466 
»s
;

468 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_INT
) {

469 
	`mes§ge_”rÜ
("Taking int value of‚on-int‚ode.");

473 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"val");

474 
»s
 = 
	`©oi
((*è
v®
);

475 ià(
v®
è
	`xmlF»e
(val);

477  
»s
;

478 
	}
}

485 
	$d©a_’um
(
D©aNode
 
d©a
)

487 
xmlCh¬
 *
v®
;

488 
»s
;

490 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_ENUM
) {

491 
	`mes§ge_”rÜ
("Takingƒnum value of‚on-enum‚ode.");

495 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"val");

496 
»s
 = 
	`©oi
((*è
v®
);

497 ià(
v®
è
	`xmlF»e
(val);

499  
»s
;

500 
	}
}

507 
»®


508 
	$d©a_»®
(
D©aNode
 
d©a
)

510 
xmlCh¬
 *
v®
;

511 
»®
 
»s
;

513 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_REAL
) {

514 
	`mes§ge_”rÜ
("Taking„eal value of‚on-real‚ode.");

518 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"val");

519 
»s
 = 
	`g_ascii_¡¹od
((*è
v®
, 
NULL
);

520 ià(
v®
è
	`xmlF»e
(val);

522  
»s
;

523 
	}
}

531 
	$d©a_boŞ—n
(
D©aNode
 
d©a
)

533 
xmlCh¬
 *
v®
;

534 
»s
;

536 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_BOOLEAN
) {

537 
	`mes§ge_”rÜ
("Taking boolean value of‚on-boolean‚ode.");

541 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"val");

543 ià((
v®
è&& (
	`¡rcmp
((*) val, "true")==0))

544 
»s
 = 
TRUE
;

546 
»s
 = 
FALSE
;

548 ià(
v®
è
	`xmlF»e
(val);

550  
»s
;

551 
	}
}

559 
	$hex_dig™
(
c
)

561 ià((
c
>='0') && (c<='9'))

562  
c
-'0';

563 ià((
c
>='a') && (c<='f'))

564  (
c
-'a') + 10;

565 ià((
c
>='A') && (c<='F'))

566  (
c
-'A') + 10;

567 
	`mes§ge_”rÜ
("wrÚg hex dig™ %c", 
c
);

569 
	}
}

579 
	$d©a_cŞÜ
(
D©aNode
 
d©a
, 
CŞÜ
 *
cŞ
)

581 
xmlCh¬
 *
v®
;

582 
r
=0, 
g
=0, 
b
=0;

584 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_COLOR
) {

585 
	`mes§ge_”rÜ
("Taking color value of‚on-color‚ode.");

589 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"val");

594 ià((
v®
è&& (
	`xmlSŒËn
(val)>=7)) {

595 
r
 = 
	`hex_dig™
(
v®
[1])*16 + hex_digit(val[2]);

596 
g
 = 
	`hex_dig™
(
v®
[3])*16 + hex_digit(val[4]);

597 
b
 = 
	`hex_dig™
(
v®
[5])*16 + hex_digit(val[6]);

600 ià(
v®
è
	`xmlF»e
(val);

602 
cŞ
->
»d
 = ()(
r
/255.0);

603 
cŞ
->
g»’
 = ()(
g
/255.0);

604 
cŞ
->
blue
 = ()(
b
/255.0);

605 
	}
}

614 
	$d©a_pošt
(
D©aNode
 
d©a
, 
Pošt
 *
pošt
)

616 
xmlCh¬
 *
v®
;

617 
gch¬
 *
¡r
;

618 
»®
 
ax
,
ay
;

620 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_POINT
) {

621 
	`mes§ge_”rÜ
(
	`_
("Taking…oint value of‚on-point‚ode."));

625 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"val");

626 
pošt
->
x
 = 
	`g_ascii_¡¹od
((*)
v®
, &
¡r
);

627 
ax
 = 
	`çbs
(
pošt
->
x
);

628 ià((
ax
 > 1e9è|| (×x < 1e-9è&& (ax !ğ0.0)è|| 
	`i¢ª
×xè|| 
	`isšf
(ax)) {

631 ià(!(
ax
 < 1e-9))

632 
	`g_w¬nšg
(
	`_
("IncÜ»ù x Pošˆv®u\"%s\" %f; disÿrdšg it."),
v®
,
pošt
->
x
);

633 
pošt
->
x
 = 0.0;

635 (*
¡r
 != ',') && (*str!=0))

636 
¡r
++;

637 ià(*
¡r
==0){

638 
pošt
->
y
 = 0.0;

639 
	`g_w¬nšg
(
	`_
("Error…arsing…oint."));

640 
	`xmlF»e
(
v®
);

643 
pošt
->
y
 = 
	`g_ascii_¡¹od
(
¡r
+1, 
NULL
);

644 
ay
 = 
	`çbs
(
pošt
->
y
);

645 ià((
ay
 > 1e9è|| (×y < 1e-9è&& (ay !ğ0.0)è|| 
	`i¢ª
×yè|| 
	`isšf
(ay)) {

646 ià(!(
ay
 < 1e-9))

647 
	`g_w¬nšg
(
	`_
("IncÜ»ù y Pošˆv®u\"%s\" %f; disÿrdšg it."),
¡r
+1,
pošt
->
y
);

648 
pošt
->
y
 = 0.0;

650 
	`xmlF»e
(
v®
);

651 
	}
}

659 
	$d©a_bezpošt
(
D©aNode
 
d©a
, 
BezPošt
 *
pošt
)

661 
xmlCh¬
 *
v®
;

662 
gch¬
 *
¡r
;

663 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_BEZPOINT
) {

664 
	`mes§ge_”rÜ
(
	`_
("Taking bezpoint value of‚on-point‚ode."));

667 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"type");

668 ià(
v®
) {

669 ià(
	`¡rcmp
((*)
v®
, "moveto") == 0)

670 
pošt
->
ty³
 = 
BEZ_MOVE_TO
;

671 ià(
	`¡rcmp
((*)
v®
, "lineto") == 0)

672 
pošt
->
ty³
 = 
BEZ_LINE_TO
;

674 
pošt
->
ty³
 = 
BEZ_CURVE_TO
;

675 
	`xmlF»e
(
v®
);

677 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"p1");

678 ià(
v®
) {

679 
pošt
->
p1
.
x
 = 
	`g_ascii_¡¹od
((*)
v®
, &
¡r
);

680 ià(*
¡r
==0) {

681 
pošt
->
p1
.
y
 = 0;

682 
	`g_w¬nšg
(
	`_
("Error…arsing bezpoint…1."));

684 
pošt
->
p1
.
y
 = 
	`g_ascii_¡¹od
(
¡r
+1, 
NULL
);

686 
	`xmlF»e
(
v®
);

688 
pošt
->
p1
.
x
 = 0;

689 
pošt
->
p1
.
y
 = 0;

691 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"p2");

692 ià(
v®
) {

693 
pošt
->
p2
.
x
 = 
	`g_ascii_¡¹od
((*)
v®
, &
¡r
);

694 ià(*
¡r
==0) {

695 
pošt
->
p2
.
y
 = 0;

696 
	`g_w¬nšg
(
	`_
("Error…arsing bezpoint…2."));

698 
pošt
->
p2
.
y
 = 
	`g_ascii_¡¹od
(
¡r
+1, 
NULL
);

700 
	`xmlF»e
(
v®
);

702 
pošt
->
p2
.
x
 = 0;

703 
pošt
->
p2
.
y
 = 0;

705 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"p3");

706 ià(
v®
) {

707 
pošt
->
p3
.
x
 = 
	`g_ascii_¡¹od
((*)
v®
, &
¡r
);

708 ià(*
¡r
==0) {

709 
pošt
->
p3
.
y
 = 0;

710 
	`g_w¬nšg
(
	`_
("Error…arsing bezpoint…3."));

712 
pošt
->
p3
.
y
 = 
	`g_ascii_¡¹od
(
¡r
+1, 
NULL
);

714 
	`xmlF»e
(
v®
);

716 
pošt
->
p3
.
x
 = 0;

717 
pošt
->
p3
.
y
 = 0;

719 
	}
}

728 
	$d©a_»ùªgË
(
D©aNode
 
d©a
, 
ReùªgË
 *
»ù
)

730 
xmlCh¬
 *
v®
;

731 
gch¬
 *
¡r
;

733 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_RECTANGLE
) {

734 
	`mes§ge_”rÜ
("Taking„ectangle value of‚on-rectangle‚ode.");

738 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"val");

740 
»ù
->
Ëá
 = 
	`g_ascii_¡¹od
((*)
v®
, &
¡r
);

742 (*
¡r
 != ',') && (*str!=0))

743 
¡r
++;

745 ià(*
¡r
==0){

746 
	`mes§ge_”rÜ
("Error…arsing„ectangle.");

747 
	`xmlF»e
(
v®
);

751 
»ù
->
tİ
 = 
	`g_ascii_¡¹od
(
¡r
+1, &str);

753 (*
¡r
 != ';') && (*str!=0))

754 
¡r
++;

756 ià(*
¡r
==0){

757 
	`mes§ge_”rÜ
("Error…arsing„ectangle.");

758 
	`xmlF»e
(
v®
);

762 
»ù
->
right
 = 
	`g_ascii_¡¹od
(
¡r
+1, &str);

764 (*
¡r
 != ',') && (*str!=0))

765 
¡r
++;

767 ià(*
¡r
==0){

768 
	`mes§ge_”rÜ
("Error…arsing„ectangle.");

769 
	`xmlF»e
(
v®
);

773 
»ù
->
bÙtom
 = 
	`g_ascii_¡¹od
(
¡r
+1, 
NULL
);

775 
	`xmlF»e
(
v®
);

776 
	}
}

785 
gch¬
 *

786 
	$d©a_¡ršg
(
D©aNode
 
d©a
)

788 
xmlCh¬
 *
v®
;

789 
gch¬
 *
¡r
, *
p
,*
¡r2
;

790 
Ën
;

792 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_STRING
) {

793 
	`mes§ge_”rÜ
("Taking string value of‚on-string‚ode.");

794  
NULL
;

797 
v®
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"val");

798 ià(
v®
 !ğ
NULL
) {

799 
¡r
 = 
	`g_m®loc
(4 * (()*(
	`xmlSŒËn
(
v®
)+1)));

801 
p
 = 
¡r
;

802 *
v®
) {

803 ià(*
v®
 == '\\') {

804 
v®
++;

805 *
v®
) {

810 *
p
++ = '\n';

813 *
p
++ = '\t';

816 *
p
++ = '\\';

819 
	`mes§ge_”rÜ
("Error in stringag.");

822 *
p
++ = *
v®
;

824 
v®
++;

826 *
p
 = 0;

827 
	`xmlF»e
(
v®
);

828 
¡r2
 = 
	`g_¡rdup
(
¡r
);

829 
	`g_ä“
(
¡r
);

830  
¡r2
;

833 ià(
d©a
->
xmlChd»nNode
!=
NULL
) {

834 
p
 = (*)
	`xmlNodeLi¡G‘SŒšg
(
d©a
->
doc
, d©a->
xmlChd»nNode
, 
TRUE
);

836 ià(*
p
!='#')

837 
	`mes§ge_”rÜ
("Error in file, string‚ot starting with #\n");

839 
Ën
 = 
	`¡¾’
(
p
)-1;

841 
¡r
 = 
	`g_m®loc
(
Ën
+1);

843 
	`¡ºıy
(
¡r
, 
p
+1, 
Ën
);

844 
¡r
[
Ën
]=0;

846 
¡r
[
	`¡¾’
(str)-1] = 0;

847 
	`xmlF»e
(
p
);

848  
¡r
;

851  
NULL
;

852 
	}
}

863 
	$d©a_f’ame
(
D©aNode
 
d©a
)

865 *
utf8
 = 
	`d©a_¡ršg
(
d©a
);

866 *
f’ame
 = 
	`g_f’ame_äom_utf8
(
utf8
, -1, 
NULL
, NULL, NULL);

867 
	`g_ä“
(
utf8
);

868  
f’ame
;

869 
	}
}

878 
DŸFÚt
 *

879 
	$d©a_fÚt
(
D©aNode
 
d©a
)

881 
xmlCh¬
 *
çmy
;

882 
DŸFÚt
 *
fÚt
;

884 ià(
	`d©a_ty³
(
d©a
)!=
DATATYPE_FONT
) {

885 
	`mes§ge_”rÜ
("Taking font value of‚on-font‚ode.");

886  
NULL
;

889 
çmy
 = 
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"family");

891 ià(
çmy
) {

892 
DŸFÚtStyË
 
¡yË
;

893 * 
¡yË_Çme
 = (*è
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"style");

894 
¡yË
 = 
¡yË_Çme
 ? 
	`©oi
(style_name) : 0;

896 
fÚt
 = 
	`dŸ_fÚt_Ãw
 ((*)
çmy
, 
¡yË
, 1.0);

897 ià(
çmy
è
	`ä“
(family);

898 ià(
¡yË_Çme
è
	`xmlF»e
(style_name);

901 *
Çme
 = (*)
	`xmlG‘Prİ
(
d©a
, (cÚ¡ 
xmlCh¬
 *)"name");

902 
fÚt
 = 
	`dŸ_fÚt_Ãw_äom_Ëgacy_Çme
(
Çme
);

903 
	`ä“
(
Çme
);

905  
fÚt
;

906 
	}
}

917 
A‰ribu‹Node


918 
	$Ãw_©Œibu‹
(
ObjeùNode
 
obj_node
,

919 cÚ¡ *
©ŒÇme
)

921 
A‰ribu‹Node
 
©Œ
;

922 
©Œ
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"attribute", NULL);

923 
	`xmlS‘Prİ
(
©Œ
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
©ŒÇme
);

925  
©Œ
;

926 
	}
}

928 
A‰ribu‹Node


929 
	$Ãw_cu¡om_©Œibu‹
(
ObjeùNode
 
obj_node
,cÚ¡ * 
cu¡omnode
,

930 cÚ¡ *
©ŒÇme
)

932 
A‰ribu‹Node
 
©Œ
;

933 
©Œ
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)
cu¡omnode
, NULL);

934 
	`xmlS‘Prİ
(
©Œ
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
©ŒÇme
);

936  
©Œ
;

937 
	}
}

946 
A‰ribu‹Node


947 
	$compos™e_add_©Œibu‹
(
D©aNode
 
compos™e_node
,

948 cÚ¡ *
©ŒÇme
)

950 
A‰ribu‹Node
 
©Œ
;

951 
©Œ
 = 
	`xmlNewChd
(
compos™e_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"attribute", NULL);

952 
	`xmlS‘Prİ
(
©Œ
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
©ŒÇme
);

954  
©Œ
;

955 
	}
}

962 
	$d©a_add_št
(
A‰ribu‹Node
 
©Œ
, 
d©a
)

964 
D©aNode
 
d©a_node
;

965 
bufãr
[20+1];

967 
	`g_¢´štf
(
bufãr
, 20, "%d", 
d©a
);

969 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"int", NULL);

970 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"v®", (xmlCh¬ *)
bufãr
);

971 
	}
}

978 
	$d©a_add_’um
(
A‰ribu‹Node
 
©Œ
, 
d©a
)

980 
D©aNode
 
d©a_node
;

981 
bufãr
[20+1];

983 
	`g_¢´štf
(
bufãr
, 20, "%d", 
d©a
);

985 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"enum", NULL);

986 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"v®", (xmlCh¬ *)
bufãr
);

987 
	}
}

994 
	$d©a_add_»®
(
A‰ribu‹Node
 
©Œ
, 
»®
 
d©a
)

996 
D©aNode
 
d©a_node
;

997 
bufãr
[
G_ASCII_DTOSTR_BUF_SIZE
];

999 
	`g_ascii_dto¡r
(
bufãr
, 
G_ASCII_DTOSTR_BUF_SIZE
, 
d©a
);

1001 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"real", NULL);

1002 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"v®", (xmlCh¬ *)
bufãr
);

1003 
	}
}

1010 
	$d©a_add_boŞ—n
(
A‰ribu‹Node
 
©Œ
, 
d©a
)

1012 
D©aNode
 
d©a_node
;

1014 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"boolean", NULL);

1015 ià(
d©a
)

1016 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"val", (const xmlChar *)"true");

1018 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"val", (const xmlChar *)"false");

1019 
	}
}

1030 
	$cÚv”t_to_hex
(
x
, *
¡r
)

1032 cÚ¡ 
hex_dig™
[] = "0123456789abcdef";

1033 
v®
;

1035 
v®
 = 
x
 * 255.0;

1036 ià(
v®
>255)

1037 
v®
 = 255;

1038 ià(
v®
<0)

1039 
v®
 = 0;

1041 
¡r
[0] = 
hex_dig™
[
v®
/16];

1042 
¡r
[1] = 
hex_dig™
[
v®
%16];

1043 
	}
}

1050 
	$d©a_add_cŞÜ
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
CŞÜ
 *
cŞ
)

1052 
bufãr
[1+6+1];

1053 
D©aNode
 
d©a_node
;

1055 
bufãr
[0] = '#';

1056 
	`cÚv”t_to_hex
(
cŞ
->
»d
, &
bufãr
[1]);

1057 
	`cÚv”t_to_hex
(
cŞ
->
g»’
, &
bufãr
[3]);

1058 
	`cÚv”t_to_hex
(
cŞ
->
blue
, &
bufãr
[5]);

1059 
bufãr
[7] = 0;

1061 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"color", NULL);

1062 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"v®", (xmlCh¬ *)
bufãr
);

1063 
	}
}

1065 
gch¬
 *

1066 
	$_¡r_pošt
 (cÚ¡ 
Pošt
 *
pošt
)

1068 
gch¬
 *
bufãr
;

1069 
gch¬
 
px_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1070 
gch¬
 
py_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1072 
	`g_ascii_fÜm©d
(
px_buf
, Õx_buf), "%g", 
pošt
->
x
);

1073 
	`g_ascii_fÜm©d
(
py_buf
, Õy_buf), "%g", 
pošt
->
y
);

1074 
bufãr
 = 
	`g_¡rcÚÿt
(
px_buf
, ",", 
py_buf
, 
NULL
);

1076  
bufãr
;

1077 
	}
}

1084 
	$d©a_add_pošt
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
Pošt
 *
pošt
)

1086 
D©aNode
 
d©a_node
;

1087 
gch¬
 *
bufãr
 = 
	`_¡r_pošt
 (
pošt
);

1089 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"point", NULL);

1090 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"v®", (xmlCh¬ *)
bufãr
);

1091 
	`g_ä“
(
bufãr
);

1092 
	}
}

1095 
	$d©a_add_bezpošt
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
BezPošt
 *
pošt
)

1097 
D©aNode
 
d©a_node
;

1098 
gch¬
 *
bufãr
;

1100 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"bezpoint", NULL);

1101 
pošt
->
ty³
) {

1102 
BEZ_MOVE_TO
 :

1103 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"type", (const xmlChar *)"moveto");

1105 
BEZ_LINE_TO
 :

1106 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"type", (const xmlChar *)"lineto");

1108 
BEZ_CURVE_TO
 :

1109 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"type", (const xmlChar *)"curveto");

1112 
	`g_as£¹_nÙ_»ached
();

1115 
bufãr
 = 
	`_¡r_pošt
 (&
pošt
->
p1
);

1116 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"p1", (xmlCh¬ *)
bufãr
);

1117 
	`g_ä“
 (
bufãr
);

1118 ià(
pošt
->
ty³
 =ğ
BEZ_CURVE_TO
) {

1119 
bufãr
 = 
	`_¡r_pošt
 (&
pošt
->
p2
);

1120 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"p2", (xmlCh¬ *)
bufãr
);

1121 
	`g_ä“
 (
bufãr
);

1122 
bufãr
 = 
	`_¡r_pošt
 (&
pošt
->
p3
);

1123 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"p3", (xmlCh¬ *)
bufãr
);

1124 
	`g_ä“
 (
bufãr
);

1126 
	}
}

1133 
	$d©a_add_»ùªgË
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
ReùªgË
 *
»ù
)

1135 
D©aNode
 
d©a_node
;

1136 
gch¬
 *
bufãr
;

1137 
gch¬
 
¾_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1138 
gch¬
 
¼_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1139 
gch¬
 
¹_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1140 
gch¬
 
rb_buf
[
G_ASCII_DTOSTR_BUF_SIZE
];

1142 
	`g_ascii_fÜm©d
(
¾_buf
, Ôl_buf), "%g", 
»ù
->
Ëá
);

1143 
	`g_ascii_fÜm©d
(
¼_buf
, Ôr_buf), "%g", 
»ù
->
right
);

1144 
	`g_ascii_fÜm©d
(
¹_buf
, Ôt_buf), "%g", 
»ù
->
tİ
);

1145 
	`g_ascii_fÜm©d
(
rb_buf
, Ôb_buf), "%g", 
»ù
->
bÙtom
);

1147 
bufãr
 = 
	`g_¡rcÚÿt
(
¾_buf
, ",", 
¹_buf
, ";", 
¼_buf
, ",", 
rb_buf
, 
NULL
);

1149 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"rectangle", NULL);

1150 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"v®", (xmlCh¬ *)
bufãr
);

1152 
	`g_ä“
(
bufãr
);

1153 
	}
}

1160 
	$d©a_add_¡ršg
(
A‰ribu‹Node
 
©Œ
, cÚ¡ *
¡r
)

1162 
D©aNode
 
d©a_node
;

1163 
xmlCh¬
 *
esÿ³d_¡r
;

1164 
xmlCh¬
 *
sh¬³d_¡r
;

1166 ià(
¡r
==
NULL
) {

1167 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"string", (const xmlChar *)"##");

1171 
esÿ³d_¡r
 = 
	`xmlEncodeEÁ™›sR“Á¿Á
(
©Œ
->
doc
, (
xmlCh¬
 *è
¡r
);

1173 
sh¬³d_¡r
 = (
xmlCh¬
 *è
	`g_¡rcÚÿt
("#", (*è
esÿ³d_¡r
, "#", 
NULL
);

1175 
	`xmlF»e
(
esÿ³d_¡r
);

1177 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"¡ršg", (xmlCh¬ *è
sh¬³d_¡r
);

1179 
	`g_ä“
(
sh¬³d_¡r
);

1180 
	}
}

1188 
	$d©a_add_f’ame
(
D©aNode
 
d©a
, cÚ¡ *
¡r
)

1190 *
utf8
 = 
	`g_f’ame_to_utf8
(
¡r
, -1, 
NULL
, NULL, NULL);

1192 
	`d©a_add_¡ršg
(
d©a
, 
utf8
);

1194 
	`g_ä“
(
utf8
);

1195 
	}
}

1202 
	$d©a_add_fÚt
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
DŸFÚt
 *
fÚt
)

1204 
D©aNode
 
d©a_node
;

1205 
DŸFÚtStyË
 
¡yË
;

1206 
bufãr
[20+1];

1208 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"font", NULL);

1209 
¡yË
 = 
	`dŸ_fÚt_g‘_¡yË
 (
fÚt
);

1210 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"çmy", (xmlCh¬ *è
	`dŸ_fÚt_g‘_çmy
(
fÚt
));

1211 
	`g_¢´štf
(
bufãr
, 20, "%d", 
	`dŸ_fÚt_g‘_¡yË
(
fÚt
));

1213 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
bufãr
);

1215 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *è
	`dŸ_fÚt_g‘_Ëgacy_Çme
(
fÚt
));

1216 
	}
}

1223 
D©aNode


1224 
	$d©a_add_compos™e
(
A‰ribu‹Node
 
©Œ
, cÚ¡ *
ty³
)

1227 
D©aNode
 
d©a_node
;

1229 
d©a_node
 = 
	`xmlNewChd
(
©Œ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"composite", NULL);

1230 ià(
ty³
 !ğ
NULL
)

1231 
	`xmlS‘Prİ
(
d©a_node
, (cÚ¡ 
xmlCh¬
 *)"ty³", (xmlCh¬ *)
ty³
);

1233  
d©a_node
;

1234 
	}
}

1236 
	#BUFSIZE
 2048

	)

1237 
	#OVERRUN_SAFETY
 16

	)

1240 
	g´‘ty_fÜm©ed_xml
 = 
TRUE
;

1249 
	$xmlDŸSaveFe
(cÚ¡ *
f’ame
,

1250 
xmlDocPŒ
 
cur
)

1252 
Şd
 = 0, 
»t
;

1254 ià(
´‘ty_fÜm©ed_xml
)

1255 
Şd
 = 
	`xmlK“pBÏnksDeçuÉ
 (0);

1256 
»t
 = 
	`xmlSaveFÜm©FeEnc
 (
f’ame
,
cur
, "UTF-8", 
´‘ty_fÜm©ed_xml
 ? 1 : 0);

1257 ià(
´‘ty_fÜm©ed_xml
)

1258 
	`xmlK“pBÏnksDeçuÉ
 (
Şd
);

1259  
»t
;

1260 
	}
}

	@O:\tool\dvs50\lib\dia_xml.h

18 #iâdeà
DIA_XML_H


19 
	#DIA_XML_H


	)

21 
	~<glib.h
>

22 
	~"geom‘ry.h
"

23 
	~"cŞÜ.h
"

24 
	~"fÚt.h
"

25 
	~"dŸv¬.h
"

26 
	~<libxml/Œ“.h
>

39 
	#DIA_XML_NAME_SPACE_BASE
 "h‰p://www.ly§tÜ.liu.£/~®Ï/dŸ/"

	)

41 
DIAVAR
 
	g´‘ty_fÜm©ed_xml
;

43 
xmlNodePŒ
 
	tXML_NODE
;

45 
XML_NODE
 
	tObjeùNode
;

46 
XML_NODE
 
	tA‰ribu‹Node
;

47 
XML_NODE
 
	tD©aNode
;

50 
	mDATATYPE_COMPOSITE
,

51 
	mDATATYPE_INT
,

52 
	mDATATYPE_ENUM
,

53 
	mDATATYPE_REAL
,

54 
	mDATATYPE_BOOLEAN
,

55 
	mDATATYPE_COLOR
,

56 
	mDATATYPE_POINT
,

57 
	mDATATYPE_RECTANGLE
,

58 
	mDATATYPE_STRING
,

59 
	mDATATYPE_FONT
,

60 
	mDATATYPE_BEZPOINT
,

61 
	mDATATYPE_DICT


62 } 
	tD©aTy³
;

64 
DIAVAR
 
A‰ribu‹Node
 
çùÜy_fšd_cu¡om_node
(
ObjeùNode
 
obj_node
,cÚ¡ *
nod’ame
);

67 
DIAVAR
 
A‰ribu‹Node
 
objeù_fšd_©Œibu‹
(
ObjeùNode
 
obj_node
,

68 cÚ¡ *
©ŒÇme
);

69 
DIAVAR
 
A‰ribu‹Node
 
compos™e_fšd_©Œibu‹
(
D©aNode
 
compos™e_node
,

70 cÚ¡ *
©ŒÇme
);

71 
DIAVAR
 
©Œibu‹_num_d©a
(
A‰ribu‹Node
 
©Œibu‹
);

72 
DIAVAR
 
D©aNode
 
©Œibu‹_fœ¡_d©a
(
A‰ribu‹Node
 
©Œibu‹
);

73 
DIAVAR
 
D©aNode
 
d©a_Ãxt
(D©aNod
d©a
);

74 
D©aTy³
 
d©a_ty³
(
D©aNode
 
d©a
);

75 
DIAVAR
 
d©a_št
(
D©aNode
 
d©a
);

76 
DIAVAR
 
d©a_’um
(
D©aNode
 
d©a
);

77 
DIAVAR
 
»®
 
d©a_»®
(
D©aNode
 
d©a
);

78 
DIAVAR
 
d©a_boŞ—n
(
D©aNode
 
d©a
);

79 
DIAVAR
 
d©a_cŞÜ
(
D©aNode
 
d©a
, 
CŞÜ
 *
cŞ
);

80 
DIAVAR
 
d©a_pošt
(
D©aNode
 
d©a
, 
Pošt
 *
pošt
);

81 
DIAVAR
 
d©a_bezpošt
(
D©aNode
 
d©a
, 
BezPošt
 *
pošt
);

82 
d©a_»ùªgË
(
D©aNode
 
d©a
, 
ReùªgË
 *
»ù
);

83 
DIAVAR
 *
d©a_¡ršg
(
D©aNode
 
d©a
);

84 
DIAVAR
 *
d©a_f’ame
(
D©aNode
 
d©a
);

85 
DIAVAR
 
DŸFÚt
 *
d©a_fÚt
(
D©aNode
 
d©a
);

87 
DIAVAR
 
A‰ribu‹Node
 
Ãw_©Œibu‹
(
ObjeùNode
 
obj_node
, cÚ¡ *
©ŒÇme
);

88 
DIAVAR
 
A‰ribu‹Node
 
Ãw_cu¡om_©Œibu‹
(
ObjeùNode
 
obj_node
,cÚ¡ * 
cu¡omnode
,cÚ¡ *
©ŒÇme
);

89 
DIAVAR
 
A‰ribu‹Node
 
compos™e_add_©Œibu‹
(
D©aNode
 
compos™e_node
,

90 cÚ¡ *
©ŒÇme
);

91 
DIAVAR
 
d©a_add_št
(
A‰ribu‹Node
 
©Œ
, 
d©a
);

92 
DIAVAR
 
d©a_add_’um
(
A‰ribu‹Node
 
©Œ
, 
d©a
);

93 
DIAVAR
 
d©a_add_»®
(
A‰ribu‹Node
 
©Œ
, 
»®
 
d©a
);

94 
DIAVAR
 
d©a_add_boŞ—n
(
A‰ribu‹Node
 
©Œ
, 
d©a
);

95 
DIAVAR
 
d©a_add_cŞÜ
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
CŞÜ
 *
cŞ
);

96 
DIAVAR
 
d©a_add_pošt
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
Pošt
 *
pošt
);

97 
DIAVAR
 
d©a_add_bezpošt
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
BezPošt
 *
pošt
);

98 
d©a_add_»ùªgË
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
ReùªgË
 *
»ù
);

99 
DIAVAR
 
d©a_add_¡ršg
(
A‰ribu‹Node
 
©Œ
, cÚ¡ *
¡r
);

100 
DIAVAR
 
d©a_add_f’ame
(
A‰ribu‹Node
 
©Œ
, cÚ¡ *
¡r
);

101 
DIAVAR
 
d©a_add_fÚt
(
A‰ribu‹Node
 
©Œ
, cÚ¡ 
DŸFÚt
 *
fÚt
);

102 
DIAVAR
 
D©aNode
 
d©a_add_compos™e
(
A‰ribu‹Node
 
©Œ
,

103 cÚ¡ *
ty³
);

105 
GHashTabË
 *
d©a_diù
 (
D©aNode
 
d©a
);

106 
d©a_add_diù
 (
A‰ribu‹Node
 
©Œ
, 
GHashTabË
 *
d©a
);

	@O:\tool\dvs50\lib\dia_xml_libxml.h

21 #iâdeà
DIA_XML_LIBXML_H


22 
	#DIA_XML_LIBXML_H


	)

24 
	~<libxml/Œ“.h
>

25 
	~<libxml/·r£r.h
>

26 
	~"dŸv¬.h
"

29 
DIAVAR
 
xmlDocPŒ
 
xmlDŸP¬£Fe
(cÚ¡ *
f’ame
);

32 
DIAVAR
 
xmlDocPŒ
 
xmlDoP¬£Fe
(cÚ¡ *
f’ame
);

36 
DIAVAR
 
xmlDŸSaveFe
(cÚ¡ *
f’ame
,

37 
xmlDocPŒ
 
doc
);

	@O:\tool\dvs50\lib\diaarrowchooser.c

25 #undeà
GTK_DISABLE_DEPRECATED


27 
	~<gtk/gtk.h
>

28 
	~<cÚfig.h
>

29 
	~"š.h
"

30 
	~"widg‘s.h
"

31 
	~"dŸ¬rowchoo£r.h
"

32 
	~"»nd”_pixm­.h
"

34 cÚ¡ *
	gbu‰Ú_m’u_key
 = "dia-button-menu";

35 cÚ¡ *
	gm’u™em_’um_key
 = "dia-menuitem-value";

37 
gch¬
*

38 
	$_dŸ_Œª¦©e
 (cÚ¡ 
gch¬
* 
‹rm
, 
gpoš‹r
 
d©a
)

40 cÚ¡ 
gch¬
* 
Œªs
 = 
‹rm
;

42 ià(
‹rm
 && *term) {

44 
Œªs
 = 
	`dg‘‹xt
 (
GETTEXT_PACKAGE
, 
‹rm
);

46 ià(
‹rm
 =ğ
Œªs
)

47 
Œªs
 = 
	`dg‘‹xt
 ("gtk20", 
‹rm
);

50 ià(
‹rm
 =ğ
Œªs
) {

51 
gch¬
* 
kludge
 = 
	`g_¡rdup_´štf
 ("/%s", 
‹rm
);

52 
Œªs
 = 
	`dg‘‹xt
 (
GETTEXT_PACKAGE
, 
kludge
);

53 ià(
kludge
 =ğ
Œªs
)

54 
Œªs
 = 
‹rm
;

56 ++
Œªs
;

57 
	`g_ä“
 (
kludge
);

59 ià(
‹rm
 =ğ
Œªs
)

60 
Œªs
 = 
	`g_¡rdup_´štf
 ("XXX: %s", 
‹rm
);

63  
Œªs
;

64 
	}
}

67 
dŸ_¬row_´ev›w_£t
(
DŸA¼owP»v›w
 *
¬row
,

68 
A¼owTy³
 
©y³
, 
gboŞ—n
 
Ëá
);

70 
dŸ_¬row_´ev›w_şass_š™
 (
DŸA¼owP»v›wCÏss
 *
kÏss
);

71 
dŸ_¬row_´ev›w_š™
 (
DŸA¼owP»v›w
 *
¬row
);

72 
gšt
 
dŸ_¬row_´ev›w_expo£
 (
GtkWidg‘
 *
widg‘
,

73 
GdkEv’tExpo£
 *
ev’t
);

78 
GTy³


79 
	$dŸ_¬row_´ev›w_g‘_ty³
()

81 
GTy³
 
ty³
 = 0;

83 ià(!
ty³
) {

84 cÚ¡ 
GTy³Info
 
šfo
 = {

85  (
DŸA¼owP»v›wCÏss
),

86 (
GBa£In™Func
è
NULL
,

87 (
GBa£Fš®izeFunc
è
NULL
,

88 (
GCÏssIn™Func
è
dŸ_¬row_´ev›w_şass_š™
,

89 (
GCÏssFš®izeFunc
è
NULL
,

90 
NULL
,

91  (
DŸA¼owP»v›w
),

93 (
GIn¡ªûIn™Func
è
dŸ_¬row_´ev›w_š™


96 
ty³
 = 
	`g_ty³_»gi¡”_¡©ic
(
GTK_TYPE_MISC
, "DŸA¼owP»v›w", &
šfo
, 0);

99  
ty³
;

100 
	}
}

106 
	$dŸ_¬row_´ev›w_şass_š™
(
DŸA¼owP»v›wCÏss
 *
şass
)

108 
GtkWidg‘CÏss
 *
widg‘_şass
;

110 
widg‘_şass
 = 
	`GTK_WIDGET_CLASS
 (
şass
);

111 
widg‘_şass
->
expo£_ev’t
 = 
dŸ_¬row_´ev›w_expo£
;

112 
	}
}

118 
	$dŸ_¬row_´ev›w_š™
(
DŸA¼owP»v›w
 *
¬row
)

120 
	`GTK_WIDGET_SET_FLAGS
 (
¬row
, 
GTK_NO_WINDOW
);

122 
	`GTK_WIDGET
 (
¬row
)->
»quis™iÚ
.
width
 = 40 + 
	`GTK_MISC
 (¬row)->
x·d
 * 2;

123 
	`GTK_WIDGET
 (
¬row
)->
»quis™iÚ
.
height
 = 20 + 
	`GTK_MISC
 (¬row)->
y·d
 * 2;

125 
¬row
->
©y³
 = 
ARROW_NONE
;

126 
¬row
->
Ëá
 = 
TRUE
;

127 
	}
}

134 
GtkWidg‘
 *

135 
	$dŸ_¬row_´ev›w_Ãw
(
A¼owTy³
 
©y³
, 
gboŞ—n
 
Ëá
)

137 
DŸA¼owP»v›w
 *
¬row
 = 
	`g_objeù_Ãw
(
DIA_TYPE_ARROW_PREVIEW
, 
NULL
);

139 
¬row
->
©y³
 =‡type;

140 
¬row
->
Ëá
 =†eft;

141  
	`GTK_WIDGET
(
¬row
);

142 
	}
}

150 
	$dŸ_¬row_´ev›w_£t
(
DŸA¼owP»v›w
 *
¬row
, 
A¼owTy³
 
©y³
, 
gboŞ—n
 
Ëá
)

152 ià(
¬row
->
©y³
 !ğ©y³ ||‡¼ow->
Ëá
 !=†eft) {

153 
¬row
->
©y³
 =‡type;

154 
¬row
->
Ëá
 =†eft;

155 ià(
	`GTK_WIDGET_DRAWABLE
(
¬row
))

156 
	`gtk_widg‘_queue_d¿w
(
	`GTK_WIDGET
(
¬row
));

158 
	}
}

166 
gšt


167 
	$dŸ_¬row_´ev›w_expo£
(
GtkWidg‘
 *
widg‘
, 
GdkEv’tExpo£
 *
ev’t
)

169 ià(
	`GTK_WIDGET_DRAWABLE
(
widg‘
)) {

170 
Pošt
 
äom
, 
to
;

171 
Pošt
 
move_¬row
, 
move_lše
, 
¬row_h—d
;

172 
DŸR’d””
 *
»nd””
;

173 
DŸA¼owP»v›w
 *
¬row
 = 
	`DIA_ARROW_PREVIEW
(
widg‘
);

174 
A¼ow
 
¬row_ty³
;

175 
GtkMisc
 *
misc
 = 
	`GTK_MISC
(
widg‘
);

176 
gšt
 
width
, 
height
;

177 
gšt
 
x
, 
y
;

178 
GdkWšdow
 *
wš
;

179 
lšewidth
 = 2;

180 
DŸR’d””CÏss
 *
»nd””_İs
;

182 
width
 = 
widg‘
->
®loÿtiÚ
.width - 
misc
->
x·d
 * 2;

183 
height
 = 
widg‘
->
®loÿtiÚ
.heighˆ- 
misc
->
y·d
 * 2;

184 
x
 = (
widg‘
->
®loÿtiÚ
.x + 
misc
->
x·d
);

185 
y
 = (
widg‘
->
®loÿtiÚ
.y + 
misc
->
y·d
);

187 
wš
 = 
widg‘
->
wšdow
;

189 
to
.
y
 = 
äom
.y = 
height
/2;

190 ià(
¬row
->
Ëá
) {

191 
äom
.
x
 = 
width
-
lšewidth
;

192 
to
.
x
 = 0;

194 
äom
.
x
 = 0;

195 
to
.
x
 = 
width
-
lšewidth
;

201 
¬row_ty³
.
ty³
 = 
¬row
->
©y³
;

202 
¬row_ty³
.
Ëngth
 = .75*((
»®
)
height
-
lšewidth
);

203 
¬row_ty³
.
width
 = .75*((
»®
)
height
-
lšewidth
);

206 
	`ÿlcuÏ‹_¬row_pošt
(&
¬row_ty³
, &
äom
, &
to
,

207 &
move_¬row
, &
move_lše
,

208 
lšewidth
);

209 
¬row_h—d
 = 
to
;

210 
	`pošt_add
(&
¬row_h—d
, &
move_¬row
);

211 
	`pošt_add
(&
to
, &
move_lše
);

213 
»nd””
 = 
	`Ãw_pixm­_»nd””
(
wš
, 
width
, 
height
);

214 
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

215 
	`»nd””_pixm­_£t_pixm­
(
»nd””
, 
wš
, 
x
, 
y
, 
width
, 
height
);

216 
»nd””_İs
->
	`begš_»nd”
(
»nd””
);

217 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
lšewidth
);

219 
CŞÜ
 
cŞÜ_bg
, 
cŞÜ_fg
;

221 
GdkCŞÜ
 
bg
 = 
widg‘
->
¡yË
->
ba£
[
	`GTK_WIDGET_STATE
(widget)];

222 
GdkCŞÜ
 
fg
 = 
widg‘
->
¡yË
->
‹xt
[
	`GTK_WIDGET_STATE
(widget)];

224 
	`GDK_COLOR_TO_DIA
(
bg
, 
cŞÜ_bg
);

225 
	`GDK_COLOR_TO_DIA
(
fg
, 
cŞÜ_fg
);

226 
»nd””_İs
->
	`d¿w_lše
(
»nd””
, &
äom
, &
to
, &
cŞÜ_fg
);

227 
	`¬row_d¿w
 (
»nd””
, 
¬row_ty³
.
ty³
,

228 &
¬row_h—d
, &
äom
,

229 
¬row_ty³
.
Ëngth
,

230 
¬row_ty³
.
width
,

231 
lšewidth
, &
cŞÜ_fg
, &
cŞÜ_bg
);

233 
»nd””_İs
->
	`’d_»nd”
(
»nd””
);

234 
	`g_objeù_uÄef
(
»nd””
);

237  
TRUE
;

238 
	}
}

243 
dŸ_¬row_choo£r_şass_š™
 (
DŸA¼owChoo£rCÏss
 *
kÏss
);

244 
dŸ_¬row_choo£r_š™
 (
DŸA¼owChoo£r
 *
¬row
);

249 
GTy³


250 
	$dŸ_¬row_choo£r_g‘_ty³
()

252 
GTy³
 
ty³
 = 0;

254 ià(!
ty³
) {

255 cÚ¡ 
GTy³Info
 
šfo
 = {

256  (
DŸA¼owChoo£rCÏss
),

257 (
GBa£In™Func
è
NULL
,

258 (
GBa£Fš®izeFunc
è
NULL
,

259 (
GCÏssIn™Func
è
dŸ_¬row_choo£r_şass_š™
,

260 (
GCÏssFš®izeFunc
è
NULL
,

261 
NULL
,

262  (
DŸA¼owChoo£r
),

264 (
GIn¡ªûIn™Func
è
dŸ_¬row_choo£r_š™


267 
ty³
 = 
	`g_ty³_»gi¡”_¡©ic
(
GTK_TYPE_BUTTON
, "DŸA¼owChoo£r", &
šfo
, 0);

270  
ty³
;

271 
	}
}

279 
gšt


280 
	$dŸ_¬row_choo£r_ev’t
(
GtkWidg‘
 *
widg‘
, 
GdkEv’t
 *
ev’t
)

282 ià(
ev’t
->
ty³
 =ğ
GDK_BUTTON_PRESS
 &&ƒv’t->
bu‰Ú
.button == 1) {

283 
GtkM’u
 *
m’u
 = 
	`gtk_objeù_g‘_d©a
(
	`GTK_OBJECT
(
widg‘
), 
bu‰Ú_m’u_key
);

284 
	`gtk_m’u_pİup
(
m’u
, 
NULL
, NULL, NULL, NULL,

285 
ev’t
->
bu‰Ú
.bu‰Ú,ƒv’t->bu‰Ú.
time
);

286  
TRUE
;

289  
FALSE
;

290 
	}
}

296 
	$dŸ_¬row_choo£r_şass_š™
(
DŸA¼owChoo£rCÏss
 *
şass
)

298 
GtkWidg‘CÏss
 *
widg‘_şass
;

300 
widg‘_şass
 = 
	`GTK_WIDGET_CLASS
(
şass
);

301 
widg‘_şass
->
ev’t
 = 
dŸ_¬row_choo£r_ev’t
;

302 
	}
}

308 
	$dŸ_¬row_choo£r_š™
(
DŸA¼owChoo£r
 *
¬row
)

310 
GtkWidg‘
 *
wid
;

312 
¬row
->
Ëá
 = 
FALSE
;

313 
¬row
->¬row.
ty³
 = 
ARROW_NONE
;

314 
¬row
->¬row.
Ëngth
 = 
DEFAULT_ARROW_LENGTH
;

315 
¬row
->¬row.
width
 = 
DEFAULT_ARROW_WIDTH
;

317 
wid
 = 
	`dŸ_¬row_´ev›w_Ãw
(
ARROW_NONE
, 
¬row
->
Ëá
);

318 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
¬row
), 
wid
);

319 
	`gtk_widg‘_show
(
wid
);

320 
¬row
->
´ev›w
 = 
	`DIA_ARROW_PREVIEW
(
wid
);

322 
¬row
->
dŸlog
 = 
NULL
;

323 
	}
}

331 
	$dŸ_¬row_choo£r_dŸlog_»¥Ú£
(
GtkWidg‘
 *
dŸlog
,

332 
gšt
 
»¥Ú£_id
,

333 
DŸA¼owChoo£r
 *
choo£r
)

335 ià(
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
) {

336 
A¼ow
 
Ãw_¬row
 = 
	`dŸ_¬row_£ËùÜ_g‘_¬row
(
choo£r
->
£ËùÜ
);

338 ià(
Ãw_¬row
.
ty³
 !ğ
choo£r
->
¬row
.type ||

339 
Ãw_¬row
.
Ëngth
 !ğ
choo£r
->
¬row
.length ||

340 
Ãw_¬row
.
width
 !ğ
choo£r
->
¬row
.width) {

341 
choo£r
->
¬row
 = 
Ãw_¬row
;

342 
	`dŸ_¬row_´ev›w_£t
(
choo£r
->
´ev›w
, 
Ãw_¬row
.
ty³
, choo£r->
Ëá
);

343 ià(
choo£r
->
ÿÎback
)

344 (* 
choo£r
->
ÿÎback
)(choo£r->
¬row
, choo£r->
u£r_d©a
);

347 
	`dŸ_¬row_£ËùÜ_£t_¬row
(
choo£r
->
£ËùÜ
, choo£r->
¬row
);

349 
	`gtk_widg‘_hide
(
choo£r
->
dŸlog
);

350 
	}
}

357 
	$dŸ_¬row_choo£r_dŸlog_Ãw
(
DŸA¼owChoo£r
 *
choo£r
)

359 
GtkWidg‘
 *
wid
;

361 
choo£r
->
dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(
	`_
("Arrow Properties"),

362 
NULL
,

363 
GTK_DIALOG_NO_SEPARATOR
,

364 
GTK_STOCK_CANCEL
,

365 
GTK_RESPONSE_CANCEL
,

366 
GTK_STOCK_OK
,

367 
GTK_RESPONSE_OK
,

368 
NULL
);

369 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
	`GTK_DIALOG
(
choo£r
->
dŸlog
),

370 
GTK_RESPONSE_OK
);

371 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
choo£r
->
dŸlog
), "response",

372 
	`G_CALLBACK
(
dŸ_¬row_choo£r_dŸlog_»¥Ú£
), 
choo£r
);

373 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
choo£r
->
dŸlog
), "destroy",

374 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
choo£r
->
dŸlog
);

376 
wid
 = 
	`dŸ_¬row_£ËùÜ_Ãw
();

377 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
wid
), 5);

378 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
	`GTK_DIALOG
(
choo£r
->
dŸlog
)->
vbox
), 
wid
,

379 
TRUE
, TRUE, 0);

380 
	`gtk_widg‘_show
(
wid
);

381 
choo£r
->
£ËùÜ
 = 
	`DIA_ARROW_SELECTOR
(
wid
);

382 
	}
}

390 
	$dŸ_¬row_choo£r_dŸlog_show
(
GtkWidg‘
 *
widg‘
, 
DŸA¼owChoo£r
 *
choo£r
)

392 ià(
choo£r
->
dŸlog
) {

393 
	`gtk_wšdow_´e£Á
(
	`GTK_WINDOW
(
choo£r
->
dŸlog
));

397 
	`dŸ_¬row_choo£r_dŸlog_Ãw
(
choo£r
);

398 
	`dŸ_¬row_£ËùÜ_£t_¬row
(
choo£r
->
£ËùÜ
, choo£r->
¬row
);

399 
	`gtk_widg‘_show
(
choo£r
->
dŸlog
);

400 
	}
}

407 
	$dŸ_¬row_choo£r_chªge_¬row_ty³
(
GtkM’uI‹m
 *
mi
, 
DŸA¼owChoo£r
 *
choo£r
)

409 
A¼owTy³
 
©y³
 = 
	`GPOINTER_TO_INT
(
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
mi
),

410 
m’u™em_’um_key
));

411 
A¼ow
 
¬row
;

412 
¬row
.
width
 = 
choo£r
->arrow.width;

413 
¬row
.
Ëngth
 = 
choo£r
->arrow.length;

414 
¬row
.
ty³
 = 
©y³
;

415 
	`dŸ_¬row_choo£r_£t_¬row
(
choo£r
, &
¬row
);

416 
	}
}

426 
GtkWidg‘
 *

427 
	$dŸ_¬row_choo£r_Ãw
(
gboŞ—n
 
Ëá
, 
DŸChªgeA¼owC®lback
 
ÿÎback
,

428 
gpoš‹r
 
u£r_d©a
, 
GtkToŞts
 *
toŞ_ts
)

430 
DŸA¼owChoo£r
 *
choo£r
 = 
	`g_objeù_Ãw
(
DIA_TYPE_ARROW_CHOOSER
, 
NULL
);

431 
GtkWidg‘
 *
m’u
, *
mi
, *
¬
;

432 
gšt
 
i
;

434 
choo£r
->
Ëá
 =†eft;

435 
	`dŸ_¬row_´ev›w_£t
(
choo£r
->
´ev›w
, choo£r->´ev›w->
©y³
, 
Ëá
);

436 
choo£r
->
ÿÎback
 = callback;

437 
choo£r
->
u£r_d©a
 = user_data;

439 
m’u
 = 
	`gtk_m’u_Ãw
();

440 
	`g_objeù_»f
(
	`G_OBJECT
(
m’u
));

441 
	`gtk_objeù_sšk
(
	`GTK_OBJECT
(
m’u
));

442 
	`g_objeù_£t_d©a_fuÎ
(
	`G_OBJECT
(
choo£r
), 
bu‰Ú_m’u_key
, 
m’u
,

443 (
GtkDe¡royNÙify
)
gtk_widg‘_uÄef
);

445 
i
 = 
ARROW_NONE
; i < 
MAX_ARROW_TYPE
; ++i) {

446 
A¼owTy³
 
¬row_ty³
 = 
	`¬row_ty³_äom_šdex
(
i
);

447 
mi
 = 
	`gtk_m’u_™em_Ãw
();

448 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
mi
), 
m’u™em_’um_key
,

449 
	`GINT_TO_POINTER
(
¬row_ty³
));

450 ià(
toŞ_ts
) {

451 
	`gtk_toŞts_£t_t
(
toŞ_ts
, 
mi
, 
	`_dŸ_Œª¦©e
(
	`¬row_g‘_Çme_äom_ty³
(
¬row_ty³
), 
NULL
), NULL);

453 
¬
 = 
	`dŸ_¬row_´ev›w_Ãw
(
¬row_ty³
, 
Ëá
);

455 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
mi
), 
¬
);

456 
	`gtk_widg‘_show
(
¬
);

457 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
mi
), "activate",

458 
	`G_CALLBACK
(
dŸ_¬row_choo£r_chªge_¬row_ty³
), 
choo£r
);

459 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
mi
);

460 
	`gtk_widg‘_show
(
mi
);

462 
mi
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
	`_dŸ_Œª¦©e
("D‘as...", 
NULL
));

463 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
mi
), "activate",

464 
	`G_CALLBACK
(
dŸ_¬row_choo£r_dŸlog_show
), 
choo£r
);

465 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
mi
);

466 
	`gtk_widg‘_show
(
mi
);

468  
	`GTK_WIDGET
(
choo£r
);

469 
	}
}

478 
	$dŸ_¬row_choo£r_£t_¬row
(
DŸA¼owChoo£r
 *
choo£r
, 
A¼ow
 *
¬row
)

480 ià(
choo£r
->
¬row
.
ty³
 !=‡rrow->type) {

481 
	`dŸ_¬row_´ev›w_£t
(
choo£r
->
´ev›w
, 
¬row
->
ty³
, choo£r->
Ëá
);

482 
choo£r
->
¬row
.
ty³
 =‡rrow->type;

483 ià(
choo£r
->
dŸlog
 !ğ
NULL
)

484 
	`dŸ_¬row_£ËùÜ_£t_¬row
(
choo£r
->
£ËùÜ
, choo£r->
¬row
);

485 ià(
choo£r
->
ÿÎback
)

486 (* 
choo£r
->
ÿÎback
)(choo£r->
¬row
, choo£r->
u£r_d©a
);

488 
choo£r
->
¬row
.
width
 =‡rrow->width;

489 
choo£r
->
¬row
.
Ëngth
 =‡rrow->length;

490 
	}
}

496 
A¼owTy³


497 
	$dŸ_¬row_choo£r_g‘_¬row_ty³
(
DŸA¼owChoo£r
 *
¬row
)

499  
¬row
->¬row.
ty³
;

500 
	}
}

	@O:\tool\dvs50\lib\diaarrowchooser.h

22 #iâdeà
_DIAARROWCHOOSER_H_


23 
	#_DIAARROWCHOOSER_H_


	)

25 
	~<gtk/gtk.h
>

27 
	~"¬rows.h
"

28 
	~"dŸty³s.h
"

32 
GTy³
 
dŸ_¬row_´ev›w_g‘_ty³
 ();

34 
	#DIA_TYPE_ARROW_PREVIEW
 (
	`dŸ_¬row_´ev›w_g‘_ty³
 ())

	)

35 
	#DIA_ARROW_PREVIEW
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_ARROW_PREVIEW
, 
DŸA¼owP»v›w
))

	)

36 
	#DIA_ARROW_PREVIEW_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_ARROW_PREVIEW
, 
DŸA¼owP»v›wCÏss
))

	)

37 
	#DIA_IS_ARROW_PREVIEW
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_ARROW_PREVIEW
))

	)

38 
	#DIA_IS_ARROW_PREVIEW_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kÏss), 
DIA_TYPE_ARROW_PREVIEW
))

	)

39 
	#DIA_ARROW_PREVIEW_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_ARROW_PREVIEW
, 
DŸA¼owP»v›wCÏss
))

	)

41 
_DŸA¼owP»v›w
 
	tDŸA¼owP»v›w
;

42 
_DŸA¼owP»v›wCÏss
 
	tDŸA¼owP»v›wCÏss
;

44 
	s_DŸA¼owP»v›w


46 
GtkMisc
 
	mmisc
;

47 
A¼owTy³
 
	m©y³
;

48 
gboŞ—n
 
	mËá
;

51 
	s_DŸA¼owP»v›wCÏss


53 
GtkMiscCÏss
 
	m·»Á_şass
;

56 
GtkWidg‘
 *
dŸ_¬row_´ev›w_Ãw
 (
A¼owTy³
 
©y³
, 
gboŞ—n
 
Ëá
);

60 
DIAVAR
 
GTy³
 
dŸ_¬row_choo£r_g‘_ty³
 ();

62 
	#DIA_TYPE_ARROW_CHOOSER
 (
	`dŸ_¬row_choo£r_g‘_ty³
 ())

	)

63 
	#DIA_ARROW_CHOOSER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_ARROW_CHOOSER
, 
DŸA¼owChoo£r
))

	)

64 
	#DIA_ARROW_CHOOSER_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_ARROW_CHOOSER
, 
DŸA¼owChoo£rCÏss
))

	)

65 
	#DIA_IS_ARROW_CHOOSER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_ARROW_CHOOSER
))

	)

66 
	#DIA_IS_ARROW_CHOOSER_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kÏss), 
DIA_TYPE_ARROW_CHOOSER
))

	)

67 
	#DIA_ARROW_CHOOSER_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_ARROW_CHOOSER
, 
DŸA¼owChoo£rCÏss
))

	)

69 
_DŸA¼owChoo£r
 
	tDŸA¼owChoo£r
;

70 
_DŸA¼owChoo£rCÏss
 
	tDŸA¼owChoo£rCÏss
;

72 (*
	tDŸChªgeA¼owC®lback
è(
	tA¼ow
 
	t©y³
, 
	tgpoš‹r
 
	tu£r_d©a
);

74 
	s_DŸA¼owChoo£r


76 
GtkBu‰Ú
 
bu‰Ú
;

77 
DŸA¼owP»v›w
 *
´ev›w
;

78 
A¼ow
 
¬row
;

79 
gboŞ—n
 
Ëá
;

81 
DŸChªgeA¼owC®lback
 
ÿÎback
;

82 
gpoš‹r
 
u£r_d©a
;

84 
GtkWidg‘
 *
dŸlog
;

85 
DŸA¼owS–eùÜ
 *
£ËùÜ
;

88 
	s_DŸA¼owChoo£rCÏss


90 
GtkBu‰ÚCÏss
 
·»Á_şass
;

93 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_¬row_choo£r_Ãw
 (
gboŞ—n
 
Ëá
,

94 
DŸChªgeA¼owC®lback
 
ÿÎback
,

95 
gpoš‹r
 
u£r_d©a
,

96 #iâdeà
GTK_DISABLE_DEPRECATED


97 
GtkToŞts
 *
toŞ_ts


99 
gpoš‹r
 
toŞ_ts


102 
DIAVAR
 
	`dŸ_¬row_choo£r_£t_¬row
(
DŸA¼owChoo£r
 *
choo£r
, 
A¼ow
 *
¬row
);

103 
DIAVAR
 
A¼owTy³
 
	`dŸ_¬row_choo£r_g‘_¬row_ty³
(
DŸA¼owChoo£r
 *
choo£r
);

	@O:\tool\dvs50\lib\diacellrendererproperty.c

26 
	~<cÚfig.h
>

28 
	~<gtk/gtk.h
>

30 
	~"dŸûÎ»nd””´İ”ty.h
"

32 
	~"dŸ»nd””.h
"

33 
	~"dŸm¬sh®.h
"

34 
	~"mes§ge.h
"

38 
	mCLICKED
,

39 
	mLAST_SIGNAL


44 
	mPROP_0
,

45 
	mPROP_RENDERER
,

46 
	mPROP_PROPERTY


49 
dŸ_ûÎ_»nd””_´İ”ty_fš®ize
 (
GObjeù
 *
objeù
);

50 
dŸ_ûÎ_»nd””_´İ”ty_g‘_´İ”ty
 (
GObjeù
 *
objeù
,

51 
gušt
 
·¿m_id
,

52 
GV®ue
 *
v®ue
,

53 
GP¬amS³c
 *
p¥ec
);

54 
dŸ_ûÎ_»nd””_´İ”ty_£t_´İ”ty
 (
GObjeù
 *
objeù
,

55 
gušt
 
·¿m_id
,

56 cÚ¡ 
GV®ue
 *
v®ue
,

57 
GP¬amS³c
 *
p¥ec
);

58 
dŸ_ûÎ_»nd””_´İ”ty_g‘_size
 (
GtkC–lR’d””
 *
ûÎ
,

59 
GtkWidg‘
 *
widg‘
,

60 
GdkReùªgË
 *
»ùªgË
,

61 
gšt
 *
x_off£t
,

62 
gšt
 *
y_off£t
,

63 
gšt
 *
width
,

64 
gšt
 *
height
);

65 
dŸ_ûÎ_»nd””_´İ”ty_»nd”
 (
GtkC–lR’d””
 *
ûÎ
,

66 
GdkWšdow
 *
wšdow
,

67 
GtkWidg‘
 *
widg‘
,

68 
GdkReùªgË
 *
background_¬—
,

69 
GdkReùªgË
 *
ûÎ_¬—
,

70 
GdkReùªgË
 *
expo£_¬—
,

71 
GtkC–lR’d””S‹
 
æags
);

72 
gboŞ—n
 
dŸ_ûÎ_»nd””_´İ”ty_aùiv©e
 (
GtkC–lR’d””
 *
ûÎ
,

73 
GdkEv’t
 *
ev’t
,

74 
GtkWidg‘
 *
widg‘
,

75 cÚ¡ 
gch¬
 *
·th
,

76 
GdkReùªgË
 *
background_¬—
,

77 
GdkReùªgË
 *
ûÎ_¬—
,

78 
GtkC–lR’d””S‹
 
æags
);

81 
	$G_DEFINE_TYPE
 (
DŸC–lR’d””Prİ”ty
, 
dŸ_ûÎ_»nd””_´İ”ty
, 
GTK_TYPE_CELL_RENDERER
)

83 
	#·»Á_şass
 
dŸ_ûÎ_»nd””_´İ”ty_·»Á_şass


	)

85 
gušt
 
´İ”ty_ûÎ_sigÇls
[
LAST_SIGNAL
] = { 0 
	}
};

89 
	$dŸ_ûÎ_»nd””_´İ”ty_şass_š™
 (
DŸC–lR’d””Prİ”tyCÏss
 *
kÏss
)

91 
GObjeùCÏss
 *
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
kÏss
);

92 
GtkC–lR’d””CÏss
 *
ûÎ_şass
 = 
	`GTK_CELL_RENDERER_CLASS
 (
kÏss
);

94 
´İ”ty_ûÎ_sigÇls
[
CLICKED
] =

95 
	`g_sigÇl_Ãw
 ("clicked",

96 
	`G_OBJECT_CLASS_TYPE
 (
objeù_şass
),

97 
G_SIGNAL_RUN_LAST
,

98 
	`G_STRUCT_OFFSET
 (
DŸC–lR’d””Prİ”tyCÏss
, 
şicked
),

99 
NULL
, NULL,

100 
dŸ_m¬sh®_VOID__STRING_FLAGS
,

101 
G_TYPE_NONE
, 2,

102 
G_TYPE_STRING
,

103 
GDK_TYPE_MODIFIER_TYPE
);

105 
objeù_şass
->
fš®ize
 = 
dŸ_ûÎ_»nd””_´İ”ty_fš®ize
;

106 
objeù_şass
->
g‘_´İ”ty
 = 
dŸ_ûÎ_»nd””_´İ”ty_g‘_´İ”ty
;

107 
objeù_şass
->
£t_´İ”ty
 = 
dŸ_ûÎ_»nd””_´İ”ty_£t_´İ”ty
;

109 
ûÎ_şass
->
g‘_size
 = 
dŸ_ûÎ_»nd””_´İ”ty_g‘_size
;

110 
ûÎ_şass
->
»nd”
 = 
dŸ_ûÎ_»nd””_´İ”ty_»nd”
;

111 
ûÎ_şass
->
aùiv©e
 = 
dŸ_ûÎ_»nd””_´İ”ty_aùiv©e
;

113 
kÏss
->
şicked
 = 
NULL
;

115 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
, 
PROP_RENDERER
,

116 
	`g_·¿m_¥ec_objeù
 ("renderer",

117 
NULL
, NULL,

118 
DIA_TYPE_RENDERER
,

119 
G_PARAM_READWRITE
));

120 
	`g_objeù_şass_š¡®l_´İ”ty
 (
objeù_şass
, 
PROP_PROPERTY
,

121 
	`g_·¿m_¥ec_objeù
 ("property",

122 
NULL
, NULL,

123 
DIA_TYPE_RENDERER
,

124 
G_PARAM_READWRITE
));

125 
	}
}

128 
	$dŸ_ûÎ_»nd””_´İ”ty_š™
 (
DŸC–lR’d””Prİ”ty
 *
ûÎ´İ”ty
)

130 
	`GTK_CELL_RENDERER
 (
ûÎ´İ”ty
)->
mode
 = 
GTK_CELL_RENDERER_MODE_ACTIVATABLE
;

131 
	}
}

134 
	$dŸ_ûÎ_»nd””_´İ”ty_fš®ize
 (
GObjeù
 *
objeù
)

136 
DŸC–lR’d””Prİ”ty
 *
ûÎ
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
objeù
);

138 ià(
ûÎ
->
»nd””
)

140 
	`g_objeù_uÄef
 (
ûÎ
->
»nd””
);

141 
ûÎ
->
»nd””
 = 
NULL
;

144 
	`G_OBJECT_CLASS
 (
·»Á_şass
)->
	`fš®ize
 (
objeù
);

145 
	}
}

148 
	$dŸ_ûÎ_»nd””_´İ”ty_g‘_´İ”ty
 (
GObjeù
 *
objeù
,

149 
gušt
 
·¿m_id
,

150 
GV®ue
 *
v®ue
,

151 
GP¬amS³c
 *
p¥ec
)

153 
DŸC–lR’d””Prİ”ty
 *
ûÎ
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
objeù
);

155 
·¿m_id
)

157 
PROP_RENDERER
:

158 
	`g_v®ue_£t_objeù
 (
v®ue
, 
ûÎ
->
»nd””
);

162 
	`G_OBJECT_WARN_INVALID_PROPERTY_ID
 (
objeù
, 
·¿m_id
, 
p¥ec
);

165 
	}
}

168 
	$dŸ_ûÎ_»nd””_´İ”ty_£t_´İ”ty
 (
GObjeù
 *
objeù
,

169 
gušt
 
·¿m_id
,

170 cÚ¡ 
GV®ue
 *
v®ue
,

171 
GP¬amS³c
 *
p¥ec
)

173 
DŸC–lR’d””Prİ”ty
 *
ûÎ
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
objeù
);

175 
·¿m_id
)

177 
PROP_RENDERER
:

179 
DŸR’d””
 *
»nd””
;

181 
»nd””
 = (
DŸR’d””
 *è
	`g_v®ue_dup_objeù
 (
v®ue
);

182 ià(
ûÎ
->
»nd””
)

183 
	`g_objeù_uÄef
 (
ûÎ
->
»nd””
);

184 
ûÎ
->
»nd””
 =„enderer;

189 
	`G_OBJECT_WARN_INVALID_PROPERTY_ID
 (
objeù
, 
·¿m_id
, 
p¥ec
);

192 
	}
}

195 
	$dŸ_ûÎ_»nd””_´İ”ty_g‘_size
 (
GtkC–lR’d””
 *
ûÎ
,

196 
GtkWidg‘
 *
widg‘
,

197 
GdkReùªgË
 *
ûÎ_¬—
,

198 
gšt
 *
x_off£t
,

199 
gšt
 *
y_off£t
,

200 
gšt
 *
width
,

201 
gšt
 *
height
)

203 
DŸC–lR’d””Prİ”ty
 *
ûÎ´İ”ty
;

204 
gšt
 
v›w_width
 = 0;

205 
gšt
 
v›w_height
 = 0;

206 
gšt
 
ÿlc_width
;

207 
gšt
 
ÿlc_height
;

210 
ûÎ´İ”ty
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
ûÎ
);

212 ià(
ûÎ´İ”ty
->
»nd””
)

214 
v›w_width
 = (
ûÎ´İ”ty
->
»nd””
->
width
 +

215 2 * 
ûÎ´İ”ty
->
»nd””
->
bÜd”_width
);

216 
v›w_height
 = (
ûÎ´İ”ty
->
»nd””
->
height
 +

217 2 * 
ûÎ´İ”ty
->
»nd””
->
bÜd”_width
);

221 
v›w_width
 = 120;

222 
v›w_height
 = 30;

225 
ÿlc_width
 = (
gšt
è
ûÎ
->
x·d
 * 2 + 
v›w_width
;

226 
ÿlc_height
 = (
gšt
è
ûÎ
->
y·d
 * 2 + 
v›w_height
;

228 ià(
x_off£t
) *x_offset = 0;

229 ià(
y_off£t
) *y_offset = 0;

231 ià(
ûÎ_¬—
 && 
v›w_width
 > 0 && 
v›w_height
 > 0)

233 ià(
x_off£t
)

235 *
x_off£t
 = (((
	`gtk_widg‘_g‘_dœeùiÚ
 (
widg‘
è=ğ
GTK_TEXT_DIR_RTL
) ?

236 1.0 - 
ûÎ
->
x®ign
 : cell->xalign) *

237 (
ûÎ_¬—
->
width
 - 
ÿlc_width
 - 2 * 
ûÎ
->
x·d
));

238 *
x_off£t
 = (
	`MAX
 (*x_off£t, 0è+ 
ûÎ
->
x·d
);

240 ià(
y_off£t
)

242 *
y_off£t
 = (
ûÎ
->
y®ign
 *

243 (
ûÎ_¬—
->
height
 - 
ÿlc_height
 - 2 * 
ûÎ
->
y·d
));

244 *
y_off£t
 = (
	`MAX
 (*y_off£t, 0è+ 
ûÎ
->
y·d
);

248 ià(
width
è*width = 
ÿlc_width
;

249 ià(
height
è*heighˆğ
ÿlc_height
;

250 
	}
}

253 
	$dŸ_ûÎ_»nd””_´İ”ty_»nd”
 (
GtkC–lR’d””
 *
ûÎ
,

254 
GdkWšdow
 *
wšdow
,

255 
GtkWidg‘
 *
widg‘
,

256 
GdkReùªgË
 *
background_¬—
,

257 
GdkReùªgË
 *
ûÎ_¬—
,

258 
GdkReùªgË
 *
expo£_¬—
,

259 
GtkC–lR’d””S‹
 
æags
)

261 
DŸC–lR’d””Prİ”ty
 *
ûÎ´İ”ty
;

263 
ûÎ´İ”ty
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
ûÎ
);

265 ià(
ûÎ´İ”ty
->
»nd””
)

267 ià(! (
æags
 & 
GTK_CELL_RENDERER_SELECTED
))

270 
	`dŸ_v›w_»nd””_»move_idË
 (
ûÎ´İ”ty
->
»nd””
);

274 
	`dŸ_v›w_»nd””_d¿w
 (
ûÎ´İ”ty
->
»nd””
, 
wšdow
, 
widg‘
,

275 
ûÎ_¬—
, 
expo£_¬—
);

278 
	}
}

280 
gboŞ—n


281 
	$dŸ_ûÎ_»nd””_´İ”ty_aùiv©e
 (
GtkC–lR’d””
 *
ûÎ
,

282 
GdkEv’t
 *
ev’t
,

283 
GtkWidg‘
 *
widg‘
,

284 cÚ¡ 
gch¬
 *
·th
,

285 
GdkReùªgË
 *
background_¬—
,

286 
GdkReùªgË
 *
ûÎ_¬—
,

287 
GtkC–lR’d””S‹
 
æags
)

289 
DŸC–lR’d””Prİ”ty
 *
ûÎ´İ”ty
;

291 
ûÎ´İ”ty
 = 
	`DIA_CELL_RENDERER_PROPERTY
 (
ûÎ
);

293 ià(
ûÎ´İ”ty
->
»nd””
)

295 
GdkModif›rTy³
 
¡©e
 = 0;

297 ià(
ev’t
 && ((
GdkEv’tAny
 *èev’t)->
ty³
 =ğ
GDK_BUTTON_PRESS
)

298 
¡©e
 = ((
GdkEv’tBu‰Ú
 *è
ev’t
)->state;

300 ià(! 
ev’t
 ||

301 (((
GdkEv’tAny
 *è
ev’t
)->
ty³
 =ğ
GDK_BUTTON_PRESS
 &&

302 ((
GdkEv’tBu‰Ú
 *è
ev’t
)->
bu‰Ú
 == 1))

304 
	`dŸ_ûÎ_»nd””_´İ”ty_şicked
 (
ûÎ´İ”ty
, 
·th
, 
¡©e
);

306  
TRUE
;

310  
FALSE
;

311 
	}
}

313 
GtkC–lR’d””
 *

314 
	$dŸ_ûÎ_»nd””_´İ”ty_Ãw
 ()

316  
	`g_objeù_Ãw
 (
DIA_TYPE_CELL_RENDERER_PROPERTY
, 
NULL
);

317 
	}
}

320 
	$dŸ_ûÎ_»nd””_´İ”ty_şicked
 (
DŸC–lR’d””Prİ”ty
 *
ûÎ
,

321 cÚ¡ 
gch¬
 *
·th
,

322 
GdkModif›rTy³
 
¡©e
)

324 
GdkEv’t
 *
ev’t
;

326 
	`g_»tuº_if_ç
 (
	`DIA_IS_CELL_RENDERER_PROPERTY
 (
ûÎ
));

327 
	`g_»tuº_if_ç
 (
·th
 !ğ
NULL
);

329 
	`g_sigÇl_em™
 (
ûÎ
, 
´İ”ty_ûÎ_sigÇls
[
CLICKED
], 0, 
·th
, 
¡©e
);

331 
ev’t
 = 
	`gtk_g‘_cu¼’t_ev’t
 ();

333 ià(
ev’t
)

335 
GdkEv’tBu‰Ú
 *
bev’t
 = (GdkEv’tBu‰Ú *è
ev’t
;

337 ià(
bev’t
->
ty³
 =ğ
GDK_BUTTON_PRESS
 &&

338 (
bev’t
->
bu‰Ú
 == 1 || bevent->button == 2))

341 
	`dŸ_v›w_pİup_show
 (
	`gtk_g‘_ev’t_widg‘
 (
ev’t
),

342 
bev’t
,

343 
ûÎ
->
»nd””
->
cÚ‹xt
,

344 
ûÎ
->
»nd””
->
´İ”ty
,

345 
ûÎ
->
»nd””
->
width
,

346 
ûÎ
->
»nd””
->
height
,

347 
ûÎ
->
»nd””
->
dÙ_fÜ_dÙ
);

350 
	`mes§ge_w¬nšg
 ("Clicked!");

354 
	`gdk_ev’t_ä“
 (
ev’t
);

356 
	}
}

	@O:\tool\dvs50\lib\diacellrendererproperty.h

25 #iâdeà
__DIA_CELL_RENDERER_PROPERTY_H__


26 
	#__DIA_CELL_RENDERER_PROPERTY_H__


	)

29 
	~<gtk/gtkûÎ»nd””.h
>

30 
	~"dŸty³s.h
"

32 
	#DIA_TYPE_CELL_RENDERER_PROPERTY
 (
	`dŸ_ûÎ_»nd””_´İ”ty_g‘_ty³
 ())

	)

33 
	#DIA_CELL_RENDERER_PROPERTY
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_CELL_RENDERER_PROPERTY
, 
DŸC–lR’d””Prİ”ty
))

	)

34 
	#DIA_CELL_RENDERER_PROPERTY_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_CELL_RENDERER_PROPERTY
, 
DŸC–lR’d””Prİ”tyCÏss
))

	)

35 
	#DIA_IS_CELL_RENDERER_PROPERTY
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_CELL_RENDERER_PROPERTY
))

	)

36 
	#DIA_IS_CELL_RENDERER_PROPERTY_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kÏss), 
DIA_TYPE_CELL_RENDERER_PROPERTY
))

	)

37 
	#DIA_CELL_RENDERER_PROPERTY_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_CELL_RENDERER_PROPERTY
, 
DŸC–lR’d””Prİ”tyCÏss
))

	)

40 
_DŸC–lR’d””Prİ”tyCÏss
 
	tDŸC–lR’d””Prİ”tyCÏss
;

42 
	s_DŸC–lR’d””Prİ”ty


44 
GtkC–lR’d””
 
	m·»Á_š¡ªû
;

47 
DŸR’d””
 *
	m»nd””
;

50 
	s_DŸC–lR’d””Prİ”tyCÏss


52 
GtkC–lR’d””CÏss
 
	m·»Á_şass
;

54 (* 
	mşicked
è(
DŸC–lR’d””Prİ”ty
 *
	mûÎ
,

55 cÚ¡ 
gch¬
 *
	m·th
,

56 
GdkModif›rTy³
 
	m¡©e
);

60 
GTy³
 
	$dŸ_ûÎ_»nd””_´İ”ty_g‘_ty³
 (è
G_GNUC_CONST
;

62 
GtkC–lR’d””
 * 
	`dŸ_ûÎ_»nd””_´İ”ty_Ãw
 ();

64 
	`dŸ_ûÎ_»nd””_´İ”ty_şicked
 (
DŸC–lR’d””Prİ”ty
 *
ûÎ
,

65 cÚ¡ 
gch¬
 *
·th
,

66 
GdkModif›rTy³
 
¡©e
);

	@O:\tool\dvs50\lib\diaerror.c

19 
	~"dŸ”rÜ.h
"

26 
GQu¬k


27 
	$dŸ_”rÜ_qu¬k
()

29 
GQu¬k
 
q
 = 0;

30 ià(!
q
)

31 
q
 = 
	`g_qu¬k_äom_¡©ic_¡ršg
("dia-error-quark");

32  
q
;

33 
	}
}

	@O:\tool\dvs50\lib\diaerror.h

19 #iâdeà
DIA_ERROR_H


20 
	#DIA_ERROR_H


	)

22 
	~<glib.h
>

23 
	~<gmoduË.h
>

24 
	~"dŸv¬.h
"

28 
	#DIA_ERROR
 
	`dŸ_”rÜ_qu¬k
 ()

	)

33 
	mDIA_ERROR_FORMAT
,

34 
	mDIA_ERROR_FILE
,

35 
	mDIA_ERROR_DIRECTORY
,

36 } 
	tDŸE¼Ü
;

38 
	$__deş¥ec
(
dÎexpÜt
è
GQu¬k
 
	`dŸ_”rÜ_qu¬k
 ();

	@O:\tool\dvs50\lib\diagdkrenderer.c

22 
	~<cÚfig.h
>

24 
	~<m©h.h
>

25 
	~<¡dlib.h
>

26 
	~<¡ršg.h
>

27 
	~<gdk/gdk.h
>

29 
	#PANGO_ENABLE_ENGINE


	)

30 
	~<·ngo/·ngo-’gše.h
>

31 
	~<·ngo/·ngo.h
>

33 
	~"dŸgdk»nd””.h
"

34 
	~"dŸ_image.h
"

35 
	~"mes§ge.h
"

36 
	~"cŞÜ.h
"

37 
	~"fÚt.h
"

38 
	~"‹xt.h
"

39 
	~"objeù.h
"

40 
	~"‹xše.h
"

42 
	~"time.h
"

44 #ifdeà
HAVE_FREETYPE


45 
	~<·ngo/·ngo.h
>

46 
	~<·ngo/·ngoá2.h
>

49 
g‘_width_pix–s
 (
DŸR’d””
 *);

50 
g‘_height_pix–s
 (
DŸR’d””
 *);

52 
begš_»nd”
 (
DŸR’d””
 *);

53 
’d_»nd”
 (
DŸR’d””
 *);

55 
£t_lšewidth
 (
DŸR’d””
 *
»nd””
, 
»®
 
lšewidth
);

56 
£t_lšeÿps
 (
DŸR’d””
 *
»nd””
, 
LšeC­s
 
mode
);

57 
£t_lšejoš
 (
DŸR’d””
 *
»nd””
, 
LšeJoš
 
mode
);

58 
£t_lše¡yË
 (
DŸR’d””
 *
»nd””
, 
LšeStyË
 
mode
);

59 
£t_dashËngth
 (
DŸR’d””
 *
»nd””
, 
»®
 
Ëngth
);

60 
£t_fl¡yË
 (
DŸR’d””
 *
»nd””
, 
FlStyË
 
mode
);

62 
d¿w_lše
 (
DŸR’d””
 *
»nd””
,

63 
Pošt
 *
¡¬t
, Pošˆ*
’d
,

64 
CŞÜ
 *
cŞÜ
);

65 
fl_pŞygÚ
 (
DŸR’d””
 *
»nd””
,

66 
Pošt
 *
pošts
, 
num_pošts
,

67 
CŞÜ
 *
cŞÜ
);

68 
d¿w_¬c
 (
DŸR’d””
 *
»nd””
,

69 
Pošt
 *
ûÁ”
,

70 
»®
 
width
,„—È
height
,

71 
»®
 
ªgË1
,„—È
ªgË2
,

72 
CŞÜ
 *
cŞÜ
);

73 
fl_¬c
 (
DŸR’d””
 *
»nd””
,

74 
Pošt
 *
ûÁ”
,

75 
»®
 
width
,„—È
height
,

76 
»®
 
ªgË1
,„—È
ªgË2
,

77 
CŞÜ
 *
cŞÜ
);

78 
d¿w_–l£
 (
DŸR’d””
 *
»nd””
,

79 
Pošt
 *
ûÁ”
,

80 
»®
 
width
,„—È
height
,

81 
CŞÜ
 *
cŞÜ
);

82 
fl_–l£
 (
DŸR’d””
 *
»nd””
,

83 
Pošt
 *
ûÁ”
,

84 
»®
 
width
,„—È
height
,

85 
CŞÜ
 *
cŞÜ
);

86 
d¿w_¡ršg
 (
DŸR’d””
 *
»nd””
,

87 cÚ¡ 
gch¬
 *
‹xt
,

88 
Pošt
 *
pos
,

89 
Alignm’t
 
®ignm’t
,

90 
CŞÜ
 *
cŞÜ
);

91 
d¿w_‹xt_lše
 (
DŸR’d””
 *
»nd””
,

92 
TextLše
 *
‹xt
,

93 
Pošt
 *
pos
,

94 
Alignm’t
 
®ignm’t
,

95 
CŞÜ
 *
cŞÜ
);

96 
d¿w_image
 (
DŸR’d””
 *
»nd””
,

97 
Pošt
 *
pošt
,

98 
»®
 
width
,„—È
height
,

99 
DŸImage
 *
image
);

101 
d¿w_»ù
 (
DŸR’d””
 *
»nd””
,

102 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

103 
CŞÜ
 *
cŞÜ
);

104 
fl_»ù
 (
DŸR’d””
 *
»nd””
,

105 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

106 
CŞÜ
 *
cŞÜ
);

107 
d¿w_fl_»ù
 (
DŸGdkR’d””
 *
»nd””
,

108 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

109 
CŞÜ
 *
cŞÜ
, 
gboŞ—n
 
fl
);

110 
d¿w_pŞylše
 (
DŸR’d””
 *
»nd””
,

111 
Pošt
 *
pošts
, 
num_pošts
,

112 
CŞÜ
 *
cŞÜ
);

113 
d¿w_pŞygÚ
 (
DŸR’d””
 *
»nd””
,

114 
Pošt
 *
pošts
, 
num_pošts
,

115 
CŞÜ
 *
cŞÜ
);

116 
d¿w_rounded_»ù
 (
DŸR’d””
 *
»nd””
,

117 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

118 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
);

119 
fl_rounded_»ù
 (
DŸR’d””
 *
»nd””
,

120 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

121 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
);

122 
d¿w_objeù
 (
DŸR’d””
 *
»nd””
, 
DŸObjeù
 *
objeù
);

124 
»®
 
g‘_‹xt_width
 (
DŸR’d””
 *
»nd””
,

125 cÚ¡ 
gch¬
 *
‹xt
, 
Ëngth
);

127 
dŸ_gdk_»nd””_şass_š™
 (
DŸGdkR’d””CÏss
 *
kÏss
);

128 
»nd””_š™
 (
DŸGdkR’d””
 *
»nd””
, *);

130 
gpoš‹r
 
	g·»Á_şass
 = 
NULL
;

135 
GTy³


136 
	$dŸ_gdk_»nd””_g‘_ty³
()

138 
GTy³
 
objeù_ty³
 = 0;

140 ià(!
objeù_ty³
)

142 cÚ¡ 
GTy³Info
 
objeù_šfo
 =

144  (
DŸGdkR’d””CÏss
),

145 (
GBa£In™Func
è
NULL
,

146 (
GBa£Fš®izeFunc
è
NULL
,

147 (
GCÏssIn™Func
è
dŸ_gdk_»nd””_şass_š™
,

148 
NULL
,

149 
NULL
,

150  (
DŸGdkR’d””
),

152 (
GIn¡ªûIn™Func
)
»nd””_š™


155 
objeù_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
DIA_TYPE_RENDERER
,

157 &
objeù_šfo
, 0);

160  
objeù_ty³
;

161 
	}
}

168 
	$»nd””_š™
(
DŸGdkR’d””
 *
»nd””
, * 
p
)

170 
»nd””
->
lše_width
 = 1;

171 
»nd””
->
lše_¡yË
 = 
GDK_LINE_SOLID
;

172 
»nd””
->
ÿp_¡yË
 = 
GDK_CAP_BUTT
;

173 
»nd””
->
još_¡yË
 = 
GDK_JOIN_ROUND
;

175 
»nd””
->
§ved_lše_¡yË
 = 
LINESTYLE_SOLID
;

176 
»nd””
->
dash_Ëngth
 = 10;

177 
»nd””
->
dÙ_Ëngth
 = 2;

179 
»nd””
->
highlight_cŞÜ
 = 
NULL
;

180 
	}
}

186 
	$»nd””_fš®ize
(
GObjeù
 *
objeù
)

188 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

190 ià(
»nd””
->
pixm­
 !ğ
NULL
)

191 
	`gdk_pixm­_uÄef
(
»nd””
->
pixm­
);

193 ià(
»nd””
->
gc
 !ğ
NULL
)

194 
	`gdk_gc_uÄef
(
»nd””
->
gc
);

196 ià(
»nd””
->
ş_»giÚ
 !ğ
NULL
)

197 
	`gdk_»giÚ_de¡roy
(
»nd””
->
ş_»giÚ
);

199 ià(
»nd””
->
ŒªsfÜm
)

200 
	`g_objeù_uÄef
 (
»nd””
->
ŒªsfÜm
);

202 
	`G_OBJECT_CLASS
 (
·»Á_şass
)->
	`fš®ize
 (
objeù
);

203 
	}
}

210 
	$dŸ_gdk_»nd””_şass_š™
(
DŸGdkR’d””CÏss
 *
kÏss
)

212 
GObjeùCÏss
 *
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
kÏss
);

213 
DŸR’d””CÏss
 *
»nd””_şass
 = 
	`DIA_RENDERER_CLASS
 (
kÏss
);

215 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
kÏss
);

217 
objeù_şass
->
fš®ize
 = 
»nd””_fš®ize
;

219 
»nd””_şass
->
g‘_width_pix–s
 = get_width_pixels;

220 
»nd””_şass
->
g‘_height_pix–s
 = get_height_pixels;

222 
»nd””_şass
->
begš_»nd”
 = begin_render;

223 
»nd””_şass
->
’d_»nd”
 =ƒnd_render;

225 
»nd””_şass
->
£t_lšewidth
 = set_linewidth;

226 
»nd””_şass
->
£t_lšeÿps
 = set_linecaps;

227 
»nd””_şass
->
£t_lšejoš
 = set_linejoin;

228 
»nd””_şass
->
£t_lše¡yË
 = set_linestyle;

229 
»nd””_şass
->
£t_dashËngth
 = set_dashlength;

230 
»nd””_şass
->
£t_fl¡yË
 = set_fillstyle;

232 
»nd””_şass
->
d¿w_lše
 = draw_line;

233 
»nd””_şass
->
fl_pŞygÚ
 = fill_polygon;

234 
»nd””_şass
->
d¿w_»ù
 = draw_rect;

235 
»nd””_şass
->
fl_»ù
 = fill_rect;

236 
»nd””_şass
->
d¿w_¬c
 = draw_arc;

237 
»nd””_şass
->
fl_¬c
 = fill_arc;

238 
»nd””_şass
->
d¿w_–l£
 = draw_ellipse;

239 
»nd””_şass
->
fl_–l£
 = fill_ellipse;

243 
»nd””_şass
->
d¿w_¡ršg
 = draw_string;

244 
»nd””_şass
->
d¿w_‹xt_lše
 = draw_text_line;

245 
»nd””_şass
->
d¿w_image
 = draw_image;

248 
»nd””_şass
->
d¿w_»ù
 = draw_rect;

249 
»nd””_şass
->
d¿w_pŞylše
 = draw_polyline;

250 
»nd””_şass
->
d¿w_pŞygÚ
 = draw_polygon;

251 
»nd””_şass
->
d¿w_objeù
 = draw_object;

254 
»nd””_şass
->
d¿w_rounded_»ù
 = draw_rounded_rect;

255 
»nd””_şass
->
fl_rounded_»ù
 = fill_rounded_rect;

258 
»nd””_şass
->
g‘_‹xt_width
 = get_text_width;

259 
	}
}

269 
	$»nd””_cŞÜ_cÚv”t
(
DŸGdkR’d””
 *
»nd””
,

270 
CŞÜ
 *
cŞ
, 
GdkCŞÜ
 *
gdk_cŞ
)

272 ià(
»nd””
->
highlight_cŞÜ
 !ğ
NULL
) {

273 
	`cŞÜ_cÚv”t
(
»nd””
->
highlight_cŞÜ
, 
gdk_cŞ
);

275 
	`cŞÜ_cÚv”t
(
cŞ
, 
gdk_cŞ
);

277 
	}
}

280 
	$begš_»nd”
 (
DŸR’d””
 *
objeù
)

282 
	}
}

285 
	$’d_»nd”
 (
DŸR’d””
 *
objeù
)

287 
	}
}

290 
	$£t_lšewidth
 (
DŸR’d””
 *
objeù
, 
»®
 
lšewidth
)

292 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

294 ià(
»nd””
->
highlight_cŞÜ
 !ğ
NULL
) {

296 
»®
 
bÜd”
 = 
	`dŸ_uÁ¿nsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 6);

297 
lšewidth
 +ğ
bÜd”
;

301 
»nd””
->
lše_width
 =

302 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 
lšewidth
);

304 ià(
»nd””
->
lše_width
<=0)

305 
»nd””
->
lše_width
 = 1;

307 
	`gdk_gc_£t_lše_©Œibu‹s
(
»nd””
->
gc
,

308 
»nd””
->
lše_width
,

309 
»nd””
->
lše_¡yË
,

310 
»nd””
->
ÿp_¡yË
,

311 
»nd””
->
još_¡yË
);

312 
	}
}

315 
	$£t_lšeÿps
 (
DŸR’d””
 *
objeù
, 
LšeC­s
 
mode
)

317 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

319 ià(
»nd””
->
highlight_cŞÜ
 !ğ
NULL
) {

320 
»nd””
->
ÿp_¡yË
 = 
GDK_CAP_ROUND
;

322 
mode
) {

323 
LINECAPS_BUTT
:

324 
»nd””
->
ÿp_¡yË
 = 
GDK_CAP_BUTT
;

326 
LINECAPS_ROUND
:

327 
»nd””
->
ÿp_¡yË
 = 
GDK_CAP_ROUND
;

329 
LINECAPS_PROJECTING
:

330 
»nd””
->
ÿp_¡yË
 = 
GDK_CAP_PROJECTING
;

335 
	`gdk_gc_£t_lše_©Œibu‹s
(
»nd””
->
gc
,

336 
»nd””
->
lše_width
,

337 
»nd””
->
lše_¡yË
,

338 
»nd””
->
ÿp_¡yË
,

339 
»nd””
->
još_¡yË
);

340 
	}
}

343 
	$£t_lšejoš
 (
DŸR’d””
 *
objeù
, 
LšeJoš
 
mode
)

345 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

347 ià(
»nd””
->
highlight_cŞÜ
 !ğ
NULL
) {

348 
»nd””
->
još_¡yË
 = 
GDK_JOIN_ROUND
;

350 
mode
) {

351 
LINEJOIN_MITER
:

352 
»nd””
->
još_¡yË
 = 
GDK_JOIN_MITER
;

354 
LINEJOIN_ROUND
:

355 
»nd””
->
još_¡yË
 = 
GDK_JOIN_ROUND
;

357 
LINEJOIN_BEVEL
:

358 
»nd””
->
još_¡yË
 = 
GDK_JOIN_BEVEL
;

362 
»nd””
->
još_¡yË
 = 
GDK_JOIN_ROUND
;

367 
	`gdk_gc_£t_lše_©Œibu‹s
(
»nd””
->
gc
,

368 
»nd””
->
lše_width
,

369 
»nd””
->
lše_¡yË
,

370 
»nd””
->
ÿp_¡yË
,

371 
»nd””
->
još_¡yË
);

372 
	}
}

379 
	$dŸ_gdk_»nd””_£t_dashes
(
DŸGdkR’d””
 *
»nd””
, 
off£t
)

381 
gšt8
 
dash_li¡
[6];

382 
hŞe_width
;

383 
·‰”n_Ëngth
;

385 
»nd””
->
§ved_lše_¡yË
) {

386 
LINESTYLE_SOLID
:

388 
LINESTYLE_DASHED
:

389 
dash_li¡
[0] = 
»nd””
->
dash_Ëngth
;

390 
dash_li¡
[1] = 
»nd””
->
dash_Ëngth
;

391 
·‰”n_Ëngth
 = 
»nd””
->
dash_Ëngth
*2;

392 
	`gdk_gc_£t_dashes
(
»nd””
->
gc
, 
off£t
, 
dash_li¡
, 2);

394 
LINESTYLE_DASH_DOT
:

395 
hŞe_width
 = (
»nd””
->
dash_Ëngth
 -„’d””->
dÙ_Ëngth
) / 2;

396 ià(
hŞe_width
==0)

397 
hŞe_width
 = 1;

398 
dash_li¡
[0] = 
»nd””
->
dash_Ëngth
;

399 
dash_li¡
[1] = 
hŞe_width
;

400 
dash_li¡
[2] = 
»nd””
->
dÙ_Ëngth
;

401 
dash_li¡
[3] = 
hŞe_width
;

402 
·‰”n_Ëngth
 = 
»nd””
->
dash_Ëngth
+»nd””->
dÙ_Ëngth
+2*
hŞe_width
;

403 
	`gdk_gc_£t_dashes
(
»nd””
->
gc
, 
off£t
, 
dash_li¡
, 4);

405 
LINESTYLE_DASH_DOT_DOT
:

406 
hŞe_width
 = (
»nd””
->
dash_Ëngth
 - 2*»nd””->
dÙ_Ëngth
) / 3;

407 ià(
hŞe_width
==0)

408 
hŞe_width
 = 1;

409 
dash_li¡
[0] = 
»nd””
->
dash_Ëngth
;

410 
dash_li¡
[1] = 
hŞe_width
;

411 
dash_li¡
[2] = 
»nd””
->
dÙ_Ëngth
;

412 
dash_li¡
[3] = 
hŞe_width
;

413 
dash_li¡
[4] = 
»nd””
->
dÙ_Ëngth
;

414 
dash_li¡
[5] = 
hŞe_width
;

415 
·‰”n_Ëngth
 = 
»nd””
->
dash_Ëngth
+2*»nd””->
dÙ_Ëngth
+3*
hŞe_width
;

416 
	`gdk_gc_£t_dashes
(
»nd””
->
gc
, 
off£t
, 
dash_li¡
, 6);

418 
LINESTYLE_DOTTED
:

419 
dash_li¡
[0] = 
»nd””
->
dÙ_Ëngth
;

420 
dash_li¡
[1] = 
»nd””
->
dÙ_Ëngth
;

421 
·‰”n_Ëngth
 = 
»nd””
->
dÙ_Ëngth
;

422 
	`gdk_gc_£t_dashes
(
»nd””
->
gc
, 
off£t
, 
dash_li¡
, 2);

426 
	}
}

429 
	$£t_lše¡yË
 (
DŸR’d””
 *
objeù
, 
LšeStyË
 
mode
)

431 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

433 
»nd””
->
§ved_lše_¡yË
 = 
mode
;

434 
mode
) {

435 
LINESTYLE_SOLID
:

436 
»nd””
->
lše_¡yË
 = 
GDK_LINE_SOLID
;

438 
LINESTYLE_DASHED
:

439 
»nd””
->
lše_¡yË
 = 
GDK_LINE_ON_OFF_DASH
;

440 
	`dŸ_gdk_»nd””_£t_dashes
(
»nd””
, 0);

442 
LINESTYLE_DASH_DOT
:

443 
»nd””
->
lše_¡yË
 = 
GDK_LINE_ON_OFF_DASH
;

444 
	`dŸ_gdk_»nd””_£t_dashes
(
»nd””
, 0);

446 
LINESTYLE_DASH_DOT_DOT
:

447 
»nd””
->
lše_¡yË
 = 
GDK_LINE_ON_OFF_DASH
;

448 
	`dŸ_gdk_»nd””_£t_dashes
(
»nd””
, 0);

450 
LINESTYLE_DOTTED
:

451 
»nd””
->
lše_¡yË
 = 
GDK_LINE_ON_OFF_DASH
;

452 
	`dŸ_gdk_»nd””_£t_dashes
(
»nd””
, 0);

455 
	`gdk_gc_£t_lše_©Œibu‹s
(
»nd””
->
gc
,

456 
»nd””
->
lše_width
,

457 
»nd””
->
lše_¡yË
,

458 
»nd””
->
ÿp_¡yË
,

459 
»nd””
->
još_¡yË
);

460 
	}
}

463 
	$£t_dashËngth
 (
DŸR’d””
 *
objeù
, 
»®
 
Ëngth
)

465 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

467 
»®
 
ddi¥_Ën
;

469 
ddi¥_Ën
 =

470 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 
Ëngth
);

472 
»nd””
->
dash_Ëngth
 = ()
	`æoÜ
(
ddi¥_Ën
+0.5);

473 
»nd””
->
dÙ_Ëngth
 = ()
	`æoÜ
(
ddi¥_Ën
*0.1+0.5);

475 ià(
»nd””
->
dash_Ëngth
<=0)

476 
»nd””
->
dash_Ëngth
 = 1;

477 ià(
»nd””
->
dash_Ëngth
>255)

478 
»nd””
->
dash_Ëngth
 = 255;

479 ià(
»nd””
->
dÙ_Ëngth
<=0)

480 
»nd””
->
dÙ_Ëngth
 = 1;

481 ià(
»nd””
->
dÙ_Ëngth
>255)

482 
»nd””
->
dÙ_Ëngth
 = 255;

483 
	`£t_lše¡yË
(
objeù
, 
»nd””
->
§ved_lše_¡yË
);

484 
	}
}

487 
	$£t_fl¡yË
 (
DŸR’d””
 *
objeù
, 
FlStyË
 
mode
)

489 
mode
) {

490 
FILLSTYLE_SOLID
:

493 
	`mes§ge_”rÜ
("gdk_renderer: Unsupported fill mode specified!\n");

495 
	}
}

498 
	$d¿w_lše
 (
DŸR’d””
 *
objeù
, 
Pošt
 *
¡¬t
, Pošˆ*
’d
, 
CŞÜ
 *
lše_cŞÜ
)

500 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

502 
GdkGC
 *
gc
 = 
»nd””
->gc;

503 
GdkCŞÜ
 
cŞÜ
;

504 
x1
,
y1
,
x2
,
y2
;

506 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
, 
¡¬t
->
x
, s¹->
y
, &
x1
, &
y1
);

507 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
, 
’d
->
x
,ƒnd->
y
, &
x2
, &
y2
);

509 
	`»nd””_cŞÜ_cÚv”t
(
»nd””
, 
lše_cŞÜ
, &
cŞÜ
);

510 
	`gdk_gc_£t_fÜeground
(
gc
, &
cŞÜ
);

512 
	`gdk_d¿w_lše
(
»nd””
->
pixm­
, 
gc
,

513 
x1
, 
y1
, 
x2
, 
y2
);

514 
	}
}

517 
	$fl_pŞygÚ
 (
DŸR’d””
 *
objeù
, 
Pošt
 *
pošts
, 
num_pošts
, 
CŞÜ
 *
lše_cŞÜ
)

519 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

520 
GdkGC
 *
gc
 = 
»nd””
->gc;

521 
GdkCŞÜ
 
cŞÜ
;

522 
GdkPošt
 *
gdk_pošts
;

523 
i
,
x
,
y
;

525 
gdk_pošts
 = 
	`g_Ãw
(
GdkPošt
, 
num_pošts
);

527 
i
=0;i<
num_pošts
;i++) {

528 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
, 
pošts
[
i
].
x
,…ošts[i].
y
, &x, &y);

529 
gdk_pošts
[
i
].
x
 = x;

530 
gdk_pošts
[
i
].
y
 = y;

533 
	`»nd””_cŞÜ_cÚv”t
(
»nd””
, 
lše_cŞÜ
, &
cŞÜ
);

534 
	`gdk_gc_£t_fÜeground
(
gc
, &
cŞÜ
);

536 
	`gdk_d¿w_pŞygÚ
(
»nd””
->
pixm­
, 
gc
, 
TRUE
, 
gdk_pošts
, 
num_pošts
);

537 
	`g_ä“
(
gdk_pošts
);

538 
	}
}

541 
	$d¿w_fl_¬c
 (
DŸR’d””
 *
objeù
,

542 
Pošt
 *
ûÁ”
,

543 
»®
 
width
,„—È
height
,

544 
»®
 
ªgË1
,„—È
ªgË2
,

545 
CŞÜ
 *
cŞÜ
,

546 
gboŞ—n
 
fl
)

548 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

549 
GdkGC
 *
gc
 = 
»nd””
->gc;

550 
GdkCŞÜ
 
gdkcŞÜ
;

551 
gšt
 
tİ
, 
Ëá
, 
bÙtom
, 
right
;

552 
»®
 
dªgË
;

554 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
,

555 
ûÁ”
->
x
 - 
width
/2, c’‹r->
y
 - 
height
/2,

556 &
Ëá
, &
tİ
);

557 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
,

558 
ûÁ”
->
x
 + 
width
/2, c’‹r->
y
 + 
height
/2,

559 &
right
, &
bÙtom
);

561 ià((
Ëá
>
right
è|| (
tİ
>
bÙtom
))

564 
	`»nd””_cŞÜ_cÚv”t
(
»nd””
, 
cŞÜ
, &
gdkcŞÜ
);

565 
	`gdk_gc_£t_fÜeground
(
gc
, &
gdkcŞÜ
);

567 
dªgË
 = 
ªgË2
-
ªgË1
;

568 ià(
dªgË
<0)

569 
dªgË
 += 360.0;

571 
	`gdk_d¿w_¬c
(
»nd””
->
pixm­
,

572 
gc
, 
fl
,

573 
Ëá
, 
tİ
, 
right
-Ëá, 
bÙtom
-top,

574 (è(
ªgË1
*64.0), (è(
dªgË
*64.0));

575 
	}
}

577 
	$d¿w_¬c
 (
DŸR’d””
 *
objeù
,

578 
Pošt
 *
ûÁ”
,

579 
»®
 
width
,„—È
height
,

580 
»®
 
ªgË1
,„—È
ªgË2
,

581 
CŞÜ
 *
cŞÜ
)

583 
	`d¿w_fl_¬c
 (
objeù
, 
ûÁ”
, 
width
, 
height
, 
ªgË1
, 
ªgË2
, 
cŞÜ
, 
FALSE
);

584 
	}
}

587 
	$fl_¬c
 (
DŸR’d””
 *
objeù
, 
Pošt
 *
ûÁ”
,

588 
»®
 
width
,„—È
height
,„—È
ªgË1
,„—È
ªgË2
,

589 
CŞÜ
 *
cŞÜ
)

591 
	`d¿w_fl_¬c
 (
objeù
, 
ûÁ”
, 
width
, 
height
, 
ªgË1
, 
ªgË2
, 
cŞÜ
, 
TRUE
);

592 
	}
}

595 
	$d¿w_–l£
 (
DŸR’d””
 *
objeù
, 
Pošt
 *
ûÁ”
,

596 
»®
 
width
,„—È
height
,

597 
CŞÜ
 *
cŞÜ
)

599 
	`d¿w_¬c
(
objeù
, 
ûÁ”
, 
width
, 
height
, 0.0, 360.0, 
cŞÜ
);

600 
	}
}

603 
	$fl_–l£
 (
DŸR’d””
 *
objeù
, 
Pošt
 *
ûÁ”
,

604 
»®
 
width
,„—È
height
, 
CŞÜ
 *
cŞÜ
)

606 
	`fl_¬c
(
objeù
, 
ûÁ”
, 
width
, 
height
, 0.0, 360.0, 
cŞÜ
);

607 
	}
}

612 
	$d¿w_highligh‹d_¡ršg
(
DŸGdkR’d””
 *
»nd””
,

613 
PªgoLayout
 *
Ïyout
,

614 
x
, 
y
,

615 
GdkCŞÜ
 *
cŞÜ
)

617 
gšt
 
width
, 
height
;

619 
	`·ngo_Ïyout_g‘_pix–_size
(
Ïyout
, &
width
, &
height
);

621 
	`gdk_gc_£t_fÜeground
(
»nd””
->
gc
, 
cŞÜ
);

623 
	`gdk_d¿w_»ùªgË
 (
»nd””
->
pixm­
,

624 
»nd””
->
gc
, 
TRUE
,

625 
x
-3, 
y
-3,

626 
width
+6, 
height
+6);

627 
	}
}

630 
	$d¿w_¡ršg
 (
DŸR’d””
 *
objeù
,

631 cÚ¡ 
gch¬
 *
‹xt
, 
Pošt
 *
pos
, 
Alignm’t
 
®ignm’t
,

632 
CŞÜ
 *
cŞÜ
)

634 
TextLše
 *
‹xt_lše
 = 
	`‹xt_lše_Ãw
(
‹xt
, 
objeù
->
fÚt
, objeù->
fÚt_height
);

635 
	`d¿w_‹xt_lše
(
objeù
, 
‹xt_lše
, 
pos
, 
®ignm’t
, 
cŞÜ
);

636 
	`‹xt_lše_de¡roy
(
‹xt_lše
);

637 
	}
}

639 #ifdeà
HAVE_FREETYPE


641 
	$š™Ÿlize_á_b™m­
(
FT_B™m­
 *
áb™m­
, 
width
, 
height
)

643 
row¡ride
 = 32*((
width
+31)/31);

644 
gušt8
 *
g¿yb™m­
 = (gušt8*)
	`g_Ãw0
(gušt8, 
height
*
row¡ride
);

646 
áb™m­
->
rows
 = 
height
;

647 
áb™m­
->
width
 = width;

648 
áb™m­
->
p™ch
 = 
row¡ride
;

649 
áb™m­
->
bufãr
 = 
g¿yb™m­
;

650 
áb™m­
->
num_g¿ys
 = 256;

651 
áb™m­
->
pix–_mode
 = 
á_pix–_mode_g¿ys
;

652 
áb™m­
->
·Ë‰e_mode
 = 0;

653 
áb™m­
->
·Ë‰e
 = 0;

654 
	}
}

664 
	$d¿w_‹xt_lše
 (
DŸR’d””
 *
objeù
, 
TextLše
 *
‹xt_lše
,

665 
Pošt
 *
pos
, 
Alignm’t
 
®ignm’t
, 
CŞÜ
 *
cŞÜ
)

667 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

668 
GdkCŞÜ
 
gdkcŞÜ
;

669 
x
,
y
;

670 
Pošt
 
¡¬t_pos
;

671 
PªgoLayout
* 
Ïyout
 = 
NULL
;

672 cÚ¡ 
gch¬
 *
‹xt
 = 
	`‹xt_lše_g‘_¡ršg
(
‹xt_lše
);

673 
height_pix–s
;

674 
»®
 
fÚt_height
 = 
	`‹xt_lše_g‘_height
(
‹xt_lše
);

675 
»®
 
sÿË
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 1.0);

677 ià(
‹xt
 =ğ
NULL
 || *text == '\0') ;

679 
	`pošt_cİy
(&
¡¬t_pos
,
pos
);

681 
	`»nd””_cŞÜ_cÚv”t
(
»nd””
, 
cŞÜ
, &
gdkcŞÜ
);

683 
height_pix–s
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 
fÚt_height
);

684 ià(
height_pix–s
 < 2) {

685 
width_pix–s
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
,

686 
	`‹xt_lše_g‘_width
(
‹xt_lše
));

687 
	`gdk_gc_£t_fÜeground
(
»nd””
->
gc
, &
gdkcŞÜ
);

688 
	`gdk_gc_£t_dashes
(
»nd””
->
gc
, 0, (
gušt8
*)"\1\2", 2);

689 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
, 
¡¬t_pos
.
x
, s¹_pos.
y
, &x, &y);

690 
	`gdk_d¿w_lše
(
»nd””
->
pixm­
,„’d””->
gc
, 
x
, 
y
, x + 
width_pix–s
, y);

693 
¡¬t_pos
.
y
 -ğ
	`‹xt_lše_g‘_asûÁ
(
‹xt_lše
);

694 
¡¬t_pos
.
x
 -ğ
	`‹xt_lše_g‘_®ignm’t_adju¡m’t
 (
‹xt_lše
, 
®ignm’t
);

696 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
,

697 
¡¬t_pos
.
x
, s¹_pos.
y
, &x, &y);

699 
Ïyout
 = 
	`dŸ_fÚt_bud_Ïyout
(
‹xt
, 
‹xt_lše
->
fÚt
,

700 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 
‹xt_lše
->
height
)/20.0);

701 #ià
	`defšed
(
PANGO_VERSION_ENCODE
)

702 #ià(
PANGO_VERSION
 >ğ
	`PANGO_VERSION_ENCODE
(1,16,0))

704 
	#HAVE_·ngo_Ïyout_g‘_lše_»adÚly


	)

707 
	`‹xt_lše_adju¡_Ïyout_lše
 (
‹xt_lše
,

708 #ià
	`defšed
(
HAVE_·ngo_Ïyout_g‘_lše_»adÚly
)

709 
	`·ngo_Ïyout_g‘_lše_»adÚly
(
Ïyout
, 0),

711 
	`·ngo_Ïyout_g‘_lše
(
Ïyout
, 0),

713 
sÿË
/20.0);

715 ià(
»nd””
->
highlight_cŞÜ
 !ğ
NULL
) {

716 
	`d¿w_highligh‹d_¡ršg
(
»nd””
, 
Ïyout
, 
x
, 
y
, &
gdkcŞÜ
);

718 #ià
defšed
 
HAVE_FREETYPE


720 
FT_B™m­
 
áb™m­
;

721 
width
, 
height
;

722 
GdkPixbuf
 *
rgba
 = 
NULL
;

724 
width
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
,

725 
	`‹xt_lše_g‘_width
(
‹xt_lše
));

726 
height
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
,

727 
	`‹xt_lše_g‘_height
(
‹xt_lše
));

729 ià(
width
 > 0) {

730 
¡ride
;

731 
guch¬
* 
pix–s
;

732 
i
,
j
;

733 
gušt8
 *
g¿yb™m­
;

735 
	`š™Ÿlize_á_b™m­
(&
áb™m­
, 
width
, 
height
);

736 
	`·ngo_á2_»nd”_Ïyout
(&
áb™m­
, 
Ïyout
, 0, 0);

738 
g¿yb™m­
 = 
áb™m­
.
bufãr
;

740 
rgba
 = 
	`gdk_pixbuf_Ãw
(
GDK_COLORSPACE_RGB
, 
TRUE
, 8, 
width
, 
height
);

741 
¡ride
 = 
	`gdk_pixbuf_g‘_row¡ride
(
rgba
);

742 
pix–s
 = 
	`gdk_pixbuf_g‘_pix–s
(
rgba
);

743 
i
 = 0; i < 
height
; i++) {

744 
j
 = 0; j < 
width
; j++) {

745 
pix–s
[
i
*
¡ride
+
j
*4] = 
gdkcŞÜ
.
»d
>>8;

746 
pix–s
[
i
*
¡ride
+
j
*4+1] = 
gdkcŞÜ
.
g»’
>>8;

747 
pix–s
[
i
*
¡ride
+
j
*4+2] = 
gdkcŞÜ
.
blue
>>8;

748 
pix–s
[
i
*
¡ride
+
j
*4+3] = 
g¿yb™m­
[i*
áb™m­
.
p™ch
+j];

751 
	`g_ä“
(
g¿yb™m­
);

753 
	`gdk_d¿w_pixbuf
(
»nd””
->
pixm­
,„’d””->
gc
, 
rgba
, 0, 0, 
x
, 
y
, 
width
, 
height
, 
GDK_RGB_DITHER_NONE
, 0, 0);

755 
	`g_objeù_uÄef
(
	`G_OBJECT
(
rgba
));

759 
	`gdk_gc_£t_fÜeground
(
»nd””
->
gc
, &
gdkcŞÜ
);

761 
	`gdk_d¿w_Ïyout
(
»nd””
->
pixm­
,„’d””->
gc
, 
x
, 
y
, 
Ïyout
);

764 
	`g_objeù_uÄef
(
	`G_OBJECT
(
Ïyout
));

766 
	}
}

769 
»®


770 
	$g‘_‹xt_width
(
DŸR’d””
 *
objeù
,

771 cÚ¡ 
gch¬
 *
‹xt
, 
Ëngth
)

773 
»®
 
»suÉ
;

774 
TextLše
 *
‹xt_lše
;

776 ià(
Ëngth
 !ğ
	`g_utf8_¡¾’
(
‹xt
, -1)) {

777 *
Ùh”tx
;

778 
uËn
;

780 
uËn
 = 
	`g_utf8_off£t_to_poš‹r
(
‹xt
, 
Ëngth
)-text;

781 ià(!
	`g_utf8_v®id©e
(
‹xt
, 
uËn
, 
NULL
)) {

782 
	`g_w¬nšg
 ("Texˆ© ch¬ %d‚Ù v®id\n", 
Ëngth
);

784 
Ùh”tx
 = 
	`g_¡ºdup
(
‹xt
, 
uËn
);

785 
‹xt_lše
 = 
	`‹xt_lše_Ãw
(
Ùh”tx
, 
objeù
->
fÚt
, objeù->
fÚt_height
);

787 
‹xt_lše
 = 
	`‹xt_lše_Ãw
(
‹xt
, 
objeù
->
fÚt
, objeù->
fÚt_height
);

789 
»suÉ
 = 
	`‹xt_lše_g‘_width
(
‹xt_lše
);

790 
	`‹xt_lše_de¡roy
(
‹xt_lše
);

791  
»suÉ
;

792 
	}
}

795 
	$d¿w_image
 (
DŸR’d””
 *
objeù
,

796 
Pošt
 *
pošt
,

797 
»®
 
width
,„—È
height
,

798 
DŸImage
 *
image
)

800 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

801 ià(
»nd””
->
highlight_cŞÜ
 !ğ
NULL
) {

802 
Pošt
 
Ì
;

803 
DŸR’d””CÏss
 *
£lf_şass
 = 
	`DIA_RENDERER_GET_CLASS
 (
objeù
);

805 
Ì
 = *
pošt
;

806 
Ì
.
x
 +ğ
width
;

807 
Ì
.
y
 +ğ
height
;

808 
£lf_şass
->
	`fl_»ù
(
objeù
, 
pošt
, &
Ì
, 
»nd””
->
highlight_cŞÜ
);

810 
»®_width
, 
»®_height
, 
»®_x
, 
»®_y
;

811 cÚ¡ 
GdkPixbuf
 *
Üg
 = 
	`dŸ_image_pixbuf
 (
image
);

812 
Üg_width
 = 
	`gdk_pixbuf_g‘_width
(
Üg
);

813 
Üg_height
 = 
	`gdk_pixbuf_g‘_height
(
Üg
);

815 
»®_width
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 
width
);

816 
»®_height
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 
height
);

817 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
, 
pošt
->
x
,…ošt->
y
,

818 &
»®_x
, &
»®_y
);

820 ià(
»®_width
 =ğ
Üg_width
 && 
»®_height
 =ğ
Üg_height
) {

821 
	`gdk_d¿w_pixbuf
(
»nd””
->
pixm­
,„’d””->
gc
, (
GdkPixbuf
 *)
Üg
,

822 0, 0, 
»®_x
, 
»®_y
, 
»®_width
, 
»®_height
,

823 
GDK_RGB_DITHER_NORMAL
, 0, 0);

824 } ià(
»®_width
 > 
Üg_width
 || 
»®_height
 > 
Üg_height
) {

826 
sub_width
 = 
»®_width
 - (
»®_x
 >= 0 ? 0 : -real_x);

827 
sub_height
 = 
»®_height
 - (
»®_y
 >= 0 ? 0 : -real_y);

830 ià(
	`g‘_width_pix–s
 (
objeù
è< 
sub_width
)

831 
sub_width
 = 
	`g‘_width_pix–s
 (
objeù
);

832 ià(
	`g‘_height_pix–s
 (
objeù
è< 
sub_height
)

833 
sub_height
 = 
	`g‘_height_pix–s
 (
objeù
);

835 ià(
sub_height
 > 0 && 
sub_width
 > 0) {

836 
GdkPixbuf
 *
sÿËd
 = 
	`gdk_pixbuf_Ãw
 (
	`gdk_pixbuf_g‘_cŞÜ¥aû
 (
Üg
),

837 
	`gdk_pixbuf_g‘_has_®pha
 (
Üg
),

838 
	`gdk_pixbuf_g‘_b™s_³r_§m¶e
 (
Üg
),

839 
sub_width
, 
sub_height
);

840 
sÿË_x
 = ()
»®_width
/
Üg_width
;

841 
sÿË_y
 = ()
»®_height
/
Üg_height
;

842 
	`gdk_pixbuf_sÿË
 (
Üg
, 
sÿËd
,

843 0, 0, 
sub_width
, 
sub_height
,

844 
»®_x
 >ğ0 ? 0 :„—l_x, 
»®_y
 >= 0 ? 0 :„eal_y,

845 
sÿË_x
, 
sÿË_y
, 
GDK_INTERP_TILES
);

846 
	`gdk_d¿w_pixbuf
(
»nd””
->
pixm­
,„’d””->
gc
, 
sÿËd
,

847 0, 0, 
»®_x
 >ğ0 ?„—l_x : 0, 
»®_y
 >= 0 ?„eal_y : 0,

848 
sub_width
, 
sub_height
, 
GDK_RGB_DITHER_NORMAL
, 0, 0);

849 
	`g_objeù_uÄef
 (
sÿËd
);

853 
	`dŸ_image_d¿w
(
image
, 
»nd””
->
pixm­
,„’d””->
gc
, 
»®_x
, 
»®_y
,

854 
»®_width
, 
»®_height
);

857 
	}
}

863 
	$d¿w_fl_»ù
 (
DŸGdkR’d””
 *
»nd””
,

864 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

865 
CŞÜ
 *
cŞÜ
, 
gboŞ—n
 
fl
)

867 
GdkGC
 *
gc
 = 
»nd””
->gc;

868 
GdkCŞÜ
 
gdkcŞÜ
;

869 
gšt
 
tİ
, 
bÙtom
, 
Ëá
, 
right
;

871 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
,

872 
ul_cÜÃr
->
x
, ul_cÜÃr->
y
, &
Ëá
, &
tİ
);

873 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
,

874 
Ì_cÜÃr
->
x
,†r_cÜÃr->
y
, &
right
, &
bÙtom
);

876 ià((
Ëá
>
right
è|| (
tİ
>
bÙtom
))

879 
	`»nd””_cŞÜ_cÚv”t
(
»nd””
, 
cŞÜ
, &
gdkcŞÜ
);

880 
	`gdk_gc_£t_fÜeground
(
gc
, &
gdkcŞÜ
);

882 
	`gdk_d¿w_»ùªgË
 (
»nd””
->
pixm­
,

883 
gc
, 
fl
,

884 
Ëá
, 
tİ
,

885 
right
-
Ëá
,

886 
bÙtom
-
tİ
);

887 
	}
}

890 
	$d¿w_»ù
 (
DŸR’d””
 *
objeù
,

891 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

892 
CŞÜ
 *
cŞÜ
)

894 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

896 
	`d¿w_fl_»ù
 (
»nd””
, 
ul_cÜÃr
, 
Ì_cÜÃr
, 
cŞÜ
, 
FALSE
);

897 
	}
}

900 
	$fl_»ù
 (
DŸR’d””
 *
objeù
,

901 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

902 
CŞÜ
 *
cŞÜ
)

904 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

906 
	`d¿w_fl_»ù
 (
»nd””
, 
ul_cÜÃr
, 
Ì_cÜÃr
, 
cŞÜ
, 
TRUE
);

907 
	}
}

910 
	$d¿w_pŞylše
 (
DŸR’d””
 *
£lf
,

911 
Pošt
 *
pošts
, 
num_pošts
,

912 
CŞÜ
 *
lše_cŞÜ
)

914 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

915 
GdkGC
 *
gc
 = 
»nd””
->gc;

916 
GdkCŞÜ
 
cŞÜ
;

917 
GdkPošt
 *
gdk_pošts
;

918 
i
,
x
,
y
;

920 
gdk_pošts
 = 
	`g_Ãw
(
GdkPošt
, 
num_pošts
);

922 
i
=0;i<
num_pošts
;i++) {

923 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
, 
pošts
[
i
].
x
,…ošts[i].
y
, &x, &y);

924 
gdk_pošts
[
i
].
x
 = x;

925 
gdk_pošts
[
i
].
y
 = y;

928 
	`»nd””_cŞÜ_cÚv”t
(
»nd””
, 
lše_cŞÜ
, &
cŞÜ
);

929 
	`gdk_gc_£t_fÜeground
(
gc
, &
cŞÜ
);

931 
	`gdk_d¿w_lšes
(
»nd””
->
pixm­
, 
gc
, 
gdk_pošts
, 
num_pošts
);

932 
	`g_ä“
(
gdk_pošts
);

933 
	}
}

936 
	$d¿w_pŞygÚ
 (
DŸR’d””
 *
£lf
,

937 
Pošt
 *
pošts
, 
num_pošts
,

938 
CŞÜ
 *
lše_cŞÜ
)

940 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

941 
GdkGC
 *
gc
 = 
»nd””
->gc;

942 
GdkCŞÜ
 
cŞÜ
;

943 
GdkPošt
 *
gdk_pošts
;

944 
i
,
x
,
y
;

946 
gdk_pošts
 = 
	`g_Ãw
(
GdkPošt
, 
num_pošts
);

948 
i
=0;i<
num_pošts
;i++) {

949 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
, 
pošts
[
i
].
x
,…ošts[i].
y
, &x, &y);

950 
gdk_pošts
[
i
].
x
 = x;

951 
gdk_pošts
[
i
].
y
 = y;

954 
	`»nd””_cŞÜ_cÚv”t
(
»nd””
, 
lše_cŞÜ
, &
cŞÜ
);

955 
	`gdk_gc_£t_fÜeground
(
gc
, &
cŞÜ
);

957 
	`gdk_d¿w_pŞygÚ
(
»nd””
->
pixm­
, 
gc
, 
FALSE
, 
gdk_pošts
, 
num_pošts
);

958 
	`g_ä“
(
gdk_pošts
);

959 
	}
}

966 
	$d¿w_fl_rounded_»ù
 (
DŸR’d””
 *
£lf
,

967 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

968 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
,

969 
gboŞ—n
 
fl
)

971 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

972 
GdkGC
 *
gc
 = 
»nd””
->gc;

973 
GdkCŞÜ
 
gdkcŞÜ
;

974 
gšt
 
tİ
, 
bÙtom
, 
Ëá
, 
right
, 
r
, 
d
;

975 
gšt
 
off£t
 = 0;

977 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
,

978 
ul_cÜÃr
->
x
, ul_cÜÃr->
y
, &
Ëá
, &
tİ
);

979 
	`dŸ_ŒªsfÜm_coÜds
(
»nd””
->
ŒªsfÜm
,

980 
Ì_cÜÃr
->
x
,†r_cÜÃr->
y
, &
right
, &
bÙtom
);

981 
r
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 
¿dius
);

983 ià((
Ëá
>
right
è|| (
tİ
>
bÙtom
))

986 ià(
r
>(
right
-
Ëá
)/2)

987 
r
 = (
right
-
Ëá
)/2;

988 ià(
r
>(
bÙtom
-
tİ
)/2)

989 
r
 = (
bÙtom
-
tİ
)/2;

991 
d
 = 
r
<<1;

993 ià(
»nd””
->
lše_width
 > 
d
)

994 
off£t
 = (
»nd””
->
lše_width
 + 1) / 2;

996 
	`»nd””_cŞÜ_cÚv”t
(
»nd””
, 
cŞÜ
, &
gdkcŞÜ
);

997 
	`gdk_gc_£t_fÜeground
(
gc
, &
gdkcŞÜ
);

999 ià(
d
 > 0) {

1000 ià(
off£t
 > 0) {

1002 
	`gdk_gc_£t_lše_©Œibu‹s
(
»nd””
->
gc
,

1003 
r
, 
»nd””
->
lše_¡yË
,

1004 
»nd””
->
ÿp_¡yË
,„’d””->
još_¡yË
);

1005 
	`gdk_d¿w_¬c
(
»nd””
->
pixm­
, 
gc
, 
TRUE
, 
Ëá
-
off£t
, 
tİ
-off£t, 
d
, d, 90<<6, 90<<6);

1006 
	`gdk_d¿w_¬c
(
»nd””
->
pixm­
, 
gc
, 
TRUE
, 
right
-
d
+
off£t
, 
tİ
-offset, d, d, 0<<6, 90<<6);

1007 
	`gdk_d¿w_¬c
(
»nd””
->
pixm­
, 
gc
, 
TRUE
, 
right
-
d
+
off£t
, 
bÙtom
-d+offset, d, d, 270<<6, 90<<6);

1008 
	`gdk_d¿w_¬c
(
»nd””
->
pixm­
, 
gc
, 
TRUE
, 
Ëá
-
off£t
, 
bÙtom
-
d
+offset, d, d, 180<<6, 90<<6);

1009 
	`gdk_gc_£t_lše_©Œibu‹s
(
»nd””
->
gc
,

1010 
»nd””
->
lše_width
,„’d””->
lše_¡yË
,

1011 
»nd””
->
ÿp_¡yË
,„’d””->
još_¡yË
);

1013 
	`gdk_d¿w_¬c
(
»nd””
->
pixm­
, 
gc
, 
fl
, 
Ëá
, 
tİ
, 
d
, d, 90<<6, 90<<6);

1014 
	`gdk_d¿w_¬c
(
»nd””
->
pixm­
, 
gc
, 
fl
, 
right
-
d
, 
tİ
, d, d, 0<<6, 90<<6);

1015 
	`gdk_d¿w_¬c
(
»nd””
->
pixm­
, 
gc
, 
fl
, 
right
-
d
, 
bÙtom
-d, d, d, 270<<6, 90<<6);

1016 
	`gdk_d¿w_¬c
(
»nd””
->
pixm­
, 
gc
, 
fl
, 
Ëá
, 
bÙtom
-
d
, d, d, 180<<6, 90<<6);

1020 ià(
fl
) {

1021 
	`gdk_d¿w_»ùªgË
 (
»nd””
->
pixm­
,„’d””->
gc
, 
TRUE
,

1022 
Ëá
+
r
-
off£t
, 
tİ
, 
right
-Ëá-
d
+off£t, 
bÙtom
-top);

1023 
	`gdk_d¿w_»ùªgË
 (
»nd””
->
pixm­
,„’d””->
gc
, 
TRUE
,

1024 
Ëá
, 
tİ
+
r
-
off£t
, 
right
-Ëá, 
bÙtom
-tİ-
d
+offset);

1026 
	`gdk_d¿w_lše
(
»nd””
->
pixm­
, 
gc
, 
Ëá
+
r
-
off£t
, 
tİ
, 
right
-r+offset,op);

1027 
	`gdk_d¿w_lše
(
»nd””
->
pixm­
, 
gc
, 
right
, 
tİ
+
r
-
off£t
,„ight, 
bÙtom
-r+offset);

1028 
	`gdk_d¿w_lše
(
»nd””
->
pixm­
, 
gc
, 
right
-
r
+
off£t
, 
bÙtom
, 
Ëá
+r-1-offset, bottom);

1029 
	`gdk_d¿w_lše
(
»nd””
->
pixm­
, 
gc
, 
Ëá
, 
bÙtom
-
r
+
off£t
,†eá, 
tİ
+r-1-offset);

1031 
	}
}

1033 
	$d¿w_rounded_»ù
 (
DŸR’d””
 *
£lf
,

1034 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

1035 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
)

1037 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

1038 
gšt
 
r
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 
¿dius
);

1040 ià(
r
 > 0)

1041 
	`d¿w_fl_rounded_»ù
 (
£lf
, 
ul_cÜÃr
, 
Ì_cÜÃr
, 
cŞÜ
, 
¿dius
, 
FALSE
);

1043 
	`d¿w_»ù
 (
£lf
, 
ul_cÜÃr
, 
Ì_cÜÃr
, 
cŞÜ
);

1044 
	}
}

1046 
	$fl_rounded_»ù
 (
DŸR’d””
 *
£lf
,

1047 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

1048 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
)

1050 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
£lf
);

1051 
gšt
 
r
 = 
	`dŸ_ŒªsfÜm_Ëngth
(
»nd””
->
ŒªsfÜm
, 
¿dius
);

1053 ià(
r
 > 0)

1054 
	`d¿w_fl_rounded_»ù
 (
£lf
, 
ul_cÜÃr
, 
Ì_cÜÃr
, 
cŞÜ
, 
¿dius
, 
TRUE
);

1056 
	`fl_»ù
 (
£lf
, 
ul_cÜÃr
, 
Ì_cÜÃr
, 
cŞÜ
);

1057 
	}
}

1060 
	$d¿w_objeù
 (
DŸR’d””
 *
»nd””
, 
DŸObjeù
 *
objeù
)

1062 ià(
»nd””
->
is_š‹¿ùive
 &&

1063 
objeù
->
highlight_cŞÜ
 !ğ
NULL
) {

1064 
DŸGdkR’d””
 *
gdk_»nd
 = 
	`DIA_GDK_RENDERER
(
»nd””
);

1065 
gdk_»nd
->
highlight_cŞÜ
 = 
objeù
->highlight_color;

1066 
objeù
->
İs
->
	`d¿w
(objeù, 
»nd””
);

1067 
gdk_»nd
->
highlight_cŞÜ
 = 
NULL
;

1069 
objeù
->
İs
->
	`d¿w
(objeù, 
»nd””
);

1070 
	}
}

1073 
	$g‘_width_pix–s
 (
DŸR’d””
 *
objeù
)

1075 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

1076 
width
 = 0;

1078 ià(
»nd””
->
pixm­
)

1079 
	`gdk_d¿wabË_g‘_size
 (
	`GDK_DRAWABLE
 (
»nd””
->
pixm­
), &
width
, 
NULL
);

1081  
width
;

1082 
	}
}

1085 
	$g‘_height_pix–s
 (
DŸR’d””
 *
objeù
)

1087 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
objeù
);

1088 
height
 = 0;

1090 ià(
»nd””
->
pixm­
)

1091 
	`gdk_d¿wabË_g‘_size
 (
	`GDK_DRAWABLE
 (
»nd””
->
pixm­
), 
NULL
, &
height
);

1093  
height
;

1094 
	}
}

	@O:\tool\dvs50\lib\diagdkrenderer.h

1 #iâdeà
DIA_GDK_RENDERER_H


2 
	#DIA_GDK_RENDERER_H


	)

4 
	~"dŸty³s.h
"

5 
	~<gdk/gdk.h
>

6 
	~"dŸ»nd””.h
"

7 
	~"dŸŒªsfÜm.h
"

9 
	gG_BEGIN_DECLS


11 
	#DIA_TYPE_GDK_RENDERER
 (
	`dŸ_gdk_»nd””_g‘_ty³
 ())

	)

12 
	#DIA_GDK_RENDERER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_GDK_RENDERER
, 
DŸGdkR’d””
))

	)

13 
	#DIA_GDK_RENDERER_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_GDK_RENDERER
, 
DŸGdkR’d””CÏss
))

	)

14 
	#DIA_IS_GDK_RENDERER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_GDK_RENDERER
))

	)

15 
	#DIA_GDK_RENDERER_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_GDK_RENDERER
, 
DŸGdkR’d””CÏss
))

	)

17 
DIAVAR
 
GTy³
 
	$dŸ_gdk_»nd””_g‘_ty³
 (è
G_GNUC_CONST
;

18 
DIAVAR
 
	`dŸ_gdk_»nd””_£t_dashes
(
DŸGdkR’d””
 *
»nd””
, 
off£t
);

20 
	s_DŸGdkR’d””


22 
DŸR’d””
 
·»Á_š¡ªû
;

25 
DŸT¿nsfÜm
 *
ŒªsfÜm
;

26 
GdkPixm­
 *
pixm­
;

27 
gušt32
 
width
;

28 
gušt32
 
height
;

29 
GdkGC
 *
gc
;

30 
GdkRegiÚ
 *
ş_»giÚ
;

33 
lše_width
;

34 
GdkLšeStyË
 
lše_¡yË
;

35 
GdkC­StyË
 
ÿp_¡yË
;

36 
GdkJošStyË
 
još_¡yË
;

38 
LšeStyË
 
§ved_lše_¡yË
;

39 
dash_Ëngth
;

40 
dÙ_Ëngth
;

43 
CŞÜ
 *
highlight_cŞÜ
;

46 
	s_DŸGdkR’d””CÏss


48 
DŸR’d””CÏss
 
·»Á_şass
;

51 
G_END_DECLS


	@O:\tool\dvs50\lib\diagramdata.c

23 #ifdeà
HAVE_CONFIG_H


24 
	~<cÚfig.h
>

27 
	~"š.h
"

28 
	~"dŸg¿md©a.h
"

29 
	~"dŸ»nd””.h
"

30 
	~"·³r.h
"

31 
	~"³rsi¡’û.h
"

33 
	~"dyÇmic_obj.h
"

34 
	~"dŸm¬sh®.h
"

36 
FaùÜySŒuùI‹mAÎ
 *
çùÜyCÚš”
 ;

38 cÚ¡ 
ReùªgË
 
	gšv®id_ex‹Ás
 = { -1.0,-1.0,-1.0,-1.0 };

40 
dŸg¿m_d©a_şass_š™
 (
DŸg¿mD©aCÏss
 *
kÏss
);

41 
dŸg¿m_d©a_š™
 (
DŸg¿mD©a
 *
objeù
);

44 
	mOBJECT_ADD
,

45 
	mOBJECT_REMOVE
,

46 
	mLAST_SIGNAL


49 
gušt
 
	gdŸg¿m_d©a_sigÇls
[
LAST_SIGNAL
] = { 0, };

51 
gpoš‹r
 
	g·»Á_şass
 = 
NULL
;

55 
GTy³


56 
	$dŸg¿m_d©a_g‘_ty³
()

58 
GTy³
 
objeù_ty³
 = 0;

60 ià(!
objeù_ty³
)

62 cÚ¡ 
GTy³Info
 
objeù_šfo
 =

64  (
DŸg¿mD©aCÏss
),

65 (
GBa£In™Func
è
NULL
,

66 (
GBa£Fš®izeFunc
è
NULL
,

67 (
GCÏssIn™Func
è
dŸg¿m_d©a_şass_š™
,

68 
NULL
,

69 
NULL
,

70  (
DŸg¿mD©a
),

72 (
GIn¡ªûIn™Func
)
dŸg¿m_d©a_š™


75 
objeù_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
G_TYPE_OBJECT
,

77 &
objeù_šfo
, 0);

80  
objeù_ty³
;

81 
	}
}

85 
	$_dŸg¿m_d©a_objeù_add
 (
DŸg¿mD©a
* 
dŸ
,
Lay”
* 
Ïy”
,
DŸObjeù
* 
obj
)

87 
	}
}

90 
	$_dŸg¿m_d©a_objeù_»move
 (
DŸg¿mD©a
* 
dŸ
,
Lay”
* 
Ïy”
,
DŸObjeù
* 
obj
)

92 
	}
}

98 
	$dŸg¿m_d©a_š™
(
DŸg¿mD©a
 *
d©a
)

100 
CŞÜ
* 
cŞÜ
 = 
	`³rsi¡’û_»gi¡”_cŞÜ
 ("Ãw_dŸg¿m_bgcŞour", &
cŞÜ_wh™e
);

101 
gboŞ—n
 
com´ess
 = 
	`³rsi¡’û_»gi¡”_boŞ—n
 ("com´ess_§ve", 
TRUE
);

102 
Lay”
 *
fœ¡_Ïy”
;

104 
d©a
->
ex‹Ás
.
Ëá
 = 0.0;

105 
d©a
->
ex‹Ás
.
right
 = 10.0;

106 
d©a
->
ex‹Ás
.
tİ
 = 0.0;

107 
d©a
->
ex‹Ás
.
bÙtom
 = 10.0;

109 
d©a
->
bg_cŞÜ
 = *
cŞÜ
;

111 
	`g‘_·³r_šfo
 (&
d©a
->
·³r
, -1, 
NULL
);

113 
fœ¡_Ïy”
 = 
	`Ãw_Ïy”
(
	`g_¡rdup
(
	`_
("Background")),
d©a
);

115 
d©a
->
Ïy”s
 = 
	`g_±r_¬¿y_Ãw
 ();

116 
	`g_±r_¬¿y_add
 (
d©a
->
Ïy”s
, 
fœ¡_Ïy”
);

117 
d©a
->
aùive_Ïy”
 = 
fœ¡_Ïy”
;

119 
d©a
->
£Ëùed_couÁ_´iv©e
 = 0;

120 
d©a
->
£Ëùed
 = 
NULL
;

122 
d©a
->
is_com´es£d
 = 
com´ess
;

124 
d©a
->
‹xt_ed™s
 = 
NULL
;

125 
d©a
->
aùive_‹xt_ed™
 = 
NULL
;

126 
	}
}

132 
	$dŸg¿m_d©a_fš®ize
(
GObjeù
 *
objeù
)

134 
DŸg¿mD©a
 *
d©a
 = 
	`DIA_DIAGRAM_DATA
(
objeù
);

136 
gušt
 
i
;

138 
	`g_ä“
(
d©a
->
·³r
.
Çme
);

140 
i
=0;i<
d©a
->
Ïy”s
->
Ën
;i++) {

141 
	`Ïy”_de¡roy
(
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
));

143 
	`g_±r_¬¿y_ä“
(
d©a
->
Ïy”s
, 
TRUE
);

144 
d©a
->
aùive_Ïy”
 = 
NULL
;

146 
	`g_li¡_ä“
(
d©a
->
£Ëùed
);

147 
d©a
->
£Ëùed
 = 
NULL
;

148 
d©a
->
£Ëùed_couÁ_´iv©e
 = 0;

149 
	}
}

155 
	$dŸg¿m_d©a_şass_š™
(
DŸg¿mD©aCÏss
 *
kÏss
)

157 
GObjeùCÏss
 *
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
kÏss
);

159 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
kÏss
);

161 
dŸg¿m_d©a_sigÇls
[
OBJECT_ADD
] =

162 
	`g_sigÇl_Ãw
 ("object_add",

163 
	`G_TYPE_FROM_CLASS
 (
kÏss
),

164 
G_SIGNAL_RUN_FIRST
,

165 
	`G_STRUCT_OFFSET
 (
DŸg¿mD©aCÏss
, 
objeù_add
),

166 
NULL
, NULL,

167 
dŸ_m¬sh®_VOID__POINTER_POINTER
,

168 
G_TYPE_NONE
,

170 
G_TYPE_POINTER
,

171 
G_TYPE_POINTER
);

173 
dŸg¿m_d©a_sigÇls
[
OBJECT_REMOVE
] =

174 
	`g_sigÇl_Ãw
 ("object_remove",

175 
	`G_TYPE_FROM_CLASS
 (
kÏss
),

176 
G_SIGNAL_RUN_FIRST
,

177 
	`G_STRUCT_OFFSET
 (
DŸg¿mD©aCÏss
, 
objeù_»move
),

178 
NULL
, NULL,

179 
dŸ_m¬sh®_VOID__POINTER_POINTER
,

180 
G_TYPE_NONE
,

182 
G_TYPE_POINTER
,

183 
G_TYPE_POINTER
);

185 
objeù_şass
->
fš®ize
 = 
dŸg¿m_d©a_fš®ize
;

186 
kÏss
->
objeù_add
 = 
_dŸg¿m_d©a_objeù_add
;

187 
kÏss
->
objeù_»move
 = 
_dŸg¿m_d©a_objeù_»move
;

188 
	}
}

199 
Lay”
 *

200 
	$Ãw_Ïy”
(
gch¬
 *
Çme
, 
DŸg¿mD©a
 *
·»Á
)

202 
Lay”
 *
Ïy”
;

204 
Ïy”
 = 
	`g_Ãw
(
Lay”
, 1);

206 
Ïy”
->
Çme
 =‚ame;

208 
Ïy”
->
·»Á_dŸg¿m
 = 
·»Á
;

209 
Ïy”
->
visibË
 = 
TRUE
;

210 
Ïy”
->
cÚÃùabË
 = 
TRUE
;

212 
Ïy”
->
objeùs
 = 
NULL
;

213 
Ïy”
->
deâames
 = 
NULL
;

214 
Ïy”
->
ex‹Ás
.
Ëá
 = 0.0;

215 
Ïy”
->
ex‹Ás
.
right
 = 10.0;

216 
Ïy”
->
ex‹Ás
.
tİ
 = 0.0;

217 
Ïy”
->
ex‹Ás
.
bÙtom
 = 10.0;

220 
çùÜyCÚš”
->
curLay”
 = 
Ïy”
;

221  
Ïy”
;

222 
	}
}

229 
	$Ïy”_de¡roy
(
Lay”
 *
Ïy”
)

231 
	`g_ä“
(
Ïy”
->
Çme
);

232 
	`de¡roy_objeù_li¡
(
Ïy”
->
objeùs
);

233 
	`g_ä“
(
Ïy”
);

234 
	}
}

242 
	$d©a_¿i£_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
)

244 
gušt
 
i
;

245 
gušt
 
Ïy”_Ä
 = 0;

246 
Lay”
 *
tmp
;

248 
i
=0;i<
d©a
->
Ïy”s
->
Ën
;i++) {

249 ià(
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
)==
Ïy”
)

250 
Ïy”_Ä
 = 
i
;

253 ià(
Ïy”_Ä
 < 
d©a
->
Ïy”s
->
Ën
-1) {

254 
tmp
 = 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
Ïy”_Ä
+1);

255 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
Ïy”_Ä
+1) =

256 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
Ïy”_Ä
);

257 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
Ïy”_Ä
èğ
tmp
;

259 
	}
}

267 
	$d©a_low”_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
)

269 
gušt
 
i
;

270 
Ïy”_Ä
 = -1;

271 
Lay”
 *
tmp
;

273 
i
=0;i<
d©a
->
Ïy”s
->
Ën
;i++) {

274 ià(
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
)==
Ïy”
)

275 
Ïy”_Ä
 = 
i
;

278 
	`g_as£¹
(
Ïy”_Ä
>=0);

280 ià(
Ïy”_Ä
 > 0) {

281 
tmp
 = 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
Ïy”_Ä
-1);

282 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
Ïy”_Ä
-1) =

283 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
Ïy”_Ä
);

284 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
Ïy”_Ä
èğ
tmp
;

286 
	}
}

293 
	$d©a_add_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
)

295 
	`g_±r_¬¿y_add
(
d©a
->
Ïy”s
, 
Ïy”
);

296 
Ïy”
->
·»Á_dŸg¿m
 = 
d©a
;

297 
	`Ïy”_upd©e_ex‹Ás
(
Ïy”
);

298 
	`d©a_upd©e_ex‹Ás
(
d©a
);

299 
	}
}

302 
	$d©a_add_Ïy”_©
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
, 
pos
)

304 
Ën
;

305 
i
;

307 
	`g_±r_¬¿y_add
(
d©a
->
Ïy”s
, 
Ïy”
);

308 
Ën
 = 
d©a
->
Ïy”s
->len;

310 iàĞ(
pos
>=0è&& (po < 
Ën
)) {

311 
i
=
Ën
-1;i>
pos
;i--) {

312 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
) = g_ptr_array_index(data->layers, i-1);

314 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
pos
èğ
Ïy”
;

317 
Ïy”
->
·»Á_dŸg¿m
 = 
d©a
;

318 
	`Ïy”_upd©e_ex‹Ás
(
Ïy”
);

319 
	`d©a_upd©e_ex‹Ás
(
d©a
);

320 
	}
}

323 
	$d©a_Ïy”_g‘_šdex
 (cÚ¡ 
DŸg¿mD©a
 *
d©a
, cÚ¡ 
Lay”
 *
Ïy”
)

325 
Ën
;

326 
i
;

328 
Ën
 = 
d©a
->
Ïy”s
->len;

329 
i
=0;i<
Ën
;++i) {

330 ià(
Ïy”
 =ğ
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
))

331  
i
;

334 
	}
}

342 
	$d©a_£t_aùive_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
)

344 
çùÜyCÚš”
->
curLay”
 = 
Ïy”
;

345 
d©a
->
aùive_Ïy”
 = 
Ïy”
;

346 
	}
}

354 
	$d©a_d–‘e_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
)

356 ià(
d©a
->
Ïy”s
->
Ën
<=1)

359 ià(
d©a
->
aùive_Ïy”
 =ğ
Ïy”
) {

360 
	`d©a_»move_®l_£Ëùed
(
d©a
);

362 
Ïy”
->
·»Á_dŸg¿m
 = 
NULL
;

363 
	`g_±r_¬¿y_»move
(
d©a
->
Ïy”s
, 
Ïy”
);

365 ià(
d©a
->
aùive_Ïy”
 =ğ
Ïy”
) {

366 
d©a
->
aùive_Ïy”
 = 
	`g_±r_¬¿y_šdex
(d©a->
Ïy”s
, 0);

368 
	}
}

378 
	$d©a_£Ëù
(
DŸg¿mD©a
 *
d©a
, 
DŸObjeù
 *
obj
)

380 ià(
	`g_li¡_fšd
 (
d©a
->
£Ëùed
, 
obj
))

382 
d©a
->
£Ëùed
 = 
	`g_li¡_´•’d
(d©a->£Ëùed, 
obj
);

383 
d©a
->
£Ëùed_couÁ_´iv©e
++;

384 
	}
}

394 
	$d©a_un£Ëù
(
DŸg¿mD©a
 *
d©a
, 
DŸObjeù
 *
obj
)

396 ià(!
	`g_li¡_fšd
 (
d©a
->
£Ëùed
, 
obj
))

398 
d©a
->
£Ëùed
 = 
	`g_li¡_»move
(d©a->£Ëùed, 
obj
);

399 
d©a
->
£Ëùed_couÁ_´iv©e
--;

400 
	}
}

407 
	$d©a_»move_®l_£Ëùed
(
DŸg¿mD©a
 *
d©a
)

409 
	`g_li¡_ä“
(
d©a
->
£Ëùed
);

410 
d©a
->
£Ëùed
 = 
NULL
;

411 
d©a
->
£Ëùed_couÁ_´iv©e
 = 0;

412 
	}
}

418 
gboŞ—n


419 
	$d©a_has_visibË_Ïy”s
(
DŸg¿mD©a
 *
d©a
)

421 
gušt
 
i
;

422 
i
 = 0; i < 
d©a
->
Ïy”s
->
Ën
; i++) {

423 
Lay”
 *
Ïy”
 = 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
);

424 ià(
Ïy”
->
visibË
è 
TRUE
;

426  
FALSE
;

427 
	}
}

433 
	$d©a_g‘_Ïy”s_ex‹Ás_uniÚ
(
DŸg¿mD©a
 *
d©a
)

435 
gušt
 
i
;

436 
gboŞ—n
 
fœ¡
 = 
TRUE
;

437 
ReùªgË
 
Ãw_ex‹Ás
;

439  
i
 = 0 ; i<
d©a
->
Ïy”s
->
Ën
; i++) {

440 
Lay”
 *
Ïy”
 = 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
);

441 ià(!
Ïy”
->
visibË
) ;

443 
	`Ïy”_upd©e_ex‹Ás
(
Ïy”
);

445 ià(
fœ¡
) {

446 
Ãw_ex‹Ás
 = 
Ïy”
->
ex‹Ás
;

447 
fœ¡
 = 
	`»ùªgË_equ®s
(&
Ãw_ex‹Ás
,&
šv®id_ex‹Ás
);

449 ià(!
	`»ùªgË_equ®s
(&
Ïy”
->
ex‹Ás
,&
šv®id_ex‹Ás
)) {

450 
	`»ùªgË_uniÚ
(&
Ãw_ex‹Ás
, &
Ïy”
->
ex‹Ás
);

455 
d©a
->
ex‹Ás
 = 
Ãw_ex‹Ás
;

456 
	}
}

464 
	$d©a_ad­t_sÿlšg_to_ex‹Ás
(
DŸg¿mD©a
 *
d©a
)

466 
gdoubË
 
pwidth
 = 
d©a
->
·³r
.
width
 * d©a->·³r.
sÿlšg
;

467 
gdoubË
 
pheight
 = 
d©a
->
·³r
.
height
 * d©a->·³r.
sÿlšg
;

469 
gdoubË
 
xsÿË
 = 
d©a
->
·³r
.
f™width
 * 
pwidth
 /

470 (
d©a
->
ex‹Ás
.
right
 - d©a->ex‹Ás.
Ëá
);

471 
gdoubË
 
ysÿË
 = 
d©a
->
·³r
.
f™height
 * 
pheight
 /

472 (
d©a
->
ex‹Ás
.
bÙtom
 - d©a->ex‹Ás.
tİ
);

474 
d©a
->
·³r
.
sÿlšg
 = ()
	`MIN
(
xsÿË
, 
ysÿË
);

475 
d©a
->
·³r
.
width
 = ()(
pwidth
 / d©a->·³r.
sÿlšg
);

476 
d©a
->
·³r
.
height
 = ()(
pheight
 / d©a->·³r.
sÿlšg
);

477 
	}
}

483 
gboŞ—n


484 
	$d©a_compu‹_ex‹Ás
(
DŸg¿mD©a
 *
d©a
)

486 
ReùªgË
 
Şd_ex‹Ás
 = 
d©a
->
ex‹Ás
;

488 ià(!
	`d©a_has_visibË_Ïy”s
(
d©a
)) {

489 ià(
d©a
->
Ïy”s
->
Ën
 > 0) {

490 
Lay”
 *
Ïy”
 = 
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 0);

491 
	`Ïy”_upd©e_ex‹Ás
(
Ïy”
);

493 
d©a
->
ex‹Ás
 = 
Ïy”
->extents;

495 
d©a
->
ex‹Ás
 = 
šv®id_ex‹Ás
;

498 
	`d©a_g‘_Ïy”s_ex‹Ás_uniÚ
(
d©a
);

501 ià(
	`»ùªgË_equ®s
(&
d©a
->
ex‹Ás
,&
šv®id_ex‹Ás
)) {

502 
d©a
->
ex‹Ás
.
Ëá
 = 0.0;

503 
d©a
->
ex‹Ás
.
right
 = 10.0;

504 
d©a
->
ex‹Ás
.
tİ
 = 0.0;

505 
d©a
->
ex‹Ás
.
bÙtom
 = 10.0;

507  (!
	`»ùªgË_equ®s
(&
d©a
->
ex‹Ás
,&
Şd_ex‹Ás
));

508 
	}
}

514 
gboŞ—n


515 
	$d©a_upd©e_ex‹Ás
(
DŸg¿mD©a
 *
d©a
)

518 
gboŞ—n
 
chªged
;

520 
chªged
 = 
	`d©a_compu‹_ex‹Ás
(
d©a
);

521 ià(
chªged
 && 
d©a
->
·³r
.
f™to
è
	`d©a_ad­t_sÿlšg_to_ex‹Ás
(data);

523  
chªged
;

524 
	}
}

532 
GLi¡
 *

533 
	$d©a_g‘_sÜ‹d_£Ëùed
(
DŸg¿mD©a
 *
d©a
)

535 
GLi¡
 *
li¡
;

536 
GLi¡
 *
sÜ‹d_li¡
;

537 
GLi¡
 *
found
;

538 
DŸObjeù
 *
obj
;

540 
	`g_as£¹
 (
	`g_li¡_Ëngth
 (
d©a
->
£Ëùed
è=ğd©a->
£Ëùed_couÁ_´iv©e
);

541 ià(
d©a
->
£Ëùed_couÁ_´iv©e
 == 0)

542  
NULL
;

544 
sÜ‹d_li¡
 = 
NULL
;

545 
li¡
 = 
	`g_li¡_Ï¡
(
d©a
->
aùive_Ïy”
->
objeùs
);

546 
li¡
 !ğ
NULL
) {

547 
found
 = 
	`g_li¡_fšd
(
d©a
->
£Ëùed
, 
li¡
->data);

548 ià(
found
) {

549 
obj
 = (
DŸObjeù
 *)
found
->
d©a
;

550 
sÜ‹d_li¡
 = 
	`g_li¡_´•’d
(sÜ‹d_li¡, 
obj
);

552 
li¡
 = 
	`g_li¡_´evious
(list);

555  
sÜ‹d_li¡
;

556 
	}
}

565 
GLi¡
 *

566 
	$d©a_g‘_sÜ‹d_£Ëùed_»move
(
DŸg¿mD©a
 *
d©a
)

568 
GLi¡
 *
li¡
,*
tmp
;

569 
GLi¡
 *
sÜ‹d_li¡
;

570 
GLi¡
 *
found
;

571 
DŸObjeù
 *
obj
;

573 
	`g_as£¹
 (
	`g_li¡_Ëngth
 (
d©a
->
£Ëùed
è=ğd©a->
£Ëùed_couÁ_´iv©e
);

574 ià(
d©a
->
£Ëùed_couÁ_´iv©e
 == 0)

575  
NULL
;

577 
sÜ‹d_li¡
 = 
NULL
;

578 
li¡
 = 
	`g_li¡_Ï¡
(
d©a
->
aùive_Ïy”
->
objeùs
);

579 
li¡
 !ğ
NULL
) {

580 
found
 = 
	`g_li¡_fšd
(
d©a
->
£Ëùed
, 
li¡
->data);

581 ià(
found
) {

582 
obj
 = (
DŸObjeù
 *)
found
->
d©a
;

583 
sÜ‹d_li¡
 = 
	`g_li¡_´•’d
(sÜ‹d_li¡, 
obj
);

585 
tmp
 = 
li¡
;

586 
li¡
 = 
	`g_li¡_´evious
(list);

587 
d©a
->
aùive_Ïy”
->
objeùs
 =

588 
	`g_li¡_»move_lšk
(
d©a
->
aùive_Ïy”
->
objeùs
, 
tmp
);

590 
li¡
 = 
	`g_li¡_´evious
(list);

594  
sÜ‹d_li¡
;

595 
	}
}

605 
	$d©a_em™
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
, 
DŸObjeù
* 
obj
,

606 cÚ¡ *
sigÇl_Çme
)

609 ià(
	`¡rcmp
("objeù_add",
sigÇl_Çme
) == 0)

610 
	`g_sigÇl_em™
(
d©a
, 
dŸg¿m_d©a_sigÇls
[
OBJECT_ADD
], 0, 
Ïy”
, 
obj
);

612 ià(
	`¡rcmp
("objeù_»move",
sigÇl_Çme
) == 0)

613 
	`g_sigÇl_em™
(
d©a
, 
dŸg¿m_d©a_sigÇls
[
OBJECT_REMOVE
], 0, 
Ïy”
, 
obj
);

615 
	}
}

627 
	$d©a_»nd”
(
DŸg¿mD©a
 *
d©a
, 
DŸR’d””
 *
»nd””
, 
ReùªgË
 *
upd©e
,

628 
ObjeùR’d””
 
obj_»nd””
,

629 
gpoš‹r
 
gd©a
)

631 
Lay”
 *
Ïy”
;

632 
gušt
 
i
, 
aùive_Ïy”
;

634 ià(!
»nd””
->
is_š‹¿ùive
)

635 (
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
begš_»nd”
)(renderer);

637 
i
=0; i<
d©a
->
Ïy”s
->
Ën
; i++) {

638 
Ïy”
 = (
Lay”
 *è
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
);

639 
aùive_Ïy”
 = (
Ïy”
 =ğ
d©a
->active_layer);

640 ià(
Ïy”
->
visibË
)

641 
	`Ïy”_»nd”
(
Ïy”
, 
»nd””
, 
upd©e
, 
obj_»nd””
, 
gd©a
, 
aùive_Ïy”
);

644 ià(!
»nd””
->
is_š‹¿ùive
)

645 (
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
’d_»nd”
)(renderer);

646 
	}
}

649 
	$d©a_fÜ—ch_objeù
 (
DŸg¿mD©a
 *
d©a
, 
GFunc
 
func
, 
gpoš‹r
 
u£r_d©a
)

651 
Lay”
 *
Ïy”
;

652 
gušt
 
i
;

653 
i
=0; i<
d©a
->
Ïy”s
->
Ën
; i++) {

654 
Ïy”
 = (
Lay”
 *è
	`g_±r_¬¿y_šdex
(
d©a
->
Ïy”s
, 
i
);

655 
	`g_li¡_fÜ—ch
 (
Ïy”
->
objeùs
, 
func
, 
u£r_d©a
);

657 
	}
}

	@O:\tool\dvs50\lib\diagramdata.h

19 #iâdeà
DIAGRAMDATA_H


20 
	#DIAGRAMDATA_H


	)

22 
	~<glib.h
>

23 
	~<¡ršg.h
>

25 
	~"dŸty³s.h
"

26 
	~"cŞÜ.h
"

27 
	~"geom‘ry.h
"

28 
	~"dŸv¬.h
"

29 
	~"·³r.h
"

31 
G_BEGIN_DECLS


36 
	s_NewDŸg¿mD©a
 {

37 
gch¬
 *
	m·³¹y³
;

38 
gæßt
 
	mtm¬gš
, 
	mbm¬gš
, 
	mlm¬gš
, 
	mrm¬gš
;

39 
gboŞ—n
 
	mis_pÜŒa™
;

40 
gæßt
 
	msÿlšg
;

41 
gboŞ—n
 
	mf™to
;

42 
gšt
 
	mf™width
, 
	mf™height
;

43 
CŞÜ
 
	mbg_cŞÜ
, 
	m·geb»ak_cŞÜ
, 
	mgrid_cŞÜ
;

44 
	mcom´ess_§ve
;

45 
gch¬
 *
	mun™
, *
	mfÚt_un™
;

48 
DIAVAR
 
GTy³
 
	$dŸg¿m_d©a_g‘_ty³
 (è
G_GNUC_CONST
;

50 
	#DIA_TYPE_DIAGRAM_DATA
 (
	`dŸg¿m_d©a_g‘_ty³
 ())

	)

51 
	#DIA_DIAGRAM_DATA
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_DIAGRAM_DATA
, 
DŸg¿mD©a
))

	)

52 
	#DIA_DIAGRAM_DATA_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_DIAGRAM_DATA
, 
DŸg¿mD©aCÏss
))

	)

53 
	#DIA_IS_DIAGRAM_DATA
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_DIAGRAM_DATA
))

	)

54 
	#DIA_DIAGRAM_DATA_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_DIAGRAM_DATA
, 
DŸg¿mD©aCÏss
))

	)

59 
	s_DŸg¿mD©a
 {

60 
GObjeù
 
·»Á_š¡ªû
;

62 
ReùªgË
 
ex‹Ás
;

64 
CŞÜ
 
bg_cŞÜ
;

66 
P­”Info
 
·³r
;

67 
gboŞ—n
 
is_com´es£d
;

70 
GPŒA¼ay
 *
Ïy”s
;

71 
Lay”
 *
aùive_Ïy”
;

73 
gušt
 
£Ëùed_couÁ_´iv©e
;

74 
GLi¡
 *
£Ëùed
;

79 
GLi¡
 *
‹xt_ed™s
;

81 
gch¬
 *
un™
, *
fÚt_un™
;

84 
Focus
 *
aùive_‹xt_ed™
;

90 
	s_DŸg¿mD©aCÏss
 {

91 
GObjeùCÏss
 
·»Á_şass
;

94 (* 
objeù_add
è(
DŸg¿mD©a
*, 
Lay”
*, 
DŸObjeù
*);

95 (* 
objeù_»move
è(
DŸg¿mD©a
*, 
Lay”
*, 
DŸObjeù
*);

97 } 
	tDŸg¿mD©aCÏss
;

104 
	s_Lay”
 {

105 *
Çme
;

106 
ReùªgË
 
ex‹Ás
;

108 
GLi¡
 *
objeùs
;

113 
gboŞ—n
 
visibË
;

114 
gboŞ—n
 
cÚÃùabË
;

117 
DŸg¿mD©a
 *
·»Á_dŸg¿m
;

121 
GLi¡
 *
deâames
;

124 
DIAVAR
 
Lay”
 *
	`Ãw_Ïy”
 (*
Çme
, 
DŸg¿mD©a
 *
·»Á
);

125 
DIAVAR
 
	`Ïy”_de¡roy
(
Lay”
 *
Ïy”
);

127 
DIAVAR
 
	`d©a_¿i£_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
);

128 
DIAVAR
 
	`d©a_low”_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
);

130 
DIAVAR
 
	`d©a_add_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
);

131 
DIAVAR
 
	`d©a_add_Ïy”_©
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
, 
pos
);

132 
DIAVAR
 
	`d©a_£t_aùive_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
);

133 
DIAVAR
 
	`d©a_d–‘e_Ïy”
(
DŸg¿mD©a
 *
d©a
, 
Lay”
 *
Ïy”
);

134 
DIAVAR
 
	`d©a_Ïy”_g‘_šdex
 (cÚ¡ 
DŸg¿mD©a
 *
d©a
, cÚ¡ 
Lay”
 *
Ïy”
);

136 
DIAVAR
 
	`d©a_£Ëù
(
DŸg¿mD©a
 *
d©a
, 
DŸObjeù
 *
obj
);

137 
DIAVAR
 
	`d©a_un£Ëù
(
DŸg¿mD©a
 *
d©a
, 
DŸObjeù
 *
obj
);

138 
DIAVAR
 
	`d©a_»move_®l_£Ëùed
(
DŸg¿mD©a
 *
d©a
);

139 
DIAVAR
 
gboŞ—n
 
	`d©a_upd©e_ex‹Ás
(
DŸg¿mD©a
 *
d©a
);

140 
DIAVAR
 
GLi¡
 *
	`d©a_g‘_sÜ‹d_£Ëùed
(
DŸg¿mD©a
 *
d©a
);

141 
DIAVAR
 
GLi¡
 *
	`d©a_g‘_sÜ‹d_£Ëùed_»move
(
DŸg¿mD©a
 *
d©a
);

142 
DIAVAR
 
	`d©a_£t_un™
(
DŸg¿mD©a
 *
d©a
, 
gch¬
 *
un™
);

143 
DIAVAR
 
gch¬
 *
	`d©a_g‘_un™
(
DŸg¿mD©a
 *
d©a
);

144 
DIAVAR
 
	`d©a_g‘_un™_muÉl›r
(
DŸg¿mD©a
 *
d©a
);

145 
DIAVAR
 
	`d©a_£t_fÚt_un™
(
DŸg¿mD©a
 *
d©a
, 
gch¬
 *
un™
);

146 
DIAVAR
 
gch¬
 *
	`d©a_g‘_fÚt_un™
(
DŸg¿mD©a
 *
d©a
);

147 
DIAVAR
 
	`d©a_g‘_fÚt_un™_muÉl›r
(
DŸg¿mD©a
 *
d©a
);

148 
DIAVAR
 
	`d©a_em™
(
DŸg¿mD©a
 *
d©a
,
Lay”
 *
Ïy”
,
DŸObjeù
* 
obj
,cÚ¡ *
sigÇl_Çme
);

150 
DIAVAR
 
	`d©a_fÜ—ch_objeù
 (
DŸg¿mD©a
 *
d©a
, 
GFunc
 
func
, 
gpoš‹r
 
u£r_d©a
);

153 (*
	tObjeùR’d””
)(
	tDŸObjeù
 *
	tobj
, 
	tDŸR’d””
 *
	t»nd””
,

154 
	taùive_Ïy”
,

155 
	tgpoš‹r
 
	td©a
);

156 
DIAVAR
 
	`d©a_»nd”
(
DŸg¿mD©a
 *
d©a
, 
DŸR’d””
 *
»nd””
, 
ReùªgË
 *
upd©e
,

157 
ObjeùR’d””
 
obj_»nd””
 ,

158 
gpoš‹r
 
gd©a
);

159 
DIAVAR
 
	`Ïy”_»nd”
(
Lay”
 *
Ïy”
, 
DŸR’d””
 *
»nd””
, 
ReùªgË
 *
upd©e
,

160 
ObjeùR’d””
 
obj_»nd””
 ,

161 
gpoš‹r
 
d©a
,

162 
aùive_Ïy”
);

164 
DIAVAR
 
	`Ïy”_objeù_šdex
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
obj
);

165 
DIAVAR
 
	`Ïy”_add_objeù
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
obj
);

166 
DIAVAR
 
	`Ïy”_add_objeù_©
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
obj
, 
pos
);

167 
DIAVAR
 
	`Ïy”_add_objeùs
(
Lay”
 *
Ïy”
, 
GLi¡
 *
obj_li¡
);

168 
DIAVAR
 
	`Ïy”_add_objeùs_fœ¡
(
Lay”
 *
Ïy”
, 
GLi¡
 *
obj_li¡
);

169 
DIAVAR
 
	`Ïy”_»move_objeù
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
obj
);

170 
DIAVAR
 
	`Ïy”_»move_objeùs
(
Lay”
 *
Ïy”
, 
GLi¡
 *
obj_li¡
);

171 
DIAVAR
 
GLi¡
 *
	`Ïy”_fšd_objeùs_š‹r£ùšg_»ùªgË
(
Lay”
 *
Ïy”
, 
ReùªgË
*
»ù
);

172 
DIAVAR
 
GLi¡
 *
	`Ïy”_fšd_objeùs_š_»ùªgË
(
Lay”
 *
Ïy”
, 
ReùªgË
 *
»ù
);

173 
DIAVAR
 
GLi¡
 *
	`Ïy”_fšd_objeùs_cÚššg_»ùªgË
(
Lay”
 *
Ïy”
, 
ReùªgË
 *
»ù
);

174 
DIAVAR
 
DŸObjeù
 *
	`Ïy”_fšd_şo£¡_objeù
(
Lay”
 *
Ïy”
, 
Pošt
 *
pos
, 
»®
 
maxdi¡
);

175 
DIAVAR
 
DŸObjeù
 *
	`Ïy”_fšd_şo£¡_objeù_exû±
(
Lay”
 *
Ïy”
, 
Pošt
 *
pos
,

176 
»®
 
maxdi¡
, 
GLi¡
 *
avoid
);

177 
DIAVAR
 
»®
 
	`Ïy”_fšd_şo£¡_cÚÃùiÚpošt
(
Lay”
 *
Ïy”
,

178 
CÚÃùiÚPošt
 **
şo£¡
,

179 
Pošt
 *
pos
,

180 
DŸObjeù
 *
nÙthis
);

181 
DIAVAR
 
	`Ïy”_upd©e_ex‹Ás
(
Lay”
 *
Ïy”
);

182 
DIAVAR
 
	`Ïy”_»¶aû_objeù_w™h_li¡
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
obj
,

183 
GLi¡
 *
li¡
);

184 
DIAVAR
 
	`Ïy”_£t_objeù_li¡
(
Lay”
 *
Ïy”
, 
GLi¡
 *
li¡
);

185 
DIAVAR
 
DŸg¿mD©a
 *
	`Ïy”_g‘_·»Á_dŸg¿m
(
Lay”
 *
Ïy”
);

189 
G_END_DECLS


	@O:\tool\dvs50\lib\diainteractiverenderer.c

23 
	~"dŸ»nd””.h
"

26 
	$dŸ_š‹¿ùive_»nd””_içû_š™
 (
DŸIÁ”aùiveR’d””IÁ”çû
 *
içû
)

29 
içû
->
ş_»giÚ_ş—r
 = 
NULL
;

30 
içû
->
ş_»giÚ_add_»ù
 = 
NULL
;

31 
içû
->
d¿w_pix–_lše
 = 
NULL
;

32 
içû
->
d¿w_pix–_»ù
 = 
NULL
;

33 
içû
->
fl_pix–_»ù
 = 
NULL
;

34 
içû
->
cİy_to_wšdow
 = 
NULL
;

35 
içû
->
£t_size
 = 
NULL
;

36 
	}
}

38 
GTy³


39 
	$dŸ_š‹¿ùive_»nd””_š‹rçû_g‘_ty³
 ()

41 
GTy³
 
içû_ty³
 = 0;

43 ià(!
içû_ty³
)

45 cÚ¡ 
GTy³Info
 
içû_šfo
 =

47  (
DŸIÁ”aùiveR’d””IÁ”çû
),

48 (
GBa£In™Func
è
dŸ_š‹¿ùive_»nd””_içû_š™
,

49 (
GBa£Fš®izeFunc
è
NULL
,

52 
içû_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
G_TYPE_INTERFACE
,

54 &
içû_šfo
,

57 
	`g_ty³_š‹rçû_add_´”equis™e
 (
içû_ty³
,

58 
DIA_TYPE_RENDERER
);

61  
içû_ty³
;

62 
	}
}

68 
	$dŸ_»nd””_£t_size
 (
DŸR’d””
* 
»nd””
, 
gpoš‹r
 
wšdow
,

69 
width
, 
height
)

71 
DŸIÁ”aùiveR’d””IÁ”çû
 *
œ’d””
 =

72 
	`DIA_GET_INTERACTIVE_RENDERER_INTERFACE
 (
»nd””
);

74 
	`g_»tuº_if_ç
 (
œ’d””
 !ğ
NULL
);

75 
	`g_»tuº_if_ç
 (
œ’d””
->
£t_size
 !ğ
NULL
);

77 
œ’d””
->
	`£t_size
 (
»nd””
, 
wšdow
, 
width
, 
height
);

78 
	}
}

	@O:\tool\dvs50\lib\dialib.c

19 
	~<cÚfig.h
>

21 
	~<¡dio.h
>

22 
	~<¡dlib.h
>

23 
	~<¡ršg.h
>

24 
	~<glib.h
>

25 
	~<gtk/gtk.h
>

27 
	~<libxml/xmË¼Ü.h
>

29 
	~"dŸlib.h
"

30 
	~"mes§ge.h
"

31 
	~"uts.h
"

32 
	~"dŸ_image.h
"

33 
	~"cŞÜ.h
"

34 
	~"objeù.h
"

35 
	~"dŸ_dœs.h
"

38 
	$¡d”r_mes§ge_š‹º®
(cÚ¡ *
t™Ë
, 
ShowAgašStyË
 
showAgaš
,

39 cÚ¡ *
fmt
, 
va_li¡
 *
¬gs
, va_li¡ *
¬gs2
)

41 
gch¬
 *
buf
 = 
NULL
;

42 
gšt
 
®loc
 = 0;

43 
gšt
 
Ën
;

45 
Ën
 = 
	`fÜm©_¡ršg_Ëngth_uµ”_bound
 (
fmt
, 
¬gs
);

47 ià(
Ën
 >ğ
®loc
) {

48 ià(
buf
)

49 
	`g_ä“
 (
buf
);

51 
®loc
 = 
	`Ã¬e¡_pow
 (
	`MAX
(
Ën
 + 1, 1024));

53 
buf
 = 
	`g_Ãw
 (, 
®loc
);

56 
	`v¥rštf
 (
buf
, 
fmt
, *
¬gs2
);

58 
	`årštf
(
¡d”r
,

60 
t™Ë
,
buf
);

61 
	}
}

63 #ifdeà
G_OS_WIN32


65 
	$myXmlE¼ÜR•Ütšg
 (*
ùx
, cÚ¡ * 
msg
, ...)

67 
va_li¡
 
¬gs
;

68 
gch¬
 *
¡ršg
;

70 
	`va_¡¬t
(
¬gs
, 
msg
);

71 
¡ršg
 = 
	`g_¡rdup_v´štf
 (
msg
, 
¬gs
);

72 
	`g_´št
 ("%s", 
¡ršg
 ? string : "xmlƒrror (null)?");

73 
	`va_’d
(
¬gs
);

75 
	`g_ä“
(
¡ršg
);

76 
	}
}

86 
	$libdŸ_š™
 (
gušt
 
æags
)

88 
gboŞ—n
 
š™Ÿlized
 = 
FALSE
;

90 ià(
š™Ÿlized
)

93 ià(
æags
 & 
DIA_MESSAGE_STDERR
)

94 
	`£t_mes§ge_func
(
¡d”r_mes§ge_š‹º®
);

95 
LIBXML_TEST_VERSION
;

97 #ifdeà
G_OS_WIN32


98 
	`xmlS‘G’”icE¼ÜFunc
(
NULL
, 
myXmlE¼ÜR•Ütšg
);

101 ià(
æags
 & 
DIA_VERBOSE
) {

102 
	`dŸ_log_mes§ge_’abË
 (
FALSE
);

103 
	`dŸ_log_mes§ge
 ("initializing†ibdia");

105 
	`¡d´İs_š™
();

107 ià(
æags
 & 
DIA_INTERACTIVE
) {

108 *
dŸgtkrc
;

110 
	`dŸ_image_š™
();

112 
	`gdk_rgb_š™
();

114 
dŸgtkrc
 = 
	`dŸ_cÚfig_f’ame
("diagtkrc");

115 
	`dŸ_log_mes§ge
 ("CÚfig from %s", 
dŸgtkrc
);

116 
	`gtk_rc_·r£
(
dŸgtkrc
);

117 
	`g_ä“
(
dŸgtkrc
);

119 
	`cŞÜ_š™
();

121 
š™Ÿlized
 = 
TRUE
;

123 
	`objeù_»gi¡ry_š™
();

124 
	}
}

	@O:\tool\dvs50\lib\dialib.h

1 #iâdeà
LIBDIA_H


2 
	#LIBDIA_H


	)

4 
	~<glib.h
>

5 
	~"dŸv¬.h
"

7 
G_BEGIN_DECLS


9 
	eDŸIn™FÏgs


11 
	mDIA_INTERACTIVE
 = (1<<0),

12 
	mDIA_MESSAGE_STDERR
 = (1<<1),

13 
	mDIA_VERBOSE
 = (1<<2)

16 
DIAVAR
 
libdŸ_š™
 (
gušt
 
æags
);

18 
	gG_END_DECLS


	@O:\tool\dvs50\lib\dialinechooser.c

22 #ifdeà
HAVE_CONFIG_H


23 
	~<cÚfig.h
>

26 
	~"š.h
"

27 
	~"widg‘s.h
"

28 
	~"dŸlšechoo£r.h
"

30 cÚ¡ *
	gbu‰Ú_m’u_key
 = "dia-button-menu";

31 cÚ¡ *
	gm’u™em_’um_key
 = "dia-menuitem-value";

36 
dŸ_lše_´ev›w_£t
(
DŸLšeP»v›w
 *
lše
, 
LšeStyË
 
l¡yË
);

38 
dŸ_lše_´ev›w_şass_š™
 (
DŸLšeP»v›wCÏss
 *
kÏss
);

39 
dŸ_lše_´ev›w_š™
 (
DŸLšeP»v›w
 *
¬row
);

40 
gšt
 
dŸ_lše_´ev›w_expo£
 (
GtkWidg‘
 *
widg‘
,

41 
GdkEv’tExpo£
 *
ev’t
);

43 
GTy³


44 
	$dŸ_lše_´ev›w_g‘_ty³
 ()

46 
GTy³
 
ty³
 = 0;

48 ià(!
ty³
) {

49 cÚ¡ 
GTy³Info
 
šfo
 = {

50  (
DŸLšeP»v›wCÏss
),

51 (
GBa£In™Func
è
NULL
,

52 (
GBa£Fš®izeFunc
è
NULL
,

53 (
GCÏssIn™Func
è
dŸ_lše_´ev›w_şass_š™
,

54 (
GCÏssFš®izeFunc
è
NULL
,

55 
NULL
,

56  (
DŸLšeP»v›w
),

58 (
GIn¡ªûIn™Func
è
dŸ_lše_´ev›w_š™


61 
ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
GTK_TYPE_MISC
, "DŸLšeP»v›w", &
šfo
, 0);

64  
ty³
;

65 
	}
}

68 
	$dŸ_lše_´ev›w_şass_š™
 (
DŸLšeP»v›wCÏss
 *
şass
)

70 
GtkWidg‘CÏss
 *
widg‘_şass
;

72 
widg‘_şass
 = 
	`GTK_WIDGET_CLASS
(
şass
);

73 
widg‘_şass
->
expo£_ev’t
 = 
dŸ_lše_´ev›w_expo£
;

74 
	}
}

77 
	$dŸ_lše_´ev›w_š™
 (
DŸLšeP»v›w
 *
lše
)

79 
	`GTK_WIDGET_SET_FLAGS
 (
lše
, 
GTK_NO_WINDOW
);

81 
	`GTK_WIDGET
 (
lše
)->
»quis™iÚ
.
width
 = 30 + 
	`GTK_MISC
 (lše)->
x·d
 * 2;

82 
	`GTK_WIDGET
 (
lše
)->
»quis™iÚ
.
height
 = 15 + 
	`GTK_MISC
 (lše)->
y·d
 * 2;

84 
lše
->
l¡yË
 = 
LINESTYLE_SOLID
;

85 
	}
}

87 
GtkWidg‘
 *

88 
	$dŸ_lše_´ev›w_Ãw
 (
LšeStyË
 
l¡yË
)

90 
DŸLšeP»v›w
 *
lše
 = 
	`g_objeù_Ãw
(
DIA_TYPE_LINE_PREVIEW
, 
NULL
);

92 
lše
->
l¡yË
 =†style;

93  
	`GTK_WIDGET
(
lše
);

94 
	}
}

97 
	$dŸ_lše_´ev›w_£t
(
DŸLšeP»v›w
 *
lše
, 
LšeStyË
 
l¡yË
)

99 ià(
lše
->
l¡yË
 !=†style) {

100 
lše
->
l¡yË
 =†style;

101 ià(
	`GTK_WIDGET_DRAWABLE
(
lše
))

102 
	`gtk_widg‘_queue_d¿w
(
	`GTK_WIDGET
(
lše
));

104 
	}
}

106 
gšt


107 
	$dŸ_lše_´ev›w_expo£
(
GtkWidg‘
 *
widg‘
, 
GdkEv’tExpo£
 *
ev’t
)

109 
DŸLšeP»v›w
 *
lše
 = 
	`DIA_LINE_PREVIEW
(
widg‘
);

110 
GtkMisc
 *
misc
 = 
	`GTK_MISC
(
widg‘
);

111 
gšt
 
width
, 
height
;

112 
gšt
 
x
, 
y
;

113 
gšt
 
ex‹Á
;

114 
GdkWšdow
 *
wš
;

115 
GdkGC
 *
gc
;

116 
GdkGCV®ues
 
gcv®ues
;

117 
gšt8
 
dash_li¡
[6];

118 
lše_width
 = 2;

120 ià(
	`GTK_WIDGET_DRAWABLE
(
widg‘
)) {

121 
width
 = 
widg‘
->
®loÿtiÚ
.width - 
misc
->
x·d
 * 2;

122 
height
 = 
widg‘
->
®loÿtiÚ
.heighˆ- 
misc
->
y·d
 * 2;

123 
ex‹Á
 = 
	`MIN
(
width
, 
height
);

124 
x
 = (
widg‘
->
®loÿtiÚ
.x + 
misc
->
x·d
);

125 
y
 = (
widg‘
->
®loÿtiÚ
.y + 
misc
->
y·d
);

127 
wš
 = 
widg‘
->
wšdow
;

128 
gc
 = 
widg‘
->
¡yË
->
fg_gc
[widg‘->
¡©e
];

131 
	`gdk_gc_g‘_v®ues
(
gc
, &
gcv®ues
);

132 
lše
->
l¡yË
) {

133 
LINESTYLE_SOLID
:

134 
	`gdk_gc_£t_lše_©Œibu‹s
(
gc
, 
lše_width
, 
GDK_LINE_SOLID
,

135 
gcv®ues
.
ÿp_¡yË
, gcv®ues.
još_¡yË
);

137 
LINESTYLE_DASHED
:

138 
	`gdk_gc_£t_lše_©Œibu‹s
(
gc
, 
lše_width
, 
GDK_LINE_ON_OFF_DASH
,

139 
gcv®ues
.
ÿp_¡yË
, gcv®ues.
još_¡yË
);

140 
dash_li¡
[0] = 10;

141 
dash_li¡
[1] = 10;

142 
	`gdk_gc_£t_dashes
(
gc
, 0, 
dash_li¡
, 2);

144 
LINESTYLE_DASH_DOT
:

145 
	`gdk_gc_£t_lše_©Œibu‹s
(
gc
, 
lše_width
, 
GDK_LINE_ON_OFF_DASH
,

146 
gcv®ues
.
ÿp_¡yË
, gcv®ues.
još_¡yË
);

147 
dash_li¡
[0] = 10;

148 
dash_li¡
[1] = 4;

149 
dash_li¡
[2] = 2;

150 
dash_li¡
[3] = 4;

151 
	`gdk_gc_£t_dashes
(
gc
, 0, 
dash_li¡
, 4);

153 
LINESTYLE_DASH_DOT_DOT
:

154 
	`gdk_gc_£t_lše_©Œibu‹s
(
gc
, 
lše_width
, 
GDK_LINE_ON_OFF_DASH
,

155 
gcv®ues
.
ÿp_¡yË
, gcv®ues.
još_¡yË
);

156 
dash_li¡
[0] = 10;

157 
dash_li¡
[1] = 2;

158 
dash_li¡
[2] = 2;

159 
dash_li¡
[3] = 2;

160 
dash_li¡
[4] = 2;

161 
dash_li¡
[5] = 2;

162 
	`gdk_gc_£t_dashes
(
gc
, 0, 
dash_li¡
, 6);

164 
LINESTYLE_DOTTED
:

165 
	`gdk_gc_£t_lše_©Œibu‹s
(
gc
, 
lše_width
, 
GDK_LINE_ON_OFF_DASH
,

166 
gcv®ues
.
ÿp_¡yË
, gcv®ues.
još_¡yË
);

167 
dash_li¡
[0] = 2;

168 
dash_li¡
[1] = 2;

169 
	`gdk_gc_£t_dashes
(
gc
, 0, 
dash_li¡
, 2);

172 
	`gdk_d¿w_lše
(
wš
, 
gc
, 
x
, 
y
+
height
/2, x+
width
, y+height/2);

173 
	`gdk_gc_£t_lše_©Œibu‹s
(
gc
, 
gcv®ues
.
lše_width
, gcv®ues.
lše_¡yË
,

174 
gcv®ues
.
ÿp_¡yË
, gcv®ues.
još_¡yË
);

176  
TRUE
;

177 
	}
}

182 
dŸ_lše_choo£r_şass_š™
 (
DŸLšeChoo£rCÏss
 *
kÏss
);

183 
dŸ_lše_choo£r_š™
 (
DŸLšeChoo£r
 *
¬row
);

185 
GTy³


186 
	$dŸ_lše_choo£r_g‘_ty³
 ()

188 
GTy³
 
ty³
 = 0;

190 ià(!
ty³
) {

191 cÚ¡ 
GTy³Info
 
šfo
 = {

192  (
DŸLšeChoo£rCÏss
),

193 (
GBa£In™Func
è
NULL
,

194 (
GBa£Fš®izeFunc
è
NULL
,

195 (
GCÏssIn™Func
è
dŸ_lše_choo£r_şass_š™
,

196 (
GCÏssFš®izeFunc
è
NULL
,

197 
NULL
,

198  (
DŸLšeChoo£r
),

200 (
GIn¡ªûIn™Func
è
dŸ_lše_choo£r_š™


203 
ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
GTK_TYPE_BUTTON
, "DŸLšeChoo£r", &
šfo
, 0);

206  
ty³
;

207 
	}
}

209 
gšt


210 
	$dŸ_lše_choo£r_ev’t
(
GtkWidg‘
 *
widg‘
, 
GdkEv’t
 *
ev’t
)

212 ià(
ev’t
->
ty³
 =ğ
GDK_BUTTON_PRESS
 &&ƒv’t->
bu‰Ú
.button == 1) {

213 
GtkM’u
 *
m’u
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
widg‘
), 
bu‰Ú_m’u_key
);

214 
	`gtk_m’u_pİup
(
m’u
, 
NULL
, NULL, NULL, NULL,

215 
ev’t
->
bu‰Ú
.bu‰Ú,ƒv’t->bu‰Ú.
time
);

216  
TRUE
;

218  
FALSE
;

219 
	}
}

222 
	$dŸ_lše_choo£r_şass_š™
 (
DŸLšeChoo£rCÏss
 *
şass
)

224 
GtkWidg‘CÏss
 *
widg‘_şass
;

226 
widg‘_şass
 = 
	`GTK_WIDGET_CLASS
(
şass
);

227 
widg‘_şass
->
ev’t
 = 
dŸ_lše_choo£r_ev’t
;

228 
	}
}

231 
	$dŸ_lše_choo£r_dŸlog_»¥Ú£
 (
GtkWidg‘
 *
dŸlog
,

232 
gšt
 
»¥Ú£_id
,

233 
DŸLšeChoo£r
 *
lchoo£r
)

235 
LšeStyË
 
Ãw_¡yË
;

236 
»®
 
Ãw_dash
;

238 ià(
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
) {

239 
	`dŸ_lše_¡yË_£ËùÜ_g‘_lše¡yË
(
lchoo£r
->
£ËùÜ
,

240 &
Ãw_¡yË
, &
Ãw_dash
);

241 ià(
Ãw_¡yË
 !ğ
lchoo£r
->
l¡yË
 || 
Ãw_dash
 !ğlchoo£r->
dash_Ëngth
) {

242 
lchoo£r
->
l¡yË
 = 
Ãw_¡yË
;

243 
lchoo£r
->
dash_Ëngth
 = 
Ãw_dash
;

244 
	`dŸ_lše_´ev›w_£t
(
lchoo£r
->
´ev›w
, 
Ãw_¡yË
);

245 ià(
lchoo£r
->
ÿÎback
)

246 (* 
lchoo£r
->
ÿÎback
)(
Ãw_¡yË
, 
Ãw_dash
,†choo£r->
u£r_d©a
);

249 
	`dŸ_lše_¡yË_£ËùÜ_£t_lše¡yË
(
lchoo£r
->
£ËùÜ
,

250 
lchoo£r
->
l¡yË
,

251 
lchoo£r
->
dash_Ëngth
);

253 
	`gtk_widg‘_hide
(
lchoo£r
->
dŸlog
);

254 
	}
}

257 
	$dŸ_lše_choo£r_chªge_lše_¡yË
(
GtkM’uI‹m
 *
mi
, 
DŸLšeChoo£r
 *
lchoo£r
)

259 
LšeStyË
 
l¡yË
 = 
	`GPOINTER_TO_INT
(
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
mi
),

260 
m’u™em_’um_key
));

262 
	`dŸ_lše_choo£r_£t_lše_¡yË
(
lchoo£r
, 
l¡yË
,†choo£r->
dash_Ëngth
);

263 
	}
}

266 
	$dŸ_lše_choo£r_£t_lše_¡yË
(
DŸLšeChoo£r
 *
lchoo£r
,

267 
LšeStyË
 
l¡yË
,

268 
»®
 
dashËngth
)

270 ià(
l¡yË
 !ğ
lchoo£r
->lstyle) {

271 
	`dŸ_lše_´ev›w_£t
(
lchoo£r
->
´ev›w
, 
l¡yË
);

272 
lchoo£r
->
l¡yË
 =†style;

273 
	`dŸ_lše_¡yË_£ËùÜ_£t_lše¡yË
(
lchoo£r
->
£ËùÜ
,†choo£r->
l¡yË
,

274 
lchoo£r
->
dash_Ëngth
);

276 
lchoo£r
->
dash_Ëngth
 = 
dashËngth
;

277 ià(
lchoo£r
->
ÿÎback
)

278 (* 
lchoo£r
->
ÿÎback
)Öchoo£r->
l¡yË
,†choo£r->
dash_Ëngth
,

279 
lchoo£r
->
u£r_d©a
);

280 
	}
}

283 
	$dŸ_lše_choo£r_š™
 (
DŸLšeChoo£r
 *
lchoo£r
)

285 
GtkWidg‘
 *
wid
;

286 
GtkWidg‘
 *
m’u
, *
mi
, *
Ê
;

287 
gšt
 
i
;

289 
lchoo£r
->
l¡yË
 = 
LINESTYLE_SOLID
;

290 
lchoo£r
->
dash_Ëngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

292 
wid
 = 
	`dŸ_lše_´ev›w_Ãw
(
LINESTYLE_SOLID
);

293 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
lchoo£r
), 
wid
);

294 
	`gtk_widg‘_show
(
wid
);

295 
lchoo£r
->
´ev›w
 = 
	`DIA_LINE_PREVIEW
(
wid
);

297 
lchoo£r
->
dŸlog
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(
	`_
("Line Style Properties"),

298 
NULL
,

299 
GTK_DIALOG_NO_SEPARATOR
,

300 
GTK_STOCK_CANCEL
,

301 
GTK_RESPONSE_CANCEL
,

302 
GTK_STOCK_OK
,

303 
GTK_RESPONSE_OK
,

304 
NULL
);

305 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
	`GTK_DIALOG
(
lchoo£r
->
dŸlog
),

306 
GTK_RESPONSE_OK
);

307 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
lchoo£r
->
dŸlog
), "response",

308 
	`G_CALLBACK
(
dŸ_lše_choo£r_dŸlog_»¥Ú£
), 
lchoo£r
);

310 
wid
 = 
	`dŸ_lše_¡yË_£ËùÜ_Ãw
();

311 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
wid
), 5);

312 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
	`GTK_DIALOG
(
lchoo£r
->
dŸlog
)->
vbox
), 
wid
,

313 
TRUE
, TRUE, 0);

314 
	`gtk_widg‘_show
(
wid
);

315 
lchoo£r
->
£ËùÜ
 = 
	`DIALINESTYLESELECTOR
(
wid
);

317 
m’u
 = 
	`gtk_m’u_Ãw
();

318 #ià
	`GLIB_CHECK_VERSION
(2,10,0)

319 
	`g_objeù_»f_sšk
(
	`GTK_OBJECT
(
m’u
));

320 
	`g_objeù_£t_d©a_fuÎ
(
	`G_OBJECT
(
lchoo£r
), 
bu‰Ú_m’u_key
, 
m’u
,

321 (
GDe¡royNÙify
)
g_objeù_uÄef
);

323 
	`g_objeù_»f
(
	`G_OBJECT
(
m’u
));

324 
	`gtk_objeù_sšk
(
	`GTK_OBJECT
(
m’u
));

325 
	`g_objeù_£t_d©a_fuÎ
(
	`G_OBJECT
(
lchoo£r
), 
bu‰Ú_m’u_key
, 
m’u
,

326 (
GDe¡royNÙify
)
gtk_widg‘_uÄef
);

328 
i
 = 0; i <ğ
LINESTYLE_DOTTED
; i++) {

329 
mi
 = 
	`gtk_m’u_™em_Ãw
();

330 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
mi
), 
m’u™em_’um_key
, 
	`GINT_TO_POINTER
(
i
));

331 
Ê
 = 
	`dŸ_lše_´ev›w_Ãw
(
i
);

332 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
mi
), 
Ê
);

333 
	`gtk_widg‘_show
(
Ê
);

334 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
mi
), "activate",

335 
	`G_CALLBACK
(
dŸ_lše_choo£r_chªge_lše_¡yË
), 
lchoo£r
);

336 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
mi
);

337 
	`gtk_widg‘_show
 (
mi
);

339 
mi
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
	`_
("Details..."));

340 
	`g_sigÇl_cÚÃù_sw­³d
(
	`G_OBJECT
(
mi
), "activate",

341 
	`G_CALLBACK
(
gtk_widg‘_show
), 
lchoo£r
->
dŸlog
);

342 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
mi
);

343 
	`gtk_widg‘_show
 (
mi
);

344 
	}
}

346 
GtkWidg‘
 *

347 
	$dŸ_lše_choo£r_Ãw
(
DŸChªgeLšeC®lback
 
ÿÎback
,

348 
gpoš‹r
 
u£r_d©a
)

350 
DŸLšeChoo£r
 *
choo£r
 = 
	`g_objeù_Ãw
(
DIA_TYPE_LINE_CHOOSER
, 
NULL
);

352 
choo£r
->
ÿÎback
 = callback;

353 
choo£r
->
u£r_d©a
 = user_data;

355  
	`GTK_WIDGET
(
choo£r
);

356 
	}
}

	@O:\tool\dvs50\lib\dialinechooser.h

22 #iâdeà
DIALINECHOOSER_H


23 
	#DIALINECHOOSER_H


	)

25 
	~"¬rows.h
"

27 
	~<gtk/gtk.h
>

30 
GTy³
 
dŸ_lše_´ev›w_g‘_ty³
 ();

32 
	#DIA_TYPE_LINE_PREVIEW
 (
	`dŸ_lše_´ev›w_g‘_ty³
 ())

	)

33 
	#DIA_LINE_PREVIEW
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_LINE_PREVIEW
, 
DŸLšeP»v›w
))

	)

34 
	#DIA_LINE_PREVIEW_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_LINE_PREVIEW
, 
DŸLšeP»v›wCÏss
))

	)

35 
	#DIA_IS_LINE_PREVIEW
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_LINE_PREVIEW
))

	)

36 
	#DIA_IS_LINE_PREVIEW_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kÏss), 
DIA_TYPE_LINE_PREVIEW
))

	)

37 
	#DIA_LINE_PREVIEW_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_LINE_PREVIEW
, 
DŸLšeP»v›wCÏss
))

	)

39 
_DŸLšeP»v›w
 
	tDŸLšeP»v›w
;

40 
_DŸLšeP»v›wCÏss
 
	tDŸLšeP»v›wCÏss
;

42 
	s_DŸLšeP»v›w


44 
GtkMisc
 
	mmisc
;

45 
LšeStyË
 
	ml¡yË
;

48 
	s_DŸLšeP»v›wCÏss


50 
GtkMiscCÏss
 
	m·»Á_şass
;

53 
GtkWidg‘
 *
dŸ_lše_´ev›w_Ãw
 (
LšeStyË
 
l¡yË
);

57 
DIAVAR
 
GTy³
 
dŸ_lše_choo£r_g‘_ty³
 ();

59 
	#DIA_TYPE_LINE_CHOOSER
 (
	`dŸ_lše_choo£r_g‘_ty³
 ())

	)

60 
	#DIA_LINE_CHOOSER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_LINE_CHOOSER
, 
DŸLšeChoo£r
))

	)

61 
	#DIA_LINE_CHOOSER_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_LINE_CHOOSER
, 
DŸLšeChoo£rCÏss
))

	)

62 
	#DIA_IS_LINE_CHOOSER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_LINE_CHOOSER
))

	)

63 
	#DIA_IS_LINE_CHOOSER_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_TYPE
 ((kÏss), 
DIA_TYPE_LINE_CHOOSER
))

	)

64 
	#DIA_LINE_CHOOSER_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_LINE_CHOOSER
, 
DŸLšeChoo£rCÏss
))

	)

66 
_DŸLšeChoo£r
 
	tDŸLšeChoo£r
;

67 
_DŸLšeChoo£rCÏss
 
	tDŸLšeChoo£rCÏss
;

69 (*
	tDŸChªgeLšeC®lback
è(
	tLšeStyË
 
	tl¡yË
, 
	t»®
 
	tdash_Ëngth
,

70 
	tgpoš‹r
 
	tu£r_d©a
);

72 
	s_DŸLšeChoo£r


74 
GtkBu‰Ú
 
bu‰Ú
;

75 
DŸLšeP»v›w
 *
´ev›w
;

76 
LšeStyË
 
l¡yË
;

77 
»®
 
dash_Ëngth
;

79 
DŸChªgeLšeC®lback
 
ÿÎback
;

80 
gpoš‹r
 
u£r_d©a
;

82 
GtkWidg‘
 *
dŸlog
;

83 
DŸLšeStyËS–eùÜ
 *
£ËùÜ
;

86 
	s_DŸLšeChoo£rCÏss


88 
GtkBu‰ÚCÏss
 
·»Á_şass
;

91 
DIAVAR
 
	`dŸ_lše_choo£r_£t_lše_¡yË
(
DŸLšeChoo£r
 *
lchoo£r
,

92 
LšeStyË
 
¡yË
,

93 
»®
 
dashËngth
);

94 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_lše_choo£r_Ãw
 (
DŸChªgeLšeC®lback
 
ÿÎback
,

95 
gpoš‹r
 
u£r_d©a
);

	@O:\tool\dvs50\lib\dialogs.c

22 #ifdeà
HAVE_CONFIG_H


23 
	~<cÚfig.h
>

26 
	~"š.h
"

27 
	~<gtk/gtk.h
>

28 
	~"geom‘ry.h
"

29 
	~"dŸlogs.h
"

43 
GtkWidg‘
 *

44 
	$dŸlog_make
(*
t™Ë
, *
okay_‹xt
, *
ÿnûl_‹xt
,

45 
GtkWidg‘
 **
okay_bu‰Ú
, GtkWidg‘ **
ÿnûl_bu‰Ú
) {

46 
GtkWidg‘
 *
dŸlog
 = 
	`gtk_dŸlog_Ãw
();

47 
GtkWidg‘
 *
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
t™Ë
);

49 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dŸlog
)->
vbox
), 
Ïb–
);

51 *
okay_bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
((
okay_‹xt
!=
NULL
?okay_‹xt:
	`_
("Ok")));

52 *
ÿnûl_bu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
((
ÿnûl_‹xt
!=
NULL
?ÿnûl_‹xt:
	`_
("Cancel")));

54 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dŸlog
)->
aùiÚ_¬—
),

55 *
okay_bu‰Ú
);

56 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dŸlog
)->
aùiÚ_¬—
),

57 *
ÿnûl_bu‰Ú
);

59  
dŸlog
;

60 
	}
}

65 
GtkSpšBu‰Ú
 *

66 
	$dŸlog_add_¥šbu‰Ú
(
GtkWidg‘
 *
dŸlog
, *
t™Ë
,

67 
»®
 
mš
,„—È
max
,„—È
decim®s
) {

68 
GtkAdju¡m’t
 *
lim™s
 =

69 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(10.0, 
mš
, 
max
, 1.0, 10.0, 0));

70 
GtkWidg‘
 *
box
 = 
	`gtk_hbox_Ãw
(
FALSE
, 10);

71 
GtkWidg‘
 *
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
t™Ë
);

72 
GtkWidg‘
 *
’Œy
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
lim™s
, 10.0, 
decim®s
);

74 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
(
box
), 
Ïb–
, 
TRUE
, TRUE, 0);

75 
	`gtk_box_·ck_¡¬t
 (
	`GTK_BOX
(
box
), 
’Œy
, 
TRUE
, TRUE, 0);

76 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
dŸlog
)->
vbox
), 
box
);

78  
	`GTK_SPIN_BUTTON
(
’Œy
);

79 
	}
}

	@O:\tool\dvs50\lib\dialogs.h

21 
	~<gtk/gtkwidg‘.h
>

22 
	~<gtk/gtk¥šbu‰Ú.h
>

24 
DIAVAR
 
GtkWidg‘
 *
dŸlog_make
(*
t™Ë
, *
okay_‹xt
, *
ÿnûl_‹xt
,

25 
GtkWidg‘
 **
okay_bu‰Ú
, GtkWidg‘ **
ÿnûl_bu‰Ú
);

26 
DIAVAR
 
GtkSpšBu‰Ú
 *
dŸlog_add_¥šbu‰Ú
(
GtkWidg‘
 *
dŸlog
, *
t™Ë
,

27 
»®
 
mš
,„—È
max
,„—È
decim®s
);

	@O:\tool\dvs50\lib\diamarshal.c

1 
	~"dŸm¬sh®.h
"

3 
	~<glib-objeù.h
>

6 #ifdeà
G_ENABLE_DEBUG


7 
	#g_m¬sh®_v®ue_³ek_boŞ—n
(
v
è
	`g_v®ue_g‘_boŞ—n
 (v)

	)

8 
	#g_m¬sh®_v®ue_³ek_ch¬
(
v
è
	`g_v®ue_g‘_ch¬
 (v)

	)

9 
	#g_m¬sh®_v®ue_³ek_uch¬
(
v
è
	`g_v®ue_g‘_uch¬
 (v)

	)

10 
	#g_m¬sh®_v®ue_³ek_št
(
v
è
	`g_v®ue_g‘_št
 (v)

	)

11 
	#g_m¬sh®_v®ue_³ek_ušt
(
v
è
	`g_v®ue_g‘_ušt
 (v)

	)

12 
	#g_m¬sh®_v®ue_³ek_lÚg
(
v
è
	`g_v®ue_g‘_lÚg
 (v)

	)

13 
	#g_m¬sh®_v®ue_³ek_ulÚg
(
v
è
	`g_v®ue_g‘_ulÚg
 (v)

	)

14 
	#g_m¬sh®_v®ue_³ek_št64
(
v
è
	`g_v®ue_g‘_št64
 (v)

	)

15 
	#g_m¬sh®_v®ue_³ek_ušt64
(
v
è
	`g_v®ue_g‘_ušt64
 (v)

	)

16 
	#g_m¬sh®_v®ue_³ek_’um
(
v
è
	`g_v®ue_g‘_’um
 (v)

	)

17 
	#g_m¬sh®_v®ue_³ek_æags
(
v
è
	`g_v®ue_g‘_æags
 (v)

	)

18 
	#g_m¬sh®_v®ue_³ek_æßt
(
v
è
	`g_v®ue_g‘_æßt
 (v)

	)

19 
	#g_m¬sh®_v®ue_³ek_doubË
(
v
è
	`g_v®ue_g‘_doubË
 (v)

	)

20 
	#g_m¬sh®_v®ue_³ek_¡ršg
(
v
è(*è
	`g_v®ue_g‘_¡ršg
 (v)

	)

21 
	#g_m¬sh®_v®ue_³ek_·¿m
(
v
è
	`g_v®ue_g‘_·¿m
 (v)

	)

22 
	#g_m¬sh®_v®ue_³ek_boxed
(
v
è
	`g_v®ue_g‘_boxed
 (v)

	)

23 
	#g_m¬sh®_v®ue_³ek_poš‹r
(
v
è
	`g_v®ue_g‘_poš‹r
 (v)

	)

24 
	#g_m¬sh®_v®ue_³ek_objeù
(
v
è
	`g_v®ue_g‘_objeù
 (v)

	)

25 
	#g_m¬sh®_v®ue_³ek_v¬ŸÁ
(
v
è
	`g_v®ue_g‘_v¬ŸÁ
 (v)

	)

31 
	#g_m¬sh®_v®ue_³ek_boŞ—n
(
v
è(v)->
d©a
[0].
v_št


	)

32 
	#g_m¬sh®_v®ue_³ek_ch¬
(
v
è(v)->
d©a
[0].
v_št


	)

33 
	#g_m¬sh®_v®ue_³ek_uch¬
(
v
è(v)->
d©a
[0].
v_ušt


	)

34 
	#g_m¬sh®_v®ue_³ek_št
(
v
è(v)->
d©a
[0].
v_št


	)

35 
	#g_m¬sh®_v®ue_³ek_ušt
(
v
è(v)->
d©a
[0].
v_ušt


	)

36 
	#g_m¬sh®_v®ue_³ek_lÚg
(
v
è(v)->
d©a
[0].
v_lÚg


	)

37 
	#g_m¬sh®_v®ue_³ek_ulÚg
(
v
è(v)->
d©a
[0].
v_ulÚg


	)

38 
	#g_m¬sh®_v®ue_³ek_št64
(
v
è(v)->
d©a
[0].
v_št64


	)

39 
	#g_m¬sh®_v®ue_³ek_ušt64
(
v
è(v)->
d©a
[0].
v_ušt64


	)

40 
	#g_m¬sh®_v®ue_³ek_’um
(
v
è(v)->
d©a
[0].
v_lÚg


	)

41 
	#g_m¬sh®_v®ue_³ek_æags
(
v
è(v)->
d©a
[0].
v_ulÚg


	)

42 
	#g_m¬sh®_v®ue_³ek_æßt
(
v
è(v)->
d©a
[0].
v_æßt


	)

43 
	#g_m¬sh®_v®ue_³ek_doubË
(
v
è(v)->
d©a
[0].
v_doubË


	)

44 
	#g_m¬sh®_v®ue_³ek_¡ršg
(
v
è(v)->
d©a
[0].
v_poš‹r


	)

45 
	#g_m¬sh®_v®ue_³ek_·¿m
(
v
è(v)->
d©a
[0].
v_poš‹r


	)

46 
	#g_m¬sh®_v®ue_³ek_boxed
(
v
è(v)->
d©a
[0].
v_poš‹r


	)

47 
	#g_m¬sh®_v®ue_³ek_poš‹r
(
v
è(v)->
d©a
[0].
v_poš‹r


	)

48 
	#g_m¬sh®_v®ue_³ek_objeù
(
v
è(v)->
d©a
[0].
v_poš‹r


	)

49 
	#g_m¬sh®_v®ue_³ek_v¬ŸÁ
(
v
è(v)->
d©a
[0].
v_poš‹r


	)

61 
	$dŸ_m¬sh®_VOID__POINTER_POINTER
 (
GClosu»
 *
şosu»
,

62 
GV®ue
 *
»tuº_v®ue
 
G_GNUC_UNUSED
,

63 
gušt
 
n_·¿m_v®ues
,

64 cÚ¡ 
GV®ue
 *
·¿m_v®ues
,

65 
gpoš‹r
 
švoÿtiÚ_hšt
 
G_GNUC_UNUSED
,

66 
gpoš‹r
 
m¬sh®_d©a
)

68 (*
	tGM¬sh®Func_VOID__POINTER_POINTER
è(
	tgpoš‹r
 
	td©a1
,

69 
	tgpoš‹r
 
	t¬g_1
,

70 
	tgpoš‹r
 
	t¬g_2
,

71 
	tgpoš‹r
 
	td©a2
);

72 
GM¬sh®Func_VOID__POINTER_POINTER
 
ÿÎback
;

73 
GCClosu»
 *
cc
 = (GCClosu»*è
şosu»
;

74 
gpoš‹r
 
d©a1
, 
d©a2
;

76 
	`g_»tuº_if_ç
 (
n_·¿m_v®ues
 == 3);

78 ià(
	`G_CCLOSURE_SWAP_DATA
 (
şosu»
))

80 
d©a1
 = 
şosu»
->
d©a
;

81 
d©a2
 = 
	`g_v®ue_³ek_poš‹r
 (
·¿m_v®ues
 + 0);

85 
d©a1
 = 
	`g_v®ue_³ek_poš‹r
 (
·¿m_v®ues
 + 0);

86 
d©a2
 = 
şosu»
->
d©a
;

88 
ÿÎback
 = (
GM¬sh®Func_VOID__POINTER_POINTER
è(
m¬sh®_d©a
 ? m¬sh®_d©¨: 
cc
->callback);

90 
	`ÿÎback
 (
d©a1
,

91 
	`g_m¬sh®_v®ue_³ek_poš‹r
 (
·¿m_v®ues
 + 1),

92 
	`g_m¬sh®_v®ue_³ek_poš‹r
 (
·¿m_v®ues
 + 2),

93 
d©a2
);

94 
	}
}

98 
	$dŸ_m¬sh®_VOID__STRING_FLAGS
 (
GClosu»
 *
şosu»
,

99 
GV®ue
 *
»tuº_v®ue
 
G_GNUC_UNUSED
,

100 
gušt
 
n_·¿m_v®ues
,

101 cÚ¡ 
GV®ue
 *
·¿m_v®ues
,

102 
gpoš‹r
 
švoÿtiÚ_hšt
 
G_GNUC_UNUSED
,

103 
gpoš‹r
 
m¬sh®_d©a
)

105 (*
	tGM¬sh®Func_VOID__STRING_FLAGS
è(
	tgpoš‹r
 
	td©a1
,

106 
	tgpoš‹r
 
	t¬g_1
,

107 
	tgušt
 
	t¬g_2
,

108 
	tgpoš‹r
 
	td©a2
);

109 
GM¬sh®Func_VOID__STRING_FLAGS
 
ÿÎback
;

110 
GCClosu»
 *
cc
 = (GCClosu»*è
şosu»
;

111 
gpoš‹r
 
d©a1
, 
d©a2
;

113 
	`g_»tuº_if_ç
 (
n_·¿m_v®ues
 == 3);

115 ià(
	`G_CCLOSURE_SWAP_DATA
 (
şosu»
))

117 
d©a1
 = 
şosu»
->
d©a
;

118 
d©a2
 = 
	`g_v®ue_³ek_poš‹r
 (
·¿m_v®ues
 + 0);

122 
d©a1
 = 
	`g_v®ue_³ek_poš‹r
 (
·¿m_v®ues
 + 0);

123 
d©a2
 = 
şosu»
->
d©a
;

125 
ÿÎback
 = (
GM¬sh®Func_VOID__STRING_FLAGS
è(
m¬sh®_d©a
 ? m¬sh®_d©¨: 
cc
->callback);

127 
	`ÿÎback
 (
d©a1
,

128 
	`g_m¬sh®_v®ue_³ek_¡ršg
 (
·¿m_v®ues
 + 1),

129 
	`g_m¬sh®_v®ue_³ek_æags
 (
·¿m_v®ues
 + 2),

130 
d©a2
);

131 
	}
}

	@O:\tool\dvs50\lib\diamarshal.h

2 #iâdeà
__dŸ_m¬sh®_MARSHAL_H__


3 
	#__dŸ_m¬sh®_MARSHAL_H__


	)

5 
	~<glib-objeù.h
>

6 
	~"dŸv¬.h
"

7 
	gG_BEGIN_DECLS


10 
	#dŸ_m¬sh®_VOID__VOID
 
g_cşosu»_m¬sh®_VOID__VOID


	)

13 
	#dŸ_m¬sh®_VOID__OBJECT
 
g_cşosu»_m¬sh®_VOID__OBJECT


	)

16 
	#dŸ_m¬sh®_VOID__INT
 
g_cşosu»_m¬sh®_VOID__INT


	)

19 
dŸ_m¬sh®_VOID__POINTER_POINTER
 (
GClosu»
 *
şosu»
,

20 
GV®ue
 *
»tuº_v®ue
,

21 
gušt
 
n_·¿m_v®ues
,

22 cÚ¡ 
GV®ue
 *
·¿m_v®ues
,

23 
gpoš‹r
 
švoÿtiÚ_hšt
,

24 
gpoš‹r
 
m¬sh®_d©a
);

27 
dŸ_m¬sh®_VOID__STRING_FLAGS
 (
GClosu»
 *
şosu»
,

28 
GV®ue
 *
»tuº_v®ue
,

29 
gušt
 
n_·¿m_v®ues
,

30 cÚ¡ 
GV®ue
 *
·¿m_v®ues
,

31 
gpoš‹r
 
švoÿtiÚ_hšt
,

32 
gpoš‹r
 
m¬sh®_d©a
);

34 
	gG_END_DECLS


	@O:\tool\dvs50\lib\diamenu.h

18 #iâdeà
DIAMENU_H


19 
	#DIAMENU_H


	)

21 
	~"dŸty³s.h
"

24 
	#DIAMENU_ACTIVE
 (1<<0)

	)

25 
	#DIAMENU_TOGGLE
 (1<<1)

	)

26 
	#DIAMENU_TOGGLE_ON
 (1<<2)

	)

29 
	gObjeùChªge
 *(*
	tDŸM’uC®lback
)(
	tDŸObjeù
 *
	tobj
, 
	tPošt
 *
	tpos
, 
	tgpoš‹r
 
	td©a
);

31 
	s_DŸM’uI‹m
 {

32 *
	m‹xt
;

33 
DŸM’uC®lback
 
	mÿÎback
;

34 
gpoš‹r
 
	mÿÎback_d©a
;

35 
	maùive
;

37 *
	m­p_d©a
;

40 (*
	tDŸM’uAµD©aF»e
è(
	tDŸM’u
 *
	tm’u
);

42 
	s_DŸM’u
 {

43 *
t™Ë
;

44 
num_™ems
;

45 
DŸM’uI‹m
 *
™ems
;

47 *
­p_d©a
;

48 
DŸM’uAµD©aF»e
 
­p_d©a_ä“
;

	@O:\tool\dvs50\lib\diarenderer.c

24 
	~"dŸ»nd””.h
"

25 
	~"objeù.h
"

26 
	~"‹xt.h
"

27 
	~"‹xše.h
"

34 #iâdeà
i¢ª


35 
	#i¢ª
(
x
) \

36 ( (
x
è=ğ (è? 
	`i¢ª_ld
 (x) \

37 :  (
x
è=ğ (è? 
	`i¢ª_d
 (x) \

38 : 
	`i¢ª_f
 (
x
))

	)

39 
šlše
 
	$i¢ª_f
 (
x
è{  x !ğx; 
	}
}

40 
šlše
 
	$i¢ª_d
 (
x
è{  x !ğx; 
	}
}

41 
šlše
 
	$i¢ª_ld
 (
x
è{  x !ğx; 
	}
}

44 
	s_Bez›rAµrox
 {

45 
Pošt
 *
	mpošts
;

46 
	mnumpošts
;

47 
	mcu¼pošt
;

50 
dŸ_»nd””_şass_š™
 (
DŸR’d””CÏss
 *
kÏss
);

52 
g‘_width_pix–s
 (
DŸR’d””
 *);

53 
g‘_height_pix–s
 (
DŸR’d””
 *);

55 
begš_»nd”
 (
DŸR’d””
 *);

56 
’d_»nd”
 (
DŸR’d””
 *);

58 
£t_lšewidth
 (
DŸR’d””
 *
»nd””
, 
»®
 
lšewidth
);

59 
£t_lšeÿps
 (
DŸR’d””
 *
»nd””
, 
LšeC­s
 
mode
);

60 
£t_lšejoš
 (
DŸR’d””
 *
»nd””
, 
LšeJoš
 
mode
);

61 
£t_lše¡yË
 (
DŸR’d””
 *
»nd””
, 
LšeStyË
 
mode
);

62 
£t_dashËngth
 (
DŸR’d””
 *
»nd””
, 
»®
 
Ëngth
);

63 
£t_fl¡yË
 (
DŸR’d””
 *
»nd””
, 
FlStyË
 
mode
);

64 
£t_fÚt
 (
DŸR’d””
 *
»nd””
, 
DŸFÚt
 *
fÚt
, 
»®
 
height
);

66 
d¿w_lše
 (
DŸR’d””
 *
»nd””
,

67 
Pošt
 *
¡¬t
, Pošˆ*
’d
,

68 
CŞÜ
 *
cŞÜ
);

69 
fl_»ù
 (
DŸR’d””
 *
»nd””
,

70 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

71 
CŞÜ
 *
cŞÜ
);

72 
fl_pŞygÚ
 (
DŸR’d””
 *
»nd””
,

73 
Pošt
 *
pošts
, 
num_pošts
,

74 
CŞÜ
 *
cŞÜ
);

75 
d¿w_¬c
 (
DŸR’d””
 *
»nd””
,

76 
Pošt
 *
ûÁ”
,

77 
»®
 
width
,„—È
height
,

78 
»®
 
ªgË1
,„—È
ªgË2
,

79 
CŞÜ
 *
cŞÜ
);

80 
fl_¬c
 (
DŸR’d””
 *
»nd””
,

81 
Pošt
 *
ûÁ”
,

82 
»®
 
width
,„—È
height
,

83 
»®
 
ªgË1
,„—È
ªgË2
,

84 
CŞÜ
 *
cŞÜ
);

85 
d¿w_–l£
 (
DŸR’d””
 *
»nd””
,

86 
Pošt
 *
ûÁ”
,

87 
»®
 
width
,„—È
height
,

88 
CŞÜ
 *
cŞÜ
);

89 
fl_–l£
 (
DŸR’d””
 *
»nd””
,

90 
Pošt
 *
ûÁ”
,

91 
»®
 
width
,„—È
height
,

92 
CŞÜ
 *
cŞÜ
);

93 
d¿w_bez›r
 (
DŸR’d””
 *
»nd””
,

94 
BezPošt
 *
pošts
,

95 
numpošts
,

96 
CŞÜ
 *
cŞÜ
);

97 
fl_bez›r
 (
DŸR’d””
 *
»nd””
,

98 
BezPošt
 *
pošts
,

99 
numpošts
,

100 
CŞÜ
 *
cŞÜ
);

101 
d¿w_¡ršg
 (
DŸR’d””
 *
»nd””
,

102 cÚ¡ 
gch¬
 *
‹xt
,

103 
Pošt
 *
pos
,

104 
Alignm’t
 
®ignm’t
,

105 
CŞÜ
 *
cŞÜ
);

106 
d¿w_image
 (
DŸR’d””
 *
»nd””
,

107 
Pošt
 *
pošt
,

108 
»®
 
width
,„—È
height
,

109 
DŸImage
 *
image
);

110 
d¿w_‹xt
 (
DŸR’d””
 *
»nd””
,

111 
Text
 *
‹xt
);

112 
d¿w_‹xt_lše
 (
DŸR’d””
 *
»nd””
,

113 
TextLše
 *
‹xt_lše
, 
Pošt
 *
pos
, 
Alignm’t
 
®ignm’t
, 
CŞÜ
 *
cŞÜ
);

115 
d¿w_»ù
 (
DŸR’d””
 *
»nd””
,

116 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

117 
CŞÜ
 *
cŞÜ
);

118 
d¿w_pŞylše
 (
DŸR’d””
 *
»nd””
,

119 
Pošt
 *
pošts
, 
num_pošts
,

120 
CŞÜ
 *
cŞÜ
);

121 
d¿w_rounded_pŞylše
 (
DŸR’d””
 *
»nd””
,

122 
Pošt
 *
pošts
, 
num_pošts
,

123 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
);

124 
d¿w_pŞygÚ
 (
DŸR’d””
 *
»nd””
,

125 
Pošt
 *
pošts
, 
num_pošts
,

126 
CŞÜ
 *
cŞÜ
);

128 
»®
 
g‘_‹xt_width
 (
DŸR’d””
 *
»nd””
,

129 cÚ¡ 
gch¬
 *
‹xt
, 
Ëngth
);

131 
d¿w_rounded_»ù
 (
DŸR’d””
 *
»nd””
,

132 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

133 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
);

134 
fl_rounded_»ù
 (
DŸR’d””
 *
»nd””
,

135 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

136 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
);

137 
d¿w_lše_w™h_¬rows
 (
DŸR’d””
 *
»nd””
,

138 
Pošt
 *
¡¬t
, Pošˆ*
’d
,

139 
»®
 
lše_width
,

140 
CŞÜ
 *
lše_cŞÜ
,

141 
A¼ow
 *
¡¬t_¬row
,

142 
A¼ow
 *
’d_¬row
);

143 
d¿w_¬c_w™h_¬rows
 (
DŸR’d””
 *
»nd””
,

144 
Pošt
 *
¡¬t
,

145 
Pošt
 *
’d
,

146 
Pošt
 *
midpošt
,

147 
»®
 
lše_width
,

148 
CŞÜ
 *
cŞÜ
,

149 
A¼ow
 *
¡¬t_¬row
,

150 
A¼ow
 *
’d_¬row
);

151 
d¿w_pŞylše_w™h_¬rows
 (
DŸR’d””
 *
»nd””
,

152 
Pošt
 *
pošts
, 
num_pošts
,

153 
»®
 
lše_width
,

154 
CŞÜ
 *
cŞÜ
,

155 
A¼ow
 *
¡¬t_¬row
,

156 
A¼ow
 *
’d_¬row
);

157 
d¿w_rounded_pŞylše_w™h_¬rows
 (
DŸR’d””
 *
»nd””
,

158 
Pošt
 *
pošts
, 
num_pošts
,

159 
»®
 
lše_width
,

160 
CŞÜ
 *
cŞÜ
,

161 
A¼ow
 *
¡¬t_¬row
,

162 
A¼ow
 *
’d_¬row
,

163 
»®
 
¿dius
);

165 
d¿w_bez›r_w™h_¬rows
 (
DŸR’d””
 *
»nd””
,

166 
BezPošt
 *
pošts
,

167 
num_pošts
,

168 
»®
 
lše_width
,

169 
CŞÜ
 *
cŞÜ
,

170 
A¼ow
 *
¡¬t_¬row
,

171 
A¼ow
 *
’d_¬row
);

173 
gpoš‹r
 
	g·»Á_şass
 = 
NULL
;

175 
GTy³


176 
	$dŸ_»nd””_g‘_ty³
 ()

178 
GTy³
 
objeù_ty³
 = 0;

180 ià(!
objeù_ty³
)

182 cÚ¡ 
GTy³Info
 
objeù_šfo
 =

184  (
DŸR’d””CÏss
),

185 (
GBa£In™Func
è
NULL
,

186 (
GBa£Fš®izeFunc
è
NULL
,

187 (
GCÏssIn™Func
è
dŸ_»nd””_şass_š™
,

188 
NULL
,

189 
NULL
,

190  (
DŸR’d””
),

192 
NULL


195 
objeù_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
G_TYPE_OBJECT
,

197 &
objeù_šfo
, 0);

200  
objeù_ty³
;

201 
	}
}

204 
	$d¿w_objeù
 (
DŸR’d””
 *
»nd””
,

205 
DŸObjeù
 *
objeù
)

207 
objeù
->
İs
->
	`d¿w
(objeù, 
»nd””
);

208 
	}
}

211 
	$»nd””_fš®ize
 (
GObjeù
 *
objeù
)

213 
DŸR’d””
 *
»nd””
 = 
	`DIA_RENDERER
 (
objeù
);

215 ià(
»nd””
->
fÚt
)

216 
	`dŸ_fÚt_uÄef
 (
»nd””
->
fÚt
);

218 ià(
»nd””
->
bez›r
)

220 ià(
»nd””
->
bez›r
->
pošts
)

221 
	`g_ä“
 (
»nd””
->
bez›r
->
pošts
);

222 
	`g_ä“
 (
»nd””
->
bez›r
);

225 
	`G_OBJECT_CLASS
 (
·»Á_şass
)->
	`fš®ize
 (
objeù
);

226 
	}
}

229 
	$dŸ_»nd””_şass_š™
 (
DŸR’d””CÏss
 *
kÏss
)

231 
GObjeùCÏss
 *
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
kÏss
);

232 
DŸR’d””CÏss
 *
»nd””_şass
 = 
	`DIA_RENDERER_CLASS
 (
kÏss
);

234 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
kÏss
);

236 
objeù_şass
->
fš®ize
 = 
»nd””_fš®ize
;

238 
»nd””_şass
->
g‘_width_pix–s
 = get_width_pixels;

239 
»nd””_şass
->
g‘_height_pix–s
 = get_height_pixels;

240 
»nd””_şass
->
d¿w_objeù
 = draw_object;

241 
»nd””_şass
->
g‘_‹xt_width
 = get_text_width;

243 
»nd””_şass
->
begš_»nd”
 = begin_render;

244 
»nd””_şass
->
’d_»nd”
 =ƒnd_render;

246 
»nd””_şass
->
£t_lšewidth
 = set_linewidth;

247 
»nd””_şass
->
£t_lšeÿps
 = set_linecaps;

248 
»nd””_şass
->
£t_lšejoš
 = set_linejoin;

249 
»nd””_şass
->
£t_lše¡yË
 = set_linestyle;

250 
»nd””_şass
->
£t_dashËngth
 = set_dashlength;

251 
»nd””_şass
->
£t_fl¡yË
 = set_fillstyle;

252 
»nd””_şass
->
£t_fÚt
 = set_font;

254 
»nd””_şass
->
d¿w_lše
 = draw_line;

255 
»nd””_şass
->
fl_»ù
 = fill_rect;

256 
»nd””_şass
->
fl_pŞygÚ
 = fill_polygon;

257 
»nd””_şass
->
d¿w_¬c
 = draw_arc;

258 
»nd””_şass
->
fl_¬c
 = fill_arc;

259 
»nd””_şass
->
d¿w_–l£
 = draw_ellipse;

260 
»nd””_şass
->
fl_–l£
 = fill_ellipse;

261 
»nd””_şass
->
d¿w_¡ršg
 = draw_string;

262 
»nd””_şass
->
d¿w_image
 = draw_image;

265 
»nd””_şass
->
d¿w_bez›r
 = draw_bezier;

266 
»nd””_şass
->
fl_bez›r
 = fill_bezier;

267 
»nd””_şass
->
d¿w_»ù
 = draw_rect;

268 
»nd””_şass
->
d¿w_rounded_pŞylše
 = draw_rounded_polyline;

269 
»nd””_şass
->
d¿w_pŞylše
 = draw_polyline;

270 
»nd””_şass
->
d¿w_pŞygÚ
 = draw_polygon;

271 
»nd””_şass
->
d¿w_‹xt
 = draw_text;

272 
»nd””_şass
->
d¿w_‹xt_lše
 = draw_text_line;

275 
»nd””_şass
->
d¿w_rounded_»ù
 = draw_rounded_rect;

276 
»nd””_şass
->
fl_rounded_»ù
 = fill_rounded_rect;

277 
»nd””_şass
->
d¿w_lše_w™h_¬rows
 = draw_line_with_arrows;

278 
»nd””_şass
->
d¿w_¬c_w™h_¬rows
 = draw_arc_with_arrows;

279 
»nd””_şass
->
d¿w_pŞylše_w™h_¬rows
 = draw_polyline_with_arrows;

280 
»nd””_şass
->
d¿w_rounded_pŞylše_w™h_¬rows
 = draw_rounded_polyline_with_arrows;

281 
»nd””_şass
->
d¿w_bez›r_w™h_¬rows
 = draw_bezier_with_arrows;

282 
	}
}

285 
	$begš_»nd”
 (
DŸR’d””
 *
objeù
)

287 
	`g_w¬nšg
 ("%s::begin_render‚ot implemented!",

288 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
objeù
)));

289 
	}
}

292 
	$’d_»nd”
 (
DŸR’d””
 *
objeù
)

294 
	`g_w¬nšg
 ("%s::end_render‚ot implemented!",

295 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
objeù
)));

296 
	}
}

299 
	$£t_lšewidth
 (
DŸR’d””
 *
objeù
, 
»®
 
lšewidth
)

301 
	`g_w¬nšg
 ("%s::set_line_width‚ot implemented!",

302 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
objeù
)));

303 
	}
}

306 
	$£t_lšeÿps
 (
DŸR’d””
 *
objeù
, 
LšeC­s
 
mode
)

308 
	`g_w¬nšg
 ("%s::set_line_caps‚ot implemented!",

309 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
objeù
)));

310 
	}
}

313 
	$£t_lšejoš
 (
DŸR’d””
 *
»nd””
, 
LšeJoš
 
mode
)

315 
	`g_w¬nšg
 ("%s::set_line_join‚ot implemented!",

316 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

317 
	}
}

320 
	$£t_lše¡yË
 (
DŸR’d””
 *
»nd””
, 
LšeStyË
 
mode
)

322 
	`g_w¬nšg
 ("%s::set_line_style‚ot implemented!",

323 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

324 
	}
}

327 
	$£t_dashËngth
 (
DŸR’d””
 *
»nd””
, 
»®
 
Ëngth
)

329 
	`g_w¬nšg
 ("%s::set_dash_length‚ot implemented!",

330 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

331 
	}
}

334 
	$£t_fl¡yË
 (
DŸR’d””
 *
»nd””
, 
FlStyË
 
mode
)

336 
	`g_w¬nšg
 ("%s::set_fill_style‚ot implemented!",

337 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

338 
	}
}

341 
	$£t_fÚt
 (
DŸR’d””
 *
»nd””
, 
DŸFÚt
 *
fÚt
, 
»®
 
height
)

344 
	`dŸ_fÚt_»f
 (
fÚt
);

345 ià(
»nd””
->
fÚt
)

346 
	`dŸ_fÚt_uÄef
 (
»nd””
->
fÚt
);

347 
»nd””
->
fÚt
 = font;

348 
»nd””
->
fÚt_height
 = 
height
;

349 
	}
}

353 
	$d¿w_lše
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
¡¬t
, Pošˆ*
’d
, 
CŞÜ
 *
cŞÜ
)

355 
	`g_w¬nšg
 ("%s::draw_line‚ot implemented!",

356 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

357 
	}
}

360 
	$fl_pŞygÚ
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
pošts
, 
num_pošts
, 
CŞÜ
 *
cŞÜ
)

362 
	`g_w¬nšg
 ("%s::fill_polygon‚ot implemented!",

363 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

364 
	}
}

367 
	$d¿w_¬c
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
ûÁ”
,

368 
»®
 
width
,„—È
height
,„—È
ªgË1
,„—È
ªgË2
,

369 
CŞÜ
 *
cŞÜ
)

371 
	`g_w¬nšg
 ("%s::draw_arc‚ot implemented!",

372 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

373 
	}
}

376 
	$fl_»ù
 (
DŸR’d””
 *
»nd””
,

377 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

378 
CŞÜ
 *
cŞÜ
)

380 
	`g_w¬nšg
 ("%s::fill_rect‚ot implemented!",

381 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

382 
	}
}

385 
	$fl_¬c
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
ûÁ”
,

386 
»®
 
width
,„—È
height
,„—È
ªgË1
,„—È
ªgË2
,

387 
CŞÜ
 *
cŞÜ
)

389 
	`g_w¬nšg
 ("%s::fill_arc‚ot implemented!",

390 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

391 
	}
}

394 
	$d¿w_–l£
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
ûÁ”
,

395 
»®
 
width
,„—È
height
,

396 
CŞÜ
 *
cŞÜ
)

398 
	`g_w¬nšg
 ("%s::draw_ellipse‚ot implemented!",

399 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

400 
	}
}

403 
	$fl_–l£
 (
DŸR’d””
 *
»nd””
, 
Pošt
 *
ûÁ”
,

404 
»®
 
width
,„—È
height
, 
CŞÜ
 *
cŞÜ
)

406 
	`g_w¬nšg
 ("%s::fill_ellipse‚ot implemented!",

407 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

408 
	}
}

411 
	$d¿w_¡ršg
 (
DŸR’d””
 *
»nd””
,

412 cÚ¡ 
gch¬
 *
‹xt
, 
Pošt
 *
pos
, 
Alignm’t
 
®ignm’t
,

413 
CŞÜ
 *
cŞÜ
)

415 
	`g_w¬nšg
 ("%s::draw_string‚ot implemented!",

416 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

417 
	}
}

421 
	$d¿w_‹xt
 (
DŸR’d””
 *
»nd””
,

422 
Text
 *
‹xt
)

424 
Pošt
 
pos
;

425 
i
;

427 
pos
 = 
‹xt
->
pos™iÚ
;

429 
i
=0;i<
‹xt
->
numlšes
;i++) {

430 
TextLše
 *
‹xt_lše
 = 
‹xt
->
lšes
[
i
];

432 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_‹xt_lše
(renderer,

433 
‹xt_lše
,

434 &
pos
,

435 
‹xt
->
®ignm’t
,

436 &
‹xt
->
cŞÜ
);

437 
pos
.
y
 +ğ
‹xt
->
height
;

439 
	}
}

443 
	$d¿w_‹xt_lše
 (
DŸR’d””
 *
»nd””
,

444 
TextLše
 *
‹xt_lše
, 
Pošt
 *
pos
, 
Alignm’t
 
®ignm’t
, 
CŞÜ
 *
cŞÜ
)

446 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_fÚt
(renderer,

447 
	`‹xt_lše_g‘_fÚt
(
‹xt_lše
),

448 
	`‹xt_lše_g‘_height
(
‹xt_lše
));

450 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_¡ršg
(renderer,

451 
	`‹xt_lše_g‘_¡ršg
(
‹xt_lše
),

452 
pos
, 
®ignm’t
,

453 
cŞÜ
);

454 
	}
}

457 
	$d¿w_image
 (
DŸR’d””
 *
»nd””
,

458 
Pošt
 *
pošt
, 
»®
 
width
,„—È
height
,

459 
DŸImage
 *
image
)

461 
	`g_w¬nšg
 ("%s::draw_image‚ot implemented!",

462 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

463 
	}
}

477 
	#BEZIER_SUBDIVIDE_LIMIT
 0.01

	)

478 
	#BEZIER_SUBDIVIDE_LIMIT_SQ
 (
BEZIER_SUBDIVIDE_LIMIT
*BEZIER_SUBDIVIDE_LIMIT)

	)

481 
	$bez›r_add_pošt
(
Bez›rAµrox
 *
bez›r
,

482 
Pošt
 *
pošt
)

485 ià(
bez›r
->
cu¼pošt
 =ğbez›r->
numpošts
) {

486 
bez›r
->
numpošts
 += 40;

487 
bez›r
->
pošts
 = 
	`g_»®loc
(bezier->points,

488 
bez›r
->
numpošts
*(
Pošt
));

491 
bez›r
->
pošts
[bez›r->
cu¼pošt
] = *
pošt
;

493 
bez›r
->
cu¼pošt
++;

494 
	}
}

497 
	$bez›r_add_lšes
(
Bez›rAµrox
 *
bez›r
,

498 
Pošt
 
pošts
[4])

500 
Pošt
 
u
, 
v
, 
x
, 
y
;

501 
Pošt
 
r
[4];

502 
Pošt
 
s
[4];

503 
Pošt
 
middË
;

504 
coÜd
 
d–
;

505 
»®
 
v_Ën_sq
;

508 
u
 = 
pošts
[1];

509 
	`pošt_sub
(&
u
, &
pošts
[0]);

510 
v
 = 
pošts
[3];

511 
	`pošt_sub
(&
v
, &
pošts
[0]);

512 
y
 = 
v
;

513 
v_Ën_sq
 = 
	`pošt_dÙ
(&
v
,&v);

514 ià(
	`i¢ª
(
v_Ën_sq
)) {

515 
	`g_w¬nšg
("v_len_sq is NaN while calculating bezier curve!");

518 ià(
v_Ën_sq
 < 0.000001)

519 
v_Ën_sq
 = 0.000001;

520 
	`pošt_sÿË
(&
y
, 
	`pošt_dÙ
(&
u
,&
v
)/
v_Ën_sq
);

521 
x
 = 
u
;

522 
	`pošt_sub
(&
x
,&
y
);

523 
d–
 = 
	`pošt_dÙ
(&
x
,&x);

524 ià(
d–
 < 
BEZIER_SUBDIVIDE_LIMIT_SQ
) {

525 
u
 = 
pošts
[2];

526 
	`pošt_sub
(&
u
, &
pošts
[3]);

527 
v
 = 
pošts
[0];

528 
	`pošt_sub
(&
v
, &
pošts
[3]);

529 
y
 = 
v
;

530 
v_Ën_sq
 = 
	`pošt_dÙ
(&
v
,&v);

531 ià(
v_Ën_sq
 < 0.000001)

532 
v_Ën_sq
 = 0.000001;

533 
	`pošt_sÿË
(&
y
, 
	`pošt_dÙ
(&
u
,&
v
)/
v_Ën_sq
);

534 
x
 = 
u
;

535 
	`pošt_sub
(&
x
,&
y
);

536 
d–
 = 
	`pošt_dÙ
(&
x
,&x);

537 ià(
d–
 < 
BEZIER_SUBDIVIDE_LIMIT_SQ
) {

538 
	`bez›r_add_pošt
(
bez›r
, &
pošts
[3]);

544 
middË
 = 
pošts
[1];

545 
	`pošt_add
(&
middË
, &
pošts
[2]);

546 
	`pošt_sÿË
(&
middË
, 0.5);

548 
r
[0] = 
pošts
[0];

550 
r
[1] = 
pošts
[0];

551 
	`pošt_add
(&
r
[1], &
pošts
[1]);

552 
	`pošt_sÿË
(&
r
[1], 0.5);

554 
r
[2] =„[1];

555 
	`pošt_add
(&
r
[2], &
middË
);

556 
	`pošt_sÿË
(&
r
[2], 0.5);

558 
s
[3] = 
pošts
[3];

560 
s
[2] = 
pošts
[2];

561 
	`pošt_add
(&
s
[2], &
pošts
[3]);

562 
	`pošt_sÿË
(&
s
[2], 0.5);

564 
s
[1] = s[2];

565 
	`pošt_add
(&
s
[1], &
middË
);

566 
	`pošt_sÿË
(&
s
[1], 0.5);

568 
r
[3] =„[2];

569 
	`pošt_add
(&
r
[3], &
s
[1]);

570 
	`pošt_sÿË
(&
r
[3], 0.5);

572 
s
[0] = 
r
[3];

574 
	`bez›r_add_lšes
(
bez›r
, 
r
);

575 
	`bez›r_add_lšes
(
bez›r
, 
s
);

576 
	}
}

579 
	$bez›r_add_curve
(
Bez›rAµrox
 *
bez›r
,

580 
Pošt
 
pošts
[4])

583 iàĞ(
	`di¡ªû_pošt_pošt
(&
pošts
[0], &points[1]) < 0.00001) &&

584 (
	`di¡ªû_pošt_pošt
(&
pošts
[2], &points[3]) < 0.00001) &&

585 (
	`di¡ªû_pošt_pošt
(&
pošts
[0], &points[3]) < 0.00001)) {

586 
	`bez›r_add_pošt
(
bez›r
, &
pošts
[3]);

589 
	`bez›r_add_lšes
(
bez›r
, 
pošts
);

590 
	}
}

593 
	$­´oxim©e_bez›r
 (
Bez›rAµrox
 *
bez›r
,

594 
BezPošt
 *
pošts
, 
numpošts
)

596 
Pošt
 
curve
[4];

597 
i
;

599 ià(
pošts
[0].
ty³
 !ğ
BEZ_MOVE_TO
)

600 
	`g_w¬nšg
("first BezPoint must be‡ BEZ_MOVE_TO");

601 
curve
[3] = 
pošts
[0].
p1
;

602 
	`bez›r_add_pošt
(
bez›r
, &
pošts
[0].
p1
);

603 
i
 = 1; i < 
numpošts
; i++)

604 
pošts
[
i
].
ty³
) {

605 
BEZ_MOVE_TO
:

606 
	`g_w¬nšg
("only first BezPoint can be‡ BEZ_MOVE_TO");

607 
curve
[3] = 
pošts
[
i
].
p1
;

609 
BEZ_LINE_TO
:

610 
	`bez›r_add_pošt
(
bez›r
, &
pošts
[
i
].
p1
);

611 
curve
[3] = 
pošts
[
i
].
p1
;

613 
BEZ_CURVE_TO
:

614 
curve
[0] = curve[3];

615 
curve
[1] = 
pošts
[
i
].
p1
;

616 
curve
[2] = 
pošts
[
i
].
p2
;

617 
curve
[3] = 
pošts
[
i
].
p3
;

618 
	`bez›r_add_curve
(
bez›r
, 
curve
);

621 
	}
}

625 
	$d¿w_bez›r
 (
DŸR’d””
 *
»nd””
,

626 
BezPošt
 *
pošts
, 
numpošts
,

627 
CŞÜ
 *
cŞÜ
)

629 
Bez›rAµrox
 *
bez›r
;

631 ià(
»nd””
->
bez›r
)

632 
bez›r
 = 
»nd””
->bezier;

634 
»nd””
->
bez›r
 = bez›¸ğ
	`g_Ãw0
 (
Bez›rAµrox
, 1);

636 ià(
bez›r
->
pošts
 =ğ
NULL
) {

637 
bez›r
->
numpošts
 = 30;

638 
bez›r
->
pošts
 = 
	`g_m®loc
(bez›r->
numpošts
*(
Pošt
));

641 
bez›r
->
cu¼pošt
 = 0;

642 
	`­´oxim©e_bez›r
 (
bez›r
, 
pošts
, 
numpošts
);

644 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`d¿w_pŞylše
 (renderer,

645 
bez›r
->
pošts
,

646 
bez›r
->
cu¼pošt
,

647 
cŞÜ
);

648 
	}
}

651 
	$fl_bez›r
 (
DŸR’d””
 *
»nd””
,

652 
BezPošt
 *
pošts
, 
numpošts
,

653 
CŞÜ
 *
cŞÜ
)

655 
Bez›rAµrox
 *
bez›r
;

657 ià(
»nd””
->
bez›r
)

658 
bez›r
 = 
»nd””
->bezier;

660 
»nd””
->
bez›r
 = bez›¸ğ
	`g_Ãw0
 (
Bez›rAµrox
, 1);

662 ià(
bez›r
->
pošts
 =ğ
NULL
) {

663 
bez›r
->
numpošts
 = 30;

664 
bez›r
->
pošts
 = 
	`g_m®loc
(bez›r->
numpošts
*(
Pošt
));

667 
bez›r
->
cu¼pošt
 = 0;

668 
	`­´oxim©e_bez›r
 (
bez›r
, 
pošts
, 
numpošts
);

670 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`fl_pŞygÚ
 (renderer,

671 
bez›r
->
pošts
,

672 
bez›r
->
cu¼pošt
,

673 
cŞÜ
);

674 
	}
}

677 
	$d¿w_»ù
 (
DŸR’d””
 *
»nd””
,

678 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

679 
CŞÜ
 *
cŞÜ
)

681 
DŸR’d””CÏss
 *
kÏss
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

682 
Pošt
 
ur
, 
Î
;

684 
ur
.
x
 = 
Ì_cÜÃr
->x;

685 
ur
.
y
 = 
ul_cÜÃr
->y;

686 
Î
.
x
 = 
ul_cÜÃr
->x;

687 
Î
.
y
 = 
Ì_cÜÃr
->y;

689 
kÏss
->
	`d¿w_lše
 (
»nd””
, 
ul_cÜÃr
, &
ur
, 
cŞÜ
);

690 
kÏss
->
	`d¿w_lše
 (
»nd””
, &
ur
, 
Ì_cÜÃr
, 
cŞÜ
);

691 
kÏss
->
	`d¿w_lše
 (
»nd””
, 
Ì_cÜÃr
, &
Î
, 
cŞÜ
);

692 
kÏss
->
	`d¿w_lše
 (
»nd””
, &
Î
, 
ul_cÜÃr
, 
cŞÜ
);

693 
	}
}

696 
	$d¿w_pŞylše
 (
DŸR’d””
 *
»nd””
,

697 
Pošt
 *
pošts
, 
num_pošts
,

698 
CŞÜ
 *
cŞÜ
)

700 
DŸR’d””CÏss
 *
kÏss
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

701 
i
;

703 
i
 = 0; i < 
num_pošts
 - 1; i++)

704 
kÏss
->
	`d¿w_lše
 (
»nd””
, &
pošts
[
i
+0], &pošts[i+1], 
cŞÜ
);

705 
	}
}

716 
»®


717 
	$ÿlcuÏ‹_mš_¿dius
Ğ
Pošt
 *
p1
, Pošˆ*
p2
, Pošˆ*
p3
 )

719 
»®
 
c
;

720 
»®
 
a
;

721 
Pošt
 
v1
,
v2
;

723 
c
 = 
	`MIN
(
	`di¡ªû_pošt_pošt
(
p1
,
p2
)/2,di¡ªû_pošt_poštÕ2,
p3
)/2);

724 
v1
.
x
 = 
p1
->x-
p2
->x; v1.
y
 =…1->y-p2->y;

725 
v2
.
x
 = 
p3
->x-
p2
->x; v2.
y
 =…3->y-p2->y;

726 
a
 = 
	`dÙ2
(&
v1
,&
v2
);

727  (
c
*
	`sš
(
a
/2));

728 
	}
}

735 
	$d¿w_rounded_pŞylše
 (
DŸR’d””
 *
»nd””
,

736 
Pošt
 *
pošts
, 
num_pošts
,

737 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
)

739 
DŸR’d””CÏss
 *
kÏss
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

740 
i
 = 0;

741 
Pošt
 
p1
,
p2
,
p3
,
p4
 ;

742 
Pošt
 *
p
;

743 
p
 = 
pošts
;

745 ià(
¿dius
 < 0.00001) {

746 
kÏss
->
	`d¿w_pŞylše
(
»nd””
, 
pošts
, 
num_pošts
, 
cŞÜ
);

751 iàĞ
num_pošts
 <= 2 ) {

752 
i
 = 0;

753 
p1
.
x
 = 
p
[
i
].x;…1.
y
 =…[i].y;

754 
p2
.
x
 = 
p
[
i
+1].x;…2.
y
 =…[i+1].y;

755 
kÏss
->
	`d¿w_lše
(
»nd””
,&
p1
,&
p2
,
cŞÜ
);

759 
i
 = 0;

761 
p1
.
x
 = 
p
[
i
].x;…1.
y
 =…[i].y;

762 
p2
.
x
 = 
p
[
i
+1].x;…2.
y
 =…[i+1].y;

763 
i
 = 0; i <ğ
num_pošts
 - 3; i++) {

764 
Pošt
 
c
;

765 
»®
 
¡¬t_ªgË
, 
¡İ_ªgË
;

766 
»®
 
mš_¿dius
;

767 
p3
.
x
 = 
p
[
i
+1].x;…3.
y
 =…[i+1].y;

768 
p4
.
x
 = 
p
[
i
+2].x;…4.
y
 =…[i+2].y;

771 
mš_¿dius
 = 
	`MIN
(
¿dius
, 
	`ÿlcuÏ‹_mš_¿dius
(&
p1
,&
p2
,&
p4
));

772 
	`fËt
(&
p1
,&
p2
,&
p3
,&
p4
, 
mš_¿dius
, &
c
, &
¡¬t_ªgË
, &
¡İ_ªgË
);

773 
kÏss
->
	`d¿w_¬c
(
»nd””
, &
c
, 
mš_¿dius
*2, min_radius*2,

774 
¡¬t_ªgË
,

775 
¡İ_ªgË
, 
cŞÜ
);

776 
kÏss
->
	`d¿w_lše
(
»nd””
, &
p1
, &
p2
, 
cŞÜ
);

777 
p1
.
x
 = 
p3
.x;…1.
y
 =…3.y;

778 
p2
.
x
 = 
p4
.x;…2.
y
 =…4.y;

780 
kÏss
->
	`d¿w_lše
(
»nd””
, &
p3
, &
p4
, 
cŞÜ
);

781 
	}
}

784 
	$d¿w_pŞygÚ
 (
DŸR’d””
 *
»nd””
,

785 
Pošt
 *
pošts
, 
num_pošts
,

786 
CŞÜ
 *
cŞÜ
)

788 
DŸR’d””CÏss
 *
kÏss
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

789 
i
;

791 
	`g_»tuº_if_ç
 (
num_pošts
 > 1);

793 
i
 = 0; i < 
num_pošts
 - 1; i++)

794 
kÏss
->
	`d¿w_lše
 (
»nd””
, &
pošts
[
i
+0], &pošts[i+1], 
cŞÜ
);

796 iàĞ(
pošts
[0].
x
 !ğpošts[
num_pošts
-1].x)

797 || (
pošts
[0].
y
 !ğpošts[
num_pošts
-1].y))

798 
kÏss
->
	`d¿w_lše
 (
»nd””
, &
pošts
[
num_pošts
-1], &pošts[0], 
cŞÜ
);

799 
	}
}

802 
	$d¿w_rounded_»ù
 (
DŸR’d””
 *
»nd””
,

803 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

804 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
)

806 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

807 
Pošt
 
¡¬t
, 
’d
, 
ûÁ”
;

809 
¿dius
 = 
	`MIN
Ôadius, (
Ì_cÜÃr
->
x
-
ul_cÜÃr
->x)/2);

810 
¿dius
 = 
	`MIN
Ôadius, (
Ì_cÜÃr
->
y
-
ul_cÜÃr
->y)/2);

812 ià(
¿dius
 < 0.00001) {

813 
»nd””_İs
->
	`d¿w_»ù
(
»nd””
, 
ul_cÜÃr
, 
Ì_cÜÃr
, 
cŞÜ
);

817 
¡¬t
.
x
 = 
ûÁ”
.x = 
ul_cÜÃr
->x+
¿dius
;

818 
’d
.
x
 = 
Ì_cÜÃr
->x-
¿dius
;

819 
¡¬t
.
y
 = 
’d
.y = 
ul_cÜÃr
->y;

820 
»nd””_İs
->
	`d¿w_lše
(
»nd””
, &
¡¬t
, &
’d
, 
cŞÜ
);

821 
¡¬t
.
y
 = 
’d
.y = 
Ì_cÜÃr
->y;

822 
»nd””_İs
->
	`d¿w_lše
(
»nd””
, &
¡¬t
, &
’d
, 
cŞÜ
);

824 
ûÁ”
.
y
 = 
ul_cÜÃr
->y+
¿dius
;

825 
»nd””_İs
->
	`d¿w_¬c
(
»nd””
, &
ûÁ”
,

826 2.0*
¿dius
, 2.0*radius,

827 90.0, 180.0, 
cŞÜ
);

828 
ûÁ”
.
x
 = 
’d
.x;

829 
»nd””_İs
->
	`d¿w_¬c
(
»nd””
, &
ûÁ”
,

830 2.0*
¿dius
, 2.0*radius,

831 0.0, 90.0, 
cŞÜ
);

833 
¡¬t
.
y
 = 
ul_cÜÃr
->y+
¿dius
;

834 
¡¬t
.
x
 = 
’d
.x = 
ul_cÜÃr
->x;

835 
’d
.
y
 = 
ûÁ”
.y = 
Ì_cÜÃr
->y-
¿dius
;

836 
»nd””_İs
->
	`d¿w_lše
(
»nd””
, &
¡¬t
, &
’d
, 
cŞÜ
);

837 
¡¬t
.
x
 = 
’d
.x = 
Ì_cÜÃr
->x;

838 
»nd””_İs
->
	`d¿w_lše
(
»nd””
, &
¡¬t
, &
’d
, 
cŞÜ
);

840 
ûÁ”
.
y
 = 
Ì_cÜÃr
->y-
¿dius
;

841 
ûÁ”
.
x
 = 
ul_cÜÃr
->x+
¿dius
;

842 
»nd””_İs
->
	`d¿w_¬c
(
»nd””
, &
ûÁ”
,

843 2.0*
¿dius
, 2.0*radius,

844 180.0, 270.0, 
cŞÜ
);

845 
ûÁ”
.
x
 = 
Ì_cÜÃr
->x-
¿dius
;

846 
»nd””_İs
->
	`d¿w_¬c
(
»nd””
, &
ûÁ”
,

847 2.0*
¿dius
, 2.0*radius,

848 270.0, 360.0, 
cŞÜ
);

849 
	}
}

852 
	$fl_rounded_»ù
(
DŸR’d””
 *
»nd””
,

853 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

854 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
)

856 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

857 
Pošt
 
¡¬t
, 
’d
, 
ûÁ”
;

859 
¿dius
 = 
	`MIN
Ôadius, (
Ì_cÜÃr
->
x
-
ul_cÜÃr
->x)/2);

860 
¿dius
 = 
	`MIN
Ôadius, (
Ì_cÜÃr
->
y
-
ul_cÜÃr
->y)/2);

862 ià(
¿dius
 < 0.00001) {

863 
»nd””_İs
->
	`fl_»ù
(
»nd””
, 
ul_cÜÃr
, 
Ì_cÜÃr
, 
cŞÜ
);

867 
¡¬t
.
x
 = 
ûÁ”
.x = 
ul_cÜÃr
->x+
¿dius
;

868 
’d
.
x
 = 
Ì_cÜÃr
->x-
¿dius
;

869 
¡¬t
.
y
 = 
ul_cÜÃr
->y;

870 
’d
.
y
 = 
Ì_cÜÃr
->y;

871 
»nd””_İs
->
	`fl_»ù
(
»nd””
, &
¡¬t
, &
’d
, 
cŞÜ
);

873 
ûÁ”
.
y
 = 
ul_cÜÃr
->y+
¿dius
;

874 
»nd””_İs
->
	`fl_¬c
(
»nd””
, &
ûÁ”
,

875 2.0*
¿dius
, 2.0*radius,

876 90.0, 180.0, 
cŞÜ
);

877 
ûÁ”
.
x
 = 
’d
.x;

878 
»nd””_İs
->
	`fl_¬c
(
»nd””
, &
ûÁ”
,

879 2.0*
¿dius
, 2.0*radius,

880 0.0, 90.0, 
cŞÜ
);

883 
¡¬t
.
x
 = 
ul_cÜÃr
->x;

884 
¡¬t
.
y
 = 
ul_cÜÃr
->y+
¿dius
;

885 
’d
.
x
 = 
Ì_cÜÃr
->x;

886 
’d
.
y
 = 
ûÁ”
.y = 
Ì_cÜÃr
->y-
¿dius
;

887 
»nd””_İs
->
	`fl_»ù
(
»nd””
, &
¡¬t
, &
’d
, 
cŞÜ
);

889 
ûÁ”
.
y
 = 
Ì_cÜÃr
->y-
¿dius
;

890 
ûÁ”
.
x
 = 
ul_cÜÃr
->x+
¿dius
;

891 
»nd””_İs
->
	`fl_¬c
(
»nd””
, &
ûÁ”
,

892 2.0*
¿dius
, 2.0*radius,

893 180.0, 270.0, 
cŞÜ
);

894 
ûÁ”
.
x
 = 
Ì_cÜÃr
->x-
¿dius
;

895 
»nd””_İs
->
	`fl_¬c
(
»nd””
, &
ûÁ”
,

896 2.0*
¿dius
, 2.0*radius,

897 270.0, 360.0, 
cŞÜ
);

898 
	}
}

901 
	$d¿w_lše_w™h_¬rows
(
DŸR’d””
 *
»nd””
,

902 
Pošt
 *
¡¬ošt
,

903 
Pošt
 *
’dpošt
,

904 
»®
 
lše_width
,

905 
CŞÜ
 *
cŞÜ
,

906 
A¼ow
 *
¡¬t_¬row
,

907 
A¼ow
 *
’d_¬row
)

909 
Pošt
 
Şd¡¬t
 = *
¡¬ošt
;

910 
Pošt
 
Şd’d
 = *
’dpošt
;

911 
Pošt
 
¡¬t_¬row_h—d
;

912 
Pošt
 
’d_¬row_h—d
;

915 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
) {

916 
Pošt
 
move_¬row
, 
move_lše
;

917 
	`ÿlcuÏ‹_¬row_pošt
(
¡¬t_¬row
, 
¡¬ošt
, 
’dpošt
,

918 &
move_¬row
, &
move_lše
,

919 
lše_width
);

920 
¡¬t_¬row_h—d
 = *
¡¬ošt
;

921 
	`pošt_sub
(&
¡¬t_¬row_h—d
, &
move_¬row
);

922 
	`pošt_sub
(
¡¬ošt
, &
move_lše
);

924 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
) {

925 
Pošt
 
move_¬row
, 
move_lše
;

926 
	`ÿlcuÏ‹_¬row_pošt
(
’d_¬row
, 
’dpošt
, 
¡¬ošt
,

927 &
move_¬row
, &
move_lše
,

928 
lše_width
);

929 
’d_¬row_h—d
 = *
’dpošt
;

930 
	`pošt_sub
(&
’d_¬row_h—d
, &
move_¬row
);

931 
	`pošt_sub
(
’dpošt
, &
move_lše
);

934 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, 
¡¬ošt
, 
’dpošt
, 
cŞÜ
);

937 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
)

938 
	`¬row_d¿w
(
»nd””
, 
¡¬t_¬row
->
ty³
,

939 &
¡¬t_¬row_h—d
, 
’dpošt
,

940 
¡¬t_¬row
->
Ëngth
, s¹_¬row->
width
,

941 
lše_width
,

942 
cŞÜ
, &
cŞÜ_wh™e
);

943 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
)

944 
	`¬row_d¿w
(
»nd””
, 
’d_¬row
->
ty³
,

945 &
’d_¬row_h—d
, 
¡¬ošt
,

946 
’d_¬row
->
Ëngth
,ƒnd_¬row->
width
,

947 
lše_width
,

948 
cŞÜ
, &
cŞÜ_wh™e
);

950 *
¡¬ošt
 = 
Şd¡¬t
;

951 *
’dpošt
 = 
Şd’d
;

952 
	}
}

955 
	$d¿w_pŞylše_w™h_¬rows
(
DŸR’d””
 *
»nd””
,

956 
Pošt
 *
pošts
, 
num_pošts
,

957 
»®
 
lše_width
,

958 
CŞÜ
 *
cŞÜ
,

959 
A¼ow
 *
¡¬t_¬row
,

960 
A¼ow
 *
’d_¬row
)

963 
fœ¡lše
 = 0;

964 
Ï¡lše
 = 
num_pošts
;

965 
Pošt
 
Şd¡¬t
 = 
pošts
[
fœ¡lše
];

966 
Pošt
 
Şd’d
 = 
pošts
[
Ï¡lše
-1];

967 
Pošt
 
¡¬t_¬row_h—d
;

968 
Pošt
 
’d_¬row_h—d
;

970 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
) {

971 
Pošt
 
move_¬row
, 
move_lše
;

972 
fœ¡lše
 < 
num_pošts
-1 &&

973 
	`di¡ªû_pošt_pošt
(&
pošts
[
fœ¡lše
],

974 &
pošts
[
fœ¡lše
+1]) < 0.0000001)

975 
fœ¡lše
++;

976 ià(
fœ¡lše
 =ğ
num_pošts
-1)

977 
fœ¡lše
 = 0;

978 
Şd¡¬t
 = 
pošts
[
fœ¡lše
];

979 
	`ÿlcuÏ‹_¬row_pošt
(
¡¬t_¬row
,

980 &
pošts
[
fœ¡lše
], &points[firstline+1],

981 &
move_¬row
, &
move_lše
,

982 
lše_width
);

983 
¡¬t_¬row_h—d
 = 
pošts
[
fœ¡lše
];

984 
	`pošt_sub
(&
¡¬t_¬row_h—d
, &
move_¬row
);

985 
	`pošt_sub
(&
pošts
[
fœ¡lše
], &
move_lše
);

987 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
) {

988 
Pošt
 
move_¬row
, 
move_lše
;

989 
Ï¡lše
 > 0 &&

990 
	`di¡ªû_pošt_pošt
(&
pošts
[
Ï¡lše
-1],

991 &
pošts
[
Ï¡lše
-2]) < 0.0000001)

992 
Ï¡lše
--;

993 ià(
Ï¡lše
 == 0)

994 
fœ¡lše
 = 
num_pošts
;

995 
Şd’d
 = 
pošts
[
Ï¡lše
-1];

996 
	`ÿlcuÏ‹_¬row_pošt
(
’d_¬row
, &
pošts
[
Ï¡lše
-1],

997 &
pošts
[
Ï¡lše
-2],

998 &
move_¬row
, &
move_lše
,

999 
lše_width
);

1000 
’d_¬row_h—d
 = 
pošts
[
Ï¡lše
-1];

1001 
	`pošt_sub
(&
’d_¬row_h—d
, &
move_¬row
);

1002 
	`pošt_sub
(&
pošts
[
Ï¡lše
-1], &
move_lše
);

1005 ià(
Ï¡lše
-
fœ¡lše
 > 1)

1007 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞylše
Ô’d””, &
pošts
[
fœ¡lše
],

1008 
Ï¡lše
-
fœ¡lše
, 
cŞÜ
);

1009 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
)

1010 
	`¬row_d¿w
(
»nd””
, 
¡¬t_¬row
->
ty³
,

1011 &
¡¬t_¬row_h—d
, &
pošts
[
fœ¡lše
+1],

1012 
¡¬t_¬row
->
Ëngth
, s¹_¬row->
width
,

1013 
lše_width
,

1014 
cŞÜ
, &
cŞÜ_wh™e
);

1015 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
)

1016 
	`¬row_d¿w
(
»nd””
, 
’d_¬row
->
ty³
,

1017 &
’d_¬row_h—d
, &
pošts
[
Ï¡lše
-2],

1018 
’d_¬row
->
Ëngth
,ƒnd_¬row->
width
,

1019 
lše_width
,

1020 
cŞÜ
, &
cŞÜ_wh™e
);

1022 
pošts
[
fœ¡lše
] = 
Şd¡¬t
;

1023 
pošts
[
Ï¡lše
-1] = 
Şd’d
;

1024 
	}
}

1027 
	$d¿w_rounded_pŞylše_w™h_¬rows
(
DŸR’d””
 *
»nd””
,

1028 
Pošt
 *
pošts
, 
num_pošts
,

1029 
»®
 
lše_width
,

1030 
CŞÜ
 *
cŞÜ
,

1031 
A¼ow
 *
¡¬t_¬row
,

1032 
A¼ow
 *
’d_¬row
,

1033 
»®
 
¿dius
)

1036 
fœ¡lše
 = 0;

1037 
Ï¡lše
 = 
num_pošts
;

1038 
Pošt
 
Şd¡¬t
 = 
pošts
[
fœ¡lše
];

1039 
Pošt
 
Şd’d
 = 
pošts
[
Ï¡lše
-1];

1040 
Pošt
 
¡¬t_¬row_h—d
;

1041 
Pošt
 
’d_¬row_h—d
;

1043 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
) {

1044 
Pošt
 
move_¬row
, 
move_lše
;

1045 
fœ¡lše
 < 
num_pošts
-1 &&

1046 
	`di¡ªû_pošt_pošt
(&
pošts
[
fœ¡lše
],

1047 &
pošts
[
fœ¡lše
+1]) < 0.0000001)

1048 
fœ¡lše
++;

1049 ià(
fœ¡lše
 =ğ
num_pošts
-1)

1050 
fœ¡lše
 = 0;

1051 
Şd¡¬t
 = 
pošts
[
fœ¡lše
];

1052 
	`ÿlcuÏ‹_¬row_pošt
(
¡¬t_¬row
,

1053 &
pošts
[
fœ¡lše
], &points[firstline+1],

1054 &
move_¬row
, &
move_lše
,

1055 
lše_width
);

1056 
¡¬t_¬row_h—d
 = 
pošts
[
fœ¡lše
];

1057 
	`pošt_sub
(&
¡¬t_¬row_h—d
, &
move_¬row
);

1058 
	`pošt_sub
(&
pošts
[
fœ¡lše
], &
move_lše
);

1060 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
) {

1061 
Pošt
 
move_¬row
, 
move_lše
;

1062 
Ï¡lše
 > 0 &&

1063 
	`di¡ªû_pošt_pošt
(&
pošts
[
Ï¡lše
-1],

1064 &
pošts
[
Ï¡lše
-2]) < 0.0000001)

1065 
Ï¡lše
--;

1066 ià(
Ï¡lše
 == 0)

1067 
fœ¡lše
 = 
num_pošts
;

1068 
Şd’d
 = 
pošts
[
Ï¡lše
-1];

1069 
	`ÿlcuÏ‹_¬row_pošt
(
’d_¬row
, &
pošts
[
Ï¡lše
-1],

1070 &
pošts
[
Ï¡lše
-2],

1071 &
move_¬row
, &
move_lše
,

1072 
lše_width
);

1073 
’d_¬row_h—d
 = 
pošts
[
Ï¡lše
-1];

1074 
	`pošt_sub
(&
’d_¬row_h—d
, &
move_¬row
);

1075 
	`pošt_sub
(&
pošts
[
Ï¡lše
-1], &
move_lše
);

1078 ià(
Ï¡lše
-
fœ¡lše
 > 1)

1079 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_rounded_pŞylše
(renderer,

1080 &
pošts
[
fœ¡lše
],

1081 
Ï¡lše
-
fœ¡lše
,

1082 
cŞÜ
, 
¿dius
);

1083 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
)

1084 
	`¬row_d¿w
(
»nd””
, 
¡¬t_¬row
->
ty³
,

1085 &
¡¬t_¬row_h—d
, &
pošts
[
fœ¡lše
+1],

1086 
¡¬t_¬row
->
Ëngth
, s¹_¬row->
width
,

1087 
lše_width
,

1088 
cŞÜ
, &
cŞÜ_wh™e
);

1089 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
)

1090 
	`¬row_d¿w
(
»nd””
, 
’d_¬row
->
ty³
,

1091 &
’d_¬row_h—d
, &
pošts
[
Ï¡lše
-2],

1092 
’d_¬row
->
Ëngth
,ƒnd_¬row->
width
,

1093 
lše_width
,

1094 
cŞÜ
, &
cŞÜ_wh™e
);

1096 
pošts
[
fœ¡lše
] = 
Şd¡¬t
;

1097 
pošts
[
Ï¡lše
-1] = 
Şd’d
;

1098 
	}
}

1103 
gboŞ—n


1104 
	$pošts_to_lše
(
»®
 *
a
,„—È*
b
, 
Pošt
 *
p1
, Pošˆ*
p2
)

1106 ià(
	`çbs
(
p1
->
x
 - 
p2
->x) < 0.000000001)

1107  
FALSE
;

1108 *
a
 = (
p2
->
y
-
p1
->y)/Õ2->
x
-p1->x);

1109 *
b
 = 
p1
->
y
-(*
a
)*p1->
x
;

1110  
TRUE
;

1111 
	}
}

1116 
gboŞ—n


1117 
	$š‹r£ùiÚ_lše_lše
(
Pošt
 *
üoss
,

1118 
Pošt
 *
p1a
, Pošˆ*
p1b
,

1119 
Pošt
 *
p2a
, Pošˆ*
p2b
)

1121 
»®
 
a1
, 
b1
, 
a2
, 
b2
;

1124 ià(!(
	`pošts_to_lše
(&
a1
, &
b1
, 
p1a
, 
p1b
))) {

1125 ià(!(
	`pošts_to_lše
(&
a2
, &
b2
, 
p2a
, 
p2b
))) {

1126 ià(
	`çbs
(
p1a
->
x
-
p2a
->x) < 0.00000001) {

1127 *
üoss
 = *
p1a
;

1128  
TRUE
;

1129 }  
FALSE
;

1131 
üoss
->
x
 = 
p1a
->x;

1132 
üoss
->
y
 = 
a2
*(
p1a
->
x
)+
b2
;

1133  
TRUE
;

1135 ià(!(
	`pošts_to_lše
(&
a2
, &
b2
, 
p2a
, 
p2b
))) {

1136 
üoss
->
x
 = 
p2a
->x;

1137 
üoss
->
y
 = 
a1
*(
p2a
->
x
)+
b1
;

1138  
TRUE
;

1141 ià(
	`çbs
(
a1
-
a2
) < 0.000000001) {

1142 ià(
	`çbs
(
b1
-
b2
) < 0.000000001) {

1143 *
üoss
 = *
p1a
;

1144  
TRUE
;

1146  
FALSE
;

1156 
üoss
->
x
 = (
b2
-
b1
)/(
a1
-
a2
);

1157 
üoss
->
y
 = 
a1
*üoss->
x
+
b1
;

1158  
TRUE
;

1160 
	}
}

1167 
gboŞ—n


1168 
	$fšd_ûÁ”_pošt
(
Pošt
 *
ûÁ”
, cÚ¡ Pošˆ*
p1
, cÚ¡ Pošˆ*
p2
, cÚ¡ Pošˆ*
p3
)

1170 
Pošt
 
mid1
;

1171 
Pošt
 
mid2
;

1172 
Pošt
 
Üth1
;

1173 
Pošt
 
Üth2
;

1174 
»®
 
tmp
;

1177 
mid1
 = *
p1
;

1178 
	`pošt_sub
(&
mid1
, 
p2
);

1179 
	`pošt_sÿË
(&
mid1
, 0.5);

1180 
Üth1
 = 
mid1
;

1181 
	`pošt_add
(&
mid1
, 
p2
);

1182 
tmp
 = 
Üth1
.
x
;

1183 
Üth1
.
x
 = o¹h1.
y
;

1184 
Üth1
.
y
 = -
tmp
;

1185 
	`pošt_add
(&
Üth1
, &
mid1
);

1189 
mid2
 = *
p2
;

1190 
	`pošt_sub
(&
mid2
, 
p3
);

1191 
	`pošt_sÿË
(&
mid2
, 0.5);

1192 
Üth2
 = 
mid2
;

1193 
	`pošt_add
(&
mid2
, 
p3
);

1194 
tmp
 = 
Üth2
.
x
;

1195 
Üth2
.
x
 = o¹h2.
y
;

1196 
Üth2
.
y
 = -
tmp
;

1197 
	`pošt_add
(&
Üth2
, &
mid2
);

1200 ià(!
	`š‹r£ùiÚ_lše_lše
(
ûÁ”
, &
mid1
, &
Üth1
, &
mid2
, &
Üth2
)) {

1203 ià(
	`çbs
((
p1
->
x
 + 
p2
->x + 
p3
->x)/3 -…1->x) < 0.0000001 &&

1204 
	`çbs
((
p1
->
y
 + 
p2
->y + 
p3
->y)/3 -…1->y) < 0.0000001) {

1205  
FALSE
;

1210 ià(
	`di¡ªû_pošt_pošt_mªh©n
(
p1
, 
p2
) < 0.0000001) {

1211 *
ûÁ”
 = 
mid2
;

1212  
TRUE
;

1213 } ià(
	`di¡ªû_pošt_pošt_mªh©n
(
p1
, 
p3
) < 0.0000001 ||

1214 
	`di¡ªû_pošt_pošt_mªh©n
(
p2
, 
p3
) < 0.0000001) {

1215 *
ûÁ”
 = 
mid1
;

1216  
TRUE
;

1219  
FALSE
;

1221  
TRUE
;

1222 
	}
}

1224 
gboŞ—n


1225 
	$is_right_hªd
 (cÚ¡ 
Pošt
 *
a
, cÚ¡ Pošˆ*
b
, cÚ¡ Pošˆ*
c
)

1227 
Pošt
 
dÙ1
, 
dÙ2
;

1229 
dÙ1
 = *
a
;

1230 
	`pošt_sub
(&
dÙ1
, 
c
);

1231 
	`pošt_nÜm®ize
(&
dÙ1
);

1232 
dÙ2
 = *
b
;

1233 
	`pošt_sub
(&
dÙ2
, 
c
);

1234 
	`pošt_nÜm®ize
(&
dÙ2
);

1235  
	`pošt_üoss
(&
dÙ1
, &
dÙ2
) > 0;

1236 
	}
}

1239 
	$d¿w_¬c_w™h_¬rows
 (
DŸR’d””
 *
»nd””
,

1240 
Pošt
 *
¡¬ošt
,

1241 
Pošt
 *
’dpošt
,

1242 
Pošt
 *
midpošt
,

1243 
»®
 
lše_width
,

1244 
CŞÜ
 *
cŞÜ
,

1245 
A¼ow
 *
¡¬t_¬row
,

1246 
A¼ow
 *
’d_¬row
)

1248 
Pošt
 
Ãw_¡¬ošt
 = *
¡¬ošt
;

1249 
Pošt
 
Ãw_’dpošt
 = *
’dpošt
;

1250 
Pošt
 
ûÁ”
;

1251 
»®
 
width
, 
ªgË1
, 
ªgË2
;

1252 
gboŞ—n
 
righthªd
;

1253 
Pošt
 
¡¬t_¬row_h—d
;

1254 
Pošt
 
¡¬t_¬row_’d
;

1255 
Pošt
 
’d_¬row_h—d
;

1256 
Pošt
 
’d_¬row_’d
;

1258 ià(!
	`fšd_ûÁ”_pošt
(&
ûÁ”
, 
¡¬ošt
, 
’dpošt
, 
midpošt
)) {

1260 
	`´štf
("Degenerate\n");

1263 
righthªd
 = 
	`is_right_hªd
 (
¡¬ošt
, 
midpošt
, 
’dpošt
);

1265 
width
 = 2*
	`di¡ªû_pošt_pošt
(&
ûÁ”
, 
¡¬ošt
);

1267 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
) {

1268 
Pošt
 
move_¬row
, 
move_lše
;

1269 
»®
 
tmp
;

1271 
¡¬t_¬row_’d
 = *
¡¬ošt
;

1272 
	`pošt_sub
(&
¡¬t_¬row_’d
, &
ûÁ”
);

1273 
tmp
 = 
¡¬t_¬row_’d
.
x
;

1274 ià(
righthªd
) {

1275 
¡¬t_¬row_’d
.
x
 = -¡¬t_¬row_’d.
y
;

1276 
¡¬t_¬row_’d
.
y
 = 
tmp
;

1278 
¡¬t_¬row_’d
.
x
 = s¹_¬row_’d.
y
;

1279 
¡¬t_¬row_’d
.
y
 = -
tmp
;

1281 
	`pošt_add
(&
¡¬t_¬row_’d
, 
¡¬ošt
);

1283 
	`ÿlcuÏ‹_¬row_pošt
(
¡¬t_¬row
, 
¡¬ošt
, &
¡¬t_¬row_’d
,

1284 &
move_¬row
, &
move_lše
,

1285 
lše_width
);

1286 
¡¬t_¬row_h—d
 = *
¡¬ošt
;

1287 
	`pošt_sub
(&
¡¬t_¬row_h—d
, &
move_¬row
);

1288 
	`pošt_sub
(&
Ãw_¡¬ošt
, &
move_lše
);

1290 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
) {

1291 
Pošt
 
move_¬row
, 
move_lše
;

1292 
»®
 
tmp
;

1294 
’d_¬row_’d
 = *
’dpošt
;

1295 
	`pošt_sub
(&
’d_¬row_’d
, &
ûÁ”
);

1296 
tmp
 = 
’d_¬row_’d
.
x
;

1297 ià(
righthªd
) {

1298 
’d_¬row_’d
.
x
 =ƒnd_¬row_’d.
y
;

1299 
’d_¬row_’d
.
y
 = -
tmp
;

1301 
’d_¬row_’d
.
x
 = -’d_¬row_’d.
y
;

1302 
’d_¬row_’d
.
y
 = 
tmp
;

1304 
	`pošt_add
(&
’d_¬row_’d
, 
’dpošt
);

1306 
	`ÿlcuÏ‹_¬row_pošt
(
’d_¬row
, 
’dpošt
, &
’d_¬row_’d
,

1307 &
move_¬row
, &
move_lše
,

1308 
lše_width
);

1309 
’d_¬row_h—d
 = *
’dpošt
;

1310 
	`pošt_sub
(&
’d_¬row_h—d
, &
move_¬row
);

1311 
	`pošt_sub
(&
Ãw_’dpošt
, &
move_lše
);

1324 
ªgË1
 = -
	`©ª2
(
Ãw_¡¬ošt
.
y
 - 
ûÁ”
.y,‚ew_¡¬ošt.
x
 - c’‹r.x)*180.0/
G_PI
;

1325 
ªgË1
 < 0.0)‡ngle1 += 360.0;

1326 
ªgË2
 = -
	`©ª2
(
Ãw_’dpošt
.
y
 - 
ûÁ”
.y,‚ew_’dpošt.
x
 - c’‹r.x)*180.0/
G_PI
;

1327 
ªgË2
 < 0.0)‡ngle2 += 360.0;

1328 ià(
righthªd
) {

1329 
»®
 
tmp
 = 
ªgË1
;

1330 
ªgË1
 = 
ªgË2
;

1331 
ªgË2
 = 
tmp
;

1334 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
) {

1335 
Ãw_¡¬ošt
.
x
 = 
	`cos
 (
G_PI
 * 
ªgË1
 / 180.0è* 
width
 / 2.0 + 
ûÁ”
.x;

1336 
Ãw_¡¬ošt
.
y
 = 
	`sš
 (
G_PI
 * 
ªgË1
 / 180.0è* 
width
 / 2.0 + 
ûÁ”
.y;

1338 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
) {

1339 
Ãw_’dpošt
.
x
 = 
	`cos
 (
G_PI
 * 
ªgË1
 / 180.0è* 
width
 / 2.0 + 
ûÁ”
.x;

1340 
Ãw_’dpošt
.
y
 = 
	`sš
 (
G_PI
 * 
ªgË1
 / 180.0è* 
width
 / 2.0 + 
ûÁ”
.y;

1343 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_¬c
Ô’d””, &
ûÁ”
, 
width
, width,

1344 
ªgË1
, 
ªgË2
, 
cŞÜ
);

1346 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
)

1347 
	`¬row_d¿w
(
»nd””
, 
¡¬t_¬row
->
ty³
,

1348 &
¡¬t_¬row_h—d
, &
¡¬t_¬row_’d
,

1349 
¡¬t_¬row
->
Ëngth
, s¹_¬row->
width
,

1350 
lše_width
,

1351 
cŞÜ
, &
cŞÜ_wh™e
);

1352 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
)

1353 
	`¬row_d¿w
(
»nd””
, 
’d_¬row
->
ty³
,

1354 &
’d_¬row_h—d
, &
’d_¬row_’d
,

1355 
’d_¬row
->
Ëngth
,ƒnd_¬row->
width
,

1356 
lše_width
,

1357 
cŞÜ
, &
cŞÜ_wh™e
);

1358 
	}
}

1361 
	$d¿w_bez›r_w™h_¬rows
(
DŸR’d””
 *
»nd””
,

1362 
BezPošt
 *
pošts
,

1363 
num_pošts
,

1364 
»®
 
lše_width
,

1365 
CŞÜ
 *
cŞÜ
,

1366 
A¼ow
 *
¡¬t_¬row
,

1367 
A¼ow
 *
’d_¬row
)

1369 
Pošt
 
¡¬ošt
, 
’dpošt
;

1370 
Pošt
 
¡¬t_¬row_h—d
;

1371 
Pošt
 
’d_¬row_h—d
;

1373 
¡¬ošt
 = 
pošts
[0].
p1
;

1374 
’dpošt
 = 
pošts
[
num_pošts
-1].
p3
;

1376 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
) {

1377 
Pošt
 
move_¬row
;

1378 
Pošt
 
move_lše
;

1379 
	`ÿlcuÏ‹_¬row_pošt
(
¡¬t_¬row
, &
pošts
[0].
p1
, &points[1].p1,

1380 &
move_¬row
, &
move_lše
,

1381 
lše_width
);

1382 
¡¬t_¬row_h—d
 = 
pošts
[0].
p1
;

1383 
	`pošt_sub
(&
¡¬t_¬row_h—d
, &
move_¬row
);

1384 
	`pošt_sub
(&
pošts
[0].
p1
, &
move_lše
);

1386 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
) {

1387 
Pošt
 
move_¬row
;

1388 
Pošt
 
move_lše
;

1389 
	`ÿlcuÏ‹_¬row_pošt
(
’d_¬row
,

1390 &
pošts
[
num_pošts
-1].
p3
, &pošts[num_pošts-1].
p2
,

1391 &
move_¬row
, &
move_lše
,

1392 
lše_width
);

1393 
’d_¬row_h—d
 = 
pošts
[
num_pošts
-1].
p3
;

1394 
	`pošt_sub
(&
’d_¬row_h—d
, &
move_¬row
);

1395 
	`pošt_sub
(&
pošts
[
num_pošts
-1].
p3
, &
move_lše
);

1397 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_bez›r
Ô’d””, 
pošts
, 
num_pošts
, 
cŞÜ
);

1398 ià(
¡¬t_¬row
 !ğ
NULL
 && s¹_¬row->
ty³
 !ğ
ARROW_NONE
)

1399 
	`¬row_d¿w
(
»nd””
, 
¡¬t_¬row
->
ty³
,

1400 &
¡¬t_¬row_h—d
, &
pošts
[1].
p1
,

1401 
¡¬t_¬row
->
Ëngth
, s¹_¬row->
width
,

1402 
lše_width
,

1403 
cŞÜ
, &
cŞÜ_wh™e
);

1404 ià(
’d_¬row
 !ğ
NULL
 &&ƒnd_¬row->
ty³
 !ğ
ARROW_NONE
)

1405 
	`¬row_d¿w
(
»nd””
, 
’d_¬row
->
ty³
,

1406 &
’d_¬row_h—d
, &
pošts
[
num_pošts
-1].
p2
,

1407 
’d_¬row
->
Ëngth
,ƒnd_¬row->
width
,

1408 
lše_width
,

1409 
cŞÜ
, &
cŞÜ_wh™e
);

1411 
pošts
[0].
p1
 = 
¡¬ošt
;

1412 
pošts
[
num_pošts
-1].
p3
 = 
’dpošt
;

1414 
	}
}

1420 
»®


1421 
	$g‘_‹xt_width
 (
DŸR’d””
 *
»nd””
,

1422 cÚ¡ 
gch¬
 *
‹xt
, 
Ëngth
)

1424 
»®
 
»t
 = 0;

1426 ià(
»nd””
->
fÚt
) {

1427 *
¡r
 = 
	`g_¡ºdup
 (
‹xt
, 
Ëngth
);

1429 
»t
 = 
	`dŸ_fÚt_¡ršg_width
 (
¡r
,

1430 
»nd””
->
fÚt
,

1431 
»nd””
->
fÚt_height
);

1432 
	`g_ä“
 (
¡r
);

1434 
	`g_w¬nšg
 ("%s::get_text_width‚ot implemented (and„enderer->font==NULL)!",

1435 
	`G_OBJECT_CLASS_NAME
 (
	`G_OBJECT_GET_CLASS
 (
»nd””
)));

1438  
»t
;

1439 
	}
}

1442 
	$g‘_width_pix–s
 (
DŸR’d””
 *
»nd””
)

1444 
	`g_»tuº_v®_if_ç
 (
»nd””
->
is_š‹¿ùive
, 0);

1446 
	}
}

1449 
	$g‘_height_pix–s
 (
DŸR’d””
 *
»nd””
)

1451 
	`g_»tuº_v®_if_ç
 (
»nd””
->
is_š‹¿ùive
, 0);

1453 
	}
}

1460 
	$dŸ_»nd””_g‘_width_pix–s
 (
DŸR’d””
 *
»nd””
)

1462  
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`g‘_width_pix–s
 (renderer);

1463 
	}
}

1466 
	$dŸ_»nd””_g‘_height_pix–s
 (
DŸR’d””
 *
»nd””
)

1468  
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`g‘_height_pix–s
 (renderer);

1469 
	}
}

	@O:\tool\dvs50\lib\diarenderer.h

20 #iâdeà
DIA_RENDERER_H


21 
	#DIA_RENDERER_H


	)

23 
	~"dŸty³s.h
"

24 
	~<glib-objeù.h
>

26 
	~"dŸ-’ums.h
"

27 
	~"geom‘ry.h
"

28 
	~"fÚt.h
"

30 
	gG_BEGIN_DECLS


33 
	#DIA_TYPE_RENDERER
 (
	`dŸ_»nd””_g‘_ty³
 ())

	)

35 
	#DIA_RENDERER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_RENDERER
, 
DŸR’d””
))

	)

37 
	#DIA_RENDERER_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_RENDERER
, 
DŸR’d””CÏss
))

	)

39 
	#DIA_IS_RENDERER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_RENDERER
))

	)

41 
	#DIA_RENDERER_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_RENDERER
, 
DŸR’d””CÏss
))

	)

43 
	$__deş¥ec
(
dÎexpÜt
è
GTy³
 
	$dŸ_»nd””_g‘_ty³
 (è
G_GNUC_CONST
;

46 
	s_DŸR’d””


48 
GObjeù
 
·»Á_š¡ªû
;

49 
gboŞ—n
 
is_š‹¿ùive
;

51 
DŸFÚt
 *
fÚt
;

52 
»®
 
fÚt_height
;

56 
Bez›rAµrox
 *
bez›r
;

67 
	s_DŸR’d””CÏss


69 
GObjeùCÏss
 
·»Á_şass
;

72 (*
g‘_width_pix–s
è(
DŸR’d””
*);

74 (*
g‘_height_pix–s
è(
DŸR’d””
*);

76 (*
d¿w_objeù
è(
DŸR’d””
*, 
DŸObjeù
*);

82 
	`»®
 (*
g‘_‹xt_width
è(
DŸR’d””
 *
»nd””
,

83 cÚ¡ 
gch¬
 *
‹xt
, 
Ëngth
);

91 (*
begš_»nd”
è(
DŸR’d””
 *);

94 (*
’d_»nd”
è(
DŸR’d””
 *);

98 (*
£t_lšewidth
è(
DŸR’d””
 *
»nd””
, 
»®
 
lšewidth
);

100 (*
£t_lšeÿps
è(
DŸR’d””
 *
»nd””
, 
LšeC­s
 
mode
);

102 (*
£t_lšejoš
è(
DŸR’d””
 *
»nd””
, 
LšeJoš
 
mode
);

104 (*
£t_lše¡yË
è(
DŸR’d””
 *
»nd””
, 
LšeStyË
 
mode
);

107 (*
£t_dashËngth
è(
DŸR’d””
 *
»nd””
, 
»®
 
Ëngth
);

109 (*
£t_fl¡yË
è(
DŸR’d””
 *
»nd””
, 
FlStyË
 
mode
);

111 (*
£t_fÚt
è(
DŸR’d””
 *
»nd””
, 
DŸFÚt
 *
fÚt
, 
»®
 
height
);

114 (*
d¿w_lše
è(
DŸR’d””
 *
»nd””
,

115 
Pošt
 *
¡¬t
, Pošˆ*
’d
,

116 
CŞÜ
 *
cŞÜ
);

118 (*
fl_»ù
è(
DŸR’d””
 *
»nd””
,

119 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

120 
CŞÜ
 *
cŞÜ
);

122 (*
fl_pŞygÚ
è(
DŸR’d””
 *
»nd””
,

123 
Pošt
 *
pošts
, 
num_pošts
,

124 
CŞÜ
 *
cŞÜ
);

127 (*
d¿w_¬c
è(
DŸR’d””
 *
»nd””
,

128 
Pošt
 *
ûÁ”
,

129 
»®
 
width
,„—È
height
,

130 
»®
 
ªgË1
,„—È
ªgË2
,

131 
CŞÜ
 *
cŞÜ
);

133 (*
fl_¬c
è(
DŸR’d””
 *
»nd””
,

134 
Pošt
 *
ûÁ”
,

135 
»®
 
width
,„—È
height
,

136 
»®
 
ªgË1
,„—È
ªgË2
,

137 
CŞÜ
 *
cŞÜ
);

139 (*
d¿w_–l£
è(
DŸR’d””
 *
»nd””
,

140 
Pošt
 *
ûÁ”
,

141 
»®
 
width
,„—È
height
,

142 
CŞÜ
 *
cŞÜ
);

144 (*
fl_–l£
è(
DŸR’d””
 *
»nd””
,

145 
Pošt
 *
ûÁ”
,

146 
»®
 
width
,„—È
height
,

147 
CŞÜ
 *
cŞÜ
);

149 (*
d¿w_¡ršg
è(
DŸR’d””
 *
»nd””
,

150 cÚ¡ 
gch¬
 *
‹xt
,

151 
Pošt
 *
pos
,

152 
Alignm’t
 
®ignm’t
,

153 
CŞÜ
 *
cŞÜ
);

155 (*
d¿w_image
è(
DŸR’d””
 *
»nd””
,

156 
Pošt
 *
pošt
,

157 
»®
 
width
,„—È
height
,

158 
DŸImage
 *
image
);

166 (*
d¿w_bez›r
è(
DŸR’d””
 *
»nd””
,

167 
BezPošt
 *
pošts
,

168 
numpošts
,

169 
CŞÜ
 *
cŞÜ
);

172 (*
fl_bez›r
è(
DŸR’d””
 *
»nd””
,

173 
BezPošt
 *
pošts
,

174 
numpošts
,

175 
CŞÜ
 *
cŞÜ
);

178 (*
d¿w_pŞylše
è(
DŸR’d””
 *
»nd””
,

179 
Pošt
 *
pošts
, 
num_pošts
,

180 
CŞÜ
 *
cŞÜ
);

184 (*
d¿w_pŞygÚ
è(
DŸR’d””
 *
»nd””
,

185 
Pošt
 *
pošts
, 
num_pošts
,

186 
CŞÜ
 *
cŞÜ
);

188 (*
d¿w_‹xt
è(
DŸR’d””
 *
»nd””
,

189 
Text
 *
‹xt
);

191 (*
d¿w_‹xt_lše
è(
DŸR’d””
 *
»nd””
,

192 
TextLše
 *
‹xt_lše
, 
Pošt
 *
pos
, 
Alignm’t
 
®ignm’t
, 
CŞÜ
 *
cŞÜ
);

194 (*
d¿w_»ù
è(
DŸR’d””
 *
»nd””
,

195 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

196 
CŞÜ
 *
cŞÜ
);

203 (*
d¿w_rounded_»ù
è(
DŸR’d””
 *
»nd””
,

204 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

205 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
);

208 (*
fl_rounded_»ù
è(
DŸR’d””
 *
»nd””
,

209 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

210 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
);

213 (*
d¿w_rounded_pŞylše
è(
DŸR’d””
 *
»nd””
,

214 
Pošt
 *
pošts
, 
num_pošts
,

215 
CŞÜ
 *
cŞÜ
, 
»®
 
¿dius
 );

218 (*
d¿w_lše_w™h_¬rows
è(
DŸR’d””
 *
»nd””
,

219 
Pošt
 *
¡¬t
, Pošˆ*
’d
,

220 
»®
 
lše_width
,

221 
CŞÜ
 *
lše_cŞÜ
,

222 
A¼ow
 *
¡¬t_¬row
,

223 
A¼ow
 *
’d_¬row
);

225 (*
d¿w_¬c_w™h_¬rows
è(
DŸR’d””
 *
»nd””
,

226 
Pošt
 *
¡¬t
, Pošˆ*
’d
,

227 
Pošt
 *
midpošt
,

228 
»®
 
lše_width
,

229 
CŞÜ
 *
cŞÜ
,

230 
A¼ow
 *
¡¬t_¬row
,

231 
A¼ow
 *
’d_¬row
);

233 (*
d¿w_pŞylše_w™h_¬rows
è(
DŸR’d””
 *
»nd””
,

234 
Pošt
 *
pošts
, 
num_pošts
,

235 
»®
 
lše_width
,

236 
CŞÜ
 *
cŞÜ
,

237 
A¼ow
 *
¡¬t_¬row
,

238 
A¼ow
 *
’d_¬row
);

239 (*
d¿w_rounded_pŞylše_w™h_¬rows
è(
DŸR’d””
 *
»nd””
,

240 
Pošt
 *
pošts
, 
num_pošts
,

241 
»®
 
lše_width
,

242 
CŞÜ
 *
cŞÜ
,

243 
A¼ow
 *
¡¬t_¬row
,

244 
A¼ow
 *
’d_¬row
,

245 
»®
 
¿dius
);

247 (*
d¿w_bez›r_w™h_¬rows
è(
DŸR’d””
 *
»nd””
,

248 
BezPošt
 *
pošts
,

249 
num_pošts
,

250 
»®
 
lše_width
,

251 
CŞÜ
 *
cŞÜ
,

252 
A¼ow
 *
¡¬t_¬row
,

253 
A¼ow
 *
’d_¬row
);

260 
	#DIA_TYPE_INTERACTIVE_RENDERER_INTERFACE
 (
	`dŸ_š‹¿ùive_»nd””_š‹rçû_g‘_ty³
 ())

	)

261 
	#DIA_GET_INTERACTIVE_RENDERER_INTERFACE
(
obj
è(
	`G_TYPE_INSTANCE_GET_INTERFACE
 ((obj), 
DIA_TYPE_INTERACTIVE_RENDERER_INTERFACE
, 
DŸIÁ”aùiveR’d””IÁ”çû
))

	)

263 
	s_DŸIÁ”aùiveR’d””IÁ”çû


265 
GTy³IÁ”çû
 
ba£_içû
;

268 (*
£t_size
è(
DŸR’d””
 *
»nd””
, 
gpoš‹r
, , );

271 (*
ş_»giÚ_ş—r
è(
DŸR’d””
 *
»nd””
);

274 (*
ş_»giÚ_add_»ù
è(
DŸR’d””
 *
»nd””
, 
ReùªgË
 *
»ù
);

277 (*
d¿w_pix–_lše
è(
DŸR’d””
 *
»nd””
,

278 
x1
, 
y1
, 
x2
, 
y2
,

279 
CŞÜ
 *
cŞÜ
);

281 (*
d¿w_pix–_»ù
è(
DŸR’d””
 *
»nd””
,

282 
x
, 
y
, 
width
, 
height
,

283 
CŞÜ
 *
cŞÜ
);

285 (*
fl_pix–_»ù
è(
DŸR’d””
 *
»nd””
,

286 
x
, 
y
, 
width
, 
height
,

287 
CŞÜ
 *
cŞÜ
);

289 (*
cİy_to_wšdow
è(
DŸR’d””
 *
»nd””
,

290 
gpoš‹r
 
wšdow
,

291 
x
, 
y
, 
width
, 
height
);

294 
	$__deş¥ec
(
dÎexpÜt
è
GTy³
 
	$dŸ_š‹¿ùive_»nd””_š‹rçû_g‘_ty³
 (è
G_GNUC_CONST
;

296 
DIAVAR
 
	`dŸ_»nd””_£t_size
 (
DŸR’d””
*, 
gpoš‹r
 
wšdow
, , );

297 
DIAVAR
 
	`dŸ_»nd””_g‘_width_pix–s
 (
DŸR’d””
*);

298 
DIAVAR
 
	`dŸ_»nd””_g‘_height_pix–s
 (
DŸR’d””
*);

300 
G_END_DECLS


	@O:\tool\dvs50\lib\diasvgrenderer.c

27 
	~<cÚfig.h
>

29 
	~<¡dlib.h
>

30 
	~<¡ršg.h
>

31 
	~<time.h
>

32 
	~<m©h.h
>

33 
	~<glib.h
>

34 #ifdeà
HAVE_UNISTD_H


35 
	~<uni¡d.h
>

38 
	~<libxml/’t™›s.h
>

39 
	~<libxml/Œ“.h
>

40 
	~<libxml/xmlmemÜy.h
>

42 
	~"geom‘ry.h
"

43 
	~"š.h
"

44 
	~"mes§ge.h
"

45 
	~"dŸ_xml_libxml.h
"

46 
	~"dŸ_image.h
"

48 
	~"dŸsvg»nd””.h
"

49 
	~"‹xše.h
"

51 
	#DTOSTR_BUF_SIZE
 
G_ASCII_DTOSTR_BUF_SIZE


	)

52 
	#dŸ_svg_dto¡r
(
buf
,
d
) \

53 
	`g_ascii_fÜm©d
(
buf
,(buf),"%g",(
d
)*
»nd””
->
sÿË
)

	)

55 
d¿w_‹xt_lše
(
DŸR’d””
 *
£lf
, 
TextLše
 *
‹xt_lše
,

56 
Pošt
 *
pos
, 
Alignm’t
 
®ignm’t
, 
CŞÜ
 *
cŞour
);

60 
	$begš_»nd”
(
DŸR’d””
 *
£lf
)

62 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

64 
»nd””
->
lšewidth
 = 0;

65 
»nd””
->
lšeÿp
 = "butt";

66 
»nd””
->
lšejoš
 = "miter";

67 
»nd””
->
lše¡yË
 = 
NULL
;

68 
	}
}

71 
	$’d_»nd”
(
DŸR’d””
 *
£lf
)

73 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

74 
	`g_ä“
(
»nd””
->
lše¡yË
);

76 
	`xmlS‘DocCom´essMode
(
»nd””
->
doc
, 0);

77 
	`xmlDŸSaveFe
(
»nd””
->
f’ame
,„’d””->
doc
);

78 
	`g_ä“
(
»nd””
->
f’ame
);

79 
	`xmlF»eDoc
(
»nd””
->
doc
);

80 
	}
}

83 
	$£t_lšewidth
(
DŸR’d””
 *
£lf
, 
»®
 
lšewidth
)

85 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

87 ià(
lšewidth
 == 0)

88 
»nd””
->
lšewidth
 = 0.001;

90 
»nd””
->
lšewidth
 =†inewidth;

91 
	}
}

94 
	$£t_lšeÿps
(
DŸR’d””
 *
£lf
, 
LšeC­s
 
mode
)

96 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

98 
mode
) {

99 
LINECAPS_BUTT
:

100 
»nd””
->
lšeÿp
 = "butt";

102 
LINECAPS_ROUND
:

103 
»nd””
->
lšeÿp
 = "round";

105 
LINECAPS_PROJECTING
:

106 
»nd””
->
lšeÿp
 = "square";

109 
»nd””
->
lšeÿp
 = "butt";

111 
	}
}

114 
	$£t_lšejoš
(
DŸR’d””
 *
£lf
, 
LšeJoš
 
mode
)

116 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

118 
mode
) {

119 
LINEJOIN_MITER
:

120 
»nd””
->
lšejoš
 = "miter";

122 
LINEJOIN_ROUND
:

123 
»nd””
->
lšejoš
 = "round";

125 
LINEJOIN_BEVEL
:

126 
»nd””
->
lšejoš
 = "bevel";

129 
»nd””
->
lšejoš
 = "miter";

131 
	}
}

134 
	$£t_lše¡yË
(
DŸR’d””
 *
£lf
, 
LšeStyË
 
mode
)

136 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

137 
»®
 
hŞe_width
;

138 
gch¬
 
dash_Ëngth_buf
[
DTOSTR_BUF_SIZE
];

139 
gch¬
 
dÙ_Ëngth_buf
[
DTOSTR_BUF_SIZE
];

140 
gch¬
 
hŞe_width_buf
[
DTOSTR_BUF_SIZE
];

142 
»nd””
->
§ved_lše_¡yË
 = 
mode
;

144 
	`g_ä“
(
»nd””
->
lše¡yË
);

145 
mode
) {

146 
LINESTYLE_SOLID
:

147 
»nd””
->
lše¡yË
 = 
NULL
;

149 
LINESTYLE_DASHED
:

150 
	`dŸ_svg_dto¡r
(
dash_Ëngth_buf
, 
»nd””
->
dash_Ëngth
);

151 
»nd””
->
lše¡yË
 = 
	`g_¡rdup_´štf
("%s", 
dash_Ëngth_buf
);

153 
LINESTYLE_DASH_DOT
:

154 
hŞe_width
 = (
»nd””
->
dash_Ëngth
 -„’d””->
dÙ_Ëngth
) / 2.0;

156 
	`dŸ_svg_dto¡r
(
dash_Ëngth_buf
, 
»nd””
->
dash_Ëngth
);

157 
	`dŸ_svg_dto¡r
(
dÙ_Ëngth_buf
, 
»nd””
->
dÙ_Ëngth
);

158 
	`dŸ_svg_dto¡r
(
hŞe_width_buf
, 
hŞe_width
);

160 
»nd””
->
lše¡yË
 = 
	`g_¡rdup_´štf
("%s %s %s %s",

161 
dash_Ëngth_buf
,

162 
hŞe_width_buf
,

163 
dÙ_Ëngth_buf
,

164 
hŞe_width_buf
 );

166 
LINESTYLE_DASH_DOT_DOT
:

167 
hŞe_width
 = (
»nd””
->
dash_Ëngth
 - 2.0*»nd””->
dÙ_Ëngth
) / 3.0;

169 
	`dŸ_svg_dto¡r
(
dash_Ëngth_buf
, 
»nd””
->
dash_Ëngth
);

170 
	`dŸ_svg_dto¡r
(
dÙ_Ëngth_buf
, 
»nd””
->
dÙ_Ëngth
);

171 
	`dŸ_svg_dto¡r
(
hŞe_width_buf
, 
hŞe_width
);

173 
»nd””
->
lše¡yË
 = 
	`g_¡rdup_´štf
("%s %s %s %s %s %s",

174 
dash_Ëngth_buf
,

175 
hŞe_width_buf
,

176 
dÙ_Ëngth_buf
,

177 
hŞe_width_buf
,

178 
dÙ_Ëngth_buf
,

179 
hŞe_width_buf
 );

181 
LINESTYLE_DOTTED
:

183 
	`dŸ_svg_dto¡r
(
dÙ_Ëngth_buf
, 
»nd””
->
dÙ_Ëngth
);

185 
»nd””
->
lše¡yË
 = 
	`g_¡rdup_´štf
("%s", 
dÙ_Ëngth_buf
);

188 
»nd””
->
lše¡yË
 = 
NULL
;

190 
	}
}

193 
	$£t_dashËngth
(
DŸR’d””
 *
£lf
, 
»®
 
Ëngth
)

195 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

197 ià(
Ëngth
<0.001)

198 
Ëngth
 = 0.001;

200 
»nd””
->
dash_Ëngth
 = 
Ëngth
;

201 
»nd””
->
dÙ_Ëngth
 = 
Ëngth
*0.2;

203 
	`£t_lše¡yË
(
£lf
, 
»nd””
->
§ved_lše_¡yË
);

204 
	}
}

207 
	$£t_fl¡yË
(
DŸR’d””
 *
£lf
, 
FlStyË
 
mode
)

209 
mode
) {

210 
FILLSTYLE_SOLID
:

213 
	`mes§ge_”rÜ
("svg_renderer: Unsupported fill mode specified!\n");

215 
	}
}

218 cÚ¡ 
gch¬
 *

219 
	$g‘_d¿w_¡yË
(
DŸSvgR’d””
 *
»nd””
,

220 
CŞÜ
 *
cŞour
)

222 
GSŒšg
 *
¡r
 = 
NULL
;

223 
gch¬
 
lšewidth_buf
[
DTOSTR_BUF_SIZE
];

225 ià(!
¡r
è¡¸ğ
	`g_¡ršg_Ãw
(
NULL
);

226 
	`g_¡ršg_Œunÿ‹
(
¡r
, 0);

229 
	`g_¡ršg_´štf
(
¡r
, "fl:‚Úe; fl-İac™y:0; sŒoke-width: %s", 
	`dŸ_svg_dto¡r
(
lšewidth_buf
, 
»nd””
->
lšewidth
) );

230 ià(
	`¡rcmp
(
»nd””
->
lšeÿp
, "butt"))

231 
	`g_¡ršg_­³nd_´štf
(
¡r
, "; sŒoke-lšeÿp: %s", 
»nd””
->
lšeÿp
);

232 ià(
	`¡rcmp
(
»nd””
->
lšejoš
, "miter"))

233 
	`g_¡ršg_­³nd_´štf
(
¡r
, "; sŒoke-lšejoš: %s", 
»nd””
->
lšejoš
);

234 ià(
»nd””
->
lše¡yË
)

235 
	`g_¡ršg_­³nd_´štf
(
¡r
, "; sŒoke-dash¬¿y: %s", 
»nd””
->
lše¡yË
);

237 ià(
cŞour
)

238 
	`g_¡ršg_­³nd_´štf
(
¡r
, "; stroke: #%02x%02x%02x",

239 ()(255*
cŞour
->
»d
),

240 ()(255*
cŞour
->
g»’
),

241 ()(255*
cŞour
->
blue
));

243  
¡r
->str;

244 
	}
}

247 cÚ¡ 
gch¬
 *

248 
	$g‘_fl_¡yË
(
DŸSvgR’d””
 *
»nd””
,

249 
CŞÜ
 *
cŞour
)

251 
GSŒšg
 *
¡r
 = 
NULL
;

253 ià(!
¡r
è¡¸ğ
	`g_¡ršg_Ãw
(
NULL
);

255 
	`g_¡ršg_´štf
(
¡r
, "fill: #%02x%02x%02x",

256 ()(255*
cŞour
->
»d
),

257 ()(255*
cŞour
->
g»’
),

258 ()(255*
cŞour
->
blue
));

260  
¡r
->str;

261 
	}
}

264 
	$d¿w_lše
(
DŸR’d””
 *
£lf
,

265 
Pošt
 *
¡¬t
, Pošˆ*
’d
,

266 
CŞÜ
 *
lše_cŞour
)

268 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

269 
xmlNodePŒ
 
node
;

270 
gch¬
 
d_buf
[
DTOSTR_BUF_SIZE
];

272 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"lše", 
NULL
);

274 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_d¿w_¡yË
(
»nd””
, 
lše_cŞour
));

276 
	`dŸ_svg_dto¡r
(
d_buf
, 
¡¬t
->
x
);

277 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"x1", (xmlCh¬ *è
d_buf
);

278 
	`dŸ_svg_dto¡r
(
d_buf
, 
¡¬t
->
y
);

279 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"y1", (xmlCh¬ *è
d_buf
);

280 
	`dŸ_svg_dto¡r
(
d_buf
, 
’d
->
x
);

281 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"x2", (xmlCh¬ *è
d_buf
);

282 
	`dŸ_svg_dto¡r
(
d_buf
, 
’d
->
y
);

283 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"y2", (xmlCh¬ *è
d_buf
);

284 
	}
}

287 
	$d¿w_pŞylše
(
DŸR’d””
 *
£lf
,

288 
Pošt
 *
pošts
, 
num_pošts
,

289 
CŞÜ
 *
lše_cŞour
)

291 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

292 
i
;

293 
xmlNodePŒ
 
node
;

294 
GSŒšg
 *
¡r
;

295 
gch¬
 
px_buf
[
DTOSTR_BUF_SIZE
];

296 
gch¬
 
py_buf
[
DTOSTR_BUF_SIZE
];

298 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"pŞylše", 
NULL
);

300 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_d¿w_¡yË
(
»nd””
, 
lše_cŞour
));

302 
¡r
 = 
	`g_¡ršg_Ãw
(
NULL
);

303 
i
 = 0; i < 
num_pošts
; i++)

304 
	`g_¡ršg_­³nd_´štf
(
¡r
, "%s,%s ",

305 
	`dŸ_svg_dto¡r
(
px_buf
, 
pošts
[
i
].
x
),

306 
	`dŸ_svg_dto¡r
(
py_buf
, 
pošts
[
i
].
y
) );

307 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"pošts", (xmlCh¬ *è
¡r
->str);

308 
	`g_¡ršg_ä“
(
¡r
, 
TRUE
);

309 
	}
}

312 
	$d¿w_pŞygÚ
(
DŸR’d””
 *
£lf
,

313 
Pošt
 *
pošts
, 
num_pošts
,

314 
CŞÜ
 *
lše_cŞour
)

316 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

317 
i
;

318 
xmlNodePŒ
 
node
;

319 
GSŒšg
 *
¡r
;

320 
gch¬
 
px_buf
[
DTOSTR_BUF_SIZE
];

321 
gch¬
 
py_buf
[
DTOSTR_BUF_SIZE
];

323 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"pŞygÚ", 
NULL
);

325 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_d¿w_¡yË
(
»nd””
, 
lše_cŞour
));

327 
¡r
 = 
	`g_¡ršg_Ãw
(
NULL
);

328 
i
 = 0; i < 
num_pošts
; i++)

329 
	`g_¡ršg_­³nd_´štf
(
¡r
, "%s,%s ",

330 
	`dŸ_svg_dto¡r
(
px_buf
, 
pošts
[
i
].
x
),

331 
	`dŸ_svg_dto¡r
(
py_buf
, 
pošts
[
i
].
y
) );

332 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"pošts", (xmlCh¬ *è
¡r
->str);

333 
	`g_¡ršg_ä“
(
¡r
, 
TRUE
);

334 
	}
}

337 
	$fl_pŞygÚ
(
DŸR’d””
 *
£lf
,

338 
Pošt
 *
pošts
, 
num_pošts
,

339 
CŞÜ
 *
cŞour
)

341 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

342 
i
;

343 
xmlNodePŒ
 
node
;

344 
GSŒšg
 *
¡r
;

345 
gch¬
 
px_buf
[
DTOSTR_BUF_SIZE
];

346 
gch¬
 
py_buf
[
DTOSTR_BUF_SIZE
];

348 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"pŞygÚ", 
NULL
);

350 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_fl_¡yË
(
»nd””
, 
cŞour
));

352 
¡r
 = 
	`g_¡ršg_Ãw
(
NULL
);

353 
i
 = 0; i < 
num_pošts
; i++)

354 
	`g_¡ršg_­³nd_´štf
(
¡r
, "%s,%s ",

355 
	`dŸ_svg_dto¡r
(
px_buf
, 
pošts
[
i
].
x
),

356 
	`dŸ_svg_dto¡r
(
py_buf
, 
pošts
[
i
].
y
) );

357 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"pošts", (xmlCh¬ *)
¡r
->str);

358 
	`g_¡ršg_ä“
(
¡r
, 
TRUE
);

359 
	}
}

362 
	$d¿w_»ù
(
DŸR’d””
 *
£lf
,

363 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

364 
CŞÜ
 *
cŞour
)

366 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

367 
xmlNodePŒ
 
node
;

368 
gch¬
 
d_buf
[
DTOSTR_BUF_SIZE
];

370 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"rect", NULL);

372 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *)
	`g‘_d¿w_¡yË
(
»nd””
, 
cŞour
));

374 
	`dŸ_svg_dto¡r
(
d_buf
, 
ul_cÜÃr
->
x
);

375 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"x", (xmlCh¬ *è
d_buf
);

376 
	`dŸ_svg_dto¡r
(
d_buf
, 
ul_cÜÃr
->
y
);

377 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"y", (xmlCh¬ *è
d_buf
);

378 
	`dŸ_svg_dto¡r
(
d_buf
, 
Ì_cÜÃr
->
x
 - 
ul_cÜÃr
->x);

379 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"width", (xmlCh¬ *è
d_buf
);

380 
	`dŸ_svg_dto¡r
(
d_buf
, 
Ì_cÜÃr
->
y
 - 
ul_cÜÃr
->y);

381 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"height", (xmlCh¬ *è
d_buf
);

382 
	}
}

385 
	$fl_»ù
(
DŸR’d””
 *
£lf
,

386 
Pošt
 *
ul_cÜÃr
, Pošˆ*
Ì_cÜÃr
,

387 
CŞÜ
 *
cŞour
)

389 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

390 
xmlNodePŒ
 
node
;

391 
gch¬
 
d_buf
[
DTOSTR_BUF_SIZE
];

393 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"»ù", 
NULL
);

395 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_fl_¡yË
(
»nd””
, 
cŞour
));

397 
	`dŸ_svg_dto¡r
(
d_buf
, 
ul_cÜÃr
->
x
);

398 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"x", (xmlCh¬ *)
d_buf
);

399 
	`dŸ_svg_dto¡r
(
d_buf
, 
ul_cÜÃr
->
y
);

400 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"y", (xmlCh¬ *)
d_buf
);

401 
	`dŸ_svg_dto¡r
(
d_buf
, 
Ì_cÜÃr
->
x
 - 
ul_cÜÃr
->x);

402 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"width", (xmlCh¬ *)
d_buf
);

403 
	`dŸ_svg_dto¡r
(
d_buf
, 
Ì_cÜÃr
->
y
 - 
ul_cÜÃr
->y);

404 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"height", (xmlCh¬ *)
d_buf
);

405 
	}
}

408 
	$d¿w_¬c
(
DŸR’d””
 *
£lf
,

409 
Pošt
 *
ûÁ”
,

410 
»®
 
width
,„—È
height
,

411 
»®
 
ªgË1
,„—È
ªgË2
,

412 
CŞÜ
 *
cŞour
)

414 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

415 
xmlNodePŒ
 
node
;

416 
buf
[512];

417 
»®
 
rx
 = 
width
 / 2, 
ry
 = 
height
 / 2;

418 
»®
 
sx
=
ûÁ”
->
x
 + 
rx
*
	`cos
(
ªgË1
*
G_PI
/180);

419 
»®
 
sy
=
ûÁ”
->
y
 - 
ry
*
	`sš
(
ªgË1
*
G_PI
/180);

420 
»®
 
ex
=
ûÁ”
->
x
 + 
rx
*
	`cos
(
ªgË2
*
G_PI
/180);

421 
»®
 
ey
=
ûÁ”
->
y
 - 
ry
*
	`sš
(
ªgË2
*
G_PI
/180);

422 
swp
 = 0;

423 
Ïrge_¬c
;

424 
gch¬
 
sx_buf
[
DTOSTR_BUF_SIZE
];

425 
gch¬
 
sy_buf
[
DTOSTR_BUF_SIZE
];

426 
gch¬
 
rx_buf
[
DTOSTR_BUF_SIZE
];

427 
gch¬
 
ry_buf
[
DTOSTR_BUF_SIZE
];

428 
gch¬
 
ex_buf
[
DTOSTR_BUF_SIZE
];

429 
gch¬
 
ey_buf
[
DTOSTR_BUF_SIZE
];

431 ià(
ªgË1
 > 
ªgË2
)

432 
ªgË2
 += 360;

433 
Ïrge_¬c
 = (
ªgË2
 - 
ªgË1
 >= 180);

435 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"·th", 
NULL
);

437 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_d¿w_¡yË
(
»nd””
, 
cŞour
));

439 
	`g_¢´štf
(
buf
, (buf), "M %s,%s A %s,%s 0 %d %d %s,%s",

440 
	`dŸ_svg_dto¡r
(
sx_buf
, 
sx
), dŸ_svg_dto¡r(
sy_buf
, 
sy
),

441 
	`dŸ_svg_dto¡r
(
rx_buf
, 
rx
), dŸ_svg_dto¡r(
ry_buf
, 
ry
),

442 
Ïrge_¬c
, 
swp
,

443 
	`dŸ_svg_dto¡r
(
ex_buf
, 
ex
), dŸ_svg_dto¡r(
ey_buf
, 
ey
) );

445 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"d", (xmlCh¬ *è
buf
);

446 
	}
}

449 
	$fl_¬c
(
DŸR’d””
 *
£lf
,

450 
Pošt
 *
ûÁ”
,

451 
»®
 
width
,„—È
height
,

452 
»®
 
ªgË1
,„—È
ªgË2
,

453 
CŞÜ
 *
cŞour
)

455 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

456 
xmlNodePŒ
 
node
;

457 
buf
[512];

458 
»®
 
rx
 = 
width
 / 2, 
ry
 = 
height
 / 2;

459 
»®
 
sx
=
ûÁ”
->
x
 + 
rx
*
	`cos
(
ªgË1
*
G_PI
/180);

460 
»®
 
sy
=
ûÁ”
->
y
 - 
ry
*
	`sš
(
ªgË1
*
G_PI
/180);

461 
»®
 
ex
=
ûÁ”
->
x
 + 
rx
*
	`cos
(
ªgË2
*
G_PI
/180);

462 
»®
 
ey
=
ûÁ”
->
y
 - 
ry
*
	`sš
(
ªgË2
*
G_PI
/180);

463 
swp
 = 0;

464 
Ïrge_¬c
 = (
ªgË2
 - 
ªgË1
 >= 180);

465 
gch¬
 
sx_buf
[
DTOSTR_BUF_SIZE
];

466 
gch¬
 
sy_buf
[
DTOSTR_BUF_SIZE
];

467 
gch¬
 
rx_buf
[
DTOSTR_BUF_SIZE
];

468 
gch¬
 
ry_buf
[
DTOSTR_BUF_SIZE
];

469 
gch¬
 
ex_buf
[
DTOSTR_BUF_SIZE
];

470 
gch¬
 
ey_buf
[
DTOSTR_BUF_SIZE
];

471 
gch¬
 
cx_buf
[
DTOSTR_BUF_SIZE
];

472 
gch¬
 
cy_buf
[
DTOSTR_BUF_SIZE
];

474 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"path", NULL);

476 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *)
	`g‘_fl_¡yË
(
»nd””
, 
cŞour
));

478 
	`g_¢´štf
(
buf
, (buf), "M %s,%s A %s,%s 0 %d %d %s,%s L %s,%s z",

479 
	`dŸ_svg_dto¡r
(
sx_buf
, 
sx
), dŸ_svg_dto¡r(
sy_buf
, 
sy
),

480 
	`dŸ_svg_dto¡r
(
rx_buf
, 
rx
), dŸ_svg_dto¡r(
ry_buf
, 
ry
),

481 
Ïrge_¬c
, 
swp
,

482 
	`dŸ_svg_dto¡r
(
ex_buf
, 
ex
), dŸ_svg_dto¡r(
ey_buf
, 
ey
),

483 
	`dŸ_svg_dto¡r
(
cx_buf
, 
ûÁ”
->
x
),

484 
	`dŸ_svg_dto¡r
(
cy_buf
, 
ûÁ”
->
y
) );

486 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"d", (xmlCh¬ *è
buf
);

487 
	}
}

490 
	$d¿w_–l£
(
DŸR’d””
 *
£lf
,

491 
Pošt
 *
ûÁ”
,

492 
»®
 
width
,„—È
height
,

493 
CŞÜ
 *
cŞour
)

495 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

496 
xmlNodePŒ
 
node
;

497 
gch¬
 
d_buf
[
DTOSTR_BUF_SIZE
];

499 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"–l£", 
NULL
);

501 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_d¿w_¡yË
(
»nd””
, 
cŞour
));

503 
	`dŸ_svg_dto¡r
(
d_buf
, 
ûÁ”
->
x
);

504 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"cx", (xmlCh¬ *è
d_buf
);

505 
	`dŸ_svg_dto¡r
(
d_buf
, 
ûÁ”
->
y
);

506 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"cy", (xmlCh¬ *è
d_buf
);

507 
	`dŸ_svg_dto¡r
(
d_buf
, 
width
 / 2);

508 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"rx", (xmlCh¬ *è
d_buf
);

509 
	`dŸ_svg_dto¡r
(
d_buf
, 
height
 / 2);

510 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"ry", (xmlCh¬ *è
d_buf
);

511 
	}
}

514 
	$fl_–l£
(
DŸR’d””
 *
£lf
,

515 
Pošt
 *
ûÁ”
,

516 
»®
 
width
,„—È
height
,

517 
CŞÜ
 *
cŞour
)

519 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

520 
xmlNodePŒ
 
node
;

521 
gch¬
 
d_buf
[
DTOSTR_BUF_SIZE
];

523 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"–l£", 
NULL
);

525 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_fl_¡yË
(
»nd””
, 
cŞour
));

527 
	`dŸ_svg_dto¡r
(
d_buf
, 
ûÁ”
->
x
);

528 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"cx", (xmlCh¬ *è
d_buf
);

529 
	`dŸ_svg_dto¡r
(
d_buf
, 
ûÁ”
->
y
);

530 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"cy", (xmlCh¬ *è
d_buf
);

531 
	`dŸ_svg_dto¡r
(
d_buf
, 
width
 / 2);

532 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"rx", (xmlCh¬ *è
d_buf
);

533 
	`dŸ_svg_dto¡r
(
d_buf
, 
height
 / 2);

534 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"ry", (xmlCh¬ *è
d_buf
);

535 
	}
}

538 
	$d¿w_bez›r
(
DŸR’d””
 *
£lf
,

539 
BezPošt
 *
pošts
,

540 
numpošts
,

541 
CŞÜ
 *
cŞour
)

543 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

544 
i
;

545 
xmlNodePŒ
 
node
;

546 
GSŒšg
 *
¡r
;

547 
gch¬
 
p1x_buf
[
DTOSTR_BUF_SIZE
];

548 
gch¬
 
p1y_buf
[
DTOSTR_BUF_SIZE
];

549 
gch¬
 
p2x_buf
[
DTOSTR_BUF_SIZE
];

550 
gch¬
 
p2y_buf
[
DTOSTR_BUF_SIZE
];

551 
gch¬
 
p3x_buf
[
DTOSTR_BUF_SIZE
];

552 
gch¬
 
p3y_buf
[
DTOSTR_BUF_SIZE
];

554 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"·th", 
NULL
);

556 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_d¿w_¡yË
(
»nd””
, 
cŞour
));

558 
¡r
 = 
	`g_¡ršg_Ãw
(
NULL
);

560 ià(
pošts
[0].
ty³
 !ğ
BEZ_MOVE_TO
)

561 
	`g_w¬nšg
("first BezPoint must be‡ BEZ_MOVE_TO");

563 
	`g_¡ršg_´štf
(
¡r
, "M %s %s",

564 
	`dŸ_svg_dto¡r
(
p1x_buf
, (
gdoubË
è
pošts
[0].
p1
.
x
),

565 
	`dŸ_svg_dto¡r
(
p1y_buf
, (
gdoubË
è
pošts
[0].
p1
.
y
) );

567 
i
 = 1; i < 
numpošts
; i++)

568 
pošts
[
i
].
ty³
) {

569 
BEZ_MOVE_TO
:

570 
	`g_w¬nšg
("only first BezPoint shoul be‡ BEZ_MOVE_TO");

571 
	`g_¡ršg_´štf
(
¡r
, "M %s %s",

572 
	`dŸ_svg_dto¡r
(
p1x_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
x
),

573 
	`dŸ_svg_dto¡r
(
p1y_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
y
) );

575 
BEZ_LINE_TO
:

576 
	`g_¡ršg_­³nd_´štf
(
¡r
, " L %s,%s",

577 
	`dŸ_svg_dto¡r
(
p1x_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
x
),

578 
	`dŸ_svg_dto¡r
(
p1y_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
y
) );

580 
BEZ_CURVE_TO
:

581 
	`g_¡ršg_­³nd_´štf
(
¡r
, " C %s,%s %s,%s %s,%s",

582 
	`dŸ_svg_dto¡r
(
p1x_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
x
),

583 
	`dŸ_svg_dto¡r
(
p1y_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
y
),

584 
	`dŸ_svg_dto¡r
(
p2x_buf
, (
gdoubË
è
pošts
[
i
].
p2
.
x
),

585 
	`dŸ_svg_dto¡r
(
p2y_buf
, (
gdoubË
è
pošts
[
i
].
p2
.
y
),

586 
	`dŸ_svg_dto¡r
(
p3x_buf
, (
gdoubË
è
pošts
[
i
].
p3
.
x
),

587 
	`dŸ_svg_dto¡r
(
p3y_buf
, (
gdoubË
è
pošts
[
i
].
p3
.
y
) );

590 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"d", (xmlCh¬ *è
¡r
->str);

591 
	`g_¡ršg_ä“
(
¡r
, 
TRUE
);

592 
	}
}

595 
	$fl_bez›r
(
DŸR’d””
 *
£lf
,

596 
BezPošt
 *
pošts
,

597 
numpošts
,

598 
CŞÜ
 *
cŞour
)

600 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

601 
i
;

602 
xmlNodePŒ
 
node
;

603 
GSŒšg
 *
¡r
;

604 
gch¬
 
p1x_buf
[
DTOSTR_BUF_SIZE
];

605 
gch¬
 
p1y_buf
[
DTOSTR_BUF_SIZE
];

606 
gch¬
 
p2x_buf
[
DTOSTR_BUF_SIZE
];

607 
gch¬
 
p2y_buf
[
DTOSTR_BUF_SIZE
];

608 
gch¬
 
p3x_buf
[
DTOSTR_BUF_SIZE
];

609 
gch¬
 
p3y_buf
[
DTOSTR_BUF_SIZE
];

611 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"·th", 
NULL
);

613 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
	`g‘_fl_¡yË
(
»nd””
, 
cŞour
));

615 
¡r
 = 
	`g_¡ršg_Ãw
(
NULL
);

617 ià(
pošts
[0].
ty³
 !ğ
BEZ_MOVE_TO
)

618 
	`g_w¬nšg
("first BezPoint must be‡ BEZ_MOVE_TO");

620 
	`g_¡ršg_´štf
(
¡r
, "M %s %s",

621 
	`dŸ_svg_dto¡r
(
p1x_buf
, (
gdoubË
è
pošts
[0].
p1
.
x
),

622 
	`dŸ_svg_dto¡r
(
p1y_buf
, (
gdoubË
è
pošts
[0].
p1
.
y
) );

624 
i
 = 1; i < 
numpošts
; i++)

625 
pošts
[
i
].
ty³
) {

626 
BEZ_MOVE_TO
:

627 
	`g_w¬nšg
("only first BezPoint should be‡ BEZ_MOVE_TO");

628 
	`g_¡ršg_´štf
(
¡r
, "M %s %s",

629 
	`dŸ_svg_dto¡r
(
p1x_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
x
),

630 
	`dŸ_svg_dto¡r
(
p1y_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
y
) );

632 
BEZ_LINE_TO
:

633 
	`g_¡ršg_­³nd_´štf
(
¡r
, " L %s,%s",

634 
	`dŸ_svg_dto¡r
(
p1x_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
x
),

635 
	`dŸ_svg_dto¡r
(
p1y_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
y
) );

637 
BEZ_CURVE_TO
:

638 
	`g_¡ršg_­³nd_´štf
(
¡r
, " C %s,%s %s,%s %s,%s",

639 
	`dŸ_svg_dto¡r
(
p1x_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
x
),

640 
	`dŸ_svg_dto¡r
(
p1y_buf
, (
gdoubË
è
pošts
[
i
].
p1
.
y
),

641 
	`dŸ_svg_dto¡r
(
p2x_buf
, (
gdoubË
è
pošts
[
i
].
p2
.
x
),

642 
	`dŸ_svg_dto¡r
(
p2y_buf
, (
gdoubË
è
pošts
[
i
].
p2
.
y
),

643 
	`dŸ_svg_dto¡r
(
p3x_buf
, (
gdoubË
è
pošts
[
i
].
p3
.
x
),

644 
	`dŸ_svg_dto¡r
(
p3y_buf
, (
gdoubË
è
pošts
[
i
].
p3
.
y
) );

647 
	`g_¡ršg_­³nd
(
¡r
, "z");

648 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"d", (xmlCh¬ *è
¡r
->str);

649 
	`g_¡ršg_ä“
(
¡r
, 
TRUE
);

650 
	}
}

653 
	$d¿w_¡ršg
(
DŸR’d””
 *
£lf
,

654 cÚ¡ *
‹xt
,

655 
Pošt
 *
pos
, 
Alignm’t
 
®ignm’t
,

656 
CŞÜ
 *
cŞour
)

658 
TextLše
 *
‹xt_lše
 = 
	`‹xt_lše_Ãw
(
‹xt
, 
£lf
->
fÚt
, s–f->
fÚt_height
);

659 
	`d¿w_‹xt_lše
(
£lf
, 
‹xt_lše
, 
pos
, 
®ignm’t
, 
cŞour
);

660 
	`‹xt_lše_de¡roy
(
‹xt_lše
);

661 
	}
}

665 
	$d¿w_‹xt_lše
(
DŸR’d””
 *
£lf
, 
TextLše
 *
‹xt_lše
,

666 
Pošt
 *
pos
, 
Alignm’t
 
®ignm’t
, 
CŞÜ
 *
cŞour
)

668 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

669 
xmlNodePŒ
 
node
;

670 *
¡yË
, *
tmp
;

671 
»®
 
§ved_width
;

672 
gch¬
 
d_buf
[
DTOSTR_BUF_SIZE
];

673 
DŸFÚt
 *
fÚt
;

675 
node
 = 
	`xmlNewTextChd
(
»nd””
->
roÙ
,„’d””->
svg_Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"text",

676 (
xmlCh¬
 *è
	`‹xt_lše_g‘_¡ršg
(
‹xt_lše
));

678 
§ved_width
 = 
»nd””
->
lšewidth
;

679 
»nd””
->
lšewidth
 = 0.001;

680 
¡yË
 = (*)
	`g‘_fl_¡yË
(
»nd””
, 
cŞour
);

682 
»nd””
->
lšewidth
 = 
§ved_width
;

684 
tmp
 = 
	`g_¡rdup_´štf
("%s; fÚt-size: %s", 
¡yË
,

685 
	`dŸ_svg_dto¡r
(
d_buf
, 
	`‹xt_lše_g‘_height
(
‹xt_lše
)));

686 
¡yË
 = 
tmp
;

690 
®ignm’t
) {

691 
ALIGN_LEFT
:

692 
tmp
 = 
	`g_¡rcÚÿt
(
¡yË
, ";ext-ªchÜ:¡¬t", 
NULL
);

694 
ALIGN_CENTER
:

695 
tmp
 = 
	`g_¡rcÚÿt
(
¡yË
, ";ext-ªchÜ:middË", 
NULL
);

697 
ALIGN_RIGHT
:

698 
tmp
 = 
	`g_¡rcÚÿt
(
¡yË
, ";ext-ªchÜ:’d", 
NULL
);

701 
	`g_ä“
 (
¡yË
);

702 
¡yË
 = 
tmp
;

704 
fÚt
 = 
	`‹xt_lše_g‘_fÚt
(
‹xt_lše
);

705 
tmp
 = 
	`g_¡rdup_´štf
("%s; font-family: %s; font-style: %s; "

706 "fÚt-weight: %s",
¡yË
,

707 
	`dŸ_fÚt_g‘_çmy
(
fÚt
),

708 
	`dŸ_fÚt_g‘_¦ªt_¡ršg
(
fÚt
),

709 
	`dŸ_fÚt_g‘_weight_¡ršg
(
fÚt
));

710 
	`g_ä“
(
¡yË
);

711 
¡yË
 = 
tmp
;

715 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"¡yË", (xmlCh¬ *è
¡yË
);

716 
	`g_ä“
(
¡yË
);

718 
	`dŸ_svg_dto¡r
(
d_buf
, 
pos
->
x
);

719 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"x", (xmlCh¬ *è
d_buf
);

720 
	`dŸ_svg_dto¡r
(
d_buf
, 
pos
->
y
);

721 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"y", (xmlCh¬ *è
d_buf
);

724 
	`dŸ_svg_dto¡r
(
d_buf
, 
	`‹xt_lše_g‘_height
(
‹xt_lše
));

725 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"fÚt-size", (xmlCh¬ *è
d_buf
);

727 
	`dŸ_svg_dto¡r
(
d_buf
, 
	`‹xt_lše_g‘_width
(
‹xt_lše
));

728 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
*)"‹xtL’gth", (xmlCh¬ *è
d_buf
);

729 
	}
}

732 
	$d¿w_image
(
DŸR’d””
 *
£lf
,

733 
Pošt
 *
pošt
,

734 
»®
 
width
,„—È
height
,

735 
DŸImage
 *
image
)

737 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

738 
xmlNodePŒ
 
node
;

739 
gch¬
 
d_buf
[
DTOSTR_BUF_SIZE
];

740 
gch¬
 *
uri
;

742 
node
 = 
	`xmlNewChd
(
»nd””
->
roÙ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"image", NULL);

744 
	`dŸ_svg_dto¡r
(
d_buf
, 
pošt
->
x
);

745 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"x", (xmlCh¬ *è
d_buf
);

746 
	`dŸ_svg_dto¡r
(
d_buf
, 
pošt
->
y
);

747 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"y", (xmlCh¬ *è
d_buf
);

748 
	`dŸ_svg_dto¡r
(
d_buf
, 
width
);

749 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"width", (xmlCh¬ *è
d_buf
);

750 
	`dŸ_svg_dto¡r
(
d_buf
, 
height
);

751 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"height", (xmlCh¬ *è
d_buf
);

753 
uri
 = 
	`g_f’ame_to_uri
(
	`dŸ_image_f’ame
(
image
), 
NULL
, NULL);

754 ià(
uri
)

755 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"xlšk:h»f", (xmlCh¬ *è
uri
);

757 
	`xmlS‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"xlšk:h»f", (xmlCh¬ *è
	`dŸ_image_f’ame
(
image
));

758 
	`g_ä“
 (
uri
);

759 
	}
}

763 
	$dŸ_svg_»nd””_š™
 (
GTy³In¡ªû
 *
£lf
, 
gpoš‹r
 
g_şass
)

765 
DŸSvgR’d””
 *
»nd””
 = 
	`DIA_SVG_RENDERER
 (
£lf
);

767 
»nd””
->
sÿË
 = 1.0;

769 
	}
}

771 
gpoš‹r
 
	g·»Á_şass
 = 
NULL
;

775 
	$dŸ_svg_»nd””_fš®ize
 (
GObjeù
 *
objeù
)

777 
	`G_OBJECT_CLASS
 (
·»Á_şass
)->
	`fš®ize
 (
objeù
);

778 
	}
}

781 
dŸ_svg_»nd””_şass_š™
 (
DŸSvgR’d””CÏss
 *
kÏss
);

783 
GTy³


784 
	$dŸ_svg_»nd””_g‘_ty³
 ()

786 
GTy³
 
objeù_ty³
 = 0;

788 ià(!
objeù_ty³
)

790 cÚ¡ 
GTy³Info
 
objeù_šfo
 =

792  (
DŸSvgR’d””CÏss
),

793 (
GBa£In™Func
è
NULL
,

794 (
GBa£Fš®izeFunc
è
NULL
,

795 (
GCÏssIn™Func
è
dŸ_svg_»nd””_şass_š™
,

796 
NULL
,

797 
NULL
,

798  (
DŸSvgR’d””
),

800 
dŸ_svg_»nd””_š™


803 
objeù_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
DIA_TYPE_RENDERER
,

805 &
objeù_šfo
, 0);

808  
objeù_ty³
;

809 
	}
}

812 
	$dŸ_svg_»nd””_şass_š™
 (
DŸSvgR’d””CÏss
 *
kÏss
)

814 
GObjeùCÏss
 *
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
kÏss
);

815 
DŸR’d””CÏss
 *
»nd””_şass
 = 
	`DIA_RENDERER_CLASS
 (
kÏss
);

816 
DŸSvgR’d””CÏss
 *
svg_»nd””_şass
 = 
	`DIA_SVG_RENDERER_CLASS
 (
kÏss
);

818 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
kÏss
);

820 
objeù_şass
->
fš®ize
 = 
dŸ_svg_»nd””_fš®ize
;

823 
»nd””_şass
->
begš_»nd”
 = begin_render;

824 
»nd””_şass
->
’d_»nd”
 =ƒnd_render;

826 
»nd””_şass
->
£t_lšewidth
 = set_linewidth;

827 
»nd””_şass
->
£t_lšeÿps
 = set_linecaps;

828 
»nd””_şass
->
£t_lšejoš
 = set_linejoin;

829 
»nd””_şass
->
£t_lše¡yË
 = set_linestyle;

830 
»nd””_şass
->
£t_dashËngth
 = set_dashlength;

831 
»nd””_şass
->
£t_fl¡yË
 = set_fillstyle;

833 
»nd””_şass
->
d¿w_lše
 = draw_line;

834 
»nd””_şass
->
fl_pŞygÚ
 = fill_polygon;

835 
»nd””_şass
->
d¿w_»ù
 = draw_rect;

836 
»nd””_şass
->
fl_»ù
 = fill_rect;

837 
»nd””_şass
->
d¿w_¬c
 = draw_arc;

838 
»nd””_şass
->
fl_¬c
 = fill_arc;

839 
»nd””_şass
->
d¿w_–l£
 = draw_ellipse;

840 
»nd””_şass
->
fl_–l£
 = fill_ellipse;

842 
»nd””_şass
->
d¿w_¡ršg
 = draw_string;

843 
»nd””_şass
->
d¿w_image
 = draw_image;

846 
»nd””_şass
->
d¿w_»ù
 = draw_rect;

847 
»nd””_şass
->
d¿w_pŞylše
 = draw_polyline;

848 
»nd””_şass
->
d¿w_pŞygÚ
 = draw_polygon;

850 
»nd””_şass
->
d¿w_bez›r
 = draw_bezier;

851 
»nd””_şass
->
fl_bez›r
 = fill_bezier;

852 
»nd””_şass
->
d¿w_‹xt_lše
 = draw_text_line;

855 
svg_»nd””_şass
->
g‘_d¿w_¡yË
 = get_draw_style;

856 
svg_»nd””_şass
->
g‘_fl_¡yË
 = get_fill_style;

857 
	}
}

	@O:\tool\dvs50\lib\diasvgrenderer.h

1 #iâdeà
DIA_SVG_RENDERER_H


2 
	#DIA_SVG_RENDERER_H


	)

4 
	~"dŸty³s.h
"

5 
	~"dŸ»nd””.h
"

7 
	gG_BEGIN_DECLS


9 
	#DIA_TYPE_SVG_RENDERER
 (
	`dŸ_svg_»nd””_g‘_ty³
 ())

	)

10 
	#DIA_SVG_RENDERER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_SVG_RENDERER
, 
DŸSvgR’d””
))

	)

11 
	#DIA_SVG_RENDERER_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_SVG_RENDERER
, 
DŸSvgR’d””CÏss
))

	)

12 
	#DIA_IS_SVG_RENDERER
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_SVG_RENDERER
))

	)

13 
	#DIA_SVG_RENDERER_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_SVG_RENDERER
, 
DŸSvgR’d””CÏss
))

	)

15 
DIAVAR
 
GTy³
 
	$dŸ_svg_»nd””_g‘_ty³
 (è
G_GNUC_CONST
;

17 
	s_DŸSvgR’d””


19 
DŸR’d””
 
·»Á_š¡ªû
;

22 *
f’ame
;

24 
xmlDocPŒ
 
doc
;

25 
xmlNodePŒ
 
roÙ
;

26 
xmlNsPŒ
 
svg_Çme_¥aû
;

28 
LšeStyË
 
§ved_lše_¡yË
;

29 
»®
 
dash_Ëngth
;

30 
»®
 
dÙ_Ëngth
;

32 
»®
 
lšewidth
;

33 cÚ¡ *
lšeÿp
;

34 cÚ¡ *
lšejoš
;

35 *
lše¡yË
;

36 
»®
 
sÿË
;

39 
	s_DŸSvgR’d””CÏss


41 
DŸR’d””CÏss
 
·»Á_şass
;

43 cÚ¡ 
gch¬
* (*
g‘_d¿w_¡yË
è(
DŸSvgR’d””
*, 
CŞÜ
*);

44 cÚ¡ 
gch¬
* (*
g‘_fl_¡yË
è(
DŸSvgR’d””
*, 
CŞÜ
*);

47 
G_END_DECLS


	@O:\tool\dvs50\lib\diatransform.c

23 
	~"dŸŒªsfÜm.h
"

25 
_DŸT¿nsfÜmCÏss
 
	tDŸT¿nsfÜmCÏss
;

27 
	s_DŸT¿nsfÜm


29 
GObjeù
 
	m·»Á_š¡ªû
;

31 
ReùªgË
 *
	mvisibË
;

32 
»®
 *
	mçùÜ
;

35 
	s_DŸT¿nsfÜmCÏss


37 
GObjeùCÏss
 
	m·»Á_şass
;

40 
dŸ_ŒªsfÜm_şass_š™
 (
DŸT¿nsfÜmCÏss
 *
kÏss
);

42 
gpoš‹r
 
	g·»Á_şass
 = 
NULL
;

44 
GTy³


45 
	$dŸ_ŒªsfÜm_g‘_ty³
 ()

47 
GTy³
 
objeù_ty³
 = 0;

49 ià(!
objeù_ty³
)

51 cÚ¡ 
GTy³Info
 
objeù_šfo
 =

53  (
DŸT¿nsfÜmCÏss
),

54 (
GBa£In™Func
è
NULL
,

55 (
GBa£Fš®izeFunc
è
NULL
,

56 (
GCÏssIn™Func
è
dŸ_ŒªsfÜm_şass_š™
,

57 
NULL
,

58 
NULL
,

59  (
DŸT¿nsfÜm
),

61 
NULL


64 
objeù_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
G_TYPE_OBJECT
,

66 &
objeù_šfo
, 0);

69  
objeù_ty³
;

70 
	}
}

73 
	$dŸ_ŒªsfÜm_fš®ize
 (
GObjeù
 *
objeù
)

77 
	`G_OBJECT_CLASS
 (
·»Á_şass
)->
	`fš®ize
 (
objeù
);

78 
	}
}

81 
	$dŸ_ŒªsfÜm_şass_š™
 (
DŸT¿nsfÜmCÏss
 *
kÏss
)

83 
GObjeùCÏss
 *
objeù_şass
 = 
	`G_OBJECT_CLASS
 (
kÏss
);

85 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
 (
kÏss
);

87 
objeù_şass
->
fš®ize
 = 
dŸ_ŒªsfÜm_fš®ize
;

89 
	}
}

91 
DŸT¿nsfÜm
 *

92 
	$dŸ_ŒªsfÜm_Ãw
 (
ReùªgË
 *
»ù
, 
»®
* 
zoom
)

94 
DŸT¿nsfÜm
 *
t
 = 
	`g_objeù_Ãw
 (
DIA_TYPE_TRANSFORM
, 
NULL
);

95 
t
->
visibË
 = 
»ù
;

96 
t
->
çùÜ
 = 
zoom
;

98  
t
;

99 
	}
}

101 
»®


102 
	$dŸ_ŒªsfÜm_Ëngth
 (
DŸT¿nsfÜm
 *
t
, 
»®
 
Ën
)

104 
	`g_»tuº_v®_if_ç
 (
	`DIA_IS_TRANSFORM
 (
t
), 
Ën
);

105 
	`g_»tuº_v®_if_ç
 (
t
 !ğ
NULL
 && *t->
çùÜ
 !ğ0.0, 
Ën
);

107  (
Ën
 * *(
t
->
çùÜ
));

108 
	}
}

111 
»®


112 
	$dŸ_uÁ¿nsfÜm_Ëngth
(
DŸT¿nsfÜm
 *
t
, 
»®
 
Ën
)

114 
	`g_»tuº_v®_if_ç
 (
	`DIA_IS_TRANSFORM
 (
t
), 
Ën
);

115 
	`g_»tuº_v®_if_ç
 (
t
 !ğ
NULL
 && *t->
çùÜ
 !ğ0.0, 
Ën
);

117  
Ën
 / *(
t
->
çùÜ
);

118 
	}
}

121 
	$dŸ_ŒªsfÜm_coÜds
 (
DŸT¿nsfÜm
 *
t
,

122 
coÜd
 
x
, coÜd 
y
,

123 *
xi
, *
yi
)

125 
	`g_»tuº_if_ç
 (
	`DIA_IS_TRANSFORM
 (
t
));

126 
	`g_»tuº_if_ç
 (
t
 !ğ
NULL
 &&->
çùÜ
 != NULL);

128 *
xi
 = 
	`ROUND
 ( (
x
 - 
t
->
visibË
->
Ëá
è* *Ñ->
çùÜ
));

129 *
yi
 = 
	`ROUND
 ( (
y
 - 
t
->
visibË
->
tİ
è* *Ñ->
çùÜ
));

130 
	}
}

133 
	$dŸ_ŒªsfÜm_coÜds_doubË
 (
DŸT¿nsfÜm
 *
t
,

134 
coÜd
 
x
, coÜd 
y
,

135 *
xd
, *
yd
)

137 
	`g_»tuº_if_ç
 (
	`DIA_IS_TRANSFORM
 (
t
));

138 
	`g_»tuº_if_ç
 (
t
 !ğ
NULL
 &&->
çùÜ
 != NULL);

140 *
xd
 = ((
x
 - 
t
->
visibË
->
Ëá
è* *Ñ->
çùÜ
));

141 *
yd
 = ((
y
 - 
t
->
visibË
->
tİ
è* *Ñ->
çùÜ
));

142 
	}
}

	@O:\tool\dvs50\lib\diatransform.h

1 #iâdeà
DIA_TRANSFORM_H


2 
	#DIA_TRANSFORM_H


	)

4 
	~"dŸty³s.h
"

5 
	~<glib-objeù.h
>

6 
	~"geom‘ry.h
"

8 
	gG_BEGIN_DECLS


10 
	#DIA_TYPE_TRANSFORM
 (
	`dŸ_ŒªsfÜm_g‘_ty³
 ())

	)

11 
	#DIA_TRANSFORM
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((obj), 
DIA_TYPE_TRANSFORM
, 
DŸT¿nsfÜm
))

	)

12 
	#DIA_TRANSFORM_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((kÏss), 
DIA_TYPE_TRANSFORM
, 
DŸT¿nsfÜmCÏss
))

	)

13 
	#DIA_IS_TRANSFORM
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_TYPE
 ((obj), 
DIA_TYPE_TRANSFORM
))

	)

14 
	#DIA_TRANSFORM_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_TRANSFORM
, 
DŸT¿nsfÜmCÏss
))

	)

16 
GTy³
 
	$dŸ_ŒªsfÜm_g‘_ty³
 (è
G_GNUC_CONST
;

18 
DIAVAR
 
DŸT¿nsfÜm
 *
	`dŸ_ŒªsfÜm_Ãw
 (
ReùªgË
 *
»ù
, 
»®
* 
zoom
);

19 
DIAVAR
 
»®
 
	`dŸ_ŒªsfÜm_Ëngth
 (
DŸT¿nsfÜm
 *
ŒªsfÜm
,„—È
Ën
);

20 
DIAVAR
 
	`dŸ_ŒªsfÜm_coÜds
 (
DŸT¿nsfÜm
 *
ŒªsfÜm
, 
coÜd
 
x
, coÜd 
y
, *
xi
, *
yi
);

21 
DIAVAR
 
	`dŸ_ŒªsfÜm_coÜds_doubË
 (
DŸT¿nsfÜm
 *
ŒªsfÜm
, 
coÜd
 
x
, coÜd 
y
, *
xd
, *
yd
);

22 
DIAVAR
 
»®
 
	`dŸ_uÁ¿nsfÜm_Ëngth
(
DŸT¿nsfÜm
 *
t
,„—È
Ën
);

24 
G_END_DECLS


	@O:\tool\dvs50\lib\diatypes.h

21 #iâdeà
TYPES_H


22 
	#TYPES_H


	)

23 
	~"dŸv¬.h
"

28 
_DŸg¿mD©a
 
	tDŸg¿mD©a
;

29 
_Lay”
 
	tLay”
;

30 
_NewDŸg¿mD©a
 
	tNewDŸg¿mD©a
;

33 
_A¼ow
 
	tA¼ow
;

36 
_Bez›rCÚn
 
	tBez›rCÚn
;

39 
_Bez›rSh­e
 
	tBez›rSh­e
;

42 
_PŞyBBExŒas
 
	tPŞyBBExŒas
;

43 
_LšeBBExŒas
 
	tLšeBBExŒas
;

44 
_EËm’tBBExŒas
 
	tEËm’tBBExŒas
;

47 
_CŞÜ
 
	tCŞÜ
;

50 
_CÚÃùiÚ
 
	tCÚÃùiÚ
;

53 
_CÚÃùiÚPošt
 
	tCÚÃùiÚPošt
;

56 
_MuÉoštC»©eD©a
 
	tMuÉoštC»©eD©a
;

57 
_Bez›rC»©eD©a
 
	tBez›rC»©eD©a
;

60 
_DŸImage
 
	tDŸImage
;

63 
_DŸGdkR’d””
 
	tDŸGdkR’d””
;

64 
_DŸGdkR’d””CÏss
 
	tDŸGdkR’d””CÏss
;

65 
_DDi¥
 
	tDDi¥
;

68 
_DŸLib¬tR’d””
 
	tDŸLib¬tR’d””
;

69 
_DŸLib¬tR’d””CÏss
 
	tDŸLib¬tR’d””CÏss
;

72 
_DŸM’uI‹m
 
	tDŸM’uI‹m
;

73 
_DŸM’u
 
	tDŸM’u
;

76 
_Bez›rAµrox
 
	tBez›rAµrox
;

77 
_DŸR’d””
 
	tDŸR’d””
;

78 
_DŸR’d””CÏss
 
	tDŸR’d””CÏss
;

79 
_DŸIÁ”aùiveR’d””IÁ”çû
 
	tDŸIÁ”aùiveR’d””IÁ”çû
;

82 
_DŸC–lR’d””Prİ”ty
 
	tDŸC–lR’d””Prİ”ty
;

85 
_DŸSvgR’d””
 
	tDŸSvgR’d””
;

86 
_DŸSvgR’d””CÏss
 
	tDŸSvgR’d””CÏss
;

89 
_DŸT¿nsfÜm
 
	tDŸT¿nsfÜm
;

92 
_EËm’t
 
	tEËm’t
;

95 
_DŸExpÜtF‹r
 
	tDŸExpÜtF‹r
;

96 
_DŸImpÜtF‹r
 
	tDŸImpÜtF‹r
;

97 
_DŸC®lbackF‹r
 
	tDŸC®lbackF‹r
;

100 
_Focus
 
	tFocus
;

103 
_DŸFÚt
 
	tDŸFÚt
;

104 
_DŸFÚtCÏss
 
	tDŸFÚtCÏss
;

107 
_Pošt
 
	tPošt
;

108 
_ReùªgË
 
	tReùªgË
;

109 
_IÁReùªgË
 
	tIÁReùªgË
;

110 
_BezPošt
 
	tBezPošt
;

113 
_Group
 
	tGroup
;

116 
_HªdË
 
	tHªdË
;

119 
_NewO¹hCÚn
 
	tNewO¹hCÚn
;

122 
_ObjeùS‹
 
	tObjeùS‹
;

123 
_ObjeùChªge
 
	tObjeùChªge
;

126 
_DŸObjeù
 
	tDŸObjeù
;

127 
_ObjeùOps
 
	tObjeùOps
;

128 
_DŸObjeùTy³
 
	tDŸObjeùTy³
;

129 
_ObjeùTy³Ops
 
	tObjeùTy³Ops
;

132 
_O¹hCÚn
 
	tO¹hCÚn
;

135 
_P­”Info
 
	tP­”Info
;

138 
_PlugšInfo
 
	tPlugšInfo
;

141 
_PŞyCÚn
 
	tPŞyCÚn
;

144 
_PŞySh­e
 
	tPŞySh­e
;

147 
_PrİDesütiÚ
 
	tPrİDesütiÚ
;

148 
_Prİ”ty
 
	tPrİ”ty
;

149 
_PrİEv’tD©a
 
	tPrİEv’tD©a
;

150 
_PrİDŸlog
 
	tPrİDŸlog
;

151 
_PrİEv’tHªdËrChaš
 
	tPrİEv’tHªdËrChaš
;

152 
_PrİWidg‘Assoc
 
	tPrİWidg‘Assoc
;

153 
_Prİ”tyOps
 
	tPrİ”tyOps
;

154 
_PrİNumD©a
 
	tPrİNumD©a
;

155 
_PrİEnumD©a
 
	tPrİEnumD©a
;

156 
_PrİDescCommÚA¼ayExŒa
 
	tPrİDescCommÚA¼ayExŒa
;

157 
_PrİDescDA¼ayExŒa
 
	tPrİDescDA¼ayExŒa
;

158 
_PrİDescSA¼ayExŒa
 
	tPrİDescSA¼ayExŒa
;

159 
_PrİOff£t
 
	tPrİOff£t
;

162 
_PSFÚtDesütÜ
 
	tPSFÚtDesütÜ
;

163 
_PSEncodšgPage
 
	tPSEncodšgPage
;

164 
_PSUnicod”
 
	tPSUnicod”
;

165 
_PSUnicod”C®lbacks
 
	tPSUnicod”C®lbacks
;

168 
_Sh“t
 
	tSh“t
;

169 
_Sh“tObjeù
 
	tSh“tObjeù
;

172 
_Text
 
	tText
;

175 
_TextLše
 
	tTextLše
;

178 
_TextA‰ribu‹s
 
	tTextA‰ribu‹s
;

181 
_DŸSizeS–eùÜ
 
	tDŸSizeS–eùÜ
;

182 
_DŸSizeS–eùÜCÏss
 
	tDŸSizeS–eùÜCÏss
;

183 
_DŸFÚtS–eùÜ
 
	tDŸFÚtS–eùÜ
;

184 
_DŸFÚtS–eùÜCÏss
 
	tDŸFÚtS–eùÜCÏss
;

185 
_DŸAlignm’tS–eùÜ
 
	tDŸAlignm’tS–eùÜ
;

186 
_DŸAlignm’tS–eùÜCÏss
 
	tDŸAlignm’tS–eùÜCÏss
;

187 
_DŸLšeStyËS–eùÜ
 
	tDŸLšeStyËS–eùÜ
;

188 
_DŸLšeStyËS–eùÜCÏss
 
	tDŸLšeStyËS–eùÜCÏss
;

189 
_DŸCŞÜS–eùÜ
 
	tDŸCŞÜS–eùÜ
;

190 
_DŸCŞÜS–eùÜCÏss
 
	tDŸCŞÜS–eùÜCÏss
;

191 
_DŸA¼owS–eùÜ
 
	tDŸA¼owS–eùÜ
;

192 
_DŸA¼owS–eùÜCÏss
 
	tDŸA¼owS–eùÜCÏss
;

193 
_DŸFeS–eùÜ
 
	tDŸFeS–eùÜ
;

194 
_DŸFeS–eùÜCÏss
 
	tDŸFeS–eùÜCÏss
;

197 
_FaùÜySŒuùI‹m
 
	tFaùÜySŒuùI‹m
;

198 
_FaùÜySŒuùEnum
 
	tFaùÜySŒuùEnum
;

200 
_FaùÜySŒuùI‹mLi¡
 
	tFaùÜySŒuùI‹mLi¡
;

201 
	s_FaùÜySŒuùI‹mLi¡
{

202 
gch¬
 *
	m¢ame
;

203 
gch¬
 *
	mvÇme
;

204 
GLi¡
 *
	mli¡
;

205 
	mnumb”
;

206 
gch¬
 *
	msfe
;

207 
gboŞ—n
 
	misvisibË
;

210 
_FaùÜySŒuùI‹mAÎ
 
	tFaùÜySŒuùI‹mAÎ
;

211 
	s_FaùÜySŒuùI‹mAÎ
{

212 
GHashTabË
 *
	m’umTabË
;

214 
GHashTabË
 *
	m¡ruùTabË
;

215 
GHashTabË
 *
	muniÚTabË
;

216 
GLi¡
* 
	m¡ruùLi¡
;

217 
gch¬
 *
	mfe_v”siÚ
;

218 
Lay”
 *
	mcurLay”
;

	@O:\tool\dvs50\lib\diavar.h

1 #iâdeà
DIAVAR_H


2 
	#DIAVAR_H


	)

4 
	~<glib.h
>

15 
	#DIAVAR
 
	`__deş¥ec
(
dÎexpÜt
)

	)

17 
DIAVAR
 
»nd”_boundšg_boxes
;

	@O:\tool\dvs50\lib\dummy_dep.h

18 
	~<glib.h
>

19 
	~"cÚÃùiÚ.h
"

20 
	~"–em’t.h
"

21 
	~"fÚt.h
"

22 
	~"‹xt.h
"

23 
	~"Üth_cÚn.h
"

24 
	~"ÃwÜth_cÚn.h
"

25 
	~"¬rows.h
"

26 
	~"uts.h
"

27 
	~"pŞy_cÚn.h
"

28 
	~"pŞysh­e.h
"

29 
	~"bez›r_cÚn.h
"

30 
	~"bez›rsh­e.h
"

31 
	~"widg‘s.h
"

32 
	~"š.h
"

33 
	~"cÚÅošt_lše.h
"

34 
	~"´İ”t›s.h
"

35 
	~"dyÇmic_obj.h
"

36 
	~"cÚÃùiÚpošt.h
"

42 #iâdeà
__sgi


45 *
	gdummy_d•
[] 
	gG_GNUC_UNUSED
 = {

46 
cÚÃùiÚ_move_hªdË
,

47 
–em’t_upd©e_boundšgbox
,

48 
ÜthcÚn_upd©e_d©a
,

49 
pŞycÚn_š™
,

50 
pŞysh­e_š™
,

51 
bez›rcÚn_š™
,

52 
bez›rsh­e_š™
,

53 
Ãw_‹xt
,

54 
dŸ_fÚt_Ãw_äom_¡yË
,

55 
Ã¬e¡_pow
,

56 
¬row_d¿w
,

57 
dŸ_fÚt_£ËùÜ_Ãw
,

58 
Ãw_objeù_¡©e_chªge
,

59 
š_scÜe_loÿË
,

60 
cÚÅošše_ü—‹
,

61 
ÃwÜthcÚn_upd©e_d©a
,

62 
objeù_ü—‹_´İs_dŸlog
,

63 
dynobj_li¡_g‘_dynobj_¿‹
,

64 
cÚÅošt_upd©e
,

	@O:\tool\dvs50\lib\dynamic_obj.c

22 
	~<glib.h
>

23 
	~<dyÇmic_obj.h
>

26 
DŸObjeù
* 
	mobj
;

27 
gušt
 
	mtimeout
;

28 } 
	tDynobjRec
;

30 
GLi¡
* 
	gdyn_obj_li¡
 = 
NULL
;

32 
	$dynobj_li¡_add_objeù
(
DŸObjeù
* 
obj
, 
gušt
 
timeout
) {

33 
DynobjRec
 *
dÜ
 = 
	`g_Ãw
(DynobjRec,1);

34 
dÜ
->
obj
 = obj;

35 
dÜ
->
timeout
 =imeout;

37 
dyn_obj_li¡
 = 
	`g_li¡_­³nd
(dyn_obj_li¡,
dÜ
);

38 
	}
}

40 
gšt
 
	$dÜ_found
(
gcÚ¡poš‹r
 
d©a
, gcÚ¡poš‹¸
u£r_d©a
) {

41 cÚ¡ 
DynobjRec
* 
dÜ
 = (cÚ¡ DynobjRec*)
d©a
;

42 cÚ¡ 
DŸObjeù
* 
obj
 = (cÚ¡ DŸObjeù*)
u£r_d©a
;

44 ià((!
dÜ
è|| (!
obj
))  1;

45 ià(
dÜ
->
obj
 != obj)  1;

47 
	}
}

49 
	$dynobj_li¡_»move_objeù
(
DŸObjeù
* 
obj
) {

50 
GLi¡
* 
™em
 = 
	`g_li¡_fšd_cu¡om
(
dyn_obj_li¡
,
obj
,
dÜ_found
);

52 ià(
™em
) {

53 
DynobjRec
* 
dÜ
 = 
™em
->
d©a
;

54 
dyn_obj_li¡
 = 
	`g_li¡_»move
(dyn_obj_li¡,
dÜ
);

55 
	`g_ä“
(
dÜ
);

57 
	}
}

60 
ObjeùDynobjFunc
 
	modf
;

61 
gpoš‹r
 
	md©a
;

62 } 
	tT¿mpŞšeD©a
;

64 
	$fÜ—ch_ŒampŞše
(
gpoš‹r
 
d©a
, gpoš‹¸
u£r_d©a
) {

65 
T¿mpŞšeD©a
* 
td
 = (T¿mpŞšeD©a*)
u£r_d©a
;

66 
DynobjRec
* 
dÜ
 = (DynobjRec*)
d©a
;

68 
td
->
	`odf
(
dÜ
->
obj
,td->
d©a
);

69 
	}
}

71 
	$dynobj_li¡_fÜ—ch
(
ObjeùDynobjFunc
 
odf
, 
gpoš‹r
 
d©a
) {

72 
T¿mpŞšeD©a
 
td
;

73 
td
.
odf
 = odf;

74 
td
.
d©a
 = data;

75 
	`g_li¡_fÜ—ch
(
dyn_obj_li¡
,
fÜ—ch_ŒampŞše
,&
td
);

76 
	}
}

78 
	$accum_timeout
(
gpoš‹r
 
d©a
, gpoš‹¸
u£r_d©a
) {

79 
gušt
* 
accum
 = (gušt*)
u£r_d©a
;

80 
DynobjRec
* 
dÜ
 = (DynobjRec*)
d©a
;

82 ià(!
dÜ
) ;

84 *
accum
 = 
	`MAX
(*accum,
dÜ
->
timeout
);

85 
	}
}

87 
gušt
 
	$dynobj_li¡_g‘_dynobj_¿‹
() {

88 
gušt
 
timeout
 = 250;

90 ià(
dyn_obj_li¡
)

91 
	`g_li¡_fÜ—ch
(
dyn_obj_li¡
,
accum_timeout
,&
timeout
);

93 
timeout
 = 0;

95  
timeout
;

96 
	}
}

	@O:\tool\dvs50\lib\dynamic_obj.h

22 #iâdeà
DYNAMIC_OBJ_H


23 
	#DYNAMIC_OBJ_H


	)

25 
	~<glib.h
>

26 
	~"objeù.h
"

33 
DIAVAR
 
dynobj_li¡_add_objeù
(
DŸObjeù
 *
obj
, 
gušt
 
timeout
);

41 
DIAVAR
 
dynobj_li¡_»move_objeù
(
DŸObjeù
 *
obj
);

44 (*
	tObjeùDynobjFunc
è(
	tDŸObjeù
 *
	tobj
, 
	tgpoš‹r
 
	td©a
);

50 
	$__deş¥ec
(
dÎexpÜt
è
	`dynobj_li¡_fÜ—ch
(
ObjeùDynobjFunc
 
Üf
, 
gpoš‹r
 
d©a
);

55 
	$__deş¥ec
(
dÎexpÜt
è
gušt
 
	`dynobj_li¡_g‘_dynobj_¿‹
();

	@O:\tool\dvs50\lib\element.c

25 
	~<cÚfig.h
>

27 
	~<¡dio.h
>

28 
	~<as£¹.h
>

29 
	~<m©h.h
>

30 
	~<¡ršg.h
>

32 
	~"–em’t.h
"

33 
	~"mes§ge.h
"

39 
	$–em’t_upd©e_boundšgbox
(
EËm’t
 *
–em
) {

40 
ReùªgË
 
bb
;

41 
Pošt
 *
cÜÃr
;

42 
EËm’tBBExŒas
 *
exŒa
 = &
–em
->
exŒa_¥acšg
;

44 
	`as£¹
(
–em
 !ğ
NULL
);

46 
cÜÃr
 = &
–em
->corner;

47 
bb
.
Ëá
 = 
cÜÃr
->
x
;

48 
bb
.
right
 = 
cÜÃr
->
x
 + 
–em
->
width
;

49 
bb
.
tİ
 = 
cÜÃr
->
y
;

50 
bb
.
bÙtom
 = 
cÜÃr
->
y
 + 
–em
->
height
;

52 
	`»ùªgË_bbox
(&
bb
,
exŒa
,&
–em
->
objeù
.
boundšg_box
);

53 
	}
}

66 
	$–em’t_upd©e_cÚÃùiÚs_»ùªgË
(
EËm’t
 *
–em
,

67 
CÚÃùiÚPošt
* 
ıs
)

69 
ıs
[0].
pos
 = 
–em
->
cÜÃr
;

70 
ıs
[1].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

71 
ıs
[1].
pos
.
y
 = 
–em
->
cÜÃr
.y;

72 
ıs
[2].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

73 
ıs
[2].
pos
.
y
 = 
–em
->
cÜÃr
.y;

74 
ıs
[3].
pos
.
x
 = 
–em
->
cÜÃr
.x;

75 
ıs
[3].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

76 
ıs
[4].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

77 
ıs
[4].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

78 
ıs
[5].
pos
.
x
 = 
–em
->
cÜÃr
.x;

79 
ıs
[5].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

80 
ıs
[6].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

81 
ıs
[6].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

82 
ıs
[7].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

83 
ıs
[7].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

84 
	`g_as£¹
(
–em
->
objeù
.
num_cÚÃùiÚs
 >= 9);

85 
ıs
[8].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

86 
ıs
[8].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

88 
ıs
[0].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_WEST
;

89 
ıs
[1].
dœeùiÚs
 = 
DIR_NORTH
;

90 
ıs
[2].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_EAST
;

91 
ıs
[3].
dœeùiÚs
 = 
DIR_WEST
;

92 
ıs
[4].
dœeùiÚs
 = 
DIR_EAST
;

93 
ıs
[5].
dœeùiÚs
 = 
DIR_SOUTH
|
DIR_WEST
;

94 
ıs
[6].
dœeùiÚs
 = 
DIR_SOUTH
;

95 
ıs
[7].
dœeùiÚs
 = 
DIR_SOUTH
|
DIR_EAST
;

96 
ıs
[8].
dœeùiÚs
 = 
DIR_ALL
;

97 
	}
}

104 
	$–em’t_upd©e_hªdËs
(
EËm’t
 *
–em
)

106 
Pošt
 *
cÜÃr
 = &
–em
->corner;

108 
–em
->
»size_hªdËs
[0].
id
 = 
HANDLE_RESIZE_NW
;

109 
–em
->
»size_hªdËs
[0].
pos
.
x
 = 
cÜÃr
->x;

110 
–em
->
»size_hªdËs
[0].
pos
.
y
 = 
cÜÃr
->y;

112 
–em
->
»size_hªdËs
[1].
id
 = 
HANDLE_RESIZE_N
;

113 
–em
->
»size_hªdËs
[1].
pos
.
x
 = 
cÜÃr
->x +ƒËm->
width
/2.0;

114 
–em
->
»size_hªdËs
[1].
pos
.
y
 = 
cÜÃr
->y;

116 
–em
->
»size_hªdËs
[2].
id
 = 
HANDLE_RESIZE_NE
;

117 
–em
->
»size_hªdËs
[2].
pos
.
x
 = 
cÜÃr
->x +ƒËm->
width
;

118 
–em
->
»size_hªdËs
[2].
pos
.
y
 = 
cÜÃr
->y;

120 
–em
->
»size_hªdËs
[3].
id
 = 
HANDLE_RESIZE_W
;

121 
–em
->
»size_hªdËs
[3].
pos
.
x
 = 
cÜÃr
->x;

122 
–em
->
»size_hªdËs
[3].
pos
.
y
 = 
cÜÃr
->y +ƒËm->
height
/2.0;

124 
–em
->
»size_hªdËs
[4].
id
 = 
HANDLE_RESIZE_E
;

125 
–em
->
»size_hªdËs
[4].
pos
.
x
 = 
cÜÃr
->x +ƒËm->
width
;

126 
–em
->
»size_hªdËs
[4].
pos
.
y
 = 
cÜÃr
->y +ƒËm->
height
/2.0;

128 
–em
->
»size_hªdËs
[5].
id
 = 
HANDLE_RESIZE_SW
;

129 
–em
->
»size_hªdËs
[5].
pos
.
x
 = 
cÜÃr
->x;

130 
–em
->
»size_hªdËs
[5].
pos
.
y
 = 
cÜÃr
->y +ƒËm->
height
;

132 
–em
->
»size_hªdËs
[6].
id
 = 
HANDLE_RESIZE_S
;

133 
–em
->
»size_hªdËs
[6].
pos
.
x
 = 
cÜÃr
->x +ƒËm->
width
/2.0;

134 
–em
->
»size_hªdËs
[6].
pos
.
y
 = 
cÜÃr
->y +ƒËm->
height
;

136 
–em
->
»size_hªdËs
[7].
id
 = 
HANDLE_RESIZE_SE
;

137 
–em
->
»size_hªdËs
[7].
pos
.
x
 = 
cÜÃr
->x +ƒËm->
width
;

138 
–em
->
»size_hªdËs
[7].
pos
.
y
 = 
cÜÃr
->y +ƒËm->
height
;

139 
	}
}

152 
ObjeùChªge
*

153 
	$–em’t_move_hªdË
(
EËm’t
 *
–em
, 
HªdËId
 
id
,

154 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

155 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

157 
Pošt
 
p
;

158 
Pošt
 *
cÜÃr
;

160 
	`as£¹
(
id
>=
HANDLE_RESIZE_NW
);

161 
	`as£¹
(
id
<=
HANDLE_RESIZE_SE
);

163 
cÜÃr
 = &
–em
->corner;

165 
p
 = *
to
;

166 
	`pošt_sub
(&
p
, &
–em
->
cÜÃr
);

168 
id
) {

169 
HANDLE_RESIZE_NW
:

170 iàĞ
to
->
x
 < (
cÜÃr
->x+
–em
->
width
)) {

171 
cÜÃr
->
x
 +ğ
p
.x;

172 
–em
->
width
 -ğ
p
.
x
;

174 iàĞ
to
->
y
 < (
cÜÃr
->y+
–em
->
height
)) {

175 
cÜÃr
->
y
 +ğ
p
.y;

176 
–em
->
height
 -ğ
p
.
y
;

179 
HANDLE_RESIZE_N
:

180 iàĞ
to
->
y
 < (
cÜÃr
->y+
–em
->
height
)) {

181 
cÜÃr
->
y
 +ğ
p
.y;

182 
–em
->
height
 -ğ
p
.
y
;

185 
HANDLE_RESIZE_NE
:

186 ià(
p
.
x
>0.0)

187 
–em
->
width
 = 
p
.
x
;

188 iàĞ
to
->
y
 < (
cÜÃr
->y+
–em
->
height
)) {

189 
cÜÃr
->
y
 +ğ
p
.y;

190 
–em
->
height
 -ğ
p
.
y
;

193 
HANDLE_RESIZE_W
:

194 iàĞ
to
->
x
 < (
cÜÃr
->x+
–em
->
width
)) {

195 
cÜÃr
->
x
 +ğ
p
.x;

196 
–em
->
width
 -ğ
p
.
x
;

199 
HANDLE_RESIZE_E
:

200 ià(
p
.
x
>0.0)

201 
–em
->
width
 = 
p
.
x
;

203 
HANDLE_RESIZE_SW
:

204 iàĞ
to
->
x
 < (
cÜÃr
->x+
–em
->
width
)) {

205 
cÜÃr
->
x
 +ğ
p
.x;

206 
–em
->
width
 -ğ
p
.
x
;

208 ià(
p
.
y
>0.0)

209 
–em
->
height
 = 
p
.
y
;

211 
HANDLE_RESIZE_S
:

212 ià(
p
.
y
>0.0)

213 
–em
->
height
 = 
p
.
y
;

215 
HANDLE_RESIZE_SE
:

216 ià(
p
.
x
>0.0)

217 
–em
->
width
 = 
p
.
x
;

218 ià(
p
.
y
>0.0)

219 
–em
->
height
 = 
p
.
y
;

222 
	`mes§ge_”rÜ
("Error, calledƒlement_move_handle() with wrong handle-id\n");

224  
NULL
;

225 
	}
}

235 
	$–em’t_move_hªdË_a¥eù
(
EËm’t
 *
–em
, 
HªdËId
 
id
,

236 
Pošt
 *
to
, 
»®
 
a¥eù_¿tio
)

238 
Pošt
 
p
;

239 
Pošt
 *
cÜÃr
;

240 
»®
 
width
, 
height
;

241 
»®
 
Ãw_width
, 
Ãw_height
;

242 
»®
 
move_x
=0;

243 
»®
 
move_y
=0;

245 
	`as£¹
(
id
>=
HANDLE_RESIZE_NW
);

246 
	`as£¹
(
id
<=
HANDLE_RESIZE_SE
);

248 
cÜÃr
 = &
–em
->corner;

250 
p
 = *
to
;

251 
	`pošt_sub
(&
p
, &
–em
->
cÜÃr
);

253 
width
 = 
–em
->width;

254 
height
 = 
–em
->height;

256 
Ãw_width
 = 0.0;

257 
Ãw_height
 = 0.0;

260 
id
) {

261 
HANDLE_RESIZE_NW
:

262 
Ãw_width
 = 
width
 - 
p
.
x
;

263 
Ãw_height
 = 
height
 - 
p
.
y
;

264 
move_x
 = 1.0;

265 
move_y
 = 1.0;

267 
HANDLE_RESIZE_N
:

268 
Ãw_height
 = 
height
 - 
p
.
y
;

269 
move_y
 = 1.0;

270 
move_x
 = 0.5;

272 
HANDLE_RESIZE_NE
:

273 
Ãw_width
 = 
p
.
x
;

274 
Ãw_height
 = 
height
 - 
p
.
y
;

275 
move_x
 = 0.0;

276 
move_y
 = 1.0;

278 
HANDLE_RESIZE_W
:

279 
Ãw_width
 = 
width
 - 
p
.
x
;

280 
move_x
 = 1.0;

281 
move_y
 = 0.5;

283 
HANDLE_RESIZE_E
:

284 
Ãw_width
 = 
p
.
x
;

285 
move_x
 = 0.0;

286 
move_y
 = 0.5;

288 
HANDLE_RESIZE_SW
:

289 
Ãw_width
 = 
width
 - 
p
.
x
;

290 
Ãw_height
 = 
p
.
y
;

291 
move_x
 = 1.0;

292 
move_y
 = 0.0;

294 
HANDLE_RESIZE_S
:

295 
Ãw_height
 = 
p
.
y
;

296 
move_x
 = 0.5;

297 
move_y
 = 0.0;

299 
HANDLE_RESIZE_SE
:

300 
Ãw_width
 = 
p
.
x
;

301 
Ãw_height
 = 
p
.
y
;

302 
move_x
 = 0.0;

303 
move_y
 = 0.0;

306 
	`mes§ge_”rÜ
("Error, calledƒlement_move_handle() with wrong handle-id\n");

310 ià(
Ãw_width
 > 
Ãw_height
*
a¥eù_¿tio
) {

311 
Ãw_height
 = 
Ãw_width
/
a¥eù_¿tio
;

313 
Ãw_width
 = 
Ãw_height
*
a¥eù_¿tio
;

316 iàĞ(
Ãw_width
<0.0è|| (
Ãw_height
<0.0)) {

317 
Ãw_width
 = 0.0;

318 
Ãw_height
 = 0.0;

321 
cÜÃr
->
x
 -ğ(
Ãw_width
 - 
width
)*
move_x
;

322 
cÜÃr
->
y
 -ğ(
Ãw_height
 - 
height
)*
move_y
;

324 
–em
->
width
 = 
Ãw_width
;

325 
–em
->
height
 = 
Ãw_height
;

326 
	}
}

339 
	$–em’t_š™
(
EËm’t
 *
–em
, 
num_hªdËs
, 
num_cÚÃùiÚs
)

341 
DŸObjeù
 *
obj
;

342 
i
;

344 
obj
 = &
–em
->
objeù
;

346 
	`as£¹
(
num_hªdËs
>=8);

348 
	`objeù_š™
(
obj
, 
num_hªdËs
, 
num_cÚÃùiÚs
);

350 
i
=0;i<8;i++) {

351 
obj
->
hªdËs
[
i
] = &
–em
->
»size_hªdËs
[i];

352 
obj
->
hªdËs
[
i
]->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

353 
obj
->
hªdËs
[
i
]->
cÚÃùed_to
 = 
NULL
;

354 
obj
->
hªdËs
[
i
]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

356 
	}
}

364 
	$–em’t_cİy
(
EËm’t
 *
äom
, EËm’ˆ*
to
)

366 
DŸObjeù
 *
toobj
, *
äomobj
;

367 
i
;

369 
äomobj
 = &
äom
->
objeù
;

370 
toobj
 = &
to
->
objeù
;

372 
	`objeù_cİy
(
äomobj
, 
toobj
);

374 
to
->
cÜÃr
 = 
äom
->corner;

375 
to
->
width
 = 
äom
->width;

376 
to
->
height
 = 
äom
->height;

378 
i
=0;i<8;i++) {

379 
to
->
»size_hªdËs
[
i
] = 
äom
->resize_handles[i];

380 
to
->
»size_hªdËs
[
i
].
cÚÃùed_to
 = 
NULL
;

381 
toobj
->
hªdËs
[
i
] = &
to
->
»size_hªdËs
[i];

383 
	`memıy
(&
to
->
exŒa_¥acšg
,&
äom
->extra_spacing,(to->extra_spacing));

384 
	}
}

392 
	$–em’t_de¡roy
(
EËm’t
 *
–em
)

394 
	`objeù_de¡roy
(&
–em
->
objeù
);

395 
	}
}

402 
	$–em’t_§ve
(
EËm’t
 *
–em
, 
ObjeùNode
 
obj_node
)

404 
	`objeù_§ve
(&
–em
->
objeù
, 
obj_node
);

406 
	`d©a_add_pošt
(
	`Ãw_©Œibu‹
(
obj_node
, "elem_corner"),

407 &
–em
->
cÜÃr
);

408 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "elem_width"),

409 
–em
->
width
);

410 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "elem_height"),

411 
–em
->
height
);

412 
	}
}

414 
	$–em’t_lßd
(
EËm’t
 *
–em
, 
ObjeùNode
 
obj_node
)

416 
A‰ribu‹Node
 
©Œ
;

418 
	`objeù_lßd
(&
–em
->
objeù
, 
obj_node
);

420 
–em
->
cÜÃr
.
x
 = 0.0;

421 
–em
->
cÜÃr
.
y
 = 0.0;

422 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "elem_corner");

423 ià(
©Œ
 !ğ
NULL
)

424 
	`d©a_pošt
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
–em
->
cÜÃr
 );

426 
–em
->
width
 = 1.0;

427 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "elem_width");

428 ià(
©Œ
 !ğ
NULL
)

429 
–em
->
width
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

431 
–em
->
height
 = 1.0;

432 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "elem_height");

433 ià(
©Œ
 !ğ
NULL
)

434 
–em
->
height
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

436 
	}
}

	@O:\tool\dvs50\lib\element.h

20 #iâdeà
ELEMENT_H


21 
	#ELEMENT_H


	)

23 
	~"dŸty³s.h
"

24 
	~"objeù.h
"

25 
	~"hªdË.h
"

26 
	~"cÚÃùiÚpošt.h
"

27 
	~"boundšgbox.h
"

36 
	s_EËm’t
 {

37 
DŸObjeù
 
	mobjeù
;

39 
HªdË
 
	m»size_hªdËs
[8];

41 
Pošt
 
	mcÜÃr
;

42 
»®
 
	mwidth
;

43 
»®
 
	mheight
;

45 
EËm’tBBExŒas
 
	mexŒa_¥acšg
;

48 
DIAVAR
 
–em’t_upd©e_hªdËs
(
EËm’t
 *
–em
);

49 
DIAVAR
 
–em’t_upd©e_cÚÃùiÚs_»ùªgË
(
EËm’t
 *
–em
,

50 
CÚÃùiÚPošt
* 
ıs
);

51 
DIAVAR
 
–em’t_upd©e_boundšgbox
(
EËm’t
 *
–em
);

52 
DIAVAR
 
–em’t_š™
(
EËm’t
 *
–em
, 
num_hªdËs
, 
num_cÚÃùiÚs
);

53 
DIAVAR
 
–em’t_de¡roy
(
EËm’t
 *
–em
);

54 
DIAVAR
 
–em’t_cİy
(
EËm’t
 *
äom
, EËm’ˆ*
to
);

55 
DIAVAR
 
ObjeùChªge
* 
–em’t_move_hªdË
(
EËm’t
 *
–em
, 
HªdËId
 
id
,

56 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

57 
HªdËMoveR—sÚ
 
»asÚ
,

58 
Modif›rKeys
 
modif›rs
);

59 
–em’t_move_hªdË_a¥eù
(
EËm’t
 *
–em
, 
HªdËId
 
id
,

60 
Pošt
 *
to
, 
»®
 
a¥eù_¿tio
);

62 
DIAVAR
 
–em’t_§ve
(
EËm’t
 *
–em
, 
ObjeùNode
 
obj_node
);

63 
DIAVAR
 
–em’t_lßd
(
EËm’t
 *
–em
, 
ObjeùNode
 
obj_node
);

66 
PrİNumD©a
 
	gwidth_¿nge
 = { -
G_MAXFLOAT
, G_MAXFLOAT, 0.1};

68 
	#ELEMENT_COMMON_PROPERTIES
 \

69 
OBJECT_COMMON_PROPERTIES
, \

70 { "–em_cÜÃr", 
PROP_TYPE_POINT
, 
PROP_FLAG_NO_DEFAULTS
, \

72 { "–em_width", 
PROP_TYPE_REAL
, 
PROP_FLAG_DONT_MERGE
 | 
PROP_FLAG_NO_DEFAULTS
 | 
PROP_FLAG_OPTIONAL
, \

73 "EËm’ˆwidth", "Thwidth oàth–em’t", &
width_¿nge
}, \

74 { "–em_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_DONT_MERGE
 | 
PROP_FLAG_NO_DEFAULTS
 | 
PROP_FLAG_OPTIONAL
, \

75 "EËm’ˆheight", "Thheighˆoàth–em’t", &
width_¿nge
}

	)

93 
	#ELEMENT_COMMON_PROPERTIES_OFFSETS
 \

94 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

95 { "–em_cÜÃr", 
PROP_TYPE_POINT
, 
	`off£tof
(
EËm’t
, 
cÜÃr
) }, \

96 { "–em_width", 
PROP_TYPE_REAL
, 
	`off£tof
(
EËm’t
, 
width
) }, \

97 { "–em_height", 
PROP_TYPE_REAL
, 
	`off£tof
(
EËm’t
, 
height
è}

	)

	@O:\tool\dvs50\lib\filter.c

22 #ifdeà
HAVE_CONFIG_H


23 
	~<cÚfig.h
>

26 
	~"f‹r.h
"

27 
	~"š.h
"

28 
	~<¡ršg.h
>

30 
GLi¡
 *
	gexpÜt_f‹rs
 = 
NULL
;

31 
GLi¡
 *
	gimpÜt_f‹rs
 = 
NULL
;

32 
GLi¡
 *
	gÿÎback_f‹rs
 = 
NULL
;

34 
gšt


35 
	$expÜt_f‹r_com·»
(
gcÚ¡poš‹r
 
a
, gcÚ¡poš‹¸
b
)

37 cÚ¡ 
DŸExpÜtF‹r
 *
ç
 = 
a
, *
fb
 = 
b
;

39  
	`g_ascii_¡rÿ£cmp
(
	`_
(
ç
->
desütiÚ
), _(
fb
->description));

40 
	}
}

43 
	$f‹r_»gi¡”_expÜt
(
DŸExpÜtF‹r
 *
ef‹r
)

45 ià(
ef‹r
->
desütiÚ
 =ğ
NULL
) {

48 
expÜt_f‹rs
 = 
	`g_li¡_š£¹_sÜ‹d
ÓxpÜt_f‹rs, 
ef‹r
,

49 
expÜt_f‹r_com·»
);

50 
	}
}

53 
	$f‹r_uÄegi¡”_expÜt
(
DŸExpÜtF‹r
 *
ef‹r
)

55 
expÜt_f‹rs
 = 
	`g_li¡_»move
ÓxpÜt_f‹rs, 
ef‹r
);

56 
	}
}

59 
GLi¡
 *

60 
	$f‹r_g‘_expÜt_f‹rs
()

62  
expÜt_f‹rs
;

63 
	}
}

66 
gch¬
 *

67 
	$f‹r_g‘_expÜt_f‹r_Ïb–
(
DŸExpÜtF‹r
 *
ef‹r
)

69 
GSŒšg
 *
¡r
 = 
	`g_¡ršg_Ãw
(
	`_
(
ef‹r
->
desütiÚ
));

70 
gšt
 
ext
 = 0;

71 
gch¬
 *
»t
;

73 
ext
 = 0; 
ef‹r
->
ex‹nsiÚs
[ext] !ğ
NULL
;ƒxt++) {

74 ià(
ext
 == 0)

75 
	`g_¡ršg_­³nd
(
¡r
, " (*.");

77 
	`g_¡ršg_­³nd
(
¡r
, ", *.");

78 
	`g_¡ršg_­³nd
(
¡r
, 
ef‹r
->
ex‹nsiÚs
[
ext
]);

80 ià(
ext
 > 0)

81 
	`g_¡ršg_­³nd
(
¡r
, ")");

82 
»t
 = 
¡r
->str;

83 
	`g_¡ršg_ä“
(
¡r
, 
FALSE
);

84  
»t
;

85 
	}
}

88 
GLi¡
 *

89 
	$f‹r_g‘_unique_expÜt_Çmes
(cÚ¡ *
ext
)

91 
GLi¡
 *
tmp
, *
»s
 = 
NULL
;

93 
tmp
 = 
expÜt_f‹rs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

94 
DŸExpÜtF‹r
 *
ef
 = 
tmp
->
d©a
;

95 
gšt
 
i
;

97 
i
 = 0; 
ef
->
ex‹nsiÚs
[i] !ğ
NULL
; i++) {

98 ià(!
	`g_ascii_¡rÿ£cmp
(
ef
->
ex‹nsiÚs
[
i
], 
ext
è&&ƒf->
unique_Çme
)

99 
»s
 = 
	`g_li¡_­³nd
 (»s, (*)
ef
->
unique_Çme
);

102  
»s
;

103 
	}
}

105 
GHashTabË
 *
	g_çvÜed_hash
 = 
NULL
;

109 
	$f‹r_£t_çvÜed_expÜt
(cÚ¡ *
ext
, cÚ¡ *
Çme
)

111 ià(!
_çvÜed_hash
)

112 
_çvÜed_hash
 = 
	`g_hash_bË_Ãw_fuÎ
 (
g_¡r_hash
, 
g_¡r_equ®
, 
g_ä“
, g_free);

114 
	`g_hash_bË_š£¹
(
_çvÜed_hash
, 
	`g_ascii_¡rdown
(
ext
, -1), 
	`g_¡rdup
(
Çme
));

115 
	}
}

123 
DŸExpÜtF‹r
 *

124 
	$f‹r_guess_expÜt_f‹r
(cÚ¡ 
gch¬
 *
f’ame
)

126 
GLi¡
 *
tmp
;

127 
gch¬
 *
ext
;

128 
gšt
 
no_guess
 = 0;

129 
DŸExpÜtF‹r
 *
dÚt_guess
 = 
NULL
;

130 cÚ¡ 
gch¬
 *
unique_Çme
;

132 
ext
 = 
	`¡¼chr
(
f’ame
, '.');

133 ià(
ext
)

134 
ext
++;

136 
ext
 = "";

139 
unique_Çme
 = 
_çvÜed_hash
 ? 
	`g_hash_bË_lookup
(_çvÜed_hash, 
ext
è: 
NULL
;

140 ià(
unique_Çme
) {

141 
DŸExpÜtF‹r
 *
ef
 = 
	`f‹r_g‘_by_Çme
(
unique_Çme
);

142 ià(
ef
)

143  
ef
;

146 
tmp
 = 
expÜt_f‹rs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

147 
DŸExpÜtF‹r
 *
ef
 = 
tmp
->
d©a
;

148 
gšt
 
i
;

150 
i
 = 0; 
ef
->
ex‹nsiÚs
[i] !ğ
NULL
; i++) {

151 ià(!
	`g_ascii_¡rÿ£cmp
(
ef
->
ex‹nsiÚs
[
i
], 
ext
)) {

152 ià(
ef
->
hšts
 & 
FILTER_DONT_GUESS
) {

153 
dÚt_guess
 = 
ef
;

154 ++
no_guess
;

157  
ef
;

161  (
no_guess
 =ğ1è? 
dÚt_guess
 : 
NULL
;

162 
	}
}

166 
DŸExpÜtF‹r
 *

167 
	$f‹r_g‘_by_Çme
(cÚ¡ 
gch¬
 *
Çme
)

169 
GLi¡
 *
tmp
;

170 
DŸExpÜtF‹r
 *
f‹r
 = 
NULL
;

172 
tmp
 = 
expÜt_f‹rs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

173 
DŸExpÜtF‹r
 *
ef
 = 
tmp
->
d©a
;

174 ià(
ef
->
unique_Çme
 !ğ
NULL
) {

175 ià(!
	`g_ascii_¡rÿ£cmp
(
ef
->
unique_Çme
, 
Çme
)) {

176 ià(
f‹r
)

177 
	`g_w¬nšg
(
	`_
("MuÉËƒxpÜˆf‹r w™h uniquÇm%s"), 
Çme
);

178 
f‹r
 = 
ef
;

182  
f‹r
;

183 
	}
}

185 
gšt


186 
	$impÜt_f‹r_com·»
(
gcÚ¡poš‹r
 
a
, gcÚ¡poš‹¸
b
)

188 cÚ¡ 
DŸImpÜtF‹r
 *
ç
 = 
a
, *
fb
 = 
b
;

190  
	`g_ascii_¡rÿ£cmp
(
	`_
(
ç
->
desütiÚ
), _(
fb
->description));

191 
	}
}

194 
	$f‹r_»gi¡”_impÜt
(
DŸImpÜtF‹r
 *
if‹r
)

196 ià(
if‹r
->
desütiÚ
 =ğ
NULL
) {

199 
impÜt_f‹rs
 = 
	`g_li¡_š£¹_sÜ‹d
(impÜt_f‹rs, 
if‹r
,

200 
impÜt_f‹r_com·»
);

201 
	}
}

204 
	$f‹r_uÄegi¡”_impÜt
(
DŸImpÜtF‹r
 *
if‹r
)

206 
impÜt_f‹rs
 = 
	`g_li¡_»move
(impÜt_f‹rs, 
if‹r
);

207 
	}
}

210 
GLi¡
 *

211 
	$f‹r_g‘_impÜt_f‹rs
()

213  
impÜt_f‹rs
;

214 
	}
}

217 
gch¬
 *

218 
	$f‹r_g‘_impÜt_f‹r_Ïb–
(
DŸImpÜtF‹r
 *
if‹r
)

220 
GSŒšg
 *
¡r
 = 
	`g_¡ršg_Ãw
(
	`_
(
if‹r
->
desütiÚ
));

221 
gšt
 
ext
 = 0;

222 
gch¬
 *
»t
;

224 
ext
 = 0; 
if‹r
->
ex‹nsiÚs
[ext] !ğ
NULL
;ƒxt++) {

225 ià(
ext
 == 0)

226 
	`g_¡ršg_­³nd
(
¡r
, " (*.");

228 
	`g_¡ršg_­³nd
(
¡r
, ", *.");

229 
	`g_¡ršg_­³nd
(
¡r
, 
if‹r
->
ex‹nsiÚs
[
ext
]);

231 ià(
ext
 > 0)

232 
	`g_¡ršg_­³nd
(
¡r
, ")");

233 
»t
 = 
¡r
->str;

234 
	`g_¡ršg_ä“
(
¡r
, 
FALSE
);

235  
»t
;

236 
	}
}

242 
DŸImpÜtF‹r
 *

243 
	$f‹r_guess_impÜt_f‹r
(cÚ¡ 
gch¬
 *
f’ame
)

245 
GLi¡
 *
tmp
;

246 
gch¬
 *
ext
;

247 
no_guess
 = 0;

248 
DŸImpÜtF‹r
 *
dÚt_guess
 = 
NULL
;

250 
ext
 = 
	`¡¼chr
(
f’ame
, '.');

251 ià(
ext
)

252 
ext
++;

254 
ext
 = "";

256 
tmp
 = 
impÜt_f‹rs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

257 
DŸImpÜtF‹r
 *
if‹r
 = 
tmp
->
d©a
;

258 
gšt
 
i
;

260 
i
 = 0; 
if‹r
->
ex‹nsiÚs
[i] !ğ
NULL
; i++) {

261 ià(!
	`g_ascii_¡rÿ£cmp
(
if‹r
->
ex‹nsiÚs
[
i
], 
ext
)) {

262 ià(
if‹r
->
hšts
 & 
FILTER_DONT_GUESS
) {

263 
dÚt_guess
 = 
if‹r
;

264 ++
no_guess
;

267  
if‹r
;

271  (
no_guess
 =ğ1è? 
dÚt_guess
 : 
NULL
;

272 
	}
}

276 
	$f‹r_»gi¡”_ÿÎback
(
DŸC®lbackF‹r
 *
cbf‹r
)

279 
	`g_»tuº_if_ç
 (
cbf‹r
 !ğ
NULL
);

280 
	`g_»tuº_if_ç
 (
cbf‹r
->
ÿÎback
 !ğ
NULL
);

281 
	`g_»tuº_if_ç
 (
cbf‹r
->
m’u·th
 !ğ
NULL
);

282 
	`g_»tuº_if_ç
 (
cbf‹r
->
desütiÚ
 !ğ
NULL
);

283 
	`g_»tuº_if_ç
 (
cbf‹r
->
aùiÚ
 !ğ
NULL
);

286 
ÿÎback_f‹rs
 = 
	`g_li¡_­³nd
 (ÿÎback_f‹rs, (
gpoš‹r
)
cbf‹r
);

287 
	}
}

290 
GLi¡
 *

291 
	$f‹r_g‘_ÿÎbacks
()

293  
	`g_li¡_fœ¡
 (
ÿÎback_f‹rs
);

294 
	}
}

	@O:\tool\dvs50\lib\filter.h

21 #iâdeà
FILTER_H


22 
	#FILTER_H


	)

24 
	~"dŸty³s.h
"

25 
	~<glib.h
>

26 
	~<dŸg¿md©a.h
>

28 
G_BEGIN_DECLS


30 
	eF‹rFÏgs
 {

31 
	mFILTER_DONT_GUESS
 = (1<<0)

34 (* 
	tDŸExpÜtFunc
è(
	tDŸg¿mD©a
 *
	tdŸ
, cÚ¡ 
	tgch¬
 *
	tf’ame
,

35 cÚ¡ 
	tgch¬
 *
	tdŸf’ame
, * 
	tu£r_d©a
);

37 
	s_DŸExpÜtF‹r
 {

38 cÚ¡ 
gch¬
 *
desütiÚ
;

41 cÚ¡ 
gch¬
 **
ex‹nsiÚs
;

42 
DŸExpÜtFunc
 
expÜt_func
;

43 * 
u£r_d©a
;

49 cÚ¡ 
gch¬
 *
unique_Çme
;

51 
gušt
 
hšts
;

53 
GTy³
 
»nd””_ty³
;

57 
	$gboŞ—n
 (* 
	tDŸImpÜtFunc
è(cÚ¡ 
	tgch¬
 *
	tf’ame
, 
	tDŸg¿mD©a
 *
	tdŸ
,

58 * 
	tu£r_d©a
);

60 
	s_DŸImpÜtF‹r
 {

61 cÚ¡ 
gch¬
 *
desütiÚ
;

64 cÚ¡ 
gch¬
 **
ex‹nsiÚs
;

65 
DŸImpÜtFunc
 
impÜt_func
;

66 * 
u£r_d©a
;

72 cÚ¡ 
gch¬
 *
unique_Çme
;

74 
gušt
 
hšts
;

78 (* 
	tDŸC®lbackFunc
è(
	tDŸg¿mD©a
 *
	tdŸ
,

79 cÚ¡ 
	tgch¬
 *
	tf’ame
,

80 
	tgušt
 
	tæags
,

81 * 
	tu£r_d©a
);

83 
	s_DŸC®lbackF‹r
 {

84 cÚ¡ 
gch¬
 *
aùiÚ
;

85 cÚ¡ 
gch¬
 *
desütiÚ
;

86 cÚ¡ 
gch¬
 *
m’u·th
;

87 
DŸC®lbackFunc
 
ÿÎback
;

88 * 
u£r_d©a
;

93 
DIAVAR
 
	`f‹r_»gi¡”_expÜt
(
DŸExpÜtF‹r
 *
ef‹r
);

95 
DIAVAR
 
	`f‹r_uÄegi¡”_expÜt
(
DŸExpÜtF‹r
 *
ef‹r
);

98 
DIAVAR
 
GLi¡
 *
	`f‹r_g‘_expÜt_f‹rs
();

101 
DIAVAR
 
gch¬
 *
	`f‹r_g‘_expÜt_f‹r_Ïb–
(
DŸExpÜtF‹r
 *
ef‹r
);

104 
DIAVAR
 
DŸExpÜtF‹r
 *
	`f‹r_guess_expÜt_f‹r
(cÚ¡ 
gch¬
 *
f’ame
);

106 
DIAVAR
 
DŸExpÜtF‹r
 *
	`f‹r_g‘_by_Çme
(cÚ¡ 
gch¬
 *
Çme
);

108 
DIAVAR
 
GLi¡
 *
	`f‹r_g‘_unique_expÜt_Çmes
(cÚ¡ *
ex‹nsiÚ
);

110 
DIAVAR
 
	`f‹r_£t_çvÜed_expÜt
(cÚ¡ *
ex‹nsiÚ
, cÚ¡ *
Çme
);

112 
DIAVAR
 
	`f‹r_»gi¡”_impÜt
(
DŸImpÜtF‹r
 *
if‹r
);

113 
DIAVAR
 
	`f‹r_uÄegi¡”_impÜt
(
DŸImpÜtF‹r
 *
if‹r
);

114 
DIAVAR
 
GLi¡
 *
	`f‹r_g‘_impÜt_f‹rs
();

115 
DIAVAR
 
gch¬
 *
	`f‹r_g‘_impÜt_f‹r_Ïb–
(
DŸImpÜtF‹r
 *
if‹r
);

116 
DIAVAR
 
DŸImpÜtF‹r
 *
	`f‹r_guess_impÜt_f‹r
(cÚ¡ 
gch¬
 *
f’ame
);

118 
DIAVAR
 
	`f‹r_»gi¡”_ÿÎback
(
DŸC®lbackF‹r
 *
cbf‹r
);

120 
DIAVAR
 
GLi¡
 *
	`f‹r_g‘_ÿÎbacks
();

122 
G_END_DECLS


	@O:\tool\dvs50\lib\focus.c

27 
	~<cÚfig.h
>

28 
	~"‹xt.h
"

29 
	~"focus.h
"

30 
	~"dŸg¿md©a.h
"

31 
	~"objeù.h
"

34 
GLi¡
 *

35 
	$g‘_‹xt_foci
(
DŸg¿mD©a
 *
dŸ
)

37  
dŸ
->
‹xt_ed™s
;

38 
	}
}

41 
Focus
 *

42 
	$g‘_aùive_focus
(
DŸg¿mD©a
 *
dŸ
)

44  
dŸ
->
aùive_‹xt_ed™
;

45 
	}
}

53 
	$£t_aùive_focus
(
DŸg¿mD©a
 *
dŸ
, 
Focus
 *
focus
)

55 ià(
dŸ
->
aùive_‹xt_ed™
 !ğ
NULL
) {

56 
dŸ
->
aùive_‹xt_ed™
->
has_focus
 = 
FALSE
;

58 
dŸ
->
aùive_‹xt_ed™
 = 
focus
;

59 ià(
focus
 !ğ
NULL
) {

60 
focus
->
has_focus
 = 
TRUE
;

62 
	}
}

67 
	$add_‹xt_focus
(
DŸg¿mD©a
 *
dŸ
, 
Focus
 *
focus
)

69 
dŸ
->
‹xt_ed™s
 = 
	`g_li¡_­³nd
(dŸ->‹xt_ed™s, 
focus
);

70 
	}
}

75 
GLi¡
 *

76 
	$£t_‹xt_foci
(
DŸg¿mD©a
 *
dŸ
, 
GLi¡
 *
foci
)

78 
GLi¡
 *
Şd_foci
 = 
	`g‘_‹xt_foci
(
dŸ
);

79 
dŸ
->
‹xt_ed™s
 = 
NULL
;

80  
Şd_foci
;

81 
	}
}

87 
	$»que¡_focus
(
Focus
 *
focus
)

89 
DŸg¿mD©a
 *
dŸ
 = 
focus
->
obj
->
·»Á_Ïy”
->
·»Á_dŸg¿m
;

90 
GLi¡
 *
‹xt_foci
 = 
	`g‘_‹xt_foci
(
dŸ
);

92 ià(!
	`g_li¡_fšd
(
‹xt_foci
, 
focus
)) {

93 
	`add_‹xt_focus
(
dŸ
, 
focus
);

96 
	}
}

99 
	$give_focus
(
Focus
 *
focus
)

101 
DŸg¿mD©a
 *
dŸ
 = 
focus
->
obj
->
·»Á_Ïy”
->
·»Á_dŸg¿m
;

103 ià(
	`g‘_aùive_focus
(
dŸ
è!ğ
NULL
) {

104 
	`g‘_aùive_focus
(
dŸ
)->
has_focus
 = 
FALSE
;

106 
	`£t_aùive_focus
(
dŸ
, 
focus
);

107 
focus
->
has_focus
 = 
TRUE
;

108 
	}
}

112 
Focus
 *

113 
	$focus_g‘_fœ¡_Ú_objeù
(
DŸObjeù
 *
obj
)

115 
GLi¡
 *
tm¶i¡
 = 
	`g‘_‹xt_foci
(
obj
->
·»Á_Ïy”
->
·»Á_dŸg¿m
);

117 ; 
tm¶i¡
 !ğ
NULL
;m¶i¡ = 
	`g_li¡_Ãxt
(tmplist) ) {

118 
Focus
 *
focus
 = (Focus*)
tm¶i¡
->
d©a
;

119 ià(
	`focus_g‘_objeù
(
focus
è=ğ
obj
) {

120  
focus
;

123  
NULL
;

124 
	}
}

130 
DŸObjeù
*

131 
	$focus_g‘_objeù
(
Focus
 *
focus
)

133  
focus
->
obj
;

134 
	}
}

136 
Focus
 *

137 
	$focus_Ãxt_Ú_dŸg¿m
(
DŸg¿mD©a
 *
dŸ
)

139 ià(
	`g‘_‹xt_foci
(
dŸ
è!ğ
NULL
 && 
	`g‘_aùive_focus
(dia) != NULL) {

140 
GLi¡
 *
li¡–em
 = 
	`g_li¡_fšd
(
	`g‘_‹xt_foci
(
dŸ
), 
	`g‘_aùive_focus
(dia));

141 
li¡–em
 = 
	`g_li¡_Ãxt
(listelem);

142 ià(
li¡–em
 =ğ
NULL
èli¡–em = 
	`g‘_‹xt_foci
(
dŸ
);

143  ((
Focus
*)
li¡–em
->
d©a
);

145  
NULL
;

146 
	}
}

149 
Focus
 *

150 
	$focus_´evious_Ú_dŸg¿m
(
DŸg¿mD©a
 *
dŸ
)

152 
GLi¡
 *
‹xt_foci
 = 
	`g‘_‹xt_foci
(
dŸ
);

153 ià(
‹xt_foci
 !ğ
NULL
 && 
	`g‘_aùive_focus
(
dŸ
) != NULL) {

154 
GLi¡
 *
li¡–em
 = 
	`g_li¡_fšd
(
‹xt_foci
, 
	`g‘_aùive_focus
(
dŸ
));

155 
li¡–em
 = 
	`g_li¡_´evious
(listelem);

156 ià(
li¡–em
 =ğ
NULL
)

157 
li¡–em
 = 
	`g_li¡_Ï¡
(
‹xt_foci
);

158  (
Focus
 *)
li¡–em
->
d©a
;

160  
NULL
;

161 
	}
}

164 
	$»move_focus_Ú_dŸg¿m
(
DŸg¿mD©a
 *
dŸ
)

166 ià(
	`g‘_aùive_focus
(
dŸ
è!ğ
NULL
) {

167 
	`£t_aùive_focus
(
dŸ
, 
NULL
);

169 
	}
}

172 
	$»£t_foci_Ú_dŸg¿m
(
DŸg¿mD©a
 *
dŸ
)

174 
GLi¡
 *
Şd_foci
;

175 
	`»move_focus_Ú_dŸg¿m
(
dŸ
);

176 
Şd_foci
 = 
	`£t_‹xt_foci
(
dŸ
, 
NULL
);

177 
	`g_li¡_ä“
(
Şd_foci
);

178 
	}
}

183 
gboŞ—n


184 
	$»move_focus_objeù
(
DŸObjeù
 *
obj
)

186 
DŸg¿mD©a
 *
dŸ
 = 
obj
->
·»Á_Ïy”
->
·»Á_dŸg¿m
;

187 
GLi¡
 *
tm¶i¡
 = 
	`g‘_‹xt_foci
(
dŸ
);

188 
gboŞ—n
 
aùive
 = 
FALSE
;

189 
Focus
 *
Ãxt_focus
 = 
NULL
;

190 
Focus
 *
aùive_focus
 = 
	`g‘_aùive_focus
(
dŸ
);

192 ; 
tm¶i¡
 !ğ
NULL
; ) {

193 
Focus
 *
focus
 = (Focus*)
tm¶i¡
->
d©a
;

194 
GLi¡
 *
lšk
 = 
tm¶i¡
;

195 
tm¶i¡
 = 
	`g_li¡_Ãxt
(tmplist);

196 ià(
	`focus_g‘_objeù
(
focus
è=ğ
obj
) {

197 ià(
focus
 =ğ
aùive_focus
) {

198 
Ãxt_focus
 = 
	`focus_Ãxt_Ú_dŸg¿m
(
dŸ
);

199 
aùive
 = 
TRUE
;

201 
	`£t_‹xt_foci
(
dŸ
, 
	`g_li¡_d–‘e_lšk
(
	`g‘_‹xt_foci
(dŸ), 
lšk
));

204 ià(
Ãxt_focus
 !ğ
NULL
 && 
	`g‘_‹xt_foci
(
dŸ
) != NULL) {

205 
	`give_focus
(
Ãxt_focus
);

207 ià(
	`g‘_‹xt_foci
(
dŸ
è=ğ
NULL
) {

208 
	`£t_aùive_focus
(
dŸ
, 
NULL
);

211  
aùive
;

212 
	}
}

	@O:\tool\dvs50\lib\focus.h

18 #iâdeà
FOCUS_H


19 
	#FOCUS_H


	)

21 
	~"dŸty³s.h
"

23 
	s_Focus
 {

24 
DŸObjeù
 *
	mobj
;

25 
Text
 *
	m‹xt
;

26 
	mhas_focus
;

27 *
	mu£r_d©a
;

31 (*
	mkey_ev’t
)(
Focus
 *
	mfocus
, 
gušt
 
	mkeysym
, cÚ¡ 
gch¬
 *
	m¡r
, 
	m¡¾’
,

32 
ObjeùChªge
 **
	mchªge
);

35 
»que¡_focus
(
Focus
 *
focus
);

36 
DIAVAR
 
Focus
 *
g‘_aùive_focus
(
DŸg¿mD©a
 *
dŸ
);

37 
DIAVAR
 
give_focus
(
Focus
 *
focus
);

38 
DIAVAR
 
Focus
 *
focus_g‘_fœ¡_Ú_objeù
(
DŸObjeù
 *
obj
);

39 
DIAVAR
 
Focus
 *
focus_Ãxt_Ú_dŸg¿m
(
DŸg¿mD©a
 *
dŸ
);

40 
DIAVAR
 
Focus
 *
focus_´evious_Ú_dŸg¿m
(
DŸg¿mD©a
 *
dŸ
);

41 
DIAVAR
 
»move_focus_Ú_dŸg¿m
(
DŸg¿mD©a
 *
dŸ
);

42 
DIAVAR
 
gboŞ—n
 
»move_focus_objeù
(
DŸObjeù
 *
obj
);

43 
DIAVAR
 
»£t_foci_Ú_dŸg¿m
(
DŸg¿mD©a
 *
dŸ
);

44 
DIAVAR
 
DŸObjeù
* 
focus_g‘_objeù
(
Focus
 *
focus
);

	@O:\tool\dvs50\lib\font.c

21 #ifdeà
HAVE_CONFIG_H


22 
	~<cÚfig.h
>

25 
	~<¡dio.h
>

26 
	~<¡dlib.h
>

27 
	~<¡ršg.h
>

28 
	~<time.h
>

30 
	~<·ngo/·ngo.h
>

31 #ifdeà
HAVE_FREETYPE


32 
	~<·ngo/·ngoá2.h
>

34 
	~<gdk/gdk.h
>

35 
	~<gtk/gtk.h
>

36 #ifdeà
GDK_WINDOWING_WIN32


38 
	#ReùªgË
 
Wš32ReùªgË


	)

39 
	#WIN32_LEAN_AND_MEAN


	)

40 
	~<·ngo/·ngowš32.h
>

41 #undeà
ReùªgË


43 
	~"fÚt.h
"

44 
	~"mes§ge.h
"

45 
	~"š.h
"

46 
	~"‹xše.h
"

48 
PªgoCÚ‹xt
* 
	g·ngo_cÚ‹xt
 = 
NULL
;

50 
	s_DŸFÚt


52 
GObjeù
 
	m·»Á_š¡ªû
;

54 
PªgoFÚtDesütiÚ
* 
	mpfd
;

55  * 
	mËgacy_Çme
;

61 
»®
 
	mheight
;

63 
PªgoFÚt
 *
	mlßded
;

64 
PªgoFÚtM‘rics
 *
	mm‘rics
;

72 
»®
 
	gglob®_zoom_çùÜ
 = 20.0;

75 
	$dŸ_fÚt_check_fÜ_fÚt
(
fÚt
)

77 
DŸFÚt
 *
check
;

78 
PªgoFÚt
 *
lßded
;

79 
»®
 
height
 = 1.0;

81 
check
 = 
	`dŸ_fÚt_Ãw_äom_¡yË
(
fÚt
, 
height
);

82 
lßded
 = 
	`·ngo_cÚ‹xt_lßd_fÚt
(
	`dŸ_fÚt_g‘_cÚ‹xt
(), 
check
->
pfd
);

83 ià(!
lßded
) {

84 
	`mes§ge_”rÜ
(
	`_
("Cª'ˆlßd fÚˆ%s.\n"), 
	`dŸ_fÚt_g‘_çmy
(
check
));

86 
	`g_objeù_uÄef
(
lßded
);

88 
	`dŸ_fÚt_uÄef
(
check
);

89 
	}
}

92 
	$dŸ_fÚt_š™
(
PªgoCÚ‹xt
* 
pcÚ‹xt
)

94 
·ngo_cÚ‹xt
 = 
pcÚ‹xt
;

96 
	`dŸ_fÚt_check_fÜ_fÚt
(
DIA_FONT_SANS
);

97 
	`dŸ_fÚt_check_fÜ_fÚt
(
DIA_FONT_SERIF
);

98 
	`dŸ_fÚt_check_fÜ_fÚt
(
DIA_FONT_MONOSPACE
);

99 
	}
}

102 
GLi¡
 *
	g·ngo_cÚ‹xts
 = 
NULL
;

106 
	$dŸ_fÚt_push_cÚ‹xt
(
PªgoCÚ‹xt
 *
pcÚ‹xt
)

108 
·ngo_cÚ‹xts
 = 
	`g_li¡_´•’d
Õªgo_cÚ‹xts, 
·ngo_cÚ‹xt
);

109 
·ngo_cÚ‹xt
 = 
pcÚ‹xt
;

110 
	`·ngo_cÚ‹xt_£t_Ïnguage
 (
·ngo_cÚ‹xt
, 
	`gtk_g‘_deçuÉ_Ïnguage
 ());

111 
	`g_objeù_»f
(
pcÚ‹xt
);

112 
	}
}

116 
	$dŸ_fÚt_pİ_cÚ‹xt
() {

117 
	`g_objeù_uÄef
(
·ngo_cÚ‹xt
);

118 
·ngo_cÚ‹xt
 = (
PªgoCÚ‹xt
*)
·ngo_cÚ‹xts
->
d©a
;

119 
	`·ngo_cÚ‹xt_£t_Ïnguage
 (
·ngo_cÚ‹xt
, 
	`gtk_g‘_deçuÉ_Ïnguage
 ());

120 
·ngo_cÚ‹xts
 = 
	`g_li¡_Ãxt
(pango_contexts);

121 
	}
}

123 
PªgoCÚ‹xt
 *

124 
	$dŸ_fÚt_g‘_cÚ‹xt
()

126 ià(
·ngo_cÚ‹xt
 =ğ
NULL
) {

132 #ifdeà
HAVE_FREETYPE


140 
	`dŸ_fÚt_push_cÚ‹xt
(
	`·ngo_á2_g‘_cÚ‹xt
(75,75));

142 ià(
	`gdk_di¥Ïy_g‘_deçuÉ
 ())

143 
	`dŸ_fÚt_push_cÚ‹xt
(
	`gdk_·ngo_cÚ‹xt_g‘
());

145 #ifdeà
GDK_WINDOWING_WIN32


146 
	`dŸ_fÚt_push_cÚ‹xt
(
	`·ngo_wš32_g‘_cÚ‹xt
 ());

148 
	`g_w¬nšg
 ("dia_font_get_context() :‚ot font context w/o display. Crashing soon.");

153  
·ngo_cÚ‹xt
;

154 
	}
}

157 
gšt


158 
	$dcm_to_pdu
(
»®
 
dcm
è{  dcm * 
glob®_zoom_çùÜ
 * 
PANGO_SCALE
; 
	}
}

160 
»®


161 
	$pdu_to_dcm
(
gšt
 
pdu
è{  (
»®
ídu / (
glob®_zoom_çùÜ
 * 
PANGO_SCALE
); 
	}
}

163 
dŸ_fÚt_şass_š™
(
DŸFÚtCÏss
* 
şass
);

164 
dŸ_fÚt_fš®ize
(
GObjeù
* 
objeù
);

165 
dŸ_fÚt_š™_š¡ªû
(
DŸFÚt
*);

167 
GTy³


168 
	$dŸ_fÚt_g‘_ty³
 ()

170 
GTy³
 
objeù_ty³
 = 0;

172 ià(!
objeù_ty³
) {

173 cÚ¡ 
GTy³Info
 
objeù_šfo
 =

175  (
DŸFÚtCÏss
),

176 (
GBa£In™Func
è
NULL
,

177 (
GBa£Fš®izeFunc
è
NULL
,

178 (
GCÏssIn™Func
è
dŸ_fÚt_şass_š™
,

179 
NULL
,

180 
NULL
,

181  (
DŸFÚt
),

183 (
GIn¡ªûIn™Func
)
dŸ_fÚt_š™_š¡ªû


185 
objeù_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
G_TYPE_OBJECT
,

187 &
objeù_šfo
, 0);

189  
objeù_ty³
;

190 
	}
}

191 
gpoš‹r
 
	g·»Á_şass
;

194 
	$dŸ_fÚt_şass_š™
(
DŸFÚtCÏss
* 
kÏss
)

196 
GObjeùCÏss
* 
objeù_şass
 = 
	`G_OBJECT_CLASS
(
kÏss
);

197 
·»Á_şass
 = 
	`g_ty³_şass_³ek_·»Á
(
kÏss
);

198 
objeù_şass
->
fš®ize
 = 
dŸ_fÚt_fš®ize
;

199 
	}
}

202 
	$dŸ_fÚt_š™_š¡ªû
(
DŸFÚt
* 
fÚt
)

205 
	}
}

208 
	$dŸ_pfd_£t_height
(
PªgoFÚtDesütiÚ
* 
pfd
, 
»®
 
height
)

211 
	`·ngo_fÚt_desütiÚ_£t_absŞu‹_size
(
pfd
, 
	`dcm_to_pdu
(
height
) * 0.8);

212 
	}
}

222 
	$_dŸ_fÚt_adju¡_size
 (
DŸFÚt
 *
fÚt
, 
»®
 
height
, 
gboŞ—n
 
»ÿlc_®wways
)

225 ià(
fÚt
->
height
 !ğheighˆ|| !fÚt->
m‘rics
 || 
»ÿlc_®wways
) {

226 
PªgoFÚt
 *
lßded
;

228 
	`dŸ_pfd_£t_height
 (
fÚt
->
pfd
, 
height
);

230 
lßded
 = 
fÚt
->loaded;

231 
fÚt
->
lßded
 = 
	`·ngo_cÚ‹xt_lßd_fÚt
(
	`dŸ_fÚt_g‘_cÚ‹xt
(), fÚt->
pfd
);

232 ià(
lßded
)

233 
	`g_objeù_uÄef
 (
lßded
);

234 ià(
fÚt
->
m‘rics
)

235 
	`·ngo_fÚt_m‘rics_uÄef
 (
fÚt
->
m‘rics
);

238 
fÚt
->
m‘rics
 = 
	`·ngo_fÚt_g‘_m‘rics
 (fÚt->
lßded
, 
NULL
);

239 
fÚt
->
height
 = height;

241 
	}
}

242 
DŸFÚt
*

243 
	$dŸ_fÚt_Ãw
(cÚ¡ *
çmy
, 
DŸFÚtStyË
 
¡yË
, 
»®
 
height
)

245 
DŸFÚt
* 
fÚt
 = 
	`dŸ_fÚt_Ãw_äom_¡yË
(
¡yË
, 
height
);

246 
gboŞ—n
 
chªged
;

248 
chªged
 = 
çmy
 !ğ
NULL
 && 
	`¡rcmp
 (
	`·ngo_fÚt_desütiÚ_g‘_çmy
(
fÚt
->
pfd
), family) != 0;

249 
	`·ngo_fÚt_desütiÚ_£t_çmy
(
fÚt
->
pfd
, 
çmy
);

251 ià(
chªged
)

252 
	`_dŸ_fÚt_adju¡_size
 (
fÚt
, fÚt->
height
, 
TRUE
);

254  
fÚt
;

255 
	}
}

258 
	$dŸ_pfd_£t_çmy
(
PªgoFÚtDesütiÚ
* 
pfd
, 
DŸFÚtFamy
 
çm
)

260 
çm
) {

261 
DIA_FONT_SANS
 :

262 
	`·ngo_fÚt_desütiÚ_£t_çmy
(
pfd
, "sans");

264 
DIA_FONT_SERIF
 :

265 
	`·ngo_fÚt_desütiÚ_£t_çmy
(
pfd
, "serif");

267 
DIA_FONT_MONOSPACE
 :

268 
	`·ngo_fÚt_desütiÚ_£t_çmy
(
pfd
, "monospace");

270 
DIA_FONT_SIMSUN
:

271 
	`·ngo_fÚt_desütiÚ_£t_çmy
(
pfd
, "SimSun");

275 
	`·ngo_fÚt_desütiÚ_£t_çmy
(
pfd
, "sans");

278 
	}
}

281 
	$dŸ_pfd_£t_weight
(
PªgoFÚtDesütiÚ
* 
pfd
, 
DŸFÚtWeight
 
fw
)

283 
fw
) {

284 
DIA_FONT_ULTRALIGHT
 :

285 
	`·ngo_fÚt_desütiÚ_£t_weight
(
pfd
, 
PANGO_WEIGHT_ULTRALIGHT
);

287 
DIA_FONT_LIGHT
 :

288 
	`·ngo_fÚt_desütiÚ_£t_weight
(
pfd
, 
PANGO_WEIGHT_LIGHT
);

290 
DIA_FONT_WEIGHT_NORMAL
 :

291 
	`·ngo_fÚt_desütiÚ_£t_weight
(
pfd
, 
PANGO_WEIGHT_NORMAL
);

293 
DIA_FONT_MEDIUM
 :

295 
	`·ngo_fÚt_desütiÚ_£t_weight
(
pfd
, 500);

297 
DIA_FONT_DEMIBOLD
 :

298 
	`·ngo_fÚt_desütiÚ_£t_weight
(
pfd
, 600);

300 
DIA_FONT_BOLD
 :

301 
	`·ngo_fÚt_desütiÚ_£t_weight
(
pfd
, 
PANGO_WEIGHT_BOLD
);

303 
DIA_FONT_ULTRABOLD
 :

304 
	`·ngo_fÚt_desütiÚ_£t_weight
(
pfd
, 
PANGO_WEIGHT_ULTRABOLD
);

306 
DIA_FONT_HEAVY
 :

307 
	`·ngo_fÚt_desütiÚ_£t_weight
(
pfd
, 
PANGO_WEIGHT_HEAVY
);

310 
	`g_as£¹_nÙ_»ached
();

312 
	}
}

315 
	$dŸ_pfd_£t_¦ªt
(
PªgoFÚtDesütiÚ
* 
pfd
, 
DŸFÚtSÏÁ
 
fo
)

317 
fo
) {

318 
DIA_FONT_NORMAL
 :

319 
	`·ngo_fÚt_desütiÚ_£t_¡yË
(
pfd
,
PANGO_STYLE_NORMAL
);

321 
DIA_FONT_OBLIQUE
 :

322 
	`·ngo_fÚt_desütiÚ_£t_¡yË
(
pfd
,
PANGO_STYLE_OBLIQUE
);

324 
DIA_FONT_ITALIC
 :

325 
	`·ngo_fÚt_desütiÚ_£t_¡yË
(
pfd
,
PANGO_STYLE_ITALIC
);

328 
	`g_as£¹_nÙ_»ached
();

330 
	}
}

332 
DŸFÚt
*

333 
	$dŸ_fÚt_Ãw_äom_¡yË
(
DŸFÚtStyË
 
¡yË
, 
»®
 
height
)

335 
DŸFÚt
* 
»tv®
;

340 
PªgoFÚtDesütiÚ
* 
pfd
 = 
	`·ngo_fÚt_desütiÚ_Ãw
();

341 
	`dŸ_pfd_£t_çmy
(
pfd
,
	`DIA_FONT_STYLE_GET_FAMILY
(
¡yË
));

342 
	`dŸ_pfd_£t_weight
(
pfd
,
	`DIA_FONT_STYLE_GET_WEIGHT
(
¡yË
));

343 
	`dŸ_pfd_£t_¦ªt
(
pfd
,
	`DIA_FONT_STYLE_GET_SLANT
(
¡yË
));

344 
	`dŸ_pfd_£t_height
(
pfd
,
height
);

346 
»tv®
 = 
	`DIA_FONT
(
	`g_objeù_Ãw
(
DIA_TYPE_FONT
, 
NULL
));

347 
»tv®
->
pfd
 =…fd;

348 
	`_dŸ_fÚt_adju¡_size
 (
»tv®
, 
height
, 
FALSE
);

349 
»tv®
->
Ëgacy_Çme
 = 
NULL
;

350  
»tv®
;

351 
	}
}

353 
DŸFÚt
* 
	$dŸ_fÚt_cİy
(cÚ¡ 
DŸFÚt
* 
fÚt
)

355 ià(!
fÚt
)

356  
NULL
;

357  
	`dŸ_fÚt_Ãw
(
	`dŸ_fÚt_g‘_çmy
(
fÚt
),

358 
	`dŸ_fÚt_g‘_¡yË
(
fÚt
),

359 
	`dŸ_fÚt_g‘_height
(
fÚt
));

360 
	}
}

363 
	$dŸ_fÚt_fš®ize
(
GObjeù
* 
objeù
)

365 
DŸFÚt
* 
fÚt
 = 
	`DIA_FONT
(
objeù
);

367 ià(
fÚt
->
pfd
)

368 
	`·ngo_fÚt_desütiÚ_ä“
(
fÚt
->
pfd
);

369 
fÚt
->
pfd
 = 
NULL
;

370 ià(
fÚt
->
m‘rics
)

371 
	`·ngo_fÚt_m‘rics_uÄef
(
fÚt
->
m‘rics
);

372 
fÚt
->
m‘rics
 = 
NULL
;

373 ià(
fÚt
->
lßded
)

374 
	`g_objeù_uÄef
(
fÚt
->
lßded
);

375 
fÚt
->
lßded
 = 
NULL
;

376 
	`G_OBJECT_CLASS
(
·»Á_şass
)->
	`fš®ize
(
objeù
);

377 
	}
}

379 
DŸFÚt
 *

380 
	$dŸ_fÚt_»f
(
DŸFÚt
* 
fÚt
)

382 
	`g_objeù_»f
(
	`G_OBJECT
(
fÚt
));

383  
fÚt
;

384 
	}
}

387 
	$dŸ_fÚt_uÄef
(
DŸFÚt
* 
fÚt
)

389 
	`g_objeù_uÄef
(
	`G_OBJECT
(
fÚt
));

390 
	}
}

392 
DŸFÚtStyË


393 
	$dŸ_fÚt_g‘_¡yË
(cÚ¡ 
DŸFÚt
* 
fÚt
)

395 
gušt
 
¡yË
;

397 
weight_m­
[] = {

398 
DIA_FONT_ULTRALIGHT
, 
DIA_FONT_LIGHT
,

399 
DIA_FONT_WEIGHT_NORMAL
,

400 
DIA_FONT_MEDIUM
, 
DIA_FONT_DEMIBOLD
,

401 
DIA_FONT_BOLD
, 
DIA_FONT_ULTRABOLD
, 
DIA_FONT_HEAVY


404 
PªgoStyË
 
·ngo_¡yË
 = 
	`·ngo_fÚt_desütiÚ_g‘_¡yË
(
fÚt
->
pfd
);

405 
PªgoWeight
 
·ngo_weight
 = 
	`·ngo_fÚt_desütiÚ_g‘_weight
(
fÚt
->
pfd
);

407 
	`g_as£¹
(
PANGO_WEIGHT_ULTRALIGHT
 <ğ
·ngo_weight
 &&…ªgo_weighˆ<ğ
PANGO_WEIGHT_HEAVY
);

408 
	`g_as£¹
(
PANGO_WEIGHT_ULTRALIGHT
 == 200);

409 
	`g_as£¹
(
PANGO_WEIGHT_NORMAL
 == 400);

410 
	`g_as£¹
(
PANGO_WEIGHT_BOLD
 == 700);

412 
¡yË
 = 
weight_m­
[(
·ngo_weight
 - 
PANGO_WEIGHT_ULTRALIGHT
) / 100];

413 
¡yË
 |ğ(
·ngo_¡yË
 << 2);

415  
¡yË
;

416 
	}
}

418 
G_CONST_RETURN
 *

419 
	$dŸ_fÚt_g‘_çmy
(cÚ¡ 
DŸFÚt
* 
fÚt
)

421  
	`·ngo_fÚt_desütiÚ_g‘_çmy
(
fÚt
->
pfd
);

422 
	}
}

424 
G_CONST_RETURN
 
PªgoFÚtDesütiÚ
 *

425 
	$dŸ_fÚt_g‘_desütiÚ
(cÚ¡ 
DŸFÚt
* 
fÚt
)

427  
fÚt
->
pfd
;

428 
	}
}

430 
»®


431 
	$dŸ_fÚt_g‘_height
(cÚ¡ 
DŸFÚt
* 
fÚt
)

433  
fÚt
->
height
;

434 
	}
}

436 
»®


437 
	$dŸ_fÚt_g‘_size
(cÚ¡ 
DŸFÚt
* 
fÚt
)

439 ià(!
	`·ngo_fÚt_desütiÚ_g‘_size_is_absŞu‹
 (
fÚt
->
pfd
))

440 
	`g_w¬nšg
 ("dia_font_get_size() :‚o‡bsolute size");

441  
	`pdu_to_dcm
(
	`·ngo_fÚt_desütiÚ_g‘_size
(
fÚt
->
pfd
));

442 
	}
}

445 
	$dŸ_fÚt_£t_height
(
DŸFÚt
* 
fÚt
, 
»®
 
height
)

447 
	`_dŸ_fÚt_adju¡_size
 (
fÚt
, 
height
, 
FALSE
);

448 
	}
}

451 
G_CONST_RETURN
 *

452 
	$dŸ_fÚt_g‘_psfÚŠame
(cÚ¡ 
DŸFÚt
 *
fÚt
)

457 cÚ¡ *
fÚŠame
 = 
	`dŸ_fÚt_g‘_Ëgacy_Çme
(
fÚt
);

459 ià(!
fÚŠame
)

460  
NULL
;

462 ià(
	`¡rcmp
(
fÚŠame
, "NewCenturySchoolbook-Roman") == 0)

464 ià(
	`¡rcmp
(
fÚŠame
, "NewCenturySchoolbook-Italic") == 0)

466 ià(
	`¡rcmp
(
fÚŠame
, "NewCenturySchoolbook-Bold") == 0)

468 ià(
	`¡rcmp
(
fÚŠame
, "NewCenturySchoolbook-BoldItalic") == 0)

471  
fÚŠame
;

472 
	}
}

475 
	$dŸ_fÚt_£t_ªy_çmy
(
DŸFÚt
* 
fÚt
, cÚ¡ * 
çmy
)

477 
gboŞ—n
 
chªged
;

479 
	`g_»tuº_if_ç
(
fÚt
 !ğ
NULL
);

481 
chªged
 = 
	`¡rcmp
 (
	`·ngo_fÚt_desütiÚ_g‘_çmy
(
fÚt
->
pfd
), 
çmy
) != 0;

482 
	`·ngo_fÚt_desütiÚ_£t_çmy
(
fÚt
->
pfd
, 
çmy
);

483 ià(
chªged
)

484 
	`_dŸ_fÚt_adju¡_size
 (
fÚt
, fÚt->
height
, 
TRUE
);

485 ià(
fÚt
->
Ëgacy_Çme
) {

486 
	`g_ä“
(
fÚt
->
Ëgacy_Çme
);

487 
fÚt
->
Ëgacy_Çme
 = 
NULL
;

489 
	}
}

492 
	$dŸ_fÚt_£t_çmy
(
DŸFÚt
* 
fÚt
, 
DŸFÚtFamy
 
çmy
)

494 
	`g_»tuº_if_ç
(
fÚt
 !ğ
NULL
);

496 
	`dŸ_pfd_£t_çmy
(
fÚt
->
pfd
,
çmy
);

497 ià(
fÚt
->
Ëgacy_Çme
) {

498 
	`g_ä“
(
fÚt
->
Ëgacy_Çme
);

499 
fÚt
->
Ëgacy_Çme
 = 
NULL
;

501 
	}
}

504 
	$dŸ_fÚt_£t_weight
(
DŸFÚt
* 
fÚt
, 
DŸFÚtWeight
 
weight
)

506 
DŸFÚtWeight
 
Şd_weight
 = 
	`DIA_FONT_STYLE_GET_WEIGHT
(
	`dŸ_fÚt_g‘_¡yË
(
fÚt
));

507 
	`g_»tuº_if_ç
(
fÚt
 !ğ
NULL
);

508 
	`dŸ_pfd_£t_weight
(
fÚt
->
pfd
,
weight
);

509 ià(
Şd_weight
 !ğ
weight
)

510 
	`_dŸ_fÚt_adju¡_size
 (
fÚt
, fÚt->
height
, 
TRUE
);

511 
	}
}

514 
	$dŸ_fÚt_£t_¦ªt
(
DŸFÚt
* 
fÚt
, 
DŸFÚtSÏÁ
 
¦ªt
)

516 
DŸFÚtSÏÁ
 
Şd_¦ªt
 = 
	`DIA_FONT_STYLE_GET_SLANT
(
	`dŸ_fÚt_g‘_¡yË
(
fÚt
));

517 
	`g_»tuº_if_ç
(
fÚt
 !ğ
NULL
);

518 
	`dŸ_pfd_£t_¦ªt
(
fÚt
->
pfd
,
¦ªt
);

519 ià(
¦ªt
 !ğ
Şd_¦ªt
)

520 
	`_dŸ_fÚt_adju¡_size
 (
fÚt
, fÚt->
height
, 
TRUE
);

521 
	}
}

524 
	s_WeightName
 {

525 
DŸFÚtWeight
 
	mfw
;

526 cÚ¡ *
	mÇme
;

527 } 
	tWeightName
;

528 cÚ¡ 
WeightName
 
	gweight_Çmes
[] = {

529 {
DIA_FONT_ULTRALIGHT
, "200"},

530 {
DIA_FONT_LIGHT
,"300"},

531 {
DIA_FONT_WEIGHT_NORMAL
,"normal"},

532 {
DIA_FONT_WEIGHT_NORMAL
,"400"},

533 {
DIA_FONT_MEDIUM
, "500"},

534 {
DIA_FONT_DEMIBOLD
, "600"},

535 {
DIA_FONT_BOLD
, "700"},

536 {
DIA_FONT_ULTRABOLD
, "800"},

537 {
DIA_FONT_HEAVY
, "900"},

538 {0,
NULL
}

541 
G_CONST_RETURN
 *

542 
	$dŸ_fÚt_g‘_weight_¡ršg
(cÚ¡ 
DŸFÚt
* 
fÚt
)

544 cÚ¡ 
WeightName
* 
p
;

545 
DŸFÚtWeight
 
fw
 = 
	`DIA_FONT_STYLE_GET_WEIGHT
(
	`dŸ_fÚt_g‘_¡yË
(
fÚt
));

547 
p
 = 
weight_Çmes
;…->
Çme
 !ğ
NULL
; ++p) {

548 ià(
p
->
fw
 =ğfwè…->
Çme
;

551 
	}
}

554 
	$dŸ_fÚt_£t_weight_äom_¡ršg
(
DŸFÚt
* 
fÚt
, cÚ¡ * 
weight
)

556 
DŸFÚtWeight
 
fw
 = 
DIA_FONT_WEIGHT_NORMAL
;

557 cÚ¡ 
WeightName
* 
p
;

559 
p
 = 
weight_Çmes
;…->
Çme
 !ğ
NULL
; ++p) {

560 ià(0 =ğ
	`¡ºcmp
(
weight
,
p
->
Çme
,8)) {

561 
fw
 = 
p
->fw;

566 
	`dŸ_fÚt_£t_weight
(
fÚt
,
fw
);

567 
	}
}

570 
	s_SÏÁName
 {

571 
DŸFÚtSÏÁ
 
	mfo
;

572 cÚ¡ *
	mÇme
;

573 } 
	tSÏÁName
;

574 cÚ¡ 
SÏÁName
 
	g¦ªt_Çmes
[] = {

575 { 
DIA_FONT_NORMAL
, "normal" },

576 { 
DIA_FONT_OBLIQUE
, "oblique" },

577 { 
DIA_FONT_ITALIC
, "italic" },

578 { 0, 
NULL
}

581 
G_CONST_RETURN
 *

582 
	$dŸ_fÚt_g‘_¦ªt_¡ršg
(cÚ¡ 
DŸFÚt
* 
fÚt
)

584 cÚ¡ 
SÏÁName
* 
p
;

585 
DŸFÚtSÏÁ
 
fo
 =

586 
	`DIA_FONT_STYLE_GET_SLANT
(
	`dŸ_fÚt_g‘_¡yË
(
fÚt
));

588 
p
 = 
¦ªt_Çmes
;…->
Çme
 !ğ
NULL
; ++p) {

589 ià(
p
->
fo
 == fo)

590  
p
->
Çme
;

593 
	}
}

596 
	$dŸ_fÚt_£t_¦ªt_äom_¡ršg
(
DŸFÚt
* 
fÚt
, cÚ¡ * 
obli
)

598 
DŸFÚtSÏÁ
 
fo
 = 
DIA_FONT_NORMAL
;

599 cÚ¡ 
SÏÁName
* 
p
;

601 
DŸFÚtStyË
 
Şd_¡yË
;

602 
DŸFÚtSÏÁ
 
Şd_fo
;

603 
Şd_¡yË
 = 
	`dŸ_fÚt_g‘_¡yË
(
fÚt
);

604 
Şd_fo
 = 
	`DIA_FONT_STYLE_GET_SLANT
(
Şd_¡yË
);

606 
p
 = 
¦ªt_Çmes
;…->
Çme
 !ğ
NULL
; ++p) {

607 ià(0 =ğ
	`¡ºcmp
(
obli
,
p
->
Çme
,8)) {

608 
fo
 = 
p
->fo;

612 
	`dŸ_fÚt_£t_¦ªt
(
fÚt
,
fo
);

613 
	}
}

620 
»®


621 
	$dŸ_fÚt_¡ršg_width
(cÚ¡ * 
¡ršg
, 
DŸFÚt
 *
fÚt
, 
»®
 
height
)

623 
»®
 
»suÉ
 = 0;

624 ià(
¡ršg
 && *string) {

625 
TextLše
 *
‹xt_lše
 = 
	`‹xt_lše_Ãw
(
¡ršg
, 
fÚt
, 
height
);

626 
»suÉ
 = 
	`‹xt_lše_g‘_width
(
‹xt_lše
);

627 
	`‹xt_lše_de¡roy
(
‹xt_lše
);

629  
»suÉ
;

630 
	}
}

632 
»®


633 
	$dŸ_fÚt_asûÁ
(cÚ¡ * 
¡ršg
, 
DŸFÚt
* 
fÚt
, 
»®
 
height
)

635 ià(
fÚt
->
m‘rics
) {

636 
»®
 
asûÁ
 = 
	`pdu_to_dcm
(
	`·ngo_fÚt_m‘rics_g‘_asûÁ
 (
fÚt
->
m‘rics
));

637  
asûÁ
 * (
height
 / 
fÚt
->height);

640 
TextLše
 *
‹xt_lše
 = 
	`‹xt_lše_Ãw
(
¡ršg
, 
fÚt
, 
height
);

641 
»®
 
»suÉ
 = 
	`‹xt_lše_g‘_asûÁ
(
‹xt_lše
);

642 
	`‹xt_lše_de¡roy
(
‹xt_lše
);

643  
»suÉ
;

645 
	}
}

647 
»®


648 
	$dŸ_fÚt_desûÁ
(cÚ¡ * 
¡ršg
, 
DŸFÚt
* 
fÚt
, 
»®
 
height
)

650 ià(
fÚt
->
m‘rics
) {

651 
»®
 
desûÁ
 = 
	`pdu_to_dcm
(
	`·ngo_fÚt_m‘rics_g‘_desûÁ
 (
fÚt
->
m‘rics
));

652  
desûÁ
 * (
height
 / 
fÚt
->height);

655 
TextLše
 *
‹xt_lše
 = 
	`‹xt_lše_Ãw
(
¡ršg
, 
fÚt
, 
height
);

656 
»®
 
»suÉ
 = 
	`‹xt_lše_g‘_desûÁ
(
‹xt_lše
);

657 
	`‹xt_lše_de¡roy
(
‹xt_lše
);

658  
»suÉ
;

660 
	}
}

663 
PªgoLayout
*

664 
	$dŸ_fÚt_bud_Ïyout
(cÚ¡ * 
¡ršg
, 
DŸFÚt
* 
fÚt
, 
»®
 
height
)

666 
PªgoLayout
* 
Ïyout
;

667 
PªgoA‰rLi¡
* 
li¡
;

668 
PªgoA‰ribu‹
* 
©Œ
;

669 
gušt
 
Ëngth
;

670 
PªgoFÚtDesütiÚ
 *
pfd
;

671 
»®
 
çùÜ
;

673 
Ïyout
 = 
	`·ngo_Ïyout_Ãw
(
	`dŸ_fÚt_g‘_cÚ‹xt
());

675 
Ëngth
 = 
¡ršg
 ? 
	`¡¾’
(string) : 0;

676 
	`·ngo_Ïyout_£t_‹xt
(
Ïyout
, 
¡ršg
, 
Ëngth
);

678 
li¡
 = 
	`·ngo_©Œ_li¡_Ãw
();

680 
pfd
 = 
	`·ngo_fÚt_desütiÚ_cİy
 (
fÚt
->pfd);

682 
çùÜ
 = 
	`dŸ_fÚt_g‘_size
(
fÚt
è/ 
	`dŸ_fÚt_g‘_height
 (font);

683 
	`·ngo_fÚt_desütiÚ_£t_absŞu‹_size
 (
pfd
, 
	`dcm_to_pdu
 (
height
è* 
çùÜ
);

684 
©Œ
 = 
	`·ngo_©Œ_fÚt_desc_Ãw
(
pfd
);

685 
	`·ngo_fÚt_desütiÚ_ä“
 (
pfd
);

687 
©Œ
->
¡¬t_šdex
 = 0;

688 
©Œ
->
’d_šdex
 = 
Ëngth
;

689 
	`·ngo_©Œ_li¡_š£¹
(
li¡
,
©Œ
);

691 
	`·ngo_Ïyout_£t_©Œibu‹s
(
Ïyout
,
li¡
);

692 
	`·ngo_©Œ_li¡_uÄef
(
li¡
);

694 
	`·ngo_Ïyout_£t_šd’t
(
Ïyout
,0);

695 
	`·ngo_Ïyout_£t_ju¡ify
(
Ïyout
,
FALSE
);

696 
	`·ngo_Ïyout_£t_®ignm’t
(
Ïyout
,
PANGO_ALIGN_LEFT
);

698  
Ïyout
;

699 
	}
}

709 
	$g‘_¡ršg_off£ts
(
PªgoLayoutI‹r
 *
™”
, 
»®
** 
off£ts
, * 
n_off£ts
)

711 
i
;

712 
PªgoLayoutLše
* 
lše
 = 
	`·ngo_Ïyout_™”_g‘_lše
(
™”
);

713 
PªgoGlyphI‹m
* 
™em
;

714 
PªgoGlyphSŒšg
* 
¡ršg
;

716 if(0 =ğ
lše
->
Ëngth
)

718 *
n_off£ts
 = 0;

721 
™em
 = (
PªgoGlyphI‹m
*)
lše
->
runs
->
d©a
;

722 
¡ršg
 = 
™em
->
glyphs
;

724 *
n_off£ts
 = 
¡ršg
->
num_glyphs
;

725 *
off£ts
 = 
	`g_Ãw
(
»®
, *
n_off£ts
);

727 
i
 = 0; i < 
¡ršg
->
num_glyphs
; i++) {

728 
PªgoGlyphGeom‘ry
 
geom
 = 
¡ršg
->
glyphs
[
i
].
geom‘ry
;

730 (*
off£ts
)[
i
] = 
	`pdu_to_dcm
(
geom
.
width
è/ 
glob®_zoom_çùÜ
;

732 
	}
}

737 
	$g‘_Ïyout_off£ts
(
PªgoLayoutLše
 *
lše
, PªgoLayoutLš**
Ïyout_lše
)

740 
GSLi¡
 *
Ïyout_runs
 = 
NULL
;

741 
GSLi¡
 *
runs
 = 
lše
->runs;

743 *
Ïyout_lše
 = 
	`g_Ãw0
(
PªgoLayoutLše
, 1);

751 ; 
runs
 !ğ
NULL
;„un ğ
	`g_¦i¡_Ãxt
(runs)) {

752 
PªgoGlyphI‹m
 *
run
 = (PªgoGlyphI‹m *è
runs
->
d©a
;

753 
PªgoGlyphI‹m
 *
Ïyout_run
 = 
	`g_Ãw0
(PangoGlyphItem, 1);

754 
j
;

756 
PªgoGlyphSŒšg
 *
glyph_¡ršg
 = 
run
->
glyphs
;

757 
PªgoGlyphSŒšg
 *
Ïyout_glyph_¡ršg
;

759 
Ïyout_run
->
glyphs
 = 
	`g_Ãw0
(
PªgoGlyphSŒšg
, 1);

760 
Ïyout_glyph_¡ršg
 = 
Ïyout_run
->
glyphs
;

762 
Ïyout_glyph_¡ršg
->
num_glyphs
 = 
glyph_¡ršg
->num_glyphs;

763 
Ïyout_glyph_¡ršg
->
glyphs
 =

764 
	`g_Ãw0
(
PªgoGlyphInfo
, 
glyph_¡ršg
->
num_glyphs
);

765 
j
 = 0; j < 
Ïyout_glyph_¡ršg
->
num_glyphs
; j++) {

766 
PªgoGlyphInfo
 *
šfo
 = &
glyph_¡ršg
->
glyphs
[
j
];

767 
PªgoGlyphInfo
 *
Ïyout_šfo
 = &
Ïyout_glyph_¡ršg
->
glyphs
[
j
];

768 
Ïyout_šfo
->
geom‘ry
.
width
 = 
šfo
->geometry.width;

769 
Ïyout_šfo
->
geom‘ry
.
x_off£t
 = 
šfo
->geometry.x_offset;

770 
Ïyout_šfo
->
geom‘ry
.
y_off£t
 = 
šfo
->geometry.y_offset;

772 
Ïyout_runs
 = 
	`g_¦i¡_­³nd
Öayout_runs, 
Ïyout_run
);

774 (*
Ïyout_lše
)->
runs
 = 
Ïyout_runs
;

775 
	}
}

781 
»®
*

782 
	$dŸ_fÚt_g‘_sizes
(cÚ¡ * 
¡ršg
, 
DŸFÚt
 *
fÚt
, 
»®
 
height
,

783 
»®
 *
width
,„—È*
asûÁ
,„—È*
desûÁ
, *
n_off£ts
,

784 
PªgoLayoutLše
 **
Ïyout_off£ts
)

786 
PªgoLayout
* 
Ïyout
;

787 
PªgoLayoutI‹r
* 
™”
;

788 
»®
 
tİ
, 
blše
, 
bÙtom
;

789 cÚ¡ 
gch¬
* 
nÚ_em±y_¡ršg
;

790 
PªgoReùªgË
 
šk_»ù
,
logiÿl_»ù
;

791 
»®
* 
off£ts
 = 
NULL
;

794 ià(
¡ršg
 =ğ
NULL
 || string[0] == '\0') {

795 
nÚ_em±y_¡ršg
 = "XjgM149";

797 
nÚ_em±y_¡ršg
 = 
¡ršg
;

799 
Ïyout
 = 
	`dŸ_fÚt_bud_Ïyout
(
nÚ_em±y_¡ršg
, 
fÚt
, 
height
 * 
glob®_zoom_çùÜ
);

802 
™”
 = 
	`·ngo_Ïyout_g‘_™”
(
Ïyout
);

804 
	`·ngo_Ïyout_™”_g‘_lše_ex‹Ás
(
™”
, &
šk_»ù
, &
logiÿl_»ù
);

806 
tİ
 = 
	`pdu_to_dcm
(
logiÿl_»ù
.
y
è/ 
glob®_zoom_çùÜ
;

807 
bÙtom
 = 
	`pdu_to_dcm
(
logiÿl_»ù
.
y
 +†ogiÿl_»ù.
height
è/ 
glob®_zoom_çùÜ
;

808 
blše
 = 
	`pdu_to_dcm
(
	`·ngo_Ïyout_™”_g‘_ba£lše
(
™”
)è/ 
glob®_zoom_çùÜ
;

810 
	`g‘_¡ršg_off£ts
(
™”
, &
off£ts
, 
n_off£ts
);

811 
	`g‘_Ïyout_off£ts
(
	`·ngo_Ïyout_g‘_lše
(
Ïyout
, 0), 
Ïyout_off£ts
);

815 
	`·ngo_Ïyout_™”_Ãxt_lše
 (
™”
)) {

816 
PªgoReùªgË
 
mÜe_šk_»ù
, 
mÜe_logiÿl_»ù
;

818 
	`·ngo_Ïyout_™”_g‘_lše_ex‹Ás
(
™”
, &
mÜe_šk_»ù
, &
mÜe_logiÿl_»ù
);

819 ià(
mÜe_logiÿl_»ù
.
width
 > 
logiÿl_»ù
.width)

820 
logiÿl_»ù
.
width
 = 
mÜe_logiÿl_»ù
.width;

822 ià(
mÜe_šk_»ù
.
width
 > 
šk_»ù
.width)

823 
šk_»ù
.
width
 = 
mÜe_šk_»ù
.width;

826 
	`·ngo_Ïyout_™”_ä“
(
™”
);

827 
	`g_objeù_uÄef
(
	`G_OBJECT
(
Ïyout
));

829 *
asûÁ
 = 
blše
-
tİ
;

830 *
desûÁ
 = 
bÙtom
-
blše
;

831 ià(
nÚ_em±y_¡ršg
 !ğ
¡ršg
) {

832 *
width
 = 0.0;

835 *
width
 = 
	`pdu_to_dcm
(
logiÿl_»ù
.width > 
šk_»ù
.width ?†ogiÿl_»ù.width : ink_»ù.widthè/ 
glob®_zoom_çùÜ
;

837  
off£ts
;

838 
	}
}

858 
	s_Ëgacy_fÚt
 {

859 
gch¬
* 
	mŞdÇme
;

860 
gch¬
* 
	mÃwÇme
;

861 
DŸFÚtStyË
 
	m¡yË
;

862 } 
	gËgacy_fÚts
[] = {

863 { "AvªtG¬de-Book", "AvªtG¬de", 
DIA_FONT_SERIF
 },

864 { "AvªtG¬de-BookOblique", "AvªtG¬de", 
DIA_FONT_SERIF
 | 
DIA_FONT_OBLIQUE
 },

865 { "AvªtG¬de-Demi", "AvªtG¬de", 
DIA_FONT_SERIF
 | 
DIA_FONT_DEMIBOLD
 },

866 { "AvªtG¬de-DemiOblique", "AvªtG¬de", 
DIA_FONT_SERIF
 | 
DIA_FONT_OBLIQUE
 | 
DIA_FONT_DEMIBOLD
 },

867 { "B©ªg", "B©ªg", 
DIA_FONT_FAMILY_ANY
 },

868 { "Bookmª-Demi", "Bookmª Old StyË", 
DIA_FONT_SERIF
 | 
DIA_FONT_DEMIBOLD
 },

869 { "Bookmª-DemiIlic", "Bookmª Old StyË", 
DIA_FONT_SERIF
 | 
DIA_FONT_DEMIBOLD
 | 
DIA_FONT_ITALIC
 },

870 { "Bookmª-Light", "Bookmª Old StyË", 
DIA_FONT_SERIF
 | 
DIA_FONT_LIGHT
 },

871 { "Bookmª-LightIlic", "Bookmª Old StyË", 
DIA_FONT_SERIF
 | 
DIA_FONT_LIGHT
 | 
DIA_FONT_ITALIC
 },

872 { "BousungEG-Light-GB", "BousungEG-Light-GB", 
DIA_FONT_FAMILY_ANY
 },

873 { "Cour›r", "mÚo¥aû", 
DIA_FONT_MONOSPACE
 },

874 { "Cour›r", "Cour›¸New", 
DIA_FONT_MONOSPACE
 },

875 { "Cour›r-BŞd", "mÚo¥aû", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_BOLD
 },

876 { "Cour›r-BŞd", "Cour›¸New", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_BOLD
 },

877 { "Cour›r-BŞdOblique", "mÚo¥aû", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
 | 
DIA_FONT_BOLD
 },

878 { "Cour›r-BŞdOblique", "Cour›¸New", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
 | 
DIA_FONT_BOLD
 },

879 { "Cour›r-Oblique", "mÚo¥aû", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
},

880 { "Cour›r-Oblique", "Cour›¸New", 
DIA_FONT_MONOSPACE
 | 
DIA_FONT_ITALIC
 },

881 { "DÙum", "DÙum", 
DIA_FONT_FAMILY_ANY
 },

882 { "GBZ’Kai-Medium", "GBZ’Kai-Medium", 
DIA_FONT_FAMILY_ANY
 },

883 { "GÙhicBBB-Medium", "GÙhicBBB-Medium", 
DIA_FONT_FAMILY_ANY
 },

884 { "Gulim", "Gulim", 
DIA_FONT_FAMILY_ANY
 },

885 { "H—dlše", "H—dlše", 
DIA_FONT_FAMILY_ANY
 },

886 { "H–v‘iÿ", "§ns", 
DIA_FONT_SANS
 },

887 { "H–v‘iÿ", "ArŸl", 
DIA_FONT_SANS
 },

888 { "H–v‘iÿ-BŞd", "§ns", 
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
 },

889 { "H–v‘iÿ-BŞd", "ArŸl", 
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
 },

890 { "H–v‘iÿ-BŞdOblique", "§ns", 
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
 | 
DIA_FONT_ITALIC
 },

891 { "H–v‘iÿ-BŞdOblique", "ArŸl", 
DIA_FONT_SANS
 | 
DIA_FONT_BOLD
 | 
DIA_FONT_ITALIC
 },

892 { "H–v‘iÿ-N¬row", "ArŸÈN¬row", 
DIA_FONT_SANS
 | 
DIA_FONT_MEDIUM
 },

893 { "H–v‘iÿ-N¬row-BŞd", "ArŸÈN¬row", 
DIA_FONT_SANS
 | 
DIA_FONT_DEMIBOLD
 },

894 { "H–v‘iÿ-N¬row-BŞdOblique", "ArŸÈN¬row", 
DIA_FONT_SANS
 | 
DIA_FONT_MEDIUM
 | 
DIA_FONT_OBLIQUE
 },

895 { "H–v‘iÿ-N¬row-Oblique", "ArŸÈN¬row", 
DIA_FONT_SANS
 | 
DIA_FONT_MEDIUM
 | 
DIA_FONT_OBLIQUE
 },

896 { "H–v‘iÿ-Oblique", "§ns", 
DIA_FONT_SANS
 | 
DIA_FONT_ITALIC
 },

897 { "H–v‘iÿ-Oblique", "ArŸl", 
DIA_FONT_SANS
 | 
DIA_FONT_ITALIC
 },

898 { "MOESung-Medium", "MOESung-Medium", 
DIA_FONT_FAMILY_ANY
 },

899 { "NewC’turySchoŞbook-BŞd", "C’tury SchoŞbook SWA", 
DIA_FONT_SERIF
 | 
DIA_FONT_BOLD
 },

900 { "NewC’turySchoŞbook-BŞdIlic", "C’tury SchoŞbook SWA", 
DIA_FONT_SERIF
 | 
DIA_FONT_BOLD
 | 
DIA_FONT_ITALIC
 },

901 { "NewC’turySchoŞbook-Ilic", "C’tury SchoŞbook SWA", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 },

902 { "NewC’turySchoŞbook-Romª", "C’tury SchoŞbook SWA", 
DIA_FONT_SERIF
 },

903 { "P®©šo-BŞd", "P®©šo", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_BOLD
 },

904 { "P®©šo-BŞdIlic", "P®©šo", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_BOLD
 | 
DIA_FONT_ITALIC
 },

905 { "P®©šo-Ilic", "P®©šo", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_ITALIC
 },

906 { "P®©šo-Romª", "P®©šo", 
DIA_FONT_FAMILY_ANY
 },

907 { "Ryumš-Light", "Ryumš", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_LIGHT
 },

908 { "ShªHeiSun-Light", "ShªHeiSun", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_LIGHT
 },

909 { "SÚg-Medium", "SÚg-Medium", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_MEDIUM
 },

910 { "SymbŞ", "SymbŞ", 
DIA_FONT_SANS
 | 
DIA_FONT_MEDIUM
 },

911 { "Times-BŞd", "£rif", 
DIA_FONT_SERIF
 | 
DIA_FONT_BOLD
 },

912 { "Times-BŞd", "Time New Romª", 
DIA_FONT_SERIF
 | 
DIA_FONT_BOLD
 },

913 { "Times-BŞdIlic", "£rif", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 | 
DIA_FONT_BOLD
 },

914 { "Times-BŞdIlic", "Time New Romª", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 | 
DIA_FONT_BOLD
 },

915 { "Times-Ilic", "£rif", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 },

916 { "Times-Ilic", "Time New Romª", 
DIA_FONT_SERIF
 | 
DIA_FONT_ITALIC
 },

917 { "Times-Romª", "£rif", 
DIA_FONT_SERIF
 },

918 { "Times-Romª", "Time New Romª", 
DIA_FONT_SERIF
 },

919 { "Z­fChªûry-MediumIlic", "Z­àC®lig¿phiø801 SWA", 
DIA_FONT_SERIF
 | 
DIA_FONT_MEDIUM
 },

920 { "Z­fDšgb©s", "Z­àC®lig¿phiø801 SWA", 
DIA_FONT_SERIF
 },

921 { "Z’Kai-Medium", "Z’Kai", 
DIA_FONT_FAMILY_ANY
 | 
DIA_FONT_MEDIUM
 },

929 
DŸFÚt
*

930 
	$dŸ_fÚt_Ãw_äom_Ëgacy_Çme
(cÚ¡ * 
Çme
)

933 
DŸFÚt
* 
»tv®
;

934 
_Ëgacy_fÚt
* 
found
 = 
NULL
;

935 
»®
 
height
 = 1.0;

936 
i
;

938 
i
 = 0; i < 
	`G_N_ELEMENTS
(
Ëgacy_fÚts
); i++) {

939 ià(!
	`¡rcmp
(
Çme
, 
Ëgacy_fÚts
[
i
].
ŞdÇme
)) {

940 
found
 = &
Ëgacy_fÚts
[
i
];

944 ià(
found
) {

945 
»tv®
 = 
	`dŸ_fÚt_Ãw
 (
found
->
ÃwÇme
, found->
¡yË
, 
height
);

946 
»tv®
->
Ëgacy_Çme
 = 
found
->
ŞdÇme
;

949 
»tv®
 = 
	`dŸ_fÚt_Ãw
 (
Çme
, 
DIA_FONT_WEIGHT_NORMAL
, 
height
);

950 
»tv®
->
Ëgacy_Çme
 = 
NULL
;

953  
»tv®
;

954 
	}
}

956 
G_CONST_RETURN
 *

957 
	$dŸ_fÚt_g‘_Ëgacy_Çme
(cÚ¡ 
DŸFÚt
 *
fÚt
)

959 cÚ¡ * 
m©ched_Çme
 = 
NULL
;

960 cÚ¡ * 
çmy
;

961 
DŸFÚtStyË
 
¡yË
;

962 
i
;

965 ià(
fÚt
->
Ëgacy_Çme
)

966  
fÚt
->
Ëgacy_Çme
;

968 
çmy
 = 
	`dŸ_fÚt_g‘_çmy
 (
fÚt
);

969 
¡yË
 = 
	`dŸ_fÚt_g‘_¡yË
 (
fÚt
);

970 
i
 = 0; i < 
	`G_N_ELEMENTS
(
Ëgacy_fÚts
); i++) {

971 ià(0 =ğ
	`g_ascii_¡rÿ£cmp
 (
Ëgacy_fÚts
[
i
].
ÃwÇme
, 
çmy
)) {

973 
DŸFÚtStyË
 
¡
 = 
Ëgacy_fÚts
[
i
].
¡yË
;

974 ià((
	`DIA_FONT_STYLE_GET_SLANT
(
¡yË
è| 
	`DIA_FONT_STYLE_GET_WEIGHT
(style))

975 =ğ(
	`DIA_FONT_STYLE_GET_SLANT
(
¡
è| 
	`DIA_FONT_STYLE_GET_WEIGHT
(st))) {

976  
Ëgacy_fÚts
[
i
].
ŞdÇme
;

977 } ià(0 =ğ(
	`DIA_FONT_STYLE_GET_SLANT
(
¡
è| 
	`DIA_FONT_STYLE_GET_WEIGHT
(st))) {

978 
m©ched_Çme
 = 
Ëgacy_fÚts
[
i
].
ŞdÇme
;

983  
m©ched_Çme
 ? matched_name : "Courier";

984 
	}
}

	@O:\tool\dvs50\lib\font.h

18 #iâdeà
FONT_H


19 
	#FONT_H


	)

21 
	~"dŸty³s.h
"

22 
	~<glib.h
>

23 
	~<glib-objeù.h
>

24 
	~<·ngo/·ngo.h
>

25 
	~"dŸ-’ums.h
"

26 
	~"geom‘ry.h
"

28 
	gG_BEGIN_DECLS


32 
	#BASIC_SANS_FONT
 "¬Ÿl, h–v‘iÿ, h–v, sªs"

	)

33 
	#BASIC_SERIF_FONT
 "time Ãw„omª,imes, s”if"

	)

34 
	#BASIC_MONOSPACE_FONT
 "cour›¸Ãw, cour›r, mÚo¥aû, fixed"

	)

54 
gušt
 
	tDŸFÚtStyË
;

58 
	mDIA_FONT_FAMILY_ANY
 = 0,

59 
	mDIA_FONT_SANS
 = 1,

60 
	mDIA_FONT_SERIF
 = 2,

61 
	mDIA_FONT_MONOSPACE
 = 3,

62 
	mDIA_FONT_SIMSUN
 = 4

63 } 
	tDŸFÚtFamy
;

67 
	mDIA_FONT_NORMAL
 = (0<<2),

68 
	mDIA_FONT_OBLIQUE
 = (1<<2),

69 
	mDIA_FONT_ITALIC
 = (2<<2)

70 } 
	tDŸFÚtSÏÁ
;

74 
	mDIA_FONT_ULTRALIGHT
 = (1<<4),

75 
	mDIA_FONT_LIGHT
 = (2<<4),

76 
	mDIA_FONT_WEIGHT_NORMAL
 = (0<<4),

77 
	mDIA_FONT_MEDIUM
 = (3<<4),

78 
	mDIA_FONT_DEMIBOLD
 = (4<<4),

79 
	mDIA_FONT_BOLD
 = (5<<4),

80 
	mDIA_FONT_ULTRABOLD
 = (6<<4),

81 
	mDIA_FONT_HEAVY
 = (7<<4)

82 } 
	tDŸFÚtWeight
;

85 
	#DIA_FONT_STYLE_GET_FAMILY
(
¡
è((¡è& (0x3))

	)

86 
	#DIA_FONT_STYLE_GET_SLANT
(
¡
è((¡è& (0x3<<2))

	)

87 
	#DIA_FONT_STYLE_GET_WEIGHT
(
¡
è((¡è& (0x7<<4))

	)

89 
GTy³
 
	$dŸ_fÚt_g‘_ty³
(è
G_GNUC_CONST
;

91 
	#DIA_TYPE_FONT
 (
	`dŸ_fÚt_g‘_ty³
())

	)

93 
	#DIA_FONT
(
objeù
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 ((object), \

94 
DIA_TYPE_FONT
, \

95 
DŸFÚt
))

	)

96 
	#DIA_FONT_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 ((klass), \

97 
DIA_TYPE_FONT
, \

98 
DŸFÚtCÏss
))

	)

100 
	s_DŸFÚtCÏss
 {

101 
GObjeùCÏss
 
·»Á_şass
;

106 
DIAVAR
 
	`dŸ_fÚt_š™
(
PªgoCÚ‹xt
* 
pcÚ‹xt
);

108 
DIAVAR
 
	`dŸ_fÚt_push_cÚ‹xt
(
PªgoCÚ‹xt
 *
pcÚ‹xt
);

110 
DIAVAR
 
	`dŸ_fÚt_pİ_cÚ‹xt
();

112 
DIAVAR
 
PªgoCÚ‹xt
 *
	`dŸ_fÚt_g‘_cÚ‹xt
();

116 
DIAVAR
 
DŸFÚt
* 
	`dŸ_fÚt_Ãw
(cÚ¡ *
çmy
, 
DŸFÚtStyË
 
¡yË
,

117 
»®
 
height
);

121 
DIAVAR
 
DŸFÚt
* 
	`dŸ_fÚt_Ãw_äom_¡yË
(
DŸFÚtStyË
 
¡yË
, 
»®
 
height
);

124 
DIAVAR
 
DŸFÚt
* 
	`dŸ_fÚt_Ãw_äom_Ëgacy_Çme
(cÚ¡ *
Çme
);

128 
DIAVAR
 
G_CONST_RETURN
 * 
	`dŸ_fÚt_g‘_Ëgacy_Çme
(cÚ¡ 
DŸFÚt
* 
fÚt
);

131 
DIAVAR
 
DŸFÚt
 *
	`dŸ_fÚt_cİy
(cÚ¡ DŸFÚt* 
fÚt
);

133 
	$__deş¥ec
(
dÎexpÜt
è
DŸFÚt
* 
	`dŸ_fÚt_»f
(DŸFÚt* 
fÚt
);

134 
	$__deş¥ec
(
dÎexpÜt
è
	`dŸ_fÚt_uÄef
(
DŸFÚt
* 
fÚt
);

137 
DIAVAR
 
DŸFÚtStyË
 
	`dŸ_fÚt_g‘_¡yË
(cÚ¡ 
DŸFÚt
* 
fÚt
);

140 
DIAVAR
 
G_CONST_RETURN
 * 
	`dŸ_fÚt_g‘_çmy
(cÚ¡ 
DŸFÚt
* 
fÚt
);

142 
DIAVAR
 
G_CONST_RETURN
 
PªgoFÚtDesütiÚ
 *
	`dŸ_fÚt_g‘_desütiÚ
 (cÚ¡ 
DŸFÚt
* 
fÚt
);

145 
DIAVAR
 
»®
 
	`dŸ_fÚt_g‘_height
(cÚ¡ 
DŸFÚt
* 
fÚt
);

147 
DIAVAR
 
	`dŸ_fÚt_£t_height
(
DŸFÚt
* 
fÚt
, 
»®
 
height
);

149 
DIAVAR
 
»®
 
	`dŸ_fÚt_g‘_size
(cÚ¡ 
DŸFÚt
* 
fÚt
);

152 
DIAVAR
 
	`dŸ_fÚt_£t_¦ªt
(
DŸFÚt
* 
fÚt
, 
DŸFÚtSÏÁ
 
¦ªt
);

154 
DIAVAR
 
	`dŸ_fÚt_£t_weight
(
DŸFÚt
* 
fÚt
, 
DŸFÚtWeight
 
weight
);

157 
	`dŸ_fÚt_£t_çmy
(
DŸFÚt
* 
fÚt
, 
DŸFÚtFamy
 
çmy
);

160 
DIAVAR
 
	`dŸ_fÚt_£t_ªy_çmy
(
DŸFÚt
* 
fÚt
, cÚ¡ * 
çmy
);

164 
DIAVAR
 
G_CONST_RETURN
 *
	`dŸ_fÚt_g‘_psfÚŠame
(cÚ¡ 
DŸFÚt
 *
fÚt
);

167 
DIAVAR
 
G_CONST_RETURN
 *
	`dŸ_fÚt_g‘_weight_¡ršg
(cÚ¡ 
DŸFÚt
* 
fÚt
);

170 
DIAVAR
 
G_CONST_RETURN
 *
	`dŸ_fÚt_g‘_¦ªt_¡ršg
(cÚ¡ 
DŸFÚt
* 
fÚt
);

173 
DIAVAR
 
	`dŸ_fÚt_£t_weight_äom_¡ršg
(
DŸFÚt
* 
fÚt
, cÚ¡ * 
weight
);

176 
DIAVAR
 
	`dŸ_fÚt_£t_¦ªt_äom_¡ršg
(
DŸFÚt
* 
fÚt
, cÚ¡ * 
¦ªt
);

182 
	$__deş¥ec
(
dÎexpÜt
è
»®
 
	`dŸ_fÚt_¡ršg_width
(cÚ¡ * 
¡ršg
, 
DŸFÚt
* 
fÚt
,

183 
»®
 
height
);

185 
DIAVAR
 
»®
 
	`dŸ_fÚt_asûÁ
(cÚ¡ * 
¡ršg
, 
DŸFÚt
* 
fÚt
,„—È
height
);

187 
DIAVAR
 
»®
 
	`dŸ_fÚt_desûÁ
(cÚ¡ * 
¡ršg
, 
DŸFÚt
* 
fÚt
,„—È
height
);

190 
DIAVAR
 
PªgoLayout
* 
	`dŸ_fÚt_bud_Ïyout
(cÚ¡ * 
¡ršg
, 
DŸFÚt
* 
fÚt
,

191 
»®
 
height
);

193 
DIAVAR
 
PªgoLayout
* 
	`dŸ_fÚt_bud_Ïyout_w™h_m©rix
(cÚ¡ * 
¡ršg
,

194 
DŸFÚt
* 
fÚt
,

195 
»®
 
height
,

196 
PªgoM©rix
 *
m©rix
);

198 
»®
* 
	`dŸ_fÚt_g‘_sizes
(cÚ¡ * 
¡ršg
, 
DŸFÚt
 *
fÚt
,„—È
height
,

199 
»®
* 
width
,„—l* 
asûÁ
,„—l* 
desûÁ
,

200 *
n_off£ts
, 
PªgoLayoutLše
 **
Ïyout_off£ts
);

205 
G_END_DECLS


	@O:\tool\dvs50\lib\geometry.c

23 
	~<cÚfig.h
>

25 
	~<glib.h
>

27 #undeà
G_INLINE_FUNC


28 
	#G_INLINE_FUNC
 
DIAVAR


	)

29 
	#G_CAN_INLINE
 1

	)

30 
	~"geom‘ry.h
"

32 
	~"objeù.h
"

33 
	~"un™s.h
"

36 
	$»ùªgË_uniÚ
(
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
)

38 
r1
->
tİ
 = 
	`MIN
Ğr1->tİ, 
r2
->top );

39 
r1
->
bÙtom
 = 
	`MAX
Ğr1->bÙtom, 
r2
->bottom );

40 
r1
->
Ëá
 = 
	`MIN
Ğr1->Ëá, 
r2
->left );

41 
r1
->
right
 = 
	`MAX
Ğr1->right, 
r2
->right );

42 
	}
}

45 
	$št_»ùªgË_uniÚ
(
IÁReùªgË
 *
r1
, cÚ¡ IÁReùªgË *
r2
)

47 
r1
->
tİ
 = 
	`MIN
Ğr1->tİ, 
r2
->top );

48 
r1
->
bÙtom
 = 
	`MAX
Ğr1->bÙtom, 
r2
->bottom );

49 
r1
->
Ëá
 = 
	`MIN
Ğr1->Ëá, 
r2
->left );

50 
r1
->
right
 = 
	`MAX
Ğr1->right, 
r2
->right );

51 
	}
}

54 
	$»ùªgË_š‹r£ùiÚ
(
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
)

56 
r1
->
tİ
 = 
	`MAX
Ğr1->tİ, 
r2
->top );

57 
r1
->
bÙtom
 = 
	`MIN
Ğr1->bÙtom, 
r2
->bottom );

58 
r1
->
Ëá
 = 
	`MAX
Ğr1->Ëá, 
r2
->left );

59 
r1
->
right
 = 
	`MIN
Ğr1->right, 
r2
->right );

62 iàĞ(
r1
->
tİ
 >ğr1->
bÙtom
) ||

63 (
r1
->
Ëá
 >ğr1->
right
) ) {

64 
r1
->
tİ
 =„1->
bÙtom
 =„1->
Ëá
 =„1->
right
 = 0.0;

66 
	}
}

69 
	$»ùªgË_š‹r£ùs
(cÚ¡ 
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
)

71 iàĞ(
r1
->
right
 < 
r2
->
Ëá
) ||

72 (
r1
->
Ëá
 > 
r2
->
right
) ||

73 (
r1
->
tİ
 > 
r2
->
bÙtom
) ||

74 (
r1
->
bÙtom
 < 
r2
->
tİ
) )

75  
FALSE
;

77  
TRUE
;

78 
	}
}

81 
	$pošt_š_»ùªgË
(cÚ¡ 
ReùªgË
* 
r
, cÚ¡ 
Pošt
 *
p
)

83 iàĞ(
p
->
x
 < 
r
->
Ëá
) ||

84 (
p
->
x
 > 
r
->
right
) ||

85 (
p
->
y
 > 
r
->
bÙtom
) ||

86 (
p
->
y
 < 
r
->
tİ
) )

87  
FALSE
;

89  
TRUE
;

90 
	}
}

93 
	$»ùªgË_š_»ùªgË
(cÚ¡ 
ReùªgË
* 
ou‹r
, cÚ¡ ReùªgË *
šÃr
)

95 iàĞ(
šÃr
->
Ëá
 < 
ou‹r
->left) ||

96 (
šÃr
->
right
 > 
ou‹r
->right) ||

97 (
šÃr
->
tİ
 < 
ou‹r
->top) ||

98 (
šÃr
->
bÙtom
 > 
ou‹r
->bottom))

99  
FALSE
;

101  
TRUE
;

102 
	}
}

105 
	$»ùªgË_add_pošt
(
ReùªgË
 *
r
, cÚ¡ 
Pošt
 *
p
)

107 ià(
p
->
x
 < 
r
->
Ëá
)

108 
r
->
Ëá
 = 
p
->
x
;

109 ià(
p
->
x
 > 
r
->
right
)

110 
r
->
right
 = 
p
->
x
;

112 ià(
p
->
y
 < 
r
->
tİ
)

113 
r
->
tİ
 = 
p
->
y
;

114 ià(
p
->
y
 > 
r
->
bÙtom
)

115 
r
->
bÙtom
 = 
p
->
y
;

116 
	}
}

125 
»®


126 
	$di¡ªû_»ùªgË_pošt
(cÚ¡ 
ReùªgË
 *
»ù
, cÚ¡ 
Pošt
 *
pošt
)

128 
»®
 
dx
 = 0.0;

129 
»®
 
dy
 = 0.0;

131 ià(
pošt
->
x
 < 
»ù
->
Ëá
 ) {

132 
dx
 = 
»ù
->
Ëá
 - 
pošt
->
x
;

133 } ià(
pošt
->
x
 > 
»ù
->
right
 ) {

134 
dx
 = 
pošt
->
x
 - 
»ù
->
right
;

137 ià(
pošt
->
y
 < 
»ù
->
tİ
 ) {

138 
dy
 = 
»ù
->
tİ
 - 
pošt
->
y
;

139 } ià(
pošt
->
y
 > 
»ù
->
bÙtom
 ) {

140 
dy
 = 
pošt
->
y
 - 
»ù
->
bÙtom
;

143  
dx
 + 
dy
;

144 
	}
}

155 
»®


156 
	$di¡ªû_lše_pošt
(cÚ¡ 
Pošt
 *
lše_¡¬t
, cÚ¡ Pošˆ*
lše_’d
,

157 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
)

159 
Pošt
 
v1
, 
v2
;

160 
»®
 
v1_Ënsq
;

161 
»®
 
´ojËn
;

162 
»®
 
³½_di¡
;

164 
v1
 = *
lše_’d
;

165 
	`pošt_sub
(&
v1
,
lše_¡¬t
);

167 
v2
 = *
pošt
;

168 
	`pošt_sub
(&
v2
, 
lše_¡¬t
);

170 
v1_Ënsq
 = 
	`pošt_dÙ
(&
v1
,&v1);

172 ià(
v1_Ënsq
<0.000001) {

173  
	`sq¹
(
	`pošt_dÙ
(&
v2
,&v2));

176 
´ojËn
 = 
	`pošt_dÙ
(&
v1
,&
v2
è/ 
v1_Ënsq
;

178 ià(
´ojËn
<0.0) {

179  
	`sq¹
(
	`pošt_dÙ
(&
v2
,&v2));

182 ià(
´ojËn
>1.0) {

183 
Pošt
 
v3
 = *
pošt
;

184 
	`pošt_sub
(&
v3
,
lše_’d
);

185  
	`sq¹
(
	`pošt_dÙ
(&
v3
,&v3));

188 
	`pošt_sÿË
(&
v1
, 
´ojËn
);

189 
	`pošt_sub
(&
v1
, &
v2
);

191 
³½_di¡
 = 
	`sq¹
(
	`pošt_dÙ
(&
v1
,&v1));

193 
³½_di¡
 -ğ
lše_width
 / 2.0;

194 ià(
³½_di¡
 < 0.0) {

195 
³½_di¡
 = 0.0;

198  
³½_di¡
;

199 
	}
}

203 
	$lše_üos£s_¿y
(cÚ¡ 
Pošt
 *
lše_¡¬t
,

204 cÚ¡ 
Pošt
 *
lše_’d
, cÚ¡ Pošˆ*
¿y’d
)

206 ià((
lše_¡¬t
->
y
 <ğ
¿y’d
->y && 
lše_’d
->y >„ayend->y) ||

207 (
lše_¡¬t
->
y
 > 
¿y’d
->y && 
lše_’d
->y <=„ayend->y)) {

208 
»®
 
vt
 = (
¿y’d
->
y
 - 
lše_¡¬t
->yè/ (
lše_’d
->y -†ine_start->y);

209 ià(
¿y’d
->
x
 < 
lše_¡¬t
->x + 
vt
 * (
lše_’d
->x -†ine_start->x))

213 
	}
}

215 
»®


216 
	$di¡ªû_pŞygÚ_pošt
(cÚ¡ 
Pošt
 *
pŞy
, 
gušt
 
Åošts
, 
»®
 
lše_width
,

217 cÚ¡ 
Pošt
 *
pošt
)

219 
gušt
 
i
, 
Ï¡
 = 
Åošts
 - 1;

220 
»®
 
lše_di¡
 = 
G_MAXFLOAT
;

221 
gušt
 
üossšgs
 = 0;

224 
i
 = 0; i < 
Åošts
; i++) {

225 
»®
 
di¡
;

227 
üossšgs
 +ğ
	`lše_üos£s_¿y
(&
pŞy
[
Ï¡
], &pŞy[
i
], 
pošt
);

228 
di¡
 = 
	`di¡ªû_lše_pošt
(&
pŞy
[
Ï¡
], &pŞy[
i
], 
lše_width
, 
pošt
);

229 
lše_di¡
 = 
	`MIN
Öše_di¡, 
di¡
);

230 
Ï¡
 = 
i
;

234 ià(
üossšgs
 % 2 == 1)

237  
lše_di¡
;

238 
	}
}

241 
	#NBEZ_SEGS
 10

	)

244 
»®


245 
	$bez_pošt_di¡ªû_ªd_¿y_üos£s
(cÚ¡ 
Pošt
 *
b1
,

246 cÚ¡ 
Pošt
 *
b2
, cÚ¡ Pošˆ*
b3
,

247 cÚ¡ 
Pošt
 *
b4
,

248 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
,

249 
gušt
 *
üoss
)

251 
gboŞ—n
 
ÿlcuÏ‹d_cÛff
 = 
FALSE
;

252 
»®
 
cÛff
[
NBEZ_SEGS
+1][4];

253 
i
;

254 
»®
 
lše_di¡
 = 
G_MAXFLOAT
;

255 
Pošt
 
´ev
, 
±
;

257 ià(!
ÿlcuÏ‹d_cÛff
) {

258 
i
 = 0; i <ğ
NBEZ_SEGS
; i++) {

259 
»®
 
t1
 = (Ô—l)
i
)/
NBEZ_SEGS
, 
t2
 =1*t1, 
t3
 =1*t2;

260 
»®
 
™1
 = 1-
t1
, 
™2
 = it1*™1, 
™3
 = it1*it2;

262 
cÛff
[
i
][0] = 
™3
;

263 
cÛff
[
i
][1] = 3 * 
t1
 * 
™2
;

264 
cÛff
[
i
][2] = 3 * 
t2
 * 
™1
;

265 
cÛff
[
i
][3] = 
t3
;

268 
ÿlcuÏ‹d_cÛff
 = 
TRUE
;

270 
´ev
.
x
 = 
cÛff
[0][0] * 
b1
->x + cÛff[0][1] * 
b2
->x +

271 
cÛff
[0][2] * 
b3
->
x
 + cÛff[0][3] * 
b4
->x;

272 
´ev
.
y
 = 
cÛff
[0][0] * 
b1
->y + cÛff[0][1] * 
b2
->y +

273 
cÛff
[0][2] * 
b3
->
y
 + cÛff[0][3] * 
b4
->y;

274 
i
 = 1; i <ğ
NBEZ_SEGS
; i++) {

275 
»®
 
di¡
;

277 
±
.
x
 = 
cÛff
[
i
][0] * 
b1
->x + cÛff[i][1] * 
b2
->x +

278 
cÛff
[
i
][2] * 
b3
->
x
 + cÛff[i][3] * 
b4
->x;

279 
±
.
y
 = 
cÛff
[
i
][0] * 
b1
->y + cÛff[i][1] * 
b2
->y +

280 
cÛff
[
i
][2] * 
b3
->
y
 + cÛff[i][3] * 
b4
->y;

282 
di¡
 = 
	`di¡ªû_lše_pošt
(&
´ev
, &
±
, 
lše_width
, 
pošt
);

283 
lše_di¡
 = 
	`MIN
Öše_di¡, 
di¡
);

284 ià(
üoss
)

285 *
üoss
 +ğ
	`lše_üos£s_¿y
(&
´ev
, &
±
, 
pošt
);

287 
´ev
 = 
±
;

289  
lše_di¡
;

290 
	}
}

292 
»®


293 
	$di¡ªû_bez_£g_pošt
(cÚ¡ 
Pošt
 *
b1
, cÚ¡ Pošˆ*
b2
,

294 cÚ¡ 
Pošt
 *
b3
, cÚ¡ Pošˆ*
b4
,

295 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
)

297  
	`bez_pošt_di¡ªû_ªd_¿y_üos£s
(
b1
, 
b2
, 
b3
, 
b4
,

298 
lše_width
, 
pošt
, 
NULL
);

299 
	}
}

301 
»®


302 
	$di¡ªû_bez_lše_pošt
(cÚ¡ 
BezPošt
 *
b
, 
gušt
 
Åošts
,

303 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
)

305 
Pošt
 
Ï¡
;

306 
gušt
 
i
;

307 
»®
 
lše_di¡
 = 
G_MAXFLOAT
;

309 
	`g_»tuº_v®_if_ç
(
b
[0].
ty³
 =ğ
BEZ_MOVE_TO
, -1);

311 
Ï¡
 = 
b
[0].
p1
;

313 
i
 = 1; i < 
Åošts
; i++) {

314 
»®
 
di¡
;

316 
b
[
i
].
ty³
) {

317 
BEZ_MOVE_TO
:

319 
	`g_w¬nšg
("BEZ_MOVE_TO found half wayhrough‡ bezier†ine");

321 
BEZ_LINE_TO
:

322 
di¡
 = 
	`di¡ªû_lše_pošt
(&
Ï¡
, &
b
[
i
].
p1
, 
lše_width
, 
pošt
);

323 
lše_di¡
 = 
	`MIN
Öše_di¡, 
di¡
);

324 
Ï¡
 = 
b
[
i
].
p1
;

326 
BEZ_CURVE_TO
:

327 
di¡
 = 
	`bez_pošt_di¡ªû_ªd_¿y_üos£s
(&
Ï¡
, &
b
[
i
].
p1
, &b[i].
p2
,

328 &
b
[
i
].
p3
, 
lše_width
, 
pošt
,

329 
NULL
);

330 
lše_di¡
 = 
	`MIN
Öše_di¡, 
di¡
);

331 
Ï¡
 = 
b
[
i
].
p3
;

335  
lše_di¡
;

336 
	}
}

338 
»®


339 
	$di¡ªû_bez_sh­e_pošt
(cÚ¡ 
BezPošt
 *
b
, 
gušt
 
Åošts
,

340 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
)

342 
Pošt
 
Ï¡
;

343 
gušt
 
i
;

344 
»®
 
lše_di¡
 = 
G_MAXFLOAT
;

345 
gušt
 
üossšgs
 = 0;

347 
	`g_»tuº_v®_if_ç
(
b
[0].
ty³
 =ğ
BEZ_MOVE_TO
, -1);

349 
Ï¡
 = 
b
[0].
p1
;

351 
i
 = 1; i < 
Åošts
; i++) {

352 
»®
 
di¡
;

354 
b
[
i
].
ty³
) {

355 
BEZ_MOVE_TO
:

357 
	`g_w¬nšg
("BEZ_MOVE_TO found half wayhrough‡ bezier shape");

359 
BEZ_LINE_TO
:

360 
di¡
 = 
	`di¡ªû_lše_pošt
(&
Ï¡
, &
b
[
i
].
p1
, 
lše_width
, 
pošt
);

361 
üossšgs
 +ğ
	`lše_üos£s_¿y
(&
Ï¡
, &
b
[
i
].
p1
, 
pošt
);

362 
lše_di¡
 = 
	`MIN
Öše_di¡, 
di¡
);

363 
Ï¡
 = 
b
[
i
].
p1
;

365 
BEZ_CURVE_TO
:

366 
di¡
 = 
	`bez_pošt_di¡ªû_ªd_¿y_üos£s
(&
Ï¡
, &
b
[
i
].
p1
, &b[i].
p2
,

367 &
b
[
i
].
p3
, 
lše_width
, 
pošt
,

368 &
üossšgs
);

369 
lše_di¡
 = 
	`MIN
Öše_di¡, 
di¡
);

370 
Ï¡
 = 
b
[
i
].
p3
;

376 ià(
üossšgs
 % 2 == 1)

379  
lše_di¡
;

380 
	}
}

382 
»®


383 
	$di¡ªû_–l£_pošt
(cÚ¡ 
Pošt
 *
ûÁ»
, 
»®
 
width
,„—È
height
,

384 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
)

390 
»®
 
w2
 = 
width
*width, 
h2
 = 
height
*height;

391 
»®
 
sÿË
, 
¿d
, 
di¡
;

392 
Pošt
 
±
;

400 
±
 = *
pošt
;

401 
	`pošt_sub
(&
±
, 
ûÁ»
);

402 
±
.
x
 *=…t.x;

403 
±
.
y
 *=…t.y;

405 
sÿË
 = 
w2
 * 
h2
 / (4*h2*
±
.
x
 + 4*w2*±.
y
);

406 
¿d
 = 
	`sq¹
((
±
.
x
 +…t.
y
)*
sÿË
è+ 
lše_width
/2;

408 
di¡
 = 
	`sq¹
(
±
.
x
 +…t.
y
);

410 ià(
di¡
 <ğ
¿d
)

413  
di¡
 - 
¿d
;

414 
	}
}

418 
	$ŒªsfÜm_pošt
 (
M©rix
 
m
, 
Pošt
 *
¤c
, Pošˆ*
de¡
)

420 
»®
 
xx
, 
yy
, 
ww
;

422 
xx
 = 
m
[0][0] * 
¤c
->
x
 + m[0][1] * src->
y
 + m[0][2];

423 
yy
 = 
m
[1][0] * 
¤c
->
x
 + m[1][1] * src->
y
 + m[1][2];

424 
ww
 = 
m
[2][0] * 
¤c
->
x
 + m[2][1] * src->
y
 + m[2][2];

426 ià(!
ww
)

427 
ww
 = 1.0;

429 
de¡
->
x
 = 
xx
 / 
ww
;

430 
de¡
->
y
 = 
yy
 / 
ww
;

431 
	}
}

434 
	$muÉ_m©rix
 (
M©rix
 
m1
, M©rix 
m2
)

436 
M©rix
 
»suÉ
;

437 
i
, 
j
, 
k
;

439 
i
 = 0; i < 3; i++)

440 
j
 = 0; j < 3; j++)

442 
»suÉ
 [
i
][
j
] = 0.0;

443 
k
 = 0; k < 3; k++)

444 
»suÉ
 [
i
][
j
] +ğ
m1
 [i][
k
] * 
m2
[k][j];

448 
i
 = 0; i < 3; i++)

449 
j
 = 0; j < 3; j++)

450 
m2
 [
i
][
j
] = 
»suÉ
 [i][j];

451 
	}
}

454 
	$id’t™y_m©rix
 (
M©rix
 
m
)

456 
i
, 
j
;

458 
i
 = 0; i < 3; i++)

459 
j
 = 0; j < 3; j++)

460 
m
[
i
][
j
] = (i == j) ? 1 : 0;

462 
	}
}

465 
	$Œª¦©e_m©rix
 (
M©rix
 
m
, 
»®
 
x
,„—È
y
)

467 
M©rix
 
Œªs
;

469 
	`id’t™y_m©rix
 (
Œªs
);

470 
Œªs
[0][2] = 
x
;

471 
Œªs
[1][2] = 
y
;

472 
	`muÉ_m©rix
 (
Œªs
, 
m
);

473 
	}
}

476 
	$sÿË_m©rix
 (
M©rix
 
m
, 
»®
 
x
,„—È
y
)

478 
M©rix
 
sÿË
;

480 
	`id’t™y_m©rix
 (
sÿË
);

481 
sÿË
[0][0] = 
x
;

482 
sÿË
[1][1] = 
y
;

483 
	`muÉ_m©rix
 (
sÿË
, 
m
);

484 
	}
}

487 
	$rÙ©e_m©rix
 (
M©rix
 
m
, 
»®
 
th‘a
)

489 
M©rix
 
rÙ©e
;

490 
»®
 
cos_th‘a
, 
sš_th‘a
;

492 
cos_th‘a
 = 
	`cos
 (
th‘a
);

493 
sš_th‘a
 = 
	`sš
 (
th‘a
);

495 
	`id’t™y_m©rix
 (
rÙ©e
);

496 
rÙ©e
[0][0] = 
cos_th‘a
;

497 
rÙ©e
[0][1] = -
sš_th‘a
;

498 
rÙ©e
[1][0] = 
sš_th‘a
;

499 
rÙ©e
[1][1] = 
cos_th‘a
;

500 
	`muÉ_m©rix
 (
rÙ©e
, 
m
);

501 
	}
}

504 
	$xsh—r_m©rix
 (
M©rix
 
m
, 
»®
 
sh—r
)

506 
M©rix
 
sh—r_m
;

508 
	`id’t™y_m©rix
 (
sh—r_m
);

509 
sh—r_m
[0][1] = 
sh—r
;

510 
	`muÉ_m©rix
 (
sh—r_m
, 
m
);

511 
	}
}

514 
	$ysh—r_m©rix
 (
M©rix
 
m
, 
»®
 
sh—r
)

516 
M©rix
 
sh—r_m
;

518 
	`id’t™y_m©rix
 (
sh—r_m
);

519 
sh—r_m
[1][0] = 
sh—r
;

520 
	`muÉ_m©rix
 (
sh—r_m
, 
m
);

521 
	}
}

524 
»®


525 
	$d‘”mš©e
 (
M©rix
 
m
)

527 
i
;

528 
d‘
 = 0;

530 
i
 = 0; i < 3; i ++)

532 
d‘
 +ğ
m
[0][
i
] * m[1][(i+1)%3] * m[2][(i+2)%3];

533 
d‘
 -ğ
m
[2][
i
] * m[1][(i+1)%3] * m[0][(i+2)%3];

536  
d‘
;

537 
	}
}

542 
	$pošt_cÚvex
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c1
, cÚ¡ Pošˆ*
¤c2
, 
»®
 
®pha
)

547 
	`pošt_cİy
(
d¡
,
¤c1
);

548 
	`pošt_sÿË
(
d¡
,
®pha
);

549 
	`pošt_add_sÿËd
(
d¡
,
¤c2
,1.0 - 
®pha
);

550 
	}
}

560 
»®
 
	$dÙ2
(
Pošt
 *
p1
, Pošˆ*
p2
)

562 
»®
 
d
, 
t
;

563 
d
 = 
	`sq¹
(((
p1
->
x
*p1->x)+Õ1->
y
*p1->y)) *

564 ((
p2
->
x
*p2->x)+Õ2->
y
*p2->y)));

565 iàĞ
d
 != 0.0 )

567 
t
 = (
p1
->
x
*
p2
->x+p1->
y
*p2->y)/
d
;

568  (
	`acos
(
t
));

574 
	}
}

577 
	$lše_cÛf
(
»®
 *
a
,„—È*
b
,„—È*
c
, 
Pošt
 *
p1
, Pošˆ*
p2
)

579 *
c
 = ( 
p2
->
x
 * 
p1
->
y
 ) - (…1->x *…2->y );

580 *
a
 = 
p2
->
y
 - 
p1
->y;

581 *
b
 = 
p1
->
x
 - 
p2
->x;

582 
	}
}

586 
»®
 
	$lše_to_pošt
(
»®
 
a
,„—È
b
 ,„—È
c
, 
Pošt
 *
p
) {

587 
»®
 
d
, 
Í
;

588 
d
 = 
	`sq¹
((
a
*a)+(
b
*b));

589 iàĞ
d
 == 0.0 ) {

590 
Í
 = 0.0;

592 
Í
 = (
a
*
p
->
x
+
b
*p->
y
+
c
)/
d
;

594  (
Í
);

595 
	}
}

599 
	$pošt_³½
(
Pošt
 *
p
, 
»®
 
a
,„—È
b
,„—È
c
, Pošˆ*
³½
) {

600 
»®
 
d
, 
ı
;

601 
³½
->
x
 = 0.0;

602 
³½
->
y
 = 0.0;

603 
d
 = 
a
*¨+ 
b
*b;

604 
ı
 = 
a
*
p
->
y
-
b
*p->
x
;

605 iàĞ
d
 != 0.0 ) {

606 
³½
->
x
 = (-
a
*
c
-
b
*
ı
)/
d
;

607 
³½
->
y
 = (
a
*
ı
-
b
*
c
)/
d
;

610 
	}
}

618 
	$fËt
(
Pošt
 *
p1
, Pošˆ*
p2
, Pošˆ*
p3
, Pošˆ*
p4
,

619 
»®
 
r
, 
Pošt
 *
c
,„—È*
·
,„—È*
¯
) {

620 
»®
 
a1
, 
b1
, 
c1
;

621 
»®
 
a2
, 
b2
, 
c2
;

622 
»®
 
d
, 
d1
, 
d2
;

623 
»®
 
c1p
, 
c2p
;

624 
»®
 
¼
;

625 
»®
 
¡¬t_ªgË
, 
¡İ_ªgË
;

626 
Pošt
 
mp
,
gv1
,
gv2
;

627 
gboŞ—n
 
righthªd
 = 
FALSE
;

629 
	`lše_cÛf
(&
a1
,&
b1
,&
c1
,
p1
,
p2
);

630 
	`lše_cÛf
(&
a2
,&
b2
,&
c2
,
p3
,
p4
);

632 iàĞ(
a1
*
b2
è=ğ(
a2
*
b1
) )

637 
mp
.
x
 = (
p3
->x + 
p4
->x) / 2.0;

638 
mp
.
y
 = (
p3
->y + 
p4
->y) / 2.0;

639 
d1
 = 
	`lše_to_pošt
(
a1
, 
b1
, 
c1
, &
mp
);

641 iàĞ
d1
 == 0.0 ) ;

643 
mp
.
x
 = (
p1
->x + 
p2
->x) / 2.0;

644 
mp
.
y
 = (
p1
->y + 
p2
->y) / 2.0;

645 
d2
 = 
	`lše_to_pošt
(
a2
, 
b2
, 
c2
, &
mp
);

647 iàĞ
d2
 == 0.0 ) ;

649 
¼
 = 
r
;

650 iàĞ
d1
 <ğ0.0 ) 
¼
 = -rr;

652 
c1p
 = 
c1
-
¼
*
	`sq¹
((
a1
*a1)+(
b1
*b1));

653 
¼
 = 
r
;

655 iàĞ
d2
 <ğ0.0 ) 
¼
 = -rr;

656 
c2p
 = 
c2
-
¼
*
	`sq¹
((
a2
*a2)+(
b2
*b2));

657 
d
 = 
a1
*
b2
-
a2
*
b1
;

659 
c
->
x
 = ( 
c2p
*
b1
-
c1p
*
b2
 ) / 
d
;

660 
c
->
y
 = ( 
c1p
*
a2
-
c2p
*
a1
 ) / 
d
;

662 
	`pošt_³½
(
c
,
a1
,
b1
,
c1
,
p2
);

663 
	`pošt_³½
(
c
,
a2
,
b2
,
c2
,
p3
);

666 
gv1
.
x
 = 
p2
->x-
c
->x; gv1.
y
 = -(p2->y-c->y);

667 
gv2
.
x
 = 
p3
->x-
c
->x; gv2.
y
 = -(p3->y-c->y);

669 
¡¬t_ªgË
 = 
	`©ª2
(
gv1
.
y
,gv1.
x
);

670 
¡İ_ªgË
 = 
	`dÙ2
(&
gv1
,&
gv2
);

671 iàĞ
	`pošt_üoss
(&
gv1
,&
gv2
) < 0.0 ) {

672 
¡İ_ªgË
 = -stop_angle;

674 
righthªd
 = 
TRUE
;

678 
¡¬t_ªgË
 = s¹_ªgË*180.0/
G_PI
;

679 
¡İ_ªgË
 = 
¡¬t_ªgË
 + stİ_ªgË*180.0/
G_PI
;

680 
¡¬t_ªgË
 < 0.0) start_angle += 360.0;

681 
¡İ_ªgË
 < 0.0) stop_angle += 360.0;

683 iàĞ
righthªd
 ) {

684 
»®
 
tmp
 = 
¡¬t_ªgË
;

685 
¡¬t_ªgË
 = 
¡İ_ªgË
;

686 
¡İ_ªgË
 = 
tmp
;

688 *
·
 = 
¡¬t_ªgË
;

689 *
¯
 = 
¡İ_ªgË
;

690 
	}
}

693 
	$th»e_pošt_cœşe
 (cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
, cÚ¡ Pošˆ*
p3
,

694 
Pošt
* 
ûÁ”
, 
»®
* 
¿dius
)

696 cÚ¡ 
»®
 
•sÚ
 = 1e-4;

697 
»®
 
x1
 = 
p1
->
x
;

698 
»®
 
y1
 = 
p1
->
y
;

699 
»®
 
x2
 = 
p2
->
x
;

700 
»®
 
y2
 = 
p2
->
y
;

701 
»®
 
x3
 = 
p3
->
x
;

702 
»®
 
y3
 = 
p3
->
y
;

703 
»®
 
ma
, 
mb
;

704 ià(
	`çbs
(
x2
 - 
x1
è< 
•sÚ
)

706 ià(
	`çbs
(
x3
 - 
x2
è< 
•sÚ
)

708 
ma
 = (
y2
 - 
y1
è/ (
x2
 - 
x1
);

709 
mb
 = (
y3
 - 
y2
è/ (
x3
 - 
x2
);

710 ià(
	`çbs
 (
mb
 - 
ma
è< 
•sÚ
)

712 
ûÁ”
->
x
 = (
ma
*
mb
*(
y1
-
y3
)+mb*(
x1
+
x2
)-ma*(x2+
x3
))/(2*(mb-ma));

713 ià(
	`çbs
(
ma
)>
•sÚ
)

714 
ûÁ”
->
y
 = -1/
ma
*(ûÁ”->
x
 - (
x1
+
x2
)/2.0è+ (
y1
+
y2
)/2.0;

715 ià(
	`çbs
(
mb
)>
•sÚ
)

716 
ûÁ”
->
y
 = -1/
mb
*(ûÁ”->
x
 - (
x2
+
x3
)/2.0è+ (
y2
+
y3
)/2.0;

719 *
¿dius
 = 
	`di¡ªû_pošt_pošt
(
ûÁ”
, 
p1
);

721 
	}
}

725 
»®


726 
	$pošt_üoss
(
Pošt
 *
p1
, Pošˆ*
p2
)

728  
p1
->
x
 * 
p2
->
y
 -…2->x *…1->y;

729 
	}
}

734 
Pošt


735 
	$ÿlcuÏ‹_objeù_edge
(
Pošt
 *
objmid
, Pošˆ*
’d
, 
DŸObjeù
 *
obj
)

737 
	#MAXITER
 25

	)

738 #ifdeà
TRACE_DIST


739 
Pošt
 
Œaû
[
MAXITER
];

740 
»®
 
di¡Œaû
[
MAXITER
];

742 
Pošt
 
mid1
, 
mid2
, 
mid3
;

743 
»®
 
di¡
;

744 
i
 = 0;

746 
mid1
 = *
objmid
;

747 
mid2
.
x
 = (
objmid
->x+
’d
->x)/2;

748 
mid2
.
y
 = (
objmid
->y+
’d
->y)/2;

749 
mid3
 = *
’d
;

752 
di¡
 = 
obj
->
İs
->
	`di¡ªû_äom
(obj, &
mid3
);

753 ià(
di¡
 < 0.001è 
mid1
;

757 
di¡
 = 
obj
->
İs
->
	`di¡ªû_äom
(obj, &
mid2
);

758 ià(
di¡
 < 0.0000001) {

759 
mid1
 = 
mid2
;

761 
mid3
 = 
mid2
;

763 
mid2
.
x
 = (
mid1
.x + 
mid3
.x)/2;

764 
mid2
.
y
 = (
mid1
.y + 
mid3
.y)/2;

765 #ifdeà
TRACE_DIST


766 
Œaû
[
i
] = 
mid2
;

767 
di¡Œaû
[
i
] = 
di¡
;

769 
i
++;

770 } 
i
 < 
MAXITER
 && (
di¡
 < 0.0000001 || dist > 0.001));

772 #ifdeà
TRACE_DIST


773 ià(
i
 =ğ
MAXITER
) {

774 
i
 = 0; i < 
MAXITER
; i++) {

775 
	`´štf
("%d: %f, %f: %f\n", 
i
, 
Œaû
[i].
x
,¿û[i].
y
, 
di¡Œaû
[i]);

777 
	`´štf
("˜ğ%d, di¡ = %f\n", 
i
, 
di¡
);

781  
mid2
;

782 
	}
}

	@O:\tool\dvs50\lib\geometry.h

20 #iâdeà
GEOMETRY_H


21 
	#GEOMETRY_H


	)

23 #ifdeà
HAVE_CONFIG_H


24 
	~<cÚfig.h
>

27 
	~"dŸty³s.h
"

29 
	~<glib.h
>

30 
	~<m©h.h
>

36 #ifdeà
HAVE_IEEEFP_H


37 
	~<›“å.h
>

39 #iâdeà
HAVE_ISINF


40 
	#isšf
(
a
è(!
	`fš™e
×))

	)

43 #ifdeà
_MSC_VER


46 
	~<æßt.h
>

47 
	#fš™e
(
a
è
	`_fš™e
×)

	)

48 
	#i¢ª
(
a
è
	`_i¢ª
×)

	)

50 #ifdeà
G_OS_WIN32


51 
	#M_PI
 3.14159265358979323846

	)

52 
	#M_SQRT2
 1.41421356237309504880

	)

53 
	#M_SQRT1_2
 0.70710678118654752440

	)

57 #iâdeà
M_PI


58 
	#M_PI
 
G_PI


	)

60 #iâdeà
M_SQRT2


61 
	#M_SQRT2
 
G_SQRT2


	)

63 #iâdeà
M_SQRT1_2


64 
	#M_SQRT1_2
 (1.0/
G_SQRT2
)

	)

67 
G_BEGIN_DECLS


78 
	t»®
;

79 
»®
 
	tcoÜd
;

82 
	s_Pošt
 {

83 
coÜd
 
	mx
;

84 
coÜd
 
	my
;

88 
	s_ReùªgË
 {

89 
coÜd
 
	mËá
;

90 
coÜd
 
	mtİ
;

91 
coÜd
 
	mright
;

92 
coÜd
 
	mbÙtom
;

96 
	s_IÁReùªgË
 {

97 
	mËá
;

98 
	mtİ
;

99 
	mright
;

100 
	mbÙtom
;

106 
	s_BezPošt
 {

108 
	mBEZ_MOVE_TO
,

109 
	mBEZ_LINE_TO
,

110 
	mBEZ_CURVE_TO


111 } 
	mty³
;

112 
Pošt
 
	mp1
;

113 
Pošt
 
	mp2
;

114 
Pošt
 
	mp3
;

118 
	#ROUND
(
x
è((è
	`æoÜ
((x)+0.5))

	)

122 
G_INLINE_FUNC
 
pošt_add
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

123 #ifdeà
G_CAN_INLINE


124 
G_INLINE_FUNC
 

125 
	$pošt_add
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

127 
p1
->
x
 +ğ
p2
->x;

128 
p1
->
y
 +ğ
p2
->y;

129 
	}
}

132 
G_INLINE_FUNC
 
pošt_sub
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

133 #ifdeà
G_CAN_INLINE


134 
G_INLINE_FUNC
 

135 
	$pošt_sub
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

137 
p1
->
x
 -ğ
p2
->x;

138 
p1
->
y
 -ğ
p2
->y;

139 
	}
}

142 
G_INLINE_FUNC
 
»®
 
pošt_dÙ
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

143 #ifdeà
G_CAN_INLINE


144 
G_INLINE_FUNC
 
»®


145 
	$pošt_dÙ
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

147  
p1
->
x
*
p2
->x +…1->
y
*p2->y;

148 
	}
}

151 
G_INLINE_FUNC
 
»®
 
pošt_Ën
(cÚ¡ 
Pošt
 *
p
);

152 #ifdeà
G_CAN_INLINE


153 
G_INLINE_FUNC
 
»®


154 
	$pošt_Ën
(cÚ¡ 
Pošt
 *
p
)

156  
	`sq¹
(
p
->
x
*p->x +…->
y
*p->y);

157 
	}
}

160 
G_INLINE_FUNC
 
pošt_sÿË
(
Pošt
 *
p
, 
»®
 
®pha
);

161 #ifdeà
G_CAN_INLINE


162 
G_INLINE_FUNC
 

163 
	$pošt_sÿË
(
Pošt
 *
p
, 
»®
 
®pha
)

165 
p
->
x
 *ğ
®pha
;

166 
p
->
y
 *ğ
®pha
;

167 
	}
}

170 
G_INLINE_FUNC
 
pošt_nÜm®ize
(
Pošt
 *
p
);

171 #ifdeà
G_CAN_INLINE


172 
G_INLINE_FUNC
 

173 
	$pošt_nÜm®ize
(
Pošt
 *
p
)

175 
»®
 
Ën
;

177 
Ën
 = 
	`sq¹
(
p
->
x
*p->x +…->
y
*p->y);

184 ià(
Ën
 > 0.0) {

185 
p
->
x
 /ğ
Ën
;

186 
p
->
y
 /ğ
Ën
;

188 
p
->
x
 = 0.0;

189 
p
->
y
 = 0.0;

192 
	}
}

195 
G_INLINE_FUNC
 
pošt_rÙ©e
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

196 #ifdeà
G_CAN_INLINE


197 
G_INLINE_FUNC
 

198 
	$pošt_rÙ©e
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

200 
p1
->
x
 =…1->x*
p2
->x -…1->
y
*p2->y;

201 
p1
->
y
 =…1->
x
*
p2
->y +…1->y*p2->x;

202 
	}
}

205 
G_INLINE_FUNC
 
pošt_g‘_nÜmed
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
);

206 #ifdeà
G_CAN_INLINE


207 
G_INLINE_FUNC
 

208 
	$pošt_g‘_nÜmed
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
)

210 
»®
 
Ën
;

212 
Ën
 = 
	`sq¹
(
¤c
->
x
*¤c->x + src->
y
*src->y);

214 
d¡
->
x
 = 
¤c
->x / 
Ën
;

215 
d¡
->
y
 = 
¤c
->y / 
Ën
;

216 
	}
}

219 
G_INLINE_FUNC
 
pošt_g‘_³½
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
);

220 #ifdeà
G_CAN_INLINE


221 
G_INLINE_FUNC
 

222 
	$pošt_g‘_³½
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
)

226 
d¡
->
y
 = 
¤c
->
x
;

227 
d¡
->
x
 = -
¤c
->
y
;

228 
	}
}

231 
G_INLINE_FUNC
 
pošt_cİy
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
);

232 #ifdeà
G_CAN_INLINE


233 
G_INLINE_FUNC
 

234 
	$pošt_cİy
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
)

241 
d¡
->
x
 = 
¤c
->x;

242 
d¡
->
y
 = 
¤c
->y;

243 
	}
}

246 
G_INLINE_FUNC
 
pošt_add_sÿËd
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
, 
»®
 
®pha
);

247 #ifdeà
G_CAN_INLINE


248 
G_INLINE_FUNC
 

249 
	$pošt_add_sÿËd
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
, 
»®
 
®pha
)

252 
d¡
->
x
 +ğ
®pha
 * 
¤c
->x;

253 
d¡
->
y
 +ğ
®pha
 * 
¤c
->y;

254 
	}
}

257 
G_INLINE_FUNC
 
pošt_cİy_add_sÿËd
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
,

258 cÚ¡ 
Pošt
 *
vù
,

259 
»®
 
®pha
);

260 #ifdeà
G_CAN_INLINE


261 
G_INLINE_FUNC
 

262 
	$pošt_cİy_add_sÿËd
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
,

263 cÚ¡ 
Pošt
 *
vù
, 
»®
 
®pha
)

266 
d¡
->
x
 = 
¤c
->x + (
®pha
 * 
vù
->x);

267 
d¡
->
y
 = 
¤c
->y + (
®pha
 * 
vù
->y);

268 
	}
}

271 
DIAVAR
 
pošt_cÚvex
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c1
, cÚ¡ Pošˆ*
¤c2
, 
»®
 
®pha
);

273 
DIAVAR
 
»ùªgË_uniÚ
(
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
);

274 
DIAVAR
 
št_»ùªgË_uniÚ
(
IÁReùªgË
 *
r1
, cÚ¡ IÁReùªgË *
r2
);

275 
DIAVAR
 
»ùªgË_š‹r£ùiÚ
(
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
);

276 
DIAVAR
 
»ùªgË_š‹r£ùs
(cÚ¡ 
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
);

277 
pošt_š_»ùªgË
(cÚ¡ 
ReùªgË
* 
r
, cÚ¡ 
Pošt
 *
p
);

278 
DIAVAR
 
»ùªgË_š_»ùªgË
(cÚ¡ 
ReùªgË
* 
ou‹r
, cÚ¡ ReùªgË *
šÃr
);

279 
DIAVAR
 
»ùªgË_add_pošt
(
ReùªgË
 *
r
, cÚ¡ 
Pošt
 *
p
);

281 
G_INLINE_FUNC
 
gboŞ—n
 
»ùªgË_equ®s
(cÚ¡ 
ReùªgË
 *
Şd_ex‹Ás
,

282 cÚ¡ 
ReùªgË
 *
Ãw_ex‹Ás
);

283 #ifdeà
G_CAN_INLINE


284 
G_INLINE_FUNC
 
gboŞ—n


285 
	$»ùªgË_equ®s
(cÚ¡ 
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
)

287  ( (
r2
->
Ëá
 =ğ
r1
->left) &&

288 (
r2
->
right
 =ğ
r1
->right) &&

289 (
r2
->
tİ
 =ğ
r1
->top) &&

290 (
r2
->
bÙtom
 =ğ
r1
->bottom) );

291 
	}
}

294 
G_INLINE_FUNC
 
»®
 
di¡ªû_pošt_pošt
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

295 #ifdeà
G_CAN_INLINE


296 
G_INLINE_FUNC
 
»®


297 
	$di¡ªû_pošt_pošt
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

299 
»®
 
dx
 = 
p1
->
x
 - 
p2
->x;

300 
»®
 
dy
 = 
p1
->
y
 - 
p2
->y;

301  
	`sq¹
(
dx
*dx + 
dy
*dy);

302 
	}
}

305 
G_INLINE_FUNC
 cÚ¡ 
Pošt
 *
şo£¡_to
(cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
p1
, cÚ¡ Pošˆ*
p2
);

306 #ifdeà
G_CAN_INLINE


307 
G_INLINE_FUNC
 cÚ¡ 
Pošt
 *

308 
	$şo£¡_to
(cÚ¡ 
Pošt
 *
to
, cÚ¡ Pošˆ*
p1
, cÚ¡ Pošˆ*
p2
)

310 ià(
	`di¡ªû_pošt_pošt
(
to
,
p1
è< di¡ªû_pošt_poštÑo,
p2
))

311  
p1
;

312  
p2
;

313 
	}
}

316 
G_INLINE_FUNC
 
»®
 
di¡ªû_pošt_pošt_mªh©n
(cÚ¡ 
Pošt
 *
p1
,

317 cÚ¡ 
Pošt
 *
p2
);

318 #ifdeà
G_CAN_INLINE


319 
G_INLINE_FUNC
 
»®


320 
	$di¡ªû_pošt_pošt_mªh©n
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

322 
»®
 
dx
 = 
p1
->
x
 - 
p2
->x;

323 
»®
 
dy
 = 
p1
->
y
 - 
p2
->y;

324  
	`ABS
(
dx
è+ ABS(
dy
);

325 
	}
}

328 
DIAVAR
 
»®
 
di¡ªû_»ùªgË_pošt
(cÚ¡ 
ReùªgË
 *
»ù
, cÚ¡ 
Pošt
 *
pošt
);

329 
DIAVAR
 
»®
 
di¡ªû_lše_pošt
(cÚ¡ 
Pošt
 *
lše_¡¬t
, cÚ¡ Pošˆ*
lše_’d
,

330 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

332 
DIAVAR
 
»®
 
di¡ªû_pŞygÚ_pošt
(cÚ¡ 
Pošt
 *
pŞy
, 
gušt
 
Åošts
,

333 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

336 
DIAVAR
 
»®
 
di¡ªû_bez_£g_pošt
(cÚ¡ 
Pošt
 *
b1
, cÚ¡ Pošˆ*
b2
,

337 cÚ¡ 
Pošt
 *
b3
, cÚ¡ Pošˆ*
b4
,

338 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

339 
DIAVAR
 
»®
 
di¡ªû_bez_lše_pošt
(cÚ¡ 
BezPošt
 *
b
, 
gušt
 
Åošts
,

340 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

341 
DIAVAR
 
»®
 
di¡ªû_bez_sh­e_pošt
(cÚ¡ 
BezPošt
 *
b
, 
gušt
 
Åošts
,

342 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

344 
DIAVAR
 
»®
 
di¡ªû_–l£_pošt
(cÚ¡ 
Pošt
 *
ûÁ»
,„—È
width
,„—È
height
,

345 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

347 
»®
 
	tVeùÜ
[3];

348 
VeùÜ
 
	tM©rix
[3];

350 
DIAVAR
 
ŒªsfÜm_pošt
 (
M©rix
, 
Pošt
 *, Point *);

351 
muÉ_m©rix
 (
M©rix
, Matrix);

352 
DIAVAR
 
id’t™y_m©rix
 (
M©rix
);

353 
Œª¦©e_m©rix
 (
M©rix
, 
»®
,„eal);

354 
sÿË_m©rix
 (
M©rix
, 
»®
,„eal);

355 
DIAVAR
 
rÙ©e_m©rix
 (
M©rix
, 
»®
);

356 
xsh—r_m©rix
 (
M©rix
, 
»®
);

357 
ysh—r_m©rix
 (
M©rix
, 
»®
);

359 
»®
 
dÙ2
(
Pošt
 *
p1
, Pošˆ*
p2
);

360 
lše_cÛf
(
»®
 *
a
,„—È*
b
,„—È*
c
, 
Pošt
 *
p1
, Pošˆ*
p2
);

361 
»®
 
lše_to_pošt
Ô—È
a
,„—È
b
 ,„—È
c
, 
Pošt
 *
p
);

362 
pošt_³½
(
Pošt
 *
p
, 
»®
 
a
,„—È
b
,„—È
c
, Pošˆ*
³½
);

363 
fËt
(
Pošt
 *
p1
, Pošˆ*
p2
, Pošˆ*
p3
, Pošˆ*
p4
,

364 
»®
 
r
, 
Pošt
 *
c
,„—È*
·
,„—È*
¯
);

365 
DIAVAR
 
th»e_pošt_cœşe
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
, cÚ¡ Pošˆ*
p3
,

366 
Pošt
* 
ûÁ”
, 
»®
* 
¿dius
);

367 
DIAVAR
 
»®
 
pošt_üoss
(
Pošt
 *
p1
, Pošˆ*
p2
);

368 
DIAVAR
 
Pošt
 
ÿlcuÏ‹_objeù_edge
(Pošˆ*
objmid
, Pošˆ*
’d
, 
DŸObjeù
 *
obj
);

370 
	gG_END_DECLS


	@O:\tool\dvs50\lib\group.c

18 
	~<cÚfig.h
>

20 
	~<as£¹.h
>

21 
	~<gtk/gtk.h
>

22 
	~<m©h.h
>

24 
	~"objeù.h
"

25 
	~"cÚÃùiÚpošt.h
"

26 
	~"group.h
"

27 
	~"´İ”t›s.h
"

28 
	~"dŸ»nd””.h
"

30 
	s_Group
 {

32 
DŸObjeù
 
	mobjeù
;

34 
HªdË
 
	m»size_hªdËs
[8];

36 
GLi¡
 *
	mobjeùs
;

38 cÚ¡ 
PrİDesütiÚ
 *
	mpdesc
;

41 
_GroupPrİChªge
 
	tGroupPrİChªge
;

42 
	s_GroupPrİChªge
 {

43 
ObjeùChªge
 
	mobj_chªge
;

44 
Group
 *
	mgroup
;

45 
GLi¡
 *
	mchªges_³r_objeù
;

48 
GroupPrİChªge
* 
group_­¶y_´İ”t›s_li¡
(
Group
 *
group
, 
GPŒA¼ay
 *
´İs
);

49 
group_´İ_chªge_­¶y
(
GroupPrİChªge
 *
chªge
, 
DŸObjeù
 *
obj
);

50 
group_´İ_chªge_»v”t
(
GroupPrİChªge
 *
chªge
, 
DŸObjeù
 *
obj
);

51 
group_´İ_chªge_ä“
(
GroupPrİChªge
 *
chªge
);

53 
»®
 
group_di¡ªû_äom
(
Group
 *
group
, 
Pošt
 *
pošt
);

54 
group_£Ëù
(
Group
 *
group
);

55 
ObjeùChªge
* 
group_move_hªdË
(
Group
 *
group
, 
HªdË
 *
hªdË
, 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

56 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

57 
ObjeùChªge
* 
group_move
(
Group
 *
group
, 
Pošt
 *
to
);

58 
group_d¿w
(
Group
 *
group
, 
DŸR’d””
 *
»nd””
);

59 
group_upd©e_d©a
(
Group
 *
group
);

60 
group_upd©e_hªdËs
(
Group
 *
group
);

61 
group_de¡roy
(
Group
 *
group
);

62 
DŸObjeù
 *
group_cİy
(
Group
 *
group
);

63 cÚ¡ 
PrİDesütiÚ
 *
group_desüibe_´İs
(
Group
 *
group
);

64 
group_g‘_´İs
(
Group
 *
group
, 
GPŒA¼ay
 *
´İs
);

65 
group_£t_´İs
(
Group
 *
group
, 
GPŒA¼ay
 *
´İs
);

67 
ObjeùOps
 
	ggroup_İs
 = {

68 (
De¡royFunc
è
group_de¡roy
,

69 (
D¿wFunc
è
group_d¿w
,

70 (
Di¡ªûFunc
è
group_di¡ªû_äom
,

71 (
S–eùFunc
è
group_£Ëù
,

72 (
CİyFunc
è
group_cİy
,

73 (
MoveFunc
è
group_move
,

74 (
MoveHªdËFunc
è
group_move_hªdË
,

75 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

76 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

77 (
ObjeùM’uFunc
è
NULL
,

78 (
DesüibePrİsFunc
è
group_desüibe_´İs
,

79 (
G‘PrİsFunc
è
group_g‘_´İs
,

80 (
S‘PrİsFunc
è
group_£t_´İs
,

81 (
TextEd™Func
) 0,

82 (
AµlyPrİ”t›sLi¡Func
è
group_­¶y_´İ”t›s_li¡
,

85 
DŸObjeùTy³
 
	ggroup_ty³
 = {

88 
NULL


91 
»®


92 
	$group_di¡ªû_äom
(
Group
 *
group
, 
Pošt
 *
pošt
)

94 
»®
 
di¡
;

95 
GLi¡
 *
li¡
;

96 
DŸObjeù
 *
obj
;

98 
di¡
 = 100000.0;

100 
li¡
 = 
group
->
objeùs
;

101 
li¡
 !ğ
NULL
) {

102 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

104 
di¡
 = 
	`MIN
(di¡, 
obj
->
İs
->
	`di¡ªû_äom
(obj, 
pošt
));

106 
li¡
 = 
	`g_li¡_Ãxt
(list);

109  
di¡
;

110 
	}
}

113 
	$group_£Ëù
(
Group
 *
group
)

115 
	`group_upd©e_hªdËs
(
group
);

116 
	}
}

119 
	$group_upd©e_hªdËs
(
Group
 *
group
)

121 
ReùªgË
 *
bb
 = &
group
->
objeù
.
boundšg_box
;

123 
group
->
»size_hªdËs
[0].
id
 = 
HANDLE_RESIZE_NW
;

124 
group
->
»size_hªdËs
[0].
pos
.
x
 = 
bb
->
Ëá
;

125 
group
->
»size_hªdËs
[0].
pos
.
y
 = 
bb
->
tİ
;

127 
group
->
»size_hªdËs
[1].
id
 = 
HANDLE_RESIZE_N
;

128 
group
->
»size_hªdËs
[1].
pos
.
x
 = (
bb
->
Ëá
 + bb->
right
) / 2.0;

129 
group
->
»size_hªdËs
[1].
pos
.
y
 = 
bb
->
tİ
;

131 
group
->
»size_hªdËs
[2].
id
 = 
HANDLE_RESIZE_NE
;

132 
group
->
»size_hªdËs
[2].
pos
.
x
 = 
bb
->
right
;

133 
group
->
»size_hªdËs
[2].
pos
.
y
 = 
bb
->
tİ
;

135 
group
->
»size_hªdËs
[3].
id
 = 
HANDLE_RESIZE_W
;

136 
group
->
»size_hªdËs
[3].
pos
.
x
 = 
bb
->
Ëá
;

137 
group
->
»size_hªdËs
[3].
pos
.
y
 = (
bb
->
tİ
 + bb->
bÙtom
) / 2.0;

139 
group
->
»size_hªdËs
[4].
id
 = 
HANDLE_RESIZE_E
;

140 
group
->
»size_hªdËs
[4].
pos
.
x
 = 
bb
->
right
;

141 
group
->
»size_hªdËs
[4].
pos
.
y
 = (
bb
->
tİ
 + bb->
bÙtom
) / 2.0;

143 
group
->
»size_hªdËs
[5].
id
 = 
HANDLE_RESIZE_SW
;

144 
group
->
»size_hªdËs
[5].
pos
.
x
 = 
bb
->
Ëá
;

145 
group
->
»size_hªdËs
[5].
pos
.
y
 = 
bb
->
bÙtom
;

147 
group
->
»size_hªdËs
[6].
id
 = 
HANDLE_RESIZE_S
;

148 
group
->
»size_hªdËs
[6].
pos
.
x
 = (
bb
->
Ëá
 + bb->
right
) / 2.0;

149 
group
->
»size_hªdËs
[6].
pos
.
y
 = 
bb
->
bÙtom
;

151 
group
->
»size_hªdËs
[7].
id
 = 
HANDLE_RESIZE_SE
;

152 
group
->
»size_hªdËs
[7].
pos
.
x
 = 
bb
->
right
;

153 
group
->
»size_hªdËs
[7].
pos
.
y
 = 
bb
->
bÙtom
;

154 
	}
}

156 
ObjeùChªge
*

157 
	$group_move_hªdË
(
Group
 *
group
, 
HªdË
 *
hªdË
, 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

158 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

161  
NULL
;

162 
	}
}

164 
ObjeùChªge
*

165 
	$group_move
(
Group
 *
group
, 
Pošt
 *
to
)

167 
Pošt
 
d–
,
pos
;

169 
d–
 = *
to
;

170 
pos
 = 
group
->
objeù
.
pos™iÚ
;

171 
	`pošt_sub
(&
d–
, &
pos
);

173 
	`objeù_li¡_move_d–
(
group
->
objeùs
, &
d–
);

175 
	`group_upd©e_d©a
(
group
);

177  
NULL
;

178 
	}
}

181 
	$group_d¿w
(
Group
 *
group
, 
DŸR’d””
 *
»nd””
)

183 
GLi¡
 *
li¡
;

184 
DŸObjeù
 *
obj
;

186 
li¡
 = 
group
->
objeùs
;

187 
li¡
 !ğ
NULL
) {

188 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

190 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_objeù
Ô’d””, 
obj
);

192 
li¡
 = 
	`g_li¡_Ãxt
(list);

194 
	}
}

197 
	$group_de¡roy_sh®low
(
DŸObjeù
 *
obj
)

199 
Group
 *
group
 = (Grou°*)
obj
;

200 ià(
obj
->
hªdËs
)

201 
	`g_ä“
(
obj
->
hªdËs
);

203 ià(
obj
->
cÚÃùiÚs
)

204 
	`g_ä“
(
obj
->
cÚÃùiÚs
);

206 
	`g_li¡_ä“
(
group
->
objeùs
);

208 
	`´İ_desc_li¡_ä“_hªdËr_chaš
((
PrİDesütiÚ
 *)
group
->
pdesc
);

209 
	`g_ä“
((
PrİDesütiÚ
 *)
group
->
pdesc
);

211 
	`g_ä“
(
group
);

212 
	}
}

215 
	$group_de¡roy
(
Group
 *
group
)

217 
DŸObjeù
 *
obj
 = &
group
->
objeù
;

219 
	`de¡roy_objeù_li¡
(
group
->
objeùs
);

223 
obj
->
num_cÚÃùiÚs
 = 0;

225 
	`´İ_desc_li¡_ä“_hªdËr_chaš
((
PrİDesütiÚ
 *)
group
->
pdesc
);

226 
	`g_ä“
((
PrİDesütiÚ
 *)
group
->
pdesc
);

228 
	`objeù_de¡roy
(
obj
);

229 
	}
}

231 
DŸObjeù
 *

232 
	$group_cİy
(
Group
 *
group
)

234 
Group
 *
Ãwgroup
;

235 
DŸObjeù
 *
Ãwobj
, *
obj
;

236 
DŸObjeù
 *
li¡obj
;

237 
GLi¡
 *
li¡
;

238 
num_cÚn
, 
i
;

240 
obj
 = &
group
->
objeù
;

242 
Ãwgroup
 = 
	`g_Ãw0
(
Group
,1);

243 
Ãwobj
 = &
Ãwgroup
->
objeù
;

245 
	`objeù_cİy
(
obj
, 
Ãwobj
);

247 
i
=0;i<8;i++) {

248 
Ãwobj
->
hªdËs
[
i
] = &
Ãwgroup
->
»size_hªdËs
[i];

249 
Ãwgroup
->
»size_hªdËs
[
i
] = 
group
->resize_handles[i];

252 
Ãwgroup
->
objeùs
 = 
	`objeù_cİy_li¡
(
group
->objects);

255 
num_cÚn
 = 0;

256 
li¡
 = 
Ãwgroup
->
objeùs
;

257 
li¡
 !ğ
NULL
) {

258 
li¡obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

260 
i
=0;i<
li¡obj
->
num_cÚÃùiÚs
;i++) {

262 
Ãwobj
->
cÚÃùiÚs
[
num_cÚn
++] = 
li¡obj
->cÚÃùiÚs[
i
];

265 
li¡
 = 
	`g_li¡_Ãxt
(list);

269 
Ãwgroup
->
pdesc
 = 
NULL
;

271  (
DŸObjeù
 *)
Ãwgroup
;

272 
	}
}

276 
	$group_upd©e_d©a
(
Group
 *
group
)

278 
GLi¡
 *
li¡
;

279 
DŸObjeù
 *
obj
;

281 ià(
group
->
objeùs
 !ğ
NULL
) {

282 
li¡
 = 
group
->
objeùs
;

283 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

284 
group
->
objeù
.
boundšg_box
 = 
obj
->bounding_box;

286 
li¡
 = 
	`g_li¡_Ãxt
(list);

287 
li¡
 !ğ
NULL
) {

288 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

290 
	`»ùªgË_uniÚ
(&
group
->
objeù
.
boundšg_box
, &
obj
->bounding_box);

292 
li¡
 = 
	`g_li¡_Ãxt
(list);

295 
obj
 = (
DŸObjeù
 *è
group
->
objeùs
->
d©a
;

299 
group
->
objeù
.
pos™iÚ
 = 
obj
->position;

301 
	`group_upd©e_hªdËs
(
group
);

303 
	}
}

308 
DŸObjeù
 *

309 
	$group_ü—‹
(
GLi¡
 *
objeùs
)

311 
Group
 *
group
;

312 
DŸObjeù
 *
obj
, *
·¹_obj
;

313 
i
;

314 
GLi¡
 *
li¡
;

315 
num_cÚn
;

317 
group
 = 
	`g_Ãw0
(
Group
,1);

318 
obj
 = &
group
->
objeù
;

320 
obj
->
ty³
 = &
group_ty³
;

322 
obj
->
İs
 = &
group_İs
;

324 
group
->
objeùs
 = objects;

326 
group
->
pdesc
 = 
NULL
;

329 
num_cÚn
 = 0;

330 
li¡
 = 
objeùs
;

331 
li¡
 !ğ
NULL
) {

332 
·¹_obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

334 
num_cÚn
 +ğ
·¹_obj
->
num_cÚÃùiÚs
;

336 
li¡
 = 
	`g_li¡_Ãxt
(list);

339 
	`objeù_š™
(
obj
, 8, 
num_cÚn
);

342 
num_cÚn
 = 0;

343 
li¡
 = 
objeùs
;

344 
li¡
 !ğ
NULL
) {

345 
·¹_obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

347 
i
=0;i<
·¹_obj
->
num_cÚÃùiÚs
;i++) {

348 
obj
->
cÚÃùiÚs
[
num_cÚn
++] = 
·¹_obj
->cÚÃùiÚs[
i
];

351 
li¡
 = 
	`g_li¡_Ãxt
(list);

354 
i
=0;i<8;i++) {

355 
obj
->
hªdËs
[
i
] = &
group
->
»size_hªdËs
[i];

356 
obj
->
hªdËs
[
i
]->
ty³
 = 
HANDLE_NON_MOVABLE
;

357 
obj
->
hªdËs
[
i
]->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

358 
obj
->
hªdËs
[
i
]->
cÚÃùed_to
 = 
NULL
;

361 
	`group_upd©e_d©a
(
group
);

362  (
DŸObjeù
 *)
group
;

363 
	}
}

365 
GLi¡
 *

366 
	$group_objeùs
(
DŸObjeù
 *
group
)

368 
Group
 *
g
;

369 
g
 = (
Group
 *)
group
;

371  
g
->
objeùs
;

372 
	}
}

374 
gboŞ—n


375 
	$group_´İ_ev’t_d–iv”
(
Group
 *
group
, 
Prİ”ty
 *
´İ
)

377 
GLi¡
 *
tmp
;

378 
tmp
 = 
group
->
objeùs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

379 
DŸObjeù
 *
obj
 = 
tmp
->
d©a
;

381 ià(
obj
->
İs
->
desüibe_´İs
) {

382 cÚ¡ 
PrİDesütiÚ
 *
pdesc
,*
¶i¡
;

385 
¶i¡
 = 
obj
->
İs
->
	`desüibe_´İs
(obj);

386 
pdesc
 = 
	`´İ_desc_li¡_fšd_´İ
(
¶i¡
,
´İ
->
Çme
);

387 ià(
pdesc
 &&…desc->
ev’t_hªdËr
) {

389 
PrİEv’tHªdËr
 
hdl
 = 
	`´İ_desc_fšd_»®_hªdËr
(
pdesc
);

390 ià(
hdl
) {

391  
	`hdl
(
obj
,
´İ
);

393 
	`g_w¬nšg
("dropped groupƒvent on…rop %s, "

394 "fš® hªdË¸wa NULL",
´İ
->
Çme
);

395  
FALSE
;

400 
	`g_w¬nšg
("und–iv”ed grou°´İ”tyƒv’ˆfÜ…rİ %s",
´İ
->
Çme
);

401  
FALSE
;

402 
	}
}

404 cÚ¡ 
PrİDesütiÚ
 *

405 
	$group_desüibe_´İs
(
Group
 *
group
)

407 
i
;

408 ià(
group
->
pdesc
 =ğ
NULL
) {

412 
group
->
pdesc
 = 
	`objeù_li¡_g‘_´İ_desütiÚs
(group->
objeùs
, 
PROP_UNION
);

414 ià(
group
->
pdesc
 !ğ
NULL
) {

416 
i
=0; 
group
->
pdesc
[i].
Çme
 !ğ
NULL
; i++) {

417 ià(
group
->
pdesc
[
i
].
ev’t_hªdËr
)

418 
	`´İ_desc_š£¹_hªdËr
((
PrİDesütiÚ
 *)&
group
->
pdesc
[
i
],

419 (
PrİEv’tHªdËr
)
group_´İ_ev’t_d–iv”
);

424  
group
->
pdesc
;

425 
	}
}

428 
	$group_g‘_´İs
(
Group
 *
group
, 
GPŒA¼ay
 *
´İs
)

430 
GLi¡
 *
tmp
;

432 
tmp
 = 
group
->
objeùs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

433 
DŸObjeù
 *
obj
 = 
tmp
->
d©a
;

435 ià(
obj
->
İs
->
g‘_´İs
) {

436 
obj
->
İs
->
	`g‘_´İs
(obj, 
´İs
);

439 
	}
}

442 
	$group_£t_´İs
(
Group
 *
group
, 
GPŒA¼ay
 *
´İs
)

444 
GLi¡
 *
tmp
;

446 
tmp
 = 
group
->
objeùs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

447 
DŸObjeù
 *
obj
 = 
tmp
->
d©a
;

449 ià(
obj
->
İs
->
£t_´İs
) {

450 
obj
->
İs
->
	`£t_´İs
(obj, 
´İs
);

453 
	}
}

455 
GroupPrİChªge
 *

456 
	$group_­¶y_´İ”t›s_li¡
(
Group
 *
group
, 
GPŒA¼ay
 *
´İs
)

458 
GLi¡
 *
tmp
 = 
NULL
;

459 
GLi¡
 *
şi¡
 = 
NULL
;

460 
GroupPrİChªge
 *
chªge
 = 
NULL
;

461 
chªge
 = 
	`g_Ãw0
(
GroupPrİChªge
, 1);

464 
chªge
->
obj_chªge
.
­¶y
 =

465 (
ObjeùChªgeAµlyFunc
è
group_´İ_chªge_­¶y
;

466 
chªge
->
obj_chªge
.
»v”t
 =

467 (
ObjeùChªgeRev”tFunc
è
group_´İ_chªge_»v”t
;

468 
chªge
->
obj_chªge
.
ä“
 =

469 (
ObjeùChªgeF»eFunc
è
group_´İ_chªge_ä“
;

471 
chªge
->
group
 = group;

473 
tmp
 = 
group
->
objeùs
;m°!ğ
NULL
;m°ğ
	`g_li¡_Ãxt
(tmp)) {

474 
DŸObjeù
 *
obj
 = (DŸObjeù*)
tmp
->
d©a
;

475 
ObjeùChªge
 *
objchªge
 = 
NULL
;

477 
objchªge
 = 
obj
->
İs
->
	`­¶y_´İ”t›s_li¡
(obj, 
´İs
);

478 
şi¡
 = 
	`g_li¡_­³nd
(şi¡, 
objchªge
);

481 
chªge
->
chªges_³r_objeù
 = 
şi¡
;

483  
chªge
;

484 
	}
}

487 
	$group_´İ_chªge_­¶y
(
GroupPrİChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

489 
GLi¡
 *
tmp
;

491 
tmp
 = 
chªge
->
chªges_³r_objeù
;m°!ğ
NULL
;

492 
tmp
 = 
	`g_li¡_Ãxt
(tmp)) {

493 
ObjeùChªge
 *
obj_chªge
 = (ObjeùChªge*)
tmp
->
d©a
;

503 
obj_chªge
->
	`­¶y
(obj_chªge, 
NULL
);

505 
	}
}

508 
	$group_´İ_chªge_»v”t
(
GroupPrİChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

510 
GLi¡
 *
tmp
;

512 
tmp
 = 
chªge
->
chªges_³r_objeù
;m°!ğ
NULL
;

513 
tmp
 = 
	`g_li¡_Ãxt
(tmp)) {

514 
ObjeùChªge
 *
obj_chªge
 = (ObjeùChªge*)
tmp
->
d©a
;

524 
obj_chªge
->
	`»v”t
(obj_chªge, 
NULL
);

526 
	}
}

528 
	$group_´İ_chªge_ä“
(
GroupPrİChªge
 *
chªge
)

530 
GLi¡
 *
tmp
;

531 
tmp
 = 
chªge
->
chªges_³r_objeù
;m°!ğ
NULL
;

532 
tmp
 = 
	`g_li¡_Ãxt
(tmp)) {

533 
ObjeùChªge
 *
obj_chªge
 = (ObjeùChªge*)
tmp
->
d©a
;

534 
obj_chªge
->
	`ä“
(obj_change);

535 
	`g_ä“
(
obj_chªge
);

537 
	`g_li¡_ä“
(
chªge
->
chªges_³r_objeù
);

538 
	}
}

	@O:\tool\dvs50\lib\group.h

18 #iâdeà
GROUP_H


19 
	#GROUP_H


	)

21 
	~"dŸv¬.h
"

22 
	~"objeù.h
"

24 
DIAVAR
 
DŸObjeùTy³
 
	ggroup_ty³
;

29 
DIAVAR
 
DŸObjeù
 *
group_ü—‹
(
GLi¡
 *
objeùs
);

30 
DIAVAR
 
GLi¡
 *
group_objeùs
(
DŸObjeù
 *
group
);

32 
DIAVAR
 
group_de¡roy_sh®low
(
DŸObjeù
 *
group
);

34 
	#IS_GROUP
(
obj
è((obj)->
ty³
 =ğ&
group_ty³
)

	)

	@O:\tool\dvs50\lib\handle.h

20 #iâdeà
HANDLE_H


21 
	#HANDLE_H


	)

23 
	~"dŸty³s.h
"

24 
	~"geom‘ry.h
"

28 
	mHANDLE_RESIZE_NW
,

29 
	mHANDLE_RESIZE_N
,

30 
	mHANDLE_RESIZE_NE
,

31 
	mHANDLE_RESIZE_W
,

32 
	mHANDLE_RESIZE_E
,

33 
	mHANDLE_RESIZE_SW
,

34 
	mHANDLE_RESIZE_S
,

35 
	mHANDLE_RESIZE_SE
,

36 
	mHANDLE_MOVE_STARTPOINT
,

37 
	mHANDLE_MOVE_ENDPOINT
,

40 
	mHANDLE_CUSTOM1
=200,

41 
	mHANDLE_CUSTOM2
,

42 
	mHANDLE_CUSTOM3
,

43 
	mHANDLE_CUSTOM4
,

44 
	mHANDLE_CUSTOM5
,

45 
	mHANDLE_CUSTOM6
,

46 
	mHANDLE_CUSTOM7
,

47 
	mHANDLE_CUSTOM8
,

48 
	mHANDLE_CUSTOM9


49 } 
	tHªdËId
;

53 
	mHANDLE_NON_MOVABLE
,

54 
	mHANDLE_MAJOR_CONTROL
,

55 
	mHANDLE_MINOR_CONTROL
,

57 
	mNUM_HANDLE_TYPES


58 } 
	tHªdËTy³
;

62 
	mHANDLE_MOVE_USER
,

63 
	mHANDLE_MOVE_USER_FINAL
,

64 
	mHANDLE_MOVE_CONNECTED
,

65 
	mHANDLE_MOVE_CREATE
,

66 
	mHANDLE_MOVE_CREATE_FINAL


67 } 
	tHªdËMoveR—sÚ
;

71 
	mHANDLE_NONCONNECTABLE
,

72 
	mHANDLE_CONNECTABLE
,

73 
	mHANDLE_CONNECTABLE_NOBREAK


74 } 
	tHªdËCÚÃùTy³
;

79 
	s_HªdË
 {

80 
HªdËId
 
	mid
;

81 
HªdËTy³
 
	mty³
;

82 
Pošt
 
	mpos
;

84 
HªdËCÚÃùTy³
 
	mcÚÃù_ty³
;

85 
CÚÃùiÚPošt
 *
	mcÚÃùed_to
;

	@O:\tool\dvs50\lib\intl.c

1 
	~<cÚfig.h
>

3 
	~"š.h
"

5 
	~<¡dio.h
>

6 
	~<¡dlib.h
>

7 
	~<¡ršg.h
>

9 #iâdeà
GNOME


13 
GHashTabË
 *
	g®Ÿs_bË
 = 
NULL
;

17 
	$»ad_®Ÿ£s
 (*
fe
)

19 
FILE
 *
å
;

20 
buf
[256];

22 ià(!
®Ÿs_bË
)

23 
®Ÿs_bË
 = 
	`g_hash_bË_Ãw_fuÎ
 (
g_¡r_hash
, 
g_¡r_equ®
,

24 
g_ä“
, g_free);

25 
å
 = 
	`fİ’
 (
fe
,"r");

26 ià(!
å
)

28 
	`fg‘s
 (
buf
,256,
å
)) {

29 *
p
;

30 
	`g_¡r¡r
(
buf
);

31 if(
buf
[0]=='#' || buf[0]=='\0')

33 
p
 = 
	`¡¹ok
(
buf
,"\t ");

34 if(!
p
) ;

35 
p
 = 
	`¡¹ok
(
NULL
,"\t ");

36 if(!
p
) ;

37 
	`g_hash_bË_š£¹
 (
®Ÿs_bË
, 
	`g_¡rdup
(
buf
), g_¡rdup(
p
));

39 
	`fşo£
 (
å
);

40 
	}
}

43 
	$ä“_®Ÿs_bË
()

45 ià(!
®Ÿs_bË
)

47 
	`g_hash_bË_de¡roy
(
®Ÿs_bË
);

48 
®Ÿs_bË
 = 
NULL
;

49 
	}
}

53 
	$uÇlŸs_Ïng
 (*
Ïng
)

55 *
p
;

57 if(!
®Ÿs_bË
) {

58 
	`»ad_®Ÿ£s
 ("/usr/share/locale/locale.alias");

59 
	`»ad_®Ÿ£s
 ("/usr/local/share/locale/locale.alias");

60 
	`»ad_®Ÿ£s
 ("/usr/lib/X11/locale/locale.alias");

61 
	`»ad_®Ÿ£s
 ("/usr/openwin/lib/locale/locale.alias");

63 (
p
=
	`g_hash_bË_lookup
(
®Ÿs_bË
,
Ïng
)è&& 
	`¡rcmp
(p,†ang))

64 
Ïng
 = 
p
;

65  
Ïng
;

66 
	}
}

73 
	mCOMPONENT_CODESET
 = 1 << 0,

74 
	mCOMPONENT_TERRITORY
 = 1 << 1,

75 
	mCOMPONENT_MODIFIER
 = 1 << 2

80 
gušt


81 
	$ex¶ode_loÿË
 (cÚ¡ 
gch¬
 *
loÿË
,

82 
gch¬
 **
Ïnguage
,

83 
gch¬
 **
‹¼™Üy
,

84 
gch¬
 **
code£t
,

85 
gch¬
 **
modif›r
)

87 cÚ¡ 
gch¬
 *
uscÜe_pos
;

88 cÚ¡ 
gch¬
 *
©_pos
;

89 cÚ¡ 
gch¬
 *
dÙ_pos
;

91 
gušt
 
mask
 = 0;

93 
uscÜe_pos
 = 
	`¡rchr
 (
loÿË
, '_');

94 
dÙ_pos
 = 
	`¡rchr
 (
uscÜe_pos
 ? uscÜe_po : 
loÿË
, '.');

95 
©_pos
 = 
	`¡rchr
 (
dÙ_pos
 ? dÙ_po : (
uscÜe_pos
 ? uscÜe_po : 
loÿË
), '@');

97 ià(
©_pos
) {

98 
mask
 |ğ
COMPONENT_MODIFIER
;

99 *
modif›r
 = 
	`g_¡rdup
 (
©_pos
);

101 
©_pos
 = 
loÿË
 + 
	`¡¾’
 (locale);

103 ià(
dÙ_pos
) {

104 
mask
 |ğ
COMPONENT_CODESET
;

105 *
code£t
 = 
	`g_Ãw
 (
gch¬
, 1 + 
©_pos
 - 
dÙ_pos
);

106 
	`¡ºıy
 (*
code£t
, 
dÙ_pos
, 
©_pos
 - dot_pos);

107 (*
code£t
)[
©_pos
 - 
dÙ_pos
] = '\0';

109 
dÙ_pos
 = 
©_pos
;

111 ià(
uscÜe_pos
) {

112 
mask
 |ğ
COMPONENT_TERRITORY
;

113 *
‹¼™Üy
 = 
	`g_Ãw
 (
gch¬
, 1 + 
dÙ_pos
 - 
uscÜe_pos
);

114 
	`¡ºıy
 (*
‹¼™Üy
, 
uscÜe_pos
, 
dÙ_pos
 - uscore_pos);

115 (*
‹¼™Üy
)[
dÙ_pos
 - 
uscÜe_pos
] = '\0';

117 
uscÜe_pos
 = 
dÙ_pos
;

119 *
Ïnguage
 = 
	`g_Ãw
 (
gch¬
, 1 + 
uscÜe_pos
 - 
loÿË
);

120 
	`¡ºıy
 (*
Ïnguage
, 
loÿË
, 
uscÜe_pos
 -†ocale);

121 (*
Ïnguage
)[
uscÜe_pos
 - 
loÿË
] = '\0';

123  
mask
;

124 
	}
}

138 
GLi¡
 *

139 
	$compu‹_loÿË_v¬ŸÁs
 (cÚ¡ 
gch¬
 *
loÿË
)

141 
GLi¡
 *
»tv®
 = 
NULL
;

143 
gch¬
 *
Ïnguage
;

144 
gch¬
 *
‹¼™Üy
=
NULL
;

145 
gch¬
 *
code£t
=
NULL
;

146 
gch¬
 *
modif›r
=
NULL
;

148 
gušt
 
mask
;

149 
gušt
 
i
;

151 
	`g_»tuº_v®_if_ç
 (
loÿË
 !ğ
NULL
, NULL);

153 
mask
 = 
	`ex¶ode_loÿË
 (
loÿË
, &
Ïnguage
, &
‹¼™Üy
, &
code£t
, &
modif›r
);

158 
i
=0; i<=
mask
; i++)

159 ià((
i
 & ~
mask
) == 0)

161 
gch¬
 *
v®
 = 
	`g_¡rcÚÿt
(
Ïnguage
,

162 (
i
 & 
COMPONENT_TERRITORY
è? 
‹¼™Üy
 : "",

163 (
i
 & 
COMPONENT_CODESET
è? 
code£t
 : "",

164 (
i
 & 
COMPONENT_MODIFIER
è? 
modif›r
 : "",

165 
NULL
);

166 
»tv®
 = 
	`g_li¡_´•’d
 (»tv®, 
v®
);

169 
	`g_ä“
 (
Ïnguage
);

170 ià(
mask
 & 
COMPONENT_CODESET
)

171 
	`g_ä“
 (
code£t
);

172 ià(
mask
 & 
COMPONENT_TERRITORY
)

173 
	`g_ä“
 (
‹¼™Üy
);

174 ià(
mask
 & 
COMPONENT_MODIFIER
)

175 
	`g_ä“
 (
modif›r
);

177  
»tv®
;

178 
	}
}

183 cÚ¡ 
gch¬
 *

184 
	$guess_ÿ‹gÜy_v®ue
 (cÚ¡ 
gch¬
 *
ÿ‹gÜyÇme
)

186 cÚ¡ 
gch¬
 *
»tv®
;

190 
»tv®
 = 
	`g‘’v
 ("LANGUAGE");

191 ià(
»tv®
 !ğ
NULL
 &&„etval[0] != '\0')

192  
»tv®
;

199 
»tv®
 = 
	`g‘’v
 ("LC_ALL");

200 ià(
»tv®
 !ğ
NULL
 &&„etval[0] != '\0')

201  
»tv®
;

204 
»tv®
 = 
	`g‘’v
 (
ÿ‹gÜyÇme
);

205 ià(
»tv®
 !ğ
NULL
 &&„etval[0] != '\0')

206  
»tv®
;

209 
»tv®
 = 
	`g‘’v
 ("LANG");

210 ià(
»tv®
 !ğ
NULL
 &&„etval[0] != '\0')

211  
»tv®
;

213  
NULL
;

214 
	}
}

216 
GLi¡
 *

217 
	$g‘_Ïnguage_li¡
(cÚ¡ 
gch¬
 *
ÿ‹gÜy_Çme
)

219 
GLi¡
 *
li¡
 = 
NULL
;

220 
gšt
 
c_loÿË_defšed
ğ
FALSE
;

222 cÚ¡ 
gch¬
 *
ÿ‹gÜy_v®ue
;

223 
gch¬
 *
ÿ‹gÜy_memÜy
, *
Üig_ÿ‹gÜy_memÜy
;

225 ià(!
ÿ‹gÜy_Çme
)

226 
ÿ‹gÜy_Çme
= "LC_ALL";

228 
ÿ‹gÜy_v®ue
 = 
	`guess_ÿ‹gÜy_v®ue
 (
ÿ‹gÜy_Çme
);

229 ià(! 
ÿ‹gÜy_v®ue
)

230 
ÿ‹gÜy_v®ue
 = "C";

231 
Üig_ÿ‹gÜy_memÜy
 = 
ÿ‹gÜy_memÜy
 =

232 
	`g_m®loc
 (
	`¡¾’
 (
ÿ‹gÜy_v®ue
)+1);

234 
ÿ‹gÜy_v®ue
[0] != '\0') {

235 
ÿ‹gÜy_v®ue
[0] != '\0' && category_value[0] == ':')

236 ++
ÿ‹gÜy_v®ue
;

238 ià(
ÿ‹gÜy_v®ue
[0] != '\0') {

239 *
ı
ğ
ÿ‹gÜy_memÜy
;

241 
ÿ‹gÜy_v®ue
[0] != '\0' && category_value[0] != ':')

242 *
ÿ‹gÜy_memÜy
++ğ*
ÿ‹gÜy_v®ue
++;

244 
ÿ‹gÜy_memÜy
[0]= '\0';

245 
ÿ‹gÜy_memÜy
++;

247 
ı
 = 
	`uÇlŸs_Ïng
(cp);

249 ià(
	`¡rcmp
 (
ı
, "C") == 0)

250 
c_loÿË_defšed
ğ
TRUE
;

252 
li¡
ğ
	`g_li¡_cÚÿt
 (li¡, 
	`compu‹_loÿË_v¬ŸÁs
 (
ı
));

256 
	`g_ä“
 (
Üig_ÿ‹gÜy_memÜy
);

258 ià(!
c_loÿË_defšed
)

259 
li¡
ğ
	`g_li¡_­³nd
 (list, "C");

261  
li¡
;

262 
	}
}

266 cÚ¡ 
GLi¡
 *

267 
	$š_g‘_Ïnguage_li¡
()

269 cÚ¡ 
GLi¡
 *
li¡
 = 
NULL
;

271 ià(!
li¡
) {

272 #ifdeà
GNOME


273 
li¡
 = 
	`gnome_i18n_g‘_Ïnguage_li¡
("LC_MESSAGES");

275 
li¡
 = 
	`g‘_Ïnguage_li¡
("LC_MESSAGES");

276 
	`ä“_®Ÿs_bË
();

279  
li¡
;

280 
	}
}

284 
	$š_scÜe_loÿË
(cÚ¡ 
gch¬
 *
loÿË
)

286 cÚ¡ 
GLi¡
 *
li¡
 = 
	`š_g‘_Ïnguage_li¡
();

287 cÚ¡ 
GLi¡
 *
tmp
;

288 
i
;

291 ià(!
loÿË
)

292  
	`g_li¡_Ëngth
((
GLi¡
*)
li¡
) - 1;

293 
tmp
 = 
li¡
, 
i
 = 0;mp;m°ğtmp->
Ãxt
, i++)

294 ià(!
	`¡rcmp
((cÚ¡ *)
tmp
->
d©a
, 
loÿË
))

296 ià(!
tmp
)

297 
i
 = 
G_MAXINT
;

298  
i
;

299 
	}
}

	@O:\tool\dvs50\lib\intl.h

1 #iâdeà
INTL_H


2 
	#INTL_H


	)

4 
	~<glib.h
>

5 
	~"dŸv¬.h
"

6 #ifdeà
GNOME


7 
	~<libgnome/gnome-i18n.h
>

9 #ifdeà
ENABLE_NLS


10 
	~<libš.h
>

11 
	#_
(
SŒšg
è
	`g‘‹xt
(SŒšg)

	)

12 #ifdeà
g‘‹xt_noİ


13 
	#N_
(
SŒšg
è
	`g‘‹xt_noİ
(SŒšg)

	)

15 
	#N_
(
SŒšg
è(SŒšg)

	)

18 
	#_
(
SŒšg
è(SŒšg)

	)

19 
	#N_
(
SŒšg
è(SŒšg)

	)

20 
	#g‘‹xt
(
SŒšg
è(SŒšg)

	)

21 
	#‹xtdomaš
(
Domaš
)

	)

22 
	#bšd‹xtdomaš
(
Package
, 
DœeùÜy
)

	)

26 cÚ¡ 
GLi¡
 *
š_g‘_Ïnguage_li¡
 ();

27 
DIAVAR
 
š_scÜe_loÿË
 (cÚ¡ 
gch¬
 *
loÿË
);

	@O:\tool\dvs50\lib\layer.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~"š.h
"

24 
	~"dŸg¿md©a.h
"

25 
	~"dŸ»nd””.h
"

26 
	~"dyÇmic_obj.h
"

28 cÚ¡ 
ReùªgË
 
	gšv®id_ex‹Ás
 = { -1.0,-1.0,-1.0,-1.0 };

38 
	$nÜm®_»nd”
(
DŸObjeù
 *
obj
, 
DŸR’d””
 *
»nd””
,

39 
aùive_Ïy”
,

40 
gpoš‹r
 
d©a
)

42 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_objeù
Ô’d””, 
obj
);

43 
	}
}

46 
	g»nd”_boundšg_boxes
 = 
FALSE
;

59 
	$Ïy”_»nd”
(
Lay”
 *
Ïy”
, 
DŸR’d””
 *
»nd””
, 
ReùªgË
 *
upd©e
,

60 
ObjeùR’d””
 
obj_»nd””
,

61 
gpoš‹r
 
d©a
,

62 
aùive_Ïy”
)

64 
GLi¡
 *
li¡
;

65 
DŸObjeù
 *
obj
;

67 ià(
obj_»nd””
 =ğ
NULL
)

68 
obj_»nd””
 = 
nÜm®_»nd”
;

71 
li¡
 = 
Ïy”
->
objeùs
;

72 
li¡
!=
NULL
) {

73 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

75 ià(
upd©e
==
NULL
 || 
	`»ùªgË_š‹r£ùs
(upd©e, &
obj
->
boundšg_box
)) {

76 ià((
»nd”_boundšg_boxes
è&& (
»nd””
->
is_š‹¿ùive
)) {

77 
Pošt
 
p1
, 
p2
;

78 
CŞÜ
 
cŞ
;

79 
p1
.
x
 = 
obj
->
boundšg_box
.
Ëá
;

80 
p1
.
y
 = 
obj
->
boundšg_box
.
tİ
;

81 
p2
.
x
 = 
obj
->
boundšg_box
.
right
;

82 
p2
.
y
 = 
obj
->
boundšg_box
.
bÙtom
;

83 
cŞ
.
»d
 = 1.0;

84 
cŞ
.
g»’
 = 0.0;

85 
cŞ
.
blue
 = 1.0;

87 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
(renderer,0.01);

88 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_»ù
Ô’d””, &
p1
, &
p2
, &
cŞ
);

90 (*
obj_»nd””
)(
obj
, 
»nd””
, 
aùive_Ïy”
, 
d©a
);

93 
li¡
 = 
	`g_li¡_Ãxt
(list);

95 
	}
}

102 
	$£t_·»Á_Ïy”
(
gpoš‹r
 
–em’t
, gpoš‹¸
u£r_d©a
)

104 ((
DŸObjeù
*)
–em’t
)->
·»Á_Ïy”
 = (
Lay”
*)
u£r_d©a
;

109 
	}
}

122 
	$Ïy”_objeù_šdex
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
obj
)

124  ()
	`g_li¡_šdex
(
Ïy”
->
objeùs
, (
gpoš‹r
è
obj
);

125 
	}
}

135 
	$Ïy”_add_objeù
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
obj
)

137 
Ïy”
->
objeùs
 = 
	`g_li¡_­³nd
Öay”->objeùs, (
gpoš‹r
è
obj
);

138 
	`£t_·»Á_Ïy”
(
obj
, 
Ïy”
);

141 
	`d©a_em™
 (
	`Ïy”_g‘_·»Á_dŸg¿m
(
Ïy”
),†ay”, 
obj
, "object_add");

142 
	}
}

151 
	$Ïy”_add_objeù_©
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
obj
, 
pos
)

153 
Ïy”
->
objeùs
 = 
	`g_li¡_š£¹
Öay”->objeùs, (
gpoš‹r
è
obj
, 
pos
);

154 
	`£t_·»Á_Ïy”
(
obj
, 
Ïy”
);

157 
	`d©a_em™
 (
	`Ïy”_g‘_·»Á_dŸg¿m
(
Ïy”
),†ay”, 
obj
, "object_add");

158 
	}
}

167 
	$Ïy”_add_objeùs
(
Lay”
 *
Ïy”
, 
GLi¡
 *
obj_li¡
)

169 
GLi¡
 *
li¡
 = 
obj_li¡
;

171 
Ïy”
->
objeùs
 = 
	`g_li¡_cÚÿt
Öay”->objeùs, 
obj_li¡
);

172 
	`g_li¡_fÜ—ch
(
obj_li¡
, 
£t_·»Á_Ïy”
, 
Ïy”
);

174 
li¡
 !ğ
NULL
)

176 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

178 
	`d©a_em™
 (
	`Ïy”_g‘_·»Á_dŸg¿m
(
Ïy”
),†ay”, 
obj
, "object_add");

180 
li¡
 = 
	`g_li¡_Ãxt
(list);

182 
	}
}

191 
	$Ïy”_add_objeùs_fœ¡
(
Lay”
 *
Ïy”
, 
GLi¡
 *
obj_li¡
)

193 
GLi¡
 *
li¡
 = 
obj_li¡
;

195 
Ïy”
->
objeùs
 = 
	`g_li¡_cÚÿt
(
obj_li¡
,†ayer->objects);

196 
	`g_li¡_fÜ—ch
(
obj_li¡
, 
£t_·»Á_Ïy”
, 
Ïy”
);

199 
li¡
 !ğ
NULL
)

201 
DŸObjeù
 *
obj
 = (DŸObjeù *)
li¡
->
d©a
;

203 
	`d©a_em™
 (
	`Ïy”_g‘_·»Á_dŸg¿m
(
Ïy”
),†ay”, 
obj
, "object_add");

205 
li¡
 = 
	`g_li¡_Ãxt
(list);

208 
	}
}

216 
	$Ïy”_»move_objeù
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
obj
)

218 
pos
 = 
	`g_li¡_šdex
(
Ïy”
->
objeùs
,
obj
);

219 
gpoš‹r
 
rm
 = 
	`g_li¡_Áh_d©a
(
Ïy”
->
deâames
,
pos
);

220 
Ïy”
->
deâames
 = 
	`g_li¡_»move
Öay”->deâames,
rm
);

223 
Ïy”
->
objeùs
 = 
	`g_li¡_»move
Öay”->objeùs, 
obj
);

225 
	`dynobj_li¡_»move_objeù
(
obj
);

226 
	`£t_·»Á_Ïy”
(
obj
, 
NULL
);

229 
	`d©a_em™
 (
	`Ïy”_g‘_·»Á_dŸg¿m
(
Ïy”
),†ay”, 
obj
, "object_remove");

230 
	}
}

238 
	$Ïy”_»move_objeùs
(
Lay”
 *
Ïy”
, 
GLi¡
 *
obj_li¡
)

240 
DŸObjeù
 *
obj
;

241 
obj_li¡
 !ğ
NULL
) {

242 
obj
 = (
DŸObjeù
 *è
obj_li¡
->
d©a
;

243 
pos
 = 
	`g_li¡_šdex
(
Ïy”
->
objeùs
,
obj
);

244 
gpoš‹r
 
rm
 = 
	`g_li¡_Áh_d©a
(
Ïy”
->
deâames
,
pos
);

245 
Ïy”
->
deâames
 = 
	`g_li¡_»move
Öay”->deâames,
rm
);

248 
Ïy”
->
objeùs
 = 
	`g_li¡_»move
Öay”->objeùs, 
obj
);

250 
obj_li¡
 = 
	`g_li¡_Ãxt
(obj_list);

251 
	`dynobj_li¡_»move_objeù
(
obj
);

252 
	`£t_·»Á_Ïy”
(
obj
, 
NULL
);

254 
	`d©a_em™
 (
	`Ïy”_g‘_·»Á_dŸg¿m
(
Ïy”
),†ay”, 
obj
, "object_remove");

256 
	}
}

264 
GLi¡
 *

265 
	$Ïy”_fšd_objeùs_š‹r£ùšg_»ùªgË
(
Lay”
 *
Ïy”
, 
ReùªgË
 *
»ù
)

267 
GLi¡
 *
li¡
;

268 
GLi¡
 *
£Ëùed_li¡
;

269 
DŸObjeù
 *
obj
;

271 
£Ëùed_li¡
 = 
NULL
;

272 
li¡
 = 
Ïy”
->
objeùs
;

273 
li¡
 !ğ
NULL
) {

274 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

276 ià(
	`»ùªgË_š‹r£ùs
(
»ù
, &
obj
->
boundšg_box
)) {

277 ià(
	`dŸ_objeù_is_£ËùabË
(
obj
)) {

278 
£Ëùed_li¡
 = 
	`g_li¡_´•’d
(£Ëùed_li¡, 
obj
);

285 
li¡
 = 
	`g_li¡_Ãxt
(list);

288  
£Ëùed_li¡
;

289 
	}
}

297 
GLi¡
 *

298 
	$Ïy”_fšd_objeùs_š_»ùªgË
(
Lay”
 *
Ïy”
, 
ReùªgË
 *
»ù
)

300 
GLi¡
 *
li¡
;

301 
GLi¡
 *
£Ëùed_li¡
;

302 
DŸObjeù
 *
obj
;

304 
£Ëùed_li¡
 = 
NULL
;

305 
li¡
 = 
Ïy”
->
objeùs
;

306 
li¡
 !ğ
NULL
) {

307 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

309 ià(
	`»ùªgË_š_»ùªgË
(
»ù
, &
obj
->
boundšg_box
)) {

310 ià(
	`dŸ_objeù_is_£ËùabË
(
obj
)) {

311 
£Ëùed_li¡
 = 
	`g_li¡_´•’d
(£Ëùed_li¡, 
obj
);

315 
li¡
 = 
	`g_li¡_Ãxt
(list);

318  
£Ëùed_li¡
;

319 
	}
}

327 
GLi¡
 *

328 
	$Ïy”_fšd_objeùs_cÚššg_»ùªgË
(
Lay”
 *
Ïy”
, 
ReùªgË
 *
»ù
)

330 
GLi¡
 *
li¡
;

331 
GLi¡
 *
£Ëùed_li¡
;

332 
DŸObjeù
 *
obj
;

334 
£Ëùed_li¡
 = 
NULL
;

335 
li¡
 = 
Ïy”
->
objeùs
;

336 
li¡
 !ğ
NULL
) {

337 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

339 ià(
	`»ùªgË_š_»ùªgË
(&
obj
->
boundšg_box
, 
»ù
)) {

340 ià(
	`dŸ_objeù_is_£ËùabË
(
obj
)) {

341 
£Ëùed_li¡
 = 
	`g_li¡_´•’d
(£Ëùed_li¡, 
obj
);

345 
li¡
 = 
	`g_li¡_Ãxt
(list);

348  
£Ëùed_li¡
;

349 
	}
}

362 
DŸObjeù
 *

363 
	$Ïy”_fšd_şo£¡_objeù_exû±
(
Lay”
 *
Ïy”
, 
Pošt
 *
pos
,

364 
»®
 
maxdi¡
, 
GLi¡
 *
avoid
)

366 
GLi¡
 *
l
;

367 
DŸObjeù
 *
şo£¡
;

368 
DŸObjeù
 *
obj
;

369 
»®
 
di¡
;

370 
GLi¡
 *
avoid_tmp
;

372 
şo£¡
 = 
NULL
;

374 
l
 = 
Ïy”
->
objeùs
;†!=
NULL
;† = 
	`g_li¡_Ãxt
(l)) {

375 
obj
 = (
DŸObjeù
 *è
l
->
d©a
;

378 
di¡
 = 
obj
->
İs
->
	`di¡ªû_äom
(obj, 
pos
);

380 ià(
maxdi¡
-
di¡
 > 0.00000001) {

381 
avoid_tmp
 = 
avoid
;‡void_tm°!ğ
NULL
;‡void_tm°ğavoid_tmp->
Ãxt
) {

382 ià(
avoid_tmp
->
d©a
 =ğ
obj
) {

383 
NEXTOBJECT
;

386 
şo£¡
 = 
obj
;

388 
NEXTOBJECT
:

393 
şo£¡
 = 
	`dŸ_objeù_g‘_·»Á_w™h_æags
(closest,

394 
DIA_OBJECT_GRABS_CHILD_INPUT
);

396  
şo£¡
;

397 
	}
}

407 
DŸObjeù
 *

408 
	$Ïy”_fšd_şo£¡_objeù
(
Lay”
 *
Ïy”
, 
Pošt
 *
pos
, 
»®
 
maxdi¡
)

410  
	`Ïy”_fšd_şo£¡_objeù_exû±
(
Ïy”
, 
pos
, 
maxdi¡
, 
NULL
);

411 
	}
}

421 
»®


422 
	$Ïy”_fšd_şo£¡_cÚÃùiÚpošt
(
Lay”
 *
Ïy”
,

423 
CÚÃùiÚPošt
 **
şo£¡
,

424 
Pošt
 *
pos
,

425 
DŸObjeù
 *
nÙthis
)

427 
GLi¡
 *
l
;

428 
DŸObjeù
 *
obj
;

429 
CÚÃùiÚPošt
 *
ı
;

430 
»®
 
mšdi¡
, 
di¡
;

431 
i
;

433 
mšdi¡
 = 1000000.0;

435 *
şo£¡
 = 
NULL
;

437 
l
 = 
Ïy”
->
objeùs
;†!=
NULL
;† = 
	`g_li¡_Ãxt
(l) ) {

438 
obj
 = (
DŸObjeù
 *è
l
->
d©a
;

440 ià(
obj
 =ğ
nÙthis
) ;

441 ià(
obj
 !ğ
	`dŸ_objeù_g‘_·»Á_w™h_æags
(obj, 
DIA_OBJECT_GRABS_CHILD_INPUT
))

443 
i
=0;i<
obj
->
num_cÚÃùiÚs
;i++) {

444 
ı
 = 
obj
->
cÚÃùiÚs
[
i
];

446 
di¡
 = 
	`di¡ªû_pošt_pošt_mªh©n
(
pos
, &
ı
->pos);

447 ià(
di¡
<
mšdi¡
) {

448 
mšdi¡
 = 
di¡
;

449 *
şo£¡
 = 
ı
;

455  
mšdi¡
;

456 
	}
}

459 
	$Ïy”_upd©e_ex‹Ás
(
Lay”
 *
Ïy”
)

461 
GLi¡
 *
l
;

462 
DŸObjeù
 *
obj
;

463 
ReùªgË
 
Ãw_ex‹Ás
;

465 
l
 = 
Ïy”
->
objeùs
;

466 ià(
l
!=
NULL
) {

467 
obj
 = (
DŸObjeù
 *è
l
->
d©a
;

468 
Ãw_ex‹Ás
 = 
obj
->
boundšg_box
;

469 
l
 = 
	`g_li¡_Ãxt
(l);

471 
l
!=
NULL
) {

472 cÚ¡ 
ReùªgË
 *
bbox
;

473 
obj
 = (
DŸObjeù
 *è
l
->
d©a
;

475 
bbox
 = &
obj
->
boundšg_box
;

476 ià(
bbox
->
right
 > bbox->
Ëá
 && bbox->
bÙtom
 > bbox->
tİ
)

477 
	`»ùªgË_uniÚ
(&
Ãw_ex‹Ás
, &
obj
->
boundšg_box
);

478 
l
 = 
	`g_li¡_Ãxt
(l);

481 
Ãw_ex‹Ás
 = 
šv®id_ex‹Ás
;

484 ià(
	`»ùªgË_equ®s
(&
Ãw_ex‹Ás
,&
Ïy”
->
ex‹Ás
)è 
FALSE
;

486 
Ïy”
->
ex‹Ás
 = 
Ãw_ex‹Ás
;

487  
TRUE
;

488 
	}
}

491 
	$Ïy”_»¶aû_objeù_w™h_li¡
(
Lay”
 *
Ïy”
, 
DŸObjeù
 *
»move_obj
,

492 
GLi¡
 *
š£¹_li¡
)

494 
GLi¡
 *
li¡
;

496 
li¡
 = 
	`g_li¡_fšd
(
Ïy”
->
objeùs
, 
»move_obj
);

498 
	`g_as£¹
(
li¡
!=
NULL
);

499 
	`£t_·»Á_Ïy”
(
»move_obj
, 
NULL
);

500 
	`dynobj_li¡_»move_objeù
(
»move_obj
);

501 
	`g_li¡_fÜ—ch
(
š£¹_li¡
, 
£t_·»Á_Ïy”
, 
Ïy”
);

503 ià(
li¡
->
´ev
 =ğ
NULL
) {

504 
Ïy”
->
objeùs
 = 
š£¹_li¡
;

506 
li¡
->
´ev
->
Ãxt
 = 
š£¹_li¡
;

507 
š£¹_li¡
->
´ev
 = 
li¡
->prev;

509 ià(
li¡
->
Ãxt
 !ğ
NULL
) {

510 
GLi¡
 *
Ï¡
;

511 
Ï¡
 = 
	`g_li¡_Ï¡
(
š£¹_li¡
);

512 
Ï¡
->
Ãxt
 = 
li¡
->next;

513 
li¡
->
Ãxt
->
´ev
 = 
Ï¡
;

515 
	`g_li¡_ä“_1
(
li¡
);

516 
	}
}

519 
	$Ïy”_»move_dynobj
(
gpoš‹r
 
obj
, gpoš‹¸
u£rd©a
)

521 
	`dynobj_li¡_»move_objeù
((
DŸObjeù
*)
obj
);

522 
	}
}

524 
	$Ïy”_£t_objeù_li¡
(
Lay”
 *
Ïy”
, 
GLi¡
 *
li¡
)

526 
	`g_li¡_fÜ—ch
(
Ïy”
->
objeùs
, 
£t_·»Á_Ïy”
, 
NULL
);

527 
	`g_li¡_fÜ—ch
(
Ïy”
->
objeùs
, 
Ïy”_»move_dynobj
, 
NULL
);

528 
	`g_li¡_ä“
(
Ïy”
->
objeùs
);

529 
Ïy”
->
objeùs
 = 
li¡
;

530 
	`g_li¡_fÜ—ch
(
Ïy”
->
objeùs
, 
£t_·»Á_Ïy”
,†ayer);

531 
	}
}

533 
DŸg¿mD©a
 *

534 
	$Ïy”_g‘_·»Á_dŸg¿m
(
Lay”
 *
Ïy”
)

536  
Ïy”
->
·»Á_dŸg¿m
;

537 
	}
}

	@O:\tool\dvs50\lib\message.c

19 
	~<cÚfig.h
>

21 
	~<¡dio.h
>

22 
	~<¡ršg.h
>

23 
	~<¡d¬g.h
>

24 
	#G_LOG_DOMAIN
 "DŸ"

	)

25 
	~<gtk/gtk.h
>

26 
	~<glib.h
>

28 
	~"š.h
"

29 
	~"uts.h
"

30 
	~"mes§ge.h
"

31 
	~"³rsi¡’û.h
"

33 
GHashTabË
 *
	gmes§ge_hash_bË
;

36 cÚ¡ 
gch¬
 *
	mt™Ë
;

37 
GtkWidg‘
 *
	mdŸlog
;

38 
GtkWidg‘
 *
	m»³©_Ïb–
;

39 
GLi¡
 *
	m»³©s
;

40 
GtkWidg‘
 *
	m»³©_v›w
;

41 
GtkWidg‘
 *
	mshow_»³©s
;

42 
GtkWidg‘
 *
	mno_show_agaš
;

43 } 
	tDŸMes§geInfo
;

46 
	$gtk_mes§ge_toggË_»³©s
(
GtkWidg‘
 *
bu‰Ú
, 
gpoš‹r
 *
u£rd©a
) {

47 
DŸMes§geInfo
 *
msgšfo
 = (DŸMes§geInfo*)
u£rd©a
;

48 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
bu‰Ú
)))

49 
	`gtk_widg‘_show
(
msgšfo
->
»³©_v›w
);

51 
	`gtk_widg‘_hide
(
msgšfo
->
»³©_v›w
);

52 
	`gtk_cÚš”_check_»size
(
	`GTK_CONTAINER
(
msgšfo
->
dŸlog
));

54 
	}
}

57 
	$gtk_mes§ge_toggË_show_agaš
(
GtkWidg‘
 *
bu‰Ú
, 
gpoš‹r
 *
u£rd©a
)

59 
DŸMes§geInfo
 *
msgšfo
 = (DŸMes§geInfo*)
u£rd©a
;

60 
	`³rsi¡’û_£t_boŞ—n
(
msgšfo
->
t™Ë
,

61 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
bu‰Ú
)));

62 
	}
}

65 
	$mes§ge_dŸlog_de¡royed
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
u£rd©a
)

67 
DŸMes§geInfo
 *
msgšfo
 = (DŸMes§geInfØ*)
u£rd©a
;

69 
msgšfo
->
t™Ë
 = 
NULL
;

70 
msgšfo
->
dŸlog
 = 
NULL
;

71 
msgšfo
->
»³©_Ïb–
 = 
NULL
;

72 
msgšfo
->
»³©_v›w
 = 
NULL
;

73 
msgšfo
->
show_»³©s
 = 
NULL
;

74 
msgšfo
->
no_show_agaš
 = 
NULL
;

75 
	}
}

81 
	$mes§ge_ü—‹_dŸlog
(cÚ¡ 
gch¬
 *
t™Ë
, 
DŸMes§geInfo
 *
msgšfo
, gch¬ *
buf
)

83 
GtkWidg‘
 *
dŸlog
 = 
NULL
;

84 
GtkTextBufãr
 *
‹xtbufãr
;

85 
GtkMes§geTy³
 
ty³
 = 
GTK_MESSAGE_INFO
;

86 
GLi¡
 *
»³©s
;

89 ià(
t™Ë
) {

90 ià(0 =ğ
	`¡rcmp
 (
t™Ë
, 
	`_
("Error")))

91 
ty³
 = 
GTK_MESSAGE_ERROR
;

92 ià(0 =ğ
	`¡rcmp
 (
t™Ë
, 
	`_
("Warning")))

93 
ty³
 = 
GTK_MESSAGE_WARNING
;

95 ià(
msgšfo
->
»³©s
 !ğ
NULL
)

96 
buf
 = (
gch¬
 *)
msgšfo
->
»³©s
->
d©a
;

97 
dŸlog
 = 
	`gtk_mes§ge_dŸlog_Ãw
 (
NULL
,

99 
ty³
,

100 
GTK_BUTTONS_CLOSE
,

101 "%s", 
buf
);

102 ià(
t™Ë
) {

103 
gch¬
 *
»®_t™Ë
;

105 
msgšfo
->
t™Ë
 =itle;

106 
»®_t™Ë
 = 
	`g_¡rdup_´štf
 ("DŸ: %s", 
t™Ë
);

107 
	`gtk_wšdow_£t_t™Ë
 (
	`GTK_WINDOW
(
dŸlog
), 
»®_t™Ë
);

108 
	`g_ä“
 (
»®_t™Ë
);

110 
	`gtk_widg‘_show
 (
dŸlog
);

111 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
dŸlog
), "response",

112 
	`G_CALLBACK
 (
gtk_widg‘_hide
),

113 
NULL
);

114 
msgšfo
->
dŸlog
 = dialog;

115 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
dŸlog
), "destroy",

116 
	`G_CALLBACK
 (
mes§ge_dŸlog_de¡royed
),

117 
msgšfo
);

119 
msgšfo
->
»³©_Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("There is one similar message."));

120 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
msgšfo
->
dŸlog
)->
vbox
),

121 
msgšfo
->
»³©_Ïb–
);

123 
msgšfo
->
show_»³©s
 =

124 
	`gtk_check_bu‰Ú_Ãw_w™h_Ïb–
(
	`_
("Show„epeated messages"));

125 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
msgšfo
->
dŸlog
)->
vbox
),

126 
msgšfo
->
show_»³©s
);

127 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
msgšfo
->
show_»³©s
), "toggled",

128 
	`G_CALLBACK
(
gtk_mes§ge_toggË_»³©s
), 
msgšfo
);

130 
msgšfo
->
»³©_v›w
 = 
	`gtk_‹xt_v›w_Ãw
();

131 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
msgšfo
->
dŸlog
)->
vbox
),

132 
msgšfo
->
»³©_v›w
);

133 
	`gtk_‹xt_v›w_£t_ed™abË
(
	`GTK_TEXT_VIEW
(
msgšfo
->
»³©_v›w
), 
FALSE
);

135 
‹xtbufãr
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
	`GTK_TEXT_VIEW
(
msgšfo
->
»³©_v›w
));

136 ià(
msgšfo
->
»³©s
 !ğ
NULL
) {

137 
»³©s
 = 
msgšfo
->repeats;

138 
»³©s
 =„•—ts->
Ãxt
;

139 ; 
»³©s
 !ğ
NULL
;„•—t ğ»³©s->
Ãxt
) {

140 
	`gtk_‹xt_bufãr_š£¹_©_cursÜ
(
‹xtbufãr
, (
gch¬
*)
»³©s
->
d©a
, -1);

144 
msgšfo
->
no_show_agaš
 =

145 
	`gtk_check_bu‰Ú_Ãw_w™h_Ïb–
(
	`_
("Don't showhis message‡gain"));

146 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
	`GTK_DIALOG
(
msgšfo
->
dŸlog
)->
vbox
),

147 
msgšfo
->
no_show_agaš
);

148 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
msgšfo
->
no_show_agaš
), "toggled",

149 
	`G_CALLBACK
(
gtk_mes§ge_toggË_show_agaš
), 
msgšfo
);

150 
	}
}

153 
	$gtk_mes§ge_š‹º®
(cÚ¡ * 
t™Ë
, 
ShowAgašStyË
 
showAgaš
,

154 cÚ¡ *
fmt
,

155 
va_li¡
 *
¬gs
, va_li¡ *
¬gs2
)

157 
gch¬
 *
buf
 = 
NULL
;

158 
gšt
 
®loc
 = 0;

159 
gšt
 
Ën
;

160 
DŸMes§geInfo
 *
msgšfo
;

161 
GtkTextBufãr
 *
‹xtbufãr
;

162 
gboŞ—n
 
askFÜShowAgaš
 = 
FALSE
;

164 ià(
showAgaš
 !ğ
ALWAYS_SHOW
) {

167 
	`³rsi¡’û_»gi¡”_boŞ—n
((
gch¬
 *)
t™Ë
, 
FALSE
);

168 ià(
	`³rsi¡’û_g‘_boŞ—n
((
gch¬
 *)
t™Ë
)) {

172 
askFÜShowAgaš
 = 
TRUE
;

175 ià(
mes§ge_hash_bË
 =ğ
NULL
) {

176 
mes§ge_hash_bË
 = 
	`g_hash_bË_Ãw
(
g_¡r_hash
, 
g_¡r_equ®
);

179 
Ën
 = 
	`fÜm©_¡ršg_Ëngth_uµ”_bound
 (
fmt
, 
¬gs
);

181 ià(
Ën
 >ğ
®loc
) {

182 ià(
buf
)

183 
	`g_ä“
 (
buf
);

185 
®loc
 = 
	`Ã¬e¡_pow
 (
	`MAX
(
Ën
 + 1, 1024));

187 
buf
 = 
	`g_Ãw
 (, 
®loc
);

190 
	`v¥rštf
 (
buf
, 
fmt
, *
¬gs2
);

192 
msgšfo
 = (
DŸMes§geInfo
*)
	`g_hash_bË_lookup
(
mes§ge_hash_bË
, 
fmt
);

193 ià(
msgšfo
 =ğ
NULL
) {

194 
msgšfo
 = 
	`g_Ãw0
(
DŸMes§geInfo
, 1);

195 
	`g_hash_bË_š£¹
(
mes§ge_hash_bË
, (*)
fmt
, 
msgšfo
);

197 ià(
msgšfo
->
dŸlog
 =ğ
NULL
)

198 
	`mes§ge_ü—‹_dŸlog
(
t™Ë
, 
msgšfo
, 
buf
);

200 ià(
msgšfo
->
»³©s
 !ğ
NULL
) {

201 ià(
	`g_li¡_Ëngth
(
msgšfo
->
»³©s
) > 1) {

202 *
ÃwÏb–
;

203 
ÃwÏb–
 = 
	`g_¡rdup_´štf
(
	`_
("There‡re %d similar messages."),

204 
	`g_li¡_Ëngth
(
msgšfo
->
»³©s
));

205 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
msgšfo
->
»³©_Ïb–
), 
ÃwÏb–
);

207 
	`gtk_widg‘_show
(
msgšfo
->
»³©_Ïb–
);

208 
	`gtk_widg‘_show
(
msgšfo
->
show_»³©s
);

212 ià(
msgšfo
->
»³©s
 !ğ
NULL
) {

213 
‹xtbufãr
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
	`GTK_TEXT_VIEW
(
msgšfo
->
»³©_v›w
));

214 
	`gtk_‹xt_bufãr_š£¹_©_cursÜ
(
‹xtbufãr
, 
buf
, -1);

217 
msgšfo
->
»³©s
 = 
	`g_li¡_­³nd
(msgšfo->»³©s, 
	`g_¡rdup
(
buf
));

219 ià(
askFÜShowAgaš
) {

220 
	`gtk_widg‘_show
(
msgšfo
->
no_show_agaš
);

221 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
msgšfo
->
no_show_agaš
),

222 
showAgaš
 =ğ
SUGGEST_NO_SHOW_AGAIN
);

224 
	`gtk_widg‘_hide
(
msgšfo
->
no_show_agaš
);

227 
	`gtk_widg‘_show
 (
msgšfo
->
dŸlog
);

228 
	}
}

230 
Mes§geIÁ”Çl
 
	gmes§ge_š‹º®
 = 
gtk_mes§ge_š‹º®
;

233 
	$£t_mes§ge_func
(
Mes§geIÁ”Çl
 
func
)

235 
	`g_as£¹
(
func
);

236 
mes§ge_š‹º®
 = 
func
;

237 
	}
}

240 
	$mes§ge
(cÚ¡ *
t™Ë
, cÚ¡ *
fÜm©
, ...)

242 
va_li¡
 
¬gs
, 
¬gs2
;

244 
	`va_¡¬t
 (
¬gs
, 
fÜm©
);

245 
	`va_¡¬t
 (
¬gs2
, 
fÜm©
);

246 
	`mes§ge_š‹º®
(
t™Ë
, 
ALWAYS_SHOW
, 
fÜm©
, &
¬gs
, &
¬gs2
);

247 
	`va_’d
 (
¬gs
);

248 
	`va_’d
 (
¬gs2
);

249 
	}
}

256 
	$mes§ge_nÙiû
(cÚ¡ *
fÜm©
, ...)

258 
va_li¡
 
¬gs
, 
¬gs2
;

260 
	`va_¡¬t
 (
¬gs
, 
fÜm©
);

261 
	`va_¡¬t
 (
¬gs2
, 
fÜm©
);

262 
	`mes§ge_š‹º®
(
	`_
("NÙiû"), 
SUGGEST_NO_SHOW_AGAIN
, 
fÜm©
, &
¬gs
, &
¬gs2
);

263 
	`va_’d
 (
¬gs
);

264 
	`va_’d
 (
¬gs2
);

265 
	}
}

272 
	$mes§ge_w¬nšg
(cÚ¡ *
fÜm©
, ...)

274 
va_li¡
 
¬gs
, 
¬gs2
;

276 
	`va_¡¬t
 (
¬gs
, 
fÜm©
);

277 
	`va_¡¬t
 (
¬gs2
, 
fÜm©
);

278 
	`mes§ge_š‹º®
(
	`_
("W¬nšg"), 
SUGGEST_SHOW_AGAIN
, 
fÜm©
, &
¬gs
, &
¬gs2
);

279 
	`va_’d
 (
¬gs
);

280 
	`va_’d
 (
¬gs2
);

281 
	}
}

287 
	$mes§ge_”rÜ
(cÚ¡ *
fÜm©
, ...)

289 
va_li¡
 
¬gs
, 
¬gs2
;

291 
	`va_¡¬t
 (
¬gs
, 
fÜm©
);

292 
	`va_¡¬t
 (
¬gs2
, 
fÜm©
);

293 
	`mes§ge_š‹º®
(
	`_
("E¼Ü"), 
ALWAYS_SHOW
, 
fÜm©
, &
¬gs
, &
¬gs2
);

294 
	`va_’d
 (
¬gs
);

295 
	`va_’d
 (
¬gs2
);

296 
	}
}

298 
gboŞ—n
 
	glog_’abËd
 = 
FALSE
;

300 
	$dŸ_log_mes§ge_’abË
 (
gboŞ—n
 
yes
)

302 
log_’abËd
 = 
yes
;

303 
	}
}

306 
	$dŸ_log_mes§ge
 (cÚ¡ *
fÜm©
, ...)

308 
GTim”
 *
tim”
 = 
NULL
;

309 *
log
;

310 
va_li¡
 
¬gs
;

312 ià(!
log_’abËd
)

315 ià(!
tim”
)

316 
tim”
 = 
	`g_tim”_Ãw
 ();

318 
	`va_¡¬t
 (
¬gs
, 
fÜm©
);

319 
log
 = 
	`g_¡rdup_v´štf
 (
fÜm©
, 
¬gs
);

320 
	`va_’d
 (
¬gs
);

322 
	`g_mes§ge
 ("t=%.03à- %s", 
	`g_tim”_–­£d
 (
tim”
, 
NULL
), 
log
);

323 
	`g_ä“
 (
log
);

324 
	}
}

	@O:\tool\dvs50\lib\message.h

18 #iâdeà
MESSAGE_H


19 
	#MESSAGE_H


	)

21 
	~<¡d¬g.h
>

22 
	~"dŸv¬.h
"

23 
G_BEGIN_DECLS


25 
	eShowAgašStyË
 {

26 
	mALWAYS_SHOW
,

27 
	mSUGGEST_SHOW_AGAIN
,

28 
	mSUGGEST_NO_SHOW_AGAIN


31 (*
	tMes§geIÁ”Çl
)(cÚ¡ *
	tt™Ë
, 
	tShowAgašStyË
 
	tshowAgaš
,

32 cÚ¡ *
	tfmt
,

33 
	tva_li¡
 *
	t¬gs
, va_li¡ *
	t¬gs2
);

35 
DIAVAR
 
	`£t_mes§ge_func
(
Mes§geIÁ”Çl
 
func
);

36 
	`mes§ge
(cÚ¡ *
t™Ë
, cÚ¡ *
fÜm©
, ...);

37 
DIAVAR
 
	`mes§ge_nÙiû
(cÚ¡ *
fÜm©
, ...);

38 
DIAVAR
 
	`mes§ge_w¬nšg
(cÚ¡ *
fÜm©
, ...);

39 
DIAVAR
 
	`mes§ge_”rÜ
(cÚ¡ *
fÜm©
, ...);

41 
DIAVAR
 
	`dŸ_log_mes§ge
(cÚ¡ *
fÜm©
, ...);

42 
	`dŸ_log_mes§ge_’abË
 (
gboŞ—n
 
yes
);

44 
DIAVAR
 cÚ¡ 
gch¬
 *
	`dŸ_mes§ge_f’ame
 (cÚ¡ gch¬ *
f’ame
);

46 
G_END_DECLS


	@O:\tool\dvs50\lib\newgroup.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<as£¹.h
>

24 
	~<m©h.h
>

26 
	~"š.h
"

27 
	~"objeù.h
"

28 
	~"–em’t.h
"

29 
	~"cÚÃùiÚpošt.h
"

30 
	~"dŸ»nd””.h
"

31 
	~"©Œibu‹s.h
"

32 
	~"widg‘s.h
"

33 
	~"mes§ge.h
"

34 
	~"´İ”t›s.h
"

35 
	~"dŸg¿md©a.h
"

36 
	~"·»Á.h
"

37 
	~"Ãwgroup.h
"

39 
	~"../objeùs/Misc/pixm­s/Ãwgroup.xpm
"

41 
	#NUM_CONNECTIONS
 9

	)

43 
	#DEFAULT_WIDTH
 2

	)

44 
	#DEFAULT_HEIGHT
 2

	)

46 
_Group
 
	tNewGroup
;

48 
	s_Group
 {

49 
EËm’t
 
	m–em’t
;

51 
gboŞ—n
 
	mis_İ’
;

52 
CÚÃùiÚPošt
 
	mcÚÃùiÚs
[
NUM_CONNECTIONS
];

55 
»®
 
Ãwgroup_di¡ªû_äom
(
NewGroup
 *
group
, 
Pošt
 *
pošt
);

56 
Ãwgroup_£Ëù
(
NewGroup
 *
group
, 
Pošt
 *
şicked_pošt
,

57 
DŸR’d””
 *
š‹¿ùive_»nd””
);

58 
ObjeùChªge
* 
Ãwgroup_move_hªdË
(
NewGroup
 *
group
, 
HªdË
 *
hªdË
,

59 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

60 
HªdËMoveR—sÚ
 
»asÚ
,

61 
Modif›rKeys
 
modif›rs
);

62 
ObjeùChªge
* 
Ãwgroup_move
(
NewGroup
 *
group
, 
Pošt
 *
to
);

63 
Ãwgroup_d¿w
(
NewGroup
 *
group
, 
DŸR’d””
 *
»nd””
);

64 
Ãwgroup_upd©e_d©a
(
NewGroup
 *
group
);

65 
DŸObjeù
 *
Ãwgroup_ü—‹
(
Pošt
 *
¡¬ošt
,

66 *
u£r_d©a
,

67 
HªdË
 **
hªdË1
,

68 
HªdË
 **
hªdË2
);

69 
Ãwgroup_de¡roy
(
NewGroup
 *
group
);

70 
DŸObjeù
 *
Ãwgroup_cİy
(
NewGroup
 *
group
);

72 
PrİDesütiÚ
 *
Ãwgroup_desüibe_´İs
(
NewGroup
 *
group
);

73 
Ãwgroup_g‘_´İs
(
NewGroup
 *
group
, 
GPŒA¼ay
 *
´İs
);

74 
Ãwgroup_£t_´İs
(
NewGroup
 *
group
, 
GPŒA¼ay
 *
´İs
);

76 
Ãwgroup_§ve
(
NewGroup
 *
group
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
);

77 
DŸObjeù
 *
Ãwgroup_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
);

79 
ObjeùTy³Ops
 
	gÃwgroup_ty³_İs
 =

81 (
C»©eFunc
è
Ãwgroup_ü—‹
,

82 (
LßdFunc
è
Ãwgroup_lßd
,

83 (
SaveFunc
è
Ãwgroup_§ve
,

84 (
G‘DeçuÉsFunc
è
NULL
,

85 (
AµlyDeçuÉsFunc
è
NULL


88 
DŸObjeùTy³
 
	gÃwgroup_ty³
 =

92 (**è
Ãwgroup_icÚ
,

94 &
Ãwgroup_ty³_İs


97 
DŸObjeùTy³
 *
	g_Ãwgroup_ty³
 = (DŸObjeùTy³ *è&
Ãwgroup_ty³
;

99 
ObjeùOps
 
	gÃwgroup_İs
 = {

100 (
De¡royFunc
è
Ãwgroup_de¡roy
,

101 (
D¿wFunc
è
Ãwgroup_d¿w
,

102 (
Di¡ªûFunc
è
Ãwgroup_di¡ªû_äom
,

103 (
S–eùFunc
è
Ãwgroup_£Ëù
,

104 (
CİyFunc
è
Ãwgroup_cİy
,

105 (
MoveFunc
è
Ãwgroup_move
,

106 (
MoveHªdËFunc
è
Ãwgroup_move_hªdË
,

107 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

108 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

109 (
ObjeùM’uFunc
è
NULL
,

110 (
DesüibePrİsFunc
è
Ãwgroup_desüibe_´İs
,

111 (
G‘PrİsFunc
è
Ãwgroup_g‘_´İs
,

112 (
S‘PrİsFunc
è
Ãwgroup_£t_´İs
,

113 (
TextEd™Func
) 0,

114 #ifdeà
__GNUC__


115 #w¬nšg 
NewGroup
 
»quœes
 
a
 
funùiÚ
 
š
 
the
 
vbË
 
to
 
­¶y
 
´İs


117 #´agm¨
mes§ge
("warning: NewGroup„equires‡ function inhe vtableo‡pply…rops")

121 
PrİDesütiÚ
 
	gÃwgroup_´İs
[] = {

122 
ELEMENT_COMMON_PROPERTIES
,

123 { "İ’", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
,

124 
N_
("O³Àgroup"), 
NULL
, NULL},

126 
PROP_DESC_END


129 
PrİDesütiÚ
 *

130 
	$Ãwgroup_desüibe_´İs
(
NewGroup
 *
group
)

132 ià(
Ãwgroup_´İs
[0].
qu¬k
 == 0)

133 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
Ãwgroup_´İs
);

134  
Ãwgroup_´İs
;

135 
	}
}

137 
PrİOff£t
 
	gÃwgroup_off£ts
[] = {

138 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

139 { "İ’", 
PROP_TYPE_BOOL
, 
off£tof
(
NewGroup
, 
is_İ’
) },

140 { 
NULL
, 0, 0 }

144 
	$Ãwgroup_g‘_´İs
(
NewGroup
 *
group
, 
GPŒA¼ay
 *
´İs
)

146 
	`objeù_g‘_´İs_äom_off£ts
(&
group
->
–em’t
.
objeù
,

147 
Ãwgroup_off£ts
, 
´İs
);

148 
	}
}

151 
	$Ãwgroup_£t_´İs
(
NewGroup
 *
group
, 
GPŒA¼ay
 *
´İs
)

153 
	`objeù_£t_´İs_äom_off£ts
(&
group
->
–em’t
.
objeù
,

154 
Ãwgroup_off£ts
, 
´İs
);

155 
	`Ãwgroup_upd©e_d©a
(
group
);

156 
	}
}

158 
»®


159 
	$Ãwgroup_di¡ªû_äom
(
NewGroup
 *
group
, 
Pošt
 *
pošt
)

161 
EËm’t
 *
–em
 = &
group
->
–em’t
;

162 
ReùªgË
 
»ù
;

164 
»ù
.
Ëá
 = 
–em
->
cÜÃr
.
x
;

165 
»ù
.
right
 = 
–em
->
cÜÃr
.
x
 +ƒËm->
width
;

166 
»ù
.
tİ
 = 
–em
->
cÜÃr
.
y
;

167 
»ù
.
bÙtom
 = 
–em
->
cÜÃr
.
y
 +ƒËm->
height
;

168  
	`di¡ªû_»ùªgË_pošt
(&
»ù
, 
pošt
);

169 
	}
}

172 
	$Ãwgroup_£Ëù
(
NewGroup
 *
group
, 
Pošt
 *
şicked_pošt
,

173 
DŸR’d””
 *
š‹¿ùive_»nd””
)

175 
	`–em’t_upd©e_hªdËs
(&
group
->
–em’t
);

176 
	}
}

178 
ObjeùChªge
*

179 
	$Ãwgroup_move_hªdË
(
NewGroup
 *
group
, 
HªdË
 *
hªdË
,

180 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

181 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

183 
	`as£¹
(
group
!=
NULL
);

184 
	`as£¹
(
hªdË
!=
NULL
);

185 
	`as£¹
(
to
!=
NULL
);

187 
	`–em’t_move_hªdË
(&
group
->
–em’t
, 
hªdË
->
id
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

189 
	`Ãwgroup_upd©e_d©a
(
group
);

191  
NULL
;

192 
	}
}

194 
ObjeùChªge
*

195 
	$Ãwgroup_move
(
NewGroup
 *
group
, 
Pošt
 *
to
)

197 
group
->
–em’t
.
cÜÃr
 = *
to
;

199 
	`Ãwgroup_upd©e_d©a
(
group
);

201  
NULL
;

202 
	}
}

205 
	$Ãwgroup_d¿w
(
NewGroup
 *
group
, 
DŸR’d””
 *
»nd””
)

207 
Pošt
 
Ì_cÜÃr
;

208 
EËm’t
 *
–em
;

209 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

212 
	`as£¹
(
group
 !ğ
NULL
);

213 
	`as£¹
(
»nd””
 !ğ
NULL
);

215 
–em
 = &
group
->
–em’t
;

217 
Ì_cÜÃr
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

218 
Ì_cÜÃr
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

220 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 0.01);

221 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
LINESTYLE_SOLID
);

222 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_MITER
);

224 
»nd””_İs
->
	`d¿w_»ù
(
»nd””
,

225 &
–em
->
cÜÃr
,

226 &
Ì_cÜÃr
,

227 &
cŞÜ_bÏck
);

228 
	}
}

231 
	$Ãwgroup_upd©e_d©a
(
NewGroup
 *
group
)

233 
EËm’t
 *
–em
 = &
group
->
–em’t
;

235 
DŸObjeù
 *
obj
 = &
–em
->
objeù
;

238 
group
->
cÚÃùiÚs
[0].
pos
.
x
 = 
–em
->
cÜÃr
.x;

239 
group
->
cÚÃùiÚs
[0].
pos
.
y
 = 
–em
->
cÜÃr
.y;

240 
group
->
cÚÃùiÚs
[1].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

241 
group
->
cÚÃùiÚs
[1].
pos
.
y
 = 
–em
->
cÜÃr
.y;

242 
group
->
cÚÃùiÚs
[2].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

243 
group
->
cÚÃùiÚs
[2].
pos
.
y
 = 
–em
->
cÜÃr
.y;

244 
group
->
cÚÃùiÚs
[3].
pos
.
x
 = 
–em
->
cÜÃr
.x;

245 
group
->
cÚÃùiÚs
[3].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

246 
group
->
cÚÃùiÚs
[4].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

247 
group
->
cÚÃùiÚs
[4].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

248 
group
->
cÚÃùiÚs
[5].
pos
.
x
 = 
–em
->
cÜÃr
.x;

249 
group
->
cÚÃùiÚs
[5].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

250 
group
->
cÚÃùiÚs
[6].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

251 
group
->
cÚÃùiÚs
[6].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

252 
group
->
cÚÃùiÚs
[7].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

253 
group
->
cÚÃùiÚs
[7].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

254 
group
->
cÚÃùiÚs
[8].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

255 
group
->
cÚÃùiÚs
[8].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

257 
group
->
cÚÃùiÚs
[0].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_WEST
;

258 
group
->
cÚÃùiÚs
[1].
dœeùiÚs
 = 
DIR_NORTH
;

259 
group
->
cÚÃùiÚs
[2].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_EAST
;

260 
group
->
cÚÃùiÚs
[3].
dœeùiÚs
 = 
DIR_WEST
;

261 
group
->
cÚÃùiÚs
[4].
dœeùiÚs
 = 
DIR_EAST
;

262 
group
->
cÚÃùiÚs
[5].
dœeùiÚs
 = 
DIR_SOUTH
|
DIR_WEST
;

263 
group
->
cÚÃùiÚs
[6].
dœeùiÚs
 = 
DIR_SOUTH
;

264 
group
->
cÚÃùiÚs
[7].
dœeùiÚs
 = 
DIR_SOUTH
|
DIR_EAST
;

265 
group
->
cÚÃùiÚs
[8].
dœeùiÚs
 = 
DIR_ALL
;

267 
	`–em’t_upd©e_boundšgbox
(
–em
);

269 
obj
->
pos™iÚ
 = 
–em
->
cÜÃr
;

271 
	`–em’t_upd©e_hªdËs
(
–em
);

273 ià(
group
->
is_İ’
) {

274 
obj
->
æags
 &ğ~
DIA_OBJECT_GRABS_CHILD_INPUT
;

276 
gboŞ—n
 
ÃwlyS‘
 = 
FALSE
;

277 
Lay”
 *
Ïy”
;

278 ià(!
	`objeù_æags_£t
(
obj
, 
DIA_OBJECT_GRABS_CHILD_INPUT
)) {

279 
ÃwlyS‘
 = 
TRUE
;

281 
obj
->
æags
 |ğ
DIA_OBJECT_GRABS_CHILD_INPUT
;

282 ià(
ÃwlyS‘
) {

283 
Ïy”
 = 
	`dŸ_objeù_g‘_·»Á_Ïy”
(
obj
);

284 ià(
Ïy”
 !ğ
NULL
) {

285 
GLi¡
 *
chd»n
 = 
	`g_li¡_´•’d
(
NULL
, 
obj
);

286 
chd»n
 = 
	`·»Á_li¡_afãùed
(children);

289 
chd»n
 = 
	`g_li¡_»move_lšk
(children, children);

291 
	`dŸg¿m_un£Ëù_objeùs
(
	`Ïy”_g‘_·»Á_dŸg¿m
(
Ïy”
), 
chd»n
);

293 
	`g_w¬nšg
 ("usedo call diagram_unselect_objects()");

295 
	`g_li¡_ä“
(
chd»n
);

299 
	}
}

301 
DŸObjeù
 *

302 
	$Ãwgroup_ü—‹
(
Pošt
 *
¡¬ošt
,

303 *
u£r_d©a
,

304 
HªdË
 **
hªdË1
,

305 
HªdË
 **
hªdË2
)

307 
NewGroup
 *
group
;

308 
EËm’t
 *
–em
;

309 
DŸObjeù
 *
obj
;

310 
i
;

312 
group
 = 
	`g_m®loc0
((
NewGroup
));

313 
–em
 = &
group
->
–em’t
;

314 
obj
 = &
–em
->
objeù
;

316 
obj
->
ty³
 = &
Ãwgroup_ty³
;

318 
obj
->
İs
 = &
Ãwgroup_İs
;

319 
obj
->
æags
 |ğ
DIA_OBJECT_CAN_PARENT
|
DIA_OBJECT_GRABS_CHILD_INPUT
;

321 
–em
->
cÜÃr
 = *
¡¬ošt
;

322 
–em
->
width
 = 
DEFAULT_WIDTH
;

323 
–em
->
height
 = 
DEFAULT_HEIGHT
;

325 
	`–em’t_š™
(
–em
, 8, 
NUM_CONNECTIONS
);

327 
i
=0;i<
NUM_CONNECTIONS
;i++) {

328 
obj
->
cÚÃùiÚs
[
i
] = &
group
->connections[i];

329 
group
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

330 
group
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

332 
group
->
cÚÃùiÚs
[8].
æags
 = 
CP_FLAGS_MAIN
;

334 
	`Ãwgroup_upd©e_d©a
(
group
);

336 ià(
hªdË1
 !ğ
NULL
) {

337 *
hªdË1
 = 
NULL
;

339 ià(
hªdË2
 !ğ
NULL
) {

340 *
hªdË2
 = 
obj
->
hªdËs
[7];

342  &
group
->
–em’t
.
objeù
;

343 
	}
}

346 
	$Ãwgroup_de¡roy
(
NewGroup
 *
group
)

348 
	`–em’t_de¡roy
(&
group
->
–em’t
);

349 
	}
}

351 
DŸObjeù
 *

352 
	$Ãwgroup_cİy
(
NewGroup
 *
group
)

354 
i
;

355 
NewGroup
 *
Ãwgroup
;

356 
EËm’t
 *
–em
, *
Ãw–em
;

357 
DŸObjeù
 *
Ãwobj
;

359 
–em
 = &
group
->
–em’t
;

361 
Ãwgroup
 = 
	`g_m®loc0
((
NewGroup
));

362 
Ãw–em
 = &
Ãwgroup
->
–em’t
;

363 
Ãwobj
 = &
Ãw–em
->
objeù
;

365 
	`–em’t_cİy
(
–em
, 
Ãw–em
);

367 
i
=0;i<
NUM_CONNECTIONS
;i++) {

368 
Ãwobj
->
cÚÃùiÚs
[
i
] = &
Ãwgroup
->connections[i];

369 
Ãwgroup
->
cÚÃùiÚs
[
i
].
objeù
 = 
Ãwobj
;

370 
Ãwgroup
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

371 
Ãwgroup
->
cÚÃùiÚs
[
i
].
pos
 = 
group
->connections[i].pos;

372 
Ãwgroup
->
cÚÃùiÚs
[
i
].
Ï¡_pos
 = 
group
->connections[i].last_pos;

373 
Ãwgroup
->
cÚÃùiÚs
[
i
].
æags
 = 
group
->connections[i].flags;

376  &
Ãwgroup
->
–em’t
.
objeù
;

377 
	}
}

380 
	$Ãwgroup_§ve
(
NewGroup
 *
group
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
)

382 
	`–em’t_§ve
(&
group
->
–em’t
, 
obj_node
);

383 
	}
}

385 
DŸObjeù
 *

386 
	$Ãwgroup_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

388 
NewGroup
 *
group
;

389 
EËm’t
 *
–em
;

390 
DŸObjeù
 *
obj
;

391 
i
;

393 
group
 = 
	`g_m®loc0
((
NewGroup
));

394 
–em
 = &
group
->
–em’t
;

395 
obj
 = &
–em
->
objeù
;

397 
obj
->
ty³
 = &
Ãwgroup_ty³
;

398 
obj
->
İs
 = &
Ãwgroup_İs
;

400 
	`–em’t_lßd
(
–em
, 
obj_node
);

401 
	`–em’t_š™
(
–em
, 8, 
NUM_CONNECTIONS
);

403 
i
=0;i<
NUM_CONNECTIONS
;i++) {

404 
obj
->
cÚÃùiÚs
[
i
] = &
group
->connections[i];

405 
group
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

406 
group
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

408 
group
->
cÚÃùiÚs
[8].
æags
 = 
CP_FLAGS_MAIN
;

410 
	`Ãwgroup_upd©e_d©a
(
group
);

412  &
group
->
–em’t
.
objeù
;

413 
	}
}

	@O:\tool\dvs50\lib\newgroup.h

19 #iâdeà
NEWGROUP_H


20 
	#NEWGROUP_H


	)

22 
	~"dŸv¬.h
"

26 
DIAVAR
 
DŸObjeùTy³
 
	gÃwgroup_ty³
;

	@O:\tool\dvs50\lib\neworth_conn.c

21 
	~<cÚfig.h
>

23 
	~<¡dio.h
>

24 
	~<¡dlib.h
>

25 
	~<as£¹.h
>

26 
	~<m©h.h
>

27 
	~<¡ršg.h
>

29 
	~"ÃwÜth_cÚn.h
"

30 
	~"cÚÃùiÚpošt.h
"

31 
	~"mes§ge.h
"

32 
	~"dŸm’u.h
"

33 
	~"hªdË.h
"

34 
	~"dŸ»nd””.h
"

36 
¶aû_hªdË_by_sw­pšg
(
NewO¹hCÚn
 *
Üth
,

37 
šdex
, 
HªdË
 *
hªdË
);

39 
	echªge_ty³
 {

40 
	mTYPE_ADD_SEGMENT
,

41 
	mTYPE_REMOVE_SEGMENT


44 
ObjeùChªge
 *

45 
mid£gm’t_ü—‹_chªge
(
NewO¹hCÚn
 *
Üth
, 
chªge_ty³
 
ty³
,

46 
£gm’t
,

47 
Pošt
 *
pošt1
, Pošˆ*
pošt2
,

48 
HªdË
 *
hªdË1
, HªdË *
hªdË2
);

50 
	sMidSegm’tChªge
 {

51 
ObjeùChªge
 
	mobj_chªge
;

60 
chªge_ty³
 
	mty³
;

61 
	m­¶›d
;

63 
	m£gm’t
;

64 
Pošt
 
	mpošts
[2];

65 
HªdË
 *
	mhªdËs
[2];

66 
CÚÃùiÚPošt
 *
	mcÚn
;

67 
ObjeùChªge
 *
	mılchªge
[2];

70 
ObjeùChªge
 *

71 
’d£gm’t_ü—‹_chªge
(
NewO¹hCÚn
 *
Üth
, 
chªge_ty³
 
ty³
,

72 
£gm’t
, 
Pošt
 *
pošt
,

73 
HªdË
 *
hªdË
);

75 
	sEndSegm’tChªge
 {

76 
ObjeùChªge
 
	mobj_chªge
;

88 
chªge_ty³
 
	mty³
;

89 
	m­¶›d
;

91 
	m£gm’t
;

92 
Pošt
 
	mpošt
;

93 
HªdË
 *
	mhªdË
;

94 
HªdË
 *
	mŞd_’d_hªdË
;

95 
CÚÃùiÚPošt
 *
	mı
;

97 
ObjeùChªge
 *
	mılchªge
;

101 
	$£t_midpošt
(
Pošt
 *
pošt
, 
NewO¹hCÚn
 *
Üth
, 
£gm’t
)

103 
i
 = 
£gm’t
;

104 
pošt
->
x
 = 0.5*(
Üth
->
pošts
[
i
].x + orth->points[i+1].x);

105 
pošt
->
y
 = 0.5*(
Üth
->
pošts
[
i
].y + orth->points[i+1].y);

106 
	}
}

108 
	$£tup_midpošt_hªdË
(
HªdË
 *
hªdË
)

110 
hªdË
->
id
 = 
HANDLE_MIDPOINT
;

111 
hªdË
->
ty³
 = 
HANDLE_MINOR_CONTROL
;

112 
hªdË
->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

113 
hªdË
->
cÚÃùed_to
 = 
NULL
;

114 
	}
}

116 
	$£tup_’dpošt_hªdË
(
HªdË
 *
hªdË
, 
HªdËId
 
id
 )

118 
hªdË
->
id
 = id;

119 
hªdË
->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

120 
hªdË
->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

121 
hªdË
->
cÚÃùed_to
 = 
NULL
;

122 
	}
}

124 
	$g‘_hªdË_Ä
(
NewO¹hCÚn
 *
Üth
, 
HªdË
 *
hªdË
)

126 
i
 = 0;

127 
i
=0;i<
Üth
->
numpošts
-1;i++) {

128 ià(
Üth
->
hªdËs
[
i
] =ğ
hªdË
)

129  
i
;

132 
	}
}

134 
	$g‘_£gm’t_Ä
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
pošt
, 
»®
 
max_di¡
)

136 
i
;

137 
£gm’t
;

138 
»®
 
di¡ªû
, 
tmp_di¡
;

140 
£gm’t
 = 0;

141 
di¡ªû
 = 
	`di¡ªû_lše_pošt
(&
Üth
->
pošts
[0], &Üth->pošts[1], 0, 
pošt
);

143 
i
=1;i<
Üth
->
numpošts
-1;i++) {

144 
tmp_di¡
 = 
	`di¡ªû_lše_pošt
(&
Üth
->
pošts
[
i
], &Üth->pošts[i+1], 0, 
pošt
);

145 ià(
tmp_di¡
 < 
di¡ªû
) {

146 
£gm’t
 = 
i
;

147 
di¡ªû
 = 
tmp_di¡
;

151 ià(
di¡ªû
 < 
max_di¡
)

152  
£gm’t
;

155 
	}
}

158 
ObjeùChªge
*

159 
	$ÃwÜthcÚn_move_hªdË
(
NewO¹hCÚn
 *
Üth
, 
HªdË
 *
hªdË
,

160 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

161 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

163 
n
;

164 
hªdË_Ä
;

166 
hªdË
->
id
) {

167 
HANDLE_MOVE_STARTPOINT
:

168 
Üth
->
pošts
[0] = *
to
;

169 
Üth
->
Ü›Á©iÚ
[0]) {

170 
HORIZONTAL
:

171 
Üth
->
pošts
[1].
y
 = 
to
->y;

173 
VERTICAL
:

174 
Üth
->
pošts
[1].
x
 = 
to
->x;

178 
HANDLE_MOVE_ENDPOINT
:

179 
n
 = 
Üth
->
numpošts
 - 1;

180 
Üth
->
pošts
[
n
] = *
to
;

181 
Üth
->
Ü›Á©iÚ
[
n
-1]) {

182 
HORIZONTAL
:

183 
Üth
->
pošts
[
n
-1].
y
 = 
to
->y;

185 
VERTICAL
:

186 
Üth
->
pošts
[
n
-1].
x
 = 
to
->x;

190 
HANDLE_MIDPOINT
:

191 
n
 = 
Üth
->
numpošts
 - 1;

192 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
Üth
, 
hªdË
);

194 
Üth
->
Ü›Á©iÚ
[
hªdË_Ä
]) {

195 
HORIZONTAL
:

196 
Üth
->
pošts
[
hªdË_Ä
].
y
 = 
to
->y;

197 
Üth
->
pošts
[
hªdË_Ä
+1].
y
 = 
to
->y;

199 
VERTICAL
:

200 
Üth
->
pošts
[
hªdË_Ä
].
x
 = 
to
->x;

201 
Üth
->
pošts
[
hªdË_Ä
+1].
x
 = 
to
->x;

206 
	`mes§ge_”rÜ
("Internalƒrror in‚eworthconn_move_handle.\n");

210  
NULL
;

211 
	}
}

213 
ObjeùChªge
*

214 
	$ÃwÜthcÚn_move
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
to
)

216 
Pošt
 
p
;

217 
i
;

219 
p
 = *
to
;

220 
	`pošt_sub
(&
p
, &
Üth
->
pošts
[0]);

222 
Üth
->
pošts
[0] = *
to
;

223 
i
=1;i<
Üth
->
numpošts
;i++) {

224 
	`pošt_add
(&
Üth
->
pošts
[
i
], &
p
);

227  
NULL
;

228 
	}
}

230 
»®


231 
	$ÃwÜthcÚn_di¡ªû_äom
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

233 
i
;

234 
»®
 
di¡
;

236 
di¡
 = 
	`di¡ªû_lše_pošt
Ğ&
Üth
->
pošts
[0], &orth->points[1],

237 
lše_width
, 
pošt
);

238 
i
=1;i<
Üth
->
numpošts
-1;i++) {

239 
di¡
 = 
	`MIN
(dist,

240 
	`di¡ªû_lše_pošt
Ğ&
Üth
->
pošts
[
i
], &orth->points[i+1],

241 
lše_width
, 
pošt
));

243  
di¡
;

244 
	}
}

247 
	$ÃwÜthcÚn_upd©e_midpošts
(
NewO¹hCÚn
 *
Üth
)

249 
i
;

250 
GSLi¡
 *
–em
;

252 
–em
=
Üth
->
midpošts
->
cÚÃùiÚs
;

255 
	`£t_midpošt
(&((
CÚÃùiÚPošt
 *)(
–em
->
d©a
))->
pos
,
Üth
,0);

256 
–em
=
	`g_¦i¡_Ãxt
(elem);

257 
i
=1; i<
Üth
->
numpošts
-2; i++) {

258 ((
CÚÃùiÚPošt
 *)(
–em
->
d©a
))->
pos
 = 
Üth
->
hªdËs
[
i
]->pos;

259 
–em
 = 
	`g_¦i¡_Ãxt
(elem);

261 
	`£t_midpošt
(&(((
CÚÃùiÚPošt
 *)(
–em
->
d©a
))->
pos
),
Üth
,
i
);

262 
	}
}

268 
	$adju¡_hªdË_couÁ_to
(
NewO¹hCÚn
 *
Üth
, 
gušt
 
couÁ
) {

274 ià(
Üth
->
numhªdËs
 =ğ
couÁ
) ;

275 ià(
Üth
->
numhªdËs
 < 
couÁ
) {

276 
i
;

277 
Üth
->
hªdËs
 = 
	`g_»®loc
(orth->handles,

278 (
couÁ
)*(
HªdË
 *));

279 
Üth
->
hªdËs
[
couÁ
-1] = o¹h->hªdËs[Üth->
numhªdËs
-1];

280 
Üth
->
hªdËs
[Üth->
numhªdËs
-1] = 
NULL
;

281 
i
=
Üth
->
numhªdËs
-1; i<
couÁ
-1; i++) {

282 
HªdË
 *
hªdË
 = 
	`g_Ãw0
(Handle,1);

283 
	`£tup_midpošt_hªdË
(
hªdË
);

284 
	`objeù_add_hªdË
(&
Üth
->
objeù
,
hªdË
);

285 
Üth
->
hªdËs
[
i
] = 
hªdË
;

288 
i
;

289 
i
=
couÁ
-1; i<
Üth
->
numhªdËs
-1; i++) {

290 
HªdË
 *
hªdË
 = 
Üth
->
hªdËs
[
i
];

291 
	`objeù_»move_hªdË
(&
Üth
->
objeù
,
hªdË
);

292 
	`g_ä“
(
hªdË
);

293 
Üth
->
hªdËs
[
i
] = 
NULL
;

295 
Üth
->
hªdËs
[
couÁ
-1] = o¹h->hªdËs[Üth->
numhªdËs
-1];

296 
Üth
->
hªdËs
[Üth->
numhªdËs
-1] = 
NULL
;

297 
Üth
->
hªdËs
 = 
	`g_»®loc
(orth->handles,

298 (
couÁ
)*(
HªdË
 *));

300 
Üth
->
numhªdËs
 = 
couÁ
;

302 
	}
}

306 
	$ÃwÜthcÚn_upd©e_d©a
(
NewO¹hCÚn
 *
Üth
)

308 
i
;

309 
DŸObjeù
 *
obj
 = (DŸObjeù *)
Üth
;

310 
Pošt
 *
pošts
;

311 
CÚÃùiÚPošt
 *
¡¬t_ı
;

312 
CÚÃùiÚPošt
 *
’d_ı
;

314 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

323 
	`adju¡_hªdË_couÁ_to
(
Üth
, o¹h->
numpošts
-1);

325 
¡¬t_ı
 = 
Üth
->
hªdËs
[0]->
cÚÃùed_to
;

326 
’d_ı
 = 
Üth
->
hªdËs
[Üth->
numpošts
-2]->
cÚÃùed_to
;

328 ià(!
Üth
->
pošts
) {

329 
	`g_w¬nšg
("This NewOrthConn object is very sick !");

333 
pošts
 = 
Üth
->points;

334 ià(
	`cÚÅošt_is_autog­
(
¡¬t_ı
) ||

335 
	`cÚÅošt_is_autog­
(
’d_ı
)) {

336 
Pošt
* 
Ãw_pošts
 = 
	`g_Ãw
(Pošt, 
Üth
->
numpošts
);

337 
i
 = 0; i < 
Üth
->
numpošts
; i++) {

338 
Ãw_pošts
[
i
] = 
pošts
[i];

341 ià(
	`cÚÅošt_is_autog­
(
¡¬t_ı
)) {

342 
Ãw_pošts
[0] = 
	`ÿlcuÏ‹_objeù_edge
(&
¡¬t_ı
->
pos
, &new_points[1],

343 
¡¬t_ı
->
objeù
);

344 
	`´štf
("Moved starto %f, %f\n",

345 
Ãw_pošts
[0].
x
,‚ew_pošts[0].
y
);

347 ià(
	`cÚÅošt_is_autog­
(
’d_ı
)) {

348 
Ãw_pošts
[
Üth
->
numpošts
-1] =

349 
	`ÿlcuÏ‹_objeù_edge
(&
’d_ı
->
pos
, &
Ãw_pošts
[
Üth
->
numpošts
-2],

350 
’d_ı
->
objeù
);

351 
	`´štf
("Movedƒndo %f, %f\n",

352 
Ãw_pošts
[
Üth
->
numpošts
-1].
x
,‚ew_pošts[Üth->numpošts-1].
y
);

354 
	`g_ä“
(
pošts
);

355 
Üth
->
pošts
 = 
Ãw_pošts
;

358 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

360 
	`adju¡_hªdË_couÁ_to
(
Üth
,Üth->
numpošts
-1);

361 
	`cÚÅošše_adju¡_couÁ
(
Üth
->
midpošts
,Üth->
numpošts
-1,
NULL
);

364 
	`¶aû_hªdË_by_sw­pšg
(
Üth
, 0, o¹h->
hªdËs
[0]);

365 
	`¶aû_hªdË_by_sw­pšg
(
Üth
, 1, o¹h->
hªdËs
[Üth->
numpošts
-2]);

368 
Üth
->
hªdËs
[0]->
pos
 = o¹h->
pošts
[0];

369 
Üth
->
hªdËs
[Üth->
numpošts
-2]->
pos
 = o¹h->
pošts
[orth->numpoints-1];

371 
i
=1;i<
Üth
->
numpošts
-2;i++) {

372 
	`£t_midpošt
(&
Üth
->
hªdËs
[
i
]->
pos
, orth, i);

374 
	`ÃwÜthcÚn_upd©e_midpošts
(
Üth
);

375 
	}
}

378 
	$ÃwÜthcÚn_upd©e_boundšgbox
(
NewO¹hCÚn
 *
Üth
)

380 
	`as£¹
(
Üth
 !ğ
NULL
);

382 
	`pŞylše_bbox
(&
Üth
->
pošts
[0],

383 
Üth
->
numpošts
,

384 &
Üth
->
exŒa_¥acšg
, 
FALSE
,

385 &
Üth
->
objeù
.
boundšg_box
);

386 
	}
}

389 
	$ÃwÜthcÚn_sim¶e_d¿w
(
NewO¹hCÚn
 *
Üth
, 
DŸR’d””
 *
»nd””
, 
»®
 
width
)

391 
Pošt
 *
pošts
;

393 
	`as£¹
(
Üth
 !ğ
NULL
);

394 
	`as£¹
(
»nd””
 !ğ
NULL
);

396 ià(!
Üth
->
pošts
) {

397 
	`g_w¬nšg
("This NewOrthConn object is very sick !");

401 
pošts
 = &
Üth
->points[0];

403 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
width
);

404 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

405 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

406 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

408 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞylše
Ô’d””, 
pošts
, 
Üth
->
numpošts
,

409 &
cŞÜ_bÏck
);

410 
	}
}

414 
	$ÃwÜthcÚn_ÿn_d–‘e_£gm’t
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
)

416 
£gm’t
;

422 ià(
Üth
->
numpošts
==3)

425 
£gm’t
 = 
	`g‘_£gm’t_Ä
(
Üth
, 
şickedpošt
, 1.0);

427 ià(
£gm’t
<0)

430 iàĞ(
£gm’t
 !ğ0è&& (£gm’ˆ!ğ
Üth
->
numpošts
-2)) {

432 ià(
Üth
->
numpošts
==4)

437 
	}
}

440 
	$ÃwÜthcÚn_ÿn_add_£gm’t
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
)

442 
£gm’t
 = 
	`g‘_£gm’t_Ä
(
Üth
, 
şickedpošt
, 1000000.0);

444 ià(
£gm’t
<0)

448 
	}
}

457 
	$ÃwÜthcÚn_š™
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
¡¬ošt
)

459 
DŸObjeù
 *
obj
;

461 
obj
 = &
Üth
->
objeù
;

463 
	`objeù_š™
(
obj
, 3, 0);

465 
Üth
->
numpošts
 = 4;

466 
Üth
->
numÜ›Á
 = o¹h->
numpošts
 - 1;

467 
Üth
->
numhªdËs
 = 3;

469 
Üth
->
pošts
 = 
	`g_m®loc
(4*(
Pošt
));

470 
Üth
->
Ü›Á©iÚ
 = 
	`g_m®loc
(3*(
Or›Á©iÚ
));

471 
Üth
->
hªdËs
 = 
	`g_m®loc
(3*(
HªdË
 *));

473 
Üth
->
hªdËs
[0] = 
	`g_Ãw
(
HªdË
, 1);

474 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[0], 
HANDLE_MOVE_STARTPOINT
);

475 
obj
->
hªdËs
[0] = 
Üth
->handles[0];

477 
Üth
->
hªdËs
[1] = 
	`g_Ãw
(
HªdË
, 1);

478 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[1]);

479 
obj
->
hªdËs
[1] = 
Üth
->handles[1];

481 
Üth
->
hªdËs
[2] = 
	`g_Ãw
(
HªdË
, 1);

482 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[2], 
HANDLE_MOVE_ENDPOINT
);

483 
obj
->
hªdËs
[2] = 
Üth
->handles[2];

486 
Üth
->
pošts
[0] = *
¡¬ošt
;

487 
Üth
->
pošts
[1].
x
 = 
¡¬ošt
->x;

488 
Üth
->
pošts
[1].
y
 = 
¡¬ošt
->y + 1.0;

489 
Üth
->
pošts
[2].
x
 = 
¡¬ošt
->x + 1.0;

490 
Üth
->
pošts
[2].
y
 = 
¡¬ošt
->y + 1.0;

491 
Üth
->
pošts
[3].
x
 = 
¡¬ošt
->x + 2.0;

492 
Üth
->
pošts
[3].
y
 = 
¡¬ošt
->y + 1.0;

494 
Üth
->
Ü›Á©iÚ
[0] = 
VERTICAL
;

495 
Üth
->
Ü›Á©iÚ
[1] = 
HORIZONTAL
;

496 
Üth
->
Ü›Á©iÚ
[2] = 
VERTICAL
;

498 
Üth
->
midpošts
 = 
	`cÚÅošše_ü—‹
(
obj
,3);

500 
	`ÃwÜthcÚn_upd©e_d©a
(
Üth
);

501 
	}
}

504 
	$ÃwÜthcÚn_cİy
(
NewO¹hCÚn
 *
äom
, NewO¹hCÚÀ*
to
)

506 
i
,
rcc
;

507 
DŸObjeù
 *
toobj
, *
äomobj
;

509 
toobj
 = &
to
->
objeù
;

510 
äomobj
 = &
äom
->
objeù
;

512 
	`objeù_cİy
(
äomobj
, 
toobj
);

514 
to
->
numpošts
 = 
äom
->numpoints;

515 
to
->
numÜ›Á
 = 
äom
->numorient;

516 
to
->
numhªdËs
 = 
äom
->numhandles;

518 
to
->
pošts
 = 
	`g_m®loc
(Ño->
numpošts
)*(
Pošt
));

520 
i
=0;i<
to
->
numpošts
;i++) {

521 
to
->
pošts
[
i
] = 
äom
->points[i];

524 
to
->
Ü›Á©iÚ
 = 
	`g_m®loc
(Ño->
numpošts
-1)*(
Or›Á©iÚ
));

525 
to
->
hªdËs
 = 
	`g_m®loc
(Ño->
numpošts
-1)*(
HªdË
 *));

527 
i
=0;i<
to
->
numpošts
-1;i++) {

528 
to
->
Ü›Á©iÚ
[
i
] = 
äom
->orientation[i];

529 
to
->
hªdËs
[
i
] = 
	`g_Ãw
(
HªdË
,1);

530 *
to
->
hªdËs
[
i
] = *
äom
->handles[i];

531 
to
->
hªdËs
[
i
]->
cÚÃùed_to
 = 
NULL
;

532 
toobj
->
hªdËs
[
i
] = 
to
->handles[i];

534 
rcc
 = 0;

535 
to
->
midpošts
 = 
	`cÚÅošše_cİy
(
toobj
,
äom
->midpošts,&
rcc
);

536 
	`memıy
(&
to
->
exŒa_¥acšg
,&
äom
->extra_spacing,(to->extra_spacing));

537 
	}
}

541 
	$ÃwÜthcÚn_de¡roy
(
NewO¹hCÚn
 *
Üth
)

543 
i
;

545 
	`cÚÅošše_de¡roy
(
Üth
->
midpošts
);

546 
	`objeù_de¡roy
(&
Üth
->
objeù
);

548 
	`g_ä“
(
Üth
->
pošts
);

549 
	`g_ä“
(
Üth
->
Ü›Á©iÚ
);

551 
i
=0;i<
Üth
->
numpošts
-1;i++) {

552 
	`g_ä“
(
Üth
->
hªdËs
[
i
]);

554 
	`g_ä“
(
Üth
->
hªdËs
);

555 
	}
}

558 
	$¶aû_hªdË_by_sw­pšg
(
NewO¹hCÚn
 *
Üth
, 
šdex
, 
HªdË
 *
hªdË
)

560 
DŸObjeù
 *
obj
;

561 
HªdË
 *
tmp
;

562 
j
;

564 
obj
 = (
DŸObjeù
 *)
Üth
;

565 ià(
obj
->
hªdËs
[
šdex
] =ğ
hªdË
)

568 
j
=0;j<
obj
->
num_hªdËs
;j++) {

569 ià(
obj
->
hªdËs
[
j
] =ğ
hªdË
) {

571 
tmp
 = 
obj
->
hªdËs
[
j
];

572 
obj
->
hªdËs
[
j
] = obj->hªdËs[
šdex
];

573 
obj
->
hªdËs
[
šdex
] = 
tmp
;

578 
	}
}

581 
	$ÃwÜthcÚn_§ve
(
NewO¹hCÚn
 *
Üth
, 
ObjeùNode
 
obj_node
)

583 
i
;

584 
A‰ribu‹Node
 
©Œ
;

587 
	`¶aû_hªdË_by_sw­pšg
(
Üth
, 0, o¹h->
hªdËs
[0]);

588 
	`¶aû_hªdË_by_sw­pšg
(
Üth
, 1, o¹h->
hªdËs
[Üth->
numpošts
-2]);

590 
	`objeù_§ve
(&
Üth
->
objeù
, 
obj_node
);

592 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "orth_points");

594 
i
=0;i<
Üth
->
numpošts
;i++) {

595 
	`d©a_add_pošt
(
©Œ
, &
Üth
->
pošts
[
i
]);

598 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "orth_orient");

599 
i
=0;i<
Üth
->
numpošts
-1;i++) {

600 
	`d©a_add_’um
(
©Œ
, 
Üth
->
Ü›Á©iÚ
[
i
]);

602 
	}
}

605 
	$ÃwÜthcÚn_lßd
(
NewO¹hCÚn
 *
Üth
, 
ObjeùNode
 
obj_node
)

607 
i
;

608 
A‰ribu‹Node
 
©Œ
;

609 
D©aNode
 
d©a
;

610 
n
;

612 
DŸObjeù
 *
obj
 = &
Üth
->
objeù
;

614 
	`objeù_lßd
(
obj
, 
obj_node
);

616 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "orth_points");

618 ià(
©Œ
 !ğ
NULL
)

619 
Üth
->
numpošts
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

621 
Üth
->
numpošts
 = 0;

623 
	`objeù_š™
(
obj
, 
Üth
->
numpošts
-1,0);

625 
Üth
->
numÜ›Á
 = o¹h->
numpošts
 - 1;

627 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

628 
Üth
->
pošts
 = 
	`g_m®loc
((Üth->
numpošts
)*(
Pošt
));

629 
i
=0;i<
Üth
->
numpošts
;i++) {

630 
	`d©a_pošt
(
d©a
, &
Üth
->
pošts
[
i
]);

631 
d©a
 = 
	`d©a_Ãxt
(data);

634 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "orth_orient");

636 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

637 
Üth
->
Ü›Á©iÚ
 = 
	`g_m®loc
((Üth->
numpošts
-1)*(
Or›Á©iÚ
));

638 
i
=0;i<
Üth
->
numpošts
-1;i++) {

639 
Üth
->
Ü›Á©iÚ
[
i
] = 
	`d©a_’um
(
d©a
);

640 
d©a
 = 
	`d©a_Ãxt
(data);

643 
Üth
->
hªdËs
 = 
	`g_m®loc
((Üth->
numpošts
-1)*(
HªdË
 *));

645 
Üth
->
hªdËs
[0] = 
	`g_Ãw
(
HªdË
, 1);

646 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[0], 
HANDLE_MOVE_STARTPOINT
);

647 
Üth
->
hªdËs
[0]->
pos
 = o¹h->
pošts
[0];

648 
obj
->
hªdËs
[0] = 
Üth
->handles[0];

650 
n
 = 
Üth
->
numpošts
-2;

651 
Üth
->
hªdËs
[
n
] = 
	`g_Ãw
(
HªdË
, 1);

652 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[
n
], 
HANDLE_MOVE_ENDPOINT
);

653 
Üth
->
hªdËs
[
n
]->
pos
 = o¹h->
pošts
[Üth->
numpošts
-1];

654 
obj
->
hªdËs
[1] = 
Üth
->hªdËs[
n
];

656 
i
=1; i<
Üth
->
numpošts
-2; i++) {

657 
Üth
->
hªdËs
[
i
] = 
	`g_Ãw
(
HªdË
, 1);

658 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[
i
]);

659 
obj
->
hªdËs
[
i
+1] = 
Üth
->handles[i];

661 
Üth
->
numhªdËs
 = o¹h->
numpošts
-1;

662 
Üth
->
midpošts
 = 
	`cÚÅošše_ü—‹
(
obj
,Üth->
numpošts
-1);

664 
	`ÃwÜthcÚn_upd©e_d©a
(
Üth
);

665 
	}
}

667 
HªdË
*

668 
	$ÃwÜthcÚn_g‘_middË_hªdË
Ğ
NewO¹hCÚn
 *
Üth
 )

670 
n
 = 
Üth
->
numpošts
 - 1 ;

671  
Üth
->
hªdËs
[ 
n
/2 ] ;

672 
	}
}

674 
ObjeùChªge
 *

675 
	$ÃwÜthcÚn_d–‘e_£gm’t
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
)

677 
£gm’t
;

678 
ObjeùChªge
 *
chªge
 = 
NULL
;

680 ià(
Üth
->
numpošts
==3)

681  
NULL
;

683 
£gm’t
 = 
	`g‘_£gm’t_Ä
(
Üth
, 
şickedpošt
, 1.0);

684 ià(
£gm’t
 < 0)

685  
NULL
;

687 ià(
£gm’t
==0) {

688 
chªge
 = 
	`’d£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_REMOVE_SEGMENT
, 
£gm’t
,

689 &
Üth
->
pošts
[
£gm’t
],

690 
Üth
->
hªdËs
[
£gm’t
]);

691 } ià(
£gm’t
 =ğ
Üth
->
numpošts
-2) {

692 
chªge
 = 
	`’d£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_REMOVE_SEGMENT
, 
£gm’t
,

693 &
Üth
->
pošts
[
£gm’t
+1],

694 
Üth
->
hªdËs
[
£gm’t
]);

695 } ià(
£gm’t
 > 0) {

699 ià(
£gm’t
 =ğ
Üth
->
numpošts
-3)

700 
£gm’t
--;

702 
chªge
 = 
	`mid£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_REMOVE_SEGMENT
, 
£gm’t
,

703 &
Üth
->
pošts
[
£gm’t
],

704 &
Üth
->
pošts
[
£gm’t
+1],

705 
Üth
->
hªdËs
[
£gm’t
],

706 
Üth
->
hªdËs
[
£gm’t
+1]);

709 
chªge
->
	`­¶y
(chªge, (
DŸObjeù
 *)
Üth
);

711  
chªge
;

712 
	}
}

714 
ObjeùChªge
 *

715 
	$ÃwÜthcÚn_add_£gm’t
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
)

717 
HªdË
 *
hªdË1
, *
hªdË2
;

718 
ObjeùChªge
 *
chªge
 = 
NULL
;

719 
£gm’t
;

720 
Pošt
 
Ãwpošt
;

722 
£gm’t
 = 
	`g‘_£gm’t_Ä
(
Üth
, 
şickedpošt
, 1.0);

723 ià(
£gm’t
 < 0)

724  
NULL
;

726 ià(
£gm’t
==0) {

727 
hªdË1
 = 
	`g_Ãw
(
HªdË
, 1);

728 
	`£tup_’dpošt_hªdË
(
hªdË1
, 
HANDLE_MOVE_STARTPOINT
);

729 
chªge
 = 
	`’d£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_ADD_SEGMENT
,

730 0, &
Üth
->
pošts
[0],

731 
hªdË1
);

732 } ià(
£gm’t
 =ğ
Üth
->
numpošts
-2) {

733 
hªdË1
 = 
	`g_Ãw
(
HªdË
, 1);

734 
	`£tup_’dpošt_hªdË
(
hªdË1
, 
HANDLE_MOVE_ENDPOINT
);

735 
chªge
 = 
	`’d£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_ADD_SEGMENT
,

736 
£gm’t
+1, &
Üth
->
pošts
[segment+1],

737 
hªdË1
);

738 } ià(
£gm’t
 > 0) {

739 
hªdË1
 = 
	`g_Ãw
(
HªdË
, 1);

740 
	`£tup_midpošt_hªdË
(
hªdË1
);

741 
hªdË2
 = 
	`g_Ãw
(
HªdË
, 1);

742 
	`£tup_midpošt_hªdË
(
hªdË2
);

743 
Ãwpošt
 = *
şickedpošt
;

744 ià(
Üth
->
Ü›Á©iÚ
[
£gm’t
]==
HORIZONTAL
)

745 
Ãwpošt
.
y
 = 
Üth
->
pošts
[
£gm’t
].y;

747 
Ãwpošt
.
x
 = 
Üth
->
pošts
[
£gm’t
].x;

749 
chªge
 = 
	`mid£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_ADD_SEGMENT
, 
£gm’t
,

750 &
Ãwpošt
,

751 &
Ãwpošt
,

752 
hªdË1
,

753 
hªdË2
);

756 
chªge
->
	`­¶y
(chªge, (
DŸObjeù
 *)
Üth
);

758  
chªge
;

759 
	}
}

762 
	$d–‘e_pošt
(
NewO¹hCÚn
 *
Üth
, 
pos
)

764 
i
;

766 
Üth
->
numpošts
--;

767 
Üth
->
numÜ›Á
 = o¹h->
numpošts
 - 1;

769 
i
=
pos
;i<
Üth
->
numpošts
;i++) {

770 
Üth
->
pošts
[
i
] = orth->points[i+1];

773 
Üth
->
pošts
 = 
	`g_»®loc
(Üth->pošts, o¹h->
numpošts
*(
Pošt
));

774 
	}
}

780 
	$»move_hªdË
(
NewO¹hCÚn
 *
Üth
, 
£gm’t
)

782 
i
;

783 
HªdË
 *
hªdË
;

785 
hªdË
 = 
Üth
->
hªdËs
[
£gm’t
];

787 
i
=
£gm’t
; i < 
Üth
->
numpošts
-1; i++) {

788 
Üth
->
hªdËs
[
i
] = orth->handles[i+1];

789 
Üth
->
Ü›Á©iÚ
[
i
] = orth->orientation[i+1];

792 
Üth
->
Ü›Á©iÚ
 = 
	`g_»®loc
(orth->orientation,

793 (
Üth
->
numpošts
-1)*(
Or›Á©iÚ
));

794 
Üth
->
hªdËs
 = 
	`g_»®loc
(orth->handles,

795 (
Üth
->
numpošts
-1)*(
HªdË
 *));

797 
	`objeù_»move_hªdË
(&
Üth
->
objeù
, 
hªdË
);

798 
Üth
->
numhªdËs
 = o¹h->
numpošts
-1;

799 
	}
}

803 
	$add_pošt
(
NewO¹hCÚn
 *
Üth
, 
pos
, 
Pošt
 *
pošt
)

805 
i
;

807 
Üth
->
numpošts
++;

808 
Üth
->
numÜ›Á
 = o¹h->
numpošts
-1;

810 
Üth
->
pošts
 = 
	`g_»®loc
(Üth->pošts, o¹h->
numpošts
*(
Pošt
));

811 
i
=
Üth
->
numpošts
-1;i>
pos
;i--) {

812 
Üth
->
pošts
[
i
] = orth->points[i-1];

814 
Üth
->
pošts
[
pos
] = *
pošt
;

815 
	}
}

821 
	$š£¹_hªdË
(
NewO¹hCÚn
 *
Üth
, 
£gm’t
,

822 
HªdË
 *
hªdË
, 
Or›Á©iÚ
 
Ü›Á
)

824 
i
;

826 
Üth
->
Ü›Á©iÚ
 = 
	`g_»®loc
(orth->orientation,

827 (
Üth
->
numpošts
-1)*(
Or›Á©iÚ
));

828 
Üth
->
hªdËs
 = 
	`g_»®loc
(orth->handles,

829 (
Üth
->
numpošts
-1)*(
HªdË
 *));

830 
i
=
Üth
->
numpošts
-2;i>
£gm’t
;i--) {

831 
Üth
->
hªdËs
[
i
] = orth->handles[i-1];

832 
Üth
->
Ü›Á©iÚ
[
i
] = orth->orientation[i-1];

834 
Üth
->
hªdËs
[
£gm’t
] = 
hªdË
;

835 
Üth
->
Ü›Á©iÚ
[
£gm’t
] = 
Ü›Á
;

837 
	`objeù_add_hªdË
(&
Üth
->
objeù
, 
hªdË
);

838 
Üth
->
numhªdËs
 = o¹h->
numpošts
-1;

839 
	}
}

844 
	$’d£gm’t_chªge_ä“
(
EndSegm’tChªge
 *
chªge
)

846 iàĞ(
chªge
->
ty³
==
TYPE_ADD_SEGMENT
 && !chªge->
­¶›d
) ||

847 (
chªge
->
ty³
==
TYPE_REMOVE_SEGMENT
 && chªge->
­¶›d
) ){

848 ià(
chªge
->
hªdË
)

849 
	`g_ä“
(
chªge
->
hªdË
);

850 
chªge
->
hªdË
 = 
NULL
;

852 ià(
chªge
->
ılchªge
) {

853 ià(
chªge
->
ılchªge
->
ä“
èchªge->ılchªge->
	`ä“
(change->cplchange);

854 
	`g_ä“
(
chªge
->
ılchªge
);

855 
chªge
->
ılchªge
 = 
NULL
;

857 
	}
}

860 
	$’d£gm’t_chªge_­¶y
(
EndSegm’tChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

862 
NewO¹hCÚn
 *
Üth
 = (NewO¹hCÚÀ*)
obj
;

864 
chªge
->
­¶›d
 = 1;

866 
chªge
->
ty³
) {

867 
TYPE_ADD_SEGMENT
:

868 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
Şd_’d_hªdË
);

869 ià(
chªge
->
£gm’t
==0) {

870 
	`add_pošt
(
Üth
, 0, &
chªge
->
pošt
);

871 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
,

872 
chªge
->
hªdË
, 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[0]) );

873 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[1]);

874 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

875 
chªge
->
ılchªge
 = 
	`cÚÅošše_add_pošt
(
Üth
->
midpošts
,

876 &
chªge
->
pošt
);

878 
	`add_pošt
(
Üth
, o¹h->
numpošts
, &
chªge
->
pošt
);

879 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
, chªge->
hªdË
,

880 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[Üth->
numpošts
-3]) );

881 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[Üth->
numpošts
-3]);

882 
chªge
->
ılchªge
 = 
	`cÚÅošše_add_pošt
(
Üth
->
midpošts
,

883 &
Üth
->
midpošts
->
’d
);

886 
TYPE_REMOVE_SEGMENT
:

887 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
Şd_’d_hªdË
);

888 
chªge
->
ılchªge
 =

889 
	`cÚÅošše_»move_pošt
(
Üth
->
midpošts
,

890 &
Üth
->
pošts
[
chªge
->
£gm’t
]);

891 ià(
chªge
->
£gm’t
==0) {

892 
	`d–‘e_pošt
(
Üth
, 0);

893 
	`»move_hªdË
(
Üth
, 0);

894 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[0], 
HANDLE_MOVE_STARTPOINT
);

895 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

897 
	`d–‘e_pošt
(
Üth
, o¹h->
numpošts
-1);

898 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
);

899 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[Üth->
numpošts
-2],

900 
HANDLE_MOVE_ENDPOINT
);

904 
	`ÃwÜthcÚn_upd©e_midpošts
(
Üth
);

905 
	}
}

908 
	$’d£gm’t_chªge_»v”t
(
EndSegm’tChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

910 
NewO¹hCÚn
 *
Üth
 = (NewO¹hCÚÀ*)
obj
;

912 
chªge
->
ılchªge
->
	`»v”t
(chªge->ılchªge,
obj
);

913 
chªge
->
ty³
) {

914 
TYPE_ADD_SEGMENT
:

915 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË
);

916 ià(
chªge
->
£gm’t
==0) {

917 
	`d–‘e_pošt
(
Üth
, 0);

918 
	`»move_hªdË
(
Üth
, 0);

919 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[0], 
HANDLE_MOVE_STARTPOINT
);

920 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

922 
	`d–‘e_pošt
(
Üth
, o¹h->
numpošts
-1);

923 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
);

924 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[Üth->
numpošts
-2],

925 
HANDLE_MOVE_ENDPOINT
);

928 
TYPE_REMOVE_SEGMENT
:

929 ià(
chªge
->
£gm’t
==0) {

930 
	`add_pošt
(
Üth
, 0, &
chªge
->
pošt
);

931 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
,

932 
chªge
->
hªdË
, 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[0]) );

933 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[1]);

934 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

936 
	`add_pošt
(
Üth
, o¹h->
numpošts
, &
chªge
->
pošt
);

937 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
, chªge->
hªdË
,

938 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[Üth->
numpošts
-3]) );

939 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[Üth->
numpošts
-3]);

943 
chªge
->
­¶›d
 = 0;

944 
	`ÃwÜthcÚn_upd©e_midpošts
(
Üth
);

945 
	}
}

947 
ObjeùChªge
 *

948 
	$’d£gm’t_ü—‹_chªge
(
NewO¹hCÚn
 *
Üth
, 
chªge_ty³
 
ty³
,

949 
£gm’t
, 
Pošt
 *
pošt
,

950 
HªdË
 *
hªdË
)

952 
EndSegm’tChªge
 *
chªge
;

954 
chªge
 = 
	`g_Ãw0
(
EndSegm’tChªge
, 1);

956 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
’d£gm’t_chªge_­¶y
;

957 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
’d£gm’t_chªge_»v”t
;

958 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
’d£gm’t_chªge_ä“
;

960 
chªge
->
ty³
 =ype;

961 
chªge
->
­¶›d
 = 0;

962 
chªge
->
£gm’t
 = segment;

963 
chªge
->
pošt
 = *point;

964 
chªge
->
hªdË
 = handle;

965 ià(
£gm’t
 == 0)

966 
chªge
->
Şd_’d_hªdË
 = 
Üth
->
hªdËs
[0];

968 
chªge
->
Şd_’d_hªdË
 = 
Üth
->
hªdËs
[Üth->
numpošts
-2];

969 
chªge
->
ı
 = chªge->
Şd_’d_hªdË
->
cÚÃùed_to
;

970  (
ObjeùChªge
 *)
chªge
;

971 
	}
}

975 
	$mid£gm’t_chªge_ä“
(
MidSegm’tChªge
 *
chªge
)

977 iàĞ(
chªge
->
ty³
==
TYPE_ADD_SEGMENT
 && !chªge->
­¶›d
) ||

978 (
chªge
->
ty³
==
TYPE_REMOVE_SEGMENT
 && chªge->
­¶›d
) ){

979 ià(
chªge
->
hªdËs
[0])

980 
	`g_ä“
(
chªge
->
hªdËs
[0]);

981 
chªge
->
hªdËs
[0] = 
NULL
;

982 ià(
chªge
->
hªdËs
[1])

983 
	`g_ä“
(
chªge
->
hªdËs
[1]);

984 
chªge
->
hªdËs
[1] = 
NULL
;

987 ià(
chªge
->
ılchªge
[0]) {

988 ià(
chªge
->
ılchªge
[0]->
ä“
)

989 
chªge
->
ılchªge
[0]->
	`ä“
(change->cplchange[0]);

990 
	`g_ä“
(
chªge
->
ılchªge
[0]);

991 
chªge
->
ılchªge
[0] = 
NULL
;

993 ià(
chªge
->
ılchªge
[1]) {

994 ià(
chªge
->
ılchªge
[1]->
ä“
)

995 
chªge
->
ılchªge
[1]->
	`ä“
(change->cplchange[1]);

996 
	`g_ä“
(
chªge
->
ılchªge
[1]);

997 
chªge
->
ılchªge
[1] = 
NULL
;

999 
	}
}

1002 
	$mid£gm’t_chªge_­¶y
(
MidSegm’tChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1004 
NewO¹hCÚn
 *
Üth
 = (NewO¹hCÚÀ*)
obj
;

1005 
£g
;

1007 
chªge
->
­¶›d
 = 1;

1009 
chªge
->
ty³
) {

1010 
TYPE_ADD_SEGMENT
:

1011 
	`add_pošt
(
Üth
, 
chªge
->
£gm’t
+1, &chªge->
pošts
[1]);

1012 
	`add_pošt
(
Üth
, 
chªge
->
£gm’t
+1, &chªge->
pošts
[0]);

1013 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
+1, chªge->
hªdËs
[1],

1014 
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
] );

1015 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
+1, chªge->
hªdËs
[0],

1016 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
]) );

1017 
chªge
->
ılchªge
[0] =

1018 
	`cÚÅošše_add_pošt
(
Üth
->
midpošts
,&
chªge
->
pošts
[0]);

1019 
chªge
->
ılchªge
[1] =

1020 
	`cÚÅošše_add_pošt
(
Üth
->
midpošts
,&
chªge
->
pošts
[1]);

1022 
TYPE_REMOVE_SEGMENT
:

1023 
£g
 = 
chªge
->
£gm’t
?change->segment:1;

1024 
chªge
->
ılchªge
[0] =

1025 
	`cÚÅošše_»move_pošt
(
Üth
->
midpošts
,

1026 &
Üth
->
pošts
[
£g
-1]);

1027 
chªge
->
ılchªge
[1] =

1028 
	`cÚÅošše_»move_pošt
(
Üth
->
midpošts
,

1029 &
Üth
->
pošts
[
£g
]);

1030 
	`d–‘e_pošt
(
Üth
, 
chªge
->
£gm’t
);

1031 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
);

1032 
	`d–‘e_pošt
(
Üth
, 
chªge
->
£gm’t
);

1033 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
);

1034 ià(
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
]==
HORIZONTAL
) {

1035 
Üth
->
pošts
[
chªge
->
£gm’t
].
x
 = change->points[0].x;

1037 
Üth
->
pošts
[
chªge
->
£gm’t
].
y
 = change->points[0].y;

1041 
	`ÃwÜthcÚn_upd©e_midpošts
(
Üth
);

1042 
	}
}

1045 
	$mid£gm’t_chªge_»v”t
(
MidSegm’tChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1047 
NewO¹hCÚn
 *
Üth
 = (NewO¹hCÚÀ*)
obj
;

1049 
chªge
->
ılchªge
[0]->
	`»v”t
(chªge->ılchªge[0],
obj
);

1050 
chªge
->
ılchªge
[1]->
	`»v”t
(chªge->ılchªge[1],
obj
);

1052 
chªge
->
ty³
) {

1053 
TYPE_ADD_SEGMENT
:

1054 
	`d–‘e_pošt
(
Üth
, 
chªge
->
£gm’t
+1);

1055 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
+1);

1056 
	`d–‘e_pošt
(
Üth
, 
chªge
->
£gm’t
+1);

1057 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
+1);

1059 
TYPE_REMOVE_SEGMENT
:

1060 ià(
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
]==
HORIZONTAL
) {

1061 
Üth
->
pošts
[
chªge
->
£gm’t
].
x
 = change->points[1].x;

1063 
Üth
->
pošts
[
chªge
->
£gm’t
].
y
 = change->points[1].y;

1065 
	`add_pošt
(
Üth
, 
chªge
->
£gm’t
, &chªge->
pošts
[1]);

1066 
	`add_pošt
(
Üth
, 
chªge
->
£gm’t
, &chªge->
pošts
[0]);

1067 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
, chªge->
hªdËs
[1],

1068 
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
-1] );

1069 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
, chªge->
hªdËs
[0],

1070 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
-1]) );

1073 
chªge
->
­¶›d
 = 0;

1074 
	}
}

1076 
ObjeùChªge
 *

1077 
	$mid£gm’t_ü—‹_chªge
(
NewO¹hCÚn
 *
Üth
, 
chªge_ty³
 
ty³
,

1078 
£gm’t
,

1079 
Pošt
 *
pošt1
, Pošˆ*
pošt2
,

1080 
HªdË
 *
hªdË1
, HªdË *
hªdË2
)

1082 
MidSegm’tChªge
 *
chªge
;

1084 
chªge
 = 
	`g_Ãw
(
MidSegm’tChªge
, 1);

1086 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
mid£gm’t_chªge_­¶y
;

1087 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
mid£gm’t_chªge_»v”t
;

1088 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
mid£gm’t_chªge_ä“
;

1090 
chªge
->
ty³
 =ype;

1091 
chªge
->
­¶›d
 = 0;

1092 
chªge
->
£gm’t
 = segment;

1093 
chªge
->
pošts
[0] = *
pošt1
;

1094 
chªge
->
pošts
[1] = *
pošt2
;

1095 
chªge
->
hªdËs
[0] = 
hªdË1
;

1096 
chªge
->
hªdËs
[1] = 
hªdË2
;

1098  (
ObjeùChªge
 *)
chªge
;

1099 
	}
}

	@O:\tool\dvs50\lib\neworth_conn.h

18 #iâdeà
NEWORTH_CONN_H


19 
	#NEWORTH_CONN_H


	)

21 
	~"dŸty³s.h
"

22 
	~"objeù.h
"

23 
	~"cÚÅošt_lše.h
"

24 
	~"boundšgbox.h
"

25 
	~"Üth_cÚn.h
"

29 
	mHORIZONTAL
,

30 
	mVERTICAL


31 } 
	tOr›Á©iÚ
;

33 
	#FLIP_ORIENT
(
x
è(((x)==
HORIZONTAL
)?
VERTICAL
:HORIZONTAL)

	)

35 
	#HANDLE_MIDPOINT
 (
HANDLE_CUSTOM1
)

	)

42 
	s_NewO¹hCÚn
 {

44 
DŸObjeù
 
	mobjeù
;

46 
	mnumpošts
;

47 
Pošt
 *
	mpošts
;

48 
	mnumÜ›Á
;

49 
Or›Á©iÚ
 *
	mÜ›Á©iÚ
;

50 
	mnumhªdËs
;

51 
HªdË
 **
	mhªdËs
;

58 
CÚnPoštLše
 *
	mmidpošts
;

59 
PŞyBBExŒas
 
	mexŒa_¥acšg
;

62 
DIAVAR
 
ÃwÜthcÚn_upd©e_d©a
(
NewO¹hCÚn
 *
Üth
);

63 
DIAVAR
 
ÃwÜthcÚn_upd©e_boundšgbox
(
NewO¹hCÚn
 *
Üth
);

64 
ÃwÜthcÚn_sim¶e_d¿w
(
NewO¹hCÚn
 *
Üth
, 
DŸR’d””
 *
»nd””
,

65 
»®
 
width
);

66 
DIAVAR
 
ÃwÜthcÚn_š™
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
¡¬ošt
);

67 
DIAVAR
 
ÃwÜthcÚn_de¡roy
(
NewO¹hCÚn
 *
Üth
);

68 
DIAVAR
 
ÃwÜthcÚn_cİy
(
NewO¹hCÚn
 *
äom
, NewO¹hCÚÀ*
to
);

69 
DIAVAR
 
ÃwÜthcÚn_§ve
(
NewO¹hCÚn
 *
Üth
, 
ObjeùNode
 
obj_node
);

70 
DIAVAR
 
ÃwÜthcÚn_lßd
(
NewO¹hCÚn
 *
Üth
, 
ObjeùNode
 
obj_node
);

71 
DIAVAR
 
ObjeùChªge
* 
ÃwÜthcÚn_move_hªdË
(
NewO¹hCÚn
 *
Üth
, 
HªdË
 *
id
,

72 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

73 
HªdËMoveR—sÚ
 
»asÚ
,

74 
Modif›rKeys
 
modif›rs
);

75 
DIAVAR
 
ObjeùChªge
* 
ÃwÜthcÚn_move
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
to
);

76 
DIAVAR
 
»®
 
ÃwÜthcÚn_di¡ªû_äom
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
pošt
,

77 
»®
 
lše_width
);

78 
HªdË
* 
ÃwÜthcÚn_g‘_middË_hªdË
(
NewO¹hCÚn
 *
Üth
);

80 
DIAVAR
 
ÃwÜthcÚn_ÿn_d–‘e_£gm’t
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
);

81 
DIAVAR
 
ÃwÜthcÚn_ÿn_add_£gm’t
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
);

82 
DIAVAR
 
ObjeùChªge
 *
ÃwÜthcÚn_d–‘e_£gm’t
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
);

83 
DIAVAR
 
ObjeùChªge
 *
ÃwÜthcÚn_add_£gm’t
(
NewO¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
);

86 
	#NEWORTHCONN_COMMON_PROPERTIES
 \

87 
OBJECT_COMMON_PROPERTIES
, \

88 { "Üth_pošts", 
PROP_TYPE_POINTARRAY
, 0, "ÜthcÚÀpošts", 
NULL
}, \

89 { "Üth_Ü›Á", 
PROP_TYPE_ENUMARRAY
, 0, "ÜthcÚÀÜ›Á©iÚs", 
NULL
} \

90 

	)

91 
	#NEWORTHCONN_COMMON_PROPERTIES_OFFSETS
 \

92 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

93 { "Üth_pošts", 
PROP_TYPE_POINTARRAY
, \

94 
	`off£tof
(
NewO¹hCÚn
,
pošts
), off£tof(NewO¹hCÚn,
numpošts
)}, \

95 { "Üth_Ü›Á", 
PROP_TYPE_ENUMARRAY
, \

96 
	`off£tof
(
NewO¹hCÚn
,
Ü›Á©iÚ
), off£tof(NewO¹hCÚn,
numÜ›Á
)} \

97 

	)

	@O:\tool\dvs50\lib\objchange.c

19 
	~<cÚfig.h
>

21 
	~"objeù.h
"

25 
_ObjeùS‹Chªge
 
	tObjeùS‹Chªge
;

27 
	s_ObjeùS‹Chªge
 {

28 
ObjeùChªge
 
	mobj_chªge
;

30 
G‘S‹Func
 
	mg‘_¡©e
;

31 
S‘S‹Func
 
	m£t_¡©e
;

33 
ObjeùS‹
 *
	m§ved_¡©e
;

34 
DŸObjeù
 *
	mobj
;

38 
	$objeù_¡©e_chªge_­¶y_»v”t
(
ObjeùS‹Chªge
 *
chªge
, 
DŸObjeù
 *
obj
)

40 
ObjeùS‹
 *
Şd_¡©e
;

42 
Şd_¡©e
 = 
chªge
->
	`g‘_¡©e
(chªge->
obj
);

44 
chªge
->
	`£t_¡©e
(chªge->
obj
, chªge->
§ved_¡©e
);

46 
chªge
->
§ved_¡©e
 = 
Şd_¡©e
;

47 
	}
}

50 
	$objeù_¡©e_chªge_ä“
(
ObjeùS‹Chªge
 *
chªge
)

52 ià((
chªge
è&& (chªge->
§ved_¡©e
è&& (chªge->§ved_¡©e->
ä“
))

53 (*
chªge
->
§ved_¡©e
->
ä“
)(change->saved_state);

54 
	`g_ä“
(
chªge
->
§ved_¡©e
);

55 
	}
}

57 
ObjeùChªge
 *
	$Ãw_objeù_¡©e_chªge
(
DŸObjeù
 *
obj
,

58 
ObjeùS‹
 *
Şd_¡©e
,

59 
G‘S‹Func
 
g‘_¡©e
,

60 
S‘S‹Func
 
£t_¡©e
 )

62 
ObjeùS‹Chªge
 *
chªge
;

64 
	`g_»tuº_v®_if_ç
 (
g‘_¡©e
 !ğ
NULL
 && 
£t_¡©e
 != NULL, NULL);

66 
chªge
 = 
	`g_Ãw
(
ObjeùS‹Chªge
, 1);

68 
chªge
->
obj_chªge
.
­¶y
 =

69 (
ObjeùChªgeAµlyFunc
è
objeù_¡©e_chªge_­¶y_»v”t
;

70 
chªge
->
obj_chªge
.
»v”t
 =

71 (
ObjeùChªgeRev”tFunc
è
objeù_¡©e_chªge_­¶y_»v”t
;

72 
chªge
->
obj_chªge
.
ä“
 =

73 (
ObjeùChªgeF»eFunc
è
objeù_¡©e_chªge_ä“
;

75 
chªge
->
g‘_¡©e
 = get_state;

76 
chªge
->
£t_¡©e
 = set_state;

78 
chªge
->
obj
 = obj;

79 
chªge
->
§ved_¡©e
 = 
Şd_¡©e
;

81  (
ObjeùChªge
 *)
chªge
;

82 
	}
}

	@O:\tool\dvs50\lib\objchange.h

20 #iâdeà
OBJCHANGE_H


21 
	#OBJCHANGE_H


	)

23 
	~"dŸty³s.h
"

25 (*
	tObjeùChªgeAµlyFunc
)(
	tObjeùChªge
 *
	tchªge
, 
	tDŸObjeù
 *
	tobj
);

26 (*
	tObjeùChªgeRev”tFunc
)(
	tObjeùChªge
 *
	tchªge
, 
	tDŸObjeù
 *
	tobj
);

27 (*
	tObjeùChªgeF»eFunc
)(
	tObjeùChªge
 *
	tchªge
);

35 
	s_ObjeùChªge
 {

38 
ObjeùChªgeAµlyFunc
 
­¶y
;

39 
ObjeùChªgeRev”tFunc
 
»v”t
;

40 
ObjeùChªgeF»eFunc
 
ä“
;

45 
	s_ObjeùS‹
 {

46 (*
ä“
)(
ObjeùS‹
 *
¡©e
);

60 
ObjeùS‹
 * (*
	tG‘S‹Func
è(
	tDŸObjeù
* 
	tobj
);

70 (*
	tS‘S‹Func
è(
	tDŸObjeù
* 
	tobj
, 
	tObjeùS‹
 *
	t¡©e
);

73 
DIAVAR
 
ObjeùChªge
 *
	`Ãw_objeù_¡©e_chªge
(
DŸObjeù
 *
obj
,

74 
ObjeùS‹
 *
Şd_¡©e
,

75 
G‘S‹Func
 
g‘_¡©e
,

76 
S‘S‹Func
 
£t_¡©e
 );

	@O:\tool\dvs50\lib\object.c

20 
	~<cÚfig.h
>

22 
	~<¡dio.h
>

23 
	~<¡ršg.h
>

25 
	~<gtk/gtk.h
>

27 
	~"objeù.h
"

28 
	~"dŸg¿md©a.h
"

29 
	~"mes§ge.h
"

30 
	~"·»Á.h
"

32 
	~"dummy_d•.h
"

34 
	~"debug.h
"

36 
FaùÜySŒuùI‹mAÎ
 *
çùÜyCÚš”
;

46 
	$objeù_š™
(
DŸObjeù
 *
obj
,

47 
num_hªdËs
,

48 
num_cÚÃùiÚs
)

50 
obj
->
num_hªdËs
 =‚um_handles;

51 ià(
num_hªdËs
>0)

52 
obj
->
hªdËs
 = 
	`g_m®loc0
((
HªdË
 *è* 
num_hªdËs
);

54 
obj
->
hªdËs
 = 
NULL
;

56 
obj
->
num_cÚÃùiÚs
 =‚um_connections;

57 ià(
num_cÚÃùiÚs
>0)

58 
obj
->
cÚÃùiÚs
 = 
	`g_m®loc0
((
CÚÃùiÚPošt
 *è* 
num_cÚÃùiÚs
);

60 
obj
->
cÚÃùiÚs
 = 
NULL
;

61 
	}
}

69 
	$objeù_de¡roy
(
DŸObjeù
 *
obj
)

71 
	`objeù_uncÚÃù_®l
(
obj
);

73 ià(
obj
->
hªdËs
)

74 
	`g_ä“
(
obj
->
hªdËs
);

75 
obj
->
hªdËs
 = 
NULL
;

76 ià(
obj
->
cÚÃùiÚs
)

77 
	`g_ä“
(
obj
->
cÚÃùiÚs
);

78 
obj
->
cÚÃùiÚs
 = 
NULL
;

79 ià(
obj
->
m‘a
)

80 
	`g_hash_bË_de¡roy
 (
obj
->
m‘a
);

81 
obj
->
m‘a
 = 
NULL
;

82 
	}
}

100 
	$objeù_cİy
(
DŸObjeù
 *
äom
, DŸObjeù *
to
)

102 
to
->
ty³
 = 
äom
->type;

103 
to
->
pos™iÚ
 = 
äom
->position;

104 
to
->
boundšg_box
 = 
äom
->bounding_box;

106 
to
->
num_hªdËs
 = 
äom
->num_handles;

107 ià(
to
->
hªdËs
 !ğ
NULL
è
	`g_ä“
(to->handles);

108 ià(
to
->
num_hªdËs
>0)

109 
to
->
hªdËs
 = 
	`g_m®loc
((
HªdË
 *)*to->
num_hªdËs
);

111 
to
->
hªdËs
 = 
NULL
;

113 
to
->
num_cÚÃùiÚs
 = 
äom
->num_connections;

114 ià(
to
->
cÚÃùiÚs
 !ğ
NULL
è
	`g_ä“
(to->connections);

115 ià(
to
->
num_cÚÃùiÚs
>0)

116 
to
->
cÚÃùiÚs
 = 
	`g_m®loc0
((
CÚÃùiÚPošt
 *è*o->
num_cÚÃùiÚs
);

118 
to
->
cÚÃùiÚs
 = 
NULL
;

120 
to
->
İs
 = 
äom
->ops;

122 
to
->
æags
 = 
äom
->flags;

123 
to
->
·»Á
 = 
äom
->parent;

124 
to
->
chd»n
 = 
	`g_li¡_cİy
(
äom
->children);

125 
	}
}

130 
gušt


131 
	$poš‹r_hash
(
gpoš‹r
 
some_poš‹r
)

133  
	`GPOINTER_TO_UINT
(
some_poš‹r
);

134 
	}
}

147 
GLi¡
 *

148 
	$objeù_cİy_li¡
(
GLi¡
 *
li¡_Üig
)

150 
GLi¡
 *
li¡_cİy
;

151 
GLi¡
 *
li¡
;

152 
DŸObjeù
 *
obj
;

153 
DŸObjeù
 *
obj_cİy
;

154 
GHashTabË
 *
hash_bË
;

155 
i
;

157 
hash_bË
 = 
	`g_hash_bË_Ãw
((
GHashFunc
è
poš‹r_hash
, 
NULL
);

160 
li¡
 = 
li¡_Üig
;

161 
li¡_cİy
 = 
NULL
;

162 
li¡
 !ğ
NULL
)

164 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

166 
obj_cİy
 = 
obj
->
İs
->
	`cİy
(obj);

168 
	`g_hash_bË_š£¹
(
hash_bË
, 
obj
, 
obj_cİy
);

170 
li¡_cİy
 = 
	`g_li¡_­³nd
Öi¡_cİy, 
obj_cİy
);

172 
li¡
 = 
	`g_li¡_Ãxt
(list);

177 
li¡
 = 
li¡_Üig
;

178 
li¡
 !ğ
NULL
)

180 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

181 
obj_cİy
 = 
	`g_hash_bË_lookup
(
hash_bË
, 
obj
);

183 ià(
obj_cİy
->
·»Á
)

184 
obj_cİy
->
·»Á
 = 
	`g_hash_bË_lookup
(
hash_bË
, obj_copy->parent);

186 ià(
	`objeù_æags_£t
(
obj_cİy
, 
DIA_OBJECT_CAN_PARENT
)

187 && 
obj_cİy
->
chd»n
)

189 
GLi¡
 *
chd_li¡
 = 
obj_cİy
->
chd»n
;

190 
chd_li¡
)

192 
DŸObjeù
 *
chd_obj
 = (DŸObjeù *è
chd_li¡
->
d©a
;

193 
chd_li¡
->
d©a
 = 
	`g_hash_bË_lookup
(
hash_bË
, 
chd_obj
);

194 
chd_li¡
 = 
	`g_li¡_Ãxt
(child_list);

198 
i
=0; i<
obj
->
num_hªdËs
; i++)

200 
CÚÃùiÚPošt
 *
cÚ_pošt
;

201 
cÚ_pošt
 = 
obj
->
hªdËs
[
i
]->
cÚÃùed_to
;

203 iàĞ
cÚ_pošt
 !ğ
NULL
 )

205 
DŸObjeù
 *
Ùh”_obj
;

206 
DŸObjeù
 *
Ùh”_obj_cİy
;

207 
cÚ_pošt_Ä
;

209 
Ùh”_obj
 = 
cÚ_pošt
->
objeù
;

210 
Ùh”_obj_cİy
 = 
	`g_hash_bË_lookup
(
hash_bË
, 
Ùh”_obj
);

212 ià(
Ùh”_obj_cİy
 =ğ
NULL
)

224 
obj_cİy
->
hªdËs
[
i
]->
cÚÃùed_to
 = 
NULL
;

228 
cÚ_pošt_Ä
=0;

229 
Ùh”_obj
->
cÚÃùiÚs
[
cÚ_pošt_Ä
] !ğ
cÚ_pošt
)

231 
cÚ_pošt_Ä
++;

234 
	`objeù_cÚÃù
(
obj_cİy
, obj_cİy->
hªdËs
[
i
],

235 
Ùh”_obj_cİy
->
cÚÃùiÚs
[
cÚ_pošt_Ä
]);

239 
li¡
 = 
	`g_li¡_Ãxt
(list);

242 
	`g_hash_bË_de¡roy
(
hash_bË
);

244  
li¡_cİy
;

245 
	}
}

260 
ObjeùChªge
*

261 
	$objeù_li¡_move_d–_r
(
GLi¡
 *
objeùs
, 
Pošt
 *
d–
, 
gboŞ—n
 
afãùed
)

263 
GLi¡
 *
li¡
;

264 
DŸObjeù
 *
obj
;

265 
Pošt
 
pos
;

266 
ObjeùChªge
 *
objchªge
 = 
NULL
;

268 ià(
d–
->
x
 =ğ0 && d–->
y
 == 0)

269  
NULL
;

271 
li¡
 = 
objeùs
;

272 
li¡
 !ğ
NULL
)

274 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

276 
pos
 = 
obj
->
pos™iÚ
;

277 
	`pošt_add
(&
pos
, 
d–
);

279 ià(
obj
->
·»Á
 && 
afãùed
)

281 
ReùªgË
 
p_ext
;

282 
ReùªgË
 
c_ext
;

283 
Pošt
 
Ãw_d–
;

285 
	`·»Á_hªdË_ex‹Ás
(
obj
->
·»Á
, &
p_ext
);

286 
	`·»Á_hªdË_ex‹Ás
(
obj
, &
c_ext
);

287 
Ãw_d–
 = 
	`·»Á_move_chd_d–
(&
p_ext
, &
c_ext
, 
d–
);

288 
	`pošt_add
(&
pos
, &
Ãw_d–
);

289 
	`pošt_add
(
d–
, &
Ãw_d–
);

291 
objchªge
 = 
obj
->
İs
->
	`move
(obj, &
pos
);

293 ià(
	`objeù_æags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
è&& obj->
chd»n
)

294 
objchªge
 = 
	`objeù_li¡_move_d–_r
(
obj
->
chd»n
, 
d–
, 
FALSE
);

296 
li¡
 = 
	`g_li¡_Ãxt
(list);

298  
objchªge
;

299 
	}
}

306 
ObjeùChªge
*

307 
	$objeù_li¡_move_d–
(
GLi¡
 *
objeùs
, 
Pošt
 *
d–
)

309 
GLi¡
 *
li¡
;

310 
DŸObjeù
 *
obj
;

311 
GLi¡
 *
´oûss
;

312 
ObjeùChªge
 *
objchªge
 = 
NULL
;

314 
objeùs
 = 
	`·»Á_li¡_afãùed_h›¿rchy
(objects);

315 
li¡
 = 
objeùs
;

318 
li¡
 !ğ
NULL
)

320 
obj
 = (
DŸObjeù
 *è
li¡
->
d©a
;

322 
´oûss
 = 
NULL
;

323 
´oûss
 = 
	`g_li¡_­³nd
Õroûss, 
obj
);

324 
objchªge
 = 
	`objeù_li¡_move_d–_r
(
´oûss
, 
d–
, (
obj
->
·»Á
 !ğ
NULL
) );

325 
	`g_li¡_ä“
(
´oûss
);

327 
li¡
 = 
	`g_li¡_Ãxt
(list);

329  
objchªge
;

330 
	}
}

337 
	$de¡roy_objeù_li¡
(
GLi¡
 *
li¡_to_be_de¡royed
)

339 
GLi¡
 *
li¡
;

340 
DŸObjeù
 *
obj
;

342 
li¡
 = 
li¡_to_be_de¡royed
;

343 
li¡
 !ğ
NULL
)

345 
obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

347 
obj
->
İs
->
	`de¡roy
(obj);

348 
	`g_ä“
(
obj
);

350 
li¡
 = 
	`g_li¡_Ãxt
(list);

353 
	`g_li¡_ä“
(
li¡_to_be_de¡royed
);

354 
	}
}

364 
	$objeù_add_hªdË
(
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
)

366 
	`objeù_add_hªdË_©
(
obj
, 
hªdË
, obj->
num_hªdËs
);

367 
	}
}

378 
	$objeù_add_hªdË_©
(
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
, 
pos
)

380 
i
;

382 
	`g_as£¹
(0 <ğ
pos
 &&…o <ğ
obj
->
num_hªdËs
);

384 
obj
->
num_hªdËs
++;

386 
obj
->
hªdËs
 =

387 
	`g_»®loc
(
obj
->
hªdËs
, obj->
num_hªdËs
*(
HªdË
 *));

389 
i
=
obj
->
num_hªdËs
-1; i > 
pos
; i--)

391 
obj
->
hªdËs
[
i
] = obj->handles[i-1];

393 
obj
->
hªdËs
[
pos
] = 
hªdË
;

394 
	}
}

403 
	$objeù_»move_hªdË
(
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
)

405 
i
, 
hªdË_Ä
;

407 
hªdË_Ä
 = -1;

408 
i
=0; i<
obj
->
num_hªdËs
; i++)

410 ià(
obj
->
hªdËs
[
i
] =ğ
hªdË
)

411 
hªdË_Ä
 = 
i
;

414 ià(
hªdË_Ä
 < 0)

416 
	`mes§ge_”rÜ
("Internalƒrror, object_remove_handle: Handle doesn'tƒxist");

420 
i
=
hªdË_Ä
; i<(
obj
->
num_hªdËs
-1); i++)

422 
obj
->
hªdËs
[
i
] = obj->handles[i+1];

424 
obj
->
hªdËs
[obj->
num_hªdËs
-1] = 
NULL
;

426 
obj
->
num_hªdËs
--;

428 
obj
->
hªdËs
 =

429 
	`g_»®loc
(
obj
->
hªdËs
, obj->
num_hªdËs
*(
HªdË
 *));

430 
	}
}

438 
	$objeù_add_cÚÃùiÚpošt
(
DŸObjeù
 *
obj
, 
CÚÃùiÚPošt
 *
cÚpošt
)

440 
	`objeù_add_cÚÃùiÚpošt_©
(
obj
, 
cÚpošt
, obj->
num_cÚÃùiÚs
);

441 
	}
}

450 
	$objeù_add_cÚÃùiÚpošt_©
(
DŸObjeù
 *
obj
,

451 
CÚÃùiÚPošt
 *
cÚpošt
, 
pos
)

453 
i
;

455 
obj
->
num_cÚÃùiÚs
++;

457 
obj
->
cÚÃùiÚs
 =

458 
	`g_»®loc
(
obj
->
cÚÃùiÚs
,

459 
obj
->
num_cÚÃùiÚs
*(
CÚÃùiÚPošt
 *));

461 
i
=
obj
->
num_cÚÃùiÚs
-1; i > 
pos
; i--)

463 
obj
->
cÚÃùiÚs
[
i
] = obj->connections[i-1];

465 
obj
->
cÚÃùiÚs
[
pos
] = 
cÚpošt
;

466 
	}
}

478 
	$objeù_»move_cÚÃùiÚpošt
(
DŸObjeù
 *
obj
, 
CÚÃùiÚPošt
 *
cÚpošt
)

480 
i
, 
Ä
;

482 
Ä
 = -1;

483 
i
=0; i<
obj
->
num_cÚÃùiÚs
; i++)

485 ià(
obj
->
cÚÃùiÚs
[
i
] =ğ
cÚpošt
)

486 
Ä
 = 
i
;

489 ià(
Ä
 < 0)

491 
	`mes§ge_”rÜ
("Internalƒrror, object_remove_connectionpoint: "

496 
	`objeù_»move_cÚÃùiÚs_to
(
cÚpošt
);

498 
i
=
Ä
; i<(
obj
->
num_cÚÃùiÚs
-1); i++)

500 
obj
->
cÚÃùiÚs
[
i
] = obj->connections[i+1];

502 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1] = 
NULL
;

504 
obj
->
num_cÚÃùiÚs
--;

506 
obj
->
cÚÃùiÚs
 =

507 
	`g_»®loc
(
obj
->
cÚÃùiÚs
, obj->
num_cÚÃùiÚs
*(
CÚÃùiÚPošt
 *));

508 
	}
}

519 
	$objeù_cÚÃù
(
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
,

520 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
)

522 
	`g_»tuº_if_ç
 (
obj
 && obj->
ty³
 && obj->ty³->
Çme
);

523 
	`g_»tuº_if_ç
 (
cÚÃùiÚpošt
 && cÚÃùiÚpošt->
objeù
 &&

524 
cÚÃùiÚpošt
->
objeù
->
ty³
 && cÚÃùiÚpošt->objeù->ty³->
Çme
);

525 ià(
hªdË
->
cÚÃù_ty³
==
HANDLE_NONCONNECTABLE
)

527 
	`mes§ge_”rÜ
("Error?ryingo connect‡‚on connectable handle.\n"

530 
obj
->
ty³
->
Çme
,

531 
cÚÃùiÚpošt
->
objeù
->
ty³
->
Çme
);

534 
hªdË
->
cÚÃùed_to
 = 
cÚÃùiÚpošt
;

535 
cÚÃùiÚpošt
->
cÚÃùed
 =

536 
	`g_li¡_´•’d
(
cÚÃùiÚpošt
->
cÚÃùed
, 
obj
);

537 
	}
}

544 
	$objeù_uncÚÃù
(
DŸObjeù
 *
cÚÃùed_obj
, 
HªdË
 *
hªdË
)

546 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
;

548 
cÚÃùiÚpošt
 = 
hªdË
->
cÚÃùed_to
;

550 ià(
cÚÃùiÚpošt
!=
NULL
)

552 
cÚÃùiÚpošt
->
cÚÃùed
 =

553 
	`g_li¡_»move
(
cÚÃùiÚpošt
->
cÚÃùed
, 
cÚÃùed_obj
);

554 
hªdË
->
cÚÃùed_to
 = 
NULL
;

556 
	}
}

565 
	$objeù_»move_cÚÃùiÚs_to
(
CÚÃùiÚPošt
 *
cÚpošt
)

567 
GLi¡
 *
li¡
;

568 
DŸObjeù
 *
cÚÃùed_obj
;

569 
i
;

571 
li¡
 = 
cÚpošt
->
cÚÃùed
;

572 
li¡
 !ğ
NULL
)

574 
cÚÃùed_obj
 = (
DŸObjeù
 *)
li¡
->
d©a
;

576 
i
=0; i<
cÚÃùed_obj
->
num_hªdËs
; i++)

578 ià(
cÚÃùed_obj
->
hªdËs
[
i
]->
cÚÃùed_to
 =ğ
cÚpošt
)

580 
cÚÃùed_obj
->
hªdËs
[
i
]->
cÚÃùed_to
 = 
NULL
;

583 
li¡
 = 
	`g_li¡_Ãxt
(list);

585 
	`g_li¡_ä“
(
cÚpošt
->
cÚÃùed
);

586 
cÚpošt
->
cÚÃùed
 = 
NULL
;

587 
	}
}

593 
	$objeù_uncÚÃù_®l
(
DŸObjeù
 *
obj
)

595 
i
;

597 
i
=0; i<
obj
->
num_hªdËs
; i++)

599 
	`objeù_uncÚÃù
(
obj
, obj->
hªdËs
[
i
]);

601 
i
=0; i<
obj
->
num_cÚÃùiÚs
; i++)

603 
	`objeù_»move_cÚÃùiÚs_to
(
obj
->
cÚÃùiÚs
[
i
]);

605 
	}
}

614 
	$objeù_§ve
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
)

616 
	`d©a_add_pošt
(
	`Ãw_©Œibu‹
(
obj_node
, "obj_pos"),

617 &
obj
->
pos™iÚ
);

618 
	`d©a_add_»ùªgË
(
	`Ãw_©Œibu‹
(
obj_node
, "obj_bb"),

619 &
obj
->
boundšg_box
);

620 ià(
obj
->
m‘a
)

621 
	`d©a_add_diù
 (
	`Ãw_©Œibu‹
(
obj_node
, "m‘a"), 
obj
->
m‘a
);

622 
	}
}

631 
	$objeù_lßd
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
)

633 
A‰ribu‹Node
 
©Œ
;

635 
obj
->
pos™iÚ
.
x
 = 0.0;

636 
obj
->
pos™iÚ
.
y
 = 0.0;

637 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "obj_pos");

638 ià(
©Œ
 !ğ
NULL
)

639 
	`d©a_pošt
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
obj
->
pos™iÚ
 );

641 
obj
->
boundšg_box
.
Ëá
 = obj->boundšg_box.
right
 = 0.0;

642 
obj
->
boundšg_box
.
tİ
 = obj->boundšg_box.
bÙtom
 = 0.0;

643 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "obj_bb");

644 ià(
©Œ
 !ğ
NULL
)

645 
	`d©a_»ùªgË
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
obj
->
boundšg_box
 );

647 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "meta");

648 ià(
©Œ
 !ğ
NULL
)

649 
obj
->
m‘a
 = 
	`d©a_diù
 (
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

650 
	}
}

657 
Lay”
 *

658 
	$dŸ_objeù_g‘_·»Á_Ïy”
(
DŸObjeù
 *
obj
)

660  
obj
->
·»Á_Ïy”
;

661 
	}
}

671 
gboŞ—n


672 
	$dŸ_objeù_is_£Ëùed
 (cÚ¡ 
DŸObjeù
 *
obj
)

674 
Lay”
 *
Ïy”
 = 
obj
->
·»Á_Ïy”
;

675 
DŸg¿mD©a
 *
dŸg¿m
 = 
Ïy”
 ?†ay”->
·»Á_dŸg¿m
 : 
NULL
;

676 
GLi¡
 * 
£Ëùed
;

684 ià(!
dŸg¿m
)

685  
FALSE
;

687 
£Ëùed
 = 
dŸg¿m
->selected;

688 ; 
£Ëùed
 !ğ
NULL
; s–eùed = 
	`g_li¡_Ãxt
(selected))

690 ià(
£Ëùed
->
d©a
 =ğ
obj
è 
TRUE
;

692  
FALSE
;

693 
	}
}

705 
DŸObjeù
 *

706 
	$dŸ_objeù_g‘_·»Á_w™h_æags
(
DŸObjeù
 *
obj
, 
gušt
 
æags
)

708 
DŸObjeù
 *
tİ
 = 
obj
;

709 ià(
obj
 =ğ
NULL
)

711  
NULL
;

713 
obj
->
·»Á
 !ğ
NULL
)

715 
obj
 = obj->
·»Á
;

716 ià((
obj
->
æags
 & flags) == flags)

718 
tİ
 = 
obj
;

721  
tİ
;

722 
	}
}

732 
gboŞ—n


733 
	$dŸ_objeù_is_£ËùabË
(
DŸObjeù
 *
obj
)

735 ià(
obj
->
·»Á_Ïy”
 =ğ
NULL
)

737  
FALSE
;

739  
obj
->
·»Á_Ïy”
 =ğobj->·»Á_Ïy”->
·»Á_dŸg¿m
->
aùive_Ïy”


740 && 
obj
 =ğ
	`dŸ_objeù_g‘_·»Á_w™h_æags
(obj, 
DIA_OBJECT_GRABS_CHILD_INPUT
);

741 
	}
}

743 #ifdeà
DEBUG


744 
	$´štKey
(
gpoš‹r
 
key
,gpoš‹¸
v®ue
,gpoš‹¸
d©a
)

746 
	`g_´štf
("Key i %s: ",
key
);

747 
	`g_¦i¡_fÜ—ch
((
GLi¡
*)
v®ue
,(
GFunc
)
g_´štf
,
NULL
);

748 
	`g_´štf
("\n");

749 
	}
}

754 
gušt
 
	$hash
(
gpoš‹r
 
key
)

756 *
¡ršg
 = (*)
key
;

757 
sum
;

759 
sum
 = 0;

760 *
¡ršg
)

762 
sum
 +ğ(*
¡ršg
);

763 
¡ršg
++;

766  
sum
;

767 
	}
}

769 
gšt
 
	$com·»
(
gpoš‹r
 
a
, gpoš‹¸
b
)

771  
	`¡rcmp
((*)
a
, (*)
b
)==0;

772 
	}
}

774 
GHashTabË
 *
objeù_ty³_bË
 = 
NULL
;

778 
	$objeù_»gi¡ry_š™
()

780 
objeù_ty³_bË
 = 
	`g_hash_bË_Ãw
Ğ(
GHashFunc
è
hash
, (
GCom·»Func
è
com·»
 );

781 
	}
}

791 
	$objeù_»gi¡”_ty³
(
DŸObjeùTy³
 *
ty³
)

794 ià(
	`g_hash_bË_lookup
(
objeù_ty³_bË
, 
ty³
->
Çme
è!ğ
NULL
)

796 
	`mes§ge_w¬nšg
("Several object-types were‚amed %s.\n"

799 
ty³
->
Çme
);

802 
	`g_hash_bË_š£¹
(
objeù_ty³_bË
, 
ty³
->
Çme
,ype);

803 
	}
}

811 
	$objeù_»gi¡ry_fÜ—ch
 (
GHFunc
 
func
, 
gpoš‹r
 
u£r_d©a
)

813 
	`g_hash_bË_fÜ—ch
 (
objeù_ty³_bË
, 
func
, 
u£r_d©a
);

814 
	}
}

823 
DIAVAR
 
DŸObjeùTy³
 *

824 
	$objeù_g‘_ty³
(*
Çme
)

826  (
DŸObjeùTy³
 *è
	`g_hash_bË_lookup
(
objeù_ty³_bË
, 
Çme
);

827 
	}
}

834 
gboŞ—n


835 
	$objeù_æags_£t
(
DŸObjeù
 *
obj
, 
gšt
 
æags
)

837  (
obj
->
æags
 & flags) == flags;

838 
	}
}

851 
DŸObjeù
 *

852 
	$objeù_lßd_usšg_´İ”t›s
(cÚ¡ 
DŸObjeùTy³
 *
ty³
,

853 
ObjeùNode
 
obj_node
, 
v”siÚ
,

854 cÚ¡ *
f’ame
)

856 
DŸObjeù
 *
obj
;

857 
Pošt
 
¡¬ošt
 = {0.0,0.0};

858 
HªdË
 *
hªdË1
,*
hªdË2
;

860 
obj
 = 
ty³
->
İs
->
	`ü—‹
(&
¡¬ošt
,
NULL
, &
hªdË1
,&
hªdË2
);

861 
	`objeù_lßd_´İs
(
obj
,
obj_node
);

862  
obj
;

863 
	}
}

875 
	$objeù_§ve_usšg_´İ”t›s
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
,

876 
v”siÚ
, cÚ¡ *
f’ame
)

878 
	`objeù_§ve_´İs
(
obj
,
obj_node
);

879 
	}
}

886 
DŸObjeù
 *
	$objeù_cİy_usšg_´İ”t›s
(
DŸObjeù
 *
obj
)

888 
Pošt
 
¡¬ošt
 = {0.0,0.0};

889 
HªdË
 *
hªdË1
,*
hªdË2
;

890 
DŸObjeù
 *
Ãwobj
 = 
obj
->
ty³
->
İs
->
	`ü—‹
(&
¡¬ošt
,
NULL
,

891 &
hªdË1
,&
hªdË2
);

892 
	`objeù_cİy_´İs
(
Ãwobj
,
obj
,
FALSE
);

893  
Ãwobj
;

894 
	}
}

903 cÚ¡ 
ReùªgË
 *

904 
	$dŸ_objeù_g‘_boundšg_box
(cÚ¡ 
DŸObjeù
 *
obj
)

906  &
obj
->
boundšg_box
;

907 
	}
}

914 cÚ¡ 
ReùªgË
 *
	$dŸ_objeù_g‘_’şosšg_box
(cÚ¡ 
DŸObjeù
 *
obj
)

919 ià(
obj
->
’şosšg_box
.
tİ
 == 0.0 &&

920 
obj
->
’şosšg_box
.
bÙtom
 == 0.0 &&

921 
obj
->
’şosšg_box
.
Ëá
 == 0.0 &&

922 
obj
->
’şosšg_box
.
right
 == 0.0)

924  &
obj
->
boundšg_box
;

928 }  &
obj
->
’şosšg_box
;

929 
	}
}

940 
gboŞ—n


941 
	$dŸ_objeù_§n™y_check
(cÚ¡ 
DŸObjeù
 *
obj
, cÚ¡ 
gch¬
 *
msg
)

943 
i
;

945 
	`dŸ_as£¹_Œue
(
obj
->
ty³
 !ğ
NULL
,

947 
msg
, 
obj
);

948 ià(
obj
 !ğ
NULL
)

950 
	`dŸ_as£¹_Œue
(
obj
->
ty³
->
Çme
 !ğ
NULL
 &&

951 
	`g_utf8_v®id©e
(
obj
->
ty³
->
Çme
, -1, 
NULL
),

953 
msg
, 
obj
, obj->
ty³
->
Çme
);

956 
	`dŸ_as£¹_Œue
(
obj
->
num_hªdËs
 >= 0,

958 
msg
, 
obj
, obj->
num_hªdËs
);

959 ià(
obj
->
num_hªdËs
 != 0)

961 
	`dŸ_as£¹_Œue
(
obj
->
hªdËs
 !ğ
NULL
,

962 "%s: Objeù %°ha nuÎ hªdËs\n", 
obj
);

964 
i
 = 0; i < 
obj
->
num_hªdËs
; i++)

966 
HªdË
 *
h
 = 
obj
->
hªdËs
[
i
];

967 
	`dŸ_as£¹_Œue
(
h
 !ğ
NULL
, "%s: Object %p handle %d is‚ull\n",

968 
msg
, 
obj
, 
i
);

969 ià(
h
 !ğ
NULL
)

972 
	`dŸ_as£¹_Œue
((
h
->
id
 >ğ0 && h->id <ğ
HANDLE_MOVE_ENDPOINT
)

973 || (
h
->
id
 >ğ
HANDLE_CUSTOM1
 && h->id <ğ
HANDLE_CUSTOM9
),

975 
msg
, 
obj
, 
i
, 
h
, h->
id
);

977 
	`dŸ_as£¹_Œue
(
h
->
ty³
 >ğ0 && h->ty³ <ğ
NUM_HANDLE_TYPES
,

979 
msg
, 
obj
, 
i
, 
h
, h->
ty³
);

982 
	`dŸ_as£¹_Œue
(
h
->
cÚÃù_ty³
 >= 0

983 && 
h
->
cÚÃù_ty³
 <ğ
HANDLE_CONNECTABLE_NOBREAK
,

985 
msg
, 
obj
, 
i
, 
h
, h->
cÚÃù_ty³
);

989 
CÚÃùiÚPošt
 *
ı
 = 
h
->
cÚÃùed_to
;

990 ià(
ı
 !ğ
NULL
)

992 
gboŞ—n
 
found
 = 
FALSE
;

993 
GLi¡
 *
cÚns
;

994 ià(!
	`dŸ_as£¹_Œue
(
ı
->
objeù
 !ğ
NULL
,

996 
msg
, 
i
, 
h
, 
obj
, 
ı
)) ;

997 ià(!
	`dŸ_as£¹_Œue
(
ı
->
objeù
->
ty³
 !ğ
NULL
,

999 
msg
, 
i
, 
h
, 
obj
, 
ı
, cp->
objeù
)) ;

1000 ià(!
	`dŸ_as£¹_Œue
(
ı
->
objeù
->
ty³
->
Çme
 !ğ
NULL
 &&

1001 
	`g_utf8_v®id©e
(
ı
->
objeù
->
ty³
->
Çme
, -1, 
NULL
),

1003 
msg
, 
i
, 
h
, 
obj
, 
ı
, cp->
objeù
)) ;

1004 
	`dŸ_as£¹_Œue
(
	`çbs
(
ı
->
pos
.
x
 - 
h
->pos.x) < 0.0000001 &&

1005 
	`çbs
(
ı
->
pos
.
y
 - 
h
->pos.y) < 0.0000001,

1007 
msg
, 
i
, 
h
, 
obj
, h->
pos
.
x
, h->pos.
y
,

1008 
ı
, cp->
objeù
, cp->
pos
.
x
, cp->pos.
y
);

1009 
cÚns
 = 
ı
->
cÚÃùed
; cÚn !ğ
NULL
; cÚn ğ
	`g_li¡_Ãxt
(conns))

1011 
DŸObjeù
 *
obj2
 = (DŸObjeù *)
cÚns
->
d©a
;

1012 
j
;

1014 
j
 = 0; j < 
obj2
->
num_hªdËs
; j++)

1016 ià(
obj2
->
hªdËs
[
j
]->
cÚÃùed_to
 =ğ
ı
è
found
 = 
TRUE
;

1019 
	`dŸ_as£¹_Œue
(
found
 =ğ
TRUE
,

1021 
msg
, 
i
, 
h
, 
obj
, 
ı
, cp->
objeù
);

1024 
FALSE
);

1028 
	`dŸ_as£¹_Œue
(
obj
->
num_cÚÃùiÚs
 >= 0,

1030 
msg
, 
obj
, obj->
num_cÚÃùiÚs
);

1031 ià(
obj
->
num_cÚÃùiÚs
 != 0)

1033 
	`dŸ_as£¹_Œue
(
obj
->
cÚÃùiÚs
 !ğ
NULL
,

1035 
msg
, 
obj
);

1037 
i
 = 0; i < 
obj
->
num_cÚÃùiÚs
; i++)

1039 
GLi¡
 *
cÚÃùed
;

1040 
CÚÃùiÚPošt
 *
ı
 = 
obj
->
cÚÃùiÚs
[
i
];

1041 
j
;

1042 
	`dŸ_as£¹_Œue
(
ı
 !ğ
NULL
, "%s: Objeù %°ha nuÎ CP‡ˆ%d\n", 
msg
, 
obj
, 
i
);

1043 ià(
ı
 !ğ
NULL
)

1045 
	`dŸ_as£¹_Œue
(
ı
->
objeù
 =ğ
obj
,

1047 
msg
, 
obj
, 
i
, 
ı
, cp->
objeù
);

1048 
	`dŸ_as£¹_Œue
((
ı
->
dœeùiÚs
 & (~
DIR_ALL
)) == 0,

1050 
msg
, 
obj
, 
i
, 
ı
, cp->
dœeùiÚs
);

1051 
	`dŸ_as£¹_Œue
((
ı
->
æags
 & 
CP_FLAGS_MAIN
) == cp->flags,

1053 
msg
, 
obj
, 
i
, 
ı
, cp->
æags
);

1054 
	`dŸ_as£¹_Œue
(
ı
->
Çme
 =ğ
NULL


1055 || 
	`g_utf8_v®id©e
(
ı
->
Çme
, -1, 
NULL
),

1057 
msg
, 
obj
, 
i
, 
ı
, cp->
Çme
);

1058 
j
 = 0;

1059 
cÚÃùed
 = 
ı
->cÚÃùed; cÚÃùed !ğ
NULL
;

1060 
cÚÃùed
 = 
	`g_li¡_Ãxt
(connected))

1062 
DŸObjeù
 *
obj2
;

1063 
obj2
 = 
cÚÃùed
->
d©a
;

1064 
	`dŸ_as£¹_Œue
(
obj2
 !ğ
NULL
, "%s: Object %p CP %d (%p) has NULL object‡t index %d\n",

1065 
msg
, 
obj
, 
i
, 
ı
, 
j
);

1066 ià(
obj2
 !ğ
NULL
)

1068 
k
;

1069 
gboŞ—n
 
found_hªdË
 = 
FALSE
;

1070 
	`dŸ_as£¹_Œue
(
obj2
->
ty³
->
Çme
 !ğ
NULL
 &&

1071 
	`g_utf8_v®id©e
(
obj2
->
ty³
->
Çme
, -1, 
NULL
),

1073 
msg
, 
obj
, 
i
, 
ı
, 
obj2
, obj2->
ty³
->
Çme
, 
j
);

1075 
k
 = 0; k < 
obj2
->
num_hªdËs
; k++)

1077 ià(
obj2
->
hªdËs
[
k
] !ğ
NULL
 &&

1078 
obj2
->
hªdËs
[
k
]->
cÚÃùed_to
 =ğ
ı
)

1080 
found_hªdË
 = 
TRUE
;

1083 
	`dŸ_as£¹_Œue
(
found_hªdË
,

1085 
msg
, 
obj
, 
i
, 
ı
, 
obj2
, obj2->
ty³
->
Çme
, 
j
);

1087 
j
++;

1093  
TRUE
;

1094 
	}
}

1097 
	$dŸ_objeù_£t_m‘a
 (
DŸObjeù
 *
obj
, cÚ¡ 
gch¬
 *
key
, cÚ¡ gch¬ *
v®ue
)

1099 
	`g_»tuº_if_ç
 (
obj
 !ğ
NULL
 && 
key
 != NULL);

1100 ià(!
obj
->
m‘a
)

1101 
obj
->
m‘a
 = 
	`g_hash_bË_Ãw_fuÎ
 (
g_¡r_hash
, 
g_¡r_equ®
, 
g_ä“
, g_free);

1102 ià(
v®ue
)

1103 
	`g_hash_bË_š£¹
 (
obj
->
m‘a
, 
	`g_¡rdup
 (
key
), g_¡rdu°(
v®ue
));

1105 
	`g_hash_bË_»move
 (
obj
->
m‘a
, 
key
);

1106 
	}
}

1108 
gch¬
 *

1109 
	$dŸ_objeù_g‘_m‘a
 (
DŸObjeù
 *
obj
, cÚ¡ 
gch¬
 *
key
)

1111 
gch¬
 *
v®
;

1112 ià(!
obj
->
m‘a
)

1113  
NULL
;

1114 
v®
 = 
	`g_hash_bË_lookup
 (
obj
->
m‘a
, 
key
);

1115  
	`g_¡rdup
 (
v®
);

1116 
	}
}

1118 
gch¬
 *
	$çùÜy_utf8
(
gch¬
 *
¡r
)

1120  
	`g_loÿË_to_utf8
(
	`_
(
¡r
),-1,
NULL
,NULL,NULL);

1121 
	}
}

1123 
gch¬
 *
	$çùÜy_loÿË
(
gch¬
 *
¡r
)

1125  
	`g_loÿË_äom_utf8
(
	`_
(
¡r
),-1,
NULL
,NULL,NULL);

1126 
	}
}

1128 
gboŞ—n
 
	$çùÜy_is_¥ecŸl_objeù
(cÚ¡ 
gch¬
 *
Çme
)

1130 
gboŞ—n
 
b
 = 
FALSE
;

1131 if(!
	`g_¡rÿ£cmp
(
Çme
,"IDLST") ||

1132 !
	`g_¡rÿ£cmp
(
Çme
,"FILELST"))

1133 
b
 = 
TRUE
;

1134  
b
;

1135 
	}
}

1140 
GtkWidg‘
* 
	$çùÜy_ü—‹_Ãw_dŸlog_w™h_bu‰Ús
(
gch¬
 *
t™Ë
,
GtkWidg‘
 *
·»Á
)

1143 
GtkWidg‘
* 
subdig
 = 
	`gtk_dŸlog_Ãw_w™h_bu‰Ús
(
	`_
(
t™Ë
),

1144 
	`GTK_WINDOW
(
·»Á
),

1145 
GTK_DIALOG_DESTROY_WITH_PARENT
,

1146 
GTK_STOCK_CLOSE
, 
GTK_RESPONSE_CLOSE
,

1147 
GTK_STOCK_OK
, 
GTK_RESPONSE_OK
,
NULL
);

1148 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
subdig
), 
GTK_RESPONSE_OK
);

1149 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
(
subdig
),
FALSE
);

1150 
	`gtk_wšdow_£t_pos™iÚ
 (
	`GTK_WINDOW
(
subdig
),
GTK_WIN_POS_CENTER_ALWAYS
);

1151 
	`gtk_wšdow_´e£Á
(
	`GTK_WINDOW
(
subdig
));

1152 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
subdig
), "delete_event",

1153 
	`G_CALLBACK
(
gtk_widg‘_hide
), 
NULL
);

1154 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
subdig
), "delete_event",

1155 
	`G_CALLBACK
(
gtk_Œue
), 
NULL
);

1156  
subdig
;

1157 
	}
}

	@O:\tool\dvs50\lib\object.h

22 #iâdeà
OBJECT_H


23 
	#OBJECT_H


	)

25 
	~"dŸty³s.h
"

26 
	~<gtk/gtk.h
>

28 
	~"geom‘ry.h
"

29 
	~"cÚÃùiÚpošt.h
"

30 
	~"hªdË.h
"

31 
	~"dŸm’u.h
"

32 
	~"objchªge.h
"

33 
	~"dŸ_xml.h
"

34 
	~"‹xt.h
"

38 
GHashTabË
 *
	gglob®_TabË
;

39 
	gG_BEGIN_DECLS


46 
	#DIA_OBJECT_CAN_PARENT
 1

	)

50 
	#DIA_OBJECT_GRABS_CHILD_INPUT
 2

	)

53 
	#DIA_OBJECT_EXPAND_WITH_CHILDREN
 4

	)

58 
	mMODIFIER_NONE
,

59 
	mMODIFIER_LEFT_SHIFT
,

60 
	mMODIFIER_RIGHT_SHIFT
,

61 
	mMODIFIER_SHIFT
,

62 
	mMODIFIER_LEFT_ALT
 = 4,

63 
	mMODIFIER_RIGHT_ALT
 = 8,

64 
	mMODIFIER_ALT
 = 12,

65 
	mMODIFIER_LEFT_CONTROL
 = 16,

66 
	mMODIFIER_RIGHT_CONTROL
 = 32,

67 
	mMODIFIER_CONTROL
 = 48

68 } 
	tModif›rKeys
;

94 
	gDŸObjeù
* (*
	tC»©eFunc
è(
	tPošt
 *
	t¡¬ošt
,

95 *
	tu£r_d©a
,

96 
	tHªdË
 **
	thªdË1
,

97 
	tHªdË
 **
	thªdË2
);

112 
	gDŸObjeù
* (*
	tLßdFunc
è(
	tObjeùNode
 
	tobj_node
, 
	tv”siÚ
,

113 cÚ¡ *
	tf’ame
);

123 (*
	tSaveFunc
è(
	tDŸObjeù
* 
	tobj
, 
	tObjeùNode
 
	tobj_node
,

124 cÚ¡ *
	tf’ame
);

134 
GtkWidg‘
 *(*
	tG‘DeçuÉsFunc
) ();

140 *(*
	tAµlyDeçuÉsFunc
) ();

152 (*
	tDe¡royFunc
è(
	tDŸObjeù
* 
	tobj
);

162 (*
	tD¿wFunc
è(
	tDŸObjeù
* 
	tobj
, 
	tDŸR’d””
* 
	tddi¥
);

173 
	$»®
 (*
	tDi¡ªûFunc
è(
	tDŸObjeù
* 
	tobj
, 
	tPošt
* 
	tpošt
);

188 (*
	tS–eùFunc
è(
	tDŸObjeù
* 
	tobj
,

189 
	tPošt
* 
	tşicked_pošt
,

190 
	tDŸR’d””
* 
	tš‹¿ùive_»nd””
);

200 
DŸObjeù
* (*
	tCİyFunc
è(
	tDŸObjeù
* 
	tobj
);

213 
ObjeùChªge
* (*
	tMoveFunc
è(
	tDŸObjeù
* 
	tobj
, 
	tPošt
 * 
	tpos
);

237 
ObjeùChªge
* (*
	tMoveHªdËFunc
è(
	tDŸObjeù
* 
	tobj
,

238 
	tHªdË
* 
	thªdË
,

239 
	tPošt
* 
	tpos
,

240 
	tCÚÃùiÚPošt
* 
	tı
,

241 
	tHªdËMoveR—sÚ
 
	t»asÚ
,

242 
	tModif›rKeys
 
	tmodif›rs
);

263 
GtkWidg‘
 *(*
	tG‘Prİ”t›sFunc
è(
	tDŸObjeù
* 
	tobj
, 
	tgboŞ—n
 
	tis_deçuÉ
);

274 
ObjeùChªge
 *(*
	tAµlyPrİ”t›sDŸlogFunc
è(
	tDŸObjeù
* 
	tobj
, 
	tGtkWidg‘
 *
	twidg‘
);

285 
ObjeùChªge
 *(*
	tAµlyPrİ”t›sLi¡Func
è(
	tDŸObjeù
* 
	tobj
, 
	tGPŒA¼ay
* 
	t´İs
);

295 cÚ¡ 
	tPrİDesütiÚ
 *(* 
	tDesüibePrİsFunc
è(
	tDŸObjeù
 *
	tobj
);

308 (* 
	tG‘PrİsFunc
è(
	tDŸObjeù
 *
	tobj
, 
	tGPŒA¼ay
 *
	t´İs
);

319 (* 
	tS‘PrİsFunc
è(
	tDŸObjeù
 *
	tobj
, 
	tGPŒA¼ay
 *
	t´İs
);

329 
DŸM’u
 *(*
	tObjeùM’uFunc
è(
	tDŸObjeù
* 
	tobj
, 
	tPošt
 *
	tpos™iÚ
);

345 
	$gboŞ—n
 (*
	tTextEd™Func
è(
	tDŸObjeù
 *
	tobj
, 
	tText
 *
	t‹xt
, 
	tTextEd™S‹
 
	t¡©e
, 
	tgch¬
 *
	t‹xtchªge
);

347 (*
	tUpd©eD©a
)(
	tDŸObjeù
 *
	tobj
);

348 (*
	tCÚÃùiÚTwoObjeù
)(
	tDŸObjeù
 *
	tobj
,
	tgpoš‹r
 
	td©a
,
	tnum
);

350 (*
	tUpd©eObjeùIndex
)(
	tDŸObjeù
 *
	tobj
);

357 
DIAVAR
 
	`objeù_š™
(
DŸObjeù
 *
obj
, 
num_hªdËs
, 
num_cÚÃùiÚs
);

358 
DIAVAR
 
	`objeù_de¡roy
(
DŸObjeù
 *
obj
);

360 
DIAVAR
 
	`objeù_cİy
(
DŸObjeù
 *
äom
, DŸObjeù *
to
);

362 
DIAVAR
 
	`objeù_§ve
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
);

363 
DIAVAR
 
	`objeù_lßd
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
);

365 
DIAVAR
 
GLi¡
 *
	`objeù_cİy_li¡
(GLi¡ *
li¡
);

366 
ObjeùChªge
* 
	`objeù_li¡_move_d–_r
(
GLi¡
 *
objeùs
, 
Pošt
 *
d–
, 
gboŞ—n
 
afãùed
);

367 
DIAVAR
 
ObjeùChªge
* 
	`objeù_li¡_move_d–
(
GLi¡
 *
objeùs
, 
Pošt
 *
d–
);

370 
DIAVAR
 
ObjeùChªge
* 
	`objeù_li¡_rÙ©e
(
GLi¡
 *
objeùs
, 
Pošt
 *
ûÁ”
, 
»®
 
ªgË
);

373 
ObjeùChªge
* 
	`objeù_li¡_sÿË
(
GLi¡
 *
objeùs
, 
Pošt
 *
ûÁ”
, 
»®
 
çùÜ
);

374 
DIAVAR
 
	`de¡roy_objeù_li¡
(
GLi¡
 *
li¡
);

375 
DIAVAR
 
	`objeù_add_hªdË
(
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
);

376 
	`objeù_add_hªdË_©
(
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
, 
pos
);

377 
DIAVAR
 
	`objeù_»move_hªdË
(
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
);

378 
DIAVAR
 
	`objeù_add_cÚÃùiÚpošt
(
DŸObjeù
 *
obj
, 
CÚÃùiÚPošt
 *
cÚpošt
);

379 
DIAVAR
 
	`objeù_»move_cÚÃùiÚpošt
(
DŸObjeù
 *
obj
,

380 
CÚÃùiÚPošt
 *
cÚpošt
);

381 
	`objeù_add_cÚÃùiÚpošt_©
(
DŸObjeù
 *
obj
,

382 
CÚÃùiÚPošt
 *
cÚpošt
,

383 
pos
);

384 
DIAVAR
 
	`objeù_cÚÃù
(
DŸObjeù
 *
obj
, 
HªdË
 *
hªdË
,

385 
CÚÃùiÚPošt
 *
cÚpošt
);

386 
DIAVAR
 
	`objeù_uncÚÃù
(
DŸObjeù
 *
cÚÃùed_obj
, 
HªdË
 *
hªdË
);

387 
DIAVAR
 
	`objeù_»move_cÚÃùiÚs_to
(
CÚÃùiÚPošt
 *
cÚpošt
);

388 
	`objeù_uncÚÃù_®l
(
DŸObjeù
 *
cÚÃùed_obj
);

389 
	`objeù_»gi¡ry_š™
();

390 
DIAVAR
 
	`objeù_»gi¡”_ty³
(
DŸObjeùTy³
 *
ty³
);

391 
DIAVAR
 
	`objeù_»gi¡ry_fÜ—ch
(
GHFunc
 
func
, 
gpoš‹r
 
u£r_d©a
);

392 
DŸObjeùTy³
 *
	`objeù_g‘_ty³
(*
Çme
);

393 
DIAVAR
 
gch¬
 *
	`objeù_g‘_di¥ÏyÇme
 (
DŸObjeù
* 
obj
);

394 
DIAVAR
 
gboŞ—n
 
	`objeù_æags_£t
(
DŸObjeù
* 
obj
, 
gšt
 
æags
);

396 
DIAVAR
 
GtkWidg‘
* 
	`çùÜy_ü—‹_Ãw_dŸlog_w™h_bu‰Ús
(
gch¬
 *
t™Ë
,GtkWidg‘ *
·»Á
);

401 
DIAVAR
 
DŸObjeù
 *
	`objeù_lßd_usšg_´İ”t›s
(cÚ¡ 
DŸObjeùTy³
 *
ty³
,

402 
ObjeùNode
 
obj_node
, 
v”siÚ
,

403 cÚ¡ *
f’ame
);

404 
DIAVAR
 
	`objeù_§ve_usšg_´İ”t›s
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
,

405 
v”siÚ
, cÚ¡ *
f’ame
);

406 
DIAVAR
 
DŸObjeù
 *
	`objeù_cİy_usšg_´İ”t›s
(DŸObjeù *
obj
);

419 
	s_Affše
 {

420 
»®
 
rÙ©iÚ
;

421 
»®
 
sÿË
;

422 
»®
 
Œª¦©iÚ
;

423 } 
	tAffše
;

432 
	s_ObjeùOps
 {

433 
De¡royFunc
 
de¡roy
;

434 
D¿wFunc
 
d¿w
;

435 
Di¡ªûFunc
 
di¡ªû_äom
;

436 
S–eùFunc
 
£Ëùf
;

437 
CİyFunc
 
cİy
;

438 
MoveFunc
 
move
;

439 
MoveHªdËFunc
 
move_hªdË
;

440 
G‘Prİ”t›sFunc
 
g‘_´İ”t›s
;

441 
AµlyPrİ”t›sDŸlogFunc
 
­¶y_´İ”t›s_äom_dŸlog
;

442 
ObjeùM’uFunc
 
g‘_objeù_m’u
;

444 
DesüibePrİsFunc
 
desüibe_´İs
;

445 
G‘PrİsFunc
 
g‘_´İs
;

446 
S‘PrİsFunc
 
£t_´İs
;

448 
TextEd™Func
 
ed™_‹xt
;

450 
AµlyPrİ”t›sLi¡Func
 
­¶y_´İ”t›s_li¡
;

458 
Upd©eD©a
 
upd©e_d©a
;

459 
CÚÃùiÚTwoObjeù
 
cÚÃùiÚ_two_obj
;

460 
Upd©eObjeùIndex
 
upd©e_šdex
;

461 (*(
unu£d
[4]))(
DŸObjeù
 *
obj
,...);

478 
	s_DŸObjeù
 {

479 
DŸObjeùTy³
 *
ty³
;

480 
Pošt
 
pos™iÚ
;

488 
ReùªgË
 
boundšg_box
;

489 
Affše
 
affše
;

491 
num_hªdËs
;

492 
HªdË
 **
hªdËs
;

494 
num_cÚÃùiÚs
;

495 
CÚÃùiÚPošt
 **
cÚÃùiÚs
;

497 
ObjeùOps
 *
İs
;

499 
Lay”
 *
·»Á_Ïy”
;

503 
DŸObjeù
 *
·»Á
;

504 
GLi¡
 *
chd»n
;

505 
gšt
 
æags
;

507 
CŞÜ
 *
highlight_cŞÜ
;

520 
ReùªgË
 
’şosšg_box
;

522 
GHashTabË
 *
m‘a
;

523 
gch¬
 *
Çme
;

524 
gušt32
 
ošdex
;

530 
	s_ObjeùTy³Ops
 {

531 
C»©eFunc
 
ü—‹
;

532 
LßdFunc
 
lßd
;

533 
SaveFunc
 
§ve
;

534 
G‘DeçuÉsFunc
 
g‘_deçuÉs
;

535 
AµlyDeçuÉsFunc
 
­¶y_deçuÉs
;

542 (*(
unu£d
[10]))(
DŸObjeù
 *
obj
,...);

551 
	s_DŸObjeùTy³
 {

553 *
Çme
;

555 
v”siÚ
;

558 **
pixm­
;

562 
ObjeùTy³Ops
 *
İs
;

564 *
pixm­_fe
;

565 *
deçuÉ_u£r_d©a
;

570 
	#OBJECT_COMMON_PROPERTIES
 \

571 { "obj_pos", 
PROP_TYPE_POINT
, 
PROP_FLAG_OPTIONAL
, \

572 "Objeù…os™iÚ", "Wh”thobjeù i loÿ‹d"
	}
}, \

573 { "obj_bb", 
PROP_TYPE_RECT
, 
PROP_FLAG_OPTIONAL
, \

575 { "m‘a", 
PROP_TYPE_DICT
, 
PROP_FLAG_OPTIONAL
, \

576 "Objeù m‘¨šfo", "Somkey/v®u·œs"}

	)

578 
	#OBJECT_COMMON_PROPERTIES_OFFSETS
 \

579 { "obj_pos", 
PROP_TYPE_POINT
, 
	`off£tof
(
DŸObjeù
, 
pos™iÚ
) }, \

580 { "obj_bb", 
PROP_TYPE_RECT
, 
	`off£tof
(
DŸObjeù
, 
boundšg_box
) }, \

581 { "m‘a", 
PROP_TYPE_DICT
, 
	`off£tof
(
DŸObjeù
, 
m‘a
è}

	)

584 
DIAVAR
 
gboŞ—n
 
dŸ_objeù_deçuÉs_lßd
 (cÚ¡ 
gch¬
 *
f’ame
,

585 
gboŞ—n
 
ü—‹_Ïzy
);

586 
DIAVAR
 
DŸObjeù
 *
dŸ_objeù_deçuÉ_g‘
 (cÚ¡ 
DŸObjeùTy³
 *
ty³
, 
gpoš‹r
 
u£r_d©a
);

587 
DIAVAR
 
DŸObjeù
 *
dŸ_objeù_deçuÉ_ü—‹
 (cÚ¡ 
DŸObjeùTy³
 *
ty³
,

588 
Pošt
 *
¡¬ošt
,

589 *
u£r_d©a
,

590 
HªdË
 **
hªdË1
,

591 
HªdË
 **
hªdË2
);

592 
DIAVAR
 
gboŞ—n
 
dŸ_objeù_deçuÉs_§ve
 (cÚ¡ 
gch¬
 *
f’ame
);

593 
DIAVAR
 
Lay”
 *
dŸ_objeù_g‘_·»Á_Ïy”
(
DŸObjeù
 *
obj
);

594 
DIAVAR
 
gboŞ—n
 
dŸ_objeù_is_£Ëùed
 (cÚ¡ 
DŸObjeù
 *
obj
);

595 
DIAVAR
 cÚ¡ 
ReùªgË
 *
dŸ_objeù_g‘_boundšg_box
(cÚ¡ 
DŸObjeù
 *
obj
);

596 
DIAVAR
 cÚ¡ 
ReùªgË
 *
dŸ_objeù_g‘_’şosšg_box
(cÚ¡ 
DŸObjeù
 *
obj
);

597 
DŸObjeù
 *
dŸ_objeù_g‘_·»Á_w™h_æags
(DŸObjeù *
obj
, 
gušt
 
æags
);

598 
DIAVAR
 
gboŞ—n
 
dŸ_objeù_is_£ËùabË
(
DŸObjeù
 *
obj
);

600 
DIAVAR
 
gboŞ—n
 
dŸ_objeù_§n™y_check
(cÚ¡ 
DŸObjeù
 *
obj
, cÚ¡ 
gch¬
 *
msg
);

603 (*
	tDŸObjeùFunc
è(cÚ¡ 
	tDŸObjeù
 *
	tobj
);

606 
DIAVAR
 
	`dŸ_objeù_£t_m‘a
 (
DŸObjeù
 *
obj
, cÚ¡ 
gch¬
 *
key
, cÚ¡ gch¬ *
v®ue
);

607 
DIAVAR
 
gch¬
 *
	`dŸ_objeù_g‘_m‘a
 (
DŸObjeù
 *
obj
, cÚ¡ gch¬ *
key
);

609 
DIAVAR
 
gch¬
 *
	`çùÜy_utf8
(gch¬ *
¡r
);

610 
DIAVAR
 
gch¬
 *
	`çùÜy_loÿË
(gch¬ *
¡r
);

611 
DIAVAR
 
gboŞ—n
 
	`çùÜy_is_¥ecŸl_objeù
(cÚ¡ 
gch¬
 *
Çme
);

612 
DIAVAR
 
GtkWidg‘
* 
	`çùÜy_ü—‹_Ãw_dŸlog_w™h_bu‰Ús
(
gch¬
 *
t™Ë
,GtkWidg‘ *
·»Á
);

619 
G_END_DECLS


	@O:\tool\dvs50\lib\object_defaults.c

24 
	~<cÚfig.h
>

26 
	~<¡dlib.h
>

27 
	~<¡ršg.h
>

29 
	~<glib.h
>

31 
	~"š.h
"

33 
	~<libxml/Œ“.h
>

34 
	~"dŸ_xml_libxml.h
"

35 
	~"dŸ_xml.h
"

36 
	~"objeù.h
"

37 
	~"mes§ge.h
"

38 
	~"dŸ_dœs.h
"

39 
	~"´İš‹º®s.h
"

41 
GHashTabË
 *
	gdeçuÉs_hash
 = 
NULL
;

42 
gboŞ—n
 
	gobjeù_deçuÉ_ü—‹_Ïzy
 = 
FALSE
;

45 
	$_obj_ü—‹
 (
gpoš‹r
 
key
,

46 
gpoš‹r
 
v®ue
,

47 
gpoš‹r
 
u£r_d©a
)

49 
gch¬
 *
Çme
 = (gch¬ *)
key
;

50 
DŸObjeùTy³
 *
ty³
 = (DŸObjeùTy³ *)
v®ue
;

51 
GHashTabË
 *
ht
 = (GHashTabË *è
u£r_d©a
;

52 
DŸObjeù
 *
obj
;

53 
Pošt
 
¡¬ošt
 = {0.0,0.0};

54 
HªdË
 *
hªdË1
,*
hªdË2
;

56 
	`g_as£¹
 (
	`g_hash_bË_lookup
 (
ht
, 
Çme
è=ğ
NULL
);

59 ià(!
ty³
->
İs
)

63 
obj
 = 
ty³
->
İs
->
	`ü—‹
(&
¡¬ošt
,y³->
deçuÉ_u£r_d©a
, &
hªdË1
,&
hªdË2
);

64 ià(!
obj
)

65 
	`g_w¬nšg
 ("FaedØü—‹ deçuÉ objeù fÜ '%s'", 
Çme
);

66 ià(0 !ğ
	`¡rcmp
 (
obj
->
ty³
->
Çme
,‚ame))

67 
	`objeù_de¡roy
 (
obj
);

69 
	`g_hash_bË_š£¹
(
ht
, 
obj
->
ty³
->
Çme
, obj);

70 
	}
}

73 
	$_obj_de¡roy
 (
gpoš‹r
 
v®
)

75 
DŸObjeù
 *
obj
 = (DŸObjeù *)
v®
;

77 
obj
->
İs
->
	`de¡roy
 (obj);

78 
	}
}

88 
gboŞ—n


89 
	$dŸ_objeù_deçuÉs_lßd
 (cÚ¡ 
gch¬
 *
f’ame
, 
gboŞ—n
 
ü—‹_Ïzy
)

91 
xmlDocPŒ
 
doc
;

92 
xmlNsPŒ
 
Çme_¥aû
;

93 
ObjeùNode
 
obj_node
, 
Ïy”_node
;

95 
objeù_deçuÉ_ü—‹_Ïzy
 = 
ü—‹_Ïzy
;

97 ià(!
deçuÉs_hash
)

99 
deçuÉs_hash
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
, 
g_¡r_equ®
,

100 
NULL
, 
_obj_de¡roy
);

102 ià(!
ü—‹_Ïzy
)

103 
	`objeù_»gi¡ry_fÜ—ch
 (
_obj_ü—‹
, 
deçuÉs_hash
);

108 ià(!
f’ame
)

110 
gch¬
 *
deçuÉ_f’ame
 = 
	`dŸ_cÚfig_f’ame
("defaults.dia");

112 ià(
	`g_fe_‹¡
(
deçuÉ_f’ame
, 
G_FILE_TEST_EXISTS
))

113 
doc
 = 
	`xmlDŸP¬£Fe
(
deçuÉ_f’ame
);

115 
doc
 = 
NULL
;

116 
	`g_ä“
 (
deçuÉ_f’ame
);

119 
doc
 = 
	`xmlDŸP¬£Fe
(
f’ame
);

121 ià(!
doc
)

122  
FALSE
;

124 
Çme_¥aû
 = 
	`xmlS—rchNs
(
doc
, doc->
xmlRoÙNode
, (cÚ¡ 
xmlCh¬
 *)"dia");

125 ià(
	`xmlSŒcmp
 (
doc
->
xmlRoÙNode
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"diagram")

126 || (
Çme_¥aû
 =ğ
NULL
))

128 
	`mes§ge_”rÜ
(
	`_
("Error†oading defaults '%s'.\n"

130 
	`dŸ_mes§ge_f’ame
(
f’ame
));

131 
	`xmlF»eDoc
 (
doc
);

132  
FALSE
;

135 
Ïy”_node
 = 
doc
->
xmlRoÙNode
->
xmlChd»nNode
;

136 
Ïy”_node
)

138 iàĞ!
	`xmlIsBÏnkNode
(
Ïy”_node
)

139 && 0 =ğ
	`xmlSŒcmp
(
Ïy”_node
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"layer"))

141 
obj_node
 = 
Ïy”_node
->
xmlChd»nNode
;

142 
obj_node
)

144 ià(!
	`xmlIsBÏnkNode
(
obj_node
)

145 && 0 =ğ
	`xmlSŒcmp
(
obj_node
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"object"))

147 *
ty³¡r
 = (*è
	`xmlG‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"type");

148 *
v”siÚ
 = (*è
	`xmlG‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"version");

149 ià(
ty³¡r
)

151 
DŸObjeù
 *
obj
 = 
	`g_hash_bË_lookup
 (
deçuÉs_hash
, 
ty³¡r
);

152 ià(!
obj
)

154 ià(!
ü—‹_Ïzy
)

155 
	`g_w¬nšg
 ("Unknown object '%s' while„eading '%s'",

156 
ty³¡r
, 
f’ame
);

159 
DŸObjeùTy³
 *
ty³
 = 
	`objeù_g‘_ty³
 (
ty³¡r
);

160 ià(
ty³
)

161 
obj
 = 
ty³
->
İs
->
	`lßd
 (

162 
obj_node
,

164 
f’ame
);

165 ià(
obj
)

166 
	`g_hash_bË_š£¹
 (
deçuÉs_hash
,

167 
obj
->
ty³
->
Çme
, obj);

173 
	`objeù_lßd_´İs
(
obj
, 
obj_node
);

175 
DŸObjeù
 *
def_obj
;

176 
def_obj
 = 
obj
->
ty³
->
İs
->
	`lßd
 (

177 
obj_node
,

179 
f’ame
);

180 ià(
def_obj
->
İs
->
£t_´İs
)

182 
	`objeù_cİy_´İs
 (
obj
, 
def_obj
, 
TRUE
);

183 
def_obj
->
İs
->
	`de¡roy
 (def_obj);

188 
	`g_hash_bË_»¶aû
 (
deçuÉs_hash
,

189 
def_obj
->
ty³
->
Çme
, def_obj);

193 ià(
v”siÚ
)

194 
	`xmlF»e
 (
v”siÚ
);

195 
	`xmlF»e
 (
ty³¡r
);

198 
obj_node
 = obj_node->
Ãxt
;

201 
Ïy”_node
 =†ay”_node->
Ãxt
;

204 
	`xmlF»eDoc
(
doc
);

205  
TRUE
;

206 
	}
}

214 
DŸObjeù
 *

215 
	$dŸ_objeù_deçuÉ_g‘
 (cÚ¡ 
DŸObjeùTy³
 *
ty³
, 
gpoš‹r
 
u£r_d©a
)

217 
DŸObjeù
 *
obj
;

219 
obj
 = 
	`g_hash_bË_lookup
 (
deçuÉs_hash
, 
ty³
->
Çme
);

220 ià(!
obj
 && 
objeù_deçuÉ_ü—‹_Ïzy
)

222 
Pošt
 
¡¬ošt
 = {0.0,0.0};

223 
HªdË
 *
hªdË1
,*
hªdË2
;

226 ià(!
ty³
->
İs
)

227  
NULL
;

230 
obj
 = 
ty³
->
İs
->
	`ü—‹
(&
¡¬ošt
,

231 
ty³
->
deçuÉ_u£r_d©a
,

232 &
hªdË1
,&
hªdË2
);

233 ià(
obj
)

234 
	`g_hash_bË_š£¹
 (
deçuÉs_hash
, 
obj
->
ty³
->
Çme
, obj);

237  
obj
;

238 
	}
}

243 
gboŞ—n


244 
	$pdp_¡ªd¬d_Ü_deçuÉs
 (cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

246  ( (
pdesc
->
æags
 & 
PROP_FLAG_NO_DEFAULTS
) == 0

247 && (
pdesc
->
æags
 & 
PROP_FLAG_STANDARD
) == 0);

248 
	}
}

262 
DŸObjeù
 *

263 
	$dŸ_objeù_deçuÉ_ü—‹
 (cÚ¡ 
DŸObjeùTy³
 *
ty³
,

264 
Pošt
 *
¡¬ošt
,

265 *
u£r_d©a
,

266 
HªdË
 **
hªdË1
,

267 
HªdË
 **
hªdË2
)

269 cÚ¡ 
DŸObjeù
 *
def_obj
;

270 
DŸObjeù
 *
obj
;

272 
	`g_»tuº_v®_if_ç
 (
ty³
 !ğ
NULL
, NULL);

275 
def_obj
 = 
	`g_hash_bË_lookup
 (
deçuÉs_hash
, 
ty³
->
Çme
);

276 ià(
def_obj
 && def_obj->
İs
->
desüibe_´İs
)

279 
obj
 = 
ty³
->
İs
->
	`ü—‹
 (
¡¬ošt
, 
u£r_d©a
, 
hªdË1
, 
hªdË2
);

280 ià(
obj
)

282 
GPŒA¼ay
 *
´İs
 = 
	`´İ_li¡_äom_descs
 (

283 
	`objeù_g‘_´İ_desütiÚs
(
def_obj
), 
pdp_¡ªd¬d_Ü_deçuÉs
);

284 
def_obj
->
İs
->
	`g‘_´İs
(def_obj, 
´İs
);

285 
obj
->
İs
->
	`£t_´İs
(obj, 
´İs
);

286 
obj
->
İs
->
	`move
 (obj, 
¡¬ošt
);

287 
	`´İ_li¡_ä“
(
´İs
);

292 
obj
 = 
ty³
->
İs
->
	`ü—‹
 (
¡¬ošt
, 
u£r_d©a
, 
hªdË1
, 
hªdË2
);

295  
obj
;

296 
	}
}

298 
_MyLay”Info
 
	tMyLay”Info
;

299 
	s_MyLay”Info


301 
Pošt
 
	mpos
;

302 
xmlNodePŒ
 
	mnode
;

305 
_MyRoÙInfo
 
	tMyRoÙInfo
;

306 
	s_MyRoÙInfo


308 
xmlNodePŒ
 
	mnode
;

309 
gch¬
 *
	mf’ame
;

310 
GHashTabË
 *
	mÏy”_hash
;

311 
xmlNs
 *
	mÇme_¥aû
;

312 
gšt
 
	mobj_Ä
;

316 
	$_obj_¡Üe
 (
gpoš‹r
 
key
,

317 
gpoš‹r
 
v®ue
,

318 
gpoš‹r
 
u£r_d©a
)

320 
gch¬
 *
Çme
 = (gch¬ *)
key
;

321 
DŸObjeù
 *
obj
 = (DŸObjeù *)
v®ue
;

322 
MyRoÙInfo
 *
ri
 = (MyRoÙInfØ*)
u£r_d©a
;

323 
ObjeùNode
 
obj_node
;

324 
gch¬
 *
Ïy”_Çme
;

325 
gch¬
 
bufãr
[31];

326 
gch¬
 *
p
;

327 
MyLay”Info
 *
li
;

331 
	`g_as£¹
 (0 =ğ
	`¡rcmp
 (
obj
->
ty³
->
Çme
,‚ame));

333 
p
 = 
	`¡r¡r
 (
Çme
, " - ");

334 ià(
p
)

336 ià(
p
 > 
Çme
)

337 
Ïy”_Çme
 = 
	`g_¡ºdup
 (
Çme
, 
p
 -‚ame);

339 
Ïy”_Çme
 = 
	`g_¡rdup
("NULL");

342 
Ïy”_Çme
 = 
	`g_¡rdup
 ("default");

344 
li
 = 
	`g_hash_bË_lookup
 (
ri
->
Ïy”_hash
, 
Ïy”_Çme
);

345 ià(!
li
)

347 
li
 = 
	`g_Ãw
 (
MyLay”Info
, 1);

348 
li
->
node
 = 
	`xmlNewChd
(
ri
->node,„i->
Çme_¥aû
, (cÚ¡ 
xmlCh¬
 *)"Ïy”", 
NULL
);

349 
	`xmlS‘Prİ
(
li
->
node
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
Ïy”_Çme
);

350 
	`xmlS‘Prİ
(
li
->
node
, (cÚ¡ 
xmlCh¬
 *)"visible", (const xmlChar *)"false");

351 
li
->
pos
.
x
 =†i->pos.
y
 = 0.0;

352 
	`g_hash_bË_š£¹
 (
ri
->
Ïy”_hash
, 
Ïy”_Çme
, 
li
);

355 
	`g_ä“
 (
Ïy”_Çme
);

357 
obj_node
 = 
	`xmlNewChd
(
li
->
node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"object", NULL);

358 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"ty³", (xmlCh¬ *è
obj
->
ty³
->
Çme
);

361 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"v”siÚ", (xmlCh¬ *)
	`g_¡rdup
(
obj
->
ty³
->
v”siÚ
));

363 
	`g_¢´štf
(
bufãr
, 30, "O%d", 
ri
->
obj_Ä
++);

364 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"id", (xmlCh¬ *)
bufãr
);

367 iàĞ
	`GPOINTER_TO_INT
(
obj
->
ty³
->
deçuÉ_u£r_d©a
) > 0

368 && 
	`GPOINTER_TO_INT
(
obj
->
ty³
->
deçuÉ_u£r_d©a
) < 0xFF)

370 
	`g_¢´štf
(
bufãr
, 30, "%d", 
	`GPOINTER_TO_INT
(
obj
->
ty³
->
deçuÉ_u£r_d©a
));

371 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"štd©a", (xmlCh¬ *)
bufãr
);

374 
obj
->
İs
->
	`move
 (obj,&(
li
->
pos
));

376 
obj
->
ty³
->
İs
->
	`§ve
 (obj, 
obj_node
, 
ri
->
f’ame
);

379 
li
->
pos
.
y
 +ğ(
obj
->
boundšg_box
.
bÙtom
 - obj->boundšg_box.
tİ
 + 1.0);

380 
	}
}

389 
gboŞ—n


390 
	$dŸ_objeù_deçuÉs_§ve
 (cÚ¡ 
gch¬
 *
f’ame
)

392 
MyRoÙInfo
 
ni
;

393 
xmlDocPŒ
 
doc
;

394 
gboŞ—n
 
»t
;

395 
gch¬
 *
»®_f’ame
;

396 
Şd_bÏnks_deçuÉ
 = 
´‘ty_fÜm©ed_xml
;

401 
´‘ty_fÜm©ed_xml
 = 
TRUE
;

403 ià(!
f’ame
)

404 
»®_f’ame
 = 
	`dŸ_cÚfig_f’ame
("defaults.dia");

406 
»®_f’ame
 = 
	`g_¡rdup
 (
f’ame
);

408 
doc
 = 
	`xmlNewDoc
((cÚ¡ 
xmlCh¬
 *)"1.0");

409 
doc
->
’codšg
 = 
	`xmlSŒdup
((cÚ¡ 
xmlCh¬
 *)"UTF-8");

411 
doc
->
xmlRoÙNode
 = 
	`xmlNewDocNode
(doc, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"diagram", NULL);

413 
ni
.
Çme_¥aû
 = 
	`xmlNewNs
(
doc
->
xmlRoÙNode
,

414 (cÚ¡ 
xmlCh¬
 *)
DIA_XML_NAME_SPACE_BASE
,

415 (cÚ¡ 
xmlCh¬
 *)"dia");

416 
	`xmlS‘Ns
(
doc
->
xmlRoÙNode
, 
ni
.
Çme_¥aû
);

418 
ni
.
obj_Ä
 = 0;

419 
ni
.
node
 = 
doc
->
xmlRoÙNode
;

420 
ni
.
f’ame
 = 
»®_f’ame
;

421 
ni
.
Ïy”_hash
 = 
	`g_hash_bË_Ãw_fuÎ
 (
g_¡r_hash
, 
g_¡r_equ®
,

422 
g_ä“
, g_free);

424 
	`g_hash_bË_fÜ—ch
 (
deçuÉs_hash
, 
_obj_¡Üe
, &
ni
);

426 
»t
 = 
	`xmlDŸSaveFe
 (
»®_f’ame
, 
doc
);

427 
	`g_ä“
 (
»®_f’ame
);

428 
	`xmlF»eDoc
(
doc
);

429 
´‘ty_fÜm©ed_xml
 = 
Şd_bÏnks_deçuÉ
;

431 
	`g_hash_bË_de¡roy
 (
ni
.
Ïy”_hash
);

433  
»t
;

434 
	}
}

	@O:\tool\dvs50\lib\orth_conn.c

18 
	~<cÚfig.h
>

20 
	~<¡dio.h
>

21 
	~<¡dlib.h
>

22 
	~<as£¹.h
>

23 
	~<m©h.h
>

24 
	~<¡ršg.h
>

25 
	~<glib.h
>

27 
	~"Üth_cÚn.h
"

28 
	~"mes§ge.h
"

29 
	~"dŸm’u.h
"

30 
	~"hªdË.h
"

31 
	~"dŸ»nd””.h
"

32 
	~"autÜou‹.h
"

34 
¶aû_hªdË_by_sw­pšg
(
O¹hCÚn
 *
Üth
,

35 
šdex
, 
HªdË
 *
hªdË
);

36 
ObjeùChªge
 *
ÜthcÚn_£t_autÜoutšg
(
O¹hCÚn
 *
Üth
, 
gboŞ—n
 
Ú
);

38 
	echªge_ty³
 {

39 
	mTYPE_ADD_SEGMENT
,

40 
	mTYPE_REMOVE_SEGMENT


43 
ObjeùChªge
 *

44 
mid£gm’t_ü—‹_chªge
(
O¹hCÚn
 *
Üth
, 
chªge_ty³
 
ty³
,

45 
£gm’t
,

46 
Pošt
 *
pošt1
, Pošˆ*
pošt2
,

47 
HªdË
 *
hªdË1
, HªdË *
hªdË2
);

49 
	sMidSegm’tChªge
 {

50 
ObjeùChªge
 
	mobj_chªge
;

59 
chªge_ty³
 
	mty³
;

60 
	m­¶›d
;

62 
	m£gm’t
;

63 
Pošt
 
	mpošts
[2];

64 
HªdË
 *
	mhªdËs
[2];

67 
ObjeùChªge
 *

68 
’d£gm’t_ü—‹_chªge
(
O¹hCÚn
 *
Üth
, 
chªge_ty³
 
ty³
,

69 
£gm’t
, 
Pošt
 *
pošt
,

70 
HªdË
 *
hªdË
);

72 
¶aû_hªdË_by_sw­pšg
(
O¹hCÚn
 *
Üth
, 
šdex
, 
HªdË
 *
hªdË
);

74 
	sEndSegm’tChªge
 {

75 
ObjeùChªge
 
	mobj_chªge
;

87 
chªge_ty³
 
	mty³
;

88 
	m­¶›d
;

90 
	m£gm’t
;

91 
Pošt
 
	mpošt
;

92 
HªdË
 *
	mhªdË
;

93 
HªdË
 *
	mŞd_’d_hªdË
;

94 
CÚÃùiÚPošt
 *
	mı
;

98 
ObjeùChªge
*

99 
autÜou‹_ü—‹_chªge
(
O¹hCÚn
 *
Üth
, 
gboŞ—n
 
Ú
);

101 
	sAutÜou‹Chªge
 {

102 
ObjeùChªge
 
	mobj_chªge
;

103 
gboŞ—n
 
	mÚ
;

104 
Pošt
 *
	mpošts
;

107 
	$£t_midpošt
(
Pošt
 *
pošt
, 
O¹hCÚn
 *
Üth
, 
£gm’t
)

109 
i
 = 
£gm’t
;

110 
pošt
->
x
 = 0.5*(
Üth
->
pošts
[
i
].x + orth->points[i+1].x);

111 
pošt
->
y
 = 0.5*(
Üth
->
pošts
[
i
].y + orth->points[i+1].y);

112 
	}
}

114 
	$£tup_midpošt_hªdË
(
HªdË
 *
hªdË
)

116 
hªdË
->
id
 = 
HANDLE_MIDPOINT
;

117 
hªdË
->
ty³
 = 
HANDLE_MINOR_CONTROL
;

118 
hªdË
->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

119 
hªdË
->
cÚÃùed_to
 = 
NULL
;

120 
	}
}

122 
	$£tup_’dpošt_hªdË
(
HªdË
 *
hªdË
, 
HªdËId
 
id
 )

124 
hªdË
->
id
 = id;

125 
hªdË
->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

126 
hªdË
->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

127 
hªdË
->
cÚÃùed_to
 = 
NULL
;

128 
	}
}

130 
	$g‘_hªdË_Ä
(
O¹hCÚn
 *
Üth
, 
HªdË
 *
hªdË
)

132 
i
 = 0;

133 
i
=0;i<
Üth
->
numpošts
-1;i++) {

134 ià(
Üth
->
hªdËs
[
i
] =ğ
hªdË
)

135  
i
;

138 
	}
}

140 
	$g‘_£gm’t_Ä
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
pošt
, 
»®
 
max_di¡
)

142 
i
;

143 
£gm’t
;

144 
»®
 
di¡ªû
, 
tmp_di¡
;

146 
£gm’t
 = 0;

147 
di¡ªû
 = 
	`di¡ªû_lše_pošt
(&
Üth
->
pošts
[0], &Üth->pošts[1], 0, 
pošt
);

149 
i
=1;i<
Üth
->
numpošts
-1;i++) {

150 
tmp_di¡
 = 
	`di¡ªû_lše_pošt
(&
Üth
->
pošts
[
i
], &Üth->pošts[i+1], 0, 
pošt
);

151 ià(
tmp_di¡
 < 
di¡ªû
) {

152 
£gm’t
 = 
i
;

153 
di¡ªû
 = 
tmp_di¡
;

157 ià(
di¡ªû
 < 
max_di¡
)

158  
£gm’t
;

161 
	}
}

164 
ObjeùChªge
 *

165 
	$ÜthcÚn_move_hªdË
(
O¹hCÚn
 *
Üth
, 
HªdË
 *
hªdË
,

166 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

167 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

169 
n
;

170 
hªdË_Ä
;

171 
DŸObjeù
 *
obj
 = (DŸObjeù *)
Üth
;

172 
ObjeùChªge
 *
chªge
 = 
NULL
;

174 
hªdË
->
id
) {

175 
HANDLE_MOVE_STARTPOINT
:

176 
Üth
->
pošts
[0] = *
to
;

177 ià(
Üth
->
autÜoutšg
 &&

178 
	`autÜou‹_Ïyout_ÜthcÚn
(
Üth
, 
ı
,

179 
obj
->
hªdËs
[1]->
cÚÃùed_to
))

181 
Üth
->
Ü›Á©iÚ
[0]) {

182 
HORIZONTAL
:

183 
Üth
->
pošts
[1].
y
 = 
to
->y;

185 
VERTICAL
:

186 
Üth
->
pošts
[1].
x
 = 
to
->x;

190 
HANDLE_MOVE_ENDPOINT
:

191 
n
 = 
Üth
->
numpošts
 - 1;

192 
Üth
->
pošts
[
n
] = *
to
;

193 ià(
Üth
->
autÜoutšg
 &&

194 
	`autÜou‹_Ïyout_ÜthcÚn
(
Üth
, 
obj
->
hªdËs
[0]->
cÚÃùed_to
,

195 
ı
))

197 
Üth
->
Ü›Á©iÚ
[
n
-1]) {

198 
HORIZONTAL
:

199 
Üth
->
pošts
[
n
-1].
y
 = 
to
->y;

201 
VERTICAL
:

202 
Üth
->
pošts
[
n
-1].
x
 = 
to
->x;

206 
HANDLE_MIDPOINT
:

207 
n
 = 
Üth
->
numpošts
 - 1;

208 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
Üth
, 
hªdË
);

209 ià(
Üth
->
autÜoutšg
)

210 
chªge
 = 
	`ÜthcÚn_£t_autÜoutšg
(
Üth
, 
FALSE
);

211 
Üth
->
Ü›Á©iÚ
[
hªdË_Ä
]) {

212 
HORIZONTAL
:

213 
Üth
->
pošts
[
hªdË_Ä
].
y
 = 
to
->y;

214 
Üth
->
pošts
[
hªdË_Ä
+1].
y
 = 
to
->y;

216 
VERTICAL
:

217 
Üth
->
pošts
[
hªdË_Ä
].
x
 = 
to
->x;

218 
Üth
->
pošts
[
hªdË_Ä
+1].
x
 = 
to
->x;

223 
	`mes§ge_”rÜ
("Internalƒrror in orthconn_move_handle.\n");

227  
chªge
;

228 
	}
}

230 
ObjeùChªge
 *

231 
	$ÜthcÚn_move
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
to
)

233 
Pošt
 
p
;

234 
i
;

236 
p
 = *
to
;

237 
	`pošt_sub
(&
p
, &
Üth
->
pošts
[0]);

239 
Üth
->
pošts
[0] = *
to
;

240 
i
=1;i<
Üth
->
numpošts
;i++) {

241 
	`pošt_add
(&
Üth
->
pošts
[
i
], &
p
);

243  
NULL
;

244 
	}
}

246 
»®


247 
	$ÜthcÚn_di¡ªû_äom
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

249 
i
;

250 
»®
 
di¡
;

252 
di¡
 = 
	`di¡ªû_lše_pošt
Ğ&
Üth
->
pošts
[0], &orth->points[1],

253 
lše_width
, 
pošt
);

254 
i
=1;i<
Üth
->
numpošts
-1;i++) {

255 
di¡
 = 
	`MIN
(dist,

256 
	`di¡ªû_lše_pošt
Ğ&
Üth
->
pošts
[
i
], &orth->points[i+1],

257 
lše_width
, 
pošt
));

259  
di¡
;

260 
	}
}

264 
	$adju¡_hªdË_couÁ_to
(
O¹hCÚn
 *
Üth
, 
gušt
 
couÁ
) {

270 ià(
Üth
->
numhªdËs
 =ğ
couÁ
) ;

271 ià(
Üth
->
numhªdËs
 < 
couÁ
) {

272 
i
;

273 
Üth
->
hªdËs
 = 
	`g_»®loc
(orth->handles,

274 (
couÁ
)*(
HªdË
 *));

275 
Üth
->
hªdËs
[
couÁ
-1] = o¹h->hªdËs[Üth->
numhªdËs
-1];

276 
Üth
->
hªdËs
[Üth->
numhªdËs
-1] = 
NULL
;

277 
i
=
Üth
->
numhªdËs
-1; i<
couÁ
-1; i++) {

278 
HªdË
 *
hªdË
 = 
	`g_Ãw0
(Handle,1);

279 
	`£tup_midpošt_hªdË
(
hªdË
);

280 
	`objeù_add_hªdË
(&
Üth
->
objeù
,
hªdË
);

281 
Üth
->
hªdËs
[
i
] = 
hªdË
;

284 
i
;

285 
i
=
couÁ
-1; i<
Üth
->
numhªdËs
-1; i++) {

286 
HªdË
 *
hªdË
 = 
Üth
->
hªdËs
[
i
];

287 
	`objeù_»move_hªdË
(&
Üth
->
objeù
,
hªdË
);

288 
	`g_ä“
(
hªdË
);

289 
Üth
->
hªdËs
[
i
] = 
NULL
;

291 
Üth
->
hªdËs
[
couÁ
-1] = o¹h->hªdËs[Üth->
numhªdËs
-1];

292 
Üth
->
hªdËs
[Üth->
numhªdËs
-1] = 
NULL
;

293 
Üth
->
hªdËs
 = 
	`g_»®loc
(orth->handles,

294 (
couÁ
)*(
HªdË
 *));

296 
Üth
->
numhªdËs
 = 
couÁ
;

298 
	}
}

301 
	$ÜthcÚn_upd©e_d©a
(
O¹hCÚn
 *
Üth
)

303 
i
;

304 
DŸObjeù
 *
obj
 = (DŸObjeù *)
Üth
;

305 
Pošt
 *
pošts
;

306 
CÚÃùiÚPošt
 *
¡¬t_ı
;

307 
CÚÃùiÚPošt
 *
’d_ı
;

309 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

314 
	`adju¡_hªdË_couÁ_to
(
Üth
, o¹h->
numpošts
-1);

316 
¡¬t_ı
 = 
Üth
->
hªdËs
[0]->
cÚÃùed_to
;

317 
’d_ı
 = 
Üth
->
hªdËs
[Üth->
numpošts
-2]->
cÚÃùed_to
;

319 ià(!
Üth
->
pošts
) {

320 
	`g_w¬nšg
("very sick OrthConn object...");

324 
pošts
 = 
Üth
->points;

325 ià(!
Üth
->
autÜoutšg
 &&

326 (
	`cÚÅošt_is_autog­
(
¡¬t_ı
) ||

327 
	`cÚÅošt_is_autog­
(
’d_ı
))) {

328 
Pošt
* 
Ãw_pošts
 = 
	`g_Ãw
(Pošt, 
Üth
->
numpošts
);

329 
i
 = 0; i < 
Üth
->
numpošts
; i++) {

330 
Ãw_pošts
[
i
] = 
pošts
[i];

333 ià(
	`cÚÅošt_is_autog­
(
¡¬t_ı
)) {

334 
Ãw_pošts
[0] = 
	`ÿlcuÏ‹_objeù_edge
(&
¡¬t_ı
->
pos
, &new_points[1],

335 
¡¬t_ı
->
objeù
);

341 ià(
	`cÚÅošt_is_autog­
(
’d_ı
)) {

342 
Ãw_pošts
[
Üth
->
numpošts
-1] =

343 
	`ÿlcuÏ‹_objeù_edge
(&
’d_ı
->
pos
, &
Ãw_pošts
[
Üth
->
numpošts
-2],

344 
’d_ı
->
objeù
);

350 
	`g_ä“
(
pošts
);

351 
Üth
->
pošts
 = 
Ãw_pošts
;

354 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

356 
	`adju¡_hªdË_couÁ_to
(
Üth
, o¹h->
numpošts
-1);

359 
	`¶aû_hªdË_by_sw­pšg
(
Üth
, 0, o¹h->
hªdËs
[0]);

360 
	`¶aû_hªdË_by_sw­pšg
(
Üth
, 1, o¹h->
hªdËs
[Üth->
numpošts
-2]);

363 
Üth
->
hªdËs
[0]->
pos
 = o¹h->
pošts
[0];

364 
Üth
->
hªdËs
[Üth->
numpošts
-2]->
pos
 = o¹h->
pošts
[orth->numpoints-1];

366 
i
=1;i<
Üth
->
numpošts
-2;i++) {

367 
	`£t_midpošt
(&
Üth
->
hªdËs
[
i
]->
pos
, orth, i);

369 
	}
}

372 
	$ÜthcÚn_upd©e_boundšgbox
(
O¹hCÚn
 *
Üth
)

374 
	`as£¹
(
Üth
 !ğ
NULL
);

375 
	`pŞylše_bbox
(&
Üth
->
pošts
[0],

376 
Üth
->
numpošts
,

377 &
Üth
->
exŒa_¥acšg
, 
FALSE
,

378 &
Üth
->
objeù
.
boundšg_box
);

379 
	}
}

382 
	$ÜthcÚn_sim¶e_d¿w
(
O¹hCÚn
 *
Üth
, 
DŸR’d””
 *
»nd””
, 
»®
 
width
)

384 
Pošt
 *
pošts
;

386 
	`as£¹
(
Üth
 !ğ
NULL
);

387 
	`as£¹
(
»nd””
 !ğ
NULL
);

389 ià(!
Üth
->
pošts
) {

390 
	`g_w¬nšg
("very sick OrthConn object...");

395 
pošts
 = &
Üth
->points[0];

397 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
width
);

398 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

399 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

400 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

402 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞylše
Ô’d””, 
pošts
,

403 
Üth
->
numpošts
,

404 &
cŞÜ_bÏck
);

405 
	}
}

409 
	$ÜthcÚn_ÿn_d–‘e_£gm’t
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
)

411 
£gm’t
;

417 ià(
Üth
->
numpošts
==3)

420 
£gm’t
 = 
	`g‘_£gm’t_Ä
(
Üth
, 
şickedpošt
, 1.0);

422 ià(
£gm’t
<0)

425 iàĞ(
£gm’t
 !ğ0è&& (£gm’ˆ!ğ
Üth
->
numpošts
-2)) {

427 ià(
Üth
->
numpošts
==4)

432 
	}
}

435 
	$ÜthcÚn_ÿn_add_£gm’t
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
)

437 
£gm’t
 = 
	`g‘_£gm’t_Ä
(
Üth
, 
şickedpošt
, 1000000.0);

439 ià(
£gm’t
<0)

443 
	}
}

453 
	$ÜthcÚn_š™
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
¡¬ošt
)

455 
DŸObjeù
 *
obj
;

457 
obj
 = &
Üth
->
objeù
;

459 
	`objeù_š™
(
obj
, 3, 0);

461 
Üth
->
numpošts
 = 4;

462 
Üth
->
numÜ›Á
 = o¹h->
numpošts
 - 1;

464 
Üth
->
pošts
 = 
	`g_m®loc0
(4*(
Pošt
));

466 
Üth
->
Ü›Á©iÚ
 = 
	`g_m®loc0
(3*(
Or›Á©iÚ
));

468 
Üth
->
numhªdËs
 = 3;

469 
Üth
->
hªdËs
 = 
	`g_m®loc0
(3*(
HªdË
 *));

471 
Üth
->
hªdËs
[0] = 
	`g_Ãw
(
HªdË
, 1);

472 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[0], 
HANDLE_MOVE_STARTPOINT
);

473 
obj
->
hªdËs
[0] = 
Üth
->handles[0];

475 
Üth
->
hªdËs
[1] = 
	`g_Ãw
(
HªdË
, 1);

476 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[1]);

477 
obj
->
hªdËs
[1] = 
Üth
->handles[1];

479 
Üth
->
hªdËs
[2] = 
	`g_Ãw
(
HªdË
, 1);

480 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[2], 
HANDLE_MOVE_ENDPOINT
);

481 
obj
->
hªdËs
[2] = 
Üth
->handles[2];

483 
Üth
->
autÜoutšg
 = 
TRUE
;

486 
Üth
->
pošts
[0] = *
¡¬ošt
;

487 
Üth
->
pošts
[1].
x
 = 
¡¬ošt
->x;

488 
Üth
->
pošts
[1].
y
 = 
¡¬ošt
->y + 1.0;

489 
Üth
->
pošts
[2].
x
 = 
¡¬ošt
->x + 1.0;

490 
Üth
->
pošts
[2].
y
 = 
¡¬ošt
->y + 1.0;

491 
Üth
->
pošts
[3].
x
 = 
¡¬ošt
->x + 2.0;

492 
Üth
->
pošts
[3].
y
 = 
¡¬ošt
->y + 1.0;

494 
Üth
->
Ü›Á©iÚ
[0] = 
VERTICAL
;

495 
Üth
->
Ü›Á©iÚ
[1] = 
HORIZONTAL
;

496 
Üth
->
Ü›Á©iÚ
[2] = 
VERTICAL
;

498 
	`ÜthcÚn_upd©e_d©a
(
Üth
);

499 
	}
}

503 
	$ÜthcÚn_£t_pošts
(
O¹hCÚn
 *
Üth
, 
num_pošts
, 
Pošt
 *
pošts
)

505 
i
;

506 
gboŞ—n
 
hÜiz
;

508 
Üth
->
numpošts
 = 
num_pošts
;

510 ià(
Üth
->
pošts
)

511 
	`g_ä“
(
Üth
->
pošts
);

513 
Üth
->
pošts
 = 
	`g_m®loc
((Üth->
numpošts
)*(
Pošt
));

515 
i
=0;i<
Üth
->
numpošts
;i++) {

516 
Üth
->
pošts
[
i
] =…oints[i];

521 
Üth
->
numÜ›Á
 = o¹h->
numpošts
-1;

522 ià(
Üth
->
Ü›Á©iÚ
è
	`g_ä“
(orth->orientation);

523 
Üth
->
Ü›Á©iÚ
 = 
	`g_Ãw
(
Or›Á©iÚ
, o¹h->
numÜ›Á
);

524 
hÜiz
 = (
	`çbs
(
Üth
->
pošts
[0].
y
-orth->points[1].y) < 0.00001);

525 
i
 = 0; i < 
Üth
->
numÜ›Á
; i++) {

526 ià(
hÜiz
è
Üth
->
Ü›Á©iÚ
[
i
] = 
HORIZONTAL
;

527 
Üth
->
Ü›Á©iÚ
[
i
] = 
VERTICAL
;

528 
hÜiz
 = !horiz;

530 
	}
}

533 
	$ÜthcÚn_cİy
(
O¹hCÚn
 *
äom
, O¹hCÚÀ*
to
)

535 
i
;

536 
DŸObjeù
 *
toobj
, *
äomobj
;

538 
toobj
 = &
to
->
objeù
;

539 
äomobj
 = &
äom
->
objeù
;

541 
	`objeù_cİy
(
äomobj
, 
toobj
);

543 
to
->
numpošts
 = 
äom
->numpoints;

544 
to
->
numÜ›Á
 = 
äom
->numorient;

546 
to
->
pošts
 = 
	`g_m®loc0
(Ño->
numpošts
)*(
Pošt
));

548 
i
=0;i<
to
->
numpošts
;i++) {

549 
to
->
pošts
[
i
] = 
äom
->points[i];

552 
to
->
autÜoutšg
 = 
äom
->autorouting;

553 
to
->
Ü›Á©iÚ
 = 
	`g_m®loc0
(Ño->
numpošts
-1)*(
Or›Á©iÚ
));

554 
to
->
numhªdËs
 = 
äom
->numhandles;

555 
to
->
hªdËs
 = 
	`g_m®loc0
(Ño->
numpošts
-1)*(
HªdË
 *));

557 
i
=0;i<
to
->
numpošts
-1;i++) {

558 
to
->
Ü›Á©iÚ
[
i
] = 
äom
->orientation[i];

559 
to
->
hªdËs
[
i
] = 
	`g_Ãw
(
HªdË
,1);

560 *
to
->
hªdËs
[
i
] = *
äom
->handles[i];

561 
to
->
hªdËs
[
i
]->
cÚÃùed_to
 = 
NULL
;

562 
toobj
->
hªdËs
[
i
] = 
to
->handles[i];

564 
	`memıy
(&
to
->
exŒa_¥acšg
,&
äom
->extra_spacing,(to->extra_spacing));

565 
	}
}

568 
	$ÜthcÚn_de¡roy
(
O¹hCÚn
 *
Üth
)

570 
i
;

572 
	`objeù_de¡roy
(&
Üth
->
objeù
);

574 
	`g_ä“
(
Üth
->
pošts
);

575 
	`g_ä“
(
Üth
->
Ü›Á©iÚ
);

577 
i
=0;i<
Üth
->
numpošts
-1;i++)

578 
	`g_ä“
(
Üth
->
hªdËs
[
i
]);

580 
	`g_ä“
(
Üth
->
hªdËs
);

581 
	}
}

584 
	$¶aû_hªdË_by_sw­pšg
(
O¹hCÚn
 *
Üth
, 
šdex
, 
HªdË
 *
hªdË
)

586 
DŸObjeù
 *
obj
;

587 
HªdË
 *
tmp
;

588 
j
;

590 
obj
 = (
DŸObjeù
 *)
Üth
;

591 ià(
obj
->
hªdËs
[
šdex
] =ğ
hªdË
)

594 
j
=0;j<
obj
->
num_hªdËs
;j++) {

595 ià(
obj
->
hªdËs
[
j
] =ğ
hªdË
) {

597 
tmp
 = 
obj
->
hªdËs
[
j
];

598 
obj
->
hªdËs
[
j
] = obj->hªdËs[
šdex
];

599 
obj
->
hªdËs
[
šdex
] = 
tmp
;

604 
	}
}

607 
	$ÜthcÚn_§ve
(
O¹hCÚn
 *
Üth
, 
ObjeùNode
 
obj_node
)

609 
i
;

610 
A‰ribu‹Node
 
©Œ
;

613 
	`¶aû_hªdË_by_sw­pšg
(
Üth
, 0, o¹h->
hªdËs
[0]);

614 
	`¶aû_hªdË_by_sw­pšg
(
Üth
, 1, o¹h->
hªdËs
[Üth->
numpošts
-2]);

616 
	`objeù_§ve
(&
Üth
->
objeù
, 
obj_node
);

618 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "orth_points");

620 
i
=0;i<
Üth
->
numpošts
;i++) {

621 
	`d©a_add_pošt
(
©Œ
, &
Üth
->
pošts
[
i
]);

624 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "orth_orient");

625 
i
=0;i<
Üth
->
numpošts
-1;i++) {

626 
	`d©a_add_’um
(
©Œ
, 
Üth
->
Ü›Á©iÚ
[
i
]);

629 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
obj_node
, "autÜoutšg"), 
Üth
->
autÜoutšg
);

630 
	}
}

633 
	$ÜthcÚn_lßd
(
O¹hCÚn
 *
Üth
, 
ObjeùNode
 
obj_node
)

635 
i
;

636 
A‰ribu‹Node
 
©Œ
;

637 
D©aNode
 
d©a
;

638 
n
;

639 
v”siÚ
 = 0;

641 
DŸObjeù
 *
obj
 = &
Üth
->
objeù
;

643 
	`objeù_lßd
(
obj
, 
obj_node
);

649 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "orth_points");

651 ià(
©Œ
 !ğ
NULL
)

652 
Üth
->
numpošts
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

654 
Üth
->
numpošts
 = 0;

656 
Üth
->
numÜ›Á
 = o¹h->
numpošts
 - 1;

658 
	`objeù_š™
(
obj
, 
Üth
->
numpošts
-1, 0);

660 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

661 
Üth
->
pošts
 = 
	`g_m®loc0
((Üth->
numpošts
)*(
Pošt
));

662 
i
=0;i<
Üth
->
numpošts
;i++) {

663 
	`d©a_pošt
(
d©a
, &
Üth
->
pošts
[
i
]);

664 
d©a
 = 
	`d©a_Ãxt
(data);

667 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "orth_orient");

669 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

670 
Üth
->
Ü›Á©iÚ
 = 
	`g_m®loc0
((Üth->
numpošts
-1)*(
Or›Á©iÚ
));

671 
i
=0;i<
Üth
->
numpošts
-1;i++) {

672 
Üth
->
Ü›Á©iÚ
[
i
] = 
	`d©a_’um
(
d©a
);

673 
d©a
 = 
	`d©a_Ãxt
(data);

676 
Üth
->
autÜoutšg
 = 
TRUE
;

677 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "autorouting");

678 ià(
©Œ
 !ğ
NULL
)

679 
Üth
->
autÜoutšg
 = 
	`d©a_boŞ—n
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

680 ià(
v”siÚ
 == 0) {

682 
Üth
->
autÜoutšg
 = 
FALSE
;

685 
Üth
->
hªdËs
 = 
	`g_m®loc0
((Üth->
numpošts
-1)*(
HªdË
 *));

687 
Üth
->
hªdËs
[0] = 
	`g_Ãw
(
HªdË
, 1);

688 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[0], 
HANDLE_MOVE_STARTPOINT
);

689 
Üth
->
hªdËs
[0]->
pos
 = o¹h->
pošts
[0];

690 
obj
->
hªdËs
[0] = 
Üth
->handles[0];

692 
n
 = 
Üth
->
numpošts
-2;

693 
Üth
->
hªdËs
[
n
] = 
	`g_Ãw
(
HªdË
, 1);

694 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[
n
], 
HANDLE_MOVE_ENDPOINT
);

695 
Üth
->
hªdËs
[
n
]->
pos
 = o¹h->
pošts
[Üth->
numpošts
-1];

696 
obj
->
hªdËs
[1] = 
Üth
->hªdËs[
n
];

698 
i
=1; i<
Üth
->
numpošts
-2; i++) {

699 
Üth
->
hªdËs
[
i
] = 
	`g_Ãw
(
HªdË
, 1);

700 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[
i
]);

701 
obj
->
hªdËs
[
i
+1] = 
Üth
->handles[i];

703 
Üth
->
numhªdËs
 = o¹h->
numpošts
-1;

705 
	`ÜthcÚn_upd©e_d©a
(
Üth
);

706 
	}
}

708 
HªdË
*

709 
	$ÜthcÚn_g‘_middË_hªdË
Ğ
O¹hCÚn
 *
Üth
 )

711 
n
 = 
Üth
->
numpošts
 - 1 ;

712  
Üth
->
hªdËs
[ 
n
/2 ] ;

713 
	}
}

715 
ObjeùChªge
 *

716 
	$ÜthcÚn_d–‘e_£gm’t
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
)

718 
£gm’t
;

719 
ObjeùChªge
 *
chªge
 = 
NULL
;

721 ià(
Üth
->
numpošts
==3)

722  
NULL
;

724 
£gm’t
 = 
	`g‘_£gm’t_Ä
(
Üth
, 
şickedpošt
, 1.0);

725 ià(
£gm’t
 < 0)

726  
NULL
;

728 ià(
£gm’t
==0) {

729 
chªge
 = 
	`’d£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_REMOVE_SEGMENT
, 
£gm’t
,

730 &
Üth
->
pošts
[
£gm’t
],

731 
Üth
->
hªdËs
[
£gm’t
]);

732 } ià(
£gm’t
 =ğ
Üth
->
numpošts
-2) {

733 
chªge
 = 
	`’d£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_REMOVE_SEGMENT
, 
£gm’t
,

734 &
Üth
->
pošts
[
£gm’t
+1],

735 
Üth
->
hªdËs
[
£gm’t
]);

736 } ià(
£gm’t
 > 0) {

740 ià(
£gm’t
 =ğ
Üth
->
numpošts
-3)

741 
£gm’t
--;

743 
chªge
 = 
	`mid£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_REMOVE_SEGMENT
, 
£gm’t
,

744 &
Üth
->
pošts
[
£gm’t
],

745 &
Üth
->
pošts
[
£gm’t
+1],

746 
Üth
->
hªdËs
[
£gm’t
],

747 
Üth
->
hªdËs
[
£gm’t
+1]);

750 
chªge
->
	`­¶y
(chªge, (
DŸObjeù
 *)
Üth
);

752  
chªge
;

753 
	}
}

755 
ObjeùChªge
 *

756 
	$ÜthcÚn_add_£gm’t
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
)

758 
HªdË
 *
hªdË1
, *
hªdË2
;

759 
ObjeùChªge
 *
chªge
 = 
NULL
;

760 
£gm’t
;

761 
Pošt
 
Ãwpošt
;

763 
£gm’t
 = 
	`g‘_£gm’t_Ä
(
Üth
, 
şickedpošt
, 1.0);

764 ià(
£gm’t
 < 0)

765  
NULL
;

767 ià(
£gm’t
==0) {

768 
hªdË1
 = 
	`g_Ãw
(
HªdË
, 1);

769 
	`£tup_’dpošt_hªdË
(
hªdË1
, 
HANDLE_MOVE_STARTPOINT
);

770 
chªge
 = 
	`’d£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_ADD_SEGMENT
,

771 0, &
Üth
->
pošts
[0],

772 
hªdË1
);

773 } ià(
£gm’t
 =ğ
Üth
->
numpošts
-2) {

774 
hªdË1
 = 
	`g_Ãw
(
HªdË
, 1);

775 
	`£tup_’dpošt_hªdË
(
hªdË1
, 
HANDLE_MOVE_ENDPOINT
);

776 
chªge
 = 
	`’d£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_ADD_SEGMENT
,

777 
£gm’t
+1, &
Üth
->
pošts
[segment+1],

778 
hªdË1
);

779 } ià(
£gm’t
 > 0) {

780 
hªdË1
 = 
	`g_Ãw
(
HªdË
, 1);

781 
	`£tup_midpošt_hªdË
(
hªdË1
);

782 
hªdË2
 = 
	`g_Ãw
(
HªdË
, 1);

783 
	`£tup_midpošt_hªdË
(
hªdË2
);

784 
Ãwpošt
 = *
şickedpošt
;

785 ià(
Üth
->
Ü›Á©iÚ
[
£gm’t
]==
HORIZONTAL
)

786 
Ãwpošt
.
y
 = 
Üth
->
pošts
[
£gm’t
].y;

788 
Ãwpošt
.
x
 = 
Üth
->
pošts
[
£gm’t
].x;

790 
chªge
 = 
	`mid£gm’t_ü—‹_chªge
(
Üth
, 
TYPE_ADD_SEGMENT
, 
£gm’t
,

791 &
Ãwpošt
,

792 &
Ãwpošt
,

793 
hªdË1
,

794 
hªdË2
);

797 
chªge
->
	`­¶y
(chªge, (
DŸObjeù
 *)
Üth
);

799  
chªge
;

800 
	}
}

806 
ObjeùChªge
 *

807 
	$ÜthcÚn_£t_autÜoutšg
(
O¹hCÚn
 *
cÚn
, 
gboŞ—n
 
Ú
)

809 
DŸObjeù
 *
obj
 = (DŸObjeù *)
cÚn
;

810 
ObjeùChªge
 *
chªge
;

812 
chªge
 = 
	`autÜou‹_ü—‹_chªge
(
cÚn
, 
Ú
);

813 
chªge
->
	`­¶y
(chªge, 
obj
);

814  
chªge
;

815 
	}
}

818 
	$d–‘e_pošt
(
O¹hCÚn
 *
Üth
, 
pos
)

820 
i
;

822 
Üth
->
numpošts
--;

823 
Üth
->
numÜ›Á
 = o¹h->
numpošts
 - 1;

825 
i
=
pos
;i<
Üth
->
numpošts
;i++) {

826 
Üth
->
pošts
[
i
] = orth->points[i+1];

829 
Üth
->
pošts
 = 
	`g_»®loc
(Üth->pošts, o¹h->
numpošts
*(
Pošt
));

830 
	}
}

836 
	$»move_hªdË
(
O¹hCÚn
 *
Üth
, 
£gm’t
)

838 
i
;

839 
HªdË
 *
hªdË
;

841 
hªdË
 = 
Üth
->
hªdËs
[
£gm’t
];

843 
i
=
£gm’t
; i < 
Üth
->
numpošts
-1; i++) {

844 
Üth
->
hªdËs
[
i
] = orth->handles[i+1];

845 
Üth
->
Ü›Á©iÚ
[
i
] = orth->orientation[i+1];

848 
Üth
->
Ü›Á©iÚ
 = 
	`g_»®loc
(orth->orientation,

849 (
Üth
->
numpošts
-1)*(
Or›Á©iÚ
));

850 
Üth
->
hªdËs
 = 
	`g_»®loc
(orth->handles,

851 (
Üth
->
numpošts
-1)*(
HªdË
 *));

853 
	`objeù_»move_hªdË
(&
Üth
->
objeù
, 
hªdË
);

854 
Üth
->
numhªdËs
 = o¹h->
numpošts
-1;

855 
	}
}

859 
	$add_pošt
(
O¹hCÚn
 *
Üth
, 
pos
, 
Pošt
 *
pošt
)

861 
i
;

863 
Üth
->
numpošts
++;

864 
Üth
->
numÜ›Á
 = o¹h->
numpošts
-1;

866 
Üth
->
pošts
 = 
	`g_»®loc
(Üth->pošts, o¹h->
numpošts
*(
Pošt
));

867 
i
=
Üth
->
numpošts
-1;i>
pos
;i--) {

868 
Üth
->
pošts
[
i
] = orth->points[i-1];

870 
Üth
->
pošts
[
pos
] = *
pošt
;

871 
	}
}

877 
	$š£¹_hªdË
(
O¹hCÚn
 *
Üth
, 
£gm’t
,

878 
HªdË
 *
hªdË
, 
Or›Á©iÚ
 
Ü›Á
)

880 
i
;

882 
Üth
->
Ü›Á©iÚ
 = 
	`g_»®loc
(orth->orientation,

883 (
Üth
->
numpošts
-1)*(
Or›Á©iÚ
));

884 
Üth
->
hªdËs
 = 
	`g_»®loc
(orth->handles,

885 (
Üth
->
numpošts
-1)*(
HªdË
 *));

886 
i
=
Üth
->
numpošts
-2;i>
£gm’t
;i--) {

887 
Üth
->
hªdËs
[
i
] = orth->handles[i-1];

888 
Üth
->
Ü›Á©iÚ
[
i
] = orth->orientation[i-1];

890 
Üth
->
hªdËs
[
£gm’t
] = 
hªdË
;

891 
Üth
->
Ü›Á©iÚ
[
£gm’t
] = 
Ü›Á
;

893 
	`objeù_add_hªdË
(&
Üth
->
objeù
, 
hªdË
);

894 
Üth
->
numhªdËs
 = o¹h->
numpošts
-1;

895 
	}
}

898 
	$’d£gm’t_chªge_ä“
(
EndSegm’tChªge
 *
chªge
)

900 iàĞ(
chªge
->
ty³
==
TYPE_ADD_SEGMENT
 && !chªge->
­¶›d
) ||

901 (
chªge
->
ty³
==
TYPE_REMOVE_SEGMENT
 && chªge->
­¶›d
) ){

902 ià(
chªge
->
hªdË
)

903 
	`g_ä“
(
chªge
->
hªdË
);

904 
chªge
->
hªdË
 = 
NULL
;

906 
	}
}

909 
	$’d£gm’t_chªge_­¶y
(
EndSegm’tChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

911 
O¹hCÚn
 *
Üth
 = (O¹hCÚÀ*)
obj
;

913 
chªge
->
­¶›d
 = 1;

915 
chªge
->
ty³
) {

916 
TYPE_ADD_SEGMENT
:

917 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
Şd_’d_hªdË
);

918 ià(
chªge
->
£gm’t
==0) {

919 
	`add_pošt
(
Üth
, 0, &
chªge
->
pošt
);

920 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
,

921 
chªge
->
hªdË
, 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[0]) );

922 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[1]);

923 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

925 
	`add_pošt
(
Üth
, o¹h->
numpošts
, &
chªge
->
pošt
);

926 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
, chªge->
hªdË
,

927 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[Üth->
numpošts
-3]) );

928 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[Üth->
numpošts
-3]);

930 ià(
chªge
->
ı
)

931 
	`objeù_cÚÃù
(
obj
, 
chªge
->
hªdË
, chªge->
ı
);

933 
TYPE_REMOVE_SEGMENT
:

934 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
Şd_’d_hªdË
);

935 ià(
chªge
->
£gm’t
==0) {

936 
	`d–‘e_pošt
(
Üth
, 0);

937 
	`»move_hªdË
(
Üth
, 0);

938 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[0], 
HANDLE_MOVE_STARTPOINT
);

939 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

941 
	`d–‘e_pošt
(
Üth
, o¹h->
numpošts
-1);

942 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
);

943 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[Üth->
numpošts
-2],

944 
HANDLE_MOVE_ENDPOINT
);

948 
	}
}

951 
	$’d£gm’t_chªge_»v”t
(
EndSegm’tChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

953 
O¹hCÚn
 *
Üth
 = (O¹hCÚÀ*)
obj
;

955 
chªge
->
ty³
) {

956 
TYPE_ADD_SEGMENT
:

957 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË
);

958 ià(
chªge
->
£gm’t
==0) {

959 
	`d–‘e_pošt
(
Üth
, 0);

960 
	`»move_hªdË
(
Üth
, 0);

961 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[0], 
HANDLE_MOVE_STARTPOINT
);

962 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

964 
	`d–‘e_pošt
(
Üth
, o¹h->
numpošts
-1);

965 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
);

966 
	`£tup_’dpošt_hªdË
(
Üth
->
hªdËs
[Üth->
numpošts
-2],

967 
HANDLE_MOVE_ENDPOINT
);

969 ià(
chªge
->
ı
)

970 
	`objeù_cÚÃù
(
obj
, 
chªge
->
Şd_’d_hªdË
, chªge->
ı
);

972 
TYPE_REMOVE_SEGMENT
:

973 ià(
chªge
->
£gm’t
==0) {

974 
	`add_pošt
(
Üth
, 0, &
chªge
->
pošt
);

975 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
,

976 
chªge
->
hªdË
, 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[0]) );

977 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[1]);

978 
obj
->
pos™iÚ
 = 
Üth
->
pošts
[0];

980 
	`add_pošt
(
Üth
, o¹h->
numpošts
, &
chªge
->
pošt
);

981 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
, chªge->
hªdË
,

982 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[Üth->
numpošts
-3]) );

983 
	`£tup_midpošt_hªdË
(
Üth
->
hªdËs
[Üth->
numpošts
-3]);

985 ià(
chªge
->
ı
)

986 
	`objeù_cÚÃù
(
obj
, 
chªge
->
Şd_’d_hªdË
, chªge->
ı
);

989 
chªge
->
­¶›d
 = 0;

990 
	}
}

992 
ObjeùChªge
 *

993 
	$’d£gm’t_ü—‹_chªge
(
O¹hCÚn
 *
Üth
, 
chªge_ty³
 
ty³
,

994 
£gm’t
, 
Pošt
 *
pošt
,

995 
HªdË
 *
hªdË
)

997 
EndSegm’tChªge
 *
chªge
;

999 
chªge
 = 
	`g_Ãw
(
EndSegm’tChªge
, 1);

1001 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
’d£gm’t_chªge_­¶y
;

1002 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
’d£gm’t_chªge_»v”t
;

1003 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
’d£gm’t_chªge_ä“
;

1005 
chªge
->
ty³
 =ype;

1006 
chªge
->
­¶›d
 = 0;

1007 
chªge
->
£gm’t
 = segment;

1008 
chªge
->
pošt
 = *point;

1009 
chªge
->
hªdË
 = handle;

1010 ià(
£gm’t
 == 0)

1011 
chªge
->
Şd_’d_hªdË
 = 
Üth
->
hªdËs
[0];

1013 
chªge
->
Şd_’d_hªdË
 = 
Üth
->
hªdËs
[Üth->
numpošts
-2];

1014 
chªge
->
ı
 = chªge->
Şd_’d_hªdË
->
cÚÃùed_to
;

1016  (
ObjeùChªge
 *)
chªge
;

1017 
	}
}

1021 
	$mid£gm’t_chªge_ä“
(
MidSegm’tChªge
 *
chªge
)

1023 iàĞ(
chªge
->
ty³
==
TYPE_ADD_SEGMENT
 && !chªge->
­¶›d
) ||

1024 (
chªge
->
ty³
==
TYPE_REMOVE_SEGMENT
 && chªge->
­¶›d
) ){

1025 ià(
chªge
->
hªdËs
[0])

1026 
	`g_ä“
(
chªge
->
hªdËs
[0]);

1027 
chªge
->
hªdËs
[0] = 
NULL
;

1028 ià(
chªge
->
hªdËs
[1])

1029 
	`g_ä“
(
chªge
->
hªdËs
[1]);

1030 
chªge
->
hªdËs
[1] = 
NULL
;

1032 
	}
}

1035 
	$mid£gm’t_chªge_­¶y
(
MidSegm’tChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1037 
O¹hCÚn
 *
Üth
 = (O¹hCÚÀ*)
obj
;

1038 
chªge
->
­¶›d
 = 1;

1040 
chªge
->
ty³
) {

1041 
TYPE_ADD_SEGMENT
:

1042 
	`add_pošt
(
Üth
, 
chªge
->
£gm’t
+1, &chªge->
pošts
[1]);

1043 
	`add_pošt
(
Üth
, 
chªge
->
£gm’t
+1, &chªge->
pošts
[0]);

1044 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
+1, chªge->
hªdËs
[1],

1045 
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
] );

1046 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
+1, chªge->
hªdËs
[0],

1047 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
]) );

1049 
TYPE_REMOVE_SEGMENT
:

1050 
	`d–‘e_pošt
(
Üth
, 
chªge
->
£gm’t
);

1051 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
);

1052 
	`d–‘e_pošt
(
Üth
, 
chªge
->
£gm’t
);

1053 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
);

1054 ià(
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
]==
HORIZONTAL
) {

1055 
Üth
->
pošts
[
chªge
->
£gm’t
].
x
 = change->points[0].x;

1057 
Üth
->
pošts
[
chªge
->
£gm’t
].
y
 = change->points[0].y;

1061 
	}
}

1064 
	$mid£gm’t_chªge_»v”t
(
MidSegm’tChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1066 
O¹hCÚn
 *
Üth
 = (O¹hCÚÀ*)
obj
;

1068 
chªge
->
ty³
) {

1069 
TYPE_ADD_SEGMENT
:

1070 
	`d–‘e_pošt
(
Üth
, 
chªge
->
£gm’t
+1);

1071 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
+1);

1072 
	`d–‘e_pošt
(
Üth
, 
chªge
->
£gm’t
+1);

1073 
	`»move_hªdË
(
Üth
, 
chªge
->
£gm’t
+1);

1075 
TYPE_REMOVE_SEGMENT
:

1076 ià(
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
]==
HORIZONTAL
) {

1077 
Üth
->
pošts
[
chªge
->
£gm’t
].
x
 = change->points[1].x;

1079 
Üth
->
pošts
[
chªge
->
£gm’t
].
y
 = change->points[1].y;

1081 
	`add_pošt
(
Üth
, 
chªge
->
£gm’t
, &chªge->
pošts
[1]);

1082 
	`add_pošt
(
Üth
, 
chªge
->
£gm’t
, &chªge->
pošts
[0]);

1083 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
, chªge->
hªdËs
[1],

1084 
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
-1] );

1085 
	`š£¹_hªdË
(
Üth
, 
chªge
->
£gm’t
, chªge->
hªdËs
[0],

1086 
	`FLIP_ORIENT
(
Üth
->
Ü›Á©iÚ
[
chªge
->
£gm’t
-1]) );

1089 
chªge
->
­¶›d
 = 0;

1090 
	}
}

1092 
ObjeùChªge
 *

1093 
	$mid£gm’t_ü—‹_chªge
(
O¹hCÚn
 *
Üth
, 
chªge_ty³
 
ty³
,

1094 
£gm’t
,

1095 
Pošt
 *
pošt1
, Pošˆ*
pošt2
,

1096 
HªdË
 *
hªdË1
, HªdË *
hªdË2
)

1098 
MidSegm’tChªge
 *
chªge
;

1100 
chªge
 = 
	`g_Ãw
(
MidSegm’tChªge
, 1);

1102 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
mid£gm’t_chªge_­¶y
;

1103 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
mid£gm’t_chªge_»v”t
;

1104 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
mid£gm’t_chªge_ä“
;

1106 
chªge
->
ty³
 =ype;

1107 
chªge
->
­¶›d
 = 0;

1108 
chªge
->
£gm’t
 = segment;

1109 
chªge
->
pošts
[0] = *
pošt1
;

1110 
chªge
->
pošts
[1] = *
pošt2
;

1111 
chªge
->
hªdËs
[0] = 
hªdË1
;

1112 
chªge
->
hªdËs
[1] = 
hªdË2
;

1114  (
ObjeùChªge
 *)
chªge
;

1115 
	}
}

1118 
	$autÜou‹_chªge_ä“
(
AutÜou‹Chªge
 *
chªge
)

1120 
	`g_ä“
(
chªge
->
pošts
);

1121 
	}
}

1124 
	$autÜou‹_chªge_­¶y
(
AutÜou‹Chªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1126 
O¹hCÚn
 *
Üth
 = (O¹hCÚn*)
obj
;

1128 ià(
chªge
->
Ú
) {

1129 
Üth
->
autÜoutšg
 = 
TRUE
;

1130 
	`autÜou‹_Ïyout_ÜthcÚn
(
Üth
, 
obj
->
hªdËs
[0]->
cÚÃùed_to
,

1131 
obj
->
hªdËs
[1]->
cÚÃùed_to
);

1133 
Üth
->
autÜoutšg
 = 
FALSE
;

1134 
	`ÜthcÚn_£t_pošts
(
Üth
, o¹h->
numpošts
, 
chªge
->
pošts
);

1136 
	}
}

1139 
	$autÜou‹_chªge_»v”t
(
AutÜou‹Chªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1141 
O¹hCÚn
 *
Üth
 = (O¹hCÚn*)
obj
;

1143 ià(
chªge
->
Ú
) {

1144 
Üth
->
autÜoutšg
 = 
FALSE
;

1145 
	`ÜthcÚn_£t_pošts
(
Üth
, o¹h->
numpošts
, 
chªge
->
pošts
);

1147 
Üth
->
autÜoutšg
 = 
TRUE
;

1148 
	`autÜou‹_Ïyout_ÜthcÚn
(
Üth
, 
obj
->
hªdËs
[0]->
cÚÃùed_to
,

1149 
obj
->
hªdËs
[1]->
cÚÃùed_to
);

1151 
	}
}

1153 
ObjeùChªge
 *

1154 
	$autÜou‹_ü—‹_chªge
(
O¹hCÚn
 *
Üth
, 
gboŞ—n
 
Ú
)

1156 
AutÜou‹Chªge
 *
chªge
;

1157 
i
;

1159 
chªge
 = 
	`g_Ãw
(
AutÜou‹Chªge
, 1);

1161 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
autÜou‹_chªge_­¶y
;

1162 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
autÜou‹_chªge_»v”t
;

1163 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
autÜou‹_chªge_ä“
;

1165 
chªge
->
Ú
 = on;

1166 
chªge
->
pošts
 = 
	`g_Ãw
(
Pošt
, 
Üth
->
numpošts
);

1167 
i
 = 0; i < 
Üth
->
numpošts
; i++)

1168 
chªge
->
pošts
[
i
] = 
Üth
->points[i];

1170  (
ObjeùChªge
 *)
chªge
;

1171 
	}
}

1173 
ObjeùChªge
 *

1174 
	$ÜthcÚn_toggË_autÜoutšg_ÿÎback
(
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

1176 
ObjeùChªge
 *
chªge
;

1180 
chªge
 = 
	`ÜthcÚn_£t_autÜoutšg
((
O¹hCÚn
*)
obj
,

1181 !((
O¹hCÚn
*)
obj
)->
autÜoutšg
);

1182 
	`ÜthcÚn_upd©e_d©a
((
O¹hCÚn
 *)
obj
);

1183  
chªge
;

1184 
	}
}

1187 
	$ÜthcÚn_upd©e_objeù_m’u
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şicked
,

1188 
DŸM’uI‹m
 *
objeù_m’u_™ems
)

1190 
objeù_m’u_™ems
[0].
aùive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
|

1191 (
Üth
->
autÜoutšg
?
DIAMENU_TOGGLE_ON
:0);

1192 
	}
}

	@O:\tool\dvs50\lib\orth_conn.h

18 #iâdeà
ORTH_CONN_H


19 
	#ORTH_CONN_H


	)

21 
	~"dŸty³s.h
"

22 
	~"objeù.h
"

23 
	~"boundšgbox.h
"

26 
	mHORIZONTAL
,

27 
	mVERTICAL


28 } 
	tOr›Á©iÚ
;

30 
	#FLIP_ORIENT
(
x
è(((x)==
HORIZONTAL
)?
VERTICAL
:HORIZONTAL)

	)

32 
	#HANDLE_MIDPOINT
 (
HANDLE_CUSTOM1
)

	)

37 
	s_O¹hCÚn
 {

39 
DŸObjeù
 
	mobjeù
;

41 
	mnumpošts
;

42 
Pošt
 *
	mpošts
;

44 
	mnumÜ›Á
;

45 
Or›Á©iÚ
 *
	mÜ›Á©iÚ
;

47 
	mnumhªdËs
;

48 
HªdË
 **
	mhªdËs
;

55 
PŞyBBExŒas
 
	mexŒa_¥acšg
;

56 
gboŞ—n
 
	mautÜoutšg
;

59 
DIAVAR
 
ÜthcÚn_upd©e_d©a
(
O¹hCÚn
 *
Üth
);

60 
DIAVAR
 
ÜthcÚn_upd©e_boundšgbox
(
O¹hCÚn
 *
Üth
);

61 
DIAVAR
 
ÜthcÚn_sim¶e_d¿w
(
O¹hCÚn
 *
Üth
, 
DŸR’d””
 *
»nd””
,

62 
»®
 
width
);

63 
DIAVAR
 
ÜthcÚn_š™
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
¡¬ošt
);

64 
DIAVAR
 
ÜthcÚn_de¡roy
(
O¹hCÚn
 *
Üth
);

65 
DIAVAR
 
ÜthcÚn_£t_pošts
(
O¹hCÚn
 *
Üth
, 
num_pošts
, 
Pošt
 *
pošts
);

66 
DIAVAR
 
ÜthcÚn_cİy
(
O¹hCÚn
 *
äom
, O¹hCÚÀ*
to
);

67 
DIAVAR
 
ÜthcÚn_§ve
(
O¹hCÚn
 *
Üth
, 
ObjeùNode
 
obj_node
);

68 
DIAVAR
 
ÜthcÚn_lßd
(
O¹hCÚn
 *
Üth
, 
ObjeùNode
 
obj_node
);

69 
DIAVAR
 
ObjeùChªge
* 
ÜthcÚn_move_hªdË
(
O¹hCÚn
 *
Üth
, 
HªdË
 *
id
,

70 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

71 
HªdËMoveR—sÚ
 
»asÚ
,

72 
Modif›rKeys
 
modif›rs
);

73 
DIAVAR
 
ObjeùChªge
* 
ÜthcÚn_move
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
to
);

74 
DIAVAR
 
»®
 
ÜthcÚn_di¡ªû_äom
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
pošt
,

75 
»®
 
lše_width
);

76 
DIAVAR
 
HªdË
* 
ÜthcÚn_g‘_middË_hªdË
(
O¹hCÚn
 *
Üth
);

78 
DIAVAR
 
ÜthcÚn_ÿn_d–‘e_£gm’t
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
);

79 
DIAVAR
 
ÜthcÚn_ÿn_add_£gm’t
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
);

80 
DIAVAR
 
ObjeùChªge
 *
ÜthcÚn_d–‘e_£gm’t
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
);

81 
DIAVAR
 
ObjeùChªge
 *
ÜthcÚn_add_£gm’t
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şickedpošt
);

82 
DIAVAR
 
ObjeùChªge
 *
ÜthcÚn_toggË_autÜoutšg_ÿÎback
(
DŸObjeù
 *
Üth
,

83 
Pošt
 *
şicked
,

84 
gpoš‹r
 
d©a
);

85 
DIAVAR
 
ÜthcÚn_upd©e_objeù_m’u
(
O¹hCÚn
 *
Üth
, 
Pošt
 *
şicked
,

86 
DŸM’uI‹m
 *
objeù_m’u_™ems
);

88 
	#ORTHCONN_COMMON_PROPERTIES
 \

89 
OBJECT_COMMON_PROPERTIES
, \

90 { "Üth_pošts", 
PROP_TYPE_POINTARRAY
, 0, "ÜthcÚÀpošts", 
NULL
}, \

91 { "Üth_Ü›Á", 
PROP_TYPE_ENUMARRAY
, 
PROP_FLAG_OPTIONAL
, "ÜthcÚÀÜ›Á©iÚs", 
NULL
}, \

92 { "Üth_autÜou‹", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_OPTIONAL
, 
	`N_
("AutÜou‹"), 
NULL
} \

93 

	)

94 
	#ORTHCONN_COMMON_PROPERTIES_OFFSETS
 \

95 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

96 { "Üth_pošts", 
PROP_TYPE_POINTARRAY
, \

97 
	`off£tof
(
O¹hCÚn
,
pošts
), off£tof(O¹hCÚn,
numpošts
)}, \

98 { "Üth_Ü›Á", 
PROP_TYPE_ENUMARRAY
, \

99 
	`off£tof
(
O¹hCÚn
,
Ü›Á©iÚ
), off£tof(O¹hCÚn,
numÜ›Á
)}, \

100 { "Üth_autÜou‹", 
PROP_TYPE_BOOL
, 
	`off£tof
(
O¹hCÚn
,
autÜoutšg
)} \

101 

	)

102 
	#ORTHCONN_COMMON_MENUS
 \

103 { 
	`N_
("AutÜoutšg"), 
ÜthcÚn_toggË_autÜoutšg_ÿÎback
, 
NULL
, \

104 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
}

	)

	@O:\tool\dvs50\lib\paper.c

19 
	~<cÚfig.h
>

21 
	~<¡dio.h
>

22 
	~<¡ršg.h
>

24 
	~"·³r.h
"

29 cÚ¡ 
	s_dŸ_·³r_m‘rics
 {

30 
gch¬
 *
	m·³r
;

31 
gdoubË
 
	mpswidth
, 
	mpsheight
;

32 
gdoubË
 
	mlm¬gš
, 
	mtm¬gš
, 
	mrm¬gš
, 
	mbm¬gš
;

33 } 
	g·³r_m‘rics
[] = {

56 { 
NULL
, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 }

60 
	$fšd_·³r
(cÚ¡ 
gch¬
 *
Çme
)

62 
i
;

64 ià(
Çme
 =ğ
NULL
)  -1;

65 
i
 = 0; 
·³r_m‘rics
[i].
·³r
 !ğ
NULL
; i++) {

66 ià(!
	`g_ascii_¡ºÿ£cmp
(
·³r_m‘rics
[
i
].
·³r
, 
Çme
,

67 
	`¡¾’
(
·³r_m‘rics
[
i
].
·³r
)))

70 ià(
·³r_m‘rics
[
i
].
·³r
 =ğ
NULL
)

71 
i
 = -1;

73  
i
;

74 
	}
}

77 
	$g‘_deçuÉ_·³r
()

79 
FILE
 *
·³rsize
;

80 
gch¬
 
·³r
[100];

81 cÚ¡ 
gch¬
 *
’v
;

82 
gšt
 
i
;

84 if((
’v
 = 
	`g_g‘’v
("PAPERCONF")è!ğ
NULL
) {

85 
	`¡ºıy
(
·³r
, 
’v
, (paper));

87 if((
·³rsize
 = 
	`fİ’
("/‘c/·³rsize", "r")è!ğ
NULL
) {

88 
	`fg‘s
(
·³r
, Õ­”), 
·³rsize
))

89 if(
	`g_ascii_i§Êum
(
·³r
[0])) {

92 
	`fşo£
(
·³rsize
);

95 
	`¡rıy
(
·³r
, "a4");

97 
i
 = 
	`fšd_·³r
(
·³r
);

98 ià(
i
 == -1)

99 
i
 = 
	`fšd_·³r
("a4");

101  
i
;

102 
	}
}

105 
	$g‘_·³r_šfo
(
P­”Info
 *
·³r
, 
i
, 
NewDŸg¿mD©a
 *
´efs
)

107 ià(
i
 =ğ-1 && 
´efs
 !ğ
NULL
)

108 
i
 = 
	`fšd_·³r
(
´efs
->
·³¹y³
);

109 ià(
i
 == -1)

110 
i
 = 
	`g‘_deçuÉ_·³r
();

112 
·³r
->
Çme
 = 
	`g_¡rdup
(
·³r_m‘rics
[
i
].paper);

113 
·³r
->
tm¬gš
 = 
·³r_m‘rics
[
i
].tmargin;

114 
·³r
->
bm¬gš
 = 
·³r_m‘rics
[
i
].bmargin;

115 
·³r
->
lm¬gš
 = 
·³r_m‘rics
[
i
].lmargin;

116 
·³r
->
rm¬gš
 = 
·³r_m‘rics
[
i
].rmargin;

117 ià(
´efs
 !ğ
NULL
)

118 
·³r
->
is_pÜŒa™
 = 
´efs
->is_portrait;

120 
·³r
->
is_pÜŒa™
 = 
TRUE
;

121 
·³r
->
sÿlšg
 = 1.0;

122 
·³r
->
f™to
 = 
FALSE
;

123 
·³r
->
f™width
 = 1;

124 
·³r
->
f™height
 = 1;

125 
·³r
->
width
 = 
·³r_m‘rics
[
i
].
pswidth
 -

126 
·³r_m‘rics
[
i
].
lm¬gš
 -

127 
·³r_m‘rics
[
i
].
rm¬gš
;

128 
·³r
->
height
 = 
·³r_m‘rics
[
i
].
psheight
 -

129 
·³r_m‘rics
[
i
].
tm¬gš
 -

130 
·³r_m‘rics
[
i
].
bm¬gš
;

131 ià(!
·³r
->
is_pÜŒa™
) {

132 
tmp
 = 
·³r
->
width
;

133 
·³r
->
width
 =…­”->
height
;

134 
·³r
->
height
 = 
tmp
;

136 
	}
}

138 
GLi¡
 *

139 
	$g‘_·³r_Çme_li¡
()

141 
i
;

142 
GLi¡
 *
Çme_li¡
 = 
NULL
;

144 ià(
Çme_li¡
 =ğ
NULL
) {

145 
i
 = 0; 
·³r_m‘rics
[i].
·³r
 !ğ
NULL
; i++) {

146 
Çme_li¡
 = 
	`g_li¡_­³nd
Òame_li¡, 
·³r_m‘rics
[
i
].
·³r
);

150  
Çme_li¡
;

151 
	}
}

153 cÚ¡ 
gch¬
 *

154 
	$g‘_·³r_Çme
(
i
)

156  
·³r_m‘rics
[
i
].
·³r
;

157 
	}
}

159 
gdoubË


160 
	$g‘_·³r_psheight
(
i
)

162  
·³r_m‘rics
[
i
].
psheight
;

163 
	}
}

165 
gdoubË


166 
	$g‘_·³r_pswidth
(
i
)

168  
·³r_m‘rics
[
i
].
pswidth
;

169 
	}
}

171 
gdoubË


172 
	$g‘_·³r_lm¬gš
(
i
)

174  
·³r_m‘rics
[
i
].
lm¬gš
;

175 
	}
}

177 
gdoubË


178 
	$g‘_·³r_rm¬gš
(
i
)

180  
·³r_m‘rics
[
i
].
rm¬gš
;

181 
	}
}

183 
gdoubË


184 
	$g‘_·³r_tm¬gš
(
i
)

186  
·³r_m‘rics
[
i
].
tm¬gš
;

187 
	}
}

189 
gdoubË


190 
	$g‘_·³r_bm¬gš
(
i
)

192  
·³r_m‘rics
[
i
].
bm¬gš
;

193 
	}
}

	@O:\tool\dvs50\lib\paper.h

19 #iâdeà
PAPER_H


20 
	#PAPER_H


	)

22 
	~<glib.h
>

23 
	~<dŸty³s.h
>

25 
	s_P­”Info
 {

26 
gch¬
 *
	mÇme
;

27 
gæßt
 
	mtm¬gš
, 
	mbm¬gš
, 
	mlm¬gš
, 
	mrm¬gš
;

28 
gboŞ—n
 
	mis_pÜŒa™
;

29 
gæßt
 
	msÿlšg
;

30 
gboŞ—n
 
	mf™to
;

31 
gšt
 
	mf™width
, 
	mf™height
;

33 
gæßt
 
	mwidth
, 
	mheight
;

39 
	~<dŸg¿md©a.h
>

41 
DIAVAR
 
fšd_·³r
(cÚ¡ 
gch¬
* 
Çme
);

42 
DIAVAR
 
g‘_deçuÉ_·³r
();

43 
DIAVAR
 
g‘_·³r_šfo
(
P­”Info
 *
·³r
, 
i
, 
NewDŸg¿mD©a
 *
d©a
);

45 
DIAVAR
 
GLi¡
 *
g‘_·³r_Çme_li¡
();

46 
DIAVAR
 cÚ¡ 
gch¬
 *
g‘_·³r_Çme
(
i
);

47 
DIAVAR
 
gdoubË
 
g‘_·³r_psheight
(
i
);

48 
DIAVAR
 
gdoubË
 
g‘_·³r_pswidth
(
i
);

49 
DIAVAR
 
gdoubË
 
g‘_·³r_lm¬gš
(
i
);

50 
DIAVAR
 
gdoubË
 
g‘_·³r_rm¬gš
(
i
);

51 
DIAVAR
 
gdoubË
 
g‘_·³r_bm¬gš
(
i
);

52 
DIAVAR
 
gdoubË
 
g‘_·³r_tm¬gš
(
i
);

	@O:\tool\dvs50\lib\parent.c

19 
	~<cÚfig.h
>

21 
	~"geom‘ry.h
"

22 
	~"objeù.h
"

23 
	~"·»Á.h
"

24 
	~<glib.h
>

32 
gboŞ—n
 
	$·»Á_li¡_ex·nd
(
GLi¡
 *
obj_li¡
)

34 
gboŞ—n
 
nÙhšg_afãùed
 = 
FALSE
;

35 
GLi¡
 *
li¡
 = 
obj_li¡
;

36 
li¡
)

38 
DŸObjeù
 *
obj
 = (DŸObjeù *è
li¡
->
d©a
;

40 ià(
	`objeù_æags_£t
(
obj
, 
DIA_OBJECT_CAN_PARENT
è&& obj->
chd»n
)

42 
obj_li¡
 = 
	`g_li¡_cÚÿt
(obj_li¡, 
	`g_li¡_cİy
(
obj
->
chd»n
));

43 
nÙhšg_afãùed
 = 
FALSE
;

46 
li¡
 = 
	`g_li¡_Ãxt
(list);

49  
nÙhšg_afãùed
;

50 
	}
}

62 
GLi¡
 *
	$·»Á_li¡_afãùed_h›¿rchy
(
GLi¡
 *
obj_li¡
)

64 
GHashTabË
 *
objeù_hash
 = 
	`g_hash_bË_Ãw
(
g_dœeù_hash
, 
g_dœeù_equ®
);

65 
GLi¡
 *
®l_li¡
 = 
	`g_li¡_cİy
(
obj_li¡
);

66 
GLi¡
 *
Ãw_li¡
 = 
NULL
, *
li¡
 = 
®l_li¡
;

67 
Üig_Ëngth
 = 
	`g_li¡_Ëngth
(
obj_li¡
);

69 ià(
	`·»Á_li¡_ex·nd
(
®l_li¡
))

70  
	`g_li¡_cİy
(
obj_li¡
);

73 
li¡
 = 
	`g_li¡_Áh
(
®l_li¡
, 
Üig_Ëngth
);

74 
li¡
)

76 
	`g_hash_bË_š£¹
(
objeù_hash
, 
li¡
->
d©a
, (*) 1);

77 
li¡
 = 
	`g_li¡_Ãxt
(list);

80 
li¡
 = 
obj_li¡
;

81 
li¡
)

83 ià(!
	`g_hash_bË_lookup
(
objeù_hash
, 
li¡
->
d©a
))

84 
Ãw_li¡
 = 
	`g_li¡_­³nd
Òew_li¡, 
li¡
->
d©a
);

86 
li¡
 = 
	`g_li¡_Ãxt
(list);

89 
	`g_li¡_ä“
(
®l_li¡
);

90 
	`g_hash_bË_de¡roy
(
objeù_hash
);

92  
Ãw_li¡
;

93 
	}
}

106 
GLi¡
 *
	$·»Á_li¡_afãùed
(
GLi¡
 *
obj_li¡
)

108 
GHashTabË
 *
objeù_hash
 = 
	`g_hash_bË_Ãw
(
g_dœeù_hash
, 
g_dœeù_equ®
);

109 
GLi¡
 *
®l_li¡
 = 
	`g_li¡_cİy
(
obj_li¡
);

110 
GLi¡
 *
Ãw_li¡
 = 
NULL
, *
li¡
 = 
®l_li¡
;

112 ià(
	`·»Á_li¡_ex·nd
(
®l_li¡
))

113  
	`g_li¡_cİy
(
obj_li¡
);

116 
li¡
 = 
®l_li¡
;

117 
li¡
)

119 
DŸObjeù
 *
obj
 = (DŸObjeù *è
li¡
->
d©a
;

120 ià(!
	`g_hash_bË_lookup
(
objeù_hash
, 
obj
))

122 
Ãw_li¡
 = 
	`g_li¡_­³nd
Òew_li¡, 
obj
);

123 
	`g_hash_bË_š£¹
(
objeù_hash
, 
obj
, (*) 1);

126 
li¡
 = 
	`g_li¡_Ãxt
(list);

129 
	`g_li¡_ä“
(
®l_li¡
);

131  
Ãw_li¡
;

132 
	}
}

138 
gboŞ—n


139 
	$·»Á_hªdË_move_out_check
(
DŸObjeù
 *
objeù
, 
Pošt
 *
to
)

141 
ReùªgË
 
p_ext
, 
c_ext
;

142 
Pošt
 
Ãw_d–
;

144 ià(!
objeù
->
·»Á
)

145  
FALSE
;

147 
	`·»Á_hªdË_ex‹Ás
(
objeù
->
·»Á
, &
p_ext
);

148 
	`·»Á_pošt_ex‹Ás
(
to
, &
c_ext
);

150 
Ãw_d–
 = 
	`·»Á_move_chd_d–
(&
p_ext
, &
c_ext
, 
NULL
);

151 
	`pošt_add
(
to
, &
Ãw_d–
);

153 ià(
Ãw_d–
.
x
 ||‚ew_d–.
y
)

154  
TRUE
;

156  
FALSE
;

157 
	}
}

164 
gboŞ—n
 
	$·»Á_hªdË_move_š_check
(
DŸObjeù
 *
objeù
, 
Pošt
 *
to
, Pošˆ*
¡¬t_©
)

166 
GLi¡
 *
li¡
 = 
objeù
->
chd»n
;

167 
gboŞ—n
 
Úû
 = 
TRUE
;

168 
ReùªgË
 
commÚ_ext
;

169 
gboŞ—n
 
»¡riùed
 = 
FALSE
;

171 ià(!
	`objeù_æags_£t
(
objeù
, 
DIA_OBJECT_CAN_PARENT
è|| !objeù->
chd»n
)

172  
FALSE
;

174 
li¡
)

176 ià(
Úû
) {

177 
	`·»Á_hªdË_ex‹Ás
(
li¡
->
d©a
, &
commÚ_ext
);

178 
Úû
 = 
FALSE
;

180 
ReùªgË
 
c_ext
;

181 
	`·»Á_hªdË_ex‹Ás
 (
li¡
->
d©a
, &
c_ext
);

182 
	`»ùªgË_uniÚ
(&
commÚ_ext
, &
c_ext
);

184 
li¡
 = 
	`g_li¡_Ãxt
(list);

191 ià(
¡¬t_©
->
y
 >ğ
commÚ_ext
.
bÙtom
) {

192 ià(
to
->
y
 < 
commÚ_ext
.
bÙtom
)

193 
to
->
y
 = 
commÚ_ext
.
bÙtom
, 
»¡riùed
 = 
TRUE
;

194 } ià(
¡¬t_©
->
y
 <ğ
commÚ_ext
.
tİ
) {

195 ià(
to
->
y
 > 
commÚ_ext
.
tİ
)

196 
to
->
y
 = 
commÚ_ext
.
tİ
, 
»¡riùed
 = 
TRUE
;

199 ià(
¡¬t_©
->
x
 >ğ
commÚ_ext
.
right
) {

200 ià(
to
->
x
 < 
commÚ_ext
.
right
)

201 
to
->
x
 = 
commÚ_ext
.
right
, 
»¡riùed
 = 
TRUE
;

202 } ià(
¡¬t_©
->
x
 <ğ
commÚ_ext
.
Ëá
) {

203 ià(
to
->
x
 > 
commÚ_ext
.
Ëá
)

204 
to
->
x
 = 
commÚ_ext
.
Ëá
, 
»¡riùed
 = 
TRUE
;

207  
»¡riùed
;

208 
	}
}

215 
Pošt
 
	$·»Á_move_chd_d–
(
ReùªgË
 *
p_ext
, ReùªgË *
c_ext
, 
Pošt
 *
d–
)

217 
Pošt
 
Ãw_d–
 = {0, 0};

218 
gboŞ—n
 
ä“_d–
 = 
FALSE
;

219 ià(
d–
 =ğ
NULL
)

221 
d–
 = 
	`g_Ãw0
(
Pošt
, 1);

222 
ä“_d–
 = 
TRUE
;

227 ià(
c_ext
->
Ëá
 + 
d–
->
x
 < 
p_ext
->left )

228 
Ãw_d–
.
x
 = 
p_ext
->
Ëá
 - (
c_ext
->Ëá + 
d–
->x);

229 ià(
c_ext
->
Ëá
 + 
d–
->
x
 + (c_ext->
right
 - c_ext->Ëáè> 
p_ext
->right)

230 
Ãw_d–
.
x
 = 
p_ext
->
right
 - (
c_ext
->
Ëá
 + 
d–
->x + (c_ext->right - c_ext->left));

232 ià(
c_ext
->
tİ
 + 
d–
->
y
 < 
p_ext
->top)

233 
Ãw_d–
.
y
 = 
p_ext
->
tİ
 - (
c_ext
->tİ + 
d–
->y);

234 ià(
c_ext
->
tİ
 + 
d–
->
y
 + (c_ext->
bÙtom
 - c_ext->tİè> 
p_ext
->bottom)

235 
Ãw_d–
.
y
 = 
p_ext
->
bÙtom
 - (
c_ext
->
tİ
 + 
d–
->y + (c_ext->bottom - c_ext->top));

237 ià(
ä“_d–
)

238 
	`g_ä“
(
d–
);

240  
Ãw_d–
;

241 
	}
}

245 
	$·»Á_pošt_ex‹Ás
(
Pošt
 *
pošt
, 
ReùªgË
 *
ex‹Ás
)

247 
ex‹Ás
->
Ëá
 = 
pošt
->
x
;

248 
ex‹Ás
->
right
 = 
pošt
->
x
;

249 
ex‹Ás
->
tİ
 = 
pošt
->
y
;

250 
ex‹Ás
->
bÙtom
 = 
pošt
->
y
;

251 
	}
}

258 
gboŞ—n


259 
	$·»Á_hªdË_ex‹Ás
(
DŸObjeù
 *
obj
, 
ReùªgË
 *
ex‹Ás
)

261 
idx
;

262 
coÜd
 *
Ëá_mo¡
 = 
NULL
, *
tİ_mo¡
 = NULL, *
bÙtom_mo¡
 = NULL, *
right_mo¡
 = NULL;

264 ià(
obj
->
num_hªdËs
 == 0)

265  
FALSE
;

267 
idx
 = 0; idx < 
obj
->
num_hªdËs
; idx++)

269 
HªdË
 *
hªdË
 = 
obj
->
hªdËs
[
idx
];

271 ià(!
Ëá_mo¡
 || *Ëá_mo¡ > 
hªdË
->
pos
.
x
)

272 
Ëá_mo¡
 = &
hªdË
->
pos
.
x
;

273 ià(!
right_mo¡
 || *right_mo¡ < 
hªdË
->
pos
.
x
)

274 
right_mo¡
 = &
hªdË
->
pos
.
x
;

275 ià(!
tİ_mo¡
 || *tİ_mo¡ > 
hªdË
->
pos
.
y
)

276 
tİ_mo¡
 = &
hªdË
->
pos
.
y
;

277 ià(!
bÙtom_mo¡
 || *bÙtom_mo¡ < 
hªdË
->
pos
.
y
)

278 
bÙtom_mo¡
 = &
hªdË
->
pos
.
y
;

281 
ex‹Ás
->
Ëá
 = *
Ëá_mo¡
;

282 
ex‹Ás
->
right
 = *
right_mo¡
;

283 
ex‹Ás
->
tİ
 = *
tİ_mo¡
;

284 
ex‹Ás
->
bÙtom
 = *
bÙtom_mo¡
;

286  
TRUE
;

287 
	}
}

295 
	$·»Á_­¶y_to_chd»n
(
DŸObjeù
 *
obj
, 
DŸObjeùFunc
 
funùiÚ
)

297 
GLi¡
 *
chd»n
;

298 
chd»n
 = 
obj
->chd»n; chd»À!ğ
NULL
; chd»Àğ
	`g_li¡_Ãxt
(children)) {

299 
DŸObjeù
 *
chd
 = 
chd»n
->
d©a
;

300 (*
funùiÚ
)(
chd
);

301 
	`·»Á_­¶y_to_chd»n
(
chd
, 
funùiÚ
);

303 
	}
}

	@O:\tool\dvs50\lib\parent.h

19 #iâdeà
PARENT_H


20 
	#PARENT_H


	)

22 
	~<glib.h
>

23 
	~"geom‘ry.h
"

25 
DIAVAR
 
GLi¡
 *
·»Á_li¡_afãùed
(GLi¡ *
obj_li¡
);

26 
DIAVAR
 
gboŞ—n
 
·»Á_hªdË_ex‹Ás
(
DŸObjeù
 *
obj
, 
ReùªgË
 *
ex‹Ás
);

27 
DIAVAR
 
Pošt
 
·»Á_move_chd_d–
(
ReùªgË
 *
p_ext
, ReùªgË *
c_‹xt
, Pošˆ*
d–
);

28 
DIAVAR
 
·»Á_pošt_ex‹Ás
(
Pošt
 *
pošt
, 
ReùªgË
 *
ex‹Ás
);

29 
gboŞ—n
 
·»Á_li¡_ex·nd
(
GLi¡
 *
obj_li¡
);

30 
DIAVAR
 
GLi¡
 *
·»Á_li¡_afãùed_h›¿rchy
(GLi¡ *
obj_li¡
);

31 
DIAVAR
 
gboŞ—n
 
·»Á_hªdË_move_out_check
(
DŸObjeù
 *
objeù
, 
Pošt
 *
to
);

32 
DIAVAR
 
gboŞ—n
 
·»Á_hªdË_move_š_check
(
DŸObjeù
 *
objeù
, 
Pošt
 *
to
, Pošˆ*
¡¬t_©
);

33 
DIAVAR
 
·»Á_­¶y_to_chd»n
(
DŸObjeù
 *
obj
, 
DŸObjeùFunc
 
func
);

	@O:\tool\dvs50\lib\persistence.c

23 
	~"cÚfig.h
"

25 
	~<¡dio.h
>

26 
	~<¡ršg.h
>

27 
	~<sys/¡©.h
>

28 
	~<sys/ty³s.h
>

29 #ifdeà
HAVE_UNISTD_H


30 
	~<uni¡d.h
>

33 
	~"³rsi¡’û.h
"

34 
	~"dŸ_dœs.h
"

35 
	~"dŸ_xml_libxml.h
"

36 
	~"dŸ_xml.h
"

37 
	~"mes§ge.h
"

39 
	~<gtk/gtk.h
>

40 
	~<libxml/Œ“.h
>

44 
GHashTabË
 *
	g³rsi¡’t_wšdows
, *
	g³rsi¡’t_’Œy¡ršgs
, *
	g³rsi¡’t_li¡s
;

45 
GHashTabË
 *
	g³rsi¡’t_š‹g”s
, *
	g³rsi¡’t_»®s
;

46 
GHashTabË
 *
	g³rsi¡’t_boŞ—ns
, *
	g³rsi¡’t_¡ršgs
;

47 
GHashTabË
 *
	g³rsi¡’t_cŞÜs
;

49 
GHashTabË
 *

50 
	$_dŸ_hash_bË_¡r_ªy_Ãw
 ()

53  
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
, 
g_¡r_equ®
, 
NULL
, 
g_ä“
);

54 
	}
}

58 (*
	tP”si¡’ûLßdFunc
)(
	tgch¬
 *
	trŞe
, 
	txmlNodePŒ
 
	tnode
);

61 
	$³rsi¡’û_lßd_wšdow
(
gch¬
 *
rŞe
, 
xmlNodePŒ
 
node
)

63 
A‰ribu‹Node
 
©Œ
;

64 
P”si¡’tWšdow
 *
wššfo
 = 
	`g_Ãw0
(PersistentWindow, 1);

66 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "xpos");

67 ià(
©Œ
 !ğ
NULL
)

68 
wššfo
->
x
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

69 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "ypos");

70 ià(
©Œ
 !ğ
NULL
)

71 
wššfo
->
y
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

72 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "width");

73 ià(
©Œ
 !ğ
NULL
)

74 
wššfo
->
width
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

75 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "height");

76 ià(
©Œ
 !ğ
NULL
)

77 
wššfo
->
height
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

78 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "isopen");

79 ià(
©Œ
 !ğ
NULL
)

80 
wššfo
->
isİ’
 = 
	`d©a_boŞ—n
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

82 
	`g_hash_bË_š£¹
(
³rsi¡’t_wšdows
, 
rŞe
, 
wššfo
);

83 
	}
}

87 
	$³rsi¡’û_lßd_’Œy¡ršg
(
gch¬
 *
rŞe
, 
xmlNodePŒ
 
node
)

89 
A‰ribu‹Node
 
©Œ
;

90 
gch¬
 *
¡ršg
 = 
NULL
;

93 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "stringvalue");

94 ià(
©Œ
 !ğ
NULL
)

95 
¡ršg
 = 
	`d©a_¡ršg
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

99 ià(
¡ršg
 !ğ
NULL
)

100 
	`g_hash_bË_š£¹
(
³rsi¡’t_’Œy¡ršgs
, 
rŞe
, 
¡ršg
);

101 
	}
}

104 
	$³rsi¡’û_lßd_li¡
(
gch¬
 *
rŞe
, 
xmlNodePŒ
 
node
)

106 
A‰ribu‹Node
 
©Œ
;

107 
gch¬
 *
¡ršg
 = 
NULL
;

110 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "listvalue");

111 ià(
©Œ
 !ğ
NULL
)

112 
¡ršg
 = 
	`d©a_¡ršg
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

116 ià(
¡ršg
 !ğ
NULL
) {

117 
gch¬
 **
¡ršgs
 = 
	`g_¡r¥l™
(
¡ršg
, "\n", -1);

118 
P”si¡’tLi¡
 *
¶i¡
;

119 
GLi¡
 *
li¡
 = 
NULL
;

120 
i
;

121 
i
 = 0; 
¡ršgs
[i] !ğ
NULL
; i++) {

122 
li¡
 = 
	`g_li¡_­³nd
Öi¡, 
	`g_¡rdup
(
¡ršgs
[
i
]));

125 
	`g_¡rä“v
(
¡ršgs
);

127 
	`g_ä“
 (
¡ršg
);

128 
¶i¡
 = 
	`g_Ãw
(
P”si¡’tLi¡
, 1);

129 
¶i¡
->
gli¡
 = 
li¡
;

130 
¶i¡
->
rŞe
 =„ole;

131 
¶i¡
->
sÜ‹d
 = 
FALSE
;

132 
¶i¡
->
max_memb”s
 = 
G_MAXINT
;

133 
	`g_hash_bË_š£¹
(
³rsi¡’t_li¡s
, 
rŞe
, 
¶i¡
);

135 
	}
}

138 
	$³rsi¡’û_lßd_š‹g”
(
gch¬
 *
rŞe
, 
xmlNodePŒ
 
node
)

140 
A‰ribu‹Node
 
©Œ
;

143 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "intvalue");

144 ià(
©Œ
 !ğ
NULL
) {

145 
gšt
 *
š‹g”
 = 
	`g_Ãw
(gint, 1);

146 *
š‹g”
 = 
	`d©a_št
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

147 
	`g_hash_bË_š£¹
(
³rsi¡’t_š‹g”s
, 
rŞe
, 
š‹g”
);

149 
	}
}

152 
	$³rsi¡’û_lßd_»®
(
gch¬
 *
rŞe
, 
xmlNodePŒ
 
node
)

154 
A‰ribu‹Node
 
©Œ
;

157 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "realvalue");

158 ià(
©Œ
 !ğ
NULL
) {

159 
»®
 *
»®v®
 = 
	`g_Ãw
(real, 1);

160 *
»®v®
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

161 
	`g_hash_bË_š£¹
(
³rsi¡’t_»®s
, 
rŞe
, 
»®v®
);

163 
	}
}

166 
	$³rsi¡’û_lßd_boŞ—n
(
gch¬
 *
rŞe
, 
xmlNodePŒ
 
node
)

168 
A‰ribu‹Node
 
©Œ
;

171 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "booleanvalue");

172 ià(
©Œ
 !ğ
NULL
) {

173 
gboŞ—n
 *
boŞ—nv®
 = 
	`g_Ãw
(gboolean, 1);

174 *
boŞ—nv®
 = 
	`d©a_boŞ—n
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

175 
	`g_hash_bË_š£¹
(
³rsi¡’t_boŞ—ns
, 
rŞe
, 
boŞ—nv®
);

177 
	}
}

180 
	$³rsi¡’û_lßd_¡ršg
(
gch¬
 *
rŞe
, 
xmlNodePŒ
 
node
)

182 
A‰ribu‹Node
 
©Œ
;

185 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "stringvalue");

186 ià(
©Œ
 !ğ
NULL
) {

187 
gch¬
 *
¡ršgv®
 = 
	`d©a_¡ršg
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

188 
	`g_hash_bË_š£¹
(
³rsi¡’t_¡ršgs
, 
rŞe
, 
¡ršgv®
);

190 
	}
}

193 
	$³rsi¡’û_lßd_cŞÜ
(
gch¬
 *
rŞe
, 
xmlNodePŒ
 
node
)

195 
A‰ribu‹Node
 
©Œ
;

198 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
node
, "colorvalue");

199 ià(
©Œ
 !ğ
NULL
) {

200 
CŞÜ
 *
cŞÜv®
 = 
	`g_Ãw
(Color, 1);

201 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), 
cŞÜv®
);

202 
	`g_hash_bË_š£¹
(
³rsi¡’t_cŞÜs
, 
rŞe
, 
cŞÜv®
);

204 
	}
}

206 
GHashTabË
 *
	gty³_hªdËrs
;

212 
	$³rsi¡’û_lßd_ty³
(
xmlNodePŒ
 
node
)

214 cÚ¡ 
gch¬
 *
ty³Çme
 = (gch¬ *è
node
->
Çme
;

215 
gch¬
 *
Çme
;

217 
P”si¡’ûLßdFunc
 
func
 =

218 (
P”si¡’ûLßdFunc
)
	`g_hash_bË_lookup
(
ty³_hªdËrs
, 
ty³Çme
);

219 ià(
func
 =ğ
NULL
) {

223 
Çme
 = (
gch¬
 *)
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"role");

224 ià(
Çme
 =ğ
NULL
) {

228 (*
func
)(
Çme
, 
node
);

229 
node
 =‚ode->
Ãxt
;

230 
	}
}

233 
	$³rsi¡’û_£t_ty³_hªdËr
(
gch¬
 *
Çme
, 
P”si¡’ûLßdFunc
 
func
)

235 ià(
ty³_hªdËrs
 =ğ
NULL
)

236 
ty³_hªdËrs
 = 
	`g_hash_bË_Ãw
(
g_¡r_hash
,
g_¡r_equ®
);

238 
	`g_hash_bË_š£¹
(
ty³_hªdËrs
, 
Çme
, (
gpoš‹r
)
func
);

239 
	}
}

242 
	$³rsi¡’û_š™
()

244 
	`³rsi¡’û_£t_ty³_hªdËr
("wšdow", 
³rsi¡’û_lßd_wšdow
);

245 
	`³rsi¡’û_£t_ty³_hªdËr
("’Œy¡ršg", 
³rsi¡’û_lßd_’Œy¡ršg
);

246 
	`³rsi¡’û_£t_ty³_hªdËr
("li¡", 
³rsi¡’û_lßd_li¡
);

247 
	`³rsi¡’û_£t_ty³_hªdËr
("š‹g”", 
³rsi¡’û_lßd_š‹g”
);

248 
	`³rsi¡’û_£t_ty³_hªdËr
("»®", 
³rsi¡’û_lßd_»®
);

249 
	`³rsi¡’û_£t_ty³_hªdËr
("boŞ—n", 
³rsi¡’û_lßd_boŞ—n
);

250 
	`³rsi¡’û_£t_ty³_hªdËr
("¡ršg", 
³rsi¡’û_lßd_¡ršg
);

251 
	`³rsi¡’û_£t_ty³_hªdËr
("cŞÜ", 
³rsi¡’û_lßd_cŞÜ
);

253 ià(
³rsi¡’t_wšdows
 =ğ
NULL
) {

254 
³rsi¡’t_wšdows
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

256 ià(
³rsi¡’t_’Œy¡ršgs
 =ğ
NULL
) {

257 
³rsi¡’t_’Œy¡ršgs
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

259 ià(
³rsi¡’t_li¡s
 =ğ
NULL
) {

260 
³rsi¡’t_li¡s
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

262 ià(
³rsi¡’t_š‹g”s
 =ğ
NULL
) {

263 
³rsi¡’t_š‹g”s
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

265 ià(
³rsi¡’t_»®s
 =ğ
NULL
) {

266 
³rsi¡’t_»®s
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

268 ià(
³rsi¡’t_boŞ—ns
 =ğ
NULL
) {

269 
³rsi¡’t_boŞ—ns
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

271 ià(
³rsi¡’t_¡ršgs
 =ğ
NULL
) {

272 
³rsi¡’t_¡ršgs
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

274 ià(
³rsi¡’t_cŞÜs
 =ğ
NULL
) {

275 
³rsi¡’t_cŞÜs
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

277 
	}
}

281 
	$³rsi¡’û_lßd
()

283 
xmlDocPŒ
 
doc
;

284 
gch¬
 *
f’ame
 = 
	`dŸ_cÚfig_f’ame
("persistence");

286 
	`³rsi¡’û_š™
();

288 ià(!
	`g_fe_‹¡
(
f’ame
, 
G_FILE_TEST_IS_REGULAR
)) {

289 
	`g_ä“
 (
f’ame
);

292 
doc
 = 
	`xmlDŸP¬£Fe
(
f’ame
);

293 ià(
doc
 !ğ
NULL
) {

294 ià(
doc
->
xmlRoÙNode
 !ğ
NULL
) {

295 
xmlNsPŒ
 
Çme¥aû
 = 
	`xmlS—rchNs
(
doc
, doc->
xmlRoÙNode
, (cÚ¡ 
xmlCh¬
 *)"dia");

296 ià(!
	`xmlSŒcmp
 (
doc
->
xmlRoÙNode
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"persistence") &&

297 
Çme¥aû
 !ğ
NULL
) {

298 
xmlNodePŒ
 
chd_node
 = 
doc
->
xmlRoÙNode
->
chd»n
;

299 ; 
chd_node
 !ğ
NULL
; chd_nodğchd_node->
Ãxt
) {

300 
	`³rsi¡’û_lßd_ty³
(
chd_node
);

304 
	`xmlF»eDoc
(
doc
);

306 
	`g_ä“
(
f’ame
);

307 
	}
}

313 
	$³rsi¡’û_§ve_wšdow
(
gpoš‹r
 
key
, gpoš‹¸
v®ue
, gpoš‹¸
d©a
)

315 
xmlNodePŒ
 
Œ“
 = (xmlNodePŒ)
d©a
;

316 
P”si¡’tWšdow
 *
wšdow_pos
 = (P”si¡’tWšdow *)
v®ue
;

317 
ObjeùNode
 
wšdow
;

319 
wšdow
 = (
ObjeùNode
)
	`xmlNewChd
(
Œ“
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"window", NULL);

321 
	`xmlS‘Prİ
(
wšdow
, (cÚ¡ 
xmlCh¬
 *)"rŞe", (xmlCh¬ *è
key
);

322 
	`d©a_add_št
(
	`Ãw_©Œibu‹
(
wšdow
, "xpos"), 
wšdow_pos
->
x
);

323 
	`d©a_add_št
(
	`Ãw_©Œibu‹
(
wšdow
, "ypos"), 
wšdow_pos
->
y
);

324 
	`d©a_add_št
(
	`Ãw_©Œibu‹
(
wšdow
, "width"), 
wšdow_pos
->
width
);

325 
	`d©a_add_št
(
	`Ãw_©Œibu‹
(
wšdow
, "height"), 
wšdow_pos
->
height
);

326 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
wšdow
, "isİ’"), 
wšdow_pos
->
isİ’
);

328 
	}
}

332 
	$³rsi¡’û_§ve_li¡
(
gpoš‹r
 
key
, gpoš‹¸
v®ue
, gpoš‹¸
d©a
)

334 
xmlNodePŒ
 
Œ“
 = (xmlNodePŒ)
d©a
;

335 
ObjeùNode
 
li¡node
;

336 
GSŒšg
 *
buf
;

337 
GLi¡
 *
™ems
;

339 
li¡node
 = (
ObjeùNode
)
	`xmlNewChd
(
Œ“
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"list", NULL);

341 
	`xmlS‘Prİ
(
li¡node
, (cÚ¡ 
xmlCh¬
 *)"rŞe", (xmlCh¬ *è
key
);

343 
buf
 = 
	`g_¡ršg_Ãw
("");

344 
™ems
 = ((
P”si¡’tLi¡
*)
v®ue
)->
gli¡
; i‹m !ğ
NULL
;

345 
™ems
 = 
	`g_li¡_Ãxt
(items)) {

346 
	`g_¡ršg_­³nd
(
buf
, (
gch¬
 *)
™ems
->
d©a
);

347 ià(
	`g_li¡_Ãxt
(
™ems
è!ğ
NULL
)

348 
	`g_¡ršg_­³nd
(
buf
, "\n");

351 
	`d©a_add_¡ršg
(
	`Ãw_©Œibu‹
(
li¡node
, "li¡v®ue"), 
buf
->
¡r
);

352 
	`g_¡ršg_ä“
(
buf
, 
TRUE
);

353 
	}
}

356 
	$³rsi¡’û_§ve_š‹g”
(
gpoš‹r
 
key
, gpoš‹¸
v®ue
, gpoš‹¸
d©a
)

358 
xmlNodePŒ
 
Œ“
 = (xmlNodePŒ)
d©a
;

359 
ObjeùNode
 
š‹g”node
;

361 
š‹g”node
 = (
ObjeùNode
)
	`xmlNewChd
(
Œ“
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"integer", NULL);

363 
	`xmlS‘Prİ
(
š‹g”node
, (cÚ¡ 
xmlCh¬
 *)"rŞe", (xmlCh¬ *)
key
);

364 
	`d©a_add_št
(
	`Ãw_©Œibu‹
(
š‹g”node
, "štv®ue"), *(
gšt
 *)
v®ue
);

365 
	}
}

368 
	$³rsi¡’û_§ve_»®
(
gpoš‹r
 
key
, gpoš‹¸
v®ue
, gpoš‹¸
d©a
)

370 
xmlNodePŒ
 
Œ“
 = (xmlNodePŒ)
d©a
;

371 
ObjeùNode
 
»®node
;

373 
»®node
 = (
ObjeùNode
)
	`xmlNewChd
(
Œ“
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"real", NULL);

375 
	`xmlS‘Prİ
(
»®node
, (cÚ¡ 
xmlCh¬
 *)"rŞe", (xmlCh¬ *)
key
);

376 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
»®node
, "»®v®ue"), *(
»®
 *)
v®ue
);

377 
	}
}

380 
	$³rsi¡’û_§ve_boŞ—n
(
gpoš‹r
 
key
, gpoš‹¸
v®ue
, gpoš‹¸
d©a
)

382 
xmlNodePŒ
 
Œ“
 = (xmlNodePŒ)
d©a
;

383 
ObjeùNode
 
boŞ—Âode
;

385 
boŞ—Âode
 = (
ObjeùNode
)
	`xmlNewChd
(
Œ“
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"boolean", NULL);

387 
	`xmlS‘Prİ
(
boŞ—Âode
, (cÚ¡ 
xmlCh¬
 *)"rŞe", (xmlCh¬ *)
key
);

388 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
boŞ—Âode
, "boŞ—nv®ue"), *(
gboŞ—n
 *)
v®ue
);

389 
	}
}

392 
	$³rsi¡’û_§ve_¡ršg
(
gpoš‹r
 
key
, gpoš‹¸
v®ue
, gpoš‹¸
d©a
)

394 
xmlNodePŒ
 
Œ“
 = (xmlNodePŒ)
d©a
;

395 
ObjeùNode
 
¡ršgnode
;

397 
¡ršgnode
 = (
ObjeùNode
)
	`xmlNewChd
(
Œ“
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"string", NULL);

399 
	`xmlS‘Prİ
(
¡ršgnode
, (cÚ¡ 
xmlCh¬
 *)"rŞe", (xmlCh¬ *)
key
);

400 
	`d©a_add_¡ršg
(
	`Ãw_©Œibu‹
(
¡ršgnode
, "¡ršgv®ue"), (
gch¬
 *)
v®ue
);

401 
	}
}

404 
	$³rsi¡’û_§ve_cŞÜ
(
gpoš‹r
 
key
, gpoš‹¸
v®ue
, gpoš‹¸
d©a
)

406 
xmlNodePŒ
 
Œ“
 = (xmlNodePŒ)
d©a
;

407 
ObjeùNode
 
cŞÜnode
;

409 
cŞÜnode
 = (
ObjeùNode
)
	`xmlNewChd
(
Œ“
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"color", NULL);

411 
	`xmlS‘Prİ
(
cŞÜnode
, (cÚ¡ 
xmlCh¬
 *)"rŞe", (xmlCh¬ *)
key
);

412 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
cŞÜnode
, "cŞÜv®ue"), (
CŞÜ
 *)
v®ue
);

413 
	}
}

417 
	$³rsi¡’û_§ve_ty³
(
xmlDocPŒ
 
doc
, 
GHashTabË
 *
’Œ›s
, 
GHFunc
 
func
)

419 ià(
’Œ›s
 !ğ
NULL
 && 
	`g_hash_bË_size
(entries) != 0) {

420 
	`g_hash_bË_fÜ—ch
(
’Œ›s
, 
func
, 
doc
->
xmlRoÙNode
);

422 
	}
}

426 
	$³rsi¡’û_§ve
()

428 
xmlDocPŒ
 
doc
;

429 
xmlNs
 *
Çme_¥aû
;

430 
gch¬
 *
f’ame
 = 
	`dŸ_cÚfig_f’ame
("persistence");

432 
doc
 = 
	`xmlNewDoc
((cÚ¡ 
xmlCh¬
 *)"1.0");

433 
doc
->
’codšg
 = 
	`xmlSŒdup
((cÚ¡ 
xmlCh¬
 *)"UTF-8");

435 
doc
->
xmlRoÙNode
 = 
	`xmlNewDocNode
(doc, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"persistence", NULL);

437 
Çme_¥aû
 = 
	`xmlNewNs
(
doc
->
xmlRoÙNode
,

438 (cÚ¡ 
xmlCh¬
 *è
DIA_XML_NAME_SPACE_BASE
,

439 (cÚ¡ 
xmlCh¬
 *)"dia");

440 
	`xmlS‘Ns
(
doc
->
xmlRoÙNode
, 
Çme_¥aû
);

442 
	`³rsi¡’û_§ve_ty³
(
doc
, 
³rsi¡’t_wšdows
, 
³rsi¡’û_§ve_wšdow
);

443 
	`³rsi¡’û_§ve_ty³
(
doc
, 
³rsi¡’t_’Œy¡ršgs
, 
³rsi¡’û_§ve_¡ršg
);

444 
	`³rsi¡’û_§ve_ty³
(
doc
, 
³rsi¡’t_li¡s
, 
³rsi¡’û_§ve_li¡
);

445 
	`³rsi¡’û_§ve_ty³
(
doc
, 
³rsi¡’t_š‹g”s
, 
³rsi¡’û_§ve_š‹g”
);

446 
	`³rsi¡’û_§ve_ty³
(
doc
, 
³rsi¡’t_»®s
, 
³rsi¡’û_§ve_»®
);

447 
	`³rsi¡’û_§ve_ty³
(
doc
, 
³rsi¡’t_boŞ—ns
, 
³rsi¡’û_§ve_boŞ—n
);

448 
	`³rsi¡’û_§ve_ty³
(
doc
, 
³rsi¡’t_¡ršgs
, 
³rsi¡’û_§ve_¡ršg
);

449 
	`³rsi¡’û_§ve_ty³
(
doc
, 
³rsi¡’t_cŞÜs
, 
³rsi¡’û_§ve_cŞÜ
);

451 
	`xmlDŸSaveFe
(
f’ame
, 
doc
);

452 
	`g_ä“
(
f’ame
);

453 
	`xmlF»eDoc
(
doc
);

454 
	}
}

462 cÚ¡ 
gch¬
 *

463 
	$³rsi¡’û_g‘_wšdow_Çme
(
GtkWšdow
 *
wšdow
)

465 cÚ¡ 
gch¬
 *
Çme
 = 
	`gtk_wšdow_g‘_rŞe
(
wšdow
);

466 ià(
Çme
 =ğ
NULL
) {

467 
	`g_w¬nšg
("IÁ”Çl: Wšdow % ha nØrŞe.", 
	`gtk_wšdow_g‘_t™Ë
(
wšdow
));

468  
NULL
;

470  
Çme
;

471 
	}
}

474 
	$³rsi¡’û_¡Üe_wšdow_šfo
(
GtkWšdow
 *
wšdow
, 
P”si¡’tWšdow
 *
wššfo
,

475 
gboŞ—n
 
isşo£d
)

478 ià(!
isşo£d
) {

479 
	`gtk_wšdow_g‘_pos™iÚ
(
wšdow
, &
wššfo
->
x
, &wššfo->
y
);

480 
	`gtk_wšdow_g‘_size
(
wšdow
, &
wššfo
->
width
, &wššfo->
height
);

481 
wššfo
->
isİ’
 = 
TRUE
;

483 
wššfo
->
isİ’
 = 
FALSE
;

485 
	}
}

494 
	$³rsi¡’û_upd©e_wšdow
(
GtkWšdow
 *
wšdow
, 
gboŞ—n
 
isşo£d
)

496 cÚ¡ 
gch¬
 *
Çme
 = 
	`³rsi¡’û_g‘_wšdow_Çme
(
wšdow
);

497 
P”si¡’tWšdow
 *
wššfo
;

499 ià(
Çme
 =ğ
NULL
) ;

501 ià(
³rsi¡’t_wšdows
 =ğ
NULL
) {

502 
³rsi¡’t_wšdows
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

504 
wššfo
 = (
P”si¡’tWšdow
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_wšdows
, 
Çme
);

506 ià(
wššfo
 !ğ
NULL
) {

507 
	`³rsi¡’û_¡Üe_wšdow_šfo
(
wšdow
, 
wššfo
, 
isşo£d
);

509 
wššfo
 = 
	`g_Ãw0
(
P”si¡’tWšdow
, 1);

510 
	`³rsi¡’û_¡Üe_wšdow_šfo
(
wšdow
, 
wššfo
, 
FALSE
);

511 
	`g_hash_bË_š£¹
(
³rsi¡’t_wšdows
, (
gch¬
 *)
Çme
, 
wššfo
);

513 ià(
wššfo
->
wšdow
 !ğ
NULL
 && wininfo->window != window) {

514 
	`g_objeù_uÄef
(
wššfo
->
wšdow
);

515 
wššfo
->
wšdow
 = 
NULL
;

517 ià(
wššfo
->
wšdow
 =ğ
NULL
) {

518 
wššfo
->
wšdow
 = window;

519 
	`g_objeù_»f
(
wšdow
);

522 
wššfo
->
isİ’
 = !
isşo£d
;

523 
	}
}

532 
gboŞ—n


533 
	$³rsi¡’û_wšdow_ev’t_hªdËr
(
GtkWšdow
 *
wšdow
, 
GdkEv’t
 *
ev’t
, 
gpoš‹r
 
d©a
)

535 
ev’t
->
ty³
) {

536 
GDK_UNMAP
 :

537 
	`dŸ_log_mes§ge
 ("unm­ (%s)", 
	`³rsi¡’û_g‘_wšdow_Çme
(
wšdow
));

539 
GDK_MAP
 :

540 
	`dŸ_log_mes§ge
 ("m­ (%s)", 
	`³rsi¡’û_g‘_wšdow_Çme
(
wšdow
));

542 
GDK_CONFIGURE
 :

543 
	`dŸ_log_mes§ge
 ("cÚfigu» (%s)", 
	`³rsi¡’û_g‘_wšdow_Çme
(
wšdow
));

546 
	`³rsi¡’û_upd©e_wšdow
(
wšdow
, !(
	`GTK_WIDGET_MAPPED
(window)));

548  
FALSE
;

549 
	}
}

556 
gboŞ—n


557 
	$³rsi¡’û_hide_show_wšdow
(
GtkWšdow
 *
wšdow
, 
gpoš‹r
 
d©a
)

559 
	`³rsi¡’û_upd©e_wšdow
(
wšdow
, !
	`GTK_WIDGET_MAPPED
(window));

560  
FALSE
;

561 
	}
}

568 
gboŞ—n


569 
	$wššfo_š_¿nge
 (cÚ¡ 
P”si¡’tWšdow
 *
wššfo
)

571 
GdkSü“n
 *
sü“n
 = 
	`gdk_sü“n_g‘_deçuÉ
 ();

572 
gšt
 
num_mÚ™Üs
 = 
	`gdk_sü“n_g‘_n_mÚ™Üs
 (
sü“n
), 
i
;

573 
GdkReùªgË
 
rwš
 = {
wššfo
->
x
, wššfo->
y
, wššfo->
width
, wššfo->
height
};

574 
GdkReùªgË
 
¼es
 = {0, 0, 0, 0};

576 
i
 = 0; i < 
num_mÚ™Üs
; ++i) {

577 
GdkReùªgË
 
rmÚ
;

579 
	`gdk_sü“n_g‘_mÚ™Ü_geom‘ry
 (
sü“n
, 
i
, &
rmÚ
);

581 
	`gdk_»ùªgË_š‹r£ù
 (&
rwš
, &
rmÚ
, &
¼es
);

582 ià(
¼es
.
width
 *„»s.
height
 > 0)

586  (
¼es
.
width
 *„»s.
height
 > 0);

587 
	}
}

593 
	$³rsi¡’û_»gi¡”_wšdow
(
GtkWšdow
 *
wšdow
)

595 cÚ¡ 
gch¬
 *
Çme
 = 
	`³rsi¡’û_g‘_wšdow_Çme
(
wšdow
);

596 
P”si¡’tWšdow
 *
wššfo
;

598 ià(
Çme
 =ğ
NULL
) ;

599 ià(
³rsi¡’t_wšdows
 =ğ
NULL
) {

600 
³rsi¡’t_wšdows
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

602 
wššfo
 = (
P”si¡’tWšdow
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_wšdows
, 
Çme
);

603 ià(
wššfo
 !ğ
NULL
) {

604 ià(
	`wššfo_š_¿nge
 (
wššfo
)) {

606 
	`gtk_wšdow_move
(
wšdow
, 
wššfo
->
x
, wššfo->
y
);

607 
	`gtk_wšdow_»size
(
wšdow
, 
wššfo
->
width
, wššfo->
height
);

609 ià(
wššfo
->
isİ’
è
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
wšdow
));

611 
wššfo
 = 
	`g_Ãw0
(
P”si¡’tWšdow
, 1);

612 
	`gtk_wšdow_g‘_pos™iÚ
(
wšdow
, &
wššfo
->
x
, &wššfo->
y
);

613 
	`gtk_wšdow_g‘_size
(
wšdow
, &
wššfo
->
width
, &wššfo->
height
);

615 
wššfo
->
isİ’
 = 
	`GTK_WIDGET_DRAWABLE
(
	`GTK_WIDGET
(
wšdow
));

616 
	`g_hash_bË_š£¹
(
³rsi¡’t_wšdows
, (
gch¬
 *)
Çme
, 
wššfo
);

618 ià(
wššfo
->
wšdow
 !ğ
NULL
 && wininfo->window != window) {

619 
	`g_objeù_uÄef
(
wššfo
->
wšdow
);

620 
wššfo
->
wšdow
 = 
NULL
;

622 ià(
wššfo
->
wšdow
 =ğ
NULL
) {

623 
wššfo
->
wšdow
 = window;

624 
	`g_objeù_»f
(
wšdow
);

627 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
wšdow
), "configure-event",

628 
	`G_CALLBACK
(
³rsi¡’û_wšdow_ev’t_hªdËr
), 
NULL
);

629 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
wšdow
), "map-event",

630 
	`G_CALLBACK
(
³rsi¡’û_wšdow_ev’t_hªdËr
), 
NULL
);

631 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
wšdow
), "unmap-event",

632 
	`G_CALLBACK
(
³rsi¡’û_wšdow_ev’t_hªdËr
), 
NULL
);

634 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
wšdow
), "hide",

635 
	`G_CALLBACK
(
³rsi¡’û_hide_show_wšdow
), 
NULL
);

636 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
wšdow
), "show",

637 
	`G_CALLBACK
(
³rsi¡’û_hide_show_wšdow
), 
NULL
);

638 
	}
}

650 
	$³rsi¡’û_»gi¡”_wšdow_ü—‹
(
gch¬
 *
rŞe
, 
NuÎ¬yFunc
 *
func
)

652 
P”si¡’tWšdow
 *
wššfo
;

654 ià(
rŞe
 =ğ
NULL
) ;

655 ià(
³rsi¡’t_wšdows
 =ğ
NULL
) ;

656 
wššfo
 = (
P”si¡’tWšdow
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_wšdows
, 
rŞe
);

657 ià(
wššfo
 !ğ
NULL
) {

658 (*
func
)();

660 
	}
}

665 
gboŞ—n


666 
	$³rsi¡’û_upd©e_¡ršg_’Œy
(
GtkWidg‘
 *
widg‘
, 
GdkEv’t
 *
ev’t
,

667 
gpoš‹r
 
u£rd©a
)

669 
gch¬
 *
rŞe
 = (gch¬*)
u£rd©a
;

671 ià(
ev’t
->
ty³
 =ğ
GDK_FOCUS_CHANGE
) {

672 
gch¬
 *
¡ršg
 = (gch¬ *)
	`g_hash_bË_lookup
(
³rsi¡’t_’Œy¡ršgs
, 
rŞe
);

673 cÚ¡ 
gch¬
 *
’Œy¡ršg
 = 
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
widg‘
));

674 ià(
¡ršg
 =ğ
NULL
 || 
	`¡rcmp
(¡ršg, 
’Œy¡ršg
) != 0) {

675 
	`g_hash_bË_š£¹
(
³rsi¡’t_’Œy¡ršgs
, 
rŞe
, 
	`g_¡rdup
(
’Œy¡ršg
));

679  
FALSE
;

680 
	}
}

687 
gboŞ—n


688 
	$³rsi¡’û_chªge_¡ršg_’Œy
(
gch¬
 *
rŞe
, gch¬ *
¡ršg
,

689 
GtkWidg‘
 *
widg‘
)

691 
gch¬
 *
Şd_¡ršg
 = (gch¬*)
	`g_hash_bË_lookup
(
³rsi¡’t_’Œy¡ršgs
, 
rŞe
);

692 ià(
Şd_¡ršg
 !ğ
NULL
) {

693 ià(
widg‘
 !ğ
NULL
) {

694 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
widg‘
), 
¡ršg
);

696 
	`g_hash_bË_š£¹
(
³rsi¡’t_’Œy¡ršgs
, 
rŞe
, 
	`g_¡rdup
(
¡ršg
));

699  
FALSE
;

700 
	}
}

707 
	$³rsi¡’û_»gi¡”_¡ršg_’Œy
(
gch¬
 *
rŞe
, 
GtkWidg‘
 *
’Œy
)

709 
gch¬
 *
¡ršg
;

710 ià(
rŞe
 =ğ
NULL
) ;

711 ià(
³rsi¡’t_’Œy¡ršgs
 =ğ
NULL
) {

712 
³rsi¡’t_’Œy¡ršgs
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

714 
¡ršg
 = (
gch¬
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_’Œy¡ršgs
, 
rŞe
);

715 ià(
¡ršg
 !ğ
NULL
) {

716 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
’Œy
), 
¡ršg
);

718 
¡ršg
 = 
	`g_¡rdup
(
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
’Œy
)));

719 
	`g_hash_bË_š£¹
(
³rsi¡’t_’Œy¡ršgs
, 
rŞe
, 
¡ršg
);

721 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
’Œy
), "event",

722 
	`G_CALLBACK
(
³rsi¡’û_upd©e_¡ršg_’Œy
), 
rŞe
);

723 
	}
}

732 
P”si¡’tLi¡
 *

733 
	$³rsi¡’û_»gi¡”_li¡
(cÚ¡ 
gch¬
 *
rŞe
)

735 
P”si¡’tLi¡
 *
li¡
;

736 ià(
rŞe
 =ğ
NULL
)  NULL;

737 ià(
³rsi¡’t_li¡s
 =ğ
NULL
) {

738 
³rsi¡’t_li¡s
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

740 
li¡
 = (
P”si¡’tLi¡
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_li¡s
, 
rŞe
);

741 ià(
li¡
 !ğ
NULL
) {

742  
li¡
;

745 
li¡
 = 
	`g_Ãw
(
P”si¡’tLi¡
, 1);

746 
li¡
->
rŞe
 =„ole;

747 
li¡
->
gli¡
 = 
NULL
;

748 
li¡
->
sÜ‹d
 = 
FALSE
;

749 
li¡
->
max_memb”s
 = 
G_MAXINT
;

750 
	`g_hash_bË_š£¹
(
³rsi¡’t_li¡s
, (
gch¬
 *)
rŞe
, 
li¡
);

751  
li¡
;

752 
	}
}

754 
P”si¡’tLi¡
 *

755 
	$³rsi¡’t_li¡_g‘
(cÚ¡ 
gch¬
 *
rŞe
)

757 
P”si¡’tLi¡
 *
li¡
;

758 ià(
rŞe
 =ğ
NULL
)  NULL;

759 ià(
³rsi¡’t_li¡s
 !ğ
NULL
) {

760 
li¡
 = (
P”si¡’tLi¡
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_li¡s
, 
rŞe
);

761 ià(
li¡
 !ğ
NULL
) {

762  
li¡
;

766  
NULL
;

767 
	}
}

769 
GLi¡
 *

770 
	$³rsi¡’t_li¡_g‘_gli¡
(cÚ¡ 
gch¬
 *
rŞe
)

772 
P”si¡’tLi¡
 *
¶i¡
 = 
	`³rsi¡’t_li¡_g‘
(
rŞe
);

773 ià(
¶i¡
 =ğ
NULL
)  NULL;

774  
¶i¡
->
gli¡
;

775 
	}
}

777 
GLi¡
 *

778 
	$³rsi¡’t_li¡_cut_Ëngth
(
GLi¡
 *
li¡
, 
gušt
 
Ëngth
)

780 
	`g_li¡_Ëngth
(
li¡
è> 
Ëngth
) {

781 
GLi¡
 *
Ï¡
 = 
	`g_li¡_Ï¡
(
li¡
);

783 
li¡
 = 
	`g_li¡_»move_lšk
Öi¡, 
Ï¡
);

784 
	`g_li¡_ä“
(
Ï¡
);

786  
li¡
;

787 
	}
}

794 
gboŞ—n


795 
	$³rsi¡’t_li¡_add
(cÚ¡ 
gch¬
 *
rŞe
, cÚ¡ gch¬ *
™em
)

797 
P”si¡’tLi¡
 *
¶i¡
 = 
	`³rsi¡’t_li¡_g‘
(
rŞe
);

798 if(
¶i¡
 =ğ
NULL
) {

799 
	`g_w¬nšg
("Cª'ˆfšd†i¡ fÜ % wh’‡ddšg %s", 
rŞe
, 
™em
);

800  
TRUE
;

802 ià(
¶i¡
->
sÜ‹d
) {

804  
TRUE
;

806 
gboŞ—n
 
exi¡ed
 = 
FALSE
;

807 
GLi¡
 *
tm¶i¡
 = 
¶i¡
->
gli¡
;

808 
GLi¡
 *
Şd_–em
 = 
	`g_li¡_fšd_cu¡om
(
tm¶i¡
, 
™em
, (
GCom·»Func
)
g_ascii_¡rÿ£cmp
);

809 
Şd_–em
 !ğ
NULL
) {

810 
tm¶i¡
 = 
	`g_li¡_»move_lšk
Ñm¶i¡, 
Şd_–em
);

816 
	`g_li¡_ä“_1
(
Şd_–em
);

817 
Şd_–em
 = 
	`g_li¡_fšd_cu¡om
(
tm¶i¡
, 
™em
, (
GCom·»Func
)
g_ascii_¡rÿ£cmp
);

818 
exi¡ed
 = 
TRUE
;

820 
tm¶i¡
 = 
	`g_li¡_´•’d
Ñm¶i¡, 
	`g_¡rdup
(
™em
));

821 
tm¶i¡
 = 
	`³rsi¡’t_li¡_cut_Ëngth
Ñm¶i¡, 
¶i¡
->
max_memb”s
);

822 
¶i¡
->
gli¡
 = 
tm¶i¡
;

823  
exi¡ed
;

825 
	}
}

828 
	$³rsi¡’t_li¡_£t_max_Ëngth
(cÚ¡ 
gch¬
 *
rŞe
, 
gšt
 
max
)

830 
P”si¡’tLi¡
 *
¶i¡
 = 
	`³rsi¡’t_li¡_g‘
(
rŞe
);

831 
¶i¡
->
max_memb”s
 = 
max
;

832 
¶i¡
->
gli¡
 = 
	`³rsi¡’t_li¡_cut_Ëngth
Õli¡->gli¡, 
max
);

833 
	}
}

840 
gboŞ—n


841 
	$³rsi¡’t_li¡_»move
(cÚ¡ 
gch¬
 *
rŞe
, cÚ¡ gch¬ *
™em
)

843 
P”si¡’tLi¡
 *
¶i¡
 = 
	`³rsi¡’t_li¡_g‘
(
rŞe
);

845 
GLi¡
 *
’Œy
 = 
	`g_li¡_fšd_cu¡om
(
¶i¡
->
gli¡
, 
™em
, (
GCom·»Func
)
g_ascii_¡rÿ£cmp
);

846 ià(
’Œy
 !ğ
NULL
) {

847 
¶i¡
->
gli¡
 = 
	`g_li¡_»move_lšk
Õli¡->gli¡, 
’Œy
);

848 
	`g_ä“
(
’Œy
->
d©a
);

849  
TRUE
;

850 }  
FALSE
;

851 
	}
}

854 
	$³rsi¡’t_li¡_»move_®l
(cÚ¡ 
gch¬
 *
rŞe
)

856 
P”si¡’tLi¡
 *
¶i¡
 = 
	`³rsi¡’t_li¡_g‘
(
rŞe
);

857 
	`³rsi¡’t_li¡_cut_Ëngth
(
¶i¡
->
gli¡
, 0);

858 
¶i¡
->
gli¡
 = 
NULL
;

859 
	}
}

862 
P”si¡’ûC®lback
 
	mfunc
;

863 
GObjeù
 *
	mw©ch
;

864 
gpoš‹r
 
	mu£rd©a
;

865 } 
	tLi¡’”D©a
;

875 
	$³rsi¡’t_li¡_add_li¡’”
(cÚ¡ 
gch¬
 *
rŞe
, 
P”si¡’ûC®lback
 
func
,

876 
GObjeù
 *
w©ch
, 
gpoš‹r
 
u£rd©a
)

878 
P”si¡’tLi¡
 *
¶i¡
 = 
	`³rsi¡’t_li¡_g‘
(
rŞe
);

879 
Li¡’”D©a
 *
li¡’”
;

881 ià(
¶i¡
 !ğ
NULL
) {

882 
li¡’”
 = 
	`g_Ãw
(
Li¡’”D©a
, 1);

883 
li¡’”
->
func
 = func;

884 
li¡’”
->
w©ch
 = watch;

885 
	`g_objeù_add_w—k_poš‹r
(
w©ch
, (
gpoš‹r
)&
li¡’”
->watch);

886 
li¡’”
->
u£rd©a
 = userdata;

887 
¶i¡
->
li¡’”s
 = 
	`g_li¡_­³nd
Õli¡->li¡’”s, 
li¡’”
);

889 
	}
}

892 
gšt


893 
	$³rsi¡’û_»gi¡”_š‹g”
(
gch¬
 *
rŞe
, 
deçuÉv®ue
)

895 
gšt
 *
š‹g”
;

896 ià(
rŞe
 =ğ
NULL
)  0;

897 ià(
³rsi¡’t_š‹g”s
 =ğ
NULL
) {

898 
³rsi¡’t_š‹g”s
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

900 
š‹g”
 = (
gšt
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_š‹g”s
, 
rŞe
);

901 ià(
š‹g”
 =ğ
NULL
) {

902 
š‹g”
 = 
	`g_Ãw
(
gšt
, 1);

903 *
š‹g”
 = 
deçuÉv®ue
;

904 
	`g_hash_bË_š£¹
(
³rsi¡’t_š‹g”s
, 
rŞe
, 
š‹g”
);

906  *
š‹g”
;

907 
	}
}

909 
gšt


910 
	$³rsi¡’û_g‘_š‹g”
(
gch¬
 *
rŞe
)

912 
gšt
 *
š‹g”
;

913 ià(
³rsi¡’t_š‹g”s
 =ğ
NULL
) {

914 
	`g_w¬nšg
("NØ³rsi¡’ˆš‹g” tØg‘ fÜ %s!", 
rŞe
);

917 
š‹g”
 = (
gšt
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_š‹g”s
, 
rŞe
);

918 ià(
š‹g”
 !ğ
NULL
)  *integer;

919 
	`g_w¬nšg
("NØš‹g”Øg‘ fÜ %s", 
rŞe
);

921 
	}
}

924 
	$³rsi¡’û_£t_š‹g”
(
gch¬
 *
rŞe
, 
gšt
 
Ãwv®ue
)

926 
gšt
 *
š‹g”
;

927 ià(
³rsi¡’t_š‹g”s
 =ğ
NULL
) {

928 
	`g_w¬nšg
("NØ³rsi¡’ˆš‹g” y‘ fÜ %s!", 
rŞe
);

931 
š‹g”
 = (
gšt
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_š‹g”s
, 
rŞe
);

932 ià(
š‹g”
 !ğ
NULL
)

933 *
š‹g”
 = 
Ãwv®ue
;

935 
	`g_w¬nšg
("NØš‹g”Ø£ˆfÜ %s", 
rŞe
);

936 
	}
}

939 
»®


940 
	$³rsi¡’û_»gi¡”_»®
(
gch¬
 *
rŞe
, 
»®
 
deçuÉv®ue
)

942 
»®
 *
»®v®
;

943 ià(
rŞe
 =ğ
NULL
)  0;

944 ià(
³rsi¡’t_»®s
 =ğ
NULL
) {

945 
³rsi¡’t_»®s
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

947 
»®v®
 = (
»®
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_»®s
, 
rŞe
);

948 ià(
»®v®
 =ğ
NULL
) {

949 
»®v®
 = 
	`g_Ãw
(
»®
, 1);

950 *
»®v®
 = 
deçuÉv®ue
;

951 
	`g_hash_bË_š£¹
(
³rsi¡’t_»®s
, 
rŞe
, 
»®v®
);

953  *
»®v®
;

954 
	}
}

956 
»®


957 
	$³rsi¡’û_g‘_»®
(
gch¬
 *
rŞe
)

959 
»®
 *
»®v®
;

960 ià(
³rsi¡’t_»®s
 =ğ
NULL
) {

961 
	`g_w¬nšg
("NØ³rsi¡’ˆ»® tØg‘ fÜ %s!", 
rŞe
);

964 
»®v®
 = (
»®
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_»®s
, 
rŞe
);

965 ià(
»®v®
 !ğ
NULL
)  *realval;

966 
	`g_w¬nšg
("NØ»®Øg‘ fÜ %s", 
rŞe
);

968 
	}
}

971 
	$³rsi¡’û_£t_»®
(
gch¬
 *
rŞe
, 
»®
 
Ãwv®ue
)

973 
»®
 *
»®v®
;

974 ià(
³rsi¡’t_»®s
 =ğ
NULL
) {

975 
	`g_w¬nšg
("NØ³rsi¡’ˆ»® y‘ fÜ %s!", 
rŞe
);

978 
»®v®
 = (
»®
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_»®s
, 
rŞe
);

979 ià(
»®v®
 !ğ
NULL
)

980 *
»®v®
 = 
Ãwv®ue
;

982 
	`g_w¬nšg
("NØ»®Ø£ˆfÜ %s", 
rŞe
);

983 
	}
}

988 
gboŞ—n


989 
	$³rsi¡’û_boŞ—n_is_»gi¡”ed
(cÚ¡ 
gch¬
 *
rŞe
)

991 
gboŞ—n
 *
boŞ—nv®
;

992 ià(
rŞe
 =ğ
NULL
)  0;

993 ià(
³rsi¡’t_boŞ—ns
 =ğ
NULL
) {

994 
³rsi¡’t_boŞ—ns
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

996 
boŞ—nv®
 = (
gboŞ—n
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_boŞ—ns
, 
rŞe
);

997  
boŞ—nv®
 !ğ
NULL
;

998 
	}
}

1000 
gboŞ—n


1001 
	$³rsi¡’û_»gi¡”_boŞ—n
(cÚ¡ 
gch¬
 *
rŞe
, 
gboŞ—n
 
deçuÉv®ue
)

1003 
gboŞ—n
 *
boŞ—nv®
;

1004 ià(
rŞe
 =ğ
NULL
)  0;

1005 ià(
³rsi¡’t_boŞ—ns
 =ğ
NULL
) {

1006 
³rsi¡’t_boŞ—ns
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

1008 
boŞ—nv®
 = (
gboŞ—n
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_boŞ—ns
, 
rŞe
);

1009 ià(
boŞ—nv®
 =ğ
NULL
) {

1010 
boŞ—nv®
 = 
	`g_Ãw
(
gboŞ—n
, 1);

1011 *
boŞ—nv®
 = 
deçuÉv®ue
;

1012 
	`g_hash_bË_š£¹
(
³rsi¡’t_boŞ—ns
, 
rŞe
, 
boŞ—nv®
);

1014  *
boŞ—nv®
;

1015 
	}
}

1017 
gboŞ—n


1018 
	$³rsi¡’û_g‘_boŞ—n
(cÚ¡ 
gch¬
 *
rŞe
)

1020 
gboŞ—n
 *
boŞ—nv®
;

1021 ià(
³rsi¡’t_boŞ—ns
 =ğ
NULL
) {

1022 
	`g_w¬nšg
("NØ³rsi¡’ˆboŞ—n tØg‘ fÜ %s!", 
rŞe
);

1023  
FALSE
;

1025 
boŞ—nv®
 = (
gboŞ—n
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_boŞ—ns
, 
rŞe
);

1026 ià(
boŞ—nv®
 !ğ
NULL
)  *booleanval;

1027 
	`g_w¬nšg
("NØboŞ—ÀtØg‘ fÜ %s", 
rŞe
);

1028  
FALSE
;

1029 
	}
}

1032 
	$³rsi¡’û_£t_boŞ—n
(cÚ¡ 
gch¬
 *
rŞe
, 
gboŞ—n
 
Ãwv®ue
)

1034 
gboŞ—n
 *
boŞ—nv®
;

1035 ià(
³rsi¡’t_boŞ—ns
 =ğ
NULL
) {

1036 
	`g_w¬nšg
("NØ³rsi¡’ˆboŞ—n y‘ fÜ %s!", 
rŞe
);

1039 
boŞ—nv®
 = (
gboŞ—n
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_boŞ—ns
, 
rŞe
);

1040 ià(
boŞ—nv®
 !ğ
NULL
)

1041 *
boŞ—nv®
 = 
Ãwv®ue
;

1043 
	`g_w¬nšg
("NØboŞ—ÀtØ£ˆfÜ %s", 
rŞe
);

1044 
	}
}

1055 
gch¬
 *

1056 
	$³rsi¡’û_»gi¡”_¡ršg
(
gch¬
 *
rŞe
, gch¬ *
deçuÉv®ue
)

1058 
gch¬
 *
¡ršgv®
;

1059 ià(
rŞe
 =ğ
NULL
)  0;

1060 ià(
³rsi¡’t_¡ršgs
 =ğ
NULL
) {

1061 
³rsi¡’t_¡ršgs
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

1063 
¡ršgv®
 = (
gch¬
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_¡ršgs
, 
rŞe
);

1064 ià(
¡ršgv®
 =ğ
NULL
) {

1065 
¡ršgv®
 = 
	`g_¡rdup
(
deçuÉv®ue
);

1066 
	`g_hash_bË_š£¹
(
³rsi¡’t_¡ršgs
, 
rŞe
, 
¡ršgv®
);

1068  
	`g_¡rdup
(
¡ršgv®
);

1069 
	}
}

1071 
gch¬
 *

1072 
	$³rsi¡’û_g‘_¡ršg
(
gch¬
 *
rŞe
)

1074 
gch¬
 *
¡ršgv®
;

1075 ià(
³rsi¡’t_¡ršgs
 =ğ
NULL
) {

1076 
	`g_w¬nšg
("NØ³rsi¡’ˆ¡ršg tØg‘ fÜ %s!", 
rŞe
);

1077  
NULL
;

1079 
¡ršgv®
 = (
gch¬
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_¡ršgs
, 
rŞe
);

1080 ià(
¡ršgv®
 !ğ
NULL
è 
	`g_¡rdup
(stringval);

1081 
	`g_w¬nšg
("NØ¡ršgØg‘ fÜ %s", 
rŞe
);

1082  
NULL
;

1083 
	}
}

1086 
	$³rsi¡’û_£t_¡ršg
(
gch¬
 *
rŞe
, cÚ¡ gch¬ *
Ãwv®ue
)

1088 
gch¬
 *
¡ršgv®
;

1089 ià(
³rsi¡’t_¡ršgs
 =ğ
NULL
) {

1090 
	`g_w¬nšg
("NØ³rsi¡’ˆ¡ršg y‘ fÜ %s!", 
rŞe
);

1093 
¡ršgv®
 = (
gch¬
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_¡ršgs
, 
rŞe
);

1094 ià(
¡ršgv®
 !ğ
NULL
) {

1095 
	`g_hash_bË_š£¹
(
³rsi¡’t_¡ršgs
, 
rŞe
, 
	`g_¡rdup
(
Ãwv®ue
));

1097 
	`g_hash_bË_»move
(
³rsi¡’t_¡ršgs
, 
rŞe
);

1099 
	}
}

1104 
CŞÜ
 *

1105 
	$³rsi¡’û_»gi¡”_cŞÜ
(
gch¬
 *
rŞe
, 
CŞÜ
 *
deçuÉv®ue
)

1107 
CŞÜ
 *
cŞÜv®
;

1108 ià(
rŞe
 =ğ
NULL
)  0;

1109 ià(
³rsi¡’t_cŞÜs
 =ğ
NULL
) {

1110 
³rsi¡’t_cŞÜs
 = 
	`_dŸ_hash_bË_¡r_ªy_Ãw
();

1112 
cŞÜv®
 = (
CŞÜ
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_cŞÜs
, 
rŞe
);

1113 ià(
cŞÜv®
 =ğ
NULL
) {

1114 
cŞÜv®
 = 
	`g_Ãw
(
CŞÜ
, 1);

1115 *
cŞÜv®
 = *
deçuÉv®ue
;

1116 
	`g_hash_bË_š£¹
(
³rsi¡’t_cŞÜs
, 
rŞe
, 
cŞÜv®
);

1118  
cŞÜv®
;

1119 
	}
}

1121 
CŞÜ
 *

1122 
	$³rsi¡’û_g‘_cŞÜ
(
gch¬
 *
rŞe
)

1124 
CŞÜ
 *
cŞÜv®
;

1125 ià(
³rsi¡’t_cŞÜs
 =ğ
NULL
) {

1126 
	`g_w¬nšg
("NØ³rsi¡’ˆcŞÜ tØg‘ fÜ %s!", 
rŞe
);

1129 
cŞÜv®
 = (
CŞÜ
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_cŞÜs
, 
rŞe
);

1130 ià(
cŞÜv®
 !ğ
NULL
)  colorval;

1131 
	`g_w¬nšg
("NØcŞÜØg‘ fÜ %s", 
rŞe
);

1133 
	}
}

1136 
	$³rsi¡’û_£t_cŞÜ
(
gch¬
 *
rŞe
, 
CŞÜ
 *
Ãwv®ue
)

1138 
CŞÜ
 *
cŞÜv®
;

1139 ià(
³rsi¡’t_cŞÜs
 =ğ
NULL
) {

1140 
	`g_w¬nšg
("NØ³rsi¡’ˆcŞÜ y‘ fÜ %s!", 
rŞe
);

1143 
cŞÜv®
 = (
CŞÜ
 *)
	`g_hash_bË_lookup
(
³rsi¡’t_cŞÜs
, 
rŞe
);

1144 ià(
cŞÜv®
 !ğ
NULL
)

1145 *
cŞÜv®
 = *
Ãwv®ue
;

1147 
	`g_w¬nšg
("NØcŞÜØ£ˆfÜ %s", 
rŞe
);

1148 
	}
}

	@O:\tool\dvs50\lib\persistence.h

22 #iâdeà
PERSISTENCE_H


23 
	#PERSISTENCE_H


	)

24 
	~"cÚfig.h
"

25 
	~"geom‘ry.h
"

27 
	~<gtk/gtk.h
>

30 
	mx
, 
	my
;

31 
	mwidth
, 
	mheight
;

32 
gboŞ—n
 
	misİ’
;

33 
GtkWšdow
 *
	mwšdow
;

34 } 
	tP”si¡’tWšdow
;

36 (
	gNuÎ¬yFunc
)();

38 
DIAVAR
 
³rsi¡’û_lßd
();

39 
DIAVAR
 
³rsi¡’û_§ve
();

40 
DIAVAR
 
³rsi¡’û_»gi¡”_wšdow
(
GtkWšdow
 *
wšdow
);

41 
DIAVAR
 
³rsi¡’û_»gi¡”_wšdow_ü—‹
(
gch¬
 *
rŞe
, 
NuÎ¬yFunc
 *
func
);

42 
DIAVAR
 
³rsi¡’û_»gi¡”_¡ršg_’Œy
(
gch¬
 *
rŞe
, 
GtkWidg‘
 *
’Œy
);

43 
DIAVAR
 
gboŞ—n
 
³rsi¡’û_chªge_¡ršg_’Œy
(
gch¬
 *
rŞe
, gch¬ *
¡ršg
,

44 
GtkWidg‘
 *
widg‘
);

53 
	s_P”si¡’tLi¡
 {

54 cÚ¡ 
gch¬
 *
	mrŞe
;

55 
gboŞ—n
 
	msÜ‹d
;

56 
gšt
 
	mmax_memb”s
;

57 
GLi¡
 *
	mgli¡
;

58 
GLi¡
 *
	mli¡’”s
;

59 } 
	tP”si¡’tLi¡
;

61 (*
	tP”si¡’ûC®lback
)(
	tGObjeù
 *, 
	tgpoš‹r
);

63 
DIAVAR
 
P”si¡’tLi¡
 *
	`³rsi¡’û_»gi¡”_li¡
(cÚ¡ 
gch¬
 *
rŞe
);

64 
DIAVAR
 
P”si¡’tLi¡
 *
	`³rsi¡’t_li¡_g‘
(cÚ¡ 
gch¬
 *
rŞe
);

65 
DIAVAR
 
GLi¡
 *
	`³rsi¡’t_li¡_g‘_gli¡
(cÚ¡ 
gch¬
 *
rŞe
);

66 
DIAVAR
 
gboŞ—n
 
	`³rsi¡’t_li¡_add
(cÚ¡ 
gch¬
 *
rŞe
, cÚ¡ gch¬ *
™em
);

67 
DIAVAR
 
	`³rsi¡’t_li¡_£t_max_Ëngth
(cÚ¡ 
gch¬
 *
rŞe
, 
gšt
 
max
);

68 
DIAVAR
 
gboŞ—n
 
	`³rsi¡’t_li¡_»move
(cÚ¡ 
gch¬
 *
rŞe
, cÚ¡ gch¬ *
™em
);

69 
DIAVAR
 
	`³rsi¡’t_li¡_»move_®l
(cÚ¡ 
gch¬
 *
rŞe
);

70 
	`³rsi¡’t_li¡_add_li¡’”
(cÚ¡ 
gch¬
 *
rŞe
, 
P”si¡’ûC®lback
 
func
,

71 
GObjeù
 *
w©ch
, 
gpoš‹r
 
u£rd©a
);

73 
DIAVAR
 
gboŞ—n
 
	`³rsi¡’û_is_»gi¡”ed
(
gch¬
 *
rŞe
);

75 
DIAVAR
 
gšt
 
	`³rsi¡’û_»gi¡”_š‹g”
(
gch¬
 *
rŞe
, 
deçuÉv®ue
);

76 
DIAVAR
 
gšt
 
	`³rsi¡’û_g‘_š‹g”
(
gch¬
 *
rŞe
);

77 
DIAVAR
 
	`³rsi¡’û_£t_š‹g”
(
gch¬
 *
rŞe
, 
gšt
 
Ãwv®ue
);

79 
DIAVAR
 
»®
 
	`³rsi¡’û_»gi¡”_»®
(
gch¬
 *
rŞe
,„—È
deçuÉv®ue
);

80 
DIAVAR
 
»®
 
	`³rsi¡’û_g‘_»®
(
gch¬
 *
rŞe
);

81 
DIAVAR
 
	`³rsi¡’û_£t_»®
(
gch¬
 *
rŞe
, 
»®
 
Ãwv®ue
);

83 
gboŞ—n
 
	`³rsi¡’û_boŞ—n_is_»gi¡”ed
(cÚ¡ 
gch¬
 *
rŞe
);

84 
DIAVAR
 
gboŞ—n
 
	`³rsi¡’û_»gi¡”_boŞ—n
(cÚ¡ 
gch¬
 *
rŞe
, gboŞ—À
deçuÉv®ue
);

85 
gboŞ—n
 
	`³rsi¡’û_g‘_boŞ—n
(cÚ¡ 
gch¬
 *
rŞe
);

86 
DIAVAR
 
	`³rsi¡’û_£t_boŞ—n
(cÚ¡ 
gch¬
 *
rŞe
, 
gboŞ—n
 
Ãwv®ue
);

88 
DIAVAR
 
gch¬
 *
	`³rsi¡’û_»gi¡”_¡ršg
(gch¬ *
rŞe
, gch¬ *
deçuÉv®ue
);

89 
DIAVAR
 
gch¬
 *
	`³rsi¡’û_g‘_¡ršg
(gch¬ *
rŞe
);

90 
DIAVAR
 
	`³rsi¡’û_£t_¡ršg
(
gch¬
 *
rŞe
, cÚ¡ gch¬ *
Ãwv®ue
);

92 
DIAVAR
 
CŞÜ
 *
	`³rsi¡’û_»gi¡”_cŞÜ
(
gch¬
 *
rŞe
, CŞÜ *
deçuÉv®ue
);

93 
CŞÜ
 *
	`³rsi¡’û_g‘_cŞÜ
(
gch¬
 *
rŞe
);

94 
DIAVAR
 
	`³rsi¡’û_£t_cŞÜ
(
gch¬
 *
rŞe
, 
CŞÜ
 *
Ãwv®ue
);

	@O:\tool\dvs50\lib\plug-ins.c

22 
	~<cÚfig.h
>

24 
	~<¡dlib.h
>

25 
	~<¡ršg.h
>

26 
	~<”ºo.h
>

27 
	~<sys/ty³s.h
>

28 
	~<sys/¡©.h
>

29 
	~<fú.h
>

30 #ifdeà
HAVE_UNISTD_H


31 
	~<uni¡d.h
>

34 
	~<libxml/xmlmemÜy.h
>

35 
	~<libxml/·r£r.h
>

36 
	~<libxml/Œ“.h
>

37 
	~"dŸ_xml_libxml.h
"

38 
	~"dŸ_xml.h
"

40 
	~"¶ug-šs.h
"

41 
	~"š.h
"

42 
	~"mes§ge.h
"

43 
	~"dŸ_dœs.h
"

44 
	~"objeù.h
"

46 #ifdeà
G_OS_WIN32


47 
	#ReùªgË
 
Wš32ReùªgË


	)

48 
	#WIN32_LEAN_AND_MEAN


	)

49 
	~<·ngo/·ngowš32.h
>

50 #undeà
ReùªgË


55 
	s_PlugšInfo
 {

56 
GModuË
 *
	mmoduË
;

57 
gch¬
 *
	mf’ame
;

59 
gboŞ—n
 
	mis_lßded
;

60 
gboŞ—n
 
	mšhib™_lßd
;

62 
gch¬
 *
	mÇme
;

63 
gch¬
 *
	mdesütiÚ
;

65 
PlugšIn™Func
 
	mš™_func
;

66 
PlugšCªUÆßdFunc
 
	mÿn_uÆßd_func
;

67 
PlugšUÆßdFunc
 
	muÆßd_func
;

72 
GLi¡
 *
	g¶ugšs
 = 
NULL
;

74 
’su»_¶ugšrc
();

75 
ä“_¶ugšrc
();

76 
gboŞ—n
 
¶ugš_lßd_šhib™ed
(cÚ¡ 
gch¬
 *
f’ame
);

77 
šfo_fl_äom_¶ugšrc
(
PlugšInfo
 *
šfo
);

79 
gboŞ—n


80 
	$dŸ_¶ugš_šfo_š™
(
PlugšInfo
 *
šfo
, 
gch¬
 *
Çme
, gch¬ *
desütiÚ
,

81 
PlugšCªUÆßdFunc
 
ÿn_uÆßd_func
,

82 
PlugšUÆßdFunc
 
uÆßd_func
)

84 
	`g_ä“
(
šfo
->
Çme
);

85 
šfo
->
Çme
 = 
	`g_¡rdup
(name);

86 
	`g_ä“
(
šfo
->
desütiÚ
);

87 
šfo
->
desütiÚ
 = 
	`g_¡rdup
(description);

88 
šfo
->
ÿn_uÆßd_func
 = can_unload_func;

89 
šfo
->
uÆßd_func
 = unload_func;

90  
TRUE
;

91 
	}
}

93 
gch¬
 *

94 
	$dŸ_¶ugš_check_v”siÚ
(
gšt
 
v”siÚ
)

96 ià(
v”siÚ
 !ğ
DIA_PLUGIN_API_VERSION
)

99  
NULL
;

100 
	}
}

105 cÚ¡ 
gch¬
 *

106 
	$dŸ_¶ugš_g‘_f’ame
(
PlugšInfo
 *
šfo
)

108  
šfo
->
f’ame
;

109 
	}
}

111 cÚ¡ 
gch¬
 *

112 
	$dŸ_¶ugš_g‘_Çme
(
PlugšInfo
 *
šfo
)

114  
šfo
->
Çme
 ? info->Çm: 
	`_
("???");

115 
	}
}

117 cÚ¡ 
gch¬
 *

118 
	$dŸ_¶ugš_g‘_desütiÚ
(
PlugšInfo
 *
šfo
)

120  
šfo
->
desütiÚ
;

121 
	}
}

123 cÚ¡ 
gpoš‹r
 *

124 
	$dŸ_¶ugš_g‘_symbŞ
(
PlugšInfo
 *
šfo
, cÚ¡ 
gch¬
* 
Çme
)

126 
gpoš‹r
 
symbŞ
;

128 ià(!
šfo
->
moduË
)

129  
NULL
;

131 ià(
	`g_moduË_symbŞ
 (
šfo
->
moduË
, 
Çme
, &
symbŞ
))

132  
symbŞ
;

134  
NULL
;

135 
	}
}

137 
gboŞ—n


138 
	$dŸ_¶ugš_ÿn_uÆßd
(
PlugšInfo
 *
šfo
)

140  (
šfo
->
ÿn_uÆßd_func
 !ğ
NULL
) && (* info->can_unload_func)(info);

141 
	}
}

143 
gboŞ—n


144 
	$dŸ_¶ugš_is_lßded
(
PlugšInfo
 *
šfo
)

146  
šfo
->
is_lßded
;

147 
	}
}

149 
gboŞ—n


150 
	$dŸ_¶ugš_g‘_šhib™_lßd
(
PlugšInfo
 *
šfo
)

152  
šfo
->
šhib™_lßd
;

153 
	}
}

156 
	$dŸ_¶ugš_£t_šhib™_lßd
(
PlugšInfo
 *
šfo
, 
gboŞ—n
 
šhib™_lßd
)

158 
šfo
->
šhib™_lßd
 = inhibit_load;

159 
	}
}

162 
	$dŸ_¶ugš_lßd
(
PlugšInfo
 *
šfo
)

164 #ifdeà
G_OS_WIN32


165 
gušt
 
”rÜ_mode
;

167 
	`g_»tuº_if_ç
(
šfo
 !ğ
NULL
);

168 
	`g_»tuº_if_ç
(
šfo
->
f’ame
 !ğ
NULL
);

170 ià(
šfo
->
is_lßded
)

173 #ifdeà
G_OS_WIN32


175 
”rÜ_mode
 = 
	`S‘E¼ÜMode
 (
SEM_FAILCRITICALERRORS
|
SEM_NOOPENFILEERRORBOX
);

178 
	`dŸ_log_mes§ge
 ("¶ug-š '%s'", 
šfo
->
f’ame
);

179 
šfo
->
moduË
 = 
	`g_moduË_İ’
(šfo->
f’ame
, 
G_MODULE_BIND_LAZY
);

180 #ifdeà
G_OS_WIN32


181 
	`S‘E¼ÜMode
 (
”rÜ_mode
);

183 ià(!
šfo
->
moduË
) {

184 
gch¬
 *
msg_utf8
 = 
NULL
;

186 ià(!
	`g_fe_‹¡
(
šfo
->
f’ame
, 
G_FILE_TEST_EXISTS
))

187 
msg_utf8
 = 
	`g_loÿË_to_utf8
 (
	`g_moduË_”rÜ
(), -1, 
NULL
, NULL, NULL);

189 
msg_utf8
 = 
	`g_¡rdup_´štf
 (
	`_
("Missšg d•’d’c› fÜ '%s'?"), 
šfo
->
f’ame
);

191 
šfo
->
desütiÚ
 = 
msg_utf8
;

194 
šfo
->
š™_func
 = 
NULL
;

196 ià(!
	`g_moduË_symbŞ
(
šfo
->
moduË
, "dia_plugin_init",

197 (
gpoš‹r
)&
šfo
->
š™_func
)) {

198 
	`g_moduË_şo£
(
šfo
->
moduË
);

199 
šfo
->
moduË
 = 
NULL
;

200 
šfo
->
desütiÚ
 = 
	`g_¡rdup
(
	`_
("Missing symbol 'dia_plugin_init'"));

205 ià((* 
šfo
->
š™_func
)(šfoè!ğ
DIA_PLUGIN_INIT_OK
) {

207 
	`g_moduË_şo£
(
šfo
->
moduË
);

208 
šfo
->
moduË
 = 
NULL
;

209 
šfo
->
desütiÚ
 = 
	`g_¡rdup
(
	`_
("dia_plugin_init() call failed"));

214 ià(
šfo
->
desütiÚ
 =ğ
NULL
) {

215 
	`g_moduË_şo£
(
šfo
->
moduË
);

216 
šfo
->
moduË
 = 
NULL
;

217 
šfo
->
desütiÚ
 = 
	`g_¡rdup
(
	`_
("dia_plugin_init() call failed"));

221 
šfo
->
is_lßded
 = 
TRUE
;

224 
	}
}

227 
	$dŸ_¶ugš_uÆßd
(
PlugšInfo
 *
šfo
)

229 
	`g_»tuº_if_ç
(
šfo
 !ğ
NULL
);

230 
	`g_»tuº_if_ç
(
šfo
->
f’ame
 !ğ
NULL
);

232 ià(!
šfo
->
is_lßded
)

235 ià(!
	`dŸ_¶ugš_ÿn_uÆßd
(
šfo
)) {

236 
	`mes§ge
(
	`_
("% Plugš could‚Ù buÆßded"), 
šfo
->
Çme
);

240 ià(
šfo
->
uÆßd_func
)

241 (* 
šfo
->
uÆßd_func
)(info);

242 
	`g_moduË_şo£
(
šfo
->
moduË
);

243 
šfo
->
moduË
 = 
NULL
;

244 
šfo
->
š™_func
 = 
NULL
;

245 
šfo
->
ÿn_uÆßd_func
 = 
NULL
;

246 
šfo
->
uÆßd_func
 = 
NULL
;

248 
šfo
->
is_lßded
 = 
FALSE
;

249 
	}
}

252 
	$dŸ_»gi¡”_¶ugš
(cÚ¡ 
gch¬
 *
f’ame
)

254 
GLi¡
 *
tmp
;

255 
PlugšInfo
 *
šfo
;

258 
tmp
 = 
¶ugšs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

259 
šfo
 = 
tmp
->
d©a
;

260 ià(!
	`¡rcmp
(
šfo
->
f’ame
, filename))

265 ià(
	`¡r¡r
(
f’ame
, "libdia.")) {

270 
šfo
 = 
	`g_Ãw0
(
PlugšInfo
, 1);

271 
šfo
->
f’ame
 = 
	`g_¡rdup
(filename);

272 
šfo
->
is_lßded
 = 
FALSE
;

273 
šfo
->
šhib™_lßd
 = 
FALSE
;

277 ià(
	`¶ugš_lßd_šhib™ed
(
f’ame
))

278 
	`šfo_fl_äom_¶ugšrc
(
šfo
);

280 
	`dŸ_¶ugš_lßd
(
šfo
);

282 
¶ugšs
 = 
	`g_li¡_´•’d
Õlugšs, 
šfo
);

283 #ifdeà
DEBUG


284 
tmp
 = 
¶ugšs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

285 
šfo
 = 
tmp
->
d©a
;

288 
	}
}

290 
gboŞ—n


291 
	$this_is_a_¶ugš
(cÚ¡ 
gch¬
 *
Çme
)

293  
	`g_¡r_has_suffix
(
Çme
, 
G_MODULE_SUFFIX
);

294 
	}
}

296 
gboŞ—n


297 
	$this_is_a_¡ruù
(cÚ¡ 
gch¬
 *
Çme
)

299 
gch¬
 *
suffix_off£t
 = 
	`g_utf8_¡¼chr
(
Çme
, -1, (
gunich¬
)'.');

300 
gboŞ—n
 
»t
 = !
	`g_ascii_¡ºÿ£cmp
(
suffix_off£t
,".¡ruù",
	`¡¾’
(suffix_offset));

302  
»t
;

303 
	}
}

308 
	$fÜ_—ch_š_dœ
(cÚ¡ 
gch¬
 *
dœeùÜy
, 
FÜEachInDœDoFunc
 
dofunc
,

309 
FÜEachInDœF‹rFunc
 
f‹r
)

311 
¡©
 
¡©buf
;

312 cÚ¡ *
d’Œy
;

313 
GDœ
 *
dp
;

314 
GE¼Ü
 *
”rÜ
 = 
NULL
;

316 iàĞ
	`¡©
(
dœeùÜy
, &
¡©buf
) < 0)

319 
dp
 = 
	`g_dœ_İ’
(
dœeùÜy
, 0, &
”rÜ
);

320 ià(
dp
 =ğ
NULL
) {

321 
	`mes§ge_w¬nšg
(
	`_
("Could‚Ù o³À`%s'\n`%s'"), 
dœeùÜy
, 
”rÜ
->
mes§ge
);

322 
	`g_”rÜ_ä“
 (
”rÜ
);

326 (
d’Œy
 = 
	`g_dœ_»ad_Çme
(
dp
)è!ğ
NULL
) {

327 
gch¬
 *
Çme
 = 
	`g_¡rcÚÿt
(
dœeùÜy
,
G_DIR_SEPARATOR_S
,
d’Œy
,
NULL
);

329 ià(
	`f‹r
(
Çme
))

330 
	`dofunc
(
Çme
);

331 
	`g_ä“
(
Çme
);

333 
	`g_dœ_şo£
(
dp
);

334 
	}
}

336 
gboŞ—n


337 
	$dœeùÜy_f‹r
(cÚ¡ 
gch¬
 *
Çme
)

339 
gušt
 
Ën
 = 
	`¡¾’
(
Çme
);

341 ià(0 =ğ
	`¡rcmp
(
G_DIR_SEPARATOR_S
 ".",

342 &
Çme
[
Ën
-
	`¡¾’
(
G_DIR_SEPARATOR_S
 ".")])è 
FALSE
;

343 ià(0 =ğ
	`¡rcmp
(
G_DIR_SEPARATOR_S
 "..",

344 &
Çme
[
Ën
-
	`¡¾’
(
G_DIR_SEPARATOR_S
 "..")])è 
FALSE
;

346 ià(!
	`g_fe_‹¡
 (
Çme
, 
G_FILE_TEST_IS_DIR
))

347  
FALSE
;

349  
TRUE
;

350 
	}
}

352 
gboŞ—n


353 
	$dŸ_¶ugš_f‹r
(cÚ¡ 
gch¬
 *
Çme
)

355 ià(!
	`g_fe_‹¡
 (
Çme
, 
G_FILE_TEST_IS_REGULAR
 | 
G_FILE_TEST_IS_DIR
))

356  
FALSE
;

358  
	`this_is_a_¶ugš
(
Çme
);

359 
	}
}

362 
	$w®k_dœs_fÜ_¶ugšs
(cÚ¡ 
gch¬
 *
dœÇme
)

364 
	`fÜ_—ch_š_dœ
(
dœÇme
,
w®k_dœs_fÜ_¶ugšs
,
dœeùÜy_f‹r
);

365 
	`fÜ_—ch_š_dœ
(
dœÇme
,
dŸ_»gi¡”_¶ugš
,
dŸ_¶ugš_f‹r
);

366 
	}
}

368 
	#RECURSE
 (
G_DIR_SEPARATOR_S
 G_DIR_SEPARATOR_S)

	)

371 
	$dŸ_»gi¡”_¶ugšs_š_dœ
(cÚ¡ 
gch¬
 *
dœeùÜy
)

373 
gušt
 
»ş’
 = 
	`¡¾’
(
RECURSE
);

374 
gušt
 
Ën
 = 
	`¡¾’
(
dœeùÜy
);

376 ià((
Ën
 >ğ
»ş’
) &&

377 (0 =ğ
	`¡rcmp
(&
dœeùÜy
[
Ën
-
»ş’
],
RECURSE
))) {

378 
gch¬
 *
dœba£
 = 
	`g_¡ºdup
(
dœeùÜy
,
Ën
-
»ş’
);

379 
	`fÜ_—ch_š_dœ
(
dœba£
,
w®k_dœs_fÜ_¶ugšs
,
dœeùÜy_f‹r
);

380 
	`g_ä“
(
dœba£
);

383 
	`fÜ_—ch_š_dœ
(
dœeùÜy
,
dŸ_»gi¡”_¶ugš
,
dŸ_¶ugš_f‹r
);

384 
	}
}

387 
	$dŸ_»gi¡”_¶ugšs
()

389 cÚ¡ 
gch¬
 *
lib¿ry_·th
;

395 
lib¿ry_·th
 = 
NULL
;

405 ià(
lib¿ry_·th
 !ğ
NULL
) {

410 cÚ¡ 
Ën
 = 
	`¡¾’
(
lib¿ry_·th
);

411 
ext
[] = "\\dia\0";

412 
gch¬
* 
Ãwdœ
 = 
	`g_Ãw
(,
Ën
+
	`¡¾’
(
ext
)+1);

413 
	`¡ºıy
(
Ãwdœ
,
lib¿ry_·th
,
Ën
);

414 
	`¡ºıy
(&
Ãwdœ
[
Ën
],
ext
,
	`¡¾’
(ext));

415 
	`dŸ_»gi¡”_¶ugšs_š_dœ
(
Ãwdœ
);

416 
	`g_ä“
(
Ãwdœ
);

417 
	`g_ä“
(
lib¿ry_·th
);

421 
lib¿ry_·th
 = 
	`dŸ_g‘_lib_dœeùÜy
("dia");

423 
	`dŸ_»gi¡”_¶ugšs_š_dœ
(
lib¿ry_·th
);

424 
	`g_ä“
((*)
lib¿ry_·th
);

427 
	`ä“_¶ugšrc
();

428 
	}
}

431 
	$dŸ_»gi¡”_butš_¶ugš
(
PlugšIn™Func
 
š™_func
)

433 
PlugšInfo
 *
šfo
;

435 
šfo
 = 
	`g_Ãw0
(
PlugšInfo
, 1);

436 
šfo
->
f’ame
 = "<builtin>";

437 
šfo
->
is_lßded
 = 
TRUE
;

438 
šfo
->
šhib™_lßd
 = 
FALSE
;

440 
šfo
->
š™_func
 = init_func;

442 ià((* 
š™_func
)(
šfo
è!ğ
DIA_PLUGIN_INIT_OK
) {

443 
	`g_ä“
(
šfo
);

446 
¶ugšs
 = 
	`g_li¡_´•’d
Õlugšs, 
šfo
);

447 
	}
}

450 
GLi¡
 *

451 
	$dŸ_li¡_¶ugšs
()

453  
¶ugšs
;

454 
	}
}

456 
xmlDocPŒ
 
	g¶ugšrc
 = 
NULL
;

468 
	$’su»_¶ugšrc
()

470 
gch¬
 *
f’ame
;

472 ià(
¶ugšrc
)

474 
f’ame
 = 
	`dŸ_cÚfig_f’ame
("pluginrc");

475 ià(
	`g_fe_‹¡
 (
f’ame
, 
G_FILE_TEST_IS_REGULAR
))

476 
¶ugšrc
 = 
	`xmlDŸP¬£Fe
(
f’ame
);

478 
¶ugšrc
 = 
NULL
;

480 
	`g_ä“
(
f’ame
);

482 ià(!
¶ugšrc
) {

483 
¶ugšrc
 = 
	`xmlNewDoc
((cÚ¡ 
xmlCh¬
 *)"1.0");

484 
¶ugšrc
->
’codšg
 = 
	`xmlSŒdup
((cÚ¡ 
xmlCh¬
 *)"UTF-8");

486 
	`xmlDocS‘RoÙEËm’t
(
¶ugšrc
,

487 
	`xmlNewDocNode
(
¶ugšrc
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"plugins", NULL));

489 
	}
}

492 
	$ä“_¶ugšrc
()

494 ià(
¶ugšrc
) {

495 
	`xmlF»eDoc
(
¶ugšrc
);

496 
¶ugšrc
 = 
NULL
;

498 
	}
}

501 
gboŞ—n


502 
	$¶ugš_lßd_šhib™ed
(cÚ¡ 
gch¬
 *
f’ame
)

504 
xmlNodePŒ
 
node
;

506 
	`’su»_¶ugšrc
();

507 
node
 = 
¶ugšrc
->
xmlRoÙNode
->
xmlChd»nNode
;

508 
node
 !ğ
NULL
;

509 
node
 =‚ode->
Ãxt
) {

510 
xmlCh¬
 *
node_f’ame
;

512 ià(
	`xmlIsBÏnkNode
(
node
)) ;

514 ià(
node
->
ty³
 !ğ
XML_ELEMENT_NODE
 || 
	`xmlSŒcmp
Òode->
Çme
, (cÚ¡ 
xmlCh¬
 *)"plugin") != 0)

516 
node_f’ame
 = 
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"filename");

517 ià(
node_f’ame
 && !
	`¡rcmp
(
f’ame
, (
gch¬
 *)node_filename)) {

518 
xmlNodePŒ
 
node2
;

520 
	`xmlF»e
(
node_f’ame
);

521 
node2
 = 
node
->
xmlChd»nNode
;

522 
node2
 !ğ
NULL
;

523 
node2
 =‚ode2->
Ãxt
) {

524 ià(
	`xmlIsBÏnkNode
(
node2
)) ;

525 ià(
node2
->
ty³
 =ğ
XML_ELEMENT_NODE
 &&

526 !
	`xmlSŒcmp
(
node2
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"inhibit-load"))

527  
TRUE
;

529  
FALSE
;

531 ià(
node_f’ame
è
	`xmlF»e
(node_filename);

533  
FALSE
;

534 
	}
}

537 
	$šfo_fl_äom_¶ugšrc
(
PlugšInfo
 *
šfo
)

539 
xmlNodePŒ
 
node
;

541 
šfo
->
moduË
 = 
NULL
;

542 
šfo
->
Çme
 = 
NULL
;

543 
šfo
->
desütiÚ
 = 
NULL
;

544 
šfo
->
is_lßded
 = 
FALSE
;

545 
šfo
->
šhib™_lßd
 = 
TRUE
;

546 
šfo
->
š™_func
 = 
NULL
;

547 
šfo
->
ÿn_uÆßd_func
 = 
NULL
;

548 
šfo
->
uÆßd_func
 = 
NULL
;

550 
	`’su»_¶ugšrc
();

551 
node
 = 
¶ugšrc
->
xmlRoÙNode
->
xmlChd»nNode
;

552 
node
 !ğ
NULL
;

553 
node
 =‚ode->
Ãxt
) {

554 
xmlCh¬
 *
node_f’ame
;

556 ià(
	`xmlIsBÏnkNode
(
node
)) ;

558 ià(
node
->
ty³
 !ğ
XML_ELEMENT_NODE
 || 
	`xmlSŒcmp
Òode->
Çme
, (cÚ¡ 
xmlCh¬
 *)"plugin") != 0)

560 
node_f’ame
 = 
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"filename");

561 ià(
node_f’ame
 && !
	`¡rcmp
(
šfo
->
f’ame
, (*)‚ode_filename)) {

562 
xmlNodePŒ
 
node2
;

564 
	`xmlF»e
(
node_f’ame
);

565 
node2
 = 
node
->
xmlChd»nNode
;

566 
node2
 !ğ
NULL
;

567 
node2
 =‚ode2->
Ãxt
) {

568 
gch¬
 *
cÚ‹Á
;

570 ià(
	`xmlIsBÏnkNode
(
node2
)) ;

572 ià(
node2
->
ty³
 !ğ
XML_ELEMENT_NODE
)

574 
cÚ‹Á
 = (
gch¬
 *)
	`xmlNodeG‘CÚ‹Á
(
node2
);

575 ià(!
	`xmlSŒcmp
(
node2
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"name")) {

576 
	`g_ä“
(
šfo
->
Çme
);

577 
šfo
->
Çme
 = 
	`g_¡rdup
(
cÚ‹Á
);

578 } ià(!
	`xmlSŒcmp
(
node2
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"description")) {

579 
	`g_ä“
(
šfo
->
desütiÚ
);

580 
šfo
->
desütiÚ
 = 
	`g_¡rdup
(
cÚ‹Á
);

582 
	`xmlF»e
(
cÚ‹Á
);

586 ià(
node_f’ame
è
	`xmlF»e
(node_filename);

588 
	}
}

591 
	$dŸ_¶ugšrc_wr™e
()

593 
gch¬
 *
f’ame
;

594 
GLi¡
 *
tmp
;

596 
	`’su»_¶ugšrc
();

597 
tmp
 = 
¶ugšs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

598 
PlugšInfo
 *
šfo
 = 
tmp
->
d©a
;

599 
xmlNodePŒ
 
node
, 
¶ugšnode
, 
d©ªode
;

601 ià(
šfo
 =ğ
NULL
) {

605 
¶ugšnode
 = 
	`xmlNewNode
(
NULL
, (cÚ¡ 
xmlCh¬
 *)"plugin");

606 
d©ªode
 = 
	`xmlNewChd
(
¶ugšnode
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
šfo
->
Çme
);

609 
xmlCh¬
 *
’c
 = 
	`xmlEncodeEÁ™›sR“Á¿Á
(
¶ugšnode
->
doc
,

610 (
xmlCh¬
 *)
šfo
->
desütiÚ
);

611 
d©ªode
 = 
	`xmlNewChd
(
¶ugšnode
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"desütiÚ", 
’c
);

612 
	`xmlF»e
(
’c
);

614 ià(
šfo
->
šhib™_lßd
)

615 
d©ªode
 = 
	`xmlNewChd
(
¶ugšnode
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"inhibit-load", NULL);

617 
node
 = 
¶ugšrc
->
xmlRoÙNode
->
xmlChd»nNode
;

618 
node
 !ğ
NULL
;

619 
node
 =‚ode->
Ãxt
) {

620 
xmlCh¬
 *
node_f’ame
;

622 ià(
	`xmlIsBÏnkNode
(
node
)) ;

624 ià(
node
->
ty³
 !ğ
XML_ELEMENT_NODE
 || 
	`xmlSŒcmp
Òode->
Çme
, (cÚ¡ 
xmlCh¬
 *)"plugin") != 0)

626 
node_f’ame
 = 
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"filename");

627 ià(
node_f’ame
 && !
	`¡rcmp
(
šfo
->
f’ame
, (*)‚ode_filename)) {

628 
	`xmlF»e
(
node_f’ame
);

629 
	`xmlR•ÏûNode
(
node
, 
¶ugšnode
);

630 
	`xmlF»eNode
(
node
);

633 ià(
node_f’ame
è
	`xmlF»e
(node_filename);

636 ià(!
node
)

637 
	`xmlAddChd
(
¶ugšrc
->
xmlRoÙNode
, 
¶ugšnode
);

639 
	`xmlS‘Prİ
(
¶ugšnode
, (cÚ¡ 
xmlCh¬
 *)"f’ame", (xmlCh¬ *)
šfo
->
f’ame
);

642 
f’ame
 = 
	`dŸ_cÚfig_f’ame
("pluginrc");

644 
	`xmlDŸSaveFe
(
f’ame
,
¶ugšrc
);

646 
	`g_ä“
(
f’ame
);

647 
	`ä“_¶ugšrc
();

648 
	}
}

	@O:\tool\dvs50\lib\plug-ins.h

22 #iâdeà
PLUG_INS_H


23 
	#PLUG_INS_H


	)

25 
	~<glib.h
>

26 
	~<gmoduË.h
>

27 
	~"dŸty³s.h
"

30 
	gG_BEGIN_DECLS


53 
	#DIA_PLUGIN_API_VERSION
 13

	)

56 
	mDIA_PLUGIN_INIT_OK
,

57 
	mDIA_PLUGIN_INIT_ERROR


58 } 
	tPlugšIn™ResuÉ
;

60 
	$PlugšIn™ResuÉ
 (*
	tPlugšIn™Func
è(
	tPlugšInfo
 *
	tšfo
);

61 
	$gboŞ—n
 (*
	tPlugšCªUÆßdFunc
è(
	tPlugšInfo
 *
	tšfo
);

62 (*
	tPlugšUÆßdFunc
è(
	tPlugšInfo
 *
	tšfo
);

66 
DIAVAR
 
gboŞ—n
 
	`dŸ_¶ugš_šfo_š™
(
PlugšInfo
 *
šfo
, 
gch¬
 *
Çme
,

67 
gch¬
 *
desütiÚ
,

68 
PlugšCªUÆßdFunc
 
ÿn_uÆßd_func
,

69 
PlugšUÆßdFunc
 
uÆßd_func
);

71 
DIAVAR
 
gch¬
 *
	`dŸ_¶ugš_check_v”siÚ
(
gšt
 
v”siÚ
);

75 
DIAVAR
 cÚ¡ 
gch¬
 *
	`dŸ_¶ugš_g‘_f’ame
 (
PlugšInfo
 *
šfo
);

76 
DIAVAR
 cÚ¡ 
gch¬
 *
	`dŸ_¶ugš_g‘_Çme
 (
PlugšInfo
 *
šfo
);

77 
DIAVAR
 cÚ¡ 
gch¬
 *
	`dŸ_¶ugš_g‘_desütiÚ
 (
PlugšInfo
 *
šfo
);

78 
DIAVAR
 cÚ¡ 
gpoš‹r
 *
	`dŸ_¶ugš_g‘_symbŞ
 (
PlugšInfo
 *
šfo
, cÚ¡ 
gch¬
 *
Çme
);

80 
DIAVAR
 
gboŞ—n
 
	`dŸ_¶ugš_ÿn_uÆßd
 (
PlugšInfo
 *
šfo
);

81 
DIAVAR
 
gboŞ—n
 
	`dŸ_¶ugš_is_lßded
 (
PlugšInfo
 *
šfo
);

82 
DIAVAR
 
gboŞ—n
 
	`dŸ_¶ugš_g‘_šhib™_lßd
 (
PlugšInfo
 *
šfo
);

83 
DIAVAR
 
	`dŸ_¶ugš_£t_šhib™_lßd
 (
PlugšInfo
 *
šfo
, 
gboŞ—n
 
šhib™_lßd
);

85 
DIAVAR
 
	`dŸ_¶ugš_lßd
 (
PlugšInfo
 *
šfo
);

86 
DIAVAR
 
	`dŸ_¶ugš_uÆßd
 (
PlugšInfo
 *
šfo
);

88 
DIAVAR
 
	`dŸ_»gi¡”_¶ugš
 (cÚ¡ 
gch¬
 *
f’ame
);

89 
DIAVAR
 
	`dŸ_»gi¡”_¶ugšs_š_dœ
 (cÚ¡ 
gch¬
 *
dœeùÜy
);

90 
DIAVAR
 
	`dŸ_»gi¡”_¶ugšs
 ();

91 
DIAVAR
 
	`dŸ_»gi¡”_butš_¶ugš
 (
PlugšIn™Func
 
š™_func
);

93 
DIAVAR
 
GLi¡
 *
	`dŸ_li¡_¶ugšs
();

95 
DIAVAR
 
	`dŸ_¶ugšrc_wr™e
();

96 (*
	tFÜEachInDœDoFunc
)(cÚ¡ 
	tgch¬
 *
	tÇme
);

97 
	$gboŞ—n
 (*
	tFÜEachInDœF‹rFunc
)(cÚ¡ 
	tgch¬
 *
	tÇme
);

99 
gboŞ—n
 
	`this_is_a_¡ruù
(cÚ¡ 
gch¬
 *
Çme
);

100 
	`fÜ_—ch_š_dœ
(cÚ¡ 
gch¬
 *
dœeùÜy
, 
FÜEachInDœDoFunc
 
dofunc
,

101 
FÜEachInDœF‹rFunc
 
f‹r
);

105 
	#DIA_PLUGIN_CHECK_INIT
 \

106 
G_MODULE_EXPORT
 cÚ¡ 
gch¬
 *
	`g_moduË_check_š™
(
GModuË
 *
gmoduË
); \

107 cÚ¡ 
gch¬
 * \

108 
	`g_moduË_check_š™
(
GModuË
 *
gmoduË
) \

110  
	`dŸ_¶ugš_check_v”siÚ
(
DIA_PLUGIN_API_VERSION
); \

111 
	}

	)
}

114 
G_MODULE_EXPORT
 
PlugšIn™ResuÉ
 
dŸ_¶ugš_š™
(
PlugšInfo
 *
šfo
);

116 
	gG_END_DECLS


	@O:\tool\dvs50\lib\poly_conn.c

19 
	~<cÚfig.h
>

21 
	~<¡dio.h
>

22 
	~<¡dlib.h
>

23 
	~<as£¹.h
>

24 
	~<m©h.h
>

25 
	~<¡ršg.h
>

27 
	~"pŞy_cÚn.h
"

28 
	~"mes§ge.h
"

29 
	~"dŸ»nd””.h
"

31 
	echªge_ty³
 {

32 
	mTYPE_ADD_POINT
,

33 
	mTYPE_REMOVE_POINT


36 
	sPoštChªge
 {

37 
ObjeùChªge
 
	mobj_chªge
;

39 
chªge_ty³
 
	mty³
;

40 
	m­¶›d
;

42 
Pošt
 
	mpošt
;

43 
	mpos
;

45 
HªdË
 *
	mhªdË
;

47 
CÚÃùiÚPošt
 *
	mcÚÃùed_to
;

50 
ObjeùChªge
 *

51 
pŞycÚn_ü—‹_chªge
(
PŞyCÚn
 *
pŞy
, 
chªge_ty³
 
ty³
,

52 
Pošt
 *
pošt
, 
£gm’t
, 
HªdË
 *
hªdË
,

53 
CÚÃùiÚPošt
 *
cÚÃùed_to
);

57 
	mPC_HANDLE_START
,

58 
	mPC_HANDLE_CORNER
,

59 
	mPC_HANDLE_END


60 } 
	tPŞyCÚnHªdËTy³
;

63 
	$£tup_hªdË
(
HªdË
 *
hªdË
, 
PŞyCÚnHªdËTy³
 
t
)

65 
hªdË
->
id
 = (
PC_HANDLE_CORNER
 =ğ
t
 ? 
HANDLE_CORNER


66 : (
PC_HANDLE_END
 =ğ
t
 ? 
HANDLE_MOVE_ENDPOINT


67 : 
HANDLE_MOVE_STARTPOINT
));

68 
hªdË
->
ty³
 = (
PC_HANDLE_CORNER
 =ğ
t
 ? 
HANDLE_MINOR_CONTROL
 : 
HANDLE_MAJOR_CONTROL
);

69 
hªdË
->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

70 
hªdË
->
cÚÃùed_to
 = 
NULL
;

71 
	}
}

74 
	$g‘_hªdË_Ä
(
PŞyCÚn
 *
pŞy
, 
HªdË
 *
hªdË
)

76 
i
 = 0;

77 
i
=0;i<
pŞy
->
numpošts
;i++) {

78 ià(
pŞy
->
objeù
.
hªdËs
[
i
] =ğ
hªdË
)

79  
i
;

82 
	}
}

84 
ObjeùChªge
 *

85 
	$pŞycÚn_move_hªdË
(
PŞyCÚn
 *
pŞy
, 
HªdË
 *
hªdË
,

86 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

87 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

89 
hªdË_Ä
;

91 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
pŞy
, 
hªdË
);

92 
hªdË
->
id
) {

93 
HANDLE_MOVE_STARTPOINT
:

94 
pŞy
->
pošts
[0] = *
to
;

96 
HANDLE_MOVE_ENDPOINT
:

97 
pŞy
->
pošts
[pŞy->
numpošts
-1] = *
to
;

99 
HANDLE_CORNER
:

100 
pŞy
->
pošts
[
hªdË_Ä
] = *
to
;

103 
	`mes§ge_”rÜ
("Internalƒrror in…olyconn_move_handle.\n");

107  
NULL
;

108 
	}
}

110 
ObjeùChªge
*

111 
	$pŞycÚn_move
(
PŞyCÚn
 *
pŞy
, 
Pošt
 *
to
)

113 
Pošt
 
p
;

114 
i
;

116 
p
 = *
to
;

117 
	`pošt_sub
(&
p
, &
pŞy
->
pošts
[0]);

119 
pŞy
->
pošts
[0] = *
to
;

120 
i
=1;i<
pŞy
->
numpošts
;i++) {

121 
	`pošt_add
(&
pŞy
->
pošts
[
i
], &
p
);

124  
NULL
;

125 
	}
}

128 
	$pŞycÚn_şo£¡_£gm’t
(
PŞyCÚn
 *
pŞy
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

130 
i
;

131 
»®
 
di¡
;

132 
şo£¡
;

134 
di¡
 = 
	`di¡ªû_lše_pošt
Ğ&
pŞy
->
pošts
[0], &poly->points[1],

135 
lše_width
, 
pošt
);

136 
şo£¡
 = 0;

137 
i
=1;i<
pŞy
->
numpošts
-1;i++) {

138 
»®
 
Ãw_di¡
 =

139 
	`di¡ªû_lše_pošt
Ğ&
pŞy
->
pošts
[
i
], &poly->points[i+1],

140 
lše_width
, 
pošt
);

141 ià(
Ãw_di¡
 < 
di¡
) {

142 
di¡
 = 
Ãw_di¡
;

143 
şo£¡
 = 
i
;

146  
şo£¡
;

147 
	}
}

149 
HªdË
 *

150 
	$pŞycÚn_şo£¡_hªdË
(
PŞyCÚn
 *
pŞy
, 
Pošt
 *
pošt
)

152 
i
;

153 
»®
 
di¡
;

154 
HªdË
 *
şo£¡
;

156 
şo£¡
 = 
pŞy
->
objeù
.
hªdËs
[0];

157 
di¡
 = 
	`di¡ªû_pošt_pošt
Ğ
pošt
, &
şo£¡
->
pos
);

158 
i
=1;i<
pŞy
->
numpošts
;i++) {

159 
»®
 
Ãw_di¡
;

160 
Ãw_di¡
 = 
	`di¡ªû_pošt_pošt
Ğ
pošt
, &
pŞy
->
pošts
[
i
]);

161 ià(
Ãw_di¡
 < 
di¡
) {

162 
di¡
 = 
Ãw_di¡
;

163 
şo£¡
 = 
pŞy
->
objeù
.
hªdËs
[
i
];

166  
şo£¡
;

167 
	}
}

169 
»®


170 
	$pŞycÚn_di¡ªû_äom
(
PŞyCÚn
 *
pŞy
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

172 
i
;

173 
»®
 
di¡
;

175 
di¡
 = 
	`di¡ªû_lše_pošt
Ğ&
pŞy
->
pošts
[0], &poly->points[1],

176 
lše_width
, 
pošt
);

177 
i
=1;i<
pŞy
->
numpošts
-1;i++) {

178 
di¡
 = 
	`MIN
(dist,

179 
	`di¡ªû_lše_pošt
Ğ&
pŞy
->
pošts
[
i
], &poly->points[i+1],

180 
lše_width
, 
pošt
));

182  
di¡
;

183 
	}
}

186 
	$add_hªdË
(
PŞyCÚn
 *
pŞy
, 
pos
, 
Pošt
 *
pošt
, 
HªdË
 *
hªdË
)

188 
i
;

189 
DŸObjeù
 *
obj
;

191 
pŞy
->
numpošts
++;

192 
pŞy
->
pošts
 = 
	`g_»®loc
ÕŞy->pošts,…Şy->
numpošts
*(
Pošt
));

194 
i
=
pŞy
->
numpošts
-1; i > 
pos
; i--) {

195 
pŞy
->
pošts
[
i
] =…oly->points[i-1];

197 
pŞy
->
pošts
[
pos
] = *
pošt
;

198 
	`objeù_add_hªdË_©
((
DŸObjeù
*)
pŞy
, 
hªdË
, 
pos
);

200 
obj
 = (
DŸObjeù
 *)
pŞy
;

201 ià(
pos
==0) {

202 
obj
->
hªdËs
[1]->
ty³
 = 
HANDLE_MINOR_CONTROL
;

203 
obj
->
hªdËs
[1]->
id
 = 
HANDLE_CORNER
;

205 ià(
pos
==
obj
->
num_hªdËs
-1) {

206 
obj
->
hªdËs
[obj->
num_hªdËs
-2]->
ty³
 = 
HANDLE_MINOR_CONTROL
;

207 
obj
->
hªdËs
[obj->
num_hªdËs
-2]->
id
 = 
HANDLE_CORNER
;

209 
	}
}

212 
	$»move_hªdË
(
PŞyCÚn
 *
pŞy
, 
pos
)

214 
i
;

215 
DŸObjeù
 *
obj
;

216 
HªdË
 *
Şd_hªdË
;

218 
obj
 = (
DŸObjeù
 *)
pŞy
;

220 ià(
pos
==0) {

221 
obj
->
hªdËs
[1]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

222 
obj
->
hªdËs
[1]->
id
 = 
HANDLE_MOVE_STARTPOINT
;

224 ià(
pos
==
obj
->
num_hªdËs
-1) {

225 
obj
->
hªdËs
[obj->
num_hªdËs
-2]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

226 
obj
->
hªdËs
[obj->
num_hªdËs
-2]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

230 
pŞy
->
numpošts
--;

231 
i
=
pos
; i < 
pŞy
->
numpošts
; i++) {

232 
pŞy
->
pošts
[
i
] =…oly->points[i+1];

234 
pŞy
->
pošts
 = 
	`g_»®loc
ÕŞy->pošts,…Şy->
numpošts
*(
Pošt
));

236 
Şd_hªdË
 = 
obj
->
hªdËs
[
pos
];

237 
	`objeù_»move_hªdË
(&
pŞy
->
objeù
, 
Şd_hªdË
);

238 
	}
}

243 
ObjeùChªge
 *

244 
	$pŞycÚn_add_pošt
(
PŞyCÚn
 *
pŞy
, 
£gm’t
, 
Pošt
 *
pošt
)

246 
Pošt
 
»®pošt
;

247 
HªdË
 *
Ãw_hªdË
;

249 ià(
pošt
 =ğ
NULL
) {

250 
»®pošt
.
x
 = (
pŞy
->
pošts
[
£gm’t
].x+poly->points[segment+1].x)/2;

251 
»®pošt
.
y
 = (
pŞy
->
pošts
[
£gm’t
].y+poly->points[segment+1].y)/2;

253 
»®pošt
 = *
pošt
;

256 
Ãw_hªdË
 = 
	`g_m®loc
((
HªdË
));

257 
	`£tup_hªdË
(
Ãw_hªdË
, 
PC_HANDLE_CORNER
);

258 
	`add_hªdË
(
pŞy
, 
£gm’t
+1, &
»®pošt
, 
Ãw_hªdË
);

259  
	`pŞycÚn_ü—‹_chªge
(
pŞy
, 
TYPE_ADD_POINT
,

260 &
»®pošt
, 
£gm’t
+1, 
Ãw_hªdË
,

261 
NULL
);

262 
	}
}

264 
ObjeùChªge
 *

265 
	$pŞycÚn_»move_pošt
(
PŞyCÚn
 *
pŞy
, 
pos
)

267 
HªdË
 *
Şd_hªdË
;

268 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
;

269 
Pošt
 
Şd_pošt
;

271 
Şd_hªdË
 = 
pŞy
->
objeù
.
hªdËs
[
pos
];

272 
Şd_pošt
 = 
pŞy
->
pošts
[
pos
];

273 
cÚÃùiÚpošt
 = 
Şd_hªdË
->
cÚÃùed_to
;

275 
	`objeù_uncÚÃù
((
DŸObjeù
 *)
pŞy
, 
Şd_hªdË
);

277 
	`»move_hªdË
(
pŞy
, 
pos
);

279 
	`pŞycÚn_upd©e_d©a
(
pŞy
);

281  
	`pŞycÚn_ü—‹_chªge
(
pŞy
, 
TYPE_REMOVE_POINT
,

282 &
Şd_pošt
, 
pos
, 
Şd_hªdË
,

283 
cÚÃùiÚpošt
);

284 
	}
}

287 
	$pŞycÚn_upd©e_d©a
(
PŞyCÚn
 *
pŞy
)

289 
i
;

290 
DŸObjeù
 *
obj
 = &
pŞy
->
objeù
;

293 ià(
pŞy
->
numpošts
 !ğ
obj
->
num_hªdËs
) {

294 
	`g_as£¹
(0 =ğ
obj
->
num_cÚÃùiÚs
);

296 
obj
->
hªdËs
 = 
	`g_»®loc
(obj->handles,

297 
pŞy
->
numpošts
*(
HªdË
 *));

298 
obj
->
num_hªdËs
 = 
pŞy
->
numpošts
;

299 
i
=0;i<
pŞy
->
numpošts
;i++) {

300 
obj
->
hªdËs
[
i
] = 
	`g_m®loc
((
HªdË
));

301 ià(0 =ğ
i
)

302 
	`£tup_hªdË
(
obj
->
hªdËs
[
i
], 
PC_HANDLE_START
);

303 ià(
i
 =ğ
pŞy
->
numpošts
-1)

304 
	`£tup_hªdË
(
obj
->
hªdËs
[
i
], 
PC_HANDLE_END
);

306 
	`£tup_hªdË
(
obj
->
hªdËs
[
i
], 
PC_HANDLE_CORNER
);

311 
i
=0;i<
pŞy
->
numpošts
;i++) {

312 
obj
->
hªdËs
[
i
]->
pos
 = 
pŞy
->
pošts
[i];

314 
	}
}

317 
	$pŞycÚn_upd©e_boundšgbox
(
PŞyCÚn
 *
pŞy
)

319 
	`as£¹
(
pŞy
 !ğ
NULL
);

321 
	`pŞylše_bbox
(&
pŞy
->
pošts
[0],

322 
pŞy
->
numpošts
,

323 &
pŞy
->
exŒa_¥acšg
, 
FALSE
,

324 &
pŞy
->
objeù
.
boundšg_box
);

325 
	}
}

328 
	$pŞycÚn_sim¶e_d¿w
(
PŞyCÚn
 *
pŞy
, 
DŸR’d””
 *
»nd””
, 
»®
 
width
)

330 
Pošt
 *
pošts
;

332 
	`as£¹
(
pŞy
 !ğ
NULL
);

333 
	`as£¹
(
»nd””
 !ğ
NULL
);

335 
pošts
 = &
pŞy
->points[0];

337 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
width
);

338 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

339 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_ROUND
);

340 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

342 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞylše
Ô’d””, 
pošts
, 
pŞy
->
numpošts
,

343 &
cŞÜ_bÏck
);

344 
	}
}

348 
	$pŞycÚn_š™
(
PŞyCÚn
 *
pŞy
, 
num_pošts
)

350 
DŸObjeù
 *
obj
;

351 
i
;

353 
obj
 = &
pŞy
->
objeù
;

355 
	`objeù_š™
(
obj
, 
num_pošts
, 0);

357 
pŞy
->
numpošts
 = 
num_pošts
;

359 
pŞy
->
pošts
 = 
	`g_m®loc
(
num_pošts
*(
Pošt
));

361 
i
=0;i<
num_pošts
;i++) {

362 
obj
->
hªdËs
[
i
] = 
	`g_m®loc
((
HªdË
));

363 ià(0 =ğ
i
)

364 
	`£tup_hªdË
(
obj
->
hªdËs
[
i
], 
PC_HANDLE_START
);

365 ià(
i
 =ğ
num_pošts
-1)

366 
	`£tup_hªdË
(
obj
->
hªdËs
[
i
], 
PC_HANDLE_END
);

368 
	`£tup_hªdË
(
obj
->
hªdËs
[
i
], 
PC_HANDLE_CORNER
);

371 
	`pŞycÚn_upd©e_d©a
(
pŞy
);

372 
	}
}

376 
	$pŞycÚn_£t_pošts
(
PŞyCÚn
 *
pŞy
, 
num_pošts
, 
Pošt
 *
pošts
)

378 
i
;

380 
pŞy
->
numpošts
 = 
num_pošts
;

382 ià(
pŞy
->
pošts
)

383 
	`g_ä“
(
pŞy
->
pošts
);

385 
pŞy
->
pošts
 = 
	`g_m®loc
(ÕŞy->
numpošts
)*(
Pošt
));

387 
i
=0;i<
pŞy
->
numpošts
;i++) {

388 
pŞy
->
pošts
[
i
] =…oints[i];

390 
	}
}

393 
	$pŞycÚn_cİy
(
PŞyCÚn
 *
äom
, PŞyCÚÀ*
to
)

395 
i
;

396 
DŸObjeù
 *
toobj
, *
äomobj
;

398 
toobj
 = &
to
->
objeù
;

399 
äomobj
 = &
äom
->
objeù
;

401 
	`objeù_cİy
(
äomobj
, 
toobj
);

403 
to
->
objeù
.
hªdËs
[0] = 
	`g_Ãw
(
HªdË
,1);

404 *
to
->
objeù
.
hªdËs
[0] = *
äom
->object.handles[0];

406 
i
=1;i<
toobj
->
num_hªdËs
-1;i++) {

407 
to
->
objeù
.
hªdËs
[
i
] = 
	`g_m®loc
((
HªdË
));

408 
	`£tup_hªdË
(
to
->
objeù
.
hªdËs
[
i
], 
PC_HANDLE_CORNER
);

411 
to
->
objeù
.
hªdËs
[
toobj
->
num_hªdËs
-1] = 
	`g_Ãw
(
HªdË
,1);

412 *
to
->
objeù
.
hªdËs
[
toobj
->
num_hªdËs
-1] =

413 *
äom
->
objeù
.
hªdËs
[
toobj
->
num_hªdËs
-1];

414 
	`pŞycÚn_£t_pošts
(
to
, 
äom
->
numpošts
, from->
pošts
);

416 
	`memıy
(&
to
->
exŒa_¥acšg
,&
äom
->extra_spacing,(to->extra_spacing));

417 
	`pŞycÚn_upd©e_d©a
(
to
);

418 
	}
}

421 
	$pŞycÚn_de¡roy
(
PŞyCÚn
 *
pŞy
)

423 
i
;

424 
HªdË
 **
‹mp_hªdËs
;

428 
‹mp_hªdËs
 = 
	`g_Ãw
(
HªdË
 *, 
pŞy
->
numpošts
);

429 
i
=0;i<
pŞy
->
numpošts
;i++)

430 
‹mp_hªdËs
[
i
] = 
pŞy
->
objeù
.
hªdËs
[i];

432 
	`objeù_de¡roy
(&
pŞy
->
objeù
);

434 
i
=0;i<
pŞy
->
numpošts
;i++)

435 
	`g_ä“
(
‹mp_hªdËs
[
i
]);

436 
	`g_ä“
(
‹mp_hªdËs
);

438 
	`g_ä“
(
pŞy
->
pošts
);

439 
	}
}

443 
	$pŞycÚn_§ve
(
PŞyCÚn
 *
pŞy
, 
ObjeùNode
 
obj_node
)

445 
i
;

446 
A‰ribu‹Node
 
©Œ
;

448 
	`objeù_§ve
(&
pŞy
->
objeù
, 
obj_node
);

450 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "poly_points");

452 
i
=0;i<
pŞy
->
numpošts
;i++) {

453 
	`d©a_add_pošt
(
©Œ
, &
pŞy
->
pošts
[
i
]);

455 
	}
}

458 
	$pŞycÚn_lßd
(
PŞyCÚn
 *
pŞy
, 
ObjeùNode
 
obj_node
)

460 
i
;

461 
A‰ribu‹Node
 
©Œ
;

462 
D©aNode
 
d©a
;

464 
DŸObjeù
 *
obj
 = &
pŞy
->
objeù
;

466 
	`objeù_lßd
(
obj
, 
obj_node
);

468 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "poly_points");

470 ià(
©Œ
 !ğ
NULL
)

471 
pŞy
->
numpošts
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

473 
pŞy
->
numpošts
 = 0;

475 
	`objeù_š™
(
obj
, 
pŞy
->
numpošts
, 0);

477 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

478 
pŞy
->
pošts
 = 
	`g_m®loc
ÕŞy->
numpošts
*(
Pošt
));

479 
i
=0;i<
pŞy
->
numpošts
;i++) {

480 
	`d©a_pošt
(
d©a
, &
pŞy
->
pošts
[
i
]);

481 
d©a
 = 
	`d©a_Ãxt
(data);

484 
obj
->
hªdËs
[0] = 
	`g_m®loc
((
HªdË
));

485 
obj
->
hªdËs
[0]->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

486 
obj
->
hªdËs
[0]->
cÚÃùed_to
 = 
NULL
;

487 
obj
->
hªdËs
[0]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

488 
obj
->
hªdËs
[0]->
id
 = 
HANDLE_MOVE_STARTPOINT
;

490 
obj
->
hªdËs
[
pŞy
->
numpošts
-1] = 
	`g_m®loc
((
HªdË
));

491 
obj
->
hªdËs
[
pŞy
->
numpošts
-1]->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

492 
obj
->
hªdËs
[
pŞy
->
numpošts
-1]->
cÚÃùed_to
 = 
NULL
;

493 
obj
->
hªdËs
[
pŞy
->
numpošts
-1]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

494 
obj
->
hªdËs
[
pŞy
->
numpošts
-1]->
id
 = 
HANDLE_MOVE_ENDPOINT
;

496 
i
=1;i<
pŞy
->
numpošts
-1;i++) {

497 
obj
->
hªdËs
[
i
] = 
	`g_m®loc
((
HªdË
));

498 
	`£tup_hªdË
(
obj
->
hªdËs
[
i
], 
PC_HANDLE_CORNER
);

501 
	`pŞycÚn_upd©e_d©a
(
pŞy
);

502 
	}
}

505 
	$pŞycÚn_chªge_ä“
(
PoštChªge
 *
chªge
)

507 iàĞ(
chªge
->
ty³
==
TYPE_ADD_POINT
 && !chªge->
­¶›d
) ||

508 (
chªge
->
ty³
==
TYPE_REMOVE_POINT
 && chªge->
­¶›d
) ){

509 ià(
chªge
->
hªdË
)

510 
	`g_ä“
(
chªge
->
hªdË
);

511 
chªge
->
hªdË
 = 
NULL
;

513 
	}
}

516 
	$pŞycÚn_chªge_­¶y
(
PoštChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

518 
chªge
->
­¶›d
 = 1;

519 
chªge
->
ty³
) {

520 
TYPE_ADD_POINT
:

521 
	`add_hªdË
((
PŞyCÚn
 *)
obj
, 
chªge
->
pos
, &chªge->
pošt
,

522 
chªge
->
hªdË
);

524 
TYPE_REMOVE_POINT
:

525 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË
);

526 
	`»move_hªdË
((
PŞyCÚn
 *)
obj
, 
chªge
->
pos
);

529 
	}
}

532 
	$pŞycÚn_chªge_»v”t
(
PoštChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

534 
chªge
->
ty³
) {

535 
TYPE_ADD_POINT
:

536 
	`»move_hªdË
((
PŞyCÚn
 *)
obj
, 
chªge
->
pos
);

538 
TYPE_REMOVE_POINT
:

539 
	`add_hªdË
((
PŞyCÚn
 *)
obj
, 
chªge
->
pos
, &chªge->
pošt
,

540 
chªge
->
hªdË
);

541 ià(
chªge
->
cÚÃùed_to
) {

542 
	`objeù_cÚÃù
(
obj
, 
chªge
->
hªdË
, chªge->
cÚÃùed_to
);

547 
chªge
->
­¶›d
 = 0;

548 
	}
}

550 
ObjeùChªge
 *

551 
	$pŞycÚn_ü—‹_chªge
(
PŞyCÚn
 *
pŞy
, 
chªge_ty³
 
ty³
,

552 
Pošt
 *
pošt
, 
pos
, 
HªdË
 *
hªdË
,

553 
CÚÃùiÚPošt
 *
cÚÃùed_to
)

555 
PoštChªge
 *
chªge
;

557 
chªge
 = 
	`g_Ãw
(
PoštChªge
, 1);

559 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
pŞycÚn_chªge_­¶y
;

560 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
pŞycÚn_chªge_»v”t
;

561 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
pŞycÚn_chªge_ä“
;

563 
chªge
->
ty³
 =ype;

564 
chªge
->
­¶›d
 = 1;

565 
chªge
->
pošt
 = *point;

566 
chªge
->
pos
 =…os;

567 
chªge
->
hªdË
 = handle;

568 
chªge
->
cÚÃùed_to
 = connected_to;

570  (
ObjeùChªge
 *)
chªge
;

571 
	}
}

	@O:\tool\dvs50\lib\poly_conn.h

18 #iâdeà
POLY_CONN_H


19 
	#POLY_CONN_H


	)

21 
	~"dŸty³s.h
"

22 
	~"objeù.h
"

23 
	~"boundšgbox.h
"

25 
	#HANDLE_CORNER
 (
HANDLE_CUSTOM1
)

	)

30 
	s_PŞyCÚn
 {

32 
DŸObjeù
 
	mobjeù
;

34 
	mnumpošts
;

35 
Pošt
 *
	mpošts
;

37 
PŞyBBExŒas
 
	mexŒa_¥acšg
;

41 
DIAVAR
 
pŞycÚn_upd©e_d©a
(
PŞyCÚn
 *
pŞy
);

42 
DIAVAR
 
pŞycÚn_upd©e_boundšgbox
(
PŞyCÚn
 *
pŞy
);

43 
DIAVAR
 
pŞycÚn_sim¶e_d¿w
(
PŞyCÚn
 *
pŞy
, 
DŸR’d””
 *
»nd””
, 
»®
 
width
);

44 
DIAVAR
 
pŞycÚn_š™
(
PŞyCÚn
 *
pŞy
, 
num_pošts
);

45 
DIAVAR
 
pŞycÚn_£t_pošts
(
PŞyCÚn
 *
pŞy
, 
num_pošts
, 
Pošt
 *
pošts
);

46 
DIAVAR
 
pŞycÚn_de¡roy
(
PŞyCÚn
 *
pŞy
);

47 
DIAVAR
 
pŞycÚn_cİy
(
PŞyCÚn
 *
äom
, PŞyCÚÀ*
to
);

48 
DIAVAR
 
pŞycÚn_§ve
(
PŞyCÚn
 *
pŞy
, 
ObjeùNode
 
obj_node
);

49 
DIAVAR
 
pŞycÚn_lßd
(
PŞyCÚn
 *
pŞy
, 
ObjeùNode
 
obj_node
);

50 
DIAVAR
 
ObjeùChªge
 *
pŞycÚn_add_pošt
(
PŞyCÚn
 *
pŞy
, 
£gm’t
, 
Pošt
 *
pošt
);

51 
DIAVAR
 
ObjeùChªge
 *
pŞycÚn_»move_pošt
(
PŞyCÚn
 *
pŞy
, 
pošt
);

52 
DIAVAR
 
ObjeùChªge
 *
pŞycÚn_move_hªdË
(
PŞyCÚn
 *
pŞy
, 
HªdË
 *
id
,

53 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

54 
HªdËMoveR—sÚ
 
»asÚ
,

55 
Modif›rKeys
 
modif›rs
);

56 
DIAVAR
 
ObjeùChªge
 *
pŞycÚn_move
(
PŞyCÚn
 *
pŞy
, 
Pošt
 *
to
);

57 
DIAVAR
 
»®
 
pŞycÚn_di¡ªû_äom
(
PŞyCÚn
 *
pŞy
, 
Pošt
 *
pošt
,

58 
»®
 
lše_width
);

59 
DIAVAR
 
HªdË
 *
pŞycÚn_şo£¡_hªdË
(
PŞyCÚn
 *
pŞy
, 
Pošt
 *
pošt
);

60 
DIAVAR
 
pŞycÚn_şo£¡_£gm’t
(
PŞyCÚn
 *
pŞy
, 
Pošt
 *
pošt
,

61 
»®
 
lše_width
);

63 
	#POLYCONN_COMMON_PROPERTIES
 \

64 
OBJECT_COMMON_PROPERTIES
, \

65 { "pŞy_pošts", 
PROP_TYPE_POINTARRAY
, 0, "pŞcÚÀpošts", 
NULL
} \

66 

	)

67 
	#POLYCONN_COMMON_PROPERTIES_OFFSETS
 \

68 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

69 { "pŞy_pošts", 
PROP_TYPE_POINTARRAY
, \

70 
	`off£tof
(
PŞyCÚn
,
pošts
), off£tof(PŞyCÚn,
numpošts
)} \

71 

	)

	@O:\tool\dvs50\lib\polyshape.c

19 
	~<cÚfig.h
>

21 
	~<¡dio.h
>

22 
	~<¡dlib.h
>

23 
	~<as£¹.h
>

24 
	~<m©h.h
>

25 
	~<¡ršg.h
>

27 
	~"pŞysh­e.h
"

28 
	~"mes§ge.h
"

29 
	~"dŸ»nd””.h
"

31 
	#NUM_CONNECTIONS
(
pŞy
è(ÕŞy)->
numpošts
 * 2 + 1)

	)

33 
	echªge_ty³
 {

34 
	mTYPE_ADD_POINT
,

35 
	mTYPE_REMOVE_POINT


38 
	sPoštChªge
 {

39 
ObjeùChªge
 
	mobj_chªge
;

41 
chªge_ty³
 
	mty³
;

42 
	m­¶›d
;

44 
Pošt
 
	mpošt
;

45 
	mpos
;

47 
HªdË
 *
	mhªdË
;

49 
CÚÃùiÚPošt
 *
	mı1
, *
	mı2
;

52 
ObjeùChªge
 *

53 
pŞysh­e_ü—‹_chªge
(
PŞySh­e
 *
pŞy
, 
chªge_ty³
 
ty³
,

54 
Pošt
 *
pošt
, 
£gm’t
, 
HªdË
 *
hªdË
,

55 
CÚÃùiÚPošt
 *
ı1
, CÚÃùiÚPošˆ*
ı2
);

57 
	$£tup_hªdË
(
HªdË
 *
hªdË
)

59 
hªdË
->
id
 = 
HANDLE_CORNER
;

60 
hªdË
->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

61 
hªdË
->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

62 
hªdË
->
cÚÃùed_to
 = 
NULL
;

63 
	}
}

66 
	$g‘_hªdË_Ä
(
PŞySh­e
 *
pŞy
, 
HªdË
 *
hªdË
)

68 
i
 = 0;

69 
i
=0;i<
pŞy
->
numpošts
;i++) {

70 ià(
pŞy
->
objeù
.
hªdËs
[
i
] =ğ
hªdË
)

71  
i
;

74 
	}
}

76 
ObjeùChªge
*

77 
	$pŞysh­e_move_hªdË
(
PŞySh­e
 *
pŞy
, 
HªdË
 *
hªdË
,

78 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

79 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

81 
hªdË_Ä
;

83 
hªdË_Ä
 = 
	`g‘_hªdË_Ä
(
pŞy
, 
hªdË
);

84 
pŞy
->
pošts
[
hªdË_Ä
] = *
to
;

86  
NULL
;

87 
	}
}

89 
ObjeùChªge
*

90 
	$pŞysh­e_move
(
PŞySh­e
 *
pŞy
, 
Pošt
 *
to
)

92 
Pošt
 
p
;

93 
i
;

95 
p
 = *
to
;

96 
	`pošt_sub
(&
p
, &
pŞy
->
pošts
[0]);

98 
pŞy
->
pošts
[0] = *
to
;

99 
i
=1;i<
pŞy
->
numpošts
;i++) {

100 
	`pošt_add
(&
pŞy
->
pošts
[
i
], &
p
);

103  
NULL
;

104 
	}
}

107 
	$pŞysh­e_şo£¡_£gm’t
(
PŞySh­e
 *
pŞy
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

109 
i
;

110 
»®
 
di¡
;

111 
şo£¡
;

113 
di¡
 = 
	`di¡ªû_lše_pošt
Ğ&
pŞy
->
pošts
[pŞy->
numpošts
-1], &poly->points[0],

114 
lše_width
, 
pošt
);

115 
şo£¡
 = 
pŞy
->
numpošts
-1;

116 
i
=0;i<
pŞy
->
numpošts
-1;i++) {

117 
»®
 
Ãw_di¡
 =

118 
	`di¡ªû_lše_pošt
Ğ&
pŞy
->
pošts
[
i
], &poly->points[i+1],

119 
lše_width
, 
pošt
);

120 ià(
Ãw_di¡
 < 
di¡
) {

121 
di¡
 = 
Ãw_di¡
;

122 
şo£¡
 = 
i
;

125  
şo£¡
;

126 
	}
}

128 
HªdË
 *

129 
	$pŞysh­e_şo£¡_hªdË
(
PŞySh­e
 *
pŞy
, 
Pošt
 *
pošt
)

131 
i
;

132 
»®
 
di¡
;

133 
HªdË
 *
şo£¡
;

135 
şo£¡
 = 
pŞy
->
objeù
.
hªdËs
[0];

136 
di¡
 = 
	`di¡ªû_pošt_pošt
Ğ
pošt
, &
şo£¡
->
pos
);

137 
i
=1;i<
pŞy
->
numpošts
;i++) {

138 
»®
 
Ãw_di¡
;

139 
Ãw_di¡
 = 
	`di¡ªû_pošt_pošt
Ğ
pošt
, &
pŞy
->
pošts
[
i
]);

140 ià(
Ãw_di¡
 < 
di¡
) {

141 
di¡
 = 
Ãw_di¡
;

142 
şo£¡
 = 
pŞy
->
objeù
.
hªdËs
[
i
];

145  
şo£¡
;

146 
	}
}

148 
»®


149 
	$pŞysh­e_di¡ªû_äom
(
PŞySh­e
 *
pŞy
, 
Pošt
 *
pošt
, 
»®
 
lše_width
)

151  
	`di¡ªû_pŞygÚ_pošt
(
pŞy
->
pošts
,…Şy->
numpošts
,

152 
lše_width
, 
pošt
);

153 
	}
}

156 
	$add_hªdË
(
PŞySh­e
 *
pŞy
, 
pos
, 
Pošt
 *
pošt
, 
HªdË
 *
hªdË
,

157 
CÚÃùiÚPošt
 *
ı1
, CÚÃùiÚPošˆ*
ı2
)

159 
i
;

160 
DŸObjeù
 *
obj
;

162 
pŞy
->
numpošts
++;

163 
pŞy
->
pošts
 = 
	`g_»®loc
ÕŞy->pošts,…Şy->
numpošts
*(
Pošt
));

165 
i
=
pŞy
->
numpošts
-1; i > 
pos
; i--) {

166 
pŞy
->
pošts
[
i
] =…oly->points[i-1];

168 
pŞy
->
pošts
[
pos
] = *
pošt
;

169 
	`objeù_add_hªdË_©
((
DŸObjeù
*)
pŞy
, 
hªdË
, 
pos
);

170 
	`objeù_add_cÚÃùiÚpošt_©
((
DŸObjeù
*)
pŞy
, 
ı1
, 2*
pos
);

171 
	`objeù_add_cÚÃùiÚpošt_©
((
DŸObjeù
*)
pŞy
, 
ı2
, 2*
pos
+1);

173 
obj
 = (
DŸObjeù
 *)
pŞy
;

174 
	}
}

177 
	$»move_hªdË
(
PŞySh­e
 *
pŞy
, 
pos
)

179 
i
;

180 
DŸObjeù
 *
obj
;

181 
HªdË
 *
Şd_hªdË
;

182 
CÚÃùiÚPošt
 *
Şd_ı1
, *
Şd_ı2
;

184 
obj
 = (
DŸObjeù
 *)
pŞy
;

187 
pŞy
->
numpošts
--;

188 
i
=
pos
; i < 
pŞy
->
numpošts
; i++) {

189 
pŞy
->
pošts
[
i
] =…oly->points[i+1];

191 
pŞy
->
pošts
 = 
	`g_»®loc
ÕŞy->pošts,…Şy->
numpošts
*(
Pošt
));

193 
Şd_hªdË
 = 
obj
->
hªdËs
[
pos
];

194 
Şd_ı1
 = 
obj
->
cÚÃùiÚs
[2*
pos
];

195 
Şd_ı2
 = 
obj
->
cÚÃùiÚs
[2*
pos
+1];

196 
	`objeù_»move_hªdË
(&
pŞy
->
objeù
, 
Şd_hªdË
);

197 
	`objeù_»move_cÚÃùiÚpošt
(
obj
, 
Şd_ı1
);

198 
	`objeù_»move_cÚÃùiÚpošt
(
obj
, 
Şd_ı2
);

199 
	}
}

204 
ObjeùChªge
 *

205 
	$pŞysh­e_add_pošt
(
PŞySh­e
 *
pŞy
, 
£gm’t
, 
Pošt
 *
pošt
)

207 
Pošt
 
»®pošt
;

208 
HªdË
 *
Ãw_hªdË
;

209 
CÚÃùiÚPošt
 *
Ãw_ı1
, *
Ãw_ı2
;

211 ià(
pošt
 =ğ
NULL
) {

212 
»®pošt
.
x
 = (
pŞy
->
pošts
[
£gm’t
].x+poly->points[segment+1].x)/2;

213 
»®pošt
.
y
 = (
pŞy
->
pošts
[
£gm’t
].y+poly->points[segment+1].y)/2;

215 
»®pošt
 = *
pošt
;

218 
Ãw_hªdË
 = 
	`g_Ãw
(
HªdË
, 1);

219 
Ãw_ı1
 = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

220 
Ãw_ı1
->
objeù
 = &
pŞy
->object;

221 
Ãw_ı2
 = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

222 
Ãw_ı2
->
objeù
 = &
pŞy
->object;

223 
	`£tup_hªdË
(
Ãw_hªdË
);

224 
	`add_hªdË
(
pŞy
, 
£gm’t
+1, &
»®pošt
, 
Ãw_hªdË
, 
Ãw_ı1
, 
Ãw_ı2
);

225  
	`pŞysh­e_ü—‹_chªge
(
pŞy
, 
TYPE_ADD_POINT
,

226 &
»®pošt
, 
£gm’t
+1, 
Ãw_hªdË
,

227 
Ãw_ı1
, 
Ãw_ı2
);

228 
	}
}

230 
ObjeùChªge
 *

231 
	$pŞysh­e_»move_pošt
(
PŞySh­e
 *
pŞy
, 
pos
)

233 
HªdË
 *
Şd_hªdË
;

234 
CÚÃùiÚPošt
 *
Şd_ı1
, *
Şd_ı2
;

235 
Pošt
 
Şd_pošt
;

237 
Şd_hªdË
 = 
pŞy
->
objeù
.
hªdËs
[
pos
];

238 
Şd_pošt
 = 
pŞy
->
pošts
[
pos
];

239 
Şd_ı1
 = 
pŞy
->
objeù
.
cÚÃùiÚs
[2*
pos
];

240 
Şd_ı2
 = 
pŞy
->
objeù
.
cÚÃùiÚs
[2*
pos
+1];

242 
	`objeù_uncÚÃù
((
DŸObjeù
 *)
pŞy
, 
Şd_hªdË
);

244 
	`»move_hªdË
(
pŞy
, 
pos
);

246 
	`pŞysh­e_upd©e_d©a
(
pŞy
);

248  
	`pŞysh­e_ü—‹_chªge
(
pŞy
, 
TYPE_REMOVE_POINT
,

249 &
Şd_pošt
, 
pos
, 
Şd_hªdË
,

250 
Şd_ı1
, 
Şd_ı2
);

251 
	}
}

255 
gšt


256 
	$fœ¡_dœeùiÚ
(
gšt
 
dœs
) {

257 
dœs
) {

258 
DIR_NORTHEAST
:  
DIR_NORTH
;

259 
DIR_SOUTHEAST
:  
DIR_EAST
;

260 
DIR_NORTHWEST
:  
DIR_WEST
;

261 
DIR_SOUTHWEST
:  
DIR_SOUTH
;

262 :  
dœs
;

264 
	}
}

268 
gšt


269 
	$Ï¡_dœeùiÚ
(
gšt
 
dœs
) {

270 
dœs
) {

271 
DIR_NORTHEAST
:  
DIR_EAST
;

272 
DIR_SOUTHEAST
:  
DIR_SOUTH
;

273 
DIR_NORTHWEST
:  
DIR_NORTH
;

274 
DIR_SOUTHWEST
:  
DIR_WEST
;

275 :  
dœs
;

277 
	}
}

280 
gšt


281 
	$fšd_t_dœeùiÚs
(
Pošt
 
´ev
, Pošˆ
this
, Pošˆ
Ãxt
)

283 
gšt
 
¡¬tdœs
 = 
	`fšd_¦İe_dœeùiÚs
(
´ev
, 
this
);

284 
gšt
 
’ddœs
 = 
	`fšd_¦İe_dœeùiÚs
(
this
, 
Ãxt
);

285 
gšt
 
fœ¡dœ
 = 
	`fœ¡_dœeùiÚ
(
¡¬tdœs
);

286 
gšt
 
Ï¡dœ
 = 
	`Ï¡_dœeùiÚ
(
’ddœs
);

287 
gšt
 
dœ
, 
dœs
 = 0;

289 
dœ
 = 
fœ¡dœ
;

290 
dœ
 !ğ
Ï¡dœ
) {

291 
dœs
 |ğ
dœ
;

292 
dœ
 = dir * 2;

293 ià(
dœ
 == 16) dir = 1;

295 
dœs
 |ğ
dœ
;

297  
dœs
;

298 
	}
}

301 
	$pŞysh­e_upd©e_d©a
(
PŞySh­e
 *
pŞy
)

303 
Pošt
 
Ãxt
;

304 
i
;

305 
DŸObjeù
 *
obj
 = &
pŞy
->
objeù
;

306 
Pošt
 
mšp
, 
maxp
;

309 ià(
pŞy
->
numpošts
 !ğ
obj
->
num_hªdËs
 ||

310 
	`NUM_CONNECTIONS
(
pŞy
è!ğ
obj
->
num_cÚÃùiÚs
) {

311 
	`objeù_uncÚÃù_®l
(
obj
);

313 
obj
->
hªdËs
 = 
	`g_»®loc
(obj->handles,

314 
pŞy
->
numpošts
*(
HªdË
 *));

315 
obj
->
num_hªdËs
 = 
pŞy
->
numpošts
;

316 
i
=0;i<
pŞy
->
numpošts
;i++) {

317 
obj
->
hªdËs
[
i
] = 
	`g_Ãw
(
HªdË
, 1);

318 
	`£tup_hªdË
(
obj
->
hªdËs
[
i
]);

321 
obj
->
cÚÃùiÚs
 = 
	`g_»®loc
(obj->connections,

322 
	`NUM_CONNECTIONS
(
pŞy
è* (
CÚÃùiÚPošt
 *));

323 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pŞy
); i++) {

324 
obj
->
cÚÃùiÚs
[
i
] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

325 
obj
->
cÚÃùiÚs
[
i
]->
objeù
 = obj;

327 
obj
->
num_cÚÃùiÚs
 = 
	`NUM_CONNECTIONS
(
pŞy
);

331 
mšp
 = 
maxp
 = 
pŞy
->
pošts
[0];

332 
i
 = 0; i < 
pŞy
->
numpošts
; i++) {

333 
gšt
 
thisdœ
, 
Ãxtdœ
;

334 
Pošt
 
´ev
;

335 
obj
->
hªdËs
[
i
]->
pos
 = 
pŞy
->
pošts
[i];

337 ià(
i
 == 0)

338 
´ev
 = 
pŞy
->
pošts
[pŞy->
numpošts
-1];

340 
´ev
 = 
pŞy
->
pošts
[
i
-1];

341 ià(
i
 =ğ
pŞy
->
numpošts
 - 1)

342 
Ãxt
 = 
pŞy
->
pošts
[0];

344 
Ãxt
 = 
pŞy
->
pošts
[
i
+1];

345 
	`pošt_add
(&
Ãxt
, &
pŞy
->
pošts
[
i
]);

346 
	`pošt_sÿË
(&
Ãxt
, 0.5);

348 
thisdœ
 = 
	`fšd_t_dœeùiÚs
(
´ev
, 
pŞy
->
pošts
[
i
], 
Ãxt
);

349 
Ãxtdœ
 = 
	`fšd_¦İe_dœeùiÚs
(
pŞy
->
pošts
[
i
], 
Ãxt
);

351 
obj
->
cÚÃùiÚs
[2*
i
]->
pos
 = 
pŞy
->
pošts
[i];

352 
obj
->
cÚÃùiÚs
[2*
i
]->
dœeùiÚs
 = 
thisdœ
;

353 
obj
->
cÚÃùiÚs
[2*
i
+1]->
pos
 = 
Ãxt
;

354 
obj
->
cÚÃùiÚs
[2*
i
+1]->
dœeùiÚs
 = 
Ãxtdœ
;

356 ià(
pŞy
->
pošts
[
i
].
x
 < 
mšp
.x) minp.x =…oly->points[i].x;

357 ià(
pŞy
->
pošts
[
i
].
x
 > 
maxp
.x) maxp.x =…oly->points[i].x;

358 ià(
pŞy
->
pošts
[
i
].
y
 < 
mšp
.y) minp.y =…oly->points[i].y;

359 ià(
pŞy
->
pošts
[
i
].
y
 > 
maxp
.y) maxp.y =…oly->points[i].y;

362 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1]->
pos
.
x
 = (
mšp
.x + 
maxp
.x) / 2;

363 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1]->
pos
.
y
 = (
mšp
.y + 
maxp
.y) / 2;

364 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
-1]->
dœeùiÚs
 = 
DIR_ALL
;

365 
	}
}

368 
	$pŞysh­e_upd©e_boundšgbox
(
PŞySh­e
 *
pŞy
)

370 
EËm’tBBExŒas
 *
exŒa
;

371 
PŞyBBExŒas
 
³xŒa
;

373 
	`as£¹
(
pŞy
 !ğ
NULL
);

375 
exŒa
 = &
pŞy
->
exŒa_¥acšg
;

376 
³xŒa
.
¡¬t_Œªs
 =…exŒa.
’d_Œªs
 =

377 
³xŒa
.
¡¬t_lÚg
 =…exŒa.
’d_lÚg
 = 0;

378 
³xŒa
.
middË_Œªs
 = 
exŒa
->
bÜd”_Œªs
;

380 
	`pŞylše_bbox
(&
pŞy
->
pošts
[0],

381 
pŞy
->
numpošts
,

382 &
³xŒa
, 
TRUE
,

383 &
pŞy
->
objeù
.
boundšg_box
);

384 
	}
}

387 
	$pŞysh­e_sim¶e_d¿w
(
PŞySh­e
 *
pŞy
, 
DŸR’d””
 *
»nd””
, 
»®
 
width
)

389 
Pošt
 *
pošts
;

391 
	`as£¹
(
pŞy
 !ğ
NULL
);

392 
	`as£¹
(
»nd””
 !ğ
NULL
);

394 
pošts
 = &
pŞy
->points[0];

396 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
width
);

397 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

398 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_ROUND
);

399 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_BUTT
);

401 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_pŞygÚ
Ô’d””, 
pošts
, 
pŞy
->
numpošts
,

402 &
cŞÜ_bÏck
);

403 
	}
}

407 
	$pŞysh­e_š™
(
PŞySh­e
 *
pŞy
, 
num_pošts
)

409 
DŸObjeù
 *
obj
;

410 
i
;

412 
obj
 = &
pŞy
->
objeù
;

414 
	`objeù_š™
(
obj
, 
num_pošts
, 2 *‚um_points + 1);

416 
pŞy
->
numpošts
 = 
num_pošts
;

418 
pŞy
->
pošts
 = 
	`g_m®loc
(
num_pošts
*(
Pošt
));

420 
i
 = 0; i < 
num_pošts
; i++) {

421 
obj
->
hªdËs
[
i
] = 
	`g_Ãw
(
HªdË
, 1);

423 
obj
->
hªdËs
[
i
]->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

424 
obj
->
hªdËs
[
i
]->
cÚÃùed_to
 = 
NULL
;

425 
obj
->
hªdËs
[
i
]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

426 
obj
->
hªdËs
[
i
]->
id
 = 
HANDLE_CORNER
;

429 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pŞy
); i++) {

430 
obj
->
cÚÃùiÚs
[
i
] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

431 
obj
->
cÚÃùiÚs
[
i
]->
objeù
 = &
pŞy
->object;

432 
obj
->
cÚÃùiÚs
[
i
]->
æags
 = 0;

434 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
 - 1]->
æags
 = 
CP_FLAGS_MAIN
;

440 
	}
}

443 
	$pŞysh­e_£t_pošts
(
PŞySh­e
 *
pŞy
, 
num_pošts
, 
Pošt
 *
pošts
)

445 
i
;

447 
pŞy
->
numpošts
 = 
num_pošts
;

449 ià(
pŞy
->
pošts
è
	`g_ä“
(poly->points);

450 
pŞy
->
pošts
 = 
	`g_Ãw
(
Pošt
, 
num_pošts
);

452 
i
 = 0; i < 
num_pošts
; i++) {

453 
pŞy
->
pošts
[
i
] =…oints[i];

455 
	}
}

458 
	$pŞysh­e_cİy
(
PŞySh­e
 *
äom
, PŞySh­*
to
)

460 
i
;

461 
DŸObjeù
 *
toobj
, *
äomobj
;

463 
toobj
 = &
to
->
objeù
;

464 
äomobj
 = &
äom
->
objeù
;

466 
	`objeù_cİy
(
äomobj
, 
toobj
);

468 
	`pŞysh­e_£t_pošts
(
to
, 
äom
->
numpošts
, from->
pošts
);

470 
i
=0;i<
to
->
numpošts
;i++) {

471 
toobj
->
hªdËs
[
i
] = 
	`g_Ãw
(
HªdË
, 1);

472 
	`£tup_hªdË
(
toobj
->
hªdËs
[
i
]);

473 
toobj
->
cÚÃùiÚs
[2*
i
] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

474 
toobj
->
cÚÃùiÚs
[2*
i
]->
objeù
 = &
to
->object;

475 
toobj
->
cÚÃùiÚs
[2*
i
+1] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

476 
toobj
->
cÚÃùiÚs
[2*
i
+1]->
objeù
 = &
to
->object;

478 
toobj
->
cÚÃùiÚs
[toobj->
num_cÚÃùiÚs
 - 1] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

479 
toobj
->
cÚÃùiÚs
[toobj->
num_cÚÃùiÚs
 - 1]->
objeù
 = &
to
->object;

481 
	`memıy
(&
to
->
exŒa_¥acšg
,&
äom
->extra_spacing,(to->extra_spacing));

482 
	`pŞysh­e_upd©e_d©a
(
to
);

483 
	}
}

486 
	$pŞysh­e_de¡roy
(
PŞySh­e
 *
pŞy
)

488 
i
;

489 
HªdË
 **
‹mp_hªdËs
;

490 
CÚÃùiÚPošt
 **
‹mp_ıs
;

494 
‹mp_hªdËs
 = 
	`g_Ãw
(
HªdË
 *, 
pŞy
->
numpošts
);

495 
i
=0;i<
pŞy
->
numpošts
;i++)

496 
‹mp_hªdËs
[
i
] = 
pŞy
->
objeù
.
hªdËs
[i];

498 
‹mp_ıs
 = 
	`g_Ãw
(
CÚÃùiÚPošt
 *, 
	`NUM_CONNECTIONS
(
pŞy
));

499 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pŞy
); i++)

500 
‹mp_ıs
[
i
] = 
pŞy
->
objeù
.
cÚÃùiÚs
[i];

502 
	`objeù_de¡roy
(&
pŞy
->
objeù
);

504 
i
=0;i<
pŞy
->
numpošts
;i++)

505 
	`g_ä“
(
‹mp_hªdËs
[
i
]);

506 
	`g_ä“
(
‹mp_hªdËs
);

507 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pŞy
); i++)

508 
	`g_ä“
(
‹mp_ıs
[
i
]);

509 
	`g_ä“
(
‹mp_ıs
);

511 
	`g_ä“
(
pŞy
->
pošts
);

512 
	}
}

516 
	$pŞysh­e_§ve
(
PŞySh­e
 *
pŞy
, 
ObjeùNode
 
obj_node
)

518 
i
;

519 
A‰ribu‹Node
 
©Œ
;

521 
	`objeù_§ve
(&
pŞy
->
objeù
, 
obj_node
);

523 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, "poly_points");

525 
i
=0;i<
pŞy
->
numpošts
;i++) {

526 
	`d©a_add_pošt
(
©Œ
, &
pŞy
->
pošts
[
i
]);

528 
	}
}

531 
	$pŞysh­e_lßd
(
PŞySh­e
 *
pŞy
, 
ObjeùNode
 
obj_node
)

533 
i
;

534 
A‰ribu‹Node
 
©Œ
;

535 
D©aNode
 
d©a
;

537 
DŸObjeù
 *
obj
 = &
pŞy
->
objeù
;

539 
	`objeù_lßd
(
obj
, 
obj_node
);

541 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "poly_points");

543 ià(
©Œ
 !ğ
NULL
)

544 
pŞy
->
numpošts
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

546 
pŞy
->
numpošts
 = 0;

548 
	`objeù_š™
(
obj
, 
pŞy
->
numpošts
, 
	`NUM_CONNECTIONS
(poly));

550 
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
);

551 
pŞy
->
pošts
 = 
	`g_Ãw
(
Pošt
,…Şy->
numpošts
);

552 
i
=0;i<
pŞy
->
numpošts
;i++) {

553 
	`d©a_pošt
(
d©a
, &
pŞy
->
pošts
[
i
]);

554 
d©a
 = 
	`d©a_Ãxt
(data);

557 
i
=0;i<
pŞy
->
numpošts
;i++) {

558 
obj
->
hªdËs
[
i
] = 
	`g_Ãw
(
HªdË
, 1);

559 
	`£tup_hªdË
(
obj
->
hªdËs
[
i
]);

561 
i
 = 0; i < 
	`NUM_CONNECTIONS
(
pŞy
); i++) {

562 
obj
->
cÚÃùiÚs
[
i
] = 
	`g_Ãw0
(
CÚÃùiÚPošt
, 1);

563 
obj
->
cÚÃùiÚs
[
i
]->
objeù
 = obj;

565 
obj
->
cÚÃùiÚs
[obj->
num_cÚÃùiÚs
 - 1]->
æags
 = 
CP_FLAGS_MAIN
;

567 
	`pŞysh­e_upd©e_d©a
(
pŞy
);

568 
	}
}

571 
	$pŞysh­e_chªge_ä“
(
PoštChªge
 *
chªge
)

573 iàĞ(
chªge
->
ty³
==
TYPE_ADD_POINT
 && !chªge->
­¶›d
) ||

574 (
chªge
->
ty³
==
TYPE_REMOVE_POINT
 && chªge->
­¶›d
) ){

575 
	`g_ä“
(
chªge
->
hªdË
);

576 
	`g_ä“
(
chªge
->
ı1
);

577 
	`g_ä“
(
chªge
->
ı2
);

578 
chªge
->
hªdË
 = 
NULL
;

579 
chªge
->
ı1
 = 
NULL
;

580 
chªge
->
ı2
 = 
NULL
;

582 
	}
}

585 
	$pŞysh­e_chªge_­¶y
(
PoštChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

587 
chªge
->
­¶›d
 = 1;

588 
chªge
->
ty³
) {

589 
TYPE_ADD_POINT
:

590 
	`add_hªdË
((
PŞySh­e
 *)
obj
, 
chªge
->
pos
, &chªge->
pošt
,

591 
chªge
->
hªdË
, chªge->
ı1
, chªge->
ı2
);

593 
TYPE_REMOVE_POINT
:

594 
	`objeù_uncÚÃù
(
obj
, 
chªge
->
hªdË
);

595 
	`»move_hªdË
((
PŞySh­e
 *)
obj
, 
chªge
->
pos
);

598 
	}
}

601 
	$pŞysh­e_chªge_»v”t
(
PoštChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

603 
chªge
->
ty³
) {

604 
TYPE_ADD_POINT
:

605 
	`»move_hªdË
((
PŞySh­e
 *)
obj
, 
chªge
->
pos
);

607 
TYPE_REMOVE_POINT
:

608 
	`add_hªdË
((
PŞySh­e
 *)
obj
, 
chªge
->
pos
, &chªge->
pošt
,

609 
chªge
->
hªdË
, chªge->
ı1
, chªge->
ı2
);

613 
chªge
->
­¶›d
 = 0;

614 
	}
}

616 
ObjeùChªge
 *

617 
	$pŞysh­e_ü—‹_chªge
(
PŞySh­e
 *
pŞy
, 
chªge_ty³
 
ty³
,

618 
Pošt
 *
pošt
, 
pos
, 
HªdË
 *
hªdË
,

619 
CÚÃùiÚPošt
 *
ı1
, CÚÃùiÚPošˆ*
ı2
)

621 
PoštChªge
 *
chªge
;

623 
chªge
 = 
	`g_Ãw
(
PoštChªge
, 1);

625 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
pŞysh­e_chªge_­¶y
;

626 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
pŞysh­e_chªge_»v”t
;

627 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
pŞysh­e_chªge_ä“
;

629 
chªge
->
ty³
 =ype;

630 
chªge
->
­¶›d
 = 1;

631 
chªge
->
pošt
 = *point;

632 
chªge
->
pos
 =…os;

633 
chªge
->
hªdË
 = handle;

634 
chªge
->
ı1
 = cp1;

635 
chªge
->
ı2
 = cp2;

637  (
ObjeùChªge
 *)
chªge
;

638 
	}
}

	@O:\tool\dvs50\lib\polyshape.h

18 #iâdeà
POLYSHAPE_H


19 
	#POLYSHAPE_H


	)

21 
	~"dŸty³s.h
"

22 
	~"objeù.h
"

23 
	~"boundšgbox.h
"

25 
	#HANDLE_CORNER
 (
HANDLE_CUSTOM1
)

	)

30 
	s_PŞySh­e
 {

32 
DŸObjeù
 
	mobjeù
;

34 
	mnumpošts
;

35 
Pošt
 *
	mpošts
;

37 
EËm’tBBExŒas
 
	mexŒa_¥acšg
;

40 
DIAVAR
 
pŞysh­e_upd©e_d©a
(
PŞySh­e
 *
pŞy
);

41 
DIAVAR
 
pŞysh­e_upd©e_boundšgbox
(
PŞySh­e
 *
pŞy
);

42 
DIAVAR
 
pŞysh­e_sim¶e_d¿w
(
PŞySh­e
 *
pŞy
, 
DŸR’d””
 *
»nd””
, 
»®
 
width
);

43 
DIAVAR
 
pŞysh­e_š™
(
PŞySh­e
 *
pŞy
, 
num_pošts
);

44 
DIAVAR
 
pŞysh­e_£t_pošts
(
PŞySh­e
 *
pŞy
, 
num_pošts
, 
Pošt
 *
pošts
);

45 
DIAVAR
 
pŞysh­e_de¡roy
(
PŞySh­e
 *
pŞy
);

46 
DIAVAR
 
pŞysh­e_cİy
(
PŞySh­e
 *
äom
, PŞySh­*
to
);

47 
DIAVAR
 
pŞysh­e_§ve
(
PŞySh­e
 *
pŞy
, 
ObjeùNode
 
obj_node
);

48 
DIAVAR
 
pŞysh­e_lßd
(
PŞySh­e
 *
pŞy
, 
ObjeùNode
 
obj_node
);

49 
DIAVAR
 
ObjeùChªge
 *
pŞysh­e_add_pošt
(
PŞySh­e
 *
pŞy
, 
£gm’t
, 
Pošt
 *
pošt
);

50 
DIAVAR
 
ObjeùChªge
 *
pŞysh­e_»move_pošt
(
PŞySh­e
 *
pŞy
, 
pošt
);

51 
DIAVAR
 
ObjeùChªge
 *
pŞysh­e_move_hªdË
(
PŞySh­e
 *
pŞy
, 
HªdË
 *
id
,

52 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

53 
HªdËMoveR—sÚ
 
»asÚ
,

54 
Modif›rKeys
 
modif›rs
);

55 
DIAVAR
 
ObjeùChªge
 *
pŞysh­e_move
(
PŞySh­e
 *
pŞy
, 
Pošt
 *
to
);

56 
DIAVAR
 
»®
 
pŞysh­e_di¡ªû_äom
(
PŞySh­e
 *
pŞy
, 
Pošt
 *
pošt
,

57 
»®
 
lše_width
);

58 
DIAVAR
 
HªdË
 *
pŞysh­e_şo£¡_hªdË
(
PŞySh­e
 *
pŞy
, 
Pošt
 *
pošt
);

59 
DIAVAR
 
pŞysh­e_şo£¡_£gm’t
(
PŞySh­e
 *
pŞy
, 
Pošt
 *
pošt
,

60 
»®
 
lše_width
);

62 
	#POLYSHAPE_COMMON_PROPERTIES
 \

63 
OBJECT_COMMON_PROPERTIES
, \

64 { "pŞy_pošts", 
PROP_TYPE_POINTARRAY
, 0, "pŞysh­pošts", 
NULL
} \

65 

	)

66 
	#POLYSHAPE_COMMON_PROPERTIES_OFFSETS
 \

67 
OBJECT_COMMON_PROPERTIES_OFFSETS
, \

68 { "pŞy_pošts", 
PROP_TYPE_POINTARRAY
, \

69 
	`off£tof
(
PŞySh­e
,
pošts
), off£tof(PŞySh­e,
numpošts
)} \

70 

	)

	@O:\tool\dvs50\lib\prefs.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

22 
	~<¡ršg.h
>

24 
	~"´efs.h
"

25 
	~"widg‘s.h
"

27 
DŸUn™
 
	gËngth_un™
 = 
DIA_UNIT_CENTIMETER
;

28 
DŸUn™
 
	gfÚtsize_un™
 = 
DIA_UNIT_POINT
;

31 
	$´efs_£t_Ëngth_un™
(
gch¬
* 
un™
) {

32 
GLi¡
 *
Çme_li¡
 = 
	`g‘_un™s_Çme_li¡
();

33 
i
;

35 
i
 = 0; 
Çme_li¡
 !ğ
NULL
;‚ame_li¡ = 
	`g_li¡_Ãxt
(name_list), i++) {

36 ià(!
	`¡rcmp
(
un™
, (
gch¬
*è
Çme_li¡
->
d©a
)) {

37 
Ëngth_un™
 = 
i
;

41 
Ëngth_un™
 = 
DIA_UNIT_CENTIMETER
;

42 
	}
}

45 
	$´efs_£t_fÚtsize_un™
(
gch¬
* 
un™
) {

46 
GLi¡
 *
Çme_li¡
 = 
	`g‘_un™s_Çme_li¡
();

47 
i
;

49 
i
 = 0; 
Çme_li¡
 !ğ
NULL
;‚ame_li¡ = 
	`g_li¡_Ãxt
(name_list), i++) {

50 ià(!
	`¡rcmp
(
un™
, (
gch¬
*è
Çme_li¡
->
d©a
)) {

51 
fÚtsize_un™
 = 
i
;

55 
fÚtsize_un™
 = 
DIA_UNIT_POINT
;

56 
	}
}

58 
DŸUn™


59 
	$´efs_g‘_Ëngth_un™
()

61  
Ëngth_un™
;

62 
	}
}

64 
DŸUn™


65 
	$´efs_g‘_fÚtsize_un™
()

67  
fÚtsize_un™
;

68 
	}
}

	@O:\tool\dvs50\lib\prefs.h

21 #iâdeà
PREFS_H


22 
	#PREFS_H


	)

24 #ifdeà
HAVE_CONFIG_H


25 
	~<cÚfig.h
>

28 
	~"dŸty³s.h
"

29 
	~"widg‘s.h
"

31 
DIAVAR
 
´efs_£t_Ëngth_un™
(
gch¬
* 
un™
);

32 
DIAVAR
 
´efs_£t_fÚtsize_un™
(
gch¬
* 
un™
);

34 
DIAVAR
 
DŸUn™
 
´efs_g‘_Ëngth_un™
();

35 
DIAVAR
 
DŸUn™
 
´efs_g‘_fÚtsize_un™
();

	@O:\tool\dvs50\lib\prop_attr.c

25 #ifdeà
HAVE_CONFIG_H


26 
	~<cÚfig.h
>

29 
	~<gtk/gtk.h
>

30 
	~"dŸ_xml.h
"

31 
	~"widg‘s.h
"

32 
	~"´İ”t›s.h
"

33 
	~"´İš‹º®s.h
"

34 
	~"dŸ¬rowchoo£r.h
"

40 
Lše¡yËPrİ”ty
 *

41 
	$lše¡yË´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

42 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

44 
Lše¡yËPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(LinestyleProperty,1);

45 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

46 
´İ
->
¡yË
 = 
LINESTYLE_SOLID
;

47 
´İ
->
dash
 = 0.0;

48  
´İ
;

49 
	}
}

51 
Lše¡yËPrİ”ty
 *

52 
	$lše¡yË´İ_cİy
(
Lše¡yËPrİ”ty
 *
¤c
)

54 
Lše¡yËPrİ”ty
 *
´İ
 =

55 (
Lše¡yËPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

56 
¤c
->
commÚ
.
»asÚ
);

57 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

58 
´İ
->
¡yË
 = 
¤c
->style;

59 
´İ
->
dash
 = 
¤c
->dash;

60  
´İ
;

61 
	}
}

63 
WIDGET
 *

64 
	$lše¡yË´İ_g‘_widg‘
(
Lše¡yËPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

66 
GtkWidg‘
 *
»t
 = 
	`dŸ_lše_¡yË_£ËùÜ_Ãw
();

67 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "value-changed");

68  
»t
;

69 
	}
}

72 
	$lše¡yË´İ_»£t_widg‘
(
Lše¡yËPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

74 
	`dŸ_lše_¡yË_£ËùÜ_£t_lše¡yË
(
	`DIALINESTYLESELECTOR
(
widg‘
),

75 
´İ
->
¡yË
,

76 
´İ
->
dash
);

77 
	}
}

80 
	$lše¡yË´İ_£t_äom_widg‘
(
Lše¡yËPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

82 
	`dŸ_lše_¡yË_£ËùÜ_g‘_lše¡yË
(
	`DIALINESTYLESELECTOR
(
widg‘
),

83 &
´İ
->
¡yË
,

84 &
´İ
->
dash
);

85 
	}
}

88 
	$lše¡yË´İ_lßd
(
Lše¡yËPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

90 
´İ
->
¡yË
 = 
	`d©a_’um
(
d©a
);

91 
´İ
->
dash
 = 1.0;

93 ià(
´İ
->
¡yË
 !ğ
LINESTYLE_SOLID
) {

94 
d©a
 = 
	`d©a_Ãxt
(data);

95 ià(
d©a
)

96 
´İ
->
dash
 = 
	`d©a_»®
(
d©a
);

98 
ObjeùNode
 
obj_node
 = 
©Œ
->
·»Á
;

100 ià((
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength")) &&

101 (
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
)))

102 
´İ
->
dash
 = 
	`d©a_»®
(
d©a
);

105 
	}
}

108 
	$lše¡yË´İ_§ve
(
Lše¡yËPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

110 
	`d©a_add_’um
(
©Œ
, 
´İ
->
¡yË
);

111 
	`d©a_add_»®
(
©Œ
, 
´İ
->
dash
);

118 
	}
}

121 
	$lše¡yË´İ_g‘_äom_off£t
(
Lše¡yËPrİ”ty
 *
´İ
,

122 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

124 
´İ
->
¡yË
 = 
	`¡ruù_memb”
(
ba£
, 
off£t
, 
LšeStyË
);

125 
´İ
->
dash
 = 
	`¡ruù_memb”
(
ba£
, 
off£t2
, 
»®
);

126 
	}
}

129 
	$lše¡yË´İ_£t_äom_off£t
(
Lše¡yËPrİ”ty
 *
´İ
,

130 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

132 
	`¡ruù_memb”
(
ba£
, 
off£t
, 
LšeStyË
èğ
´İ
->
¡yË
;

133 
	`¡ruù_memb”
(
ba£
, 
off£t2
, 
»®
èğ
´İ
->
dash
;

134 
	}
}

136 cÚ¡ 
Prİ”tyOps
 
	glše¡yË´İ_İs
 = {

137 (
Prİ”tyTy³_New
è
lše¡yË´İ_Ãw
,

138 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

139 (
Prİ”tyTy³_Cİy
è
lše¡yË´İ_cİy
,

140 (
Prİ”tyTy³_Lßd
è
lše¡yË´İ_lßd
,

141 (
Prİ”tyTy³_Save
è
lše¡yË´İ_§ve
,

142 (
Prİ”tyTy³_G‘Widg‘
è
lše¡yË´İ_g‘_widg‘
,

143 (
Prİ”tyTy³_Re£tWidg‘
è
lše¡yË´İ_»£t_widg‘
,

144 (
Prİ”tyTy³_S‘FromWidg‘
è
lše¡yË´İ_£t_äom_widg‘
,

146 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

147 (
Prİ”tyTy³_G‘FromOff£t
è
lše¡yË´İ_g‘_äom_off£t
,

148 (
Prİ”tyTy³_S‘FromOff£t
è
lše¡yË´İ_£t_äom_off£t


155 
A¼owPrİ”ty
 *

156 
	$¬row´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

158 
A¼owPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(ArrowProperty,1);

159 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

160 
´İ
->
¬row_d©a
.
ty³
 = 
ARROW_NONE
;

161 
´İ
->
¬row_d©a
.
Ëngth
 = 0.0;

162 
´İ
->
¬row_d©a
.
width
 = 0.0;

163  
´İ
;

164 
	}
}

166 
A¼owPrİ”ty
 *

167 
	$¬row´İ_cİy
(
A¼owPrİ”ty
 *
¤c
)

169 
A¼owPrİ”ty
 *
´İ
 =

170 (
A¼owPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

171 
¤c
->
commÚ
.
»asÚ
);

172 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

173 
´İ
->
¬row_d©a
 = 
¤c
->arrow_data;

174  
´İ
;

175 
	}
}

177 
WIDGET
 *

178 
	$¬row´İ_g‘_widg‘
(
A¼owPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

180 
GtkWidg‘
 *
»t
 = 
	`dŸ_¬row_£ËùÜ_Ãw
();

181 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "value-changed");

182  
»t
;

183 
	}
}

186 
	$¬row´İ_»£t_widg‘
(
A¼owPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

188 
	`dŸ_¬row_£ËùÜ_£t_¬row
(
	`DIA_ARROW_SELECTOR
(
widg‘
),

189 
´İ
->
¬row_d©a
);

190 
	}
}

193 
	$¬row´İ_£t_äom_widg‘
(
A¼owPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

195 
´İ
->
¬row_d©a
 = 
	`dŸ_¬row_£ËùÜ_g‘_¬row
(
	`DIA_ARROW_SELECTOR
(
widg‘
));

196 
	}
}

199 
	$¬row´İ_lßd
(
A¼owPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

204 
´İ
->
¬row_d©a
.
ty³
 = 
	`d©a_’um
(
d©a
);

205 
´İ
->
¬row_d©a
.
Ëngth
 = 
DEFAULT_ARROW_SIZE
;

206 
´İ
->
¬row_d©a
.
width
 = 
DEFAULT_ARROW_SIZE
;

207 ià(
´İ
->
¬row_d©a
.
ty³
 !ğ
ARROW_NONE
) {

208 
ObjeùNode
 
obj_node
 = 
©Œ
->
·»Á
;

209 
gch¬
 *
¡r
 = 
	`g_¡rcÚÿt
(
´İ
->
commÚ
.
Çme
, "_Ëngth", 
NULL
);

210 ià((
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
¡r
)) &&

211 (
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
)))

212 
´İ
->
¬row_d©a
.
Ëngth
 = 
	`d©a_»®
(
d©a
);

213 
	`g_ä“
(
¡r
);

214 
¡r
 = 
	`g_¡rcÚÿt
(
´İ
->
commÚ
.
Çme
, "_width", 
NULL
);

215 ià((
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
¡r
)) &&

216 (
d©a
 = 
	`©Œibu‹_fœ¡_d©a
(
©Œ
)))

217 
´İ
->
¬row_d©a
.
width
 = 
	`d©a_»®
(
d©a
);

218 
	`g_ä“
(
¡r
);

220 
	}
}

223 
	$¬row´İ_§ve
(
A¼owPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

225 
	`d©a_add_’um
(
©Œ
, 
´İ
->
¬row_d©a
.
ty³
);

226 ià(
´İ
->
¬row_d©a
.
ty³
 !ğ
ARROW_NONE
) {

227 
ObjeùNode
 
obj_node
 = 
©Œ
->
·»Á
;

228 
gch¬
 *
¡r
 = 
	`g_¡rcÚÿt
(
´İ
->
commÚ
.
Çme
, "_Ëngth", 
NULL
);

229 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, 
¡r
);

230 
	`g_ä“
(
¡r
);

231 
	`d©a_add_»®
(
©Œ
, 
´İ
->
¬row_d©a
.
Ëngth
);

232 
¡r
 = 
	`g_¡rcÚÿt
(
´İ
->
commÚ
.
Çme
, "_width", 
NULL
);

233 
©Œ
 = 
	`Ãw_©Œibu‹
(
obj_node
, 
¡r
);

234 
	`g_ä“
(
¡r
);

235 
	`d©a_add_»®
(
©Œ
, 
´İ
->
¬row_d©a
.
width
);

237 
	}
}

240 
	$¬row´İ_g‘_äom_off£t
(
A¼owPrİ”ty
 *
´İ
,

241 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

243 
´İ
->
¬row_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
A¼ow
);

244 
	}
}

247 
	$¬row´İ_£t_äom_off£t
(
A¼owPrİ”ty
 *
´İ
,

248 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

250 
	`¡ruù_memb”
(
ba£
,
off£t
,
A¼ow
èğ
´İ
->
¬row_d©a
;

251 
	}
}

253 cÚ¡ 
Prİ”tyOps
 
	g¬row´İ_İs
 = {

254 (
Prİ”tyTy³_New
è
¬row´İ_Ãw
,

255 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

256 (
Prİ”tyTy³_Cİy
è
¬row´İ_cİy
,

257 (
Prİ”tyTy³_Lßd
è
¬row´İ_lßd
,

258 (
Prİ”tyTy³_Save
è
¬row´İ_§ve
,

259 (
Prİ”tyTy³_G‘Widg‘
è
¬row´İ_g‘_widg‘
,

260 (
Prİ”tyTy³_Re£tWidg‘
è
¬row´İ_»£t_widg‘
,

261 (
Prİ”tyTy³_S‘FromWidg‘
è
¬row´İ_£t_äom_widg‘
,

263 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

264 (
Prİ”tyTy³_G‘FromOff£t
è
¬row´İ_g‘_äom_off£t
,

265 (
Prİ”tyTy³_S‘FromOff£t
è
¬row´İ_£t_äom_off£t


272 
CŞÜPrİ”ty
 *

273 
	$cŞÜ´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

275 
CŞÜPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(ColorProperty,1);

276 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

277 
´İ
->
cŞÜ_d©a
.
»d
 = 0.0;

278 
´İ
->
cŞÜ_d©a
.
g»’
 = 0.0;

279 
´İ
->
cŞÜ_d©a
.
blue
 = 1.0;

280  
´İ
;

281 
	}
}

283 
CŞÜPrİ”ty
 *

284 
	$cŞÜ´İ_cİy
(
CŞÜPrİ”ty
 *
¤c
)

286 
CŞÜPrİ”ty
 *
´İ
 =

287 (
CŞÜPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

288 
¤c
->
commÚ
.
»asÚ
);

289 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

290 
´İ
->
cŞÜ_d©a
 = 
¤c
->color_data;

291  
´İ
;

292 
	}
}

294 
WIDGET
 *

295 
	$cŞÜ´İ_g‘_widg‘
(
CŞÜPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

297 
GtkWidg‘
 *
»t
 = 
	`dŸ_cŞÜ_£ËùÜ_Ãw
();

298 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "value-changed");

299  
»t
;

300 
	}
}

303 
	$cŞÜ´İ_»£t_widg‘
(
CŞÜPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

305 
	`dŸ_cŞÜ_£ËùÜ_£t_cŞÜ
(
widg‘
,

306 &
´İ
->
cŞÜ_d©a
);

307 
	}
}

310 
	$cŞÜ´İ_£t_äom_widg‘
(
CŞÜPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

312 
	`dŸ_cŞÜ_£ËùÜ_g‘_cŞÜ
(
widg‘
,

313 &
´İ
->
cŞÜ_d©a
);

314 
	}
}

317 
	$cŞÜ´İ_lßd
(
CŞÜPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

319 
	`d©a_cŞÜ
(
d©a
,&
´İ
->
cŞÜ_d©a
);

320 
	}
}

323 
	$cŞÜ´İ_§ve
(
CŞÜPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

325 
	`d©a_add_cŞÜ
(
©Œ
,&
´İ
->
cŞÜ_d©a
);

326 
	}
}

329 
	$cŞÜ´İ_g‘_äom_off£t
(
CŞÜPrİ”ty
 *
´İ
,

330 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

332 
´İ
->
cŞÜ_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
CŞÜ
);

333 
	}
}

336 
	$cŞÜ´İ_£t_äom_off£t
(
CŞÜPrİ”ty
 *
´İ
,

337 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

339 
	`¡ruù_memb”
(
ba£
,
off£t
,
CŞÜ
èğ
´İ
->
cŞÜ_d©a
;

340 
	}
}

342 cÚ¡ 
Prİ”tyOps
 
	gcŞÜ´İ_İs
 = {

343 (
Prİ”tyTy³_New
è
cŞÜ´İ_Ãw
,

344 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

345 (
Prİ”tyTy³_Cİy
è
cŞÜ´İ_cİy
,

346 (
Prİ”tyTy³_Lßd
è
cŞÜ´İ_lßd
,

347 (
Prİ”tyTy³_Save
è
cŞÜ´İ_§ve
,

348 (
Prİ”tyTy³_G‘Widg‘
è
cŞÜ´İ_g‘_widg‘
,

349 (
Prİ”tyTy³_Re£tWidg‘
è
cŞÜ´İ_»£t_widg‘
,

350 (
Prİ”tyTy³_S‘FromWidg‘
è
cŞÜ´İ_£t_äom_widg‘
,

352 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

353 (
Prİ”tyTy³_G‘FromOff£t
è
cŞÜ´İ_g‘_äom_off£t
,

354 (
Prİ”tyTy³_S‘FromOff£t
è
cŞÜ´İ_£t_äom_off£t


362 
FÚtPrİ”ty
 *

363 
	$fÚrİ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

365 
FÚtPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(FontProperty,1);

366 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

367 
´İ
->
fÚt_d©a
 = 
NULL
;

368  
´İ
;

369 
	}
}

372 
	$fÚrİ_ä“
(
FÚtPrİ”ty
 *
´İ
)

374 ià(
´İ
->
fÚt_d©a
)

375 
	`dŸ_fÚt_uÄef
(
´İ
->
fÚt_d©a
);

376 
	`g_ä“
(
´İ
);

377 
	}
}

379 
FÚtPrİ”ty
 *

380 
	$fÚrİ_cİy
(
FÚtPrİ”ty
 *
¤c
)

382 
FÚtPrİ”ty
 *
´İ
 =

383 (
FÚtPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

384 
¤c
->
commÚ
.
»asÚ
);

385 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

387 ià(
´İ
->
fÚt_d©a
)

388 
	`dŸ_fÚt_uÄef
(
´İ
->
fÚt_d©a
);

389 
´İ
->
fÚt_d©a
 = 
	`dŸ_fÚt_»f
(
¤c
->font_data);

391  
´İ
;

392 
	}
}

394 
WIDGET
 *

395 
	$fÚrİ_g‘_widg‘
(
FÚtPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

397 
GtkWidg‘
 *
»t
 = 
	`dŸ_fÚt_£ËùÜ_Ãw
();

398 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "value-changed");

399  
»t
;

400 
	}
}

403 
	$fÚrİ_»£t_widg‘
(
FÚtPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

405 
	`dŸ_fÚt_£ËùÜ_£t_fÚt
(
	`DIAFONTSELECTOR
(
widg‘
),

406 
´İ
->
fÚt_d©a
);

407 
	}
}

410 
	$fÚrİ_£t_äom_widg‘
(
FÚtPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

412 
´İ
->
fÚt_d©a
 = 
	`dŸ_fÚt_£ËùÜ_g‘_fÚt
(
	`DIAFONTSELECTOR
(
widg‘
));

413 
	}
}

416 
	$fÚrİ_lßd
(
FÚtPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

418 ià(
´İ
->
fÚt_d©a
)

419 
	`dŸ_fÚt_uÄef
(
´İ
->
fÚt_d©a
);

420 
´İ
->
fÚt_d©a
 = 
	`d©a_fÚt
(
d©a
);

421 
	}
}

424 
	$fÚrİ_§ve
(
FÚtPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

426 
	`d©a_add_fÚt
(
©Œ
,
´İ
->
fÚt_d©a
);

427 
	}
}

430 
	$fÚrİ_g‘_äom_off£t
(
FÚtPrİ”ty
 *
´İ
,

431 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

433 ià(
´İ
->
fÚt_d©a
)

434 
	`dŸ_fÚt_uÄef
(
´İ
->
fÚt_d©a
);

435 
´İ
->
fÚt_d©a
 = 
	`dŸ_fÚt_»f
(
	`¡ruù_memb”
(
ba£
,
off£t
,
DŸFÚt
 *));

436 
	}
}

439 
	$fÚrİ_£t_äom_off£t
(
FÚtPrİ”ty
 *
´İ
,

440 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

442 ià(
´İ
->
fÚt_d©a
) {

443 ià(
	`¡ruù_memb”
(
ba£
,
off£t
,
DŸFÚt
 *))

444 
	`dŸ_fÚt_uÄef
(
	`¡ruù_memb”
(
ba£
,
off£t
,
DŸFÚt
 *));

445 
	`¡ruù_memb”
(
ba£
,
off£t
,
DŸFÚt
 *èğ
	`dŸ_fÚt_»f
(
´İ
->
fÚt_d©a
);

447 
	}
}

449 cÚ¡ 
Prİ”tyOps
 
	gfÚrİ_İs
 = {

450 (
Prİ”tyTy³_New
è
fÚrİ_Ãw
,

451 (
Prİ”tyTy³_F»e
è
fÚrİ_ä“
,

452 (
Prİ”tyTy³_Cİy
è
fÚrİ_cİy
,

453 (
Prİ”tyTy³_Lßd
è
fÚrİ_lßd
,

454 (
Prİ”tyTy³_Save
è
fÚrİ_§ve
,

455 (
Prİ”tyTy³_G‘Widg‘
è
fÚrİ_g‘_widg‘
,

456 (
Prİ”tyTy³_Re£tWidg‘
è
fÚrİ_»£t_widg‘
,

457 (
Prİ”tyTy³_S‘FromWidg‘
è
fÚrİ_£t_äom_widg‘
,

459 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

460 (
Prİ”tyTy³_G‘FromOff£t
è
fÚrİ_g‘_äom_off£t
,

461 (
Prİ”tyTy³_S‘FromOff£t
è
fÚrİ_£t_äom_off£t


467 
	$´İ_©Œ_»gi¡”
()

469 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_LINESTYLE
,&
lše¡yË´İ_İs
);

470 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_ARROW
,&
¬row´İ_İs
);

471 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_COLOUR
,&
cŞÜ´İ_İs
);

472 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_FONT
,&
fÚrİ_İs
);

473 
	}
}

	@O:\tool\dvs50\lib\prop_attr.h

25 #iâdeà
PROP_ATTR_H


26 
	#PROP_ATTR_H


	)

28 
	~"´İ”t›s.h
"

29 
	~"dŸ_xml.h
"

32 
Prİ”ty
 
	mcommÚ
;

33 
LšeStyË
 
	m¡yË
;

34 
»®
 
	mdash
;

35 } 
	tLše¡yËPrİ”ty
;

38 
Prİ”ty
 
	mcommÚ
;

39 
A¼ow
 
	m¬row_d©a
;

40 } 
	tA¼owPrİ”ty
;

43 
Prİ”ty
 
	mcommÚ
;

44 
CŞÜ
 
	mcŞÜ_d©a
;

45 } 
	tCŞÜPrİ”ty
;

48 
Prİ”ty
 
	mcommÚ
;

49 
DŸFÚt
 *
	mfÚt_d©a
;

50 } 
	tFÚtPrİ”ty
;

52 
´İ_©Œ_»gi¡”
();

	@O:\tool\dvs50\lib\prop_basic.c

26 #ifdeà
HAVE_CONFIG_H


27 
	~<cÚfig.h
>

30 
	~<¡ršg.h
>

32 
	~<gtk/gtk.h
>

33 
	#WIDGET
 
GtkWidg‘


	)

34 
	~"´İ”t›s.h
"

35 
	~"´İ_basic.h
"

36 
	~"´İš‹º®s.h
"

39 cÚ¡ 
gch¬
 *
	mÇme
;

40 cÚ¡ 
gch¬
 *
	mty³
;

41 } 
	tPrİMÚik”
;

43 
gušt


44 
	$desc_hash_hash
(cÚ¡ 
PrİMÚik”
 *
desc
)

46 
gušt
 
Çme_hash
 = 
	`g_¡r_hash
(
desc
->
Çme
);

47 
gušt
 
ty³_hash
 = 
	`g_¡r_hash
(
desc
->
ty³
);

49  (
Çme_hash
 ^ ((
ty³_hash
 & 0xFFFF0000) >> 16) ^

50 ((
ty³_hash
 & 0x0000FFFF) << 16) ^ (type_hash));

51 
	}
}

53 
gušt


54 
	$desc_hash_com·»
(cÚ¡ 
PrİMÚik”
 *
a
, cÚ¡ PrİMÚik” *
b
)

56  ((0 =ğ
	`¡rcmp
(
a
->
Çme
,
b
->Çme)è&& (0 =ğ¡rcmp×->
ty³
,b->type)));

57 
	}
}

59 
Prİ”ty
 *

60 
	$make_Ãw_´İ
(cÚ¡ *
Çme
, 
Prİ”tyTy³
 
ty³
, 
gušt
 
æags
)

62 
GHashTabË
 *
hash
 = 
NULL
;

63 
PrİMÚik”
 *
mÚik”
 = 
	`g_Ãw0
(PropMoniker, 1);

64 
PrİDesütiÚ
 *
desü
;

66 
mÚik”
->
Çme
 =‚ame;

67 
mÚik”
->
ty³
 =ype;

69 ià(!
hash
èhash = 
	`g_hash_bË_Ãw
((
GHashFunc
)
desc_hash_hash
,

70 (
GCom·»Func
)
desc_hash_com·»
);

72 
desü
 = 
	`g_hash_bË_lookup
(
hash
,
mÚik”
);

73 ià(
desü
) {

74 
	`g_ä“
(
mÚik”
);

76 
desü
 = 
	`g_Ãw0
(
PrİDesütiÚ
,1);

77 
desü
->
Çme
 =‚ame;

78 
desü
->
ty³
 =ype;

79 
desü
->
æags
 = flags;

80 
desü
->
qu¬k
 = 
	`g_qu¬k_äom_¡©ic_¡ršg
(desü->
Çme
);

81 
desü
->
ty³_qu¬k
 = 
	`g_qu¬k_äom_¡©ic_¡ršg
(desü->
ty³
);

82 
desü
->
İs
 = 
	`´İ_ty³_g‘_İs
(
ty³
);

83 
	`g_hash_bË_š£¹
(
hash
,
mÚik”
,
desü
);

86  
desü
->
İs
->
	`Ãw_´İ
(desü,
pdp_syÁh‘ic
);

87 
	}
}

97 
Prİ”ty
 *

98 
	$commÚ´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

102  
pdesc
->
İs
->
	`Ãw_´İ
Õdesc,
»asÚ
);

103 
	}
}

106 
	$commÚ´İ_ä“
(
Prİ”ty
 *
´İ
)

108 
´İ
->
»®_İs
->
	`ä“
(prop);

109 
	}
}

111 
Prİ”ty
 *

112 
	$commÚ´İ_cİy
(
Prİ”ty
 *
¤c
)

114 
Prİ”ty
 *
´İ
 = 
¤c
->
»®_İs
->
	`cİy
(src);

115 
¤c
->
ex³r›nû
 |ğ
PXP_COPIED
;

116 
´İ
->
ex³r›nû
 |ğ
PXP_COPY
;

117  
´İ
;

118 
	}
}

120 
WIDGET
 *

121 
	$commÚ´İ_g‘_widg‘
(
Prİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

123 
WIDGET
 *
wid
 = 
´İ
->
»®_İs
->
	`g‘_widg‘
Õrİ,
dŸlog
);

124 
´İ
->
ex³r›nû
 |ğ
PXP_GET_WIDGET
;

125  
wid
;

126 
	}
}

129 
	$commÚ´İ_»£t_widg‘
(
Prİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

131 
´İ
->
»®_İs
->
	`»£t_widg‘
Õrİ,
widg‘
);

132 
´İ
->
ex³r›nû
 |ğ
PXP_RESET_WIDGET
;

133 
	}
}

136 
	$commÚ´İ_£t_äom_widg‘
(
Prİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

138 
´İ
->
»®_İs
->
	`£t_äom_widg‘
Õrİ,
widg‘
);

139 
´İ
->
ex³r›nû
 |ğ
PXP_SET_FROM_WIDGET
;

140 
	}
}

143 
	$commÚ´İ_lßd
(
Prİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

145 
´İ
->
»®_İs
->
	`lßd
Õrİ,
©Œ
,
d©a
);

146 
´İ
->
ex³r›nû
 |ğ
PXP_LOADED
;

147 
	}
}

150 
	$commÚ´İ_§ve
(
Prİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

152 
´İ
->
»®_İs
->
	`§ve
Õrİ,
©Œ
);

153 
´İ
->
ex³r›nû
 |ğ
PXP_SAVED
;

154 
	}
}

156 
gboŞ—n


157 
	$commÚ´İ_ÿn_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
, cÚ¡ PrİDesütiÚ *
pd2
)

159  
pd1
->
İs
->
	`ÿn_m”ge
Õd1,
pd2
);

160 
	}
}

163 
	$commÚ´İ_g‘_äom_off£t
(cÚ¡ 
Prİ”ty
 *
´İ
,

164 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

166 
´İ
->
»®_İs
->
	`g‘_äom_off£t
Õrİ,
ba£
,
off£t
,
off£t2
);

167 ((
Prİ”ty
 *)
´İ
)->
ex³r›nû
 |ğ
PXP_GFO
;

168 
	}
}

171 
	$commÚ´İ_£t_äom_off£t
(
Prİ”ty
 *
´İ
,

172 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

174 
´İ
->
»®_İs
->
	`£t_äom_off£t
Õrİ,
ba£
,
off£t
,
off£t2
);

175 
´İ
->
ex³r›nû
 |ğ
PXP_SFO
;

176 
	}
}

178 cÚ¡ 
Prİ”tyOps
 
	gcommÚ´İ_İs
 = {

179 (
Prİ”tyTy³_New
è
commÚ´İ_Ãw
,

180 (
Prİ”tyTy³_F»e
è
commÚ´İ_ä“
,

181 (
Prİ”tyTy³_Cİy
è
commÚ´İ_cİy
,

182 (
Prİ”tyTy³_Lßd
è
commÚ´İ_lßd
,

183 (
Prİ”tyTy³_Save
è
commÚ´İ_§ve
,

184 (
Prİ”tyTy³_G‘Widg‘
è
commÚ´İ_g‘_widg‘
,

185 (
Prİ”tyTy³_Re£tWidg‘
è
commÚ´İ_»£t_widg‘
,

186 (
Prİ”tyTy³_S‘FromWidg‘
è
commÚ´İ_£t_äom_widg‘
,

188 (
Prİ”tyTy³_CªM”ge
è
commÚ´İ_ÿn_m”ge
,

189 (
Prİ”tyTy³_G‘FromOff£t
è
commÚ´İ_g‘_äom_off£t
,

190 (
Prİ”tyTy³_S‘FromOff£t
è
commÚ´İ_£t_äom_off£t


195 
	$š™Ÿlize_´İ”ty
(
Prİ”ty
 *
´İ
, cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

196 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

198 
´İ
->
»asÚ
 =„eason;

199 
´İ
->
Çme
 = 
pdesc
->name;

200 
´İ
->
Çme_qu¬k
 = 
pdesc
->
qu¬k
;

201 ià(!
´İ
->
Çme_qu¬k
) {

202 
´İ
->
Çme_qu¬k
 = 
	`g_qu¬k_äom_¡ršg
Õrİ->
Çme
);

203 
	`g_”rÜ
("%s:†ate quark construction for…roperty %s",

204 
G_STRFUNC
,
´İ
->
Çme
);

206 
´İ
->
ty³
 = 
pdesc
->type;

207 
´İ
->
ty³_qu¬k
 = 
pdesc
->type_quark;

208 
´İ
->
İs
 = &
commÚ´İ_İs
;

209 
´İ
->
»®_İs
 = 
pdesc
->
İs
;

211 
´İ
->
desü
 = 
pdesc
;

212 
´İ
->
»asÚ
 =„eason;

213 
´İ
->
exŒa_d©a
 = 
pdesc
->extra_data;

215 
´İ
->
ev’t_hªdËr
 = 
pdesc
->event_handler;

217 
´İ
->
ex³r›nû
 = 0;

218 
	}
}

220 
	$cİy_š™_´İ”ty
(
Prİ”ty
 *
de¡
, cÚ¡ Prİ”ty *
¤c
)

222 
	`memıy
(
de¡
,
¤c
,(*dest));

223 
de¡
->
ex³r›nû
 = 0;

224 
	}
}

233 
NoİPrİ”ty
 *

234 
	$noİ´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

236 
NoİPrİ”ty
 *
´İ
 = 
	`g_Ãw
(NoopProperty,1);

237 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

238  
´İ
;

239 
	}
}

242 
	$noİ´İ_ä“
(
NoİPrİ”ty
 *
´İ
)

244 
	`g_ä“
(
´İ
);

245 
	}
}

247 
NoİPrİ”ty
 *

248 
	$noİ´İ_cİy
(
NoİPrİ”ty
 *
¤c
)

250 
NoİPrİ”ty
 *
´İ
 =

251 (
NoİPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

252 
¤c
->
commÚ
.
»asÚ
);

253 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

254  
´İ
;

256 
	}
}

258 
WIDGET
 *

259 
	$noİ´İ_g‘_widg‘
(
NoİPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

261  
NULL
;

262 
	}
}

265 
	$noİ´İ_»£t_widg‘
(
NoİPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

267 
	}
}

270 
	$noİ´İ_£t_äom_widg‘
(
NoİPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

272 
	}
}

275 
	$noİ´İ_lßd
(
NoİPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

277 
	}
}

280 
	$noİ´İ_§ve
(
NoİPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

282 
	}
}

284 
gboŞ—n


285 
	$noİ´İ_ÿn_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
, cÚ¡ PrİDesütiÚ *
pd2
)

287  
TRUE
;

288 
	}
}

290 
gboŞ—n


291 
	$noİ´İ_ÿÂÙ_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
, cÚ¡ PrİDesütiÚ *
pd2
)

293  
TRUE
;

294 
	}
}

297 
	$noİ´İ_g‘_äom_off£t
(cÚ¡ 
NoİPrİ”ty
 *
´İ
,

298 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

300 
	}
}

303 
	$noİ´İ_£t_äom_off£t
(
NoİPrİ”ty
 *
´İ
,

304 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

306 
	}
}

308 cÚ¡ 
Prİ”tyOps
 
	gnoİ´İ_İs
 = {

309 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

310 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

311 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

312 (
Prİ”tyTy³_Lßd
è
noİ´İ_lßd
,

313 (
Prİ”tyTy³_Save
è
noİ´İ_§ve
,

314 (
Prİ”tyTy³_G‘Widg‘
è
noİ´İ_g‘_widg‘
,

315 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

316 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

318 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

319 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

320 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


328 
Inv®idPrİ”ty
 *

329 
	$šv®id´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

330 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

332 
	`g_as£¹_nÙ_»ached
();

333  
NULL
;

334 
	}
}

337 
	$šv®id´İ_ä“
(
Inv®idPrİ”ty
 *
´İ
)

339 
	`g_as£¹_nÙ_»ached
();

340 
	}
}

342 
Inv®idPrİ”ty
 *

343 
	$šv®id´İ_cİy
(
Inv®idPrİ”ty
 *
¤c
)

345 
	`g_as£¹_nÙ_»ached
();

346  
NULL
;

347 
	}
}

349 
WIDGET
 *

350 
	$šv®id´İ_g‘_widg‘
(
Inv®idPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

352 
	`g_as£¹_nÙ_»ached
();

353  
NULL
;

354 
	}
}

357 
	$šv®id´İ_»£t_widg‘
(
Inv®idPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

359 
	`g_as£¹_nÙ_»ached
();

360 
	}
}

363 
	$šv®id´İ_£t_äom_widg‘
(
Inv®idPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

365 
	`g_as£¹_nÙ_»ached
();

366 
	}
}

369 
	$šv®id´İ_lßd
(
Inv®idPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

371 
	`g_as£¹_nÙ_»ached
();

372 
	}
}

375 
	$šv®id´İ_§ve
(
Inv®idPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

377 
	`g_as£¹_nÙ_»ached
();

378 
	}
}

380 
gboŞ—n


381 
	$šv®id´İ_ÿn_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
, cÚ¡ PrİDesütiÚ *
pd2
)

383 
	`g_as£¹_nÙ_»ached
();

384  
TRUE
;

385 
	}
}

388 
	$šv®id´İ_g‘_äom_off£t
(cÚ¡ 
Inv®idPrİ”ty
 *
´İ
,

389 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

391 
	`g_as£¹_nÙ_»ached
();

392 
	}
}

395 
	$šv®id´İ_£t_äom_off£t
(
Inv®idPrİ”ty
 *
´İ
,

396 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

398 
	`g_as£¹_nÙ_»ached
();

399 
	}
}

401 cÚ¡ 
Prİ”tyOps
 
	gšv®id´İ_İs
 = {

402 (
Prİ”tyTy³_New
è
šv®id´İ_Ãw
,

403 (
Prİ”tyTy³_F»e
è
šv®id´İ_ä“
,

404 (
Prİ”tyTy³_Cİy
è
šv®id´İ_cİy
,

405 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

406 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

407 (
Prİ”tyTy³_G‘Widg‘
è
šv®id´İ_g‘_widg‘
,

408 (
Prİ”tyTy³_Re£tWidg‘
è
šv®id´İ_»£t_widg‘
,

409 (
Prİ”tyTy³_S‘FromWidg‘
è
šv®id´İ_£t_äom_widg‘
,

411 (
Prİ”tyTy³_CªM”ge
è
šv®id´İ_ÿn_m”ge
,

412 (
Prİ”tyTy³_G‘FromOff£t
è
šv®id´İ_g‘_äom_off£t
,

413 (
Prİ”tyTy³_S‘FromOff£t
è
šv®id´İ_£t_äom_off£t


421 
Unim¶em’‹dPrİ”ty
 *

422 
	$unim¶em’‹d´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

423 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

425 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
pdesc
->
Çme
);

426  
NULL
;

427 
	}
}

430 
	$unim¶em’‹d´İ_ä“
(
Unim¶em’‹dPrİ”ty
 *
´İ
)

432 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
´İ
->
commÚ
.
desü
->
Çme
);

433 
	}
}

435 
Unim¶em’‹dPrİ”ty
 *

436 
	$unim¶em’‹d´İ_cİy
(
Unim¶em’‹dPrİ”ty
 *
¤c
)

438 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
¤c
->
commÚ
.
desü
->
Çme
);

439  
NULL
;

440 
	}
}

442 
WIDGET
 *

443 
	$unim¶em’‹d´İ_g‘_widg‘
(
Unim¶em’‹dPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

445 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
´İ
->
commÚ
.
desü
->
Çme
);

446  
NULL
;

447 
	}
}

450 
	$unim¶em’‹d´İ_»£t_widg‘
(
Unim¶em’‹dPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

452 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
´İ
->
commÚ
.
desü
->
Çme
);

453 
	}
}

456 
	$unim¶em’‹d´İ_£t_äom_widg‘
(
Unim¶em’‹dPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

458 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
´İ
->
commÚ
.
desü
->
Çme
);

459 
	}
}

462 
	$unim¶em’‹d´İ_lßd
(
Unim¶em’‹dPrİ”ty
 *
´İ
,

463 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

465 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
´İ
->
commÚ
.
desü
->
Çme
);

466 
	}
}

469 
	$unim¶em’‹d´İ_§ve
(
Unim¶em’‹dPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

471 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
´İ
->
commÚ
.
desü
->
Çme
);

472 
	}
}

474 
gboŞ—n


475 
	$unim¶em’‹d´İ_ÿn_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
, cÚ¡ PrİDesütiÚ *
pd2
)

477 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s/%s",
G_STRFUNC
,
pd1
->
Çme
,
pd2
->name);

478  
FALSE
;

479 
	}
}

482 
	$unim¶em’‹d´İ_g‘_äom_off£t
(cÚ¡ 
Unim¶em’‹dPrİ”ty
 *
´İ
,

483 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

485 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
´İ
->
commÚ
.
desü
->
Çme
);

486 
	}
}

489 
	$unim¶em’‹d´İ_£t_äom_off£t
(
Unim¶em’‹dPrİ”ty
 *
´İ
,

490 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

492 
	`g_w¬nšg
("%s: fÜ…rİ”ty %s",
G_STRFUNC
,
´İ
->
commÚ
.
desü
->
Çme
);

493 
	}
}

495 cÚ¡ 
Prİ”tyOps
 
	gunim¶em’‹d´İ_İs
 = {

496 (
Prİ”tyTy³_New
è
unim¶em’‹d´İ_Ãw
,

497 (
Prİ”tyTy³_F»e
è
unim¶em’‹d´İ_ä“
,

498 (
Prİ”tyTy³_Cİy
è
unim¶em’‹d´İ_cİy
,

499 (
Prİ”tyTy³_Lßd
è
unim¶em’‹d´İ_lßd
,

500 (
Prİ”tyTy³_Save
è
unim¶em’‹d´İ_§ve
,

501 (
Prİ”tyTy³_G‘Widg‘
è
unim¶em’‹d´İ_g‘_widg‘
,

502 (
Prİ”tyTy³_Re£tWidg‘
è
unim¶em’‹d´İ_»£t_widg‘
,

503 (
Prİ”tyTy³_S‘FromWidg‘
è
unim¶em’‹d´İ_£t_äom_widg‘
,

505 (
Prİ”tyTy³_CªM”ge
è
unim¶em’‹d´İ_ÿn_m”ge
,

506 (
Prİ”tyTy³_G‘FromOff£t
è
unim¶em’‹d´İ_g‘_äom_off£t
,

507 (
Prİ”tyTy³_S‘FromOff£t
è
unim¶em’‹d´İ_£t_äom_off£t


513 
	$´İ_basic_»gi¡”
()

515 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_NOOP
,&
noİ´İ_İs
);

516 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_INVALID
,&
šv®id´İ_İs
);

517 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_UNIMPLEMENTED
,&
unim¶em’‹d´İ_İs
);

518 
	}
}

	@O:\tool\dvs50\lib\prop_basic.h

26 #iâdeà
PROP_BASIC_H


27 
	#PROP_BASIC_H


	)

29 
	~"´İ”t›s.h
"

30 
	~"dŸ_xml.h
"

32 
š™Ÿlize_´İ”ty
(
Prİ”ty
 *
´İ
, cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

33 
PrİDescToPrİP»diÿ‹
 
»asÚ
);

34 
cİy_š™_´İ”ty
(
Prİ”ty
 *
de¡
, cÚ¡ Prİ”ty *
¤c
);

37 
Prİ”ty
 
	mcommÚ
;

38 } 
	tNoİPrİ”ty
;

40 
NoİPrİ”ty
 *
noİ´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

41 
PrİDescToPrİP»diÿ‹
 
»asÚ
);

42 
noİ´İ_ä“
(
NoİPrİ”ty
 *
´İ
);

43 
NoİPrİ”ty
 *
noİ´İ_cİy
(NoİPrİ”ty *
¤c
);

44 
WIDGET
 *
noİ´İ_g‘_widg‘
(
NoİPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
);

45 
noİ´İ_»£t_widg‘
(
NoİPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
);

46 
noİ´İ_£t_äom_widg‘
(
NoİPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
);

47 
noİ´İ_lßd
(
NoİPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
);

48 
noİ´İ_§ve
(
NoİPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
);

49 
gboŞ—n
 
noİ´İ_ÿn_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
,

50 cÚ¡ 
PrİDesütiÚ
 *
pd2
);

51 
gboŞ—n
 
noİ´İ_ÿÂÙ_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
,

52 cÚ¡ 
PrİDesütiÚ
 *
pd2
);

53 
noİ´İ_g‘_äom_off£t
(cÚ¡ 
NoİPrİ”ty
 *
´İ
,

54 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
);

55 
noİ´İ_£t_äom_off£t
(
NoİPrİ”ty
 *
´İ
,

56 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
);

59 
Prİ”ty
 
	mcommÚ
;

60 } 
	tInv®idPrİ”ty
;

62 
Inv®idPrİ”ty
 *
šv®id´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

63 
PrİDescToPrİP»diÿ‹
 
»asÚ
);

64 
šv®id´İ_ä“
(
Inv®idPrİ”ty
 *
´İ
);

65 
Inv®idPrİ”ty
 *
šv®id´İ_cİy
(Inv®idPrİ”ty *
¤c
);

66 
WIDGET
 *
šv®id´İ_g‘_widg‘
(
Inv®idPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
);

67 
šv®id´İ_»£t_widg‘
(
Inv®idPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
);

68 
šv®id´İ_£t_äom_widg‘
(
Inv®idPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
);

69 
šv®id´İ_lßd
(
Inv®idPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
,

70 
D©aNode
 
d©a
);

71 
šv®id´İ_§ve
(
Inv®idPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
);

72 
gboŞ—n
 
šv®id´İ_ÿn_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
,

73 cÚ¡ 
PrİDesütiÚ
 *
pd2
);

74 
šv®id´İ_g‘_äom_off£t
(cÚ¡ 
Inv®idPrİ”ty
 *
´İ
,

75 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
);

76 
šv®id´İ_£t_äom_off£t
(
Inv®idPrİ”ty
 *
´İ
,

77 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
);

79 
Prİ”ty
 
	mcommÚ
;

80 } 
	tUnim¶em’‹dPrİ”ty
;

82 
Unim¶em’‹dPrİ”ty
 *
unim¶em’‹d´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

83 
PrİDescToPrİP»diÿ‹
 
»asÚ
);

84 
unim¶em’‹d´İ_ä“
(
Unim¶em’‹dPrİ”ty
 *
´İ
);

85 
Unim¶em’‹dPrİ”ty
 *
unim¶em’‹d´İ_cİy
(Unim¶em’‹dPrİ”ty *
¤c
);

86 
WIDGET
 *
unim¶em’‹d´İ_g‘_widg‘
(
Unim¶em’‹dPrİ”ty
 *
´İ
,

87 
PrİDŸlog
 *
dŸlog
);

88 
unim¶em’‹d´İ_»£t_widg‘
(
Unim¶em’‹dPrİ”ty
 *
´İ
,

89 
WIDGET
 *
widg‘
);

90 
unim¶em’‹d´İ_£t_äom_widg‘
(
Unim¶em’‹dPrİ”ty
 *
´İ
,

91 
WIDGET
 *
widg‘
);

92 
unim¶em’‹d´İ_lßd
(
Unim¶em’‹dPrİ”ty
 *
´İ
,

93 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
);

94 
unim¶em’‹d´İ_§ve
(
Unim¶em’‹dPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
);

95 
gboŞ—n
 
unim¶em’‹d´İ_ÿn_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
,

96 cÚ¡ 
PrİDesütiÚ
 *
pd2
);

97 
unim¶em’‹d´İ_g‘_äom_off£t
(cÚ¡ 
Unim¶em’‹dPrİ”ty
 *
´İ
,

98 *
ba£
,

99 
gušt
 
off£t
, gušˆ
off£t2
);

101 
unim¶em’‹d´İ_£t_äom_off£t
(
Unim¶em’‹dPrİ”ty
 *
´İ
,

102 *
ba£
,

103 
gušt
 
off£t
, gušˆ
off£t2
);

104 
DIAVAR
 
´İ_basic_»gi¡”
();

	@O:\tool\dvs50\lib\prop_dict.c

26 #ifdeà
HAVE_CONFIG_H


27 
	~<cÚfig.h
>

30 
	~<gtk/gtk.h
>

31 
	#WIDGET
 
GtkWidg‘


	)

32 
	~"widg‘s.h
"

33 
	~"´İ”t›s.h
"

34 
	~"´İš‹º®s.h
"

36 
	s_W–lKnownKeys
 {

37 cÚ¡ 
gch¬
 *
	mÇme
;

38 cÚ¡ 
gch¬
 *
	mdi¥Ïy_Çme
;

39 } 
	tW–lKnownKeys
;

42 
W–lKnownKeys
 
	g_w–l_known
[] = {

43 { "authÜ", 
N_
("Author") },

44 { "id", 
N_
("Identifier") },

45 { "ü—tiÚ", 
N_
("Creation date") },

46 { "modifiÿtiÚ", 
N_
("Modification date") },

47 { "u¾", 
N_
("URL") },

48 { 
NULL
, NULL }

51 
DiùPrİ”ty
 *

52 
	$diù´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

54 
DiùPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(DictProperty,1);

56 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

57 
´İ
->
diù
 = 
	`g_hash_bË_Ãw_fuÎ
 (
g_¡r_hash
, 
g_¡r_equ®
, 
g_ä“
, g_free);

58  
´İ
;

59 
	}
}

62 
	$diù´İ_ä“
(
DiùPrİ”ty
 *
´İ
)

64 ià(
´İ
->
diù
)

65 
	`g_hash_bË_de¡roy
(
´İ
->
diù
);

66 
	`g_ä“
(
´İ
);

67 
	}
}

70 
	$_keyv®ue_cİy
 (
gpoš‹r
 
key
,

71 
gpoš‹r
 
v®ue
,

72 
gpoš‹r
 
u£r_d©a
)

74 
gch¬
 *
Çme
 = (gch¬ *)
key
;

75 
gch¬
 *
v®
 = (gch¬ *)
v®ue
;

76 
GHashTabË
 *
de¡
 = (GHashTabË *)
u£r_d©a
;

78 
	`g_hash_bË_š£¹
 (
de¡
, 
	`g_¡rdup
 (
Çme
), g_¡rdu°(
v®
));

79 
	}
}

80 
DiùPrİ”ty
 *

81 
	$diù´İ_cİy
(
DiùPrİ”ty
 *
¤c
)

83 
DiùPrİ”ty
 *
´İ
 =

84 (
DiùPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

85 
¤c
->
commÚ
.
»asÚ
);

86 ià(
¤c
->
diù
)

87 
	`g_hash_bË_fÜ—ch
 (
¤c
->
diù
, 
_keyv®ue_cİy
, 
´İ
->dict);

89  
´İ
;

90 
	}
}

93 
	$diù´İ_lßd
(
DiùPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

95 
D©aNode
 
kv
;

96 
gušt
 
nv®s
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

97 ià(!
nv®s
)

100 
kv
 = 
	`©Œibu‹_fœ¡_d©a
 (
d©a
);

101 
kv
) {

102 
xmlCh¬
 *
key
 = 
	`xmlG‘Prİ
(
kv
, (const xmlChar *)"name");

104 ià(
key
) {

105 
gch¬
 *
v®ue
 = 
	`d©a_¡ršg
(
	`©Œibu‹_fœ¡_d©a
 (
kv
));

106 ià(
v®ue
)

107 
	`g_hash_bË_š£¹
 (
´İ
->
diù
, 
	`g_¡rdup
((
gch¬
 *)
key
), 
v®ue
);

109 
	`g_w¬nšg
 ("Dictionary key missing");

111 
kv
 = 
	`d©a_Ãxt
(kv);

113 
	}
}

115 
GHashTabË
 *

116 
	$_hash_dup
 (cÚ¡ 
GHashTabË
 *
¤c
)

118 
GHashTabË
 *
de¡
 = 
NULL
;

119 ià(
¤c
) {

120 
de¡
 = 
	`g_hash_bË_Ãw_fuÎ
 (
g_¡r_hash
, 
g_¡r_equ®
, 
g_ä“
, g_free);

121 
	`g_hash_bË_fÜ—ch
 ((
GHashTabË
 *)
¤c
, 
_keyv®ue_cİy
, 
de¡
);

123  
de¡
;

124 
	}
}

127 
	$_keyv®ue_§ve
 (
gpoš‹r
 
key
,

128 
gpoš‹r
 
v®ue
,

129 
gpoš‹r
 
u£r_d©a
)

131 
gch¬
 *
Çme
 = (gch¬ *)
key
;

132 
gch¬
 *
v®
 = (gch¬ *)
v®ue
;

133 
ObjeùNode
 
node
 = (ObjeùNode)
u£r_d©a
;

135 
	`d©a_add_¡ršg
(
	`Ãw_©Œibu‹
(
node
, 
Çme
), 
v®
);

136 
	}
}

138 
	$diù´İ_§ve
(
DiùPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

140 
ObjeùNode
 
compos™e
 = 
	`d©a_add_compos™e
(
©Œ
, "dict");

141 ià(
´İ
->
diù
)

142 
	`g_hash_bË_fÜ—ch
 (
´İ
->
diù
, 
_keyv®ue_§ve
, 
compos™e
);

143 
	}
}

146 
	$diù´İ_g‘_äom_off£t
(
DiùPrİ”ty
 *
´İ
,

147 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

149 
´İ
->
diù
 = 
	`_hash_dup
 (
	`¡ruù_memb”
(
ba£
,
off£t
,
GHashTabË
 *));

150 
	}
}

153 
	$diù´İ_£t_äom_off£t
(
DiùPrİ”ty
 *
´İ
,

154 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

156 
GHashTabË
 *
de¡
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,GHashTable *);

157 ià(
de¡
)

158 
	`g_hash_bË_de¡roy
 (
de¡
);

159 
	`¡ruù_memb”
(
ba£
,
off£t
, 
GHashTabË
 *èğ
	`_hash_dup
 (
´İ
->
diù
);

160 
	}
}

162 cÚ¡ 
Prİ”tyOps
 
	gdiù´İ_İs
 = {

163 (
Prİ”tyTy³_New
è
diù´İ_Ãw
,

164 (
Prİ”tyTy³_F»e
è
diù´İ_ä“
,

165 (
Prİ”tyTy³_Cİy
è
diù´İ_cİy
,

166 (
Prİ”tyTy³_Lßd
è
diù´İ_lßd
,

167 (
Prİ”tyTy³_Save
è
diù´İ_§ve
,

168 (
Prİ”tyTy³_G‘Widg‘
è
noİ´İ_g‘_widg‘
,

169 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

170 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

172 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

173 (
Prİ”tyTy³_G‘FromOff£t
è
diù´İ_g‘_äom_off£t
,

174 (
Prİ”tyTy³_S‘FromOff£t
è
diù´İ_£t_äom_off£t


178 
	$´İ_diùty³s_»gi¡”
()

180 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_DICT
, &
diù´İ_İs
);

181 
	}
}

183 
GHashTabË
 *

184 
	$d©a_diù
 (
D©aNode
 
d©a
)

186 
GHashTabË
 *
ht
 = 
NULL
;

187 
nv®s
 = 
	`©Œibu‹_num_d©a
 (
d©a
);

189 ià(
nv®s
) {

190 
D©aNode
 
kv
 = 
	`©Œibu‹_fœ¡_d©a
 (
d©a
);

191 
gch¬
 *
v®
 = 
NULL
;

193 
ht
 = 
	`g_hash_bË_Ãw_fuÎ
 (
g_¡r_hash
, 
g_¡r_equ®
, 
g_ä“
, g_free);

194 
kv
) {

195 
xmlCh¬
 *
key
 = 
	`xmlG‘Prİ
(
kv
, (const xmlChar *)"name");

197 ià(
key
) {

198 
v®
 = 
	`d©a_¡ršg
 (
	`©Œibu‹_fœ¡_d©a
 (
kv
));

199 ià(
v®
)

200 
	`g_hash_bË_š£¹
 (
ht
, 
	`g_¡rdup
 ((
gch¬
 *)
key
), 
v®
);

201 
	`xmlF»e
 (
key
);

203 
kv
 = 
	`d©a_Ãxt
 (kv);

206  
ht
;

207 
	}
}

210 
	$d©a_add_diù
 (
A‰ribu‹Node
 
©Œ
, 
GHashTabË
 *
d©a
)

212 
ObjeùNode
 
compos™e
 = 
	`d©a_add_compos™e
(
©Œ
, "dict");

214 
	`g_hash_bË_fÜ—ch
 (
d©a
, 
_keyv®ue_§ve
, 
compos™e
);

215 
	}
}

	@O:\tool\dvs50\lib\prop_dict.h

26 #iâdeà
PROP_DICT_H


27 
	#PROP_DICT_H


	)

29 
	~"´İ”t›s.h
"

30 
	~"dŸ_xml.h
"

33 
Prİ”ty
 
	mcommÚ
;

34 
GHashTabË
 *
	mdiù
;

35 } 
	tDiùPrİ”ty
;

37 
DIAVAR
 
´İ_diùty³s_»gi¡”
();

	@O:\tool\dvs50\lib\prop_geomtypes.c

25 #ifdeà
HAVE_CONFIG_H


26 
	~<cÚfig.h
>

29 
	~<¡ršg.h
>

31 
	~<gtk/gtk.h
>

32 
	#WIDGET
 
GtkWidg‘


	)

33 
	~"widg‘s.h
"

34 
	~"´İ”t›s.h
"

35 
	~"´İš‹º®s.h
"

36 
	~"geom‘ry.h
"

37 
	~"cÚÅošt_lše.h
"

38 
	~"´İ_geomty³s.h
"

39 
	~"´efs.h
"

41 
fÚtsiz•rİ_»£t_widg‘
(
FÚtsizePrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
);

47 
R—lPrİ”ty
 *

48 
	$»®´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

50 
R—lPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(RealProperty,1);

51 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

52 
´İ
->
»®_d©a
 = 0.0;

53  
´İ
;

54 
	}
}

56 
R—lPrİ”ty
 *

57 
	$»®´İ_cİy
(
R—lPrİ”ty
 *
¤c
)

59 
R—lPrİ”ty
 *
´İ
 =

60 (
R—lPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

61 
¤c
->
commÚ
.
»asÚ
);

62 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

63 
´İ
->
»®_d©a
 = 
¤c
->real_data;

64  
´İ
;

65 
	}
}

67 
WIDGET
 *

68 
	$»®´İ_g‘_widg‘
(
R—lPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

70 
GtkAdju¡m’t
 *
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(
´İ
->
»®_d©a
,

71 
G_MINFLOAT
,

72 
G_MAXFLOAT
,

74 
GtkWidg‘
 *
»t
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 1.0, 2);

75 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
»t
),
TRUE
);

76 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "value_changed");

78  
»t
;

79 
	}
}

82 
	$»®´İ_»£t_widg‘
(
R—lPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

84 
GtkAdju¡m’t
 *
adj
;

85 ià(
´İ
->
commÚ
.
exŒa_d©a
) {

86 
PrİNumD©a
 *
numd©a
 = 
´İ
->
commÚ
.
exŒa_d©a
;

87 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(
´İ
->
»®_d©a
,

88 
numd©a
->
mš
,‚umd©a->
max
,

89 
numd©a
->
¡•
,

90 10.0 * 
numd©a
->
¡•
, 0));

92 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(
´İ
->
»®_d©a
,

93 
G_MINFLOAT
, 
G_MAXFLOAT
,

96 
	`gtk_¥š_bu‰Ú_£t_adju¡m’t
(
	`GTK_SPIN_BUTTON
(
widg‘
), 
adj
);

97 
	}
}

100 
	$»®´İ_£t_äom_widg‘
(
R—lPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

102 
´İ
->
»®_d©a
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
widg‘
));

103 
	}
}

106 
	$»®´İ_lßd
(
R—lPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

108 
´İ
->
»®_d©a
 = 
	`d©a_»®
(
d©a
);

109 
	}
}

112 
	$»®´İ_§ve
(
R—lPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

114 
	`d©a_add_»®
(
©Œ
, 
´İ
->
»®_d©a
);

115 
	}
}

118 
	$»®´İ_g‘_äom_off£t
(
R—lPrİ”ty
 *
´İ
,

119 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

121 
´İ
->
»®_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
»®
);

122 
	}
}

125 
	$»®´İ_£t_äom_off£t
(
R—lPrİ”ty
 *
´İ
,

126 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

128 
	`¡ruù_memb”
(
ba£
,
off£t
,
»®
èğ
´İ
->
»®_d©a
;

129 
	}
}

132 
	$»®´İ_g‘_d©a_size
(
R—lPrİ”ty
 *
´İ
)

134   (
´İ
->
»®_d©a
);

135 
	}
}

137 cÚ¡ 
Prİ”tyOps
 
	g»®´İ_İs
 = {

138 (
Prİ”tyTy³_New
è
»®´İ_Ãw
,

139 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

140 (
Prİ”tyTy³_Cİy
è
»®´İ_cİy
,

141 (
Prİ”tyTy³_Lßd
è
»®´İ_lßd
,

142 (
Prİ”tyTy³_Save
è
»®´İ_§ve
,

143 (
Prİ”tyTy³_G‘Widg‘
è
»®´İ_g‘_widg‘
,

144 (
Prİ”tyTy³_Re£tWidg‘
è
»®´İ_»£t_widg‘
,

145 (
Prİ”tyTy³_S‘FromWidg‘
è
»®´İ_£t_äom_widg‘
,

147 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

148 (
Prİ”tyTy³_G‘FromOff£t
è
»®´İ_g‘_äom_off£t
,

149 (
Prİ”tyTy³_S‘FromOff£t
è
»®´İ_£t_äom_off£t
,

150 (
Prİ”tyTy³_G‘D©aSize
è
»®´İ_g‘_d©a_size


157 
L’gthPrİ”ty
 *

158 
	$Ëngth´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

160 
L’gthPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(LengthProperty,1);

161 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

162 
´İ
->
Ëngth_d©a
 = 0.0;

163  
´İ
;

164 
	}
}

166 
L’gthPrİ”ty
 *

167 
	$Ëngth´İ_cİy
(
L’gthPrİ”ty
 *
¤c
)

169 
L’gthPrİ”ty
 *
´İ
 =

170 (
L’gthPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

171 
¤c
->
commÚ
.
»asÚ
);

172 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

173 
´İ
->
Ëngth_d©a
 = 
¤c
->length_data;

174  
´İ
;

175 
	}
}

177 
WIDGET
 *

178 
	$Ëngth´İ_g‘_widg‘
(
L’gthPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

180 
GtkAdju¡m’t
 *
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(
´İ
->
Ëngth_d©a
,

181 
G_MINFLOAT
,

182 
G_MAXFLOAT
,

184 
GtkWidg‘
 *
»t
 = 
	`dŸ_un™_¥šÃr_Ãw
(
adj
, 
	`´efs_g‘_Ëngth_un™
());

186 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "value-changed");

188  
»t
;

189 
	}
}

192 
	$Ëngth´İ_»£t_widg‘
(
L’gthPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

209 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
widg‘
), 
´İ
->
Ëngth_d©a
);

210 
	}
}

213 
	$Ëngth´İ_£t_äom_widg‘
(
L’gthPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

215 
´İ
->
Ëngth_d©a
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
widg‘
));

216 
	}
}

219 
	$Ëngth´İ_lßd
(
L’gthPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

221 
´İ
->
Ëngth_d©a
 = 
	`d©a_»®
(
d©a
);

222 
	}
}

225 
	$Ëngth´İ_§ve
(
L’gthPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

227 
	`d©a_add_»®
(
©Œ
, 
´İ
->
Ëngth_d©a
);

228 
	}
}

231 
	$Ëngth´İ_g‘_äom_off£t
(
L’gthPrİ”ty
 *
´İ
,

232 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

234 
´İ
->
Ëngth_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
»®
);

235 
	}
}

238 
	$Ëngth´İ_£t_äom_off£t
(
L’gthPrİ”ty
 *
´İ
,

239 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

241 
	`¡ruù_memb”
(
ba£
,
off£t
,
»®
èğ
´İ
->
Ëngth_d©a
;

242 
	}
}

245 
	$Ëngth´İ_g‘_d©a_size
(
L’gthPrİ”ty
 *
´İ
)

247   (
´İ
->
Ëngth_d©a
);

248 
	}
}

250 cÚ¡ 
Prİ”tyOps
 
	gËngth´İ_İs
 = {

251 (
Prİ”tyTy³_New
è
Ëngth´İ_Ãw
,

252 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

253 (
Prİ”tyTy³_Cİy
è
Ëngth´İ_cİy
,

254 (
Prİ”tyTy³_Lßd
è
Ëngth´İ_lßd
,

255 (
Prİ”tyTy³_Save
è
Ëngth´İ_§ve
,

256 (
Prİ”tyTy³_G‘Widg‘
è
Ëngth´İ_g‘_widg‘
,

257 (
Prİ”tyTy³_Re£tWidg‘
è
Ëngth´İ_»£t_widg‘
,

258 (
Prİ”tyTy³_S‘FromWidg‘
è
Ëngth´İ_£t_äom_widg‘
,

260 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

261 (
Prİ”tyTy³_G‘FromOff£t
è
Ëngth´İ_g‘_äom_off£t
,

262 (
Prİ”tyTy³_S‘FromOff£t
è
Ëngth´İ_£t_äom_off£t
,

263 (
Prİ”tyTy³_G‘D©aSize
è
Ëngth´İ_g‘_d©a_size


270 
FÚtsizePrİ”ty
 *

271 
	$fÚtsiz•rİ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

273 
FÚtsizePrİ”ty
 *
´İ
 = 
	`g_Ãw0
(FontsizeProperty,1);

274 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

275 
´İ
->
fÚtsize_d©a
 = 0.0;

276  
´İ
;

277 
	}
}

279 
FÚtsizePrİ”ty
 *

280 
	$fÚtsiz•rİ_cİy
(
FÚtsizePrİ”ty
 *
¤c
)

282 
FÚtsizePrİ”ty
 *
´İ
 =

283 (
FÚtsizePrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

284 
¤c
->
commÚ
.
»asÚ
);

285 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

286 
´İ
->
fÚtsize_d©a
 = 
¤c
->fontsize_data;

287  
´İ
;

288 
	}
}

290 
WIDGET
 *

291 
	$fÚtsiz•rİ_g‘_widg‘
(
FÚtsizePrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

293 
GtkAdju¡m’t
 *
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(
´İ
->
fÚtsize_d©a
,

294 
G_MINFLOAT
,

295 
G_MAXFLOAT
,

297 
GtkWidg‘
 *
»t
 = 
	`dŸ_un™_¥šÃr_Ãw
(
adj
, 
	`´efs_g‘_fÚtsize_un™
());

299 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "value-changed");

301  
»t
;

302 
	}
}

305 
	$fÚtsiz•rİ_»£t_widg‘
(
FÚtsizePrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

307 
	`dŸ_un™_¥šÃr_£t_v®ue
(
	`DIA_UNIT_SPINNER
(
widg‘
), 
´İ
->
fÚtsize_d©a
);

308 
	}
}

311 
	$fÚtsiz•rİ_£t_äom_widg‘
(
FÚtsizePrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

313 
´İ
->
fÚtsize_d©a
 = 
	`dŸ_un™_¥šÃr_g‘_v®ue
(
	`DIA_UNIT_SPINNER
(
widg‘
));

314 
	}
}

317 
	$fÚtsiz•rİ_lßd
(
FÚtsizePrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

319 
PrİNumD©a
 *
numd©a
 = 
´İ
->
commÚ
.
exŒa_d©a
;

320 
»®
 
v®ue
 = 
	`d©a_»®
(
d©a
);

322 ià(
numd©a
) {

323 ià(
v®ue
 < 
numd©a
->
mš
)

324 
v®ue
 = 
numd©a
->
mš
;

325 ià(
v®ue
 > 
numd©a
->
max
)

326 
v®ue
 = 
numd©a
->
max
;

328 
´İ
->
fÚtsize_d©a
 = 
v®ue
;

329 
	}
}

332 
	$fÚtsiz•rİ_§ve
(
FÚtsizePrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

334 
	`d©a_add_»®
(
©Œ
, 
´İ
->
fÚtsize_d©a
);

335 
	}
}

338 
	$fÚtsiz•rİ_g‘_äom_off£t
(
FÚtsizePrİ”ty
 *
´İ
,

339 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

341 
´İ
->
fÚtsize_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
»®
);

342 
	}
}

345 
	$fÚtsiz•rİ_£t_äom_off£t
(
FÚtsizePrİ”ty
 *
´İ
,

346 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

348 
PrİNumD©a
 *
numd©a
 = 
´İ
->
commÚ
.
exŒa_d©a
;

349 
»®
 
v®ue
 = 
´İ
->
fÚtsize_d©a
;

351 ià(
numd©a
) {

352 ià(
v®ue
 < 
numd©a
->
mš
)

353 
v®ue
 = 
numd©a
->
mš
;

354 ià(
v®ue
 > 
numd©a
->
max
)

355 
v®ue
 = 
numd©a
->
max
;

357 
	`¡ruù_memb”
(
ba£
,
off£t
,
»®
èğ
v®ue
;

358 
	}
}

361 
	$fÚtsiz•rİ_g‘_d©a_size
(
FÚtsizePrİ”ty
 *
´İ
)

363   (
´İ
->
fÚtsize_d©a
);

364 
	}
}

366 cÚ¡ 
Prİ”tyOps
 
	gfÚtsiz•rİ_İs
 = {

367 (
Prİ”tyTy³_New
è
fÚtsiz•rİ_Ãw
,

368 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

369 (
Prİ”tyTy³_Cİy
è
fÚtsiz•rİ_cİy
,

370 (
Prİ”tyTy³_Lßd
è
fÚtsiz•rİ_lßd
,

371 (
Prİ”tyTy³_Save
è
fÚtsiz•rİ_§ve
,

372 (
Prİ”tyTy³_G‘Widg‘
è
fÚtsiz•rİ_g‘_widg‘
,

373 (
Prİ”tyTy³_Re£tWidg‘
è
fÚtsiz•rİ_»£t_widg‘
,

374 (
Prİ”tyTy³_S‘FromWidg‘
è
fÚtsiz•rİ_£t_äom_widg‘
,

376 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

377 (
Prİ”tyTy³_G‘FromOff£t
è
fÚtsiz•rİ_g‘_äom_off£t
,

378 (
Prİ”tyTy³_S‘FromOff£t
è
fÚtsiz•rİ_£t_äom_off£t
,

379 (
Prİ”tyTy³_G‘D©aSize
è
fÚtsiz•rİ_g‘_d©a_size


386 
PoštPrİ”ty
 *

387 
	$pošrİ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

389 
PoštPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(PointProperty,1);

390 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

391 
´İ
->
pošt_d©a
.
x
 = 0.0;

392 
´İ
->
pošt_d©a
.
y
 = 0.0;

393  
´İ
;

394 
	}
}

396 
PoštPrİ”ty
 *

397 
	$pošrİ_cİy
(
PoštPrİ”ty
 *
¤c
)

399 
PoštPrİ”ty
 *
´İ
 =

400 (
PoštPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

401 
¤c
->
commÚ
.
»asÚ
);

402 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

403 
´İ
->
pošt_d©a
 = 
¤c
->point_data;

404  
´İ
;

405 
	}
}

408 
	$pošrİ_lßd
(
PoštPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

410 
	`d©a_pošt
(
d©a
,&
´İ
->
pošt_d©a
);

411 
	}
}

414 
	$pošrİ_§ve
(
PoštPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

416 
	`d©a_add_pošt
(
©Œ
, &
´İ
->
pošt_d©a
);

417 
	}
}

420 
	$pošrİ_g‘_äom_off£t
(
PoštPrİ”ty
 *
´İ
,

421 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

423 
´İ
->
pošt_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
Pošt
);

424 
	}
}

427 
	$pošrİ_£t_äom_off£t
(
PoštPrİ”ty
 *
´İ
,

428 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

430 
	`¡ruù_memb”
(
ba£
,
off£t
,
Pošt
èğ
´İ
->
pošt_d©a
;

431 
	}
}

433 cÚ¡ 
Prİ”tyOps
 
	gpošrİ_İs
 = {

434 (
Prİ”tyTy³_New
è
pošrİ_Ãw
,

435 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

436 (
Prİ”tyTy³_Cİy
è
pošrİ_cİy
,

437 (
Prİ”tyTy³_Lßd
è
pošrİ_lßd
,

438 (
Prİ”tyTy³_Save
è
pošrİ_§ve
,

439 (
Prİ”tyTy³_G‘Widg‘
è
šv®id´İ_g‘_widg‘
,

440 (
Prİ”tyTy³_Re£tWidg‘
è
šv®id´İ_»£t_widg‘
,

441 (
Prİ”tyTy³_S‘FromWidg‘
è
šv®id´İ_£t_äom_widg‘
,

443 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

444 (
Prİ”tyTy³_G‘FromOff£t
è
pošrİ_g‘_äom_off£t
,

445 (
Prİ”tyTy³_S‘FromOff£t
è
pošrİ_£t_äom_off£t


452 
Poš¼ayPrİ”ty
 *

453 
	$poš¼ay´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

454 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

456 
Poš¼ayPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(PointarrayProperty,1);

457 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

458 
´İ
->
poš¼ay_d©a
 = 
	`g_¬¿y_Ãw
(
FALSE
,
TRUE
,(
Pošt
));

459  
´İ
;

460 
	}
}

463 
	$poš¼ay´İ_ä“
(
Poš¼ayPrİ”ty
 *
´İ
)

465 
	`g_¬¿y_ä“
(
´İ
->
poš¼ay_d©a
,
TRUE
);

466 
	`g_ä“
(
´İ
);

467 
	}
}

469 
Poš¼ayPrİ”ty
 *

470 
	$poš¼ay´İ_cİy
(
Poš¼ayPrİ”ty
 *
¤c
)

472 
gušt
 
i
;

473 
Poš¼ayPrİ”ty
 *
´İ
 =

474 (
Poš¼ayPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

475 
¤c
->
commÚ
.
»asÚ
);

476 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

477 
	`g_¬¿y_£t_size
(
´İ
->
poš¼ay_d©a
,
¤c
->poš¼ay_d©a->
Ën
);

478 
i
 = 0 ; i < 
¤c
->
poš¼ay_d©a
->
Ën
; i++)

479 
	`g_¬¿y_šdex
(
´İ
->
poš¼ay_d©a
,
Pošt
,
i
) =

480 
	`g_¬¿y_šdex
(
¤c
->
poš¼ay_d©a
,
Pošt
,
i
);

481  
´İ
;

482 
	}
}

485 
	$poš¼ay´İ_lßd
(
Poš¼ayPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

487 
gušt
 
nv®s
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

488 
gušt
 
i
;

489 
	`g_¬¿y_£t_size
(
´İ
->
poš¼ay_d©a
,
nv®s
);

490 
i
=0; (˜< 
nv®s
è&& 
d©a
; i++, d©¨ğ
	`d©a_Ãxt
(data))

491 
	`d©a_pošt
(
d©a
,&
	`g_¬¿y_šdex
(
´İ
->
poš¼ay_d©a
,
Pošt
,
i
));

492 ià(
i
 !ğ
nv®s
)

493 
	`g_w¬nšg
("attribute_num_data()‡nd‡ctual data count mismatch "

495 
	}
}

498 
	$poš¼ay´İ_§ve
(
Poš¼ayPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

500 
gušt
 
i
;

501 
i
 = 0; i < 
´İ
->
poš¼ay_d©a
->
Ën
; i++)

502 
	`d©a_add_pošt
(
©Œ
, &
	`g_¬¿y_šdex
(
´İ
->
poš¼ay_d©a
,
Pošt
,
i
));

503 
	}
}

506 
	$poš¼ay´İ_g‘_äom_off£t
(
Poš¼ayPrİ”ty
 *
´İ
,

507 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

509 
gušt
 
nv®s
 = 
	`¡ruù_memb”
(
ba£
,
off£t2
,guint);

510 
gušt
 
i
;

511 *
ofs_v®
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,*);

512 
	`g_¬¿y_£t_size
(
´İ
->
poš¼ay_d©a
,
nv®s
);

513 
i
 = 0; i < 
nv®s
; i++)

514 
	`g_¬¿y_šdex
(
´İ
->
poš¼ay_d©a
,
Pošt
,
i
) =

515 
	`¡ruù_memb”
(
ofs_v®
,
i
 * (
Pošt
),Point);

516 
	}
}

519 
	$poš¼ay´İ_£t_äom_off£t
(
Poš¼ayPrİ”ty
 *
´İ
,

520 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

522 
gušt
 
nv®s
 = 
´İ
->
poš¼ay_d©a
->
Ën
;

523 
Pošt
 *
v®s
 = 
	`g_memdup
(&
	`g_¬¿y_šdex
(
´İ
->
poš¼ay_d©a
,Point,0),

524 (
Pošt
è* 
nv®s
);

525 
	`g_ä“
(
	`¡ruù_memb”
(
ba£
,
off£t
,
Pošt
 *));

526 
	`¡ruù_memb”
(
ba£
,
off£t
,
Pošt
 *èğ
v®s
;

527 
	`¡ruù_memb”
(
ba£
,
off£t2
,
gušt
èğ
nv®s
;

528 
	}
}

530 cÚ¡ 
Prİ”tyOps
 
	gpoš¼ay´İ_İs
 = {

531 (
Prİ”tyTy³_New
è
poš¼ay´İ_Ãw
,

532 (
Prİ”tyTy³_F»e
è
poš¼ay´İ_ä“
,

533 (
Prİ”tyTy³_Cİy
è
poš¼ay´İ_cİy
,

534 (
Prİ”tyTy³_Lßd
è
poš¼ay´İ_lßd
,

535 (
Prİ”tyTy³_Save
è
poš¼ay´İ_§ve
,

536 (
Prİ”tyTy³_G‘Widg‘
è
šv®id´İ_g‘_widg‘
,

537 (
Prİ”tyTy³_Re£tWidg‘
è
šv®id´İ_»£t_widg‘
,

538 (
Prİ”tyTy³_S‘FromWidg‘
è
šv®id´İ_£t_äom_widg‘
,

540 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

541 (
Prİ”tyTy³_G‘FromOff£t
è
poš¼ay´İ_g‘_äom_off£t
,

542 (
Prİ”tyTy³_S‘FromOff£t
è
poš¼ay´İ_£t_äom_off£t


550 
BezPoštPrİ”ty
 *

551 
	$bezpošrİ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

552 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

554 
BezPoštPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(BezPointProperty,1);

555 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

556 
	`mem£t
(&
´İ
->
bezpošt_d©a
,0,(prop->bezpoint_data));

557  
´İ
;

558 
	}
}

560 
BezPoštPrİ”ty
 *

561 
	$bezpošrİ_cİy
(
BezPoštPrİ”ty
 *
¤c
)

563 
BezPoštPrİ”ty
 *
´İ
 =

564 (
BezPoštPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

565 
¤c
->
commÚ
.
»asÚ
);

566 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

567 
´İ
->
bezpošt_d©a
 = 
¤c
->bezpoint_data;

568  
´İ
;

569 
	}
}

572 
	$bezpošrİ_lßd
(
BezPoštPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

574 
	`d©a_bezpošt
(
d©a
,&
´İ
->
bezpošt_d©a
);

575 
	}
}

578 
	$bezpošrİ_§ve
(
BezPoštPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

580 
	`d©a_add_bezpošt
(
©Œ
, &
´İ
->
bezpošt_d©a
);

581 
	}
}

584 
	$bezpošrİ_g‘_äom_off£t
(
BezPoštPrİ”ty
 *
´İ
,

585 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

587 
´İ
->
bezpošt_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
BezPošt
);

588 
	}
}

591 
	$bezpošrİ_£t_äom_off£t
(
BezPoštPrİ”ty
 *
´İ
,

592 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

594 
	`¡ruù_memb”
(
ba£
,
off£t
,
BezPošt
èğ
´İ
->
bezpošt_d©a
;

595 
	}
}

597 cÚ¡ 
Prİ”tyOps
 
	gbezpošrİ_İs
 = {

598 (
Prİ”tyTy³_New
è
bezpošrİ_Ãw
,

599 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

600 (
Prİ”tyTy³_Cİy
è
bezpošrİ_cİy
,

601 (
Prİ”tyTy³_Lßd
è
bezpošrİ_lßd
,

602 (
Prİ”tyTy³_Save
è
bezpošrİ_§ve
,

603 (
Prİ”tyTy³_G‘Widg‘
è
šv®id´İ_g‘_widg‘
,

604 (
Prİ”tyTy³_Re£tWidg‘
è
šv®id´İ_»£t_widg‘
,

605 (
Prİ”tyTy³_S‘FromWidg‘
è
šv®id´İ_£t_äom_widg‘
,

607 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

608 (
Prİ”tyTy³_G‘FromOff£t
è
bezpošrİ_g‘_äom_off£t
,

609 (
Prİ”tyTy³_S‘FromOff£t
è
bezpošrİ_£t_äom_off£t


616 
BezPoš¼ayPrİ”ty
 *

617 
	$bezpoš¼ay´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

618 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

620 
BezPoš¼ayPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(BezPointarrayProperty,1);

621 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

622 
´İ
->
bezpoš¼ay_d©a
 = 
	`g_¬¿y_Ãw
(
FALSE
,
TRUE
,(
BezPošt
));

623  
´İ
;

624 
	}
}

627 
	$bezpoš¼ay´İ_ä“
(
BezPoš¼ayPrİ”ty
 *
´İ
)

629 
	`g_¬¿y_ä“
(
´İ
->
bezpoš¼ay_d©a
,
TRUE
);

630 
	`g_ä“
(
´İ
);

631 
	}
}

633 
BezPoš¼ayPrİ”ty
 *

634 
	$bezpoš¼ay´İ_cİy
(
BezPoš¼ayPrİ”ty
 *
¤c
)

636 
gušt
 
i
;

637 
BezPoš¼ayPrİ”ty
 *
´İ
 =

638 (
BezPoš¼ayPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

639 
¤c
->
commÚ
.
»asÚ
);

640 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

641 
	`g_¬¿y_£t_size
(
´İ
->
bezpoš¼ay_d©a
,
¤c
->bezpoš¼ay_d©a->
Ën
);

642 
i
 = 0 ; i < 
¤c
->
bezpoš¼ay_d©a
->
Ën
; i++)

643 
	`g_¬¿y_šdex
(
´İ
->
bezpoš¼ay_d©a
,
BezPošt
,
i
) =

644 
	`g_¬¿y_šdex
(
¤c
->
bezpoš¼ay_d©a
,
BezPošt
,
i
);

645  
´İ
;

646 
	}
}

649 
	$bezpoš¼ay´İ_lßd
(
BezPoš¼ayPrİ”ty
 *
´İ
,

650 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

652 
gušt
 
nv®s
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

653 
gušt
 
i
;

655 
	`g_¬¿y_£t_size
(
´İ
->
bezpoš¼ay_d©a
,
nv®s
);

657 
i
=0; (˜< 
nv®s
è&& 
d©a
; i++, d©¨ğ
	`d©a_Ãxt
(data))

658 
	`d©a_bezpošt
(
d©a
,&
	`g_¬¿y_šdex
(
´İ
->
bezpoš¼ay_d©a
,
BezPošt
,
i
));

659 ià(
i
 !ğ
nv®s
)

660 
	`g_w¬nšg
("attribute_num_data()‡nd‡ctual data count mismatch "

662 
	}
}

665 
	$bezpoš¼ay´İ_§ve
(
BezPoš¼ayPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

667 
gušt
 
i
;

668 
i
 = 0; i < 
´İ
->
bezpoš¼ay_d©a
->
Ën
; i++)

669 
	`d©a_add_bezpošt
(
©Œ
,

670 &
	`g_¬¿y_šdex
(
´İ
->
bezpoš¼ay_d©a
,
BezPošt
,
i
));

671 
	}
}

674 
	$bezpoš¼ay´İ_g‘_äom_off£t
(
BezPoš¼ayPrİ”ty
 *
´İ
,

675 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

677 
gušt
 
nv®s
 = 
	`¡ruù_memb”
(
ba£
,
off£t2
,guint);

678 
gušt
 
i
;

679 *
ofs_v®
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,*);

680 
	`g_¬¿y_£t_size
(
´İ
->
bezpoš¼ay_d©a
,
nv®s
);

681 
i
 = 0; i < 
nv®s
; i++)

682 
	`g_¬¿y_šdex
(
´İ
->
bezpoš¼ay_d©a
,
BezPošt
,
i
) =

683 
	`¡ruù_memb”
(
ofs_v®
,
i
 * (
BezPošt
),BezPoint);

684 
	}
}

687 
	$bezpoš¼ay´İ_£t_äom_off£t
(
BezPoš¼ayPrİ”ty
 *
´İ
,

688 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

690 
gušt
 
nv®s
 = 
´İ
->
bezpoš¼ay_d©a
->
Ën
;

691 
BezPošt
 *
v®s
 = 
	`g_memdup
(&
	`g_¬¿y_šdex
(
´İ
->
bezpoš¼ay_d©a
,

692 
BezPošt
,0),

693 (
BezPošt
è* 
nv®s
);

694 
	`g_ä“
(
	`¡ruù_memb”
(
ba£
,
off£t
,
gšt
 *));

695 
	`¡ruù_memb”
(
ba£
,
off£t
,
BezPošt
 *èğ
v®s
;

696 
	`¡ruù_memb”
(
ba£
,
off£t2
,
gušt
èğ
nv®s
;

697 
	}
}

699 cÚ¡ 
Prİ”tyOps
 
	gbezpoš¼ay´İ_İs
 = {

700 (
Prİ”tyTy³_New
è
bezpoš¼ay´İ_Ãw
,

701 (
Prİ”tyTy³_F»e
è
bezpoš¼ay´İ_ä“
,

702 (
Prİ”tyTy³_Cİy
è
bezpoš¼ay´İ_cİy
,

703 (
Prİ”tyTy³_Lßd
è
bezpoš¼ay´İ_lßd
,

704 (
Prİ”tyTy³_Save
è
bezpoš¼ay´İ_§ve
,

705 (
Prİ”tyTy³_G‘Widg‘
è
šv®id´İ_g‘_widg‘
,

706 (
Prİ”tyTy³_Re£tWidg‘
è
šv®id´İ_»£t_widg‘
,

707 (
Prİ”tyTy³_S‘FromWidg‘
è
šv®id´İ_£t_äom_widg‘
,

709 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

710 (
Prİ”tyTy³_G‘FromOff£t
è
bezpoš¼ay´İ_g‘_äom_off£t
,

711 (
Prİ”tyTy³_S‘FromOff£t
è
bezpoš¼ay´İ_£t_äom_off£t


718 
ReùPrİ”ty
 *

719 
	$»ù´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

721 
ReùPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(RectProperty,1);

722 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

723 
	`mem£t
(&
´İ
->
»ù_d©a
,0,(prop->rect_data));

724  
´İ
;

725 
	}
}

727 
ReùPrİ”ty
 *

728 
	$»ù´İ_cİy
(
ReùPrİ”ty
 *
¤c
)

730 
ReùPrİ”ty
 *
´İ
 =

731 (
ReùPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

732 
¤c
->
commÚ
.
»asÚ
);

733 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

734 
´İ
->
»ù_d©a
 = 
¤c
->rect_data;

735  
´İ
;

736 
	}
}

739 
	$»ù´İ_lßd
(
ReùPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

741 
	`d©a_»ùªgË
(
d©a
,&
´İ
->
»ù_d©a
);

742 
	}
}

745 
	$»ù´İ_§ve
(
ReùPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

747 
	`d©a_add_»ùªgË
(
©Œ
, &
´İ
->
»ù_d©a
);

748 
	}
}

751 
	$»ù´İ_g‘_äom_off£t
(
ReùPrİ”ty
 *
´İ
,

752 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

754 
´İ
->
»ù_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
ReùªgË
);

755 
	}
}

758 
	$»ù´İ_£t_äom_off£t
(
ReùPrİ”ty
 *
´İ
,

759 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

761 
	`¡ruù_memb”
(
ba£
,
off£t
,
ReùªgË
èğ
´İ
->
»ù_d©a
;

762 
	}
}

764 cÚ¡ 
Prİ”tyOps
 
	g»ù´İ_İs
 = {

765 (
Prİ”tyTy³_New
è
»ù´İ_Ãw
,

766 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

767 (
Prİ”tyTy³_Cİy
è
»ù´İ_cİy
,

768 (
Prİ”tyTy³_Lßd
è
»ù´İ_lßd
,

769 (
Prİ”tyTy³_Save
è
»ù´İ_§ve
,

770 (
Prİ”tyTy³_G‘Widg‘
è
šv®id´İ_g‘_widg‘
,

771 (
Prİ”tyTy³_Re£tWidg‘
è
šv®id´İ_»£t_widg‘
,

772 (
Prİ”tyTy³_S‘FromWidg‘
è
šv®id´İ_£t_äom_widg‘
,

774 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

775 (
Prİ”tyTy³_G‘FromOff£t
è
»ù´İ_g‘_äom_off£t
,

776 (
Prİ”tyTy³_S‘FromOff£t
è
»ù´İ_£t_äom_off£t


783 
EndpoštsPrİ”ty
 *

784 
	$’dpošt¥rİ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

785 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

787 
EndpoštsPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(EndpointsProperty,1);

788 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

789 
	`mem£t
(&
´İ
->
’dpošts_d©a
,0,(prop->endpoints_data));

790  
´İ
;

791 
	}
}

793 
EndpoštsPrİ”ty
 *

794 
	$’dpošt¥rİ_cİy
(
EndpoštsPrİ”ty
 *
¤c
)

796 
EndpoštsPrİ”ty
 *
´İ
 =

797 (
EndpoštsPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

798 
¤c
->
commÚ
.
»asÚ
);

799 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

800 
	`memıy
(&
´İ
->
’dpošts_d©a
,

801 &
¤c
->
’dpošts_d©a
,

802 (
´İ
->
’dpošts_d©a
));

803  
´İ
;

804 
	}
}

807 
	$’dpošt¥rİ_lßd
(
EndpoštsPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

809 
	`d©a_pošt
(
d©a
,&
´İ
->
’dpošts_d©a
[0]);

810 
d©a
 = 
	`d©a_Ãxt
(data);

811 
	`d©a_pošt
(
d©a
,&
´İ
->
’dpošts_d©a
[1]);

812 
	}
}

815 
	$’dpošt¥rİ_§ve
(
EndpoštsPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

817 
	`d©a_add_pošt
(
©Œ
, &
´İ
->
’dpošts_d©a
[0]);

818 
	`d©a_add_pošt
(
©Œ
, &
´İ
->
’dpošts_d©a
[1]);

819 
	}
}

822 
	$’dpošt¥rİ_g‘_äom_off£t
(
EndpoštsPrİ”ty
 *
´İ
,

823 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

825 
	`memıy
(&
´İ
->
’dpošts_d©a
,

826 &
	`¡ruù_memb”
(
ba£
,
off£t
,
Pošt
),

827 (
´İ
->
’dpošts_d©a
));

828 
	}
}

831 
	$’dpošt¥rİ_£t_äom_off£t
(
EndpoštsPrİ”ty
 *
´İ
,

832 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

834 
	`memıy
(&
	`¡ruù_memb”
(
ba£
,
off£t
,
Pošt
),

835 &
´İ
->
’dpošts_d©a
,

836 (
´İ
->
’dpošts_d©a
));

837 
	}
}

839 cÚ¡ 
Prİ”tyOps
 
	g’dpošt¥rİ_İs
 = {

840 (
Prİ”tyTy³_New
è
’dpošt¥rİ_Ãw
,

841 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

842 (
Prİ”tyTy³_Cİy
è
’dpošt¥rİ_cİy
,

843 (
Prİ”tyTy³_Lßd
è
’dpošt¥rİ_lßd
,

844 (
Prİ”tyTy³_Save
è
’dpošt¥rİ_§ve
,

845 (
Prİ”tyTy³_G‘Widg‘
è
šv®id´İ_g‘_widg‘
,

846 (
Prİ”tyTy³_Re£tWidg‘
è
šv®id´İ_»£t_widg‘
,

847 (
Prİ”tyTy³_S‘FromWidg‘
è
šv®id´İ_£t_äom_widg‘
,

849 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

850 (
Prİ”tyTy³_G‘FromOff£t
è
’dpošt¥rİ_g‘_äom_off£t
,

851 (
Prİ”tyTy³_S‘FromOff£t
è
’dpošt¥rİ_£t_äom_off£t


858 
CÚÅošt_LšePrİ”ty
 *

859 
	$cÚÅošt_lš•rİ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

860 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

862 
CÚÅošt_LšePrİ”ty
 *
´İ
 = 
	`g_Ãw0
(Connpoint_LineProperty,1);

863 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

864 
´İ
->
cÚÅošt_lše_d©a
 = 0;

865  
´İ
;

866 
	}
}

868 
CÚÅošt_LšePrİ”ty
 *

869 
	$cÚÅošt_lš•rİ_cİy
(
CÚÅošt_LšePrİ”ty
 *
¤c
)

871 
CÚÅošt_LšePrİ”ty
 *
´İ
 =

872 (
CÚÅošt_LšePrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

873 
¤c
->
commÚ
.
»asÚ
);

874 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

875 
´İ
->
cÚÅošt_lše_d©a
 = 
¤c
->connpoint_line_data;

876  
´İ
;

877 
	}
}

880 
	$cÚÅošt_lš•rİ_lßd
(
CÚÅošt_LšePrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

882 
´İ
->
cÚÅošt_lše_d©a
 = 
	`d©a_št
(
d©a
);

883 
	}
}

886 
	$cÚÅošt_lš•rİ_§ve
(
CÚÅošt_LšePrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

888 
	`d©a_add_št
(
©Œ
, 
´İ
->
cÚÅošt_lše_d©a
);

889 
	}
}

892 
	$cÚÅošt_lš•rİ_g‘_äom_off£t
(
CÚÅošt_LšePrİ”ty
 *
´İ
,

893 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

895 
´İ
->
cÚÅošt_lše_d©a
 =

896 
	`¡ruù_memb”
(
ba£
,
off£t
,
CÚnPoštLše
 *)->
num_cÚÃùiÚs
;

897 
	}
}

900 
	$cÚÅošt_lš•rİ_£t_äom_off£t
(
CÚÅošt_LšePrİ”ty
 *
´İ
,

901 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

903 
	`cÚÅošše_adju¡_couÁ
(
	`¡ruù_memb”
(
ba£
,
off£t
,
CÚnPoštLše
 *),

904 
´İ
->
cÚÅošt_lše_d©a
,

905 &
	`¡ruù_memb”
(
ba£
,
off£t
,
CÚnPoštLše
 *)->
’d
);

906 
	}
}

908 cÚ¡ 
Prİ”tyOps
 
	gcÚÅošt_lš•rİ_İs
 = {

909 (
Prİ”tyTy³_New
è
cÚÅošt_lš•rİ_Ãw
,

910 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

911 (
Prİ”tyTy³_Cİy
è
cÚÅošt_lš•rİ_cİy
,

912 (
Prİ”tyTy³_Lßd
è
cÚÅošt_lš•rİ_lßd
,

913 (
Prİ”tyTy³_Save
è
cÚÅošt_lš•rİ_§ve
,

914 (
Prİ”tyTy³_G‘Widg‘
è
šv®id´İ_g‘_widg‘
,

915 (
Prİ”tyTy³_Re£tWidg‘
è
šv®id´İ_»£t_widg‘
,

916 (
Prİ”tyTy³_S‘FromWidg‘
è
šv®id´İ_£t_äom_widg‘
,

918 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

919 (
Prİ”tyTy³_G‘FromOff£t
è
cÚÅošt_lš•rİ_g‘_äom_off£t
,

920 (
Prİ”tyTy³_S‘FromOff£t
è
cÚÅošt_lš•rİ_£t_äom_off£t


927 
	$´İ_geomty³s_»gi¡”
()

929 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_REAL
,&
»®´İ_İs
);

930 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_LENGTH
,&
Ëngth´İ_İs
);

931 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_FONTSIZE
,&
fÚtsiz•rİ_İs
);

932 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_POINT
,&
pošrİ_İs
);

933 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_POINTARRAY
,&
poš¼ay´İ_İs
);

934 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_BEZPOINTARRAY
,&
bezpoš¼ay´İ_İs
);

935 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_RECT
,&
»ù´İ_İs
);

936 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_ENDPOINTS
,&
’dpošt¥rİ_İs
);

937 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_CONNPOINT_LINE
,&
cÚÅošt_lš•rİ_İs
);

938 
	}
}

	@O:\tool\dvs50\lib\prop_geomtypes.h

25 #iâdeà
PROP_GEOMTYPES_H


26 
	#PROP_GEOMTYPES_H


	)

28 
	~"´İ”t›s.h
"

29 
	~"geom‘ry.h
"

32 
Prİ”ty
 
	mcommÚ
;

33 
»®
 
	m»®_d©a
;

34 } 
	tR—lPrİ”ty
;

37 
Prİ”ty
 
	mcommÚ
;

38 
»®
 
	mËngth_d©a
;

39 } 
	tL’gthPrİ”ty
;

42 
Prİ”ty
 
	mcommÚ
;

43 
»®
 
	mfÚtsize_d©a
;

44 } 
	tFÚtsizePrİ”ty
;

47 
Prİ”ty
 
	mcommÚ
;

48 
Pošt
 
	mpošt_d©a
;

49 } 
	tPoštPrİ”ty
;

52 
Prİ”ty
 
	mcommÚ
;

53 
GA¼ay
 *
	mpoš¼ay_d©a
;

54 } 
	tPoš¼ayPrİ”ty
;

57 
Prİ”ty
 
	mcommÚ
;

58 
BezPošt
 
	mbezpošt_d©a
;

59 } 
	tBezPoštPrİ”ty
;

62 
Prİ”ty
 
	mcommÚ
;

63 
GA¼ay
 *
	mbezpoš¼ay_d©a
;

64 } 
	tBezPoš¼ayPrİ”ty
;

67 
Prİ”ty
 
	mcommÚ
;

68 
ReùªgË
 
	m»ù_d©a
;

69 } 
	tReùPrİ”ty
;

72 
Prİ”ty
 
	mcommÚ
;

73 
Pošt
 
	m’dpošts_d©a
[2];

74 } 
	tEndpoštsPrİ”ty
;

77 
Prİ”ty
 
	mcommÚ
;

78 
gšt
 
	mcÚÅošt_lše_d©a
;

79 } 
	tCÚÅošt_LšePrİ”ty
;

81 
DIAVAR
 
´İ_geomty³s_»gi¡”
();

	@O:\tool\dvs50\lib\prop_inttypes.c

26 #ifdeà
HAVE_CONFIG_H


27 
	~<cÚfig.h
>

30 
	~<¡dlib.h
>

32 
	~<gtk/gtk.h
>

33 
	#WIDGET
 
GtkWidg‘


	)

34 
	~"´İ”t›s.h
"

35 
	~"´İš‹º®s.h
"

36 
	~"mes§ge.h
"

42 
Ch¬Prİ”ty
 *

43 
	$ch¬´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

45 
Ch¬Prİ”ty
 *
´İ
 = 
	`g_Ãw0
(CharProperty,1);

46 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

47 
´İ
->
ch¬_d©a
 = 0;

48  
´İ
;

49 
	}
}

51 
Ch¬Prİ”ty
 *

52 
	$ch¬´İ_cİy
(
Ch¬Prİ”ty
 *
¤c
)

54 
Ch¬Prİ”ty
 *
´İ
 =

55 (
Ch¬Prİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

56 
¤c
->
commÚ
.
»asÚ
);

57 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

58 
´İ
->
ch¬_d©a
 = 
¤c
->char_data;

59  
´İ
;

60 
	}
}

62 
WIDGET
 *

63 
	$ch¬´İ_g‘_widg‘
(
Ch¬Prİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

65 
GtkWidg‘
 *
»t
 = 
	`gtk_’Œy_Ãw
();

66 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "changed");

67  
»t
;

68 
	}
}

71 
	$ch¬´İ_»£t_widg‘
(
Ch¬Prİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

73 
gch¬
 
ch
[7];

74 
un’
 = 
	`g_unich¬_to_utf8
 (
´İ
->
ch¬_d©a
, 
ch
);

75 
ch
[
un’
] = 0;

76 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
widg‘
), 
ch
);

77 
	}
}

80 
	$ch¬´İ_£t_äom_widg‘
(
Ch¬Prİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

82 
gch¬
 *
buf
 = 
	`gtk_ed™abË_g‘_ch¬s
(
	`GTK_EDITABLE
(
widg‘
), 0, 1);

83 
´İ
->
ch¬_d©a
 = 
	`g_utf8_g‘_ch¬
(
buf
);

84 
	`g_ä“
(
buf
);

85 
	}
}

88 
	$ch¬´İ_lßd
(
Ch¬Prİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

90 
gch¬
 *
¡r
 = 
	`d©a_¡ršg
(
d©a
);

92 ià(
¡r
 && str[0]) {

93 
´İ
->
ch¬_d©a
 = 
	`g_utf8_g‘_ch¬
(
¡r
);

94 
	`g_ä“
(
¡r
);

96 
	`g_w¬nšg
("Could‚ot„ead character data for‡ttribute %s",

97 
´İ
->
commÚ
.
Çme
);

99 
	}
}

102 
	$ch¬´İ_§ve
(
Ch¬Prİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

104 
gch¬
 
utf
[7];

105 
gšt
 
n
 = 
	`g_unich¬_to_utf8
 (
´İ
->
ch¬_d©a
, 
utf
);

106 
utf
[
n
] = 0;

107 
	`d©a_add_¡ršg
 (
©Œ
, 
utf
);

108 
	}
}

111 
	$ch¬´İ_g‘_äom_off£t
(
Ch¬Prİ”ty
 *
´İ
,

112 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

114 
´İ
->
ch¬_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
gunich¬
);

115 
	}
}

118 
	$ch¬´İ_£t_äom_off£t
(
Ch¬Prİ”ty
 *
´İ
,

119 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

121 
	`¡ruù_memb”
(
ba£
,
off£t
,
gunich¬
èğ
´İ
->
ch¬_d©a
;

122 
	}
}

125 
	$ch¬´İ_g‘_d©a_size
(
Ch¬Prİ”ty
 *
´İ
)

127   (
´İ
->
ch¬_d©a
);

128 
	}
}

131 cÚ¡ 
Prİ”tyOps
 
	gch¬´İ_İs
 = {

132 (
Prİ”tyTy³_New
è
ch¬´İ_Ãw
,

133 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

134 (
Prİ”tyTy³_Cİy
è
ch¬´İ_cİy
,

135 (
Prİ”tyTy³_Lßd
è
ch¬´İ_lßd
,

136 (
Prİ”tyTy³_Save
è
ch¬´İ_§ve
,

137 (
Prİ”tyTy³_G‘Widg‘
è
ch¬´İ_g‘_widg‘
,

138 (
Prİ”tyTy³_Re£tWidg‘
è
ch¬´İ_»£t_widg‘
,

139 (
Prİ”tyTy³_S‘FromWidg‘
è
ch¬´İ_£t_äom_widg‘
,

141 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

142 (
Prİ”tyTy³_G‘FromOff£t
è
ch¬´İ_g‘_äom_off£t
,

143 (
Prİ”tyTy³_S‘FromOff£t
è
ch¬´İ_£t_äom_off£t
,

144 (
Prİ”tyTy³_G‘D©aSize
è
ch¬´İ_g‘_d©a_size


155 
	$boŞ_toggËd
(
GtkWidg‘
 *
wid
)

157 ià(
	`GTK_TOGGLE_BUTTON
(
wid
)->
aùive
)

158 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
	`GTK_BIN
(
wid
)->
chd
), 
	`_
("Yes"));

160 
	`gtk_Ïb–_£t_‹xt
(
	`GTK_LABEL
(
	`GTK_BIN
(
wid
)->
chd
), 
	`_
("No"));

161 
	}
}

163 
Prİ”ty
 *

164 
	$boŞ´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

166 
BoŞPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(BoolProperty,1);

167 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

168 
´İ
->
boŞ_d©a
 = 
FALSE
;

169  &
´İ
->
commÚ
;

170 
	}
}

172 
BoŞPrİ”ty
 *

173 
	$boŞ´İ_cİy
(
BoŞPrİ”ty
 *
¤c
)

175 
BoŞPrİ”ty
 *
´İ
 =

176 (
BoŞPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

177 
¤c
->
commÚ
.
»asÚ
);

178 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

179 
´İ
->
boŞ_d©a
 = 
¤c
->bool_data;

180  
´İ
;

181 
	}
}

183 
WIDGET
 *

184 
	$boŞ´İ_g‘_widg‘
(
BoŞPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

186 
GtkWidg‘
 *
»t
 = 
	`gtk_toggË_bu‰Ú_Ãw_w™h_Ïb–
(
	`_
("No"));

187 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
»t
), "toggled",

188 
	`G_CALLBACK
 (
boŞ_toggËd
), 
NULL
);

189 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "toggled");

190  
»t
;

191 
	}
}

194 
	$boŞ´İ_»£t_widg‘
(
BoŞPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

196 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
widg‘
),
´İ
->
boŞ_d©a
);

197 
	}
}

200 
	$boŞ´İ_£t_äom_widg‘
(
BoŞPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

202 
´İ
->
boŞ_d©a
 = 
	`GTK_TOGGLE_BUTTON
(
widg‘
)->
aùive
;

203 
	}
}

206 
	$boŞ´İ_lßd
(
BoŞPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

208 
´İ
->
boŞ_d©a
 = 
	`d©a_boŞ—n
(
d©a
);

209 
	}
}

212 
	$boŞ´İ_§ve
(
BoŞPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

214 
	`d©a_add_boŞ—n
(
©Œ
, 
´İ
->
boŞ_d©a
);

215 
	}
}

218 
	$boŞ´İ_g‘_äom_off£t
(
BoŞPrİ”ty
 *
´İ
,

219 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

221 
´İ
->
boŞ_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
gboŞ—n
);

222 
	}
}

225 
	$boŞ´İ_£t_äom_off£t
(
BoŞPrİ”ty
 *
´İ
,

226 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

228 
	`¡ruù_memb”
(
ba£
,
off£t
,
gboŞ—n
èğ
´İ
->
boŞ_d©a
;

229 
	}
}

232 
	$boŞ´İ_g‘_d©a_size
(
BoŞPrİ”ty
 *
´İ
)

234   (
´İ
->
boŞ_d©a
);

235 
	}
}

238 cÚ¡ 
Prİ”tyOps
 
	gboŞ´İ_İs
 = {

239 (
Prİ”tyTy³_New
è
boŞ´İ_Ãw
,

240 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

241 (
Prİ”tyTy³_Cİy
è
boŞ´İ_cİy
,

242 (
Prİ”tyTy³_Lßd
è
boŞ´İ_lßd
,

243 (
Prİ”tyTy³_Save
è
boŞ´İ_§ve
,

244 (
Prİ”tyTy³_G‘Widg‘
è
boŞ´İ_g‘_widg‘
,

245 (
Prİ”tyTy³_Re£tWidg‘
è
boŞ´İ_»£t_widg‘
,

246 (
Prİ”tyTy³_S‘FromWidg‘
è
boŞ´İ_£t_äom_widg‘
,

248 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

249 (
Prİ”tyTy³_G‘FromOff£t
è
boŞ´İ_g‘_äom_off£t
,

250 (
Prİ”tyTy³_S‘FromOff£t
è
boŞ´İ_£t_äom_off£t
,

251 (
Prİ”tyTy³_G‘D©aSize
è
boŞ´İ_g‘_d©a_size


258 
IÁPrİ”ty
 *

259 
	$šrİ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

261 
IÁPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(IntProperty,1);

262 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

263 
´İ
->
št_d©a
 = 0;

264  
´İ
;

265 
	}
}

267 
IÁPrİ”ty
 *

268 
	$šrİ_cİy
(
IÁPrİ”ty
 *
¤c
)

270 
IÁPrİ”ty
 *
´İ
 =

271 (
IÁPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

272 
¤c
->
commÚ
.
»asÚ
);

273 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

274 
´İ
->
št_d©a
 = 
¤c
->int_data;

275  
´İ
;

276 
	}
}

278 
WIDGET
 *

279 
	$šrİ_g‘_widg‘
(
IÁPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

281 
GtkAdju¡m’t
 *
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(
´İ
->
št_d©a
,

282 
G_MININT
, 
G_MAXINT
,

284 
GtkWidg‘
 *
»t
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 1.0, 0);

285 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
»t
),
TRUE
);

286 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "value_changed");

288  
»t
;

289 
	}
}

292 
	$šrİ_»£t_widg‘
(
IÁPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

294 
GtkAdju¡m’t
 *
adj
;

295 ià(
´İ
->
commÚ
.
exŒa_d©a
) {

296 
PrİNumD©a
 *
numd©a
 = 
´İ
->
commÚ
.
exŒa_d©a
;

297 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(
´İ
->
št_d©a
,

298 
numd©a
->
mš
,‚umd©a->
max
,

299 
numd©a
->
¡•
, 10.0 *‚umdata->step, 0));

301 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(
´İ
->
št_d©a
,

302 
G_MININT
, 
G_MAXINT
,

305 
	`gtk_¥š_bu‰Ú_£t_adju¡m’t
(
	`GTK_SPIN_BUTTON
(
widg‘
), 
adj
);

306 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
widg‘
), 
TRUE
);

307 
	}
}

310 
	$šrİ_£t_äom_widg‘
(
IÁPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

312 
´İ
->
št_d©a
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_št
(
	`GTK_SPIN_BUTTON
(
widg‘
));

313 
	}
}

316 
	$šrİ_lßd
(
IÁPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

318 
´İ
->
št_d©a
 = 
	`d©a_št
(
d©a
);

319 
	}
}

322 
	$šrİ_§ve
(
IÁPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

324 
	`d©a_add_št
(
©Œ
, 
´İ
->
št_d©a
);

325 
	}
}

328 
	$šrİ_g‘_äom_off£t
(
IÁPrİ”ty
 *
´İ
,

329 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

331 
´İ
->
št_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
gšt
);

332 
	}
}

335 
	$šrİ_£t_äom_off£t
(
IÁPrİ”ty
 *
´İ
,

336 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

338 
	`¡ruù_memb”
(
ba£
,
off£t
,
gšt
èğ
´İ
->
št_d©a
;

339 
	}
}

342 
	$šrİ_g‘_d©a_size
(
IÁPrİ”ty
 *
´İ
)

344   (
´İ
->
št_d©a
);

345 
	}
}

347 cÚ¡ 
Prİ”tyOps
 
	gšrİ_İs
 = {

348 (
Prİ”tyTy³_New
è
šrİ_Ãw
,

349 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

350 (
Prİ”tyTy³_Cİy
è
šrİ_cİy
,

351 (
Prİ”tyTy³_Lßd
è
šrİ_lßd
,

352 (
Prİ”tyTy³_Save
è
šrİ_§ve
,

353 (
Prİ”tyTy³_G‘Widg‘
è
šrİ_g‘_widg‘
,

354 (
Prİ”tyTy³_Re£tWidg‘
è
šrİ_»£t_widg‘
,

355 (
Prİ”tyTy³_S‘FromWidg‘
è
šrİ_£t_äom_widg‘
,

357 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

358 (
Prİ”tyTy³_G‘FromOff£t
è
šrİ_g‘_äom_off£t
,

359 (
Prİ”tyTy³_S‘FromOff£t
è
šrİ_£t_äom_off£t
,

360 (
Prİ”tyTy³_G‘D©aSize
è
šrİ_g‘_d©a_size


367 
IÁ¬¿yPrİ”ty
 *

368 
	$š¼ay´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

369 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

371 
IÁ¬¿yPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(IntarrayProperty,1);

372 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

373 
´İ
->
š¼ay_d©a
 = 
	`g_¬¿y_Ãw
(
FALSE
,
TRUE
,(
gšt
));

374  
´İ
;

375 
	}
}

378 
	$š¼ay´İ_ä“
(
IÁ¬¿yPrİ”ty
 *
´İ
)

380 
	`g_¬¿y_ä“
(
´İ
->
š¼ay_d©a
,
TRUE
);

381 
	`g_ä“
(
´İ
);

382 
	}
}

384 
IÁ¬¿yPrİ”ty
 *

385 
	$š¼ay´İ_cİy
(
IÁ¬¿yPrİ”ty
 *
¤c
)

387 
gušt
 
i
;

388 
IÁ¬¿yPrİ”ty
 *
´İ
 =

389 (
IÁ¬¿yPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

390 
¤c
->
commÚ
.
»asÚ
);

391 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

392 
	`g_¬¿y_£t_size
(
´İ
->
š¼ay_d©a
,
¤c
->š¼ay_d©a->
Ën
);

393 
i
 = 0 ; i < 
¤c
->
š¼ay_d©a
->
Ën
; i++)

394 
	`g_¬¿y_šdex
(
´İ
->
š¼ay_d©a
,
gšt
,
i
) =

395 
	`g_¬¿y_šdex
(
¤c
->
š¼ay_d©a
,
gšt
,
i
);

396  
´İ
;

397 
	}
}

400 
	$š¼ay´İ_lßd
(
IÁ¬¿yPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

402 
gušt
 
nv®s
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

403 
gušt
 
i
;

404 
	`g_¬¿y_£t_size
(
´İ
->
š¼ay_d©a
,
nv®s
);

405 
i
=0; (˜< 
nv®s
è&& 
d©a
; i++, d©¨ğ
	`d©a_Ãxt
(data))

406 
	`g_¬¿y_šdex
(
´İ
->
š¼ay_d©a
,
gšt
,
i
èğ
	`d©a_št
(
d©a
);

407 ià(
i
 !ğ
nv®s
)

408 
	`g_w¬nšg
("attribute_num_data()‡nd‡ctual data count mismatch "

410 
	}
}

413 
	$š¼ay´İ_§ve
(
IÁ¬¿yPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

415 
gušt
 
i
;

416 
i
 = 0; i < 
´İ
->
š¼ay_d©a
->
Ën
; i++)

417 
	`d©a_add_št
(
©Œ
, 
	`g_¬¿y_šdex
(
´İ
->
š¼ay_d©a
,
gšt
,
i
));

418 
	}
}

421 
	$š¼ay´İ_g‘_äom_off£t
(
IÁ¬¿yPrİ”ty
 *
´İ
,

422 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

424 
gušt
 
nv®s
 = 
	`¡ruù_memb”
(
ba£
,
off£t2
,guint);

425 
gušt
 
i
;

426 *
ofs_v®
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,*);

427 
	`g_¬¿y_£t_size
(
´İ
->
š¼ay_d©a
,
nv®s
);

428 
i
 = 0; i < 
nv®s
; i++)

429 
	`g_¬¿y_šdex
(
´İ
->
š¼ay_d©a
,
gšt
,
i
) =

430 
	`¡ruù_memb”
(
ofs_v®
,
i
 * (
gšt
),gint);

431 
	}
}

434 
	$š¼ay´İ_£t_äom_off£t
(
IÁ¬¿yPrİ”ty
 *
´İ
,

435 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

437 
gušt
 
nv®s
 = 
´İ
->
š¼ay_d©a
->
Ën
;

438 
gšt
 *
v®s
 = 
	`g_memdup
(&
	`g_¬¿y_šdex
(
´İ
->
š¼ay_d©a
,gint,0),

439 (
gšt
è* 
nv®s
);

440 
	`g_ä“
(
	`¡ruù_memb”
(
ba£
,
off£t
,
gšt
 *));

441 
	`¡ruù_memb”
(
ba£
,
off£t
,
gšt
 *èğ
v®s
;

442 
	`¡ruù_memb”
(
ba£
,
off£t2
,
gušt
èğ
nv®s
;

443 
	}
}

445 cÚ¡ 
Prİ”tyOps
 
	gš¼ay´İ_İs
 = {

446 (
Prİ”tyTy³_New
è
š¼ay´İ_Ãw
,

447 (
Prİ”tyTy³_F»e
è
š¼ay´İ_ä“
,

448 (
Prİ”tyTy³_Cİy
è
š¼ay´İ_cİy
,

449 (
Prİ”tyTy³_Lßd
è
š¼ay´İ_lßd
,

450 (
Prİ”tyTy³_Save
è
š¼ay´İ_§ve
,

451 (
Prİ”tyTy³_G‘Widg‘
è
noİ´İ_g‘_widg‘
,

452 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

453 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

455 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

456 (
Prİ”tyTy³_G‘FromOff£t
è
š¼ay´İ_g‘_äom_off£t
,

457 (
Prİ”tyTy³_S‘FromOff£t
è
š¼ay´İ_£t_äom_off£t


464 
EnumPrİ”ty
 *

465 
	$’um´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

467 
EnumPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(EnumProperty,1);

468 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

469 
´İ
->
’um_d©a
 = 0;

470  
´İ
;

471 
	}
}

473 
EnumPrİ”ty
 *

474 
	$’um´İ_cİy
(
EnumPrİ”ty
 *
¤c
)

476 
EnumPrİ”ty
 *
´İ
 =

477 (
EnumPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

478 
¤c
->
commÚ
.
»asÚ
);

479 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

480 
´İ
->
’um_d©a
 = 
¤c
->enum_data;

481  
´İ
;

482 
	}
}

484 
WIDGET
 *

485 
	$’um´İ_g‘_widg‘
(
EnumPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

487 
GtkWidg‘
 *
»t
;

489 ià(
´İ
->
commÚ
.
exŒa_d©a
) {

490 
PrİEnumD©a
 *
’umd©a
 = 
´İ
->
commÚ
.
exŒa_d©a
;

491 
gušt
 
i
;

493 
»t
 = 
	`gtk_combo_box_Ãw_‹xt
 ();

494 
i
 = 0; 
’umd©a
[i].
Çme
 !ğ
NULL
; i++)

495 
	`gtk_combo_box_­³nd_‹xt
 (
	`GTK_COMBO_BOX
 (
»t
), 
	`_
(
’umd©a
[
i
].
Çme
));

496 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
 (
»t
), "changed");

498 
»t
 = 
	`gtk_’Œy_Ãw
();

500  
»t
;

501 
	}
}

504 
	$’um´İ_»£t_widg‘
(
EnumPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

506 ià(
´İ
->
commÚ
.
exŒa_d©a
) {

507 
PrİEnumD©a
 *
’umd©a
 = 
´İ
->
commÚ
.
exŒa_d©a
;

508 
gušt
 
i
, 
pos
 = 0;

510 
i
 = 0; 
’umd©a
[i].
Çme
 !ğ
NULL
; i++) {

511 ià(
’umd©a
[
i
].
’umv
 =ğ
´İ
->
’um_d©a
) {

512 
pos
 = 
i
;

516 
	`gtk_combo_box_£t_aùive
 (
	`GTK_COMBO_BOX
 (
widg‘
), 
pos
);

518 
buf
[16];

519 
	`g_¢´štf
(
buf
, (buf), "%d", 
´İ
->
’um_d©a
);

520 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
widg‘
), 
buf
);

522 
	}
}

525 
	$’um´İ_£t_äom_widg‘
(
EnumPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

527 ià(
	`GTK_IS_COMBO_BOX
 (
widg‘
)) {

528 
gušt
 
pos
 = 
	`gtk_combo_box_g‘_aùive
 (
	`GTK_COMBO_BOX
 (
widg‘
));

529 
PrİEnumD©a
 *
’umd©a
 = 
´İ
->
commÚ
.
exŒa_d©a
;

531 
	`g_»tuº_if_ç
 (
’umd©a
 !ğ
NULL
);

533 
´İ
->
’um_d©a
 = 
’umd©a
[
pos
].
’umv
;

535 
´İ
->
’um_d©a
 = 
	`¡¹Ş
(
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
widg‘
)), 
NULL
, 0);

537 
	}
}

540 
	$’um´İ_lßd
(
EnumPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

542 
D©aTy³
 
dt
 = 
	`d©a_ty³
 (
d©a
);

543 ià(
DATATYPE_ENUM
 =ğ
dt
)

544 
´İ
->
’um_d©a
 = 
	`d©a_’um
(
d©a
);

545 ià(
DATATYPE_INT
 =ğ
dt
) {

546 
gboŞ—n
 
ÿ¡_ok
 = 
FALSE
;

547 
PrİEnumD©a
 *
’umd©a
 = 
´İ
->
commÚ
.
exŒa_d©a
;

548 
gušt
 
i
, 
v
 = 
	`d©a_št
(
d©a
);

549 
i
 = 0; 
’umd©a
[i].
Çme
 !ğ
NULL
; ++i) {

550 ià(
v
 =ğ
’umd©a
[
i
].
’umv
) {

551 
´İ
->
’um_d©a
 = 
v
;

552 
ÿ¡_ok
 = 
TRUE
;

556 ià(!
ÿ¡_ok
) {

557 
´İ
->
’um_d©a
 = 
’umd©a
[0].
’umv
;

558 
	`mes§ge_w¬nšg
 (
	`_
("Property cast from intoƒnum out of„ange"));

561 
	}
}

564 
	$’um´İ_§ve
(
EnumPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

566 
	`d©a_add_’um
(
©Œ
, 
´İ
->
’um_d©a
);

567 
	}
}

570 
	$’um´İ_g‘_äom_off£t
(
EnumPrİ”ty
 *
´İ
,

571 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

573 
´İ
->
’um_d©a
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
gšt
);

574 
	}
}

577 
	$’um´İ_£t_äom_off£t
(
EnumPrİ”ty
 *
´İ
,

578 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

580 
	`¡ruù_memb”
(
ba£
,
off£t
,
gšt
èğ
´İ
->
’um_d©a
;

581 
	}
}

583 cÚ¡ 
Prİ”tyOps
 
	g’um´İ_İs
 = {

584 (
Prİ”tyTy³_New
è
’um´İ_Ãw
,

585 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

586 (
Prİ”tyTy³_Cİy
è
’um´İ_cİy
,

587 (
Prİ”tyTy³_Lßd
è
’um´İ_lßd
,

588 (
Prİ”tyTy³_Save
è
’um´İ_§ve
,

589 (
Prİ”tyTy³_G‘Widg‘
è
’um´İ_g‘_widg‘
,

590 (
Prİ”tyTy³_Re£tWidg‘
è
’um´İ_»£t_widg‘
,

591 (
Prİ”tyTy³_S‘FromWidg‘
è
’um´İ_£t_äom_widg‘
,

593 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

594 (
Prİ”tyTy³_G‘FromOff£t
è
’um´İ_g‘_äom_off£t
,

595 (
Prİ”tyTy³_S‘FromOff£t
è
’um´İ_£t_äom_off£t


602 
Enum¬¿yPrİ”ty
 *

603 
	$’um¬¿y´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

604 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

606 
Enum¬¿yPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(EnumarrayProperty,1);

607 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

608 
´İ
->
’um¬¿y_d©a
 = 
	`g_¬¿y_Ãw
(
FALSE
,
TRUE
,(
gšt
));

609  
´İ
;

610 
	}
}

613 
	$’um¬¿y´İ_ä“
(
Enum¬¿yPrİ”ty
 *
´İ
)

615 
	`g_¬¿y_ä“
(
´İ
->
’um¬¿y_d©a
,
TRUE
);

616 
	`g_ä“
(
´İ
);

617 
	}
}

619 
Enum¬¿yPrİ”ty
 *

620 
	$’um¬¿y´İ_cİy
(
Enum¬¿yPrİ”ty
 *
¤c
)

622 
gušt
 
i
;

623 
Enum¬¿yPrİ”ty
 *
´İ
 =

624 (
Enum¬¿yPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

625 
¤c
->
commÚ
.
»asÚ
);

626 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

627 
	`g_¬¿y_£t_size
(
´İ
->
’um¬¿y_d©a
,
¤c
->’um¬¿y_d©a->
Ën
);

628 
i
 = 0 ; i < 
¤c
->
’um¬¿y_d©a
->
Ën
; i++)

629 
	`g_¬¿y_šdex
(
´İ
->
’um¬¿y_d©a
,
gšt
,
i
) =

630 
	`g_¬¿y_šdex
(
¤c
->
’um¬¿y_d©a
,
gšt
,
i
);

631  
´İ
;

632 
	}
}

635 
	$’um¬¿y´İ_lßd
(
Enum¬¿yPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

637 
gušt
 
nv®s
 = 
	`©Œibu‹_num_d©a
(
©Œ
);

638 
gušt
 
i
;

639 
	`g_¬¿y_£t_size
(
´İ
->
’um¬¿y_d©a
,
nv®s
);

641 
i
=0; (˜< 
nv®s
è&& 
d©a
; i++, d©¨ğ
	`d©a_Ãxt
(data))

642 
	`g_¬¿y_šdex
(
´İ
->
’um¬¿y_d©a
,
gšt
,
i
èğ
	`d©a_’um
(
d©a
);

643 ià(
i
 !ğ
nv®s
)

644 
	`g_w¬nšg
("attribute_num_data()‡nd‡ctual data count mismatch "

646 
	}
}

649 
	$’um¬¿y´İ_§ve
(
Enum¬¿yPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

651 
gušt
 
i
;

652 
i
 = 0; i < 
´İ
->
’um¬¿y_d©a
->
Ën
; i++)

653 
	`d©a_add_’um
(
©Œ
, 
	`g_¬¿y_šdex
(
´İ
->
’um¬¿y_d©a
,
gšt
,
i
));

654 
	}
}

657 
	$’um¬¿y´İ_g‘_äom_off£t
(
Enum¬¿yPrİ”ty
 *
´İ
,

658 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

660 
gušt
 
nv®s
 = 
	`¡ruù_memb”
(
ba£
,
off£t2
,guint);

661 
gušt
 
i
;

662 *
ofs_v®
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,*);

663 
	`g_¬¿y_£t_size
(
´İ
->
’um¬¿y_d©a
,
nv®s
);

664 
i
 = 0; i < 
nv®s
; i++)

665 
	`g_¬¿y_šdex
(
´İ
->
’um¬¿y_d©a
,
gšt
,
i
) =

666 
	`¡ruù_memb”
(
ofs_v®
,
i
 * (
gšt
),gint);

667 
	}
}

670 
	$’um¬¿y´İ_£t_äom_off£t
(
Enum¬¿yPrİ”ty
 *
´İ
,

671 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

673 
gušt
 
nv®s
 = 
´İ
->
’um¬¿y_d©a
->
Ën
;

674 
gšt
 *
v®s
 = 
	`g_memdup
(&
	`g_¬¿y_šdex
(
´İ
->
’um¬¿y_d©a
,gint,0),

675 (
gšt
è* 
nv®s
);

676 
	`g_ä“
(
	`¡ruù_memb”
(
ba£
,
off£t
,
gšt
 *));

677 
	`¡ruù_memb”
(
ba£
,
off£t
,
gšt
 *èğ
v®s
;

678 
	`¡ruù_memb”
(
ba£
,
off£t2
,
gušt
èğ
nv®s
;

679 
	}
}

681 cÚ¡ 
Prİ”tyOps
 
	g’um¬¿y´İ_İs
 = {

682 (
Prİ”tyTy³_New
è
’um¬¿y´İ_Ãw
,

683 (
Prİ”tyTy³_F»e
è
’um¬¿y´İ_ä“
,

684 (
Prİ”tyTy³_Cİy
è
’um¬¿y´İ_cİy
,

685 (
Prİ”tyTy³_Lßd
è
’um¬¿y´İ_lßd
,

686 (
Prİ”tyTy³_Save
è
’um¬¿y´İ_§ve
,

687 (
Prİ”tyTy³_G‘Widg‘
è
noİ´İ_g‘_widg‘
,

688 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

689 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

691 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

692 (
Prİ”tyTy³_G‘FromOff£t
è
’um¬¿y´İ_g‘_äom_off£t
,

693 (
Prİ”tyTy³_S‘FromOff£t
è
’um¬¿y´İ_£t_äom_off£t


699 
	$´İ_š‰y³s_»gi¡”
()

701 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_CHAR
,&
ch¬´İ_İs
);

702 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_BOOL
,&
boŞ´İ_İs
);

703 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_INT
,&
šrİ_İs
);

704 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_INTARRAY
,&
š¼ay´İ_İs
);

705 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_ENUM
,&
’um´İ_İs
);

706 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_ENUMARRAY
,&
’um¬¿y´İ_İs
);

707 
	}
}

	@O:\tool\dvs50\lib\prop_inttypes.h

25 #iâdeà
PROP_INTTYPES_H


26 
	#PROP_INTTYPES_H


	)

28 
	~"´İ”t›s.h
"

29 
	~"dŸ_xml.h
"

33 
Prİ”ty
 
	mcommÚ
;

34 
gunich¬
 
	mch¬_d©a
;

35 } 
	tCh¬Prİ”ty
;

38 
Prİ”ty
 
	mcommÚ
;

39 
gboŞ—n
 
	mboŞ_d©a
;

40 } 
	tBoŞPrİ”ty
;

43 
Prİ”ty
 
	mcommÚ
;

44 
gšt
 
	mšt_d©a
;

45 } 
	tIÁPrİ”ty
;

48 
Prİ”ty
 
	mcommÚ
;

49 
GA¼ay
 *
	mš¼ay_d©a
;

50 } 
	tIÁ¬¿yPrİ”ty
;

53 
Prİ”ty
 
	mcommÚ
;

54 
gšt
 
	m’um_d©a
;

55 } 
	tEnumPrİ”ty
;

58 
Prİ”ty
 
	mcommÚ
;

59 
GA¼ay
 *
	m’um¬¿y_d©a
;

60 } 
	tEnum¬¿yPrİ”ty
;

62 
´İ_š‰y³s_»gi¡”
();

	@O:\tool\dvs50\lib\prop_sdarray.c

27 #ifdeà
HAVE_CONFIG_H


28 
	~<cÚfig.h
>

31 
	~<gtk/gtk.h
>

32 
	#WIDGET
 
GtkWidg‘


	)

33 
	~"widg‘s.h
"

34 
	~"´İ”t›s.h
"

35 
	~"´İš‹º®s.h
"

41 
A¼ayPrİ”ty
 *

42 
	$¬¿y´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

44 
A¼ayPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(ArrayProperty,1);

45 cÚ¡ 
PrİDescCommÚA¼ayExŒa
 *
exŒa
 = 
pdesc
->
exŒa_d©a
;

47 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
, 
pdesc
, 
»asÚ
);

48 
´İ
->
ex_´İs
 = 
	`´İ_li¡_äom_descs
(
exŒa
->
»cÜd
,
»asÚ
);

49 
´İ
->
»cÜds
 = 
	`g_±r_¬¿y_Ãw
();

50  
´İ
;

51 
	}
}

54 
	$¬¿y´İ_ä“»cÜds
(
A¼ayPrİ”ty
 *
´İ
)

56 
gušt
 
i
;

58 
i
=0; i < 
´İ
->
»cÜds
->
Ën
; i++)

59 
	`´İ_li¡_ä“
(
	`g_±r_¬¿y_šdex
(
´İ
->
»cÜds
,
i
));

60 
	}
}

63 
	$¬¿y´İ_ä“
(
A¼ayPrİ”ty
 *
´İ
)

65 
	`¬¿y´İ_ä“»cÜds
(
´İ
);

66 
	`g_±r_¬¿y_ä“
(
´İ
->
»cÜds
,
TRUE
);

67 
	`g_ä“
(
´İ
);

68 
	}
}

70 
A¼ayPrİ”ty
 *

71 
	$¬¿y´İ_cİy
(
A¼ayPrİ”ty
 *
¤c
)

73 
A¼ayPrİ”ty
 *
´İ
 =

74 (
A¼ayPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

75 
¤c
->
commÚ
.
»asÚ
);

76 
gušt
 
i
;

77 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

78 
´İ
->
ex_´İs
 = 
	`´İ_li¡_cİy
(
¤c
->ex_props);

79 
´İ
->
»cÜds
 = 
	`g_±r_¬¿y_Ãw
();

80 
i
 = 0; i < 
¤c
->
»cÜds
->
Ën
; i++) {

81 
	`g_±r_¬¿y_add
(
´İ
->
»cÜds
,

82 
	`´İ_li¡_cİy
(
	`g_±r_¬¿y_šdex
(
¤c
->
»cÜds
,
i
)));

84  
´İ
;

85 
	}
}

88 
	$¬¿y´İ_lßd
(
A¼ayPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

90 cÚ¡ 
PrİDescCommÚA¼ayExŒa
 *
exŒa
 = 
´İ
->
commÚ
.
desü
->
exŒa_d©a
;

91 
D©aNode
 
compos™e
;

92 
GE¼Ü
 *
”r
 = 
NULL
;

94 
	`¬¿y´İ_ä“»cÜds
(
´İ
);

95 
	`g_±r_¬¿y_£t_size
(
´İ
->
»cÜds
,0);

97 
compos™e
 = 
d©a
;

98 
compos™e
 !ğ
NULL
;

99 
compos™e
 = 
	`d©a_Ãxt
(composite)) {

100 
GPŒA¼ay
 *
»cÜd
 = 
	`´İ_li¡_äom_descs
(
exŒa
->record,

101 
´İ
->
commÚ
.
»asÚ
);

102 ià(!
	`´İ_li¡_lßd
(
»cÜd
,
compos™e
, &
”r
)) {

103 
	`g_w¬nšg
 ("%s:%s", 
´İ
->
commÚ
.
Çme
, 
”r
->
mes§ge
);

104 
	`g_”rÜ_ä“
 (
”r
);

105 
”r
 = 
NULL
;

107 
	`g_±r_¬¿y_add
(
´İ
->
»cÜds
,
»cÜd
);

109 
	}
}

112 
	$¬¿y´İ_§ve
(
A¼ayPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

114 
i
;

115 cÚ¡ 
PrİDescCommÚA¼ayExŒa
 *
exŒa
 = 
´İ
->
commÚ
.
desü
->
exŒa_d©a
;

117 
i
 = 0; i < 
´İ
->
»cÜds
->
Ën
; i++) {

118 
	`´İ_li¡_§ve
(
	`g_±r_¬¿y_šdex
(
´İ
->
»cÜds
,
i
),

119 
	`d©a_add_compos™e
(
©Œ
,
exŒa
->
compos™e_ty³
));

121 
	}
}

124 
	$§¼ay´İ_g‘_äom_off£t
(
A¼ayPrİ”ty
 *
´İ
,

125 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

127 cÚ¡ 
PrİDescSA¼ayExŒa
 *
exŒa
 = 
´İ
->
commÚ
.
desü
->
exŒa_d©a
;

128 
PrİOff£t
 *
suboff£ts
 = 
exŒa
->
commÚ
.
off£ts
;

129 
gušt
 
i
;

131 
	`´İ_off£t_li¡_ÿlcuÏ‹_qu¬ks
(
suboff£ts
);

133 
	`¬¿y´İ_ä“»cÜds
(
´İ
);

134 
	`g_±r_¬¿y_£t_size
(
´İ
->
»cÜds
,
exŒa
->
¬¿y_Ën
);

136 
i
=0; i < 
´İ
->
»cÜds
->
Ën
; i++) {

137 *
»c_š_obj
 = &
	`¡ruù_memb”
(
ba£
,

138 
off£t
 + (
i
 * 
exŒa
->
–em’t_size
),

140 
GPŒA¼ay
 *
sub´İs
 = 
	`´İ_li¡_cİy
(
´İ
->
ex_´İs
);

142 
	`do_g‘_´İs_äom_off£ts
(
»c_š_obj
,
sub´İs
,
suboff£ts
);

144 
	`g_±r_¬¿y_šdex
(
´İ
->
»cÜds
,
i
èğ
sub´İs
;

146 
	}
}

149 
	$§¼ay´İ_£t_äom_off£t
(
A¼ayPrİ”ty
 *
´İ
,

150 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

152 cÚ¡ 
PrİDescSA¼ayExŒa
 *
exŒa
 = 
´İ
->
commÚ
.
desü
->
exŒa_d©a
;

153 
PrİOff£t
 *
suboff£ts
 = 
exŒa
->
commÚ
.
off£ts
;

154 
gušt
 
i
;

156 
	`g_as£¹
(
´İ
->
»cÜds
->
Ën
 =ğ
exŒa
->
¬¿y_Ën
);

158 
	`´İ_off£t_li¡_ÿlcuÏ‹_qu¬ks
(
suboff£ts
);

160 
i
=0; i < 
´İ
->
»cÜds
->
Ën
; i++) {

161 *
»c_š_obj
 = &
	`¡ruù_memb”
(
ba£
,

162 
off£t
 + (
i
 * 
exŒa
->
–em’t_size
),

164 
GPŒA¼ay
 *
sub´İs
 = 
	`g_±r_¬¿y_šdex
(
´İ
->
»cÜds
,
i
);

166 
	`do_£t_´İs_äom_off£ts
(
»c_š_obj
,
sub´İs
,
suboff£ts
);

168 
	}
}

171 
	$d¬¿y´İ_g‘_äom_off£t
(
A¼ayPrİ”ty
 *
´İ
,

172 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

175 cÚ¡ 
PrİDescSA¼ayExŒa
 *
exŒa
 = 
´İ
->
commÚ
.
desü
->
exŒa_d©a
;

176 
PrİOff£t
 *
suboff£ts
 = 
exŒa
->
commÚ
.
off£ts
;

177 
gušt
 
i
;

178 
GLi¡
 *
obj_»c
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,GList *);

180 
	`´İ_off£t_li¡_ÿlcuÏ‹_qu¬ks
(
suboff£ts
);

182 
	`¬¿y´İ_ä“»cÜds
(
´İ
);

183 
	`g_±r_¬¿y_£t_size
(
´İ
->
»cÜds
,0);

185 
obj_»c
 = 
	`g_li¡_fœ¡
(obj_»c), 
i
 = 0;

186 
obj_»c
 !ğ
NULL
;

187 
obj_»c
 = 
	`g_li¡_Ãxt
(obj_»c), 
i
++) {

188 *
»c_š_obj
 = 
obj_»c
->
d©a
;

189 
GPŒA¼ay
 *
sub´İs
 = 
	`´İ_li¡_cİy
(
´İ
->
ex_´İs
);

191 
	`do_g‘_´İs_äom_off£ts
(
»c_š_obj
,
sub´İs
,
suboff£ts
);

193 
	`g_±r_¬¿y_add
(
´İ
->
»cÜds
,
sub´İs
);

195 
	}
}

197 
GLi¡
 *

198 
	$d¬¿y´İ_adju¡_objeù_»cÜds
(
A¼ayPrİ”ty
 *
´İ
,

199 cÚ¡ 
PrİDescDA¼ayExŒa
 *
exŒa
,

200 
GLi¡
 *
obj_»c
) {

201 
gušt
 
li¡_Ën
 = 
	`g_li¡_Ëngth
(
obj_»c
);

203 
li¡_Ën
 > 
´İ
->
»cÜds
->
Ën
) {

204 
gpoš‹r
 
»c
 = 
obj_»c
->
d©a
;

205 
obj_»c
 = 
	`g_li¡_»move
(obj_»c,
»c
);

206 
exŒa
->
	`ä“»c
(
»c
);

207 
li¡_Ën
--;

209 
li¡_Ën
 < 
´İ
->
»cÜds
->
Ën
) {

210 
obj_»c
 = 
	`g_li¡_­³nd
(obj_»c,
exŒa
->
	`Ãw»c
());

211 
li¡_Ën
++;

213  
obj_»c
;

214 
	}
}

217 
	$d¬¿y´İ_£t_äom_off£t
(
A¼ayPrİ”ty
 *
´İ
,

218 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

221 cÚ¡ 
PrİDescDA¼ayExŒa
 *
exŒa
 = 
´İ
->
commÚ
.
desü
->
exŒa_d©a
;

222 
PrİOff£t
 *
suboff£ts
 = 
exŒa
->
commÚ
.
off£ts
;

223 
gušt
 
i
;

224 
GLi¡
 *
obj_»c
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,GList *);

226 
	`´İ_off£t_li¡_ÿlcuÏ‹_qu¬ks
(
suboff£ts
);

228 
obj_»c
 = 
	`d¬¿y´İ_adju¡_objeù_»cÜds
(
´İ
,
exŒa
,obj_rec);

229 
	`¡ruù_memb”
(
ba£
,
off£t
,
GLi¡
 *èğ
obj_»c
;

231 
obj_»c
 = 
	`g_li¡_fœ¡
(obj_»c), 
i
 = 0;

232 
obj_»c
 !ğ
NULL
;

233 
obj_»c
 = 
	`g_li¡_Ãxt
(obj_»c), 
i
++) {

234 *
»c_š_obj
 = 
obj_»c
->
d©a
;

235 
GPŒA¼ay
 *
sub´İs
 = 
	`g_±r_¬¿y_šdex
(
´İ
->
»cÜds
,
i
);

237 
	`do_£t_´İs_äom_off£ts
(
»c_š_obj
,
sub´İs
,
suboff£ts
);

239 
	}
}

245 
	$d¬¿y_´İ_ed™
 (
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

247 
A¼ayPrİ”ty
 *
´İ
 = 
d©a
;

249 
	}
}

251 
WIDGET
 *

252 
	$¬¿y´İ_g‘_widg‘
(
A¼ayPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

254 
GtkWidg‘
 *
»t
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
 (
´İ
->
commÚ
.
desü
->
toŞt
);

255 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
»t
), "clicked",

256 
	`G_CALLBACK
 (
d¬¿y_´İ_ed™
), 
´İ
);

258  
»t
;

259 
	}
}

262 
	$¬¿y´İ_»£t_widg‘
(
NoİPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

264 
	}
}

267 
	$¬¿y´İ_£t_äom_widg‘
(
NoİPrİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

269 
	}
}

271 
gboŞ—n


272 
	$¬¿y´İ_ÿn_m”ge
(cÚ¡ 
PrİDesütiÚ
 *
pd1
, cÚ¡ PrİDesütiÚ *
pd2
)

274 ià(
pd1
->
exŒa_d©a
 !ğ
pd2
->exŒa_d©aè 
FALSE
;

275  
TRUE
;

276 
	}
}

278 cÚ¡ 
Prİ”tyOps
 
	g§¼ay´İ_İs
 = {

279 (
Prİ”tyTy³_New
è
¬¿y´İ_Ãw
,

280 (
Prİ”tyTy³_F»e
è
¬¿y´İ_ä“
,

281 (
Prİ”tyTy³_Cİy
è
¬¿y´İ_cİy
,

282 (
Prİ”tyTy³_Lßd
è
¬¿y´İ_lßd
,

283 (
Prİ”tyTy³_Save
è
¬¿y´İ_§ve
,

285 (
Prİ”tyTy³_G‘Widg‘
è
¬¿y´İ_g‘_widg‘
,

286 (
Prİ”tyTy³_Re£tWidg‘
è
¬¿y´İ_»£t_widg‘
,

287 (
Prİ”tyTy³_S‘FromWidg‘
è
¬¿y´İ_£t_äom_widg‘
,

289 (
Prİ”tyTy³_CªM”ge
è
¬¿y´İ_ÿn_m”ge
,

290 (
Prİ”tyTy³_G‘FromOff£t
è
§¼ay´İ_g‘_äom_off£t
,

291 (
Prİ”tyTy³_S‘FromOff£t
è
§¼ay´İ_£t_äom_off£t


294 cÚ¡ 
Prİ”tyOps
 
	gd¬¿y´İ_İs
 = {

295 (
Prİ”tyTy³_New
è
¬¿y´İ_Ãw
,

296 (
Prİ”tyTy³_F»e
è
¬¿y´İ_ä“
,

297 (
Prİ”tyTy³_Cİy
è
¬¿y´İ_cİy
,

298 (
Prİ”tyTy³_Lßd
è
¬¿y´İ_lßd
,

299 (
Prİ”tyTy³_Save
è
¬¿y´İ_§ve
,

301 (
Prİ”tyTy³_G‘Widg‘
è
¬¿y´İ_g‘_widg‘
,

302 (
Prİ”tyTy³_Re£tWidg‘
è
¬¿y´İ_»£t_widg‘
,

303 (
Prİ”tyTy³_S‘FromWidg‘
è
¬¿y´İ_£t_äom_widg‘
,

305 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

306 (
Prİ”tyTy³_G‘FromOff£t
è
d¬¿y´İ_g‘_äom_off£t
,

307 (
Prİ”tyTy³_S‘FromOff£t
è
d¬¿y´İ_£t_äom_off£t


313 
	$´İ_sd¬¿y_»gi¡”
()

315 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_SARRAY
,&
§¼ay´İ_İs
);

316 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_DARRAY
,&
d¬¿y´İ_İs
);

317 
	}
}

	@O:\tool\dvs50\lib\prop_sdarray.h

27 #iâdeà
PROP_SDARRAY_H


28 
	#PROP_SDARRAY_H


	)

30 
	~"´İ”t›s.h
"

31 
	~"dŸ_xml.h
"

34 
Prİ”ty
 
	mcommÚ
;

35 
GPŒA¼ay
 *
	mex_´İs
;

36 
GPŒA¼ay
 *
	m»cÜds
;

37 } 
	tA¼ayPrİ”ty
;

39 
´İ_sd¬¿y_»gi¡”
();

	@O:\tool\dvs50\lib\prop_text.c

26 #ifdeà
HAVE_CONFIG_H


27 
	~<cÚfig.h
>

30 
	~<gtk/gtk.h
>

31 
	~<gdk/gdkkeysyms.h
>

32 
	~"widg‘s.h
"

33 
	~"´İ”t›s.h
"

34 
	~"´İš‹º®s.h
"

35 
	~"‹xt.h
"

36 
	~"group.h
"

42 
SŒšgPrİ”ty
 *

43 
	$¡ršg´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

45 
SŒšgPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(StringProperty,1);

46 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

47 
´İ
->
¡ršg_d©a
 = 
NULL
;

48 
´İ
->
num_lšes
 = 1;

49  
´İ
;

50 
	}
}

52 
SŒšgPrİ”ty
 *

53 
	$muÉi¡ršg´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
,

54 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

56 
SŒšgPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(StringProperty,1);

57 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

58 
´İ
->
¡ršg_d©a
 = 
NULL
;

59 
´İ
->
num_lšes
 = 
	`GPOINTER_TO_INT
(
pdesc
->
exŒa_d©a
);

60  
´İ
;

61 
	}
}

63 
SŒšgPrİ”ty
 *

64 
	$¡ršg´İ_cİy
(
SŒšgPrİ”ty
 *
¤c
)

66 
SŒšgPrİ”ty
 *
´İ
 =

67 (
SŒšgPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

68 
¤c
->
commÚ
.
»asÚ
);

69 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

70 ià(
¤c
->
¡ršg_d©a
)

71 
´İ
->
¡ršg_d©a
 = 
	`g_¡rdup
(
¤c
->string_data);

73 
´İ
->
¡ršg_d©a
 = 
NULL
;

74 
´İ
->
num_lšes
 = 
¤c
->num_lines;

75  
´İ
;

76 
	}
}

79 
	$¡ršg´İ_ä“
(
SŒšgPrİ”ty
 *
´İ
)

81 
	`g_ä“
(
´İ
->
¡ršg_d©a
);

82 
	`g_ä“
(
´İ
);

83 
	}
}

85 
GtkWidg‘
 *

86 
	$¡ršg´İ_g‘_widg‘
(
SŒšgPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

88 
GtkWidg‘
 *
»t
 = 
	`gtk_’Œy_Ãw
();

89 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "changed");

90  
»t
;

91 
	}
}

94 
	$¡ršg´İ_»£t_widg‘
(
SŒšgPrİ”ty
 *
´İ
, 
GtkWidg‘
 *
widg‘
)

96 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
widg‘
),

97 
´İ
->
¡ršg_d©a
 ?…rop->string_data : "");

98 
	}
}

101 
	$¡ršg´İ_£t_äom_widg‘
(
SŒšgPrİ”ty
 *
´İ
, 
GtkWidg‘
 *
widg‘
)

103 
	`g_ä“
(
´İ
->
¡ršg_d©a
);

104 
´İ
->
¡ršg_d©a
 =

105 
	`g_¡rdup
 (
	`gtk_’Œy_g‘_‹xt
 (
	`GTK_ENTRY
(
widg‘
)));

106 
	}
}

108 
gboŞ—n


109 
	$muÉi¡ršg´İ_hªdË_key
(
GtkWidg‘
 *
wid
, 
GdkEv’tKey
 *
ev’t
)

115 ià(
ev’t
->
keyv®
 =ğ
GDK_R‘uº
)

116  
TRUE
;

117  
FALSE
;

118 
	}
}

120 
GtkWidg‘
 *

121 
	$muÉi¡ršg´İ_g‘_widg‘
(
SŒšgPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

123 
GtkWidg‘
 *
»t
 = 
	`gtk_‹xt_v›w_Ãw
();

124 
GtkTextBufãr
 *
bufãr
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
	`GTK_TEXT_VIEW
(
»t
));

125 
GtkWidg‘
 *
äame
 = 
	`gtk_äame_Ãw
(
NULL
);

126 
	`gtk_äame_£t_shadow_ty³
(
	`GTK_FRAME
(
äame
), 
GTK_SHADOW_IN
);

127 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
äame
), 
»t
);

128 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
»t
), "key-release-event",

129 
	`G_CALLBACK
(
muÉi¡ršg´İ_hªdË_key
), 
NULL
);

130 
	`gtk_widg‘_show
(
»t
);

131 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
bufãr
), "changed");

132  
äame
;

133 
	}
}

136 
	$muÉi¡ršg´İ_»£t_widg‘
(
SŒšgPrİ”ty
 *
´İ
, 
GtkWidg‘
 *
widg‘
)

138 
GtkWidg‘
 *
‹xtv›w
 = 
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
widg‘
));

139 
GtkTextBufãr
 *
bufãr
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
	`GTK_TEXT_VIEW
(
‹xtv›w
));

140 
	`gtk_‹xt_bufãr_£t_‹xt
(
bufãr
,

141 
´İ
->
¡ršg_d©a
 ?…rop->string_data : "", -1);

142 
	}
}

145 
	$muÉi¡ršg´İ_£t_äom_widg‘
(
SŒšgPrİ”ty
 *
´İ
, 
GtkWidg‘
 *
widg‘
) {

146 
GtkWidg‘
 *
‹xtv›w
 = 
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
widg‘
));

147 
GtkTextBufãr
 *
bufãr
 = 
	`gtk_‹xt_v›w_g‘_bufãr
(
	`GTK_TEXT_VIEW
(
‹xtv›w
));

148 
GtkTextI‹r
 
¡¬t
, 
’d
;

149 
	`gtk_‹xt_bufãr_g‘_¡¬t_™”
(
bufãr
, &
¡¬t
);

150 
	`gtk_‹xt_bufãr_g‘_’d_™”
(
bufãr
, &
’d
);

151 
	`g_ä“
(
´İ
->
¡ršg_d©a
);

152 
´İ
->
¡ršg_d©a
 =

153 
	`g_¡rdup
 (
	`gtk_‹xt_bufãr_g‘_‹xt
 (
bufãr
, &
¡¬t
, &
’d
, 
TRUE
));

154 
	}
}

156 
GtkWidg‘
 *

157 
	$f•rİ_g‘_widg‘
(
SŒšgPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

159 
GtkWidg‘
 *
»t
 = 
	`dŸ_fe_£ËùÜ_Ãw
();

160 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "value-changed");

161  
»t
;

162 
	}
}

165 
	$f•rİ_»£t_widg‘
(
SŒšgPrİ”ty
 *
´İ
, 
GtkWidg‘
 *
widg‘
)

167 
	`dŸ_fe_£ËùÜ_£t_fe
(
	`DIAFILESELECTOR
(
widg‘
),
´İ
->
¡ršg_d©a
);

168 
	}
}

171 
	$f•rİ_£t_äom_widg‘
(
SŒšgPrİ”ty
 *
´İ
, 
GtkWidg‘
 *
widg‘
)

173 
	`g_ä“
(
´İ
->
¡ršg_d©a
);

174 
´İ
->
¡ršg_d©a
 =

175 
	`g_¡rdup
(
	`dŸ_fe_£ËùÜ_g‘_fe
(
	`DIAFILESELECTOR
(
widg‘
)));

176 
	}
}

179 
	$¡ršg´İ_lßd
(
SŒšgPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

181 
	`g_ä“
(
´İ
->
¡ršg_d©a
);

182 
´İ
->
¡ršg_d©a
 = 
	`d©a_¡ršg
(
d©a
);

183 ià(
´İ
->
¡ršg_d©a
 =ğ
NULL
) {

184 
´İ
->
¡ršg_d©a
 = 
	`g_¡rdup
("");

186 
	}
}

189 
	$¡ršg´İ_§ve
(
SŒšgPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

191 
	`d©a_add_¡ršg
(
©Œ
, 
´İ
->
¡ršg_d©a
);

192 
	}
}

195 
	$¡ršg´İ_g‘_äom_off£t
(
SŒšgPrİ”ty
 *
´İ
,

196 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

198 
	`g_ä“
(
´İ
->
¡ršg_d©a
);

199 
´İ
->
¡ršg_d©a
 = 
	`g_¡rdup
(
	`¡ruù_memb”
(
ba£
,
off£t
,
gch¬
 *));

200 
	}
}

203 
	$¡ršg´İ_£t_äom_off£t
(
SŒšgPrİ”ty
 *
´İ
,

204 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

206 
	`g_ä“
(
	`¡ruù_memb”
(
ba£
,
off£t
,
gch¬
 *));

207 
	`¡ruù_memb”
(
ba£
,
off£t
,
gch¬
 *èğ
	`g_¡rdup
(
´İ
->
¡ršg_d©a
);

208 
	}
}

211 
	$¡ršg´İ_g‘_d©a_size
(
SŒšgPrİ”ty
 *
´İ
)

213   (
´İ
->
¡ršg_d©a
);

214 
	}
}

216 
SŒšgLi¡Prİ”ty
 *

217 
	$¡ršgli¡´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

219 
SŒšgLi¡Prİ”ty
 *
´İ
 = 
	`g_Ãw0
(StringListProperty,1);

220 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

221 
´İ
->
¡ršg_li¡
 = 
NULL
;

222  
´İ
;

223 
	}
}

226 
	$¡ršgli¡´İ_ä“
(
SŒšgLi¡Prİ”ty
 *
´İ
)

228 
	`g_li¡_fÜ—ch
(
´İ
->
¡ršg_li¡
, (
GFunc
)
g_ä“
, 
NULL
);

229 
	`g_li¡_ä“
(
´İ
->
¡ršg_li¡
);

230 
	`g_ä“
(
´İ
);

231 
	}
}

233 
SŒšgLi¡Prİ”ty
 *

234 
	$¡ršgli¡´İ_cİy
(
SŒšgLi¡Prİ”ty
 *
¤c
)

236 
SŒšgLi¡Prİ”ty
 *
´İ
 =

237 (
SŒšgLi¡Prİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

238 
¤c
->
commÚ
.
»asÚ
);

239 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

240 ià(
¤c
->
¡ršg_li¡
) {

241 
GLi¡
 *
tmp
;

243 
tmp
 = 
¤c
->
¡ršg_li¡
;m°!ğ
NULL
;m°ğtmp->
Ãxt
)

244 
´İ
->
¡ršg_li¡
 = 
	`g_li¡_­³nd
Õrİ->¡ršg_li¡, 
	`g_¡rdup
(
tmp
->
d©a
));

247 
´İ
->
¡ršg_li¡
 = 
NULL
;

248  
´İ
;

249 
	}
}

252 
	$¡ršgli¡´İ_lßd
(
SŒšgLi¡Prİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

254 
	`g_w¬nšg
("stringlistprop_load‚ot implemented");

255 
	}
}

258 
	$¡ršgli¡´İ_§ve
(
SŒšgPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

260 
	`g_w¬nšg
("stringlistprop_save‚ot implemented");

261 
	}
}

264 
	$¡ršgli¡´İ_g‘_äom_off£t
(
SŒšgLi¡Prİ”ty
 *
´İ
,

265 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

267 
GLi¡
 *
tmp
, *
l¡
 = 
´İ
->
¡ršg_li¡
;

269 
	`g_li¡_fÜ—ch
(
l¡
, (
GFunc
)
g_ä“
, 
NULL
);

270 
	`g_li¡_ä“
(
l¡
);

271 
tmp
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,
GLi¡
 *);m°!ğ
NULL
;m°ğtmp->
Ãxt
)

272 
l¡
 = 
	`g_li¡_­³nd
Ö¡, 
	`g_¡rdup
(
tmp
->
d©a
));

273 
´İ
->
¡ršg_li¡
 = 
l¡
;

274 
	}
}

277 
	$¡ršgli¡´İ_£t_äom_off£t
(
SŒšgLi¡Prİ”ty
 *
´İ
,

278 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

280 
GLi¡
 *
tmp
, *
l¡
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,GList *);

282 
	`g_li¡_fÜ—ch
(
l¡
, (
GFunc
)
g_ä“
, 
NULL
);

283 
	`g_li¡_ä“
(
l¡
);

284 
tmp
 = 
´İ
->
¡ršg_li¡
;m°!ğ
NULL
;m°ğtmp->
Ãxt
)

285 
l¡
 = 
	`g_li¡_­³nd
Ö¡, 
	`g_¡rdup
(
tmp
->
d©a
));

286 
	`¡ruù_memb”
(
ba£
,
off£t
,
GLi¡
 *èğ
l¡
;

287 
	}
}

289 cÚ¡ 
Prİ”tyOps
 
	g¡ršg´İ_İs
 = {

290 (
Prİ”tyTy³_New
è
¡ršg´İ_Ãw
,

291 (
Prİ”tyTy³_F»e
è
¡ršg´İ_ä“
,

292 (
Prİ”tyTy³_Cİy
è
¡ršg´İ_cİy
,

293 (
Prİ”tyTy³_Lßd
è
¡ršg´İ_lßd
,

294 (
Prİ”tyTy³_Save
è
¡ršg´İ_§ve
,

295 (
Prİ”tyTy³_G‘Widg‘
è
¡ršg´İ_g‘_widg‘
,

296 (
Prİ”tyTy³_Re£tWidg‘
è
¡ršg´İ_»£t_widg‘
,

297 (
Prİ”tyTy³_S‘FromWidg‘
è
¡ršg´İ_£t_äom_widg‘
,

299 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

300 (
Prİ”tyTy³_G‘FromOff£t
è
¡ršg´İ_g‘_äom_off£t
,

301 (
Prİ”tyTy³_S‘FromOff£t
è
¡ršg´İ_£t_äom_off£t
,

302 (
Prİ”tyTy³_G‘D©aSize
è
¡ršg´İ_g‘_d©a_size


305 cÚ¡ 
Prİ”tyOps
 
	g¡ršgli¡´İ_İs
 = {

306 (
Prİ”tyTy³_New
è
¡ršgli¡´İ_Ãw
,

307 (
Prİ”tyTy³_F»e
è
¡ršgli¡´İ_ä“
,

308 (
Prİ”tyTy³_Cİy
è
¡ršgli¡´İ_cİy
,

309 (
Prİ”tyTy³_Lßd
è
¡ršgli¡´İ_lßd
,

310 (
Prİ”tyTy³_Save
è
¡ršgli¡´İ_§ve
,

311 (
Prİ”tyTy³_G‘Widg‘
è
noİ´İ_g‘_widg‘
,

312 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

313 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

315 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

316 (
Prİ”tyTy³_G‘FromOff£t
è
¡ršgli¡´İ_g‘_äom_off£t
,

317 (
Prİ”tyTy³_S‘FromOff£t
è
¡ršgli¡´İ_£t_äom_off£t


320 cÚ¡ 
Prİ”tyOps
 
	gmuÉi¡ršg´İ_İs
 = {

321 (
Prİ”tyTy³_New
è
muÉi¡ršg´İ_Ãw
,

322 (
Prİ”tyTy³_F»e
è
¡ršg´İ_ä“
,

323 (
Prİ”tyTy³_Cİy
è
¡ršg´İ_cİy
,

324 (
Prİ”tyTy³_Lßd
è
¡ršg´İ_lßd
,

325 (
Prİ”tyTy³_Save
è
¡ršg´İ_§ve
,

326 (
Prİ”tyTy³_G‘Widg‘
è
muÉi¡ršg´İ_g‘_widg‘
,

327 (
Prİ”tyTy³_Re£tWidg‘
è
muÉi¡ršg´İ_»£t_widg‘
,

328 (
Prİ”tyTy³_S‘FromWidg‘
è
muÉi¡ršg´İ_£t_äom_widg‘
,

330 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

331 (
Prİ”tyTy³_G‘FromOff£t
è
¡ršg´İ_g‘_äom_off£t
,

332 (
Prİ”tyTy³_S‘FromOff£t
è
¡ršg´İ_£t_äom_off£t


335 cÚ¡ 
Prİ”tyOps
 
	gf•rİ_İs
 = {

336 (
Prİ”tyTy³_New
è
¡ršg´İ_Ãw
,

337 (
Prİ”tyTy³_F»e
è
¡ršg´İ_ä“
,

338 (
Prİ”tyTy³_Cİy
è
¡ršg´İ_cİy
,

339 (
Prİ”tyTy³_Lßd
è
¡ršg´İ_lßd
,

340 (
Prİ”tyTy³_Save
è
¡ršg´İ_§ve
,

341 (
Prİ”tyTy³_G‘Widg‘
è
f•rİ_g‘_widg‘
,

342 (
Prİ”tyTy³_Re£tWidg‘
è
f•rİ_»£t_widg‘
,

343 (
Prİ”tyTy³_S‘FromWidg‘
è
f•rİ_£t_äom_widg‘
,

345 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

346 (
Prİ”tyTy³_G‘FromOff£t
è
¡ršg´İ_g‘_äom_off£t
,

347 (
Prİ”tyTy³_S‘FromOff£t
è
¡ršg´İ_£t_äom_off£t


354 
TextPrİ”ty
 *

355 
	$‹xrİ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

357 
TextPrİ”ty
 *
´İ
 = 
	`g_Ãw0
(TextProperty,1);

358 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

359 
´İ
->
‹xt_d©a
 = 
NULL
;

360  
´İ
;

361 
	}
}

363 
TextPrİ”ty
 *

364 
	$‹xrİ_cİy
(
TextPrİ”ty
 *
¤c
)

366 
TextPrİ”ty
 *
´İ
 =

367 (
TextPrİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

368 
¤c
->
commÚ
.
»asÚ
);

369 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

370 ià(
¤c
->
‹xt_d©a
)

371 
´İ
->
‹xt_d©a
 = 
	`g_¡rdup
(
¤c
->text_data);

373 
´İ
->
‹xt_d©a
 = 
NULL
;

374  
´İ
;

375 
	}
}

378 
	$‹xrİ_ä“
(
TextPrİ”ty
 *
´İ
)

380 ià(
´İ
->
©Œ
.
fÚt
)

381 
	`dŸ_fÚt_uÄef
(
´İ
->
©Œ
.
fÚt
);

382 
	`g_ä“
(
´İ
->
‹xt_d©a
);

383 
	`g_ä“
(
´İ
);

384 
	}
}

387 
	$‹xrİ_lßd
(
TextPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
, 
D©aNode
 
d©a
)

389 
Text
 *
‹xt
;

390 
	`g_ä“
(
´İ
->
‹xt_d©a
);

391 
‹xt
 = 
	`d©a_‹xt
(
d©a
);

392 
	`‹xt_g‘_©Œibu‹s
(
‹xt
,&
´İ
->
©Œ
);

393 
´İ
->
‹xt_d©a
 = 
	`‹xt_g‘_¡ršg_cİy
(
‹xt
);

394 
	`‹xt_de¡roy
(
‹xt
);

395 
	}
}

398 
	$‹xrİ_§ve
(
TextPrİ”ty
 *
´İ
, 
A‰ribu‹Node
 
©Œ
)

400 
Text
 *
‹xt
 = 
	`Ãw_‹xt
(
´İ
->
‹xt_d©a
,

401 
´İ
->
©Œ
.
fÚt
,

402 
´İ
->
©Œ
.
height
,

403 &
´İ
->
©Œ
.
pos™iÚ
,

404 &
´İ
->
©Œ
.
cŞÜ
,

405 
´İ
->
©Œ
.
®ignm’t
);

406 
	`d©a_add_‹xt
(
©Œ
,
‹xt
);

407 
	`‹xt_de¡roy
(
‹xt
);

408 
	}
}

411 
	$‹xrİ_g‘_äom_off£t
(
TextPrİ”ty
 *
´İ
,

412 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

414 
Text
 *
‹xt
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,Text *);

415 
	`g_ä“
(
´İ
->
‹xt_d©a
);

416 
´İ
->
‹xt_d©a
 = 
	`‹xt_g‘_¡ršg_cİy
(
‹xt
);

417 
	`‹xt_g‘_©Œibu‹s
(
‹xt
,&
´İ
->
©Œ
);

418 
	}
}

421 
	$‹xrİ_£t_äom_off£t
(
TextPrİ”ty
 *
´İ
,

422 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

424 
Text
 *
‹xt
 = 
	`¡ruù_memb”
(
ba£
,
off£t
,Text *);

425 
	`‹xt_£t_¡ršg
(
‹xt
,
´İ
->
‹xt_d©a
);

426 
	`‹xt_£t_©Œibu‹s
(
‹xt
,&
´İ
->
©Œ
);

427 
	}
}

429 cÚ¡ 
Prİ”tyOps
 
	g‹xrİ_İs
 = {

430 (
Prİ”tyTy³_New
è
‹xrİ_Ãw
,

431 (
Prİ”tyTy³_F»e
è
‹xrİ_ä“
,

432 (
Prİ”tyTy³_Cİy
è
‹xrİ_cİy
,

433 (
Prİ”tyTy³_Lßd
è
‹xrİ_lßd
,

434 (
Prİ”tyTy³_Save
è
‹xrİ_§ve
,

435 (
Prİ”tyTy³_G‘Widg‘
è
noİ´İ_g‘_widg‘
,

436 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

437 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

439 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

440 (
Prİ”tyTy³_G‘FromOff£t
è
‹xrİ_g‘_äom_off£t
,

441 (
Prİ”tyTy³_S‘FromOff£t
è
‹xrİ_£t_äom_off£t


447 
	$´İ_‹xt_»gi¡”
()

449 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_STRING
,&
¡ršg´İ_İs
);

450 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_STRINGLIST
,&
¡ršgli¡´İ_İs
);

451 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_MULTISTRING
,&
muÉi¡ršg´İ_İs
);

452 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_FILE
,&
f•rİ_İs
);

453 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_TEXT
,&
‹xrİ_İs
);

454 
	}
}

459 
gch¬
 *

460 
	$objeù_g‘_di¥ÏyÇme
 (
DŸObjeù
* 
objeù
)

462 
gch¬
 *
Çme
 = 
NULL
;

463 
Prİ”ty
 *
´İ
 = 
NULL
;

465 ià(!
objeù
)

466  
	`g_¡rdup
 ("<null>");

468 ià(
	`IS_GROUP
(
objeù
))

469 
Çme
 = 
	`g_¡rdup_´štf
 (
	`_
("Grou°w™h %d objeùs"), 
	`g_li¡_Ëngth
(
	`group_objeùs
(
objeù
)));

470 ià((
´İ
 = 
	`objeù_´İ_by_Çme
(
objeù
, "Çme")è!ğ
NULL
)

471 
Çme
 = 
	`g_¡rdup
 (((
SŒšgPrİ”ty
 *)
´İ
)->
¡ršg_d©a
);

472 ià((
´İ
 = 
	`objeù_´İ_by_Çme
(
objeù
, "‹xt")è!ğ
NULL
)

473 
Çme
 = 
	`g_¡rdup
 (((
TextPrİ”ty
 *)
´İ
)->
‹xt_d©a
);

475 ià(!
Çme
)

476 
Çme
 = 
	`g_¡rdup
 (
objeù
->
ty³
->name);

478 ià(
´İ
)

479 
´İ
->
İs
->
	`ä“
(prop);

481 
Çme
 = 
	`g_¡rd–im™
 (name, "\n", ' ');

483  
Çme
;

484 
	}
}

	@O:\tool\dvs50\lib\prop_text.h

25 #iâdeà
PROP_TEXT_H


26 
	#PROP_TEXT_H


	)

28 
	~"´İ”t›s.h
"

29 
	~"dŸ_xml.h
"

30 
	~"‹xt.h
"

34 
Prİ”ty
 
	mcommÚ
;

35 
gch¬
 *
	m¡ršg_d©a
;

36 
gšt
 
	mnum_lšes
;

37 } 
	tSŒšgPrİ”ty
;

40 
Prİ”ty
 
	mcommÚ
;

41 
GLi¡
 *
	m¡ršg_li¡
;

42 } 
	tSŒšgLi¡Prİ”ty
;

45 
Prİ”ty
 
	mcommÚ
;

46 
gch¬
 *
	m‹xt_d©a
;

47 
TextA‰ribu‹s
 
	m©Œ
;

48 } 
	tTextPrİ”ty
;

50 
´İ_‹xt_»gi¡”
();

	@O:\tool\dvs50\lib\prop_widgets.c

25 #ifdeà
HAVE_CONFIG_H


26 
	~<cÚfig.h
>

29 
	~<glib.h
>

30 #undeà
GTK_DISABLE_DEPRECATED


31 
	~<gtk/gtk.h
>

32 
	#WIDGET
 
GtkWidg‘


	)

33 
	~"widg‘s.h
"

34 
	~"´İ”t›s.h
"

35 
	~"´İš‹º®s.h
"

41 
WIDGET
 *

42 
	$¡©iırİ_g‘_widg‘
(
SticPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

44 
GtkWidg‘
 *
»t
 = 
NULL
;

45 ià(!
´İ
->
commÚ
.
desü
è 
NULL
;

47 
»t
 = 
	`gtk_Ïb–_Ãw
(
´İ
->
commÚ
.
desü
->
toŞt
);

48 
	`gtk_Ïb–_£t_ju¡ify
(
	`GTK_LABEL
(
»t
),
GTK_JUSTIFY_LEFT
);

49  
»t
;

50 
	}
}

52 cÚ¡ 
Prİ”tyOps
 
	g¡©iırİ_İs
 = {

53 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

54 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

55 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

56 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

57 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

58 (
Prİ”tyTy³_G‘Widg‘
è
¡©iırİ_g‘_widg‘
,

59 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

60 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

62 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

63 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

64 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


72 
WIDGET
 *

73 
	$bu‰Ú´İ_g‘_widg‘
(
Bu‰ÚPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

75 
GtkWidg‘
 *
»t
 = 
NULL
;

76 ià(!
´İ
->
commÚ
.
desü
è 
NULL
;

78 
»t
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
	`_
(
´İ
->
commÚ
.
desü
->
toŞt
));

79 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "clicked");

81  
»t
;

82 
	}
}

84 cÚ¡ 
Prİ”tyOps
 
	gbu‰Ú´İ_İs
 = {

85 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

86 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

87 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

88 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

89 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

90 (
Prİ”tyTy³_G‘Widg‘
è
bu‰Ú´İ_g‘_widg‘
,

91 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

92 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

94 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

95 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

96 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


103 
	sFŞdBu‰ÚInfo
 {

104 
GtkWidg‘
 *
	munfŞdbu‰Ú
;

105 
GtkWidg‘
 *
	mäame
;

109 
	$äame_fŞd_unfŞd
(
GtkWidg‘
 *
bu‰Ú1
, 
gpoš‹r
 
u£rd©a
)

111 
FŞdBu‰ÚInfo
 *
šfo
 = (FŞdBu‰ÚInfØ*)
u£rd©a
;

113 ià(
bu‰Ú1
 =ğ
šfo
->
unfŞdbu‰Ú
) {

114 
	`gtk_widg‘_£t_£ns™ive
 (
šfo
->
unfŞdbu‰Ú
, 
FALSE
);

115 
	`gtk_widg‘_hide
(
šfo
->
unfŞdbu‰Ú
);

116 
	`gtk_widg‘_show
(
šfo
->
äame
);

118 
	`gtk_widg‘_hide
(
šfo
->
äame
);

119 
	`gtk_widg‘_show
(
šfo
->
unfŞdbu‰Ú
);

120 
	`gtk_widg‘_£t_£ns™ive
 (
šfo
->
unfŞdbu‰Ú
, 
TRUE
);

122 
	}
}

124 
WIDGET
 *

125 
	$äame_begš´İ_g‘_widg‘
(
F¿mePrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

127 
gch¬
 *
fŞd¡ršg
 = 
	`g_¡rdup_´štf
("% <<<", 
´İ
->
commÚ
.
desü
->
desütiÚ
);

128 
gch¬
 *
unfŞd¡ršg
 = 
	`g_¡rdup_´štf
("% >>>", 
´İ
->
commÚ
.
desü
->
desütiÚ
);

129 
GtkWidg‘
 *
äame
 = 
	`gtk_äame_Ãw
(
NULL
);

130 
GtkWidg‘
 *
vbox
 = 
	`gtk_vbox_Ãw
(
FALSE
,2);

131 
GtkWidg‘
 *
fŞdbu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
fŞd¡ršg
);

132 
GtkWidg‘
 *
unfŞdbu‰Ú
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
unfŞd¡ršg
);

134 
FŞdBu‰ÚInfo
 *
šfo
 = 
	`g_Ãw
(FoldButtonInfo, 1);

136 
	`g_ä“
(
fŞd¡ršg
);

137 
	`g_ä“
(
unfŞd¡ršg
);

139 
šfo
->
äame
 = frame;

140 
šfo
->
unfŞdbu‰Ú
 = unfoldbutton;

142 
	`gtk_äame_£t_Ïb–_widg‘
(
	`GTK_FRAME
(
äame
), 
fŞdbu‰Ú
);

144 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
(
äame
), 2);

145 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
äame
),
vbox
);

146 
	`gtk_widg‘_£t_£ns™ive
 (
unfŞdbu‰Ú
, 
FALSE
);

147 
	`gtk_widg‘_show
(
fŞdbu‰Ú
);

148 
	`gtk_widg‘_show
(
äame
);

149 
	`gtk_widg‘_show
(
vbox
);

151 
	`´İ_dŸlog_add_¿w
(
dŸlog
, 
äame
);

153 
	`´İ_dŸlog_add_¿w_w™h_æags
(
dŸlog
, 
unfŞdbu‰Ú
, 
FALSE
, FALSE);

155 
	`gtk_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
fŞdbu‰Ú
), "clicked",

156 
	`GTK_SIGNAL_FUNC
(
äame_fŞd_unfŞd
), 
šfo
);

157 
	`gtk_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
unfŞdbu‰Ú
), "clicked",

158 
	`GTK_SIGNAL_FUNC
(
äame_fŞd_unfŞd
), 
šfo
);

160 
	`´İ_dŸlog_cÚš”_push
(
dŸlog
,
vbox
);

162  
NULL
;

163 
	}
}

165 
WIDGET
 *

166 
	$äame_’d´İ_g‘_widg‘
(
F¿mePrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

168 
	`´İ_dŸlog_cÚš”_pİ
(
dŸlog
);

169  
NULL
;

170 
	}
}

172 cÚ¡ 
Prİ”tyOps
 
	gäame_begš´İ_İs
 = {

173 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

174 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

175 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

176 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

177 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

178 (
Prİ”tyTy³_G‘Widg‘
è
äame_begš´İ_g‘_widg‘
,

179 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

180 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

182 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

183 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

184 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


187 cÚ¡ 
Prİ”tyOps
 
	gäame_’d´İ_İs
 = {

188 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

189 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

190 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

191 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

192 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

193 (
Prİ”tyTy³_G‘Widg‘
è
äame_’d´İ_g‘_widg‘
,

194 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

195 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

197 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

198 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

199 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


206 
WIDGET
 *

207 
	$muÉicŞ_begš´İ_g‘_widg‘
(
MuÉicŞPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

209 
GtkWidg‘
 *
muÉicŞ
 = 
	`gtk_hbox_Ãw
(
FALSE
,1);

211 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
(
muÉicŞ
), 2);

212 
	`gtk_widg‘_show
(
muÉicŞ
);

214 
	`´İ_dŸlog_add_¿w
(
dŸlog
,
muÉicŞ
);

216 
	`´İ_dŸlog_cÚš”_push
(
dŸlog
,
muÉicŞ
);

217 
	`´İ_dŸlog_cÚš”_push
(
dŸlog
,
NULL
);

219  
NULL
;

220 
	}
}

222 
WIDGET
 *

223 
	$muÉicŞ_cŞumÅrİ_g‘_widg‘
(
MuÉicŞPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

225 
GtkWidg‘
 *
cŞ
 = 
	`gtk_vbox_Ãw
(
FALSE
,1);

227 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
(
cŞ
), 2);

228 
	`gtk_widg‘_show
(
cŞ
);

230 
	`´İ_dŸlog_cÚš”_pİ
(
dŸlog
);

232 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
dŸlog
->
Ï¡cÚt
),
cŞ
);

234 
	`´İ_dŸlog_add_¿w
(
dŸlog
,
NULL
);

235 
	`´İ_dŸlog_cÚš”_push
(
dŸlog
,
cŞ
);

237  
NULL
;

238 
	}
}

240 
WIDGET
 *

241 
	$muÉicŞ_’d´İ_g‘_widg‘
(
MuÉicŞPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

243 
	`´İ_dŸlog_cÚš”_pİ
(
dŸlog
);

244 
	`´İ_dŸlog_cÚš”_pİ
(
dŸlog
);

245  
NULL
;

246 
	}
}

248 cÚ¡ 
Prİ”tyOps
 
	gmuÉicŞ_begš´İ_İs
 = {

249 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

250 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

251 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

252 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

253 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

254 (
Prİ”tyTy³_G‘Widg‘
è
muÉicŞ_begš´İ_g‘_widg‘
,

255 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

256 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

258 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

259 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

260 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


263 cÚ¡ 
Prİ”tyOps
 
	gmuÉicŞ_cŞumÅrİ_İs
 = {

264 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

265 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

266 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

267 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

268 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

269 (
Prİ”tyTy³_G‘Widg‘
è
muÉicŞ_cŞumÅrİ_g‘_widg‘
,

270 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

271 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

273 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

274 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

275 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


278 cÚ¡ 
Prİ”tyOps
 
	gmuÉicŞ_’d´İ_İs
 = {

279 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

280 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

281 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

282 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

283 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

284 (
Prİ”tyTy³_G‘Widg‘
è
muÉicŞ_’d´İ_g‘_widg‘
,

285 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

286 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

288 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

289 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

290 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


297 
WIDGET
 *

298 
	$nÙebook_begš´İ_g‘_widg‘
(
NÙebookPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

300 
GtkWidg‘
 *
nÙebook
 = 
	`gtk_nÙebook_Ãw
();

302 
	`gtk_nÙebook_£t_b_pos
(
	`GTK_NOTEBOOK
(
nÙebook
),
GTK_POS_TOP
);

303 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
(
nÙebook
), 1);

304 
	`gtk_widg‘_show
(
nÙebook
);

306 
	`´İ_dŸlog_add_¿w
(
dŸlog
,
nÙebook
);

308 
	`´İ_dŸlog_cÚš”_push
(
dŸlog
,
nÙebook
);

309 
	`´İ_dŸlog_cÚš”_push
(
dŸlog
,
NULL
);

311  
NULL
;

312 
	}
}

314 
WIDGET
 *

315 
	$nÙebook_·g•rİ_g‘_widg‘
(
NÙebookPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

317 
GtkWidg‘
 *
·ge
 = 
	`gtk_vbox_Ãw
(
FALSE
,1);

318 
GtkWidg‘
 *
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
(
´İ
->
commÚ
.
desü
->
desütiÚ
));

320 
	`gtk_cÚš”_£t_bÜd”_width
 (
	`GTK_CONTAINER
(
·ge
), 2);

321 
	`gtk_widg‘_show
(
·ge
);

322 
	`gtk_widg‘_show
(
Ïb–
);

324 
	`´İ_dŸlog_cÚš”_pİ
(
dŸlog
);

326 
	`gtk_nÙebook_­³nd_·ge
(
	`GTK_NOTEBOOK
(
dŸlog
->
Ï¡cÚt
),
·ge
,
Ïb–
);

328 
	`´İ_dŸlog_add_¿w
(
dŸlog
,
NULL
);

329 
	`´İ_dŸlog_cÚš”_push
(
dŸlog
,
·ge
);

331  
NULL
;

332 
	}
}

334 
WIDGET
 *

335 
	$nÙebook_’d´İ_g‘_widg‘
(
NÙebookPrİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

337 
	`´İ_dŸlog_cÚš”_pİ
(
dŸlog
);

338 
	`´İ_dŸlog_cÚš”_pİ
(
dŸlog
);

339  
NULL
;

340 
	}
}

342 cÚ¡ 
Prİ”tyOps
 
	gnÙebook_begš´İ_İs
 = {

343 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

344 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

345 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

346 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

347 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

348 (
Prİ”tyTy³_G‘Widg‘
è
nÙebook_begš´İ_g‘_widg‘
,

349 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

350 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

352 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

353 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

354 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


357 cÚ¡ 
Prİ”tyOps
 
	gnÙebook_·g•rİ_İs
 = {

358 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

359 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

360 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

361 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

362 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

363 (
Prİ”tyTy³_G‘Widg‘
è
nÙebook_·g•rİ_g‘_widg‘
,

364 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

365 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

367 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

368 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

369 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


372 cÚ¡ 
Prİ”tyOps
 
	gnÙebook_’d´İ_İs
 = {

373 (
Prİ”tyTy³_New
è
noİ´İ_Ãw
,

374 (
Prİ”tyTy³_F»e
è
noİ´İ_ä“
,

375 (
Prİ”tyTy³_Cİy
è
noİ´İ_cİy
,

376 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

377 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

378 (
Prİ”tyTy³_G‘Widg‘
è
nÙebook_’d´İ_g‘_widg‘
,

379 (
Prİ”tyTy³_Re£tWidg‘
è
noİ´İ_»£t_widg‘
,

380 (
Prİ”tyTy³_S‘FromWidg‘
è
noİ´İ_£t_äom_widg‘
,

382 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

383 (
Prİ”tyTy³_G‘FromOff£t
è
noİ´İ_g‘_äom_off£t
,

384 (
Prİ”tyTy³_S‘FromOff£t
è
noİ´İ_£t_äom_off£t


392 
	$li¡´İ_em±ylšes_»®loc
(
Li¡Prİ”ty
 *
´İ
,
gušt
 
Ãw_size
) {

393 
gušt
 
i
;

395 
i
 = 0; i < 
´İ
->
lšes
->
Ën
; i++)

396 
	`g_ä“
(
	`g_±r_¬¿y_šdex
(
´İ
->
lšes
,
i
));

397 ià(
Ãw_size
 >= 0)

398 
	`g_±r_¬¿y_£t_size
(
´İ
->
lšes
,
Ãw_size
);

399 
	}
}

402 
	$li¡´İ_cİylšes
(
Li¡Prİ”ty
 *
´İ
, 
GPŒA¼ay
 *
¤c
) {

403 
gušt
 
i
;

405 
	`li¡´İ_em±ylšes_»®loc
(
´İ
,
¤c
->
Ën
);

407 
i
 = 0; i < 
¤c
->
Ën
; i++)

408 
	`g_±r_¬¿y_šdex
(
´İ
->
lšes
,
i
èğ
	`g_¡rdup
(g_±r_¬¿y_šdex(
¤c
,i));

409 
	}
}

411 
Li¡Prİ”ty
 *

412 
	$li¡´İ_Ãw
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
, 
PrİDescToPrİP»diÿ‹
 
»asÚ
)

414 
Li¡Prİ”ty
 *
´İ
 = 
	`g_Ãw0
(ListProperty,1);

415 
	`š™Ÿlize_´İ”ty
(&
´İ
->
commÚ
,
pdesc
,
»asÚ
);

416 
´İ
->
£Ëùed
 = -1;

417 
´İ
->
w_£Ëùed
 = -1;

418 
´İ
->
lšes
 = 
	`g_±r_¬¿y_Ãw
();

419  
´İ
;

420 
	}
}

423 
	$li¡´İ_ä“
(
Li¡Prİ”ty
 *
´İ
)

425 
	`li¡´İ_em±ylšes_»®loc
(
´İ
,-1);

426 
	`g_±r_¬¿y_ä“
(
´İ
->
lšes
,
TRUE
);

427 
	}
}

429 
Li¡Prİ”ty
 *

430 
	$li¡´İ_cİy
(
Li¡Prİ”ty
 *
¤c
)

432 
Li¡Prİ”ty
 *
´İ
 =

433 (
Li¡Prİ”ty
 *)
¤c
->
commÚ
.
İs
->
	`Ãw_´İ
(¤c->commÚ.
desü
,

434 
¤c
->
commÚ
.
»asÚ
);

436 
	`cİy_š™_´İ”ty
(&
´İ
->
commÚ
,&
¤c
->common);

437 
´İ
->
£Ëùed
 = 
¤c
->selected;

438 
´İ
->
w_£Ëùed
 = 
¤c
->w_selected;

439 
	`li¡´İ_cİylšes
(
´İ
,
¤c
->
lšes
);

441  
´İ
;

442 
	}
}

445 
	$li¡´İ_£Ëù_chd_sigÇl
(
GtkLi¡
 *
li¡
,

446 
GtkWidg‘
 *
chd
,

447 
Li¡Prİ”ty
 *
´İ
)

449 
´İ
->
w_£Ëùed
 = 
	`gtk_li¡_chd_pos™iÚ
(
li¡
,
chd
);

450 
	}
}

452 
WIDGET
 *

453 
	$li¡´İ_g‘_widg‘
(
Li¡Prİ”ty
 *
´İ
, 
PrİDŸlog
 *
dŸlog
)

455 
GtkWidg‘
 *
»t
 = 
	`gtk_li¡_Ãw
();

457 
	`gtk_li¡_£t_£ËùiÚ_mode
(
	`GTK_LIST
(
»t
),
GTK_SELECTION_BROWSE
);

458 
	`gtk_li¡_un£Ëù_®l
(
	`GTK_LIST
(
»t
));

460 
	`gtk_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
»t
), "select-child",

461 
	`GTK_SIGNAL_FUNC
(
li¡´İ_£Ëù_chd_sigÇl
), 
´İ
);

463 
	`´İhªdËr_cÚÃù
(&
´İ
->
commÚ
, 
	`G_OBJECT
(
»t
), "selection-changed");

464  
»t
;

465 
	}
}

467 
GtkWidg‘
 *

468 
	$make_™em
(cÚ¡ 
gch¬
 *
lše
) {

469 
GtkWidg‘
 *
™em
 = 
	`gtk_li¡_™em_Ãw_w™h_Ïb–
(
lše
);

470 
	`gtk_widg‘_show
(
™em
);

471  
™em
;

472 
	}
}

475 
	$li¡´İ_»£t_widg‘
(
Li¡Prİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

477 
gušt
 
i
;

478 
GLi¡
 *
™ems
 = 
NULL
;

479 
	`gtk_li¡_ş—r_™ems
(
	`GTK_LIST
(
widg‘
),0,-1);

481 
i
 = 0; i < 
´İ
->
lšes
->
Ën
; i++) {

482 
™ems
 = 
	`g_li¡_­³nd
(™ems, 
	`make_™em
(
	`g_±r_¬¿y_šdex
(
´İ
->
lšes
,
i
)));

484 
	`gtk_li¡_­³nd_™ems
(
	`GTK_LIST
(
widg‘
),
™ems
);

485 
´İ
->
w_£Ëùed
 =…rİ->
£Ëùed
;

486 
	`gtk_li¡_£Ëù_™em
(
	`GTK_LIST
(
widg‘
),
´İ
->
£Ëùed
);

487 
	}
}

490 
	$li¡´İ_£t_äom_widg‘
(
Li¡Prİ”ty
 *
´İ
, 
WIDGET
 *
widg‘
)

492 
´İ
->
£Ëùed
 =…rİ->
w_£Ëùed
;

493 
	}
}

496 
	$li¡´İ_g‘_äom_off£t
(
Li¡Prİ”ty
 *
´İ
,

497 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

499 
	`li¡´İ_cİylšes
(
´İ
,
	`¡ruù_memb”
(
ba£
,
off£t
, 
GPŒA¼ay
 *));

500 
´İ
->
£Ëùed
 = 
	`¡ruù_memb”
(
ba£
,
off£t2
,
gšt
);

501 
	}
}

504 
	$li¡´İ_£t_äom_off£t
(
Li¡Prİ”ty
 *
´İ
,

505 *
ba£
, 
gušt
 
off£t
, gušˆ
off£t2
)

507 
	`¡ruù_memb”
(
ba£
,
off£t2
,
gšt
èğ
´İ
->
£Ëùed
;

508 
	}
}

510 cÚ¡ 
Prİ”tyOps
 
	gli¡´İ_İs
 = {

511 (
Prİ”tyTy³_New
è
li¡´İ_Ãw
,

512 (
Prİ”tyTy³_F»e
è
li¡´İ_ä“
,

513 (
Prİ”tyTy³_Cİy
è
li¡´İ_cİy
,

515 (
Prİ”tyTy³_Lßd
è
šv®id´İ_lßd
,

516 (
Prİ”tyTy³_Save
è
šv®id´İ_§ve
,

518 (
Prİ”tyTy³_G‘Widg‘
è
li¡´İ_g‘_widg‘
,

519 (
Prİ”tyTy³_Re£tWidg‘
è
li¡´İ_»£t_widg‘
,

520 (
Prİ”tyTy³_S‘FromWidg‘
è
li¡´İ_£t_äom_widg‘
,

522 (
Prİ”tyTy³_CªM”ge
è
noİ´İ_ÿn_m”ge
,

523 (
Prİ”tyTy³_G‘FromOff£t
è
li¡´İ_g‘_äom_off£t
,

524 (
Prİ”tyTy³_S‘FromOff£t
è
li¡´İ_£t_äom_off£t


530 
	$´İ_widg‘s_»gi¡”
()

532 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_STATIC
,&
¡©iırİ_İs
);

533 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_BUTTON
,&
bu‰Ú´İ_İs
);

534 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_FRAME_BEGIN
,&
äame_begš´İ_İs
);

535 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_FRAME_END
,&
äame_’d´İ_İs
);

536 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_MULTICOL_BEGIN
,&
muÉicŞ_begš´İ_İs
);

537 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_MULTICOL_END
,&
muÉicŞ_’d´İ_İs
);

538 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_MULTICOL_COLUMN
,&
muÉicŞ_cŞumÅrİ_İs
);

539 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_NOTEBOOK_BEGIN
,&
nÙebook_begš´İ_İs
);

540 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_NOTEBOOK_END
,&
nÙebook_’d´İ_İs
);

541 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_NOTEBOOK_PAGE
,&
nÙebook_·g•rİ_İs
);

542 
	`´İ_ty³_»gi¡”
(
PROP_TYPE_LIST
,&
li¡´İ_İs
);

543 
	}
}

	@O:\tool\dvs50\lib\prop_widgets.h

25 #iâdeà
PROP_WIDGETS_H


26 
	#PROP_WIDGETS_H


	)

28 
	~"´İ”t›s.h
"

29 
	~"dŸ_xml.h
"

30 
	~"‹xt.h
"

34 
Prİ”ty
 
	mcommÚ
;

35 } 
	tSticPrİ”ty
;

38 
Prİ”ty
 
	mcommÚ
;

39 } 
	tBu‰ÚPrİ”ty
;

42 
Prİ”ty
 
	mcommÚ
;

43 
gboŞ—n
 
	mcŞÏpsibË
;

44 
gboŞ—n
 
	mcŞÏp£d
;

45 } 
	tF¿mePrİ”ty
;

48 
Prİ”ty
 
	mcommÚ
;

49 } 
	tMuÉicŞPrİ”ty
;

52 
Prİ”ty
 
	mcommÚ
;

53 } 
	tNÙebookPrİ”ty
;

56 
Prİ”ty
 
	mcommÚ
;

57 
gšt
 
	m£Ëùed
;

58 
GPŒA¼ay
 *
	mlšes
;

59 
gšt
 
	mw_£Ëùed
;

60 } 
	tLi¡Prİ”ty
;

62 
´İ_widg‘s_»gi¡”
();

	@O:\tool\dvs50\lib\propdesc.c

27 #ifdeà
HAVE_CONFIG_H


28 
	~<cÚfig.h
>

31 
	~<glib.h
>

33 
	~"´İ”t›s.h
"

34 
	~"´İš‹º®s.h
"

37 
	$´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
PrİDesütiÚ
 *
¶i¡
)

39 
gušt
 
i
;

41 
i
 = 0; 
¶i¡
[i].
Çme
 !ğ
NULL
; i++) {

42 ià(
¶i¡
[
i
].
qu¬k
 == 0)

43 
¶i¡
[
i
].
qu¬k
 = 
	`g_qu¬k_äom_¡©ic_¡ršg
Õli¡[i].
Çme
);

44 ià(
¶i¡
[
i
].
ty³_qu¬k
 == 0)

45 
¶i¡
[
i
].
ty³_qu¬k
 = 
	`g_qu¬k_äom_¡©ic_¡ršg
Õli¡[i].
ty³
);

46 ià(!
¶i¡
[
i
].
İs
)

47 
¶i¡
[
i
].
İs
 = 
	`´İ_ty³_g‘_İs
Õli¡[i].
ty³
);

49 
	}
}

51 cÚ¡ 
PrİDesütiÚ
 *

52 
	$´İ_desc_li¡_fšd_´İ
(cÚ¡ 
PrİDesütiÚ
 *
¶i¡
, cÚ¡ 
gch¬
 *
Çme
)

54 
gšt
 
i
 = 0;

55 
GQu¬k
 
Çme_qu¬k
 = 
	`g_qu¬k_äom_¡ršg
(
Çme
);

57 
¶i¡
[
i
].
Çme
 !ğ
NULL
) {

58 ià(
¶i¡
[
i
].
qu¬k
 =ğ
Çme_qu¬k
)

59  &
¶i¡
[
i
];

60 
i
++;

62  
NULL
;

63 
	}
}

66 
PrİEv’tHªdËr


67 
	$´İ_desc_fšd_»®_hªdËr
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

69 
PrİEv’tHªdËr
 
»t
 = 
pdesc
->
ev’t_hªdËr
;

70 cÚ¡ 
PrİEv’tHªdËrChaš
 *
chaš
 = &
pdesc
->
chaš_hªdËr
;

71 ià(!
chaš
->
hªdËr
è 
»t
;

72 
chaš
) {

73 ià(
chaš
->
hªdËr
è
»t
 = chain->handler;

74 
chaš
 = chain->chain;

76  
»t
;

77 
	}
}

81 
	$´İ_desc_ä“_hªdËr_chaš
(
PrİDesütiÚ
 *
pdesc
)

83 ià(
pdesc
) {

84 
PrİEv’tHªdËrChaš
 *
chaš
 = 
pdesc
->
chaš_hªdËr
.chain;

85 
chaš
) {

86 
PrİEv’tHªdËrChaš
 *
Ãxt
 = 
chaš
->chain;

87 
	`g_ä“
(
chaš
);

88 
chaš
 = 
Ãxt
;

90 
pdesc
->
chaš_hªdËr
.
chaš
 = 
NULL
;

91 
pdesc
->
chaš_hªdËr
.
hªdËr
 = 
NULL
;

93 
	}
}

97 
	$´İ_desc_li¡_ä“_hªdËr_chaš
(
PrİDesütiÚ
 *
pdesc
)

99 ià(!
pdesc
) ;

100 
pdesc
->
Çme
) {

101 
	`´İ_desc_ä“_hªdËr_chaš
(
pdesc
);

102 
pdesc
++;

104 
	}
}

108 
	$´İ_desc_š£¹_hªdËr
(
PrİDesütiÚ
 *
pdesc
,

109 
PrİEv’tHªdËr
 
hªdËr
)

111 ià((
pdesc
->
chaš_hªdËr
.
hªdËr
è|| (pdesc->chaš_hªdËr.
chaš
)) {

113 
PrİEv’tHªdËrChaš
 *
pushed
 = 
	`g_Ãw0
(PropEventHandlerChain,1);

114 *
pushed
 = 
pdesc
->
chaš_hªdËr
;

115 
pdesc
->
chaš_hªdËr
.
chaš
 = 
pushed
;

117 
pdesc
->
chaš_hªdËr
.
hªdËr
 =…desc->
ev’t_hªdËr
;

118 
pdesc
->
ev’t_hªdËr
 = 
hªdËr
;

119 
	}
}

121 cÚ¡ 
PrİDesütiÚ
 
	gnuÎ_´İ_desc
 = { 
NULL
 };

123 
PrİDesütiÚ
 *

124 
	$´İ_desc_li¡s_uniÚ
(
GLi¡
 *
¶i¡s
)

126 
GA¼ay
 *
¬r
 = 
	`g_¬¿y_Ãw
(
TRUE
, TRUE, (
PrİDesütiÚ
));

127 
PrİDesütiÚ
 *
»t
;

128 
GLi¡
 *
tmp
;

132 
	`g_¬¿y_­³nd_v®
(
¬r
, 
nuÎ_´İ_desc
);

133 
	`g_¬¿y_»move_šdex
(
¬r
, 0);

137 
tmp
 = 
¶i¡s
;mp;m°ğtmp->
Ãxt
) {

138 
PrİDesütiÚ
 *
¶i¡
 = 
tmp
->
d©a
;

139 
i
;

141 
i
 = 0; 
¶i¡
[i].
Çme
 !ğ
NULL
; i++) {

142 
j
;

144 ià(
¶i¡
[
i
].
æags
 & 
PROP_FLAG_DONT_MERGE
)

149 
j
 = 0; j < 
¬r
->
Ën
; j++)

150 ià(
	`g_¬¿y_šdex
(
¬r
, 
PrİDesütiÚ
, 
j
).
qu¬k
 =ğ
¶i¡
[
i
].quark)

154 ià(
j
 =ğ
¬r
->
Ën
)

155 
	`g_¬¿y_­³nd_v®
(
¬r
, 
¶i¡
[
i
]);

160 
»t
 = (
PrİDesütiÚ
 *)
¬r
->
d©a
;

161 
	`g_¬¿y_ä“
(
¬r
, 
FALSE
);

162  
»t
;

163 
	}
}

165 
gboŞ—n


166 
	$´İdescs_ÿn_be_m”ged
(cÚ¡ 
PrİDesütiÚ
 *
p1
,

167 cÚ¡ 
PrİDesütiÚ
 *
p2
) {

168 
PrİEv’tHªdËr
 
³h1
 = 
	`´İ_desc_fšd_»®_hªdËr
(
p1
);

169 
PrİEv’tHªdËr
 
³h2
 = 
	`´İ_desc_fšd_»®_hªdËr
(
p2
);

171 ià(
p1
->
İs
 !ğ
p2
->İsè 
FALSE
;

172 ià((
p1
->
æags
|
p2
->æagsè& 
PROP_FLAG_DONT_MERGE
è 
FALSE
;

173 ià(
³h1
 !ğ
³h2
è 
FALSE
;

174 ià((
p1
->
İs
->
ÿn_m”ge
 && !Õ1->İs->
	`ÿn_m”ge
Õ1,
p2
))) ||

175 (
p2
->
İs
->
ÿn_m”ge
 && !Õ2->İs->
	`ÿn_m”ge
Õ2,
p1
)))è 
FALSE
;

177  
TRUE
;

178 
	}
}

180 
PrİDesütiÚ
 *

181 
	$´İ_desc_li¡s_š‹r£ùiÚ
(
GLi¡
 *
¶i¡s
)

183 
GA¼ay
 *
¬r
 = 
	`g_¬¿y_Ãw
(
TRUE
, TRUE, (
PrİDesütiÚ
));

184 
PrİDesütiÚ
 *
»t
;

185 
GLi¡
 *
tmp
;

186 
gšt
 
i
;

189 
	`g_¬¿y_­³nd_v®
(
¬r
, 
nuÎ_´İ_desc
);

190 
	`g_¬¿y_»move_šdex
(
¬r
, 0);

192 ià(
¶i¡s
) {

195 
»t
 = 
¶i¡s
->
d©a
;

196 
i
 = 0; 
»t
[i].
Çme
 !ğ
NULL
; i++)

197 
	`g_¬¿y_­³nd_v®
(
¬r
, 
»t
[
i
]);

200 
tmp
 = 
¶i¡s
->
Ãxt
;mp;mp =mp->next) {

201 
»t
 = 
tmp
->
d©a
;

204 
i
 = 
¬r
->
Ën
 - 1; i >= 0; i--) {

205 
gšt
 
j
;

208 
PrİDesütiÚ
 
ÿnd
 = 
	`g_¬¿y_šdex
(
¬r
,PrİDesütiÚ,
i
);

209 
gboŞ—n
 
»move
 = 
TRUE
;

210 
j
 = 0; 
»t
[j].
Çme
 !ğ
NULL
; j++) {

211 ià(
ÿnd
.
qu¬k
 =ğ
»t
[
j
].quark) {

212 
»move
 = !(
	`´İdescs_ÿn_be_m”ged
(&
»t
[
j
],&
ÿnd
));

216 ià(
»move
è
	`g_¬¿y_»move_šdex
(
¬r
, 
i
);

220 
»t
 = (
PrİDesütiÚ
 *)
¬r
->
d©a
;

221 
	`g_¬¿y_ä“
(
¬r
, 
FALSE
);

222  
»t
;

223 
	}
}

	@O:\tool\dvs50\lib\propdialogs.c

25 #ifdeà
HAVE_CONFIG_H


26 
	~<cÚfig.h
>

29 
	~<¡ršg.h
>

31 
	~<gtk/gtk.h
>

32 
	#WIDGET
 
GtkWidg‘


	)

33 
	~"widg‘s.h
"

34 
	~"´İ”t›s.h
"

35 
	~"´İš‹º®s.h
"

36 
	~"objeù.h
"

38 cÚ¡ 
gch¬
 *
	g´İ_dŸlogd©a_key
 = "object-props:dialogdata";

40 
´İ_dŸlog_sigÇl_de¡roy
(
GtkWidg‘
 *
dŸlog_widg‘
);

41 
´İ_dŸlog_fl
(
PrİDŸlog
 *
dŸlog
, 
GLi¡
 *
objeùs
, 
gboŞ—n
 
is_deçuÉ
);

43 
PrİDŸlog
 *

44 
	$´İ_dŸlog_Ãw
(
GLi¡
 *
objeùs
, 
gboŞ—n
 
is_deçuÉ
)

46 
PrİDŸlog
 *
dŸlog
 = 
	`g_Ãw0
(PropDialog,1);

47 
dŸlog
->
´İs
 = 
NULL
;

48 
dŸlog
->
widg‘
 = 
	`gtk_vbox_Ãw
(
FALSE
,1);

49 
dŸlog
->
´İ_widg‘s
 = 
	`g_¬¿y_Ãw
(
FALSE
,
TRUE
,(
PrİWidg‘Assoc
));

50 
dŸlog
->
cİ›s
 = 
NULL
;

51 
dŸlog
->
cu¹abË
 = 
NULL
;

52 
dŸlog
->
cÚš”s
 = 
	`g_±r_¬¿y_Ãw
();

54 
	`´İ_dŸlog_cÚš”_push
(
dŸlog
,dŸlog->
widg‘
);

56 
	`g_objeù_£t_d©a
 (
	`G_OBJECT
 (
dŸlog
->
widg‘
), 
´İ_dŸlogd©a_key
, dialog);

57 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
dŸlog
->
widg‘
), "destroy",

58 
	`G_CALLBACK
 (
´İ_dŸlog_sigÇl_de¡roy
), 
NULL
);

60 
	`´İ_dŸlog_fl
(
dŸlog
,
objeùs
,
is_deçuÉ
);

62  
dŸlog
;

63 
	}
}

66 
	$´İ_dŸlog_de¡roy
(
PrİDŸlog
 *
dŸlog
)

68 ià(
dŸlog
->
´İs
è
	`´İ_li¡_ä“
(dialog->props);

69 
	`g_¬¿y_ä“
(
dŸlog
->
´İ_widg‘s
,
TRUE
);

70 
	`g_±r_¬¿y_ä“
(
dŸlog
->
cÚš”s
,
TRUE
);

71 ià(
dŸlog
->
cİ›s
è
	`de¡roy_objeù_li¡
(dialog->copies);

72 
	`g_ä“
(
dŸlog
);

73 
	}
}

75 
PrİDŸlog
 *

76 
	$´İ_dŸlog_äom_widg‘
(
GtkWidg‘
 *
dŸlog_widg‘
)

78  
	`g_objeù_g‘_d©a
 (
	`G_OBJECT
 (
dŸlog_widg‘
), 
´İ_dŸlogd©a_key
);

79 
	}
}

82 
	$´İ_dŸlog_sigÇl_de¡roy
(
GtkWidg‘
 *
dŸlog_widg‘
)

84 
	`´İ_dŸlog_de¡roy
(
	`´İ_dŸlog_äom_widg‘
(
dŸlog_widg‘
));

85 
	}
}

87 
WIDGET
 *

88 
	$´İ_dŸlog_g‘_widg‘
(cÚ¡ 
PrİDŸlog
 *
dŸlog
)

90  
dŸlog
->
widg‘
;

91 
	}
}

94 
	$´İ_dŸlog_add_¿w
(
PrİDŸlog
 *
dŸlog
, 
GtkWidg‘
 *
widg‘
)

96 
dŸlog
->
cu¹abË
 = 
NULL
;

97 ià(!
widg‘
) ;

98 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog
->
Ï¡cÚt
),
widg‘
);

99 
	}
}

102 
	$´İ_dŸlog_add_¿w_w™h_æags
(
PrİDŸlog
 *
dŸlog
, 
GtkWidg‘
 *
widg‘
,

103 
gboŞ—n
 
ex·nd
, gboŞ—À
fl
)

105 
	`g_»tuº_if_ç
(
	`GTK_IS_BOX
(
dŸlog
->
Ï¡cÚt
));

107 
dŸlog
->
cu¹abË
 = 
NULL
;

108 ià(!
widg‘
) ;

109 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
dŸlog
->
Ï¡cÚt
),
widg‘
, 
ex·nd
, 
fl
, 0);

110 
	}
}

113 
	$´İ_dŸlog_make_cu¹abË
(
PrİDŸlog
 *
dŸlog
)

115 
GtkWidg‘
 *
bË
 = 
	`gtk_bË_Ãw
(1,2,
FALSE
);

116 
	`gtk_bË_£t_row_¥acšgs
(
	`GTK_TABLE
(
bË
), 2);

117 
	`gtk_bË_£t_cŞ_¥acšgs
(
	`GTK_TABLE
(
bË
), 5);

118 
	`gtk_widg‘_show
(
bË
);

119 
	`´İ_dŸlog_add_¿w
(
dŸlog
,
bË
);

121 
dŸlog
->
cu¼ow
 = 0;

122 
dŸlog
->
cu¹abË
 = 
bË
;

123 
	}
}

126 
	$´İ_dŸlog_add_widg‘
(
PrİDŸlog
 *
dŸlog
, 
GtkWidg‘
 *
Ïb–
, GtkWidg‘ *
widg‘
)

128 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
Ïb–
), 0.0, 0.5);

130 ià(!
dŸlog
->
cu¹abË
è
	`´İ_dŸlog_make_cu¹abË
(dialog);

131 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
dŸlog
->
cu¹abË
),
Ïb–
,

133 
dŸlog
->
cu¼ow
, dialog->currow+1,

134 
GTK_FILL
, GTK_FILL|
GTK_EXPAND
,

136 
	`gtk_bË_©ch
(
	`GTK_TABLE
(
dŸlog
->
cu¹abË
),
widg‘
,

138 
dŸlog
->
cu¼ow
, dialog->currow+1,

139 
GTK_FILL
|
GTK_EXPAND
, GTK_FILL|GTK_EXPAND,

141 
	`gtk_widg‘_show
(
Ïb–
);

142 
	`gtk_widg‘_show
(
widg‘
);

143 
dŸlog
->
cu¼ow
++;

144 
	}
}

148 
	$´İ_dŸlog_cÚš”_push
(
PrİDŸlog
 *
dŸlog
, 
GtkWidg‘
 *
cÚš”
)

150 
	`g_±r_¬¿y_add
(
dŸlog
->
cÚš”s
,
cÚš”
);

151 
dŸlog
->
Ï¡cÚt
 = 
cÚš”
;

152 
dŸlog
->
cu¹abË
 = 
NULL
;

153 
	}
}

156 
GtkWidg‘
 *

157 
	$´İ_dŸlog_cÚš”_pİ
(
PrİDŸlog
 *
dŸlog
)

159 
GtkWidg‘
 *
»s
 = 
	`g_±r_¬¿y_»move_šdex
(
dŸlog
->
cÚš”s
,

160 
dŸlog
->
cÚš”s
->
Ën
-1);

161 
dŸlog
->
Ï¡cÚt
 = 
	`g_±r_¬¿y_šdex
(dŸlog->
cÚš”s
,

162 
dŸlog
->
cÚš”s
->
Ën
-1);

163 
dŸlog
->
cu¹abË
 = 
NULL
;

165  
»s
;

166 
	}
}

169 
	$´İ”ty_sigÇl_hªdËr
(
GtkObjeù
 *
obj
,

170 
gpoš‹r
 
func_d©a
)

172 
PrİEv’tD©a
 *
³d
 = (PrİEv’tD©¨*)
func_d©a
;

173 ià(
³d
) {

174 
PrİDŸlog
 *
dŸlog
 = 
³d
->dialog;

175 
Prİ”ty
 *
´İ
 = 
³d
->
£lf
;

176 
GLi¡
 *
li¡
, *
tmp
;

177 
gušt
 
j
;

179 
li¡
 = 
dŸlog
->
cİ›s
;

180 
	`g_»tuº_if_ç
(
li¡
);

182 
´İ
->
ex³r›nû
 &ğ~
PXP_NOTSET
;

184 ià(!
´İ
->
ev’t_hªdËr
)

191 
	`´İ_g‘_d©a_äom_widg‘s
(
dŸlog
);

193 
tmp
 = 
li¡
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

194 
DŸObjeù
 *
obj
 = (DŸObjeù*)
tmp
->
d©a
;

195 
obj
->
İs
->
	`£t_´İs
(obj,
dŸlog
->
´İs
);

196 
´İ
->
	`ev’t_hªdËr
(
obj
,prop);

197 
obj
->
İs
->
	`g‘_´İs
(obj,
dŸlog
->
´İs
);

200 
j
 = 0; j < 
dŸlog
->
´İ_widg‘s
->
Ën
; j++) {

201 
PrİWidg‘Assoc
 *
pwa
 =

202 &
	`g_¬¿y_šdex
(
dŸlog
->
´İ_widg‘s
,
PrİWidg‘Assoc
,
j
);

203 
pwa
->
´İ
->
İs
->
	`»£t_widg‘
Õwa->´İ,pwa->
widg‘
);

206 
	`g_as£¹_nÙ_»ached
();

208 
	}
}

211 
	$´İhªdËr_cÚÃù
(cÚ¡ 
Prİ”ty
 *
´İ
,

212 
GObjeù
 *
objeù
,

213 cÚ¡ 
gch¬
 *
sigÇl
)

215 ià(0==
	`¡rcmp
(
sigÇl
,"FIXME")) {

216 
	`g_w¬nšg
("signalype unknown forhis kind of…roperty (name is %s), \n"

217 "hªdË¸ignÜed.",
´İ
->
Çme
);

221 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
objeù
),

222 
sigÇl
,

223 
	`G_CALLBACK
 (
´İ”ty_sigÇl_hªdËr
),

224 (
gpoš‹r
)(&
´İ
->
£lf
));

225 
	}
}

228 
	$´İ_dŸlog_add_´İ”ty
(
PrİDŸlog
 *
dŸlog
, 
Prİ”ty
 *
´İ
)

230 
GtkWidg‘
 *
widg‘
 = 
NULL
;

231 
PrİWidg‘Assoc
 
pwa
;

232 
GtkWidg‘
 *
Ïb–
;

234 
´İ
->
£lf
.
dŸlog
 = dialog;

235 
´İ
->
£lf
.self =…rop;

236 
´İ
->
£lf
.
my_šdex
 = 
dŸlog
->
´İ_widg‘s
->
Ën
;

238 ià(
´İ
->
İs
->
g‘_widg‘
)

239 
widg‘
 = 
´İ
->
İs
->
	`g‘_widg‘
Õrİ,
dŸlog
);

240 ià(!
widg‘
)

243 
´İ
->
£lf
.
widg‘
 = widget;

244 ià(
´İ
->
İs
->
»£t_widg‘
è´İ->İs->
	`»£t_widg‘
Õrİ,
widg‘
);

245 
´İ
->
ex³r›nû
 |ğ
PXP_NOTSET
;

247 
pwa
.
´İ
 =…rop;

248 
pwa
.
widg‘
 = widget;

249 
	`g_¬¿y_­³nd_v®
(
dŸlog
->
´İ_widg‘s
,
pwa
);

251 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
(
´İ
->
desü
->
desütiÚ
));

252 
	`gtk_misc_£t_®ignm’t
(
	`GTK_MISC
(
Ïb–
), 0.0, 0.5);

254 
	`´İ_dŸlog_add_widg‘
(
dŸlog
, 
Ïb–
, 
widg‘
);

255 
	}
}

258 
	$´İ_dŸlog_add_´İ”t›s
(
PrİDŸlog
 *
dŸlog
, 
GPŒA¼ay
 *
´İs
)

260 
gušt
 
i
;

261 
gboŞ—n
 
süŞÏbË
 = (
´İs
->
Ën
 > 16);

263 ià(
süŞÏbË
) {

264 
GtkWidg‘
 *
swš
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
, NULL);

265 
GtkWidg‘
 *
vbox
 = 
	`gtk_vbox_Ãw
(
FALSE
,2);

266 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
 (
dŸlog
->
widg‘
), 
swš
, 
TRUE
, TRUE, 0);

267 
	`gtk_widg‘_show
 (
swš
);

268 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
 (
	`GTK_SCROLLED_WINDOW
 (
swš
), 
vbox
);

269 
	`gtk_v›wpÜt_£t_shadow_ty³
(
	`GTK_VIEWPORT
(
	`GTK_BIN
(
swš
)->
chd
), 
GTK_SHADOW_NONE
);

270 
	`gtk_widg‘_show
 (
vbox
);

271 
	`gtk_süŞËd_wšdow_£t_pŞicy
 (
	`GTK_SCROLLED_WINDOW
 (
swš
), 
GTK_POLICY_NEVER
, 
GTK_POLICY_AUTOMATIC
);

272 
	`´İ_dŸlog_cÚš”_push
 (
dŸlog
, 
swš
);

273 
	`´İ_dŸlog_cÚš”_push
 (
dŸlog
, 
vbox
);

277 
i
 = 0; i < 
´İs
->
Ën
; i++) {

278 
Prİ”ty
 *
´İ
 = (Prİ”ty*)
	`g_±r_¬¿y_šdex
(
´İs
,
i
);

279 
	`´İ_dŸlog_add_´İ”ty
(
dŸlog
, 
´İ
);

282 ià(
süŞÏbË
) {

283 
GtkRequis™iÚ
 
»quis™iÚ
;

284 
GtkWidg‘
 *
vbox
 = 
	`´İ_dŸlog_cÚš”_pİ
(
dŸlog
);

285 
GtkWidg‘
 *
swš
 = 
	`´İ_dŸlog_cÚš”_pİ
(
dŸlog
);

286 
GdkSü“n
 *
sü“n
 = 
	`gtk_widg‘_g‘_sü“n
(
swš
);

287 
gušt
 
sheight
 = 
sü“n
 ? (2 * 
	`gdk_sü“n_g‘_height
(screen)) / 3 : 400;

289 
	`gtk_widg‘_size_»que¡
 (
vbox
, &
»quis™iÚ
);

291 
	`gtk_widg‘_£t_size_»que¡
 (
swš
, -1, 
»quis™iÚ
.
height
 > 
sheight
 ? sheight :„equisition.height);

293 
	}
}

296 
	$´İ_g‘_d©a_äom_widg‘s
(
PrİDŸlog
 *
dŸlog
)

298 
gušt
 
i
;

299 
i
 = 0; i < 
dŸlog
->
´İ_widg‘s
->
Ën
; i++) {

300 
PrİWidg‘Assoc
 *
pwa
 = &
	`g_¬¿y_šdex
(
dŸlog
->
´İ_widg‘s
,

301 
PrİWidg‘Assoc
,
i
);

302 
pwa
->
´İ
->
İs
->
	`£t_äom_widg‘
Õwa->´İ,pwa->
widg‘
);

305 
	}
}

307 
gboŞ—n


308 
	$pdp_is_visibË_deçuÉ
 (cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

310  
	`pdp_deçuÉs
 (
pdesc
è&& 
	`pdp_is_visibË_no_¡ªd¬d
(pdesc);

311 
	}
}

314 
	$´İ_dŸlog_fl
(
PrİDŸlog
 *
dŸlog
, 
GLi¡
 *
objeùs
, 
gboŞ—n
 
is_deçuÉ
)

316 cÚ¡ 
PrİDesütiÚ
 *
pdesc
;

317 
GPŒA¼ay
 *
´İs
;

319 
	`g_»tuº_if_ç
(
	`objeùs_com¶y_w™h_¡d´İ
(
objeùs
));

321 
dŸlog
->
objeùs
 = 
	`g_li¡_cİy
(objects);

322 
dŸlog
->
cİ›s
 = 
	`objeù_cİy_li¡
(
objeùs
);

324 
pdesc
 = 
	`objeù_li¡_g‘_´İ_desütiÚs
(
objeùs
, 
PROP_UNION
);

325 ià(!
pdesc
) ;

327 ià(
is_deçuÉ
)

328 
´İs
 = 
	`´İ_li¡_äom_descs
(
pdesc
,
pdp_is_visibË_deçuÉ
);

330 
´İs
 = 
	`´İ_li¡_äom_descs
(
pdesc
,
pdp_is_visibË
);

332 ià(!
´İs
) ;

334 
dŸlog
->
´İs
 =…rops;

335 
	`objeù_li¡_g‘_´İs
(
objeùs
, 
´İs
);

337 
	`´İ_dŸlog_add_´İ”t›s
(
dŸlog
, 
´İs
);

338 
	}
}

	@O:\tool\dvs50\lib\properties.c

27 #ifdeà
HAVE_CONFIG_H


28 
	~<cÚfig.h
>

31 
	~"geom‘ry.h
"

32 #iâdeà
LIBDIA_COMPILATION


33 
	#LIBDIA_COMPILATION


	)

35 #undeà
G_INLINE_FUNC


36 
	#G_INLINE_FUNC
 

	)

37 
	#G_CAN_INLINE
 1

	)

38 
	~"´İ”t›s.h
"

39 
	~"´İš‹º®s.h
"

44 
	$¡d´İs_š™
()

46 
	`´İ_basic_»gi¡”
();

47 
	`´İ_š‰y³s_»gi¡”
();

48 
	`´İ_geomty³s_»gi¡”
();

49 
	`´İ_©Œ_»gi¡”
();

50 
	`´İ_‹xt_»gi¡”
();

51 
	`´İ_widg‘s_»gi¡”
();

52 
	`´İ_sd¬¿y_»gi¡”
();

53 
	`´İ_diùty³s_»gi¡”
();

54 
	}
}

58 #ifdeà
G_OS_WIN32


62 
PrİNumD©a
 
´İ_¡d_lše_width_d©a
 = { 0.0, 10.0, 0.01 };

63 
PrİNumD©a
 
	g´İ_¡d_‹xt_height_d©a
 = { 0.1, 10.0, 0.1 };

64 
PrİEnumD©a
 
	g´İ_¡d_‹xt_®ign_d©a
[] = {

65 { 
N_
("Leá"), 
ALIGN_LEFT
 },

66 { 
N_
("C’‹r"), 
ALIGN_CENTER
 },

67 { 
N_
("Right"), 
ALIGN_RIGHT
 },

68 { 
NULL
, 0 }

72 #ifdeà
FOR_TRANSLATORS_ONLY


73 *
	gli¡
 [] = {

74 
N_
("Line color"),

75 
N_
("Line style"),

76 
N_
("Fill color"),

77 
N_
("Draw background"),

78 
N_
("Start‡rrow"),

79 
N_
("End‡rrow"),

80 
N_
("Text"),

81 
N_
("Text‡lignment"),

82 
N_
("Font"),

83 
N_
("Font size"),

84 
N_
("Text color")

	@O:\tool\dvs50\lib\properties.h

24 #iâdeà
LIB_PROPERTIES_H


25 
	#LIB_PROPERTIES_H


	)

27 #iâdeà
WIDGET


28 #ifdeà
GTK_WIDGET


29 
	#WIDGET
 
GtkWidg‘


	)

31 
	#WIDGET
 

	)

36 #ifdeà
HAVE_STDDEF_H


37 
	~<¡ddef.h
>

40 
	~<glib.h
>

41 
	~"dŸty³s.h
"

43 
	~"geom‘ry.h
"

44 
	~"¬rows.h
"

45 
	~"cŞÜ.h
"

46 
	~"fÚt.h
"

47 
	~"dŸ_xml.h
"

48 
	~"š.h
"

49 
	~"‹x‰r.h
"

51 
G_BEGIN_DECLS


53 
	$gboŞ—n
 (*
	tPrİDescToPrİP»diÿ‹
)(cÚ¡ 
	tPrİDesütiÚ
 *
	tpdesc
);

55 
	s_PrİWidg‘Assoc
 {

56 
Prİ”ty
 *
´İ
;

57 
WIDGET
 *
widg‘
;

60 
	s_PrİDŸlog
 {

61 
WIDGET
 *
widg‘
;

63 
GPŒA¼ay
 *
´İs
;

64 
GA¼ay
 *
´İ_widg‘s
;

67 
GLi¡
 *
objeùs
;

68 
GLi¡
 *
cİ›s
;

70 
GPŒA¼ay
 *
cÚš”s
;

71 
WIDGET
 *
Ï¡cÚt
;

72 
WIDGET
 *
cu¹abË
;

73 
gušt
 
cu¼ow
;

76 
	s_PrİEv’tD©a
 {

77 
PrİDŸlog
 *
dŸlog
;

78 
gušt
 
my_šdex
;

79 
WIDGET
 *
widg‘
;

80 
Prİ”ty
 *
£lf
;

83 
	$gboŞ—n
 (*
	tPrİEv’tHªdËr
è(
	tDŸObjeù
 *
	tobj
, 
	tPrİ”ty
 *
	t´İ
);

85 
	s_PrİEv’tHªdËrChaš
 {

86 
PrİEv’tHªdËr
 
hªdËr
;

87 
PrİEv’tHªdËrChaš
 *
chaš
;

93 
Prİ”ty
 * (*
	tPrİ”tyTy³_New
è(cÚ¡ 
	tPrİDesütiÚ
 *
	tpdesc
,

94 
	tPrİDescToPrİP»diÿ‹
 
	t»asÚ
);

96 (* 
	tPrİ”tyTy³_F»e
)(
	tPrİ”ty
 *
	t´İ
);

98 
Prİ”ty
 *(* 
	tPrİ”tyTy³_Cİy
)(
	tPrİ”ty
 *
	t¤c
);

101 
WIDGET
 *(* 
	tPrİ”tyTy³_G‘Widg‘
)(
	tPrİ”ty
 *
	t´İ
,

102 
	tPrİDŸlog
 *
	tdŸlog
);

105 (* 
	tPrİ”tyTy³_Re£tWidg‘
)(cÚ¡ 
	tPrİ”ty
 *
	t´İ
, 
	tWIDGET
 *
	twidg‘
);

107 (* 
	tPrİ”tyTy³_S‘FromWidg‘
)(
	tPrİ”ty
 *
	t´İ
, 
	tWIDGET
 *
	twidg‘
);

109 (*
	tPrİ”tyTy³_Lßd
)(
	tPrİ”ty
 *
	t´İ
, 
	tA‰ribu‹Node
 
	t©Œ
, 
	tD©aNode
 
	td©a
);

110 (*
	tPrİ”tyTy³_Save
)(
	tPrİ”ty
 *
	t´İ
, 
	tA‰ribu‹Node
 
	t©Œ
);

114 
	$gboŞ—n
 (*
	tPrİ”tyTy³_CªM”ge
)(cÚ¡ 
	tPrİDesütiÚ
 *
	tpd1
,cÚ¡ PrİDesütiÚ *
	tpd2
);

115 (*
	tPrİ”tyTy³_G‘FromOff£t
)(cÚ¡ 
	tPrİ”ty
 *
	t´İ
,

116 *
	tba£
, 
	tgušt
 
	toff£t
, gušˆ
	toff£t2
);

117 (*
	tPrİ”tyTy³_S‘FromOff£t
)(
	tPrİ”ty
 *
	t´İ
,

118 *
	tba£
, 
	tgušt
 
	toff£t
, gušˆ
	toff£t2
);

119 (*
	tPrİ”tyTy³_G‘D©aSize
)(
	tPrİ”ty
 *
	t´İ
);

122 
	s_Prİ”tyOps
 {

123 
Prİ”tyTy³_New
 
Ãw_´İ
;

124 
Prİ”tyTy³_F»e
 
ä“
;

125 
Prİ”tyTy³_Cİy
 
cİy
;

126 
Prİ”tyTy³_Lßd
 
lßd
;

127 
Prİ”tyTy³_Save
 
§ve
;

128 
Prİ”tyTy³_G‘Widg‘
 
g‘_widg‘
;

129 
Prİ”tyTy³_Re£tWidg‘
 
»£t_widg‘
;

130 
Prİ”tyTy³_S‘FromWidg‘
 
£t_äom_widg‘
;

132 
Prİ”tyTy³_CªM”ge
 
ÿn_m”ge
;

134 
Prİ”tyTy³_G‘FromOff£t
 
g‘_äom_off£t
;

135 
Prİ”tyTy³_S‘FromOff£t
 
£t_äom_off£t
;

136 
Prİ”tyTy³_G‘D©aSize
 
g‘_d©a_size
;

139 cÚ¡ 
	tgch¬
 *
	tPrİ”tyTy³
;

142 
	#PROP_TYPE_INVALID
 "šv®id"

	)

143 
	#PROP_TYPE_NOOP
 "noİ"

	)

144 
	#PROP_TYPE_UNIMPLEMENTED
 "unim¶em’‹d"

	)

147 
	#PROP_TYPE_CHAR
 "ch¬"

	)

148 
	#PROP_TYPE_BOOL
 "boŞ"

	)

149 
	#PROP_TYPE_INT
 "št"

	)

150 
	#PROP_TYPE_INTARRAY
 "š¼ay"

	)

151 
	#PROP_TYPE_ENUM
 "’um"

	)

152 
	#PROP_TYPE_ENUMARRAY
 "’um¬¿y"

	)

155 
	#PROP_TYPE_MULTISTRING
 "muÉi¡ršg"

	)

157 
	#PROP_TYPE_STRING
 "¡ršg"

	)

158 
	#PROP_TYPE_FILE
 "fe"

	)

159 
	#PROP_TYPE_TEXT
 "‹xt"

	)

160 
	#PROP_TYPE_STRINGLIST
 "¡ršgli¡"

	)

163 
	#PROP_TYPE_REAL
 "»®"

	)

164 
	#PROP_TYPE_LENGTH
 "Ëngth"

	)

165 
	#PROP_TYPE_FONTSIZE
 "fÚtsize"

	)

166 
	#PROP_TYPE_POINT
 "pošt"

	)

167 
	#PROP_TYPE_POINTARRAY
 "poš¼ay"

	)

168 
	#PROP_TYPE_BEZPOINT
 "bezpošt"

	)

169 
	#PROP_TYPE_BEZPOINTARRAY
 "bezpoš¼ay"

	)

170 
	#PROP_TYPE_RECT
 "»ù"

	)

171 
	#PROP_TYPE_ENDPOINTS
 "’dpošts"

	)

172 
	#PROP_TYPE_CONNPOINT_LINE
 "cÚÅošt_lše"

	)

175 
	#PROP_TYPE_LINESTYLE
 "lše¡yË"

	)

176 
	#PROP_TYPE_ARROW
 "¬row"

	)

177 
	#PROP_TYPE_COLOUR
 "cŞour"

	)

178 
	#PROP_TYPE_FONT
 "fÚt"

	)

181 
	#PROP_TYPE_STATIC
 "¡©ic"

	)

183 
	#PROP_TYPE_BUTTON
 "bu‰Ú"

	)

185 
	#PROP_TYPE_NOTEBOOK_BEGIN
 "nb_begš"

	)

186 
	#PROP_TYPE_NOTEBOOK_END
 "nb_’d"

	)

187 
	#PROP_TYPE_NOTEBOOK_PAGE
 "nb_·ge"

	)

188 
	#PROP_TYPE_MULTICOL_BEGIN
 "mc_begš"

	)

189 
	#PROP_TYPE_MULTICOL_END
 "mc_’d"

	)

190 
	#PROP_TYPE_MULTICOL_COLUMN
 "mc_cŞ"

	)

191 
	#PROP_TYPE_FRAME_BEGIN
 "f_begš"

	)

192 
	#PROP_TYPE_FRAME_END
 "f_’d"

	)

193 
	#PROP_TYPE_LIST
 "li¡"

	)

198 
	#PROP_TYPE_SARRAY
 "§¼ay"

	)

199 
	#PROP_TYPE_DARRAY
 "d¬¿y"

	)

200 
	#PROP_TYPE_DICT
 "diù"

	)

204 
	s_PrİDesütiÚ
 {

205 cÚ¡ 
gch¬
 *
Çme
;

206 
Prİ”tyTy³
 
ty³
;

207 
gušt
 
æags
;

208 cÚ¡ 
gch¬
 *
desütiÚ
;

209 cÚ¡ 
gch¬
 *
toŞt
;

214 
gpoš‹r
 
exŒa_d©a
;

221 
PrİEv’tHªdËr
 
ev’t_hªdËr
;

223 
GQu¬k
 
qu¬k
;

224 
GQu¬k
 
ty³_qu¬k
;

227 
PrİEv’tHªdËrChaš
 
chaš_hªdËr
;

229 cÚ¡ 
Prİ”tyOps
 *
İs
;

232 
	#PROP_FLAG_VISIBLE
 0x0001

	)

233 
	#PROP_FLAG_DONT_SAVE
 0x0002

	)

234 
	#PROP_FLAG_DONT_MERGE
 0x0004

	)

235 
	#PROP_FLAG_NO_DEFAULTS
 0x0008

	)

236 
	#PROP_FLAG_LOAD_ONLY
 0x0010

	)

237 
	#PROP_FLAG_STANDARD
 0x0020

	)

238 
	#PROP_FLAG_MULTIVALUE
 0x0040

	)

239 
	#PROP_FLAG_WIDGET_ONLY
 0x0080

	)

240 
	#PROP_FLAG_OPTIONAL
 0x0100

	)

242 ’um {
PROP_UNION
, 
PROP_INTERSECTION
} 
	tPrİM”geO±iÚ
;

244 
	#PROP_DESC_END
 { 
NULL
, 0, 0, NULL, NULL, NULL, 0 
	}

	)
}

247 
	s_PrİNumD©a
 {

248 
gæßt
 
	mmš
, 
	mmax
, 
	m¡•
;

250 
	s_PrİEnumD©a
 {

251 cÚ¡ 
gch¬
 *
	mÇme
;

252 
gušt
 
	m’umv
;

255 
	$gpoš‹r
 (*
	tNewRecÜdFunc
)();

256 (*
	tF»eRecÜdFunc
)(
	tgpoš‹r
 
	t»c
);

258 
	s_PrİDescCommÚA¼ayExŒa
 {

260 
PrİDesütiÚ
 *
»cÜd
;

261 
PrİOff£t
 *
off£ts
;

262 cÚ¡ 
gch¬
 *
compos™e_ty³
;

265 
	s_PrİDescDA¼ayExŒa
 {

266 
PrİDescCommÚA¼ayExŒa
 
commÚ
;

267 
NewRecÜdFunc
 
Ãw»c
;

268 
F»eRecÜdFunc
 
ä“»c
;

271 
	s_PrİDescSA¼ayExŒa
 {

272 
PrİDescCommÚA¼ayExŒa
 
commÚ
;

273 
gušt
 
–em’t_size
;

274 
gušt
 
¬¿y_Ën
;

281 
	s_Prİ”ty
 {

282 cÚ¡ 
gch¬
 *
Çme
;

283 
GQu¬k
 
Çme_qu¬k
;

284 
Prİ”tyTy³
 
ty³
;

285 
GQu¬k
 
ty³_qu¬k
;

286 cÚ¡ 
PrİDesütiÚ
 *
desü
;

287 
gpoš‹r
 
exŒa_d©a
;

288 
PrİEv’tD©a
 
£lf
;

289 
PrİEv’tHªdËr
 
ev’t_hªdËr
;

290 
PrİDescToPrİP»diÿ‹
 
»asÚ
;

292 
gušt
 
ex³r›nû
;

294 cÚ¡ 
Prİ”tyOps
 *
İs
;

295 cÚ¡ 
Prİ”tyOps
 *
»®_İs
;

299 
	#PXP_COPIED
 0x00000001

	)

300 
	#PXP_COPY
 0x00000002

	)

301 
	#PXP_GET_WIDGET
 0x00000004

	)

302 
	#PXP_RESET_WIDGET
 0x00000008

	)

303 
	#PXP_SET_FROM_WIDGET
 0x00000010

	)

304 
	#PXP_LOADED
 0x00000020

	)

305 
	#PXP_SAVED
 0x00000040

	)

306 
	#PXP_GFO
 0x00000080

	)

307 
	#PXP_SFO
 0x00000100

	)

308 
	#PXP_NOTSET
 0x00000200

	)

309 
	#PXP_SHAMELESS
 0xFFFFFFFF

	)

314 
DIAVAR
 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
PrİDesütiÚ
 *
¶i¡
);

316 
DIAVAR
 cÚ¡ 
PrİDesütiÚ
 *
	`´İ_desc_li¡_fšd_´İ
(cÚ¡ PrİDesütiÚ *
¶i¡
,

317 cÚ¡ 
gch¬
 *
Çme
);

319 
DIAVAR
 
PrİEv’tHªdËr
 
	`´İ_desc_fšd_»®_hªdËr
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

321 
DIAVAR
 
	`´İ_desc_ä“_hªdËr_chaš
(
PrİDesütiÚ
 *
pdesc
);

323 
DIAVAR
 
	`´İ_desc_li¡_ä“_hªdËr_chaš
(
PrİDesütiÚ
 *
pdesc
);

325 
DIAVAR
 
	`´İ_desc_š£¹_hªdËr
(
PrİDesütiÚ
 *
pdesc
,

326 
PrİEv’tHªdËr
 
hªdËr
);

329 
DIAVAR
 
PrİDesütiÚ
 *
	`´İ_desc_li¡s_uniÚ
(
GLi¡
 *
¶i¡s
);

330 
DIAVAR
 
PrİDesütiÚ
 *
	`´İ_desc_li¡s_š‹r£ùiÚ
(
GLi¡
 *
¶i¡s
);

335 
	`´İ_ty³_»gi¡”
(
Prİ”tyTy³
 
ty³
, cÚ¡ 
Prİ”tyOps
 *
İs
);

336 cÚ¡ 
Prİ”tyOps
 *
	`´İ_ty³_g‘_İs
(
Prİ”tyTy³
 
ty³
);

341 
DIAVAR
 
	`´İ_li¡_ä“
(
GPŒA¼ay
 *
¶i¡
);

345 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_cİy
(GPŒA¼ay *
¶i¡
);

347 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_cİy_em±y
(GPŒA¼ay *
¶i¡
);

349 
DIAVAR
 
	`´İ_li¡_add_li¡
 (
GPŒA¼ay
 *
´İs
, cÚ¡ GPŒA¼ay *
±ßdd
);

351 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_äom_descs
(cÚ¡ 
PrİDesütiÚ
 *
¶i¡
,

352 
PrİDescToPrİP»diÿ‹
 
´ed
);

354 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_äom_sšgË
(
Prİ”ty
 *
´İ
);

357 
DIAVAR
 
gboŞ—n
 
	`pdp_Œue
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

358 
DIAVAR
 
gboŞ—n
 
	`pdp_is_visibË
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

359 
gboŞ—n
 
	`pdp_is_visibË_no_¡ªd¬d
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

360 
gboŞ—n
 
	`pdp_is_nÙ_visibË
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

361 
gboŞ—n
 
	`pdp_do_§ve
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

362 
gboŞ—n
 
	`pdp_do_§ve_no_¡ªd¬d
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

363 
gboŞ—n
 
	`pdp_do_lßd
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

364 
gboŞ—n
 
	`pdp_do_nÙ_§ve
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

366 
gboŞ—n
 
	`pdp_deçuÉs
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

368 
gboŞ—n
 
	`pdp_syÁh‘ic
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

369 
gboŞ—n
 
	`pdp_äom_objeù
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

377 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_of_sšgË
(
Prİ”ty
 *
´İ
);

382 
DIAVAR
 
Prİ”ty
 *
	`make_Ãw_´İ
(cÚ¡ *
Çme
, 
Prİ”tyTy³
 
ty³
, 
gušt
 
æags
);

389 #iâdeà
off£tof


390 
	#off£tof
(
ty³
, 
memb”
èĞ(è& (Ñy³*)0è-> memb” )

	)

392 
	s_PrİOff£t
 {

393 cÚ¡ 
gch¬
 *
Çme
;

394 
Prİ”tyTy³
 
ty³
;

395 
off£t
;

396 
off£t2
;

397 
GQu¬k
 
Çme_qu¬k
;

398 
GQu¬k
 
ty³_qu¬k
;

399 cÚ¡ 
Prİ”tyOps
 *
İs
;

407 
gboŞ—n
 
	`objeù_com¶›s_w™h_¡d´İ
(cÚ¡ 
DŸObjeù
 *
obj
);

408 
gboŞ—n
 
	`objeùs_com¶y_w™h_¡d´İ
(
GLi¡
 *
objeùs
);

410 
	`objeù_li¡_g‘_´İs
(
GLi¡
 *
objeùs
, 
GPŒA¼ay
 *
´İs
);

414 
DIAVAR
 cÚ¡ 
PrİDesütiÚ
 *
	`objeù_g‘_´İ_desütiÚs
(cÚ¡ 
DŸObjeù
 *
obj
);

415 cÚ¡ 
PrİDesütiÚ
 *
	`objeù_li¡_g‘_´İ_desütiÚs
(
GLi¡
 *
objeùs
,

416 
PrİM”geO±iÚ
 
İtiÚ
);

418 
DIAVAR
 
gboŞ—n
 
	`objeù_g‘_´İs_äom_off£ts
(
DŸObjeù
 *
obj
, 
PrİOff£t
 *
off£ts
,

419 
GPŒA¼ay
 *
´İs
);

420 
DIAVAR
 
gboŞ—n
 
	`objeù_£t_´İs_äom_off£ts
(
DŸObjeù
 *
obj
, 
PrİOff£t
 *
off£ts
,

421 
GPŒA¼ay
 *
´İs
);

424 
DIAVAR
 
ObjeùChªge
 *
	`objeù_­¶y_´İs
(
DŸObjeù
 *
obj
, 
GPŒA¼ay
 *
´İs
);

430 
DIAVAR
 
WIDGET
 *
	`objeù_ü—‹_´İs_dŸlog
 (
DŸObjeù
 *
obj
, 
gboŞ—n
 
is_deçuÉ
);

431 
DIAVAR
 
WIDGET
 *
	`objeù_li¡_ü—‹_´İs_dŸlog
(
GLi¡
 *
obj
, 
gboŞ—n
 
is_deçuÉ
);

432 
DIAVAR
 
ObjeùChªge
 *
	`objeù_­¶y_´İs_äom_dŸlog
 (
DŸObjeù
 *
obj
, 
WIDGET
 *
dŸlog
);

438 
DIAVAR
 
Prİ”ty
 *
	`objeù_´İ_by_Çme
(
DŸObjeù
 *
obj
, cÚ¡ *
Çme
);

439 
DIAVAR
 
Prİ”ty
 *
	`objeù_´İ_by_Çme_ty³
(
DŸObjeù
 *
obj
, cÚ¡ *
Çme
, cÚ¡ *
ty³
);

442 
DIAVAR
 
	`objeù_lßd_´İs
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
);

443 
DIAVAR
 
	`objeù_§ve_´İs
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
);

447 
DIAVAR
 
	`objeù_cİy_´İs
(
DŸObjeù
 *
de¡
, cÚ¡ DŸObjeù *
¤c
,

448 
gboŞ—n
 
is_deçuÉ
);

451 
DIAVAR
 
Prİ”ty
 *
	`objeù_g‘_´İ_by_Çme
 (
DŸObjeù
 *
obj
, cÚ¡ * 
Çme
);

455 
	`¡d´İs_š™
();

473 #ifdeà
G_OS_WIN32


474 
PrİNumD©a
 
´İ_¡d_lše_width_d©a
 = { 0.0f, 10.0f, 0.01à
	}
};

475 
PrİNumD©a
 
	g´İ_¡d_‹xt_height_d©a
 = { 0.1f, 10.0f, 0.1f };

476 
PrİEnumD©a
 
	g´İ_¡d_‹xt_®ign_d©a
[] = {

477 { 
N_
("Leá"), 
ALIGN_LEFT
 },

478 { 
N_
("C’‹r"), 
ALIGN_CENTER
 },

479 { 
N_
("Right"), 
ALIGN_RIGHT
 },

480 { 
NULL
, 0 }

483 
PrİNumD©a
 
´İ_¡d_lše_width_d©a
, 
´İ_¡d_‹xt_height_d©a
;

484 
PrİEnumD©a
 
´İ_¡d_‹xt_®ign_d©a
[];

487 
	#PROP_STDNAME_LINE_WIDTH
 "lše_width"

	)

488 
	#PROP_STDTYPE_LINE_WIDTH
 
PROP_TYPE_LENGTH


	)

489 
	#PROP_STD_LINE_WIDTH
 \

490 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

491 
	`N_
("Lšwidth"), 
NULL
, &
´İ_¡d_lše_width_d©a
 }

	)

492 
	#PROP_STD_LINE_WIDTH_OPTIONAL
 \

493 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

494 
	`N_
("Lšwidth"), 
NULL
, &
´İ_¡d_lše_width_d©a
 }

	)

495 
	#PROP_STD_LINE_COLOUR
 \

496 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

497 
	`N_
("LšcŞÜ"), 
NULL
, NULL }

	)

498 
	#PROP_STD_LINE_COLOUR_OPTIONAL
 \

499 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

500 
	`N_
("LšcŞÜ"), 
NULL
, NULL }

	)

501 
	#PROP_STD_LINE_STYLE
 \

502 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

503 
	`N_
("Lš¡yË"), 
NULL
, NULL }

	)

504 
	#PROP_STD_LINE_STYLE_OPTIONAL
 \

505 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

506 
	`N_
("Lš¡yË"), 
NULL
, NULL }

	)

508 
	#PROP_STD_FILL_COLOUR
 \

509 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

510 
	`N_
("FÈcŞÜ"), 
NULL
, NULL }

	)

511 
	#PROP_STD_FILL_COLOUR_OPTIONAL
 \

512 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

513 
	`N_
("FÈcŞÜ"), 
NULL
, NULL }

	)

514 
	#PROP_STD_SHOW_BACKGROUND
 \

515 { "show_background", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
, \

516 
	`N_
("D¿w background"), 
NULL
, NULL }

	)

517 
	#PROP_STD_SHOW_BACKGROUND_OPTIONAL
 \

518 { "show_background", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_OPTIONAL
, \

519 
	`N_
("D¿w background"), 
NULL
, NULL }

	)

521 
	#PROP_STD_START_ARROW
 \

522 { "¡¬t_¬row", 
PROP_TYPE_ARROW
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

523 
	`N_
("S¹‡¼ow"), 
NULL
, NULL }

	)

524 
	#PROP_STD_END_ARROW
 \

525 { "’d_¬row", 
PROP_TYPE_ARROW
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

526 
	`N_
("End‡¼ow"), 
NULL
, NULL }

	)

528 
	#PROP_STD_TEXT_OPTIONS
(
İtiÚs
) \

529 { "‹xt", 
PROP_TYPE_TEXT
, (
İtiÚs
), \

530 
	`N_
("Text"), 
NULL
, NULL }

	)

531 
	#PROP_STD_TEXT
 
	`PROP_STD_TEXT_OPTIONS
(
PROP_FLAG_DONT_SAVE
)

	)

532 
	#PROP_STD_SAVED_TEXT
 
	`PROP_STD_TEXT_OPTIONS
(0)

	)

534 
	#PROP_STD_TEXT_ALIGNMENT_OPTIONS
(
İtiÚs
) \

535 { "‹xt_®ignm’t", 
PROP_TYPE_ENUM
, (
İtiÚs
), \

536 
	`N_
("Texˆ®ignm’t"), 
NULL
, 
´İ_¡d_‹xt_®ign_d©a
 }

	)

537 
	#PROP_STD_TEXT_ALIGNMENT
 \

538 
	`PROP_STD_TEXT_ALIGNMENT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

540 
	#PROP_STD_TEXT_FONT_OPTIONS
(
İtiÚs
) \

541 { "‹xt_fÚt", 
PROP_TYPE_FONT
, (
İtiÚs
), 
	`N_
("FÚt"), 
NULL
, NULL }

	)

542 
	#PROP_STD_TEXT_FONT
 \

543 
	`PROP_STD_TEXT_FONT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

545 
	#PROP_STDNAME_TEXT_HEIGHT
 "‹xt_height"

	)

546 
	#PROP_STDTYPE_TEXT_HEIGHT
 
PROP_TYPE_FONTSIZE


	)

547 
	#PROP_STD_TEXT_HEIGHT_OPTIONS
(
İtiÚs
) \

548 { 
PROP_STDNAME_TEXT_HEIGHT
, 
PROP_STDTYPE_TEXT_HEIGHT
, (
İtiÚs
), \

549 
	`N_
("FÚˆsize"), 
NULL
, &
´İ_¡d_‹xt_height_d©a
 }

	)

550 
	#PROP_STD_TEXT_HEIGHT
 \

551 
	`PROP_STD_TEXT_HEIGHT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

553 
	#PROP_STD_TEXT_COLOUR_OPTIONS
(
İtiÚs
) \

554 { "‹xt_cŞour", 
PROP_TYPE_COLOUR
, (
İtiÚs
), \

555 
	`N_
("TexˆcŞÜ"), 
NULL
, NULL }

	)

556 
	#PROP_STD_TEXT_COLOUR
 \

557 
	`PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_STANDARD
)

	)

558 
	#PROP_STD_TEXT_COLOUR_OPTIONAL
 \

559 
	`PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
)

	)

562 
	#PROP_NOTEBOOK_BEGIN
(
Çme
) \

563 { "nbook_" 
Çme
, 
PROP_TYPE_NOTEBOOK_BEGIN
, \

564 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
, 
NULL
, NULL}

	)

565 
	#PROP_STD_NOTEBOOK_BEGIN
 
	`PROP_NOTEBOOK_BEGIN
("¡d")

	)

566 
	#PROP_OFFSET_NOTEBOOK_BEGIN
(
Çme
) \

567 { "nbook_" 
Çme
, 
PROP_TYPE_NOTEBOOK_BEGIN
, 0}

	)

568 
	#PROP_OFFSET_STD_NOTEBOOK_BEGIN
 
	`PROP_OFFSET_NOTEBOOK_BEGIN
("¡d")

	)

570 
	#PROP_NOTEBOOK_END
(
Çme
) \

571 { "nbook_" 
Çme
 "_’d", 
PROP_TYPE_NOTEBOOK_END
, \

572 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
, 
NULL
, NULL}

	)

573 
	#PROP_STD_NOTEBOOK_END
 
	`PROP_NOTEBOOK_END
("¡d")

	)

574 
	#PROP_OFFSET_NOTEBOOK_END
(
Çme
) \

575 { "nbook_" 
Çme
 "_’d", 
PROP_TYPE_NOTEBOOK_END
, 0}

	)

576 
	#PROP_OFFSET_STD_NOTEBOOK_END
 
	`PROP_OFFSET_NOTEBOOK_END
("¡d")

	)

578 
	#PROP_NOTEBOOK_PAGE
(
Çme
,
æags
,
desü
) \

579 { "nbook_·ge_" 
Çme
, 
PROP_TYPE_NOTEBOOK_PAGE
, \

580 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
|
æags
,
desü
,
NULL
}

	)

581 
	#PROP_OFFSET_NOTEBOOK_PAGE
(
Çme
) \

582 { "nbook_·ge_" 
Çme
 , 
PROP_TYPE_NOTEBOOK_PAGE
, 0}

	)

584 
	#PROP_MULTICOL_BEGIN
(
Çme
) \

585 { "mcŞ_" 
Çme
, 
PROP_TYPE_MULTICOL_BEGIN
, \

586 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
, 
NULL
, NULL}

	)

587 
	#PROP_OFFSET_MULTICOL_BEGIN
(
Çme
) \

588 { "mcŞ_" 
Çme
, 
PROP_TYPE_NOTEBOOK_BEGIN
, 0}

	)

590 
	#PROP_MULTICOL_END
(
Çme
) \

591 { "mcŞ_" 
Çme
 "_’d", 
PROP_TYPE_MULTICOL_END
, \

592 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
, 
NULL
, NULL}

	)

593 
	#PROP_OFFSET_MULTICOL_END
(
Çme
) \

594 { "mcŞ_" 
Çme
 "_’d", 
PROP_TYPE_MULTICOL_END
, 0}

	)

596 
	#PROP_MULTICOL_COLUMN
(
Çme
) \

597 { "mcŞ_cŞ_" 
Çme
, 
PROP_TYPE_MULTICOL_COLUMN
, \

598 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
,
NULL
,NULL}

	)

599 
	#PROP_OFFSET_MULTICOL_COLUMN
(
Çme
) \

600 { "mcŞ_cŞ_" 
Çme
, 
PROP_TYPE_MULTICOL_COLUMN
, 0}

	)

602 
	#PROP_FRAME_BEGIN
(
Çme
,
æags
,
desü
) \

603 { "äame_" 
Çme
, 
PROP_TYPE_FRAME_BEGIN
, \

604 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
æags
, 
desü
, 
NULL
}

	)

605 
	#PROP_OFFSET_FRAME_BEGIN
(
Çme
) \

606 { "äame_" 
Çme
, 
PROP_TYPE_FRAME_BEGIN
, 0}

	)

608 
	#PROP_FRAME_END
(
Çme
,
æags
) \

609 { "äame_" 
Çme
 "_’d", 
PROP_TYPE_FRAME_END
, \

610 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
æags
, 
NULL
, NULL}

	)

611 
	#PROP_OFFSET_FRAME_END
(
Çme
) \

612 { "äame_" 
Çme
 "_’d", 
PROP_TYPE_FRAME_END
, 0}

	)

614 
	gG_END_DECLS


	@O:\tool\dvs50\lib\propinternals.h

27 #iâdeà
PROPINTERNALS_H


28 
	#PROPINTERNALS_H


	)

30 
	~<glib.h
>

32 
	~<gtk/gtk.h
>

33 
	~"´İ”t›s.h
"

37 
gboŞ—n
 
´İdescs_ÿn_be_m”ged
(cÚ¡ 
PrİDesütiÚ
 *
p1
,

38 cÚ¡ 
PrİDesütiÚ
 *
p2
);

41 
gboŞ—n
 
´İ_li¡_lßd
(
GPŒA¼ay
 *
´İs
, 
D©aNode
 
d©a
, 
GE¼Ü
 **
”r
);

42 
´İ_li¡_§ve
(
GPŒA¼ay
 *
´İs
, 
D©aNode
 
d©a
);

44 
	#¡ruù_memb”
(
¥
, 
off
, 

è(*Ñ°*)(((*)¥è+ off))

	)

46 
DIAVAR
 
Prİ”ty
 *
fšd_´İ_by_Çme
(cÚ¡ 
GPŒA¼ay
 *
´İs
, cÚ¡ 
gch¬
 *
Çme
);

47 
Prİ”ty
 *
fšd_´İ_by_Çme_ªd_ty³
(cÚ¡ 
GPŒA¼ay
 *
´İs
, cÚ¡ 
gch¬
 *
Çme
,

48 
Prİ”tyTy³
 
ty³
);

55 
´İ_dŸlog_add_¿w
(
PrİDŸlog
 *
dŸlog
, 
GtkWidg‘
 *
widg‘
);

56 
´İ_dŸlog_add_¿w_w™h_æags
(
PrİDŸlog
 *
dŸlog
, 
GtkWidg‘
 *
widg‘
,

57 
gboŞ—n
 
ex·nd
, gboŞ—À
fl
);

59 
´İ_dŸlog_cÚš”_push
(
PrİDŸlog
 *
dŸlog
, 
GtkWidg‘
 *
cÚš”
);

61 
GtkWidg‘
 *
´İ_dŸlog_cÚš”_pİ
(
PrİDŸlog
 *
dŸlog
);

62 
´İ_dŸlog_add_´İ”ty
(
PrİDŸlog
 *
dŸlog
, 
Prİ”ty
 *
´İ
);

64 
PrİDŸlog
 *
´İ_dŸlog_Ãw
(
GLi¡
 *
objeùs
, 
gboŞ—n
 
is_deçuÉ
);

65 
DIAVAR
 
PrİDŸlog
 *
´İ_dŸlog_äom_widg‘
(
GtkWidg‘
 *
dŸlog_widg‘
);

66 
DIAVAR
 
´İ_dŸlog_de¡roy
(
PrİDŸlog
 *
dŸlog
);

67 
DIAVAR
 
´İ_g‘_d©a_äom_widg‘s
(
PrİDŸlog
 *
dŸlog
);

68 
WIDGET
 *
´İ_dŸlog_g‘_widg‘
(cÚ¡ 
PrİDŸlog
 *
dŸlog
);

70 
´İhªdËr_cÚÃù
(cÚ¡ 
Prİ”ty
 *
´İ
, 
GObjeù
 *
objeù
,

71 cÚ¡ 
gch¬
 *
sigÇl
);

74 
DIAVAR
 
´İ_off£t_li¡_ÿlcuÏ‹_qu¬ks
(
PrİOff£t
 *
off£ts
);

75 
do_£t_´İs_äom_off£ts
(*
ba£
, 
GPŒA¼ay
 *
´İs
,

76 cÚ¡ 
PrİOff£t
 *
off£ts
);

77 
do_g‘_´İs_äom_off£ts
(*
ba£
, 
GPŒA¼ay
 *
´İs
,

78 cÚ¡ 
PrİOff£t
 *
off£ts
);

81 
	~"´İ_basic.h
"

82 
	~"´İ_š‰y³s.h
"

83 
	~"´İ_geomty³s.h
"

84 
	~"´İ_©Œ.h
"

85 
	~"´İ_‹xt.h
"

86 
	~"´İ_widg‘s.h
"

87 
	~"´İ_sd¬¿y.h
"

88 
	~"´İ_diù.h
"

	@O:\tool\dvs50\lib\proplist.c

26 #ifdeà
HAVE_CONFIG_H


27 
	~<cÚfig.h
>

30 
	~"´İ”t›s.h
"

31 
	~"´İš‹º®s.h
"

32 
	~"dŸ_xml.h
"

33 
	~"dŸ”rÜ.h
"

39 
gboŞ—n
 
	$pdp_Œue
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

40 {  
TRUE
; 
	}
}

41 
gboŞ—n
 
	$pdp_syÁh‘ic
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

42 {  
TRUE
; 
	}
}

43 
gboŞ—n
 
	$pdp_äom_objeù
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

44 {  
TRUE
; 
	}
}

45 
gboŞ—n
 
	$pdp_is_visibË
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

46 {  (
pdesc
->
æags
 & 
PROP_FLAG_VISIBLE
è!ğ0; 
	}
}

47 
gboŞ—n
 
	$pdp_is_visibË_no_¡ªd¬d
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

48 {  (
pdesc
->
æags
 & 
PROP_FLAG_VISIBLE
) != 0 &&

49 (
pdesc
->
æags
 & 
PROP_FLAG_STANDARD
è=ğ0; 
	}
}

50 
gboŞ—n
 
	$pdp_is_nÙ_visibË
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

51 {  (
pdesc
->
æags
 & 
PROP_FLAG_VISIBLE
è=ğ0; 
	}
}

52 
gboŞ—n
 
	$pdp_do_§ve
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

53 {  (
pdesc
->
æags
 & (
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_LOAD_ONLY
)è=ğ0; 
	}
}

54 
gboŞ—n
 
	$pdp_do_§ve_no_¡ªd¬d
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

55 {  (
pdesc
->
æags
 & (
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_LOAD_ONLY
|
PROP_FLAG_STANDARD
)è=ğ0; 
	}
}

56 
gboŞ—n
 
	$pdp_do_lßd
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

57 {  (((
pdesc
->
æags
 & 
PROP_FLAG_DONT_SAVE
) == 0) ||

58 ((
pdesc
->
æags
 & 
PROP_FLAG_LOAD_ONLY
è!ğ0)); 
	}
}

59 
gboŞ—n
 
	$pdp_deçuÉs
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

60 {  (
pdesc
->
æags
 & 
PROP_FLAG_NO_DEFAULTS
è=ğ0; 
	}
}

61 
gboŞ—n
 
	$pdp_do_nÙ_§ve
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

62 {  (
pdesc
->
æags
 & 
PROP_FLAG_DONT_SAVE
è!ğ0; 
	}
}

64 
GPŒA¼ay
 *

65 
	$´İ_li¡_äom_descs
(cÚ¡ 
PrİDesütiÚ
 *
¶i¡
,

66 
PrİDescToPrİP»diÿ‹
 
´ed
)

68 
GPŒA¼ay
 *
»t
;

69 
gušt
 
couÁ
 = 0, 
i
;

71 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
((
PrİDesütiÚ
 *)
¶i¡
);

73 
i
 = 0; 
¶i¡
[i].
Çme
 !ğ
NULL
; i++)

74 ià(
	`´ed
(&
¶i¡
[
i
])è
couÁ
++;

76 
»t
 = 
	`g_±r_¬¿y_Ãw
();

77 
	`g_±r_¬¿y_£t_size
(
»t
,
couÁ
);

79 
couÁ
 = 0;

80 
i
 = 0; 
¶i¡
[i].
Çme
 !ğ
NULL
; i++) {

82 
	`g_mes§ge
("abouto‡ppend…roperty %s/%so†ist"

83 "´ediÿ‹ i % %d %d",
¶i¡
[
i
].
ty³
,¶i¡[i].
Çme
,

84 
	`´ed
(&
¶i¡
[
i
])?"TRUE":"FALSE",

85 
¶i¡
[
i
].
æags
,¶i¡[i].æag & 
PROP_FLAG_DONT_SAVE
);

87 ià(
	`´ed
(&
¶i¡
[
i
])) {

88 
Prİ”ty
 *
´İ
 = 
¶i¡
[
i
].
İs
->
	`Ãw_´İ
(&¶i¡[i],
´ed
);

89 
	`g_±r_¬¿y_šdex
(
»t
,
couÁ
++èğ
´İ
;

93  
»t
;

94 
	}
}

97 
	$´İ_li¡_ä“
(
GPŒA¼ay
 *
¶i¡
)

99 
i
;

100 ià(!
¶i¡
) ;

102 
i
 = 0; i < 
¶i¡
->
Ën
; i++) {

103 
Prİ”ty
 *
´İ
 = 
	`g_±r_¬¿y_šdex
(
¶i¡
,
i
);

104 
´İ
->
İs
->
	`ä“
(prop);

106 
	`g_±r_¬¿y_ä“
(
¶i¡
,
TRUE
);

107 
	}
}

110 
GPŒA¼ay
 *

111 
	$´İ_li¡_cİy
(
GPŒA¼ay
 *
¤c
)

113 
i
;

114 
GPŒA¼ay
 *
de¡
;

116 
de¡
 = 
	`g_±r_¬¿y_Ãw
();

117 
	`g_±r_¬¿y_£t_size
(
de¡
, 
¤c
->
Ën
);

119 
i
=0; i < 
¤c
->
Ën
; i++) {

120 
Prİ”ty
 *
p¤c
 = 
	`g_±r_¬¿y_šdex
(
¤c
,
i
);

121 
Prİ”ty
 *
pde¡
 =…de¡ = 
p¤c
->
İs
->
	`cİy
(psrc);

122 
	`g_±r_¬¿y_šdex
(
de¡
,
i
èğ
pde¡
;

124  
de¡
;

125 
	}
}

128 
GPŒA¼ay
 *

129 
	$´İ_li¡_cİy_em±y
(
GPŒA¼ay
 *
¶i¡
)

131 
i
;

132 
GPŒA¼ay
 *
de¡
;

134 
de¡
 = 
	`g_±r_¬¿y_Ãw
();

135 
	`g_±r_¬¿y_£t_size
(
de¡
, 
¶i¡
->
Ën
);

137 
i
=0; i < 
¶i¡
->
Ën
; i++) {

138 
Prİ”ty
 *
p¤c
 = 
	`g_±r_¬¿y_šdex
(
¶i¡
,
i
);

139 
Prİ”ty
 *
pde¡
 = 
p¤c
->
İs
->
	`Ãw_´İ
Õ¤c->
desü
,p¤c->
»asÚ
);

140 
	`g_±r_¬¿y_šdex
(
de¡
,
i
èğ
pde¡
;

142  
de¡
;

143 
	}
}

145 
gboŞ—n


146 
	$´İ_li¡_lßd
(
GPŒA¼ay
 *
´İs
, 
D©aNode
 
d©a
, 
GE¼Ü
 **
”r
)

148 
i
;

149 
gboŞ—n
 
»t
 = 
TRUE
;

151 
i
 = 0; i < 
´İs
->
Ën
; i++) {

152 
Prİ”ty
 *
´İ
 = 
	`g_±r_¬¿y_šdex
(
´İs
,
i
);

153 
A‰ribu‹Node
 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
d©a
, 
´İ
->
Çme
);

154 
D©aNode
 
d©a
 = 
©Œ
 ? 
	`©Œibu‹_fœ¡_d©a
×‰rè: 
NULL
;

155 ià((!
©Œ
 || !
d©a
è&& 
´İ
->
desü
->
æags
 & 
PROP_FLAG_OPTIONAL
) {

156 
´İ
->
ex³r›nû
 |ğ
PXP_NOTSET
;

159 ià((!
©Œ
è|| (!
d©a
)) {

160 ià(
”r
 && !*err)

161 *
”r
 = 
	`g_”rÜ_Ãw
 (
DIA_ERROR
,

162 
DIA_ERROR_FORMAT
,

163 
	`_
("No‡ttribute '%s' (%p) or‚o data(%p) inhis‡ttribute"),

164 
´İ
->
Çme
,
©Œ
,
d©a
);

165 
´İ
->
ex³r›nû
 |ğ
PXP_NOTSET
;

166 
»t
 = 
FALSE
;

169 
´İ
->
İs
->
	`lßd
Õrİ,
©Œ
,
d©a
);

171  
»t
;

172 
	}
}

175 
	$´İ_li¡_§ve
(
GPŒA¼ay
 *
´İs
, 
D©aNode
 
d©a
)

177 
i
;

178 
i
 = 0; i < 
´İs
->
Ën
; i++) {

179 
Prİ”ty
 *
´İ
 = 
	`g_±r_¬¿y_šdex
(
´İs
,
i
);

180 
A‰ribu‹Node
 
©Œ
 = 
	`Ãw_©Œibu‹
(
d©a
,
´İ
->
Çme
);

181 
´İ
->
İs
->
	`§ve
Õrİ,
©Œ
);

183 
	}
}

185 
Prİ”ty
 *

186 
	$fšd_´İ_by_Çme
(cÚ¡ 
GPŒA¼ay
 *
´İs
, cÚ¡ 
gch¬
 *
Çme
)

188 
i
;

189 
GQu¬k
 
´İ_qu¬k
 = 
	`g_qu¬k_äom_¡ršg
(
Çme
);

191 
i
 = 0; i < 
´İs
->
Ën
; i++) {

192 
Prİ”ty
 *
´İ
 = 
	`g_±r_¬¿y_šdex
(
´İs
,
i
);

193 ià(
´İ
->
Çme_qu¬k
 =ğ
´İ_qu¬k
) …rop;

195  
NULL
;

196 
	}
}

198 
Prİ”ty
 *

199 
	$fšd_´İ_by_Çme_ªd_ty³
(cÚ¡ 
GPŒA¼ay
 *
´İs
, cÚ¡ 
gch¬
 *
Çme
,

200 
Prİ”tyTy³
 
ty³
)

202 
Prİ”ty
 *
»t
 = 
	`fšd_´İ_by_Çme
(
´İs
,
Çme
);

203 
GQu¬k
 
ty³_qu¬k
 = 
	`g_qu¬k_äom_¡ršg
(
ty³
);

204 ià(!
»t
è 
NULL
;

205 ià(
ty³_qu¬k
 !ğ
»t
->ty³_qu¬kè 
NULL
;

206  
»t
;

207 
	}
}

210 
	$´İ_li¡_add_li¡
 (
GPŒA¼ay
 *
´İs
, cÚ¡ GPŒA¼ay *
±ßdd
)

212 
gušt
 
i
;

213 
i
 = 0 ; i < 
±ßdd
->
Ën
; i++) {

214 
Prİ”ty
 *
´İ
 = 
	`g_±r_¬¿y_šdex
(
±ßdd
,
i
);

216 
	`g_±r_¬¿y_add
(
´İs
,
´İ
->
İs
->
	`cİy
(prop));

218 
	}
}

220 
GPŒA¼ay
 *

221 
	$´İ_li¡_äom_sšgË
(
Prİ”ty
 *
´İ
) {

222 
GPŒA¼ay
 *
¶i¡
 = 
	`g_±r_¬¿y_Ãw
();

223 
	`g_±r_¬¿y_add
(
¶i¡
,
´İ
);

224  
¶i¡
;

225 
	}
}

	@O:\tool\dvs50\lib\propobject.c

30 #ifdeà
HAVE_CONFIG_H


31 
	~<cÚfig.h
>

34 
	~<¡ršg.h
>

36 
	~<glib.h
>

37 
	~"´İ”t›s.h
"

38 
	~"´İš‹º®s.h
"

39 
	~"objeù.h
"

41 cÚ¡ 
PrİDesütiÚ
 *

42 
	$objeù_g‘_´İ_desütiÚs
(cÚ¡ 
DŸObjeù
 *
obj
) {

43 cÚ¡ 
PrİDesütiÚ
 *
pdesc
;

44 ià(!
obj
->
İs
->
desüibe_´İs
è 
NULL
;

46 
pdesc
 = 
obj
->
İs
->
	`desüibe_´İs
((
DŸObjeù
 *)obj);

47 ià(!
pdesc
è 
NULL
;

49 ià(
pdesc
[0].
qu¬k
 != 0) …desc;

51 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
((
PrİDesütiÚ
 *)
pdesc
);

52  
pdesc
;

53 
	}
}

55 cÚ¡ 
PrİDesütiÚ
 *

56 
	$objeù_li¡_g‘_´İ_desütiÚs
(
GLi¡
 *
objeùs
, 
PrİM”geO±iÚ
 
İtiÚ
)

58 
GLi¡
 *
descs
 = 
NULL
, *
tmp
;

59 cÚ¡ 
PrİDesütiÚ
 *
pdesc
;

61 
tmp
 = 
objeùs
;m°!ğ
NULL
;m°ğtmp->
Ãxt
) {

62 
DŸObjeù
 *
obj
 = 
tmp
->
d©a
;

63 cÚ¡ 
PrİDesütiÚ
 *
desc
 = 
	`objeù_g‘_´İ_desütiÚs
(
obj
);

65 ià(
desc
è
descs
 = 
	`g_li¡_­³nd
(descs, (
gpoš‹r
)desc);

70 ià(
İtiÚ
 =ğ
PROP_UNION
 && 
	`g_li¡_Ëngth
(
objeùs
)!=1)

71 
pdesc
 = 
	`´İ_desc_li¡s_uniÚ
(
descs
);

73 
pdesc
 = 
	`´İ_desc_li¡s_š‹r£ùiÚ
(
descs
);

77 
	`g_li¡_ä“
(
descs
);

79  
pdesc
;

80 
	}
}

87 
_ObjeùPrİChªge
 
	tObjeùPrİChªge
;

88 
	s_ObjeùPrİChªge
 {

89 
ObjeùChªge
 
	mobj_chªge
;

91 
DŸObjeù
 *
	mobj
;

92 
GPŒA¼ay
 *
	m§ved_´İs
;

96 
	$objeù_´İ_chªge_­¶y_»v”t
(
ObjeùPrİChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

98 
GPŒA¼ay
 *
Şd_´İs
;

100 
Şd_´İs
 = 
	`´İ_li¡_cİy_em±y
(
chªge
->
§ved_´İs
);

102 ià(
chªge
->
obj
->
İs
->
g‘_´İs
)

103 
chªge
->
obj
->
İs
->
	`g‘_´İs
(chªge->obj, 
Şd_´İs
);

106 ià(
chªge
->
obj
->
İs
->
£t_´İs
)

107 
chªge
->
obj
->
İs
->
	`£t_´İs
(chªge->obj, chªge->
§ved_´İs
);

110 
	`´İ_li¡_ä“
(
chªge
->
§ved_´İs
);

111 
chªge
->
§ved_´İs
 = 
Şd_´İs
;

112 
	}
}

115 
	$objeù_´İ_chªge_ä“
(
ObjeùPrİChªge
 *
chªge
)

117 
	`´İ_li¡_ä“
(
chªge
->
§ved_´İs
);

118 
	}
}

120 
ObjeùChªge
 *

121 
	$objeù_­¶y_´İs
(
DŸObjeù
 *
obj
, 
GPŒA¼ay
 *
´İs
)

123 
ObjeùPrİChªge
 *
chªge
;

124 
GPŒA¼ay
 *
Şd_´İs
;

126 
chªge
 = 
	`g_Ãw0
(
ObjeùPrİChªge
, 1);

128 
chªge
->
obj_chªge
.
­¶y
 =

129 (
ObjeùChªgeAµlyFunc
è
objeù_´İ_chªge_­¶y_»v”t
;

130 
chªge
->
obj_chªge
.
»v”t
 =

131 (
ObjeùChªgeRev”tFunc
è
objeù_´İ_chªge_­¶y_»v”t
;

132 
chªge
->
obj_chªge
.
ä“
 =

133 (
ObjeùChªgeF»eFunc
è
objeù_´İ_chªge_ä“
;

135 
chªge
->
obj
 = obj;

138 
Şd_´İs
 = 
	`´İ_li¡_cİy_em±y
(
´İs
);

140 ià(
obj
->
İs
->
g‘_´İs
)

141 
obj
->
İs
->
	`g‘_´İs
(obj, 
Şd_´İs
);

144 ià(
obj
->
İs
->
£t_´İs
)

145 
obj
->
İs
->
	`£t_´İs
(obj, 
´İs
);

147 
chªge
->
§ved_´İs
 = 
Şd_´İs
;

149  (
ObjeùChªge
 *)
chªge
;

150 
	}
}

155 
gboŞ—n


156 
	$objeù_g‘_´İs_äom_off£ts
(
DŸObjeù
 *
obj
, 
PrİOff£t
 *
off£ts
,

157 
GPŒA¼ay
 *
´İs
)

159 
	`´İ_off£t_li¡_ÿlcuÏ‹_qu¬ks
(
off£ts
);

160 
	`do_g‘_´İs_äom_off£ts
(
obj
,
´İs
,
off£ts
);

162  
TRUE
;

163 
	}
}

165 
gboŞ—n


166 
	$objeù_£t_´İs_äom_off£ts
(
DŸObjeù
 *
obj
, 
PrİOff£t
 *
off£ts
,

167 
GPŒA¼ay
 *
´İs
)

169 
	`´İ_off£t_li¡_ÿlcuÏ‹_qu¬ks
(
off£ts
);

170 
	`do_£t_´İs_äom_off£ts
(
obj
,
´İs
,
off£ts
);

172  
TRUE
;

173 
	}
}

176 
WIDGET
 *

177 
	$objeù_ü—‹_´İs_dŸlog
(
DŸObjeù
 *
obj
, 
gboŞ—n
 
is_deçuÉ
)

179 
GLi¡
 *
li¡
 = 
NULL
;

180 
li¡
 = 
	`g_li¡_­³nd
Öi¡, 
obj
);

181  
	`objeù_li¡_ü—‹_´İs_dŸlog
(
li¡
, 
is_deçuÉ
);

182 
	}
}

184 
WIDGET
 *

185 
	$objeù_li¡_ü—‹_´İs_dŸlog
(
GLi¡
 *
objeùs
, 
gboŞ—n
 
is_deçuÉ
)

187  
	`´İ_dŸlog_Ãw
(
objeùs
, 
is_deçuÉ
)->
widg‘
;

188 
	}
}

191 
ObjeùChªge
 *

192 
	$objeù_­¶y_´İs_äom_dŸlog
(
DŸObjeù
 *
obj
, 
WIDGET
 *
dŸlog_widg‘
)

194 
PrİDŸlog
 *
dŸlog
 = 
	`´İ_dŸlog_äom_widg‘
(
dŸlog_widg‘
);

196 
	`´İ_g‘_d©a_äom_widg‘s
(
dŸlog
);

197 ià(!
obj
->
İs
->
­¶y_´İ”t›s_li¡
) {

198 
	`g_w¬nšg
("using‡ fallback functiono‡pply…roperties;"

200  
	`objeù_­¶y_´İs
(
obj
, 
dŸlog
->
´İs
);

202  
obj
->
İs
->
	`­¶y_´İ”t›s_li¡
(obj, 
dŸlog
->
´İs
);

203 
	}
}

205 
gboŞ—n


206 
	$objeùs_com¶y_w™h_¡d´İ
(
GLi¡
 *
objeùs
)

208 
GLi¡
 *
tmp
 = 
objeùs
;

210 ; 
tmp
 !ğ
NULL
;m°ğtmp->
Ãxt
) {

211 cÚ¡ 
DŸObjeù
 *
obj
 = (cÚ¡ DŸObjeù*)
tmp
->
d©a
;

212 ià(!
	`objeù_com¶›s_w™h_¡d´İ
(
obj
))

213  
FALSE
;

216  
TRUE
;

217 
	}
}

219 
gboŞ—n


220 
	$objeù_com¶›s_w™h_¡d´İ
(cÚ¡ 
DŸObjeù
 *
obj
)

222 ià(
obj
->
İs
->
£t_´İs
 =ğ
NULL
) {

223 
	`g_w¬nšg
("No set_props !");

224  
FALSE
;

226 ià(
obj
->
İs
->
g‘_´İs
 =ğ
NULL
) {

227 
	`g_w¬nšg
("No get_props !");

228  
FALSE
;

230 ià(
obj
->
İs
->
desüibe_´İs
 =ğ
NULL
) {

231 
	`g_w¬nšg
("No describe_props !");

232  
FALSE
;

234 ià(
	`objeù_g‘_´İ_desütiÚs
(
obj
è=ğ
NULL
) {

235 
	`g_w¬nšg
("No…roperties !");

236  
FALSE
;

238  
TRUE
;

239 
	}
}

242 
	$objeù_li¡_g‘_´İs
(
GLi¡
 *
objeùs
, 
GPŒA¼ay
 *
´İs
)

244 
GLi¡
 *
tmp
 = 
objeùs
;

246 ; 
tmp
 !ğ
NULL
;m°ğtmp->
Ãxt
) {

247 
DŸObjeù
 *
obj
 = (DŸObjeù*)
tmp
->
d©a
;

248 
obj
->
İs
->
	`g‘_´İs
(obj,
´İs
);

250 
	}
}

252 
gboŞ—n


253 
	$pdp_do_§ve_no_¡ªd¬d_deçuÉ
 (cÚ¡ 
PrİDesütiÚ
 *
pdesc
)

255  
	`pdp_do_§ve_no_¡ªd¬d
(
pdesc
è&& 
	`pdp_deçuÉs
 (pdesc);

256 
	}
}

259 
	$objeù_cİy_´İs
(
DŸObjeù
 *
de¡
, cÚ¡ DŸObjeù *
¤c
, 
gboŞ—n
 
is_deçuÉ
)

261 
GPŒA¼ay
 *
´İs
;

263 
	`g_»tuº_if_ç
(
¤c
 !ğ
NULL
);

264 
	`g_»tuº_if_ç
(
de¡
 !ğ
NULL
);

265 
	`g_»tuº_if_ç
(
	`¡rcmp
(
¤c
->
ty³
->
Çme
,
de¡
->type->name)==0);

266 
	`g_»tuº_if_ç
(
¤c
->
İs
 =ğ
de¡
->ops);

267 
	`g_»tuº_if_ç
(
	`objeù_com¶›s_w™h_¡d´İ
(
¤c
));

268 
	`g_»tuº_if_ç
(
	`objeù_com¶›s_w™h_¡d´İ
(
de¡
));

270 
´İs
 = 
	`´İ_li¡_äom_descs
(
	`objeù_g‘_´İ_desütiÚs
(
¤c
),

271 (
is_deçuÉ
?
pdp_do_§ve_no_¡ªd¬d_deçuÉ
:

272 
pdp_do_§ve
));

274 
¤c
->
İs
->
	`g‘_´İs
((
DŸObjeù
 *)¤c, 
´İs
);

277 
de¡
->
İs
->
	`£t_´İs
(de¡, 
´İs
);

279 
	`´İ_li¡_ä“
(
´İs
);

280 
	}
}

283 
	$objeù_lßd_´İs
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
)

285 
GPŒA¼ay
 *
´İs
;

286 
GE¼Ü
 *
”r
 = 
NULL
;

288 
	`g_»tuº_if_ç
(
obj
 !ğ
NULL
);

289 
	`g_»tuº_if_ç
(
obj_node
 !ğ
NULL
);

290 
	`g_»tuº_if_ç
(
	`objeù_com¶›s_w™h_¡d´İ
(
obj
));

292 
´İs
 = 
	`´İ_li¡_äom_descs
(
	`objeù_g‘_´İ_desütiÚs
(
obj
),

293 
pdp_do_lßd
);

295 ià(!
	`´İ_li¡_lßd
(
´İs
,
obj_node
, &
”r
)) {

296 
	`g_w¬nšg
 ("%s: %s", 
obj
->
ty³
->
Çme
, 
”r
->
mes§ge
);

297 
	`g_”rÜ_ä“
(
”r
);

300 
obj
->
İs
->
	`£t_´İs
(obj, 
´İs
);

301 
	`´İ_li¡_ä“
(
´İs
);

302 
	}
}

305 
	$objeù_§ve_´İs
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
)

307 
GPŒA¼ay
 *
´İs
;

309 
	`g_»tuº_if_ç
(
obj
 !ğ
NULL
);

310 
	`g_»tuº_if_ç
(
obj_node
 !ğ
NULL
);

311 
	`g_»tuº_if_ç
(
	`objeù_com¶›s_w™h_¡d´İ
(
obj
));

313 
´İs
 = 
	`´İ_li¡_äom_descs
(
	`objeù_g‘_´İ_desütiÚs
(
obj
),

314 
pdp_do_§ve
);

316 
obj
->
İs
->
	`g‘_´İs
(obj, 
´İs
);

317 
	`´İ_li¡_§ve
(
´İs
,
obj_node
);

318 
	`´İ_li¡_ä“
(
´İs
);

319 
	}
}

321 
Prİ”ty
 *

322 
	$objeù_´İ_by_Çme_ty³
(
DŸObjeù
 *
obj
, cÚ¡ *
Çme
, cÚ¡ *
ty³
)

324 cÚ¡ 
PrİDesütiÚ
 *
pdesc
;

325 
GQu¬k
 
Çme_qu¬k
 = 
	`g_qu¬k_äom_¡ršg
(
Çme
);

327 ià(!
	`objeù_com¶›s_w™h_¡d´İ
(
obj
)è 
NULL
;

329 
pdesc
 = 
	`objeù_g‘_´İ_desütiÚs
(
obj
);

330 
pdesc
->
Çme
 !ğ
NULL
;

331 
pdesc
++) {

332 ià((
pdesc
->
qu¬k
 =ğ
Çme_qu¬k
)) {

333 
Prİ”ty
 *
´İ
;

334 
GPŒA¼ay
 *
¶i¡
 = 
NULL
;

336 ià(
ty³
 && (0 !ğ
	`¡rcmp
(
pdesc
->type,type))) ;

338 ià(!
¶i¡
) {

339 
¶i¡
 = 
	`g_±r_¬¿y_Ãw
();

340 
	`g_±r_¬¿y_£t_size
(
¶i¡
,1);

342 
´İ
 = 
pdesc
->
İs
->
	`Ãw_´İ
Õdesc,
pdp_äom_objeù
);

343 
	`g_±r_¬¿y_šdex
(
¶i¡
,0èğ
´İ
;

344 
obj
->
İs
->
	`g‘_´İs
(obj,
¶i¡
);

345  
´İ
;

348  
NULL
;

349 
	}
}

351 
Prİ”ty
 *

352 
	$objeù_´İ_by_Çme
(
DŸObjeù
 *
obj
, cÚ¡ *
Çme
)

354  
	`objeù_´İ_by_Çme_ty³
(
obj
,
Çme
,
NULL
);

355 
	}
}

	@O:\tool\dvs50\lib\propoffsets.c

27 
	~<glib.h
>

28 
	~"´İ”t›s.h
"

29 
	~"´İš‹º®s.h
"

32 
	$do_£t_´İs_äom_off£ts
(*
ba£
,

33 
GPŒA¼ay
 *
´İs
, cÚ¡ 
PrİOff£t
 *
off£ts
)

36 
gušt
 
i
;

38 
i
 = 0; i < 
´İs
->
Ën
; i++) {

39 
Prİ”ty
 *
´İ
 = 
	`g_±r_¬¿y_šdex
(
´İs
,
i
);

40 cÚ¡ 
PrİOff£t
 *
ofs
;

41 
ofs
 = 
off£ts
; ofs->
Çme
 ; ofs++) {

42 ià((
´İ
->
Çme_qu¬k
 =ğ
ofs
->name_quark) &&

43 (
´İ
->
ty³_qu¬k
 =ğ
ofs
->type_quark)) {

45 ià((
´İ
->
ex³r›nû
 & 
PXP_NOTSET
) == 0)

46 
´İ
->
İs
->
	`£t_äom_off£t
Õrİ,
ba£
,
ofs
->
off£t
,ofs->
off£t2
);

51 
	}
}

54 
	$do_g‘_´İs_äom_off£ts
(*
ba£
,

55 
GPŒA¼ay
 *
´İs
, cÚ¡ 
PrİOff£t
 *
off£ts
)

59 
gušt
 
i
;

61 
i
 = 0; i < 
´İs
->
Ën
; i++) {

62 
Prİ”ty
 *
´İ
 = 
	`g_±r_¬¿y_šdex
(
´İs
,
i
);

63 cÚ¡ 
PrİOff£t
 *
ofs
;

64 
ofs
 = 
off£ts
; ofs->
Çme
 ; ofs++) {

65 ià((
´İ
->
Çme_qu¬k
 =ğ
ofs
->name_quark) &&

66 (
´İ
->
ty³_qu¬k
 =ğ
ofs
->type_quark)) {

67 
´İ
->
İs
->
	`g‘_äom_off£t
Õrİ,
ba£
,
ofs
->
off£t
,ofs->
off£t2
);

72 
	}
}

77 
	$´İ_off£t_li¡_ÿlcuÏ‹_qu¬ks
(
PrİOff£t
 *
Şi¡
)

79 
gušt
 
i
;

81 
i
 = 0; 
Şi¡
[i].
Çme
 !ğ
NULL
; i++) {

82 ià(
Şi¡
[
i
].
Çme_qu¬k
 == 0)

83 
Şi¡
[
i
].
Çme_qu¬k
 = 
	`g_qu¬k_äom_¡©ic_¡ršg
(Şi¡[i].
Çme
);

84 ià(
Şi¡
[
i
].
ty³_qu¬k
 == 0)

85 
Şi¡
[
i
].
ty³_qu¬k
 = 
	`g_qu¬k_äom_¡©ic_¡ršg
(Şi¡[i].
ty³
);

86 ià(!
Şi¡
[
i
].
İs
)

87 
Şi¡
[
i
].
İs
 = 
	`´İ_ty³_g‘_İs
(Şi¡[i].
ty³
);

89 
	}
}

	@O:\tool\dvs50\lib\propregistry.c

25 #ifdeà
HAVE_CONFIG_H


26 
	~<cÚfig.h
>

29 
	~<gtk/gtk.h
>

30 
	~"´İ”t›s.h
"

31 
	~"´İš‹º®s.h
"

33 
GHashTabË
 *
	g´İs_hash
 = 
NULL
;

35 
	$check_´İs_hash
()

37 ià(!
´İs_hash
) {

38 
´İs_hash
 = 
	`g_hash_bË_Ãw
(
g_¡r_hash
,
g_¡r_equ®
);

40 
	}
}

43 
	$´İ_ty³_»gi¡”
(
Prİ”tyTy³
 
ty³
, cÚ¡ 
Prİ”tyOps
 *
İs
)

45 
	`check_´İs_hash
();

46 
	`g_hash_bË_š£¹
(
´İs_hash
,(
gpoš‹r
)
ty³
,(gpoš‹r)
İs
);

47 
	}
}

49 cÚ¡ 
Prİ”tyOps
 *

50 
	$´İ_ty³_g‘_İs
(
Prİ”tyTy³
 
ty³
)

52 
	`check_´İs_hash
();

53  
	`g_hash_bË_lookup
(
´İs_hash
,
ty³
);

54 
	}
}

	@O:\tool\dvs50\lib\render_pixmap.c

32 
	~<cÚfig.h
>

34 
	~<m©h.h
>

35 
	~<¡dlib.h
>

36 
	~<gdk/gdk.h
>

38 
	~"»nd”_pixm­.h
"

39 
	~"mes§ge.h
"

40 
	~"dŸgdk»nd””.h
"

42 
ReùªgË
 
	g»ù
;

43 
»®
 
	gzoom
 = 1.0;

45 
DŸR’d””
 *

46 
	$Ãw_pixm­_»nd””
(
GdkWšdow
 *
wšdow
, 
width
, 
height
)

48 
DŸGdkR’d””
 *
»nd””
;

49 
GdkCŞÜ
 
cŞÜ
;

51 
»ù
.
Ëá
 = 0;

52 
»ù
.
tİ
 = 0;

53 
»ù
.
right
 = 
width
;

54 
»ù
.
bÙtom
 = 
height
;

56 
»nd””
 = 
	`g_objeù_Ãw
 (
DIA_TYPE_GDK_RENDERER
, 
NULL
);

57 
»nd””
->
ŒªsfÜm
 = 
	`dŸ_ŒªsfÜm_Ãw
 (&
»ù
, &
zoom
);

58 
»nd””
->
pixm­
 = 
	`gdk_pixm­_Ãw
(
wšdow
, 
width
, 
height
, -1);

59 
»nd””
->
gc
 = 
	`gdk_gc_Ãw
(
wšdow
);

61 
	`gdk_cŞÜ_wh™e
(
	`gdk_cŞÜm­_g‘_sy¡em
(), &
cŞÜ
);

62 
	`gdk_gc_£t_fÜeground
(
»nd””
->
gc
, &
cŞÜ
);

63 
	`gdk_d¿w_»ùªgË
(
»nd””
->
pixm­
,„’d””->
gc
, 1,

64 0, 0, 
width
, 
height
);

66  
	`DIA_RENDERER
(
»nd””
);

67 
	}
}

70 
	$»nd””_pixm­_£t_pixm­
 (
DŸR’d””
 *
»n
,

71 
GdkD¿wabË
 *
d¿wabË
,

72 
xoff£t
, 
yoff£t
,

73 
width
, 
height
)

75 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
»n
);

77 ià(
»nd””
->
pixm­
 !ğ
NULL
)

78 
	`gdk_pixm­_uÄef
(
»nd””
->
pixm­
);

80 ià(
»nd””
->
gc
 !ğ
NULL
)

81 
	`gdk_gc_uÄef
(
»nd””
->
gc
);

83 
	`gdk_pixm­_»f
(
d¿wabË
);

84 
»nd””
->
pixm­
 = 
d¿wabË
;

85 
»nd””
->
gc
 = 
	`gdk_gc_Ãw
(
d¿wabË
);

87 
»ù
.
Ëá
 = -
xoff£t
;

88 
»ù
.
tİ
 = -
yoff£t
;

89 
»ù
.
right
 = 
width
;

90 
»ù
.
bÙtom
 = 
height
;

91 
	}
}

93 
GdkPixm­
 *

94 
	$»nd””_pixm­_g‘_pixm­
 (
DŸR’d””
 *
»n
)

96 
DŸGdkR’d””
 *
»nd””
 = 
	`DIA_GDK_RENDERER
 (
»n
);

98  
»nd””
->
pixm­
;

99 
	}
}

	@O:\tool\dvs50\lib\render_pixmap.h

18 #iâdeà
RENDER_PIXMAP_H


19 
	#RENDER_PIXMAP_H


	)

21 
	~"dŸ»nd””.h
"

23 
DŸR’d””
 *
Ãw_pixm­_»nd””
(
GdkWšdow
 *
wšdow
, 
width
, 
height
);

24 
»nd””_pixm­_£t_pixm­
(
DŸR’d””
 *
»nd””
,

25 
GdkD¿wabË
 *
d¿wabË
,

26 
xoff£t
, 
yoff£t
,

27 
width
, 
height
);

28 
GdkPixm­
 *
»nd””_pixm­_g‘_pixm­
(
DŸR’d””
 *
»nd””
);

	@O:\tool\dvs50\lib\sheet.c

19 
	~<cÚfig.h
>

21 
	~<¡dlib.h
>

22 
	~<¡ršg.h
>

23 
	~<sys/ty³s.h
>

24 
	~<sys/¡©.h
>

25 #ifdeà
HAVE_UNISTD_H


26 
	~<uni¡d.h
>

28 
	~<glib.h
>

29 
	~<libxml/Œ“.h
>

30 
	~<libxml/·r£r.h
>

31 
	~<libxml/xmlmemÜy.h
>

32 
	~"dŸ_xml_libxml.h
"

33 
	~<¡ršg.h
>

35 
	~"š.h
"

37 
	~"sh“t.h
"

38 
	~"mes§ge.h
"

39 
	~"objeù.h
"

40 
	~"dŸ_dœs.h
"

41 
	~"¶ug-šs.h
"

43 
FaùÜySŒuùI‹mAÎ
 *
	gçùÜyCÚš”
 = 
NULL
;

44 
GSLi¡
 *
	gsh“ts
 = 
NULL
;

46 
Sh“t
 *

47 
	$Ãw_sh“t
(*
Çme
, 
gch¬
 *
desütiÚ
, *
f’ame
, 
Sh“tScİe
 
scİe
,

48 
Sh“t
 *
shadowšg
)

50 
Sh“t
 *
sh“t
;

52 
sh“t
 = 
	`g_Ãw
(
Sh“t
, 1);

54 
sh“t
->
Çme
 = 
	`g_¡rdup
(name);

55 
sh“t
->
desütiÚ
 = 
	`g_¡rdup
(description);

57 
sh“t
->
f’ame
 = filename;

58 
sh“t
->
scİe
 = scope;

59 
sh“t
->
shadowšg
 = shadowing;

60 
sh“t
->
objeùs
 = 
NULL
;

61  
sh“t
;

62 
	}
}

65 
	$sh“t_´•’d_sh“t_obj
(
Sh“t
 *
sh“t
, 
Sh“tObjeù
 *
obj
)

67 
DŸObjeùTy³
 *
ty³
;

69 
ty³
 = 
	`objeù_g‘_ty³
(
obj
->
objeù_ty³
);

70 ià(
ty³
 =ğ
NULL
)

72 
	`mes§ge_w¬nšg
(
	`_
("DiaObject '%s'‚eeded in sheet '%s' was‚ot found.\n"

74 
obj
->
objeù_ty³
, 
sh“t
->
Çme
);

78 
sh“t
->
objeùs
 = 
	`g_¦i¡_´•’d
Ğsh“t->objeùs, (
gpoš‹r
è
obj
);

80 
	}
}

83 
	$sh“t_­³nd_sh“t_obj
(
Sh“t
 *
sh“t
, 
Sh“tObjeù
 *
obj
)

85 
DŸObjeùTy³
 *
ty³
;

87 
ty³
 = 
	`objeù_g‘_ty³
(
obj
->
objeù_ty³
);

88 ià(
ty³
 =ğ
NULL
)

90 
	`mes§ge_w¬nšg
(
	`_
("DiaObject '%s'‚eeded in sheet '%s' was‚ot found.\n"

92 
obj
->
objeù_ty³
, 
sh“t
->
Çme
);

96 
sh“t
->
objeùs
 = 
	`g_¦i¡_­³nd
Ğsh“t->objeùs, (
gpoš‹r
è
obj
);

98 
	}
}

101 
	$»gi¡”_sh“t
(
Sh“t
 *
sh“t
)

103 
sh“ts
 = 
	`g_¦i¡_­³nd
(sh“ts, (
gpoš‹r
è
sh“t
);

104 
	}
}

106 
GSLi¡
 *

107 
	$g‘_sh“ts_li¡
()

109  
sh“ts
;

110 
	}
}

114 
lßd_sh“ts_äom_dœ
(cÚ¡ 
gch¬
 *
dœeùÜy
, 
Sh“tScİe
 
scİe
);

115 
lßd_»gi¡”_sh“t
(cÚ¡ 
gch¬
 *
dœeùÜy
,cÚ¡ gch¬ *
f’ame
,

116 
Sh“tScİe
 
scİe
);

120 
gšt


121 
	$dŸ_sh“t_sÜt_ÿÎback
(
gcÚ¡poš‹r
 
a
, gcÚ¡poš‹¸
b
)

123  
	`g_utf8_cŞÏ‹
(
	`g‘‹xt
Ğ((
Sh“t
 *)(
a
))->
Çme
 ),

124 
	`g‘‹xt
Ğ((
Sh“t
 *)(
b
))->
Çme
 ));

125 
	}
}

128 
	$dŸ_sÜt_sh“ts
()

130 
sh“ts
 = 
	`g_¦i¡_sÜt
(sh“ts, 
dŸ_sh“t_sÜt_ÿÎback
);

131 
	}
}

141 
	$lßd_®l_sh“ts
()

143 *
sh“t_·th
;

144 *
home_dœ
;

150 
	`fÜ_—ch_š_dœ
(
	`dŸ_g‘_lib_dœeùÜy
("cÚfig"),
çùÜyR—dD©aFromFe
,
this_is_a_¡ruù
);

173 *
thedœ
 = 
	`dŸ_g‘_d©a_dœeùÜy
("sheets");

174 
	`dŸ_log_mes§ge
 ("sh“t äom '%s'", 
thedœ
);

175 
	`lßd_sh“ts_äom_dœ
(
thedœ
, 
SHEET_SCOPE_SYSTEM
);

176 
	`g_ä“
(
thedœ
);

181 
	`dŸ_sÜt_sh“ts
();

182 
	}
}

185 
	$lßd_sh“ts_äom_dœ
(cÚ¡ 
gch¬
 *
dœeùÜy
, 
Sh“tScİe
 
scİe
)

187 
GDœ
 *
dp
;

188 cÚ¡ *
d’Œy
;

189 
gch¬
 *
p
;

191 
dp
 = 
	`g_dœ_İ’
(
dœeùÜy
, 0, 
NULL
);

192 ià(!
dp
) ;

194  (
d’Œy
 = 
	`g_dœ_»ad_Çme
(
dp
)) )

196 
gch¬
 *
f’ame
 = 
	`g_¡rcÚÿt
(
dœeùÜy
,
G_DIR_SEPARATOR_S
,

197 
d’Œy
,
NULL
);

199 ià(!
	`g_fe_‹¡
(
f’ame
, 
G_FILE_TEST_IS_REGULAR
))

201 
	`g_ä“
(
f’ame
);

206 
p
 = 
f’ame
 + 
	`¡¾’
(filename) - 6 ;

207 ià(0!=
	`¡ºcmp
(
p
,".sheet",6))

209 
	`g_ä“
(
f’ame
);

213 
	`lßd_»gi¡”_sh“t
(
dœeùÜy
, 
f’ame
, 
scİe
);

214 
	`g_ä“
(
f’ame
);

218 
	`g_dœ_şo£
(
dp
);

219 
	}
}

222 
gboŞ—n
 
	$‹¡_Ï¡_ch¬
(
gch¬
 
c
)

224 ifĞ
c
 == '{' || c == '}' || c == ';' )

225  
FALSE
;

227  
TRUE
;

228 
	}
}

230 
	$figu»_out_ch¬
(cÚ¡ 
gch¬
 *
¡r
,cÚ¡ gch¬ 
c
,*
couÁ
)

232 
gch¬
 *
tmp
 = 
¡r
;

233 *
tmp
)

235 if(*
tmp
++ =ğ
c
 )

237 *
couÁ
 +=1;

240 
	}
}

243 
	$çùÜy_»ad_Çtive_c_fe
(cÚ¡ 
gch¬
* 
f’ame
)

245 
	#MAX_LINE
 1024

	)

246 
	#MAX_SECTION
 7

	)

247 
çùÜyCÚš”
->
¡ruùTabË
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

248 
çùÜyCÚš”
->
’umTabË
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

249 
çùÜyCÚš”
->
uniÚTabË
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

250 
¡©
 
¡©buf
;

252 
FILE
 *
fd
;

253 if((
fd
 = 
	`fİ’
(
f’ame
,"r")è=ğ
NULL
)

255 
	`mes§ge_”rÜ
(
	`_
("Couldn't open filename "

259 if(
	`¡©
(
f’ame
,&
¡©buf
) <0 )

261 
	`mes§ge_”rÜ
(
	`_
("Couldn't„ead filename stats"

267 
f‘xt
[
MAX_LINE
]= {'\0'};

268 
z”o
 = 0;

269 
lcb
 = 0;

270 
rcb
 = 0;

271 
gch¬
 *
blockbuf
 = 
NULL
;

272 
	`fg‘s
(
f‘xt
,
MAX_LINE
,
fd
)!=
NULL
)

275 
gch¬
 *
®še
 =
	`g_¡r¡r
(
f‘xt
);

276 
n
 = 
	`¡¾’
(
®še
);

277 
gch¬
 *
fmt
 = 
	`g_¡rdup_´štf
("%02x%02x%02x",
®še
[0]&0xff,aline[1]&0xff,aline[2]&0xff);

278 if(3==
n
 && !
	`g_¡ºÿ£cmp
(
fmt
,"efbbbf",
	`¡¾’
(fmt)) )

282 ifĞ!
n
 || !
®še
 )

285 
Ï¡ch¬
 = 
®še
[
	`¡¾’
(aline)-1];

290 
	`figu»_out_ch¬
(
®še
,'{',&
lcb
);

291 
	`figu»_out_ch¬
(
®še
,'}',&
rcb
);

293 if(!
lcb
 && 
rcb
 )

295 
	`mes§ge_”rÜ
(
	`_
("¸ñÊ½´íÎó,ÕÒ²»µ½ÏàÓ¦µÄ×óÀ¨ºÅ"));

298 ifĞ
lcb
 && 
rcb
 &&†cb ==„cb)

300 
gch¬
 **
mlše
 = 
	`g_¡r¥l™
(
blockbuf
,"\n",-1);

301 
num
 = 
	`g_¡rv_Ëngth
(
mlše
);

302 
DEFTYPE
 
deá
 = 
	`çùÜy_check_defše
(
mlše
[0]);

305 
gch¬
 *
p
 = 
	`g_¡rdup
(
blockbuf
);

306 
	`g_ä“
(
blockbuf
);

307 if(
p
)

308 
blockbuf
 = 
	`g_¡rcÚÿt
(
p
,
®še
,"\n",
NULL
);

311 
blockbuf
 = 
	`g_¡rcÚÿt
(
®še
,"\n",
NULL
);

313 
	`g_ä“
(
®še
);

314 
	`mem£t
(
f‘xt
,0x0,
MAX_LINE
);

317 
	}
}

319 
DEFTYPE
 
	$çùÜy_check_defše
(
gch¬
 *
d©a
)

321 
gch¬
 **
tmp
 = 
	`g_¡r¥l™
(
d©a
," ",-1);

322 
DEFTYPE
 
»t
;

323 if(
	`g_¡rv_Ëngth
(
tmp
))

325 if(!
	`g_¡ºÿ£cmp
(
tmp
[0],"struct",6))

327 
»t
 = 
STRUCT
;

329 if(!
	`g_¡ºÿ£cmp
(
tmp
[0],"typedef",7))

331 
»t
 = 
TYPEDEF
;

336 
»t
 = 
WRONG
;

338 
	`g_¡rä“v
(
tmp
);

342  
»t
;

343 
	}
}

345 
gboŞ—n
 
	$çùÜy_is_ba£_ty³
(cÚ¡ 
gch¬
 *
¡r
)

348 ifĞ(
¡r
[0] == 'u' || str[0] == 's') && str[1] >= '0' && str[1] <= '9')

349  
TRUE
;

351  
FALSE
;

352 
	}
}

356 
	$çùÜy_check_™ems_v®id
(
gpoš‹r
 
key
, gpoš‹¸
v®ue
, gpoš‹¸
u£r_d©a
)

358 
gch¬
 *
key¡r
 = (gch¬ *)
key
;

359 
GLi¡
 *
v®li¡
 = 
v®ue
;

361 ; 
v®li¡
; v®li¡ = v®li¡->
Ãxt
)

363 
gpoš‹r
 
»t
 = 
NULL
;

364 
FaùÜySŒuùI‹m
 *
™em
 = 
v®li¡
->
d©a
;

365 if(
™em
->
Ity³
 !ğ
BT
)

368 
»t
 = 
	`g_hash_bË_lookup
(
çùÜyCÚš”
->
¡ruùTabË
,
™em
->
STy³
);

369 if(
»t
)

371 
FaùÜySŒuùI‹mLi¡
 *
fs
 = 
»t
;

372 
™em
->
Ity³
 = 
ST
;

373 
™em
->
d©®i¡
 = 
fs
->
li¡
;

377 
»t
 = 
	`g_hash_bË_lookup
(
çùÜyCÚš”
->
’umTabË
,
™em
->
STy³
);

378 if(
»t
)

380 
™em
->
Ity³
 = 
ET
;

381 
™em
->
d©®i¡
 = 
»t
;

385 
»t
 = 
	`g_hash_bË_lookup
(
çùÜyCÚš”
->
uniÚTabË
,
™em
->
STy³
);

386 if(
»t
)

388 
™em
->
Ity³
 = 
UT
;

389 
™em
->
d©®i¡
 = 
»t
;

393 if(
™em
->
Ity³
 =ğ
NT
)

395 
gch¬
 *
msg_”r
 = 
	`g_loÿË_to_utf8
(
	`_
("%sÃ»ÓĞ¶¨Òå"),-1,
NULL
,NULL,NULL);

396 
	`mes§ge_”rÜ
(
	`_
(
	`g_¡rdup_´štf
(
msg_”r
,
™em
->
STy³
)));

397 
	`g_ä“
(
msg_”r
);

410 
	}
}

412 
	$çùÜy_check_¡ruù_™ems_v®id
(
gpoš‹r
 
key
, gpoš‹¸
v®ue
, gpoš‹¸
u£r_d©a
)

414 
FaùÜySŒuùI‹mLi¡
 *
fs
 = 
v®ue
;

415 if(
fs
)

416 
	`çùÜy_check_™ems_v®id
(
NULL
,
fs
->
li¡
,NULL);

418 
	}
}

421 
gch¬
 *
	$çùÜy_g‘_utf8_¡r
(
gboŞ—n
 
isutf8
,
gch¬
 *
¡r
)

423 
gch¬
 *
p
 = 
NULL
;

424 if(
isutf8
)

425 
p
 = 
	`g_¡rdup
(
¡r
);

427 
p
 = 
	`g_¡rdup
(
	`çùÜy_utf8
(
¡r
));

428  
p
;

429 
	}
}

431 
	$çùÜyR—dD©aFromFe
(cÚ¡ 
gch¬
* 
f’ame
)

433 
	#MAX_LINE
 1024

	)

434 
	#MAX_SECTION
 7

	)

435 
çùÜyCÚš”
 = 
	`g_Ãw0
(
FaùÜySŒuùI‹mAÎ
,1);

436 
çùÜyCÚš”
->
¡ruùTabË
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

437 
çùÜyCÚš”
->
’umTabË
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

438 
çùÜyCÚš”
->
uniÚTabË
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

439 
gboŞ—n
 
isutf8
 = 
FALSE
;

440 
¡©
 
¡©buf
;

442 
FILE
 *
fd
;

443 if((
fd
 = 
	`fİ’
(
f’ame
,"r")è=ğ
NULL
)

445 
	`mes§ge_”rÜ
(
	`_
("Couldn't open filename "

457 
f‘xt
[
MAX_LINE
]= {'\0'};

458 
gch¬
* 
®še
 = 
NULL
;

460 
	`fg‘s
(
f‘xt
,
MAX_LINE
,
fd
);

462 
®še
 = 
	`g_¡rdup
(
	`g_¡r¡r
(
f‘xt
));

465 if(
	`g_ascii_¡ºÿ£cmp
(
®še
,
	`_
(":version="),9))

467 
gch¬
 *
msg_”r
 = 
	`g_loÿË_to_utf8
(
	`_
("ÎÄ¼ş¸ñÊ½´íÎó,ÕÒ²»µ½ÎÄ¼şÉÏµÄ°æ±¾ĞÅÏ¢!\n"),-1,
NULL
,NULL,NULL);

468 
	`mes§ge_”rÜ
(
msg_”r
);

469 
	`g_ä“
(
msg_”r
);

470 
	`ex™
(1);

472 
gch¬
 **
v”
 = 
	`g_¡r¥l™
(
®še
,"=",-1);

473 
çùÜyCÚš”
->
fe_v”siÚ
 = 
	`g_¡rdup
(
v”
[1]);

474 
	`g_¡rä“v
(
v”
);

475 
	`g_ä“
(
®še
);

477 
	`fşo£
(
fd
);

479 
GLi¡
 *
dli¡
 = 
NULL
;

481 
GLi¡
 *
’umli¡
 = 
NULL
;

484 
gboŞ—n
 
isEmnu
 = 
FALSE
;

485 
gboŞ—n
 
isSŒuù
 = 
FALSE
;

486 
gboŞ—n
 
isUniÚ
 = 
FALSE
;

488 
FaùÜySŒuùI‹mLi¡
 *
fs¦
 = 
NULL
;

490 
gch¬
 *
hashKey
 = 
NULL
;

491 
GHashTabË
 *
hashV®ue
 = 
NULL
;

492 
GHashTabË
 *
uniÚV®ue
 = 
NULL
;

493 
n
 = 0;

494 
z”o
 = 0;

495 if((
fd
 = 
	`fİ’
(
f’ame
,"r")è=ğ
NULL
)

497 
	`mes§ge_”rÜ
(
	`_
("Couldn't open filename "

501 
cu¾še
 = 0;

503 
gch¬
 *
dÙ
 = 
	`g_¡rdup
(".");

504 
gch¬
 *
u_dÙ
 = 
	`çùÜy_utf8
(".");

506 
gch¬
 *
tdÙ
 = 
	`g_¡rdup
(":");

507 
gch¬
 *
u_tdÙ
 = 
	`çùÜy_utf8
(":");

509 
	`fg‘s
(
f‘xt
,
MAX_LINE
,
fd
)!=
NULL
)

512 
cu¾še
++;

514 
®še
 = 
	`g_¡r¡r
(
f‘xt
);

516 if(!
	`g_ascii_¡ºÿ£cmp
(
®še
,
	`_
(":version="),9))

518 
isutf8
 = 
	`g_utf8_v®id©e
(
®še
,-1,
NULL
);

519 if(
®še
[0]==':')

521 
gch¬
 ** 
sbuf
=
NULL
;

522 
sbuf
ğ
	`g_¡r¥l™_£t
 (
f‘xt
,
isutf8
 ? 
u_tdÙ
 : 
tdÙ
,-1);

524 if(
	`g_¡rv_Ëngth
(
sbuf
) < 3)

526 
	`mes§ge_”rÜ
(
	`_
("This Header format isƒrror."

529 if(0 =ğ
	`g_ascii_¡ºÿ£cmp
("Enum",
sbuf
[1],4))

531 
isEmnu
 = 
TRUE
;

532 
z”o
 = 0;

533 
’umli¡
 = 
NULL
;

535 ifĞ0 =ğ
	`g_ascii_¡ºÿ£cmp
("SŒuù",
sbuf
[1],6))

537 
isSŒuù
 = 
TRUE
;

538 
fs¦
 = 
	`g_Ãw0
(
FaùÜySŒuùI‹mLi¡
,1);

539 
fs¦
->
¢ame
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[2]);;

540 
fs¦
->
vÇme
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[4]);;

541 
fs¦
->
isvisibË
 = 
FALSE
;

542 if(!
	`g_ascii_¡rÿ£cmp
("aùiÚ",
sbuf
[3])|| !g_ascii_strcasecmp("system",sbuf[3]))

544 
fs¦
->
isvisibË
 = 
TRUE
;

546 
fs¦
->
sfe
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[5]);;

547 
fs¦
->
li¡
 = 
NULL
;

548 
fs¦
->
numb”
 = 
n
++;

549 
dli¡
 = 
NULL
;

552 ifĞ0 =ğ
	`g_ascii_¡ºÿ£cmp
("uniÚ",
sbuf
[1],5))

554 
isUniÚ
 = 
TRUE
;

555 
dli¡
 = 
NULL
;

558 
hashKey
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[2]);

559 
	`g_¡rä“v
(
sbuf
);

561 if(
®še
[0] == '{' )

565 if(
®še
[0] == '}')

567 if(
isSŒuù
)

569 
isSŒuù
 = 
FALSE
;

570 
fs¦
->
li¡
 = 
dli¡
;

571 
çùÜyCÚš”
->
¡ruùLi¡
 = 
	`g_li¡_­³nd
(çùÜyCÚš”->¡ruùLi¡,
fs¦
);

572 
	`g_hash_bË_š£¹
(
çùÜyCÚš”
->
¡ruùTabË
,
hashKey
,
fs¦
);

574 if(
isEmnu
)

576 
isEmnu
 = 
FALSE
;

577 
	`g_hash_bË_š£¹
(
çùÜyCÚš”
->
’umTabË
,
hashKey
,
’umli¡
);

579 if(
isUniÚ
)

581 
isUniÚ
 = 
FALSE
;

582 
	`g_hash_bË_š£¹
(
çùÜyCÚš”
->
uniÚTabË
,
hashKey
,
dli¡
);

585 if(
isEmnu
)

587 if(
®še
[0] =ğ'/' ||‡lše[0] =ğ'#' || !
	`¡¾’
(aline))

589 
FaùÜySŒuùEnum
 *
kvm­
 = 
	`g_Ãw0
(FactoryStructEnum,1);

590 
gch¬
 ** 
sbuf
=
NULL
;

591 
sbuf
ğ
	`g_¡r¥l™_£t
 (
®še
,
isutf8
 ? 
u_tdÙ
 : 
tdÙ
,-1);

592 ifĞ
	`g_¡rv_Ëngth
(
sbuf
) <2)

594 
kvm­
->
key
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[0]);

595 
kvm­
->
v®ue
 = 
	`çùÜy_utf8
(
	`g_¡rdup_´štf
("%d",
z”o
++));

600 
z”o
 = 
	`g_ascii_¡¹od
(
sbuf
[1],
NULL
);

601 
kvm­
->
key
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[0]);

602 
kvm­
->
v®ue
 =
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[1]);

606 
’umli¡
 = 
	`g_li¡_­³nd
Ónumli¡,
kvm­
);

608 
	`g_¡rä“v
(
sbuf
);

610 if(
isSŒuù
 || 
isUniÚ
 )

613 
gch¬
 ** 
sbuf
=
NULL
;

614 if(
®še
[0] =ğ'/' ||‡lše[0] =ğ'#' || !
	`¡¾’
(aline))

616 
FaùÜySŒuùI‹m
 *
™em
 = 
	`g_Ãw0
(FactoryStructItem,1);

617 
™em
->
§ve¡ruù
 = 
NULL
;

618 
™em
->
Ügşass
 = 
NULL
;

620 
sbuf
ğ
	`g_¡r¥l™_£t
 (
f‘xt
,
isutf8
 ? 
u_tdÙ
 : 
tdÙ
,-1);

622 ifĞ
	`g_¡rv_Ëngth
(
sbuf
è<
MAX_SECTION
)

625 
™em
->
FTy³
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[0]);

627 
gch¬
 **
p
 = 
	`g_¡r¥l™
(
™em
->
FTy³
,
isutf8
 ? 
u_dÙ
 : 
dÙ
,-1);

628 
l
 = 
	`g_¡rv_Ëngth
(
p
);

629 
™em
->
STy³
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
p
[
l
-1]);

630 
	`g_¡rä“v
(
p
);

631 
™em
->
Ity³
 = 
NT
;

632 if(
	`çùÜy_is_ba£_ty³
(
™em
->
STy³
))

634 
™em
->
Ity³
 = 
BT
;

636 
™em
->
Name
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[1]);

637 
™em
->
CÇme
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[2]);

638 
™em
->
V®ue
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[3]);

639 
™em
->
Mš
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[4]);

640 
™em
->
Max
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[5]);

641 
™em
->
Comm’t
 = 
	`çùÜy_g‘_utf8_¡r
(
isutf8
,
sbuf
[6]);

642 
dli¡
 = 
	`g_li¡_­³nd
(dli¡,
™em
);

643 
	`g_¡rä“v
(
sbuf
);

645 
	`mem£t
(
f‘xt
,0x0,
MAX_LINE
);

647 
	`fşo£
(
fd
);

649 
	`g_hash_bË_fÜ—ch
(
çùÜyCÚš”
->
uniÚTabË
,
çùÜy_check_™ems_v®id
,
NULL
);

650 
	`g_hash_bË_fÜ—ch
(
çùÜyCÚš”
->
¡ruùTabË
,
çùÜy_check_¡ruù_™ems_v®id
,
NULL
);

652 
	}
}

655 
	$lßd_»gi¡”_sh“t
(cÚ¡ 
gch¬
 *
dœÇme
, cÚ¡ gch¬ *
f’ame
,

656 
Sh“tScİe
 
scİe
)

658 
xmlDocPŒ
 
doc
;

659 
xmlNsPŒ
 
ns
;

660 
xmlNodePŒ
 
node
, 
cÚ‹Ás
,
subnode
,
roÙ
;

661 
xmlCh¬
 *
tmp
;

662 
gch¬
 *
Çme
 = 
NULL
, *
desütiÚ
 = NULL;

663 
Çme_scÜe
 = -1;

664 
desü_scÜe
 = -1;

665 
Sh“t
 *
sh“t
 = 
NULL
;

666 
GSLi¡
 *
sh“
;

667 
gboŞ—n
 
£t_lše_b»ak
 = 
FALSE
;

668 
gboŞ—n
 
Çme_is_gm®loûd
 = 
FALSE
;

669 
Sh“t
 *
shadowšg
 = 
NULL
;

670 
Sh“t
 *
shadowšg_sh“t
 = 
NULL
;

674 
doc
 = 
	`xmlDoP¬£Fe
(
f’ame
);

675 ià(!
doc
) ;

676 
roÙ
 = 
doc
->
xmlRoÙNode
;

677 
roÙ
 && (roÙ->
ty³
 !ğ
XML_ELEMENT_NODE
)èroÙôoÙ->
Ãxt
;

678 ià(!
roÙ
) ;

679 ià(
	`xmlIsBÏnkNode
(
roÙ
)) ;

681 ià(!(
ns
 = 
	`xmlS—rchNsByH»f
(
doc
,
roÙ
, (cÚ¡ 
xmlCh¬
 *)

682 
DIA_XML_NAME_SPACE_BASE
 "dia-sheet-ns")))

684 
	`g_w¬nšg
("could‚ot find sheet‚amespace");

685 
	`xmlF»eDoc
(
doc
);

688 ià((
roÙ
->
ns
 !ğnsè|| (
	`xmlSŒcmp
ÔoÙ->
Çme
, (cÚ¡ 
xmlCh¬
 *)"sheet")))

690 
	`g_w¬nšg
("rootƒlement was %s --ƒxpecting sheet",

691 
doc
->
xmlRoÙNode
->
Çme
);

692 
	`xmlF»eDoc
(
doc
);

696 
cÚ‹Ás
 = 
NULL
;

697 
node
 = 
roÙ
->
xmlChd»nNode
;‚od!ğ
NULL
;‚odğnode->
Ãxt
)

699 ià(
	`xmlIsBÏnkNode
(
node
)) ;

700 ià(
node
->
ty³
 !ğ
XML_ELEMENT_NODE
)

703 ià(
node
->
ns
 =ğn && !
	`xmlSŒcmp
Òode->
Çme
, (cÚ¡ 
xmlCh¬
 *)"name"))

705 
gšt
 
scÜe
;

718 
scÜe
 = 
	`š_scÜe_loÿË
("C");

723 ià(
Çme_scÜe
 < 0 || 
scÜe
 <‚ame_score)

725 
Çme_scÜe
 = 
scÜe
;

726 ià(
Çme
è
	`xmlF»e
(name);

727 
Çme
 = (*è
	`xmlNodeG‘CÚ‹Á
(
node
);

730 ià(
node
->
ns
 =ğn && !
	`xmlSŒcmp
Òode->
Çme
, (cÚ¡ 
xmlCh¬
 *)"description"))

732 
gšt
 
scÜe
;

737 
tmp
 = 
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"xml:lang");

738 ià(!
tmp
ètm°ğ
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"lang");

739 
scÜe
 = 
	`š_scÜe_loÿË
((*è
tmp
);

740 ià(
tmp
è
	`xmlF»e
(tmp);

742 ià(
desü_scÜe
 < 0 || 
scÜe
 < descr_score)

744 
desü_scÜe
 = 
scÜe
;

745 ià(
desütiÚ
è
	`xmlF»e
(description);

746 
desütiÚ
 = (*è
	`xmlNodeG‘CÚ‹Á
(
node
);

750 ià(
node
->
ns
 =ğn && !
	`xmlSŒcmp
Òode->
Çme
, (cÚ¡ 
xmlCh¬
 *)"contents"))

752 
cÚ‹Ás
 = 
node
;

756 ià(!
Çme
 || !
cÚ‹Ás
)

758 
	`g_w¬nšg
("NØ<Çme>‡nd/Ü <cÚ‹Ás> iÀsh“ˆ%s--skpšg", 
f’ame
);

759 
	`xmlF»eDoc
(
doc
);

760 ià(
Çme
è
	`xmlF»e
(name);

761 ià(
desütiÚ
è
	`xmlF»e
(description);

768 
sh“
 = 
	`g‘_sh“ts_li¡
();

769 
sh“
)

771 ià(
sh“
->
d©a
 && !
	`¡rcmp
(((
Sh“t
 *)(sh“->d©a))->
Çme
,‚ame))

773 
¡©
 
fœ¡_fe
, 
this_fe
;

774 
¡©_»t
;

776 
¡©_»t
 = 
	`¡©
(((
Sh“t
 *)(
sh“
->
d©a
))->
f’ame
, &
fœ¡_fe
);

777 
	`g_as£¹
(!
¡©_»t
);

779 
¡©_»t
 = 
	`¡©
(
f’ame
, &
this_fe
);

780 
	`g_as£¹
(!
¡©_»t
);

782 ià(
this_fe
.
¡_mtime
 > 
fœ¡_fe
.st_mtime)

784 
gch¬
 *
tmp
 = 
	`g_¡rdup_´štf
("% [Cİy oàsy¡em]", 
Çme
);

785 
	`mes§ge_nÙiû
(
	`_
("The system sheet '%s'‡ppearso be more„ecent"

792 
Çme
, 
tmp
,mp,mp);

793 
	`xmlF»e
(
Çme
);

794 
Çme
 = 
tmp
;

795 
Çme_is_gm®loûd
 = 
TRUE
;

796 
shadowšg
 = 
sh“
->
d©a
;

803 
shadowšg_sh“t
 = 
sh“
->
d©a
;

806 
sh“
 = 
	`g_¦i¡_Ãxt
(sheetp);

809 
sh“t
 = 
	`Ãw_sh“t
(
Çme
, 
desütiÚ
, 
	`g_¡rdup
(
f’ame
), 
scİe
, 
shadowšg
);

811 ià(
shadowšg_sh“t
)

812 
shadowšg_sh“t
->
shadowšg
 = 
sh“t
;

814 ià(
Çme_is_gm®loûd
 =ğ
TRUE
)

815 
	`g_ä“
(
Çme
);

817 
	`xmlF»e
(
Çme
);

818 
	`xmlF»e
(
desütiÚ
);

819 
DŸObjeùTy³
 *
Ùy³
;

820 
Sh“tObjeù
 *
sh“t_obj
;

821 
gšt
 
štd©a
 = 0;

822 
gch¬
 *
ch¬d©a
 = 
NULL
;

824 
gboŞ—n
 
has_štd©a
 = 
FALSE
;

825 
gboŞ—n
 
has_icÚ_Ú_sh“t
 = 
TRUE
;

826 
node
 = 
cÚ‹Ás
->
xmlChd»nNode
 ;‚od!ğ
NULL
;‚odğnode->
Ãxt
)

830 
gch¬
 *
icÚÇme
 = 
NULL
;

832 
subdesc_scÜe
 = -1;

833 
gch¬
 *
objdesc
 = 
NULL
;

837 ià(
	`xmlIsBÏnkNode
(
node
)) ;

839 ià(
node
->
ty³
 !ğ
XML_ELEMENT_NODE
)

841 ià(
node
->
ns
 !=‚s) ;

842 ià(!
	`xmlSŒcmp
(
node
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"object"))

846 ià(!
	`xmlSŒcmp
(
node
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"shape"))

848 
	`g_mes§ge
(
	`_
("%s: you should use objectags„atherhan shapeags‚ow"),

849 
f’ame
);

851 ià(!
	`xmlSŒcmp
(
node
->
Çme
, (cÚ¡ 
xmlCh¬
 *)"br"))

854 
£t_lše_b»ak
 = 
TRUE
;

860 
tmp
 = 
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"intdata");

861 ià(
tmp
)

863 *
p
;

864 
štd©a
 = (
gšt
)
	`¡¹Ş
((*è
tmp
,&
p
,0);

865 ià(*
p
 !ğ0è
štd©a
 = 0;

866 
	`xmlF»e
(
tmp
);

867 
has_štd©a
 = 
TRUE
;

869 
ch¬d©a
 = (
gch¬
 *è
	`xmlG‘Prİ
(
node
, (cÚ¡ 
xmlCh¬
 *)"chardata");

871 ià(
ch¬d©a
è
	`xmlF»e
(chardata);

873 
subnode
 = 
node
->
xmlChd»nNode
;

874 
subnode
 !ğ
NULL
 ;

875 
subnode
 = subnode->
Ãxt
)

877 ià(
	`xmlIsBÏnkNode
(
subnode
)) ;

879 ià(
subnode
->
ns
 =ğn && !
	`xmlSŒcmp
(subnode->
Çme
, (cÚ¡ 
xmlCh¬
 *)"description"))

881 
gšt
 
scÜe
;

887 
tmp
 = 
	`xmlG‘Prİ
(
subnode
, (
xmlCh¬
 *)"xml:lang");

888 ià(!
tmp
ètm°ğ
	`xmlG‘Prİ
(
subnode
, (
xmlCh¬
 *)"lang");

889 
scÜe
 = 
	`š_scÜe_loÿË
((*è
tmp
);

890 ià(
tmp
è
	`xmlF»e
(tmp);

892 ià(
subdesc_scÜe
 < 0 || 
scÜe
 < subdesc_score)

894 
subdesc_scÜe
 = 
scÜe
;

895 ià(
objdesc
è
	`ä“
(objdesc);

896 
objdesc
 = (
gch¬
 *è
	`xmlNodeG‘CÚ‹Á
(
subnode
);

900 ià(
subnode
->
ns
 =ğn && !
	`xmlSŒcmp
(subnode->
Çme
, (cÚ¡ 
xmlCh¬
 *)"icon"))

902 
tmp
 = 
	`xmlNodeG‘CÚ‹Á
(
subnode
);

903 
icÚÇme
 = 
	`g_¡rcÚÿt
(
dœÇme
,
G_DIR_SEPARATOR_S
, (*è
tmp
,
NULL
);

904 if(!
shadowšg_sh“t
 && !
	`g_fe_‹¡
 (
icÚÇme
, 
G_FILE_TEST_EXISTS
))

907 
gch¬
 *
sh“tdœ
 = 
	`dŸ_g‘_d©a_dœeùÜy
("sheets");

908 
icÚÇme
 = 
	`g_¡rcÚÿt
(
sh“tdœ
,
G_DIR_SEPARATOR_S
, (*è
tmp
,
NULL
);

909 
	`g_ä“
(
sh“tdœ
);

911 
has_icÚ_Ú_sh“t
 = 
TRUE
;

912 ià(
tmp
è
	`xmlF»e
(tmp);

916 
tmp
 = 
	`xmlG‘Prİ
(
node
, (
xmlCh¬
 *)"name");

917 
	`xmlF»e
(
objdesc
);

918 
objdesc
 = 
NULL
;

920 
Ùy³
 = 
	`objeù_g‘_ty³
((*)"STRUCT - Class");

921 
gch¬
 *
bmµ©h
 = 
	`dŸ_g‘_lib_dœeùÜy
("numbers");

923 
GLi¡
 *
¦i¡
 = 
çùÜyCÚš”
->
¡ruùLi¡
;

924 
FaùÜySŒuùI‹mLi¡
 *
fs¦
 = 
NULL
;

925 
gch¬
 *
fmt
 = 
	`g_¡rdup
("pixmap_%03d.bmp");

926 
n
 = 0;

927 ; 
¦i¡
 !ğ
NULL
; sli¡ = sli¡->
Ãxt
)

930 
fs¦
 = 
¦i¡
->
d©a
;

931 if(!
fs¦
->
isvisibË
)

933 
sh“t_obj
 = 
	`g_Ãw
(
Sh“tObjeù
,1);

934 
sh“t_obj
->
objeù_ty³
 = 
	`g_¡rdup
((*è
Ùy³
->
Çme
);

935 
sh“t_obj
->
desütiÚ
 = 
	`g_¡rdup
(
fs¦
->
vÇme
);

938 
sh“t_obj
->
pixm­
 = 
NULL
;

940 
sh“t_obj
->
u£r_d©a
 = 
	`GINT_TO_POINTER
(
fs¦
->
numb”
);

941 
sh“t_obj
->
u£r_d©a_ty³
 = 
has_štd©a
 ? 
USER_DATA_IS_INTDATA


942 : 
USER_DATA_IS_OTHER
;

944 
sh“t_obj
->
has_icÚ_Ú_sh“t
 = has_icon_on_sheet;

945 
sh“t_obj
->
lše_b»ak
 = 
£t_lše_b»ak
;

946 
£t_lše_b»ak
 = 
FALSE
;

969 
gch¬
 *
numÇme
 = 
	`g_¡rcÚÿt
(
bmµ©h
,
G_DIR_SEPARATOR_S
,
	`g_¡rdup_´štf
(
fmt
,
n
++),
NULL
);

970 if(
	`g_fe_‹¡
(
numÇme
,
G_FILE_TEST_EXISTS
))

972 
sh“t_obj
->
pixm­_fe
 = 
	`g_¡rdup
(
numÇme
);

973 
sh“t_obj
->
pixm­
 = 
NULL
;

977 
sh“t_obj
->
pixm­
 = 
Ùy³
->pixmap;

978 
sh“t_obj
->
pixm­_fe
 = 
Ùy³
->pixmap_file;

981 
	`g_ä“
(
numÇme
);

982 
sh“t_obj
->
has_icÚ_Ú_sh“t
 = has_icon_on_sheet;

984 ià(
sh“t_obj
->
u£r_d©a
 =ğ
NULL


985 && 
sh“t_obj
->
u£r_d©a_ty³
 !ğ
USER_DATA_IS_INTDATA
)

986 
sh“t_obj
->
u£r_d©a
 = 
Ùy³
->
deçuÉ_u£r_d©a
;

988 
sh“t_obj
->
u£r_d©a_ty³
 = 
USER_DATA_IS_INTDATA
;

995 
	`sh“t_­³nd_sh“t_obj
(
sh“t
,
sh“t_obj
);

998 
	`g_ä“
(
bmµ©h
);

999 
	`g_ä“
(
fmt
);

1000 ià(
tmp
)

1001 
	`xmlF»e
(
tmp
);

1005 ià(!
shadowšg_sh“t
)

1006 
	`»gi¡”_sh“t
(
sh“t
);

1008 
	`xmlF»eDoc
(
doc
);

1009 
	}
}

1011 
	gšü’um
 = 0;

1067 
	$çùÜy_ü—‹_obj_äom_hashbË
(
gpoš‹r
 
key
,

1068 
gpoš‹r
 
v®ue
,

1069 
gpoš‹r
 
u£r_d©a
)

1071 
gch¬
 *
Çme
 = (gch¬*)
key
;

1072 
FaùÜyC»©eSh“ts
 *
fcs
 = (FaùÜyC»©eSh“t *)
u£r_d©a
;

1073 
fcs
->
	`ÿÎback_func
(fcs->
sh“t
,fcs->
sh“t_obj
,fcs->
Ùy³
,fcs->
tmp
,
Çme
);

1074 
	}
}

	@O:\tool\dvs50\lib\sheet.h

18 #iâdeà
SHEET_H


19 
	#SHEET_H


	)

21 
	~<glib.h
>

23 
	~"dŸty³s.h
"

24 
DIAVAR
 
FaùÜySŒuùI‹mAÎ
 *
	gçùÜyCÚš”
;

25 
	s_Sh“tObjeù
 {

26 *
	mobjeù_ty³
;

27 *
	mdesütiÚ
;

28 **
	mpixm­
;

30 *
	mu£r_d©a
;

31 ’um { 
	mUSER_DATA_IS_INTDATA
, 
	mUSER_DATA_IS_OTHER
 } 
	mu£r_d©a_ty³
;

33 
gboŞ—n
 
	mlše_b»ak
;

35 *
	mpixm­_fe
;

36 
gboŞ—n
 
	mhas_icÚ_Ú_sh“t
;

41 
	mSHEET_SCOPE_SYSTEM
,

42 
	mSHEET_SCOPE_USER


44 
	tSh“tScİe
;

46 
	s_Sh“t
 {

47 *
	mÇme
;

48 *
	mdesütiÚ
;

49 *
	mf’ame
;

51 
Sh“tScİe
 
	mscİe
;

52 
Sh“t
 *
	mshadowšg
;

60 
GSLi¡
 *
	mobjeùs
;

64 
	s_FaùÜySŒuùEnum


66 
gch¬
 *
	mkey
;

67 
gch¬
 *
	mv®ue
;

71 
	mBT
,

72 
	mET
,

73 
	mST
,

74 
	mUT
,

75 
	mNT


76 }
	tI‹mTy³
;

78 
	s_FaùÜySŒuùI‹m
{

79 
gch¬
 *
	mFTy³
;

80 
gch¬
 *
	mSTy³
;

81 
gch¬
 *
	mName
;

82 
gch¬
 *
	mCÇme
;

83 
gch¬
 *
	mV®ue
;

84 
gch¬
 *
	mMš
;

85 
gch¬
 *
	mMax
;

86 
gch¬
 *
	mComm’t
;

87 
I‹mTy³
 
	mIty³
;

88 
GLi¡
 *
	md©®i¡
;

89 
gpoš‹r
 
	m§ve¡ruù
 ;

91 
gpoš‹r
 
	mÜgşass
;

104 (*
	tFaùÜ_ÿÎback_fun
)(
	tSh“t
 *
	tsh“t
,
	tSh“tObjeù
 *
	tsh“t_obj
,
	tDŸObjeùTy³
 *
	tÙy³
,
	tgch¬
 *
	ttmp
,gch¬ *
	tsh“t_Çme
);

105 
_FaùÜyC»©eSh“ts
 
	tFaùÜyC»©eSh“ts
;

106 
	s_FaùÜyC»©eSh“ts
{

107 
FaùÜ_ÿÎback_fun
 
ÿÎback_func
;

108 
Sh“t
* 
sh“t
;

109 
Sh“tObjeù
 *
sh“t_obj
;

110 
DŸObjeùTy³
 *
Ùy³
;

111 
gch¬
 *
tmp
;

115 
TYPEDEF
,

116 
STRUCT
,

117 
WRONG


118 }
	tDEFTYPE
;

121 
Sh“t
 *
	`Ãw_sh“t
(*
Çme
, *
desütiÚ
, *
f’ame
,

122 
Sh“tScİe
 
scİe
, 
Sh“t
 *
shadowšg
);

123 
	`sh“t_´•’d_sh“t_obj
(
Sh“t
 *
sh“t
, 
Sh“tObjeù
 *
ty³
);

124 
DIAVAR
 
	`sh“t_­³nd_sh“t_obj
(
Sh“t
 *
sh“t
, 
Sh“tObjeù
 *
ty³
);

125 
DIAVAR
 
	`»gi¡”_sh“t
(
Sh“t
 *
sh“t
);

126 
DIAVAR
 
GSLi¡
 *
	`g‘_sh“ts_li¡
();

127 
DIAVAR
 
	`çùÜyR—dD©aFromFe
(cÚ¡ 
gch¬
* 
Çme
);

128 
DEFTYPE
 
	`çùÜy_check_defše
(
gch¬
 *
d©a
);

129 
DIAVAR
 
	`çùÜy_»ad_Çtive_c_fe
(cÚ¡ 
gch¬
* 
Çme
);

132 
DIAVAR
 
	`lßd_®l_sh“ts
();

133 
DIAVAR
 
	`dŸ_sÜt_sh“ts
();

	@O:\tool\dvs50\lib\text.c

18 
	~<cÚfig.h
>

20 
	~<¡dio.h
>

21 
	~<¡dlib.h
>

22 
	~<¡ršg.h
>

23 
	~<glib.h
>

24 
	~<m©h.h
>

26 
	~<gdk/gdkkeysyms.h
>

28 
	~"´İš‹º®s.h
"

29 
	~"‹xt.h
"

30 
	~"mes§ge.h
"

31 
	~"dŸ»nd””.h
"

32 
	~"dŸg¿md©a.h
"

33 
	~"objchªge.h
"

34 
	~"‹xše.h
"

36 
‹xt_key_ev’t
(
Focus
 *
focus
, 
gušt
 
keysym
,

37 cÚ¡ 
gch¬
 *
¡r
, 
¡¾’
,

38 
ObjeùChªge
 **
chªge
);

40 
	echªge_ty³
 {

41 
	mTYPE_DELETE_BACKWARD
,

42 
	mTYPE_DELETE_FORWARD
,

43 
	mTYPE_INSERT_CHAR
,

44 
	mTYPE_JOIN_ROW
,

45 
	mTYPE_SPLIT_ROW
,

46 
	mTYPE_DELETE_ALL


49 
	sTextObjeùChªge
 {

50 
ObjeùChªge
 
	mobj_chªge
;

52 
Text
 *
	m‹xt
;

53 
chªge_ty³
 
	mty³
;

54 
gunich¬
 
	mch
;

55 
	mpos
;

56 
	mrow
;

57 
gch¬
 *
	m¡r
;

60 
	#CURSOR_HEIGHT_RATIO
 20

	)

63 
gch¬
 *

64 
	$‹xt_g‘_lše
(
Text
 *
‹xt
, 
lše
)

66  
	`‹xt_lše_g‘_¡ršg
(
‹xt
->
lšes
[
lše
]);

67 
	}
}

72 
	$‹xt_£t_lše
(
Text
 *
‹xt
, 
lše_no
, 
gch¬
 *
lše
)

74 
	`‹xt_lše_£t_¡ršg
(
‹xt
->
lšes
[
lše_no
], 
lše
);

75 
	}
}

81 
	$‹xt_£t_lše_‹xt
(
Text
 *
‹xt
, 
lše_no
, 
gch¬
 *
lše
)

83 
	`‹xt_£t_lše
(
‹xt
, 
lše_no
, 
lše
);

84 
	}
}

90 
	$‹xt_d–‘e_lše
(
Text
 *
‹xt
, 
lše_no
)

92 
i
;

94 
	`g_ä“
(
‹xt
->
lšes
[
lše_no
]);

95 
i
 = 
lše_no
; i < 
‹xt
->
numlšes
 - 1; i++) {

96 
‹xt
->
lšes
[
i
] =ext->lines[i+1];

98 
‹xt
->
numlšes
 -= 1;

99 
‹xt
->
lšes
 = 
	`g_»®loc
Ñext->lšes, (
TextLše
 *)*‹xt->
numlšes
);

100 
	}
}

106 
	$‹xt_š£¹_lše
(
Text
 *
‹xt
, 
lše_no
)

108 
i
;

109 
‹xt
->
numlšes
 += 1;

110 
‹xt
->
lšes
 = 
	`g_»®loc
Ñext->lšes, (*)*‹xt->
numlšes
);

112 
i
 = 
‹xt
->
numlšes
 - 1; i > 
lše_no
; i--) {

113 
‹xt
->
lšes
[
i
] =ext->lines[i - 1];

115 
‹xt
->
lšes
[
lše_no
] = 
	`‹xt_lše_Ãw
("",ext->
fÚt
,ext->
height
);;

116 
	}
}

123 
»®


124 
	$‹xt_g‘_lše_width
(
Text
 *
‹xt
, 
lše_no
)

126  
	`‹xt_lše_g‘_width
(
‹xt
->
lšes
[
lše_no
]);

127 
	}
}

135 
	$‹xt_g‘_lše_¡¾’
(
Text
 *
‹xt
, 
lše_no
)

137  
	`g_utf8_¡¾’
(
	`‹xt_lše_g‘_¡ršg
(
‹xt
->
lšes
[
lše_no
]), -1);

138 
	}
}

140 
»®


141 
	$‹xt_g‘_max_width
(
Text
 *
‹xt
)

143  
‹xt
->
max_width
;

144 
	}
}

150 
»®


151 
	$‹xt_g‘_asûÁ
(
Text
 *
‹xt
)

153  
‹xt
->
asûÁ
;

154 
	}
}

160 
»®


161 
	$‹xt_g‘_desûÁ
(
Text
 *
‹xt
)

163  
‹xt
->
desûÁ
;

164 
	}
}

166 
ObjeùChªge
 *
‹xt_ü—‹_chªge
(
Text
 *
‹xt
, 
chªge_ty³
 
ty³
,

167 
gunich¬
 
ch
, 
pos
, 
row
);

170 
	$ÿlc_width
(
Text
 *
‹xt
)

172 
»®
 
width
;

173 
i
;

175 
width
 = 0.0;

176 
i
 = 0; i < 
‹xt
->
numlšes
; i++) {

177 
width
 = 
	`MAX
(width, 
	`‹xt_g‘_lše_width
(
‹xt
, 
i
));

180 
‹xt
->
max_width
 = 
width
;

181 
	}
}

184 
	$ÿlc_asûÁ_desûÁ
(
Text
 *
‹xt
)

186 
»®
 
sig_a
 = 0.0,
sig_d
 = 0.0;

187 
gušt
 
i
;

189  
i
 = 0; i < 
‹xt
->
numlšes
; i++) {

190 
sig_a
 +ğ
	`‹xt_lše_g‘_asûÁ
(
‹xt
->
lšes
[
i
]);

191 
sig_d
 +ğ
	`‹xt_lše_g‘_desûÁ
(
‹xt
->
lšes
[
i
]);

194 
‹xt
->
asûÁ
 = 
sig_a
 / (
»®
éext->
numlšes
;

195 
‹xt
->
desûÁ
 = 
sig_d
 / (
»®
éext->
numlšes
;

196 
	}
}

199 
	$ä“_¡ršg
(
Text
 *
‹xt
)

201 
i
;

203 
i
=0;i<
‹xt
->
numlšes
;i++) {

204 
	`‹xt_lše_de¡roy
(
‹xt
->
lšes
[
i
]);

207 
	`g_ä“
(
‹xt
->
lšes
);

208 
‹xt
->
lšes
 = 
NULL
;

209 
	}
}

212 
	$£t_¡ršg
(
Text
 *
‹xt
, cÚ¡ *
¡ršg
)

214 
numlšes
, 
i
;

215 cÚ¡ *
s
,*
s2
;

217 
s
 = 
¡ršg
;

219 
numlšes
 = 1;

220 ià(
s
 !ğ
NULL
)

221  (
s
 = 
	`g_utf8_¡rchr
(s, -1, '\n')è!ğ
NULL
 ) {

222 
numlšes
++;

223 ià(*
s
) {

224 
s
 = 
	`g_utf8_Ãxt_ch¬
(s);

227 
‹xt
->
numlšes
 =‚umlines;

228 
‹xt
->
lšes
 = 
	`g_Ãw0
(
TextLše
 *, 
numlšes
);

229 
i
 = 0; i < 
numlšes
; i++) {

230 
‹xt
->
lšes
[
i
] = 
	`‹xt_lše_Ãw
("",ext->
fÚt
,ext->
height
);

233 
s
 = 
¡ršg
;

235 ià(
¡ršg
 =ğ
NULL
) {

236 
	`‹xt_£t_lše_‹xt
(
‹xt
, 0, "");

240 
i
 = 0; i < 
numlšes
; i++) {

241 
gch¬
 *
¡ršg_lše
;

242 
s2
 = 
	`g_utf8_¡rchr
(
s
, -1, '\n');

243 ià(
s2
 =ğ
NULL
) {

244 
s2
 = 
s
 + 
	`¡¾’
(s);

246 
¡ršg_lše
 = 
	`g_¡ºdup
(
s
, 
s2
 - s);

247 
	`‹xt_£t_lše_‹xt
(
‹xt
, 
i
, 
¡ršg_lše
);

248 
	`g_ä“
(
¡ršg_lše
);

249 
s
 = 
s2
;

250 ià(*
s
) {

251 
s
 = 
	`g_utf8_Ãxt_ch¬
(s);

255 ià(
‹xt
->
cursÜ_row
 >ğ‹xt->
numlšes
) {

256 
‹xt
->
cursÜ_row
 =ext->
numlšes
 - 1;

259 ià(
‹xt
->
cursÜ_pos
 > 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
)) {

260 
‹xt
->
cursÜ_pos
 = 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
);

262 
	}
}

265 
	$‹xt_£t_¡ršg
(
Text
 *
‹xt
, cÚ¡ *
¡ršg
)

267 ià(
‹xt
->
lšes
 !ğ
NULL
)

268 
	`ä“_¡ršg
(
‹xt
);

270 
	`£t_¡ršg
(
‹xt
, 
¡ršg
);

271 
	}
}

273 
Text
 *

274 
	$Ãw_‹xt
(cÚ¡ *
¡ršg
, 
DŸFÚt
 *
fÚt
, 
»®
 
height
,

275 
Pošt
 *
pos
, 
CŞÜ
 *
cŞÜ
, 
Alignm’t
 
®ign
)

277 
Text
 *
‹xt
;

279 
‹xt
 = 
	`g_Ãw
(
Text
, 1);

281 
‹xt
->
fÚt
 = 
	`dŸ_fÚt_»f
(font);

282 
‹xt
->
height
 = height;

284 
‹xt
->
pos™iÚ
 = *
pos
;

285 
‹xt
->
cŞÜ
 = *color;

286 
‹xt
->
®ignm’t
 = 
®ign
;

288 
‹xt
->
cursÜ_pos
 = 0;

289 
‹xt
->
cursÜ_row
 = 0;

291 
‹xt
->
focus
.
obj
 = 
NULL
;

292 
‹xt
->
focus
.
has_focus
 = 
FALSE
;

293 
‹xt
->
focus
.
u£r_d©a
 = (*)text;

294 
‹xt
->
focus
.
key_ev’t
 = 
‹xt_key_ev’t
;

295 
‹xt
->
focus
.text =ext;

297 
	`£t_¡ršg
(
‹xt
, 
¡ršg
);

299 
	`ÿlc_asûÁ_desûÁ
(
‹xt
);

301  
‹xt
;

302 
	}
}

304 
Text
 *

305 
	$‹xt_cİy
(
Text
 *
‹xt
)

307 
Text
 *
cİy
;

308 
i
;

310 
cİy
 = 
	`g_Ãw
(
Text
, 1);

311 
cİy
->
numlšes
 = 
‹xt
->numlines;

312 
cİy
->
lšes
 = 
	`g_Ãw
(
TextLše
 *, 
‹xt
->
numlšes
);

314 
cİy
->
fÚt
 = 
	`dŸ_fÚt_cİy
(
‹xt
->font);

315 
cİy
->
height
 = 
‹xt
->height;

316 
cİy
->
pos™iÚ
 = 
‹xt
->position;

317 
cİy
->
cŞÜ
 = 
‹xt
->color;

318 
cİy
->
®ignm’t
 = 
‹xt
->alignment;

320 
i
=0;i<
‹xt
->
numlšes
;i++) {

321 
TextLše
 *
‹xt_lše
 = 
‹xt
->
lšes
[
i
];

322 
cİy
->
lšes
[
i
] = 
	`‹xt_lše_Ãw
(
	`‹xt_lše_g‘_¡ršg
(
‹xt_lše
),

323 
	`‹xt_lše_g‘_fÚt
(
‹xt_lše
),

324 
	`‹xt_lše_g‘_height
(
‹xt_lše
));

327 
cİy
->
cursÜ_pos
 = 0;

328 
cİy
->
cursÜ_row
 = 0;

329 
cİy
->
focus
.
obj
 = 
NULL
;

330 
cİy
->
focus
.
has_focus
 = 
FALSE
;

331 
cİy
->
focus
.
u£r_d©a
 = (*)copy;

332 
cİy
->
focus
.
key_ev’t
 = 
‹xt_key_ev’t
;

333 
cİy
->
focus
.
‹xt
 = copy;

335 
cİy
->
asûÁ
 = 
‹xt
->ascent;

336 
cİy
->
desûÁ
 = 
‹xt
->descent;

337 
cİy
->
max_width
 = 
‹xt
->max_width;

339  
cİy
;

340 
	}
}

343 
	$‹xt_de¡roy
(
Text
 *
‹xt
)

345 
	`ä“_¡ršg
(
‹xt
);

346 
	`dŸ_fÚt_uÄef
(
‹xt
->
fÚt
);

347 
	`g_ä“
(
‹xt
);

348 
	}
}

351 
	$‹xt_£t_height
(
Text
 *
‹xt
, 
»®
 
height
)

353 
i
;

354 
‹xt
->
height
 = height;

355 
i
 = 0; i < 
‹xt
->
numlšes
; i++) {

356 
	`‹xt_lše_£t_height
(
‹xt
->
lšes
[
i
], 
height
);

358 
	`ÿlc_width
(
‹xt
);

359 
	`ÿlc_asûÁ_desûÁ
(
‹xt
);

360 
	}
}

363 
	$‹xt_£t_fÚt
(
Text
 *
‹xt
, 
DŸFÚt
 *
fÚt
)

365 
DŸFÚt
 *
Şd_fÚt
 = 
‹xt
->
fÚt
;

366 
i
;

368 
‹xt
->
fÚt
 = 
	`dŸ_fÚt_»f
(font);

369 
	`dŸ_fÚt_uÄef
(
Şd_fÚt
);

371 
i
 = 0; i < 
‹xt
->
numlšes
; i++) {

372 
	`‹xt_lše_£t_fÚt
(
‹xt
->
lšes
[
i
], 
fÚt
);

375 
	`ÿlc_width
(
‹xt
);

376 
	`ÿlc_asûÁ_desûÁ
(
‹xt
);

377 
	}
}

380 
	$‹xt_£t_pos™iÚ
(
Text
 *
‹xt
, 
Pošt
 *
pos
)

382 
‹xt
->
pos™iÚ
 = *
pos
;

383 
	}
}

386 
	$‹xt_£t_cŞÜ
(
Text
 *
‹xt
, 
CŞÜ
 *
cŞ
)

388 
‹xt
->
cŞÜ
 = *
cŞ
;

389 
	}
}

392 
	$‹xt_£t_®ignm’t
(
Text
 *
‹xt
, 
Alignm’t
 
®ign
)

394 
‹xt
->
®ignm’t
 = 
®ign
;

395 
	}
}

398 
	$‹xt_ÿlc_boundšgbox
(
Text
 *
‹xt
, 
ReùªgË
 *
box
)

400 
	`ÿlc_width
(
‹xt
);

401 
	`ÿlc_asûÁ_desûÁ
(
‹xt
);

403 ià(
box
 =ğ
NULL
) ;

405 
box
->
Ëá
 = 
‹xt
->
pos™iÚ
.
x
;

406 
‹xt
->
®ignm’t
) {

407 
ALIGN_LEFT
:

409 
ALIGN_CENTER
:

410 
box
->
Ëá
 -ğ
‹xt
->
max_width
 / 2.0;

412 
ALIGN_RIGHT
:

413 
box
->
Ëá
 -ğ
‹xt
->
max_width
;

417 
box
->
right
 = box->
Ëá
 + 
‹xt
->
max_width
;

419 
box
->
tİ
 = 
‹xt
->
pos™iÚ
.
y
 -ext->
asûÁ
;

421 
box
->
bÙtom
 = box->
tİ
 + 
‹xt
->
height
*‹xt->
numlšes
 +ext->
desûÁ
;

424 
box
->
bÙtom
 = box->
tİ
 + (
‹xt
->
asûÁ
+‹xt->
desûÁ
+‹xt->
height
*Ñext->
numlšes
-1));

426 ià(
‹xt
->
focus
.
has_focus
) {

427 
»®
 
height
 = 
‹xt
->
asûÁ
 +ext->
desûÁ
;

428 ià(
‹xt
->
cursÜ_pos
 == 0) {

430 
box
->
Ëá
 -ğ
height
/(
CURSOR_HEIGHT_RATIO
*2);

435 
box
->
right
 +ğ
height
/(
CURSOR_HEIGHT_RATIO
*2);

439 
box
->
tİ
 -ğ
height
/(
CURSOR_HEIGHT_RATIO
*2);

440 
box
->
bÙtom
 +ğ
height
/
CURSOR_HEIGHT_RATIO
;

442 
	}
}

445 
	$‹xt_g‘_¡ršg_cİy
(
Text
 *
‹xt
)

447 
num
,
i
;

448 *
¡r
;

450 
num
 = 0;

451 
i
=0;i<
‹xt
->
numlšes
;i++) {

453 
num
 +ğ
	`¡¾’
(
	`‹xt_g‘_lše
(
‹xt
, 
i
))+1;

456 
¡r
 = 
	`g_m®loc
(
num
);

458 *
¡r
 = 0;

460 
i
=0;i<
‹xt
->
numlšes
;i++) {

461 
	`¡rÿt
(
¡r
, 
	`‹xt_g‘_lše
(
‹xt
, 
i
));

462 ià(
i
 !ğ(
‹xt
->
numlšes
-1)) {

463 
	`¡rÿt
(
¡r
, "\n");

467  
¡r
;

468 
	}
}

470 
»®


471 
	$‹xt_di¡ªû_äom
(
Text
 *
‹xt
, 
Pošt
 *
pošt
)

473 
»®
 
dx
, 
dy
;

474 
»®
 
tİy
, 
bÙtomy
;

475 
»®
 
Ëá
, 
right
;

476 
lše
;

478 
tİy
 = 
‹xt
->
pos™iÚ
.
y
 -ext->
asûÁ
;

479 
bÙtomy
 = 
tİy
 + 
‹xt
->
height
*‹xt->
numlšes
;

480 ià(
pošt
->
y
 <ğ
tİy
) {

481 
dy
 = 
tİy
 - 
pošt
->
y
;

482 
lše
 = 0;

483 } ià(
pošt
->
y
 >ğ
bÙtomy
) {

484 
dy
 = 
pošt
->
y
 - 
bÙtomy
;

485 
lše
 = 
‹xt
->
numlšes
 - 1;

487 
dy
 = 0.0;

488 
lše
 = (è
	`æoÜ
Ğ(
pošt
->
y
 - 
tİy
è/ 
‹xt
->
height
 );

491 
Ëá
 = 
‹xt
->
pos™iÚ
.
x
;

492 
‹xt
->
®ignm’t
) {

493 
ALIGN_LEFT
:

495 
ALIGN_CENTER
:

496 
Ëá
 -ğ
	`‹xt_g‘_lše_width
(
‹xt
, 
lše
) / 2.0;

498 
ALIGN_RIGHT
:

499 
Ëá
 -ğ
	`‹xt_g‘_lše_width
(
‹xt
, 
lše
);

502 
right
 = 
Ëá
 + 
	`‹xt_g‘_lše_width
(
‹xt
, 
lše
);

504 ià(
pošt
->
x
 <ğ
Ëá
) {

505 
dx
 = 
Ëá
 - 
pošt
->
x
;

506 } ià(
pošt
->
x
 >ğ
right
) {

507 
dx
 = 
pošt
->
x
 - 
right
;

509 
dx
 = 0.0;

512  
dx
 + 
dy
;

513 
	}
}

516 
	$‹xt_d¿w
(
Text
 *
‹xt
, 
DŸR’d””
 *
»nd””
)

518 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_‹xt
Ô’d””, 
‹xt
);

520 ià((
»nd””
->
is_š‹¿ùive
è&& (
‹xt
->
focus
.
has_focus
)) {

521 
»®
 
curs_x
, 
curs_y
;

522 
»®
 
¡r_width_fœ¡
;

523 
»®
 
¡r_width_whŞe
;

524 
Pošt
 
p1
, 
p2
;

525 
»®
 
height
 = 
‹xt
->
asûÁ
+‹xt->
desûÁ
;

526 
curs_y
 = 
‹xt
->
pos™iÚ
.
y
 -ext->
asûÁ
 +ext->
cursÜ_row
*‹xt->
height
;

528 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_fÚt
Ô’d””, 
‹xt
->
fÚt
,ext->
height
);

530 
¡r_width_fœ¡
 =

531 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`g‘_‹xt_width
(renderer,

532 
	`‹xt_g‘_lše
(
‹xt
,ext->
cursÜ_row
),

533 
‹xt
->
cursÜ_pos
);

534 
¡r_width_whŞe
 =

535 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`g‘_‹xt_width
(renderer,

536 
	`‹xt_g‘_lše
(
‹xt
,ext->
cursÜ_row
),

537 
	`‹xt_g‘_lše_¡¾’
(
‹xt
,ext->
cursÜ_row
));

538 
curs_x
 = 
‹xt
->
pos™iÚ
.
x
 + 
¡r_width_fœ¡
;

540 
‹xt
->
®ignm’t
) {

541 
ALIGN_LEFT
:

543 
ALIGN_CENTER
:

544 
curs_x
 -ğ
¡r_width_whŞe
 / 2.0;

546 
ALIGN_RIGHT
:

547 
curs_x
 -ğ
¡r_width_whŞe
;

551 
p1
.
x
 = 
curs_x
;

552 
p1
.
y
 = 
curs_y
;

553 
p2
.
x
 = 
curs_x
;

554 
p2
.
y
 = 
curs_y
 + 
height
;

556 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lše¡yË
Ô’d””, 
LINESTYLE_SOLID
);

557 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_lšewidth
Ô’d””, 
height
/
CURSOR_HEIGHT_RATIO
);

558 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`d¿w_lše
Ô’d””, &
p1
, &
p2
, &
cŞÜ_bÏck
);

560 
	}
}

563 
	$‹xt_g¿b_focus
(
Text
 *
‹xt
, 
DŸObjeù
 *
objeù
)

565 
‹xt
->
focus
.
obj
 = 
objeù
;

566 
	`»que¡_focus
(&
‹xt
->
focus
);

567 
	}
}

570 
	$‹xt_£t_cursÜ_©_’d
Ğ
Text
* 
‹xt
 )

572 
‹xt
->
cursÜ_row
 =ext->
numlšes
 - 1 ;

573 
‹xt
->
cursÜ_pos
 = 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
) ;

574 
	}
}

579 
	$‹xt_£t_cursÜ
(
Text
 *
‹xt
, 
Pošt
 *
şicked_pošt
,

580 
DŸR’d””
 *
»nd””
)

582 
»®
 
¡r_width_whŞe
;

583 
»®
 
¡r_width_fœ¡
;

584 
»®
 
tİ
;

585 
»®
 
¡¬t_x
;

586 
row
;

587 
i
;

589 ià(
şicked_pošt
 !ğ
NULL
) {

590 
tİ
 = 
‹xt
->
pos™iÚ
.
y
 -ext->
asûÁ
;

592 
row
 = ()
	`æoÜ
((
şicked_pošt
->
y
 - 
tİ
è/ 
‹xt
->
height
);

594 ià(
row
 < 0)

595 
row
 = 0;

597 ià(
row
 >ğ
‹xt
->
numlšes
)

598 
row
 = 
‹xt
->
numlšes
 - 1;

600 
‹xt
->
cursÜ_row
 = 
row
;

601 
‹xt
->
cursÜ_pos
 = 0;

603 ià(!
»nd””
->
is_š‹¿ùive
) {

604 
	`mes§ge_”rÜ
("Internalƒrror: Select gives‚on interactive„enderer!\n"

605 "v®: %d\n", 
»nd””
->
is_š‹¿ùive
);

610 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`£t_fÚt
Ô’d””, 
‹xt
->
fÚt
,ext->
height
);

611 
¡r_width_whŞe
 =

612 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`g‘_‹xt_width
(renderer,

613 
	`‹xt_g‘_lše
(
‹xt
, 
row
),

614 
	`‹xt_g‘_lše_¡¾’
(
‹xt
, 
row
));

615 
¡¬t_x
 = 
‹xt
->
pos™iÚ
.
x
;

616 
‹xt
->
®ignm’t
) {

617 
ALIGN_LEFT
:

619 
ALIGN_CENTER
:

620 
¡¬t_x
 -ğ
¡r_width_whŞe
 / 2.0;

622 
ALIGN_RIGHT
:

623 
¡¬t_x
 -ğ
¡r_width_whŞe
;

630 
i
=0;i<=
	`‹xt_g‘_lše_¡¾’
(
‹xt
, 
row
);i++) {

631 
¡r_width_fœ¡
 =

632 
	`DIA_RENDERER_GET_CLASS
(
»nd””
)->
	`g‘_‹xt_width
Ô’d””, 
	`‹xt_g‘_lše
(
‹xt
, 
row
), 
i
);

633 ià(
şicked_pošt
->
x
 - 
¡¬t_x
 >ğ
¡r_width_fœ¡
) {

634 
‹xt
->
cursÜ_pos
 = 
i
;

639 
‹xt
->
cursÜ_pos
 = 
	`‹xt_g‘_lše_¡¾’
Ñext, 
row
);

643 
	}
}

646 
	$‹xt_još_lšes
(
Text
 *
‹xt
, 
fœ¡_lše
)

648 
gch¬
 *
combšed_lše
;

649 
Ën1
;

651 
Ën1
 = 
	`‹xt_g‘_lše_¡¾’
(
‹xt
, 
fœ¡_lše
);

653 
combšed_lše
 = 
	`g_¡rcÚÿt
(
	`‹xt_g‘_lše
(
‹xt
, 
fœ¡_lše
),

654 
	`‹xt_g‘_lše
(
‹xt
, 
fœ¡_lše
 + 1), 
NULL
);

655 
	`‹xt_d–‘e_lše
(
‹xt
, 
fœ¡_lše
);

656 
	`‹xt_£t_lše_‹xt
(
‹xt
, 
fœ¡_lše
, 
combšed_lše
);

657 
	`g_ä“
(
combšed_lše
);

659 
‹xt
->
max_width
 = 
	`MAX
Ñext->max_width, 
	`‹xt_g‘_lše_width
Ñext, 
fœ¡_lše
));

661 
‹xt
->
cursÜ_row
 = 
fœ¡_lše
;

662 
‹xt
->
cursÜ_pos
 = 
Ën1
;

663 
	}
}

666 
	$‹xt_d–‘e_fÜw¬d
(
Text
 *
‹xt
)

668 
row
;

669 
i
;

670 
»®
 
width
;

671 
gch¬
 *
lše
;

672 
gch¬
 *
utf8_befÜe
, *
utf8_aá”
;

673 
gch¬
 *
¡r1
, *
¡r
;

675 
row
 = 
‹xt
->
cursÜ_row
;

677 ià(
‹xt
->
cursÜ_pos
 >ğ
	`‹xt_g‘_lše_¡¾’
Ñext, 
row
)) {

678 ià(
row
 + 1 < 
‹xt
->
numlšes
)

679 
	`‹xt_još_lšes
(
‹xt
, 
row
);

683 
lše
 = 
	`‹xt_g‘_lše
(
‹xt
, 
row
);

684 
utf8_befÜe
 = 
	`g_utf8_off£t_to_poš‹r
(
lše
, (
glÚg
)(
‹xt
->
cursÜ_pos
));

685 
utf8_aá”
 = 
	`g_utf8_off£t_to_poš‹r
(
utf8_befÜe
, 1);

686 
¡r1
 = 
	`g_¡ºdup
(
lše
, 
utf8_befÜe
 -†ine);

687 
¡r
 = 
	`g_¡rcÚÿt
(
¡r1
, 
utf8_aá”
, 
NULL
);

688 
	`‹xt_£t_lše_‹xt
(
‹xt
, 
row
, 
¡r
);

689 
	`g_ä“
(
¡r1
);

690 
	`g_ä“
(
¡r
);

692 ià(
‹xt
->
cursÜ_pos
 > 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
))

693 
‹xt
->
cursÜ_pos
 = 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
);

695 
width
 = 0.0;

696 
i
 = 0; i < 
‹xt
->
numlšes
; i++) {

697 
width
 = 
	`MAX
(width, 
	`‹xt_g‘_lše_width
(
‹xt
, 
i
));

699 
‹xt
->
max_width
 = 
width
;

700 
	}
}

703 
	$‹xt_d–‘e_backw¬d
(
Text
 *
‹xt
)

705 
row
;

706 
i
;

707 
»®
 
width
;

708 
gch¬
 *
lše
;

709 
gch¬
 *
utf8_befÜe
, *
utf8_aá”
;

710 
gch¬
 *
¡r1
, *
¡r
;

712 
row
 = 
‹xt
->
cursÜ_row
;

714 ià(
‹xt
->
cursÜ_pos
 <= 0) {

715 ià(
row
 > 0)

716 
	`‹xt_još_lšes
(
‹xt
, 
row
-1);

720 
lše
 = 
	`‹xt_g‘_lše
(
‹xt
, 
row
);

721 
utf8_befÜe
 = 
	`g_utf8_off£t_to_poš‹r
(
lše
, (
glÚg
)(
‹xt
->
cursÜ_pos
 - 1));

722 
utf8_aá”
 = 
	`g_utf8_off£t_to_poš‹r
(
utf8_befÜe
, 1);

723 
¡r1
 = 
	`g_¡ºdup
(
lše
, 
utf8_befÜe
 -†ine);

724 
¡r
 = 
	`g_¡rcÚÿt
(
¡r1
, 
utf8_aá”
, 
NULL
);

725 
	`‹xt_£t_lše_‹xt
(
‹xt
, 
row
, 
¡r
);

726 
	`g_ä“
(
¡r
);

727 
	`g_ä“
(
¡r1
);

729 
‹xt
->
cursÜ_pos
 --;

730 ià(
‹xt
->
cursÜ_pos
 > 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
))

731 
‹xt
->
cursÜ_pos
 = 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
);

733 
width
 = 0.0;

734 
i
 = 0; i < 
‹xt
->
numlšes
; i++) {

735 
width
 = 
	`MAX
(width, 
	`‹xt_g‘_lše_width
(
‹xt
, 
i
));

737 
‹xt
->
max_width
 = 
width
;

738 
	}
}

741 
	$‹xt_¥l™_lše
(
Text
 *
‹xt
)

743 
i
;

744 *
lše
;

745 
»®
 
width
;

746 
gch¬
 *
utf8_befÜe
;

747 
gch¬
 *
¡r1
, *
¡r2
;

750 
lše
 = 
	`‹xt_g‘_lše
(
‹xt
,ext->
cursÜ_row
);

751 
	`‹xt_š£¹_lše
(
‹xt
,ext->
cursÜ_row
);

752 
utf8_befÜe
 = 
	`g_utf8_off£t_to_poš‹r
(
lše
, (
glÚg
)(
‹xt
->
cursÜ_pos
));

753 
¡r1
 = 
	`g_¡ºdup
(
lše
, 
utf8_befÜe
 -†ine);

754 
¡r2
 = 
	`g_¡rdup
(
utf8_befÜe
);

755 
	`‹xt_£t_lše_‹xt
(
‹xt
,ext->
cursÜ_row
, 
¡r1
);

756 
	`‹xt_£t_lše_‹xt
(
‹xt
,ext->
cursÜ_row
 + 1, 
¡r2
);

757 
	`g_ä“
(
¡r2
);

758 
	`g_ä“
(
¡r1
);

760 
‹xt
->
cursÜ_row
 ++;

761 
‹xt
->
cursÜ_pos
 = 0;

763 
width
 = 0.0;

764 
i
=0;i<
‹xt
->
numlšes
;i++) {

765 
width
 = 
	`MAX
(width, 
	`‹xt_g‘_lše_width
(
‹xt
, 
i
));

767 
‹xt
->
max_width
 = 
width
;

768 
	}
}

771 
	$‹xt_š£¹_ch¬
(
Text
 *
‹xt
, 
gunich¬
 
c
)

773 
gch¬
 
ch
[7];

774 
un’
;

775 
row
;

776 
gch¬
 *
lše
, *
¡r
;

777 
gch¬
 *
utf8_befÜe
;

778 
gch¬
 *
¡r1
;

781 
un’
 = 
	`g_unich¬_to_utf8
 (
c
, 
ch
);

782 
ch
[
un’
] = 0;

784 
row
 = 
‹xt
->
cursÜ_row
;

787 
lše
 = 
	`‹xt_g‘_lše
(
‹xt
, 
row
);

788 
utf8_befÜe
 = 
	`g_utf8_off£t_to_poš‹r
(
lše
, (
glÚg
)(
‹xt
->
cursÜ_pos
));

789 
¡r1
 = 
	`g_¡ºdup
(
lše
, 
utf8_befÜe
 -†ine);

790 
¡r
 = 
	`g_¡rcÚÿt
(
¡r1
, 
ch
, 
utf8_befÜe
, 
NULL
);

791 
	`‹xt_£t_lše_‹xt
(
‹xt
, 
row
, 
¡r
);

792 
	`g_ä“
(
¡r
);

793 
	`g_ä“
(
¡r1
);

795 
‹xt
->
cursÜ_pos
++;

796 
‹xt
->
max_width
 = 
	`MAX
Ñext->max_width, 
	`‹xt_g‘_lše_width
Ñext, 
row
));

797 
	}
}

799 
gboŞ—n


800 
	$‹xt_d–‘e_key_hªdËr
(
Focus
 *
focus
, 
ObjeùChªge
 ** 
chªge
)

802 
Text
 *
‹xt
;

803 
row
, 
i
;

804 cÚ¡ *
utf
;

805 
gunich¬
 
c
;

807 
‹xt
 = (
Text
 *)
focus
->
u£r_d©a
;

808 
row
 = 
‹xt
->
cursÜ_row
;

809 ià(
‹xt
->
cursÜ_pos
 >ğ
	`‹xt_g‘_lše_¡¾’
Ñext, 
row
)) {

810 ià(
row
+1 < 
‹xt
->
numlšes
) {

811 *
chªge
 = 
	`‹xt_ü—‹_chªge
(
‹xt
, 
TYPE_JOIN_ROW
, 'Q',

812 
‹xt
->
cursÜ_pos
, 
row
);

814  
FALSE
;

817 
utf
 = 
	`‹xt_g‘_lše
(
‹xt
, 
row
);

818 
i
 = 0; i < 
‹xt
->
cursÜ_pos
; i++)

819 
utf
 = 
	`g_utf8_Ãxt_ch¬
 (utf);

820 
c
 = 
	`g_utf8_g‘_ch¬
 (
utf
);

821 *
chªge
 = 
	`‹xt_ü—‹_chªge
 (
‹xt
, 
TYPE_DELETE_FORWARD
, 
c
,

822 
‹xt
->
cursÜ_pos
,ext->
cursÜ_row
);

824 
	`‹xt_d–‘e_fÜw¬d
(
‹xt
);

825  
TRUE
;;

826 
	}
}

829 
	$‹xt_key_ev’t
(
Focus
 *
focus
, 
gušt
 
keyv®
, cÚ¡ 
gch¬
 *
¡r
, 
¡¾’
,

830 
ObjeùChªge
 **
chªge
)

832 
Text
 *
‹xt
;

833 
»tuº_v®
 = 
FALSE
;

834 
row
, 
i
;

835 cÚ¡ *
utf
;

836 
gunich¬
 
c
;

838 *
chªge
 = 
NULL
;

840 
‹xt
 = (
Text
 *)
focus
->
u£r_d©a
;

842 
keyv®
) {

843 
GDK_Up
:

844 
‹xt
->
cursÜ_row
--;

845 ià(
‹xt
->
cursÜ_row
<0)

846 
‹xt
->
cursÜ_row
 = 0;

848 ià(
‹xt
->
cursÜ_pos
 > 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
))

849 
‹xt
->
cursÜ_pos
 = 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
);

852 
GDK_Down
:

853 
‹xt
->
cursÜ_row
++;

854 ià(
‹xt
->
cursÜ_row
 >ğ‹xt->
numlšes
)

855 
‹xt
->
cursÜ_row
 =ext->
numlšes
 - 1;

857 ià(
‹xt
->
cursÜ_pos
 > 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
))

858 
‹xt
->
cursÜ_pos
 = 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
);

861 
GDK_Leá
:

862 
‹xt
->
cursÜ_pos
--;

863 ià(
‹xt
->
cursÜ_pos
<0)

864 
‹xt
->
cursÜ_pos
 = 0;

866 
GDK_Right
:

867 
‹xt
->
cursÜ_pos
++;

868 ià(
‹xt
->
cursÜ_pos
 > 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
))

869 
‹xt
->
cursÜ_pos
 = 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
);

871 
GDK_Home
:

872 
‹xt
->
cursÜ_pos
 = 0;

874 
GDK_End
:

875 
‹xt
->
cursÜ_pos
 = 
	`‹xt_g‘_lše_¡¾’
Ñext,ext->
cursÜ_row
);

877 
GDK_D–‘e
:

878 
»tuº_v®
 = 
	`‹xt_d–‘e_key_hªdËr
(
focus
, 
chªge
);

880 
GDK_BackS·û
:

881 
»tuº_v®
 = 
TRUE
;

882 
row
 = 
‹xt
->
cursÜ_row
;

883 ià(
‹xt
->
cursÜ_pos
 <= 0) {

884 ià(
row
 > 0) {

885 *
chªge
 = 
	`‹xt_ü—‹_chªge
(
‹xt
, 
TYPE_JOIN_ROW
, 'Q',

886 
	`‹xt_g‘_lše_¡¾’
(
‹xt
, 
row
-1),„ow-1);

888 
»tuº_v®
 = 
FALSE
;

892 
utf
 = 
	`‹xt_g‘_lše
(
‹xt
, 
row
);

893 
i
 = 0; i < (
‹xt
->
cursÜ_pos
 - 1); i++)

894 
utf
 = 
	`g_utf8_Ãxt_ch¬
 (utf);

895 
c
 = 
	`g_utf8_g‘_ch¬
 (
utf
);

896 *
chªge
 = 
	`‹xt_ü—‹_chªge
 (
‹xt
, 
TYPE_DELETE_BACKWARD
, 
c
,

897 
‹xt
->
cursÜ_pos
 - 1,

898 
‹xt
->
cursÜ_row
);

900 
	`‹xt_d–‘e_backw¬d
(
‹xt
);

902 
GDK_R‘uº
:

903 
GDK_KP_EÁ”
:

904 
»tuº_v®
 = 
TRUE
;

905 *
chªge
 = 
	`‹xt_ü—‹_chªge
(
‹xt
, 
TYPE_SPLIT_ROW
, 'Q',

906 
‹xt
->
cursÜ_pos
,ext->
cursÜ_row
);

907 
	`‹xt_¥l™_lše
(
‹xt
);

909 
GDK_Shiá_L
:

910 
GDK_Shiá_R
:

911 
GDK_CÚŒŞ_L
:

912 
GDK_CÚŒŞ_R
:

913 
GDK_AÉ_L
:

914 
GDK_AÉ_R
:

915 
GDK_M‘a_L
:

916 
GDK_M‘a_R
:

917 
»tuº_v®
 = 
FALSE
;

920 ià(
¡r
 || (
¡¾’
>0)) {

921 ià(
¡¾’
 =ğ1 && *
¡r
 == '\r')

923 
»tuº_v®
 = 
TRUE
;

924 
utf
 = 
¡r
;

925 
utf
 = 
¡r
; utà&& *utà&& 
¡¾’
 > 0 ;

926 
utf
 = 
	`g_utf8_Ãxt_ch¬
 (utf), 
¡¾’
--) {

927 
c
 = 
	`g_utf8_g‘_ch¬
 (
utf
);

929 *
chªge
 = 
	`‹xt_ü—‹_chªge
 (
‹xt
, 
TYPE_INSERT_CHAR
, 
c
,

930 
‹xt
->
cursÜ_pos
,ext->
cursÜ_row
);

931 
	`‹xt_š£¹_ch¬
 (
‹xt
, 
c
);

937  
»tuº_v®
;

938 
	}
}

940 
	$‹xt_is_em±y
(
Text
 *
‹xt
)

942 
i
;

943 
i
 = 0; i < 
‹xt
->
numlšes
; i++) {

944 ià(
	`‹xt_g‘_lše_¡¾’
(
‹xt
, 
i
) != 0) {

945  
FALSE
;

948  
TRUE
;

949 
	}
}

952 
	$‹xt_d–‘e_®l
(
Text
 *
‹xt
, 
ObjeùChªge
 **
chªge
)

954 ià(!
	`‹xt_is_em±y
(
‹xt
)) {

955 *
chªge
 = 
	`‹xt_ü—‹_chªge
(
‹xt
, 
TYPE_DELETE_ALL
,

956 0, 
‹xt
->
cursÜ_pos
,ext->
cursÜ_row
);

958 
	`‹xt_£t_¡ršg
(
‹xt
, "");

959 
	`ÿlc_asûÁ_desûÁ
(
‹xt
);

960  
TRUE
;

962  
FALSE
;

963 
	}
}

966 
	$d©a_add_‹xt
(
A‰ribu‹Node
 
©Œ
, 
Text
 *
‹xt
)

968 
D©aNode
 
compos™e
;

969 *
¡r
;

971 
compos™e
 = 
	`d©a_add_compos™e
(
©Œ
, "text");

973 
¡r
 = 
	`‹xt_g‘_¡ršg_cİy
(
‹xt
);

974 
	`d©a_add_¡ršg
(
	`compos™e_add_©Œibu‹
(
compos™e
, "string"),

975 
¡r
);

976 
	`g_ä“
(
¡r
);

977 
	`d©a_add_fÚt
(
	`compos™e_add_©Œibu‹
(
compos™e
, "font"),

978 
‹xt
->
fÚt
);

979 
	`d©a_add_»®
(
	`compos™e_add_©Œibu‹
(
compos™e
, "height"),

980 
‹xt
->
height
);

981 
	`d©a_add_pošt
(
	`compos™e_add_©Œibu‹
(
compos™e
, "pos"),

982 &
‹xt
->
pos™iÚ
);

983 
	`d©a_add_cŞÜ
(
	`compos™e_add_©Œibu‹
(
compos™e
, "color"),

984 &
‹xt
->
cŞÜ
);

985 
	`d©a_add_’um
(
	`compos™e_add_©Œibu‹
(
compos™e
, "alignment"),

986 
‹xt
->
®ignm’t
);

987 
	}
}

990 
Text
 *

991 
	$d©a_‹xt
(
A‰ribu‹Node
 
‹xt_©Œ
)

993 *
¡ršg
 = 
NULL
;

994 
DŸFÚt
 *
fÚt
;

995 
»®
 
height
;

996 
Pošt
 
pos
 = {0.0, 0.0};

997 
CŞÜ
 
cŞ
;

998 
Alignm’t
 
®ign
;

999 
A‰ribu‹Node
 
©Œ
;

1000 
D©aNode
 
compos™e_node
;

1001 
Text
 *
‹xt
;

1003 
compos™e_node
 = 
	`©Œibu‹_fœ¡_d©a
(
‹xt_©Œ
);

1005 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
‹xt_©Œ
, "string");

1006 ià(
©Œ
 !ğ
NULL
)

1007 
¡ršg
 = 
	`d©a_¡ršg
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

1009 
height
 = 1.0;

1010 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
‹xt_©Œ
, "height");

1011 ià(
©Œ
 !ğ
NULL
)

1012 
height
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

1014 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
‹xt_©Œ
, "font");

1015 ià(
©Œ
 !ğ
NULL
) {

1016 
fÚt
 = 
	`d©a_fÚt
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

1018 
fÚt
 = 
	`dŸ_fÚt_Ãw_äom_¡yË
(
DIA_FONT_SANS
,1.0);

1021 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
‹xt_©Œ
, "pos");

1022 ià(
©Œ
 !ğ
NULL
)

1023 
	`d©a_pošt
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
pos
);

1025 
cŞ
 = 
cŞÜ_bÏck
;

1026 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
‹xt_©Œ
, "color");

1027 ià(
©Œ
 !ğ
NULL
)

1028 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
cŞ
);

1030 
®ign
 = 
ALIGN_LEFT
;

1031 
©Œ
 = 
	`compos™e_fšd_©Œibu‹
(
‹xt_©Œ
, "alignment");

1032 ià(
©Œ
 !ğ
NULL
)

1033 
®ign
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

1035 
‹xt
 = 
	`Ãw_‹xt
(
¡ršg
 ? sŒšg : "", 
fÚt
, 
height
, &
pos
, &
cŞ
, 
®ign
);

1036 ià(
fÚt
è
	`dŸ_fÚt_uÄef
(font);

1037 ià(
¡ršg
è
	`g_ä“
(string);

1038  
‹xt
;

1039 
	}
}

1042 
	$‹xt_g‘_©Œibu‹s
(
Text
 *
‹xt
, 
TextA‰ribu‹s
 *
©Œ
)

1044 
DŸFÚt
 *
Şd_fÚt
;

1045 
Şd_fÚt
 = 
©Œ
->
fÚt
;

1046 
©Œ
->
fÚt
 = 
	`dŸ_fÚt_»f
(
‹xt
->font);

1047 ià(
Şd_fÚt
 !ğ
NULL
è
	`dŸ_fÚt_uÄef
(old_font);

1048 
©Œ
->
height
 = 
‹xt
->height;

1049 
©Œ
->
pos™iÚ
 = 
‹xt
->position;

1050 
©Œ
->
cŞÜ
 = 
‹xt
->color;

1051 
©Œ
->
®ignm’t
 = 
‹xt
->alignment;

1052 
	}
}

1055 
	$‹xt_£t_©Œibu‹s
(
Text
 *
‹xt
, 
TextA‰ribu‹s
 *
©Œ
)

1057 ià(
‹xt
->
fÚt
 !ğ
©Œ
->font) {

1058 
	`‹xt_£t_fÚt
(
‹xt
, 
©Œ
->
fÚt
);

1060 
	`‹xt_£t_height
(
‹xt
, 
©Œ
->
height
);

1061 
‹xt
->
pos™iÚ
 = 
©Œ
->position;

1062 
‹xt
->
cŞÜ
 = 
©Œ
->color;

1063 
‹xt
->
®ignm’t
 = 
©Œ
->alignment;

1064 
	}
}

1067 
	$‹xt_chªge_­¶y
(
TextObjeùChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1069 
Text
 *
‹xt
 = 
chªge
->text;

1070 
chªge
->
ty³
) {

1071 
TYPE_INSERT_CHAR
:

1072 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
;

1073 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1074 
	`‹xt_š£¹_ch¬
(
‹xt
, 
chªge
->
ch
);

1076 
TYPE_DELETE_BACKWARD
:

1077 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
+1;

1078 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1079 
	`‹xt_d–‘e_backw¬d
(
‹xt
);

1081 
TYPE_DELETE_FORWARD
:

1082 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
;

1083 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1084 
	`‹xt_d–‘e_fÜw¬d
(
‹xt
);

1086 
TYPE_SPLIT_ROW
:

1087 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
;

1088 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1089 
	`‹xt_¥l™_lše
(
‹xt
);

1091 
TYPE_JOIN_ROW
:

1092 
	`‹xt_još_lšes
(
‹xt
, 
chªge
->
row
);

1094 
TYPE_DELETE_ALL
:

1095 
	`£t_¡ršg
(
‹xt
, "");

1096 
‹xt
->
cursÜ_pos
 = 0;

1097 
‹xt
->
cursÜ_row
 = 0;

1100 
	}
}

1103 
	$‹xt_chªge_»v”t
(
TextObjeùChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

1105 
Text
 *
‹xt
 = 
chªge
->text;

1106 
chªge
->
ty³
) {

1107 
TYPE_INSERT_CHAR
:

1108 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
;

1109 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1110 
	`‹xt_d–‘e_fÜw¬d
(
‹xt
);

1112 
TYPE_DELETE_BACKWARD
:

1113 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
;

1114 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1115 
	`‹xt_š£¹_ch¬
(
‹xt
, 
chªge
->
ch
);

1117 
TYPE_DELETE_FORWARD
:

1118 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
;

1119 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1120 
	`‹xt_š£¹_ch¬
(
‹xt
, 
chªge
->
ch
);

1121 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
;

1122 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1124 
TYPE_SPLIT_ROW
:

1125 
	`‹xt_još_lšes
(
‹xt
, 
chªge
->
row
);

1127 
TYPE_JOIN_ROW
:

1128 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
;

1129 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1130 
	`‹xt_¥l™_lše
(
‹xt
);

1132 
TYPE_DELETE_ALL
:

1133 
	`£t_¡ršg
(
‹xt
, 
chªge
->
¡r
);

1134 
‹xt
->
cursÜ_pos
 = 
chªge
->
pos
;

1135 
‹xt
->
cursÜ_row
 = 
chªge
->
row
;

1138 
	}
}

1141 
	$‹xt_chªge_ä“
(
TextObjeùChªge
 *
chªge
) {

1142 
	`g_ä“
(
chªge
->
¡r
);

1143 
	}
}

1145 
ObjeùChªge
 *

1146 
	$‹xt_ü—‹_chªge
(
Text
 *
‹xt
, 
chªge_ty³
 
ty³
,

1147 
gunich¬
 
ch
, 
pos
, 
row
)

1149 
TextObjeùChªge
 *
chªge
;

1151 
chªge
 = 
	`g_Ãw0
(
TextObjeùChªge
, 1);

1153 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
‹xt_chªge_­¶y
;

1154 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
‹xt_chªge_»v”t
;

1155 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
‹xt_chªge_ä“
;

1157 
chªge
->
‹xt
 =ext;

1158 
chªge
->
ty³
 =ype;

1159 
chªge
->
ch
 = ch;

1160 
chªge
->
pos
 =…os;

1161 
chªge
->
row
 =„ow;

1162 ià(
ty³
 =ğ
TYPE_DELETE_ALL
)

1163 
chªge
->
¡r
 = 
	`‹xt_g‘_¡ršg_cİy
(
‹xt
);

1165 
chªge
->
¡r
 = 
NULL
;

1166  (
ObjeùChªge
 *)
chªge
;

1167 
	}
}

1169 
gboŞ—n


1170 
	$­¶y_‹x‰r_´İ”t›s
(
GPŒA¼ay
 *
´İs
,

1171 
Text
 *
‹xt
, cÚ¡ 
gch¬
 *
‹xŠame
,

1172 
TextA‰ribu‹s
 *
©Œs
)

1174 
TextPrİ”ty
 *
‹xrİ
 =

1175 (
TextPrİ”ty
 *)
	`fšd_´İ_by_Çme_ªd_ty³
(
´İs
,
‹xŠame
,
PROP_TYPE_TEXT
);

1177 ià((!
‹xrİ
) ||

1178 ((
‹xrİ
->
commÚ
.
ex³r›nû
 & (
PXP_LOADED
|
PXP_SFO
))==0 )) {

1180 
	`‹xt_£t_©Œibu‹s
(
‹xt
,
©Œs
);

1181  
TRUE
;

1183  
FALSE
;

1184 
	}
}

1186 
gboŞ—n


1187 
	$­¶y_‹xt¡r_´İ”t›s
(
GPŒA¼ay
 *
´İs
,

1188 
Text
 *
‹xt
, cÚ¡ 
gch¬
 *
‹xŠame
,

1189 cÚ¡ 
gch¬
 *
¡r
)

1191 
TextPrİ”ty
 *
‹xrİ
 =

1192 (
TextPrİ”ty
 *)
	`fšd_´İ_by_Çme_ªd_ty³
(
´İs
,
‹xŠame
,
PROP_TYPE_TEXT
);

1194 ià((!
‹xrİ
) ||

1195 ((
‹xrİ
->
commÚ
.
ex³r›nû
 & (
PXP_LOADED
|
PXP_SFO
))==0 )) {

1197 
	`‹xt_£t_¡ršg
(
‹xt
,
¡r
);

1198  
TRUE
;

1200  
FALSE
;

1201 
	}
}

	@O:\tool\dvs50\lib\text.h

18 #iâdeà
TEXT_H


19 
	#TEXT_H


	)

22 
	mTEXT_EDIT_START
,

23 
	mTEXT_EDIT_CHANGE
,

24 
	mTEXT_EDIT_END


25 } 
	tTextEd™S‹
;

27 
	~<glib.h
>

28 
	~"dŸty³s.h
"

29 
	~"‹x‰r.h
"

30 
	~"focus.h
"

31 
	~"´İ”t›s.h
"

33 
	#USE_TEXTLINE_FOR_LINES


	)

35 
	s_Text
 {

37 
DŸObjeù
 *
	m·»Á_objeù
;

41 
	mnumlšes
;

42 
TextLše
 **
	mlšes
;

45 
DŸFÚt
 *
	mfÚt
;

46 
»®
 
	mheight
;

47 
Pošt
 
	mpos™iÚ
;

48 
CŞÜ
 
	mcŞÜ
;

49 
Alignm’t
 
	m®ignm’t
;

52 
	mcursÜ_pos
;

53 
	mcursÜ_row
;

54 
Focus
 
	mfocus
;

57 
»®
 
	masûÁ
;

58 
»®
 
	mdesûÁ
;

59 
»®
 
	mmax_width
;

64 
DIAVAR
 
Text
 *
Ãw_‹xt
(cÚ¡ *
¡ršg
, 
DŸFÚt
 *
fÚt
, 
»®
 
height
,

65 
Pošt
 *
pos
, 
CŞÜ
 *
cŞÜ
, 
Alignm’t
 
®ign
);

66 
DIAVAR
 
‹xt_de¡roy
(
Text
 *
‹xt
);

67 
DIAVAR
 
Text
 *
‹xt_cİy
(Texˆ*
‹xt
);

68 
DIAVAR
 
gch¬
 *
‹xt_g‘_lše
(
Text
 *
‹xt
, 
lše
);

69 
DIAVAR
 *
‹xt_g‘_¡ršg_cİy
(
Text
 *
‹xt
);

70 
DIAVAR
 
‹xt_£t_¡ršg
(
Text
 *
‹xt
, cÚ¡ *
¡ršg
);

71 
DIAVAR
 
‹xt_£t_height
(
Text
 *
‹xt
, 
»®
 
height
);

72 
DIAVAR
 
‹xt_£t_fÚt
(
Text
 *
‹xt
, 
DŸFÚt
 *
fÚt
);

73 
DIAVAR
 
‹xt_£t_pos™iÚ
(
Text
 *
‹xt
, 
Pošt
 *
pos
);

74 
DIAVAR
 
‹xt_£t_cŞÜ
(
Text
 *
‹xt
, 
CŞÜ
 *
cŞ
);

75 
DIAVAR
 
‹xt_£t_®ignm’t
(
Text
 *
‹xt
, 
Alignm’t
 
®ign
);

76 
DIAVAR
 
»®
 
‹xt_di¡ªû_äom
(
Text
 *
‹xt
, 
Pošt
 *
pošt
);

77 
DIAVAR
 
‹xt_ÿlc_boundšgbox
(
Text
 *
‹xt
, 
ReùªgË
 *
box
);

78 
DIAVAR
 
‹xt_d¿w
(
Text
 *
‹xt
, 
DŸR’d””
 *
»nd””
);

79 
DIAVAR
 
‹xt_£t_cursÜ
(
Text
 *
‹xt
, 
Pošt
 *
şicked_pošt
,

80 
DŸR’d””
 *
š‹¿ùive_»nd””
);

81 
DIAVAR
 
‹xt_£t_cursÜ_©_’d
Ğ
Text
* 
‹xt
 );

82 
DIAVAR
 
‹xt_g¿b_focus
(
Text
 *
‹xt
, 
DŸObjeù
 *
objeù
);

83 
DIAVAR
 
‹xt_is_em±y
(
Text
 *
‹xt
);

84 
DIAVAR
 
‹xt_d–‘e_®l
(
Text
 *
‹xt
, 
ObjeùChªge
 **
chªge
);

85 
DIAVAR
 
‹xt_g‘_©Œibu‹s
(
Text
 *
‹xt
, 
TextA‰ribu‹s
 *
©Œ
);

86 
DIAVAR
 
‹xt_£t_©Œibu‹s
(
Text
 *
‹xt
, 
TextA‰ribu‹s
 *
©Œ
);

88 
DIAVAR
 
»®
 
‹xt_g‘_lše_width
(
Text
 *
‹xt
, 
lše_no
);

89 
DIAVAR
 
‹xt_g‘_lše_¡¾’
(
Text
 *
‹xt
, 
lše_no
);

90 
DIAVAR
 
»®
 
‹xt_g‘_max_width
(
Text
 *
‹xt
);

91 
DIAVAR
 
»®
 
‹xt_g‘_asûÁ
(
Text
 *
‹xt
);

92 
DIAVAR
 
»®
 
‹xt_g‘_desûÁ
(
Text
 *
‹xt
);

96 
DIAVAR
 
gboŞ—n
 
‹xt_d–‘e_key_hªdËr
(
Focus
 *
focus
, 
ObjeùChªge
 **
chªge
);

97 
DIAVAR
 
d©a_add_‹xt
(
A‰ribu‹Node
 
©Œ
, 
Text
 *
‹xt
);

98 
DIAVAR
 
Text
 *
d©a_‹xt
(
A‰ribu‹Node
 
©Œ
);

99 
DIAVAR
 
gboŞ—n
 
­¶y_‹x‰r_´İ”t›s
(
GPŒA¼ay
 *
´İs
,

100 
Text
 *
‹xt
, cÚ¡ 
gch¬
 *
‹xŠame
,

101 
TextA‰ribu‹s
 *
©Œs
);

102 
DIAVAR
 
gboŞ—n
 
­¶y_‹xt¡r_´İ”t›s
(
GPŒA¼ay
 *
´İs
,

103 
Text
 *
‹xt
, cÚ¡ 
gch¬
 *
‹xŠame
,

104 cÚ¡ 
gch¬
 *
¡r
);

	@O:\tool\dvs50\lib\textattr.h

18 #iâdeà
TEXTATTR_H


19 
	#TEXTATTR_H


	)

21 
	~"dŸty³s.h
"

22 
	~"fÚt.h
"

23 
	~"geom‘ry.h
"

24 
	~"cŞÜ.h
"

26 
	s_TextA‰ribu‹s
 {

27 
DŸFÚt
 *
	mfÚt
;

28 
»®
 
	mheight
;

29 
Pošt
 
	mpos™iÚ
;

30 
CŞÜ
 
	mcŞÜ
;

31 
Alignm’t
 
	m®ignm’t
;

	@O:\tool\dvs50\lib\textline.c

18 
	~<cÚfig.h
>

20 
	~<¡dio.h
>

21 
	~<¡dlib.h
>

22 
	~<¡ršg.h
>

23 
	~<glib.h
>

24 
	~<m©h.h
>

26 
	~<gdk/gdkkeysyms.h
>

28 
	~"´İš‹º®s.h
"

29 
	~"‹xt.h
"

30 
	~"mes§ge.h
"

31 
	~"‹xše.h
"

33 
‹xt_lše_dœty_ÿche
(
TextLše
 *
‹xt_lše
);

34 
‹xt_lše_ÿche_v®ues
(
TextLše
 *
‹xt_lše
);

35 
ş—r_Ïyout_off£t
 (
TextLše
 *
‹xt_lše
);

42 
	$‹xt_lše_£t_¡ršg
(
TextLše
 *
‹xt_lše
, cÚ¡ 
gch¬
 *
¡ršg
)

44 ià(
‹xt_lše
->
ch¬s
 =ğ
NULL
 ||

45 
	`¡rcmp
(
‹xt_lše
->
ch¬s
, 
¡ršg
)) {

46 ià(
‹xt_lše
->
ch¬s
 !ğ
NULL
) {

47 
	`g_ä“
(
‹xt_lše
->
ch¬s
);

50 
‹xt_lše
->
ch¬s
 = 
	`g_¡rdup
(
¡ršg
);

52 
	`‹xt_lše_dœty_ÿche
(
‹xt_lše
);

54 
	}
}

61 
	$‹xt_lše_£t_fÚt
(
TextLše
 *
‹xt_lše
, 
DŸFÚt
 *
fÚt
)

63 ià(
‹xt_lše
->
fÚt
 != font) {

64 
DŸFÚt
 *
Şd_fÚt
 = 
‹xt_lše
->
fÚt
;

65 
	`dŸ_fÚt_»f
(
fÚt
);

66 
‹xt_lše
->
fÚt
 = font;

67 ià(
Şd_fÚt
 !ğ
NULL
) {

68 
	`dŸ_fÚt_uÄef
(
Şd_fÚt
);

70 
	`‹xt_lše_dœty_ÿche
(
‹xt_lše
);

72 
	}
}

80 
	$‹xt_lše_£t_height
(
TextLše
 *
‹xt_lše
, 
»®
 
height
)

82 ià(
	`çbs
(
‹xt_lše
->
height
 - height) > 0.00001) {

83 
‹xt_lše
->
height
 = height;

84 
	`‹xt_lše_dœty_ÿche
(
‹xt_lše
);

86 
	}
}

93 
TextLše
 *

94 
	$‹xt_lše_Ãw
(cÚ¡ 
gch¬
 *
¡ršg
, 
DŸFÚt
 *
fÚt
, 
»®
 
height
)

96 
TextLše
 *
‹xt_lše
 = 
	`g_Ãw0
(TextLine, 1);

98 
	`‹xt_lše_£t_¡ršg
(
‹xt_lše
, 
¡ršg
);

99 
	`‹xt_lše_£t_fÚt
(
‹xt_lše
, 
fÚt
);

100 
	`‹xt_lše_£t_height
(
‹xt_lše
, 
height
);

102  
‹xt_lše
;

103 
	}
}

105 
TextLše
 *

106 
	$‹xt_lše_cİy
(cÚ¡ 
TextLše
 *
‹xt_lše
)

108  
	`‹xt_lše_Ãw
(
‹xt_lše
->
ch¬s
,ext_lše->
fÚt
,ext_lše->
height
);

109 
	}
}

116 
	$‹xt_lše_de¡roy
(
TextLše
 *
‹xt_lše
)

118 ià(
‹xt_lše
->
ch¬s
 !ğ
NULL
) {

119 
	`g_ä“
(
‹xt_lše
->
ch¬s
);

121 ià(
‹xt_lše
->
fÚt
 !ğ
NULL
) {

122 
	`dŸ_fÚt_uÄef
(
‹xt_lše
->
fÚt
);

124 
	`ş—r_Ïyout_off£t
 (
‹xt_lše
);

125 
	`g_ä“
 (
‹xt_lše
->
off£ts
);

126 
	`g_ä“
(
‹xt_lše
);

127 
	}
}

135 
	$‹xt_lše_ÿlc_boundšgbox_size
(
TextLše
 *
‹xt_lše
, 
Pošt
 *
size
)

137 
	`‹xt_lše_ÿche_v®ues
(
‹xt_lše
);

139 
size
->
x
 = 
‹xt_lše
->
width
;

140 
size
->
y
 = 
‹xt_lše
->
asûÁ
 +ext_lše->
desûÁ
;

141 
	}
}

143 
gch¬
 *

144 
	$‹xt_lše_g‘_¡ršg
(cÚ¡ 
TextLše
 *
‹xt_lše
)

146  
‹xt_lše
->
ch¬s
;

147 
	}
}

149 
DŸFÚt
 *

150 
	$‹xt_lše_g‘_fÚt
(cÚ¡ 
TextLše
 *
‹xt_lše
)

152  
‹xt_lše
->
fÚt
;

153 
	}
}

155 
»®


156 
	$‹xt_lše_g‘_height
(cÚ¡ 
TextLše
 *
‹xt_lše
)

158  
‹xt_lše
->
height
;

159 
	}
}

161 
»®


162 
	$‹xt_lše_g‘_width
(cÚ¡ 
TextLše
 *
‹xt_lše
)

164 
	`‹xt_lše_ÿche_v®ues
((
TextLše
 *)
‹xt_lše
);

165  
‹xt_lše
->
width
;

166 
	}
}

168 
»®


169 
	$‹xt_lše_g‘_asûÁ
(cÚ¡ 
TextLše
 *
‹xt_lše
)

171 
	`‹xt_lše_ÿche_v®ues
((
TextLše
 *)
‹xt_lše
);

172  
‹xt_lše
->
asûÁ
;

173 
	}
}

175 
»®


176 
	$‹xt_lše_g‘_desûÁ
(cÚ¡ 
TextLše
 *
‹xt_lše
)

178 
	`‹xt_lše_ÿche_v®ues
((
TextLše
 *)
‹xt_lše
);

179  
‹xt_lše
->
desûÁ
;

180 
	}
}

190 
»®


191 
	$‹xt_lše_g‘_®ignm’t_adju¡m’t
(
TextLše
 *
‹xt_lše
, 
Alignm’t
 
®ignm’t
)

193 
	`‹xt_lše_ÿche_v®ues
(
‹xt_lše
);

194 
®ignm’t
) {

195 
ALIGN_CENTER
:

196  
‹xt_lše
->
width
 / 2;

197 
ALIGN_RIGHT
:

198  
‹xt_lše
->
width
;

202 
	}
}

209 
	$‹xt_lše_dœty_ÿche
(
TextLše
 *
‹xt_lše
)

211 
‹xt_lše
->
ş—n
 = 
FALSE
;

212 
	}
}

215 
	$ş—r_Ïyout_off£t
 (
TextLše
 *
‹xt_lše
)

217 ià(
‹xt_lše
->
Ïyout_off£ts
 !ğ
NULL
) {

218 
GSLi¡
 *
runs
 = 
‹xt_lše
->
Ïyout_off£ts
->runs;

220 ; 
runs
 !ğ
NULL
;„un ğ
	`g_¦i¡_Ãxt
(runs)) {

221 
PªgoGlyphI‹m
 *
run
 = (PªgoGlyphI‹m *è
runs
->
d©a
;

223 
	`g_ä“
(
run
->
glyphs
->glyphs);

224 
	`g_ä“
(
run
->
glyphs
);

226 
	`g_¦i¡_ä“
(
runs
);

227 
	`g_ä“
(
‹xt_lše
->
Ïyout_off£ts
);

228 
‹xt_lše
->
Ïyout_off£ts
 = 
NULL
;

230 
	}
}

233 
	$‹xt_lše_ÿche_v®ues
(
TextLše
 *
‹xt_lše
)

235 ià(!
‹xt_lše
->
ş—n
 ||

236 
‹xt_lše
->
ch¬s
 !ğ‹xt_lše->
ch¬s_ÿche
 ||

237 
‹xt_lše
->
fÚt
 !ğ‹xt_lše->
fÚt_ÿche
 ||

238 
‹xt_lše
->
height
 !ğ‹xt_lše->
height_ÿche
) {

239 
n_off£ts
;

241 ià(
‹xt_lše
->
off£ts
 !ğ
NULL
) {

242 
	`g_ä“
(
‹xt_lše
->
off£ts
);

243 
‹xt_lše
->
off£ts
 = 
NULL
;

245 
	`ş—r_Ïyout_off£t
 (
‹xt_lše
);

247 ià(
‹xt_lše
->
ch¬s
 =ğ
NULL
 ||

248 
‹xt_lše
->
ch¬s
[0] == '\0') {

250 
‹xt_lše
->
off£ts
 =

251 
	`dŸ_fÚt_g‘_sizes
("XjgM149", 
‹xt_lše
->
fÚt
,ext_lše->
height
,

252 &
‹xt_lše
->
width
, &‹xt_lše->
asûÁ
,

253 &
‹xt_lše
->
desûÁ
, &
n_off£ts
,

254 &
‹xt_lše
->
Ïyout_off£ts
);

255 
	`ş—r_Ïyout_off£t
 (
‹xt_lše
);

256 
	`g_ä“
 (
‹xt_lše
->
off£ts
);

257 
‹xt_lše
->
off£ts
 = 
	`g_Ãw
 (
»®
,0);

258 
‹xt_lše
->
width
 = 0;

260 
‹xt_lše
->
off£ts
 =

261 
	`dŸ_fÚt_g‘_sizes
(
‹xt_lše
->
ch¬s
,ext_lše->
fÚt
,ext_lše->
height
,

262 &
‹xt_lše
->
width
, &‹xt_lše->
asûÁ
,

263 &
‹xt_lše
->
desûÁ
, &
n_off£ts
,

264 &
‹xt_lše
->
Ïyout_off£ts
);

266 
‹xt_lše
->
ş—n
 = 
TRUE
;

267 
‹xt_lše
->
ch¬s_ÿche
 =ext_lše->
ch¬s
;

268 
‹xt_lše
->
fÚt_ÿche
 =ext_lše->
fÚt
;

269 
‹xt_lše
->
height_ÿche
 =ext_lše->
height
;

271 
	}
}

280 
	$‹xt_lše_adju¡_glyphs
(
TextLše
 *
lše
, 
PªgoGlyphSŒšg
 *
glyphs
, 
»®
 
sÿË
)

282 
i
;

284 
i
 = 0; i < 
glyphs
->
num_glyphs
; i++) {

290 
glyphs
->glyphs[
i
].
geom‘ry
.
width
 =

291 ()(
lše
->
off£ts
[
i
] * 
sÿË
 * 20.0 * 
PANGO_SCALE
);

293 
	}
}

304 
	$‹xt_lše_adju¡_Ïyout_lše
(
TextLše
 *
lše
, 
PªgoLayoutLše
 *
Ïyouše
,

305 
»®
 
sÿË
)

307 
GSLi¡
 *
ÏyouŒuns
 = 
Ïyouše
->
runs
;

308 
GSLi¡
 *
runs
;

310 ià(
lše
->
Ïyout_off£ts
 =ğ
NULL
) {

314 
runs
 = 
lše
->
Ïyout_off£ts
->runs;

316 ià(
	`g_¦i¡_Ëngth
(
runs
è!ğg_¦i¡_Ëngth(
ÏyouŒuns
)) {

317 
	`´štf
("Runs†engthƒrror: %d != %d\n",

318 
	`g_¦i¡_Ëngth
(
lše
->
Ïyout_off£ts
->
runs
),

319 
	`g_¦i¡_Ëngth
(
Ïyouše
->
runs
));

321 ; 
runs
 !ğ
NULL
 && 
ÏyouŒuns
 !ğNULL;„un ğ
	`g_¦i¡_Ãxt
(runs),

322 
ÏyouŒuns
 = 
	`g_¦i¡_Ãxt
(layoutruns)) {

323 
PªgoGlyphSŒšg
 *
glyphs
 = ((
PªgoLayoutRun
 *è
runs
->
d©a
)->glyphs;

324 
PªgoGlyphSŒšg
 *
Ïyoutglyphs
 =

325 ((
PªgoLayoutRun
 *è
ÏyouŒuns
->
d©a
)->
glyphs
;

326 
i
;

328 
i
 = 0; i < 
glyphs
->
num_glyphs
 && i < 
Ïyoutglyphs
->num_glyphs; i++) {

329 
Ïyoutglyphs
->
glyphs
[
i
].
geom‘ry
.
width
 =

330 ()(
glyphs
->glyphs[
i
].
geom‘ry
.
width
 * 
sÿË
 / 20.0);

331 
Ïyoutglyphs
->
glyphs
[
i
].
geom‘ry
.
x_off£t
 =

332 ()(
glyphs
->glyphs[
i
].
geom‘ry
.
x_off£t
 * 
sÿË
 / 20.0);

333 
Ïyoutglyphs
->
glyphs
[
i
].
geom‘ry
.
y_off£t
 =

334 ()(
glyphs
->glyphs[
i
].
geom‘ry
.
y_off£t
 * 
sÿË
 / 20.0);

336 ià(
glyphs
->
num_glyphs
 !ğ
Ïyoutglyphs
->num_glyphs) {

337 
	`´štf
("Glyph†engthƒrror: %d != %d\n",

338 
glyphs
->
num_glyphs
, 
Ïyoutglyphs
->num_glyphs);

341 
	}
}

	@O:\tool\dvs50\lib\textline.h

18 #iâdeà
TEXTLINE_H


19 
	#TEXTLINE_H


	)

27 
	~<glib.h
>

28 
	~"dŸty³s.h
"

29 
	~"´İ”t›s.h
"

30 
	~"dŸv¬.h
"

32 
	s_TextLše
 {

36 
gch¬
 *
	mch¬s
;

39 
DŸFÚt
 *
	mfÚt
;

40 
»®
 
	mheight
;

43 
»®
 
	masûÁ
;

44 
»®
 
	mdesûÁ
;

45 
»®
 
	mwidth
;

49 
gboŞ—n
 
	mş—n
;

54 
gch¬
 *
	mch¬s_ÿche
;

55 
DŸFÚt
 *
	mfÚt_ÿche
;

56 
»®
 
	mheight_ÿche
;

59 
»®
 *
	moff£ts
;

60 
PªgoLayoutLše
 *
	mÏyout_off£ts
;

63 
DIAVAR
 
TextLše
 *
‹xt_lše_Ãw
(cÚ¡ 
gch¬
 *
¡ršg
, 
DŸFÚt
 *
fÚt
, 
»®
 
height
);

64 
DIAVAR
 
‹xt_lše_de¡roy
(
TextLše
 *
‹xt
);

65 
DIAVAR
 
TextLše
 *
‹xt_lše_cİy
(cÚ¡ TextLš*
‹xt
);

66 
DIAVAR
 
‹xt_lše_£t_¡ršg
(
TextLše
 *
‹xt
, cÚ¡ *
¡ršg
);

67 
DIAVAR
 
‹xt_lše_£t_height
(
TextLše
 *
‹xt
, 
»®
 
height
);

68 
DIAVAR
 
‹xt_lše_£t_fÚt
(
TextLše
 *
‹xt
, 
DŸFÚt
 *
fÚt
);

69 
	$__deş¥ec
(
dÎexpÜt
è
gch¬
 *
	`‹xt_lše_g‘_¡ršg
(cÚ¡ 
TextLše
 *
‹xt
);

70 
	$__deş¥ec
(
dÎexpÜt
è
DŸFÚt
 *
	`‹xt_lše_g‘_fÚt
(cÚ¡ 
TextLše
 *
‹xt
);

71 
	$__deş¥ec
(
dÎexpÜt
è
»®
 
	`‹xt_lše_g‘_height
(cÚ¡ 
TextLše
 *
‹xt
);

72 
DIAVAR
 
	`‹xt_lše_ÿlc_boundšgbox_size
(
TextLše
 *
‹xt
, 
Pošt
 *
size
);

73 
DIAVAR
 
»®
 
	`‹xt_lše_g‘_width
(cÚ¡ 
TextLše
 *
‹xt
);

74 
DIAVAR
 
»®
 
	`‹xt_lše_g‘_asûÁ
(cÚ¡ 
TextLše
 *
‹xt
);

75 
DIAVAR
 
»®
 
	`‹xt_lše_g‘_desûÁ
(cÚ¡ 
TextLše
 *
‹xt
);

77 
	`‹xt_lše_adju¡_glyphs
(
TextLše
 *
lše
,

78 
PªgoGlyphSŒšg
 *
glyphs
,

79 
»®
 
sÿË
);

80 
DIAVAR
 
	`‹xt_lše_adju¡_Ïyout_lše
(
TextLše
 *
lše
, 
PªgoLayoutLše
 *
Ïyouše
,

81 
»®
 
sÿË
);

82 
DIAVAR
 
»®
 
	`‹xt_lše_g‘_®ignm’t_adju¡m’t
(
TextLše
 *
‹xt_lše
,

83 
Alignm’t
 
®ignm’t
);

	@O:\tool\dvs50\lib\units.c

2 
	~"un™s.h
"

5 cÚ¡ 
DIAVAR
 
DŸUn™Def
 
	gun™s
[] =

	@O:\tool\dvs50\lib\units.h

18 #iâdeà
UNITS_H


19 
	#UNITS_H


	)

21 
	~<cÚfig.h
>

22 
	~"dŸv¬.h
"

25 
	mDIA_UNIT_CENTIMETER
,

26 
	mDIA_UNIT_DECIMETER
,

27 
	mDIA_UNIT_FEET
,

28 
	mDIA_UNIT_INCH
,

29 
	mDIA_UNIT_METER
,

30 
	mDIA_UNIT_MILLIMETER
,

31 
	mDIA_UNIT_POINT
,

32 
	mDIA_UNIT_PICA
,

33 } 
	tDŸUn™
;

35 
_DŸUn™Def
 
	tDŸUn™Def
;

36 
	s_DŸUn™Def
 {

37 * 
	mÇme
;

38 * 
	mun™
;

39 
	mçùÜ
;

40 
	mdig™s
;

43 cÚ¡ 
DIAVAR
 
DŸUn™Def
 
	gun™s
[];

	@O:\tool\dvs50\lib\utils.c

27 
	~<cÚfig.h
>

29 
	~<¡dlib.h
>

30 
	~<¡dio.h
>

31 
	~<¡ršg.h
>

33 
	~<glib.h
>

35 
	~"uts.h
"

38 
	$Ã¬e¡_pow
 (
num
)

40 
n
 = 1;

42 
n
 < 
num
)

43 
n
 <<= 1;

45  
n
;

46 
	}
}

49 
	$fÜm©_¡ršg_Ëngth_uµ”_bound
 (cÚ¡ * 
fmt
, 
va_li¡
 *
¬gs
)

51 
Ën
 = 0;

52 
shÜt_št
;

53 
lÚg_št
;

54 
dÚe
;

55 *
tmp
;

57 *
fmt
)

59 
c
 = *
fmt
++;

61 
shÜt_št
 = 
FALSE
;

62 
lÚg_št
 = 
FALSE
;

64 ià(
c
 == '%')

66 
dÚe
 = 
FALSE
;

67 *
fmt
 && !
dÚe
)

69 *
fmt
++)

72 
Ën
 +ğ
	`va_¬g
(*
¬gs
, );

83 
fmt
 -= 1;

84 
Ën
 +ğ
	`¡¹Ş
 (
fmt
, (**)&fmt, 10);

87 
shÜt_št
 = 
TRUE
;

90 
lÚg_št
 = 
TRUE
;

96 
tmp
 = 
	`va_¬g
(*
¬gs
, *);

97 if(
tmp
)

98 
Ën
 +ğ
	`¡¾’
 (
tmp
);

100 
Ën
 +ğ
	`¡¾’
 ("(null)");

101 
dÚe
 = 
TRUE
;

109 ià(
lÚg_št
)

110 ()
	`va_¬g
 (*
¬gs
, );

111 ià(
shÜt_št
)

112 ()
	`va_¬g
 (*
¬gs
, );

114 ()
	`va_¬g
 (*
¬gs
, );

115 
Ën
 += 32;

116 
dÚe
 = 
TRUE
;

121 ()
	`va_¬g
 (*
¬gs
, );

122 
Ën
 += 32;

123 
dÚe
 = 
TRUE
;

129 ()
	`va_¬g
 (*
¬gs
, );

130 
Ën
 += 32;

131 
dÚe
 = 
TRUE
;

134 ()
	`va_¬g
 (*
¬gs
, );

135 
Ën
 += 1;

136 
dÚe
 = 
TRUE
;

140 ()
	`va_¬g
 (*
¬gs
, *);

141 
Ën
 += 32;

142 
dÚe
 = 
TRUE
;

145 
Ën
 += 1;

146 
dÚe
 = 
TRUE
;

154 
Ën
 += 1;

157  
Ën
;

158 
	}
}

	@O:\tool\dvs50\lib\utils.h

18 #iâdeà
UTILS_H


19 
	#UTILS_H


	)

21 
	~<¡d¬g.h
>

22 
	~"dŸv¬.h
"

24 
G_BEGIN_DECLS


26 
DIAVAR
 
Ã¬e¡_pow
 (
num
);

27 
DIAVAR
 
fÜm©_¡ršg_Ëngth_uµ”_bound
 (cÚ¡ * 
fmt
,

28 
va_li¡
 *
¬gs
);

30 
	gG_END_DECLS


	@O:\tool\dvs50\lib\widgets.c

19 
	~<cÚfig.h
>

20 
	~<¡ršg.h
>

21 
	~"š.h
"

22 #undeà
GTK_DISABLE_DEPRECATED


23 
	~"widg‘s.h
"

24 
	~"un™s.h
"

25 
	~"mes§ge.h
"

26 
	~"dŸ_dœs.h
"

27 
	~"¬rows.h
"

28 
	~"dŸ¬rowchoo£r.h
"

29 
	~"dŸlšechoo£r.h
"

30 
	~"³rsi¡’û.h
"

31 
	~"dŸ-lib-icÚs.h
"

33 
	~<¡dlib.h
>

34 
	~<glib.h
>

35 
	~<gdk/gdk.h
>

36 
	~<gtk/gtk.h
>

37 
	~<·ngo/·ngo.h
>

38 
	~<¡dio.h
>

39 
	~<time.h
>

40 
	~<gdk/gdkkeysyms.h
>

46 
	s_DŸDyÇmicM’u
 {

47 
GtkO±iÚM’u
 
	m·»Á
;

49 
GLi¡
 *
	mdeçuÉ_’Œ›s
;

51 
DDMC»©eI‹mFunc
 
	mü—‹_func
;

52 
DDMC®lbackFunc
 
	maùiv©e_func
;

53 
gpoš‹r
 
	mu£rd©a
;

55 
GtkM’uI‹m
 *
	mÙh”_™em
;

57 
gch¬
 *
	m³rsi¡’t_Çme
;

58 
gšt
 
	mcŞs
;

60 
gch¬
 *
	maùive
;

62 
GLi¡
 *
	mİtiÚs
;

66 
	s_DŸDyÇmicM’uCÏss
 {

67 
GtkO±iÚM’uCÏss
 
	m·»Á_şass
;

77 
	s_DŸSizeS–eùÜ


79 
GtkHBox
 
	mhbox
;

80 
GtkSpšBu‰Ú
 *
	mwidth
, *
	mheight
;

81 
GtkToggËBu‰Ú
 *
	ma¥eù_locked
;

82 
»®
 
	m¿tio
;

83 
GtkAdju¡m’t
 *
	mÏ¡_adju¡ed
;

86 
	s_DŸSizeS–eùÜCÏss


88 
GtkHBoxCÏss
 
	m·»Á_şass
;

92 
	mDSS_VALUE_CHANGED
,

93 
	mDSS_LAST_SIGNAL


96 
gušt
 
	gdss_sigÇls
[
DSS_LAST_SIGNAL
] = { 0 };

99 
	$dŸ_size_£ËùÜ_uÄ—lize
(
GtkWidg‘
 *
widg‘
)

101 (* 
	`GTK_WIDGET_CLASS
 (
	`gtk_ty³_şass
(
	`gtk_hbox_g‘_ty³
 ()))->
uÄ—lize
è(
widg‘
);

102 
	}
}

105 
	$dŸ_size_£ËùÜ_şass_š™
 (
DŸSizeS–eùÜCÏss
 *
şass
)

107 
GtkObjeùCÏss
 *
objeù_şass
;

108 
GtkWidg‘CÏss
 *
widg‘_şass
;

110 
objeù_şass
 = (
GtkObjeùCÏss
*è
şass
;

111 
widg‘_şass
 = (
GtkWidg‘CÏss
*è
şass
;

112 
widg‘_şass
->
uÄ—lize
 = 
dŸ_size_£ËùÜ_uÄ—lize
;

114 
dss_sigÇls
[
DSS_VALUE_CHANGED
]

115 ğ
	`g_sigÇl_Ãw
("value-changed",

116 
	`G_TYPE_FROM_CLASS
(
şass
),

117 
G_SIGNAL_RUN_FIRST
,

118 0, 
NULL
, NULL,

119 
g_cşosu»_m¬sh®_VOID__VOID
,

120 
G_TYPE_NONE
, 0);

121 
	}
}

124 
	$dŸ_size_£ËùÜ_adju¡_width
(
DŸSizeS–eùÜ
 *
ss
)

126 
»®
 
height
 =

127 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_æßt
(
	`GTK_SPIN_BUTTON
(
ss
->
height
));

128 ià(
	`çbs
(
ss
->
¿tio
) > 1e-6)

129 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
ss
->
width
), 
height
*ss->
¿tio
);

130 
	}
}

133 
	$dŸ_size_£ËùÜ_adju¡_height
(
DŸSizeS–eùÜ
 *
ss
)

135 
»®
 
width
 =

136 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_æßt
(
	`GTK_SPIN_BUTTON
(
ss
->
width
));

137 ià(
	`çbs
(
ss
->
¿tio
) > 1e-6)

138 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
ss
->
height
), 
width
/ss->
¿tio
);

139 
	}
}

142 
	$dŸ_size_£ËùÜ_¿tio_ÿÎback
(
GtkAdju¡m’t
 *
lim™s
, 
gpoš‹r
 
u£rd©a
)

144 
gboŞ—n
 
š_´og»ss
 = 
FALSE
;

145 
DŸSizeS–eùÜ
 *
ss
 = 
	`DIA_SIZE_SELECTOR
(
u£rd©a
);

147 
ss
->
Ï¡_adju¡ed
 = 
lim™s
;

149 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
ss
->
a¥eù_locked
))

150 && 
ss
->
¿tio
 != 0.0) {

152 ià(
š_´og»ss
)

154 
š_´og»ss
 = 
TRUE
;

156 ià(
lim™s
 =ğ
	`gtk_¥š_bu‰Ú_g‘_adju¡m’t
(
	`GTK_SPIN_BUTTON
(
ss
->
width
))) {

157 
	`dŸ_size_£ËùÜ_adju¡_height
(
ss
);

159 
	`dŸ_size_£ËùÜ_adju¡_width
(
ss
);

162 
š_´og»ss
 = 
FALSE
;

165 
	`g_sigÇl_em™
(
ss
, 
dss_sigÇls
[
DSS_VALUE_CHANGED
], 0);

167 
	}
}

173 
	$dŸ_size_£ËùÜ_£t_¿tio
(
DŸSizeS–eùÜ
 *
ss
, 
»®
 
width
,„—È
height
)

175 ià(
height
 > 0.0)

176 
ss
->
¿tio
 = 
width
/
height
;

178 
ss
->
¿tio
 = 0.0;

179 
	}
}

182 
	$dŸ_size_£ËùÜ_lock_´es£d
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

184 
DŸSizeS–eùÜ
 *
ss
 = 
	`DIA_SIZE_SELECTOR
(
d©a
);

186 
	`dŸ_size_£ËùÜ_£t_¿tio
(
ss
,

187 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
ss
->
width
)),

188 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
ss
->
height
)));

189 
	}
}

194 
	$dŸ_size_£ËùÜ_š™
 (
DŸSizeS–eùÜ
 *
ss
)

196 
GtkAdju¡m’t
 *
adj
;

198 
ss
->
¿tio
 = 0.0;

200 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1.0, 0.01, 10,

202 
ss
->
width
 = 
	`GTK_SPIN_BUTTON
(
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 1.0, 2));

203 
	`gtk_¥š_bu‰Ú_£t_w¿p
(
	`GTK_SPIN_BUTTON
(
ss
->
width
), 
TRUE
);

204 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
ss
->
width
), 
TRUE
);

205 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
ss
), 
	`GTK_WIDGET
(ss->
width
), 
FALSE
, 
TRUE
, 0);

206 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
ss
->
width
));

208 
adj
 = 
	`GTK_ADJUSTMENT
(
	`gtk_adju¡m’t_Ãw
(1.0, 0.01, 10,

210 
ss
->
height
 = 
	`GTK_SPIN_BUTTON
(
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 1.0, 2));

211 
	`gtk_¥š_bu‰Ú_£t_w¿p
(
	`GTK_SPIN_BUTTON
(
ss
->
height
), 
TRUE
);

212 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
ss
->
height
), 
TRUE
);

213 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
ss
), 
	`GTK_WIDGET
(ss->
height
), 
FALSE
, 
TRUE
, 0);

214 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
ss
->
height
));

220 
ss
->
a¥eù_locked
 =

221 
	`GTK_TOGGLE_BUTTON
(
dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs


222 (
dŸ_unbrok’_chaš_icÚ
,

223 
dŸ_brok’_chaš_icÚ
));

225 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
ss
->
a¥eù_locked
), 0);

227 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
ss
), 
	`GTK_WIDGET
(ss->
a¥eù_locked
), 
FALSE
, 
TRUE
, 0);

228 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
ss
->
a¥eù_locked
), 
TRUE
);

229 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
ss
->
a¥eù_locked
));

231 
	`gtk_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
ss
->
a¥eù_locked
), "clicked",

232 (
GtkSigÇlFunc
è
dŸ_size_£ËùÜ_lock_´es£d
,

233 
ss
);

235 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
	`gtk_¥š_bu‰Ú_g‘_adju¡m’t
(
ss
->
width
)),

237 
	`G_CALLBACK
(
dŸ_size_£ËùÜ_¿tio_ÿÎback
), (
gpoš‹r
)
ss
);

238 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
	`gtk_¥š_bu‰Ú_g‘_adju¡m’t
(
ss
->
height
)),

240 
	`G_CALLBACK
(
dŸ_size_£ËùÜ_¿tio_ÿÎback
), (
gpoš‹r
)
ss
);

241 
	}
}

243 
GtkTy³


244 
	$dŸ_size_£ËùÜ_g‘_ty³
 ()

246 
GtkTy³
 
dss_ty³
 = 0;

248 ià(!
dss_ty³
) {

249 cÚ¡ 
GtkTy³Info
 
dss_šfo
 = {

251  (
DŸSizeS–eùÜ
),

252  (
DŸSizeS–eùÜCÏss
),

253 (
GtkCÏssIn™Func
è
dŸ_size_£ËùÜ_şass_š™
,

254 (
GtkObjeùIn™Func
è
dŸ_size_£ËùÜ_š™
,

255 
NULL
,

256 
NULL
,

257 (
GtkCÏssIn™Func
è
NULL
,

260 
dss_ty³
 = 
	`gtk_ty³_unique
 (
	`gtk_hbox_g‘_ty³
 (), &
dss_šfo
);

264  
dss_ty³
;

265 
	}
}

267 
GtkWidg‘
 *

268 
	$dŸ_size_£ËùÜ_Ãw
 (
»®
 
width
,„—È
height
)

270 
GtkWidg‘
 *
wid
;

272 
wid
 = 
	`GTK_WIDGET
 ( 
	`gtk_ty³_Ãw
 (
	`dŸ_size_£ËùÜ_g‘_ty³
 ()));

273 
	`dŸ_size_£ËùÜ_£t_size
(
	`DIA_SIZE_SELECTOR
(
wid
), 
width
, 
height
);

274  
wid
;

275 
	}
}

278 
	$dŸ_size_£ËùÜ_£t_size
(
DŸSizeS–eùÜ
 *
ss
, 
»®
 
width
,„—È
height
)

280 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
ss
->
width
), width);

281 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
ss
->
height
), height);

286 
	`dŸ_size_£ËùÜ_£t_¿tio
(
ss
, 
width
, 
height
);

287 
	}
}

290 
	$dŸ_size_£ËùÜ_£t_locked
(
DŸSizeS–eùÜ
 *
ss
, 
gboŞ—n
 
locked
)

292 ià(!
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
ss
->
a¥eù_locked
))

293 && 
locked
) {

294 
	`dŸ_size_£ËùÜ_£t_¿tio
(
ss
,

295 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
ss
->
width
)),

296 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
ss
->
height
)));

298 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
ss
->
a¥eù_locked
), 
locked
);

299 
	}
}

301 
gboŞ—n


302 
	$dŸ_size_£ËùÜ_g‘_size
(
DŸSizeS–eùÜ
 *
ss
, 
»®
 *
width
,„—È*
height
)

304 *
width
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_æßt
(
	`GTK_SPIN_BUTTON
(
ss
->width));

305 *
height
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue_as_æßt
(
	`GTK_SPIN_BUTTON
(
ss
->height));

306  
	`gtk_toggË_bu‰Ú_g‘_aùive
(
ss
->
a¥eù_locked
);

307 
	}
}

315 
	s_DŸFÚtS–eùÜ


317 
GtkHBox
 
	mhbox
;

319 
GtkO±iÚM’u
 *
	mfÚt_om’u
;

320 
GtkO±iÚM’u
 *
	m¡yË_om’u
;

321 
GtkM’u
 *
	m¡yË_m’u
;

324 
	s_DŸFÚtS–eùÜCÏss


326 
GtkHBoxCÏss
 
	m·»Á_şass
;

330 
	mDFONTSEL_VALUE_CHANGED
,

331 
	mDFONTSEL_LAST_SIGNAL


334 
gušt
 
	gdfÚt£l_sigÇls
[
DFONTSEL_LAST_SIGNAL
] = { 0 };

354 
dŸ_fÚt_£ËùÜ_fÚtm’u_ÿÎback
(
DŸDyÇmicM’u
 *
ddm
,

355 
gpoš‹r
 
d©a
);

356 
dŸ_fÚt_£ËùÜ_¡yËm’u_ÿÎback
(
GtkM’u
 *
m’u
,

357 
gpoš‹r
 
d©a
);

358 
dŸ_fÚt_£ËùÜ_£t_¡yËs
(
DŸFÚtS–eùÜ
 *
fs
,

359 cÚ¡ 
gch¬
 *
Çme
,

360 
DŸFÚtStyË
 
dŸ_¡yË
);

361 
dŸ_fÚt_£ËùÜ_£t_¡yË_m’u
(
DŸFÚtS–eùÜ
 *
fs
,

362 
PªgoFÚtFamy
 *
pff
,

363 
DŸFÚtStyË
 
dŸ_¡yË
);

366 
	$dŸ_fÚt_£ËùÜ_şass_š™
 (
DŸFÚtS–eùÜCÏss
 *
şass
)

368 
GtkObjeùCÏss
 *
objeù_şass
;

370 
objeù_şass
 = (
GtkObjeùCÏss
*è
şass
;

372 
dfÚt£l_sigÇls
[
DFONTSEL_VALUE_CHANGED
]

373 ğ
	`g_sigÇl_Ãw
("value_changed",

374 
	`G_TYPE_FROM_CLASS
(
şass
),

375 
G_SIGNAL_RUN_FIRST
,

376 0, 
NULL
, NULL,

377 
g_cşosu»_m¬sh®_VOID__VOID
,

378 
G_TYPE_NONE
, 0);

379 
	}
}

382 
	$dŸ_fÚt_£ËùÜ_sÜt_fÚts
(cÚ¡ *
p1
, cÚ¡ *
p2
)

384 cÚ¡ 
gch¬
 *
n1
 = 
	`·ngo_fÚt_çmy_g‘_Çme
(
	`PANGO_FONT_FAMILY
(*(**)
p1
));

385 cÚ¡ 
gch¬
 *
n2
 = 
	`·ngo_fÚt_çmy_g‘_Çme
(
	`PANGO_FONT_FAMILY
(*(**)
p2
));

386  
	`g_ascii_¡rÿ£cmp
(
n1
, 
n2
);

387 
	}
}

389 
gch¬
*

390 
	$»¶aû_am³r§nds
(
gch¬
* 
¡ršg
)

392 
gch¬
** 
p›ûs
 = 
	`g_¡r¥l™
(
¡ršg
, "&", -1);

393 
gch¬
* 
esÿ³d
 = 
	`g_¡rjošv
("&amp;", 
p›ûs
);

394 
	`g_¡rä“v
(
p›ûs
);

395  
esÿ³d
;

396 
	}
}

398 
GtkWidg‘
 *

399 
	$dŸ_fÚt_£ËùÜ_ü—‹_¡ršg_™em
(
DŸDyÇmicM’u
 *
ddm
, 
gch¬
 *
¡ršg
)

401 
GtkWidg‘
 *
™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
¡ršg
);

402 ià(
	`¡rchr
(
¡ršg
, '&')) {

403 
gch¬
 *
esÿ³d
 = 
	`»¶aû_am³r§nds
(
¡ršg
);

404 
gch¬
 *
Ïb–
 = 
	`g_¡rdup_´štf
("<span face=\"%s,sans\" size=\"medium\">%s</span>",

405 
esÿ³d
,ƒscaped);

406 
	`gtk_Ïb–_£t_m¬kup
(
	`GTK_LABEL
(
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
™em
))), 
Ïb–
);

407 
	`g_ä“
(
Ïb–
);

408 
	`g_ä“
(
esÿ³d
);

410 
gch¬
 *
Ïb–
 = 
	`g_¡rdup_´štf
("<span face=\"%s,sans\" size=\"medium\">%s</span>",

411 
¡ršg
, string);

412 
	`gtk_Ïb–_£t_m¬kup
(
	`GTK_LABEL
(
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
™em
))), 
Ïb–
);

413 
	`g_ä“
(
Ïb–
);

415  
™em
;

416 
	}
}

419 
	$dŸ_fÚt_£ËùÜ_š™
 (
DŸFÚtS–eùÜ
 *
fs
)

421 
GtkWidg‘
 *
m’u
;

422 
GtkWidg‘
 *
om’u
;

424 
PªgoFÚtFamy
 **
çm›s
;

425 
n_çm›s
,
i
;

426 
GLi¡
 *
fÚŠames
 = 
NULL
;

428 
	`·ngo_cÚ‹xt_li¡_çm›s
 (
	`dŸ_fÚt_g‘_cÚ‹xt
(),

429 &
çm›s
, &
n_çm›s
);

430 
	`qsÜt
(
çm›s
, 
n_çm›s
, (
PªgoFÚtFamy
*),

431 
dŸ_fÚt_£ËùÜ_sÜt_fÚts
);

433 
i
 = 0; i < 
n_çm›s
; i++) {

434 
fÚŠames
 = 
	`g_li¡_­³nd
(fontnames,

435 
	`g_¡rdup
(
	`·ngo_fÚt_çmy_g‘_Çme
(
çm›s
[
i
])));

437 
	`g_ä“
 (
çm›s
);

439 
fs
->
fÚt_om’u
 =

440 
	`GTK_OPTION_MENU
(
	`dŸ_dyÇmic_m’u_Ãw_li¡ba£d
(
dŸ_fÚt_£ËùÜ_ü—‹_¡ršg_™em
,

441 
fs
, 
	`_
("Other fonts"),

442 
fÚŠames
, "font-menu"));

443 
	`g_sigÇl_cÚÃù
(
	`DIA_DYNAMIC_MENU
(
fs
->
fÚt_om’u
), "value-changed",

444 
	`G_CALLBACK
(
dŸ_fÚt_£ËùÜ_fÚtm’u_ÿÎback
), 
fs
);

445 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
fs
->
fÚt_om’u
),

447 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
fs
->
fÚt_om’u
),

449 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
fs
->
fÚt_om’u
),

451 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
fs
->
fÚt_om’u
));

454 
om’u
 = 
	`gtk_İtiÚ_m’u_Ãw
();

455 
fs
->
¡yË_om’u
 = 
	`GTK_OPTION_MENU
(
om’u
);

456 
m’u
 = 
	`gtk_m’u_Ãw
 ();

458 
fs
->
¡yË_m’u
 = 
	`GTK_MENU
(
m’u
);

459 
	`gtk_İtiÚ_m’u_£t_m’u
 (
	`GTK_OPTION_MENU
 (
fs
->
¡yË_om’u
), 
m’u
);

461 
	`gtk_widg‘_show
(
m’u
);

462 
	`gtk_widg‘_show
(
om’u
);

464 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
fÚt_om’u
));

465 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
¡yË_om’u
));

466 
	}
}

468 
GtkTy³


469 
	$dŸ_fÚt_£ËùÜ_g‘_ty³
 ()

471 
GtkTy³
 
dfs_ty³
 = 0;

473 ià(!
dfs_ty³
) {

474 cÚ¡ 
GtkTy³Info
 
dfs_šfo
 = {

476  (
DŸFÚtS–eùÜ
),

477  (
DŸFÚtS–eùÜCÏss
),

478 (
GtkCÏssIn™Func
è
dŸ_fÚt_£ËùÜ_şass_š™
,

479 (
GtkObjeùIn™Func
è
dŸ_fÚt_£ËùÜ_š™
,

480 
NULL
,

481 
NULL
,

482 (
GtkCÏssIn™Func
è
NULL


485 
dfs_ty³
 = 
	`gtk_ty³_unique
 (
	`gtk_hbox_g‘_ty³
 (), &
dfs_šfo
);

488  
dfs_ty³
;

489 
	}
}

491 
GtkWidg‘
 *

492 
	$dŸ_fÚt_£ËùÜ_Ãw
 ()

494  
	`GTK_WIDGET
 ( 
	`gtk_ty³_Ãw
 (
	`dŸ_fÚt_£ËùÜ_g‘_ty³
 ()));

495 
	}
}

497 
PªgoFÚtFamy
 *

498 
	$dŸ_fÚt_£ËùÜ_g‘_çmy_äom_Çme
(
GtkWidg‘
 *
widg‘
, cÚ¡ 
gch¬
 *
fÚŠame
)

500 
PªgoFÚtFamy
 **
çm›s
;

501 
n_çm›s
,
i
;

503 
	`·ngo_cÚ‹xt_li¡_çm›s
 (
	`dŸ_fÚt_g‘_cÚ‹xt
(),

504 &
çm›s
, &
n_çm›s
);

506 
i
 = 0; i < 
n_çm›s
; i++) {

507 ià(!(
	`g_ascii_¡rÿ£cmp
(
	`·ngo_fÚt_çmy_g‘_Çme
(
çm›s
[
i
]), 
fÚŠame
))) {

508 
PªgoFÚtFamy
 *
çm
 = 
çm›s
[
i
];

509 
	`g_ä“
(
çm›s
);

510  
çm
;

513 
	`g_w¬nšg
(
	`_
("Couldn'ˆfšd fÚˆçmy fÜ %s\n"), 
fÚŠame
);

514 
	`g_ä“
(
çm›s
);

515  
NULL
;

516 
	}
}

519 
	$dŸ_fÚt_£ËùÜ_fÚtm’u_ÿÎback
(
DŸDyÇmicM’u
 *
ddm
, 
gpoš‹r
 
d©a
)

521 
DŸFÚtS–eùÜ
 *
fs
 = 
	`DIAFONTSELECTOR
(
d©a
);

522 *
fÚŠame
 = 
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
ddm
);

523 
	`dŸ_fÚt_£ËùÜ_£t_¡yËs
(
fs
, 
fÚŠame
, -1);

524 
	`g_sigÇl_em™
(
	`GTK_OBJECT
(
fs
),

525 
dfÚt£l_sigÇls
[
DFONTSEL_VALUE_CHANGED
], 0);

526 
	`g_ä“
(
fÚŠame
);

527 
	}
}

530 
	$dŸ_fÚt_£ËùÜ_¡yËm’u_ÿÎback
(
GtkM’u
 *
m’u
, 
gpoš‹r
 
d©a
)

532 
DŸFÚtS–eùÜ
 *
fs
 = 
	`DIAFONTSELECTOR
(
d©a
);

533 
	`g_sigÇl_em™
(
	`GTK_OBJECT
(
fs
),

534 
dfÚt£l_sigÇls
[
DFONTSEL_VALUE_CHANGED
], 0);

535 
	}
}

537 *
	g¡yË_Ïb–s
[] = {

565 
	$dŸ_fÚt_£ËùÜ_£t_¡yË_m’u
(
DŸFÚtS–eùÜ
 *
fs
,

566 
PªgoFÚtFamy
 *
pff
,

567 
DŸFÚtStyË
 
dŸ_¡yË
)

569 
£Ëù
 = 0;

570 
PªgoFÚtFaû
 **
çûs
 = 
NULL
;

571 
gušt
 
nçûs
 = 0;

572 
gušt
 
i
=0;

573 
GtkWidg‘
 *
m’u
 = 
NULL
;

574 
¡yËb™s
 = 0;

575 
m’u_™em_Ä
 = 0;

576 
GSLi¡
 *
group
 = 
NULL
;

578 
m’u
 = 
	`gtk_m’u_Ãw
 ();

579 
	`g_sigÇl_cÚÃù
(
m’u
, "selection-done",

580 
	`G_CALLBACK
(
dŸ_fÚt_£ËùÜ_¡yËm’u_ÿÎback
), 
fs
);

582 
	`·ngo_fÚt_çmy_li¡_çûs
(
pff
, &
çûs
, &
nçûs
);

584 
i
 = 0; i < 
nçûs
; i++) {

585 
PªgoFÚtDesütiÚ
 *
pfd
 = 
	`·ngo_fÚt_çû_desüibe
(
çûs
[
i
]);

586 
PªgoStyË
 
¡yË
 = 
	`·ngo_fÚt_desütiÚ_g‘_¡yË
(
pfd
);

587 
PªgoWeight
 
weight
 = 
	`·ngo_fÚt_desütiÚ_g‘_weight
(
pfd
);

596 
weighŠr
 = (
weight
-200)/100;

597 ià(
weighŠr
 < 2) weightnr ++;

598 ià(
weighŠr
 == 2) weightnr = 0;

599 
¡yËb™s
 |ğ1 << (3*
weighŠr
 + 
¡yË
);

600 
	`·ngo_fÚt_desütiÚ_ä“
(
pfd
);

603 
	`g_ä“
(
çûs
);

605 ià(
¡yËb™s
 == 0) {

606 
	`g_w¬nšg
 ("'%s' has‚o style!",

607 
	`·ngo_fÚt_çmy_g‘_Çme
 (
pff
) ?…ango_font_family_get_name (pff) : "(null font)");

610 
i
 = 
DIA_FONT_NORMAL
; i <ğ(
DIA_FONT_HEAVY
 | 
DIA_FONT_ITALIC
); i+=4) {

611 
GtkWidg‘
 *
m’u™em
;

615 
weight
 = 
	`DIA_FONT_STYLE_GET_WEIGHT
(
i
) >> 4;

616 
¦ªt
 = 
	`DIA_FONT_STYLE_GET_SLANT
(
i
) >> 2;

617 ià(
	`DIA_FONT_STYLE_GET_SLANT
(
i
è> 
DIA_FONT_ITALIC
) ;

618 ià(!(
¡yËb™s
 & (1 << (3*
weight
 + 
¦ªt
)))) ;

619 
m’u™em
 = 
	`gtk_¿dio_m’u_™em_Ãw_w™h_Ïb–
 (
group
, 
¡yË_Ïb–s
[3*
weight
+
¦ªt
]);

620 
group
 = 
	`gtk_¿dio_m’u_™em_g‘_group
(
	`GTK_RADIO_MENU_ITEM
(
m’u™em
));

621 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
i
));

622 ià(
dŸ_¡yË
 =ğ
i
) {

623 
£Ëù
 = 
m’u_™em_Ä
;

625 
m’u_™em_Ä
++;

626 
	`gtk_m’u_­³nd
 (
	`GTK_MENU
 (
m’u
), 
m’u™em
);

627 
	`gtk_widg‘_show
 (
m’u™em
);

629 
	`gtk_widg‘_show
(
m’u
);

630 
	`gtk_İtiÚ_m’u_»move_m’u
(
fs
->
¡yË_om’u
);

631 
	`gtk_İtiÚ_m’u_£t_m’u
(
fs
->
¡yË_om’u
, 
m’u
);

632 
fs
->
¡yË_m’u
 = 
	`GTK_MENU
(
m’u
);

633 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
(
	`GTK_OPTION_MENU
(
fs
->
¡yË_om’u
), 
£Ëù
);

634 
	`gtk_m’u_£t_aùive
(
fs
->
¡yË_m’u
, 
£Ëù
);

635 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
fs
->
¡yË_om’u
), 
m’u_™em_Ä
 > 1);

636 
	`gtk_check_m’u_™em_£t_aùive
(
	`GTK_CHECK_MENU_ITEM
(
	`gtk_m’u_g‘_aùive
(
fs
->
¡yË_m’u
)), 
TRUE
);

637 
	}
}

640 
	$dŸ_fÚt_£ËùÜ_£t_¡yËs
(
DŸFÚtS–eùÜ
 *
fs
,

641 cÚ¡ 
gch¬
 *
Çme
, 
DŸFÚtStyË
 
dŸ_¡yË
)

643 
PªgoFÚtFamy
 *
pff
;

644 
pff
 = 
	`dŸ_fÚt_£ËùÜ_g‘_çmy_äom_Çme
(
	`GTK_WIDGET
(
fs
), 
Çme
);

645 
	`dŸ_fÚt_£ËùÜ_£t_¡yË_m’u
(
fs
, 
pff
, 
dŸ_¡yË
);

646 
	}
}

655 
	$dŸ_fÚt_£ËùÜ_£t_´ev›w
(
DŸFÚtS–eùÜ
 *
fs
, 
gch¬
 *
‹xt
) {

656 
	}
}

661 
	$dŸ_fÚt_£ËùÜ_£t_fÚt
(
DŸFÚtS–eùÜ
 *
fs
, 
DŸFÚt
 *
fÚt
)

663 cÚ¡ 
gch¬
 *
fÚŠame
 = 
	`dŸ_fÚt_g‘_çmy
(
fÚt
);

665 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
	`DIA_DYNAMIC_MENU
(
fs
->
fÚt_om’u
), 
fÚŠame
);

666 
	`g_sigÇl_em™
(
	`GTK_OBJECT
(
fs
),

667 
dfÚt£l_sigÇls
[
DFONTSEL_VALUE_CHANGED
], 0);

668 
	`dŸ_fÚt_£ËùÜ_£t_¡yËs
(
fs
, 
fÚŠame
, 
	`dŸ_fÚt_g‘_¡yË
 (
fÚt
));

669 
	}
}

671 
DŸFÚt
 *

672 
	$dŸ_fÚt_£ËùÜ_g‘_fÚt
(
DŸFÚtS–eùÜ
 *
fs
)

674 
GtkWidg‘
 *
m’u™em
;

675 *
fÚŠame
;

676 
DŸFÚtStyË
 
¡yË
;

677 
DŸFÚt
 *
fÚt
;

679 
fÚŠame
 = 
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
	`DIA_DYNAMIC_MENU
(
fs
->
fÚt_om’u
));

680 
m’u™em
 = 
	`gtk_m’u_g‘_aùive
(
fs
->
¡yË_m’u
);

681 ià(!
m’u™em
)

682 
¡yË
 = 0;

684 
¡yË
 = 
	`GPOINTER_TO_INT
(
	`gtk_objeù_g‘_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
)));

685 
fÚt
 = 
	`dŸ_fÚt_Ãw
(
fÚŠame
, 
¡yË
, 1.0);

686 
	`g_ä“
(
fÚŠame
);

687  
fÚt
;

688 
	}
}

691 
	s_DŸAlignm’tS–eùÜ


693 
GtkO±iÚM’u
 
	mom’u
;

695 
GtkM’u
 *
	m®ignm’t_m’u
;

698 
	s_DŸAlignm’tS–eùÜCÏss


700 
GtkO±iÚM’uCÏss
 
	m·»Á_şass
;

704 
	$dŸ_®ignm’t_£ËùÜ_şass_š™
 (
DŸAlignm’tS–eùÜCÏss
 *
şass
)

706 
GtkObjeùCÏss
 *
objeù_şass
;

708 
objeù_şass
 = (
GtkObjeùCÏss
*è
şass
;

709 
	}
}

712 
	$dŸ_®ignm’t_£ËùÜ_š™
 (
DŸAlignm’tS–eùÜ
 *
fs
)

714 
GtkWidg‘
 *
m’u
;

715 
GtkWidg‘
 *
subm’u
;

716 
GtkWidg‘
 *
m’u™em
;

717 
GSLi¡
 *
group
;

719 
m’u
 = 
	`gtk_m’u_Ãw
 ();

720 
fs
->
®ignm’t_m’u
 = 
	`GTK_MENU
(
m’u
);

721 
subm’u
 = 
NULL
;

722 
group
 = 
NULL
;

724 
m’u™em
 = 
	`gtk_¿dio_m’u_™em_Ãw_w™h_Ïb–
 (
group
, 
	`_
("Left"));

725 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
ALIGN_LEFT
));

726 
group
 = 
	`gtk_¿dio_m’u_™em_group
 (
	`GTK_RADIO_MENU_ITEM
 (
m’u™em
));

727 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u™em
);

728 
	`gtk_widg‘_show
 (
m’u™em
);

730 
m’u™em
 = 
	`gtk_¿dio_m’u_™em_Ãw_w™h_Ïb–
 (
group
, 
	`_
("Center"));

731 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
ALIGN_CENTER
));

732 
group
 = 
	`gtk_¿dio_m’u_™em_group
 (
	`GTK_RADIO_MENU_ITEM
 (
m’u™em
));

733 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u™em
);

734 
	`gtk_widg‘_show
 (
m’u™em
);

736 
m’u™em
 = 
	`gtk_¿dio_m’u_™em_Ãw_w™h_Ïb–
 (
group
, 
	`_
("Right"));

737 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
ALIGN_RIGHT
));

738 
group
 = 
	`gtk_¿dio_m’u_™em_group
 (
	`GTK_RADIO_MENU_ITEM
 (
m’u™em
));

739 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u™em
);

740 
	`gtk_widg‘_show
 (
m’u™em
);

742 
	`gtk_m’u_£t_aùive
(
	`GTK_MENU
 (
m’u
), 
DEFAULT_ALIGNMENT
);

743 
	`gtk_İtiÚ_m’u_£t_m’u
 (
	`GTK_OPTION_MENU
 (
fs
), 
m’u
);

744 
	}
}

746 
GtkTy³


747 
	$dŸ_®ignm’t_£ËùÜ_g‘_ty³
 ()

749 
GtkTy³
 
dfs_ty³
 = 0;

751 ià(!
dfs_ty³
) {

752 cÚ¡ 
GtkTy³Info
 
dfs_šfo
 = {

754  (
DŸAlignm’tS–eùÜ
),

755  (
DŸAlignm’tS–eùÜCÏss
),

756 (
GtkCÏssIn™Func
è
dŸ_®ignm’t_£ËùÜ_şass_š™
,

757 (
GtkObjeùIn™Func
è
dŸ_®ignm’t_£ËùÜ_š™
,

758 
NULL
,

759 
NULL
,

760 (
GtkCÏssIn™Func
è
NULL
,

763 
dfs_ty³
 = 
	`gtk_ty³_unique
 (
	`gtk_İtiÚ_m’u_g‘_ty³
 (), &
dfs_šfo
);

766  
dfs_ty³
;

767 
	}
}

769 
GtkWidg‘
 *

770 
	$dŸ_®ignm’t_£ËùÜ_Ãw
 ()

772  
	`GTK_WIDGET
 ( 
	`gtk_ty³_Ãw
 (
	`dŸ_®ignm’t_£ËùÜ_g‘_ty³
 ()));

773 
	}
}

776 
Alignm’t


777 
	$dŸ_®ignm’t_£ËùÜ_g‘_®ignm’t
(
DŸAlignm’tS–eùÜ
 *
fs
)

779 
GtkWidg‘
 *
m’u™em
;

780 *
®ign
;

782 
m’u™em
 = 
	`gtk_m’u_g‘_aùive
(
fs
->
®ignm’t_m’u
);

783 
®ign
 = 
	`gtk_objeù_g‘_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
));

785  
	`GPOINTER_TO_INT
(
®ign
);

786 
	}
}

789 
	$dŸ_®ignm’t_£ËùÜ_£t_®ignm’t
 (
DŸAlignm’tS–eùÜ
 *
as
,

790 
Alignm’t
 
®ign
)

792 
	`gtk_m’u_£t_aùive
(
	`GTK_MENU
 (
as
->
®ignm’t_m’u
), 
®ign
);

793 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
 (
	`GTK_OPTION_MENU
(
as
), 
®ign
);

794 
	}
}

797 
	s_DŸLšeStyËS–eùÜ


799 
GtkVBox
 
	mvbox
;

801 
GtkO±iÚM’u
 *
	mom’u
;

802 
GtkM’u
 *
	mlše¡yË_m’u
;

803 
GtkLab–
 *
	mËngthÏb–
;

804 
GtkSpšBu‰Ú
 *
	mdashËngth
;

808 
	s_DŸLšeStyËS–eùÜCÏss


810 
GtkVBoxCÏss
 
	m·»Á_şass
;

814 
	mDLS_VALUE_CHANGED
,

815 
	mDLS_LAST_SIGNAL


818 
gušt
 
	gdls_sigÇls
[
DLS_LAST_SIGNAL
] = { 0 };

821 
	$dŸ_lše_¡yË_£ËùÜ_şass_š™
 (
DŸLšeStyËS–eùÜCÏss
 *
şass
)

823 
GtkObjeùCÏss
 *
objeù_şass
;

825 
objeù_şass
 = (
GtkObjeùCÏss
*è
şass
;

827 
dls_sigÇls
[
DLS_VALUE_CHANGED
]

828 ğ
	`g_sigÇl_Ãw
("value-changed",

829 
	`G_TYPE_FROM_CLASS
(
şass
),

830 
G_SIGNAL_RUN_FIRST
,

831 0, 
NULL
, NULL,

832 
g_cşosu»_m¬sh®_VOID__VOID
,

833 
G_TYPE_NONE
, 0);

834 
	}
}

837 
	$£t_lše¡yË_£ns™iv™y
(
DŸLšeStyËS–eùÜ
 *
fs
)

839 
¡©e
;

840 
GtkWidg‘
 *
m’u™em
;

841 ià(!
fs
->
lše¡yË_m’u
) ;

842 
m’u™em
 = 
	`gtk_m’u_g‘_aùive
(
fs
->
lše¡yË_m’u
);

843 
¡©e
 = (
	`GPOINTER_TO_INT
(
	`gtk_objeù_g‘_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
)))

844 !ğ
LINESTYLE_SOLID
);

846 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
fs
->
ËngthÏb–
), 
¡©e
);

847 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
fs
->
dashËngth
), 
¡©e
);

848 
	}
}

851 
	$lše¡yË_ty³_chªge_ÿÎback
(
GtkM’u
 *
m’u
, 
gpoš‹r
 
d©a
)

853 
	`£t_lše¡yË_£ns™iv™y
(
	`DIALINESTYLESELECTOR
(
d©a
));

854 
	`g_sigÇl_em™
(
	`DIALINESTYLESELECTOR
(
d©a
),

855 
dls_sigÇls
[
DLS_VALUE_CHANGED
], 0);

856 
	}
}

859 
	$lše¡yË_dashËngth_chªge_ÿÎback
(
GtkSpšBu‰Ú
 *
sb
, 
gpoš‹r
 
d©a
)

861 
	`g_sigÇl_em™
(
	`DIALINESTYLESELECTOR
(
d©a
),

862 
dls_sigÇls
[
DLS_VALUE_CHANGED
], 0);

863 
	}
}

866 
	$dŸ_lše_¡yË_£ËùÜ_š™
 (
DŸLšeStyËS–eùÜ
 *
fs
)

868 
GtkWidg‘
 *
m’u
;

869 
GtkWidg‘
 *
subm’u
;

870 
GtkWidg‘
 *
m’u™em
, *
Ê
;

871 
GtkWidg‘
 *
Ïb–
;

872 
GtkWidg‘
 *
Ëngth
;

873 
GtkWidg‘
 *
box
;

874 
GSLi¡
 *
group
;

875 
GtkAdju¡m’t
 *
adj
;

876 
gšt
 
i
;

878 
m’u
 = 
	`gtk_İtiÚ_m’u_Ãw
();

879 
fs
->
om’u
 = 
	`GTK_OPTION_MENU
(
m’u
);

881 
m’u
 = 
	`gtk_m’u_Ãw
 ();

882 
fs
->
lše¡yË_m’u
 = 
	`GTK_MENU
(
m’u
);

883 
subm’u
 = 
NULL
;

884 
group
 = 
NULL
;

886 
i
 = 0; i <ğ
LINESTYLE_DOTTED
; i++) {

887 
m’u™em
 = 
	`gtk_m’u_™em_Ãw
();

888 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
i
));

889 
Ê
 = 
	`dŸ_lše_´ev›w_Ãw
(
i
);

890 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
m’u™em
), 
Ê
);

891 
	`gtk_widg‘_show
(
Ê
);

892 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u™em
);

893 
	`gtk_widg‘_show
(
m’u™em
);

896 
m’u™em
 = 
	`gtk_¿dio_m’u_™em_Ãw_w™h_Ïb–
 (
group
, 
	`_
("Solid"));

897 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
LINESTYLE_SOLID
));

898 
group
 = 
	`gtk_¿dio_m’u_™em_group
 (
	`GTK_RADIO_MENU_ITEM
 (
m’u™em
));

899 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u™em
);

900 
	`gtk_widg‘_show
 (
m’u™em
);

902 
m’u™em
 = 
	`gtk_¿dio_m’u_™em_Ãw_w™h_Ïb–
 (
group
, 
	`_
("Dashed"));

903 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
LINESTYLE_DASHED
));

904 
group
 = 
	`gtk_¿dio_m’u_™em_group
 (
	`GTK_RADIO_MENU_ITEM
 (
m’u™em
));

905 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u™em
);

906 
	`gtk_widg‘_show
 (
m’u™em
);

908 
m’u™em
 = 
	`gtk_¿dio_m’u_™em_Ãw_w™h_Ïb–
 (
group
, 
	`_
("Dash-Dot"));

909 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
LINESTYLE_DASH_DOT
));

910 
group
 = 
	`gtk_¿dio_m’u_™em_group
 (
	`GTK_RADIO_MENU_ITEM
 (
m’u™em
));

911 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u™em
);

912 
	`gtk_widg‘_show
 (
m’u™em
);

914 
m’u™em
 = 
	`gtk_¿dio_m’u_™em_Ãw_w™h_Ïb–
 (
group
, 
	`_
("Dash-Dot-Dot"));

915 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
LINESTYLE_DASH_DOT_DOT
));

916 
group
 = 
	`gtk_¿dio_m’u_™em_group
 (
	`GTK_RADIO_MENU_ITEM
 (
m’u™em
));

917 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u™em
);

918 
	`gtk_widg‘_show
 (
m’u™em
);

920 
m’u™em
 = 
	`gtk_¿dio_m’u_™em_Ãw_w™h_Ïb–
 (
group
, 
	`_
("Dotted"));

921 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
), 
	`GINT_TO_POINTER
(
LINESTYLE_DOTTED
));

922 
group
 = 
	`gtk_¿dio_m’u_™em_group
 (
	`GTK_RADIO_MENU_ITEM
 (
m’u™em
));

923 
	`gtk_m’u_sh–l_­³nd
 (
	`GTK_MENU_SHELL
 (
m’u
), 
m’u™em
);

924 
	`gtk_widg‘_show
 (
m’u™em
);

927 
	`gtk_m’u_£t_aùive
(
	`GTK_MENU
 (
m’u
), 
DEFAULT_LINESTYLE
);

928 
	`gtk_İtiÚ_m’u_£t_m’u
 (
	`GTK_OPTION_MENU
 (
fs
->
om’u
), 
m’u
);

929 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
m’u
), "selection-done",

930 
	`G_CALLBACK
(
lše¡yË_ty³_chªge_ÿÎback
), 
fs
);

932 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
om’u
), 
FALSE
, 
TRUE
, 0);

933 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
fs
->
om’u
));

935 
box
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

938 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Dash†ength: "));

939 
fs
->
ËngthÏb–
 = 
	`GTK_LABEL
(
Ïb–
);

940 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
box
), 
Ïb–
);

941 
	`gtk_widg‘_show
(
Ïb–
);

943 
adj
 = (
GtkAdju¡m’t
 *)
	`gtk_adju¡m’t_Ãw
(0.1, 0.00, 10.0, 0.1, 1.0, 0);

944 
Ëngth
 = 
	`gtk_¥š_bu‰Ú_Ãw
(
adj
, 
DEFAULT_LINESTYLE_DASHLEN
, 2);

945 
	`gtk_¥š_bu‰Ú_£t_w¿p
(
	`GTK_SPIN_BUTTON
(
Ëngth
), 
TRUE
);

946 
	`gtk_¥š_bu‰Ú_£t_num”ic
(
	`GTK_SPIN_BUTTON
(
Ëngth
), 
TRUE
);

947 
fs
->
dashËngth
 = 
	`GTK_SPIN_BUTTON
(
Ëngth
);

948 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
 (
box
), 
Ëngth
);

949 
	`gtk_widg‘_show
 (
Ëngth
);

951 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
Ëngth
), "changed",

952 
	`G_CALLBACK
(
lše¡yË_dashËngth_chªge_ÿÎback
), 
fs
);

954 
	`£t_lše¡yË_£ns™iv™y
(
fs
);

955 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
fs
), 
box
);

956 
	`gtk_widg‘_show
(
box
);

958 
	}
}

960 
GtkTy³


961 
	$dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 ()

963 
GtkTy³
 
dfs_ty³
 = 0;

965 ià(!
dfs_ty³
) {

966 cÚ¡ 
GtkTy³Info
 
dfs_šfo
 = {

968  (
DŸLšeStyËS–eùÜ
),

969  (
DŸLšeStyËS–eùÜCÏss
),

970 (
GtkCÏssIn™Func
è
dŸ_lše_¡yË_£ËùÜ_şass_š™
,

971 (
GtkObjeùIn™Func
è
dŸ_lše_¡yË_£ËùÜ_š™
,

972 
NULL
,

973 
NULL
,

974 (
GtkCÏssIn™Func
è
NULL
,

977 
dfs_ty³
 = 
	`gtk_ty³_unique
 (
	`gtk_vbox_g‘_ty³
 (), &
dfs_šfo
);

980  
dfs_ty³
;

981 
	}
}

983 
GtkWidg‘
 *

984 
	$dŸ_lše_¡yË_£ËùÜ_Ãw
 ()

986  
	`GTK_WIDGET
 ( 
	`gtk_ty³_Ãw
 (
	`dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 ()));

987 
	}
}

991 
	$dŸ_lše_¡yË_£ËùÜ_g‘_lše¡yË
(
DŸLšeStyËS–eùÜ
 *
fs
,

992 
LšeStyË
 *
ls
, 
»®
 *
dl
)

994 
GtkWidg‘
 *
m’u™em
;

995 *
®ign
;

997 
m’u™em
 = 
	`gtk_m’u_g‘_aùive
(
fs
->
lše¡yË_m’u
);

998 
®ign
 = 
	`gtk_objeù_g‘_u£r_d©a
(
	`GTK_OBJECT
(
m’u™em
));

999 *
ls
 = 
	`GPOINTER_TO_INT
(
®ign
);

1000 ià(
dl
!=
NULL
) {

1001 *
dl
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
fs
->
dashËngth
);

1003 
	}
}

1006 
	$dŸ_lše_¡yË_£ËùÜ_£t_lše¡yË
 (
DŸLšeStyËS–eùÜ
 *
as
,

1007 
LšeStyË
 
lše¡yË
, 
»®
 
dashËngth
)

1009 
	`gtk_m’u_£t_aùive
(
	`GTK_MENU
 (
as
->
lše¡yË_m’u
), 
lše¡yË
);

1010 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
 (
	`GTK_OPTION_MENU
(
as
->
om’u
), 
lše¡yË
);

1013 
	`£t_lše¡yË_£ns™iv™y
(
	`DIALINESTYLESELECTOR
(
as
));

1014 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
as
->
dashËngth
), dashlength);

1015 
	}
}

1021 
GtkWidg‘
 *

1022 
	$dŸ_cŞÜ_£ËùÜ_ü—‹_¡ršg_™em
(
DŸDyÇmicM’u
 *
ddm
, 
gch¬
 *
¡ršg
)

1024 
GtkWidg‘
 *
™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
¡ršg
);

1025 
gšt
 
r
, 
g
, 
b
;

1026 
	`ssÿnf
(
¡ršg
, "#%2x%2x%2x", &
r
, &
g
, &
b
);

1030 ià(
r
*299+
g
*587+
b
*114 > 500 * 256) {

1031 
gch¬
 *
Ïb–
 = 
	`g_¡rdup_´štf
("<¥ª fÜeground=\"bÏck\" background=\"%s\">%s</¥ª>", 
¡ršg
, string);

1032 
	`gtk_Ïb–_£t_m¬kup
(
	`GTK_LABEL
(
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
™em
))), 
Ïb–
);

1033 
	`g_ä“
(
Ïb–
);

1035 
gch¬
 *
Ïb–
 = 
	`g_¡rdup_´štf
("<¥ª fÜeground=\"wh™e\" background=\"%s\">%s</¥ª>", 
¡ršg
, string);

1036 
	`gtk_Ïb–_£t_m¬kup
(
	`GTK_LABEL
(
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
™em
))), 
Ïb–
);

1037 
	`g_ä“
(
Ïb–
);

1040  
™em
;

1041 
	}
}

1044 
	$dŸ_cŞÜ_£ËùÜ_mÜe_ok
(
GtkWidg‘
 *
ok
, 
gpoš‹r
 
u£rd©a
)

1046 
DŸDyÇmicM’u
 *
ddm
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
u£rd©a
), "ddm");

1047 
GtkWidg‘
 *
cŞÜ£l
 = 
	`GTK_WIDGET
(
u£rd©a
);

1048 
GdkCŞÜ
 
gcŞ
;

1049 
gch¬
 *
’Œy
;

1051 
	`gtk_cŞÜ_£ËùiÚ_g‘_cu¼’t_cŞÜ
(

1052 
	`GTK_COLOR_SELECTION
(

1053 
	`GTK_COLOR_SELECTION_DIALOG
(
cŞÜ£l
)->colorsel),

1054 &
gcŞ
);

1056 
’Œy
 = 
	`g_¡rdup_´štf
("#%02X%02X%02X", 
gcŞ
.
»d
/256, gcŞ.
g»’
/256, gcŞ.
blue
/256);

1057 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
ddm
, 
’Œy
);

1058 
	`g_ä“
(
’Œy
);

1060 
	`gtk_widg‘_de¡roy
(
cŞÜ£l
);

1061 
	}
}

1064 
	$dŸ_cŞÜ_£ËùÜ_mÜe_ÿÎback
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
u£rd©a
)

1066 
GtkCŞÜS–eùiÚDŸlog
 *
dŸlog
 = 
	`GTK_COLOR_SELECTION_DIALOG
 (
	`gtk_cŞÜ_£ËùiÚ_dŸlog_Ãw
(
	`_
("Select color")));

1067 
DŸDyÇmicM’u
 *
ddm
 = 
	`DIA_DYNAMIC_MENU
(
u£rd©a
);

1068 
GtkCŞÜS–eùiÚ
 *
cŞÜ£l
 = 
	`GTK_COLOR_SELECTION
(
dŸlog
->colorsel);

1069 
GSŒšg
 *
·Ë‰e
 = 
	`g_¡ršg_Ãw
 ("");

1071 
gch¬
 *
Şd_cŞÜ
 = 
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
ddm
);

1073 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
ddm
, 
Şd_cŞÜ
);

1075 ià(
ddm
->
deçuÉ_’Œ›s
 !ğ
NULL
) {

1076 
GLi¡
 *
tm¶i¡
;

1077 
šdex
 = 0;

1078 
gboŞ—n
 
advªû
 = 
TRUE
;

1080 
tm¶i¡
 = 
ddm
->
deçuÉ_’Œ›s
;

1081 
tm¶i¡
 !ğ
NULL
 || 
advªû
;

1082 
tm¶i¡
 = 
	`g_li¡_Ãxt
(tmplist)) {

1083 cÚ¡ 
gch¬
* 
¥ec
;

1084 
GdkCŞÜ
 
cŞÜ
;

1087 ià(!
tm¶i¡
 && 
advªû
) {

1088 
advªû
 = 
FALSE
;

1089 
tm¶i¡
 = 
	`³rsi¡’t_li¡_g‘_gli¡
(
ddm
->
³rsi¡’t_Çme
);

1090 ià(!
tm¶i¡
)

1093 
¥ec
 = (
gch¬
 *)
tm¶i¡
->
d©a
;

1095 
	`gdk_cŞÜ_·r£
 (
¥ec
, &
cŞÜ
);

1098 
	`gtk_cŞÜ_£ËùiÚ_£t_·Ë‰e_cŞÜ
 (
cŞÜ£l
, 
šdex
, &
cŞÜ
);

1100 
	`g_¡ršg_­³nd
 (
·Ë‰e
, 
¥ec
);

1101 
	`g_¡ršg_­³nd
 (
·Ë‰e
, ":");

1103 ià(0 =ğ
	`¡rcmp
 (
¥ec
, 
Şd_cŞÜ
)) {

1104 
	`gtk_cŞÜ_£ËùiÚ_£t_´evious_cŞÜ
 (
cŞÜ£l
, &
cŞÜ
);

1105 
	`gtk_cŞÜ_£ËùiÚ_£t_cu¼’t_cŞÜ
 (
cŞÜ£l
, &
cŞÜ
);

1107 
šdex
++;

1111 
	`g_objeù_£t
 (
	`gtk_widg‘_g‘_£‰šgs
 (
	`GTK_WIDGET
 (
cŞÜ£l
)), "gtk-cŞÜ-·Ë‰e", 
·Ë‰e
->
¡r
, 
NULL
);

1112 
	`gtk_cŞÜ_£ËùiÚ_£t_has_·Ë‰e
 (
cŞÜ£l
, 
TRUE
);

1113 
	`g_¡ršg_ä“
 (
·Ë‰e
, 
TRUE
);

1114 
	`g_ä“
(
Şd_cŞÜ
);

1116 
	`gtk_widg‘_hide
(
dŸlog
->
h–p_bu‰Ú
);

1118 
	`gtk_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
dŸlog
->
ok_bu‰Ú
), "clicked",

1119 (
GtkSigÇlFunc
è
dŸ_cŞÜ_£ËùÜ_mÜe_ok
,

1120 
dŸlog
);

1121 
	`gtk_sigÇl_cÚÃù_objeù
(
	`GTK_OBJECT
 (
dŸlog
->
ÿnûl_bu‰Ú
), "clicked",

1122 (
GtkSigÇlFunc
è
gtk_widg‘_de¡roy
,

1123 
	`GTK_OBJECT
(
dŸlog
));

1124 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
dŸlog
), "ddm", 
ddm
);

1126 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
dŸlog
));

1127 
	}
}

1129 
GtkWidg‘
 *

1130 
	$dŸ_cŞÜ_£ËùÜ_Ãw
 ()

1132 
GtkWidg‘
 *
Ùh”™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
	`_
("More colors..."));

1133 
GtkWidg‘
 *
ddm
 = 
	`dŸ_dyÇmic_m’u_Ãw
(
dŸ_cŞÜ_£ËùÜ_ü—‹_¡ršg_™em
,

1134 
NULL
,

1135 
	`GTK_MENU_ITEM
(
Ùh”™em
),

1137 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1139 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1141 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1143 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1145 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
ddm
),

1147 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
Ùh”™em
), "activate",

1148 
	`G_CALLBACK
(
dŸ_cŞÜ_£ËùÜ_mÜe_ÿÎback
), 
ddm
);

1149 
	`gtk_widg‘_show
(
Ùh”™em
);

1150  
ddm
;

1151 
	}
}

1155 
	$dŸ_cŞÜ_£ËùÜ_g‘_cŞÜ
(
GtkWidg‘
 *
widg‘
, 
CŞÜ
 *
cŞÜ
)

1157 
gch¬
 *
’Œy
 = 
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
	`DIA_DYNAMIC_MENU
(
widg‘
));

1158 
gšt
 
r
, 
g
, 
b
;

1160 
	`ssÿnf
(
’Œy
, "#%2x%2x%2x", &
r
, &
g
, &
b
);

1161 
	`g_ä“
(
’Œy
);

1162 
cŞÜ
->
»d
 = 
r
 / 255.0;

1163 
cŞÜ
->
g»’
 = 
g
 / 255.0;

1164 
cŞÜ
->
blue
 = 
b
 / 255.0;

1165 
	}
}

1168 
	$dŸ_cŞÜ_£ËùÜ_£t_cŞÜ
 (
GtkWidg‘
 *
widg‘
,

1169 cÚ¡ 
CŞÜ
 *
cŞÜ
)

1171 
gšt
 
»d
, 
g»’
, 
blue
;

1172 
gch¬
 *
’Œy
;

1173 
»d
 = 
cŞÜ
->red * 255;

1174 
g»’
 = 
cŞÜ
->green * 255;

1175 
blue
 = 
cŞÜ
->blue * 255;

1176 ià(
cŞÜ
->
»d
 > 1.0 || cŞÜ->
g»’
 > 1.0 || cŞÜ->
blue
 > 1.0) {

1177 
	`´štf
("Color out of„ange:„ %f, g %f, b %f\n",

1178 
cŞÜ
->
»d
, cŞÜ->
g»’
, cŞÜ->
blue
);

1179 
»d
 = 
	`MIN
(red, 255);

1180 
g»’
 = 
	`MIN
(green, 255);

1181 
blue
 = 
	`MIN
(blue, 255);

1183 
’Œy
 = 
	`g_¡rdup_´štf
("#%02X%02X%02X", 
»d
, 
g»’
, 
blue
);

1184 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
	`DIA_DYNAMIC_MENU
(
widg‘
), 
’Œy
);

1185 
	`g_ä“
 (
’Œy
);

1186 
	}
}

1192 
	s_DŸA¼owS–eùÜ


1194 
GtkVBox
 
	mvbox
;

1196 
GtkHBox
 *
	msizebox
;

1197 
GtkLab–
 *
	msiz–ab–
;

1198 
DŸSizeS–eùÜ
 *
	msize
;

1200 
GtkO±iÚM’u
 *
	mom’u
;

1203 
	s_DŸA¼owS–eùÜCÏss


1205 
GtkVBoxCÏss
 
	m·»Á_şass
;

1209 
	mDAS_VALUE_CHANGED
,

1210 
	mDAS_LAST_SIGNAL


1213 
gušt
 
	gdas_sigÇls
[
DAS_LAST_SIGNAL
] = {0};

1216 
	$dŸ_¬row_£ËùÜ_şass_š™
 (
DŸA¼owS–eùÜCÏss
 *
şass
)

1218 
das_sigÇls
[
DAS_VALUE_CHANGED
]

1219 ğ
	`g_sigÇl_Ãw
("value_changed",

1220 
	`G_TYPE_FROM_CLASS
(
şass
),

1221 
G_SIGNAL_RUN_FIRST
,

1222 0, 
NULL
, NULL,

1223 
g_cşosu»_m¬sh®_VOID__VOID
,

1224 
G_TYPE_NONE
, 0);

1225 
	}
}

1228 
	$£t_size_£ns™iv™y
(
DŸA¼owS–eùÜ
 *
as
)

1230 
¡©e
;

1231 
gch¬
 *
’ŒyÇme
 = 
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
	`DIA_DYNAMIC_MENU
(
as
->
om’u
));

1233 
¡©e
 = (
’ŒyÇme
 !ğ
NULL
è&& (0 !ğ
	`g_ascii_¡rÿ£cmp
(entryname, "None"));

1234 
	`g_ä“
(
’ŒyÇme
);

1236 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
as
->
siz–ab–
), 
¡©e
);

1237 
	`gtk_widg‘_£t_£ns™ive
(
	`GTK_WIDGET
(
as
->
size
), 
¡©e
);

1238 
	}
}

1241 
	$¬row_ty³_chªge_ÿÎback
(
DŸDyÇmicM’u
 *
ddm
, 
gpoš‹r
 
u£rd©a
)

1243 
	`£t_size_£ns™iv™y
(
	`DIA_ARROW_SELECTOR
(
u£rd©a
));

1244 
	`g_sigÇl_em™
(
	`DIA_ARROW_SELECTOR
(
u£rd©a
),

1245 
das_sigÇls
[
DAS_VALUE_CHANGED
], 0);

1246 
	}
}

1249 
	$¬row_size_chªge_ÿÎback
(
DŸSizeS–eùÜ
 *
size
, 
gpoš‹r
 
u£rd©a
)

1251 
	`g_sigÇl_em™
(
	`DIA_ARROW_SELECTOR
(
u£rd©a
),

1252 
das_sigÇls
[
DAS_VALUE_CHANGED
], 0);

1253 
	}
}

1255 
GtkWidg‘
 *

1256 
	$ü—‹_¬row_m’u_™em
(
DŸDyÇmicM’u
 *
ddm
, 
gch¬
 *
Çme
)

1258 
A¼owTy³
 
©y³
 = 
	`¬row_ty³_äom_Çme
(
Çme
);

1259 
GtkWidg‘
 *
™em
 = 
	`gtk_m’u_™em_Ãw
();

1260 
GtkWidg‘
 *
´ev›w
 = 
	`dŸ_¬row_´ev›w_Ãw
(
©y³
, 
FALSE
);

1262 
	`gtk_widg‘_show
(
´ev›w
);

1263 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
™em
), 
´ev›w
);

1264 
	`gtk_widg‘_show
(
™em
);

1265  
™em
;

1266 
	}
}

1269 
	$dŸ_¬row_£ËùÜ_š™
 (
DŸA¼owS–eùÜ
 *
as
,

1270 
gpoš‹r
 
g_şass
)

1272 
GtkWidg‘
 *
om’u
;

1273 
GtkWidg‘
 *
box
;

1274 
GtkWidg‘
 *
Ïb–
;

1275 
GtkWidg‘
 *
size
;

1277 
GLi¡
 *
¬row_Çmes
 = 
	`g‘_¬row_Çmes
();

1278 
om’u
 = 
	`dŸ_dyÇmic_m’u_Ãw_li¡ba£d
(
ü—‹_¬row_m’u_™em
,

1279 
as
,

1280 
	`_
("More‡rrows"),

1281 
¬row_Çmes
,

1283 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
om’u
), "None");

1284 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
om’u
), "Lines");

1285 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
	`DIA_DYNAMIC_MENU
(
om’u
), "Filled Concave");

1286 
as
->
om’u
 = 
	`GTK_OPTION_MENU
(omenu);

1287 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
as
), 
om’u
, 
FALSE
, 
TRUE
, 0);

1288 
	`gtk_widg‘_show
(
om’u
);

1290 
	`g_sigÇl_cÚÃù
(
	`DIA_DYNAMIC_MENU
(
om’u
),

1291 "v®ue-chªged", 
	`G_CALLBACK
(
¬row_ty³_chªge_ÿÎback
),

1292 
as
);

1294 
box
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

1295 
as
->
sizebox
 = 
	`GTK_HBOX
(
box
);

1297 
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`_
("Size: "));

1298 
as
->
siz–ab–
 = 
	`GTK_LABEL
(
Ïb–
);

1299 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
box
), 
Ïb–
);

1300 
	`gtk_widg‘_show
(
Ïb–
);

1302 
size
 = 
	`dŸ_size_£ËùÜ_Ãw
(0.0, 0.0);

1303 
as
->
size
 = 
	`DIA_SIZE_SELECTOR
(size);

1304 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
box
), 
size
);

1305 
	`gtk_widg‘_show
(
size
);

1306 
	`g_sigÇl_cÚÃù
(
size
, "value-changed",

1307 
	`G_CALLBACK
(
¬row_size_chªge_ÿÎback
), 
as
);

1309 
	`£t_size_£ns™iv™y
(
as
);

1310 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
as
), 
box
);

1312 
	`gtk_widg‘_show
(
box
);

1313 
	}
}

1315 
GTy³


1316 
	$dŸ_¬row_£ËùÜ_g‘_ty³
 ()

1318 
GTy³
 
dfs_ty³
 = 0;

1320 ià(!
dfs_ty³
) {

1321 cÚ¡ 
GTy³Info
 
dfs_šfo
 = {

1323  (
DŸA¼owS–eùÜCÏss
),

1324 (
GBa£In™Func
è
NULL
,

1325 (
GBa£Fš®izeFunc
è
NULL
,

1326 (
GCÏssIn™Func
è
dŸ_¬row_£ËùÜ_şass_š™
,

1327 
NULL
,

1328 
NULL
,

1329  (
DŸA¼owS–eùÜ
),

1331 (
GIn¡ªûIn™Func
)
dŸ_¬row_£ËùÜ_š™
,

1340 
dfs_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
 (
GTK_TYPE_VBOX
,

1342 &
dfs_šfo
, 0);

1345  
dfs_ty³
;

1346 
	}
}

1348 
GtkWidg‘
 *

1349 
	$dŸ_¬row_£ËùÜ_Ãw
 ()

1351  
	`GTK_WIDGET
 ( 
	`g_objeù_Ãw
 (
DIA_TYPE_ARROW_SELECTOR
, 
NULL
));

1352 
	}
}

1355 
A¼ow


1356 
	$dŸ_¬row_£ËùÜ_g‘_¬row
(
DŸA¼owS–eùÜ
 *
as
)

1358 
A¼ow
 
©
;

1359 
gch¬
 *
¬rowÇme
 = 
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
	`DIA_DYNAMIC_MENU
(
as
->
om’u
));

1361 
©
.
ty³
 = 
	`¬row_ty³_äom_Çme
(
¬rowÇme
);

1362 
	`g_ä“
(
¬rowÇme
);

1363 
	`dŸ_size_£ËùÜ_g‘_size
(
as
->
size
, &
©
.
width
, &©.
Ëngth
);

1364  
©
;

1365 
	}
}

1368 
	$dŸ_¬row_£ËùÜ_£t_¬row
 (
DŸA¼owS–eùÜ
 *
as
,

1369 
A¼ow
 
¬row
)

1371 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
	`DIA_DYNAMIC_MENU
(
as
->
om’u
),

1372 
	`¬row_g‘_Çme_äom_ty³
(
¬row
.
ty³
));

1373 
	`£t_size_£ns™iv™y
(
as
);

1374 
	`dŸ_size_£ËùÜ_£t_size
(
	`DIA_SIZE_SELECTOR
(
as
->
size
), 
¬row
.
width
,‡¼ow.
Ëngth
);

1375 
	}
}

1378 
	s_DŸFeS–eùÜ


1380 
GtkHBox
 
	mhbox
;

1381 
GtkEÁry
 *
	m’Œy
;

1382 
GtkBu‰Ú
 *
	mbrow£
;

1383 
GtkWidg‘
 *
	mdŸlog
;

1384 
gch¬
 *
	msys_f’ame
;

1387 
	s_DŸFeS–eùÜCÏss


1389 
GtkHBoxCÏss
 
	m·»Á_şass
;

1393 
	mDFILE_VALUE_CHANGED
,

1394 
	mDFILE_LAST_SIGNAL


1397 
gušt
 
	gdfe_sigÇls
[
DFILE_LAST_SIGNAL
] = { 0 };

1400 
	$dŸ_fe_£ËùÜ_uÄ—lize
(
GtkWidg‘
 *
widg‘
)

1402 
DŸFeS–eùÜ
 *
fs
 = 
	`DIAFILESELECTOR
(
widg‘
);

1404 ià(
fs
->
dŸlog
 !ğ
NULL
) {

1405 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
fs
->
dŸlog
));

1406 
fs
->
dŸlog
 = 
NULL
;

1408 ià(
fs
->
sys_f’ame
) {

1409 
	`g_ä“
(
fs
->
sys_f’ame
);

1410 
fs
->
sys_f’ame
 = 
NULL
;

1413 (* 
	`GTK_WIDGET_CLASS
 (
	`gtk_ty³_şass
(
	`gtk_hbox_g‘_ty³
 ()))->
uÄ—lize
è(
widg‘
);

1414 
	}
}

1417 
	$dŸ_fe_£ËùÜ_şass_š™
 (
DŸFeS–eùÜCÏss
 *
şass
)

1419 
GtkObjeùCÏss
 *
objeù_şass
;

1420 
GtkWidg‘CÏss
 *
widg‘_şass
;

1422 
objeù_şass
 = (
GtkObjeùCÏss
*è
şass
;

1423 
widg‘_şass
 = (
GtkWidg‘CÏss
*è
şass
;

1424 
widg‘_şass
->
uÄ—lize
 = 
dŸ_fe_£ËùÜ_uÄ—lize
;

1426 
dfe_sigÇls
[
DFILE_VALUE_CHANGED
]

1427 ğ
	`g_sigÇl_Ãw
("value-changed",

1428 
	`G_TYPE_FROM_CLASS
(
şass
),

1429 
G_SIGNAL_RUN_FIRST
,

1430 0, 
NULL
, NULL,

1431 
g_cşosu»_m¬sh®_VOID__VOID
,

1432 
G_TYPE_NONE
, 0);

1433 
	}
}

1436 
	$dŸ_fe_£ËùÜ_’Œy_chªged
(
GtkEd™abË
 *
ed™abË


1437 , 
gpoš‹r
 
d©a
)

1439 
DŸFeS–eùÜ
 *
fs
 = 
	`DIAFILESELECTOR
(
d©a
);

1440 
	`g_sigÇl_em™
(
fs
, 
dfe_sigÇls
[
DFILE_VALUE_CHANGED
], 0);

1441 
	}
}

1444 
	$fe_İ’_»¥Ú£_ÿÎback
(
GtkWidg‘
 *
dŸlog
,

1445 
gšt
 
»¥Ú£
,

1446 
gpoš‹r
 
u£r_d©a
)

1448 
DŸFeS–eùÜ
 *
fs
 =

1449 
	`DIAFILESELECTOR
(
	`gtk_objeù_g‘_u£r_d©a
(
	`GTK_OBJECT
(
dŸlog
)));

1451 ià(
»¥Ú£
 =ğ
GTK_RESPONSE_ACCEPT
 ||„e¥Ú£ =ğ
GTK_RESPONSE_OK
) {

1452 
gch¬
 *
utf8
 = 
	`g_f’ame_to_utf8
(
	`gtk_fe_choo£r_g‘_f’ame
(
	`GTK_FILE_CHOOSER
(
dŸlog
)),

1453 -1, 
NULL
, NULL, NULL);

1454 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
fs
->
’Œy
), 
utf8
);

1455 
	`g_ä“
(
utf8
);

1457 
	`gtk_widg‘_de¡roy
(
	`GTK_WIDGET
(
dŸlog
));

1458 
	}
}

1461 
	$dŸ_fe_£ËùÜ_brow£_´es£d
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

1463 
GtkWidg‘
 *
dŸlog
;

1464 
DŸFeS–eùÜ
 *
fs
 = 
	`DIAFILESELECTOR
(
d©a
);

1465 
gch¬
 *
f’ame
;

1466 
GtkWidg‘
 *
tİËv–
 = 
	`gtk_widg‘_g‘_tİËv–
 (
widg‘
);

1468 ià(!
	`GTK_WIDGET_TOPLEVEL
(
tİËv–
è|| !
	`GTK_WINDOW
(toplevel))

1469 
tİËv–
 = 
NULL
;

1471 ià(
fs
->
dŸlog
 =ğ
NULL
) {

1472 
GtkFeF‹r
 *
f‹r
;

1474 
dŸlog
 = 
fs
->dialog =

1475 
	`gtk_fe_choo£r_dŸlog_Ãw
 (
	`_
("S–eù imagfe"), 
tİËv–
 ? 
	`GTK_WINDOW
ÑİËv–è: 
NULL
,

1476 
GTK_FILE_CHOOSER_ACTION_OPEN
,

1477 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

1478 
GTK_STOCK_OPEN
, 
GTK_RESPONSE_ACCEPT
,

1479 
NULL
);

1480 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
	`GTK_DIALOG
(
dŸlog
), 
GTK_RESPONSE_ACCEPT
);

1481 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
dŸlog
), "response",

1482 
	`G_CALLBACK
(
fe_İ’_»¥Ú£_ÿÎback
), 
NULL
);

1483 
	`gtk_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
fs
->
dŸlog
), "destroy",

1484 
	`GTK_SIGNAL_FUNC
 (
gtk_widg‘_de¡royed
),

1485 &
fs
->
dŸlog
);

1487 
f‹r
 = 
	`gtk_fe_f‹r_Ãw
 ();

1488 
	`gtk_fe_f‹r_£t_Çme
 (
f‹r
, 
	`_
("Supported Formats"));

1489 
	`gtk_fe_f‹r_add_pixbuf_fÜm©s
 (
f‹r
);

1490 
	`gtk_fe_choo£r_add_f‹r
 (
	`GTK_FILE_CHOOSER
 (
dŸlog
), 
f‹r
);

1492 
f‹r
 = 
	`gtk_fe_f‹r_Ãw
 ();

1493 
	`gtk_fe_f‹r_£t_Çme
 (
f‹r
, 
	`_
("All Files"));

1494 
	`gtk_fe_f‹r_add_·‰”n
 (
f‹r
, "*");

1495 
	`gtk_fe_choo£r_add_f‹r
 (
	`GTK_FILE_CHOOSER
 (
dŸlog
), 
f‹r
);

1497 
	`gtk_objeù_£t_u£r_d©a
(
	`GTK_OBJECT
(
dŸlog
), 
fs
);

1500 
f’ame
 = 
	`g_f’ame_äom_utf8
(
	`gtk_’Œy_g‘_‹xt
(
fs
->
’Œy
), -1, 
NULL
, NULL, NULL);

1502 ià(
	`g_·th_is_absŞu‹
(
f’ame
))

1503 
	`gtk_fe_choo£r_£t_f’ame
(
	`GTK_FILE_CHOOSER
(
fs
->
dŸlog
), 
f’ame
);

1505 
	`g_ä“
(
f’ame
);

1507 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
fs
->
dŸlog
));

1508 
	}
}

1511 
	$dŸ_fe_£ËùÜ_š™
 (
DŸFeS–eùÜ
 *
fs
)

1514 
fs
->
dŸlog
 = 
NULL
;

1515 
fs
->
sys_f’ame
 = 
NULL
;

1517 
fs
->
’Œy
 = 
	`GTK_ENTRY
(
	`gtk_’Œy_Ãw
());

1518 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
’Œy
), 
FALSE
, 
TRUE
, 0);

1519 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
fs
->
’Œy
), "changed",

1520 
	`G_CALLBACK
(
dŸ_fe_£ËùÜ_’Œy_chªged
), 
fs
);

1521 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
fs
->
’Œy
));

1523 
fs
->
brow£
 = 
	`GTK_BUTTON
(
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
	`_
("Browse")));

1524 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
fs
), 
	`GTK_WIDGET
(fs->
brow£
), 
FALSE
, 
TRUE
, 0);

1525 
	`gtk_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
fs
->
brow£
), "clicked",

1526 (
GtkSigÇlFunc
è
dŸ_fe_£ËùÜ_brow£_´es£d
,

1527 
fs
);

1528 
	`gtk_widg‘_show
(
	`GTK_WIDGET
(
fs
->
brow£
));

1529 
	}
}

1532 
GtkTy³


1533 
	$dŸ_fe_£ËùÜ_g‘_ty³
 ()

1535 
GtkTy³
 
dfs_ty³
 = 0;

1537 ià(!
dfs_ty³
) {

1538 cÚ¡ 
GtkTy³Info
 
dfs_šfo
 = {

1540  (
DŸFeS–eùÜ
),

1541  (
DŸFeS–eùÜCÏss
),

1542 (
GtkCÏssIn™Func
è
dŸ_fe_£ËùÜ_şass_š™
,

1543 (
GtkObjeùIn™Func
è
dŸ_fe_£ËùÜ_š™
,

1544 
NULL
,

1545 
NULL
,

1546 (
GtkCÏssIn™Func
è
NULL
,

1549 
dfs_ty³
 = 
	`gtk_ty³_unique
 (
	`gtk_hbox_g‘_ty³
 (), &
dfs_šfo
);

1553  
dfs_ty³
;

1554 
	}
}

1556 
GtkWidg‘
 *

1557 
	$dŸ_fe_£ËùÜ_Ãw
 ()

1559  
	`GTK_WIDGET
 ( 
	`gtk_ty³_Ãw
 (
	`dŸ_fe_£ËùÜ_g‘_ty³
 ()));

1560 
	}
}

1563 
	$dŸ_fe_£ËùÜ_£t_fe
(
DŸFeS–eùÜ
 *
fs
, 
gch¬
 *
fe
)

1566 
gch¬
 *
utf8
 = 
	`g_f’ame_to_utf8
(
fe
, -1, 
NULL
, NULL, NULL);

1567 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
fs
->
’Œy
), 
utf8
);

1568 
	`g_ä“
(
utf8
);

1569 
	}
}

1571 cÚ¡ 
gch¬
 *

1572 
	$dŸ_fe_£ËùÜ_g‘_fe
(
DŸFeS–eùÜ
 *
fs
)

1575 
	`g_ä“
(
fs
->
sys_f’ame
);

1576 
fs
->
sys_f’ame
 = 
	`g_f’ame_äom_utf8
(
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(fs->
’Œy
)),

1577 -1, 
NULL
, NULL, NULL);

1578  
fs
->
sys_f’ame
;

1579 
	}
}

1589 
dŸ_un™_¥šÃr_š™
(
DŸUn™SpšÃr
 *
£lf
);

1591 
GTy³


1592 
	$dŸ_un™_¥šÃr_g‘_ty³
()

1594 
GTy³
 
us_ty³
 = 0;

1596 ià(!
us_ty³
) {

1597 cÚ¡ 
GTy³Info
 
us_šfo
 = {

1598 (
DŸUn™SpšÃrCÏss
),

1599 
NULL
,

1600 
NULL
,

1601 
NULL
,

1602 
NULL
,

1603 
NULL
,

1604 (
DŸUn™SpšÃr
),

1606 (
GIn¡ªûIn™Func
è
dŸ_un™_¥šÃr_š™
,

1608 
us_ty³
 = 
	`g_ty³_»gi¡”_¡©ic
(
GTK_TYPE_SPIN_BUTTON
,

1610 &
us_šfo
, 0);

1612  
us_ty³
;

1613 
	}
}

1617 
	$dŸ_un™_¥šÃr_š™
(
DŸUn™SpšÃr
 *
£lf
)

1619 
£lf
->
un™_num
 = 
DIA_UNIT_CENTIMETER
;

1620 
	}
}

1627 
gboŞ—n


1628 
dŸ_un™_¥šÃr_šput
(
DŸUn™SpšÃr
 *
£lf
, 
gdoubË
 *
v®ue
);

1629 
gboŞ—n
 
dŸ_un™_¥šÃr_ouut
(
DŸUn™SpšÃr
 *
£lf
);

1631 
GtkWidg‘
 *

1632 
	$dŸ_un™_¥šÃr_Ãw
(
GtkAdju¡m’t
 *
adju¡m’t
, 
DŸUn™
 
adj_un™
)

1634 
DŸUn™SpšÃr
 *
£lf
;

1636 ià(
adju¡m’t
) {

1637 
	`g_»tuº_v®_if_ç
 (
	`GTK_IS_ADJUSTMENT
 (
adju¡m’t
), 
NULL
);

1640 
£lf
 = 
	`gtk_ty³_Ãw
(
	`dŸ_un™_¥šÃr_g‘_ty³
());

1641 
£lf
->
un™_num
 = 
adj_un™
;

1643 
	`gtk_¥š_bu‰Ú_cÚfigu»
(
	`GTK_SPIN_BUTTON
(
£lf
),

1644 
adju¡m’t
, 0.0, 
un™s
[
adj_un™
].
dig™s
);

1646 
	`g_sigÇl_cÚÃù
(
	`GTK_SPIN_BUTTON
(
£lf
), "output",

1647 
	`G_CALLBACK
(
dŸ_un™_¥šÃr_ouut
),

1648 
NULL
);

1649 
	`g_sigÇl_cÚÃù
(
	`GTK_SPIN_BUTTON
(
£lf
), "input",

1650 
	`G_CALLBACK
(
dŸ_un™_¥šÃr_šput
),

1651 
NULL
);

1653  
	`GTK_WIDGET
(
£lf
);

1654 
	}
}

1656 
gboŞ—n


1657 
	$dŸ_un™_¥šÃr_šput
(
DŸUn™SpšÃr
 *
£lf
, 
gdoubË
 *
v®ue
)

1659 
gæßt
 
v®
, 
çùÜ
 = 1.0;

1660 
gch¬
 *
exŒa
 = 
NULL
;

1662 
v®
 = 
	`g_¡¹od
(
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
£lf
)), &
exŒa
);

1665 *
exŒa
 && 
	`g_ascii_is¥aû
(*extra))ƒxtra++;

1666 ià(*
exŒa
) {

1667 
i
;

1669 
i
 = 0; 
un™s
[i].
Çme
 !ğ
NULL
; i++)

1670 ià(!
	`g_ascii_¡rÿ£cmp
(
un™s
[
i
].
un™
, 
exŒa
)) {

1671 
çùÜ
 = 
un™s
[
i
].çùÜ / un™s[
£lf
->
un™_num
].factor;

1676 
v®
 *ğ
çùÜ
;

1679 *
v®ue
 = 
v®
;

1682  
TRUE
;

1683 
	}
}

1685 
gboŞ—n
 
	$dŸ_un™_¥šÃr_ouut
(
DŸUn™SpšÃr
 *
£lf
)

1687 
buf
[256];

1689 
GtkSpšBu‰Ú
 *
sbu‰Ú
 = 
	`GTK_SPIN_BUTTON
(
£lf
);

1690 
GtkAdju¡m’t
 *
adju¡m’t
 = 
	`gtk_¥š_bu‰Ú_g‘_adju¡m’t
(
sbu‰Ú
);

1692 
	`g_¢´štf
(
buf
, (buf), "%0.*f %s",

1693 
	`gtk_¥š_bu‰Ú_g‘_dig™s
(
sbu‰Ú
),

1694 
	`gtk_adju¡m’t_g‘_v®ue
(
adju¡m’t
),

1695 
un™s
[
£lf
->
un™_num
].
un™
);

1696 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
£lf
), 
buf
);

1699  
TRUE
;

1700 
	}
}

1705 
	$dŸ_un™_¥šÃr_£t_v®ue
(
DŸUn™SpšÃr
 *
£lf
, 
gdoubË
 
v®
)

1707 
GtkSpšBu‰Ú
 *
sbu‰Ú
 = 
	`GTK_SPIN_BUTTON
(
£lf
);

1709 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
sbu‰Ú
,

1710 
v®
 /

1711 (
un™s
[
£lf
->
un™_num
].
çùÜ
 /

1712 
un™s
[
DIA_UNIT_CENTIMETER
].
çùÜ
));

1713 
	}
}

1716 
gdoubË


1717 
	$dŸ_un™_¥šÃr_g‘_v®ue
(
DŸUn™SpšÃr
 *
£lf
)

1719 
GtkSpšBu‰Ú
 *
sbu‰Ú
 = 
	`GTK_SPIN_BUTTON
(
£lf
);

1721  
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
sbu‰Ú
) *

1722 (
un™s
[
£lf
->
un™_num
].
çùÜ
 / un™s[
DIA_UNIT_CENTIMETER
].factor);

1723 
	}
}

1729 
	$dŸ_un™_¥šÃr_£t_uµ”
 (
DŸUn™SpšÃr
 *
£lf
, 
gdoubË
 
v®
)

1731 
v®
 /ğ(
un™s
[
£lf
->
un™_num
].
çùÜ
 / un™s[
DIA_UNIT_CENTIMETER
].factor);

1733 
	`gtk_adju¡m’t_£t_uµ”
 (

1734 
	`gtk_¥š_bu‰Ú_g‘_adju¡m’t
(
	`GTK_SPIN_BUTTON
(
£lf
)), 
v®
);

1735 
	}
}

1736 
GLi¡
 *

1737 
	$g‘_un™s_Çme_li¡
()

1739 
i
;

1740 
GLi¡
 *
Çme_li¡
 = 
NULL
;

1742 ià(
Çme_li¡
 =ğ
NULL
) {

1743 
i
 = 0; 
un™s
[i].
Çme
 !ğ
NULL
; i++) {

1744 
Çme_li¡
 = 
	`g_li¡_­³nd
Òame_li¡, 
un™s
[
i
].
Çme
);

1748  
Çme_li¡
;

1749 
	}
}

1753 
dŸ_dyÇmic_m’u_şass_š™
(
DŸDyÇmicM’uCÏss
 *
şass
);

1754 
dŸ_dyÇmic_m’u_š™
(
DŸDyÇmicM’u
 *
£lf
);

1755 
dŸ_dyÇmic_m’u_ü—‹_subli¡
(
DŸDyÇmicM’u
 *
ddm
,

1756 
GLi¡
 *
™ems
,

1757 
DDMC»©eI‹mFunc
 
ü—‹
);

1758 
dŸ_dyÇmic_m’u_ü—‹_m’u
(
DŸDyÇmicM’u
 *
ddm
);

1759 
dŸ_dyÇmic_m’u_de¡roy
(
GtkObjeù
 *
objeù
);

1762 
	mDDM_VALUE_CHANGED
,

1763 
	mDDM_LAST_SIGNAL


1766 
gušt
 
	gddm_sigÇls
[
DDM_LAST_SIGNAL
] = { 0 };

1768 
GtkTy³


1769 
	$dŸ_dyÇmic_m’u_g‘_ty³
()

1771 
GtkTy³
 
us_ty³
 = 0;

1773 ià(!
us_ty³
) {

1774 cÚ¡ 
GtkTy³Info
 
us_šfo
 = {

1776 (
DŸDyÇmicM’u
),

1777 (
DŸDyÇmicM’uCÏss
),

1778 (
GtkCÏssIn™Func
è
dŸ_dyÇmic_m’u_şass_š™
,

1779 (
GtkObjeùIn™Func
è
dŸ_dyÇmic_m’u_š™
,

1780 
NULL
,

1781 
NULL
,

1782 (
GtkCÏssIn™Func
è
NULL
,

1784 
us_ty³
 = 
	`gtk_ty³_unique
(
	`gtk_İtiÚ_m’u_g‘_ty³
(), &
us_šfo
);

1786  
us_ty³
;

1787 
	}
}

1790 
	$dŸ_dyÇmic_m’u_şass_š™
(
DŸDyÇmicM’uCÏss
 *
şass
)

1792 
GtkObjeùCÏss
 *
objeù_şass
 = (GtkObjeùCÏss*)
şass
;

1794 
objeù_şass
->
de¡roy
 = 
dŸ_dyÇmic_m’u_de¡roy
;

1796 
ddm_sigÇls
[
DDM_VALUE_CHANGED
]

1797 ğ
	`g_sigÇl_Ãw
("value-changed",

1798 
	`G_TYPE_FROM_CLASS
(
şass
),

1799 
G_SIGNAL_RUN_FIRST
,

1800 0, 
NULL
, NULL,

1801 
g_cşosu»_m¬sh®_VOID__VOID
,

1802 
G_TYPE_NONE
, 0);

1803 
	}
}

1806 
	$dŸ_dyÇmic_m’u_š™
(
DŸDyÇmicM’u
 *
£lf
)

1808 
	}
}

1811 
	$dŸ_dyÇmic_m’u_de¡roy
(
GtkObjeù
 *
objeù
)

1813 
DŸDyÇmicM’u
 *
ddm
 = 
	`DIA_DYNAMIC_MENU
(
objeù
);

1814 
GtkObjeùCÏss
 *
·»Á_şass
 = 
	`GTK_OBJECT_CLASS
(
	`g_ty³_şass_³ek_·»Á
(
	`GTK_OBJECT_GET_CLASS
(
objeù
)));

1816 ià(
ddm
->
aùive
)

1817 
	`g_ä“
(
ddm
->
aùive
);

1818 
ddm
->
aùive
 = 
NULL
;

1820 ià(
·»Á_şass
->
de¡roy
)

1821 (* 
·»Á_şass
->
de¡roy
è(
objeù
);

1822 
	}
}

1833 
GtkWidg‘
 *

1834 
	$dŸ_dyÇmic_m’u_Ãw
(
DDMC»©eI‹mFunc
 
ü—‹
,

1835 
gpoš‹r
 
u£rd©a
,

1836 
GtkM’uI‹m
 *
Ùh”™em
, 
gch¬
 *
³rsi¡
)

1838 
DŸDyÇmicM’u
 *
ddm
;

1840 
	`g_as£¹
(
³rsi¡
 !ğ
NULL
);

1842 
ddm
 = 
	`DIA_DYNAMIC_MENU
 ( 
	`gtk_ty³_Ãw
 (
	`dŸ_dyÇmic_m’u_g‘_ty³
 ()));

1844 
ddm
->
ü—‹_func
 = 
ü—‹
;

1845 
ddm
->
u£rd©a
 = userdata;

1846 
ddm
->
Ùh”_™em
 = 
Ùh”™em
;

1847 
ddm
->
³rsi¡’t_Çme
 = 
³rsi¡
;

1848 
ddm
->
cŞs
 = 1;

1850 
	`³rsi¡’û_»gi¡”_li¡
(
³rsi¡
);

1852 
	`dŸ_dyÇmic_m’u_ü—‹_m’u
(
ddm
);

1854  
	`GTK_WIDGET
(
ddm
);

1855 
	}
}

1859 
	$dŸ_dyÇmic_m’u_£Ëù_’Œy
(
DŸDyÇmicM’u
 *
ddm
, cÚ¡ 
gch¬
 *
Çme
)

1861 
gšt
 
add_»suÉ
 = 
	`dŸ_dyÇmic_m’u_add_’Œy
(
ddm
, 
Çme
);

1862 ià(
add_»suÉ
 == 0) {

1863 
GLi¡
 *
tmp
;

1864 
i
 = 0;

1865 
tmp
 = 
ddm
->
deçuÉ_’Œ›s
;m°!ğ
NULL
;

1866 
tmp
 = 
	`g_li¡_Ãxt
Ñmp), 
i
++) {

1867 ià(!
	`g_ascii_¡rÿ£cmp
(
tmp
->
d©a
, 
Çme
))

1868 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
(
	`GTK_OPTION_MENU
(
ddm
), 
i
);

1872 ià(
ddm
->
deçuÉ_’Œ›s
 !ğ
NULL
)

1873 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
(
	`GTK_OPTION_MENU
(
ddm
),

1874 
	`g_li¡_Ëngth
(
ddm
->
deçuÉ_’Œ›s
)+1);

1876 
	`gtk_İtiÚ_m’u_£t_hi¡Üy
(
	`GTK_OPTION_MENU
(
ddm
), 0);

1879 
	`g_ä“
(
ddm
->
aùive
);

1880 
ddm
->
aùive
 = 
	`g_¡rdup
(
Çme
);

1881 
	`g_sigÇl_em™
(
	`GTK_OBJECT
(
ddm
), 
ddm_sigÇls
[
DDM_VALUE_CHANGED
], 0);

1882 
	}
}

1885 
	$dŸ_dyÇmic_m’u_aùiv©e
(
GtkWidg‘
 *
™em
, 
gpoš‹r
 
u£rd©a
)

1887 
DŸDyÇmicM’u
 *
ddm
 = 
	`DIA_DYNAMIC_MENU
(
u£rd©a
);

1888 
gch¬
 *
Çme
 = 
	`g_objeù_g‘_d©a
(
	`G_OBJECT
(
™em
), "ddm_name");

1889 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
ddm
, 
Çme
);

1890 
	}
}

1892 
GtkWidg‘
 *

1893 
	$dŸ_dyÇmic_m’u_ü—‹_¡ršg_™em
(
DŸDyÇmicM’u
 *
ddm
, 
gch¬
 *
¡ršg
)

1895 
GtkWidg‘
 *
™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
	`g‘‹xt
(
¡ršg
));

1896  
™em
;

1897 
	}
}

1902 
GtkWidg‘
 *

1903 
	$dŸ_dyÇmic_m’u_Ãw_¡ršgba£d
(
GtkM’uI‹m
 *
Ùh”™em
,

1904 
gpoš‹r
 
u£rd©a
,

1905 
gch¬
 *
³rsi¡
)

1907 
GtkWidg‘
 *
ddm
 = 
	`dŸ_dyÇmic_m’u_Ãw
(
dŸ_dyÇmic_m’u_ü—‹_¡ršg_™em
,

1908 
u£rd©a
,

1909 
Ùh”™em
, 
³rsi¡
);

1910  
ddm
;

1911 
	}
}

1917 
GtkWidg‘
 *

1918 
	$dŸ_dyÇmic_m’u_Ãw_li¡ba£d
(
DDMC»©eI‹mFunc
 
ü—‹
,

1919 
gpoš‹r
 
u£rd©a
,

1920 
gch¬
 *
Ùh”_Ïb–
, 
GLi¡
 *
™ems
,

1921 
gch¬
 *
³rsi¡
)

1923 
GtkWidg‘
 *
™em
 = 
	`gtk_m’u_™em_Ãw_w™h_Ïb–
(
Ùh”_Ïb–
);

1924 
GtkWidg‘
 *
ddm
 = 
	`dŸ_dyÇmic_m’u_Ãw
(
ü—‹
, 
u£rd©a
,

1925 
	`GTK_MENU_ITEM
(
™em
), 
³rsi¡
);

1928 
	`gtk_widg‘_show
(
™em
);

1929  
ddm
;

1930 
	}
}

1935 
GtkWidg‘
 *

1936 
	$dŸ_dyÇmic_m’u_Ãw_¡ršgli¡ba£d
(
gch¬
 *
Ùh”_Ïb–
,

1937 
GLi¡
 *
™ems
,

1938 
gpoš‹r
 
u£rd©a
,

1939 
gch¬
 *
³rsi¡
)

1941  
	`dŸ_dyÇmic_m’u_Ãw_li¡ba£d
(
dŸ_dyÇmic_m’u_ü—‹_¡ršg_™em
,

1942 
u£rd©a
,

1943 
Ùh”_Ïb–
, 
™ems
, 
³rsi¡
);

1944 
	}
}

1947 
	$dŸ_dyÇmic_m’u_ü—‹_subli¡
(
DŸDyÇmicM’u
 *
ddm
,

1948 
GLi¡
 *
™ems
, 
DDMC»©eI‹mFunc
 
ü—‹
)

1950 
GtkWidg‘
 *
™em
 = 
	`GTK_WIDGET
(
ddm
->
Ùh”_™em
);

1952 
GtkWidg‘
 *
subm’u
 = 
	`gtk_m’u_Ãw
();

1954 ; 
™ems
 !ğ
NULL
; i‹m ğ
	`g_li¡_Ãxt
(items)) {

1955 
GtkWidg‘
 *
subm’u™em
 = (
ü—‹
)(
ddm
, 
™ems
->
d©a
);

1957 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
subm’u
), 
subm’u™em
);

1958 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
subm’u™em
), "ddm_Çme", 
™ems
->
d©a
);

1959 
	`g_sigÇl_cÚÃù
(
subm’u™em
, "activate",

1960 
	`G_CALLBACK
(
dŸ_dyÇmic_m’u_aùiv©e
), 
ddm
);

1961 
	`gtk_widg‘_show
(
subm’u™em
);

1964 
	`gtk_m’u_™em_£t_subm’u
(
	`GTK_MENU_ITEM
(
™em
), 
subm’u
);

1965 
	`gtk_widg‘_show
(
subm’u
);

1966 
	}
}

1978 
	$dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
DŸDyÇmicM’u
 *
ddm
, cÚ¡ 
gch¬
 *
’Œy
)

1980 
ddm
->
deçuÉ_’Œ›s
 = 
	`g_li¡_­³nd
(ddm->default_entries,

1981 
	`g_¡rdup
(
’Œy
));

1983 
	`dŸ_dyÇmic_m’u_ü—‹_m’u
(
ddm
);

1984 
	}
}

1990 
	$dŸ_dyÇmic_m’u_£t_cŞumns
(
DŸDyÇmicM’u
 *
ddm
, 
gšt
 
cŞs
)

1992 
ddm
->
cŞs
 = cols;

1994 
	`dŸ_dyÇmic_m’u_ü—‹_m’u
(
ddm
);

1995 
	}
}

2007 
gšt


2008 
	$dŸ_dyÇmic_m’u_add_’Œy
(
DŸDyÇmicM’u
 *
ddm
, cÚ¡ 
gch¬
 *
’Œy
)

2010 
GLi¡
 *
tmp
;

2011 
gboŞ—n
 
exi¡ed
;

2013 
tmp
 = 
ddm
->
deçuÉ_’Œ›s
;m°!ğ
NULL
;m°ğ
	`g_li¡_Ãxt
(tmp)) {

2014 ià(!
	`g_ascii_¡rÿ£cmp
(
tmp
->
d©a
, 
’Œy
))

2017 
exi¡ed
 = 
	`³rsi¡’t_li¡_add
(
ddm
->
³rsi¡’t_Çme
, 
’Œy
);

2019 
	`dŸ_dyÇmic_m’u_ü—‹_m’u
(
ddm
);

2021  
exi¡ed
?1:2;

2022 
	}
}

2027 
gch¬
 *

2028 
	$dŸ_dyÇmic_m’u_g‘_’Œy
(
DŸDyÇmicM’u
 *
ddm
)

2030  
	`g_¡rdup
(
ddm
->
aùive
);

2031 
	}
}

2037 
	$dŸ_dyÇmic_m’u_ü—‹_m’u
(
DŸDyÇmicM’u
 *
ddm
)

2039 
GtkWidg‘
 *
£p
;

2040 
GLi¡
 *
tm¶i¡
;

2041 
GtkWidg‘
 *
m’u
;

2042 
GtkWidg‘
 *
™em
;

2044 
	`g_objeù_»f
(
	`G_OBJECT
(
ddm
->
Ùh”_™em
));

2045 
m’u
 = 
	`gtk_İtiÚ_m’u_g‘_m’u
(
	`GTK_OPTION_MENU
(
ddm
));

2046 ià(
m’u
 !ğ
NULL
) {

2047 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
m’u
), 
	`GTK_WIDGET
(
ddm
->
Ùh”_™em
));

2048 
	`gtk_cÚš”_fÜ—ch
(
	`GTK_CONTAINER
(
m’u
),

2049 (
GtkC®lback
)
gtk_widg‘_de¡roy
, 
NULL
);

2050 
	`gtk_İtiÚ_m’u_»move_m’u
(
	`GTK_OPTION_MENU
(
ddm
));

2053 
m’u
 = 
	`gtk_m’u_Ãw
();

2055 ià(
ddm
->
deçuÉ_’Œ›s
 !ğ
NULL
) {

2056 
tm¶i¡
 = 
ddm
->
deçuÉ_’Œ›s
;m¶i¡ !ğ
NULL
;m¶i¡ = 
	`g_li¡_Ãxt
(tmplist)) {

2057 
GtkWidg‘
 *
™em
 = (
ddm
->
ü—‹_func
)(ddm, 
tm¶i¡
->
d©a
);

2058 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
™em
), "ddm_Çme", 
tm¶i¡
->
d©a
);

2059 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
™em
), "aùiv©e",
	`G_CALLBACK
(
dŸ_dyÇmic_m’u_aùiv©e
), 
ddm
);

2060 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
™em
);

2061 
	`gtk_widg‘_show
(
™em
);

2068 
tm¶i¡
 = 
	`³rsi¡’t_li¡_g‘_gli¡
(
ddm
->
³rsi¡’t_Çme
);

2069 
tm¶i¡
 !ğ
NULL
;m¶i¡ = 
	`g_li¡_Ãxt
(tmplist)) {

2070 
GtkWidg‘
 *
™em
 = (
ddm
->
ü—‹_func
)(ddm, 
tm¶i¡
->
d©a
);

2071 
	`g_objeù_£t_d©a
(
	`G_OBJECT
(
™em
), "ddm_Çme", 
tm¶i¡
->
d©a
);

2072 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
™em
), "activate",

2073 
	`G_CALLBACK
(
dŸ_dyÇmic_m’u_aùiv©e
), 
ddm
);

2074 
	`gtk_m’u_sh–l_­³nd
(
	`GTK_MENU_SHELL
(
m’u
), 
™em
);

2075 
	`gtk_widg‘_show
(
™em
);

2092 
	`gtk_İtiÚ_m’u_£t_m’u
(
	`GTK_OPTION_MENU
(
ddm
), 
m’u
);

2095 
	}
}

2102 
	$dŸ_dyÇmic_m’u_£t_sÜtšg_m‘hod
(
DŸDyÇmicM’u
 *
ddm
, 
DdmSÜtTy³
 
sÜt
)

2104 
	}
}

2109 
	$dŸ_dyÇmic_m’u_»£t
(
GtkWidg‘
 *
™em
, 
gpoš‹r
 
u£rd©a
)

2111 
DŸDyÇmicM’u
 *
ddm
 = 
	`DIA_DYNAMIC_MENU
(
u£rd©a
);

2112 
P”si¡’tLi¡
 *
¶i¡
 = 
	`³rsi¡’t_li¡_g‘
(
ddm
->
³rsi¡’t_Çme
);

2113 
gch¬
 *
aùive
 = 
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
ddm
);

2114 
	`g_li¡_fÜ—ch
(
¶i¡
->
gli¡
, (
GFunc
)
g_ä“
, 
NULL
);

2115 
	`g_li¡_ä“
(
¶i¡
->
gli¡
);

2116 
¶i¡
->
gli¡
 = 
NULL
;

2117 
	`dŸ_dyÇmic_m’u_ü—‹_m’u
(
ddm
);

2118 ià(
aùive
)

2119 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
ddm
, 
aùive
);

2120 
	`g_ä“
(
aùive
);

2121 
	}
}

2127 
	$dŸ_dyÇmic_m’u_£t_max_’Œ›s
(
DŸDyÇmicM’u
 *
ddm
, 
gšt
 
max
)

2129 
	}
}

2133 
	simage_·œ
 { 
GtkWidg‘
 *
	mÚ
; GtkWidg‘ *
	moff
; };

2136 
	$dŸ_toggË_bu‰Ú_sw­_images
(
GtkToggËBu‰Ú
 *
widg‘
,

2137 
gpoš‹r
 
d©a
)

2139 
image_·œ
 *
images
 = (image_·œ *)
d©a
;

2140 ià(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
widg‘
)) {

2141 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
widg‘
),

2142 
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
widg‘
)));

2143 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
widg‘
),

2144 
images
->
Ú
);

2147 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
widg‘
),

2148 
	`gtk_bš_g‘_chd
(
	`GTK_BIN
(
widg‘
)));

2149 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
widg‘
),

2150 
images
->
off
);

2152 
	}
}

2155 
	$dŸ_toggË_bu‰Ú_de¡roy
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
d©a
)

2157 
image_·œ
 *
images
 = (image_·œ *)
d©a
;

2159 ià(
images
->
Ú
)

2160 
	`g_objeù_uÄef
(
images
->
Ú
);

2161 
images
->
Ú
 = 
NULL
;

2162 ià(
images
->
off
)

2163 
	`g_objeù_uÄef
(
images
->
off
);

2164 
images
->
off
 = 
NULL
;

2165 ià(
images
)

2166 
	`g_ä“
(
images
);

2167 
images
 = 
NULL
;

2168 
	}
}

2171 
GtkWidg‘
 *

2172 
	$dŸ_toggË_bu‰Ú_Ãw
(
GtkWidg‘
 *
Ú_widg‘
, GtkWidg‘ *
off_widg‘
)

2174 
GtkWidg‘
 *
bu‰Ú
 = 
	`gtk_toggË_bu‰Ú_Ãw
();

2175 
GtkRcStyË
 *
rc¡yË
;

2176 
GV®ue
 *
´İ
;

2177 
gšt
 
i
;

2178 
image_·œ
 *
images
;

2180 
images
 = 
	`g_Ãw
(
image_·œ
, 1);

2183 
images
->
Ú
 = 
Ú_widg‘
;

2184 
	`g_objeù_»f
(
	`G_OBJECT
(
images
->
Ú
));

2185 
	`gtk_objeù_sšk
(
	`GTK_OBJECT
(
images
->
Ú
));

2186 
	`gtk_widg‘_show
(
images
->
Ú
);

2188 
images
->
off
 = 
off_widg‘
;

2189 
	`g_objeù_»f
(
	`G_OBJECT
(
images
->
off
));

2190 
	`gtk_objeù_sšk
(
	`GTK_OBJECT
(
images
->
off
));

2191 
	`gtk_widg‘_show
(
images
->
off
);

2194 
	`gtk_misc_£t_·ddšg
(
	`GTK_MISC
(
images
->
Ú
), 0, 0);

2195 
	`gtk_misc_£t_·ddšg
(
	`GTK_MISC
(
images
->
off
), 0, 0);

2196 
	`GTK_WIDGET_UNSET_FLAGS
(
	`GTK_WIDGET
(
bu‰Ú
), 
GTK_CAN_FOCUS
);

2197 
	`GTK_WIDGET_UNSET_FLAGS
(
	`GTK_WIDGET
(
bu‰Ú
), 
GTK_CAN_DEFAULT
);

2199 
rc¡yË
 = 
	`gtk_rc_¡yË_Ãw
 ();

2200 
rc¡yË
->
xthickÃss
 =„c¡yË->
ythickÃss
 = 0;

2201 
	`gtk_widg‘_modify_¡yË
 (
bu‰Ú
, 
rc¡yË
);

2202 
	`gtk_rc_¡yË_uÄef
 (
rc¡yË
);

2204 
´İ
 = 
	`g_Ãw0
(
GV®ue
, 1);

2205 
	`g_v®ue_š™
(
´İ
, 
G_TYPE_INT
);

2206 
	`gtk_widg‘_¡yË_g‘_´İ”ty
(
	`GTK_WIDGET
(
bu‰Ú
), "focus-·ddšg", 
´İ
);

2207 
i
 = 
	`g_v®ue_g‘_št
(
´İ
);

2208 
	`g_v®ue_£t_št
(
´İ
, 0);

2209 
	`g_ä“
(
´İ
);

2211 
	`gtk_bu‰Ú_£t_»l›f
(
	`GTK_BUTTON
(
bu‰Ú
), 
GTK_RELIEF_NONE
);

2213 
	`gtk_cÚš”_£t_bÜd”_width
(
	`GTK_CONTAINER
(
bu‰Ú
), 0);

2215 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
bu‰Ú
), 
images
->
off
);

2217 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
bu‰Ú
), "toggled",

2218 
	`G_CALLBACK
(
dŸ_toggË_bu‰Ú_sw­_images
), 
images
);

2219 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
bu‰Ú
), "destroy",

2220 
	`G_CALLBACK
(
dŸ_toggË_bu‰Ú_de¡roy
), 
images
);

2222  
bu‰Ú
;

2223 
	}
}

2228 
GtkWidg‘
 *

2229 
	$dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs
(cÚ¡ 
gušt8
 *
Ú_icÚ
,

2230 cÚ¡ 
gušt8
 *
off_icÚ
)

2232 
GdkPixbuf
 *
p1
, *
p2
;

2234 
p1
 = 
	`gdk_pixbuf_Ãw_äom_šlše
(-1, 
Ú_icÚ
, 
FALSE
, 
NULL
);

2235 
p2
 = 
	`gdk_pixbuf_Ãw_äom_šlše
(-1, 
off_icÚ
, 
FALSE
, 
NULL
);

2237  
	`dŸ_toggË_bu‰Ú_Ãw
(
	`gtk_image_Ãw_äom_pixbuf
(
p1
),

2238 
	`gtk_image_Ãw_äom_pixbuf
(
p2
));

2239 
	}
}

2241 
GtkWidg‘
* 
	$çùÜy_ü—‹_bu‰Ú_w™h_icÚs
(cÚ¡ 
gušt8
 *
icÚ
)

2243 
GtkWidg‘
 *
sy¡emd©a_bŠ
 = 
	`gtk_bu‰Ú_Ãw
();

2244 
GdkPixbuf
 *
p1
 = 
	`gdk_pixbuf_Ãw_äom_šlše
(-1, 
icÚ
, 
FALSE
, 
NULL
);

2245 
	`gtk_bu‰Ú_£t_image
(
	`GTK_BUTTON
(
sy¡emd©a_bŠ
),
	`gtk_image_Ãw_äom_pixbuf
(
p1
));

2246  
sy¡emd©a_bŠ
;

2247 
	}
}

	@O:\tool\dvs50\lib\widgets.h

18 #iâdeà
WIDGETS_H


19 
	#WIDGETS_H


	)

21 
	~<cÚfig.h
>

23 
	~<gdk/gdk.h
>

24 
	~<gtk/gtkm’u.h
>

25 
	~<gtk/gtkİtiÚm’u.h
>

26 
	~<gtk/gtkd¿wšg¬—.h
>

27 
	~<gtk/gtkcŞÜ£l.h
>

28 
	~<gtk/gtkhbox.h
>

29 
	~<gtk/gtkfe£l.h
>

30 
	~<gtk/gtk¥šbu‰Ú.h
>

31 
	~<gtk/gtkÏb–.h
>

32 
	~<gtk/gtkcŞÜ£ldŸlog.h
>

33 
	~<gtk/gtkm’u™em.h
>

35 
	~"dŸty³s.h
"

36 
	~"fÚt.h
"

37 
	~"cŞÜ.h
"

38 
	~"¬rows.h
"

39 
	~"un™s.h
"

42 
	#DIAFONTSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_fÚt_£ËùÜ_g‘_ty³
 (), 
DŸFÚtS–eùÜ
)

	)

43 
	#DIAFONTSELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_fÚt_£ËùÜ_g‘_ty³
 (), 
DŸFÚtS–eùÜCÏss
)

	)

44 
	#IS_DIAFONTSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_fÚt_£ËùÜ_g‘_ty³
 ())

	)

47 
DIAVAR
 
GTy³
 
dŸ_fÚt_£ËùÜ_g‘_ty³
 ();

48 
DIAVAR
 
GtkWidg‘
* 
dŸ_fÚt_£ËùÜ_Ãw
 ();

49 
DIAVAR
 
dŸ_fÚt_£ËùÜ_£t_fÚt
 (
DŸFÚtS–eùÜ
 *
fs
, 
DŸFÚt
 *
fÚt
);

50 
dŸ_fÚt_£ËùÜ_£t_´ev›w
 (
DŸFÚtS–eùÜ
 *
fs
, 
gch¬
 *
‹xt
);

51 
DIAVAR
 
DŸFÚt
 * 
dŸ_fÚt_£ËùÜ_g‘_fÚt
 (
DŸFÚtS–eùÜ
 *
fs
);

54 
	#DIAALIGNMENTSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_®ignm’t_£ËùÜ_g‘_ty³
 (), 
DŸAlignm’tS–eùÜ
)

	)

55 
	#DIAALIGNMENTSELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_®ignm’t_£ËùÜ_g‘_ty³
 (), 
DŸAlignm’tS–eùÜCÏss
)

	)

56 
	#IS_DIAALIGNMENTSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_®ignm’t_£ËùÜ_g‘_ty³
 ())

	)

59 
DIAVAR
 
GTy³
 
dŸ_®ignm’t_£ËùÜ_g‘_ty³
 ();

60 
DIAVAR
 
GtkWidg‘
* 
dŸ_®ignm’t_£ËùÜ_Ãw
 ();

61 
DIAVAR
 
Alignm’t
 
dŸ_®ignm’t_£ËùÜ_g‘_®ignm’t
 (
DŸAlignm’tS–eùÜ
 *
as
);

62 
DIAVAR
 
dŸ_®ignm’t_£ËùÜ_£t_®ignm’t
 (
DŸAlignm’tS–eùÜ
 *
as
,

63 
Alignm’t
 
®ign
);

66 
	#DIALINESTYLESELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 (), 
DŸLšeStyËS–eùÜ
)

	)

67 
	#DIALINESTYLESELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 (), 
DŸLšeStyËS–eùÜCÏss
)

	)

68 
	#IS_DIALINESTYLESELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 ())

	)

70 
	#DEFAULT_LINESTYLE
 
LINESTYLE_SOLID


	)

71 
	#DEFAULT_LINESTYLE_DASHLEN
 1.0

	)

74 
DIAVAR
 
GTy³
 
dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 ();

75 
DIAVAR
 
GtkWidg‘
* 
dŸ_lše_¡yË_£ËùÜ_Ãw
 ();

76 
DIAVAR
 
dŸ_lše_¡yË_£ËùÜ_g‘_lše¡yË
 (
DŸLšeStyËS–eùÜ
 *
as
,

77 
LšeStyË
 *
lše¡yË
,

78 
»®
 *
dashËngth
);

79 
DIAVAR
 
dŸ_lše_¡yË_£ËùÜ_£t_lše¡yË
 (
DŸLšeStyËS–eùÜ
 *
as
,

80 
LšeStyË
 
lše¡yË
,

81 
»®
 
dashËngth
);

84 
	#DIACOLORSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_cŞÜ_£ËùÜ_g‘_ty³
 (), 
DŸCŞÜS–eùÜ
)

	)

85 
	#DIACOLORSELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_cŞÜ_£ËùÜ_g‘_ty³
 (), 
DŸCŞÜS–eùÜCÏss
)

	)

86 
	#IS_DIACOLORSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_cŞÜ_£ËùÜ_g‘_ty³
 ())

	)

88 
	#DEFAULT_FG_COLOR
 
cŞÜ_bÏck


	)

89 
	#DEFAULT_BG_COLOR
 
cŞÜ_wh™e


	)

90 
	#DEFAULT_COLOR
 
cŞÜ_wh™e


	)

94 
DIAVAR
 
GTy³
 
dŸ_cŞÜ_£ËùÜ_g‘_ty³
 ();

95 
DIAVAR
 
GtkWidg‘
* 
dŸ_cŞÜ_£ËùÜ_Ãw
 ();

96 
DIAVAR
 
dŸ_cŞÜ_£ËùÜ_g‘_cŞÜ
 (
GtkWidg‘
 *
cs
, 
CŞÜ
 *
cŞÜ
);

97 
DIAVAR
 
dŸ_cŞÜ_£ËùÜ_£t_cŞÜ
 (
GtkWidg‘
 *
cs
,

98 cÚ¡ 
CŞÜ
 *
cŞÜ
);

102 
	#DIA_TYPE_ARROW_SELECTOR
 (
	`dŸ_¬row_£ËùÜ_g‘_ty³
())

	)

103 
	#DIA_ARROW_SELECTOR
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_¬row_£ËùÜ_g‘_ty³
 (), 
DŸA¼owS–eùÜ
))

	)

104 
	#DIA_ARROW_SELECTOR_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_¬row_£ËùÜ_g‘_ty³
 (), 
DŸA¼owS–eùÜCÏss
))

	)

105 
	#DIA_IS_ARROW_SELECTOR
(
obj
è(
	`G_TYPE_CHECK_TYPE
 (obj, 
	`dŸ_¬row_£ËùÜ_g‘_ty³
 ()))

	)

106 
	#DIA_ARROW_SELECTOR_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_ARROW_SELECTOR
, 
DŸA¼owS–eùÜCÏss
))

	)

108 
	#DEFAULT_ARROW
 
ARROW_NONE


	)

109 
	#DEFAULT_ARROW_LENGTH
 
DEFAULT_ARROW_SIZE


	)

110 
	#DEFAULT_ARROW_WIDTH
 
DEFAULT_ARROW_SIZE


	)

113 
DIAVAR
 
GTy³
 
dŸ_¬row_£ËùÜ_g‘_ty³
 ();

114 
DIAVAR
 
GtkWidg‘
* 
dŸ_¬row_£ËùÜ_Ãw
 ();

115 
DIAVAR
 
A¼ow
 
dŸ_¬row_£ËùÜ_g‘_¬row
 (
DŸA¼owS–eùÜ
 *
as
);

116 
DIAVAR
 
dŸ_¬row_£ËùÜ_£t_¬row
 (
DŸA¼owS–eùÜ
 *
as
,

117 
A¼ow
 
¬row
);

121 
	#DIAFILESELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_fe_£ËùÜ_g‘_ty³
 (), 
DŸFeS–eùÜ
)

	)

122 
	#DIAFILESELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_fe_£ËùÜ_g‘_ty³
 (), 
DŸFeS–eùÜCÏss
)

	)

123 
	#IS_DIAFILESELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_fe_£ËùÜ_g‘_ty³
 ())

	)

126 
DIAVAR
 
GTy³
 
dŸ_fe_£ËùÜ_g‘_ty³
 ();

127 
DIAVAR
 
GtkWidg‘
* 
dŸ_fe_£ËùÜ_Ãw
 ();

128 
DIAVAR
 
dŸ_fe_£ËùÜ_£t_fe
 (
DŸFeS–eùÜ
 *
fs
, *
fe
);

129 
DIAVAR
 cÚ¡ 
gch¬
 *
dŸ_fe_£ËùÜ_g‘_fe
 (
DŸFeS–eùÜ
 *
fs
);

132 
	#DIA_SIZE_SELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_size_£ËùÜ_g‘_ty³
 (), 
DŸSizeS–eùÜ
)

	)

133 
	#DIA_SIZE_SELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_size_£ËùÜ_g‘_ty³
 (), 
DŸSizeS–eùÜCÏss
)

	)

134 
	#IS_DIA_SIZE_SELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_size_£ËùÜ_g‘_ty³
 ())

	)

137 
DIAVAR
 
GTy³
 
dŸ_size_£ËùÜ_g‘_ty³
 ();

138 
DIAVAR
 
GtkWidg‘
* 
dŸ_size_£ËùÜ_Ãw
 (
»®
 
width
,„—È
height
);

139 
DIAVAR
 
dŸ_size_£ËùÜ_£t_locked
(
DŸSizeS–eùÜ
 *
ss
, 
gboŞ—n
 
locked
);

140 
DIAVAR
 
dŸ_size_£ËùÜ_£t_size
 (
DŸSizeS–eùÜ
 *
ss
, 
»®
 
width
,„—È
height
);

141 
DIAVAR
 
gboŞ—n
 
dŸ_size_£ËùÜ_g‘_size
 (
DŸSizeS–eùÜ
 *
ss
, 
»®
 *
width
,„—È*
height
);

145 
	#DIA_UNIT_SPINNER
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
(obj, 
	`dŸ_un™_¥šÃr_g‘_ty³
(), 
DŸUn™SpšÃr
)

	)

146 
	#DIA_UNIT_SPINNER_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
(kÏss, 
	`dŸ_un™_¥šÃr_g‘_ty³
(), 
DŸUn™SpšÃrCÏss
)

	)

147 
	#DIA_IS_UNIT_SPINNER
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
(obj, 
	`dŸ_un™_¥šÃr_g‘_ty³
())

	)

149 
_DŸUn™SpšÃr
 
	tDŸUn™SpšÃr
;

150 
_DŸUn™SpšÃrCÏss
 
	tDŸUn™SpšÃrCÏss
;

152 
	s_DŸUn™SpšÃr
 {

153 
GtkSpšBu‰Ú
 
	m·»Á
;

155 
DŸUn™
 
	mun™_num
;

158 
	s_DŸUn™SpšÃrCÏss
 {

159 
GtkSpšBu‰ÚCÏss
 
	m·»Á_şass
;

163 
DIAVAR
 
GTy³
 
dŸ_un™_¥šÃr_g‘_ty³
 ();

164 
DIAVAR
 
GtkWidg‘
 *
dŸ_un™_¥šÃr_Ãw
 (
GtkAdju¡m’t
 *
adju¡m’t
,

165 
DŸUn™
 
adj_un™
);

166 
DIAVAR
 
dŸ_un™_¥šÃr_£t_v®ue
 (
DŸUn™SpšÃr
 *
£lf
, 
gdoubË
 
v®
);

167 
DIAVAR
 
gdoubË
 
dŸ_un™_¥šÃr_g‘_v®ue
 (
DŸUn™SpšÃr
 *
£lf
);

168 
DIAVAR
 
dŸ_un™_¥šÃr_£t_uµ”
 (
DŸUn™SpšÃr
 *
£lf
, 
gdoubË
 
v®
);

170 
DIAVAR
 
GLi¡
 * 
g‘_un™s_Çme_li¡
();

174 
	#DIA_DYNAMIC_MENU
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
(obj, 
	`dŸ_dyÇmic_m’u_g‘_ty³
(), 
DŸDyÇmicM’u
)

	)

175 
	#DIA_DYNAMIC_MENU_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
(kÏss, 
	`dŸ_dyÇmic_m’u_g‘_ty³
(), 
DŸDyÇmicM’uCÏss
)

	)

176 
	#DIA_IS_DYNAMIC_MENU
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
(obj, 
	`dŸ_dyÇmic_m’u_g‘_ty³
())

	)

178 
_DŸDyÇmicM’u
 
	tDŸDyÇmicM’u
;

179 
_DŸDyÇmicM’uCÏss
 
	tDŸDyÇmicM’uCÏss
;

188 ’um { 
	mDDM_SORT_TOP
, 
	mDDM_SORT_NEWEST
, 
	mDDM_SORT_SORT
 } 
	tDdmSÜtTy³
;

190 
	gGtkWidg‘
 *(* 
	tDDMC»©eI‹mFunc
)(
	tDŸDyÇmicM’u
 *, 
	tgch¬
 *);

191 (* 
	tDDMC®lbackFunc
)(
	tDŸDyÇmicM’u
 *, cÚ¡ 
	tgch¬
 *, 
	tgpoš‹r
);

193 
DIAVAR
 
GTy³
 
	`dŸ_dyÇmic_m’u_g‘_ty³
 ();

195 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_dyÇmic_m’u_Ãw
(
DDMC»©eI‹mFunc
 
ü—‹
,

196 
gpoš‹r
 
u£rd©a
,

197 
GtkM’uI‹m
 *
Ùh”™em
, 
gch¬
 *
³rsi¡
);

198 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_dyÇmic_m’u_Ãw_¡ršgba£d
(
GtkM’uI‹m
 *
Ùh”™em
,

199 
gpoš‹r
 
u£rd©a
,

200 
gch¬
 *
³rsi¡
);

201 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_dyÇmic_m’u_Ãw_li¡ba£d
(
DDMC»©eI‹mFunc
 
ü—‹
,

202 
gpoš‹r
 
u£rd©a
,

203 
gch¬
 *
Ùh”_Ïb–
,

204 
GLi¡
 *
™ems
, 
gch¬
 *
³rsi¡
);

205 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_dyÇmic_m’u_Ãw_¡ršgli¡ba£d
(
gch¬
 *
Ùh”_Ïb–
,

206 
GLi¡
 *
™ems
,

207 
gpoš‹r
 
u£rd©a
,

208 
gch¬
 *
³rsi¡
);

209 
DIAVAR
 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
DŸDyÇmicM’u
 *
ddm
, cÚ¡ 
gch¬
 *
’Œy
);

210 
DIAVAR
 
gšt
 
	`dŸ_dyÇmic_m’u_add_’Œy
(
DŸDyÇmicM’u
 *
ddm
, cÚ¡ 
gch¬
 *
’Œy
);

211 
DIAVAR
 
	`dŸ_dyÇmic_m’u_£t_sÜtšg_m‘hod
(
DŸDyÇmicM’u
 *
ddm
, 
DdmSÜtTy³
 
sÜt
);

212 
DIAVAR
 
	`dŸ_dyÇmic_m’u_»£t
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
u£rd©a
);

213 
DIAVAR
 
	`dŸ_dyÇmic_m’u_£t_max_’Œ›s
(
DŸDyÇmicM’u
 *
ddm
, 
gšt
 
max
);

214 
DIAVAR
 
	`dŸ_dyÇmic_m’u_£t_cŞumns
(
DŸDyÇmicM’u
 *
ddm
, 
gšt
 
cŞs
);

215 
DIAVAR
 
gch¬
 *
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
DŸDyÇmicM’u
 *
ddm
);

216 
DIAVAR
 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
DŸDyÇmicM’u
 *
ddm
, cÚ¡ 
gch¬
 *
’Œy
);

223 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs
(cÚ¡ 
gušt8
 *
Ú_icÚ
,

224 cÚ¡ 
gušt8
 *
off_icÚ
);

227 
DIAVAR
 
GtkWidg‘
* 
	`çùÜy_ü—‹_bu‰Ú_w™h_icÚs
(cÚ¡ 
gušt8
 *
icÚ
);

230 
	#DEFAULT_ALIGNMENT
 
ALIGN_LEFT


	)

232 
	#DEFAULT_LINE_WIDTH
 2*0.05

	)

	@O:\tool\dvs50\objects\Struct\struct.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<¡ršg.h
>

24 
	~<¡dio.h
>

25 
	~<as£¹.h
>

27 
	~"š.h
"

28 
	~"objeù.h
"

30 
	~"¶ug-šs.h
"

31 
	~"sh“ts.h
"

33 
DŸObjeùTy³
 
¡ruùşass_ty³
;

40 
DIA_PLUGIN_CHECK_INIT


42 
PlugšIn™ResuÉ


43 
	$dŸ_¶ugš_š™
(
PlugšInfo
 *
šfo
)

45 ià(!
	`dŸ_¶ugš_šfo_š™
(
šfo
, "STRUCT",

46 
	`_
("Unified Modelling Language diagram objects STRUCT 1.3"),

47 
NULL
, NULL))

48  
DIA_PLUGIN_INIT_ERROR
;

50 
	`objeù_»gi¡”_ty³
(&
¡ruùşass_ty³
);

52  
DIA_PLUGIN_INIT_OK
;

53 
	}
}

	@O:\tool\dvs50\objects\Struct\struct_class.c

25 #ifdeà
HAVE_CONFIG_H


26 
	~<cÚfig.h
>

29 
	~<as£¹.h
>

30 
	~<gtk/gtk.h
>

31 
	~<m©h.h
>

32 
	~<¡ršg.h
>

34 
	~"š.h
"

35 
	~"dŸ»nd””.h
"

36 
	~"©Œibu‹s.h
"

37 
	~"´İ”t›s.h
"

38 
	~"dŸm’u.h
"

40 
	~"¡ruù_şass.h
"

42 
	~"pixm­s/¡ruùşass.xpm
"

44 
	~"debug.h
"

45 
	~"sh“t.h
"

46 
	~"fedlg.h
"

48 
FaùÜySŒuùI‹mAÎ
 *
çùÜyCÚš”
;

51 
	#STRUCTCLASS_BORDER
 0.1

	)

52 
	#STRUCTCLASS_UNDERLINEWIDTH
 0.05

	)

53 
	#STRUCTCLASS_TEMPLATE_OVERLAY_X
 2.3

	)

54 
	#STRUCTCLASS_TEMPLATE_OVERLAY_Y
 0.3

	)

56 
MusicFeMªag”O±s
 
	gmfmo_İts
 =

58 (
O³nDŸlog
è
çùÜy_fe_mªag”_dŸlog
,

59 (
AµlyDŸlog
è
çùÜy_music_fe_mªag”_­¶y
,

60 (
I‹m_Added
è
çùÜy_music_fe_mªag”_Ãw_™em_chªged
,

61 (
CË¬_AÎ
è
çùÜy_music_fe_mªag”_»move_®l


66 
»®
 
¡ruùşass_di¡ªû_äom
(
STRUCTCÏss
 *
¡ruùşass
, 
Pošt
 *
pošt
);

67 
¡ruùşass_£Ëù
(
STRUCTCÏss
 *
¡ruùşass
, 
Pošt
 *
şicked_pošt
,

68 
DŸR’d””
 *
š‹¿ùive_»nd””
);

69 
ObjeùChªge
* 
¡ruùşass_move_hªdË
(
STRUCTCÏss
 *
¡ruùşass
, 
HªdË
 *
hªdË
,

70 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
, 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

71 
ObjeùChªge
* 
¡ruùşass_move
(
STRUCTCÏss
 *
¡ruùşass
, 
Pošt
 *
to
);

72 
¡ruùşass_d¿w
(
STRUCTCÏss
 *
¡ruùşass
, 
DŸR’d””
 *
»nd””
);

77 
¡ruùşass_de¡roy
(
STRUCTCÏss
 *
¡ruùşass
);

78 
DŸObjeù
 *
¡ruùşass_cİy
(
STRUCTCÏss
 *
¡ruùşass
);

79 
çùÜy_hªdË_’Œy_™em
(
SaveEÁry
* 
£y
,
FaùÜySŒuùI‹m
 *
f¡
);

87 
çùÜy_»ad_š™Ÿl_to_¡ruù
(
STRUCTCÏss
 *
fşass
);

88 
gpoš‹r
 *
çùÜy_»ad_objeù_comobox_v®ue_äom_fe
(
A‰ribu‹Node
 
©Œ_node
);

89 
DŸM’u
 * 
¡ruùşass_objeù_m’u
(
DŸObjeù
 *
obj
, 
Pošt
 *
p
);

90 
ObjeùChªge
 *
¡ruùşass_show_comm’ts_ÿÎback
(
DŸObjeù
 *
obj
, 
Pošt
 *
pos
, 
gpoš‹r
 
d©a
);

92 
PrİDesütiÚ
 *
¡ruùşass_desüibe_´İs
(
STRUCTCÏss
 *
¡ruùşass
);

95 
PrİDesütiÚ
 *
¡ruù‹¡_desüibe_´İs
(
STRUCTCÏss
 *
¡ruùşass
);

96 
¡ruùşass_g‘_´İs
(
STRUCTCÏss
 *
¡ruùşass
, 
GPŒA¼ay
 *
´İs
);

97 
¡ruùşass_£t_´İs
(
STRUCTCÏss
 *
¡ruùşass
, 
GPŒA¼ay
 *
´İs
);

99 
PrİDesütiÚ
 *
çùÜy_desüibe_´İs
(
STRUCTCÏss
 *
¡ruùşass
);

102 
çùÜy_¡ruù_™ems_§ve
(
STRUCTCÏss
 *
¡ruùşass
, 
ObjeùNode
 
obj_node
,

103 cÚ¡ *
f’ame
);

105 
DŸObjeù
 * 
çùÜy_¡ruù_™ems_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
,

106 cÚ¡ *
f’ame
);

109 
DŸObjeù
 * 
çùÜy_¡ruù_™ems_ü—‹
(
Pošt
 *
¡¬ošt
,

110 *
u£r_d©a
,

111 
HªdË
 **
hªdË1
,

112 
HªdË
 **
hªdË2
);

116 
çùÜy_upd©e_šdex
(
STRUCTCÏss
 *
fşass
);

118 
fl_š_fÚtd©a
(
STRUCTCÏss
 *
¡ruùşass
);

119 
¡ruùşass_num_dyÇmic_cÚÃùiÚpošts
(
STRUCTCÏss
 *
şass
);

120 
çùÜy_d–‘e_lše_b‘w“n_two_objeùs
(
STRUCTCÏss
 *
¡¬tc
,cÚ¡ 
gch¬
 *
’dc
);

124 
ObjeùChªge
 *
çùÜy_­¶y_´İs_äom_dŸlog
(
STRUCTCÏss
 *
¡ruùşass
, 
GtkWidg‘
 *
widg‘
);

125 
çùÜy_d–‘e_lše_b‘w“n_two_objeùs
(
STRUCTCÏss
 *
¡¬tc
,cÚ¡ 
gch¬
 *
’dc
);

127 
ObjeùTy³Ops
 
	g¡ruùşass_ty³_İs
 =

129 (
C»©eFunc
è
çùÜy_¡ruù_™ems_ü—‹
,

132 (
LßdFunc
è
çùÜy_¡ruù_™ems_lßd
,

133 (
SaveFunc
è
çùÜy_¡ruù_™ems_§ve


147 
DŸObjeùTy³
 
	g¡ruùşass_ty³
 =

150 
NULL
,

151 (**è
¡ruùşass_xpm
,

153 &
¡ruùşass_ty³_İs
,

154 
NULL
,

159 
ObjeùOps
 
	g¡ruùşass_İs
 =

161 (
De¡royFunc
è
¡ruùşass_de¡roy
,

162 (
D¿wFunc
è
¡ruùşass_d¿w
,

163 (
Di¡ªûFunc
è
¡ruùşass_di¡ªû_äom
,

164 (
S–eùFunc
è
çùÜy_£Ëù
,

165 (
CİyFunc
è
¡ruùşass_cİy
,

166 (
MoveFunc
è
¡ruùşass_move
,

167 (
MoveHªdËFunc
è
¡ruùşass_move_hªdË
,

169 (
G‘Prİ”t›sFunc
è
çùÜy_g‘_´İ”t›s
,

171 (
AµlyPrİ”t›sDŸlogFunc
è
çùÜy_­¶y_´İs_äom_dŸlog
,

172 (
ObjeùM’uFunc
è
¡ruùşass_objeù_m’u
,

173 (
DesüibePrİsFunc
è
¡ruùşass_desüibe_´İs
,

174 (
G‘PrİsFunc
è
¡ruùşass_g‘_´İs
,

175 (
S‘PrİsFunc
è
¡ruùşass_£t_´İs
,

176 (
TextEd™Func
) 0,

177 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

178 (
Upd©eD©a
) 0,

179 (
CÚÃùiÚTwoObjeù
) 0,

180 (
Upd©eObjeùIndex
è
çùÜy_upd©e_šdex


195 
PrİDesütiÚ
 
	g¡ruùşass_´İs
[] =

197 
ELEMENT_COMMON_PROPERTIES
,

198 
PROP_STD_LINE_WIDTH_OPTIONAL
,

200 
PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
),

201 
PROP_STD_LINE_COLOUR_OPTIONAL
,

202 
PROP_STD_FILL_COLOUR_OPTIONAL
,

204 
PROP_STD_NOTEBOOK_BEGIN
,

205 
PROP_NOTEBOOK_PAGE
("şass", 
PROP_FLAG_DONT_MERGE
, 
N_
("Class")),

207 "Çme", 
PROP_TYPE_STRING
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
 | 
PROP_FLAG_NO_DEFAULTS
,

208 
N_
("Name"), 
NULL
, NULL

239 
PROP_NOTEBOOK_PAGE
("fÚt", 
PROP_FLAG_DONT_MERGE
, 
N_
("Font")),

240 
PROP_MULTICOL_BEGIN
("class"),

241 
PROP_MULTICOL_COLUMN
("font"),

244 "nÜm®_fÚt", 
PROP_TYPE_FONT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

245 
N_
("NÜm®"), 
NULL
, NULL

252 "şas¢ame_fÚt", 
PROP_TYPE_FONT
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

253 
N_
("CÏs¢ame"), 
NULL
, NULL

260 
PROP_MULTICOL_COLUMN
("height"),

262 "nÜm®_fÚt_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

263 
N_
(" "), 
NULL
, NULL

266 "pŞymÜphic_fÚt_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

267 
N_
(" "), 
NULL
, NULL

270 "ab¡¿ù_fÚt_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

271 
N_
(" "), 
NULL
, NULL

274 "şas¢ame_fÚt_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

275 
N_
(" "), 
NULL
, NULL

278 "ab¡¿ù_şas¢ame_fÚt_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

279 
N_
(" "), 
NULL
, NULL

282 "comm’t_fÚt_height", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
,

283 
N_
(" "), 
NULL
, NULL

285 
PROP_MULTICOL_END
("class"),

286 
PROP_STD_NOTEBOOK_END
,

297 
PROP_DESC_END


312 
PrİDesütiÚ
 *

313 
	$¡ruùşass_desüibe_´İs
(
STRUCTCÏss
 *
¡ruùşass
)

315 ià(
¡ruùşass_´İs
[0].
qu¬k
 == 0)

317 
i
 = 0;

319 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
¡ruùşass_´İs
);

320 
¡ruùşass_´İs
[
i
].
Çme
 !ğ
NULL
)

341 
i
++;

344  
¡ruùşass_´İs
;

345 
	}
}

347 
PrİOff£t
 
	g¡ruùşass_off£ts
[] =

349 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

351 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
STRUCTCÏss
, 
lše_width
) },

352 { "‹xt_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
STRUCTCÏss
, 
‹xt_cŞÜ
) },

353 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
STRUCTCÏss
, 
lše_cŞÜ
) },

354 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
STRUCTCÏss
, 
fl_cŞÜ
) },

355 { "Çme", 
PROP_TYPE_STRING
, 
off£tof
(
STRUCTCÏss
, 
Çme
) },

372 
PROP_OFFSET_MULTICOL_BEGIN
("class"),

373 
PROP_OFFSET_MULTICOL_COLUMN
("font"),

374 { "nÜm®_fÚt", 
PROP_TYPE_FONT
, 
off£tof
(
STRUCTCÏss
, 
nÜm®_fÚt
) },

377 { "şas¢ame_fÚt", 
PROP_TYPE_FONT
, 
off£tof
(
STRUCTCÏss
, 
şas¢ame_fÚt
) },

381 
PROP_OFFSET_MULTICOL_COLUMN
("height"),

382 { "nÜm®_fÚt_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCÏss
, 
fÚt_height
) },

383 { "ab¡¿ù_fÚt_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCÏss
, 
ab¡¿ù_fÚt_height
) },

384 { "pŞymÜphic_fÚt_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCÏss
, 
pŞymÜphic_fÚt_height
) },

385 { "şas¢ame_fÚt_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCÏss
, 
şas¢ame_fÚt_height
) },

386 { "ab¡¿ù_şas¢ame_fÚt_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCÏss
, 
ab¡¿ù_şas¢ame_fÚt_height
) },

387 { "comm’t_fÚt_height", 
PROP_TYPE_REAL
, 
off£tof
(
STRUCTCÏss
, 
comm’t_fÚt_height
) },

388 
PROP_OFFSET_MULTICOL_END
("class"),

394 { 
NULL
, 0, 0 },

398 
	$¡ruùşass_g‘_´İs
(
STRUCTCÏss
 * 
¡ruùşass
, 
GPŒA¼ay
 *
´İs
)

400 
	`objeù_g‘_´İs_äom_off£ts
(&
¡ruùşass
->
–em’t
.
objeù
,

401 
¡ruùşass_off£ts
, 
´İs
);

402 
	}
}

404 
DŸM’uI‹m
 
	g¡ruùşass_m’u_™ems
[] =

407 
N_
("Show Comm’ts"), 
¡ruùşass_show_comm’ts_ÿÎback
, 
NULL
,

408 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE


412 
DŸM’u
 
	g¡ruùşass_m’u
 =

414 
N_
("Class"),

415 (
¡ruùşass_m’u_™ems
)/(
DŸM’uI‹m
),

416 
¡ruùşass_m’u_™ems
,

417 
NULL


420 
DŸM’u
 *

421 
	$¡ruùşass_objeù_m’u
(
DŸObjeù
 *
obj
, 
Pošt
 *
p
)

426  &
¡ruùşass_m’u
;

427 
	}
}

429 
	s_Comm’tS‹


431 
ObjeùS‹
 
	m¡©e
;

432 
gboŞ—n
 
	mvisibË_comm’ts
;

433 } 
	tComm’tS‹
;

434 
ObjeùS‹
*

435 
	$_comm’t_g‘_¡©e
 (
DŸObjeù
 *
obj
)

437 
Comm’tS‹
 *
¡©e
 = 
	`g_Ãw
 (CommentState,1);

438 
¡©e
->¡©e.
ä“
 = 
NULL
;

440  (
ObjeùS‹
 *)
¡©e
;

441 
	}
}

443 
	$_comm’t_£t_¡©e
 (
DŸObjeù
 *
obj
, 
ObjeùS‹
 *
¡©e
)

446 
	`g_ä“
 (
¡©e
);

447 
	`¡ruùşass_ÿlcuÏ‹_d©a
((
STRUCTCÏss
 *)
obj
);

448 
	`¡ruùşass_upd©e_d©a
((
STRUCTCÏss
 *)
obj
);

449 
	}
}

451 
ObjeùChªge
 *

452 
	$¡ruùşass_show_comm’ts_ÿÎback
(
DŸObjeù
 *
obj
, 
Pošt
 *
pos
, 
gpoš‹r
 
d©a
)

454 
ObjeùS‹
 *
Şd_¡©e
 = 
	`_comm’t_g‘_¡©e
(
obj
);

455 
ObjeùChªge
 *
chªge
 = 
	`Ãw_objeù_¡©e_chªge
(
obj
, 
Şd_¡©e
, 
_comm’t_g‘_¡©e
, 
_comm’t_£t_¡©e
 );

458 
	`¡ruùşass_ÿlcuÏ‹_d©a
((
STRUCTCÏss
 *)
obj
);

459 
	`¡ruùşass_upd©e_d©a
((
STRUCTCÏss
 *)
obj
);

460  
chªge
;

461 
	}
}

464 
	$¡ruùşass_£t_´İs
(
STRUCTCÏss
 *
¡ruùşass
, 
GPŒA¼ay
 *
´İs
)

471 
DŸObjeù
 *
obj
 = &
¡ruùşass
->
–em’t
.
objeù
;

473 
num
;

475 
	`objeù_£t_´İs_äom_off£ts
(&
¡ruùşass
->
–em’t
.
objeù
, 
¡ruùşass_off£ts
,

476 
´İs
);

478 
num
 = 
STRUCTCLASS_CONNECTIONPOINTS
 + 
	`¡ruùşass_num_dyÇmic_cÚÃùiÚpošts
(
¡ruùşass
);

480 #ifdeà
STRUCT_MAINPOINT


481 
obj
->
num_cÚÃùiÚs
 = 
num
 + 1;

483 
obj
->
num_cÚÃùiÚs
 = 
num
;

486 
obj
->
cÚÃùiÚs
 = 
	`g_»®loc
(obj->cÚÃùiÚs, obj->
num_cÚÃùiÚs
*(
CÚÃùiÚPošt
 *));

489 ià(
num
 > 
STRUCTCLASS_CONNECTIONPOINTS
)

523 #ifdeà
STRUCT_MAINPOINT


524 
obj
->
cÚÃùiÚs
[
num
] = &
¡ruùşass
->cÚÃùiÚs[
STRUCTCLASS_CONNECTIONPOINTS
];

525 
obj
->
cÚÃùiÚs
[
num
]->
objeù
 = obj;

528 
	`¡ruùşass_ÿlcuÏ‹_d©a
(
¡ruùşass
);

529 
	`¡ruùşass_upd©e_d©a
(
¡ruùşass
);

530 #ifdeà
DEBUG


533 
	`¡ruùşass_§n™y_check
(
¡ruùşass
, "After updating data");

535 
	}
}

537 
»®


538 
	$¡ruùşass_di¡ªû_äom
(
STRUCTCÏss
 *
¡ruùşass
, 
Pošt
 *
pošt
)

540 
DŸObjeù
 *
obj
 = &
¡ruùşass
->
–em’t
.
objeù
;

541  
	`di¡ªû_»ùªgË_pošt
(&
obj
->
boundšg_box
, 
pošt
);

542 
	}
}

545 
	$¡ruùşass_£Ëù
(
STRUCTCÏss
 *
¡ruùşass
, 
Pošt
 *
şicked_pošt
,

546 
DŸR’d””
 *
š‹¿ùive_»nd””
)

548 
	`–em’t_upd©e_hªdËs
(&
¡ruùşass
->
–em’t
);

549 
	}
}

552 
	$çùÜy_upd©e_šdex
(
STRUCTCÏss
 *
fşass
)

555 
DŸObjeù
 *
obj
 = &
fşass
->
–em’t
.
objeù
;

556 
Lay”
 *
cu¾ay
 = 
obj
->
·»Á_Ïy”
;

557 
GLi¡
 *
li¡
 = 
cu¾ay
->
objeùs
;

558 
obj
->
ošdex
 = 
	`g_li¡_šdex
(
li¡
,obj);

568 
	`¡ruùşass_ÿlcuÏ‹_d©a
(
fşass
);

569 if(!
fşass
->
isIn™Ÿl
)

571 
fşass
->
isIn™Ÿl
 = 
TRUE
;

572 
	`çùÜy_»ad_š™Ÿl_to_¡ruù
(
fşass
);

574 
	}
}

577 
	$çùÜy_£Ëù
(
STRUCTCÏss
 *
fşass
, 
Pošt
 *
şicked_pošt
,

578 
DŸR’d””
 *
š‹¿ùive_»nd””
)

580 
	`–em’t_upd©e_hªdËs
(&
fşass
->
–em’t
);

581 
	`çùÜy_upd©e_šdex
(
fşass
);

582 
	}
}

584 
ObjeùChªge
*

585 
	$¡ruùşass_move_hªdË
(
STRUCTCÏss
 *
¡ruùşass
, 
HªdË
 *
hªdË
,

586 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

587 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

589 
	`as£¹
(
¡ruùşass
!=
NULL
);

590 
	`as£¹
(
hªdË
!=
NULL
);

591 
	`as£¹
(
to
!=
NULL
);

593 
	`as£¹
(
hªdË
->
id
 < 
STRUCTCLASS_CONNECTIONPOINTS
);

595  
NULL
;

596 
	}
}

598 
ObjeùChªge
*

599 
	$¡ruùşass_move
(
STRUCTCÏss
 *
¡ruùşass
, 
Pošt
 *
to
)

601 
¡ruùşass
->
–em’t
.
cÜÃr
 = *
to
;

602 
	`¡ruùşass_upd©e_d©a
(
¡ruùşass
);

604  
NULL
;

605 
	}
}

691 
gch¬
 *

692 
	$¡ruù_ü—‹_docum’tiÚ_g
 (
gch¬
 * 
comm’t
,

693 
gboŞ—n
 
ggšg
,

694 
gšt
 
W¿pPošt
,

695 
gšt
 *
Numb”OfLšes
)

697 
gch¬
 *
Comm’tTag
 = 
ggšg
 ? "{documentation = " : "";

698 
gšt
 
TagL’gth
 = 
	`¡¾’
(
Comm’tTag
);

704 
gšt
 
WÜkšgW¿pPošt
 = (
TagL’gth
<
W¿pPošt
) ? WrapPoint : ((TagLength<=0)?1:TagLength);

705 
gšt
 
RawL’gth
 = 
TagL’gth
 + 
	`¡¾’
(
comm’t
è+ (
ggšg
?1:0);

706 
gšt
 
MaxCookedL’gth
 = 
RawL’gth
 + RawL’gth/
WÜkšgW¿pPošt
;

707 
gch¬
 *
W¿µedComm’t
 = 
	`g_m®loc0
(
MaxCookedL’gth
+1);

708 
gšt
 
AvaS·û
 = 
WÜkšgW¿pPošt
 - 
TagL’gth
;

709 
gch¬
 *
Sÿn
;

710 
gch¬
 *
B»akCªdid©e
;

711 
gunich¬
 
SÿnCh¬
;

712 
gboŞ—n
 
AddNL
 = 
FALSE
;

714 ià(
ggšg
)

715 
	`¡rÿt
(
W¿µedComm’t
, 
Comm’tTag
);

716 *
Numb”OfLšes
 = 1;

718  *
comm’t
 )

721  *
comm’t
 && 
	`g_unich¬_is¥aû
(
	`g_utf8_g‘_ch¬
(comment)) )

723 
comm’t
 = 
	`g_utf8_Ãxt_ch¬
(comment);

726 iàĞ*
comm’t
 )

729 
Sÿn
 = 
comm’t
;

730 
B»akCªdid©e
 = 
NULL
;

731  *
Sÿn
 && *SÿÀ!ğ'\n' && 
AvaS·û
 > 0 )

733 
SÿnCh¬
 = 
	`g_utf8_g‘_ch¬
(
Sÿn
);

737 iàĞ
	`g_unich¬_is¥aû
(
SÿnCh¬
) )

738 
B»akCªdid©e
 = 
Sÿn
;

739 
AvaS·û
--;

740 
Sÿn
 = 
	`g_utf8_Ãxt_ch¬
(Scan);

742 iàĞ
AvaS·û
==0 && 
B»akCªdid©e
 !ğ
NULL
 )

743 
Sÿn
 = 
B»akCªdid©e
;

744 iàĞ
AddNL
 )

746 
	`¡rÿt
(
W¿µedComm’t
, "\n");

747 *
Numb”OfLšes
+=1;

749 
AddNL
 = 
TRUE
;

750 
	`¡ºÿt
(
W¿µedComm’t
, 
comm’t
, 
Sÿn
-comment);

751 
AvaS·û
 = 
WÜkšgW¿pPošt
;

752 
comm’t
 = 
Sÿn
;

755 ià(
ggšg
)

756 
	`¡rÿt
(
W¿µedComm’t
, "}");

757 
	`as£¹
(
	`¡¾’
(
W¿µedComm’t
)<=
MaxCookedL’gth
);

758  
W¿µedComm’t
;

759 
	}
}

851 
»®


852 
	$¡ruùşass_d¿w_Çmebox
(
STRUCTCÏss
 *
¡ruùşass
, 
DŸR’d””
 *
»nd””
, 
EËm’t
 *
–em
 )

854 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

855 
»®
 
fÚt_height
;

856 
»®
 
asûÁ
;

857 
DŸFÚt
 *
fÚt
;

858 
Pošt
 
S¹Pošt
;

859 
Pošt
 
Low”RightPošt
;

860 
»®
 
Yoff£t
;

861 
CŞÜ
 *
‹xt_cŞÜ
 = &
¡ruùşass
->text_color;

865 
S¹Pošt
.
x
 = 
–em
->
cÜÃr
.x;

866 
S¹Pošt
.
y
 = 
–em
->
cÜÃr
.y;

868 
Yoff£t
 = 
–em
->
cÜÃr
.
y
 + 
¡ruùşass
->
Çmebox_height
;

870 
Low”RightPošt
 = 
S¹Pošt
;

871 
Low”RightPošt
.
x
 +ğ
–em
->
width
;

872 
Low”RightPošt
.
y
 = 
Yoff£t
;

878 
»nd””_İs
->
	`fl_»ù
(
»nd””
, &
S¹Pošt
, &
Low”RightPošt
, &
¡ruùşass
->
fl_cŞÜ
);

879 
»nd””_İs
->
	`d¿w_»ù
(
»nd””
, &
S¹Pošt
, &
Low”RightPošt
, &
¡ruùşass
->
lše_cŞÜ
);

882 
S¹Pošt
.
x
 +ğ
–em
->
width
 / 2.0;

883 
S¹Pošt
.
y
 += 0.2;

896 ià(
¡ruùşass
->
Çme
 !ğ
NULL
)

900 
gch¬
 *
utf8Çme
 = 
¡ruùşass
->
Çme
;

906 
fÚt
 = 
¡ruùşass
->
şas¢ame_fÚt
;

907 
fÚt_height
 = 
¡ruùşass
->
şas¢ame_fÚt_height
;

909 
asûÁ
 = 
	`dŸ_fÚt_asûÁ
(
utf8Çme
, 
fÚt
, 
fÚt_height
);

910 
S¹Pošt
.
y
 +ğ
asûÁ
;

912 
»nd””_İs
->
	`£t_fÚt
(
»nd””
, 
fÚt
, 
fÚt_height
);

913 
»nd””_İs
->
	`d¿w_¡ršg
(
»nd””
,
utf8Çme
 ,

914 &
S¹Pošt
, 
ALIGN_CENTER
, 
‹xt_cŞÜ
);

915 
S¹Pošt
.
y
 +ğ
fÚt_height
 - 
asûÁ
;

924  
Yoff£t
;

925 
	}
}

1252 
	$¡ruùşass_d¿w
(
STRUCTCÏss
 *
¡ruùşass
, 
DŸR’d””
 *
»nd””
)

1254 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

1255 
EËm’t
 *
–em
;

1257 
	`as£¹
(
¡ruùşass
 !ğ
NULL
);

1258 
	`as£¹
(
»nd””
 !ğ
NULL
);

1260 
»nd””_İs
->
	`£t_fl¡yË
(
»nd””
, 
FILLSTYLE_SOLID
);

1261 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
¡ruùşass
->
lše_width
);

1262 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
LINESTYLE_SOLID
);

1264 
–em
 = &
¡ruùşass
->
–em’t
;

1266 
	`¡ruùşass_d¿w_Çmebox
(
¡ruùşass
, 
»nd””
, 
–em
);

1276 
	}
}

1279 
	$¡ruùşass_upd©e_d©a
(
STRUCTCÏss
 *
¡ruùşass
)

1281 
EËm’t
 *
–em
 = &
¡ruùşass
->
–em’t
;

1282 
DŸObjeù
 *
obj
 = &
–em
->
objeù
;

1283 
»®
 
x
,
y
;

1285 
i
;

1286 
poštswide
;

1287 
low”ËácÜÃr
;

1288 
»®
 
pošt¥acšg
;

1290 
x
 = 
–em
->
cÜÃr
.x;

1291 
y
 = 
–em
->
cÜÃr
.y;

1294 
¡ruùşass
->
cÚÃùiÚs
[0].
pos
 = 
–em
->
cÜÃr
;

1295 
¡ruùşass
->
cÚÃùiÚs
[0].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_WEST
;

1300 
poštswide
 = (
STRUCTCLASS_CONNECTIONPOINTS
 - 6) / 2;

1301 
pošt¥acšg
 = 
–em
->
width
 / (
poštswide
 + 1.0);

1304 
i
=1; i<=
poštswide
; i++)

1306 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
x
 = x + (
pošt¥acšg
 * i);

1307 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
y
 = y;

1308 
¡ruùşass
->
cÚÃùiÚs
[
i
].
dœeùiÚs
 = 
DIR_NORTH
;

1311 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2) - 2;

1312 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
x
 = x + 
–em
->
width
;

1313 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
y
 = y;

1314 
¡ruùşass
->
cÚÃùiÚs
[
i
].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_EAST
;

1316 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2) - 1;

1317 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
x
 = x;

1318 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
y
 = y + sŒuùşass->
Çmebox_height
 / 2.0;

1319 
¡ruùşass
->
cÚÃùiÚs
[
i
].
dœeùiÚs
 = 
DIR_WEST
;

1321 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2);

1322 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
x
 = x + 
–em
->
width
;

1323 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
y
 = y + sŒuùşass->
Çmebox_height
 / 2.0;

1324 
¡ruùşass
->
cÚÃùiÚs
[
i
].
dœeùiÚs
 = 
DIR_EAST
;

1326 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2) + 1;

1327 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
x
 = x;

1328 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
y
 = y + 
–em
->
height
;

1329 
¡ruùşass
->
cÚÃùiÚs
[
i
].
dœeùiÚs
 = 
DIR_WEST
|
DIR_SOUTH
;

1332 
low”ËácÜÃr
 = (
STRUCTCLASS_CONNECTIONPOINTS
 / 2) + 1;

1333 
i
=1; i<=
poštswide
; i++)

1335 
¡ruùşass
->
cÚÃùiÚs
[
low”ËácÜÃr
 + 
i
].
pos
.
x
 = x + (
pošt¥acšg
 * i);

1336 
¡ruùşass
->
cÚÃùiÚs
[
low”ËácÜÃr
 + 
i
].
pos
.
y
 = y + 
–em
->
height
;

1337 
¡ruùşass
->
cÚÃùiÚs
[
low”ËácÜÃr
 + 
i
].
dœeùiÚs
 = 
DIR_SOUTH
;

1341 
i
 = (
STRUCTCLASS_CONNECTIONPOINTS
) - 1;

1342 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
x
 = x + 
–em
->
width
;

1343 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
y
 = y + 
–em
->
height
;

1344 
¡ruùşass
->
cÚÃùiÚs
[
i
].
dœeùiÚs
 = 
DIR_EAST
|
DIR_SOUTH
;

1346 #ifdeà
STRUCT_MAINPOINT


1348 
i
 = 
STRUCTCLASS_CONNECTIONPOINTS
;

1349 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
x
 = x + 
–em
->
width
 / 2;

1350 
¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
.
y
 = y + 
–em
->
height
 / 2;

1351 
¡ruùşass
->
cÚÃùiÚs
[
i
].
dœeùiÚs
 = 
DIR_ALL
;

1352 
¡ruùşass
->
cÚÃùiÚs
[
i
].
æags
 = 
CP_FLAGS_MAIN
;

1355 
y
 +ğ
¡ruùşass
->
Çmebox_height
 + 0.1 + sŒuùşass->
fÚt_height
/2;

1416 
	`–em’t_upd©e_boundšgbox
(
–em
);

1426 
obj
->
pos™iÚ
 = 
–em
->
cÜÃr
;

1428 
	`–em’t_upd©e_hªdËs
(
–em
);

1430 #ifdeà
DEBUG


1433 
	}
}

1503 
»®


1504 
	$¡ruùşass_ÿlcuÏ‹_Çme_d©a
(
STRUCTCÏss
 *
¡ruùşass
)

1506 
»®
 
maxwidth
 = 0.0;

1510 ià(
¡ruùşass
->
Çme
 !ğ
NULL
 && structclass->name[0] != '\0')

1518 
maxwidth
 = 
	`dŸ_fÚt_¡ršg_width
(
¡ruùşass
->
Çme
,

1519 
¡ruùşass
->
şas¢ame_fÚt
,

1520 
¡ruùşass
->
şas¢ame_fÚt_height
);

1524 
¡ruùşass
->
Çmebox_height
 = sŒuùşass->
şas¢ame_fÚt_height
 + 4*0.1;

1558  
maxwidth
;

1559 
	}
}

1826 
	$¡ruùşass_ÿlcuÏ‹_d©a
(
STRUCTCÏss
 *
¡ruùşass
)

1829 
num_‹m¶©es
;

1830 
»®
 
maxwidth
 = 0.0;

1834 ià(!
¡ruùşass
->
de¡royed
)

1836 
maxwidth
 = 
	`MAX
(
	`¡ruùşass_ÿlcuÏ‹_Çme_d©a
(
¡ruùşass
), maxwidth);

1838 
¡ruùşass
->
–em’t
.
height
 = sŒuùşass->
Çmebox_height
;

1848 
¡ruùşass
->
–em’t
.
width
 = 
maxwidth
+0.5;

1857 
maxwidth
 = 
STRUCTCLASS_TEMPLATE_OVERLAY_X
;

1858 ià(
num_‹m¶©es
 != 0)

1879 
	}
}

1939 
	$fl_š_fÚtd©a
(
STRUCTCÏss
 *
¡ruùşass
)

1941 ià(
¡ruùşass
->
nÜm®_fÚt
 =ğ
NULL
)

1943 
¡ruùşass
->
fÚt_height
 = 0.8;

1944 
¡ruùşass
->
nÜm®_fÚt
 = 
	`dŸ_fÚt_Ãw_äom_¡yË
(
DIA_FONT_MONOSPACE
, 0.8);

1956 ià(
¡ruùşass
->
şas¢ame_fÚt
 =ğ
NULL
)

1958 
¡ruùşass
->
şas¢ame_fÚt_height
 = 1.0;

1959 
¡ruùşass
->
şas¢ame_fÚt
 =

1960 
	`dŸ_fÚt_Ãw_äom_¡yË
(
DIA_FONT_MONOSPACE
 | 
DIA_FONT_BOLD
, 1.0);

1971 
	}
}

2111 
DŸObjeù
 *

2112 
	$çùÜy_¡ruù_™ems_ü—‹
(
Pošt
 *
¡¬ošt
,

2113 *
u£r_d©a
,

2114 
HªdË
 **
hªdË1
,

2115 
HªdË
 **
hªdË2
)

2118 if(!
curLay”
)

2119 
curLay”
 = 
çùÜyCÚš”
->curLayer;

2120 
STRUCTCÏss
 *
¡ruùşass
;

2122 
EËm’t
 *
–em
;

2123 
DŸObjeù
 *
obj
;

2124 
i
;

2126 
¡ruùşass
 = 
	`g_m®loc0
((
STRUCTCÏss
));

2127 
¡ruùşass
->
isIn™Ÿl
 = 
FALSE
;

2129 
–em
 = &
¡ruùşass
->
–em’t
;

2130 
obj
 = &
–em
->
objeù
;

2132 
–em
->
cÜÃr
 = *
¡¬ošt
;

2134 #ifdeà
STRUCT_MAINPOINT


2135 
	`–em’t_š™
(
–em
, 8, 
STRUCTCLASS_CONNECTIONPOINTS
 + 1);

2137 
	`–em’t_š™
(
–em
, 8, 
STRUCTCLASS_CONNECTIONPOINTS
);

2140 
	`fl_š_fÚtd©a
(
¡ruùşass
);

2148 
šdex
 = 
	`GPOINTER_TO_INT
(
u£r_d©a
);

2149 
GLi¡
 *
s¡ruù
 = 
çùÜyCÚš”
->
¡ruùLi¡
;

2150 ; 
s¡ruù
 !=
NULL
; s¡ruù = s¡ruù->
Ãxt
)

2152 
FaùÜySŒuùI‹mLi¡
 *
i
 = 
s¡ruù
->
d©a
;

2153 if(
i
->
numb”
 =ğ
šdex
)

2155 
¡ruùşass
->
Çme
 = 
	`g_¡rdup
(
i
->
vÇme
) ;

2156 
obj
->
Çme
 = 
	`g_¡rdup
(
	`_
(
i
->
¢ame
));

2161 if(
curLay”
 && !
	`çùÜy_is_¥ecŸl_objeù
(
obj
->
Çme
))

2163 
GLi¡
 *
li¡
 = 
curLay”
->
deâames
;

2164 
num
 = 0;

2165 ; 
li¡
;†i¡ =†i¡->
Ãxt
)

2167 
gch¬
 *
¡r
 = 
li¡
->
d©a
;

2168 if(!
	`g_ascii_¡ºÿ£cmp
(
¡r
,
¡ruùşass
->
Çme
,
	`¡¾’
(structclass->name)))

2169 
num
++;

2173 if(
num
>0)

2175 
gch¬
 *
t¡r
 = 
	`g_¡rdup
(
¡ruùşass
->
Çme
);

2176 
	`g_ä“
(
¡ruùşass
->
Çme
);

2177 
¡ruùşass
->
Çme
 =
	`g_¡rcÚÿt
(
t¡r
,
	`g_¡rdup_´štf
("(%d)",
num
),
NULL
);

2178 
	`g_ä“
(
t¡r
);

2181 if(!
	`çùÜy_is_sy¡em_d©a
(
obj
->
Çme
))

2182 
curLay”
->
deâames
 = 
	`g_li¡_­³nd
(curLay”->deâames,
¡ruùşass
->
Çme
);

2193 
¡ruùşass
->
widg‘m­
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

2195 
obj
->
ty³
 = &
¡ruùşass_ty³
;

2196 
obj
->
ty³
->
v”siÚ
 = 
	`g_¡rdup
(
çùÜyCÚš”
->
fe_v”siÚ
);

2197 
obj
->
İs
 = &
¡ruùşass_İs
;

2199 
¡ruùşass
->
lše_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

2200 
¡ruùşass
->
‹xt_cŞÜ
 = 
cŞÜ_bÏck
;

2201 
¡ruùşass
->
lše_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

2202 
¡ruùşass
->
fl_cŞÜ
 = 
	`©Œibu‹s_g‘_background
();

2204 
	`¡ruùşass_ÿlcuÏ‹_d©a
(
¡ruùşass
);

2206 
i
=0; i<
STRUCTCLASS_CONNECTIONPOINTS
; i++)

2208 
obj
->
cÚÃùiÚs
[
i
] = &
¡ruùşass
->connections[i];

2209 
¡ruùşass
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

2210 
¡ruùşass
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

2212 #ifdeà
STRUCT_MAINPOINT


2215 
i
 +ğ
	`¡ruùşass_num_dyÇmic_cÚÃùiÚpošts
(
¡ruùşass
);

2216 
obj
->
cÚÃùiÚs
[
i
] = &
¡ruùşass
->cÚÃùiÚs[
STRUCTCLASS_CONNECTIONPOINTS
];

2217 
¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
objeù
 = 
obj
;

2218 
¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
cÚÃùed
 = 
NULL
;

2221 
–em
->
exŒa_¥acšg
.
bÜd”_Œªs
 = 
¡ruùşass
->
lše_width
/2.0;

2222 
	`¡ruùşass_upd©e_d©a
(
¡ruùşass
);

2224 
i
=0; i<8; i++)

2226 
obj
->
hªdËs
[
i
]->
ty³
 = 
HANDLE_NON_MOVABLE
;

2229 *
hªdË1
 = 
NULL
;

2230 *
hªdË2
 = 
NULL
;

2231 
¡ruùşass
->
EnumsAndSŒuùs
 = 
NULL
;

2232 
¡ruùşass
->
EnumsAndSŒuùs
 = 
çùÜyCÚš”
;

2234  &
¡ruùşass
->
–em’t
.
objeù
;

2235 
	}
}

2256 
gch¬
 *
	$çùÜy_g‘_Ï¡_£ùiÚ
(cÚ¡ 
gch¬
 *
¤c
,cÚ¡ gch¬ *
d–im™”
)

2258 
gch¬
 **
¥l™
 = 
	`g_¡r¥l™
(
¤c
,".",-1);

2259 
£ùiÚ
 = 
	`g_¡rv_Ëngth
(
¥l™
);

2260 
gch¬
 *
»t
 = 
	`g_¡rdup
(
¥l™
[
£ùiÚ
-1]);

2261 
	`g_¡rä“v
(
¥l™
);

2262  
»t
;

2263 
	}
}

2264 
FaùÜySŒuùI‹m
 *
	$çùÜy_g‘_çùÜy¡ruù™em
(
GLi¡
 *
šli¡
,cÚ¡ 
gch¬
 *
Çme
)

2266 
FaùÜySŒuùI‹m
 *
f¡
 = 
NULL
;

2267 
GLi¡
 *
p
 =
šli¡
;

2268 ; 
p
;…õ->
Ãxt
)

2270 
FaùÜySŒuùI‹m
 *
t
 = 
p
->
d©a
;

2271 if(!
	`g_ascii_¡rÿ£cmp
(
t
->
Name
,
Çme
))

2273 
f¡
 = 
p
->
d©a
;

2277  
f¡
;

2278 
	}
}

2280 
	$çùÜy_»ad_uniÚ_bu‰Ú_äom_fe
(
STRUCTCÏss
 *
fşass
,
ObjeùNode
 
obŠ_node
,
SaveUbŠ
 *
sbŠ
)

2282 
xmlCh¬
 *
key
 = 
NULL
;

2283 
obŠ_node
 = 
	`d©a_Ãxt
(obtn_node))

2285 
key
 = 
	`xmlG‘Prİ
(
obŠ_node
,(
xmlCh¬
 *)"name");

2286 if(!
key
) ;

2287 
gch¬
 *
skey
 = 
	`çùÜy_g‘_Ï¡_£ùiÚ
((gch¬*)
key
,".");

2288 
FaùÜySŒuùI‹m
 *
s™em
 = 
	`çùÜy_g‘_çùÜy¡ruù™em
(
sbŠ
->
¡ruùli¡
,
skey
);

2289 if(!
s™em
) ;

2290 
s™em
->
Ügşass
 = 
fşass
;

2293 
SaveSŒuù
 *
Âode
 = 
	`çùÜy_g‘_§ve¡ruù
(
s™em
);

2294 if(
Âode
)

2296 
Âode
->
widg‘1
 = 
NULL
;

2297 
Âode
->
widg‘2
 = 
NULL
;

2298 
Âode
->
Üg
 = 
s™em
;

2299 
Âode
->
sşass
 = 
s™em
->
Ügşass
;

2300 
Âode
->
Çme
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2301 
	`xmlF»e
(
key
);

2306 
	`çùÜy_»ad_objeù_v®ue_äom_fe
(
Âode
,
s™em
,
obŠ_node
);

2307 
sbŠ
->
§v–i¡
 = 
	`g_li¡_­³nd
(sbŠ->§v–i¡,
Âode
);

2311 
	}
}

2312 
	$çùÜy_»ad_objeù_v®ue_äom_fe
(
SaveSŒuù
 *
sss
,
FaùÜySŒuùI‹m
 *
f¡
,
ObjeùNode
 
©Œ_node
)

2315 
STRUCTCÏss
 *
fşass
 = 
f¡
->
Ügşass
;

2316 
xmlCh¬
 *
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(xmlChar *)"wtype");

2317 ifĞ
key
 && 
	`çùÜy_is_¥ecŸl_objeù
((
gch¬
*)key) )

2320 
sss
->
ûÎty³
 = 
UBTN
;

2322 
sss
->
ty³
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2323 
	`xmlF»e
(
key
);

2324 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"value");

2325 
SaveKV
 *
skv
 = 
	`g_Ãw0
(SaveKV,1);

2327 
skv
->
v®ue
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2328 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
*)"index");

2329 
skv
->
¿dšdex
 = 
	`g_¡¹od
((
gch¬
*)
key
,
NULL
);

2330 
sss
->
v®ue
.
vnumb”
 = 
skv
;

2331 
	`xmlF»e
(
key
);

2335 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"type");

2337 ià(
key
)

2339 
sss
->
ty³
 = 
	`g_loÿË_to_utf8
((
gch¬
*)
key
,-1,
NULL
,NULL,NULL);

2340 
	`xmlF»e
 (
key
);

2342 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"wtype");

2343 if(!
key
è 
NULL
;

2345 if(!
	`g_ascii_¡ºÿ£cmp
((
gch¬
*)
key
,"ECOMBO",6))

2347 
sss
->
ûÎty³
 = 
ECOMBO
;

2349 
gch¬
 *
skey
 = 
	`çùÜy_g‘_Ï¡_£ùiÚ
(
sss
->
ty³
,".");

2351 
GLi¡
 *
rg‘bË
 = 
	`g_hash_bË_lookup
(
fşass
->
EnumsAndSŒuùs
->
’umTabË
,
skey
);

2352 
	`g_ä“
(
skey
);

2353 
SaveEnum
 *
£n
 = &
sss
->
v®ue
.
£num
;

2354 if(
rg‘bË
)

2356 
£n
->
’umLi¡
 = 
rg‘bË
;

2357 
GLi¡
 *
t
 = 
rg‘bË
;

2358 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"value");

2359 if((
gch¬
*)
key
)

2360 ; 
t
 !ğ
NULL
 ; =->
Ãxt
)

2362 
FaùÜySŒuùEnum
 *
f£
 = 
t
->
d©a
;

2363 if(0 =ğ
	`g_ascii_¡rÿ£cmp
(
f£
->
v®ue
,(
gch¬
*)
key
))

2365 
£n
->
ev®ue
 = 
	`g_loÿË_to_utf8
((
gch¬
*)
key
,-1,
NULL
,NULL,NULL);

2366 
£n
->
šdex
 = 
	`g_li¡_šdex
(
rg‘bË
,
f£
);

2371 
	`xmlF»e
(
key
);

2372 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"width");

2373 if(
key
)

2374 
£n
->
width
 = 
	`g_loÿË_to_utf8
((
gch¬
*)
key
,-1,
NULL
,NULL,NULL);

2375 
	`xmlF»e
(
key
);

2379 if(0=ğ
	`g_ascii_¡ºÿ£cmp
((
gch¬
*)
key
,"ENTRY",5))

2381 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"value");

2382 
	`xmlF»e
(
key
);

2383 
sss
->
ûÎty³
 = 
ENTRY
;

2385 if(!
	`g_ascii_¡ºÿ£cmp
((
gch¬
*)
key
,"OCOMBO",6))

2387 
sss
->
ûÎty³
 = 
OCOMBO
;

2388 
NextID
 *
nid
 = &
sss
->
v®ue
.
Ãxtid
;

2390 
AùiÚID
 *
aid
 = 
	`çùÜy_»ad_objeù_comobox_v®ue_äom_fe
(
©Œ_node
);

2391 if(
	`g_li¡_Ëngth
(
nid
->
aùli¡
) == 1)

2393 
AùiÚID
 *
exi¡s
 = 
nid
->
aùli¡
->
d©a
;

2394 *
exi¡s
 = *
aid
;

2397 
nid
->
aùli¡
 = 
	`g_li¡_­³nd
Òid->aùli¡,
aid
);

2399 if(!
	`g_ascii_¡ºÿ£cmp
((
gch¬
*)
key
,"OBTN",4))

2401 
sss
->
ûÎty³
 = 
OBTN
;

2402 
sss
->
isPoš‹r
 = 
TRUE
;

2403 
sss
->
Ãwdlg_func
 = 
çùÜy_ü—‹_objeùbu‰Ú_dŸlog
;

2404 
sss
->
şo£_func
 = 
çùÜy_§ve_objeùbu‰Ú_dŸlog
;

2405 
NextID
 *
nid
 = &
sss
->
v®ue
.
Ãxtid
;

2407 
	`g_li¡_ä“1
(
nid
->
aùli¡
);

2408 
nid
->
aùli¡
 = 
NULL
;

2409 
A‰ribu‹Node
 
obŠ_node
 = 
©Œ_node
->
xmlChd»nNode
;

2410 
obŠ_node
 !ğ
NULL
)

2412 ià(
	`xmlIsBÏnkNode
(
obŠ_node
))

2414 
obŠ_node
 = obŠ_node->
Ãxt
;

2417 iàĞ
obŠ_node
 && (
	`¡rcmp
((*èobŠ_node->
Çme
, "JL_item")==0) )

2419 
key
 = 
	`xmlG‘Prİ
(
obŠ_node
,(
xmlCh¬
 *)"name");

2420 if(
key
)

2422 
AùiÚID
 *
aid
 = 
	`çùÜy_»ad_objeù_comobox_v®ue_äom_fe
(
obŠ_node
);

2423 
nid
->
aùli¡
 = 
	`g_li¡_­³nd
Òid->aùli¡,
aid
);

2425 
	`xmlF»e
(
key
);

2427 
obŠ_node
 = obŠ_node->
Ãxt
;

2431 if(!
	`g_ascii_¡ºÿ£cmp
((
gch¬
*)
key
,"UBTN",6))

2433 
sss
->
ûÎty³
 = 
UCOMBO
;

2434 
SaveUniÚ
 *
su±r
 = &
sss
->
v®ue
.
suniÚ
;

2435 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"index");

2436 if(
key
)

2437 
su±r
->
šdex
 = 
	`©oi
((
gch¬
*)
key
);

2438 
	`xmlF»e
(
key
);

2439 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"type");

2440 if(
key
)

2441 
sss
->
ty³
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2442 
	`xmlF»e
(
key
);

2443 
GLi¡
 *
¦i¡
;

2444 if(
key
)

2447 
¦i¡
 = 
	`g_hash_bË_lookup
(
fşass
->
EnumsAndSŒuùs
->
uniÚTabË
,(
gch¬
*)
sss
->
ty³
);

2450 
	`g_hash_bË_š£¹
(
su±r
->
§veV®
,su±r->
curkey
,
sss
);

2453 
A‰ribu‹Node
 
obŠ_node
 = 
©Œ_node
->
xmlChd»nNode
;

2454 
obŠ_node
 !ğ
NULL
)

2456 ià(
	`xmlIsBÏnkNode
(
obŠ_node
))

2458 
obŠ_node
 = obŠ_node->
Ãxt
;

2461 iàĞ
obŠ_node
 && (
	`¡rcmp
((*èobŠ_node->
Çme
, "JL_item")==0) )

2465 
obŠ_node
 = obŠ_node->
Ãxt
;

2467 
FaùÜySŒuùI‹m
 *
Ãxtobj
 = 
	`g_li¡_Áh_d©a
(
¦i¡
,
su±r
->
šdex
);

2468 
su±r
->
¡ruùli¡
 = 
¦i¡
;

2470 if(!
Ãxtobj
)

2472 
su±r
->
curkey
 = 
	`g_¡rjoš
("##",
Ãxtobj
->
FTy³
,Ãxtobj->
Name
,
NULL
);

2473 
su±r
->
cu¹ext
 = 
	`g_¡rdup
(
Ãxtobj
->
Name
);

2474 
SaveSŒuù
 *
ns™m
 = 
	`çùÜy_g‘_§ve¡ruù
(
Ãxtobj
);

2475 if(
ns™m
)

2477 
ns™m
->
sşass
 = 
sss
->sclass;

2478 
SaveUbŠ
 *
sbŠ
 = &
ns™m
->
v®ue
.
ssubŠ
;

2479 
	`çùÜy_¡rjoš
(&
ns™m
->
Çme
,
sss
->name,".");

2482 
sbŠ
->
¡ruùli¡
 = 
Ãxtobj
->
d©®i¡
;

2483 
sbŠ
->
§v–i¡
 = 
NULL
;

2484 
	`çùÜy_»ad_uniÚ_bu‰Ú_äom_fe
(
sss
->
sşass
,
obŠ_node
->
´ev
,
sbŠ
);

2485 
	`g_hash_bË_š£¹
(
su±r
->
§veV®
,su±r->
curkey
,
ns™m
);

2489 if(!
	`g_ascii_¡ºÿ£cmp
((
gch¬
*)
key
,"BBTN",4))

2491 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

2492 
sss
->
ûÎty³
 = 
BBTN
;

2493 
sss
->
isPoš‹r
 = 
TRUE
;

2494 
sss
->
Ãwdlg_func
 = 
çùÜy_ü—‹_ba£bu‰Ú_dŸlog
;

2495 
sss
->
şo£_func
 = 
çùÜy_§ve_ba£bu‰Ú_dŸlog
;

2497 
	`çùÜy_hªdË_’Œy_™em
(
£y
,
f¡
);

2498 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"value");

2499 
	`g_li¡_ä“1
(
£y
->
d©a
);

2500 
£y
->
d©a
 = 
NULL
;

2501 if(
key
)

2503 
gch¬
 **
¥l™
 = 
	`g_¡r¥l™
((gch¬*)
key
,",",-1);

2504 
Ën
 = 
	`g_¡rv_Ëngth
(
¥l™
);

2505 
n
 = 0;

2506 ; 
n
 < 
Ën
;‚++)

2508 
£y
->
d©a
 = 
	`g_li¡_­³nd
(£y->d©a,
	`g_¡rdup
(
¥l™
[
n
]));

2510 
	`g_¡rä“v
(
¥l™
);

2512 
	`xmlF»e
(
key
);

2514 if(!
	`g_ascii_¡ºÿ£cmp
((
gch¬
*)
key
,"EBTN",4))

2516 
sss
->
ûÎty³
 = 
EBTN
;

2517 
	`çùÜy_š™®_ebŠ
(
sss
,
f¡
);

2518 
SaveEbŠ
 *
£bŠ
 = &
sss
->
v®ue
.
s£bŠ
;

2519 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"value");

2520 if(
key
)

2522 
gch¬
 **
¥l™
 = 
	`g_¡r¥l™
((gch¬*)
key
,",",-1);

2523 
Ën
 = 
	`g_¡rv_Ëngth
(
¥l™
);

2524 
n
 = 0;

2525 ; 
n
 < 
Ën
;‚++)

2527 
SaveEnumA¼
 *
£a
 = 
	`g_li¡_Áh_d©a
(
£bŠ
->
ebŠwli¡
,
n
);

2528 
SaveEnum
 *
£
 = 
£a
->
£num
;

2529 
£
->
ev®ue
 = 
	`g_¡rdup
(
¥l™
[
n
]);

2530 
GLi¡
 *
i¡
 = 
£bŠ
->
ebŠ¦i¡
;

2531 ; 
i¡
;li¡ =li¡->
Ãxt
)

2533 
FaùÜySŒuùEnum
 *
f£
 = 
i¡
->
d©a
;

2534 if(!
	`g_ascii_¡rÿ£cmp
(
f£
->
v®ue
,
£
->
ev®ue
))

2536 
£
->
šdex
 = 
	`g_li¡_šdex
(
£bŠ
->
ebŠ¦i¡
,
f£
);

2541 
	`g_¡rä“v
(
¥l™
);

2543 
	`xmlF»e
(
key
);

2547 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"value");

2548 if(
key
)

2549 
sss
->
v®ue
.
vnumb”
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2550 
	`xmlF»e
(
key
);

2551 
sss
->
ûÎty³
 = 
SPINBOX
;

2556 
	}
}

2558 
GLi¡
 *
	$çùÜy_g‘_li¡_äom_hashbË
(
STRUCTCÏss
 *
fşass
)

2560 
FaùÜySŒuùI‹mLi¡
 *
fs
 = 
	`g_hash_bË_lookup
(
fşass
->
EnumsAndSŒuùs
->
¡ruùTabË
,

2561 
fşass
->
–em’t
.
objeù
.
Çme
);

2562 
GLi¡
 *
i¡
 = 
NULL
;

2563 if(
fs
)

2564 
i¡
 = 
fs
->
li¡
;

2565  
i¡
;

2566 
	}
}

2568 
	$çùÜy_»ad_¥ecific_objeù_äom_fe
(
STRUCTCÏss
 *
fşass
,
ObjeùNode
 
obj_node
)

2571 
gch¬
 *
objÇme
 = 
fşass
->
–em’t
.
objeù
.
Çme
;

2572 if(!
	`g_ascii_¡rÿ£cmp
(
objÇme
,"FILELST"))

2574 
SaveMusicDŸlog
 *
smd
 = 
MusicMªag”DŸlog
;

2575 
A‰ribu‹Node
 
©Œ_node
 = 
obj_node
;

2576 
©Œ_node
 = 
	`d©a_Ãxt
(attr_node))

2578 
xmlCh¬
 *
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(xmlChar *)"name");

2579 if(
key
)

2581 if(!
	`g_ascii_¡rÿ£cmp
((
gch¬
*)
key
,"Music_File"))

2583 
SaveMusicFeMª
 *
smfm
 = 
MusicMªag”DŸlog
->smfm;

2584 if(!
smfm
)

2586 
smfm
 = 
	`g_Ãw0
(
SaveMusicFeMª
,1);

2587 
smfm
->
£Ëùed
 = -1;

2588 
MusicMªag”DŸlog
->
smfm
 = smfm;

2591 
	`çùÜy_»ad_fe_li¡_äom_xml
(
©Œ_node
->
xmlChd»nNode
);

2592 
	`çùÜy_fm_g‘_cboxli¡
(
smd
);

2596 
SaveMusicI‹m
 *
smi
 = 
	`g_Ãw0
(SaveMusicItem,1);

2597 
smi
->
id_šdex
 = 
	`g_¡¹od
((
gch¬
*)
key
,
NULL
);

2599 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"addr");

2600 
smi
->
id_addr
 = 
	`g_¡¹od
((
gch¬
*)
key
,
NULL
);

2602 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"active");

2604 
smi
->
aùive
 = 
	`g_¡¹od
((
gch¬
*)
key
,
NULL
);

2605 
smd
->
™emli¡
 = 
	`g_li¡_­³nd
(smd->™emli¡,
smi
);

2608 
	`xmlF»e
(
key
);

2612 if(!
©Œ_node
)

2618 
SaveIdDŸlog
 *
sid
 = 
IdDŸlog
;

2619 
A‰ribu‹Node
 
©Œ_node
 = 
obj_node
;

2620 
©Œ_node
 = 
	`d©a_Ãxt
(attr_node))

2622 
xmlCh¬
 *
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(xmlChar *)"name");

2623 if(!
key
) ;

2624 
SaveMusicI‹m
 *
smi
 = 
	`g_Ãw0
(SaveMusicItem,1);

2625 
smi
->
id_šdex
 = 
	`g_¡¹od
((
gch¬
*)
key
,
NULL
);

2626 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"addr");

2627 
smi
->
id_addr
 = 
	`g_¡¹od
((
gch¬
*)
key
,
NULL
);

2628 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"dname");

2629 
smi
->
dÇme
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2630 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"active");

2632 
smi
->
aùive
 = 
	`g_¡¹od
((
gch¬
*)
key
,
NULL
);

2633 
sid
->
idli¡s
 = 
	`g_li¡_­³nd
(sid->idli¡s,
smi
);

2638 
	}
}

2641 
	$çùÜy_»ad_fe_li¡_äom_xml
(
ObjeùNode
 
obj_node
)

2645 
SaveMusicFeMª
 *
smfm
 = 
MusicMªag”DŸlog
->smfm;

2646 
A‰ribu‹Node
 
©Œ_node
 = 
obj_node
;

2647 
©Œ_node
 = 
	`d©a_Ãxt
(attr_node))

2649 
xmlCh¬
 *
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(xmlChar *)"name");

2650 if(!
key
) ;

2652 
SaveMusicFe
 *
smf
 = 
	`g_Ãw0
(SaveMusicFile,1);

2653 
smf
->
šdex
 = 
	`g_¡¹od
((
gch¬
*)
key
,
NULL
);

2655 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"fname");

2656 
smf
->
fuÎ_Çme
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2658 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"addr");

2659 
smf
->
fe_addr
 = 
	`g_¡¹od
((
gch¬
*)
key
,
NULL
);

2661 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"dname");

2662 
smf
->
down_Çme
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2664 
gch¬
 **
¥l™
 = 
	`g_¡r¥l™
(
smf
->
fuÎ_Çme
,"\\",-1);

2665 
Ën
 = 
	`g_¡rv_Ëngth
(
¥l™
);

2666 
smf
->
ba£_Çme
 = 
	`g_¡rdup
(
¥l™
[
Ën
-1]);

2667 
	`g_¡rä“v
(
¥l™
);

2668 
smfm
->
f–i¡
 = 
	`g_li¡_­³nd
(smfm->f–i¡,
smf
);

2670 
	`xmlF»e
(
key
);

2673 if(!
©Œ_node
)

2675 
	}
}

2678 
	$çùÜy_»ad_v®ue_äom_xml
(
STRUCTCÏss
 *
fşass
,
ObjeùNode
 
obj_node
)

2685 
GLi¡
 *
i¡
 = 
	`çùÜy_g‘_li¡_äom_hashbË
(
fşass
);

2686 
GLi¡
 *
‰‰
 = 
i¡
;

2688 ; 
‰‰
 !ğ
NULL
 ;‰ˆğ‰‰->
Ãxt
)

2690 
FaùÜySŒuùI‹m
 *
f¡
 = 
‰‰
->
d©a
;

2691 
f¡
->
Ügşass
 = 
fşass
;

2692 
SaveSŒuù
 *
sss
 = 
	`çùÜy_g‘_§ve¡ruù
(
f¡
);

2693 
sss
->
widg‘1
 = 
NULL
;

2694 
sss
->
widg‘2
 = 
NULL
;

2695 
sss
->
Üg
 = 
f¡
;

2696 
sss
->
sşass
 = 
fşass
;

2697 
A‰ribu‹Node
 
©Œ_node
 = 
obj_node
;

2698 
©Œ_node
 = 
	`d©a_Ãxt
(attr_node))

2700 
xmlCh¬
 *
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(xmlChar *)"name");

2701 if(
key
)

2703 if(0 =ğ
	`g_ascii_¡rÿ£cmp
((
gch¬
*)
key
,
f¡
->
Name
))

2705 
sss
->
Çme
 = 
	`g_¡rdup
(
f¡
->
Name
);

2709 
	`xmlF»e
(
key
);

2712 if(!
©Œ_node
)

2715 
gch¬
 *
hkey
 = 
	`g_¡rjoš
("##",
f¡
->
FTy³
,f¡->
Name
,
NULL
);

2716 
	`çùÜy_»ad_objeù_v®ue_äom_fe
(
sss
,
f¡
,
©Œ_node
);

2717 
SaveSŒuù
 *
fœ¡v®
 = 
	`g_hash_bË_lookup
(
fşass
->
widg‘m­
,
hkey
);

2718 if(
fœ¡v®
)

2719 *
fœ¡v®
 = *
sss
;

2722 
	`g_hash_bË_š£¹
(
fşass
->
widg‘m­
,
	`g_¡rdup
(
hkey
),
sss
);

2723 
fşass
->
widg‘Save
 = 
	`g_li¡_­³nd
(fşass->widg‘Save,
sss
);

2726 
	`g_ä“
(
hkey
);

2729 
	}
}

2731 
gpoš‹r
 *
	$çùÜy_»ad_objeù_comobox_v®ue_äom_fe
(
A‰ribu‹Node
 
©Œ_node
)

2733 
xmlCh¬
 *
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(xmlChar *)"index");

2734 
AùiÚID
 *
aid
 = 
	`g_Ãw0
(ActionID,1);

2735 
aid
->
šdex
 = 
	`©oi
((
gch¬
*)
key
);

2736 
	`xmlF»e
(
key
);

2737 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"nvalue");

2738 
aid
->
´e_Çme
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2739 
	`xmlF»e
(
key
);

2740 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"name");

2741 
aid
->
t™Ë_Çme
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2742 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"value");

2743 
aid
->
v®ue
 = 
	`g_¡rdup
((
gch¬
*)
key
);

2744 
	`xmlF»e
(
key
);

2745  
aid
;

2746 
	}
}

2748 
	$çùÜy_š™®_ebŠ
(
SaveSŒuù
 *
sss
,cÚ¡ 
FaùÜySŒuùI‹m
 *
f¡
)

2750 
SaveEbŠ
 *
£bŠ
 = &
sss
->
v®ue
.
s£bŠ
;

2751 
£bŠ
->
ebŠ¦i¡
 = 
	`g_hash_bË_lookup
(
çùÜyCÚš”
->
’umTabË
,
f¡
->
STy³
);

2752 
£bŠ
->
ebŠwli¡
 = 
NULL
;

2753 
£bŠ
->
width
 = 
	`g_¡rdup
(
f¡
->
Max
);

2754 
sss
->
şo£_func
 = 
çùÜy_§ve_’umbu‰Ú_dŸlog
;

2755 
sss
->
Ãwdlg_func
 = 
çùÜy_ü—‹_’umbu‰Ú_dŸlog
;

2756 
GLi¡
 *
tm¶i¡
 = 
£bŠ
->
ebŠ¦i¡
;

2757 
šdex
 = 0;

2758 
gch¬
 *
v®ue
 = 
NULL
;

2759 
GLi¡
 *
fl_li¡
 = 
NULL
;

2760 ; 
tm¶i¡
;m¶i¡ =m¶i¡->
Ãxt
)

2762 
FaùÜySŒuùEnum
 *
kvm­
 = 
tm¶i¡
->
d©a
;

2763 if(!
	`g_ascii_¡rÿ£cmp
(
f¡
->
V®ue
,
kvm­
->
key
))

2765 
šdex
 = 
	`g_li¡_šdex
(
£bŠ
->
ebŠ¦i¡
,
kvm­
);

2766 
v®ue
 = 
kvm­
->value;

2768 
fl_li¡
 = 
	`g_li¡_­³nd
(fl_li¡,
kvm­
->
key
);

2770 
SaveEÁry
 
tmp
;

2771 
	`çùÜy_hªdË_’Œy_™em
(&
tmp
,
f¡
);

2772 
£bŠ
->
¬r_ba£
 = 
tmp
.arr_base;

2774 
GLi¡
 *
i¡
 = 
£bŠ
->
ebŠ¦i¡
;

2775 
GLi¡
 *
nixli¡
 = 
NULL
;

2776 
n
 = 0;

2777 
gch¬
 **
t™Ë
 = 
	`g_¡r¥l™
(
f¡
->
Name
,"[",-1);

2778 
gch¬
 *
Çme
 = 
	`g_¡rcÚÿt
(
t™Ë
[0],"(%d)",
NULL
);

2779 
	`g_¡rä“v
(
t™Ë
);

2781 
n
 = 0;

2782 ; 
n
 < 
£bŠ
->
¬r_ba£
->
»®Ën
;‚++)

2784 
SaveEnum
 *
£e
 = 
	`g_Ãw0
(SaveEnum,1);

2785 
£e
->
’umLi¡
 = 
fl_li¡
;

2786 
£e
->
šdex
 = index;

2787 
£e
->
ev®ue
 = 
v®ue
;

2788 
£e
->
width
 = 
f¡
->
Max
;

2789 
SaveEnumA¼
 *
£a
 = 
	`g_Ãw0
(SaveEnumArr,1);

2790 
£a
->
widg‘1
 = 
NULL
;

2791 
£a
->
widg‘2
 = 
NULL
;

2792 
£a
->
£num
 = 
£e
;

2793 
£bŠ
->
ebŠwli¡
 = 
	`g_li¡_­³nd
(£bŠ->ebŠwli¡,
£a
);

2795 
	}
}

2797 
SaveSŒuù
 * 
	$çùÜy_g‘_§ve¡ruù
(
FaùÜySŒuùI‹m
 *
f¡
)

2799 
SaveSŒuù
 *
sss
 = 
	`g_Ãw0
(SaveStruct,1);

2800 
sss
->
widg‘1
ğ
NULL
;

2801 
sss
->
widg‘2
 = 
NULL
;

2803 
sss
->
ty³
 = 
	`g_¡rdup
(
f¡
->
FTy³
);

2804 
sss
->
Çme
 = 
	`g_¡rdup
(
f¡
->
Name
);

2805 
sss
->
sşass
 = 
f¡
->
Ügşass
;

2806 
sss
->
şo£_func
 = 
NULL
;

2807 
sss
->
Ãwdlg_func
 = 
NULL
;

2809 if(!
	`g_ascii_¡rÿ£cmp
(
f¡
->
Mš
,
	`çùÜy_utf8
(
	`_
("¹Ì¶¨Öµ"))))

2811 
sss
->
isS’s™ive
 = 
FALSE
;

2814 
sss
->
isS’s™ive
 = 
TRUE
;

2821 if(!
	`g_ascii_¡ºÿ£cmp
(
sss
->
Çme
,
ACTION_ID
,
ACT_SIZE
))

2823 
sss
->
ûÎty³
 = 
OCOMBO
;

2824 
NextID
 *
nid
 = &
sss
->
v®ue
.
Ãxtid
;

2825 
nid
->
™emli¡
 = 
NULL
;

2826 
nid
->
aùli¡
 = 
NULL
;

2827 
nid
->
wli¡
 = 
NULL
;

2828 if(
	`g_¡r_has_suffix
(
sss
->
Çme
,"]"))

2830 
sss
->
ûÎty³
 = 
OBTN
;

2831 
sss
->
Ãwdlg_func
 = 
çùÜy_ü—‹_objeùbu‰Ú_dŸlog
;

2832 
sss
->
şo£_func
 = 
çùÜy_§ve_objeùbu‰Ú_dŸlog
;

2833 
SaveEÁry
 
tmp
;

2834 
	`çùÜy_hªdË_’Œy_™em
(&
tmp
,
f¡
);

2835 
nid
->
¬r_ba£
 = 
tmp
.arr_base;

2837 
gch¬
 **
t™Ë
 = 
	`g_¡r¥l™
(
sss
->
Çme
,"[",-1);

2838 
gch¬
 *
Çme
 = 
	`g_¡rcÚÿt
(
t™Ë
[0],"(%d)",
NULL
);

2839 
	`g_¡rä“v
(
t™Ë
);

2841 
n
 = 0;

2842 ; 
n
 < 
nid
->
¬r_ba£
->
»®Ën
;‚++ )

2844 
AùiÚID
 *
aid
 = 
	`g_Ãw0
(ActionID,1);

2845 
aid
->
šdex
 = 0;

2846 
aid
->
´e_Çme
 = 
	`g_¡rdup
("");

2847 
aid
->
v®ue
 = 
	`g_¡rdup
("-1");

2848 
aid
->
t™Ë_Çme
 = 
	`g_¡rdup_´štf
(
Çme
,
n
);

2849 
nid
->
aùli¡
 = 
	`g_li¡_­³nd
Òid->aùli¡,
aid
);

2851 
	`g_ä“
(
Çme
);

2855 
AùiÚID
 *
aid
 = 
	`g_Ãw0
(ActionID,1);

2856 
aid
->
šdex
 = 0;

2857 
aid
->
´e_Çme
 = 
	`g_¡rdup
("");

2858 
aid
->
v®ue
 = 
	`g_¡rdup
("-1");

2859 
aid
->
t™Ë_Çme
 = 
	`g_¡rdup
(
sss
->
Çme
);

2860 
nid
->
aùli¡
 = 
	`g_li¡_­³nd
Òid->aùli¡,
aid
);

2865 
f¡
->
Ity³
)

2867 
BT
:

2868 ifĞ
	`çùÜy_fšd_¬¿y_æag
(
f¡
->
Name
))

2871 
sss
->
ûÎty³
 = 
ENTRY
;

2873 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

2874 
	`çùÜy_hªdË_’Œy_™em
(
£y
,
f¡
);

2875 if(!
£y
->
isSŒšg
)

2877 
sss
->
ûÎty³
 = 
BBTN
;

2878 
sss
->
Ãwdlg_func
 = 
çùÜy_ü—‹_ba£bu‰Ú_dŸlog
;

2879 
sss
->
şo£_func
 = 
çùÜy_§ve_ba£bu‰Ú_dŸlog
;

2880 ifĞ2 =ğ
	`¡¾’
(
f¡
->
STy³
è&& !
	`g_ascii_¡rÿ£cmp
(fst->SType,"u1"))

2882 
n
 = 0 ;

2883 
maxi
 = 
£y
->
¬r_ba£
->
»®Ën
;

2884  ; 
n
 < 
maxi
;‚++)

2887 
£y
->
d©a
 = 
	`g_li¡_­³nd
(£y->d©a,
	`g_¡rdup_´štf
("%d",0));

2892 
gch¬
 *
fmt
 = 
NULL
;

2893 
Ën
 = 2;

2894 
£y
->
width
)

2897 
fmt
 = 
	`g_¡rdup
("0x%02x");

2898 
Ën
 = 4;

2901 
fmt
 = 
	`g_¡rdup
("0x%04x");

2902 
Ën
 = 6;

2905 
fmt
 = 
	`g_¡rdup
("0x%08x");

2906 
Ën
 = 6;

2909 
fmt
 = 
	`g_¡rdup
("0x%02x");

2911 
n
 = 0 ;

2912 
maxi
 = 
£y
->
¬r_ba£
->
»®Ën
;

2913 
fœ¡
 = 
	`g_¡¹od
(
f¡
->
V®ue
,
NULL
);

2914  ; 
n
 < 
maxi
;‚++)

2917 
gch¬
 *
tmp
 = 
	`g_¡rdup_´štf
(
fmt
,
fœ¡
);

2918 
tmp
[
Ën
]='\0';

2919 
£y
->
d©a
 = 
	`g_li¡_­³nd
(£y->d©a,
	`g_¡rdup
(
tmp
));

2920 
	`g_ä“
(
tmp
);

2922 
	`g_ä“
(
fmt
);

2929 
sss
->
ûÎty³
 = 
SPINBOX
;

2930 if(!
	`g_ascii_¡rÿ£cmp
(
f¡
->
Name
,"wActID"))

2932 
STRUCTCÏss
 *
sşass
 = 
f¡
->
Ügşass
;

2934 
sss
->
v®ue
.
vnumb”
 = 
	`g_¡rdup_´štf
("%d",
sşass
->
–em’t
.
objeù
.
ošdex
);

2935 
sss
->
isS’s™ive
 = 
FALSE
;

2939 
sss
->
v®ue
.
vnumb”
 = 
	`g_¡rdup
(
f¡
->
V®ue
);

2942 
ET
:

2944 ifĞ
	`çùÜy_fšd_¬¿y_æag
(
f¡
->
Name
))

2946 
sss
->
ûÎty³
 = 
EBTN
;

2947 
	`çùÜy_š™®_ebŠ
(
sss
,
f¡
);

2951 
sss
->
ûÎty³
 = 
ECOMBO
;

2952 
sss
->
v®ue
.
£num
.
’umLi¡
 = 
f¡
->
d©®i¡
;

2954 
GLi¡
 *
t
 = 
sss
->
v®ue
.
£num
.
’umLi¡
;

2955 ; 
t
 !ğ
NULL
 ; =->
Ãxt
)

2957 
FaùÜySŒuùEnum
 *
kvm­
 = 
t
->
d©a
;

2958 if(!
	`g_ascii_¡rÿ£cmp
(
f¡
->
V®ue
,
kvm­
->
key
))

2960 
sss
->
v®ue
.
£num
.
šdex
 = 
	`g_li¡_šdex
(
f¡
->
d©®i¡
,
kvm­
);

2961 
sss
->
v®ue
.
£num
.
width
 = 
	`g_¡rdup
(
f¡
->
Max
);

2962 
sss
->
v®ue
.
£num
.
ev®ue
 = 
	`g_¡rdup
(
kvm­
->value);

2967 if(!
t
 && !
sss
->
v®ue
.
£num
.
width
 )

2969 
sss
->
v®ue
.
£num
.
šdex
 = 0;

2970 
sss
->
v®ue
.
£num
.
width
 = 
	`g_¡rdup
(
f¡
->
Max
);

2971 
FaùÜySŒuùEnum
 *
kvm­
 = 
sss
->
v®ue
.
£num
.
’umLi¡
->
d©a
;

2972 
sss
->
v®ue
.
£num
.
ev®ue
 = 
	`g_¡rdup
(
kvm­
->value);

2980 
ST
:

2982 
sss
->
ûÎty³
 = 
UBTN
;

2983 
sss
->
isPoš‹r
 = 
TRUE
;

2985 if(!
	`g_¡rÿ£cmp
(
f¡
->
STy³
,"FILELST"))

2988 if(!
MusicMªag”DŸlog
)

2990 
MusicMªag”DŸlog
 = 
	`g_Ãw0
(
SaveMusicDŸlog
,1);

2991 
MusicMªag”DŸlog
->
t™Ë
 = 
	`çùÜy_utf8
("ÎÄ¼ş¹ÜÀí");

2992 
MusicMªag”DŸlog
->
smfm
 = 
NULL
;

2993 
MusicMªag”DŸlog
->
mfmos
 = &
mfmo_İts
;

2997 
SaveKV
 *
skv
 = 
	`g_Ãw0
(SaveKV,1);

2998 
MusicMªag”DŸlog
->
skv
 = skv;

2999 
skv
->
v®ue
 = 
	`g_¡rdup
(
f¡
->
V®ue
);

3000 
skv
->
¿dšdex
 = -1;

3001 
sss
->
v®ue
.
vnumb”
 = 
skv
;

3002 
MusicMªag”DŸlog
->
bŠÇme
 = 
	`g_¡rdup
(
f¡
->
CÇme
);

3003 
sss
->
Ãwdlg_func
 = 
çùÜy_fe_mªag”_dŸlog
;

3004 
sss
->
şo£_func
 = 
çùÜy_music_fe_mªag”_­¶y
;

3006 if(!
	`g_¡rÿ£cmp
(
f¡
->
STy³
,"IDLST"))

3009 if(!
IdDŸlog
)

3011 
IdDŸlog
 = 
	`g_Ãw0
(
SaveIdDŸlog
,1);

3013 
SaveKV
 *
skv
 = 
	`g_Ãw0
(SaveKV,1);

3014 
IdDŸlog
->
skv
 = skv;

3015 
skv
->
v®ue
 = 
	`g_¡rdup
(
f¡
->
V®ue
);

3016 
skv
->
¿dšdex
 = -1;

3017 
sss
->
v®ue
.
vnumb”
 = 
skv
;

3018 
sss
->
Ãwdlg_func
 = 
çùÜy_Ãw_idli¡_dŸlog
;

3019 
sss
->
şo£_func
 = 
çùÜy_§ve_idli¡_dŸlog
;

3023 
SaveUbŠ
 *
sbŠ
 = &
sss
->
v®ue
.
ssubŠ
;

3024 
sbŠ
->
¡ruùli¡
 = 
f¡
->
d©®i¡
;

3026 
sbŠ
->
§v–i¡
 = 
NULL
;

3027 
sss
->
Ãwdlg_func
 = 
çùÜy_ü—‹_uniÚbu‰Ú_dŸlog
;

3028 
sss
->
şo£_func
 = 
çùÜy_§ve_uniÚbu‰Ú_dŸlog
;

3032 
UT
:

3035 
SaveUniÚ
 *
su±r
 = &
sss
->
v®ue
.
suniÚ
;

3036 
sss
->
ûÎty³
 = 
UCOMBO
;

3037 
su±r
->
vbox
 = 
NULL
;

3038 
su±r
->
§veV®
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

3039 
su±r
->
curkey
 = 
	`g_¡rdup
("");

3040 
su±r
->
šdex
 = 0;

3041 
su±r
->
comobox
 = 
NULL
;

3042 
su±r
->
¡ruùli¡
 = 
f¡
->
d©®i¡
;

3043 
GLi¡
 *
p
 = 
su±r
->
¡ruùli¡
;

3045 
FaùÜySŒuùI‹m
 *
Ãxtobj
 = 
	`g_li¡_Áh_d©a
(
su±r
->
¡ruùli¡
,su±r->
šdex
);

3046 if(!
Ãxtobj
)

3048 
su±r
->
curkey
 = 
	`g_¡rjoš
("##",
Ãxtobj
->
FTy³
,Ãxtobj->
Name
,
NULL
);

3049 
SaveSŒuù
 *
ts¡
 = 
	`çùÜy_g‘_§ve¡ruù
(
Ãxtobj
);

3050 if(!
ts¡
)

3052 
ts¡
->
sşass
 = 
sss
->sclass;

3053 
	`çùÜy_¡rjoš
(&
ts¡
->
Çme
,
sss
->name,".");

3055 
	`g_hash_bË_š£¹
(
su±r
->
§veV®
,su±r->
curkey
,
ts¡
);

3056 if(
ts¡
->
isPoš‹r
 )

3058 
SaveUbŠ
 *
sbŠ
 = &
ts¡
->
v®ue
.
ssubŠ
;

3059 ifĞ!
	`g_li¡_Ëngth
(
sbŠ
->
§v–i¡
è&& sbŠ->
¡ruùli¡
)

3063 
GLi¡
 *
¦i¡
 = 
sbŠ
->
¡ruùli¡
;

3064 ; 
¦i¡
; sli¡ = sli¡->
Ãxt
)

3066 
FaùÜySŒuùI‹m
 *
o
 = 
¦i¡
->
d©a
;

3067 
SaveSŒuù
 *
s
 = 
	`çùÜy_g‘_§ve¡ruù
(
o
);

3068 
s
->
sşass
 = 
sss
->sclass;

3069 
	`çùÜy_¡rjoš
(&
s
->
Çme
,
sss
->name,".");

3070 
sbŠ
->
§v–i¡
 = 
	`g_li¡_­³nd
(sbŠ->§v–i¡,
s
);

3079 
sss
->
Üg
 = 
f¡
;

3080  
sss
;

3081 
	}
}

3098 
	$çùÜy_£t_®l_çùÜyşass
(
STRUCTCÏss
 *
fşass
,
gch¬
 *
Çme
)

3101 
GLi¡
 *
i¡
 = 
	`çùÜy_g‘_li¡_äom_hashbË
(
fşass
);

3104 ; 
i¡
;li¡ =li¡->
Ãxt
)

3106 
FaùÜySŒuùI‹m
 *
f¡
 = 
i¡
->
d©a
;

3107 
f¡
->
Ügşass
 = 
fşass
;

3109 
	}
}

3111 
	$çùÜy_»ad_š™Ÿl_to_¡ruù
(
STRUCTCÏss
 *
fşass
)

3115 
GLi¡
 *
‰‰
 = 
	`çùÜy_g‘_li¡_äom_hashbË
(
fşass
);

3116 
GLi¡
 * 
i¡
 = 
‰‰
 ;

3117 ; 
i¡
;li¡ =li¡->
Ãxt
)

3119 
FaùÜySŒuùI‹m
 *
f¡
 = 
i¡
->
d©a
;

3120 
f¡
->
Ügşass
 = 
fşass
;

3123 ; 
‰‰
 !ğ
NULL
 ;‰ˆğ‰‰->
Ãxt
)

3125 
FaùÜySŒuùI‹m
 *
f¡
 = 
‰‰
->
d©a
;

3126 
SaveSŒuù
 *
s¡
ğ
	`çùÜy_g‘_§ve¡ruù
(
f¡
);

3127 
	`g_hash_bË_š£¹
(
fşass
->
widg‘m­
,
	`g_¡rjoš
("##",
f¡
->
FTy³
,f¡->
Name
,
NULL
),
s¡
);

3128 
fşass
->
widg‘Save
 = 
	`g_li¡_­³nd
(fşass->widg‘Save,
s¡
);

3139 
	}
}

3144 
	$çùÜy_hªdË_’Œy_™em
(
SaveEÁry
* 
£y
,
FaùÜySŒuùI‹m
 *
f¡
)

3149 
A¼ayBa£Prİ
 *
abp
 = 
	`g_Ãw0
(ArrayBaseProp,1);

3150 
£y
->
¬r_ba£
 = 
abp
;

3151 
abp
->
»®Ën
 = 0;

3152 
gch¬
 **
ooo
 = 
	`g_¡r¥l™_£t
 (
f¡
->
Name
,"[]",-1);

3153 
num
 = 
	`g_¡rv_Ëngth
(
ooo
);

3155 
£y
->
width
 = 0;

3156 if(
	`g_ascii_i§Êum
(
f¡
->
STy³
[1]))

3157 
£y
->
width
 = 
	`g_¡¹od
(&
f¡
->
STy³
[1],
NULL
) / 8;

3161 if(
£y
->
width
 == 0 )

3162 
£y
->
width
 = 1;

3163 
abp
->
row
 = 1;

3164 if(
num
 >= 5)

3166 
abp
->
row
 = 
	`g_¡¹od
(
ooo
[1],
NULL
);

3167 
abp
->
cŞ
 = 
	`g_¡¹od
(
ooo
[3],
NULL
);

3168 
abp
->
»®Ën
 =‡bp->
row
 *‡bp->
cŞ
;

3172 
abp
->
cŞ
 = 
	`g_¡¹od
(
ooo
[1],
NULL
);

3173 
abp
->
»®Ën
 =‡bp->
cŞ
;

3175 
	`g_¡rä“v
(
ooo
);

3178 
£y
->
isSŒšg
 = !
	`g_ascii_¡ºÿ£cmp
(
f¡
->
STy³
,"s8",2è? 
TRUE
 : 
FALSE
;

3179 
¡¾’gth
 = 
£y
->
width
 * 
abp
->
row
 *‡bp->
cŞ
;

3180 if(
£y
->
isSŒšg
)

3182 
£y
->
d©a
 = 
	`g_Ãw0
(
gch¬
,
¡¾’gth
 );

3183 
£y
->
d©a
 = 
	`g_loÿË_to_utf8
(
f¡
->
V®ue
,
¡¾’gth
,
NULL
,NULL,NULL);

3188 ifĞ(
abp
->
row
 =ğ1è&& (abp->
cŞ
 > 8))

3191 
sq¹v
 = 
	`sq¹
(
abp
->
cŞ
);

3192 
modv
 = 
abp
->
cŞ
 % 8;

3193 if((
sq¹v
 * sq¹v =ğ
abp
->
cŞ
) && (sqrtv > 8))

3194 
abp
->
row
 =‡bp->
cŞ
 = 
sq¹v
;

3195 if(
modv
)

3197 
abp
->
row
 =‡bp->
cŞ
 / 8;

3198 
abp
->
row
++;

3199 
abp
->
cŞ
 = 8;

3203 
abp
->
row
 = 
£y
->
width
 * 2;

3204 
abp
->
cŞ
 =‡bp->cŞ /‡bp->
row
;

3211 
	}
}

3215 
	$¡ruùşass_de¡roy
(
STRUCTCÏss
 *
¡ruùşass
)

3218 
¡ruùşass
->
de¡royed
 = 
TRUE
;

3220 
	`dŸ_fÚt_uÄef
(
¡ruùşass
->
nÜm®_fÚt
);

3223 
	`dŸ_fÚt_uÄef
(
¡ruùşass
->
şas¢ame_fÚt
);

3227 
	`–em’t_de¡roy
(&
¡ruùşass
->
–em’t
);

3229 
	`g_ä“
(
¡ruùşass
->
Çme
);

3264 if(
¡ruùşass
->
widg‘m­
 && 
	`g_hash_bË_size
(structclass->widgetmap))

3266 
	`g_hash_bË_de¡roy
(
¡ruùşass
->
widg‘m­
);

3269 ià(
¡ruùşass
->
´İ”t›s_dŸlog
 !ğ
NULL
)

3271 
	`¡ruùşass_dŸlog_ä“
 (
¡ruùşass
->
´İ”t›s_dŸlog
);

3274 
	`g_li¡_ä“1
(
¡ruùşass
->
widg‘Save
);

3277 
	}
}

3279 
	$çùÜy_hashbË_cİy
(
gpoš‹r
 
key
,gpoš‹¸
v®ue
,gpoš‹¸
u£r_d©a
)

3281 
GHashTabË
 *
t
 = (GHashTabË *)
u£r_d©a
;

3282 
	`g_hash_bË_š£¹
(
t
,
key
,
v®ue
);

3283 
	}
}

3285 
DŸObjeù
 *

3286 
	$¡ruùşass_cİy
(
STRUCTCÏss
 *
¡ruùşass
)

3288 
i
;

3289 
STRUCTCÏss
 *
Ãw¡ruùşass
;

3290 
EËm’t
 *
–em
, *
Ãw–em
;

3291 
DŸObjeù
 *
Ãwobj
;

3295 
–em
 = &
¡ruùşass
->
–em’t
;

3297 
Ãw¡ruùşass
 = 
	`g_m®loc0
((
STRUCTCÏss
));

3298 
Ãw–em
 = &
Ãw¡ruùşass
->
–em’t
;

3299 
Ãwobj
 = &
Ãw–em
->
objeù
;

3301 
	`–em’t_cİy
(
–em
, 
Ãw–em
);

3303 
Ãw¡ruùşass
->
fÚt_height
 = 
¡ruùşass
->font_height;

3304 
Ãw¡ruùşass
->
ab¡¿ù_fÚt_height
 = 
¡ruùşass
->abstract_font_height;

3305 
Ãw¡ruùşass
->
pŞymÜphic_fÚt_height
 = 
¡ruùşass
->polymorphic_font_height;

3306 
Ãw¡ruùşass
->
şas¢ame_fÚt_height
 = 
¡ruùşass
->classname_font_height;

3307 
Ãw¡ruùşass
->
ab¡¿ù_şas¢ame_fÚt_height
 =

3308 
¡ruùşass
->
ab¡¿ù_şas¢ame_fÚt_height
;

3309 
Ãw¡ruùşass
->
comm’t_fÚt_height
 =

3310 
¡ruùşass
->
comm’t_fÚt_height
;

3312 
Ãw¡ruùşass
->
nÜm®_fÚt
 =

3313 
	`dŸ_fÚt_cİy
(
¡ruùşass
->
nÜm®_fÚt
);

3318 
Ãw¡ruùşass
->
şas¢ame_fÚt
 =

3319 
	`dŸ_fÚt_cİy
(
¡ruùşass
->
şas¢ame_fÚt
);

3325 
Ãw¡ruùşass
->
Çme
 = 
	`g_¡rdup
(
¡ruùşass
->name);

3346 
Ãw¡ruùşass
->
lše_width
 = 
¡ruùşass
->line_width;

3347 
Ãw¡ruùşass
->
‹xt_cŞÜ
 = 
¡ruùşass
->text_color;

3348 
Ãw¡ruùşass
->
lše_cŞÜ
 = 
¡ruùşass
->line_color;

3349 
Ãw¡ruùşass
->
fl_cŞÜ
 = 
¡ruùşass
->fill_color;

3389 
i
=0; i<
STRUCTCLASS_CONNECTIONPOINTS
; i++)

3391 
Ãwobj
->
cÚÃùiÚs
[
i
] = &
Ãw¡ruùşass
->connections[i];

3392 
Ãw¡ruùşass
->
cÚÃùiÚs
[
i
].
objeù
 = 
Ãwobj
;

3393 
Ãw¡ruùşass
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

3394 
Ãw¡ruùşass
->
cÚÃùiÚs
[
i
].
pos
 = 
¡ruùşass
->connections[i].pos;

3395 
Ãw¡ruùşass
->
cÚÃùiÚs
[
i
].
Ï¡_pos
 = 
¡ruùşass
->connections[i].last_pos;

3398 
	`¡ruùşass_ÿlcuÏ‹_d©a
(
Ãw¡ruùşass
);

3400 
i
 = 
STRUCTCLASS_CONNECTIONPOINTS
;

3425 #ifdeà
STRUCT_MAINPOINT


3426 
Ãwobj
->
cÚÃùiÚs
[
i
] = &
Ãw¡ruùşass
->cÚÃùiÚs[
STRUCTCLASS_CONNECTIONPOINTS
];

3427 
Ãw¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
objeù
 = 
Ãwobj
;

3428 
Ãw¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
cÚÃùed
 = 
NULL
;

3429 
Ãw¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
pos
 =

3430 
¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
pos
;

3431 
Ãw¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
Ï¡_pos
 =

3432 
¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
Ï¡_pos
;

3433 
Ãw¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
æags
 =

3434 
¡ruùşass
->
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
].
æags
;

3435 
i
++;

3438 
	`¡ruùşass_upd©e_d©a
(
Ãw¡ruùşass
);

3440 #ifdeà
DEBUG


3441 
	`¡ruùşass_§n™y_check
(
Ãw¡ruùşass
, "Copied");

3443 
Ãw¡ruùşass
->
EnumsAndSŒuùs
 = 
çùÜyCÚš”
;

3444 
Ãw¡ruùşass
->
widg‘m­
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

3445 
	`g_hash_bË_fÜ—ch
(
¡ruùşass
->
widg‘m­
,
çùÜy_hashbË_cİy
,
Ãw¡ruùşass
->widgetmap);

3446 
Ãw¡ruùşass
->
´İ”t›s_dŸlog
 = 
NULL
;

3448  &
Ãw¡ruùşass
->
–em’t
.
objeù
;

3449 
	}
}

3453 
	$çùÜy_ba£_™em_§ve
(
SaveSŒuù
 *
sss
,
ObjeùNode
 
ccc
)

3455 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
sss
->
Çme
);

3456 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"ty³", (xmlCh¬ *)
sss
->
ty³
);

3460 
sss
->
ûÎty³
)

3462 
ECOMBO
:

3463 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"wtype", (xmlChar *)"ECOMBO");

3464 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"width", (xmlCh¬ *)
sss
->
v®ue
.
£num
.
width
);

3465 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"v®ue", (xmlCh¬ *)
sss
->
v®ue
.
£num
.
ev®ue
);

3467 
ENTRY
:

3469 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"wtype", (xmlChar *)"ENTRY");

3470 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

3471 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"v®ue", (xmlCh¬ *)
£y
->
d©a
);

3474 
BBTN
:

3476 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"wtype", (xmlChar *)"BBTN");

3477 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

3478 
GLi¡
 *
i¡
 = 
£y
->
d©a
;

3479 
gch¬
 *
»t
 =
	`g_¡rdup
("");

3480 ; 
i¡
;li¡ =li¡->
Ãxt
)

3483 
gch¬
 *
p
 = 
	`g_¡rcÚÿt
(
	`g_¡rdup
(
»t
),
i¡
->
d©a
,g_¡rdup(","),
NULL
);

3484 
	`g_ä“
(
»t
);

3485 
»t
 = 
	`g_¡rdup
(
p
);

3486 
	`g_ä“
(
p
);

3488 
Ën
 = 
	`¡¾’
(
»t
);

3489 if(
»t
[
Ën
-1]==',')

3490 
»t
[
Ën
-1] = '\0';

3491 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"v®ue", (xmlCh¬ *)
»t
);

3494 
EBTN
:

3496 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"wtype", (xmlChar *)"EBTN");

3497 
SaveEbŠ
 *
£bŠ
 = &
sss
->
v®ue
.
s£bŠ
;

3498 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"width", (xmlCh¬ *)
£bŠ
->
width
);

3499 
GLi¡
 *
i¡
 = 
£bŠ
->
ebŠwli¡
;

3500 
gch¬
 *
»t
 =
	`g_¡rdup
("");

3502 ; 
i¡
;li¡ =li¡->
Ãxt
)

3505 
SaveEnumA¼
 *
£a
 = 
i¡
->
d©a
;

3506 
SaveEnum
 *
£
 = 
£a
->
£num
;

3507 
gch¬
 *
p
 = 
	`g_¡rcÚÿt
(
	`g_¡rdup
(
»t
),
£
->
ev®ue
,g_¡rdup(","),
NULL
);

3508 
	`g_ä“
(
»t
);

3509 
»t
 = 
	`g_¡rdup
(
p
);

3510 
	`g_ä“
(
p
);

3512 
Ën
 = 
	`¡¾’
(
»t
);

3513 if(
»t
[
Ën
-1]==',')

3514 
»t
[
Ën
-1] = '\0';

3515 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"v®ue", (xmlCh¬ *)
»t
);

3519 
SPINBOX
:

3520 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"wtype", (xmlChar *)"SPINBOX");

3521 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"v®ue", (xmlCh¬ *)
sss
->
v®ue
.
vnumb”
);

3525 
	}
}

3527 
	$çùÜy_wr™e_objeù_comobox
(
AùiÚID
 *
aid
,
ObjeùNode
 
ccc
 )

3529 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
aid
->
t™Ë_Çme
);

3531 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"šdex", (xmlCh¬ *)
	`g_¡rdup_´štf
(
	`_
("%d"),
aid
->
šdex
));

3534 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"v®ue", (xmlCh¬ *)
aid
->
v®ue
);

3537 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"nv®ue", (xmlCh¬ *)
aid
->
´e_Çme
);

3538 
	}
}

3540 
	$çùÜy_ba£_¡ruù_§ve_to_fe
(
SaveSŒuù
 *
sss
,
ObjeùNode
 
obj_node
)

3542 
sss
->
ûÎty³
)

3544 
ECOMBO
:

3545 
ENTRY
:

3546 
BBTN
:

3547 
EBTN
:

3548 
SPINBOX
:

3551 
ObjeùNode
 
ccc
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_item", NULL);

3552 
	`çùÜy_ba£_™em_§ve
(
sss
,
ccc
);

3555 
OCOMBO
:

3558 
ObjeùNode
 
ccc
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_item", NULL);

3559 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"ty³", (xmlCh¬ *)
sss
->
ty³
);

3560 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"wtype", (xmlChar *)"OCOMBO");

3561 
NextID
 *
nid
 = &
sss
->
v®ue
.
Ãxtid
;

3562 
GLi¡
 *
i¡
 = 
nid
->
aùli¡
;

3563 
AùiÚID
 *
aid
 = 
	`g_li¡_fœ¡
(
i¡
)->
d©a
;

3564 if(
	`¡¾’
(
aid
->
´e_Çme
 )> 0)

3566 
STRUCTCÏss
 *
fşass
 = 
	`çùÜy_fšd_dŸobjeù_by_Çme
(
curLay”
,
aid
->
´e_Çme
);

3567 if(
fşass
 )

3569 
aid
->
v®ue
 = 
	`g_¡rdup_´štf
("%d",
fşass
->
–em’t
.
objeù
.
ošdex
);

3572 
	`çùÜy_wr™e_objeù_comobox
(
aid
,
ccc
);

3575 
OBTN
:

3577 
NextID
 *
nid
 = &
sss
->
v®ue
.
Ãxtid
;

3578 
GLi¡
 *
i¡
 = 
nid
->
aùli¡
;

3579 
ObjeùNode
 
obŠ
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_obtn", NULL);

3580 
	`xmlS‘Prİ
(
obŠ
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
sss
->
Çme
);

3581 
	`xmlS‘Prİ
(
obŠ
, (cÚ¡ 
xmlCh¬
 *)"wtype", (xmlChar *)"OBTN");

3582 ; 
i¡
;li¡ =li¡->
Ãxt
)

3584 
AùiÚID
 *
aid
 = 
i¡
->
d©a
;

3585 
ObjeùNode
 
ccc
 = 
	`xmlNewChd
(
obŠ
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_item", NULL);

3586 
	`xmlS‘Prİ
(
obŠ
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
sss
->
Çme
);

3587 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"ty³", (xmlCh¬ *)
sss
->
ty³
);

3588 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"wtype", (xmlChar *)"OCOMBO");

3589 
STRUCTCÏss
 *
fşass
 = 
	`çùÜy_fšd_dŸobjeù_by_Çme
(
curLay”
,
aid
->
´e_Çme
);

3590 if(
fşass
 && fşass->
widg‘Save
->
d©a
)

3592 
SaveSŒuù
 *
tmp
 = 
fşass
->
widg‘Save
->
d©a
;

3593 
aid
->
v®ue
 = 
	`g_¡rdup
(
tmp
->v®ue.
vnumb”
);

3595 
	`çùÜy_wr™e_objeù_comobox
(
i¡
->
d©a
,
ccc
);

3599 
UCOMBO
:

3601 
SaveUniÚ
 *
su±r
 = &
sss
->
v®ue
.
suniÚ
;

3602 
SaveSŒuù
 *
ts¡
 = 
	`g_hash_bË_lookup
(
su±r
->
§veV®
,su±r->
curkey
);

3603 if(
ts¡
)

3605 
ObjeùNode
 
ccc
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_union", NULL);

3606 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
sss
->
Çme
);

3607 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"ty³", (xmlCh¬ *)
sss
->
ty³
);

3608 if(
ts¡
->
isPoš‹r
)

3610 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"wtype", (xmlChar *)"UBTN");

3611 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"šdex", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
su±r
->
šdex
));

3612 
	`çùÜy_ba£_¡ruù_§ve_to_fe
(
ts¡
,
ccc
);

3616 
ObjeùNode
 
¯a
 = 
	`xmlNewChd
(
ccc
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_union", NULL);

3617 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"ty³", (xmlCh¬ *)
ts¡
->
ty³
);

3618 
	`çùÜy_ba£_™em_§ve
(
ts¡
,
¯a
);

3624 
UBTN
:

3626 
gch¬
 **
¥l™
 = 
	`g_¡r¥l™
(
sss
->
ty³
,".",-1);

3627 
gch¬
 *
¡y³
 = 
¥l™
[
	`g_¡rv_Ëngth
(split)-1];

3628 if(
	`çùÜy_is_¥ecŸl_objeù
(
¡y³
))

3630 
ObjeùNode
 
ccc
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_item", NULL);

3631 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
sss
->
Çme
);

3632 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"type", (xmlChar *)"u16");

3633 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"wty³", (xmlCh¬ *)
sss
->
ty³
);

3635 
SaveKV
 *
skv
 = 
sss
->
v®ue
.
vnumb”
;

3636 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"v®ue", (xmlCh¬ *)
skv
->
v®ue
);

3637 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"šdex", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
skv
->
¿dšdex
));

3638 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"vÇme", (xmlCh¬ *)
skv
->
vÇme
);

3643 
SaveUbŠ
 *
sbŠ
 = &
sss
->
v®ue
.
ssubŠ
;

3645 
GLi¡
 *
¦i¡
 = 
sbŠ
->
§v–i¡
;

3646 if(
¦i¡
)

3648 ; 
¦i¡
; sli¡ = sli¡->
Ãxt
)

3650 
SaveSŒuù
 *
s
 = 
¦i¡
->
d©a
;

3651 
	`çùÜy_ba£_¡ruù_§ve_to_fe
(
s
,
obj_node
);

3655 
	`g_¡rä“v
(
¥l™
);

3661 
	}
}

3663 
	$çùÜy_¡ruù_§ve_to_xml
(
gpoš‹r
 
key
,gpoš‹¸
v®ue
,gpoš‹¸
u£r_d©a
)

3666 
SaveSŒuù
 *
sss
 = (SaveSŒuù*)
v®ue
;

3667 
	`çùÜy_ba£_¡ruù_§ve_to_fe
(
sss
,
u£r_d©a
);

3668 
	}
}

3672 
DŸObjeù
 *

3673 
	$çùÜy_¡ruù_™ems_lßd
(
ObjeùNode
 
obj_node
,
v”siÚ
, cÚ¡ *
f’ame
)

3675 
STRUCTCÏss
 *
¡ruùşass
;

3676 
EËm’t
 *
–em
;

3677 
DŸObjeù
 *
obj
;

3678 
A‰ribu‹Node
 
©Œ_node
;

3679 
i
;

3681 
¡ruùşass
 = 
	`g_m®loc0
((
STRUCTCÏss
));

3682 
–em
 = &
¡ruùşass
->
–em’t
;

3683 
obj
 = &
–em
->
objeù
;

3684 
obj
->
ty³
 = &
¡ruùşass_ty³
;

3685 
obj
->
İs
 = &
¡ruùşass_İs
;

3686 
obj
->
ty³
->
v”siÚ
 = 
	`g_¡rdup
(
çùÜyCÚš”
->
fe_v”siÚ
);

3687 
	`–em’t_lßd
(
–em
, 
obj_node
);

3688 if(!
curLay”
)

3689 
curLay”
 = 
çùÜyCÚš”
->curLayer;

3690 #ifdeà
STRUCT_MAINPOINT


3691 
	`–em’t_š™
(
–em
, 8, 
STRUCTCLASS_CONNECTIONPOINTS
 + 1);

3693 
	`–em’t_š™
(
–em
, 8, 
STRUCTCLASS_CONNECTIONPOINTS
);

3696 
¡ruùşass
->
´İ”t›s_dŸlog
 = 
NULL
;

3698 
i
=0; i<
STRUCTCLASS_CONNECTIONPOINTS
; i++)

3700 
obj
->
cÚÃùiÚs
[
i
] = &
¡ruùşass
->connections[i];

3701 
¡ruùşass
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

3702 
¡ruùşass
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

3705 
¡ruùşass
->
widg‘m­
 = 
	`g_hash_bË_Ãw_fuÎ
(
g_¡r_hash
,
g_¡r_equ®
,
g_ä“
,g_free);

3706 
¡ruùşass
->
widg‘Save
 = 
NULL
;

3707 
	`fl_š_fÚtd©a
(
¡ruùşass
);

3710 
	`objeù_lßd_´İs
(
obj
,
obj_node
);

3720 
¡ruùşass
->
fl_cŞÜ
 = 
cŞÜ_wh™e
;

3721 
©Œ_node
 = 
	`çùÜy_fšd_cu¡om_node
(
obj_node
,"JL_struct");

3722 if(
©Œ_node
)

3725 
xmlCh¬
 *
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(xmlChar *)"name");

3726 ià(
key
)

3728 
¡ruùşass
->
–em’t
.
objeù
.
Çme
 = 
	`g_¡rdup
((
gch¬
*)
key
);

3729 
	`xmlF»e
 (
key
);

3731 
key
 = 
	`xmlG‘Prİ
(
©Œ_node
,(
xmlCh¬
 *)"vname");

3732 if(
key
)

3734 
¡ruùşass
->
Çme
 = 
	`g_¡rdup
((
gch¬
*)
key
);

3735 
	`xmlF»e
 (
key
);

3741 
	`fl_š_fÚtd©a
(
¡ruùşass
);

3743 
	`¡ruùşass_ÿlcuÏ‹_d©a
(
¡ruùşass
);

3745 
–em
->
exŒa_¥acšg
.
bÜd”_Œªs
 = 
¡ruùşass
->
lše_width
/2.0;

3746 
	`¡ruùşass_upd©e_d©a
(
¡ruùşass
);

3748 
i
=0; i<8; i++)

3750 
obj
->
hªdËs
[
i
]->
ty³
 = 
HANDLE_NON_MOVABLE
;

3753 #ifdeà
DEBUG


3756 
¡ruùşass
->
EnumsAndSŒuùs
 = 
NULL
;

3757 
¡ruùşass
->
EnumsAndSŒuùs
 = 
çùÜyCÚš”
;

3758 
¡ruùşass
->
isIn™Ÿl
 = 
TRUE
;

3761 
s
 = 
	`g_hash_bË_size
(
¡ruùşass
->
widg‘m­
);

3762 if(
	`çùÜy_is_¥ecŸl_objeù
(
obj
->
Çme
))

3764 if(!
MusicMªag”DŸlog
)

3766 
MusicMªag”DŸlog
 = 
	`g_Ãw0
(
SaveMusicDŸlog
,1);

3767 
MusicMªag”DŸlog
->
t™Ë
 = 
	`çùÜy_utf8
("ÎÄ¼ş¹ÜÀí");

3768 
MusicMªag”DŸlog
->
smfm
 = 
NULL
;

3769 
MusicMªag”DŸlog
->
mfmos
 = &
mfmo_İts
;

3773 if(!
IdDŸlog
)

3775 
IdDŸlog
 = 
	`g_Ãw0
(
SaveIdDŸlog
,1);

3777 
	`çùÜy_»ad_¥ecific_objeù_äom_fe
(
¡ruùşass
,
©Œ_node
->
xmlChd»nNode
);

3778 
	`¡ruùşass_de¡roy
(
¡ruùşass
) ;

3779  
NULL
;

3782 
	`çùÜy_»ad_v®ue_äom_xml
(
¡ruùşass
,
©Œ_node
->
xmlChd»nNode
);

3783 
curLay”
->
deâames
 = 
	`g_li¡_­³nd
(curLay”->deâames,
¡ruùşass
->
Çme
);

3784  &
¡ruùşass
->
–em’t
.
objeù
;

3785 
	}
}

3788 
	$çùÜy_¡ruù_™ems_§ve
(
STRUCTCÏss
 *
¡ruùşass
, 
ObjeùNode
 
obj_node
,

3789 cÚ¡ *
f’ame
)

3791 
	`–em’t_§ve
(&
¡ruùşass
->
–em’t
, 
obj_node
);

3794 
gch¬
 *
objÇme
 = 
¡ruùşass
->
–em’t
.
objeù
.
Çme
;

3795 
obj_node
 = 
	`xmlNewChd
(obj_node, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_struct", NULL);

3796 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
objÇme
);

3797 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"vÇme", (xmlCh¬ *)
¡ruùşass
->
Çme
);

3798 
FaùÜySŒuùI‹mLi¡
 *
fsi
 = 
	`g_hash_bË_lookup
(
¡ruùşass
->
EnumsAndSŒuùs
->
¡ruùTabË
,

3799 
objÇme
);

3800 if(
fsi
)

3801 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"fe", (xmlCh¬ *)
fsi
->
sfe
);

3803 if(!
	`g_¡rÿ£cmp
(
fsi
->
¢ame
,"FILELST"))

3806 if(!
MusicMªag”DŸlog
 || !MusicMªag”DŸlog->
™emli¡
)

3808 
gch¬
 *
rows
 = 
	`g_¡rdup_´štf
("%d",
	`g_li¡_Ëngth
(
MusicMªag”DŸlog
->
™emli¡
));

3809 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"rows", (xmlCh¬ *)
rows
);

3810 
	`g_ä“
(
rows
);

3811 
GLi¡
 *
æi¡
 = 
MusicMªag”DŸlog
->
™emli¡
;

3812 ; 
æi¡
; fli¡ = fli¡->
Ãxt
)

3814 
SaveMusicI‹m
 *
smi
 = 
æi¡
->
d©a
;

3815 
ObjeùNode
 
ccc
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_item", NULL);

3816 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
smi
->
id_šdex
));

3817 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"type", (xmlChar *)"u16");

3818 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"v®ue", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
smi
->
aùive
 ? smi->active : -1));

3819 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"addr", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
smi
->
id_addr
));

3820 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"aùive", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
smi
->
aùive
));

3823 
ObjeùNode
 
Ãwobj
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"Music_File", NULL);

3825 
	`xmlS‘Prİ
(
Ãwobj
, (cÚ¡ 
xmlCh¬
 *)"name",

3826 (
xmlCh¬
 *)"Music_File");

3827 
	`xmlS‘Prİ
(
Ãwobj
, (cÚ¡ 
xmlCh¬
 *)"offset",

3828 (
xmlCh¬
 *)
	`g_¡rdup_´štf
("%d",
MusicMªag”DŸlog
->
smfm
->
off£t
));

3829 
æi¡
 = 
MusicMªag”DŸlog
->
smfm
->
f–i¡
;

3830 ; 
æi¡
; fli¡ = fli¡->
Ãxt
)

3832 
SaveMusicFe
 *
smf
 = 
æi¡
->
d©a
;

3833 
ObjeùNode
 
Šode
 = 
	`xmlNewChd
(
Ãwobj
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"file", NULL);

3834 
	`xmlS‘Prİ
(
Šode
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
smf
->
šdex
));

3835 
	`xmlS‘Prİ
(
Šode
, (cÚ¡ 
xmlCh¬
 *)"addr", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
smf
->
fe_addr
));

3836 
	`xmlS‘Prİ
(
Šode
, (cÚ¡ 
xmlCh¬
 *)"âame", (xmlCh¬ *)
smf
->
fuÎ_Çme
);

3837 
	`xmlS‘Prİ
(
Šode
, (cÚ¡ 
xmlCh¬
 *)"dÇme", (xmlCh¬ *)
smf
->
down_Çme
);

3840 if(!
	`g_¡rÿ£cmp
(
fsi
->
¢ame
,"IDLST"))

3842 if(!
IdDŸlog
 || !IdDŸlog->
idli¡s
)

3844 
gch¬
 *
rows
 = 
	`g_¡rdup_´štf
("%d",
	`g_li¡_Ëngth
(
IdDŸlog
->
idli¡s
));

3845 
	`xmlS‘Prİ
(
obj_node
, (cÚ¡ 
xmlCh¬
 *)"rows", (xmlCh¬ *)
rows
);

3846 
	`g_ä“
(
rows
);

3847 
GLi¡
 *
idli¡
 = 
IdDŸlog
->
idli¡s
;

3848 ; 
idli¡
; idli¡ = idli¡->
Ãxt
)

3850 
SaveIdI‹m
 *
s™
 =
idli¡
->
d©a
;

3851 
ObjeùNode
 
ccc
 = 
	`xmlNewChd
(
obj_node
, 
NULL
, (cÚ¡ 
xmlCh¬
 *)"JL_item", NULL);

3852 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"Çme", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
s™
->
id_šdex
));

3853 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"type", (xmlChar *)"u16");

3854 
gch¬
 *
v®
 = "-1";

3855 if(
s™
->
aùive
>0)

3857 
STRUCTCÏss
 *
tÿlss
 = 
	`çùÜy_g‘_objeù_äom_Ïy”
(
curLay”
,
s™
->
dÇme
);

3858 if(
tÿlss
)

3860 
SaveSŒuù
 *
s¡
 = 
tÿlss
->
widg‘Save
->
d©a
;

3861 
v®
 = 
	`g_¡rdup
(
s¡
->
v®ue
.
vnumb”
);

3864 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"v®ue", (xmlCh¬ *)
v®
);

3865 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"addr", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
s™
->
id_addr
));

3866 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"dÇme", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
s™
->
dÇme
));

3867 
	`xmlS‘Prİ
(
ccc
, (cÚ¡ 
xmlCh¬
 *)"aùive", (xmlCh¬ *)
	`g_¡rdup_´štf
("%d",
s™
->
aùive
));

3872 
GLi¡
 *
§veLi¡
 = 
¡ruùşass
->
widg‘Save
;

3874 ; 
§veLi¡
; saveLi¡ = saveLi¡->
Ãxt
)

3876 
	`çùÜy_ba£_¡ruù_§ve_to_fe
(
§veLi¡
->
d©a
,
obj_node
);

3881 
	}
}

4188 
	$¡ruùşass_num_dyÇmic_cÚÃùiÚpošts
(
STRUCTCÏss
 *
¡ruùşass
)

4190 
num
 = 0;

4202  
num
;

4203 
	}
}

4206 
	$¡ruùşass_§n™y_check
(
STRUCTCÏss
 *
c
, 
gch¬
 *
msg
)

4208 #ifdeà
STRUCT_MAINPOINT


4209 
num_fixed_cÚÃùiÚs
 = 
STRUCTCLASS_CONNECTIONPOINTS
 + 1;

4211 
num_fixed_cÚÃùiÚs
 = 
STRUCTCLASS_CONNECTIONPOINTS
;

4213 
DŸObjeù
 *
obj
 = (DŸObjeù*)
c
;

4215 
i
;

4220 
	`dŸ_as£¹_Œue
(
num_fixed_cÚÃùiÚs
 + 
	`¡ruùşass_num_dyÇmic_cÚÃùiÚpošts
(
c
)

4221 =ğ
obj
->
num_cÚÃùiÚs
,

4223 
msg
, 
c
, 
obj
->
num_cÚÃùiÚs
, 
num_fixed_cÚÃùiÚs
,

4224 
	`¡ruùşass_num_dyÇmic_cÚÃùiÚpošts
(
c
));

4226 
i
 = 0; i < 
STRUCTCLASS_CONNECTIONPOINTS
; i++)

4228 
	`dŸ_as£¹_Œue
(&
c
->
cÚÃùiÚs
[
i
] =ğ
obj
->connections[i],

4230 
msg
, 
c
, 
i
, &c->
cÚÃùiÚs
[i], 
obj
->connections[i]);

4233 #ifdeà
STRUCT_MAINPOINT


4234 
	`dŸ_as£¹_Œue
(&
c
->
cÚÃùiÚs
[
i
] ==

4235 
obj
->
cÚÃùiÚs
[
i
 + 
	`¡ruùşass_num_dyÇmic_cÚÃùiÚpošts
(
c
)],

4237 
msg
, 
c
, 
i
, &c->
cÚÃùiÚs
[i],

4238 
obj
->
cÚÃùiÚs
[
i
 + 
	`¡ruùşass_num_dyÇmic_cÚÃùiÚpošts
(
c
)],

4239 
i
 + 
	`¡ruùşass_num_dyÇmic_cÚÃùiÚpošts
(
c
));

4243 
i
 = 0;

4282 
	}
}

	@O:\tool\dvs50\objects\Struct\struct_class.h

24 #iâdeà
CLASS_H


25 
	#CLASS_H


	)

27 
	~"objeù.h
"

28 
	~"–em’t.h
"

29 
	~"cÚÃùiÚpošt.h
"

30 
	~"widg‘s.h
"

32 
	~"¡ruù.h
"

33 
	~"di¥Ïy.h
"

34 
	#DIA_OBJECT
(
x
è(
DŸObjeù
*)(x)

	)

38 
	#STRUCTCLASS_CONNECTIONPOINTS
 8

	)

40 
	#STRUCTCLASS_WRAP_AFTER_CHAR
 40

	)

42 
	#STRUCTCLASS_COMMENT_LINE_LENGTH
 40

	)

54 
	#STRUCT_MAINPOINT
 1

	)

56 
	#ACTION_ID
 "NextID"

	)

58 
	#ACT_SIZE
 6

	)

63 
Lay”
 *
	gcurLay”
;

64 
_STRUCTCÏss
 
	tSTRUCTCÏss
;

65 
_STRUCTCÏssDŸlog
 
	tSTRUCTCÏssDŸlog
;

73 
	s_STRUCTCÏssDŸlog


75 
GtkWidg‘
 *
	mdŸlog
;

76 
GtkWidg‘
 *
	mmašTabË
;

80 
_FaùÜyCÏssDŸlog
 
	tFaùÜyCÏssDŸlog
;

82 
	s_FaùÜyCÏssDŸlog


84 
GtkWidg‘
 *
	mdŸlog
;

88 
FaùÜySŒuùI‹mAÎ
 *
	mEnumsAndSŒuùs
 ;

89 
GtkWidg‘
 *
	mmašTabË
;

94 
_SaveSŒuù
 
	tSaveSŒuù
;

96 (*
	tClo£Widg‘AndSave
)(
	tGtkWidg‘
 *
	twidg‘
,
	tgšt
 
	t»¥Ú£_id
,
	tgpoš‹r
 
	tu£r_d©a
);

97 (*
	tC»©eNewDŸlog
)(
	tgpoš‹r
 
	t™em
,
	tSaveSŒuù
 *
	ts¡
);

103 
ECOMBO
,

104 
UCOMBO
,

105 
OCOMBO
,

106 
ENTRY
,

107 
SPINBOX
,

108 
BBTN
,

109 
UBTN
,

110 
OBTN
,

111 
EBTN
,

112 
SBTN


113 } 
	tC–lTy³
;

115 
_AùiÚId
 
	tAùiÚID
;

116 
	s_AùiÚId


118 
šdex
;

119 
gch¬
* 
v®ue
;

120 
gch¬
 *
´e_Çme
;

121 
gch¬
 *
t™Ë_Çme
;

125 
_A¼ayBa£Prİ
 
	tA¼ayBa£Prİ
 ;

126 
	s_A¼ayBa£Prİ


128 
row
;

129 
cŞ
;

130 
»®Ën
;

133 
_NextId
 
	tNextID
;

134 
	s_NextId


136 
GLi¡
 *
™emli¡
;

137 
GLi¡
 *
aùli¡
;

138 
GLi¡
 *
wli¡
;

139 
A¼ayBa£Prİ
 *
¬r_ba£
;

142 
_CheckSave
 
	tCheckSave
;

143 
	s_CheckSave


145 
gch¬
 *
ObjName
;

146 
gboŞ—n
 
isChecked
;

164 
_SaveKV
 
	tSaveKV
;

165 
	s_SaveKV


167 
gch¬
 *
v®ue
;

168 
gch¬
 *
vÇme
;

169 
¿dšdex
;

173 
_SaveIdDŸlog
 
	tSaveIdDŸlog
;

174 
	s_SaveIdDŸlog


176 
GtkWidg‘
 *
·»Á_bŠ
;

177 
GtkWidg‘
 *
vbox
;

178 
GLi¡
 *
idli¡s
;

179 
gch¬
 *
t™Ë
;

180 
SaveKV
 *
skv
;

182 
GSLi¡
 *
grou¶i¡
;

185 
SaveIdDŸlog
 *
IdDŸlog
;

190 
_SaveMusicFe
 
	tSaveMusicFe
;

191 
	s_SaveMusicFe


193 
šdex
;

194 
fe_addr
;

195 
gch¬
* 
ba£_Çme
;

196 
gch¬
* 
fuÎ_Çme
;

197 
gch¬
* 
down_Çme
;

201 
_SaveMusicFeMª
 
	tSaveMusicFeMª
;

202 
	s_SaveMusicFeMª


204 
numb”
;

205 
off£t
;

206 
£Ëùed
;

207 
gch¬
 *
Ï¡Dœ
;

208 
GtkWidg‘
 *
İ’dlg
;

209 
GLi¡
 *
f–i¡
;

210 
GtkWidg‘
 *
wid_off£t
;

211 
GtkWidg‘
 *
wid_şi¡
;

214 
OPT_APPEND
,

215 
OPT_INSERT


216 } 
mª_İt
;

220 
SEQUENCE
,

221 
INDEX
,

222 
PHY


223 }
	tFMSaveTy³
; ;

229 
_MusicFeMªag”O±s
 
	tMusicFeMªag”O±s
;

230 
_SaveMusicDŸlog
 
	tSaveMusicDŸlog
;

231 
	s_SaveMusicDŸlog


233 
gch¬
 *
t™Ë
;

234 
gch¬
 *
bŠÇme
;

235 
FMSaveTy³
 
fm¡
;

238 
SaveKV
 *
skv
;

239 
GtkWidg‘
 *
Ëávbox
;

240 
GSLi¡
 *
grou¶i¡
;

241 
GLi¡
 *
™emli¡
;

242 
GLi¡
 *
cboxli¡
;

243 
GtkWidg‘
 *
·»Á_bŠ
;

244 
GtkWidg‘
 *
wšdow
;

245 
SaveMusicFeMª
 *
smfm
;

246 
MusicFeMªag”O±s
 *
mfmos
;

252 (*
	tO³nDŸlog
)(
	tSaveMusicDŸlog
*);

253 (*
	tAµlyDŸlog
)(
	tSaveMusicDŸlog
*);

255 (*
	tI‹m_Added
è(
	tSaveMusicDŸlog
*);

256 (*
	tCË¬_AÎ
è(
	tSaveMusicFeMª
*);

259 
	s_MusicFeMªag”O±s


261 
O³nDŸlog
 
m_İ’dog
;

262 
AµlyDŸlog
 
m_­¶ydŸlog
;

263 
I‹m_Added
 
m_™emadded
;

264 
CË¬_AÎ
 
m_ş—¿Î
;

265 (*(
unu£d
[4]))(
gpoš‹r
 
obj
,...);

270 
SaveMusicDŸlog
 *
MusicMªag”DŸlog
 ;

272 
_SaveMusicI‹m
 
	tSaveMusicI‹m
;

273 
	s_SaveMusicI‹m


275 
id_šdex
;

276 
id_addr
;

277 
aùive
;

278 
gch¬
 *
dÇme
;

279 
GtkWidg‘
 *
wid_cŞum0
;

280 
GtkWidg‘
 *
wid_cŞum2
;

281 
GtkWidg‘
 *
wid_cŞum3
;

284 
_SaveMusicI‹m
 
	tSaveIdI‹m
;

297 
_SaveEnum
 
	tSaveEnum
;

298 
	s_SaveEnum


300 
GLi¡
 *
’umLi¡
;

301 
šdex
;

302 
gch¬
* 
ev®ue
;

303 
gch¬
* 
width
;

306 
_SaveEnumA¼
 
	tSaveEnumA¼
;

307 
	s_SaveEnumA¼


309 
GtkWidg‘
 *
widg‘1
;

310 
GtkWidg‘
 *
widg‘2
;

311 
SaveEnum
 *
£num
;

314 
_SaveUbŠ
 
	tSaveUbŠ
;

315 
	s_SaveUbŠ


317 
GLi¡
 *
¡ruùli¡
;

319 
GLi¡
* 
§v–i¡
;

323 
_SaveUniÚ
 
	tSaveUniÚ
;

324 
	s_SaveUniÚ


326 
šdex
;

327 
gch¬
 *
cu¹ext
;

328 
gch¬
 *
curkey
;

329 
GtkWidg‘
 *
vbox
;

330 
GtkWidg‘
 *
comobox
;

332 
GLi¡
 *
¡ruùli¡
;

337 
GHashTabË
* 
§veV®
;

340 
_SaveEÁry
 
	tSaveEÁry
;

341 
	s_SaveEÁry


343 
gboŞ—n
 
isSŒšg
;

347 
A¼ayBa£Prİ
 *
¬r_ba£
;

348 
width
;

349 
gpoš‹r
 
d©a
;

350 
GLi¡
 *
wli¡
;

354 
_NameIndex
 
	tNameIndex
;

355 
	s_NameIndex


357 
gch¬
 *
t™Ë
;

358 
šdex
;

361 
_SaveEbŠ
 
	tSaveEbŠ
;

362 
	s_SaveEbŠ


364 
gch¬
* 
width
;

365 
A¼ayBa£Prİ
 *
¬r_ba£
;

366 
GLi¡
 *
ebŠ¦i¡
;

367 
GLi¡
 *
ebŠwli¡
;

372 
	s_SaveSŒuù


374 
GtkWidg‘
 *
widg‘1
;

375 
GtkWidg‘
 *
widg‘2
;

376 
gch¬
* 
ty³
;

377 
gch¬
* 
Çme
;

379 
C–lTy³
 
ûÎty³
;

380 
gboŞ—n
 
isPoš‹r
;

381 
gboŞ—n
 
isS’s™ive
;

384 
SaveEÁry
 
£Áry
;

385 
gch¬
 *
vnumb”
;

386 
SaveEnum
 
£num
;

387 
SaveUniÚ
 
suniÚ
;

388 
NextID
 
Ãxtid
;

389 
SaveUbŠ
 
ssubŠ
;

390 
SaveEbŠ
 
s£bŠ
;

391 } 
v®ue
;

392 
FaùÜySŒuùI‹m
 *
Üg
;

393 
STRUCTCÏss
 *
sşass
;

394 
Clo£Widg‘AndSave
 *
şo£_func
;

395 
C»©eNewDŸlog
 *
Ãwdlg_func
;

398 
_PublicSeùiÚ
 
	tPublicSeùiÚ
;

399 
	s_PublicSeùiÚ


401 
GtkWidg‘
 *
wid_hasfšished
;

402 
gboŞ—n
 
hasfšished
;

403 
GtkWidg‘
 *
wid_»Çme_’Œy
;

404 
gch¬
 *
Çme
;

412 
	s_STRUCTCÏss


414 
EËm’t
 
–em’t
;

417 #ifdeà
STRUCT_MAINPOINT


418 
CÚÃùiÚPošt
 
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
 + 1];

420 
CÚÃùiÚPošt
 
cÚÃùiÚs
[
STRUCTCLASS_CONNECTIONPOINTS
];

425 
»®
 
lše_width
;

426 
»®
 
fÚt_height
;

427 
»®
 
ab¡¿ù_fÚt_height
;

428 
»®
 
pŞymÜphic_fÚt_height
;

429 
»®
 
şas¢ame_fÚt_height
;

430 
»®
 
ab¡¿ù_şas¢ame_fÚt_height
;

431 
»®
 
comm’t_fÚt_height
;

433 
DŸFÚt
 *
nÜm®_fÚt
;

436 
DŸFÚt
 *
şas¢ame_fÚt
;

440 *
Çme
;

455 
CŞÜ
 
lše_cŞÜ
;

456 
CŞÜ
 
fl_cŞÜ
;

457 
CŞÜ
 
‹xt_cŞÜ
;

473 
»®
 
Çmebox_height
;

487 
STRUCTCÏssDŸlog
 *
´İ”t›s_dŸlog
;

493 
gboŞ—n
 
isIn™Ÿl
;

494 
gboŞ—n
 
de¡royed
;

495 
GHashTabË
 *
widg‘m­
;

496 
GLi¡
 *
widg‘Save
;

497 
FaùÜySŒuùI‹mAÎ
 *
EnumsAndSŒuùs
 ;

498 
PublicSeùiÚ
 *
µs
;

501 
	`¡ruùşass_dŸlog_ä“
 (
STRUCTCÏssDŸlog
 *
dŸlog
);

502 
GtkWidg‘
 *
	`¡ruùşass_g‘_´İ”t›s
(
STRUCTCÏss
 *
¡ruùşass
, 
gboŞ—n
 
is_deçuÉ
);

503 
ObjeùChªge
 *
	`¡ruùşass_­¶y_´İs_äom_dŸlog
(
STRUCTCÏss
 *
¡ruùşass
, 
GtkWidg‘
 *
widg‘
);

504 
	`¡ruùşass_ÿlcuÏ‹_d©a
(
STRUCTCÏss
 *
¡ruùşass
);

505 
	`¡ruùşass_upd©e_d©a
(
STRUCTCÏss
 *
¡ruùşass
);

507 
	`©Œibu‹s_upd©e_ev’t
(
GtkWidg‘
 *
widg‘
, 
GdkEv’tFocus
 *
ev
, 
STRUCTCÏss
 *
¡ruùşass
);

509 
	`©Œibu‹s_upd©e
(
GtkWidg‘
 *
widg‘
, 
STRUCTCÏss
 *
¡ruùşass
);

511 
	`çùÜy_ba£_™em_§ve
(
SaveSŒuù
 *
sss
,
ObjeùNode
 
ccc
);

514 
	`©Œibu‹s_li¡_£ËùiÚ_chªged_ÿÎback
(
GtkWidg‘
 *
gtkli¡
,

515 
STRUCTCÏss
 *
¡ruùşass
);

516 
	`çùÜy_cÚÃùiÚ_two_objeù
(
STRUCTCÏss
 *
fşass
,

517 
gch¬
 *
objÇme
 );

521 
	`¡ruùşass_§n™y_check
(
STRUCTCÏss
 *
c
, 
gch¬
 *
msg
);

524 
gboŞ—n
 
	`çùÜy_fšd_¬¿y_æag
(cÚ¡ 
gch¬
 *
d©a
);

526 
	`çùÜy_ÿlcuÏ‹_d©a
(
STRUCTCÏss
 *
¡ruùşass
);

528 
GtkWidg‘
 *

529 
	`çùÜy_g‘_´İ”t›s
(
STRUCTCÏss
 *
¡ruùşass
, 
gboŞ—n
 
is_deçuÉ
);

531 
GtkWidg‘
 *
	`çùÜy_ü—‹_mªy_’Œy_box
(
SaveSŒuù
 *
sss
);

532 
GtkWidg‘
 *
	`çùÜy_ü—‹_mªy_checkbox
(
SaveSŒuù
 *
sss
);

534 
	`çùÜy_ü—‹_ba£bu‰Ú_dŸlog
(
GtkWidg‘
 *
bu‰Ú
,
SaveSŒuù
 *
sss
);

535 
	`çùÜy_ü—‹_uniÚbu‰Ú_dŸlog
(
GtkWidg‘
 *
bu‰Ú
,
SaveSŒuù
 *
s¡
);

536 
	`çùÜy_ü—‹_checkbu‰Ús_by_li¡
(
GtkWidg‘
 *
bu‰Ú
,
SaveSŒuù
 *
s¡
);

537 
	`çùÜy_ü—‹_objeùbu‰Ú_dŸlog
(
GtkWidg‘
 *
bu‰Ú
,
SaveSŒuù
 *
s¡
);

538 
	`çùÜy_ü—‹_’umbu‰Ú_dŸlog
(
GtkWidg‘
 *
bu‰Ú
,
SaveSŒuù
 *
s¡
);

539 
	`çùÜy_§ve_’umbu‰Ú_dŸlog
(
GtkWidg‘
 *
widg‘
,
gšt
 
»¥Ú£_id
,
gpoš‹r
 
u£r_d©a
);

540 
	`çùÜy_§ve_objeùbu‰Ú_dŸlog
(
GtkWidg‘
 *
widg‘
,
gšt
 
»¥Ú£_id
,
gpoš‹r
 
u£r_d©a
);

541 
	`çùÜy_§ve_uniÚbu‰Ú_dŸlog
(
GtkWidg‘
 *
widg‘
,
gšt
 
»¥Ú£_id
,
gpoš‹r
 
u£r_d©a
);

542 
	`çùÜy_§ve_ba£bu‰Ú_dŸlog
(
GtkWidg‘
 *
widg‘
,
gšt
 
»¥Ú£_id
,
gpoš‹r
 
u£r_d©a
);

545 
	`çùÜy_š™®_ebŠ
(
SaveSŒuù
 *
sss
,cÚ¡ 
FaùÜySŒuùI‹m
 *
f¡
);

548 
GLi¡
* 
	`çùÜy_g‘_objeùs_äom_Ïy”
(
Lay”
 *
Ïy”
);

549 
STRUCTCÏss
* 
	`çùÜy_g‘_objeù_äom_Ïy”
(
Lay”
 *
Ïy”
,cÚ¡ 
gch¬
 *
Çme
);

550 
	`çùÜy_g‘_v®ue_äom_comobox
(
STRUCTCÏss
 *
¡¬tşass
,
GtkWidg‘
 *
comobox
,
AùiÚID
 *
aid
);

552 
	`çùÜy_¡rjoš
(
gch¬
 **
d¡
,cÚ¡ gch¬ *
´efix
,cÚ¡ gch¬ *
£p
);

553 
	`çùoy_chªged_™em
(
gpoš‹r
 
™em
,gpoš‹¸
u£r_d©a
);

554 
STRUCTCÏss
 *
	`çùÜy_fšd_dŸobjeù_by_Çme
(
Lay”
 *
cu¾ay”
,cÚ¡ 
gch¬
 *
Çme
);

555 
DŸObjeù
 *
	`çùÜy_fšd_§me_dŸobjeù_vŸ_gli¡
(
GLi¡
 *
æi¡
,GLi¡ *
com´–i¡
);

557 
	`çùÜy_ü—‹_ªd_fl_dŸlog
(
STRUCTCÏss
 *
¡ruùşass
, 
gboŞ—n
 
is_deçuÉ
);

558 
	`çùÜy_­³nd_public_šfo
(
GtkWidg‘
 *
dŸlog
,
STRUCTCÏss
 *
¡ruùşass
);

559 
	`çùÜy_ü—‹_¡ruù_dŸlog
(
GtkWidg‘
 *
dŸlog
,
GLi¡
 *
d©®i¡
);

561 
gboŞ—n
 
	`çùÜy_is_cÚÃùed
(
CÚÃùiÚPošt
 *
ı’d
,CÚÃùiÚPošˆ*
ı¡¬t
);

563 
	`çùÜy_£t_§ve¡ruù_widg‘s
(
SaveSŒuù
 *
sss
);

564 
SaveSŒuù
 * 
	`çùÜy_g‘_§ve¡ruù
(
FaùÜySŒuùI‹m
 *
f¡
);

567 
gch¬
* 
	`çùÜy_’Œy_check
(gch¬* 
¡r
);

568 
	`çùÜy_ed™abË_š£¹_ÿÎback
(
GtkEÁry
 *
’Œy
,

569 
gch¬
* 
Ãw_‹xt
,

570 
gšt
 
Ãw_Ëngth
,

571 
gpoš‹r
 
pos™iÚ
,

572 
gpoš‹r
 
d©a
);

574 
	`çùÜy_ed™abË_d–‘e_ÿÎback
(
GtkEd™abË
 *
ed™abË
,

575 
gšt
 
¡¬t_pos
,

576 
gšt
 
’d_pos
);

577 
	`çùÜy_ed™abË_aùive_ÿÎback
(
GtkEd™abË
 *
ed™
,
gpoš‹r
 
d©a
);

580 
ObjeùChªge
 *

581 
	`çùÜy_­¶e_´İs_äom_dŸlog
(
STRUCTCÏss
 *
¡ruùşass
, 
GtkWidg‘
 *
widg‘
);

584 
	`çùÜy_ü—‹_toŞb¬_bu‰Ú
(cÚ¡ 
gšt8
 *
icÚ
,
gch¬
 *
ts
,
GtkToŞb¬
 *
toŞb¬
,

585 
gpoš‹r
 *
ÿÎback
);

587 
	`çùÜy_Ãw_idli¡_dŸlog
(
GtkWidg‘
 *
·»Á
,
SaveSŒuù
 *
s¡
);

588 
	`çùÜy_§ve_idli¡_dŸlog
(
GtkWidg‘
 *
widg‘
,

589 
gšt
 
»¥Ú£_id
,

590 
gpoš‹r
 
u£r_d©a
);

592 
	`çùÜy_fe_mªag”_dŸlog
(
GtkWidg‘
 *
bŠ
,
SaveSŒuù
 *
s¡
);

595 
	`çùÜy_£Ëù
(
STRUCTCÏss
 *
¡ruùşass
, 
Pošt
 *
şicked_pošt
,

596 
DŸR’d””
 *
š‹¿ùive_»nd””
);

598 (*
	tçùÜy_bu‰Ú_ÿÎback
)(
	tGtkWidg‘
 *
	t£lf
);

600 
	`çùÜy_add_™em_to_music_mªag”
(
GtkBu‰Ú
 *
£lf
,
gpoš‹r
 
u£r_d©a
);

601 
GtkWidg‘
 *
	`çùÜy_Ãw_add_bu‰Ú
(
çùÜy_bu‰Ú_ÿÎback
 *
ÿÎback
,
gpoš‹r
 
li¡
);

602 
GtkWidg‘
 *
	`çùÜy_g‘_Ãw_id™em
(
SaveIdI‹m
 *
swt
,
GSLi¡
 **
grou¶i¡
);

603 
GtkWidg‘
 *
	`çùÜy_g‘_Ãw_music™em
Ğ
SaveMusicI‹m
 *
swt
,
GLi¡
 *
fli¡
,
GSLi¡
 **
grou¶i¡
);

606 
gboŞ—n
 
	`çùÜy_is_sy¡em_d©a
(cÚ¡ 
gch¬
 *
Çme
);

608 
GtkWidg‘
 *
	`çùÜy_music_fe_mªag”
(GtkWidg‘ *
·»Á
,
SaveMusicDŸlog
 *
smd
);

609 
GtkWidg‘
 *
	`çùÜy_dowÆßd_fe_mªag”
(GtkWidg‘ *
·»Á
,
SaveMusicDŸlog
 *
smd
);

610 
GtkWidg‘
 *
	`çùÜy_fe_id_mªag”
();

613 
	`çùÜy_add_™em_to_idli¡
(
GtkBu‰Ú
 *
£lf
,
gpoš‹r
 
u£r_d©a
);

616 
	`çùÜy_choo£_musicfe_ÿÎback
(
GtkWidg‘
 *
dlg
,
gšt
 
»¥Ú£
,
gpoš‹r
 
u£r_d©a
);

617 
	`çùÜy_İ’_fe_dŸlog
(
GtkWidg‘
 *
widg‘
,
gpoš‹r
 
u£r_d©a
);

618 
	`çùÜy_d–‘e_fe_mªag”_™em
(
GtkWidg‘
 *
widg‘
,
gpoš‹r
 
u£r_d©a
);

619 
	`çùÜy_ş—ÇÎ_fe_mªag”_™em
(
GtkWidg‘
 *
widg‘
,
gpoš‹r
 
u£r_d©a
);

620 
	`çùÜy_š£¹_fe_mªag”_™em
(
GtkWidg‘
 *
widg‘
,
gpoš‹r
 
u£r_d©a
);

622 
	`çùÜy_music_fe_mªag”_Ãw_™em_chªged
(
SaveMusicDŸlog
 *
smd
);

623 
	`çùÜy_music_fe_mªag”_»move_®l
(
SaveMusicDŸlog
 *
smd
);

624 
	`çùÜy_music_fe_mªag”_­¶y
(
GtkWidg‘
 *
widg‘
,

625 
gšt
 
»¥Ú£_id
,

626 
SaveMusicDŸlog
 *
smd
);

628 
	`çùÜy_music_fe_mªag”_£Ëù_ÿÎback
(
GtkWidg‘
 *
şi¡
,

629 
gšt
 
row
,gšˆ
cŞumn
,

630 
GdkEv’tBu‰Ú
 *
ev’t
,

631 
gšt
 *
»t
);

633 
gboŞ—n
 
	`çùÜy_music_fm_g‘_ty³
(cÚ¡ 
gch¬
* 
¡r
);

635 
	`çùÜy_fm_g‘_cboxli¡
(
SaveMusicDŸlog
 *
smd
);

	@O:\tool\dvs50\objects\Struct\struct_dialog.c

32 #ifdeà
HAVE_CONFIG_H


33 
	~<cÚfig.h
>

36 
	~<as£¹.h
>

37 #undeà
GTK_DISABLE_DEPRECATED


38 
	~<gtk/gtk.h
>

39 
	~<m©h.h
>

40 
	~<¡ršg.h
>

42 
	~"dŸg¿m.h
"

43 
	~"objeù.h
"

44 
	~"objchªge.h
"

45 
	~"š.h
"

46 
	~"¡ruù_şass.h
"

47 
	~"sh“t.h
"

48 
	~"dŸg¿md©a.h
"

49 
	~"cÚÅošt_lše.h
"

55 
	$¡ruùşass_dŸlog_ä“
 (
STRUCTCÏssDŸlog
 *
dŸlog
)

58 
	`gtk_widg‘_de¡roy
(
dŸlog
->dialog);

59 
dŸlog
->dŸlog = 
NULL
;

60 
	`gtk_widg‘_de¡roy
(
dŸlog
->
mašTabË
);

64 
	}
}

66 
	s_DiscÚÃù


68 
CÚÃùiÚPošt
 *
	mı
;

69 
DŸObjeù
 *
	mÙh”_objeù
;

70 
HªdË
 *
	mÙh”_hªdË
;

71 } 
	tDiscÚÃù
;

73 
_STRUCTCÏssS‹
 
	tSTRUCTCÏssS‹
;

75 
	s_STRUCTCÏssS‹


77 
»®
 
	mfÚt_height
;

78 
»®
 
	mab¡¿ù_fÚt_height
;

79 
»®
 
	mpŞymÜphic_fÚt_height
;

80 
»®
 
	mşas¢ame_fÚt_height
;

81 
»®
 
	mab¡¿ù_şas¢ame_fÚt_height
;

82 
»®
 
	mcomm’t_fÚt_height
;

84 
DŸFÚt
 *
	mnÜm®_fÚt
;

87 
DŸFÚt
 *
	mşas¢ame_fÚt
;

91 *
	mÇme
;

107 
»®
 
	mlše_width
;

108 
CŞÜ
 
	mlše_cŞÜ
;

109 
CŞÜ
 
	mfl_cŞÜ
;

110 
CŞÜ
 
	m‹xt_cŞÜ
;

121 
GHashTabË
 *
	mwidg‘m­
;

122 
FaùÜySŒuùI‹mAÎ
 *
	mEnumsAndSŒuùs
 ;

126 
_STRUCTCÏssChªge
 
	tSTRUCTCÏssChªge
;

128 
	s_STRUCTCÏssChªge


130 
ObjeùChªge
 
	mobj_chªge
;

132 
STRUCTCÏss
 *
	mobj
;

138 
	m­¶›d
;

140 
STRUCTCÏssS‹
 *
	m§ved_¡©e
;

143 
STRUCTCÏssS‹
 *
¡ruùşass_g‘_¡©e
(
STRUCTCÏss
 *
¡ruùşass
);

145 
STRUCTCÏssS‹
 *
çùÜy_g‘_¡©e
(
STRUCTCÏss
 *
¡ruùşass
);

146 
ObjeùChªge
 *

147 
çùÜy_Ãw_chªge
(
STRUCTCÏss
 *
obj
, 
STRUCTCÏssS‹
 *
§ved_¡©e
);

149 
ObjeùChªge
 *
Ãw_¡ruùşass_chªge
(
STRUCTCÏss
 *
obj
, 
STRUCTCÏssS‹
 *
§ved_¡©e
,

150 
GLi¡
 *
added
, GLi¡ *
d–‘ed
,

151 
GLi¡
 *
discÚÃùed
);

152 cÚ¡ 
gch¬
 *
g‘_comm’t
(
GtkTextV›w
 *);

153 
£t_comm’t
(
GtkTextV›w
 *, 
gch¬
 *);

154 
çùÜy_§ve_v®ue_äom_widg‘
(
SaveSŒuù
 *
sss
);

346 
gboŞ—n
 
	$çùÜy_fšd_¬¿y_æag
(cÚ¡ 
gch¬
 *
d©a
)

349 
gboŞ—n
 
læag
 = 
FALSE
;

350 
gboŞ—n
 
ræag
 = 
FALSE
;

351 
Ën
 = 
	`¡¾’
(
d©a
);

352 
i
 =0;

353 ; 
i
 <
Ën
 ; i++)

355 if(
d©a
[
i
] == '[')

357 
læag
 = 
TRUE
;

359 if(
d©a
[
i
] == ']')

361 
ræag
 = 
TRUE
;

364  
ræag
 & 
læag
;

365 
	}
}

373 
	$çùÜy_£t_twoxtwo_bË
(
GtkWidg‘
* 
bË
 ,GtkWidg‘* 
fœ¡
,GtkWidg‘ *
£cÚd
,
row
)

375 ifĞ
row
 == 0 || !(row % 2 ))

377 
	`gtk_bË_©ch_deçuÉs
(
	`GTK_TABLE
(
bË
),
fœ¡
,0,1,
row
,row+1);

378 
	`gtk_bË_©ch_deçuÉs
(
	`GTK_TABLE
(
bË
),
£cÚd
,1,2,
row
,row+1);

382 
	`gtk_bË_©ch_deçuÉs
(
	`GTK_TABLE
(
bË
),
fœ¡
,2,3,
row
-1,row);

383 
	`gtk_bË_©ch_deçuÉs
(
	`GTK_TABLE
(
bË
),
£cÚd
,3,4,
row
-1,row);

385 
	}
}

2976 
	$de¡roy_´İ”t›s_dŸlog
 (
GtkWidg‘
* 
widg‘
,

2977 
gpoš‹r
 
u£r_d©a
)

2980 
STRUCTCÏss
 *
¡ruùşass
 = (STRUCTCÏs *)
u£r_d©a
;

2982 
	`g_ä“
 (
¡ruùşass
->
´İ”t›s_dŸlog
);

2983 
¡ruùşass
->
´İ”t›s_dŸlog
 = 
NULL
;

2984 
	}
}

2988 
gpoš‹r
 
	$çùÜy_fšd_li¡_node
(
GLi¡
 *
li¡
,
gch¬
 *
d©a
)

2990 
GLi¡
 *
t
 = 
li¡
;

2991 ; 
t
 !ğ
NULL
 ; =->
Ãxt
)

2993 
FaùÜySŒuùEnum
 *
p
 = 
t
->
d©a
;

2994 if(!
	`g_ascii_¡rÿ£cmp
(
d©a
,
p
->
key
))

2995  
t
->
d©a
;

2997 
	}
}

2999 
	$çùÜy_cÚÃùiÚto_objeù
(
DDi¥Ïy
 *
ddi¥
,
DŸObjeù
 *
obj
,
STRUCTCÏss
 *
fşass
,
num
)

3001 
DŸg¿m
 *
dŸg¿m
;

3002 
HªdË
 *
hªdË
;

3003 
dŸg¿m
 = 
ddi¥
->diagram;

3005 
hªdË
 = 
obj
->
hªdËs
[
num
];

3006 
hªdË
->
id
 = 
num
 =ğ0 ? 
HANDLE_MOVE_STARTPOINT
 : 
HANDLE_MOVE_ENDPOINT
 ;

3007 
hªdË
->
cÚÃùed_to
 = &
fşass
->
cÚÃùiÚs
[8];

3008 
hªdË
->
pos
 = 
fşass
->
cÚÃùiÚs
[8].pos;

3012 
CÚÃùiÚPošt
 *
cÚÃùiÚpošt
 = 
NULL
;

3013 
cÚÃùiÚpošt
 = 
	`objeù_fšd_cÚÃùpošt_di¥Ïy
(
ddi¥
, &
fşass
->
cÚÃùiÚs
[8].
pos
, 
obj
, 
TRUE
);

3014 if(
cÚÃùiÚpošt
 !ğ
NULL
)

3016 
hªdË
->
pos
 = 
cÚÃùiÚpošt
->pos;

3017 if(
cÚÃùiÚpošt
->
cÚÃùed
)

3018 
cÚÃùiÚpošt
->
cÚÃùed
 = 
	`g_li¡_­³nd
(cÚÃùiÚpošt->cÚÃùed,
obj
);

3021 
GLi¡
 *
tm¶i¡
 = 
NULL
;

3022 
tm¶i¡
ğ
	`g_li¡_­³nd
Ñm¶i¡,
obj
);

3023 
cÚÃùiÚpošt
->
cÚÃùed
 = 
tm¶i¡
;

3025 
obj
->
İs
->
	`cÚÃùiÚ_two_obj
(obj,
cÚÃùiÚpošt
,
num
);

3028 
	`objeù_add_upd©es
(
obj
, 
dŸg¿m
);

3030 
	}
}

3032 
DŸObjeù
 *
	$çùÜy_fšd_§me_dŸobjeù_vŸ_gli¡
(
GLi¡
 *
æi¡
,GLi¡ *
com´–i¡
)

3034 
GLi¡
 *
§m–i¡
 = 
NULL
;

3035 
DŸObjeù
 *
obj
 = 
NULL
;

3036 ; 
æi¡
; fli¡ = fli¡->
Ãxt
)

3038 
§m–i¡
 = 
	`g_li¡_fšd
(
com´–i¡
,
æi¡
->
d©a
);

3039 if(
§m–i¡
)

3041 
obj
 = 
§m–i¡
->
d©a
;

3046  
obj
;

3047 
	}
}

3051 
	$çùÜy_cÚÃùiÚ_two_objeù
(
STRUCTCÏss
 *
fşass
,

3052 
gch¬
 *
objÇme
 )

3055 
Lay”
 *
cu¾ay”
 = 
fşass
->
–em’t
.
objeù
.
·»Á_Ïy”
;

3056 
STRUCTCÏss
 *
objşass
 = 
	`çùÜy_fšd_dŸobjeù_by_Çme
(
cu¾ay”
,
objÇme
);

3057 if(!
objşass
)

3059 if(
	`çùÜy_is_cÚÃùed
(&
objşass
->
cÚÃùiÚs
[8],&
fşass
->connections[8]))

3062 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

3064 
x
 =0,
y
=0;

3065 
x
 = 
fşass
->
cÚÃùiÚs
[8].
pos
.x;

3066 
y
 = 
fşass
->
cÚÃùiÚs
[8].
pos
.y;

3067 
DŸObjeù
 *
obj
 = 
NULL
;

3068 
obj
 = 
	`ddi¥Ïy_drİ_objeù
(
ddi¥
,
x
,
y
,
	`objeù_g‘_ty³
("Standard - Line"),6);

3072 
	`çùÜy_cÚÃùiÚto_objeù
(
ddi¥
,
obj
,
fşass
,0);

3074 if(
objşass
)

3076 
	`çùÜy_cÚÃùiÚto_objeù
(
ddi¥
,
obj
,
objşass
,1);

3079 
	`dŸg¿m_un£Ëù_objeùs
(
ddi¥
->
dŸg¿m
,ddi¥->dŸg¿m->
d©a
->
£Ëùed
);

3080 
	`dŸg¿m_£Ëù
(
ddi¥
->
dŸg¿m
,
fşass
);

3081 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

3083 
	}
}

3085 
	$çùÜy_»ad_´İs_äom_widg‘
(
gpoš‹r
 
key
,gpoš‹¸
v®ue
 ,gpoš‹¸
u£r_d©a
)

3087 
SaveSŒuù
 *
sss
 = (SaveSŒuù *)
v®ue
;

3088 
sss
->
ûÎty³
)

3090 
ECOMBO
:

3091 if(
	`gtk_cÚš”_chd_ty³
(
	`GTK_CONTAINER
(
sss
->
widg‘2
)è!ğ
GTK_TYPE_NONE
)

3093 
GLi¡
 *
p
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(
sss
->
widg‘2
));

3094 if(
p
)

3095 
sss
->
v®ue
.
£num
.
šdex
 = 
	`gtk_combo_box_g‘_aùive
(
	`GTK_COMBO_BOX
(
p
->
d©a
));

3098 
sss
->
v®ue
.
£num
.
šdex
 = 
	`gtk_combo_box_g‘_aùive
(
	`GTK_COMBO_BOX
(sss->
widg‘2
));

3099 
FaùÜySŒuùEnum
 *
km­
 = 
	`g_li¡_Áh_d©a
(
sss
->
v®ue
.
£num
.
’umLi¡
,sss->v®ue.£num.
šdex
);

3100 
sss
->
v®ue
.
£num
.
ev®ue
 = 
km­
->value;

3102 
ENTRY
:

3104 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

3106 if(
£y
->
isSŒšg
)

3108 
£y
->
d©a
 = 
	`g_loÿË_to_utf8
(
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
 (
sss
->
widg‘2
)),-1,
NULL
,NULL,NULL);

3113 
SPINBOX
:

3115 
v
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
sss
->
widg‘2
));

3116 
sss
->
v®ue
.
vnumb”
 = 
	`g_¡rdup_´štf
("%d",
v
);

3120 
OCOMBO
:

3122 
NextID
 *
nid
 = &
sss
->
v®ue
.
Ãxtid
;

3123 ifĞ
	`g_li¡_Ëngth
(
nid
->
aùli¡
)>0)

3125 
AùiÚID
 *
aid
 = 
nid
->
aùli¡
->
d©a
;

3126 
	`çùÜy_g‘_v®ue_äom_comobox
(
sss
->
sşass
,sss->
widg‘2
,
aid
);

3136 
UCOMBO
:

3138 
SaveUniÚ
 *
su±r
 = &
sss
->
v®ue
.
suniÚ
;

3139 if(!
sss
->
isPoš‹r
)

3141 
SaveSŒuù
 *
ts¡
 = 
	`g_hash_bË_lookup
(
su±r
->
§veV®
,su±r->
curkey
);

3142 if(
ts¡
)

3144 
	`çùÜy_§ve_v®ue_äom_widg‘
(
ts¡
);

3153 
	}
}

3155 
	$çùÜy_g‘_v®ue_äom_comobox
(
STRUCTCÏss
 *
¡¬tşass
,
GtkWidg‘
 *
comobox
,
AùiÚID
 *
aid
)

3157 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

3158 
curšdex
 = 
	`gtk_combo_box_g‘_aùive
(
	`GTK_COMBO_BOX
(
comobox
));

3159 
gch¬
 *
²ame
 = 
	`gtk_combo_box_g‘_aùive_‹xt
(
	`GTK_COMBO_BOX
(
comobox
));

3161 if(!
curšdex
)

3162 
DELL
;

3165 
Lay”
 *
p
 = 
¡¬tşass
->
–em’t
.
objeù
.
·»Á_Ïy”
;

3166 
STRUCTCÏss
 *
objşass
 =
NULL
;

3167 if(!
	`g_ascii_¡rÿ£cmp
(
²ame
,
¡¬tşass
->
Çme
))

3169 
objşass
 = 
	`çùÜy_fšd_dŸobjeù_by_Çme
(
p
,
aid
->
´e_Çme
);

3170 if(
objşass
 && 
	`çùÜy_is_cÚÃùed
(&objşass->
cÚÃùiÚs
[8],&
¡¬tşass
->connections[8]))

3172 
	`çùÜy_d–‘e_lše_b‘w“n_two_objeùs
(
¡¬tşass
,
aid
->
´e_Çme
);

3175 
SETV
 ;

3180 
objşass
 = 
	`çùÜy_fšd_dŸobjeù_by_Çme
(
p
,
²ame
);

3181 if(
objşass
 && 
	`çùÜy_is_cÚÃùed
(&objşass->
cÚÃùiÚs
[8],&
¡¬tşass
->connections[8]))

3182 
SETV
;

3185 if(
objşass
 && objşass->
widg‘Save
)

3187 
SaveSŒuù
 *
s¡
 =
objşass
->
widg‘Save
->
d©a
;

3188 
aid
->
v®ue
 = 
	`g_¡rdup
(
s¡
->v®ue.
vnumb”
);

3192 
aid
->
v®ue
 = 
	`g_¡rdup
("-1");

3195 
	`çùÜy_cÚÃùiÚ_two_objeù
(
¡¬tşass
,
	`g_¡rdup
(
²ame
));

3200 
DELL
:

3201 if(
aid
->
šdex
 &&‡id->šdex !ğ
curšdex
 &&

3202 
	`g_ascii_¡rÿ£cmp
(
aid
->
´e_Çme
,
¡¬tşass
->
Çme
))

3204 
	`çùÜy_d–‘e_lše_b‘w“n_two_objeùs
(
¡¬tşass
,
aid
->
´e_Çme
);

3207 
SETV
:

3208 
aid
->
´e_Çme
 = 
	`g_¡rdup
(
²ame
);

3209 
aid
->
šdex
 = 
curšdex
;

3210 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

3211 
	`g_ä“
(
²ame
);

3212 
	}
}

3215 
	$çùÜy_d–‘e_lše_b‘w“n_two_objeùs
(
STRUCTCÏss
 *
¡¬tc
,cÚ¡ 
gch¬
 *
’dc
)

3217 
DDi¥Ïy
 *
ddi¥
 = 
	`ddi¥Ïy_aùive
();

3219 
STRUCTCÏss
 *
objşass
 = 
	`çùÜy_fšd_dŸobjeù_by_Çme
(
curLay”
,
’dc
);

3220 if(
objşass
)

3222 
CÚÃùiÚPošt
 *
ı¡¬t
 = &
¡¬tc
->
cÚÃùiÚs
[8];

3223 
CÚÃùiÚPošt
 *
ı’d
 = &
objşass
->
cÚÃùiÚs
[8];

3224 
DŸObjeù
 *
lše
 = 
	`çùÜy_fšd_§me_dŸobjeù_vŸ_gli¡
(
ı’d
->
cÚÃùed
,
ı¡¬t
->connected);

3225 if(
lše
 && 
	`çùÜy_is_cÚÃùed
(
ı’d
,
ı¡¬t
))

3229 
ı¡¬t
->
cÚÃùed
 = 
	`g_li¡_»move
(ı¡¬t->cÚÃùed,
lše
);

3230 
ı’d
->
cÚÃùed
 = 
	`g_li¡_»move
(ı’d->cÚÃùed,
lše
);

3231 
	`g_li¡_ä“1
(
lše
->
cÚÃùiÚs
[0]->
cÚÃùed
);

3232 
lše
->
cÚÃùiÚs
[0]->
cÚÃùed
 = 
NULL
;

3233 
lše
->
cÚÃùiÚs
[0]->
objeù
 = 
NULL
;

3236 
	`Ïy”_»move_objeù
(
curLay”
,
lše
);

3237 
lše
->
İs
->
	`de¡roy
(line);

3238 
	`dŸg¿m_æush
(
ddi¥
->
dŸg¿m
);

3241 
	`dŸg¿m_£Ëù
(
ddi¥
->
dŸg¿m
,
objşass
);

3242 
	`dŸg¿m_un£Ëù_objeùs
(
ddi¥
->
dŸg¿m
,ddi¥->dŸg¿m->
d©a
->
£Ëùed
);

3243 
	`dŸg¿m_£Ëù
(
ddi¥
->
dŸg¿m
,
¡¬tc
);

3245 
	}
}

3249 
ObjeùChªge
 *

3250 
	$çùÜy_­¶y_´İs_äom_dŸlog
(
STRUCTCÏss
 *
fşass
, 
GtkWidg‘
 *
widg‘
)

3253 
GLi¡
 *
­¶i¡
 = 
NULL
;

3255 
­¶i¡
 = 
fşass
->
widg‘Save
;

3256 ; 
­¶i¡
;‡µli¡ =‡µli¡->
Ãxt
)

3258 
	`çùÜy_»ad_´İs_äom_widg‘
(
NULL
,
­¶i¡
->
d©a
,NULL);

3261 
PublicSeùiÚ
 *
µs
 = 
fşass
->pps;

3262 if(!
µs
)

3263  
NULL
;

3264 
µs
->
hasfšished
 = 
	`gtk_toggË_toŞ_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
Õps->
wid_hasfšished
));

3265 
gch¬
 *
txt
 = 
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
(
µs
->
wid_»Çme_’Œy
));

3266 if(
	`g_utf8_v®id©e
(
txt
,-1,
NULL
))

3267 
µs
->
Çme
 = 
	`g_¡rdup
(
txt
);

3269 
µs
->
Çme
 = 
	`çùÜy_utf8
(
txt
);

3270 if(
µs
->
Çme
 !ğ
NULL
 && 
	`g_ascii_¡rÿ£cmp
Õps->Çme,
fşass
->name))

3272 
GLi¡
 *
exi¡s
 = 
NULL
;

3273 if(
curLay”
)

3274 
exi¡s
 = 
curLay”
->
objeùs
;

3275 ; 
exi¡s
;ƒxi¡ ğexi¡s->
Ãxt
)

3277 
STRUCTCÏss
 *
pşass
 = 
exi¡s
->
d©a
;

3278 if(!
	`çùÜy_is_v®id_ty³
(
pşass
))

3280 if(!
	`g_ascii_¡rÿ£cmp
(
pşass
->
Çme
,
µs
->name))

3282 
gch¬
 *
msg_”r
 = 
	`g_loÿË_to_utf8
(
	`_
("ÕÒµ½Ê±ÓĞÏàÍ¬Ãû×ÖµÄ¿Ø¼ş,Çë¸ü»»Ãû×Ö!\n"),-1,
NULL
,NULL,NULL);

3283 
	`mes§ge_”rÜ
(
msg_”r
);

3284 
	`g_ä“
(
msg_”r
);

3289 if(!
exi¡s
 && 
curLay”
)

3291 
fşass
->
Çme
 = 
	`g_¡rdup
(
µs
->name);

3292 
GLi¡
 *
deâames
 = 
NULL
;

3293 
GLi¡
 *
objli¡
 = 
NULL
;

3295 
curLay”
->
deâames
;

3296 
objli¡
 = 
curLay”
->
objeùs
;

3297 
	`g_li¡_ä“1
(
curLay”
->
deâames
);

3298 
curLay”
->
deâames
 = 
NULL
;

3300 ; 
objli¡
; objli¡ = objli¡->
Ãxt
)

3302 if(
	`çùÜy_is_v®id_ty³
(
objli¡
->
d©a
))

3304 
STRUCTCÏss
 *
oşass
 = 
objli¡
->
d©a
;

3305 if(!
	`çùÜy_is_sy¡em_d©a
(
oşass
->
–em’t
.
objeù
.
Çme
))

3306 
curLay”
->
deâames
 = 
	`g_li¡_­³nd
(curLay”->deâames,
oşass
->
Çme
);

3311 
	`¡ruùşass_ÿlcuÏ‹_d©a
(
fşass
);

3312 
	`¡ruùşass_upd©e_d©a
(
fşass
);

3316 
µs
->
hasfšished
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
Õps->
wid_hasfšished
));

3317 if(
µs
->
hasfšished
)

3319 
CŞÜ
 
»d
 = {200,0,0};

3320 
fşass
->
fl_cŞÜ
 = 
»d
;

3324 
CŞÜ
 
w
 = {255,255,255};

3325 
fşass
->
fl_cŞÜ
 = 
w
;

3330  
NULL
;

3331 
	}
}

3422 
GtkWidg‘
 *

3423 
	$çùÜy_g‘_´İ”t›s
(
STRUCTCÏss
 *
fşass
, 
gboŞ—n
 
is_deçuÉ
)

3426 
STRUCTCÏssDŸlog
 *
´İ_dŸlog
;

3427 
GtkWidg‘
 *
vbox
;

3430 ià(
fşass
->
´İ”t›s_dŸlog
 =ğ
NULL
)

3432 
´İ_dŸlog
 = 
	`g_Ãw
(
STRUCTCÏssDŸlog
, 1);

3433 
fşass
->
´İ”t›s_dŸlog
 = 
´İ_dŸlog
;

3436 
vbox
 = 
	`gtk_vbox_Ãw
(
FALSE
, 0);

3437 
´İ_dŸlog
->
dŸlog
 = 
vbox
;

3439 
	`gtk_widg‘_£t_Çme
(
vbox
,
fşass
->
Çme
);

3440 
	`gtk_sigÇl_cÚÃù
 (
	`GTK_OBJECT
 (
´İ_dŸlog
->
dŸlog
),"destroy",

3441 
	`GTK_SIGNAL_FUNC
(
de¡roy_´İ”t›s_dŸlog
),(
gpoš‹r
è
fşass
);

3443 
	`çùÜy_ü—‹_ªd_fl_dŸlog
(
fşass
,
FALSE
);

3445 
	`gtk_widg‘_show_®l
 (
fşass
->
´İ”t›s_dŸlog
->
dŸlog
);

3446  
fşass
->
´İ”t›s_dŸlog
->
dŸlog
;

3447 
	}
}

3449 
GtkWidg‘
 *
	$çùÜy_ü—‹_combo_widg‘
(
GLi¡
 *
d©®i¡
,
gšt
 
aùiveid
)

3451 
GtkWidg‘
 *
widg‘
;

3452 
widg‘
 = 
	`gtk_combo_box_Ãw_‹xt
();

3453 
	`gtk_combo_box_pİdown
(
	`GTK_COMBO_BOX
(
widg‘
));

3454 
GLi¡
 *
µ
 = 
d©®i¡
;

3455 ; 
µ
 ;…°ğµ->
Ãxt
)

3457 
	`gtk_combo_box_­³nd_‹xt
(
	`GTK_COMBO_BOX
(
widg‘
),
µ
->
d©a
);

3459 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
widg‘
),
aùiveid
);

3460  
widg‘
;

3461 
	}
}

3463 
GtkWidg‘
 *
	$çùÜy_ü—‹_‹xt_widg‘
(
gch¬
 *
¡r
,
gšt
 
maxËngth
)

3465 
GtkWidg‘
 *
widg‘
;

3466 
widg‘
 = 
	`gtk_’Œy_Ãw
();

3467 
	`gtk_’Œy_£t_max_Ëngth
(
	`GTK_ENTRY
(
widg‘
), 
maxËngth
);

3468 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
(
widg‘
),
¡r
);

3469  
widg‘
;

3470 
	}
}

3472 
GtkWidg‘
 *
	$çùÜy_ü—‹_¥bšbox_widg‘
(
gšt
 
v®ue
,gšˆ
mšv®ue
,gšˆ
maxv®ue
)

3474 
GtkWidg‘
 *
widg‘
;

3475 
widg‘
 = 
	`GTK_SPIN_BUTTON
(
	`gtk_¥š_bu‰Ú_Ãw_w™h_¿nge
(
mšv®ue
,
maxv®ue
,1));

3477 
	`gtk_¥š_bu‰Ú_£t_num”ic
Ğ
	`GTK_SPIN_BUTTON
Ğ
widg‘
), 
TRUE
);

3478 
	`gtk_¥š_bu‰Ú_£t_¢­_to_ticks
Ğ
	`GTK_SPIN_BUTTON
(
widg‘
), 
TRUE
);

3479 
	`gtk_¥š_bu‰Ú_£t_v®ue
 (
	`GTK_SPIN_BUTTON
(
widg‘
),
v®ue
);

3480  
widg‘
;

3481 
	}
}

3484 
GtkWidg‘
 *
	$çùÜy_ü—‹_’um_widg‘
(
GLi¡
 *
li¡
,
šdex
)

3486 
GtkWidg‘
 *
cŞumTwo
 = 
NULL
;

3487 
GLi¡
 *
d©®i¡
 = 
NULL
;

3488 
GLi¡
 *
p
 = 
li¡
;

3489 ; 
p
 !ğ
NULL
 ;…ğp->
Ãxt
)

3491 
FaùÜySŒuùEnum
 *
kvm­
 = 
p
->
d©a
;

3492 
d©®i¡
 = 
	`g_li¡_­³nd
(d©®i¡,
kvm­
->
key
);

3494 
cŞumTwo
 = 
	`çùÜy_ü—‹_combo_widg‘
(
d©®i¡
,
šdex
);

3496  
cŞumTwo
;

3497 
	}
}

3499 
GtkWidg‘
 *
	$çùÜy_ü—‹_v¬ŸÁ_objeù
(
SaveSŒuù
 *
sss
)

3502 
FaùÜySŒuùI‹m
 *
™em
 = 
sss
->
Üg
;

3503 
GtkWidg‘
 *
cŞumTwo
 = 
NULL
;

3505 
sss
->
ûÎty³
)

3507 
ENTRY
:

3509 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

3511 if(
£y
->
isSŒšg
)

3513 
cŞumTwo
 = 
£y
->
d©a
 ? 
	`çùÜy_ü—‹_‹xt_widg‘
(£y->d©a,£y->
¬r_ba£
->
»®Ën
):

3514 
	`çùÜy_ü—‹_‹xt_widg‘
(
™em
->
V®ue
,
£y
->
¬r_ba£
->
»®Ën
);

3519 
SPINBOX
:

3522 
gšt
 
v
 = 0;

3523 if(!
	`g_ascii_¡ºÿ£cmp
(
sss
->
v®ue
.
vnumb”
,"-1",2))

3524 
v
 = -1;

3526 
v
 = 
	`g_¡¹od
(
sss
->
v®ue
.
vnumb”
,
NULL
);

3528 
gšt
 
vmš
 = 
	`g_¡¹od
(
™em
->
Mš
,
NULL
);

3529 
gšt
 
vmax
 = 
	`g_¡¹od
(
™em
->
Max
,
NULL
);

3530 
cŞumTwo
 = 
	`çùÜy_ü—‹_¥bšbox_widg‘
(
v
,
vmš
,
vmax
);

3535 
UCOMBO
:

3537 
SaveUniÚ
 *
su±r
 = &
sss
->
v®ue
.
suniÚ
;

3538 
cŞumTwo
 = 
	`gtk_vbox_Ãw
(
FALSE
,1) ;

3539 
su±r
->
comobox
 = 
	`gtk_combo_box_Ãw_‹xt
();

3540 
su±r
->
vbox
 = 
cŞumTwo
;

3542 
	`gtk_combo_box_pİdown
(
	`GTK_COMBO_BOX
(
su±r
->
comobox
));

3543 
GLi¡
 *
p
 = 
su±r
->
¡ruùli¡
;

3545 
FaùÜySŒuùI‹m
 *
Ãxtobj
 = 
	`g_li¡_Áh_d©a
(
su±r
->
¡ruùli¡
,su±r->
šdex
);

3546 if(!
Ãxtobj
)

3549 ; 
p
 !ğ
NULL
 ;…ğp->
Ãxt
)

3551 
FaùÜySŒuùI‹m
 *
d©a
 = 
p
->data;

3552 
	`gtk_combo_box_­³nd_‹xt
(
	`GTK_COMBO_BOX
(
su±r
->
comobox
),
d©a
->
Name
);

3554 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
su±r
->
comobox
),su±r->
šdex
);

3555 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
cŞumTwo
),
su±r
->
comobox
);

3556 
SaveSŒuù
 *
ts¡
 = 
NULL
;

3557 
su±r
->
curkey
 = 
	`g_¡rjoš
("##",
Ãxtobj
->
FTy³
,Ãxtobj->
Name
,
NULL
);

3558 
su±r
->
cu¹ext
 = 
	`g_¡rdup
(
Ãxtobj
->
Name
);

3559 if(
	`g_hash_bË_size
(
su±r
->
§veV®
))

3561 
ts¡
 = 
	`g_hash_bË_lookup
(
su±r
->
§veV®
,su±r->
curkey
);

3562 if(!
ts¡
)

3564 
FIRST
;

3570 
FIRST
:

3571 
ts¡
 = 
	`çùÜy_g‘_§ve¡ruù
(
Ãxtobj
);

3572 
ts¡
->
sşass
 = 
sss
->sclass;

3573 
	`çùÜy_¡rjoš
(&
ts¡
->
Çme
,
sss
->name,".");

3575 
	`g_hash_bË_š£¹
(
su±r
->
§veV®
,su±r->
curkey
,
ts¡
);

3579 
GtkWidg‘
 *
widg‘
 = 
	`çùÜy_ü—‹_v¬ŸÁ_objeù
(
ts¡
);

3580 if(
ts¡
->
isPoš‹r
 )

3583 
SaveUbŠ
 *
sbŠ
 = &
ts¡
->
v®ue
.
ssubŠ
;

3585 ifĞ!
	`g_li¡_Ëngth
(
sbŠ
->
§v–i¡
è&& sbŠ->
¡ruùli¡
)

3588 
GLi¡
 *
¦i¡
 = 
sbŠ
->
¡ruùli¡
;

3589 ; 
¦i¡
; sli¡ = sli¡->
Ãxt
)

3591 
FaùÜySŒuùI‹m
 *
o
 = 
¦i¡
->
d©a
;

3592 
SaveSŒuù
 *
s
 = 
	`çùÜy_g‘_§ve¡ruù
(
o
);

3593 
s
->
sşass
 = 
sss
->sclass;

3594 
	`çùÜy_¡rjoš
(&
s
->
Çme
,
sss
->name,".");

3595 
sbŠ
->
§v–i¡
 = 
	`g_li¡_­³nd
(sbŠ->§v–i¡,
s
);

3600 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
cŞumTwo
),
widg‘
);

3601 
	`gtk_widg‘_show_®l
(
cŞumTwo
);

3602 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
su±r
->
comobox
), "chªged",
	`G_CALLBACK
 (
çùoy_chªged_™em
), 
sss
);

3605 
ECOMBO
:

3606 
cŞumTwo
 = 
	`çùÜy_ü—‹_’um_widg‘
(
™em
->
d©®i¡
,
sss
->
v®ue
.
£num
.
šdex
);

3608 
OCOMBO
:

3610 
STRUCTCÏss
 *
Ügşass
 = 
sss
->
sşass
;

3611 
NextID
 *
Ãxtid
 = &
sss
->
v®ue
.nextid;

3612 
cŞumTwo
 = 
	`gtk_combo_box_Ãw_‹xt
();

3613 
	`gtk_combo_box_pİdown
(
	`GTK_COMBO_BOX
(
cŞumTwo
));

3616 
	`g_li¡_ä“
(
Ãxtid
->
™emli¡
);

3617 
Ãxtid
->
™emli¡
 = 
NULL
;

3619 
Ãxtid
->
™emli¡
 = 
	`çùÜy_g‘_objeùs_äom_Ïy”
(
curLay”
);

3620 
Ãxtid
->
™emli¡
 = 
	`g_li¡_š£¹
Òextid->™emli¡,
	`g_¡rdup
(""),0);

3621 
AùiÚID
 *
aid
 = 
Ãxtid
->
aùli¡
->
d©a
;

3623 
GLi¡
 *
i¡
 = 
Ãxtid
->
™emli¡
;

3624 
cŞumTwo
 = 
	`çùÜy_ü—‹_combo_widg‘
(
i¡
,
aid
->
šdex
);

3627 
OBTN
:

3628 
EBTN
:

3629 
UBTN
:

3630 
BBTN
:

3632 
cŞumTwo
 =
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
™em
->
Name
);

3633 
FaùÜySŒuùI‹m
 *
fsi
 = 
sss
->
Üg
;

3634 if(
	`çùÜy_is_¥ecŸl_objeù
(
™em
->
STy³
))

3636 
SaveKV
 *
skv
 = 
sss
->
v®ue
.
vnumb”
;

3637 
	`gtk_bu‰Ú_£t_Ïb–
(
	`GTK_BUTTON
(
cŞumTwo
), 
skv
->
v®ue
 );

3638 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
cŞumTwo
), "şicked",
	`G_CALLBACK
 (
sss
->
Ãwdlg_func
),sss);

3642 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
cŞumTwo
), "şicked",
	`G_CALLBACK
 (
sss
->
Ãwdlg_func
), sss);

3652 
sss
->
widg‘2
 = 
cŞumTwo
;

3653  
cŞumTwo
;

3654 
	}
}

3657 
gboŞ—n
 
	$çùÜy_music_fm_g‘_ty³
(cÚ¡ 
gch¬
* 
Çme
)

3659 
gboŞ—n
 
æag
 = 
FALSE
;

3660 if(!
	`g_ascii_¡ºÿ£cmp
(
Çme
,"aIndex_Numb”",
	`¡¾’
("aIndex_Number")))

3662 
MusicMªag”DŸlog
->
fm¡
 = 
SEQUENCE
;

3663 
æag
 = 
TRUE
;

3666 if(!
	`g_ascii_¡ºÿ£cmp
(
Çme
,"aFe_Numb”",
	`¡¾’
("aFile_Number")))

3668 
MusicMªag”DŸlog
->
fm¡
 = 
INDEX
;

3669 
æag
 = 
TRUE
;

3672 if(!
	`g_ascii_¡ºÿ£cmp
(
Çme
,"aPhy_Numb”",
	`¡¾’
("aPhy_Number")))

3674 
MusicMªag”DŸlog
->
fm¡
 = 
PHY
;

3675 
æag
 = 
TRUE
;

3677  
æag
;

3678 
	}
}

3682 
gboŞ—n
 
	$çùÜy_is_v®id_ty³
(
gpoš‹r
 
d©a
)

3684 
DŸObjeù
 *
Ùy³
 = (DŸObjeù *)
d©a
;

3685 *
n1
 = 
	`g_¡rdup
("STRUCT - Class");

3686 
gboŞ—n
 
áy³
 = 
	`g_ascii_¡ºÿ£cmp
(
Ùy³
->
ty³
->
Çme
,
n1
,
	`¡¾’
(n1));

3687 
	`g_ä“
(
n1
);

3688  !
áy³
;

3689 
	}
}

3690 
	$çùÜy_£t_§ve¡ruù_widg‘s
(
SaveSŒuù
 *
sss
)

3692 
GtkWidg‘
 *
Name
 ;

3693 
GtkWidg‘
 *
cŞumTwo
;

3694 
GtkToŞts
 *
toŞ_ts
 = 
	`gtk_toŞts_Ãw
();

3697 if(
sss
 && sss->
Üg
 )

3699 
gch¬
 *
comm’t
 = 
sss
->
Üg
->
Comm’t
;

3700 
Name
 = 
	`gtk_Ïb–_Ãw
(
sss
->
Üg
->
CÇme
);

3701 
	`gtk_toŞts_£t_t
(
toŞ_ts
,
Name
,
	`g_¡rdup
(
comm’t
),
NULL
);

3704 
cŞumTwo
 = 
	`çùÜy_ü—‹_v¬ŸÁ_objeù
(
sss
);

3705 
	`gtk_widg‘_£t_£ns™ive
(
cŞumTwo
,
sss
->
isS’s™ive
);

3706 
	`gtk_toŞts_£t_t
(
toŞ_ts
,
cŞumTwo
,
	`g_¡rdup
(
comm’t
),
NULL
);

3708 
sss
->
widg‘1
 = 
Name
;

3711 
	}
}

3714 
FaùÜySŒuùI‹m
 * 
	$çùÜy_fšd_a_¡ruù_™em
(
GLi¡
 *
™emli¡
,cÚ¡ 
gch¬
 *
‹xt
)

3716 
FaùÜySŒuùI‹m
 *
fsi
 = 
NULL
;

3717 
GLi¡
 *
uli¡
 = 
™emli¡
;

3718 ; 
uli¡
; uli¡ = uli¡->
Ãxt
)

3720 
fsi
 = 
uli¡
->
d©a
;

3721 if(!
	`g_ascii_¡rÿ£cmp
(
fsi
->
Name
,
‹xt
))

3726  
fsi
;

3727 
	}
}

3729 
	$çùÜy_§ve_’umbu‰Ú_dŸlog
(
GtkWidg‘
 *
widg‘
,
gšt
 
»¥Ú£_id
,
gpoš‹r
 
u£r_d©a
)

3731 
SaveSŒuù
 *
s¡
 = (SaveSŒuù *)
u£r_d©a
;

3732 
SaveEbŠ
 *
£bŠ
 = &
s¡
->
v®ue
.
s£bŠ
;

3733 
GLi¡
 *
wli¡
 = 
£bŠ
->
ebŠwli¡
;

3734 if(
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


3735 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
)

3737 
n
 = 0;

3738 
gch¬
 *
key
 = 
NULL
;

3739 ; 
wli¡
; wli¡ = wli¡->
Ãxt
)

3741 
SaveEnumA¼
 *
£a
 = 
wli¡
->
d©a
;

3742 
SaveEnum
 *
£
 = 
£a
->
£num
;

3743 
£
->
šdex
 = 
	`gtk_combo_box_g‘_aùive
(
	`GTK_COMBO_BOX
(
£a
->
widg‘2
));

3744 
key
 = 
	`gtk_combo_box_g‘_aùive_‹xt
(
	`GTK_COMBO_BOX
(
£a
->
widg‘2
));

3745 
GLi¡
 *
i¡
 = 
£bŠ
->
ebŠ¦i¡
;

3746 ; 
i¡
 ;li¡ =li¡->
Ãxt
)

3748 
FaùÜySŒuùEnum
 *
f£
 = 
i¡
->
d©a
;

3749 if(!
	`g_ascii_¡rÿ£cmp
(
f£
->
key
,key))

3751 
£
->
ev®ue
 = 
f£
->
v®ue
;

3757 
	`gtk_widg‘_hide
(
widg‘
);

3760 
	}
}

3762 
	$çùÜy_§ve_objeùbu‰Ú_dŸlog
(
GtkWidg‘
 *
widg‘
,

3763 
gšt
 
»¥Ú£_id
,

3764 
gpoš‹r
 
u£r_d©a
)

3766 
SaveSŒuù
 *
s¡
 = (SaveSŒuù *)
u£r_d©a
;

3767 
NextID
 *
nid
 = &
s¡
->
v®ue
.
Ãxtid
;

3768 
GLi¡
 *
wli¡
 = 
nid
->wlist;

3769 iàĞ
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


3770 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
)

3773 
n
 = 0;

3774 ; 
wli¡
; wli¡ = wli¡->
Ãxt
,
n
++)

3776 
GtkWidg‘
 *
wid
 = 
wli¡
->
d©a
;

3777 
AùiÚID
 *
aù
 = 
	`g_li¡_Áh_d©a
(
nid
->
aùli¡
,
n
);

3778 
	`çùÜy_g‘_v®ue_äom_comobox
(
s¡
->
sşass
,
wid
,
aù
);

3781 
	`gtk_widg‘_hide
(
widg‘
);

3784 
wli¡
 = 
nid
->wlist;

3785 ; 
wli¡
; wli¡ = wli¡->
Ãxt
)

3787 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
widg‘
),
wli¡
->
d©a
);

3789 
	`g_li¡_ä“
(
nid
->
wli¡
);

3790 
nid
->
wli¡
 = 
NULL
;

3791 
	}
}

3793 
	$çùÜy_d¿w_mªy_lšes_dŸlog
(
GtkWidg‘
 *
widg‘
,

3794 
gšt
 
»¥Ú£_id
,

3795 
gpoš‹r
 
u£r_d©a
)

3832 
	}
}

3835 
	$çùÜy_§ve_uniÚbu‰Ú_dŸlog
(
GtkWidg‘
 *
widg‘
,

3836 
gšt
 
»¥Ú£_id
,

3837 
gpoš‹r
 
u£r_d©a
)

3842 iàĞ
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


3843 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
)

3846 
SaveSŒuù
 *
s¡
 = (SaveSŒuù *)
u£r_d©a
;

3848 
SaveUbŠ
 *
sbŠ
 = &
s¡
->
v®ue
.
ssubŠ
;

3852 
GLi¡
 *
wli¡
 = 
sbŠ
->
§v–i¡
;

3853 ; 
wli¡
; wli¡ = wli¡->
Ãxt
)

3855 
SaveSŒuù
 *
vss
 = 
wli¡
->
d©a
;

3856 if(
vss
)

3857 
	`çùÜy_§ve_v®ue_äom_widg‘
(
vss
);

3860 
	`gtk_widg‘_hide
(
widg‘
);

3861 
	`gtk_widg‘_de¡roy
(
widg‘
);

3868 
	}
}

3870 
	$çùÜy_§ve_v®ue_äom_widg‘
(
SaveSŒuù
 *
sss
)

3873 
sss
->
ûÎty³
)

3875 
ECOMBO
:

3877 
sss
->
v®ue
.
£num
.
šdex
 = 
	`gtk_combo_box_g‘_aùive
(
	`GTK_COMBO_BOX
(sss->
widg‘2
));

3878 
FaùÜySŒuùEnum
 *
km­
 = 
	`g_li¡_Áh_d©a
(
sss
->
v®ue
.
£num
.
’umLi¡
,sss->v®ue.£num.
šdex
);

3879 if(
km­
)

3880 
sss
->
v®ue
.
£num
.
ev®ue
 = 
km­
->value;

3883 
ENTRY
:

3885 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

3887 if(
£y
->
isSŒšg
)

3889 
£y
->
d©a
 = 
	`g_loÿË_to_utf8
(
	`gtk_’Œy_g‘_‹xt
(
	`GTK_ENTRY
 (
sss
->
widg‘2
)),-1,
NULL
,NULL,NULL);

3893 
SPINBOX
:

3895 
gušt
 
v
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
sss
->
widg‘2
));

3896 
sss
->
v®ue
.
vnumb”
 = 
	`g_¡rdup_´štf
("%d",
v
);

3900 
UCOMBO
:

3902 
SaveUniÚ
 *
ssu
 = &
sss
->
v®ue
.
suniÚ
;

3903 
SaveSŒuù
 *
p
 = 
	`g_hash_bË_lookup
(
ssu
->
§veV®
,ssu->
curkey
);

3904 if(
p
)

3906 
p
->
ûÎty³
)

3908 
SPINBOX
:

3909 
ENTRY
:

3910 
ECOMBO
:

3911 
	`çùÜy_§ve_v®ue_äom_widg‘
(
p
);

3920 
	}
}

3924 
	$çùÜy_§ve_ba£bu‰Ú_dŸlog
(
GtkWidg‘
 *
widg‘
,

3925 
gšt
 
»¥Ú£_id
,

3926 
gpoš‹r
 
d©a
)

3928 
GLi¡
 *
tmp
;

3929 
SaveEÁry
 *
£y
 = 
d©a
;

3931 iàĞ
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


3932 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
)

3935 
®ign
 = 2+
£y
->
width
*2;

3936 
tmp
 = 
£y
->
wli¡
;

3937 
	`g_li¡_ä“1
(
£y
->
d©a
);

3938 
£y
->
d©a
 = 
NULL
;

3939  ; 
tmp
;m°ğtmp->
Ãxt
)

3941 
gch¬
 *
¡r
 = 
	`g_loÿË_to_utf8
(
	`gtk_’Œy_g‘_‹xt
(
tmp
->
d©a
),-1,
NULL
,NULL,NULL);

3942 
n
 = 
®ign
 - 
	`¡¾’
(
¡r
);

3943 if(
n
)

3946 
gch¬
 *
p
 = 
	`g_Ãw
(,
®ign
);

3947 
	`mem£t
(
p
,'\0',
®ign
);

3948 
p
 = 
	`¡ºıy
(p,"0x",2);

3949 
n
--)

3951 
	`¡ºÿt
(
p
,"0",1);

3953 
	`¡ºÿt
(
p
,&
¡r
[2],
	`¡¾’
(&str[2]));

3954 
	`g_ä“
(
¡r
);

3955 
¡r
 = 
p
;

3957 
£y
->
d©a
 = 
	`g_li¡_­³nd
(£y->d©a,
¡r
);

3962 
	`gtk_widg‘_hide
(
widg‘
);

3963 
tmp
 = 
£y
->
wli¡
;

3964 ; 
tmp
;m°ğtmp->
Ãxt
)

3965 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
widg‘
),
tmp
->
d©a
);

3968 
	}
}

3971 
gšt


3972 
	$çùÜy_subdig_checkbŠs_»¥Úd
(
GtkWidg‘
 *
widg‘
,
gšt
 
»¥Ú£_id
,
gpoš‹r
 
d©a
)

3974 
GLi¡
 *
wli¡
 = 
NULL
;

3975 
SaveEÁry
 *
£y
 = 
d©a
;

3977 iàĞ
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


3978 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
)

3980 
wli¡
 = 
£y
->wlist;

3981 
	`g_li¡_ä“1
(
£y
->
d©a
);

3982 
£y
->
d©a
 = 
NULL
;

3983  ; 
wli¡
; wli¡ = wli¡->
Ãxt
)

3985 
v
 = 
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
wli¡
->
d©a
)) ? 1 : 0;

3986 
£y
->
d©a
 = 
	`g_li¡_­³nd
(£y->d©a,
	`g_¡rdup_´štf
("%d",
v
));

3991 
	`gtk_widg‘_hide
(
widg‘
);

3993  
»¥Ú£_id
;

3994 
	}
}

3997 
	$çùoy_chªged_™em
(
gpoš‹r
 
widg‘
,gpoš‹¸
u£r_d©a
)

4001 
SaveSŒuù
 *
sss
 = 
u£r_d©a
;

4002 
SaveUniÚ
 *
su±r
 = &
sss
->
v®ue
.
suniÚ
;

4004 
GtkWidg‘
 *
aùiveWidg‘
 = 
NULL
;

4007 
GLi¡
 *
wli¡
 = 
	`gtk_cÚš”_chd»n
(
	`GTK_CONTAINER
(
su±r
->
vbox
));

4008 ; 
wli¡
; wli¡ = wli¡->
Ãxt
)

4010 
GtkWidg‘
 *
rwidg‘
 = 
wli¡
->
d©a
;

4011 if(
rwidg‘
 !ğ
su±r
->
comobox
)

4013 
	`gtk_cÚš”_»move
(
	`GTK_CONTAINER
(
su±r
->
vbox
),
rwidg‘
);

4014 
	`gtk_widg‘_de¡roy
 (
rwidg‘
);

4019 
gch¬
 *
‹xt
 = 
	`gtk_combo_box_g‘_aùive_‹xt
(
	`GTK_COMBO_BOX
(
widg‘
));

4020 
su±r
->
cu¹ext
 = 
	`g_¡rdup
(
‹xt
);

4021 
	`g_ä“
(
‹xt
);

4022 
su±r
->
šdex
 = 
	`gtk_combo_box_g‘_aùive
(
	`GTK_COMBO_BOX
(
widg‘
));

4026 
FaùÜySŒuùI‹m
 *
sf¡
ğ
	`çùÜy_fšd_a_¡ruù_™em
(
su±r
->
¡ruùli¡
,su±r->
cu¹ext
);

4027 if(
sf¡
)

4029 
SaveSŒuù
 *
exi¡S
 = 
NULL
;

4030 
su±r
->
curkey
 = 
	`g_¡rjoš
("##",
sf¡
->
FTy³
,sf¡->
Name
,
NULL
);

4031 if(
	`g_hash_bË_size
(
su±r
->
§veV®
))

4033 
exi¡S
 = 
	`g_hash_bË_lookup
(
su±r
->
§veV®
,su±r->
curkey
);

4034 if(!
exi¡S
)

4039 
CFIRST
;

4046 
CFIRST
:

4047 
exi¡S
 = 
	`çùÜy_g‘_§ve¡ruù
(
sf¡
);

4048 
exi¡S
->
sşass
 = 
sss
->sclass;

4049 
	`çùÜy_¡rjoš
(&
exi¡S
->
Çme
,
sss
->name,".");

4050 
	`g_hash_bË_š£¹
(
su±r
->
§veV®
,su±r->
curkey
,
exi¡S
);

4053 
aùiveWidg‘
 = 
	`çùÜy_ü—‹_v¬ŸÁ_objeù
(
exi¡S
);

4054 if(
exi¡S
->
isPoš‹r
 )

4057 
SaveUbŠ
 *
sbŠ
 = &
exi¡S
->
v®ue
.
ssubŠ
;

4058 
	`g_li¡_ä“1
(
sbŠ
->
§v–i¡
);

4059 
sbŠ
->
§v–i¡
 = 
NULL
;

4060 if(
sbŠ
->
¡ruùli¡
)

4062 
GLi¡
 *
¦i¡
 = 
sbŠ
->
¡ruùli¡
;

4063 ; 
¦i¡
; sli¡ = sli¡->
Ãxt
)

4065 
FaùÜySŒuùI‹m
 *
o
 = 
¦i¡
->
d©a
;

4066 
SaveSŒuù
 *
s
 = 
	`çùÜy_g‘_§ve¡ruù
(
o
);

4067 
s
->
sşass
 = 
sss
->sclass;

4068 
	`çùÜy_¡rjoš
(&
s
->
Çme
,
sss
->name,".");

4069 
sbŠ
->
§v–i¡
 = 
	`g_li¡_­³nd
(sbŠ->§v–i¡,
s
);

4074 
	`gtk_box_·ck_¡¬t_deçuÉs
(
	`GTK_BOX
(
su±r
->
vbox
),
aùiveWidg‘
);

4075 
	`gtk_cÚš”_»size_chd»n
 (
	`GTK_CONTAINER
(
su±r
->
vbox
));

4078 
	`gtk_widg‘_show_®l
(
su±r
->
vbox
);

4080 
	}
}

4082 
	$çùÜy_¡rjoš
(
gch¬
 **
d¡
,cÚ¡ gch¬ *
´efix
,cÚ¡ gch¬ *
£p
)

4084 
gch¬
 *
Úame
 = 
	`g_¡rdup
(*
d¡
);

4085 
	`g_ä“
(*
d¡
);

4086 *
d¡
 = 
	`g_¡rjoš
(
£p
,
´efix
,
Úame
,
NULL
);

4087 
	`g_ä“
(
Úame
);

4088 
	}
}

4093 
	$çùÜy_ü—‹_ba£bu‰Ú_dŸlog
(
GtkWidg‘
 *
bu‰Ú
,
SaveSŒuù
 *
sss
)

4096 
GtkWidg‘
 *
sdŸlog
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

4097 
GtkWidg‘
 *
subdig
 = 
	`çùÜy_ü—‹_Ãw_dŸlog_w™h_bu‰Ús
(
sss
->
Çme
,
	`gtk_widg‘_g‘_tİËv–
(
bu‰Ú
));

4098 
GtkWidg‘
 *
dŸlog_vbox
 = 
	`GTK_DIALOG
(
subdig
)->
vbox
;

4099 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog_vbox
),
sdŸlog
);

4100 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
subdig
),
TRUE
);

4105 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
subdig
), 
GTK_RESPONSE_OK
);

4112 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
(
subdig
),
FALSE
);

4113 
	`gtk_wšdow_£t_pos™iÚ
 (
	`GTK_WINDOW
(
subdig
),
GTK_WIN_POS_MOUSE
);

4114 
	`gtk_wšdow_´e£Á
(
	`GTK_WINDOW
(
subdig
));

4115 
gch¬
 **
vvv
 = 
	`g_¡r¥l™
(
sss
->
ty³
,".",-1);

4116 
Ën
 = 
	`g_¡rv_Ëngth
(
vvv
) -1 ;

4117 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

4127 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
sdŸlog
),
	`çùÜy_ü—‹_mªy_’Œy_box
(
sss
),
FALSE
,FALSE,0);

4128 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
(
subdig
), "»¥Ú£",
	`G_CALLBACK
(
sss
->
şo£_func
),
£y
);

4130 
	`g_¡rä“v
(
vvv
);

4131 
	`gtk_widg‘_show_®l
(
subdig
);

4132 
	}
}

4137 
	$çùÜy_ü—‹_’umbu‰Ú_dŸlog
(
GtkWidg‘
 *
bu‰Ú
,
SaveSŒuù
 *
s¡
)

4139 
GtkWidg‘
 *
sdŸlog
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

4140 
GtkWidg‘
 *
ÃwdŸlog
 = 
	`çùÜy_ü—‹_Ãw_dŸlog_w™h_bu‰Ús
(
s¡
->
Çme
,
	`gtk_widg‘_g‘_tİËv–
(
bu‰Ú
));

4141 
GtkWidg‘
 *
dŸlog_vbox
 = 
	`GTK_DIALOG
(
ÃwdŸlog
)->
vbox
;

4142 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog_vbox
),
sdŸlog
);

4143 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
ÃwdŸlog
),
TRUE
);

4144 
SaveEbŠ
 *
£bŠ
 = &
s¡
->
v®ue
.
s£bŠ
;

4147 
gch¬
 **
t™Ë
 = 
	`g_¡r¥l™
(
s¡
->
Çme
,"[",-1);

4148 
gch¬
 *
fmt
 = 
	`g_¡rcÚÿt
(
t™Ë
[0],"(%d)",
NULL
);

4149 
	`g_¡rä“v
(
t™Ë
);

4151 
r
 = 0;

4152 
pos
 = 0;

4153 
Šum
 = 0;

4154 
A¼ayBa£Prİ
 *
abp
 = 
£bŠ
->
¬r_ba£
;

4156 ; 
r
 < 
abp
->
row
 ;„++)

4158 
GtkWidg‘
 *
vbox
 = 
	`gtk_vbox_Ãw
(
TRUE
,0);

4159 
c
 = 0;

4160 
Šum
 = 
r
*
abp
->
cŞ
;

4161 ; 
c
 < 
abp
->
cŞ
 ; c++)

4163 
pos
 = 
Šum
 +
c
;

4164 ifĞ
pos
 >ğ
abp
->
»®Ën
)

4166 
GtkWidg‘
 *
hbox
 = 
abp
->
row
 > 8 ? 
	`gtk_vbox_Ãw
(
FALSE
,0): 
	`gtk_hbox_Ãw
(FALSE,0) ;

4167 
SaveEnumA¼
 *
£a
 = 
	`g_li¡_Áh_d©a
(
£bŠ
->
ebŠwli¡
,
pos
);

4168 
GtkWidg‘
 *
comobox
 = 
	`çùÜy_ü—‹_combo_widg‘
(
£a
->
£num
->
’umLi¡
,£a->£num->
šdex
);

4169 
GtkWidg‘
 *
wid
 = 
	`gtk_Ïb–_Ãw
(
	`g_¡rdup_´štf
(
fmt
,
pos
));

4170 
£a
->
widg‘1
 = 
wid
;

4171 
£a
->
widg‘2
 = 
comobox
;

4172 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
wid
,
FALSE
,FALSE,0);

4173 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
comobox
,
FALSE
,FALSE,0);

4174 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
),
hbox
,
FALSE
,FALSE,0);

4175 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
vbox
),
hbox
);

4177 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
sdŸlog
),
vbox
);

4179 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
ÃwdŸlog
), "response",

4180 
	`G_CALLBACK
 (
s¡
->
şo£_func
), sst);

4181 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
ÃwdŸlog
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &newdialog);

4182 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
sdŸlog
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
),&
dŸlog_vbox
);

4183 
	`gtk_widg‘_show_®l
(
ÃwdŸlog
);

4185 
	}
}

4188 
	$çùÜy_ü—‹_objeùbu‰Ú_dŸlog
(
GtkWidg‘
 *
bu‰Ú
,
SaveSŒuù
 *
s¡
)

4191 
GtkWidg‘
 *
sdŸlog
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

4192 
GtkWidg‘
 *
subdig
 = 
	`çùÜy_ü—‹_Ãw_dŸlog_w™h_bu‰Ús
(
s¡
->
Çme
,
bu‰Ú
->
wšdow
);

4193 
GtkWidg‘
 *
dŸlog_vbox
 = 
	`GTK_DIALOG
(
subdig
)->
vbox
;

4194 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog_vbox
),
sdŸlog
);

4195 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
subdig
),
TRUE
);

4197 
NextID
 *
Ãxtid
 = &
s¡
->
v®ue
.nextid;

4198 
STRUCTCÏss
 *
Ügşass
 = 
s¡
->
sşass
;

4199 
Ãxtid
->
™emli¡
 = 
	`çùÜy_g‘_objeùs_äom_Ïy”
(
curLay”
);

4200 
Ãxtid
->
™emli¡
 = 
	`g_li¡_š£¹
Òextid->™emli¡,
	`g_¡rdup
(""),0);

4202 
r
 = 0;

4203 
pos
 = 0;

4204 
Šum
 = 0;

4205 
A¼ayBa£Prİ
 *
abp
 = 
Ãxtid
->
¬r_ba£
;

4206 ; 
r
 < 
abp
->
row
 ;„++)

4208 
GtkWidg‘
 *
vbox
 = 
	`gtk_vbox_Ãw
(
TRUE
,0);

4209 
c
 = 0;

4210 
Šum
 = 
r
*
abp
->
cŞ
;

4211 ; 
c
 < 
abp
->
cŞ
 ; c++)

4213 
pos
 = 
Šum
 +
c
;

4214 ifĞ
pos
 >ğ
abp
->
»®Ën
)

4216 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

4217 
AùiÚID
 *
aid
 = 
	`g_li¡_Áh_d©a
(
Ãxtid
->
aùli¡
,
pos
);

4218 
GtkWidg‘
 *
comobox
 = 
	`çùÜy_ü—‹_combo_widg‘
(
Ãxtid
->
™emli¡
,
aid
->
šdex
);

4219 
GtkWidg‘
 *
wid
 = 
	`gtk_Ïb–_Ãw
(
aid
->
t™Ë_Çme
);

4220 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
wid
,
FALSE
,FALSE,0);

4221 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
comobox
,
FALSE
,FALSE,0);

4222 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
),
hbox
,
FALSE
,FALSE,0);

4223 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
vbox
),
hbox
);

4225 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
sdŸlog
),
vbox
);

4227 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
subdig
), "response",

4228 
	`G_CALLBACK
 (
s¡
->
şo£_func
), sst);

4230 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
subdig
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &subdig);

4231 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
sdŸlog
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
),&
dŸlog_vbox
);

4232 
	`gtk_widg‘_show_®l
(
subdig
);

4234 
	}
}

4237 
	$çùÜy_ü—‹_£Ëù®l_ªd_»v”£
(
GtkWidg‘
 *
·»Á
,GtkWidg‘ **
£Ëù®l
,GtkWidg‘ **
»v”£
)

4239 
GtkWidg‘
 *
£p1
 = 
	`gtk_h£·¿tÜ_Ãw
();

4240 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
·»Á
),
£p1
,
TRUE
,TRUE,1);

4242 *
£Ëù®l
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
	`g_loÿË_to_utf8
(
	`_
("È«Ñ¡"),-1,
NULL
,NULL,NULL));

4243 *
»v”£
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
	`g_loÿË_to_utf8
(
	`_
("·´Ñ¡"),-1,
NULL
,NULL,NULL));

4244 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

4245 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
·»Á
),
hbox
,
TRUE
,TRUE,1);

4246 
	`gtk_box_·ck_’d
(
	`GTK_BOX
(
hbox
),*
£Ëù®l
,
FALSE
,FALSE,0);

4247 
	`gtk_box_·ck_’d
(
	`GTK_BOX
(
hbox
),*
»v”£
,
FALSE
,FALSE,0);

4248 
GtkWidg‘
 *
£p2
 = 
	`gtk_h£·¿tÜ_Ãw
();

4249 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
·»Á
),
£p2
,
TRUE
,TRUE,1);

4250 
	}
}

4253 
	$çùÜy_hªdË_£Ëù_®l
(
GtkWidg‘
 *
widg‘
,
GLi¡
 *
u£r_d©a
)

4255 
GLi¡
 *
wli¡
 = 
u£r_d©a
;

4256 ; 
wli¡
; wli¡ = wli¡->
Ãxt
)

4258 
	`gtk_toggË_bu‰Ú_£t_aùive
(
wli¡
->
d©a
,
TRUE
);

4260 
	}
}

4262 
	$çùÜy_hªdË_»v”£_£Ëù
(
GtkWidg‘
 *
widg‘
,
GLi¡
 *
u£r_d©a
)

4264 
GLi¡
 *
wli¡
 = 
u£r_d©a
;

4265 ; 
wli¡
; wli¡ = wli¡->
Ãxt
)

4267 
gboŞ—n
 
b
ğ
	`gtk_toggË_bu‰Ú_g‘_aùive
(
wli¡
->
d©a
);

4268 
	`gtk_toggË_bu‰Ú_£t_aùive
(
wli¡
->
d©a
,!
b
);

4270 
	}
}

4274 
STRUCTCÏss
 *
	$çùÜy_fšd_dŸobjeù_by_Çme
(
Lay”
 *
cu¾ay”
,cÚ¡ 
gch¬
 *
Çme
)

4278 
GLi¡
 *
objli¡
 = 
NULL
;

4279 if(
cu¾ay”
)

4280 
objli¡
 = 
cu¾ay”
->
objeùs
;

4281 
STRUCTCÏss
 *
objşass
 = 
NULL
;

4282 ; 
objli¡
 ; objli¡ = objli¡->
Ãxt
 )

4284 if(!
	`çùÜy_is_v®id_ty³
(
objli¡
->
d©a
))

4286 
objşass
 = 
objli¡
->
d©a
;

4287 if(!
	`g_ascii_¡rÿ£cmp
(
objşass
->
Çme
,name))

4293  
objşass
;

4294 
	}
}

4296 
gboŞ—n
 
	$çùÜy_is_cÚÃùed
(
CÚÃùiÚPošt
 *
ı’d
,CÚÃùiÚPošˆ*
ı¡¬t
)

4298 
gboŞ—n
 
iscÚÃùed
 = 
FALSE
;

4299 
DŸObjeù
 *
obj
 = 
	`çùÜy_fšd_§me_dŸobjeù_vŸ_gli¡
(
ı’d
->
cÚÃùed
,
ı¡¬t
->connected);

4300 if(
obj
)

4302 if((
obj
->
hªdËs
[0]->
cÚÃùed_to
 =ğ
ı¡¬t
) &&

4303 (
obj
->
hªdËs
[1]->
cÚÃùed_to
 =ğ
ı’d
))

4304 
iscÚÃùed
 = 
TRUE
;

4306  
iscÚÃùed
;

4307 
	}
}

4308 
STRUCTCÏss
* 
	$çùÜy_g‘_objeù_äom_Ïy”
(
Lay”
 *
Ïy”
,cÚ¡ 
gch¬
 *
Çme
)

4310 
GLi¡
 *
objli¡
 = 
NULL
;

4311 
STRUCTCÏss
 *
fşass
 = 
NULL
;

4312 if(
curLay”
)

4313 
objli¡
 = 
Ïy”
->
objeùs
 ;

4314 ; 
objli¡
 ; objli¡ = objli¡->
Ãxt
 )

4316 if(!
	`çùÜy_is_v®id_ty³
(
objli¡
->
d©a
))

4318 
fşass
 = 
objli¡
->
d©a
;

4319 if(!
	`g_ascii_¡rÿ£cmp
(
fşass
->
Çme
,name))

4324  
fşass
;

4325 
	}
}

4327 
GLi¡
 * 
	$çùÜy_g‘_objeùs_äom_Ïy”
(
Lay”
 *
Ïy”
)

4329 
GLi¡
 *
objli¡
 = 
NULL
;

4330 if(
curLay”
)

4331 
objli¡
 = 
Ïy”
->
objeùs
 ;

4332 
GLi¡
 *
li¡
 = 
NULL
;

4333 ; 
objli¡
 ; objli¡ = objli¡->
Ãxt
 )

4335 if(!
	`çùÜy_is_v®id_ty³
(
objli¡
->
d©a
))

4337 
STRUCTCÏss
* 
objşass
 = 
objli¡
->
d©a
;

4338 if(!
	`g_ascii_¡rÿ£cmp
(
objşass
->
–em’t
.
objeù
.
Çme
,"SYS_DATA")

4339 || 
	`çùÜy_is_¥ecŸl_objeù
(
objşass
->
–em’t
.
objeù
.
Çme
))

4341 
li¡
 = 
	`g_li¡_­³nd
Öi¡,
objşass
->
Çme
);

4343  
li¡
;

4344 
	}
}

4435 
	$çùÜy_ü—‹_uniÚbu‰Ú_dŸlog
(
GtkWidg‘
 *
bu‰Ú
,
SaveSŒuù
 *
s¡
)

4438 
SaveUbŠ
 *
sbŠ
 = &
s¡
->
v®ue
.
ssubŠ
;

4441 
GtkWidg‘
 *
subdig
 = 
	`çùÜy_ü—‹_Ãw_dŸlog_w™h_bu‰Ús
(
s¡
->
Çme
,
bu‰Ú
->
wšdow
);

4442 
GtkWidg‘
 *
dŸlog_vbox
 = 
	`GTK_DIALOG
(
subdig
)->
vbox
;

4444 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
subdig
),
TRUE
);

4446 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
subdig
), 
GTK_RESPONSE_OK
);

4447 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
(
subdig
),
FALSE
);

4448 
	`gtk_wšdow_£t_pos™iÚ
 (
	`GTK_WINDOW
(
subdig
),
GTK_WIN_POS_MOUSE
);

4450 
num
 = 
	`g_li¡_Ëngth
(
sbŠ
->
¡ruùli¡
);

4451 
GtkTabË
 *
bË
 = 
	`gtk_bË_Ãw
(
num
,4,
FALSE
);

4453 
STRUCTCÏssDŸlog
 *
sdŸlog
 = 
	`g_Ãw0
(STRUCTClassDialog,1);

4454 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog_vbox
),
sdŸlog
);

4455 
sdŸlog
->
dŸlog
 = 
	`gtk_vbox_Ãw
(
TRUE
,0);

4456 
sdŸlog
->
mašTabË
 = 
bË
;

4457 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
sdŸlog
->
dŸlog
),sdŸlog->
mašTabË
);

4460 
GLi¡
 *
sub™em
 = 
sbŠ
->
§v–i¡
;

4461 if(
sub™em
)

4462 
	`çùÜy_ü—‹_¡ruù_dŸlog
(
	`GTK_WIDGET
(
bË
),
sub™em
);

4465 if(
sbŠ
->
¡ruùli¡
)

4467 
	`g_li¡_ä“1
(
sbŠ
->
§v–i¡
);

4468 
sbŠ
->
§v–i¡
 = 
NULL
;

4469 
GLi¡
 *
¦i¡
 = 
sbŠ
->
¡ruùli¡
;

4470 ; 
¦i¡
; sli¡ = sli¡->
Ãxt
)

4472 
FaùÜySŒuùI‹m
 *
o
 = 
¦i¡
->
d©a
;

4473 
SaveSŒuù
 *
s
 = 
	`çùÜy_g‘_§ve¡ruù
(
o
);

4474 
s
->
sşass
 = 
s¡
->sclass;

4475 
	`çùÜy_¡rjoš
(&
s
->
Çme
,
s¡
->name,".");

4476 
sbŠ
->
§v–i¡
 = 
	`g_li¡_­³nd
(sbŠ->§v–i¡,
s
);

4478 
sub™em
 = 
sbŠ
->
§v–i¡
;

4479 if(
sub™em
)

4481 
	`çùÜy_ü—‹_¡ruù_dŸlog
(
	`GTK_WIDGET
(
bË
),
sub™em
);

4486 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
dŸlog_vbox
),
sdŸlog
->
dŸlog
,
FALSE
,FALSE,0);

4487 
	`gtk_bË_£t_cŞ_¥acšg
(
	`GTK_TABLE
(
bË
),1,20);

4488 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
subdig
), "»¥Ú£",
	`G_CALLBACK
 (
s¡
->
şo£_func
), sst);

4489 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
subdig
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &subdig);

4490 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
sdŸlog
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
),&
dŸlog_vbox
);

4491 
	`gtk_widg‘_show_®l
(
subdig
);

4492 
	}
}

4496 
GtkWidg‘
 *
	$çùÜy_ü—‹_mªy_checkbox
(
SaveSŒuù
 *
sss
)

4498 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

4499 
GtkToŞts
 *
ts
 = 
	`gtk_toŞts_Ãw
();

4501 
row
 = 
£y
->
¬r_ba£
->row;

4502 
cŞ
 = 
£y
->
¬r_ba£
->col;

4503 
r
 = 0 ;

4504 
GtkWidg‘
 *
vbox
 = 
	`gtk_vbox_Ãw
(
FALSE
,0);

4505 
	`gtk_toŞts_£t_t
(
ts
,
vbox
,
sss
->
Üg
->
Comm’t
,
NULL
);

4506 
	`g_li¡_ä“1
(
£y
->
wli¡
);

4507 
£y
->
wli¡
 = 
NULL
;

4508 ; 
r
 < 
row
 ;„++)

4510 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

4511 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
),
hbox
,
FALSE
,FALSE,0);

4512 
c
 = 0;

4513 ; 
c
 < 
cŞ
 ; c++)

4515 
GtkWidg‘
 *
checkbŠ
 = 
	`gtk_check_bu‰Ú_Ãw_w™h_Ïb–
(
	`g_¡rdup_´štf
(
	`_
("p%d"),7-
c
));

4516 
gch¬
 *
v®
 = 
	`g_li¡_Áh_d©a
(
£y
->
d©a
,
r
*
cŞ
+
c
);

4517 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
checkbŠ
),

4518 !
	`g_ascii_¡ºÿ£cmp
(
v®
,
	`_
("1"),1è? 
TRUE
 : 
FALSE
);

4519 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
checkbŠ
,
FALSE
,FALSE,1);

4520 
£y
->
wli¡
 = 
	`g_li¡_­³nd
(£y->wli¡,
checkbŠ
);

4523  
vbox
;

4524 
	}
}

4526 
GtkWidg‘
 *
	$çùÜy_ü—‹_mªy_’Œy_box
(
SaveSŒuù
 *
sss
)

4530 
SaveEÁry
 *
£y
 = &
sss
->
v®ue
.
£Áry
;

4531 
GtkToŞts
 *
ts
 = 
	`gtk_toŞts_Ãw
();

4533 
GLi¡
 *
wli¡
 = 
NULL
;

4534 
row
 = 
£y
->
¬r_ba£
->row;

4535 
cŞ
 = 
£y
->
¬r_ba£
->col;

4542 
r
 = 0 ;

4543 
GtkWidg‘
 *
vbox
 = 
	`gtk_vbox_Ãw
(
TRUE
,0);

4544 
	`gtk_toŞts_£t_t
(
ts
,
vbox
,
sss
->
Üg
->
Comm’t
,
NULL
);

4545 ; 
r
 < 
row
 ;„++)

4547 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
TRUE
,0);

4548 
c
 = 0;

4549 ; 
c
 < 
cŞ
 ; c++)

4551 
GtkWidg‘
 *
’Œy
 = 
	`gtk_’Œy_Ãw
();

4553 
maxËngth
 = 2+
£y
->
width
 * 2;

4554 
	`gtk_’Œy_£t_max_Ëngth
 (
	`GTK_ENTRY
 (
’Œy
), 
maxËngth
);

4555 
	`gtk_’Œy_£t_width_ch¬s
(
	`GTK_ENTRY
 (
’Œy
), 
maxËngth
);

4556 
gch¬
 *
¡r
 = 
	`g_li¡_Áh_d©a
(
£y
->
d©a
,
r
*
cŞ
+
c
);

4557 if(
¡r
)

4558 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
 (
’Œy
),
¡r
);

4561 
	`gtk_’Œy_£t_‹xt
(
	`GTK_ENTRY
 (
’Œy
),"0x");

4562 
w
 = 0;

4563 
w
; w < 
£y
->
width
; w++ )

4564 
	`gtk_’Œy_­³nd_‹xt
(
	`GTK_ENTRY
(
’Œy
),"ff");

4567 
	`g_sigÇl_cÚÃù
(
’Œy
, "d–‘e_‹xt", 
	`G_CALLBACK
(
çùÜy_ed™abË_d–‘e_ÿÎback
), 
NULL
);

4568 
	`g_sigÇl_cÚÃù
(
’Œy
, "š£¹_‹xt", 
	`G_CALLBACK
(
çùÜy_ed™abË_š£¹_ÿÎback
), 
NULL
);

4569 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
’Œy
), "’‹r_nÙify_ev’t", 
	`G_CALLBACK
(
çùÜy_ed™abË_aùive_ÿÎback
), 
NULL
);

4570 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
’Œy
), "£ËùiÚ_nÙify_ev’t", 
	`G_CALLBACK
(
çùÜy_ed™abË_aùive_ÿÎback
), 
NULL
);

4571 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
’Œy
,
FALSE
,FALSE,0);

4572 
wli¡
 = 
	`g_li¡_­³nd
(wli¡,
’Œy
);

4574 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
),
hbox
,
FALSE
,FALSE,0);

4576 
	`g_li¡_ä“
(
£y
->
wli¡
);

4577 
£y
->
wli¡
 = wlist;

4578  (
GtkWidg‘
 *)
vbox
;

4579 
	}
}

4581 
	$çùÜy_ed™abË_d–‘e_ÿÎback
(
GtkEd™abË
 *
ed™
,

4582 
gšt
 
¡¬t_pos
,

4583 
gšt
 
’d_pos
)

4585 
gch¬
 *
txt
 = 
	`gtk_ed™abË_g‘_ch¬s
 (
ed™
,0,-1);

4588 ifĞ(2==
	`¡¾’
(
txt
)è&& (0 =ğ
	`g_ascii_¡ºÿ£cmp
(txt,"0x",2)))

4590 
	`g_sigÇl_¡İ_emissiÚ_by_Çme
 (
	`G_OBJECT
 (
ed™
), "delete_text");

4593 if(
¡¬t_pos
 < 2)

4595 
	`g_sigÇl_¡İ_emissiÚ_by_Çme
 (
	`G_OBJECT
 (
ed™
), "delete_text");

4596 
	`gtk_ed™abË_£Ëù_»giÚ
(
ed™
,2,
’d_pos
);

4597 
	`gtk_ed™abË_d–‘e_‹xt
 (
ed™
,2,
’d_pos
);

4599 
	}
}

4601 
	$çùÜy_ed™abË_aùive_ÿÎback
(
GtkEd™abË
 *
ed™
,
gpoš‹r
 
d©a
)

4603 
	`gtk_ed™abË_£Ëù_»giÚ
(
ed™
,2,-1);

4604 
	`g_sigÇl_¡İ_emissiÚ_by_Çme
 (
	`G_OBJECT
 (
ed™
), "selection_clear_event");

4606 
	}
}

4608 
	$çùÜy_ed™abË_š£¹_ÿÎback
(
GtkEÁry
 *
’Œy
,

4609 
gch¬
* 
Ãw_‹xt
,

4610 
gšt
 
Ãw_Ëngth
,

4611 
gpoš‹r
 
pos™iÚ
,

4612 
gpoš‹r
 
d©a
)

4614 
GtkEd™abË
 *
ed™
 = 
	`GTK_EDITABLE
(
’Œy
);

4615 
gch¬
 *
tmp
 = 
Ãw_‹xt
;

4616 
gch¬
 *
»suÉ
 = 
	`g_Ãw
(gch¬,
Ãw_Ëngth
);

4617 
	`mem£t
(
»suÉ
,'\0',
Ãw_Ëngth
);

4618 
gch¬
 *
ns
 = 
»suÉ
;

4619 *
tmp
)

4621 ifĞ*
tmp
 =ğ'x' || 
	`g_ascii_isxdig™
(*tmp))

4623 *
ns
++ = *
tmp
++;

4626 *
tmp
++;

4630 if(
ns
 - 
»suÉ
)

4632 
	`g_sigÇl_hªdËrs_block_by_func
(
	`G_OBJECT
(
ed™
),

4633 
	`G_CALLBACK
(
çùÜy_ed™abË_š£¹_ÿÎback
),

4634 
d©a
);

4635 
	`gtk_ed™abË_š£¹_‹xt
(
ed™
,
»suÉ
,
ns
-»suÉ,
pos™iÚ
);

4636 
	`g_sigÇl_hªdËrs_unblock_by_func
 (
	`G_OBJECT
 (
ed™
),

4637 
	`G_CALLBACK
 (
çùÜy_ed™abË_š£¹_ÿÎback
),
d©a
);

4639 
	`g_sigÇl_¡İ_emissiÚ_by_Çme
 (
	`G_OBJECT
 (
ed™
), "insert_text");

4640 
	}
}

4645 
	$çùÜy_ü—‹_¡ruù_dŸlog
(
GtkWidg‘
 *
dŸlog
,
GLi¡
 *
d©®i¡
)

4648 
GLi¡
 *
™em
 = 
d©®i¡
;

4649 
row
 = 0;

4650 ; 
™em
 ; i‹m = i‹m->
Ãxt
)

4652 
SaveSŒuù
 *
s¡
 = 
™em
->
d©a
;

4653 
	`çùÜy_£t_§ve¡ruù_widg‘s
(
s¡
);

4654 if(
	`g_ascii_¡rÿ£cmp
(
	`çùÜy_loÿË
(
s¡
->
Üg
->
CÇme
),
	`_
("±£Áô")))

4656 
	`çùÜy_£t_twoxtwo_bË
(
dŸlog
,
s¡
->
widg‘1
,s¡->
widg‘2
,
row
++);

4660 
	}
}

4663 
	$çùÜy_­³nd_public_šfo
(
GtkWidg‘
 *
dŸlog
,
STRUCTCÏss
 *
fşass
)

4665 
GtkWidg‘
 *
chbox
 = 
	`gtk_check_bu‰Ú_Ãw_w™h_Ïb–
(
	`çùÜy_utf8
(
	`_
("±à¼­Íê³É")));

4666 
GtkWidg‘
 *
’Œy
 = 
	`gtk_’Œy_Ãw
();

4668 
GtkWidg‘
 *
£p
 = 
	`gtk_h£·¿tÜ_Ãw
();

4669 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog
),
£p
);

4670 
PublicSeùiÚ
 *
µs
 = 
NULL
;

4671 if(
NULL
 =ğ
fşass
->
µs
)

4673 
µs
 = 
	`g_Ãw0
(
PublicSeùiÚ
,1);

4674 
fşass
->
µs
 =…ps;

4675 
µs
->
hasfšished
 = 
FALSE
;

4676 
µs
->
Çme
 = 
	`g_¡rdup
(
fşass
->name);

4680 
µs
 = 
fşass
->pps;

4682 
µs
->
wid_hasfšished
 = 
chbox
 ;

4683 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

4684 
GtkWidg‘
 *
Çme_Ïb
 = 
	`gtk_Ïb–_Ãw
(
	`g_loÿË_to_utf8
(
	`_
("¶ÔÏñÖØÃüÃû:"),-1,
NULL
,NULL,NULL));

4685 
µs
->
wid_»Çme_’Œy
 = 
’Œy
;

4686 
	`gtk_toggË_bu‰Ú_£t_aùive
 (
	`GTK_TOGGLE_BUTTON
(
chbox
),
µs
->
hasfšished
);

4687 
	`gtk_’Œy_£t_‹xt
Ğ
	`GTK_ENTRY
(
µs
->
wid_»Çme_’Œy
),µs->
Çme
);

4688 
	`gtk_’Œy_£t_max_Ëngth
(
	`GTK_ENTRY
(
µs
->
wid_»Çme_’Œy
),255);

4689 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
), 
Çme_Ïb
, 
FALSE
, FALSE, 0);

4690 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
), 
µs
->
wid_»Çme_’Œy
, 
TRUE
, TRUE, 0);

4692 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog
),
µs
->
wid_hasfšished
);

4693 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog
),
hbox
);

4696 
	}
}

4699 
	$çùÜy_ü—‹_ªd_fl_dŸlog
(
STRUCTCÏss
 *
fşass
, 
gboŞ—n
 
is_deçuÉ
)

4702 
curLay”
 = 
çùÜyCÚš”
->curLayer;

4703 
STRUCTCÏssDŸlog
 *
´İ_dŸlog
 = 
fşass
->
´İ”t›s_dŸlog
;

4723 
GLi¡
 *
rg‘li¡
 = 
fşass
->
widg‘Save
;

4724 if(!
rg‘li¡
)

4726 
	`çùÜy_»ad_š™Ÿl_to_¡ruù
(
fşass
);

4728 
num
 = 
	`g_li¡_Ëngth
(
rg‘li¡
);

4729 
´İ_dŸlog
->
mašTabË
 = 
	`gtk_bË_Ãw
(
num
,4,
FALSE
);

4730 
	`çùÜy_ü—‹_¡ruù_dŸlog
(
´İ_dŸlog
->
mašTabË
,
rg‘li¡
);

4731 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
´İ_dŸlog
->
dŸlog
),´İ_dŸlog->
mašTabË
);

4732 if(
	`g_ascii_¡rÿ£cmp
(
fşass
->
–em’t
.
objeù
.
Çme
,"SYS_DATA"))

4734 
	`çùÜy_­³nd_public_šfo
(
´İ_dŸlog
->
dŸlog
,
fşass
);

4735 
	`gtk_bË_£t_cŞ_¥acšg
(
	`GTK_TABLE
(
´İ_dŸlog
->
mašTabË
),1,20);

4738 
	}
}

4744 
	$çùÜy_music_fe_mªag”_»move_®l
(
SaveMusicDŸlog
 *
smd
)

4746 
GLi¡
 *
i¡
 = 
smd
->
™emli¡
;

4747 ; 
i¡
 ;li¡ =li¡->
Ãxt
)

4749 
SaveMusicI‹m
 *
smi
 = 
i¡
->
d©a
;

4750 
GtkT»eMod–
 *
¡Üe
 = 
	`gtk_combo_box_g‘_mod–
Ğ
smi
->
wid_cŞum3
 );

4751 
	`gtk_li¡_¡Üe_ş—r
Ğ
	`GTK_TREE_STORE
Ğ
¡Üe
 ) );

4753 
	}
}

4756 
	$çùÜy_music_fe_mªag”_Ãw_™em_chªged
(
SaveMusicDŸlog
 *
smd
)

4758 
GLi¡
 *
i¡
 = 
smd
->
™emli¡
;

4759 
GLi¡
 *
Ãwæi¡
 = 
smd
->
cboxli¡
;

4760 ; 
i¡
 ;li¡ =li¡->
Ãxt
)

4762 
SaveMusicI‹m
 *
smi
 = 
i¡
->
d©a
;

4763 
smi
->
aùive
 = 
	`gtk_combo_box_g‘_aùive
(
	`GTK_COMBO_BOX
(smi->
wid_cŞum3
));

4764 
GtkT»eMod–
 *
¡Üe
 = 
	`gtk_combo_box_g‘_mod–
(
	`GTK_COMBO_BOX
(
smi
->
wid_cŞum3
 ));

4765 
	`gtk_li¡_¡Üe_ş—r
Ğ
	`GTK_TREE_STORE
Ğ
¡Üe
 ) );

4766 
Ãwæi¡
 = 
smd
->
cboxli¡
;

4767 
	`gtk_combo_box_­³nd_‹xt
(
smi
->
wid_cŞum3
,"");

4768 ; 
Ãwæi¡
 ;‚ewæi¡ =‚ewæi¡->
Ãxt
)

4770 
	`gtk_combo_box_­³nd_‹xt
(
smi
->
wid_cŞum3
,
Ãwæi¡
->
d©a
);

4771 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
smi
->
wid_cŞum3
),smi->
aùive
);

4775 
	}
}

4780 
gboŞ—n
 
	$çùÜy_is_sy¡em_d©a
(cÚ¡ 
gch¬
 *
Çme
)

4782 
gboŞ—n
 *
b
 = 
FALSE
;

4783 if(!
	`g_ascii_¡rÿ£cmp
(
Çme
,"SYS_DATA"))

4784 
b
 = 
TRUE
;

4785  
b
;

4786 
	}
}

4789 
GtkWidg‘
 *
	$çùÜy_g‘_Ãw_™em_h—d
()

4791 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

4792 
GtkWidg‘
 *
fœ¡
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("ĞòºÅ"));

4793 
GtkWidg‘
 *
£c
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("µØÖ·"));

4794 
GtkWidg‘
 *
thœd
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("ĞĞÎªID"));

4795 
GtkWidg‘
 *
four
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("²Ù×÷"));

4796 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
fœ¡
,
TRUE
,TRUE,0);

4797 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
£c
,
TRUE
,TRUE,0);

4798 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
thœd
,
TRUE
,TRUE,0);

4799 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
four
,
TRUE
,TRUE,0);

4800 
	`gtk_widg‘_show_®l
(
hbox
);

4801  
hbox
;

4802 
	}
}

4804 
GtkWidg‘
 *
	$çùÜy_fe_id_mªag”_h—d
()

4806 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

4807 
GtkWidg‘
 *
fœ¡
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("Ë÷ÒıºÅ"));

4808 
GtkWidg‘
 *
£c
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("µØÖ·"));

4809 
GtkWidg‘
 *
thœd
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("ÒôÀÖÎÄ¼ş"));

4811 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
fœ¡
,
TRUE
,TRUE,0);

4812 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
£c
,
TRUE
,TRUE,0);

4813 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
thœd
,
TRUE
,TRUE,0);

4815 
	`gtk_widg‘_show_®l
(
hbox
);

4816  
hbox
;

4817 
	}
}

4819 
GtkWidg‘
 *
	$çùÜy_g‘_Ãw_music™em
(
SaveMusicI‹m
 *
smt
,
GLi¡
 *
fli¡
,
GSLi¡
 **
grou¶i¡
)

4822 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,1);

4823 
GtkWidg‘
 *
¿dio
 = 
	`gtk_¿dio_bu‰Ú_Ãw
(*
grou¶i¡
);

4824 *
grou¶i¡
 = 
	`gtk_¿dio_bu‰Ú_g‘_group
(
	`GTK_TOGGLE_BUTTON
(
¿dio
));

4826 
GtkWidg‘
 *
fœ¡
 = 
	`gtk_Ïb–_Ãw
(
	`g_¡rdup_´štf
("%d",
smt
->
id_šdex
));

4827 
	`gtk_widg‘_£t_size_»que¡
(
fœ¡
,50,-1);

4828 
GtkWidg‘
 *
¥box
 = 
	`gtk_¥š_bu‰Ú_Ãw_w™h_¿nge
(-1,65535,2);

4829 
	`gtk_widg‘_£t_size_»que¡
(
¥box
,50,-1);

4830 
	`gtk_widg‘_£t_£ns™ive
(
¥box
,
FALSE
);

4831 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
¥box
),
smt
->
id_addr
);

4833 
GtkWidg‘
 *
cbox
 = 
	`gtk_combo_box_‹xt_Ãw
();

4834 
	`gtk_combo_box_­³nd_‹xt
(
	`GTK_COMBO_BOX
(
cbox
),"");

4835 
GLi¡
 *
i¡
 = 
fli¡
;

4836 ; 
i¡
;li¡ =li¡->
Ãxt
)

4838 
	`gtk_combo_box_­³nd_‹xt
(
	`GTK_COMBO_BOX
(
cbox
),
i¡
->
d©a
);

4840 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
cbox
),
smt
->
aùive
);

4841 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
¿dio
,
FALSE
,FALSE,0);

4842 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
fœ¡
,
FALSE
,FALSE,0);

4843 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
¥box
,
FALSE
,FALSE,0);

4844 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
cbox
 ,
TRUE
,TRUE,0);

4845 
	`gtk_combo_box_pİdown
(
	`GTK_COMBO_BOX
(
cbox
));

4846 
smt
->
wid_cŞum2
 = 
¥box
 ;

4847 
smt
->
wid_cŞum3
 = 
cbox
;

4848 
smt
->
wid_cŞum0
 = 
¿dio
;

4849 
	`gtk_widg‘_show_®l
(
hbox
);

4850  
hbox
;

4851 
	}
}

4857 
	$çùÜy_fe_mªag”_š£¹
(
GtkWidg‘
 *
şi¡
,
SaveMusicFe
 *
smf
,
gšt
 
pos
)

4859 
gch¬
 *
fœ¡
 = 
	`g_¡rdup_´štf
("%d",
smf
->
šdex
);

4860 
gch¬
 *
£cÚd
 = 
	`g_¡rdup_´štf
("%d",
smf
->
fe_addr
);

4861 
gch¬
 *
thœd
 =
smf
->
ba£_Çme
;

4862 
gch¬
 *
four
 = 
smf
->
down_Çme
;

4863 
gch¬
 *
row
[] = {
fœ¡
,
£cÚd
,
thœd
,
four
};

4864 
	`gtk_şi¡_š£¹
(
	`GTK_CLIST
(
şi¡
),
pos
,
row
);

4865 
	}
}

4867 
	$çùÜy_fm_g‘_cboxli¡
(
SaveMusicDŸlog
 *
smd
)

4869 
GLi¡
 *
æi¡
 = 
smd
->
smfm
->
f–i¡
;

4870 ;
æi¡
;æi¡ = fli¡->
Ãxt
)

4872 
SaveMusicFe
 *
smf
 = 
æi¡
->
d©a
;

4873 
smd
->
cboxli¡
 = 
	`g_li¡_­³nd
(smd->cboxli¡,
smf
->
ba£_Çme
);

4875 
	}
}

4877 
	$çùÜy_fe_mªag”_­³nd
(
GtkWidg‘
 *
şi¡
,
SaveMusicFe
 *
smf
)

4879 
gch¬
 *
fœ¡
 = 
	`g_¡rdup_´štf
("%d",
smf
->
šdex
);

4880 
gch¬
 *
£cÚd
 = 
	`g_¡rdup_´štf
("%d",
smf
->
fe_addr
);

4881 
gch¬
 *
thœd
 =
smf
->
ba£_Çme
;

4882 
gch¬
 *
four
 = 
smf
->
down_Çme
;

4883 
gch¬
 *
row
[] = {
fœ¡
,
£cÚd
,
thœd
,
four
};

4885 
	`gtk_şi¡_­³nd
(
	`GTK_CLIST
(
şi¡
),
row
);

4886 
	}
}

4888 
	$çùÜy_choo£_musicfe_ÿÎback
(
GtkWidg‘
 *
dlg
,

4889 
gšt
 
»¥Ú£
,

4890 
gpoš‹r
 
u£r_d©a
)

4892 
SaveMusicDŸlog
 *
smd
 = 
u£r_d©a
;

4893 
SaveMusicFeMª
 *
smfm
 = 
smd
->smfm;

4894 ià(
»¥Ú£
 =ğ
GTK_RESPONSE_ACCEPT
)

4896 
off£t
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
smfm
->
wid_off£t
));

4897 
num
 = 
smfm
->
numb”
;

4899 
GLi¡
 *
¡¾i¡
 = 
NULL
;

4900 
GLi¡
 *
f–i¡
 = 
NULL
;

4902 
GSLi¡
 *
æi¡s
 = 
	`gtk_fe_choo£r_g‘_f’ames
(
	`GTK_FILE_CHOOSER
(
dlg
));

4903 
smfm
->
Ï¡Dœ
 = 
	`gtk_fe_choo£r_g‘_cu¼’t_fŞd”
(
	`GTK_FILE_CHOOSER
(
dlg
));

4904 ; 
æi¡s
; fli¡ ğæi¡s->
Ãxt
,
num
++)

4906 
SaveMusicFe
 *
smf
 = 
	`g_Ãw0
(SaveMusicFile,1);

4907 
smf
->
šdex
 = 
num
;

4908 
smf
->
fe_addr
 = 
num
 + 
off£t
;

4909 
smf
->
fuÎ_Çme
 = 
	`g_¡rdup
((
gch¬
 *)
æi¡s
->
d©a
);

4910 
gch¬
 **
¥l™
 = 
	`g_¡r¥l™
(
smf
->
fuÎ_Çme
,"\\",-1);

4911 
Ën
 = 
	`g_¡rv_Ëngth
(
¥l™
);

4912 
smf
->
ba£_Çme
 = 
	`g_¡rdup
(
¥l™
[
Ën
-1]);

4913 
	`g_¡rä“v
(
¥l™
);

4914 
smf
->
down_Çme
 = 
	`g_¡rdup_´štf
("fe_%d",smf->
šdex
);

4915 
f–i¡
 = 
	`g_li¡_­³nd
(f–i¡,
smf
);

4916 
¡¾i¡
 = 
	`g_li¡_­³nd
(¡¾i¡,
smf
->
ba£_Çme
);

4920 if(
smfm
->
numb”
 == 0)

4922 
smfm
->
f–i¡
 = 
	`g_li¡_cİy
(filelist);

4923 
smd
->
cboxli¡
 = 
	`g_li¡_cİy
(
¡¾i¡
);

4925 if(
smfm
->
mª_İt
 =ğ
OPT_APPEND
)

4927 
GLi¡
 *
p
 = 
f–i¡
;

4928 ; 
p
 ;… =…->
Ãxt
)

4929 
smfm
->
f–i¡
 = 
	`g_li¡_­³nd
(smfm->f–i¡,
p
->
d©a
);

4930 
p
 = 
¡¾i¡
;

4931 ; 
p
;… =…->
Ãxt
)

4932 
smd
->
cboxli¡
 = 
	`g_li¡_­³nd
(smd->cboxli¡,
p
->
d©a
);

4937 
pos
 = 
smfm
->
£Ëùed
;

4938 
GLi¡
 *
p
 = 
f–i¡
;

4939 ; 
p
;… =…->
Ãxt
)

4940 
smfm
->
f–i¡
 = 
	`g_li¡_š£¹
(smfm->f–i¡,
p
->
d©a
,
pos
);

4941 
	`g_li¡_ä“1
(
smd
->
cboxli¡
);

4942 
smd
->
cboxli¡
 = 
NULL
;

4943 
p
 = 
smfm
->
f–i¡
;

4944 ; 
p
 ;… =…->
Ãxt
)

4946 
SaveMusicFe
 *
smf
 = 
p
->
d©a
;

4947 
smd
->
cboxli¡
 = 
	`g_li¡_­³nd
(smd->cboxli¡,
smf
->
ba£_Çme
);

4953 if(
smfm
->
mª_İt
 =ğ
OPT_INSERT
)

4955 
	`çùÜy_fe_mªag”_»äesh_®l
(
smd
);

4959 
GLi¡
 *
p
 = 
f–i¡
;

4960 ; 
p
;… =…->
Ãxt
)

4961 
	`çùÜy_fe_mªag”_­³nd
(
smfm
->
wid_şi¡
,
p
->
d©a
);

4963 
smfm
->
numb”
 = 
	`g_li¡_Ëngth
(smfm->
f–i¡
);

4964 
smd
->
mfmos
->
	`m_™emadded
(smd);

4969 
	`gtk_widg‘_de¡roy
(
dlg
);

4970 
	}
}

4976 
	$çùÜy_İ’_fe_dŸlog
(
GtkWidg‘
 *
widg‘
,
gpoš‹r
 
u£r_d©a
)

4978 
SaveMusicDŸlog
 *
smd
 =(SaveMusicDŸlog *è
u£r_d©a
;

4979 
SaveMusicFeMª
 *
smfm
 = 
smd
->smfm;

4980 if(!
smfm
->
İ’dlg
)

4982 
smfm
->
İ’dlg
 = 
	`gtk_fe_choo£r_dŸlog_Ãw_w™h_back’d
(
	`_
("´ò¿ªÒôÀÖÎÄ¼ş"), 
widg‘
,

4983 
GTK_FILE_CHOOSER_ACTION_OPEN
,

4985 
GTK_STOCK_CANCEL
, 
GTK_RESPONSE_CANCEL
,

4986 
GTK_STOCK_OPEN
, 
GTK_RESPONSE_ACCEPT
,

4987 
NULL
);

4988 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
(
	`GTK_DIALOG
(
smfm
->
İ’dlg
), 
GTK_RESPONSE_ACCEPT
);

4989 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
smfm
->
İ’dlg
),
TRUE
);

4990 
	`gtk_fe_choo£r_£t_£Ëù_muÉË
 (
	`GTK_FILE_CHOOSER
 (
smfm
->
İ’dlg
), 
TRUE
);

4991 if(
smfm
->
Ï¡Dœ
 )

4992 
	`gtk_fe_choo£r_£t_cu¼’t_fŞd”
(
	`GTK_FILE_CHOOSER
(
smfm
->
İ’dlg
),smfm->
Ï¡Dœ
);

4996 
	`g_sigÇl_cÚÃù
(
	`GTK_OBJECT
(
smfm
->
İ’dlg
), "destroy",

4997 
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &
smfm
->
İ’dlg
);

4999 ià(!
	`gtk_fe_choo£r_g‘_exŒa_widg‘
(
	`GTK_FILE_CHOOSER
(
smfm
->
İ’dlg
)))

5001 
GtkWidg‘
 *
om’u
ğ
	`gtk_combo_box_Ãw
();

5002 
GtkFeF‹r
* 
f‹r
;

5007 
f‹r
 = 
	`gtk_fe_f‹r_Ãw
 ();

5008 
	`gtk_fe_f‹r_£t_Çme
 (
f‹r
, 
	`_
("All Files"));

5009 
	`gtk_fe_f‹r_add_·‰”n
 (
f‹r
, "*");

5011 
f‹r
 = 
	`gtk_fe_f‹r_Ãw
 ();

5012 
	`gtk_fe_f‹r_£t_Çme
 (
f‹r
, 
	`_
("Music Files"));

5013 
	`gtk_fe_f‹r_add_·‰”n
 (
f‹r
, "*.wav");

5014 
	`gtk_fe_f‹r_add_·‰”n
 (
f‹r
, "*.wma");

5015 
	`gtk_fe_f‹r_add_·‰”n
 (
f‹r
, "*.mp3");

5016 
	`gtk_fe_f‹r_add_·‰”n
 (
f‹r
, "*.f1a");

5017 
	`gtk_fe_choo£r_add_f‹r
 (
	`GTK_FILE_CHOOSER
 (
smfm
->
İ’dlg
), 
f‹r
);

5021 
	`gtk_fe_choo£r_add_f‹r
 (
	`GTK_FILE_CHOOSER
 (
smfm
->
İ’dlg
), 
f‹r
);

5024 
	`g_sigÇl_cÚÃù
(
	`GTK_FILE_CHOOSER
(
smfm
->
İ’dlg
),

5025 "»¥Ú£", 
	`G_CALLBACK
(
çùÜy_choo£_musicfe_ÿÎback
), 
smd
);

5030 if(
smfm
->
Ï¡Dœ
 )

5031 
	`gtk_fe_choo£r_£t_cu¼’t_fŞd”
(
	`GTK_FILE_CHOOSER
(
smfm
->
İ’dlg
),smfm->
Ï¡Dœ
);

5034 
	`gtk_widg‘_£t_£ns™ive
(
smfm
->
İ’dlg
, 
TRUE
);

5035 ià(
	`GTK_WIDGET_VISIBLE
(
smfm
->
İ’dlg
))

5038 
	`gtk_widg‘_show
(
smfm
->
İ’dlg
);

5039 
	}
}

5042 
	$çùÜy_add_™em_to_music_mªag”
(
GtkBu‰Ú
 *
£lf
,
gpoš‹r
 
u£r_d©a
)

5044 
SaveMusicDŸlog
 *
smd
 = 
u£r_d©a
;

5045 
SaveMusicFeMª
 *
smfm
 = 
smd
->smfm;

5047 
SaveMusicI‹m
 *
smt
 = 
	`g_Ãw0
(SaveMusicItem,1);

5048 
smt
->
id_šdex
 = 
	`g_li¡_Ëngth
(
smd
->
™emli¡
);

5049 
smt
->
id_addr
 = smt->
id_šdex
 * 2;

5051 
GtkWidg‘
 *
n™em
 = 
	`çùÜy_g‘_Ãw_music™em
(
smt
,
smd
->
cboxli¡
,&smd->
grou¶i¡
);

5053 
smd
->
™emli¡
ğ
	`g_li¡_­³nd
(smd->™emli¡,
smt
);

5054 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
smd
->
Ëávbox
),
n™em
,
FALSE
,FALSE,0);

5056 
	`gtk_widg‘_show_®l
(
smd
->
Ëávbox
);

5058 
	}
}

5060 
GtkWidg‘
 *
	$çùÜy_Ãw_add_bu‰Ú
(
çùÜy_bu‰Ú_ÿÎback
 *
ÿÎback
,
gpoš‹r
 
li¡
)

5062 
GtkWidg‘
 *
bŠ
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
 (
GTK_STOCK_ADD
);

5063 
	`gtk_widg‘_£t_Çme
 (
bŠ
,"add_button");

5064 
	`g_sigÇl_cÚÃù
 (
	`G_OBJECT
 (
bŠ
), "clicked",

5065 
	`G_CALLBACK
 (
ÿÎback
),

5066 
li¡
);

5067  
bŠ
;

5068 
	}
}

5071 
GtkWidg‘
 *
	$çùÜy_g‘_Ãw_id™em
(
SaveIdI‹m
 *
swt
,
GSLi¡
 **
grou¶i¡
)

5073 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,1);

5074 
GtkWidg‘
 *
¿dio
 = 
	`gtk_¿dio_bu‰Ú_Ãw
(*
grou¶i¡
);

5075 
	`gtk_widg‘_£t_size_»que¡
(
¿dio
,20,-1);

5076 *
grou¶i¡
 = 
	`gtk_¿dio_bu‰Ú_g‘_group
(
	`GTK_TOGGLE_BUTTON
(
¿dio
));

5077 
GtkWidg‘
 *
fœ¡
 = 
	`gtk_Ïb–_Ãw
(
	`g_¡rdup_´štf
("%d",
swt
->
id_šdex
));

5078 
	`gtk_widg‘_£t_size_»que¡
(
fœ¡
,50,-1);

5079 
GtkWidg‘
 *
¥box
 = 
	`gtk_¥š_bu‰Ú_Ãw_w™h_¿nge
(0,65536,2);

5080 
	`gtk_widg‘_£t_size_»que¡
(
fœ¡
,80,-1);

5081 
	`gtk_widg‘_£t_£ns™ive
(
¥box
,
FALSE
);

5083 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
¥box
),
swt
->
id_addr
);

5085 
GtkWidg‘
 *
cbox
 = 
	`gtk_combo_box_Ãw_‹xt
();

5088 
	`gtk_combo_box_pİdown
(
	`GTK_COMBO_BOX
(
cbox
));

5089 
GLi¡
 *
p
 = 
curLay”
->
deâames
;

5090 
	`gtk_combo_box_­³nd_‹xt
(
	`GTK_COMBO_BOX
(
cbox
),"");

5091 ; 
p
 ;… =…->
Ãxt
)

5093 
	`gtk_combo_box_­³nd_‹xt
(
	`GTK_COMBO_BOX
(
cbox
),
p
->
d©a
);

5095 
	`gtk_combo_box_£t_aùive
(
	`GTK_COMBO_BOX
(
cbox
),
swt
->
aùive
);

5097 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
¿dio
,
FALSE
,FALSE,0);

5098 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
fœ¡
,
FALSE
,FALSE,0);

5099 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
¥box
,
FALSE
,FALSE,0);

5100 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
cbox
,
TRUE
,TRUE,0);

5103 
swt
->
wid_cŞum0
 = 
¿dio
;

5104 
swt
->
wid_cŞum2
 = 
¥box
;

5105 
swt
->
wid_cŞum3
 = 
cbox
;

5106  
hbox
;

5107 
	}
}

5109 
	$çùÜy_Ãw_idli¡_dŸlog
(
GtkWidg‘
 *
·»Á
,
SaveSŒuù
 *
s¡
)

5111 
GtkWidg‘
 *
mašBox
 = 
	`gtk_vbox_Ãw
(
FALSE
,0);

5114 
IdDŸlog
->
skv
 = 
s¡
->
v®ue
.
vnumb”
;

5115 
	`gtk_bu‰Ú_£t_Ïb–
(
	`GTK_BUTTON
(
·»Á
),
IdDŸlog
->
skv
->
v®ue
);

5116 
IdDŸlog
->
·»Á_bŠ
 = 
·»Á
;

5117 
GtkWidg‘
 *
subdig
 = 
	`çùÜy_ü—‹_Ãw_dŸlog_w™h_bu‰Ús
(
	`çùÜy_utf8
("IDÁĞ±í"),
·»Á
->
wšdow
);

5118 
GtkWidg‘
 *
dŸlog_vbox
 = 
	`GTK_DIALOG
(
subdig
)->
vbox
;

5120 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
subdig
),
TRUE
);

5121 
	`gtk_dŸlog_£t_deçuÉ_»¥Ú£
 (
	`GTK_DIALOG
(
subdig
), 
GTK_RESPONSE_OK
);

5122 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
subdig
),
TRUE
);

5123 
	`gtk_widg‘_£t_size_»que¡
 (
subdig
,300,500);

5124 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog_vbox
),
mašBox
);

5125 
GtkWidg‘
 *
wid_idli¡
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
,NULL);

5126 
	`gtk_süŞËd_wšdow_£t_pŞicy
(
	`GTK_SCROLLED_WINDOW
(
wid_idli¡
),

5127 
GTK_POLICY_NEVER
,
GTK_POLICY_ALWAYS
);

5129 
GtkWidg‘
 *
vbox
 = 
	`gtk_vbox_Ãw
(
FALSE
,0);

5130 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
(
	`GTK_SCROLLED_WINDOW
(
wid_idli¡
),
vbox
);

5131 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
),
	`çùÜy_g‘_Ãw_™em_h—d
(),
FALSE
,FALSE,0);

5132 
IdDŸlog
->
vbox
 = vbox;

5133 if(
IdDŸlog
->
idli¡s
)

5135 
GLi¡
 *
i¡
 = 
IdDŸlog
->
idli¡s
;

5136 
n
 = 0;

5137 ; 
i¡
;li¡ =li¡->
Ãxt
,
n
++)

5139 
SaveIdI‹m
 *
swt
 = 
i¡
->
d©a
;

5140 
GtkWidg‘
 *
nbox
 = 
	`çùÜy_g‘_Ãw_id™em
(
swt
,&
IdDŸlog
->
grou¶i¡
);

5141 if(
n
 =ğ
IdDŸlog
->
skv
->
¿dšdex
)

5142 
	`gtk_toggË_bu‰Ú_£t_¡©e
(
	`GTK_TOGGLE_BUTTON
(
swt
->
wid_cŞum0
),
TRUE
);

5143 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
),
nbox
,
FALSE
,FALSE,0);

5147 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
mašBox
),
wid_idli¡
,
TRUE
,TRUE,0);

5148 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
mašBox
),

5149 
	`çùÜy_Ãw_add_bu‰Ú
(
çùÜy_add_™em_to_idli¡
,
IdDŸlog
),
FALSE
,FALSE,0);

5151 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
subdig
), "»¥Ú£",
	`G_CALLBACK
 (
s¡
->
şo£_func
), 
IdDŸlog
);

5152 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
subdig
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &subdig);

5153 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
mašBox
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
),&
dŸlog_vbox
);

5155 
	`gtk_widg‘_show_®l
(
subdig
);

5156 
	}
}

5159 
	$çùÜy_add_™em_to_idli¡
(
GtkBu‰Ú
 *
£lf
,
gpoš‹r
 
u£r_d©a
)

5161 
SaveIdDŸlog
 *
sid
 = (SaveIdDŸlog *)
u£r_d©a
;

5163 
GLi¡
 *
i¡
 = 
	`gtk_cÚš”_g‘_chd»n
(
	`GTK_CONTAINER
(
sid
->
vbox
));

5164 
Ën
 = 
	`g_li¡_Ëngth
(
i¡
);

5165 
SaveIdI‹m
 *
swt
 = 
	`g_Ãw0
(SaveIdItem,1);

5167 
swt
->
id_šdex
 = 
Ën
-1;

5168 
swt
->
id_addr
 = (swt->
id_šdex
)*2;

5169 
swt
->
aùive
 = 0;

5171 
GtkWidg‘
 *
n™em
 = 
	`çùÜy_g‘_Ãw_id™em
(
swt
,&
IdDŸlog
->
grou¶i¡
);

5173 
sid
->
idli¡s
 = 
	`g_li¡_­³nd
(sid->idli¡s,
swt
);

5175 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
sid
->
vbox
),
n™em
,
FALSE
,
TRUE
,0);

5178 
	`gtk_widg‘_show_®l
(
sid
->
vbox
);

5179 
	}
}

5183 
GtkWidg‘
 *
	$çùÜy_dowÆßd_fe_mªag”
(
GtkWidg‘
 *
·»Á
,
SaveMusicDŸlog
 *
smd
)

5185 
GtkWidg‘
 *
mvbox
 = 
	`gtk_vbox_Ãw
(
FALSE
,5);

5187 
GtkWidg‘
 *
wid_idli¡
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
,NULL);

5189 
	`gtk_süŞËd_wšdow_£t_pŞicy
(
	`GTK_SCROLLED_WINDOW
(
wid_idli¡
),

5190 
GTK_POLICY_NEVER
,
GTK_POLICY_ALWAYS
);

5192 
GtkWidg‘
 *
vbox
 = 
	`gtk_vbox_Ãw
(
FALSE
,5);

5193 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
(
	`GTK_SCROLLED_WINDOW
(
wid_idli¡
),
vbox
);

5194 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
vbox
),
	`çùÜy_fe_id_mªag”_h—d
(),
FALSE
,FALSE,0);

5195 
smd
->
Ëávbox
 = 
vbox
;

5196 if(
	`g_li¡_Ëngth
(
smd
->
™emli¡
)>0)

5198 
GLi¡
 *
i¡
 = 
smd
->
™emli¡
;

5199 ; 
i¡
 ;li¡ =li¡->
Ãxt
)

5201 
SaveMusicI‹m
 *
smt
 = 
i¡
->
d©a
;

5202 
GtkWidg‘
 *
n™em
 = 
	`çùÜy_g‘_Ãw_music™em
(
smt
,
smd
->
cboxli¡
,&smd->
grou¶i¡
);

5203 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
smd
->
Ëávbox
),
n™em
,
FALSE
,FALSE,0);

5206 
SaveMusicI‹m
 *
sm™
 = 
	`g_li¡_Áh_d©a
(
smd
->
™emli¡
,smd->
skv
->
¿dšdex
);

5207 if(
sm™
)

5208 
	`gtk_toggË_bu‰Ú_£t_aùive
(
	`GTK_TOGGLE_BUTTON
(
sm™
->
wid_cŞum0
), 
TRUE
);

5211 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
mvbox
),
wid_idli¡
,
TRUE
,TRUE,0);

5212 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
mvbox
),
	`çùÜy_Ãw_add_bu‰Ú
(
çùÜy_add_™em_to_music_mªag”
,
smd
),
FALSE
,FALSE,0);

5213  
mvbox
;

5214 
	}
}

5216 
	$çùÜy_§ve_idli¡_dŸlog
(
GtkWidg‘
 *
widg‘
,

5217 
gšt
 
»¥Ú£_id
,

5218 
gpoš‹r
 
u£r_d©a
)

5220 
SaveIdDŸlog
 *
sid
 = 
IdDŸlog
;

5221 iàĞ
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


5222 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
)

5224 
GLi¡
 *
p
 = 
sid
->
idli¡s
;

5225 
SaveKV
 *
skv
 = 
sid
->skv;

5226 ;
p
 ;… =…->
Ãxt
)

5228 
SaveIdI‹m
 *
s
 = 
p
->
d©a
;

5229 
s
->
dÇme
 = 
	`gtk_combo_box_g‘_aùive_‹xt
(
	`GTK_COMBO_BOX
(s->
wid_cŞum3
));

5230 
s
->
aùive
 = 
	`gtk_combo_box_g‘_aùive
(
	`GTK_COMBO_BOX
(s->
wid_cŞum3
));

5231 if(
	`gtk_toggË_bu‰Ú_g‘_aùive
Ğ
	`GTK_TOGGLE_BUTTON
(
s
->
wid_cŞum0
)))

5233 
skv
->
¿dšdex
 = 
	`g_li¡_šdex
(
sid
->
idli¡s
,
s
);

5234 
STRUCTCÏss
 *
fşass
 = 
	`çùÜy_fšd_dŸobjeù_by_Çme
(
curLay”
,
s
->
dÇme
);

5235 if(
fşass
){

5236 
SaveSŒuù
 *
tmp
 = 
fşass
->
widg‘Save
->
d©a
;

5238 
skv
->
v®ue
 = 
	`g_¡rdup
(
tmp
->v®ue.
vnumb”
);

5239 
skv
->
vÇme
 = 
	`g_¡rdup
(
fşass
->
Çme
);

5244 
	`gtk_bu‰Ú_£t_Ïb–
(
	`GTK_BUTTON
(
sid
->
·»Á_bŠ
),
skv
->
v®ue
);

5247 
	`gtk_widg‘_hide_®l
(
widg‘
);

5248 
	}
}

5251 
	$çùÜy_music_fe_mªag”_­¶y
(
GtkWidg‘
 *
widg‘
,

5252 
gšt
 
»¥Ú£_id
,

5253 
SaveMusicDŸlog
 *
smd
)

5256 iàĞ
»¥Ú£_id
 =ğ
GTK_RESPONSE_APPLY


5257 || 
»¥Ú£_id
 =ğ
GTK_RESPONSE_OK
)

5260 
gšt
 
v
 = -1;

5261 
GLi¡
 *
li¡
 = 
smd
->
™emli¡
;

5262 
SaveKV
 *
skv
 = 
smd
->skv;

5263 ; 
li¡
 ;†i¡ =†i¡->
Ãxt
)

5265 
SaveMusicI‹m
 *
smi
 = 
li¡
->
d©a
;

5266 
smi
->
aùive
 = 
	`gtk_combo_box_g‘_aùive
(
	`GTK_COMBO_BOX
(smi->
wid_cŞum3
));

5267 
smi
->
dÇme
 = 
	`gtk_combo_box_g‘_aùive_‹xt
(
	`GTK_COMBO_BOX
(smi->
wid_cŞum3
));

5269 if(
	`gtk_toggË_bu‰Ú_g‘_aùive
(
	`GTK_TOGGLE_BUTTON
(
smi
->
wid_cŞum0
)))

5271 if(
smd
->
fm¡
 =ğ
SEQUENCE
)

5273 
v
 = 
	`g_li¡_šdex
(
smd
->
™emli¡
,
smi
);

5275 if(
smd
->
fm¡
 =ğ
INDEX
)

5277 
SaveMusicFe
 *
smf
 = 
	`g_li¡_Áh_d©a
(
smd
->
smfm
->
f–i¡
,
smi
->
aùive
-1);

5278 if(
smf
)

5279 
v
 = 
	`g_li¡_šdex
(
smd
->
smfm
->
f–i¡
,
smf
);

5281 if(
smd
->
fm¡
 =ğ
PHY
)

5283 
SaveMusicFe
 *
smf
 = 
	`g_li¡_Áh_d©a
(
smd
->
smfm
->
f–i¡
,
smi
->
aùive
-1);

5284 if(
smf
)

5285 
v
 = 
smf
->
fe_addr
;

5287 
skv
->
¿dšdex
 = 
	`g_li¡_šdex
(
smd
->
™emli¡
,
smi
);

5290 
skv
->
v®ue
 = 
	`g_¡rdup_´štf
("%d",
v
);

5291 
	`gtk_bu‰Ú_£t_Ïb–
(
	`GTK_BUTTON
(
smd
->
·»Á_bŠ
),
skv
->
v®ue
);

5295 
	`gtk_widg‘_hide_®l
(
widg‘
);

5296 
	}
}

5298 
	$çùÜy_fe_mªag”_dŸlog
(
GtkWidg‘
 *
bŠ
,
SaveSŒuù
 *
s¡
)

5300 
	`çùÜy_music_fm_g‘_ty³
(
s¡
->
Çme
);

5301 
SaveMusicDŸlog
 *
smd
 = 
MusicMªag”DŸlog
;

5302 
smd
->
·»Á_bŠ
 = 
bŠ
;

5305 
smd
->
skv
 = 
s¡
->
v®ue
.
vnumb”
;

5306 
GtkWidg‘
 *
mašHbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

5307 
GtkWidg‘
 *
wšdow
 = 
	`çùÜy_ü—‹_Ãw_dŸlog_w™h_bu‰Ús
(
smd
->
t™Ë
,smd->
·»Á_bŠ
);

5308 
GtkWidg‘
 *
dŸlog_vbox
 = 
	`GTK_DIALOG
(
wšdow
)->
vbox
;

5309 
	`gtk_cÚš”_add
(
	`GTK_CONTAINER
(
dŸlog_vbox
),
mašHbox
);

5310 
	`gtk_wšdow_£t_mod®
(
	`GTK_WINDOW
(
wšdow
),
TRUE
);

5312 
	`gtk_wšdow_£t_»sizabË
 (
	`GTK_WINDOW
 (
wšdow
),
FALSE
);

5313 
	`gtk_widg‘_£t_size_»que¡
 (
	`GTK_WINDOW
 (
wšdow
),800,500);

5317 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
mašHbox
),
	`çùÜy_dowÆßd_fe_mªag”
(
NULL
,
smd
),
TRUE
,TRUE,1);

5318 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
mašHbox
),
	`çùÜy_music_fe_mªag”
(
NULL
,
smd
),
TRUE
,TRUE,1);

5320 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
wšdow
), "response",

5321 
	`G_CALLBACK
 (
smd
->
mfmos
->
m_­¶ydŸlog
), smd);

5323 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
wšdow
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
), &window);

5324 
	`g_sigÇl_cÚÃù
(
	`G_OBJECT
 (
mašHbox
), "de¡roy",
	`G_CALLBACK
(
gtk_widg‘_de¡royed
),&
dŸlog_vbox
);

5326 
	`gtk_widg‘_show_®l
(
wšdow
);

5327 
	}
}

5331 
GtkWidg‘
 *
	$çùÜy_music_bË_h—d
()

5333 
GtkWidg‘
 *
hbox_h—d
 = 
	`gtk_hbox_Ãw
(
FALSE
,5);

5334 
GtkWidg‘
 *
fœ¡
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("ĞòºÅ"));

5335 
GtkWidg‘
 *
£c
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("ÎïÀíÎÄ¼şºÅ"));

5336 
GtkWidg‘
 *
thœd
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("ÒôÀÖÎÄ¼ş"));

5337 
GtkWidg‘
 *
four
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("ÏÂÔØÎÄ¼şÃû"));

5339 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox_h—d
),
fœ¡
,
TRUE
,TRUE,0);

5340 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox_h—d
),
£c
,
TRUE
,TRUE,0);

5341 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox_h—d
),
thœd
,
TRUE
,TRUE,0);

5342 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox_h—d
),
four
,
TRUE
,TRUE,0);

5343 
	`gtk_widg‘_show_®l
(
hbox_h—d
);

5344  
hbox_h—d
;

5345 
	}
}

5347 (*
	tMusicFeMªag”Func
)(
	tGtkWidg‘
 *
	tbŠ
,
	tgpoš‹r
 
	tu£r_d©a
);

5349 
_MusicFeMªag”O³¿tiÚ
 
	tMusicFeMªag”O³¿tiÚ
;

5351 
	s_MusicFeMªag”O³¿tiÚ


5353 
GtkWidg‘
 *
bŠ
;

5354 
gch¬
 *
Çme
;

5355 
¡ack
;

5356 
MusicFeMªag”Func
 
mfmf
;

5360 
	$çùÜy_add_fe_mªag”_™em
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
u£r_d©a
)

5362 
SaveMusicDŸlog
 *
smd
 = 
u£r_d©a
;

5363 
smd
->
smfm
->
mª_İt
 = 
OPT_APPEND
;

5364 
	`çùÜy_İ’_fe_dŸlog
(
widg‘
,
u£r_d©a
);

5365 
	}
}

5368 
	$çùÜy_fe_mªag”_»äesh_®l
(
SaveMusicDŸlog
 *
smd
)

5371 
SaveMusicFeMª
 *
smfm
 = 
smd
->smfm;

5372 
	`gtk_şi¡_ş—r
(
	`GTK_CLIST
(
smd
->
smfm
->
wid_şi¡
));

5373 
GLi¡
 *
i¡
 = 
smfm
->
f–i¡
;

5374 
num
 = 0;

5375 ; 
i¡
 ;li¡ =li¡->
Ãxt
,
num
++)

5377 
SaveMusicFe
 *
smf
 = 
i¡
->
d©a
;

5378 
smf
->
šdex
 = 
num
;

5379 
smf
->
fe_addr
 = smf->
šdex
 + 
smfm
->
off£t
;

5380 
smf
->
down_Çme
 = 
	`g_¡rdup_´štf
("fe_%d",smf->
šdex
);

5381 
	`çùÜy_fe_mªag”_­³nd
(
smfm
->
wid_şi¡
,
i¡
->
d©a
);

5383 
	`gtk_şi¡_£Ëù_row
(
smfm
->
wid_şi¡
,smfm->
£Ëùed
,-1);

5384 
smfm
->
numb”
 = 
num
;

5385 
smd
->
mfmos
->
	`m_™emadded
(smd);

5386 
	}
}

5389 
	$çùÜy_d–‘e_fe_mªag”_™em
(
GtkWidg‘
 *
widg‘
,
gpoš‹r
 
u£r_d©a
)

5391 
SaveMusicDŸlog
 *
smd
 = 
u£r_d©a
;

5392 
SaveMusicFeMª
 *
smfm
 = 
smd
->smfm;

5393 if(
smfm
->
£Ëùed
 == -1 ||

5394 (
smfm
->
£Ëùed
 >ğ
	`GTK_CLIST
(smfm->
wid_şi¡
)->
rows
))

5397 cÚ¡ 
gpoš‹r
 
™m
 = 
	`g_li¡_Áh_d©a
(
smfm
->
f–i¡
,smfm->
£Ëùed
);

5398 cÚ¡ 
gpoš‹r
 
c
 = 
	`g_li¡_Áh_d©a
(
smd
->
cboxli¡
,
smfm
->
£Ëùed
);

5399 
smd
->
cboxli¡
 = 
	`g_li¡_»move
(smd->cboxli¡,
c
);

5400 
smfm
->
f–i¡
 = 
	`g_li¡_»move
(smfm->f–i¡,
™m
);

5401 
	`çùÜy_fe_mªag”_»äesh_®l
(
smd
);

5404 
	}
}

5405 
	$çùÜy_ş—ÇÎ_fe_mªag”_™em
(
GtkWidg‘
 *
widg‘
,
gpoš‹r
 
u£r_d©a
)

5408 
SaveMusicDŸlog
 *
smd
 = 
u£r_d©a
;

5409 
	`gtk_şi¡_ş—r
(
	`GTK_CLIST
(
smd
->
smfm
->
wid_şi¡
));

5410 
smd
->
smfm
->
numb”
 = 0;

5411 
	`g_li¡_ä“1
(
smd
->
cboxli¡
) ;

5412 
smd
->
cboxli¡
 = 
NULL
;

5413 
smd
->
mfmos
->
	`m_ş—¿Î
(smd);

5415 
	}
}

5416 
	$çùÜy_š£¹_fe_mªag”_™em
(
GtkWidg‘
 *
widg‘
,
gpoš‹r
 
u£r_d©a
)

5418 
SaveMusicDŸlog
 *
smd
 = 
u£r_d©a
;

5419 
smd
->
smfm
->
mª_İt
 = 
OPT_INSERT
;

5420 
	`çùÜy_İ’_fe_dŸlog
(
NULL
,
u£r_d©a
);

5421 
	}
}

5425 
GtkWidg‘
 *
	$çùÜy_music_fe_mªag”_İ”©Ü
(
SaveMusicDŸlog
 *
smd
)

5429 
MusicFeMªag”O³¿tiÚ
 
mfmo
[] = {{
NULL
,"add",
GTK_STOCK_ADD
,
çùÜy_add_fe_mªag”_™em
},

5430 {
NULL
,"d–‘e",
GTK_STOCK_DELETE
,
çùÜy_d–‘e_fe_mªag”_™em
},

5431 {
NULL
,"In£¹",NULL,
çùÜy_š£¹_fe_mªag”_™em
},

5432 {
NULL
,"ş—n",
GTK_STOCK_CLEAR
,
çùÜy_ş—ÇÎ_fe_mªag”_™em
}

5435 
GtkWidg‘
 *
İ”©Ühbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,2);

5437 
num
 =(
mfmo
)/(
MusicFeMªag”O³¿tiÚ
);

5438 
n
 = 0;

5439 ; 
n
 < 
num
;‚++)

5441 
GtkWidg‘
 *
wid
 = 
NULL
;

5442 if(!
mfmo
[
n
].
¡ack
)

5443 
wid
 = 
	`gtk_bu‰Ú_Ãw_w™h_Ïb–
(
mfmo
[
n
].
Çme
);

5445 
wid
 = 
	`gtk_bu‰Ú_Ãw_äom_¡ock
(
mfmo
[
n
].
¡ack
);

5446 
	`g_sigÇl_cÚÃù
(
wid
,"şicked",
	`G_CALLBACK
(
mfmo
[
n
].
mfmf
),
smd
);

5447 
mfmo
[
n
].
bŠ
 = 
wid
;

5448 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
İ”©Ühbox
),
wid
,
FALSE
,FALSE,0);

5451  
İ”©Ühbox
;

5452 
	}
}

5454 
	$çùoy_şi¡_š™
(
GtkWidg‘
 *
şi¡
)

5456 
	`gtk_şi¡_£t_£ËùiÚ_mode
(
	`GTK_CLIST
(
şi¡
),
GTK_SELECTION_MULTIPLE
);

5457 
	`gtk_şi¡_£t_cŞumn_width
(
	`GTK_CLIST
(
şi¡
),0,50);

5458 
	`gtk_şi¡_£t_cŞumn_width
(
	`GTK_CLIST
(
şi¡
),1,60);

5459 
	`gtk_şi¡_£t_cŞumn_auto_»size
(
	`GTK_CLIST
(
şi¡
),2,
TRUE
);

5461 
	}
}

5463 
	$çùÜy_music_fe_mªag”_£Ëù_ÿÎback
(
GtkWidg‘
 *
şi¡
,

5464 
gšt
 
row
,gšˆ
cŞumn
,

5465 
GdkEv’tBu‰Ú
 *
ev’t
,

5466 
gšt
 *
»t
)

5468 *
»t
 = 
row
;

5469 
	}
}

5472 
GtkWidg‘
 *
	$çùÜy_music_fe_mªag”
(
GtkWidg‘
 *
·»Á
,
SaveMusicDŸlog
 *
smd
)

5474 
GtkWidg‘
 *
sdŸlog
 = 
	`gtk_vbox_Ãw
(
FALSE
,0);

5475 
GtkWidg‘
 *
Ïb–
 = 
	`gtk_Ïb–_Ãw
(
	`çùÜy_utf8
("ÎïÀíÎÄ¼şºÅÆ«ÒÆ:"));

5476 
GtkWidg‘
 *
¥box
 = 
	`gtk_¥š_bu‰Ú_Ãw_w™h_¿nge
(0,65536,1);

5477 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
¥box
),5);

5478 
GtkWidg‘
 *
hbox
 = 
	`gtk_hbox_Ãw
(
FALSE
,0);

5479 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
Ïb–
,
FALSE
,FALSE,0);

5480 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
hbox
),
¥box
,
FALSE
,FALSE,0);

5481 
GtkWidg‘
 *
£p
 = 
	`gtk_h£·¿tÜ_Ãw
();

5483 
gch¬
 *
t™Ës
[] = {
	`çùÜy_utf8
("ĞòºÅ"),

5484 
	`çùÜy_utf8
("ÎïÀíÎÄ¼şºÅ"),

5485 
	`çùÜy_utf8
("ÒôÀÖÎÄ¼ş"),

5486 
	`çùÜy_utf8
("ÏÂÔØÎÄ¼şÃû")

5488 
GtkWidg‘
 *
wid_idli¡
 = 
	`gtk_süŞËd_wšdow_Ãw
 (
NULL
,NULL);

5490 
	`gtk_süŞËd_wšdow_£t_pŞicy
(
	`GTK_SCROLLED_WINDOW
(
wid_idli¡
),
GTK_POLICY_NEVER
,
GTK_POLICY_ALWAYS
);

5492 
GtkWidg‘
 *
şi¡
 = 
	`gtk_şi¡_Ãw_w™h_t™Ës
(4,
t™Ës
);

5493 
	`çùoy_şi¡_š™
(
şi¡
);

5495 
	`gtk_süŞËd_wšdow_add_w™h_v›wpÜt
(
	`GTK_SCROLLED_WINDOW
(
wid_idli¡
),
şi¡
);

5496 
SaveMusicFeMª
 *
smfm
 = 
smd
->smfm;

5497 if(!
smfm
)

5499 
smfm
 = 
	`g_Ãw0
(
SaveMusicFeMª
,1);

5500 
smd
->
grou¶i¡
 = 
NULL
;

5501 
smfm
->
£Ëùed
 = -1;

5502 
smd
->
smfm
 = smfm;

5506 if(
smfm
->
f–i¡
)

5508 
GLi¡
 *
æi¡
 = 
smfm
->
f–i¡
;

5509 ; 
æi¡
; fli¡ = fli¡->
Ãxt
)

5511 
	`çùÜy_fe_mªag”_­³nd
(
şi¡
,
æi¡
->
d©a
);

5514 
	`gtk_¥š_bu‰Ú_£t_v®ue
(
	`GTK_SPIN_BUTTON
(
¥box
),
smfm
->
off£t
);

5516 
smfm
->
wid_şi¡
 = 
şi¡
;

5517 
smfm
->
wid_off£t
 = 
¥box
;

5518 
smfm
->
off£t
 = 
	`gtk_¥š_bu‰Ú_g‘_v®ue
(
	`GTK_SPIN_BUTTON
(
¥box
));

5519 
smfm
->
numb”
 = 
	`GTK_CLIST
(
şi¡
)->
rows
;

5523 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
sdŸlog
),
hbox
,
FALSE
,FALSE,0);

5524 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
sdŸlog
),
£p
,
FALSE
,FALSE,0);

5525 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
sdŸlog
),
wid_idli¡
,
TRUE
,TRUE,0);

5526 
	`gtk_box_·ck_¡¬t
(
	`GTK_BOX
(
sdŸlog
),
	`çùÜy_music_fe_mªag”_İ”©Ü
(
smd
),
FALSE
,FALSE,0);

5528 
	`gtk_widg‘_show_®l
(
sdŸlog
);

5530 
	`g_sigÇl_cÚÃù
(
şi¡
,"£Ëù_row",
	`G_CALLBACK
(
çùÜy_music_fe_mªag”_£Ëù_ÿÎback
),&
smd
->
smfm
->
£Ëùed
);

5532  
sdŸlog
;

5534 
	}
}

5597 
	$¡ruùşass_ä“_¡©e
(
STRUCTCÏssS‹
 *
¡©e
)

5601 
	`g_objeù_uÄef
 (
¡©e
->
nÜm®_fÚt
);

5604 
	`g_objeù_uÄef
 (
¡©e
->
şas¢ame_fÚt
);

5608 
	`g_ä“
(
¡©e
->
Çme
);

5632 
	}
}

5634 
STRUCTCÏssS‹
 *

5635 
	$¡ruùşass_g‘_¡©e
(
STRUCTCÏss
 *
¡ruùşass
)

5637 
STRUCTCÏssS‹
 *
¡©e
 = 
	`g_Ãw0
(STRUCTClassState, 1);

5640 
¡©e
->
fÚt_height
 = 
¡ruùşass
->font_height;

5641 
¡©e
->
ab¡¿ù_fÚt_height
 = 
¡ruùşass
->abstract_font_height;

5642 
¡©e
->
pŞymÜphic_fÚt_height
 = 
¡ruùşass
->polymorphic_font_height;

5643 
¡©e
->
şas¢ame_fÚt_height
 = 
¡ruùşass
->classname_font_height;

5644 
¡©e
->
ab¡¿ù_şas¢ame_fÚt_height
 = 
¡ruùşass
->abstract_classname_font_height;

5645 
¡©e
->
comm’t_fÚt_height
 = 
¡ruùşass
->comment_font_height;

5647 
¡©e
->
nÜm®_fÚt
 = 
	`g_objeù_»f
 (
¡ruùşass
->normal_font);

5650 
¡©e
->
şas¢ame_fÚt
 = 
	`g_objeù_»f
 (
¡ruùşass
->classname_font);

5654 
¡©e
->
Çme
 = 
	`g_¡rdup
(
¡ruùşass
->name);

5670 
¡©e
->
lše_cŞÜ
 = 
¡ruùşass
->line_color;

5671 
¡©e
->
fl_cŞÜ
 = 
¡ruùşass
->fill_color;

5672 
¡©e
->
‹xt_cŞÜ
 = 
¡ruùşass
->text_color;

5718  
¡©e
;

5719 
	}
}

5722 
STRUCTCÏssS‹
 *

5723 
	$çùÜy_g‘_¡©e
(
STRUCTCÏss
 *
¡ruùşass
)

5725 
STRUCTCÏssS‹
 *
¡©e
 = 
	`g_Ãw0
(STRUCTClassState, 1);

5728 
¡©e
->
fÚt_height
 = 
¡ruùşass
->font_height;

5729 
¡©e
->
ab¡¿ù_fÚt_height
 = 
¡ruùşass
->abstract_font_height;

5730 
¡©e
->
pŞymÜphic_fÚt_height
 = 
¡ruùşass
->polymorphic_font_height;

5731 
¡©e
->
şas¢ame_fÚt_height
 = 
¡ruùşass
->classname_font_height;

5732 
¡©e
->
ab¡¿ù_şas¢ame_fÚt_height
 = 
¡ruùşass
->abstract_classname_font_height;

5733 
¡©e
->
comm’t_fÚt_height
 = 
¡ruùşass
->comment_font_height;

5735 
¡©e
->
nÜm®_fÚt
 = 
	`g_objeù_»f
 (
¡ruùşass
->normal_font);

5737 
¡©e
->
şas¢ame_fÚt
 = 
	`g_objeù_»f
 (
¡ruùşass
->classname_font);

5740 
¡©e
->
Çme
 = 
	`g_¡rdup
(
¡ruùşass
->name);

5742 
¡©e
->
lše_cŞÜ
 = 
¡ruùşass
->line_color;

5743 
¡©e
->
fl_cŞÜ
 = 
¡ruùşass
->fill_color;

5744 
¡©e
->
‹xt_cŞÜ
 = 
¡ruùşass
->text_color;

5747  
¡©e
;

5748 
	}
}

5753 
	$¡ruùşass_upd©e_cÚÃùiÚpošts
(
STRUCTCÏss
 *
¡ruùşass
)

5755 
num_©Œib
, 
num_İs
;

5756 
DŸObjeù
 *
obj
;

5758 
cÚÃùiÚ_šdex
;

5759 
STRUCTCÏssDŸlog
 *
´İ_dŸlog
;

5761 
´İ_dŸlog
 = 
¡ruùşass
->
´İ”t›s_dŸlog
;

5768 
num_©Œib
 = 0;

5772 
num_İs
 = 0;

5774 
obj
 = &
¡ruùşass
->
–em’t
.
objeù
;

5775 #ifdeà
STRUCT_MAINPOINT


5776 
obj
->
num_cÚÃùiÚs
 = 
STRUCTCLASS_CONNECTIONPOINTS
 + 
num_©Œib
*2 + 
num_İs
*2 + 1;

5778 
obj
->
num_cÚÃùiÚs
 = 
STRUCTCLASS_CONNECTIONPOINTS
 + 
num_©Œib
*2 + 
num_İs
*2;

5780 
obj
->
cÚÃùiÚs
 =

5781 
	`g_»®loc
(
obj
->
cÚÃùiÚs
,

5782 
obj
->
num_cÚÃùiÚs
*(
CÚÃùiÚPošt
 *));

5784 
cÚÃùiÚ_šdex
 = 
STRUCTCLASS_CONNECTIONPOINTS
;

5821 #ifdeà
STRUCT_MAINPOINT


5822 
obj
->
cÚÃùiÚs
[
cÚÃùiÚ_šdex
++] = &
¡ruùşass
->cÚÃùiÚs[
STRUCTCLASS_CONNECTIONPOINTS
];

5825 
	}
}

5828 
	$¡ruùşass_£t_¡©e
(
STRUCTCÏss
 *
¡ruùşass
, 
STRUCTCÏssS‹
 *
¡©e
)

5830 
¡ruùşass
->
fÚt_height
 = 
¡©e
->font_height;

5831 
¡ruùşass
->
ab¡¿ù_fÚt_height
 = 
¡©e
->abstract_font_height;

5832 
¡ruùşass
->
pŞymÜphic_fÚt_height
 = 
¡©e
->polymorphic_font_height;

5833 
¡ruùşass
->
şas¢ame_fÚt_height
 = 
¡©e
->classname_font_height;

5834 
¡ruùşass
->
ab¡¿ù_şas¢ame_fÚt_height
 = 
¡©e
->abstract_classname_font_height;

5835 
¡ruùşass
->
comm’t_fÚt_height
 = 
¡©e
->comment_font_height;

5838 
	`g_objeù_uÄef
 (
¡ruùşass
->
nÜm®_fÚt
);

5839 
¡ruùşass
->
nÜm®_fÚt
 = 
¡©e
->normal_font;

5844 
	`g_objeù_uÄef
 (
¡ruùşass
->
şas¢ame_fÚt
);

5845 
¡ruùşass
->
şas¢ame_fÚt
 = 
¡©e
->classname_font;

5851 
¡ruùşass
->
Çme
 = 
¡©e
->name;

5867 
¡ruùşass
->
lše_cŞÜ
 = 
¡©e
->line_color;

5868 
¡ruùşass
->
fl_cŞÜ
 = 
¡©e
->fill_color;

5869 
¡ruùşass
->
‹xt_cŞÜ
 = 
¡©e
->text_color;

5876 
	`g_ä“
(
¡©e
);

5878 
	`¡ruùşass_upd©e_cÚÃùiÚpošts
(
¡ruùşass
);

5880 
	`¡ruùşass_ÿlcuÏ‹_d©a
(
¡ruùşass
);

5881 
	`¡ruùşass_upd©e_d©a
(
¡ruùşass
);

5882 
	}
}

5885 
	$¡ruùşass_chªge_­¶y
(
STRUCTCÏssChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

5887 
STRUCTCÏssS‹
 *
Şd_¡©e
;

5890 
Şd_¡©e
 = 
	`¡ruùşass_g‘_¡©e
(
chªge
->
obj
);

5892 
	`¡ruùşass_£t_¡©e
(
chªge
->
obj
, chªge->
§ved_¡©e
);

5903 
chªge
->
§ved_¡©e
 = 
Şd_¡©e
;

5904 
chªge
->
­¶›d
 = 1;

5905 
	}
}

5908 
	$çùÜy_chªge_­¶y
(
STRUCTCÏssChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

5910 
STRUCTCÏssS‹
 *
Şd_¡©e
;

5913 
Şd_¡©e
 = 
	`¡ruùşass_g‘_¡©e
(
chªge
->
obj
);

5915 
	`¡ruùşass_£t_¡©e
(
chªge
->
obj
, chªge->
§ved_¡©e
);

5926 
chªge
->
§ved_¡©e
 = 
Şd_¡©e
;

5927 
chªge
->
­¶›d
 = 1;

5928 
	}
}

5932 
	$çùÜy_chªge_»v”t
(
STRUCTCÏssChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

5934 
STRUCTCÏssS‹
 *
Şd_¡©e
;

5937 
Şd_¡©e
 = 
	`¡ruùşass_g‘_¡©e
(
chªge
->
obj
);

5939 
	`¡ruùşass_£t_¡©e
(
chªge
->
obj
, chªge->
§ved_¡©e
);

5950 
chªge
->
§ved_¡©e
 = 
Şd_¡©e
;

5951 
chªge
->
­¶›d
 = 0;

5952 
	}
}

5955 
	$çùÜy_chªge_ä“
(
STRUCTCÏssChªge
 *
chªge
)

5959 
	`¡ruùşass_ä“_¡©e
(
chªge
->
§ved_¡©e
);

5960 
	`g_ä“
(
chªge
->
§ved_¡©e
);

5981 
	}
}

5982 
ObjeùChªge
 *
	$çùÜy_Ãw_chªge
(
STRUCTCÏss
 *
obj
, 
STRUCTCÏssS‹
 *
§ved_¡©e
)

5984 
STRUCTCÏssChªge
 *
chªge
;

5986 
chªge
 = 
	`g_Ãw0
(
STRUCTCÏssChªge
, 1);

5988 
chªge
->
obj_chªge
.
­¶y
 =

5989 (
ObjeùChªgeAµlyFunc
è
çùÜy_chªge_­¶y
;

5990 
chªge
->
obj_chªge
.
»v”t
 =

5991 (
ObjeùChªgeRev”tFunc
è
çùÜy_chªge_»v”t
;

5992 
chªge
->
obj_chªge
.
ä“
 =

5993 (
ObjeùChªgeF»eFunc
è
çùÜy_chªge_ä“
;

5995 
chªge
->
obj
 = obj;

5996 
chªge
->
§ved_¡©e
 = saved_state;

5997 
chªge
->
­¶›d
 = 1;

6003  (
ObjeùChªge
 *)
chªge
;

6004 
	}
}

	@O:\tool\dvs50\objects\standard\arc.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<as£¹.h
>

24 
	#_BSD_SOURCE
 1

	)

25 
	~<m©h.h
>

27 
	~"š.h
"

28 
	~"objeù.h
"

29 
	~"cÚÃùiÚ.h
"

30 
	~"cÚÃùiÚpošt.h
"

31 
	~"dŸ»nd””.h
"

32 
	~"©Œibu‹s.h
"

33 
	~"widg‘s.h
"

34 
	~"¬rows.h
"

35 
	~"´İ”t›s.h
"

37 
	~"toŞ-icÚs.h
"

39 
	#DEFAULT_WIDTH
 0.25

	)

41 
	#HANDLE_MIDDLE
 
HANDLE_CUSTOM1


	)

44 
	#TRACE
(
fun
è

	)

46 
_Arc
 
	tArc
;

48 
	s_Arc
 {

49 
CÚÃùiÚ
 
	mcÚÃùiÚ
;

51 
HªdË
 
	mmiddË_hªdË
;

53 
CŞÜ
 
	m¬c_cŞÜ
;

54 
»®
 
	mcurve_di¡ªû
;

55 
»®
 
	mlše_width
;

56 
LšeStyË
 
	mlše_¡yË
;

57 
»®
 
	mdashËngth
;

58 
A¼ow
 
	m¡¬t_¬row
, 
	m’d_¬row
;

61 
»®
 
	m¿dius
;

62 
Pošt
 
	mûÁ”
;

63 
»®
 
	mªgË1
, 
	mªgË2
;

68 
ObjeùChªge
* 
¬c_move_hªdË
(
Arc
 *
¬c
, 
HªdË
 *
hªdË
,

69 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

70 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

71 
ObjeùChªge
* 
¬c_move
(
Arc
 *
¬c
, 
Pošt
 *
to
);

72 
¬c_£Ëù
(
Arc
 *
¬c
, 
Pošt
 *
şicked_pošt
,

73 
DŸR’d””
 *
š‹¿ùive_»nd””
);

74 
¬c_d¿w
(
Arc
 *
¬c
, 
DŸR’d””
 *
»nd””
);

75 
DŸObjeù
 *
¬c_ü—‹
(
Pošt
 *
¡¬ošt
,

76 *
u£r_d©a
,

77 
HªdË
 **
hªdË1
,

78 
HªdË
 **
hªdË2
);

79 
»®
 
¬c_di¡ªû_äom
(
Arc
 *
¬c
, 
Pošt
 *
pošt
);

80 
¬c_upd©e_d©a
(
Arc
 *
¬c
);

81 
¬c_upd©e_hªdËs
(
Arc
 *
¬c
);

82 
¬c_de¡roy
(
Arc
 *
¬c
);

83 
DŸObjeù
 *
¬c_cİy
(
Arc
 *
¬c
);

85 
PrİDesütiÚ
 *
¬c_desüibe_´İs
(
Arc
 *
¬c
);

86 
¬c_g‘_´İs
(
Arc
 *
¬c
, 
GPŒA¼ay
 *
´İs
);

87 
¬c_£t_´İs
(
Arc
 *
¬c
, 
GPŒA¼ay
 *
´İs
);

89 
¬c_§ve
(
Arc
 *
¬c
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
);

90 
DŸObjeù
 *
¬c_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
);

91 
¬c_compu‹_midpošt
(
Arc
 *
¬c
, cÚ¡ 
Pošt
 * 
•0
, cÚ¡ Pošˆ* 
•1
 , Pošˆ* 
midpošt
);

92 
ÿlcuÏ‹_¬c_objeù_edge
(
Arc
 *
¬c
, 
»®
 
ªg_¡¬t
,„—È
ªg_’d
, 
DŸObjeù
 *
obj
, 
Pošt
 *
rg‘
, 
gboŞ—n
 
şockwi£Ãss
);

93 
¬c_g‘_pošt_©_ªgË
(
Arc
 *
¬c
, 
Pošt
* 
pošt
, 
»®
 
ªgË
);

94 
»®
 
round_ªgË
Ô—È
ªgË
);

95 
»®
 
g‘_middË_¬c_ªgË
Ô—È
ªgË1
,„—È
ªgË2
, 
gboŞ—n
 
şock
);

97 
ObjeùTy³Ops
 
	g¬c_ty³_İs
 =

99 (
C»©eFunc
è
¬c_ü—‹
,

100 (
LßdFunc
è
¬c_lßd
,

101 (
SaveFunc
è
¬c_§ve
,

102 (
G‘DeçuÉsFunc
è
NULL
,

103 (
AµlyDeçuÉsFunc
è
NULL


106 
DŸObjeùTy³
 
	g¬c_ty³
 =

110 (**è
¬c_icÚ
,

112 &
¬c_ty³_İs


115 
DŸObjeùTy³
 *
	g_¬c_ty³
 = (DŸObjeùTy³ *è&
¬c_ty³
;

117 
ObjeùOps
 
	g¬c_İs
 = {

118 (
De¡royFunc
è
¬c_de¡roy
,

119 (
D¿wFunc
è
¬c_d¿w
,

120 (
Di¡ªûFunc
è
¬c_di¡ªû_äom
,

121 (
S–eùFunc
è
¬c_£Ëù
,

122 (
CİyFunc
è
¬c_cİy
,

123 (
MoveFunc
è
¬c_move
,

124 (
MoveHªdËFunc
è
¬c_move_hªdË
,

125 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

126 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

127 (
ObjeùM’uFunc
è
NULL
,

128 (
DesüibePrİsFunc
è
¬c_desüibe_´İs
,

129 (
G‘PrİsFunc
è
¬c_g‘_´İs
,

130 (
S‘PrİsFunc
è
¬c_£t_´İs
,

131 (
TextEd™Func
) 0,

132 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

135 
PrİDesütiÚ
 
	g¬c_´İs
[] = {

136 
OBJECT_COMMON_PROPERTIES
,

137 
PROP_STD_LINE_WIDTH
,

138 
PROP_STD_LINE_COLOUR
,

139 
PROP_STD_LINE_STYLE
,

140 
PROP_STD_START_ARROW
,

141 
PROP_STD_END_ARROW
,

142 { "curve_di¡ªû", 
PROP_TYPE_REAL
, 0,

143 
N_
("Curvdi¡ªû"), 
NULL
 },

144 
PROP_DESC_END


147 
PrİDesütiÚ
 *

148 
	$¬c_desüibe_´İs
(
Arc
 *
¬c
)

150 ià(
¬c_´İs
[0].
qu¬k
 == 0)

151 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
¬c_´İs
);

152  
¬c_´İs
;

153 
	}
}

155 
PrİOff£t
 
	g¬c_off£ts
[] = {

156 
OBJECT_COMMON_PROPERTIES_OFFSETS
,

157 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Arc
, 
lše_width
) },

158 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Arc
, 
¬c_cŞÜ
) },

159 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

160 
off£tof
(
Arc
, 
lše_¡yË
), off£tof(Arc, 
dashËngth
) },

161 { "¡¬t_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
Arc
, 
¡¬t_¬row
) },

162 { "’d_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
Arc
, 
’d_¬row
) },

163 { "curve_di¡ªû", 
PROP_TYPE_REAL
, 
off£tof
(
Arc
, 
curve_di¡ªû
) },

164 { "¡¬t_pošt", 
PROP_TYPE_POINT
, 
off£tof
(
CÚÃùiÚ
, 
’dpošts
[0]) },

165 { "’d_pošt", 
PROP_TYPE_POINT
, 
off£tof
(
CÚÃùiÚ
, 
’dpošts
[1]) },

166 { 
NULL
, 0, 0 }

170 
	$¬c_g‘_´İs
(
Arc
 *
¬c
, 
GPŒA¼ay
 *
´İs
)

172 
	`objeù_g‘_´İs_äom_off£ts
(&
¬c
->
cÚÃùiÚ
.
objeù
,

173 
¬c_off£ts
, 
´İs
);

174 
	}
}

177 
	$¬c_£t_´İs
(
Arc
 *
¬c
, 
GPŒA¼ay
 *
´İs
)

179 
	`objeù_£t_´İs_äom_off£ts
(&
¬c
->
cÚÃùiÚ
.
objeù
,

180 
¬c_off£ts
, 
´İs
);

181 
	`¬c_upd©e_d©a
(
¬c
);

182 
	}
}

185 
	$š_ªgË
(
»®
 
ªgË
,„—È
¡¬ngË
,„—È
’dªgË
)

187 ià(
¡¬ngË
 > 
’dªgË
) {

188 
’dªgË
 += 360.0;

189 ià(
ªgË
<
¡¬ngË
)

190 
ªgË
 += 360;

192  (
ªgË
>=
¡¬ngË
è&& (ªgË<=
’dªgË
);

193 
	}
}

195 
»®


196 
	$¬c_di¡ªû_äom
(
Arc
 *
¬c
, 
Pošt
 *
pošt
)

198 
Pošt
 *
’dpošts
;

199 
Pošt
 
äom_ûÁ”
;

200 
»®
 
ªgË
;

201 
»®
 
d
, 
d2
;

203 
’dpošts
 = &
¬c
->
cÚÃùiÚ
.endpoints[0];

205 
äom_ûÁ”
 = *
pošt
;

206 
	`pošt_sub
(&
äom_ûÁ”
, &
¬c
->
ûÁ”
);

208 
ªgË
 = -
	`©ª2
(
äom_ûÁ”
.
y
, from_ûÁ”.
x
)*180.0/
M_PI
;

209 ià(
ªgË
<0)

210 
ªgË
+=360.0;

212 ià(
	`š_ªgË
(
ªgË
, 
¬c
->
ªgË1
,‡rc->
ªgË2
)) {

213 
d
 = 
	`çbs
(
	`sq¹
(
	`pošt_dÙ
(&
äom_ûÁ”
, &äom_ûÁ”)è- 
¬c
->
¿dius
);

214 
d
 -ğ
¬c
->
lše_width
/2.0;

215 ià(
d
<0)

216 
d
 = 0.0;

217  
d
;

219 
d
 = 
	`di¡ªû_pošt_pošt
(&
’dpošts
[0], 
pošt
);

220 
d2
 = 
	`di¡ªû_pošt_pošt
(&
’dpošts
[1], 
pošt
);

222  
	`MIN
(
d
,
d2
);

224 
	}
}

227 
	$¬c_£Ëù
(
Arc
 *
¬c
, 
Pošt
 *
şicked_pošt
,

228 
DŸR’d””
 *
š‹¿ùive_»nd””
)

230 
	`¬c_upd©e_hªdËs
(
¬c
);

231 
	}
}

234 
	$¬c_upd©e_hªdËs
(
Arc
 *
¬c
)

236 
Pošt
 *
middË_pos
;

237 
»®
 
di¡
,
dx
,
dy
;

239 
CÚÃùiÚ
 *
cÚn
 = &
¬c
->
cÚÃùiÚ
;

241 
	`cÚÃùiÚ_upd©e_hªdËs
(
cÚn
);

243 
middË_pos
 = &
¬c
->
middË_hªdË
.
pos
;

244 
middË_pos
->
x
 = (
cÚn
->
’dpošts
[0].x + conn->endpoints[1].x) / 2.0;

245 
middË_pos
->
y
 = (
cÚn
->
’dpošts
[0].y + conn->endpoints[1].y) / 2.0;

247 
dx
 = 
cÚn
->
’dpošts
[1].
x
 - conn->endpoints[0].x;

248 
dy
 = 
cÚn
->
’dpošts
[1].
y
 - conn->endpoints[0].y;

250 
di¡
 = 
	`sq¹
(
dx
*dx + 
dy
*dy);

251 ià(
di¡
 > 0.000001) {

252 
middË_pos
->
x
 -ğ
¬c
->
curve_di¡ªû
*
dy
/
di¡
;

253 
middË_pos
->
y
 +ğ
¬c
->
curve_di¡ªû
*
dx
/
di¡
;

255 
	}
}

257 
»®


258 
	$¬c_compu‹_curve_di¡ªû
(cÚ¡ 
Arc
 *
¬c
, cÚ¡ 
Pošt
 *
¡¬t
, cÚ¡ Pošˆ*
’d
, cÚ¡ Pošˆ*
mid
)

260 
Pošt
 
a
,
b
;

261 
»®
 
tmp
,
cd
;

263 
b
 = *
mid
;

264 
	`pošt_sub
(&
b
, 
¡¬t
);

266 
a
 = *
’d
;

267 
	`pošt_sub
(&
a
, 
¡¬t
);

269 
tmp
 = 
	`pošt_dÙ
(&
a
,&
b
);

270 
cd
 =

271 
	`sq¹
(
	`çbs
(
	`pošt_dÙ
(&
b
,&bè- 
tmp
*tmp/pošt_dÙ(&
a
,&a)));

273 ià(
a
.
x
*
b
.
y
 -‡.y*b.x < 0)

274 
cd
 = - cd;

275  
cd
;

276 
	}
}

281 
	$rÙ©e_pošt_¬ound_pošt
(
Pošt
 *
p
, cÚ¡ Pošˆ*
ûÁ”
, 
»®
 
ªgË
)

283 
»®
 
¿dius
;

284 
»®
 
a
;

285 
	`pošt_sub
(
p
,
ûÁ”
);

286 
¿dius
 = 
	`pošt_Ën
(
p
);

287 
a
 = -
	`©ª2
(
p
->
y
,p->
x
);

288 
a
 +ğ
ªgË
;

289 
p
->
x
 = 
	`cos
(
a
);…->
y
 = -
	`sš
(a);

290 
	`pošt_sÿË
(
p
,
¿dius
);

291 
	`pošt_add
(
p
,
ûÁ”
);

292 
	}
}

299 
	$¬c_fšd_¿dŸl
(cÚ¡ 
Arc
 *
¬c
, cÚ¡ 
Pošt
 *
to
, Pošˆ*
be¡
)

301 
Pošt
 
tmp
;

302 
tmp
 = *
to
;

303 
	`pošt_sub
(&
tmp
, &
¬c
->
ûÁ”
);

304 
	`pošt_nÜm®ize
(&
tmp
);

305 
	`pošt_sÿË
(&
tmp
,
¬c
->
¿dius
);

306 
	`pošt_add
(&
tmp
, &
¬c
->
ûÁ”
);

307 *
be¡
 = 
tmp
;

310 
	}
}

312 
ObjeùChªge
*

313 
	$¬c_move_hªdË
(
Arc
 *
¬c
, 
HªdË
 *
hªdË
,

314 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

315 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

317 
	`as£¹
(
¬c
!=
NULL
);

318 
	`as£¹
(
hªdË
!=
NULL
);

319 
	`as£¹
(
to
!=
NULL
);

323 cÚ¡ 
Pošt
 *
p1
, *
p2
;

325 ià(
hªdË
->
id
 =ğ
HANDLE_MIDDLE
) {

326 
p1
 = &
¬c
->
cÚÃùiÚ
.
’dpošts
[0];

327 
p2
 = &
¬c
->
cÚÃùiÚ
.
’dpošts
[1];

329 
p1
 = &
¬c
->
middË_hªdË
.
pos
;

330 
p2
 = &
¬c
->
cÚÃùiÚ
.
’dpošts
[(
hªdË
 =ğ(&¬c->cÚÃùiÚ.
’dpošt_hªdËs
[0])) ? 1 : 0];

332 iàĞ(
	`di¡ªû_pošt_pošt
 (
to
, 
p1
) < 0.01)

333 || (
	`di¡ªû_pošt_pošt
 (
to
, 
p2
) < 0.01))

334  
NULL
;

337 ià(
hªdË
->
id
 =ğ
HANDLE_MIDDLE
) {

338 
	`TRACE
(
	`´štf
("curve_di¡: %.2à\n",
¬c
->
curve_di¡ªû
));

339 
¬c
->
curve_di¡ªû
 = 
	`¬c_compu‹_curve_di¡ªû
×rc, &¬c->
cÚÃùiÚ
.
’dpošts
[0], &¬c->cÚÃùiÚ.’dpošts[1], 
to
);

340 
	`TRACE
(
	`´štf
("curve_di¡: %.2à\n",
¬c
->
curve_di¡ªû
));

343 
Pošt
 
be¡
;

344 
	`TRACE
(
	`´štf
("Modif›rs: %d \n",
modif›rs
));

345 ià(
modif›rs
 & 
MODIFIER_SHIFT
)

348 
	`TRACE
(
	`´štf
("SHIFT USED,Ø© %.2à%.2à ",
to
->
x
,to->
y
));

349 ià(
	`¬c_fšd_¿dŸl
(
¬c
, 
to
, &
be¡
)){

352 
Pošt
 
midpošt
;

353 
ok
;

354 ià(
hªdË
 =ğ(&
¬c
->
cÚÃùiÚ
.
’dpošt_hªdËs
[0]))

355 
ok
 = 
	`¬c_compu‹_midpošt
(
¬c
, &
be¡
 , &¬c->
cÚÃùiÚ
.
’dpošts
[1], &
midpošt
);

357 
ok
 = 
	`¬c_compu‹_midpošt
(
¬c
, &¬c->
cÚÃùiÚ
.
’dpošts
[0], &
be¡
 , &
midpošt
);

358 ià(!
ok
)

359  
NULL
;

360 
	`cÚÃùiÚ_move_hªdË
(&
¬c
->
cÚÃùiÚ
, 
hªdË
->
id
, &
be¡
, 
ı
, 
»asÚ
, 
modif›rs
);

362 
¬c
->
curve_di¡ªû
 = 
	`¬c_compu‹_curve_di¡ªû
×rc, &¬c->
cÚÃùiÚ
.
’dpošts
[0], &¬c->cÚÃùiÚ.’dpošts[1], &
midpošt
);

363 
	`TRACE
(
	`´štf
("curve_di¡: %.2à\n",
¬c
->
curve_di¡ªû
));

366 
	`TRACE
(
	`´štf
("NO best\n"));

369 
	`cÚÃùiÚ_move_hªdË
(&
¬c
->
cÚÃùiÚ
, 
hªdË
->
id
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

373 
	`¬c_upd©e_d©a
(
¬c
);

375  
NULL
;

376 
	}
}

378 
ObjeùChªge
*

379 
	$¬c_move
(
Arc
 *
¬c
, 
Pošt
 *
to
)

381 
Pošt
 
¡¬t_to_’d
;

382 
Pošt
 *
’dpošts
 = &
¬c
->
cÚÃùiÚ
.endpoints[0];

384 
¡¬t_to_’d
 = 
’dpošts
[1];

385 
	`pošt_sub
(&
¡¬t_to_’d
, &
’dpošts
[0]);

387 
’dpošts
[1] =ƒndpošts[0] = *
to
;

388 
	`pošt_add
(&
’dpošts
[1], &
¡¬t_to_’d
);

390 
	`¬c_upd©e_d©a
(
¬c
);

392  
NULL
;

393 
	}
}

396 
	$¬c_compu‹_midpošt
(
Arc
 *
¬c
, cÚ¡ 
Pošt
 * 
•0
, cÚ¡ Pošˆ* 
•1
 , Pošˆ* 
midpošt
)

398 
»®
 
ªgË
;

399 
Pošt
 
midpos
;

400 
Pošt
 *
Ûp0
, *
Ûp1
;

402 
Ûp0
 = &
¬c
->
cÚÃùiÚ
.
’dpošts
[0];

403 
Ûp1
 = &
¬c
->
cÚÃùiÚ
.
’dpošts
[1];

406 
ªgË
 = -
	`©ª2
(
•0
->
y
 - 
¬c
->
ûÁ”
.y,ƒp0->
x
 -‡rc->center.x);

407 
ªgË
 -ğ-
	`©ª2
(
Ûp0
->
y
 - 
¬c
->
ûÁ”
.y, o•0->
x
 -‡rc->center.x);

408 
ªgË
 +ğ-
	`©ª2
(
•1
->
y
 - 
¬c
->
ûÁ”
.y,ƒp1->
x
 -‡rc->center.x);

409 
ªgË
 -ğ-
	`©ª2
(
Ûp1
->
y
 - 
¬c
->
ûÁ”
.y, o•1->
x
 -‡rc->center.x);

410 ià(!
	`fš™e
(
ªgË
)){

413 ià(
ªgË
 < -1 * 
M_PI
){

414 
	`TRACE
(
	`´štf
("ªgË: %.2à",
ªgË
));

415 
ªgË
 +ğ2*
M_PI
;

416 
	`TRACE
(
	`´štf
("ªgË: %.2à",
ªgË
));

418 ià(
ªgË
 > 1 * 
M_PI
){

419 
	`TRACE
(
	`´štf
("ªgË: %.2à",
ªgË
));

420 
ªgË
 -ğ2*
M_PI
;

421 
	`TRACE
(
	`´štf
("ªgË: %.2à",
ªgË
));

424 
midpos
 = 
¬c
->
middË_hªdË
.
pos
;

426 
	`TRACE
(
	`´štf
("\nmidpo befÜe: %.2à%.2à\n",
midpos
.
x
, midpos.
y
));

427 
	`rÙ©e_pošt_¬ound_pošt
(&
midpos
, &
¬c
->
ûÁ”
, 
ªgË
/2);

428 
	`TRACE
(
	`´štf
("\nmidpo aá” : %.2à%.2à\n",
midpos
.
x
, midpos.
y
));

429 *
midpošt
 = 
midpos
;

431 
	}
}

433 
	$¬c_g‘_pošt_©_ªgË
(
Arc
 *
¬c
, 
Pošt
* 
pošt
, 
»®
 
ªgË
)

435 
Pošt
 
vec
;

436 
vec
.
x
 = 
	`cos
(
ªgË
/180.0*
M_PI
);

437 
vec
.
y
 = -
	`sš
(
ªgË
/180.0*
M_PI
);

438 
	`pošt_cİy
(
pošt
,&
¬c
->
ûÁ”
);

439 
	`pošt_add_sÿËd
(
pošt
,&
vec
,
¬c
->
¿dius
);

440 
	}
}

442 
»®
 
	$round_ªgË
(
»®
 
ªgË
){

443 
»®
 
a
 = 
ªgË
;

444 
a
<0)‡+=360;

445 
a
>=360)‡-=360;

446  
a
;

447 
	}
}

449 
»®
 
	$g‘_middË_¬c_ªgË
(
»®
 
ªgË1
,„—È
ªgË2
, 
gboŞ—n
 
şock
)

451 
»®
 
d–
;

452 
ªgË1
 = 
	`round_ªgË
(angle1);

453 
ªgË2
 = 
	`round_ªgË
(angle2);

454 
d–
 = (
ªgË2
-
ªgË1
);

455 ià(
d–
<0) delta+=360;

456 ià(
şock
)

457  
	`round_ªgË
(
ªgË1
-(360-
d–
)/2);

459  
	`round_ªgË
(
ªgË1
+
d–
/2);

460 
	}
}

462 #undeà
TRACE_DIST


468 
	$ÿlcuÏ‹_¬c_objeù_edge
(
Arc
 *
¬c
, 
»®
 
ªg_¡¬t
,„—È
ªg_’d
, 
DŸObjeù
 *
obj
, 
Pošt
 *
rg‘
, 
gboŞ—n
 
şockwi£Ãss
)

470 
	#MAXITER
 25

	)

471 #ifdeà
TRACE_DIST


472 
»®
 
Œaû
[
MAXITER
];

473 
»®
 
di¡Œaû
[
MAXITER
];

474 
j
 = 0;

476 
»®
 
mid1
, 
mid2
, 
mid3
;

477 
»®
 
di¡
;

478 
i
 = 0;

480 
mid1
 = 
ªg_¡¬t
;

481 
mid2
 = 
	`g‘_middË_¬c_ªgË
(
ªg_¡¬t
, 
ªg_’d
, 
şockwi£Ãss
);

482 
mid3
 = 
ªg_’d
;

484 
	`TRACE
(
	`´štf
("Fšd middË‡ngË b‘w“À%f°‡nd %f°\n",
ªg_¡¬t
,
ªg_’d
));

486 
	`¬c_g‘_pošt_©_ªgË
(
¬c
,
rg‘
,
mid1
);

487 
di¡
 = 
obj
->
İs
->
	`di¡ªû_äom
(obj, 
rg‘
 );

488 ià(
di¡
 < 0.001){

489 
	`TRACE
(
	`´štf
("Pošˆ© %f°: %f,%ài v”y clo£Øobjeù: %f,„‘uºšg it\n",
mid1
, 
rg‘
->
x
,¬g‘->
y
, 
di¡
));

493 
	`¬c_g‘_pošt_©_ªgË
(
¬c
, 
rg‘
, 
mid2
);

494 
di¡
 = 
obj
->
İs
->
	`di¡ªû_äom
(obj, 
rg‘
);

495 #ifdeà
TRACE_DIST


496 
Œaû
[
i
] = 
mid2
;

497 
di¡Œaû
[
i
] = 
di¡
;

499 
i
++;

501 ià(
di¡
 < 0.0000001) {

502 
mid3
 = 
mid2
;

504 
mid1
 = 
mid2
;

506 
mid2
 = 
	`g‘_middË_¬c_ªgË
(
mid1
,
mid3
,
şockwi£Ãss
);

508 } 
i
 < 
MAXITER
 && (
di¡
 < 0.0000001 || dist > 0.001));

510 #ifdeà
TRACE_DIST


511 
j
 = 0; j < 
i
; j++) {

512 
	`¬c_g‘_pošt_©_ªgË
(
¬c
,
rg‘
,
Œaû
[
j
]);

513 
	`´štf
("%d: %à° : %f,%à:%f\n", 
j
, 
Œaû
[j],
rg‘
->
x
,rg‘->
y
, 
di¡Œaû
[j]);

516 
	`¬c_g‘_pošt_©_ªgË
(
¬c
,
rg‘
,
mid2
);

518 
	}
}

520 
	$¬c_d¿w
(
Arc
 *
¬c
, 
DŸR’d””
 *
»nd””
)

522 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

523 
Pošt
 *
’dpošts
;

524 
Pošt
 
g­tmp
[3];

525 
CÚÃùiÚPošt
 *
¡¬t_ı
, *
’d_ı
;

527 
	`as£¹
(
¬c
 !ğ
NULL
);

528 
	`as£¹
(
»nd””
 !ğ
NULL
);

530 
’dpošts
 = &
¬c
->
cÚÃùiÚ
.endpoints[0];

532 
g­tmp
[0] = 
’dpošts
[0];

533 
g­tmp
[1] = 
’dpošts
[1];

534 
¡¬t_ı
 = 
¬c
->
cÚÃùiÚ
.
’dpošt_hªdËs
[0].
cÚÃùed_to
;

535 
’d_ı
 = 
¬c
->
cÚÃùiÚ
.
’dpošt_hªdËs
[1].
cÚÃùed_to
;

537 
	`TRACE
(
	`´štf
("d¿wšg‡rc:\À¡¬t:%à°:%f,%à\‹nd:%à°:%f,%f\n",
¬c
->
ªgË1
,
’dpošts
[0].
x
,’dpošts[0].
y
,‡rc->
ªgË2
,endpoints[1].x,endpoints[1].y));

539 ià(
	`cÚÅošt_is_autog­
(
¡¬t_ı
)) {

540 
	`TRACE
(
	`´štf
("computšg s¹ iÁ”£ùiÚ\ncurve_di¡ªû: %f\n",
¬c
->
curve_di¡ªû
));

541 ià(
¬c
->
curve_di¡ªû
 < 0)

542 
	`ÿlcuÏ‹_¬c_objeù_edge
(
¬c
,‡rc->
ªgË1
,‡rc->
ªgË2
, 
¡¬t_ı
->
objeù
, &
g­tmp
[0], 
FALSE
);

544 
	`ÿlcuÏ‹_¬c_objeù_edge
(
¬c
,‡rc->
ªgË2
,‡rc->
ªgË1
, 
¡¬t_ı
->
objeù
, &
g­tmp
[0], 
TRUE
);

546 ià(
	`cÚÅošt_is_autog­
(
’d_ı
)) {

547 
	`TRACE
(
	`´štf
("computšgƒnd iÁ”£ùiÚ\ncurve_di¡ªû: %f\n",
¬c
->
curve_di¡ªû
));

548 ià(
¬c
->
curve_di¡ªû
 < 0)

549 
	`ÿlcuÏ‹_¬c_objeù_edge
(
¬c
,‡rc->
ªgË2
,‡rc->
ªgË1
, 
’d_ı
->
objeù
, &
g­tmp
[1], 
TRUE
);

551 
	`ÿlcuÏ‹_¬c_objeù_edge
(
¬c
,‡rc->
ªgË1
,‡rc->
ªgË2
, 
’d_ı
->
objeù
, &
g­tmp
[1], 
FALSE
);

555 
	`¬c_compu‹_midpošt
(
¬c
, &
g­tmp
[0], &gaptmp[1], &gaptmp[2]);

557 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
¬c
->
lše_width
);

558 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
¬c
->
lše_¡yË
);

559 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
¬c
->
dashËngth
);

560 
»nd””_İs
->
	`£t_lšeÿps
(
»nd””
, 
LINECAPS_BUTT
);

563 ià(
	`çbs
(
¬c
->
curve_di¡ªû
) <= 0.01) {

564 
	`TRACE
(
	`´štf
("drawing†ike‡†ine\n"));

565 
»nd””_İs
->
	`d¿w_lše_w™h_¬rows
(
»nd””
,

566 &
g­tmp
[0], &gaptmp[1],

567 
¬c
->
lše_width
,

568 &
¬c
->
¬c_cŞÜ
,

569 &
¬c
->
¡¬t_¬row
,

570 &
¬c
->
’d_¬row
);

574 
»nd””_İs
->
	`d¿w_¬c_w™h_¬rows
(
»nd””
,

575 &
g­tmp
[0],

576 &
g­tmp
[1],

577 &
g­tmp
[2],

578 
¬c
->
lše_width
,

579 &
¬c
->
¬c_cŞÜ
,

580 &
¬c
->
¡¬t_¬row
,

581 &
¬c
->
’d_¬row
);

582 
	}
}

584 
DŸObjeù
 *

585 
	$¬c_ü—‹
(
Pošt
 *
¡¬ošt
,

586 *
u£r_d©a
,

587 
HªdË
 **
hªdË1
,

588 
HªdË
 **
hªdË2
)

590 
Arc
 *
¬c
;

591 
CÚÃùiÚ
 *
cÚn
;

592 
DŸObjeù
 *
obj
;

593 
Pošt
 
deçuÉËn
 = { 1.0, 1.0 };

595 
¬c
 = 
	`g_m®loc0
((
Arc
));

597 
¬c
->
lše_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

598 
¬c
->
curve_di¡ªû
 = 1.0;

599 
¬c
->
¬c_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

600 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
¬c
->
lše_¡yË
, &¬c->
dashËngth
);

601 
¬c
->
¡¬t_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_¡¬t_¬row
();

602 
¬c
->
’d_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_’d_¬row
();

604 
cÚn
 = &
¬c
->
cÚÃùiÚ
;

605 
cÚn
->
’dpošts
[0] = *
¡¬ošt
;

606 
cÚn
->
’dpošts
[1] = *
¡¬ošt
;

607 
	`pošt_add
(&
cÚn
->
’dpošts
[1], &
deçuÉËn
);

609 
obj
 = &
cÚn
->
objeù
;

611 
obj
->
ty³
 = &
¬c_ty³
;;

612 
obj
->
İs
 = &
¬c_İs
;

614 
	`cÚÃùiÚ_š™
(
cÚn
, 3, 0);

616 
obj
->
hªdËs
[2] = &
¬c
->
middË_hªdË
;

617 
¬c
->
middË_hªdË
.
id
 = 
HANDLE_MIDDLE
;

618 
¬c
->
middË_hªdË
.
ty³
 = 
HANDLE_MINOR_CONTROL
;

619 
¬c
->
middË_hªdË
.
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

620 
¬c
->
middË_hªdË
.
cÚÃùed_to
 = 
NULL
;

622 
	`¬c_upd©e_d©a
(
¬c
);

624 *
hªdË1
 = 
obj
->
hªdËs
[0];

625 *
hªdË2
 = 
obj
->
hªdËs
[1];

626  &
¬c
->
cÚÃùiÚ
.
objeù
;

627 
	}
}

630 
	$¬c_de¡roy
(
Arc
 *
¬c
)

632 
	`cÚÃùiÚ_de¡roy
(&
¬c
->
cÚÃùiÚ
);

633 
	}
}

635 
DŸObjeù
 *

636 
	$¬c_cİy
(
Arc
 *
¬c
)

638 
Arc
 *
Ãw¬c
;

639 
CÚÃùiÚ
 *
cÚn
, *
ÃwcÚn
;

640 
DŸObjeù
 *
Ãwobj
;

642 
cÚn
 = &
¬c
->
cÚÃùiÚ
;

644 
Ãw¬c
 = 
	`g_m®loc0
((
Arc
));

645 
ÃwcÚn
 = &
Ãw¬c
->
cÚÃùiÚ
;

646 
Ãwobj
 = &
ÃwcÚn
->
objeù
;

648 
	`cÚÃùiÚ_cİy
(
cÚn
, 
ÃwcÚn
);

650 
Ãw¬c
->
¬c_cŞÜ
 = 
¬c
->arc_color;

651 
Ãw¬c
->
curve_di¡ªû
 = 
¬c
->curve_distance;

652 
Ãw¬c
->
lše_width
 = 
¬c
->line_width;

653 
Ãw¬c
->
lše_¡yË
 = 
¬c
->line_style;

654 
Ãw¬c
->
dashËngth
 = 
¬c
->dashlength;

655 
Ãw¬c
->
¡¬t_¬row
 = 
¬c
->start_arrow;

656 
Ãw¬c
->
’d_¬row
 = 
¬c
->end_arrow;

657 
Ãw¬c
->
¿dius
 = 
¬c
->radius;

658 
Ãw¬c
->
ûÁ”
 = 
¬c
->center;

659 
Ãw¬c
->
ªgË1
 = 
¬c
->angle1;

660 
Ãw¬c
->
ªgË2
 = 
¬c
->angle2;

662 
Ãwobj
->
hªdËs
[2] = &
Ãw¬c
->
middË_hªdË
;

664 
Ãw¬c
->
middË_hªdË
 = 
¬c
->middle_handle;

666 
	`¬c_upd©e_d©a
(
¬c
);

668  &
Ãw¬c
->
cÚÃùiÚ
.
objeù
;

669 
	}
}

672 
gboŞ—n


673 
	$is_right_hªd
 (cÚ¡ 
Pošt
 *
a
, cÚ¡ Pošˆ*
b
, cÚ¡ Pošˆ*
c
)

675 
Pošt
 
dÙ1
, 
dÙ2
;

677 
dÙ1
 = *
a
;

678 
	`pošt_sub
(&
dÙ1
, 
c
);

679 
	`pošt_nÜm®ize
(&
dÙ1
);

680 
dÙ2
 = *
b
;

681 
	`pošt_sub
(&
dÙ2
, 
c
);

682 
	`pošt_nÜm®ize
(&
dÙ2
);

683  
	`pošt_üoss
(&
dÙ1
, &
dÙ2
) > 0;

684 
	}
}

687 
	$¬c_upd©e_d©a
(
Arc
 *
¬c
)

689 
CÚÃùiÚ
 *
cÚn
 = &
¬c
->
cÚÃùiÚ
;

690 
LšeBBExŒas
 *
exŒa
 =&
cÚn
->
exŒa_¥acšg
;

691 
DŸObjeù
 *
obj
 = &
cÚn
->
objeù
;

692 
Pošt
 *
’dpošts
;

693 
»®
 
x1
,
y1
,
x2
,
y2
,
xc
,
yc
;

694 
»®
 
Ënsq
, 
®pha
, 
¿dius
;

695 
»®
 
ªgË1
, 
ªgË2
;

696 
gboŞ—n
 
righthªd
;

698 
’dpošts
 = &
¬c
->
cÚÃùiÚ
.endpoints[0];

699 
x1
 = 
’dpošts
[0].
x
;

700 
y1
 = 
’dpošts
[0].
y
;

701 
x2
 = 
’dpošts
[1].
x
;

702 
y2
 = 
’dpošts
[1].
y
;

704 
Ënsq
 = (
x2
-
x1
)*(x2-x1è+ (
y2
-
y1
)*(y2-y1);

705 
¿dius
 = 
Ënsq
/(8*
¬c
->
curve_di¡ªû
) +‡rc->curve_distance/2.0;

707 ià(
Ënsq
 == 0.0)

708 
®pha
 = 1.0;

710 
®pha
 = (
¿dius
 - 
¬c
->
curve_di¡ªû
è/ 
	`sq¹
(
Ënsq
);

712 
xc
 = (
x1
 + 
x2
è/ 2.0 + (
y2
 - 
y1
)*
®pha
;

713 
yc
 = (
y1
 + 
y2
è/ 2.0 + (
x1
 - 
x2
)*
®pha
;

715 
ªgË1
 = -
	`©ª2
(
y1
-
yc
, 
x1
-
xc
)*180.0/
M_PI
;

716 ià(
ªgË1
<0)

717 
ªgË1
+=360.0;

718 
ªgË2
 = -
	`©ª2
(
y2
-
yc
, 
x2
-
xc
)*180.0/
M_PI
;

719 ià(
ªgË2
<0)

720 
ªgË2
+=360.0;

722 ià(
¿dius
<0.0) {

723 
»®
 
tmp
;

724 
tmp
 = 
ªgË1
;

725 
ªgË1
 = 
ªgË2
;

726 
ªgË2
 = 
tmp
;

727 
¿dius
 = -radius;

730 
¬c
->
¿dius
 =„adius;

731 
¬c
->
ûÁ”
.
x
 = 
xc
;‡rc->ûÁ”.
y
 = 
yc
;

732 
¬c
->
ªgË1
 =‡ngle1;

733 
¬c
->
ªgË2
 =‡ngle2;

736 
exŒa
->
¡¬t_Œªs
 =

737 
exŒa
->
’d_Œªs
 =

738 
exŒa
->
¡¬t_lÚg
 =

739 
exŒa
->
’d_lÚg
 = (
¬c
->
lše_width
 / 2.0);

742 
	`¬c_upd©e_hªdËs
(
¬c
);

744 
righthªd
 = 
	`is_right_hªd
 (&
’dpošts
[0], &
¬c
->
middË_hªdË
.
pos
, &endpoints[1]);

745 
	`cÚÃùiÚ_upd©e_boundšgbox
(
cÚn
);

748 ià(
	`š_ªgË
(0, 
¬c
->
ªgË1
,‡rc->
ªgË2
)) {

750 
Pošt
 
±
 = { 
¬c
->
ûÁ”
.
x
 +‡rc->
¿dius
 + (¬c->
lše_width
 / 2.0), 
y1
 };

751 
	`»ùªgË_add_pošt
 (&
obj
->
boundšg_box
, &
±
);

753 ià(
	`š_ªgË
(90, 
¬c
->
ªgË1
,‡rc->
ªgË2
)) {

755 
Pošt
 
±
 = {
x1
, 
¬c
->
ûÁ”
.
y
 -‡rc->
¿dius
 - (¬c->
lše_width
 / 2.0) };

756 
	`»ùªgË_add_pošt
 (&
obj
->
boundšg_box
, &
±
);

758 ià(
	`š_ªgË
(180, 
¬c
->
ªgË1
,‡rc->
ªgË2
)) {

760 
Pošt
 
±
 = { 
¬c
->
ûÁ”
.
x
 -‡rc->
¿dius
 - (¬c->
lše_width
 / 2.0), 
y1
 };

761 
	`»ùªgË_add_pošt
 (&
obj
->
boundšg_box
, &
±
);

763 ià(
	`š_ªgË
(270, 
¬c
->
ªgË1
,‡rc->
ªgË2
)) {

765 
Pošt
 
±
 = { 
x1
, 
¬c
->
ûÁ”
.
y
 +‡rc->
¿dius
 + (¬c->
lše_width
 / 2.0) };

766 
	`»ùªgË_add_pošt
 (&
obj
->
boundšg_box
, &
±
);

768 ià(
¬c
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

772 
ReùªgË
 
bbox
 = {0,};

773 
»®
 
tmp
;

774 
Pošt
 
move_¬row
, 
move_lše
;

775 
Pošt
 
to
 = 
¬c
->
cÚÃùiÚ
.
’dpošts
[0];

776 
Pošt
 
äom
 = 
to
;

777 
	`pošt_sub
 (&
äom
, &
¬c
->
ûÁ”
);

778 
tmp
 = 
äom
.
x
;

779 ià(
righthªd
)

780 
äom
.
x
 = -äom.
y
, from.y = 
tmp
;

782 
äom
.
x
 = from.
y
, from.y = -
tmp
;

783 
	`pošt_add
 (&
äom
, &
to
);

785 
	`ÿlcuÏ‹_¬row_pošt
(&
¬c
->
¡¬t_¬row
, &
to
, &
äom
,

786 &
move_¬row
, &
move_lše
, 
¬c
->
lše_width
);

788 
	`pošt_sub
(&
to
, &
move_¬row
);

789 
	`pošt_sub
(&
äom
, &
move_lše
);

790 
	`¬row_bbox
(&
¬c
->
¡¬t_¬row
,‡rc->
lše_width
, &
to
, &
äom
, &
bbox
);

791 
	`»ùªgË_uniÚ
(&
obj
->
boundšg_box
, &
bbox
);

793 ià(
¬c
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

794 
ReùªgË
 
bbox
 = {0,};

795 
»®
 
tmp
;

796 
Pošt
 
move_¬row
, 
move_lše
;

797 
Pošt
 
to
 = 
¬c
->
cÚÃùiÚ
.
’dpošts
[1];

798 
Pošt
 
äom
 = 
to
;

799 
	`pošt_sub
 (&
äom
, &
¬c
->
ûÁ”
);

800 
tmp
 = 
äom
.
x
;

801 ià(
righthªd
)

802 
äom
.
x
 = from.
y
, from.y = -
tmp
;

804 
äom
.
x
 = -äom.
y
, from.y = 
tmp
;

805 
	`pošt_add
 (&
äom
, &
to
);

806 
	`ÿlcuÏ‹_¬row_pošt
(&
¬c
->
’d_¬row
, &
to
, &
äom
,

807 &
move_¬row
, &
move_lše
, 
¬c
->
lše_width
);

809 
	`pošt_sub
(&
to
, &
move_¬row
);

810 
	`pošt_sub
(&
äom
, &
move_lše
);

811 
	`¬row_bbox
(&
¬c
->
’d_¬row
,‡rc->
lše_width
, &
to
, &
äom
, &
bbox
);

812 
	`»ùªgË_uniÚ
(&
obj
->
boundšg_box
, &
bbox
);

815 
obj
->
pos™iÚ
 = 
cÚn
->
’dpošts
[0];

816 
	}
}

819 
	$¬c_§ve
(
Arc
 *
¬c
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
)

821 
	`cÚÃùiÚ_§ve
(&
¬c
->
cÚÃùiÚ
, 
obj_node
);

823 ià(!
	`cŞÜ_equ®s
(&
¬c
->
¬c_cŞÜ
, &
cŞÜ_bÏck
))

824 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "arc_color"),

825 &
¬c
->
¬c_cŞÜ
);

827 ià(
¬c
->
curve_di¡ªû
 != 0.1)

828 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "curve_distance"),

829 
¬c
->
curve_di¡ªû
);

831 ià(
¬c
->
lše_width
 != 0.1)

832 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

833 
¬c
->
lše_width
);

835 ià(
¬c
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
)

836 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

837 
¬c
->
lše_¡yË
);

839 ià(
¬c
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
 &&

840 
¬c
->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

841 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

842 
¬c
->
dashËngth
);

844 ià(
¬c
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

845 
	`§ve_¬row
(
obj_node
, &
¬c
->
¡¬t_¬row
, "start_arrow",

849 ià(
¬c
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

850 
	`§ve_¬row
(
obj_node
, &
¬c
->
’d_¬row
, "end_arrow",

853 
	}
}

855 
DŸObjeù
 *

856 
	$¬c_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

858 
Arc
 *
¬c
;

859 
CÚÃùiÚ
 *
cÚn
;

860 
DŸObjeù
 *
obj
;

861 
A‰ribu‹Node
 
©Œ
;

863 
¬c
 = 
	`g_m®loc0
((
Arc
));

865 
cÚn
 = &
¬c
->
cÚÃùiÚ
;

866 
obj
 = &
cÚn
->
objeù
;

868 
obj
->
ty³
 = &
¬c_ty³
;

869 
obj
->
İs
 = &
¬c_İs
;

871 
	`cÚÃùiÚ_lßd
(
cÚn
, 
obj_node
);

873 
¬c
->
¬c_cŞÜ
 = 
cŞÜ_bÏck
;

874 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "arc_color");

875 ià(
©Œ
 !ğ
NULL
)

876 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
¬c
->
¬c_cŞÜ
);

878 
¬c
->
curve_di¡ªû
 = 0.1;

879 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "curve_distance");

880 ià(
©Œ
 !ğ
NULL
)

881 
¬c
->
curve_di¡ªû
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

883 
¬c
->
lše_width
 = 0.1;

884 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

885 ià(
©Œ
 !ğ
NULL
)

886 
¬c
->
lše_width
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

888 
¬c
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

889 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

890 ià(
©Œ
 !ğ
NULL
)

891 
¬c
->
lše_¡yË
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

893 
¬c
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

894 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

895 ià(
©Œ
 !ğ
NULL
)

896 
¬c
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

898 
	`lßd_¬row
(
obj_node
, &
¬c
->
¡¬t_¬row
, "start_arrow",

901 
	`lßd_¬row
(
obj_node
, &
¬c
->
’d_¬row
, "end_arrow",

904 
	`cÚÃùiÚ_š™
(
cÚn
, 3, 0);

906 
obj
->
hªdËs
[2] = &
¬c
->
middË_hªdË
;

907 
¬c
->
middË_hªdË
.
id
 = 
HANDLE_MIDDLE
;

908 
¬c
->
middË_hªdË
.
ty³
 = 
HANDLE_MINOR_CONTROL
;

909 
¬c
->
middË_hªdË
.
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

910 
¬c
->
middË_hªdË
.
cÚÃùed_to
 = 
NULL
;

912 
	`¬c_upd©e_d©a
(
¬c
);

914  &
¬c
->
cÚÃùiÚ
.
objeù
;

915 
	}
}

	@O:\tool\dvs50\objects\standard\bezier.c

22 #ifdeà
HAVE_CONFIG_H


23 
	~<cÚfig.h
>

26 
	~<as£¹.h
>

27 
	~<m©h.h
>

29 
	~"š.h
"

30 
	~"objeù.h
"

31 
	~"bez›r_cÚn.h
"

32 
	~"cÚÃùiÚpošt.h
"

33 
	~"dŸ»nd””.h
"

34 
	~"©Œibu‹s.h
"

35 
	~"widg‘s.h
"

36 
	~"dŸm’u.h
"

37 
	~"mes§ge.h
"

38 
	~"´İ”t›s.h
"

39 
	~"ü—‹.h
"

41 
	~"toŞ-icÚs.h
"

43 
	#DEFAULT_WIDTH
 0.15

	)

45 
_Bez›¾še
 
	tBez›¾še
;

47 
	s_Bez›¾še
 {

48 
Bez›rCÚn
 
	mbez
;

50 
CŞÜ
 
	mlše_cŞÜ
;

51 
LšeStyË
 
	mlše_¡yË
;

52 
»®
 
	mdashËngth
;

53 
»®
 
	mlše_width
;

54 
A¼ow
 
	m¡¬t_¬row
, 
	m’d_¬row
;

55 
»®
 
	mabsŞu‹_¡¬t_g­
, 
	mabsŞu‹_’d_g­
;

59 
ObjeùChªge
* 
bez›¾še_move_hªdË
(
Bez›¾še
 *
bez›¾še
, 
HªdË
 *
hªdË
,

60 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

61 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

62 
ObjeùChªge
* 
bez›¾še_move
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
to
);

63 
bez›¾še_£Ëù
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
şicked_pošt
,

64 
DŸR’d””
 *
š‹¿ùive_»nd””
);

65 
bez›¾še_d¿w
(
Bez›¾še
 *
bez›¾še
, 
DŸR’d””
 *
»nd””
);

66 
DŸObjeù
 *
bez›¾še_ü—‹
(
Pošt
 *
¡¬ošt
,

67 *
u£r_d©a
,

68 
HªdË
 **
hªdË1
,

69 
HªdË
 **
hªdË2
);

70 
»®
 
bez›¾še_di¡ªû_äom
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
pošt
);

71 
bez›¾še_upd©e_d©a
(
Bez›¾še
 *
bez›¾še
);

72 
bez›¾še_de¡roy
(
Bez›¾še
 *
bez›¾še
);

73 
DŸObjeù
 *
bez›¾še_cİy
(
Bez›¾še
 *
bez›¾še
);

75 
PrİDesütiÚ
 *
bez›¾še_desüibe_´İs
(
Bez›¾še
 *
bez›¾še
);

76 
bez›¾še_g‘_´İs
(
Bez›¾še
 *
bez›¾še
, 
GPŒA¼ay
 *
´İs
);

77 
bez›¾še_£t_´İs
(
Bez›¾še
 *
bez›¾še
, 
GPŒA¼ay
 *
´İs
);

79 
bez›¾še_§ve
(
Bez›¾še
 *
bez›¾še
, 
ObjeùNode
 
obj_node
,

80 cÚ¡ *
f’ame
);

81 
DŸObjeù
 *
bez›¾še_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
,

82 cÚ¡ *
f’ame
);

83 
DŸM’u
 *
bez›¾še_g‘_objeù_m’u
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
şickedpošt
);

85 
compu‹_g­_pošts
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
g­_pošts
);

86 
»®
 
­´ox_bez_Ëngth
(
Bez›rCÚn
 *
bez
);

87 
exchªge_bez_g­_pošts
(
Bez›rCÚn
 * 
bez
, 
Pošt
* 
g­_pošts
);

89 
ObjeùTy³Ops
 
	gbez›¾še_ty³_İs
 =

91 (
C»©eFunc
)
bez›¾še_ü—‹
,

92 (
LßdFunc
è
bez›¾še_lßd
,

93 (
SaveFunc
è
bez›¾še_§ve
,

94 (
G‘DeçuÉsFunc
è
NULL
,

95 (
AµlyDeçuÉsFunc
è
NULL


98 
DŸObjeùTy³
 
	gbez›¾še_ty³
 =

102 (**è
bez›¾še_icÚ
,

104 &
bez›¾še_ty³_İs
,

105 
NULL
,

109 
DŸObjeùTy³
 *
	g_bez›¾še_ty³
 = (DŸObjeùTy³ *è&
bez›¾še_ty³
;

112 
ObjeùOps
 
	gbez›¾še_İs
 = {

113 (
De¡royFunc
è
bez›¾še_de¡roy
,

114 (
D¿wFunc
è
bez›¾še_d¿w
,

115 (
Di¡ªûFunc
è
bez›¾še_di¡ªû_äom
,

116 (
S–eùFunc
è
bez›¾še_£Ëù
,

117 (
CİyFunc
è
bez›¾še_cİy
,

118 (
MoveFunc
è
bez›¾še_move
,

119 (
MoveHªdËFunc
è
bez›¾še_move_hªdË
,

120 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

121 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

122 (
ObjeùM’uFunc
è
bez›¾še_g‘_objeù_m’u
,

123 (
DesüibePrİsFunc
è
bez›¾še_desüibe_´İs
,

124 (
G‘PrİsFunc
è
bez›¾še_g‘_´İs
,

125 (
S‘PrİsFunc
è
bez›¾še_£t_´İs
,

126 (
TextEd™Func
) 0,

127 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

130 
PrİNumD©a
 
	gg­_¿nge
 = { -
G_MAXFLOAT
, G_MAXFLOAT, 0.1};

132 
PrİDesütiÚ
 
	gbez›¾še_´İs
[] = {

133 
BEZCONN_COMMON_PROPERTIES
,

134 
PROP_STD_LINE_WIDTH
,

135 
PROP_STD_LINE_COLOUR
,

136 
PROP_STD_LINE_STYLE
,

137 
PROP_STD_START_ARROW
,

138 
PROP_STD_END_ARROW
,

139 
PROP_FRAME_BEGIN
("g­s",0,
N_
("Line gaps")),

140 { "absŞu‹_¡¬t_g­", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

141 
N_
("AbsŞu‹ s¹ g­"), 
NULL
, &
g­_¿nge
 },

142 { "absŞu‹_’d_g­", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

143 
N_
("AbsŞu‹ƒnd g­"), 
NULL
, &
g­_¿nge
 },

144 
PROP_FRAME_END
("gaps",0),

145 
PROP_DESC_END


148 
PrİDesütiÚ
 *

149 
	$bez›¾še_desüibe_´İs
(
Bez›¾še
 *
bez›¾še
)

151 ià(
bez›¾še_´İs
[0].
qu¬k
 == 0)

152 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
bez›¾še_´İs
);

153  
bez›¾še_´İs
;

154 
	}
}

156 
PrİOff£t
 
	gbez›¾še_off£ts
[] = {

157 
BEZCONN_COMMON_PROPERTIES_OFFSETS
,

158 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Bez›¾še
, 
lše_width
) },

159 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Bez›¾še
, 
lše_cŞÜ
) },

160 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

161 
off£tof
(
Bez›¾še
, 
lše_¡yË
), off£tof(Bez›¾še, 
dashËngth
) },

162 { "¡¬t_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
Bez›¾še
, 
¡¬t_¬row
) },

163 { "’d_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
Bez›¾še
, 
’d_¬row
) },

164 
PROP_OFFSET_FRAME_BEGIN
("gaps"),

165 { "absŞu‹_¡¬t_g­", 
PROP_TYPE_REAL
, 
off£tof
(
Bez›¾še
, 
absŞu‹_¡¬t_g­
) },

166 { "absŞu‹_’d_g­", 
PROP_TYPE_REAL
, 
off£tof
(
Bez›¾še
, 
absŞu‹_’d_g­
) },

167 
PROP_OFFSET_FRAME_END
("gaps"),

168 { 
NULL
, 0, 0 }

172 
	$bez›¾še_g‘_´İs
(
Bez›¾še
 *
bez›¾še
, 
GPŒA¼ay
 *
´İs
)

174 
	`objeù_g‘_´İs_äom_off£ts
(&
bez›¾še
->
bez
.
objeù
, 
bez›¾še_off£ts
,

175 
´İs
);

176 
	}
}

179 
	$bez›¾še_£t_´İs
(
Bez›¾še
 *
bez›¾še
, 
GPŒA¼ay
 *
´İs
)

181 
	`objeù_£t_´İs_äom_off£ts
(&
bez›¾še
->
bez
.
objeù
, 
bez›¾še_off£ts
,

182 
´İs
);

183 
	`bez›¾še_upd©e_d©a
(
bez›¾še
);

184 
	}
}

186 
»®


187 
	$bez›¾še_di¡ªû_äom
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
pošt
)

189 
Bez›rCÚn
 *
bez
 = &
bez›¾še
->bez;

190 ià(
	`cÚÅošt_is_autog­
(
bez
->
objeù
.
hªdËs
[0]->
cÚÃùed_to
) ||

191 
	`cÚÅošt_is_autog­
(
bez
->
objeù
.
hªdËs
[3*(bez->
numpošts
-1)]->
cÚÃùed_to
) ||

192 
bez›¾še
->
absŞu‹_¡¬t_g­
 || bez›¾še->
absŞu‹_’d_g­
) {

193 
Pošt
 
g­_pošts
[4];

194 
»®
 
di¡ªû
;

195 
	`compu‹_g­_pošts
(
bez›¾še
, 
g­_pošts
);

196 
	`exchªge_bez_g­_pošts
(
bez
,
g­_pošts
);

197 
di¡ªû
 = 
	`bez›rcÚn_di¡ªû_äom
(
bez
, 
pošt
, 
bez›¾še
->
lše_width
);

198 
	`exchªge_bez_g­_pošts
(
bez
,
g­_pošts
);

199  
di¡ªû
;

201  
	`bez›rcÚn_di¡ªû_äom
(
bez
, 
pošt
, 
bez›¾še
->
lše_width
);

203 
	}
}

205 
	$bez›¾še_şo£¡_£gm’t
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
pošt
) {

206 
Bez›rCÚn
 *
bez
 = &
bez›¾še
->bez;

207  
	`bez›rcÚn_şo£¡_£gm’t
(
bez
, 
pošt
, 
bez›¾še
->
lše_width
);

208 
	}
}

211 
	$bez›¾še_£Ëù
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
şicked_pošt
,

212 
DŸR’d””
 *
š‹¿ùive_»nd””
)

214 
	`bez›rcÚn_upd©e_d©a
(&
bez›¾še
->
bez
);

215 
	}
}

217 
ObjeùChªge
*

218 
	$bez›¾še_move_hªdË
(
Bez›¾še
 *
bez›¾še
, 
HªdË
 *
hªdË
,

219 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

220 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

222 
	`as£¹
(
bez›¾še
!=
NULL
);

223 
	`as£¹
(
hªdË
!=
NULL
);

224 
	`as£¹
(
to
!=
NULL
);

226 ià(
»asÚ
 =ğ
HANDLE_MOVE_CREATE
 ||„—sÚ =ğ
HANDLE_MOVE_CREATE_FINAL
) {

228 
Bez›rCÚn
 *
bez
 = &
bez›¾še
->bez;

229 
Pošt
 
di¡
 = 
bez
->
pošts
[0].
p1
;

231 
	`pošt_sub
(&
di¡
, 
to
);

232 
di¡
.
y
 = 0;

233 
	`pošt_sÿË
(&
di¡
, 0.332);

235 
	`bez›rcÚn_move_hªdË
(
bez
, 
hªdË
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

237 
bez
->
pošts
[1].
p1
 = bez->points[0].p1;

238 
	`pošt_sub
(&
bez
->
pošts
[1].
p1
, &
di¡
);

239 
bez
->
pošts
[1].
p2
 = *
to
;

240 
	`pošt_add
(&
bez
->
pošts
[1].
p2
, &
di¡
);

242 
	`bez›rcÚn_move_hªdË
(&
bez›¾še
->
bez
, 
hªdË
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

245 
	`bez›¾še_upd©e_d©a
(
bez›¾še
);

247  
NULL
;

248 
	}
}

251 
ObjeùChªge
*

252 
	$bez›¾še_move
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
to
)

254 
	`bez›rcÚn_move
(&
bez›¾še
->
bez
, 
to
);

255 
	`bez›¾še_upd©e_d©a
(
bez›¾še
);

257  
NULL
;

258 
	}
}

260 
	$exchªge_bez_g­_pošts
(
Bez›rCÚn
 * 
bez
, 
Pošt
* 
g­_pošts
)

262 
Pošt
 
tmp_pošts
[4];

263 
tmp_pošts
[0] = 
bez
->
pošts
[0].
p1
;

264 
tmp_pošts
[1] = 
bez
->
pošts
[1].
p1
;

265 
tmp_pošts
[2] = 
bez
->
pošts
[bez->
numpošts
-1].
p2
;

266 
tmp_pošts
[3] = 
bez
->
pošts
[bez->
numpošts
-1].
p3
;

267 
bez
->
pošts
[0].
p1
 = 
g­_pošts
[0];

268 
bez
->
pošts
[1].
p1
 = 
g­_pošts
[1];

269 
bez
->
pošts
[bez->
numpošts
-1].
p2
 = 
g­_pošts
[2];

270 
bez
->
pošts
[bez->
numpošts
-1].
p3
 = 
g­_pošts
[3];

271 
g­_pošts
[0] = 
tmp_pošts
[0];

272 
g­_pošts
[1] = 
tmp_pošts
[1];

273 
g­_pošts
[2] = 
tmp_pošts
[2];

274 
g­_pošts
[3] = 
tmp_pošts
[3];

275 
	}
}

276 
»®
 
	$­´ox_bez_Ëngth
(
Bez›rCÚn
 *
bez
)

280 
Pošt
 *
cu¼’t
, *
Ï¡
, 
vec
;

281 
»®
 
Ëngth
 = .0;

282 
i
;

283 
cu¼’t
 = &
bez
->
pošts
[0].
p1
;

284 
i
=1; i < 
bez
->
numpošts
 ; i++){

285 
Ï¡
 = 
cu¼’t
;

286 
cu¼’t
 = &
bez
->
pošts
[
i
].
p3
;

287 
	`pošt_cİy
(&
vec
,
Ï¡
);

288 
	`pošt_sub
(&
vec
,
cu¼’t
);

289 
Ëngth
 +ğ
	`pošt_Ën
(&
vec
);

291  
Ëngth
;

292 
	}
}

294 
	$compu‹_g­_pošts
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
g­_pošts
)

296 
»®
 
fœ¡_Ëngth
, 
Ï¡_Ëngth
, 
bez_Ëngth
;

297 
Bez›rCÚn
 *
bez
 = &
bez›¾še
->bez;

298 
Pošt
 
vec_¡¬t
, 
vec_’d
;

301 
g­_pošts
[0] = 
bez
->
pošts
[0].
p1
;

302 
g­_pošts
[1] = 
bez
->
pošts
[1].
p1
;

303 
g­_pošts
[2] = 
bez
->
pošts
[bez->
numpošts
-1].
p2
;

304 
g­_pošts
[3] = 
bez
->
pošts
[bez->
numpošts
-1].
p3
;

306 
	`pošt_cİy
(&
vec_¡¬t
, &
g­_pošts
[1]);

307 
	`pošt_sub
(&
vec_¡¬t
, &
g­_pošts
[0]);

308 
	`pošt_nÜm®ize
(&
vec_¡¬t
);

309 
	`pošt_cİy
(&
vec_’d
, &
g­_pošts
[2]);

310 
	`pošt_sub
(&
vec_’d
, &
g­_pošts
[3]);

311 
	`pošt_nÜm®ize
(&
vec_’d
);

314 
bez_Ëngth
 = 
	`­´ox_bez_Ëngth
(
bez
) ;

315 
fœ¡_Ëngth
 = 
	`di¡ªû_pošt_pošt
(&
g­_pošts
[0],&gap_points[1]);

316 
Ï¡_Ëngth
 = 
	`di¡ªû_pošt_pošt
(&
g­_pošts
[2],&gap_points[3]);

318 ià(
	`cÚÅošt_is_autog­
(
bez
->
objeù
.
hªdËs
[0]->
cÚÃùed_to
) &&

319 (
bez
->
objeù
.
hªdËs
[0])->
cÚÃùed_to
 !ğ
NULL
 &&

320 (
bez
->
objeù
.
hªdËs
[0])->
cÚÃùed_to
->objeù !ğ
NULL
 ) {

321 
Pošt
 
’d
;

322 
	`pošt_cİy
(&
’d
, &
g­_pošts
[0]);

323 
	`pošt_add_sÿËd
(&
’d
, &
vec_¡¬t
, 
bez_Ëngth
);

324 
’d
 = 
	`ÿlcuÏ‹_objeù_edge
(&
g­_pošts
[0], &end,

325 (
bez
->
objeù
.
hªdËs
[0])->
cÚÃùed_to
->object);

326 
	`pošt_sub
(&
’d
, &
g­_pošts
[0]);

328 
	`pošt_add
(&
g­_pošts
[0], &
’d
);

329 
	`pošt_add
(&
g­_pošts
[1], &
’d
);

332 ià(
	`cÚÅošt_is_autog­
(
bez
->
objeù
.
hªdËs
[3*(bez->
numpošts
-1)]->
cÚÃùed_to
) &&

333 (
bez
->
objeù
.
hªdËs
[3*(bez->
numpošts
-1)])->
cÚÃùed_to
 !ğ
NULL
 &&

334 (
bez
->
objeù
.
hªdËs
[3*(bez->
numpošts
-1)])->
cÚÃùed_to
->objeù !ğ
NULL
) {

335 
Pošt
 
’d
;

336 
	`pošt_cİy
(&
’d
, &
g­_pošts
[3]);

337 
	`pošt_add_sÿËd
(&
’d
, &
vec_’d
, 
bez_Ëngth
);

338 
’d
 = 
	`ÿlcuÏ‹_objeù_edge
(&
g­_pošts
[3], &end,

339 (
bez
->
objeù
.
hªdËs
[3*(bez->
numpošts
-1)])->
cÚÃùed_to
->object);

340 
	`pošt_sub
(&
’d
, &
g­_pošts
[3]);

342 
	`pošt_add
(&
g­_pošts
[3], &
’d
);

343 
	`pošt_add
(&
g­_pošts
[2], &
’d
);

348 
	`pošt_add_sÿËd
(&
g­_pošts
[0], &
vec_¡¬t
, 
bez›¾še
->
absŞu‹_¡¬t_g­
);

349 
	`pošt_add_sÿËd
(&
g­_pošts
[1], &
vec_¡¬t
, 
bez›¾še
->
absŞu‹_¡¬t_g­
);

352 
	`pošt_add_sÿËd
(&
g­_pošts
[2], &
vec_’d
, 
bez›¾še
->
absŞu‹_’d_g­
);

353 
	`pošt_add_sÿËd
(&
g­_pošts
[3], &
vec_’d
, 
bez›¾še
->
absŞu‹_’d_g­
);

356 
	}
}

358 
	$bez›¾še_d¿w
(
Bez›¾še
 *
bez›¾še
, 
DŸR’d””
 *
»nd””
)

360 
Pošt
 
g­_pošts
[4];

362 
Bez›rCÚn
 *
bez
 = &
bez›¾še
->bez;

363 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

365 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
bez›¾še
->
lše_width
);

366 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
bez›¾še
->
lše_¡yË
);

367 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
bez›¾še
->
dashËngth
);

368 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_MITER
);

369 
»nd””_İs
->
	`£t_lšeÿps
(
»nd””
, 
LINECAPS_BUTT
);

371 ià(
	`cÚÅošt_is_autog­
(
bez
->
objeù
.
hªdËs
[0]->
cÚÃùed_to
) ||

372 
	`cÚÅošt_is_autog­
(
bez
->
objeù
.
hªdËs
[3*(bez->
numpošts
-1)]->
cÚÃùed_to
) ||

373 
bez›¾še
->
absŞu‹_¡¬t_g­
 || bez›¾še->
absŞu‹_’d_g­
) {

375 
	`compu‹_g­_pošts
(
bez›¾še
,
g­_pošts
);

376 
	`exchªge_bez_g­_pošts
(
bez
,
g­_pošts
);

377 
»nd””_İs
->
	`d¿w_bez›r_w™h_¬rows
(
»nd””
, 
bez
->
pošts
, bez->
numpošts
,

378 
bez›¾še
->
lše_width
,

379 &
bez›¾še
->
lše_cŞÜ
,

380 &
bez›¾še
->
¡¬t_¬row
,

381 &
bez›¾še
->
’d_¬row
);

382 
	`exchªge_bez_g­_pošts
(
bez
,
g­_pošts
);

384 
»nd””_İs
->
	`d¿w_bez›r_w™h_¬rows
(
»nd””
, 
bez
->
pošts
, bez->
numpošts
,

385 
bez›¾še
->
lše_width
,

386 &
bez›¾še
->
lše_cŞÜ
,

387 &
bez›¾še
->
¡¬t_¬row
,

388 &
bez›¾še
->
’d_¬row
);

392 
»nd””_İs
->
	`d¿w_bez›r
(
»nd””
, 
bez
->
pošts
, bez->
numpošts
,

393 &
bez›¾še
->
lše_cŞÜ
);

395 ià(
bez›¾še
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

396 
	`¬row_d¿w
(
»nd””
, 
bez›¾še
->
¡¬t_¬row
.
ty³
,

397 &
bez
->
pošts
[0].
p1
, &bez->points[1].p1,

398 
bez›¾še
->
¡¬t_¬row
.
Ëngth
, bez›¾še->¡¬t_¬row.
width
,

399 
bez›¾še
->
lše_width
,

400 &
bez›¾še
->
lše_cŞÜ
, &
cŞÜ_wh™e
);

402 ià(
bez›¾še
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

403 
	`¬row_d¿w
(
»nd””
, 
bez›¾še
->
’d_¬row
.
ty³
,

404 &
bez
->
pošts
[bez->
numpošts
-1].
p3
,

405 &
bez
->
pošts
[bez->
numpošts
-1].
p2
,

406 
bez›¾še
->
’d_¬row
.
Ëngth
, bez›¾še->’d_¬row.
width
,

407 
bez›¾še
->
lše_width
,

408 &
bez›¾še
->
lše_cŞÜ
, &
cŞÜ_wh™e
);

417 ià(
»nd””
->
is_š‹¿ùive
 &&

418 
	`dŸ_objeù_is_£Ëùed
(&
bez›¾še
->
bez
.
objeù
)) {

419 
	`bez›rcÚn_d¿w_cÚŒŞ_lšes
(&
bez›¾še
->
bez
, 
»nd””
);

421 
	}
}

423 
DŸObjeù
 *

424 
	$bez›¾še_ü—‹
(
Pošt
 *
¡¬ošt
,

425 *
u£r_d©a
,

426 
HªdË
 **
hªdË1
,

427 
HªdË
 **
hªdË2
)

429 
Bez›¾še
 *
bez›¾še
;

430 
Bez›rCÚn
 *
bez
;

431 
DŸObjeù
 *
obj
;

432 
Pošt
 
deçuÉËn
 = { .3, .3 };

434 
bez›¾še
 = 
	`g_Ãw0
(
Bez›¾še
, 1);

435 
bez
 = &
bez›¾še
->bez;

436 
obj
 = &
bez
->
objeù
;

438 
obj
->
ty³
 = &
bez›¾še_ty³
;

439 
obj
->
İs
 = &
bez›¾še_İs
;

441 ià(
u£r_d©a
 =ğ
NULL
) {

442 
	`bez›rcÚn_š™
(
bez
, 2);

444 
bez
->
pošts
[0].
p1
 = *
¡¬ošt
;

445 
bez
->
pošts
[1].
p1
 = *
¡¬ošt
;

446 
	`pošt_add
(&
bez
->
pošts
[1].
p1
, &
deçuÉËn
);

447 
bez
->
pošts
[1].
p2
 = bez->pošts[1].
p1
;

448 
	`pošt_add
(&
bez
->
pošts
[1].
p2
, &
deçuÉËn
);

449 
bez
->
pošts
[1].
p3
 = bez->pošts[1].
p2
;

450 
	`pošt_add
(&
bez
->
pošts
[1].
p3
, &
deçuÉËn
);

452 
Bez›rC»©eD©a
 *
bcd
 = (Bez›rC»©eD©a*)
u£r_d©a
;

454 
	`bez›rcÚn_š™
(
bez
, 
bcd
->
num_pošts
);

455 
	`bez›rcÚn_£t_pošts
(
bez
, 
bcd
->
num_pošts
, bcd->
pošts
);

458 
bez›¾še
->
lše_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

459 
bez›¾še
->
lše_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

460 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
bez›¾še
->
lše_¡yË
,

461 &
bez›¾še
->
dashËngth
);

462 
bez›¾še
->
¡¬t_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_¡¬t_¬row
();

463 
bez›¾še
->
’d_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_’d_¬row
();

465 *
hªdË1
 = 
bez
->
objeù
.
hªdËs
[0];

466 *
hªdË2
 = 
bez
->
objeù
.
hªdËs
[3];

468 
	`bez›¾še_upd©e_d©a
(
bez›¾še
);

470  &
bez›¾še
->
bez
.
objeù
;

471 
	}
}

474 
	$bez›¾še_de¡roy
(
Bez›¾še
 *
bez›¾še
)

476 
	`bez›rcÚn_de¡roy
(&
bez›¾še
->
bez
);

477 
	}
}

479 
DŸObjeù
 *

480 
	$bez›¾še_cİy
(
Bez›¾še
 *
bez›¾še
)

482 
Bez›¾še
 *
Ãwbez›¾še
;

483 
Bez›rCÚn
 *
bez
, *
Ãwbez
;

484 
DŸObjeù
 *
Ãwobj
;

486 
bez
 = &
bez›¾še
->bez;

488 
Ãwbez›¾še
 = 
	`g_Ãw0
(
Bez›¾še
, 1);

489 
Ãwbez
 = &
Ãwbez›¾še
->
bez
;

490 
Ãwobj
 = &
bez
->
objeù
;

492 
	`bez›rcÚn_cİy
(
bez
, 
Ãwbez
);

494 
Ãwbez›¾še
->
lše_cŞÜ
 = 
bez›¾še
->line_color;

495 
Ãwbez›¾še
->
lše_width
 = 
bez›¾še
->line_width;

496 
Ãwbez›¾še
->
lše_¡yË
 = 
bez›¾še
->line_style;

497 
Ãwbez›¾še
->
dashËngth
 = 
bez›¾še
->dashlength;

498 
Ãwbez›¾še
->
¡¬t_¬row
 = 
bez›¾še
->start_arrow;

499 
Ãwbez›¾še
->
’d_¬row
 = 
bez›¾še
->end_arrow;

500 
Ãwbez›¾še
->
absŞu‹_¡¬t_g­
 = 
bez›¾še
->absolute_start_gap;

501 
Ãwbez›¾še
->
absŞu‹_’d_g­
 = 
bez›¾še
->absolute_end_gap;

503  &
Ãwbez›¾še
->
bez
.
objeù
;

504 
	}
}

508 
	$bez›¾še_upd©e_d©a
(
Bez›¾še
 *
bez›¾še
)

510 
Bez›rCÚn
 *
bez
 = &
bez›¾še
->bez;

511 
DŸObjeù
 *
obj
 = &
bez
->
objeù
;

512 
PŞyBBExŒas
 *
exŒa
 = &
bez
->
exŒa_¥acšg
;

514 
	`bez›rcÚn_upd©e_d©a
(
bez
);

516 
exŒa
->
¡¬t_Œªs
 =ƒxŒa->
¡¬t_lÚg
 =

517 
exŒa
->
middË_Œªs
 =

518 
exŒa
->
’d_Œªs
 =ƒxŒa->
’d_lÚg
 = (
bez›¾še
->
lše_width
 / 2.0);

520 
obj
->
pos™iÚ
 = 
bez
->
pošts
[0].
p1
;

522 ià(
	`cÚÅošt_is_autog­
(
bez
->
objeù
.
hªdËs
[0]->
cÚÃùed_to
) ||

523 
	`cÚÅošt_is_autog­
(
bez
->
objeù
.
hªdËs
[3*(bez->
numpošts
-1)]->
cÚÃùed_to
) ||

524 
bez›¾še
->
absŞu‹_¡¬t_g­
 || bez›¾še->
absŞu‹_’d_g­
 ||

525 
bez›¾še
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
 || bez›¾še->
’d_¬row
.type != ARROW_NONE) {

526 
Pošt
 
g­_pošts
[4];

527 
ReùªgË
 
bbox_uniÚ
 = {
bez
->
pošts
[0].
p1
.
x
, bez->pošts[0].p1.
y
, bez->points[0].p1.x, bez->points[0].p1.y};

528 
	`compu‹_g­_pošts
(
bez›¾še
, 
g­_pošts
);

529 
	`exchªge_bez_g­_pošts
(
bez
,
g­_pošts
);

531 ià(
bez›¾še
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

532 
ReùªgË
 
bbox
;

533 
Pošt
 
move_¬row
, 
move_lše
;

534 
Pošt
 
to
 = 
bez
->
pošts
[0].
p1
, 
äom
 = bez->points[1].p1;

536 
	`ÿlcuÏ‹_¬row_pošt
(&
bez›¾še
->
¡¬t_¬row
, &
to
, &
äom
, &
move_¬row
, &
move_lše
, bez›¾še->
lše_width
);

537 
	`pošt_sub
(&
to
, &
move_¬row
);

538 
	`pošt_sub
(&
bez
->
pošts
[0].
p1
, &
move_lše
);

539 
	`¬row_bbox
 (&
bez›¾še
->
¡¬t_¬row
, bez›¾še->
lše_width
, &
to
, &
äom
, &
bbox
);

540 
	`»ùªgË_uniÚ
 (&
bbox_uniÚ
, &
bbox
);

542 ià(
bez›¾še
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

543 
ReùªgË
 
bbox
;

544 
Pošt
 
move_¬row
, 
move_lše
;

545 
num_pošts
 = 
bez
->
numpošts
;

546 
Pošt
 
to
 = 
bez
->
pošts
[
num_pošts
-1].
p3
, 
äom
 = bez->pošts[num_pošts-1].
p2
;

548 
	`ÿlcuÏ‹_¬row_pošt
(&
bez›¾še
->
’d_¬row
, &
to
, &
äom
, &
move_¬row
, &
move_lše
, bez›¾še->
lše_width
);

549 
	`pošt_sub
(&
to
, &
move_¬row
);

550 
	`pošt_sub
(&
bez
->
pošts
[
num_pošts
-1].
p3
, &
move_lše
);

551 
	`¬row_bbox
 (&
bez›¾še
->
’d_¬row
, bez›¾še->
lše_width
, &
to
, &
äom
, &
bbox
);

552 
	`»ùªgË_uniÚ
 (&
bbox_uniÚ
, &
bbox
);

554 
	`bez›rcÚn_upd©e_boundšgbox
(
bez
);

555 
	`»ùªgË_uniÚ
 (&
obj
->
boundšg_box
, &
bbox_uniÚ
);

556 
	`exchªge_bez_g­_pošts
(
bez
,
g­_pošts
);

558 
	`bez›rcÚn_upd©e_boundšgbox
(
bez
);

563 
i
, 
num_pošts
 = 
bez
->
numpošts
;

564 
obj
->
’şosšg_box
 = obj->
boundšg_box
;

566 
i
 = 1; i < 
num_pošts
; ++i) {

567 ià(
bez
->
pošts
[
i
].
ty³
 !ğ
BEZ_CURVE_TO
)

569 
	`»ùªgË_add_pošt
(&
obj
->
’şosšg_box
, &
bez
->
pošts
[
i
].
p1
);

570 
	`»ùªgË_add_pošt
(&
obj
->
’şosšg_box
, &
bez
->
pošts
[
i
].
p2
);

573 
	}
}

576 
	$bez›¾še_§ve
(
Bez›¾še
 *
bez›¾še
, 
ObjeùNode
 
obj_node
,

577 cÚ¡ *
f’ame
)

579 ià(
	`cÚÅošt_is_autog­
(
bez›¾še
->
bez
.
objeù
.
hªdËs
[0]->
cÚÃùed_to
) ||

580 
	`cÚÅošt_is_autog­
(
bez›¾še
->
bez
.
objeù
.
hªdËs
[3*(bez›¾še->bez.
numpošts
-1)]->
cÚÃùed_to
) ||

581 
bez›¾še
->
absŞu‹_¡¬t_g­
 || bez›¾še->
absŞu‹_’d_g­
) {

582 
Pošt
 
g­_pošts
[4];

583 
	`compu‹_g­_pošts
(
bez›¾še
, 
g­_pošts
);

584 
	`exchªge_bez_g­_pošts
(&
bez›¾še
->
bez
,
g­_pošts
);

585 
	`bez›rcÚn_upd©e_boundšgbox
(&
bez›¾še
->
bez
);

586 
	`exchªge_bez_g­_pošts
(&
bez›¾še
->
bez
,
g­_pošts
);

588 
	`bez›rcÚn_§ve
(&
bez›¾še
->
bez
, 
obj_node
);

590 ià(!
	`cŞÜ_equ®s
(&
bez›¾še
->
lše_cŞÜ
, &
cŞÜ_bÏck
))

591 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "line_color"),

592 &
bez›¾še
->
lše_cŞÜ
);

594 ià(
bez›¾še
->
lše_width
 != 0.1)

595 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

596 
bez›¾še
->
lše_width
);

598 ià(
bez›¾še
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
)

599 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

600 
bez›¾še
->
lše_¡yË
);

602 ià(
bez›¾še
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
 &&

603 
bez›¾še
->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

604 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

605 
bez›¾še
->
dashËngth
);

607 ià(
bez›¾še
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

608 
	`§ve_¬row
(
obj_node
, &
bez›¾še
->
¡¬t_¬row
, "start_arrow",

612 ià(
bez›¾še
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

613 
	`§ve_¬row
(
obj_node
, &
bez›¾še
->
’d_¬row
, "end_arrow",

617 ià(
bez›¾še
->
absŞu‹_¡¬t_g­
)

618 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "absolute_start_gap"),

619 
bez›¾še
->
absŞu‹_¡¬t_g­
);

620 ià(
bez›¾še
->
absŞu‹_’d_g­
)

621 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "absolute_end_gap"),

622 
bez›¾še
->
absŞu‹_’d_g­
);

623 
	}
}

625 
DŸObjeù
 *

626 
	$bez›¾še_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

628 
Bez›¾še
 *
bez›¾še
;

629 
Bez›rCÚn
 *
bez
;

630 
DŸObjeù
 *
obj
;

631 
A‰ribu‹Node
 
©Œ
;

633 
bez›¾še
 = 
	`g_Ãw0
(
Bez›¾še
, 1);

635 
bez
 = &
bez›¾še
->bez;

636 
obj
 = &
bez
->
objeù
;

638 
obj
->
ty³
 = &
bez›¾še_ty³
;

639 
obj
->
İs
 = &
bez›¾še_İs
;

641 
	`bez›rcÚn_lßd
(
bez
, 
obj_node
);

643 
bez›¾še
->
lše_cŞÜ
 = 
cŞÜ_bÏck
;

644 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_color");

645 ià(
©Œ
 !ğ
NULL
)

646 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
bez›¾še
->
lše_cŞÜ
);

648 
bez›¾še
->
lše_width
 = 0.1;

649 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

650 ià(
©Œ
 !ğ
NULL
)

651 
bez›¾še
->
lše_width
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

653 
bez›¾še
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

654 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

655 ià(
©Œ
 !ğ
NULL
)

656 
bez›¾še
->
lše_¡yË
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

658 
bez›¾še
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

659 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

660 ià(
©Œ
 !ğ
NULL
)

661 
bez›¾še
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

663 
	`lßd_¬row
(
obj_node
, &
bez›¾še
->
¡¬t_¬row
, "start_arrow",

666 
	`lßd_¬row
(
obj_node
, &
bez›¾še
->
’d_¬row
, "end_arrow",

669 
bez›¾še
->
absŞu‹_¡¬t_g­
 = 0.0;

670 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "absolute_start_gap");

671 ià(
©Œ
 !ğ
NULL
)

672 
bez›¾še
->
absŞu‹_¡¬t_g­
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

673 
bez›¾še
->
absŞu‹_’d_g­
 = 0.0;

674 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "absolute_end_gap");

675 ià(
©Œ
 !ğ
NULL
)

676 
bez›¾še
->
absŞu‹_’d_g­
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

682 
	`bez›¾še_upd©e_d©a
(
bez›¾še
);

684  &
bez›¾še
->
bez
.
objeù
;

685 
	}
}

687 
ObjeùChªge
 *

688 
	$bez›¾še_add_£gm’t_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

690 
Bez›¾še
 *
bez›¾še
 = (Bez›¾še*è
obj
;

691 
£gm’t
;

692 
ObjeùChªge
 *
chªge
;

694 
£gm’t
 = 
	`bez›¾še_şo£¡_£gm’t
(
bez›¾še
, 
şicked
);

695 
chªge
 = 
	`bez›rcÚn_add_£gm’t
(&
bez›¾še
->
bez
, 
£gm’t
, 
şicked
);

696 
	`bez›¾še_upd©e_d©a
(
bez›¾še
);

697  
chªge
;

698 
	}
}

700 
ObjeùChªge
 *

701 
	$bez›¾še_d–‘e_£gm’t_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

703 
£g_Ä
;

704 
Bez›¾še
 *
bez›¾še
 = (Bez›¾še*è
obj
;

705 
ObjeùChªge
 *
chªge
;

707 
£g_Ä
 = 
	`bez›rcÚn_şo£¡_£gm’t
(&
bez›¾še
->
bez
, 
şicked
,

708 
bez›¾še
->
lše_width
);

710 
chªge
 = 
	`bez›rcÚn_»move_£gm’t
(&
bez›¾še
->
bez
, 
£g_Ä
+1);

711 
	`bez›¾še_upd©e_d©a
(
bez›¾še
);

712  
chªge
;

713 
	}
}

715 
ObjeùChªge
 *

716 
	$bez›¾še_£t_cÜÃr_ty³_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

718 
HªdË
 *
şo£¡
;

719 
Bez›¾še
 *
bez›¾še
 = (Bez›¾še*è
obj
;

720 
ObjeùChªge
 *
chªge
;

722 
şo£¡
 = 
	`bez›rcÚn_şo£¡_majÜ_hªdË
(&
bez›¾še
->
bez
, 
şicked
);

723 
chªge
 = 
	`bez›rcÚn_£t_cÜÃr_ty³
(&
bez›¾še
->
bez
, 
şo£¡
,

724 
	`GPOINTER_TO_INT
(
d©a
));

726 
	`bez›¾še_upd©e_d©a
(
bez›¾še
);

727  
chªge
;

728 
	}
}

730 
DŸM’uI‹m
 
	gbez›¾še_m’u_™ems
[] = {

731 { 
N_
("Add segm’t"), 
bez›¾še_add_£gm’t_ÿÎback
, 
NULL
, 1 },

732 { 
N_
("D–‘£gm’t"), 
bez›¾še_d–‘e_£gm’t_ÿÎback
, 
NULL
, 1 },

733 { 
NULL
, NULL, NULL, 1 },

734 { 
N_
("Symm‘riøcÚŒŞ"), 
bez›¾še_£t_cÜÃr_ty³_ÿÎback
,

735 
GINT_TO_POINTER
(
BEZ_CORNER_SYMMETRIC
), 1 },

736 { 
N_
("SmoÙh cÚŒŞ"), 
bez›¾še_£t_cÜÃr_ty³_ÿÎback
,

737 
GINT_TO_POINTER
(
BEZ_CORNER_SMOOTH
), 1 },

738 { 
N_
("Cu¥ cÚŒŞ"), 
bez›¾še_£t_cÜÃr_ty³_ÿÎback
,

739 
GINT_TO_POINTER
(
BEZ_CORNER_CUSP
), 1 },

742 
DŸM’u
 
	gbez›¾še_m’u
 = {

744 (
bez›¾še_m’u_™ems
)/(
DŸM’uI‹m
),

745 
bez›¾še_m’u_™ems
,

746 
NULL


749 
DŸM’u
 *

750 
	$bez›¾še_g‘_objeù_m’u
(
Bez›¾še
 *
bez›¾še
, 
Pošt
 *
şickedpošt
)

752 
HªdË
 *
şo£¡
;

753 
gboŞ—n
 
şo£¡_is_’dpošt
;

754 
BezCÜÃrTy³
 
ùy³
 = 42;

755 
gšt
 
i
;

757 
şo£¡
 = 
	`bez›rcÚn_şo£¡_majÜ_hªdË
(&
bez›¾še
->
bez
, 
şickedpošt
);

758 ià(
şo£¡
->
id
 =ğ
HANDLE_MOVE_STARTPOINT
 ||

759 
şo£¡
->
id
 =ğ
HANDLE_MOVE_ENDPOINT
)

760 
şo£¡_is_’dpošt
 = 
TRUE
;

762 
şo£¡_is_’dpošt
 = 
FALSE
;

764 
i
 = 0; i < 
bez›¾še
->
bez
.
numpošts
; i++)

765 ià(
bez›¾še
->
bez
.
objeù
.
hªdËs
[3*
i
] =ğ
şo£¡
) {

766 
ùy³
 = 
bez›¾še
->
bez
.
cÜÃr_ty³s
[
i
];

771 
bez›¾še_m’u_™ems
[0].
aùive
 = 1;

772 
bez›¾še_m’u_™ems
[1].
aùive
 = 
bez›¾še
->
bez
.
numpošts
 > 2;

773 
bez›¾še_m’u_™ems
[3].
aùive
 = !
şo£¡_is_’dpošt
 &&

774 (
ùy³
 !ğ
BEZ_CORNER_SYMMETRIC
);

775 
bez›¾še_m’u_™ems
[4].
aùive
 = !
şo£¡_is_’dpošt
 &&

776 (
ùy³
 !ğ
BEZ_CORNER_SMOOTH
);

777 
bez›¾še_m’u_™ems
[5].
aùive
 = !
şo£¡_is_’dpošt
 &&

778 (
ùy³
 !ğ
BEZ_CORNER_CUSP
);

779  &
bez›¾še_m’u
;

780 
	}
}

	@O:\tool\dvs50\objects\standard\beziergon.c

22 #ifdeà
HAVE_CONFIG_H


23 
	~<cÚfig.h
>

26 
	~<as£¹.h
>

27 
	~<m©h.h
>

29 
	~"š.h
"

30 
	~"objeù.h
"

31 
	~"bez›rsh­e.h
"

32 
	~"cÚÃùiÚpošt.h
"

33 
	~"dŸ»nd””.h
"

34 
	~"©Œibu‹s.h
"

35 
	~"widg‘s.h
"

36 
	~"dŸm’u.h
"

37 
	~"mes§ge.h
"

38 
	~"´İ”t›s.h
"

39 
	~"ü—‹.h
"

41 
	~"toŞ-icÚs.h
"

43 
	#DEFAULT_WIDTH
 0.15

	)

45 
_Bez›rgÚPrİ”t›s
 
	tBez›rgÚPrİ”t›s
;

47 
	s_Bez›rgÚ
 {

48 
Bez›rSh­e
 
	mbez›r
;

50 
CŞÜ
 
	mlše_cŞÜ
;

51 
LšeStyË
 
	mlše_¡yË
;

52 
CŞÜ
 
	mšÃr_cŞÜ
;

53 
gboŞ—n
 
	mshow_background
;

54 
»®
 
	mdashËngth
;

55 
»®
 
	mlše_width
;

56 } 
	tBez›rgÚ
;

58 
	s_Bez›rgÚPrİ”t›s
 {

59 
gboŞ—n
 
	mshow_background
;

60 } 
	gdeçuÉ_´İ”t›s
 = { 
TRUE
 };

62 
ObjeùChªge
* 
bez›rgÚ_move_hªdË
(
Bez›rgÚ
 *
bez›rgÚ
, 
HªdË
 *
hªdË
,

63 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

64 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

65 
ObjeùChªge
* 
bez›rgÚ_move
(
Bez›rgÚ
 *
bez›rgÚ
, 
Pošt
 *
to
);

66 
bez›rgÚ_£Ëù
(
Bez›rgÚ
 *
bez›rgÚ
, 
Pošt
 *
şicked_pošt
,

67 
DŸR’d””
 *
š‹¿ùive_»nd””
);

68 
bez›rgÚ_d¿w
(
Bez›rgÚ
 *
bez›rgÚ
, 
DŸR’d””
 *
»nd””
);

69 
DŸObjeù
 *
bez›rgÚ_ü—‹
(
Pošt
 *
¡¬ošt
,

70 *
u£r_d©a
,

71 
HªdË
 **
hªdË1
,

72 
HªdË
 **
hªdË2
);

73 
»®
 
bez›rgÚ_di¡ªû_äom
(
Bez›rgÚ
 *
bez›rgÚ
, 
Pošt
 *
pošt
);

74 
bez›rgÚ_upd©e_d©a
(
Bez›rgÚ
 *
bez›rgÚ
);

75 
bez›rgÚ_de¡roy
(
Bez›rgÚ
 *
bez›rgÚ
);

76 
DŸObjeù
 *
bez›rgÚ_cİy
(
Bez›rgÚ
 *
bez›rgÚ
);

78 
PrİDesütiÚ
 *
bez›rgÚ_desüibe_´İs
(
Bez›rgÚ
 *
bez›rgÚ
);

79 
bez›rgÚ_g‘_´İs
(
Bez›rgÚ
 *
bez›rgÚ
, 
GPŒA¼ay
 *
´İs
);

80 
bez›rgÚ_£t_´İs
(
Bez›rgÚ
 *
bez›rgÚ
, 
GPŒA¼ay
 *
´İs
);

82 
bez›rgÚ_§ve
(
Bez›rgÚ
 *
bez›rgÚ
, 
ObjeùNode
 
obj_node
,

83 cÚ¡ *
f’ame
);

84 
DŸObjeù
 *
bez›rgÚ_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
,

85 cÚ¡ *
f’ame
);

86 
DŸM’u
 *
bez›rgÚ_g‘_objeù_m’u
(
Bez›rgÚ
 *
bez›rgÚ
,

87 
Pošt
 *
şickedpošt
);

89 
ObjeùTy³Ops
 
	gbez›rgÚ_ty³_İs
 =

91 (
C»©eFunc
)
bez›rgÚ_ü—‹
,

92 (
LßdFunc
è
bez›rgÚ_lßd
,

93 (
SaveFunc
è
bez›rgÚ_§ve
,

94 (
G‘DeçuÉsFunc
è
NULL
,

95 (
AµlyDeçuÉsFunc
è
NULL


98 
DŸObjeùTy³
 
	gbez›rgÚ_ty³
 =

102 (**è
bez›rgÚ_icÚ
,

104 &
bez›rgÚ_ty³_İs
,

105 
NULL
,

109 
DŸObjeùTy³
 *
	g_bez›rgÚ_ty³
 = (DŸObjeùTy³ *è&
bez›rgÚ_ty³
;

112 
ObjeùOps
 
	gbez›rgÚ_İs
 = {

113 (
De¡royFunc
è
bez›rgÚ_de¡roy
,

114 (
D¿wFunc
è
bez›rgÚ_d¿w
,

115 (
Di¡ªûFunc
è
bez›rgÚ_di¡ªû_äom
,

116 (
S–eùFunc
è
bez›rgÚ_£Ëù
,

117 (
CİyFunc
è
bez›rgÚ_cİy
,

118 (
MoveFunc
è
bez›rgÚ_move
,

119 (
MoveHªdËFunc
è
bez›rgÚ_move_hªdË
,

120 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

121 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

122 (
ObjeùM’uFunc
è
bez›rgÚ_g‘_objeù_m’u
,

123 (
DesüibePrİsFunc
è
bez›rgÚ_desüibe_´İs
,

124 (
G‘PrİsFunc
è
bez›rgÚ_g‘_´İs
,

125 (
S‘PrİsFunc
è
bez›rgÚ_£t_´İs
,

126 (
TextEd™Func
) 0,

127 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

130 
PrİDesütiÚ
 
	gbez›rgÚ_´İs
[] = {

131 
BEZSHAPE_COMMON_PROPERTIES
,

132 
PROP_STD_LINE_WIDTH
,

133 
PROP_STD_LINE_COLOUR
,

134 
PROP_STD_LINE_STYLE
,

135 
PROP_STD_FILL_COLOUR
,

136 
PROP_STD_SHOW_BACKGROUND
,

137 
PROP_DESC_END


140 
PrİDesütiÚ
 *

141 
	$bez›rgÚ_desüibe_´İs
(
Bez›rgÚ
 *
bez›rgÚ
)

143 ià(
bez›rgÚ_´İs
[0].
qu¬k
 == 0)

144 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
bez›rgÚ_´İs
);

145  
bez›rgÚ_´İs
;

146 
	}
}

148 
PrİOff£t
 
	gbez›rgÚ_off£ts
[] = {

149 
BEZSHAPE_COMMON_PROPERTIES_OFFSETS
,

150 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Bez›rgÚ
, 
lše_width
) },

151 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Bez›rgÚ
, 
lše_cŞÜ
) },

152 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

153 
off£tof
(
Bez›rgÚ
, 
lše_¡yË
), off£tof(Bez›rgÚ, 
dashËngth
) },

154 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Bez›rgÚ
, 
šÃr_cŞÜ
) },

155 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
Bez›rgÚ
, 
show_background
) },

156 { 
NULL
, 0, 0 }

160 
	$bez›rgÚ_g‘_´İs
(
Bez›rgÚ
 *
bez›rgÚ
, 
GPŒA¼ay
 *
´İs
)

162 
	`objeù_g‘_´İs_äom_off£ts
(&
bez›rgÚ
->
bez›r
.
objeù
, 
bez›rgÚ_off£ts
,

163 
´İs
);

164 
	}
}

167 
	$bez›rgÚ_£t_´İs
(
Bez›rgÚ
 *
bez›rgÚ
, 
GPŒA¼ay
 *
´İs
)

169 
	`objeù_£t_´İs_äom_off£ts
(&
bez›rgÚ
->
bez›r
.
objeù
, 
bez›rgÚ_off£ts
,

170 
´İs
);

171 
	`bez›rgÚ_upd©e_d©a
(
bez›rgÚ
);

172 
	}
}

174 
»®


175 
	$bez›rgÚ_di¡ªû_äom
(
Bez›rgÚ
 *
bez›rgÚ
, 
Pošt
 *
pošt
)

177  
	`bez›rsh­e_di¡ªû_äom
(&
bez›rgÚ
->
bez›r
, 
pošt
,

178 
bez›rgÚ
->
lše_width
);

179 
	}
}

182 
	$bez›rgÚ_şo£¡_£gm’t
(
Bez›rgÚ
 *
bez›rgÚ
, 
Pošt
 *
pošt
)

184  
	`bez›rsh­e_şo£¡_£gm’t
(&
bez›rgÚ
->
bez›r
, 
pošt
,

185 
bez›rgÚ
->
lše_width
);

186 
	}
}

189 
	$bez›rgÚ_£Ëù
(
Bez›rgÚ
 *
bez›rgÚ
, 
Pošt
 *
şicked_pošt
,

190 
DŸR’d””
 *
š‹¿ùive_»nd””
)

192 
	`bez›rsh­e_upd©e_d©a
(&
bez›rgÚ
->
bez›r
);

193 
	}
}

195 
ObjeùChªge
*

196 
	$bez›rgÚ_move_hªdË
(
Bez›rgÚ
 *
bez›rgÚ
, 
HªdË
 *
hªdË
,

197 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

198 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

200 
	`as£¹
(
bez›rgÚ
!=
NULL
);

201 
	`as£¹
(
hªdË
!=
NULL
);

202 
	`as£¹
(
to
!=
NULL
);

204 
	`bez›rsh­e_move_hªdË
(&
bez›rgÚ
->
bez›r
, 
hªdË
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

205 
	`bez›rgÚ_upd©e_d©a
(
bez›rgÚ
);

207  
NULL
;

208 
	}
}

211 
ObjeùChªge
*

212 
	$bez›rgÚ_move
(
Bez›rgÚ
 *
bez›rgÚ
, 
Pošt
 *
to
)

214 
	`bez›rsh­e_move
(&
bez›rgÚ
->
bez›r
, 
to
);

215 
	`bez›rgÚ_upd©e_d©a
(
bez›rgÚ
);

217  
NULL
;

218 
	}
}

221 
	$bez›rgÚ_d¿w
(
Bez›rgÚ
 *
bez›rgÚ
, 
DŸR’d””
 *
»nd””
)

223 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

225 
Bez›rSh­e
 *
bez›r
 = &
bez›rgÚ
->bezier;

226 
BezPošt
 *
pošts
;

227 
n
;

229 
pošts
 = &
bez›r
->points[0];

230 
n
 = 
bez›r
->
numpošts
;

232 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
bez›rgÚ
->
lše_width
);

233 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
bez›rgÚ
->
lše_¡yË
);

234 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
bez›rgÚ
->
dashËngth
);

235 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_MITER
);

236 
»nd””_İs
->
	`£t_lšeÿps
(
»nd””
, 
LINECAPS_BUTT
);

238 ià(
bez›rgÚ
->
show_background
)

239 
»nd””_İs
->
	`fl_bez›r
(
»nd””
, 
pošts
, 
n
, &
bez›rgÚ
->
šÃr_cŞÜ
);

241 
»nd””_İs
->
	`d¿w_bez›r
(
»nd””
, 
pošts
, 
n
, &
bez›rgÚ
->
lše_cŞÜ
);

246 ià(
»nd””
->
is_š‹¿ùive
 &&

247 
	`dŸ_objeù_is_£Ëùed
((
DŸObjeù
*)
bez›rgÚ
)) {

248 
	`bez›rsh­e_d¿w_cÚŒŞ_lšes
(&
bez›rgÚ
->
bez›r
, 
»nd””
);

250 
	}
}

252 
DŸObjeù
 *

253 
	$bez›rgÚ_ü—‹
(
Pošt
 *
¡¬ošt
,

254 *
u£r_d©a
,

255 
HªdË
 **
hªdË1
,

256 
HªdË
 **
hªdË2
)

258 
Bez›rgÚ
 *
bez›rgÚ
;

259 
Bez›rSh­e
 *
bez›r
;

260 
DŸObjeù
 *
obj
;

261 
Pošt
 
deçuÉx
 = { 1.0, 0.0 };

262 
Pošt
 
deçuÉy
 = { 0.0, 1.0 };

264 
bez›rgÚ
 = 
	`g_Ãw0
(
Bez›rgÚ
, 1);

265 
bez›r
 = &
bez›rgÚ
->bezier;

266 
obj
 = &
bez›r
->
objeù
;

268 
obj
->
ty³
 = &
bez›rgÚ_ty³
;

269 
obj
->
İs
 = &
bez›rgÚ_İs
;

271 ià(
u£r_d©a
 =ğ
NULL
) {

272 
	`bez›rsh­e_š™
(
bez›r
, 3);

274 
bez›r
->
pošts
[0].
p1
 = *
¡¬ošt
;

275 
bez›r
->
pošts
[0].
p3
 = *
¡¬ošt
;

276 
bez›r
->
pošts
[2].
p3
 = *
¡¬ošt
;

278 
bez›r
->
pošts
[1].
p1
 = *
¡¬ošt
;

279 
	`pošt_add
(&
bez›r
->
pošts
[1].
p1
, &
deçuÉx
);

280 
bez›r
->
pošts
[2].
p2
 = *
¡¬ošt
;

281 
	`pošt_sub
(&
bez›r
->
pošts
[2].
p2
, &
deçuÉx
);

283 
bez›r
->
pošts
[1].
p3
 = *
¡¬ošt
;

284 
	`pošt_add
(&
bez›r
->
pošts
[1].
p3
, &
deçuÉy
);

285 
bez›r
->
pošts
[1].
p2
 = bez›r->pošts[1].
p3
;

286 
	`pošt_add
(&
bez›r
->
pošts
[1].
p2
, &
deçuÉx
);

287 
bez›r
->
pošts
[2].
p1
 = bez›r->pošts[1].
p3
;

288 
	`pošt_sub
(&
bez›r
->
pošts
[2].
p1
, &
deçuÉx
);

290 
Bez›rC»©eD©a
 *
bcd
 = (Bez›rC»©eD©a*)
u£r_d©a
;

292 
	`bez›rsh­e_š™
(
bez›r
, 
bcd
->
num_pošts
);

293 
	`bez›rsh­e_£t_pošts
(
bez›r
, 
bcd
->
num_pošts
, bcd->
pošts
);

295 
bez›rgÚ
->
lše_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

296 
bez›rgÚ
->
lše_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

297 
bez›rgÚ
->
šÃr_cŞÜ
 = 
	`©Œibu‹s_g‘_background
();

298 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
bez›rgÚ
->
lše_¡yË
,

299 &
bez›rgÚ
->
dashËngth
);

300 
bez›rgÚ
->
show_background
 = 
deçuÉ_´İ”t›s
.show_background;

302 
	`bez›rgÚ_upd©e_d©a
(
bez›rgÚ
);

304 *
hªdË1
 = 
bez›r
->
objeù
.
hªdËs
[5];

305 *
hªdË2
 = 
bez›r
->
objeù
.
hªdËs
[2];

306  &
bez›rgÚ
->
bez›r
.
objeù
;

307 
	}
}

310 
	$bez›rgÚ_de¡roy
(
Bez›rgÚ
 *
bez›rgÚ
)

312 
	`bez›rsh­e_de¡roy
(&
bez›rgÚ
->
bez›r
);

313 
	}
}

315 
DŸObjeù
 *

316 
	$bez›rgÚ_cİy
(
Bez›rgÚ
 *
bez›rgÚ
)

318 
Bez›rgÚ
 *
Ãwbez›rgÚ
;

319 
Bez›rSh­e
 *
bez›r
, *
Ãwbez›r
;

320 
DŸObjeù
 *
Ãwobj
;

322 
bez›r
 = &
bez›rgÚ
->bezier;

324 
Ãwbez›rgÚ
 = 
	`g_m®loc0
((
Bez›rgÚ
));

325 
Ãwbez›r
 = &
Ãwbez›rgÚ
->
bez›r
;

326 
Ãwobj
 = &
Ãwbez›r
->
objeù
;

328 
	`bez›rsh­e_cİy
(
bez›r
, 
Ãwbez›r
);

330 
Ãwbez›rgÚ
->
lše_cŞÜ
 = 
bez›rgÚ
->line_color;

331 
Ãwbez›rgÚ
->
lše_width
 = 
bez›rgÚ
->line_width;

332 
Ãwbez›rgÚ
->
lše_¡yË
 = 
bez›rgÚ
->line_style;

333 
Ãwbez›rgÚ
->
dashËngth
 = 
bez›rgÚ
->dashlength;

334 
Ãwbez›rgÚ
->
šÃr_cŞÜ
 = 
bez›rgÚ
->inner_color;

335 
Ãwbez›rgÚ
->
show_background
 = 
bez›rgÚ
->show_background;

337  &
Ãwbez›rgÚ
->
bez›r
.
objeù
;

338 
	}
}

341 
	$bez›rgÚ_upd©e_d©a
(
Bez›rgÚ
 *
bez›rgÚ
)

343 
Bez›rSh­e
 *
bez›r
 = &
bez›rgÚ
->bezier;

344 
DŸObjeù
 *
obj
 = &
bez›r
->
objeù
;

345 
EËm’tBBExŒas
 *
exŒa
 = &
bez›r
->
exŒa_¥acšg
;

347 
	`bez›rsh­e_upd©e_d©a
(
bez›r
);

349 
exŒa
->
bÜd”_Œªs
 = 
bez›rgÚ
->
lše_width
 / 2.0;

350 
	`bez›rsh­e_upd©e_boundšgbox
(
bez›r
);

354 
i
, 
num_pošts
 = 
bez›r
->
numpošts
;

355 
obj
->
’şosšg_box
 = obj->
boundšg_box
;

356 
i
 = 0; i < 
num_pošts
; ++i) {

357 ià(
bez›r
->
pošts
[
i
].
ty³
 !ğ
BEZ_CURVE_TO
)

359 
	`»ùªgË_add_pošt
(&
obj
->
’şosšg_box
, &
bez›r
->
pošts
[
i
].
p1
);

360 
	`»ùªgË_add_pošt
(&
obj
->
’şosšg_box
, &
bez›r
->
pošts
[
i
].
p2
);

363 
obj
->
pos™iÚ
 = 
bez›r
->
pošts
[0].
p1
;

364 
	}
}

367 
	$bez›rgÚ_§ve
(
Bez›rgÚ
 *
bez›rgÚ
, 
ObjeùNode
 
obj_node
,

368 cÚ¡ *
f’ame
)

370 
	`bez›rsh­e_§ve
(&
bez›rgÚ
->
bez›r
, 
obj_node
);

372 ià(!
	`cŞÜ_equ®s
(&
bez›rgÚ
->
lše_cŞÜ
, &
cŞÜ_bÏck
))

373 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "line_color"),

374 &
bez›rgÚ
->
lše_cŞÜ
);

376 ià(
bez›rgÚ
->
lše_width
 != 0.1)

377 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

378 
bez›rgÚ
->
lše_width
);

380 ià(!
	`cŞÜ_equ®s
(&
bez›rgÚ
->
šÃr_cŞÜ
, &
cŞÜ_wh™e
))

381 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "inner_color"),

382 &
bez›rgÚ
->
šÃr_cŞÜ
);

384 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
obj_node
, "show_background"),

385 
bez›rgÚ
->
show_background
);

387 ià(
bez›rgÚ
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
)

388 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

389 
bez›rgÚ
->
lše_¡yË
);

391 ià(
bez›rgÚ
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
 &&

392 
bez›rgÚ
->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

393 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

394 
bez›rgÚ
->
dashËngth
);

396 
	}
}

398 
DŸObjeù
 *

399 
	$bez›rgÚ_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

401 
Bez›rgÚ
 *
bez›rgÚ
;

402 
Bez›rSh­e
 *
bez›r
;

403 
DŸObjeù
 *
obj
;

404 
A‰ribu‹Node
 
©Œ
;

406 
bez›rgÚ
 = 
	`g_m®loc0
((
Bez›rgÚ
));

408 
bez›r
 = &
bez›rgÚ
->bezier;

409 
obj
 = &
bez›r
->
objeù
;

411 
obj
->
ty³
 = &
bez›rgÚ_ty³
;

412 
obj
->
İs
 = &
bez›rgÚ_İs
;

414 
	`bez›rsh­e_lßd
(
bez›r
, 
obj_node
);

416 
bez›rgÚ
->
lše_cŞÜ
 = 
cŞÜ_bÏck
;

417 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_color");

418 ià(
©Œ
 !ğ
NULL
)

419 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
bez›rgÚ
->
lše_cŞÜ
);

421 
bez›rgÚ
->
lše_width
 = 0.1;

422 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

423 ià(
©Œ
 !ğ
NULL
)

424 
bez›rgÚ
->
lše_width
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

426 
bez›rgÚ
->
šÃr_cŞÜ
 = 
cŞÜ_wh™e
;

427 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "inner_color");

428 ià(
©Œ
 !ğ
NULL
)

429 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
bez›rgÚ
->
šÃr_cŞÜ
);

431 
bez›rgÚ
->
show_background
 = 
TRUE
;

432 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "show_background");

433 ià(
©Œ
 !ğ
NULL
)

434 
bez›rgÚ
->
show_background
 = 
	`d©a_boŞ—n
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

436 
bez›rgÚ
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

437 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

438 ià(
©Œ
 !ğ
NULL
)

439 
bez›rgÚ
->
lše_¡yË
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

441 
bez›rgÚ
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

442 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

443 ià(
©Œ
 !ğ
NULL
)

444 
bez›rgÚ
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

446 
	`bez›rgÚ_upd©e_d©a
(
bez›rgÚ
);

448  &
bez›rgÚ
->
bez›r
.
objeù
;

449 
	}
}

451 
ObjeùChªge
 *

452 
	$bez›rgÚ_add_£gm’t_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

454 
Bez›rgÚ
 *
bez›r
 = (Bez›rgÚ*è
obj
;

455 
£gm’t
;

456 
ObjeùChªge
 *
chªge
;

458 
£gm’t
 = 
	`bez›rgÚ_şo£¡_£gm’t
(
bez›r
, 
şicked
);

459 
chªge
 = 
	`bez›rsh­e_add_£gm’t
(&
bez›r
->bez›r, 
£gm’t
, 
şicked
);

461 
	`bez›rgÚ_upd©e_d©a
(
bez›r
);

462  
chªge
;

463 
	}
}

465 
ObjeùChªge
 *

466 
	$bez›rgÚ_d–‘e_£gm’t_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

468 
£g_Ä
;

469 
Bez›rgÚ
 *
bez›r
 = (Bez›rgÚ*è
obj
;

470 
ObjeùChªge
 *
chªge
;

472 
£g_Ä
 = 
	`bez›rgÚ_şo£¡_£gm’t
(
bez›r
, 
şicked
);

473 
chªge
 = 
	`bez›rsh­e_»move_£gm’t
(&
bez›r
->bez›r, 
£g_Ä
);

475 
	`bez›rgÚ_upd©e_d©a
(
bez›r
);

476  
chªge
;

477 
	}
}

479 
ObjeùChªge
 *

480 
	$bez›rgÚ_£t_cÜÃr_ty³_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

482 
HªdË
 *
şo£¡
;

483 
Bez›rgÚ
 *
bez›rgÚ
 = (Bez›rgÚ *è
obj
;

484 
ObjeùChªge
 *
chªge
;

486 
şo£¡
 = 
	`bez›rsh­e_şo£¡_majÜ_hªdË
(&
bez›rgÚ
->
bez›r
, 
şicked
);

487 
chªge
 = 
	`bez›rsh­e_£t_cÜÃr_ty³
(&
bez›rgÚ
->
bez›r
, 
şo£¡
,

488 
	`GPOINTER_TO_INT
(
d©a
));

490 
	`bez›rgÚ_upd©e_d©a
(
bez›rgÚ
);

491  
chªge
;

492 
	}
}

494 
DŸM’uI‹m
 
	gbez›rgÚ_m’u_™ems
[] = {

495 { 
N_
("Add segm’t"), 
bez›rgÚ_add_£gm’t_ÿÎback
, 
NULL
, 1 },

496 { 
N_
("D–‘£gm’t"), 
bez›rgÚ_d–‘e_£gm’t_ÿÎback
, 
NULL
, 1 },

497 { 
NULL
, NULL, NULL, 1 },

498 { 
N_
("Symm‘riøcÚŒŞ"), 
bez›rgÚ_£t_cÜÃr_ty³_ÿÎback
,

499 
GINT_TO_POINTER
(
BEZ_CORNER_SYMMETRIC
), 1 },

500 { 
N_
("SmoÙh cÚŒŞ"), 
bez›rgÚ_£t_cÜÃr_ty³_ÿÎback
,

501 
GINT_TO_POINTER
(
BEZ_CORNER_SMOOTH
), 1 },

502 { 
N_
("Cu¥ cÚŒŞ"), 
bez›rgÚ_£t_cÜÃr_ty³_ÿÎback
,

503 
GINT_TO_POINTER
(
BEZ_CORNER_CUSP
), 1 },

506 
DŸM’u
 
	gbez›rgÚ_m’u
 = {

508 (
bez›rgÚ_m’u_™ems
)/(
DŸM’uI‹m
),

509 
bez›rgÚ_m’u_™ems
,

510 
NULL


513 
DŸM’u
 *

514 
	$bez›rgÚ_g‘_objeù_m’u
(
Bez›rgÚ
 *
bez›rgÚ
, 
Pošt
 *
şickedpošt
)

517 
bez›rgÚ_m’u_™ems
[0].
aùive
 = 1;

518 
bez›rgÚ_m’u_™ems
[1].
aùive
 = 
bez›rgÚ
->
bez›r
.
numpošts
 > 3;

519  &
bez›rgÚ_m’u
;

520 
	}
}

	@O:\tool\dvs50\objects\standard\box.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<as£¹.h
>

24 
	~<m©h.h
>

26 
	~"š.h
"

27 
	~"objeù.h
"

28 
	~"–em’t.h
"

29 
	~"cÚÃùiÚpošt.h
"

30 
	~"dŸ»nd””.h
"

31 
	~"©Œibu‹s.h
"

32 
	~"widg‘s.h
"

33 
	~"mes§ge.h
"

34 
	~"´İ”t›s.h
"

36 
	~"toŞ-icÚs.h
"

38 
	#DEFAULT_WIDTH
 2.0

	)

39 
	#DEFAULT_HEIGHT
 1.0

	)

40 
	#DEFAULT_BORDER
 0.25

	)

42 
	#NUM_CONNECTIONS
 9

	)

45 
	mFREE_ASPECT
,

46 
	mFIXED_ASPECT
,

47 
	mSQUARE_ASPECT


48 } 
	tA¥eùTy³
;

50 
_Box
 
	tBox
;

52 
	s_Box
 {

53 
EËm’t
 
	m–em’t
;

55 
CÚÃùiÚPošt
 
	mcÚÃùiÚs
[
NUM_CONNECTIONS
];

57 
»®
 
	mbÜd”_width
;

58 
CŞÜ
 
	mbÜd”_cŞÜ
;

59 
CŞÜ
 
	mšÃr_cŞÜ
;

60 
gboŞ—n
 
	mshow_background
;

61 
LšeStyË
 
	mlše_¡yË
;

62 
»®
 
	mdashËngth
;

63 
»®
 
	mcÜÃr_¿dius
;

64 
A¥eùTy³
 
	ma¥eù
;

67 
	s_BoxPrİ”t›s
 {

68 
gboŞ—n
 
	mshow_background
;

69 
»®
 
	mcÜÃr_¿dius
;

70 
A¥eùTy³
 
	ma¥eù
;

71 } 
	gdeçuÉ_´İ”t›s
 = { 
TRUE
, 0.0 };

73 
»®
 
box_di¡ªû_äom
(
Box
 *
box
, 
Pošt
 *
pošt
);

74 
box_£Ëù
(
Box
 *
box
, 
Pošt
 *
şicked_pošt
,

75 
DŸR’d””
 *
š‹¿ùive_»nd””
);

76 
ObjeùChªge
* 
box_move_hªdË
(
Box
 *
box
, 
HªdË
 *
hªdË
,

77 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

78 
HªdËMoveR—sÚ
 
»asÚ
,

79 
Modif›rKeys
 
modif›rs
);

80 
ObjeùChªge
* 
box_move
(
Box
 *
box
, 
Pošt
 *
to
);

81 
box_d¿w
(
Box
 *
box
, 
DŸR’d””
 *
»nd””
);

82 
box_upd©e_d©a
(
Box
 *
box
);

83 
DŸObjeù
 *
box_ü—‹
(
Pošt
 *
¡¬ošt
,

84 *
u£r_d©a
,

85 
HªdË
 **
hªdË1
,

86 
HªdË
 **
hªdË2
);

87 
box_de¡roy
(
Box
 *
box
);

88 
DŸObjeù
 *
box_cİy
(
Box
 *
box
);

90 
PrİDesütiÚ
 *
box_desüibe_´İs
(
Box
 *
box
);

91 
box_g‘_´İs
(
Box
 *
box
, 
GPŒA¼ay
 *
´İs
);

92 
box_£t_´İs
(
Box
 *
box
, 
GPŒA¼ay
 *
´İs
);

94 
box_§ve
(
Box
 *
box
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
);

95 
DŸObjeù
 *
box_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
);

96 
DŸM’u
 *
box_g‘_objeù_m’u
(
Box
 *
box
, 
Pošt
 *
şickedpošt
);

98 
ObjeùTy³Ops
 
	gbox_ty³_İs
 =

100 (
C»©eFunc
è
box_ü—‹
,

101 (
LßdFunc
è
box_lßd
,

102 (
SaveFunc
è
box_§ve
,

103 (
G‘DeçuÉsFunc
è
NULL
,

104 (
AµlyDeçuÉsFunc
è
NULL


107 
DŸObjeùTy³
 
	gbox_ty³
 =

111 (**è
box_icÚ
,

113 &
box_ty³_İs


116 
DŸObjeùTy³
 *
	g_box_ty³
 = (DŸObjeùTy³ *è&
box_ty³
;

118 
ObjeùOps
 
	gbox_İs
 = {

119 (
De¡royFunc
è
box_de¡roy
,

120 (
D¿wFunc
è
box_d¿w
,

121 (
Di¡ªûFunc
è
box_di¡ªû_äom
,

122 (
S–eùFunc
è
box_£Ëù
,

123 (
CİyFunc
è
box_cİy
,

124 (
MoveFunc
è
box_move
,

125 (
MoveHªdËFunc
è
box_move_hªdË
,

126 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

127 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

128 (
ObjeùM’uFunc
è
box_g‘_objeù_m’u
,

129 (
DesüibePrİsFunc
è
box_desüibe_´İs
,

130 (
G‘PrİsFunc
è
box_g‘_´İs
,

131 (
S‘PrİsFunc
è
box_£t_´İs
,

132 (
TextEd™Func
) 0,

133 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

136 
PrİNumD©a
 
	gcÜÃr_¿dius_d©a
 = { 0.0, 10.0, 0.1 };

138 
PrİEnumD©a
 
	g´İ_a¥eù_d©a
[] = {

139 { 
N_
("F»e"), 
FREE_ASPECT
 },

140 { 
N_
("Fixed"), 
FIXED_ASPECT
 },

141 { 
N_
("Squ¬e"), 
SQUARE_ASPECT
 },

142 { 
NULL
, 0 }

144 
PrİDesütiÚ
 
	gbox_´İs
[] = {

145 
ELEMENT_COMMON_PROPERTIES
,

146 
PROP_STD_LINE_WIDTH
,

147 
PROP_STD_LINE_COLOUR
,

148 
PROP_STD_FILL_COLOUR
,

149 
PROP_STD_SHOW_BACKGROUND
,

150 
PROP_STD_LINE_STYLE
,

151 { "cÜÃr_¿dius", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

152 
N_
("CÜÃ¸¿dius"), 
NULL
, &
cÜÃr_¿dius_d©a
 },

153 { "a¥eù", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
,

154 
N_
("A¥eù„©io"), 
NULL
, 
´İ_a¥eù_d©a
 },

155 
PROP_DESC_END


158 
PrİDesütiÚ
 *

159 
	$box_desüibe_´İs
(
Box
 *
box
)

161 ià(
box_´İs
[0].
qu¬k
 == 0)

162 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
box_´İs
);

163  
box_´İs
;

164 
	}
}

166 
PrİOff£t
 
	gbox_off£ts
[] = {

167 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

168 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Box
, 
bÜd”_width
) },

169 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Box
, 
bÜd”_cŞÜ
) },

170 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Box
, 
šÃr_cŞÜ
) },

171 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
Box
, 
show_background
) },

172 { "a¥eù", 
PROP_TYPE_ENUM
, 
off£tof
(
Box
, 
a¥eù
) },

173 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

174 
off£tof
(
Box
, 
lše_¡yË
), off£tof(Box, 
dashËngth
) },

175 { "cÜÃr_¿dius", 
PROP_TYPE_REAL
, 
off£tof
(
Box
, 
cÜÃr_¿dius
) },

176 { 
NULL
, 0, 0 }

180 
	$box_g‘_´İs
(
Box
 *
box
, 
GPŒA¼ay
 *
´İs
)

182 
	`objeù_g‘_´İs_äom_off£ts
(&
box
->
–em’t
.
objeù
,

183 
box_off£ts
, 
´İs
);

184 
	}
}

187 
	$box_£t_´İs
(
Box
 *
box
, 
GPŒA¼ay
 *
´İs
)

189 
	`objeù_£t_´İs_äom_off£ts
(&
box
->
–em’t
.
objeù
,

190 
box_off£ts
, 
´İs
);

191 
	`box_upd©e_d©a
(
box
);

192 
	}
}

194 
»®


195 
	$box_di¡ªû_äom
(
Box
 *
box
, 
Pošt
 *
pošt
)

197 
EËm’t
 *
–em
 = &
box
->
–em’t
;

198 
ReùªgË
 
»ù
;

200 
»ù
.
Ëá
 = 
–em
->
cÜÃr
.
x
 - 
box
->
bÜd”_width
/2;

201 
»ù
.
right
 = 
–em
->
cÜÃr
.
x
 +ƒËm->
width
 + 
box
->
bÜd”_width
/2;

202 
»ù
.
tİ
 = 
–em
->
cÜÃr
.
y
 - 
box
->
bÜd”_width
/2;

203 
»ù
.
bÙtom
 = 
–em
->
cÜÃr
.
y
 +ƒËm->
height
 + 
box
->
bÜd”_width
/2;

204  
	`di¡ªû_»ùªgË_pošt
(&
»ù
, 
pošt
);

205 
	}
}

208 
	$box_£Ëù
(
Box
 *
box
, 
Pošt
 *
şicked_pošt
,

209 
DŸR’d””
 *
š‹¿ùive_»nd””
)

211 
»®
 
¿dius
;

213 
	`–em’t_upd©e_hªdËs
(&
box
->
–em’t
);

215 ià(
box
->
cÜÃr_¿dius
 > 0) {

216 
EËm’t
 *
–em
 = (EËm’ˆ*)
box
;

217 
¿dius
 = 
box
->
cÜÃr_¿dius
;

218 
¿dius
 = 
	`MIN
Ôadius, 
–em
->
width
/2);

219 
¿dius
 = 
	`MIN
Ôadius, 
–em
->
height
/2);

220 
¿dius
 *ğ(1-
M_SQRT1_2
);

222 
–em
->
»size_hªdËs
[0].
pos
.
x
 +ğ
¿dius
;

223 
–em
->
»size_hªdËs
[0].
pos
.
y
 +ğ
¿dius
;

224 
–em
->
»size_hªdËs
[2].
pos
.
x
 -ğ
¿dius
;

225 
–em
->
»size_hªdËs
[2].
pos
.
y
 +ğ
¿dius
;

226 
–em
->
»size_hªdËs
[5].
pos
.
x
 +ğ
¿dius
;

227 
–em
->
»size_hªdËs
[5].
pos
.
y
 -ğ
¿dius
;

228 
–em
->
»size_hªdËs
[7].
pos
.
x
 -ğ
¿dius
;

229 
–em
->
»size_hªdËs
[7].
pos
.
y
 -ğ
¿dius
;

231 
	}
}

233 
ObjeùChªge
*

234 
	$box_move_hªdË
(
Box
 *
box
, 
HªdË
 *
hªdË
,

235 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

236 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

238 
	`as£¹
(
box
!=
NULL
);

239 
	`as£¹
(
hªdË
!=
NULL
);

240 
	`as£¹
(
to
!=
NULL
);

242 ià(
box
->
a¥eù
 !ğ
FREE_ASPECT
){

243 
width
, 
height
;

244 
Ãw_width
, 
Ãw_height
;

245 
to_width
, 
a¥eù_width
;

246 
Pošt
 
cÜÃr
 = 
box
->
–em’t
.corner;

247 
Pošt
 
£_to
;

249 
width
 = 
box
->
–em’t
.width;

250 
height
 = 
box
->
–em’t
.height;

251 
hªdË
->
id
) {

252 
HANDLE_RESIZE_N
:

253 
HANDLE_RESIZE_S
:

254 
Ãw_height
 = 
	`çbs
(
to
->
y
 - 
cÜÃr
.y);

255 
Ãw_width
 = 
Ãw_height
 / 
height
 * 
width
;

257 
HANDLE_RESIZE_W
:

258 
HANDLE_RESIZE_E
:

259 
Ãw_width
 = 
	`çbs
(
to
->
x
 - 
cÜÃr
.x);

260 
Ãw_height
 = 
Ãw_width
 / 
width
 * 
height
;

262 
HANDLE_RESIZE_NW
:

263 
HANDLE_RESIZE_NE
:

264 
HANDLE_RESIZE_SW
:

265 
HANDLE_RESIZE_SE
:

266 
to_width
 = 
	`çbs
(
to
->
x
 - 
cÜÃr
.x);

267 
a¥eù_width
 = 
	`çbs
(
to
->
y
 - 
cÜÃr
.yè/ 
height
 * 
width
;

268 
Ãw_width
 = 
to_width
 > 
a¥eù_width
 ?o_width :‡spect_width;

269 
Ãw_height
 = 
Ãw_width
 / 
width
 * 
height
;

272 
Ãw_width
 = 
width
;

273 
Ãw_height
 = 
height
;

277 
£_to
.
x
 = 
cÜÃr
.x + 
Ãw_width
;

278 
£_to
.
y
 = 
cÜÃr
.y + 
Ãw_height
;

280 
	`–em’t_move_hªdË
(&
box
->
–em’t
, 
HANDLE_RESIZE_SE
, &
£_to
, 
ı
, 
»asÚ
, 
modif›rs
);

282 
	`–em’t_move_hªdË
(&
box
->
–em’t
, 
hªdË
->
id
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

285 
	`box_upd©e_d©a
(
box
);

287  
NULL
;

288 
	}
}

290 
ObjeùChªge
*

291 
	$box_move
(
Box
 *
box
, 
Pošt
 *
to
)

293 
box
->
–em’t
.
cÜÃr
 = *
to
;

295 
	`box_upd©e_d©a
(
box
);

297  
NULL
;

298 
	}
}

301 
	$box_d¿w
(
Box
 *
box
, 
DŸR’d””
 *
»nd””
)

303 
Pošt
 
Ì_cÜÃr
;

304 
EËm’t
 *
–em
;

305 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

308 
	`as£¹
(
box
 !ğ
NULL
);

309 
	`as£¹
(
»nd””
 !ğ
NULL
);

311 
–em
 = &
box
->
–em’t
;

313 
Ì_cÜÃr
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

314 
Ì_cÜÃr
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

316 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
box
->
bÜd”_width
);

317 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
box
->
lše_¡yË
);

318 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
box
->
dashËngth
);

319 ià(
box
->
cÜÃr_¿dius
 > 0)

320 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_ROUND
);

322 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_MITER
);

324 ià(
box
->
show_background
) {

325 
»nd””_İs
->
	`£t_fl¡yË
(
»nd””
, 
FILLSTYLE_SOLID
);

328 ià(
box
->
cÜÃr_¿dius
 > 0) {

329 
»nd””_İs
->
	`fl_rounded_»ù
(
»nd””
,

330 &
–em
->
cÜÃr
,

331 &
Ì_cÜÃr
,

332 &
box
->
šÃr_cŞÜ
,

333 
box
->
cÜÃr_¿dius
);

335 
»nd””_İs
->
	`fl_»ù
(
»nd””
,

336 &
–em
->
cÜÃr
,

337 &
Ì_cÜÃr
,

338 &
box
->
šÃr_cŞÜ
);

342 ià(
box
->
cÜÃr_¿dius
 > 0) {

343 
»nd””_İs
->
	`d¿w_rounded_»ù
(
»nd””
,

344 &
–em
->
cÜÃr
,

345 &
Ì_cÜÃr
,

346 &
box
->
bÜd”_cŞÜ
,

347 
box
->
cÜÃr_¿dius
);

349 
»nd””_İs
->
	`d¿w_»ù
(
»nd””
,

350 &
–em
->
cÜÃr
,

351 &
Ì_cÜÃr
,

352 &
box
->
bÜd”_cŞÜ
);

354 
	}
}

358 
	$box_upd©e_d©a
(
Box
 *
box
)

360 
EËm’t
 *
–em
 = &
box
->
–em’t
;

361 
EËm’tBBExŒas
 *
exŒa
 = &
–em
->
exŒa_¥acšg
;

362 
DŸObjeù
 *
obj
 = &
–em
->
objeù
;

363 
»®
 
¿dius
;

365 ià(
box
->
a¥eù
 =ğ
SQUARE_ASPECT
){

366 
size
 = 
–em
->
height
 <ƒËm->
width
 ?ƒlem->height :ƒlem->width;

367 
–em
->
height
 =ƒËm->
width
 = 
size
;

370 
¿dius
 = 
box
->
cÜÃr_¿dius
;

371 
¿dius
 = 
	`MIN
Ôadius, 
–em
->
width
/2);

372 
¿dius
 = 
	`MIN
Ôadius, 
–em
->
height
/2);

373 
¿dius
 *ğ(1-
M_SQRT1_2
);

376 
box
->
cÚÃùiÚs
[0].
pos
.
x
 = 
–em
->
cÜÃr
.x + 
¿dius
;

377 
box
->
cÚÃùiÚs
[0].
pos
.
y
 = 
–em
->
cÜÃr
.y + 
¿dius
;

378 
box
->
cÚÃùiÚs
[1].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

379 
box
->
cÚÃùiÚs
[1].
pos
.
y
 = 
–em
->
cÜÃr
.y;

380 
box
->
cÚÃùiÚs
[2].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 - 
¿dius
;

381 
box
->
cÚÃùiÚs
[2].
pos
.
y
 = 
–em
->
cÜÃr
.y + 
¿dius
;

382 
box
->
cÚÃùiÚs
[3].
pos
.
x
 = 
–em
->
cÜÃr
.x;

383 
box
->
cÚÃùiÚs
[3].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

384 
box
->
cÚÃùiÚs
[4].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

385 
box
->
cÚÃùiÚs
[4].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

386 
box
->
cÚÃùiÚs
[5].
pos
.
x
 = 
–em
->
cÜÃr
.x + 
¿dius
;

387 
box
->
cÚÃùiÚs
[5].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 - 
¿dius
;

388 
box
->
cÚÃùiÚs
[6].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

389 
box
->
cÚÃùiÚs
[6].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

390 
box
->
cÚÃùiÚs
[7].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 - 
¿dius
;

391 
box
->
cÚÃùiÚs
[7].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 - 
¿dius
;

392 
box
->
cÚÃùiÚs
[8].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

393 
box
->
cÚÃùiÚs
[8].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

395 
box
->
cÚÃùiÚs
[0].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_WEST
;

396 
box
->
cÚÃùiÚs
[1].
dœeùiÚs
 = 
DIR_NORTH
;

397 
box
->
cÚÃùiÚs
[2].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_EAST
;

398 
box
->
cÚÃùiÚs
[3].
dœeùiÚs
 = 
DIR_WEST
;

399 
box
->
cÚÃùiÚs
[4].
dœeùiÚs
 = 
DIR_EAST
;

400 
box
->
cÚÃùiÚs
[5].
dœeùiÚs
 = 
DIR_SOUTH
|
DIR_WEST
;

401 
box
->
cÚÃùiÚs
[6].
dœeùiÚs
 = 
DIR_SOUTH
;

402 
box
->
cÚÃùiÚs
[7].
dœeùiÚs
 = 
DIR_SOUTH
|
DIR_EAST
;

403 
box
->
cÚÃùiÚs
[8].
dœeùiÚs
 = 
DIR_ALL
;

405 
exŒa
->
bÜd”_Œªs
 = 
box
->
bÜd”_width
 / 2.0;

406 
	`–em’t_upd©e_boundšgbox
(
–em
);

408 
obj
->
pos™iÚ
 = 
–em
->
cÜÃr
;

410 
	`–em’t_upd©e_hªdËs
(
–em
);

412 ià(
¿dius
 > 0.0) {

414 
–em
->
»size_hªdËs
[0].
pos
.
x
 +ğ
¿dius
;

415 
–em
->
»size_hªdËs
[0].
pos
.
y
 +ğ
¿dius
;

416 
–em
->
»size_hªdËs
[2].
pos
.
x
 -ğ
¿dius
;

417 
–em
->
»size_hªdËs
[2].
pos
.
y
 +ğ
¿dius
;

418 
–em
->
»size_hªdËs
[5].
pos
.
x
 +ğ
¿dius
;

419 
–em
->
»size_hªdËs
[5].
pos
.
y
 -ğ
¿dius
;

420 
–em
->
»size_hªdËs
[7].
pos
.
x
 -ğ
¿dius
;

421 
–em
->
»size_hªdËs
[7].
pos
.
y
 -ğ
¿dius
;

423 
	}
}

425 
DŸObjeù
 *

426 
	$box_ü—‹
(
Pošt
 *
¡¬ošt
,

427 *
u£r_d©a
,

428 
HªdË
 **
hªdË1
,

429 
HªdË
 **
hªdË2
)

431 
Box
 *
box
;

432 
EËm’t
 *
–em
;

433 
DŸObjeù
 *
obj
;

434 
i
;

436 
box
 = 
	`g_m®loc0
((
Box
));

437 
–em
 = &
box
->
–em’t
;

438 
obj
 = &
–em
->
objeù
;

440 
obj
->
ty³
 = &
box_ty³
;

442 
obj
->
İs
 = &
box_İs
;

444 
–em
->
cÜÃr
 = *
¡¬ošt
;

445 
–em
->
width
 = 
DEFAULT_WIDTH
;

446 
–em
->
height
 = 
DEFAULT_HEIGHT
;

448 
box
->
bÜd”_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

449 
box
->
bÜd”_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

450 
box
->
šÃr_cŞÜ
 = 
	`©Œibu‹s_g‘_background
();

451 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
box
->
lše_¡yË
, &box->
dashËngth
);

453 
box
->
show_background
 = 
deçuÉ_´İ”t›s
.show_background;

454 
box
->
cÜÃr_¿dius
 = 
deçuÉ_´İ”t›s
.corner_radius;

455 
box
->
a¥eù
 = 
deçuÉ_´İ”t›s
.aspect;

457 
	`–em’t_š™
(
–em
, 8, 
NUM_CONNECTIONS
);

459 
i
=0;i<
NUM_CONNECTIONS
;i++) {

460 
obj
->
cÚÃùiÚs
[
i
] = &
box
->connections[i];

461 
box
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

462 
box
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

464 
box
->
cÚÃùiÚs
[8].
æags
 = 
CP_FLAGS_MAIN
;

466 
	`box_upd©e_d©a
(
box
);

468 *
hªdË1
 = 
NULL
;

469 *
hªdË2
 = 
obj
->
hªdËs
[7];

470  &
box
->
–em’t
.
objeù
;

471 
	}
}

474 
	$box_de¡roy
(
Box
 *
box
)

476 
	`–em’t_de¡roy
(&
box
->
–em’t
);

477 
	}
}

479 
DŸObjeù
 *

480 
	$box_cİy
(
Box
 *
box
)

482 
i
;

483 
Box
 *
Ãwbox
;

484 
EËm’t
 *
–em
, *
Ãw–em
;

485 
DŸObjeù
 *
Ãwobj
;

487 
–em
 = &
box
->
–em’t
;

489 
Ãwbox
 = 
	`g_m®loc0
((
Box
));

490 
Ãw–em
 = &
Ãwbox
->
–em’t
;

491 
Ãwobj
 = &
Ãw–em
->
objeù
;

493 
	`–em’t_cİy
(
–em
, 
Ãw–em
);

495 
Ãwbox
->
bÜd”_width
 = 
box
->border_width;

496 
Ãwbox
->
bÜd”_cŞÜ
 = 
box
->border_color;

497 
Ãwbox
->
šÃr_cŞÜ
 = 
box
->inner_color;

498 
Ãwbox
->
show_background
 = 
box
->show_background;

499 
Ãwbox
->
lše_¡yË
 = 
box
->line_style;

500 
Ãwbox
->
dashËngth
 = 
box
->dashlength;

501 
Ãwbox
->
cÜÃr_¿dius
 = 
box
->corner_radius;

502 
Ãwbox
->
a¥eù
 = 
box
->aspect;

504 
i
=0;i<
NUM_CONNECTIONS
;i++) {

505 
Ãwobj
->
cÚÃùiÚs
[
i
] = &
Ãwbox
->connections[i];

506 
Ãwbox
->
cÚÃùiÚs
[
i
].
objeù
 = 
Ãwobj
;

507 
Ãwbox
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

508 
Ãwbox
->
cÚÃùiÚs
[
i
].
pos
 = 
box
->connections[i].pos;

509 
Ãwbox
->
cÚÃùiÚs
[
i
].
Ï¡_pos
 = 
box
->connections[i].last_pos;

510 
Ãwbox
->
cÚÃùiÚs
[
i
].
æags
 = 
box
->connections[i].flags;

513  &
Ãwbox
->
–em’t
.
objeù
;

514 
	}
}

517 
	$box_§ve
(
Box
 *
box
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
)

519 
	`–em’t_§ve
(&
box
->
–em’t
, 
obj_node
);

521 ià(
box
->
bÜd”_width
 != 0.1)

522 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "border_width"),

523 
box
->
bÜd”_width
);

525 ià(!
	`cŞÜ_equ®s
(&
box
->
bÜd”_cŞÜ
, &
cŞÜ_bÏck
))

526 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "border_color"),

527 &
box
->
bÜd”_cŞÜ
);

529 ià(!
	`cŞÜ_equ®s
(&
box
->
šÃr_cŞÜ
, &
cŞÜ_wh™e
))

530 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "inner_color"),

531 &
box
->
šÃr_cŞÜ
);

533 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
obj_node
, "show_background"), 
box
->
show_background
);

535 ià(
box
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
)

536 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

537 
box
->
lše_¡yË
);

539 ià(
box
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
 &&

540 
box
->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

541 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

542 
box
->
dashËngth
);

544 ià(
box
->
cÜÃr_¿dius
 > 0.0)

545 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "corner_radius"),

546 
box
->
cÜÃr_¿dius
);

548 ià(
box
->
a¥eù
 !ğ
FREE_ASPECT
)

549 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "aspect"),

550 
box
->
a¥eù
);

551 
	}
}

553 
DŸObjeù
 *

554 
	$box_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

556 
Box
 *
box
;

557 
EËm’t
 *
–em
;

558 
DŸObjeù
 *
obj
;

559 
i
;

560 
A‰ribu‹Node
 
©Œ
;

562 
box
 = 
	`g_m®loc0
((
Box
));

563 
–em
 = &
box
->
–em’t
;

564 
obj
 = &
–em
->
objeù
;

566 
obj
->
ty³
 = &
box_ty³
;

567 
obj
->
İs
 = &
box_İs
;

569 
	`–em’t_lßd
(
–em
, 
obj_node
);

571 
box
->
bÜd”_width
 = 0.1;

572 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "border_width");

573 ià(
©Œ
 !ğ
NULL
)

574 
box
->
bÜd”_width
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

576 
box
->
bÜd”_cŞÜ
 = 
cŞÜ_bÏck
;

577 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "border_color");

578 ià(
©Œ
 !ğ
NULL
)

579 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
box
->
bÜd”_cŞÜ
);

581 
box
->
šÃr_cŞÜ
 = 
cŞÜ_wh™e
;

582 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "inner_color");

583 ià(
©Œ
 !ğ
NULL
)

584 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
box
->
šÃr_cŞÜ
);

586 
box
->
show_background
 = 
TRUE
;

587 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "show_background");

588 ià(
©Œ
 !ğ
NULL
)

589 
box
->
show_background
 = 
	`d©a_boŞ—n
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

591 
box
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

592 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

593 ià(
©Œ
 !ğ
NULL
)

594 
box
->
lše_¡yË
 = 
	`d©a_’um
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

596 
box
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

597 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

598 ià(
©Œ
 !ğ
NULL
)

599 
box
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

601 
box
->
cÜÃr_¿dius
 = 0.0;

602 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "corner_radius");

603 ià(
©Œ
 !ğ
NULL
)

604 
box
->
cÜÃr_¿dius
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

606 
box
->
a¥eù
 = 
FREE_ASPECT
;

607 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "aspect");

608 ià(
©Œ
 !ğ
NULL
)

609 
box
->
a¥eù
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

611 
	`–em’t_š™
(
–em
, 8, 
NUM_CONNECTIONS
);

613 
i
=0;i<
NUM_CONNECTIONS
;i++) {

614 
obj
->
cÚÃùiÚs
[
i
] = &
box
->connections[i];

615 
box
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

616 
box
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

618 
box
->
cÚÃùiÚs
[8].
æags
 = 
CP_FLAGS_MAIN
;

620 
	`box_upd©e_d©a
(
box
);

622  &
box
->
–em’t
.
objeù
;

623 
	}
}

626 
	sA¥eùChªge
 {

627 
ObjeùChªge
 
	mobj_chªge
;

628 
A¥eùTy³
 
	mŞd_ty³
, 
	mÃw_ty³
;

632 
Pošt
 
	mtİËá
;

633 
»®
 
	mwidth
, 
	mheight
;

637 
	$a¥eù_chªge_ä“
(
A¥eùChªge
 *
chªge
)

639 
	}
}

642 
	$a¥eù_chªge_­¶y
(
A¥eùChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

644 
Box
 *
box
 = (Box*)
obj
;

646 
box
->
a¥eù
 = 
chªge
->
Ãw_ty³
;

647 
	`box_upd©e_d©a
(
box
);

648 
	}
}

651 
	$a¥eù_chªge_»v”t
(
A¥eùChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

653 
Box
 *
box
 = (Box*)
obj
;

655 
box
->
a¥eù
 = 
chªge
->
Şd_ty³
;

656 
box
->
–em’t
.
cÜÃr
 = 
chªge
->
tİËá
;

657 
box
->
–em’t
.
width
 = 
chªge
->width;

658 
box
->
–em’t
.
height
 = 
chªge
->height;

659 
	`box_upd©e_d©a
(
box
);

660 
	}
}

662 
ObjeùChªge
 *

663 
	$a¥eù_ü—‹_chªge
(
Box
 *
box
, 
A¥eùTy³
 
a¥eù
)

665 
A¥eùChªge
 *
chªge
;

667 
chªge
 = 
	`g_Ãw0
(
A¥eùChªge
, 1);

669 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
a¥eù_chªge_­¶y
;

670 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
a¥eù_chªge_»v”t
;

671 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
a¥eù_chªge_ä“
;

673 
chªge
->
Şd_ty³
 = 
box
->
a¥eù
;

674 
chªge
->
Ãw_ty³
 = 
a¥eù
;

675 
chªge
->
tİËá
 = 
box
->
–em’t
.
cÜÃr
;

676 
chªge
->
width
 = 
box
->
–em’t
.width;

677 
chªge
->
height
 = 
box
->
–em’t
.height;

679  (
ObjeùChªge
 *)
chªge
;

680 
	}
}

683 
ObjeùChªge
 *

684 
	$box_£t_a¥eù_ÿÎback
 (
DŸObjeù
* 
obj
, 
Pošt
* 
şicked
, 
gpoš‹r
 
d©a
)

686 
ObjeùChªge
 *
chªge
;

688 
chªge
 = 
	`a¥eù_ü—‹_chªge
((
Box
*)
obj
, (
A¥eùTy³
)
d©a
);

689 
chªge
->
	`­¶y
(chªge, 
obj
);

691  
chªge
;

692 
	}
}

694 
DŸM’uI‹m
 
	gbox_m’u_™ems
[] = {

695 { 
N_
("F»a¥eù"), 
box_£t_a¥eù_ÿÎback
, (*)
FREE_ASPECT
,

696 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
 },

697 { 
N_
("Fixed‡¥eù"), 
box_£t_a¥eù_ÿÎback
, (*)
FIXED_ASPECT
,

698 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
 },

699 { 
N_
("Squ¬e"), 
box_£t_a¥eù_ÿÎback
, (*)
SQUARE_ASPECT
,

700 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
},

703 
DŸM’u
 
	gbox_m’u
 = {

705 (
box_m’u_™ems
)/(
DŸM’uI‹m
),

706 
box_m’u_™ems
,

707 
NULL


710 
DŸM’u
 *

711 
	$box_g‘_objeù_m’u
(
Box
 *
box
, 
Pošt
 *
şickedpošt
)

714 
box_m’u_™ems
[0].
aùive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

715 
box_m’u_™ems
[1].
aùive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

716 
box_m’u_™ems
[2].
aùive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

718 
box_m’u_™ems
[
box
->
a¥eù
].
aùive
 =

719 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
|
DIAMENU_TOGGLE_ON
;

721  &
box_m’u
;

722 
	}
}

	@O:\tool\dvs50\objects\standard\ellipse.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<as£¹.h
>

24 
	~<m©h.h
>

26 
	~"š.h
"

27 
	~"objeù.h
"

28 
	~"–em’t.h
"

29 
	~"cÚÃùiÚpošt.h
"

30 
	~"dŸ»nd””.h
"

31 
	~"©Œibu‹s.h
"

32 
	~"widg‘s.h
"

33 
	~"mes§ge.h
"

34 
	~"´İ”t›s.h
"

36 
	~"toŞ-icÚs.h
"

38 
	#DEFAULT_WIDTH
 2.0

	)

39 
	#DEFAULT_HEIGHT
 1.0

	)

40 
	#DEFAULT_BORDER
 0.15

	)

43 
	mFREE_ASPECT
,

44 
	mFIXED_ASPECT
,

45 
	mCIRCLE_ASPECT


46 } 
	tA¥eùTy³
;

48 
_EÎ£
 
	tEÎ£
;

50 
	s_EÎ£
 {

51 
EËm’t
 
	m–em’t
;

53 
CÚÃùiÚPošt
 
	mcÚÃùiÚs
[9];

54 
HªdË
 
	mûÁ”_hªdË
;

56 
»®
 
	mbÜd”_width
;

57 
CŞÜ
 
	mbÜd”_cŞÜ
;

58 
CŞÜ
 
	mšÃr_cŞÜ
;

59 
gboŞ—n
 
	mshow_background
;

60 
A¥eùTy³
 
	ma¥eù
;

61 
LšeStyË
 
	mlše_¡yË
;

62 
»®
 
	mdashËngth
;

65 
	s_EÎ£Prİ”t›s
 {

66 
A¥eùTy³
 
	ma¥eù
;

67 
gboŞ—n
 
	mshow_background
;

68 } 
	gdeçuÉ_´İ”t›s
 = { 
FREE_ASPECT
, 
TRUE
 };

70 
»®
 
–l£_di¡ªû_äom
(
EÎ£
 *
–l£
, 
Pošt
 *
pošt
);

71 
–l£_£Ëù
(
EÎ£
 *
–l£
, 
Pošt
 *
şicked_pošt
,

72 
DŸR’d””
 *
š‹¿ùive_»nd””
);

73 
ObjeùChªge
* 
–l£_move_hªdË
(
EÎ£
 *
–l£
, 
HªdË
 *
hªdË
,

74 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

75 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

76 
ObjeùChªge
* 
–l£_move
(
EÎ£
 *
–l£
, 
Pošt
 *
to
);

77 
–l£_d¿w
(
EÎ£
 *
–l£
, 
DŸR’d””
 *
»nd””
);

78 
–l£_upd©e_d©a
(
EÎ£
 *
–l£
);

79 
DŸObjeù
 *
–l£_ü—‹
(
Pošt
 *
¡¬ošt
,

80 *
u£r_d©a
,

81 
HªdË
 **
hªdË1
,

82 
HªdË
 **
hªdË2
);

83 
–l£_de¡roy
(
EÎ£
 *
–l£
);

84 
DŸObjeù
 *
–l£_cİy
(
EÎ£
 *
–l£
);

86 
PrİDesütiÚ
 *
–l£_desüibe_´İs
(
EÎ£
 *
–l£
);

87 
–l£_g‘_´İs
(
EÎ£
 *
–l£
, 
GPŒA¼ay
 *
´İs
);

88 
–l£_£t_´İs
(
EÎ£
 *
–l£
, 
GPŒA¼ay
 *
´İs
);

90 
–l£_§ve
(
EÎ£
 *
–l£
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
);

91 
DŸObjeù
 *
–l£_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
);

92 
DŸM’u
 *
–l£_g‘_objeù_m’u
(
EÎ£
 *
–l£
, 
Pošt
 *
şickedpošt
);

94 
ObjeùTy³Ops
 
	g–l£_ty³_İs
 =

96 (
C»©eFunc
è
–l£_ü—‹
,

97 (
LßdFunc
è
–l£_lßd
,

98 (
SaveFunc
è
–l£_§ve
,

99 (
G‘DeçuÉsFunc
è
NULL
,

100 (
AµlyDeçuÉsFunc
è
NULL


103 
DŸObjeùTy³
 
	g–l£_ty³
 =

107 (**è
–l£_icÚ
,

109 &
–l£_ty³_İs


112 
DŸObjeùTy³
 *
	g_–l£_ty³
 = (DŸObjeùTy³ *è&
–l£_ty³
;

114 
ObjeùOps
 
	g–l£_İs
 = {

115 (
De¡royFunc
è
–l£_de¡roy
,

116 (
D¿wFunc
è
–l£_d¿w
,

117 (
Di¡ªûFunc
è
–l£_di¡ªû_äom
,

118 (
S–eùFunc
è
–l£_£Ëù
,

119 (
CİyFunc
è
–l£_cİy
,

120 (
MoveFunc
è
–l£_move
,

121 (
MoveHªdËFunc
è
–l£_move_hªdË
,

122 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

123 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

124 (
ObjeùM’uFunc
è
–l£_g‘_objeù_m’u
,

125 (
DesüibePrİsFunc
è
–l£_desüibe_´İs
,

126 (
G‘PrİsFunc
è
–l£_g‘_´İs
,

127 (
S‘PrİsFunc
è
–l£_£t_´İs
,

128 (
TextEd™Func
) 0,

129 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

132 
PrİEnumD©a
 
	g´İ_a¥eù_d©a
[] = {

133 { 
N_
("F»e"), 
FREE_ASPECT
 },

134 { 
N_
("Fixed"), 
FIXED_ASPECT
 },

135 { 
N_
("Cœşe"), 
CIRCLE_ASPECT
 },

136 { 
NULL
, 0 }

138 
PrİDesütiÚ
 
	g–l£_´İs
[] = {

139 
ELEMENT_COMMON_PROPERTIES
,

140 
PROP_STD_LINE_WIDTH
,

141 
PROP_STD_LINE_COLOUR
,

142 
PROP_STD_FILL_COLOUR
,

143 
PROP_STD_SHOW_BACKGROUND
,

144 
PROP_STD_LINE_STYLE
,

145 { "a¥eù", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
,

146 
N_
("A¥eù„©io"), 
NULL
, 
´İ_a¥eù_d©a
 },

147 
PROP_DESC_END


150 
PrİDesütiÚ
 *

151 
	$–l£_desüibe_´İs
(
EÎ£
 *
–l£
)

153 ià(
–l£_´İs
[0].
qu¬k
 == 0)

154 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
–l£_´İs
);

155  
–l£_´İs
;

156 
	}
}

158 
PrİOff£t
 
	g–l£_off£ts
[] = {

159 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

160 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
EÎ£
, 
bÜd”_width
) },

161 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
EÎ£
, 
bÜd”_cŞÜ
) },

162 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
EÎ£
, 
šÃr_cŞÜ
) },

163 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
EÎ£
, 
show_background
) },

164 { "a¥eù", 
PROP_TYPE_ENUM
, 
off£tof
(
EÎ£
, 
a¥eù
) },

165 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

166 
off£tof
(
EÎ£
, 
lše_¡yË
), off£tof(EÎ£, 
dashËngth
) },

167 { 
NULL
, 0, 0 }

171 
	$–l£_g‘_´İs
(
EÎ£
 *
–l£
, 
GPŒA¼ay
 *
´İs
)

173 
	`objeù_g‘_´İs_äom_off£ts
(&
–l£
->
–em’t
.
objeù
,

174 
–l£_off£ts
, 
´İs
);

175 
	}
}

178 
	$–l£_£t_´İs
(
EÎ£
 *
–l£
, 
GPŒA¼ay
 *
´İs
)

181 
	`objeù_£t_´İs_äom_off£ts
(&
–l£
->
–em’t
.
objeù
,

182 
–l£_off£ts
, 
´İs
);

184 
	`–l£_upd©e_d©a
(
–l£
);

185 
	}
}

187 
»®


188 
	$–l£_di¡ªû_äom
(
EÎ£
 *
–l£
, 
Pošt
 *
pošt
)

190 
EËm’t
 *
–em
 = &
–l£
->
–em’t
;

191 
Pošt
 
ûÁ”
;

193 
ûÁ”
.
x
 = 
–em
->
cÜÃr
.x+–em->
width
/2;

194 
ûÁ”
.
y
 = 
–em
->
cÜÃr
.y+–em->
height
/2;

196  
	`di¡ªû_–l£_pošt
(&
ûÁ”
, 
–em
->
width
,ƒËm->
height
,

197 
–l£
->
bÜd”_width
, 
pošt
);

198 
	}
}

201 
	$–l£_£Ëù
(
EÎ£
 *
–l£
, 
Pošt
 *
şicked_pošt
,

202 
DŸR’d””
 *
š‹¿ùive_»nd””
)

204 
	`–em’t_upd©e_hªdËs
(&
–l£
->
–em’t
);

205 
	}
}

207 
ObjeùChªge
*

208 
	$–l£_move_hªdË
(
EÎ£
 *
–l£
, 
HªdË
 *
hªdË
,

209 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

210 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

212 
EËm’t
 *
–em
 = &
–l£
->
–em’t
;

213 
Pošt
 
nw_to
, 
£_to
;

215 
	`as£¹
(
–l£
!=
NULL
);

216 
	`as£¹
(
hªdË
!=
NULL
);

217 
	`as£¹
(
to
!=
NULL
);

219 
	`as£¹
(
hªdË
->
id
 < 8 || hªdË->id =ğ
HANDLE_CUSTOM1
);

220 ià(
hªdË
->
id
 =ğ
HANDLE_CUSTOM1
) {

221 
Pošt
 
d–
, 
cÜÃr_to
;

222 
d–
.
x
 = 
to
->x - (
–em
->
cÜÃr
.x +ƒËm->
width
/2);

223 
d–
.
y
 = 
to
->y - (
–em
->
cÜÃr
.y +ƒËm->
height
/2);

224 
cÜÃr_to
.
x
 = 
–em
->
cÜÃr
.x + 
d–
.x;

225 
cÜÃr_to
.
y
 = 
–em
->
cÜÃr
.y + 
d–
.y;

226  
	`–l£_move
(
–l£
, &
cÜÃr_to
);

228 ià(
–l£
->
a¥eù
 !ğ
FREE_ASPECT
){

229 
width
, 
height
;

230 
Ãw_width
, 
Ãw_height
;

231 
to_width
, 
a¥eù_width
;

232 
Pošt
 
ûÁ”
;

234 
width
 = 
–l£
->
–em’t
.width;

235 
height
 = 
–l£
->
–em’t
.height;

236 
ûÁ”
.
x
 = 
–em
->
cÜÃr
.x + 
width
/2;

237 
ûÁ”
.
y
 = 
–em
->
cÜÃr
.y + 
height
/2;

238 
hªdË
->
id
) {

239 
HANDLE_RESIZE_E
:

240 
HANDLE_RESIZE_W
:

241 
Ãw_width
 = 2 * 
	`çbs
(
to
->
x
 - 
ûÁ”
.x);

242 
Ãw_height
 = 
Ãw_width
 / 
width
 * 
height
;

244 
HANDLE_RESIZE_N
:

245 
HANDLE_RESIZE_S
:

246 
Ãw_height
 = 2 * 
	`çbs
(
to
->
y
 - 
ûÁ”
.y);

247 
Ãw_width
 = 
Ãw_height
 / 
height
 * 
width
;

249 
HANDLE_RESIZE_NW
:

250 
HANDLE_RESIZE_NE
:

251 
HANDLE_RESIZE_SW
:

252 
HANDLE_RESIZE_SE
:

253 
to_width
 = 2 * 
	`çbs
(
to
->
x
 - 
ûÁ”
.x);

254 
a¥eù_width
 = 2 * 
	`çbs
(
to
->
y
 - 
ûÁ”
.yè/ 
height
 * 
width
;

255 
Ãw_width
 = 
to_width
 < 
a¥eù_width
 ?o_width :‡spect_width;

256 
Ãw_height
 = 
Ãw_width
 / 
width
 * 
height
;

259 
Ãw_width
 = 
width
;

260 
Ãw_height
 = 
height
;

264 
nw_to
.
x
 = 
ûÁ”
.x - 
Ãw_width
/2;

265 
nw_to
.
y
 = 
ûÁ”
.y - 
Ãw_height
/2;

266 
£_to
.
x
 = 
ûÁ”
.x + 
Ãw_width
/2;

267 
£_to
.
y
 = 
ûÁ”
.y + 
Ãw_height
/2;

269 
	`–em’t_move_hªdË
(&
–l£
->
–em’t
, 
HANDLE_RESIZE_NW
, &
nw_to
, 
ı
, 
»asÚ
, 
modif›rs
);

270 
	`–em’t_move_hªdË
(&
–l£
->
–em’t
, 
HANDLE_RESIZE_SE
, &
£_to
, 
ı
, 
»asÚ
, 
modif›rs
);

272 
Pošt
 
ûÁ”
;

273 
Pošt
 
İpos™e_to
;

274 
ûÁ”
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
/2;

275 
ûÁ”
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
/2;

276 
İpos™e_to
.
x
 = 
ûÁ”
.x - (
to
->x-center.x);

277 
İpos™e_to
.
y
 = 
ûÁ”
.y - (
to
->y-center.y);

279 
	`–em’t_move_hªdË
(&
–l£
->
–em’t
, 
hªdË
->
id
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

283 
	`–em’t_move_hªdË
(&
–l£
->
–em’t
, 7-
hªdË
->
id
, &
İpos™e_to
, 
ı
, 
»asÚ
, 
modif›rs
);

286 
	`–l£_upd©e_d©a
(
–l£
);

288  
NULL
;

290 
	}
}

292 
ObjeùChªge
*

293 
	$–l£_move
(
EÎ£
 *
–l£
, 
Pošt
 *
to
)

295 
–l£
->
–em’t
.
cÜÃr
 = *
to
;

296 
	`–l£_upd©e_d©a
(
–l£
);

298  
NULL
;

299 
	}
}

302 
	$–l£_d¿w
(
EÎ£
 *
–l£
, 
DŸR’d””
 *
»nd””
)

304 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

305 
Pošt
 
ûÁ”
;

306 
EËm’t
 *
–em
;

308 
	`as£¹
(
–l£
 !ğ
NULL
);

309 
	`as£¹
(
»nd””
 !ğ
NULL
);

311 
–em
 = &
–l£
->
–em’t
;

313 
ûÁ”
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
/2;

314 
ûÁ”
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
/2;

316 ià(
–l£
->
show_background
) {

317 
»nd””_İs
->
	`£t_fl¡yË
(
»nd””
, 
FILLSTYLE_SOLID
);

319 
»nd””_İs
->
	`fl_–l£
(
»nd””
,

320 &
ûÁ”
,

321 
–em
->
width
,ƒËm->
height
,

322 &
–l£
->
šÃr_cŞÜ
);

325 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
–l£
->
bÜd”_width
);

326 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
–l£
->
lše_¡yË
);

327 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
–l£
->
dashËngth
);

329 
»nd””_İs
->
	`d¿w_–l£
(
»nd””
,

330 &
ûÁ”
,

331 
–em
->
width
,ƒËm->
height
,

332 &
–l£
->
bÜd”_cŞÜ
);

333 
	}
}

336 
	$–l£_upd©e_d©a
(
EÎ£
 *
–l£
)

338 
EËm’t
 *
–em
 = &
–l£
->
–em’t
;

339 
EËm’tBBExŒas
 *
exŒa
 = &
–em
->
exŒa_¥acšg
;

340 
DŸObjeù
 *
obj
 = &
–em
->
objeù
;

341 
Pošt
 
ûÁ”
;

342 
»®
 
h®f_x
, 
h®f_y
;

345 ià(
–l£
->
a¥eù
 =ğ
CIRCLE_ASPECT
){

346 
size
 = 
–em
->
height
 <ƒËm->
width
 ?ƒlem->height :ƒlem->width;

347 
–em
->
height
 =ƒËm->
width
 = 
size
;

350 
ûÁ”
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

351 
ûÁ”
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

353 
h®f_x
 = 
–em
->
width
 * 
M_SQRT1_2
 / 2.0;

354 
h®f_y
 = 
–em
->
height
 * 
M_SQRT1_2
 / 2.0;

357 
–l£
->
cÚÃùiÚs
[0].
pos
.
x
 = 
ûÁ”
.x - 
h®f_x
;

358 
–l£
->
cÚÃùiÚs
[0].
pos
.
y
 = 
ûÁ”
.y - 
h®f_y
;

359 
–l£
->
cÚÃùiÚs
[1].
pos
.
x
 = 
ûÁ”
.x;

360 
–l£
->
cÚÃùiÚs
[1].
pos
.
y
 = 
–em
->
cÜÃr
.y;

361 
–l£
->
cÚÃùiÚs
[2].
pos
.
x
 = 
ûÁ”
.x + 
h®f_x
;

362 
–l£
->
cÚÃùiÚs
[2].
pos
.
y
 = 
ûÁ”
.y - 
h®f_y
;

363 
–l£
->
cÚÃùiÚs
[3].
pos
.
x
 = 
–em
->
cÜÃr
.x;

364 
–l£
->
cÚÃùiÚs
[3].
pos
.
y
 = 
ûÁ”
.y;

365 
–l£
->
cÚÃùiÚs
[4].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

366 
–l£
->
cÚÃùiÚs
[4].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

367 
–l£
->
cÚÃùiÚs
[5].
pos
.
x
 = 
ûÁ”
.x - 
h®f_x
;

368 
–l£
->
cÚÃùiÚs
[5].
pos
.
y
 = 
ûÁ”
.y + 
h®f_y
;

369 
–l£
->
cÚÃùiÚs
[6].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

370 
–l£
->
cÚÃùiÚs
[6].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

371 
–l£
->
cÚÃùiÚs
[7].
pos
.
x
 = 
ûÁ”
.x + 
h®f_x
;

372 
–l£
->
cÚÃùiÚs
[7].
pos
.
y
 = 
ûÁ”
.y + 
h®f_y
;

373 
–l£
->
cÚÃùiÚs
[8].
pos
.
x
 = 
ûÁ”
.x;

374 
–l£
->
cÚÃùiÚs
[8].
pos
.
y
 = 
ûÁ”
.y;

377 
–l£
->
cÚÃùiÚs
[0].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_WEST
;

378 
–l£
->
cÚÃùiÚs
[1].
dœeùiÚs
 = 
DIR_NORTH
;

379 
–l£
->
cÚÃùiÚs
[2].
dœeùiÚs
 = 
DIR_NORTH
|
DIR_EAST
;

380 
–l£
->
cÚÃùiÚs
[3].
dœeùiÚs
 = 
DIR_WEST
;

381 
–l£
->
cÚÃùiÚs
[4].
dœeùiÚs
 = 
DIR_EAST
;

382 
–l£
->
cÚÃùiÚs
[5].
dœeùiÚs
 = 
DIR_SOUTH
|
DIR_WEST
;

383 
–l£
->
cÚÃùiÚs
[6].
dœeùiÚs
 = 
DIR_SOUTH
;

384 
–l£
->
cÚÃùiÚs
[7].
dœeùiÚs
 = 
DIR_SOUTH
|
DIR_EAST
;

385 
–l£
->
cÚÃùiÚs
[8].
dœeùiÚs
 = 
DIR_ALL
;

387 
exŒa
->
bÜd”_Œªs
 = 
–l£
->
bÜd”_width
 / 2.0;

388 
	`–em’t_upd©e_boundšgbox
(
–em
);

390 
obj
->
pos™iÚ
 = 
–em
->
cÜÃr
;

392 
	`–em’t_upd©e_hªdËs
(
–em
);

394 
obj
->
hªdËs
[8]->
pos
.
x
 = 
ûÁ”
.x;

395 
obj
->
hªdËs
[8]->
pos
.
y
 = 
ûÁ”
.y;

396 
	}
}

398 
DŸObjeù
 *

399 
	$–l£_ü—‹
(
Pošt
 *
¡¬ošt
,

400 *
u£r_d©a
,

401 
HªdË
 **
hªdË1
,

402 
HªdË
 **
hªdË2
)

404 
EÎ£
 *
–l£
;

405 
EËm’t
 *
–em
;

406 
DŸObjeù
 *
obj
;

407 
i
;

409 
–l£
 = 
	`g_m®loc0
((
EÎ£
));

410 
–em
 = &
–l£
->
–em’t
;

411 
obj
 = &
–em
->
objeù
;

413 
obj
->
ty³
 = &
–l£_ty³
;

415 
obj
->
İs
 = &
–l£_İs
;

417 
–em
->
cÜÃr
 = *
¡¬ošt
;

418 
–em
->
width
 = 
DEFAULT_WIDTH
;

419 
–em
->
height
 = 
DEFAULT_HEIGHT
;

421 
–l£
->
bÜd”_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

422 
–l£
->
bÜd”_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

423 
–l£
->
šÃr_cŞÜ
 = 
	`©Œibu‹s_g‘_background
();

424 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
–l£
->
lše_¡yË
,

425 &
–l£
->
dashËngth
);

426 
–l£
->
show_background
 = 
deçuÉ_´İ”t›s
.show_background;

427 
–l£
->
a¥eù
 = 
deçuÉ_´İ”t›s
.aspect;

429 
	`–em’t_š™
(
–em
, 9, 9);

431 
obj
->
hªdËs
[8] = &
–l£
->
ûÁ”_hªdË
;

432 
obj
->
hªdËs
[8]->
id
 = 
HANDLE_CUSTOM1
;

433 
obj
->
hªdËs
[8]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

434 
obj
->
hªdËs
[8]->
cÚÃùed_to
 = 
NULL
;

435 
obj
->
hªdËs
[8]->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

437 
i
=0;i<9;i++) {

438 
obj
->
cÚÃùiÚs
[
i
] = &
–l£
->connections[i];

439 
–l£
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

440 
–l£
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

442 
–l£
->
cÚÃùiÚs
[8].
æags
 = 
CP_FLAGS_MAIN
;

443 
	`–l£_upd©e_d©a
(
–l£
);

445 *
hªdË1
 = 
NULL
;

446 *
hªdË2
 = 
obj
->
hªdËs
[7];

447  &
–l£
->
–em’t
.
objeù
;

448 
	}
}

451 
	$–l£_de¡roy
(
EÎ£
 *
–l£
)

453 
	`–em’t_de¡roy
(&
–l£
->
–em’t
);

454 
	}
}

456 
DŸObjeù
 *

457 
	$–l£_cİy
(
EÎ£
 *
–l£
)

459 
i
;

460 
EÎ£
 *
Ãw–l£
;

461 
EËm’t
 *
–em
, *
Ãw–em
;

462 
DŸObjeù
 *
Ãwobj
;

464 
–em
 = &
–l£
->
–em’t
;

466 
Ãw–l£
 = 
	`g_m®loc0
((
EÎ£
));

467 
Ãw–em
 = &
Ãw–l£
->
–em’t
;

468 
Ãwobj
 = &
Ãw–em
->
objeù
;

470 
	`–em’t_cİy
(
–em
, 
Ãw–em
);

472 
Ãw–l£
->
bÜd”_width
 = 
–l£
->border_width;

473 
Ãw–l£
->
bÜd”_cŞÜ
 = 
–l£
->border_color;

474 
Ãw–l£
->
šÃr_cŞÜ
 = 
–l£
->inner_color;

475 
Ãw–l£
->
dashËngth
 = 
–l£
->dashlength;

476 
Ãw–l£
->
show_background
 = 
–l£
->show_background;

477 
Ãw–l£
->
a¥eù
 = 
–l£
->aspect;

478 
Ãw–l£
->
lše_¡yË
 = 
–l£
->line_style;

480 
Ãw–l£
->
ûÁ”_hªdË
 = 
–l£
->center_handle;

481 
Ãw–l£
->
ûÁ”_hªdË
.
cÚÃùed_to
 = 
NULL
;

482 
Ãwobj
->
hªdËs
[8] = &
Ãw–l£
->
ûÁ”_hªdË
;

484 
i
=0;i<9;i++) {

485 
Ãwobj
->
cÚÃùiÚs
[
i
] = &
Ãw–l£
->connections[i];

486 
Ãw–l£
->
cÚÃùiÚs
[
i
].
objeù
 = 
Ãwobj
;

487 
Ãw–l£
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

488 
Ãw–l£
->
cÚÃùiÚs
[
i
].
pos
 = 
–l£
->connections[i].pos;

489 
Ãw–l£
->
cÚÃùiÚs
[
i
].
Ï¡_pos
 = 
–l£
->connections[i].last_pos;

490 
Ãw–l£
->
cÚÃùiÚs
[
i
].
æags
 = 
–l£
->connections[i].flags;

493  &
Ãw–l£
->
–em’t
.
objeù
;

494 
	}
}

498 
	$–l£_§ve
(
EÎ£
 *
–l£
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
)

500 
	`–em’t_§ve
(&
–l£
->
–em’t
, 
obj_node
);

502 ià(
–l£
->
bÜd”_width
 != 0.1)

503 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "border_width"),

504 
–l£
->
bÜd”_width
);

506 ià(!
	`cŞÜ_equ®s
(&
–l£
->
bÜd”_cŞÜ
, &
cŞÜ_bÏck
))

507 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "border_color"),

508 &
–l£
->
bÜd”_cŞÜ
);

510 ià(!
	`cŞÜ_equ®s
(&
–l£
->
šÃr_cŞÜ
, &
cŞÜ_wh™e
))

511 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "inner_color"),

512 &
–l£
->
šÃr_cŞÜ
);

514 ià(!
–l£
->
show_background
)

515 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
obj_node
, "show_background"),

516 
–l£
->
show_background
);

518 ià(
–l£
->
a¥eù
 !ğ
FREE_ASPECT
)

519 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "aspect"),

520 
–l£
->
a¥eù
);

522 ià(
–l£
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
) {

523 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

524 
–l£
->
lše_¡yË
);

526 ià(
–l£
->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

527 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

528 
–l£
->
dashËngth
);

530 
	}
}

532 
DŸObjeù
 *
	$–l£_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

534 
EÎ£
 *
–l£
;

535 
EËm’t
 *
–em
;

536 
DŸObjeù
 *
obj
;

537 
i
;

538 
A‰ribu‹Node
 
©Œ
;

540 
–l£
 = 
	`g_m®loc0
((
EÎ£
));

541 
–em
 = &
–l£
->
–em’t
;

542 
obj
 = &
–em
->
objeù
;

544 
obj
->
ty³
 = &
–l£_ty³
;

545 
obj
->
İs
 = &
–l£_İs
;

547 
	`–em’t_lßd
(
–em
, 
obj_node
);

549 
–l£
->
bÜd”_width
 = 0.1;

550 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "border_width");

551 ià(
©Œ
 !ğ
NULL
)

552 
–l£
->
bÜd”_width
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

554 
–l£
->
bÜd”_cŞÜ
 = 
cŞÜ_bÏck
;

555 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "border_color");

556 ià(
©Œ
 !ğ
NULL
)

557 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
–l£
->
bÜd”_cŞÜ
);

559 
–l£
->
šÃr_cŞÜ
 = 
cŞÜ_wh™e
;

560 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "inner_color");

561 ià(
©Œ
 !ğ
NULL
)

562 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
–l£
->
šÃr_cŞÜ
);

564 
–l£
->
show_background
 = 
TRUE
;

565 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "show_background");

566 ià(
©Œ
 !ğ
NULL
)

567 
–l£
->
show_background
 = 
	`d©a_boŞ—n
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

569 
–l£
->
a¥eù
 = 
FREE_ASPECT
;

570 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "aspect");

571 ià(
©Œ
 !ğ
NULL
)

572 
–l£
->
a¥eù
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

574 
–l£
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

575 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

576 ià(
©Œ
 !ğ
NULL
)

577 
–l£
->
lše_¡yË
 = 
	`d©a_’um
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

579 
–l£
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

580 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

581 ià(
©Œ
 !ğ
NULL
)

582 
–l£
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

584 
	`–em’t_š™
(
–em
, 9, 9);

586 
obj
->
hªdËs
[8] = &
–l£
->
ûÁ”_hªdË
;

587 
obj
->
hªdËs
[8]->
id
 = 
HANDLE_CUSTOM1
;

588 
obj
->
hªdËs
[8]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

589 
obj
->
hªdËs
[8]->
cÚÃùed_to
 = 
NULL
;

590 
obj
->
hªdËs
[8]->
cÚÃù_ty³
 = 
HANDLE_NONCONNECTABLE
;

592 
i
=0;i<9;i++) {

593 
obj
->
cÚÃùiÚs
[
i
] = &
–l£
->connections[i];

594 
–l£
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

595 
–l£
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

597 
–l£
->
cÚÃùiÚs
[8].
æags
 = 
CP_FLAGS_MAIN
;

599 
	`–l£_upd©e_d©a
(
–l£
);

601  &
–l£
->
–em’t
.
objeù
;

602 
	}
}

604 
	sA¥eùChªge
 {

605 
ObjeùChªge
 
	mobj_chªge
;

606 
A¥eùTy³
 
	mŞd_ty³
, 
	mÃw_ty³
;

610 
Pošt
 
	mtİËá
;

611 
»®
 
	mwidth
, 
	mheight
;

615 
	$a¥eù_chªge_ä“
(
A¥eùChªge
 *
chªge
)

617 
	}
}

620 
	$a¥eù_chªge_­¶y
(
A¥eùChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

622 
EÎ£
 *
–l£
 = (EÎ£*)
obj
;

624 
–l£
->
a¥eù
 = 
chªge
->
Ãw_ty³
;

625 
	`–l£_upd©e_d©a
(
–l£
);

626 
	}
}

629 
	$a¥eù_chªge_»v”t
(
A¥eùChªge
 *
chªge
, 
DŸObjeù
 *
obj
)

631 
EÎ£
 *
–l£
 = (EÎ£*)
obj
;

633 
–l£
->
a¥eù
 = 
chªge
->
Şd_ty³
;

634 
–l£
->
–em’t
.
cÜÃr
 = 
chªge
->
tİËá
;

635 
–l£
->
–em’t
.
width
 = 
chªge
->width;

636 
–l£
->
–em’t
.
height
 = 
chªge
->height;

637 
	`–l£_upd©e_d©a
(
–l£
);

638 
	}
}

640 
ObjeùChªge
 *

641 
	$a¥eù_ü—‹_chªge
(
EÎ£
 *
–l£
, 
A¥eùTy³
 
a¥eù
)

643 
A¥eùChªge
 *
chªge
;

645 
chªge
 = 
	`g_Ãw0
(
A¥eùChªge
, 1);

647 
chªge
->
obj_chªge
.
­¶y
 = (
ObjeùChªgeAµlyFunc
è
a¥eù_chªge_­¶y
;

648 
chªge
->
obj_chªge
.
»v”t
 = (
ObjeùChªgeRev”tFunc
è
a¥eù_chªge_»v”t
;

649 
chªge
->
obj_chªge
.
ä“
 = (
ObjeùChªgeF»eFunc
è
a¥eù_chªge_ä“
;

651 
chªge
->
Şd_ty³
 = 
–l£
->
a¥eù
;

652 
chªge
->
Ãw_ty³
 = 
a¥eù
;

653 
chªge
->
tİËá
 = 
–l£
->
–em’t
.
cÜÃr
;

654 
chªge
->
width
 = 
–l£
->
–em’t
.width;

655 
chªge
->
height
 = 
–l£
->
–em’t
.height;

657  (
ObjeùChªge
 *)
chªge
;

658 
	}
}

661 
ObjeùChªge
 *

662 
	$–l£_£t_a¥eù_ÿÎback
 (
DŸObjeù
* 
obj
, 
Pošt
* 
şicked
, 
gpoš‹r
 
d©a
)

664 
ObjeùChªge
 *
chªge
;

666 
chªge
 = 
	`a¥eù_ü—‹_chªge
((
EÎ£
*)
obj
, (
A¥eùTy³
)
d©a
);

667 
chªge
->
	`­¶y
(chªge, 
obj
);

669  
chªge
;

670 
	}
}

672 
DŸM’uI‹m
 
	g–l£_m’u_™ems
[] = {

673 { 
N_
("F»a¥eù"), 
–l£_£t_a¥eù_ÿÎback
, (*)
FREE_ASPECT
,

674 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
 },

675 { 
N_
("Fixed‡¥eù"), 
–l£_£t_a¥eù_ÿÎback
, (*)
FIXED_ASPECT
,

676 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
 },

677 { 
N_
("Cœşe"), 
–l£_£t_a¥eù_ÿÎback
, (*)
CIRCLE_ASPECT
,

678 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
},

681 
DŸM’u
 
	g–l£_m’u
 = {

683 (
–l£_m’u_™ems
)/(
DŸM’uI‹m
),

684 
–l£_m’u_™ems
,

685 
NULL


688 
DŸM’u
 *

689 
	$–l£_g‘_objeù_m’u
(
EÎ£
 *
–l£
, 
Pošt
 *
şickedpošt
)

692 
–l£_m’u_™ems
[0].
aùive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

693 
–l£_m’u_™ems
[1].
aùive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

694 
–l£_m’u_™ems
[2].
aùive
 = 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
;

696 
–l£_m’u_™ems
[
–l£
->
a¥eù
].
aùive
 =

697 
DIAMENU_ACTIVE
|
DIAMENU_TOGGLE
|
DIAMENU_TOGGLE_ON
;

699  &
–l£_m’u
;

700 
	}
}

	@O:\tool\dvs50\objects\standard\image.c

18 
	~<cÚfig.h
>

20 
	~<as£¹.h
>

21 
	~<¡ršg.h
>

22 
	~<m©h.h
>

23 
	~<sys/¡©.h
>

24 
	~<time.h
>

25 #ifdeà
HAVE_UNIST_H


26 
	~<uni¡d.h
>

28 
	~<glib/g¡dio.h
>

30 
	~"š.h
"

31 
	~"mes§ge.h
"

32 
	~"objeù.h
"

33 
	~"–em’t.h
"

34 
	~"cÚÃùiÚpošt.h
"

35 
	~"dŸ»nd””.h
"

36 
	~"©Œibu‹s.h
"

37 
	~"widg‘s.h
"

38 
	~"dŸ_image.h
"

39 
	~"mes§ge.h
"

40 
	~"´İ”t›s.h
"

42 
	~"toŞ-icÚs.h
"

44 
	#DEFAULT_WIDTH
 2.0

	)

45 
	#DEFAULT_HEIGHT
 2.0

	)

47 
	#NUM_CONNECTIONS
 9

	)

49 
_Image
 
	tImage
;

51 
	s_Image
 {

52 
EËm’t
 
	m–em’t
;

54 
CÚÃùiÚPošt
 
	mcÚÃùiÚs
[
NUM_CONNECTIONS
];

56 
»®
 
	mbÜd”_width
;

57 
CŞÜ
 
	mbÜd”_cŞÜ
;

58 
LšeStyË
 
	mlše_¡yË
;

59 
»®
 
	mdashËngth
;

61 
DŸImage
 *
	mimage
;

62 
gch¬
 *
	mfe
;

63 
gboŞ—n
 
	md¿w_bÜd”
;

64 
gboŞ—n
 
	mk“p_a¥eù
;

66 
time_t
 
	mmtime
;

69 
	s_ImagePrİ”t›s
 {

70 
gch¬
 *
	mfe
;

71 
gboŞ—n
 
	md¿w_bÜd”
;

72 
gboŞ—n
 
	mk“p_a¥eù
;

73 } 
	gdeçuÉ_´İ”t›s
 = { "", 
FALSE
, 
TRUE
 };

75 
»®
 
image_di¡ªû_äom
(
Image
 *
image
, 
Pošt
 *
pošt
);

76 
image_£Ëù
(
Image
 *
image
, 
Pošt
 *
şicked_pošt
,

77 
DŸR’d””
 *
š‹¿ùive_»nd””
);

78 
ObjeùChªge
* 
image_move_hªdË
(
Image
 *
image
, 
HªdË
 *
hªdË
,

79 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

80 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

81 
ObjeùChªge
* 
image_move
(
Image
 *
image
, 
Pošt
 *
to
);

82 
image_d¿w
(
Image
 *
image
, 
DŸR’d””
 *
»nd””
);

83 
image_upd©e_d©a
(
Image
 *
image
);

84 
DŸObjeù
 *
image_ü—‹
(
Pošt
 *
¡¬ošt
,

85 *
u£r_d©a
,

86 
HªdË
 **
hªdË1
,

87 
HªdË
 **
hªdË2
);

88 
image_de¡roy
(
Image
 *
image
);

89 
DŸObjeù
 *
image_cİy
(
Image
 *
image
);

91 
PrİDesütiÚ
 *
image_desüibe_´İs
(
Image
 *
image
);

92 
image_g‘_´İs
(
Image
 *
image
, 
GPŒA¼ay
 *
´İs
);

93 
image_£t_´İs
(
Image
 *
image
, 
GPŒA¼ay
 *
´İs
);

95 
image_§ve
(
Image
 *
image
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
);

96 
DŸObjeù
 *
image_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
);

98 
ObjeùTy³Ops
 
	gimage_ty³_İs
 =

100 (
C»©eFunc
è
image_ü—‹
,

101 (
LßdFunc
è
image_lßd
,

102 (
SaveFunc
è
image_§ve
,

103 (
G‘DeçuÉsFunc
è
NULL
,

104 (
AµlyDeçuÉsFunc
è
NULL


107 
DŸObjeùTy³
 
	gimage_ty³
 =

111 (**è
image_icÚ
,

113 &
image_ty³_İs


116 
DŸObjeùTy³
 *
	g_image_ty³
 = (DŸObjeùTy³ *è&
image_ty³
;

118 
ObjeùOps
 
	gimage_İs
 = {

119 (
De¡royFunc
è
image_de¡roy
,

120 (
D¿wFunc
è
image_d¿w
,

121 (
Di¡ªûFunc
è
image_di¡ªû_äom
,

122 (
S–eùFunc
è
image_£Ëù
,

123 (
CİyFunc
è
image_cİy
,

124 (
MoveFunc
è
image_move
,

125 (
MoveHªdËFunc
è
image_move_hªdË
,

126 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

127 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

128 (
ObjeùM’uFunc
è
NULL
,

129 (
DesüibePrİsFunc
è
image_desüibe_´İs
,

130 (
G‘PrİsFunc
è
image_g‘_´İs
,

131 (
S‘PrİsFunc
è
image_£t_´İs
,

132 (
TextEd™Func
) 0,

133 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

136 
PrİDesütiÚ
 
	gimage_´İs
[] = {

137 
ELEMENT_COMMON_PROPERTIES
,

138 { "image_fe", 
PROP_TYPE_FILE
, 
PROP_FLAG_VISIBLE
,

139 
N_
("Imagfe"), 
NULL
, NULL},

140 { "show_bÜd”", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
,

141 
N_
("D¿w bÜd”"), 
NULL
, NULL},

142 { "k“p_a¥eù", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
,

143 
N_
("K“°a¥eù„©io"), 
NULL
, NULL},

144 
PROP_STD_LINE_WIDTH
,

145 
PROP_STD_LINE_COLOUR
,

146 
PROP_STD_LINE_STYLE
,

147 
PROP_DESC_END


150 
PrİDesütiÚ
 *

151 
	$image_desüibe_´İs
(
Image
 *
image
)

153 ià(
image_´İs
[0].
qu¬k
 == 0)

154 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
image_´İs
);

155  
image_´İs
;

156 
	}
}

158 
PrİOff£t
 
	gimage_off£ts
[] = {

159 
ELEMENT_COMMON_PROPERTIES_OFFSETS
,

160 { "image_fe", 
PROP_TYPE_FILE
, 
off£tof
(
Image
, 
fe
) },

161 { "show_bÜd”", 
PROP_TYPE_BOOL
, 
off£tof
(
Image
, 
d¿w_bÜd”
) },

162 { "k“p_a¥eù", 
PROP_TYPE_BOOL
, 
off£tof
(
Image
, 
k“p_a¥eù
) },

163 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Image
, 
bÜd”_width
) },

164 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Image
, 
bÜd”_cŞÜ
) },

165 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

166 
off£tof
(
Image
, 
lše_¡yË
), off£tof(Image, 
dashËngth
) },

167 { 
NULL
, 0, 0 }

171 
	$image_g‘_´İs
(
Image
 *
image
, 
GPŒA¼ay
 *
´İs
)

173 
	`objeù_g‘_´İs_äom_off£ts
(&
image
->
–em’t
.
objeù
, 
image_off£ts
, 
´İs
);

174 
	}
}

177 
	$image_£t_´İs
(
Image
 *
image
, 
GPŒA¼ay
 *
´İs
)

179 
¡©
 
¡
;

180 
time_t
 
mtime
 = 0;

181 *
Şd_fe
 = 
image
->
fe
 ? 
	`g_¡rdup
(image->file) : "";

183 
	`objeù_£t_´İs_äom_off£ts
(&
image
->
–em’t
.
objeù
, 
image_off£ts
, 
´İs
);

186 ià(
	`g_¡©
 (
image
->
fe
, &
¡
) != 0)

187 
mtime
 = 
image
->mtime;

189 
mtime
 = 
¡
.
¡_mtime
;

192 ià(
	`¡rcmp
(
image
->
fe
, 
Şd_fe
è!ğ0 || image->
mtime
 != mtime) {

193 
EËm’t
 *
–em
 = &
image
->
–em’t
;

194 
DŸImage
 *
img
 = 
NULL
;

196 
img
 = 
	`dŸ_image_lßd
(
image
->
fe
);

197 ià(
img
)

198 
image
->imagğ
img
;

200 
image
->imagğ
	`dŸ_image_g‘_brok’
();

201 
–em
->
height
 = (–em->
width
*()
	`dŸ_image_height
(
image
->image))/

202 ()
	`dŸ_image_width
(
image
->image);

204 
	`g_ä“
(
Şd_fe
);

206 
image
->
mtime
 = mtime;

208 
	`image_upd©e_d©a
(
image
);

209 
	}
}

211 
»®


212 
	$image_di¡ªû_äom
(
Image
 *
image
, 
Pošt
 *
pošt
)

214 
EËm’t
 *
–em
 = &
image
->
–em’t
;

215 
ReùªgË
 
»ù
;

217 
»ù
.
Ëá
 = 
–em
->
cÜÃr
.
x
 - 
image
->
bÜd”_width
;

218 
»ù
.
right
 = 
–em
->
cÜÃr
.
x
 +ƒËm->
width
 + 
image
->
bÜd”_width
;

219 
»ù
.
tİ
 = 
–em
->
cÜÃr
.
y
 - 
image
->
bÜd”_width
;

220 
»ù
.
bÙtom
 = 
–em
->
cÜÃr
.
y
 +ƒËm->
height
 + 
image
->
bÜd”_width
;

221  
	`di¡ªû_»ùªgË_pošt
(&
»ù
, 
pošt
);

222 
	}
}

225 
	$image_£Ëù
(
Image
 *
image
, 
Pošt
 *
şicked_pošt
,

226 
DŸR’d””
 *
š‹¿ùive_»nd””
)

228 
	`–em’t_upd©e_hªdËs
(&
image
->
–em’t
);

229 
	}
}

231 
ObjeùChªge
*

232 
	$image_move_hªdË
(
Image
 *
image
, 
HªdË
 *
hªdË
,

233 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

234 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

236 
EËm’t
 *
–em
 = &
image
->
–em’t
;

237 
	`as£¹
(
image
!=
NULL
);

238 
	`as£¹
(
hªdË
!=
NULL
);

239 
	`as£¹
(
to
!=
NULL
);

241 ià(
image
->
k“p_a¥eù
) {

242 
width
, 
height
;

243 
Ãw_width
, 
Ãw_height
;

244 
width
 = 
image
->
–em’t
.width;

245 
height
 = 
image
->
–em’t
.height;

247 
hªdË
->
id
) {

248 
HANDLE_RESIZE_NW
:

249 
Ãw_width
 = -(
to
->
x
-
image
->
–em’t
.
cÜÃr
.x)+
width
;

250 
Ãw_height
 = -(
to
->
y
-
image
->
–em’t
.
cÜÃr
.y)+
height
;

251 ià(
Ãw_height
 =ğ0 || 
Ãw_width
/Ãw_heighˆ> 
width
/
height
) {

252 
Ãw_height
 = 
Ãw_width
*
height
/
width
;

254 
Ãw_width
 = 
Ãw_height
*
width
/
height
;

256 
to
->
x
 = 
image
->
–em’t
.
cÜÃr
.x+(image->–em’t.
width
-
Ãw_width
);

257 
to
->
y
 = 
image
->
–em’t
.
cÜÃr
.y+(image->–em’t.
height
-
Ãw_height
);

258 
	`–em’t_move_hªdË
(
–em
, 
HANDLE_RESIZE_NW
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

260 
HANDLE_RESIZE_N
:

261 
Ãw_width
 = (-(
to
->
y
-
image
->
–em’t
.
cÜÃr
.y)+
height
)*
width
/height;

262 
to
->
x
 = 
image
->
–em’t
.
cÜÃr
.x+
Ãw_width
;

263 
	`–em’t_move_hªdË
(
–em
, 
HANDLE_RESIZE_NE
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

265 
HANDLE_RESIZE_NE
:

266 
Ãw_width
 = 
to
->
x
-
image
->
–em’t
.
cÜÃr
.x;

267 
Ãw_height
 = -(
to
->
y
-
image
->
–em’t
.
cÜÃr
.y)+
height
;

268 ià(
Ãw_height
 =ğ0 || 
Ãw_width
/Ãw_heighˆ> 
width
/
height
) {

269 
Ãw_height
 = 
Ãw_width
*
height
/
width
;

271 
Ãw_width
 = 
Ãw_height
*
width
/
height
;

273 
to
->
x
 = 
image
->
–em’t
.
cÜÃr
.x+
Ãw_width
;

274 
to
->
y
 = 
image
->
–em’t
.
cÜÃr
.y+(image->–em’t.
height
-
Ãw_height
);

275 
	`–em’t_move_hªdË
(
–em
, 
HANDLE_RESIZE_NE
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

277 
HANDLE_RESIZE_E
:

278 
Ãw_height
 = (
to
->
x
-
image
->
–em’t
.
cÜÃr
.x)*
height
/
width
;

279 
to
->
y
 = 
image
->
–em’t
.
cÜÃr
.y+
Ãw_height
;

280 
	`–em’t_move_hªdË
(
–em
, 
HANDLE_RESIZE_SE
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

282 
HANDLE_RESIZE_SE
:

283 
Ãw_width
 = 
to
->
x
-
image
->
–em’t
.
cÜÃr
.x;

284 
Ãw_height
 = 
to
->
y
-
image
->
–em’t
.
cÜÃr
.y;

285 ià(
Ãw_height
 =ğ0 || 
Ãw_width
/Ãw_heighˆ> 
width
/
height
) {

286 
Ãw_height
 = 
Ãw_width
*
height
/
width
;

288 
Ãw_width
 = 
Ãw_height
*
width
/
height
;

290 
to
->
x
 = 
image
->
–em’t
.
cÜÃr
.x+
Ãw_width
;

291 
to
->
y
 = 
image
->
–em’t
.
cÜÃr
.y+
Ãw_height
;

292 
	`–em’t_move_hªdË
(
–em
, 
HANDLE_RESIZE_SE
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

294 
HANDLE_RESIZE_S
:

295 
Ãw_width
 = (
to
->
y
-
image
->
–em’t
.
cÜÃr
.y)*
width
/
height
;

296 
to
->
x
 = 
image
->
–em’t
.
cÜÃr
.x+
Ãw_width
;

297 
	`–em’t_move_hªdË
(
–em
, 
HANDLE_RESIZE_SE
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

299 
HANDLE_RESIZE_SW
:

300 
Ãw_width
 = -(
to
->
x
-
image
->
–em’t
.
cÜÃr
.x)+
width
;

301 
Ãw_height
 = 
to
->
y
-
image
->
–em’t
.
cÜÃr
.y;

302 ià(
Ãw_height
 =ğ0 || 
Ãw_width
/Ãw_heighˆ> 
width
/
height
) {

303 
Ãw_height
 = 
Ãw_width
*
height
/
width
;

305 
Ãw_width
 = 
Ãw_height
*
width
/
height
;

307 
to
->
x
 = 
image
->
–em’t
.
cÜÃr
.x+(image->–em’t.
width
-
Ãw_width
);

308 
to
->
y
 = 
image
->
–em’t
.
cÜÃr
.y+
Ãw_height
;

309 
	`–em’t_move_hªdË
(
–em
, 
HANDLE_RESIZE_SW
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

311 
HANDLE_RESIZE_W
:

312 
Ãw_height
 = (-(
to
->
x
-
image
->
–em’t
.
cÜÃr
.x)+
width
)*
height
/width;

313 
to
->
y
 = 
image
->
–em’t
.
cÜÃr
.y+
Ãw_height
;

314 
	`–em’t_move_hªdË
(
–em
, 
HANDLE_RESIZE_SW
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

317 
	`mes§ge_w¬nšg
("Unforeseen handle in image_move_handle: %d\n",

318 
hªdË
->
id
);

322 
	`–em’t_move_hªdË
(
–em
, 
hªdË
->
id
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

324 
	`image_upd©e_d©a
(
image
);

326  
NULL
;

327 
	}
}

329 
ObjeùChªge
*

330 
	$image_move
(
Image
 *
image
, 
Pošt
 *
to
)

332 
image
->
–em’t
.
cÜÃr
 = *
to
;

334 
	`image_upd©e_d©a
(
image
);

336  
NULL
;

337 
	}
}

340 
	$image_d¿w
(
Image
 *
image
, 
DŸR’d””
 *
»nd””
)

342 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

343 
Pošt
 
ul_cÜÃr
, 
Ì_cÜÃr
;

344 
EËm’t
 *
–em
;

346 
	`as£¹
(
image
 !ğ
NULL
);

347 
	`as£¹
(
»nd””
 !ğ
NULL
);

349 
–em
 = &
image
->
–em’t
;

351 
Ì_cÜÃr
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 + 
image
->
bÜd”_width
/2;

352 
Ì_cÜÃr
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 + 
image
->
bÜd”_width
/2;

354 
ul_cÜÃr
.
x
 = 
–em
->
cÜÃr
.x - 
image
->
bÜd”_width
/2;

355 
ul_cÜÃr
.
y
 = 
–em
->
cÜÃr
.y - 
image
->
bÜd”_width
/2;

357 ià(
image
->
d¿w_bÜd”
) {

358 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
image
->
bÜd”_width
);

359 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
image
->
lše_¡yË
);

360 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
image
->
dashËngth
);

361 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_MITER
);

363 
»nd””_İs
->
	`d¿w_»ù
(
»nd””
,

364 &
ul_cÜÃr
,

365 &
Ì_cÜÃr
,

366 &
image
->
bÜd”_cŞÜ
);

369 ià(
image
->image) {

370 
»nd””_İs
->
	`d¿w_image
(
»nd””
, &
–em
->
cÜÃr
,ƒËm->
width
,

371 
–em
->
height
, 
image
->image);

373 
DŸImage
 *
brok’
 = 
	`dŸ_image_g‘_brok’
();

374 
»nd””_İs
->
	`d¿w_image
(
»nd””
, &
–em
->
cÜÃr
,ƒËm->
width
,

375 
–em
->
height
, 
brok’
);

376 
	`dŸ_image_uÄef
(
brok’
);

378 
	}
}

381 
	$image_upd©e_d©a
(
Image
 *
image
)

383 
EËm’t
 *
–em
 = &
image
->
–em’t
;

384 
EËm’tBBExŒas
 *
exŒa
 = &
–em
->
exŒa_¥acšg
;

385 
DŸObjeù
 *
obj
 = &
–em
->
objeù
;

388 
image
->
cÚÃùiÚs
[0].
pos
 = 
–em
->
cÜÃr
;

389 
image
->
cÚÃùiÚs
[1].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

390 
image
->
cÚÃùiÚs
[1].
pos
.
y
 = 
–em
->
cÜÃr
.y;

391 
image
->
cÚÃùiÚs
[2].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

392 
image
->
cÚÃùiÚs
[2].
pos
.
y
 = 
–em
->
cÜÃr
.y;

393 
image
->
cÚÃùiÚs
[3].
pos
.
x
 = 
–em
->
cÜÃr
.x;

394 
image
->
cÚÃùiÚs
[3].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

395 
image
->
cÚÃùiÚs
[4].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

396 
image
->
cÚÃùiÚs
[4].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

397 
image
->
cÚÃùiÚs
[5].
pos
.
x
 = 
–em
->
cÜÃr
.x;

398 
image
->
cÚÃùiÚs
[5].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

399 
image
->
cÚÃùiÚs
[6].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

400 
image
->
cÚÃùiÚs
[6].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

401 
image
->
cÚÃùiÚs
[7].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
;

402 
image
->
cÚÃùiÚs
[7].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
;

403 
image
->
cÚÃùiÚs
[8].
pos
.
x
 = 
–em
->
cÜÃr
.x +ƒËm->
width
 / 2.0;

404 
image
->
cÚÃùiÚs
[8].
pos
.
y
 = 
–em
->
cÜÃr
.y +ƒËm->
height
 / 2.0;

406 
exŒa
->
bÜd”_Œªs
 = 
image
->
bÜd”_width
 / 2.0;

407 
	`–em’t_upd©e_boundšgbox
(
–em
);

409 
obj
->
pos™iÚ
 = 
–em
->
cÜÃr
;

410 
image
->
cÚÃùiÚs
[8].
dœeùiÚs
 = 
DIR_ALL
;

411 
	`–em’t_upd©e_hªdËs
(
–em
);

412 
	}
}

415 
DŸObjeù
 *

416 
	$image_ü—‹
(
Pošt
 *
¡¬ošt
,

417 *
u£r_d©a
,

418 
HªdË
 **
hªdË1
,

419 
HªdË
 **
hªdË2
)

421 
Image
 *
image
;

422 
EËm’t
 *
–em
;

423 
DŸObjeù
 *
obj
;

424 
i
;

426 
image
 = 
	`g_m®loc0
((
Image
));

427 
–em
 = &
image
->
–em’t
;

428 
obj
 = &
–em
->
objeù
;

430 
obj
->
ty³
 = &
image_ty³
;

431 
obj
->
İs
 = &
image_İs
;

433 
–em
->
cÜÃr
 = *
¡¬ošt
;

434 
–em
->
width
 = 
DEFAULT_WIDTH
;

435 
–em
->
height
 = 
DEFAULT_HEIGHT
;

437 
image
->
bÜd”_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

438 
image
->
bÜd”_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

439 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
image
->
lše_¡yË
,

440 &
image
->
dashËngth
);

442 
	`–em’t_š™
(
–em
, 8, 
NUM_CONNECTIONS
);

444 
i
=0; i<
NUM_CONNECTIONS
; i++) {

445 
obj
->
cÚÃùiÚs
[
i
] = &
image
->connections[i];

446 
image
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

447 
image
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

449 
image
->
cÚÃùiÚs
[8].
æags
 = 
CP_FLAGS_MAIN
;

451 ià(
	`¡rcmp
(
deçuÉ_´İ”t›s
.
fe
, "")) {

452 
image
->
fe
 = 
	`g_¡rdup
(
deçuÉ_´İ”t›s
.file);

453 
image
->imagğ
	`dŸ_image_lßd
(image->
fe
);

455 ià(
image
->image) {

456 
–em
->
width
 = (–em->width*()
	`dŸ_image_width
(
image
->image))/

457 ()
	`dŸ_image_height
(
image
->image);

460 
image
->
fe
 = 
	`g_¡rdup
("");

461 
image
->imagğ
NULL
;

464 
image
->
d¿w_bÜd”
 = 
deçuÉ_´İ”t›s
.draw_border;

465 
image
->
k“p_a¥eù
 = 
deçuÉ_´İ”t›s
.keep_aspect;

467 
	`image_upd©e_d©a
(
image
);

469 *
hªdË1
 = 
NULL
;

470 *
hªdË2
 = 
obj
->
hªdËs
[7];

471  &
image
->
–em’t
.
objeù
;

472 
	}
}

475 
	$image_de¡roy
(
Image
 *
image
) {

476 ià(
image
->
fe
 !ğ
NULL
)

477 
	`g_ä“
(
image
->
fe
);

479 ià(
image
->imag!ğ
NULL
)

480 
	`dŸ_image_uÄef
(
image
->image);

482 
	`–em’t_de¡roy
(&
image
->
–em’t
);

483 
	}
}

485 
DŸObjeù
 *

486 
	$image_cİy
(
Image
 *
image
)

488 
i
;

489 
Image
 *
Ãwimage
;

490 
EËm’t
 *
–em
, *
Ãw–em
;

491 
DŸObjeù
 *
Ãwobj
;

493 
–em
 = &
image
->
–em’t
;

495 
Ãwimage
 = 
	`g_m®loc0
((
Image
));

496 
Ãw–em
 = &
Ãwimage
->
–em’t
;

497 
Ãwobj
 = &
Ãw–em
->
objeù
;

499 
	`–em’t_cİy
(
–em
, 
Ãw–em
);

501 
Ãwimage
->
bÜd”_width
 = 
image
->border_width;

502 
Ãwimage
->
bÜd”_cŞÜ
 = 
image
->border_color;

503 
Ãwimage
->
lše_¡yË
 = 
image
->line_style;

505 
i
=0;i<
NUM_CONNECTIONS
;i++) {

506 
Ãwobj
->
cÚÃùiÚs
[
i
] = &
Ãwimage
->connections[i];

507 
Ãwimage
->
cÚÃùiÚs
[
i
].
objeù
 = 
Ãwobj
;

508 
Ãwimage
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

509 
Ãwimage
->
cÚÃùiÚs
[
i
].
pos
 = 
image
->connections[i].pos;

510 
Ãwimage
->
cÚÃùiÚs
[
i
].
Ï¡_pos
 = 
image
->connections[i].last_pos;

511 
Ãwimage
->
cÚÃùiÚs
[
i
].
æags
 = 
image
->connections[i].flags;

514 
Ãwimage
->
fe
 = 
	`g_¡rdup
(
image
->file);

515 ià(
image
->image)

516 
	`dŸ_image_add_»f
(
image
->image);

517 
Ãwimage
->
image
 = image->image;

519 
Ãwimage
->
d¿w_bÜd”
 = 
image
->draw_border;

520 
Ãwimage
->
k“p_a¥eù
 = 
image
->keep_aspect;

522  &
Ãwimage
->
–em’t
.
objeù
;

523 
	}
}

533 
	$g‘_dœeùÜy
(cÚ¡ *
f’ame
)

535 *
cwd
;

536 *
dœeùÜy
;

537 *
dœÇme
;

539 ià(
f’ame
==
NULL
)

540  
NULL
;

542 
dœÇme
 = 
	`g_·th_g‘_dœÇme
(
f’ame
);

543 ià(
	`g_·th_is_absŞu‹
(
dœÇme
)) {

544 
dœeùÜy
 = 
	`g_bud_·th
(
G_DIR_SEPARATOR_S
, 
dœÇme
, 
NULL
);

546 
cwd
 = 
	`g_g‘_cu¼’t_dœ
();

547 
dœeùÜy
 = 
	`g_bud_·th
(
G_DIR_SEPARATOR_S
, 
cwd
, 
dœÇme
, 
NULL
);

548 
	`g_ä“
(
cwd
);

550 
	`g_ä“
(
dœÇme
);

552  
dœeùÜy
;

553 
	}
}

556 
	$image_§ve
(
Image
 *
image
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
)

558 *
dŸfe_dœ
;

560 
	`–em’t_§ve
(&
image
->
–em’t
, 
obj_node
);

562 ià(
image
->
bÜd”_width
 != 0.1)

563 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "border_width"),

564 
image
->
bÜd”_width
);

566 ià(!
	`cŞÜ_equ®s
(&
image
->
bÜd”_cŞÜ
, &
cŞÜ_bÏck
))

567 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "border_color"),

568 &
image
->
bÜd”_cŞÜ
);

570 ià(
image
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
)

571 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

572 
image
->
lše_¡yË
);

574 ià(
image
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
 &&

575 
image
->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

576 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

577 
image
->
dashËngth
);

579 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
obj_node
, "d¿w_bÜd”"), 
image
->
d¿w_bÜd”
);

580 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
obj_node
, "k“p_a¥eù"), 
image
->
k“p_a¥eù
);

582 ià(
image
->
fe
 !ğ
NULL
) {

583 ià(
	`g_·th_is_absŞu‹
(
image
->
fe
)) {

584 
dŸfe_dœ
 = 
	`g‘_dœeùÜy
(
f’ame
);

586 ià(
	`¡ºcmp
(
dŸfe_dœ
, 
image
->
fe
, 
	`¡¾’
(diafile_dir))==0) {

589 
	`d©a_add_f’ame
(
	`Ãw_©Œibu‹
(
obj_node
, "fe"), 
image
->
fe
 + 
	`¡¾’
(
dŸfe_dœ
) + 1);

592 
	`d©a_add_f’ame
(
	`Ãw_©Œibu‹
(
obj_node
, "fe"), 
image
->
fe
);

595 
	`g_ä“
(
dŸfe_dœ
);

600 
	`d©a_add_f’ame
(
	`Ãw_©Œibu‹
(
obj_node
, "fe"), 
image
->
fe
);

604 
	}
}

606 
DŸObjeù
 *

607 
	$image_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

609 
Image
 *
image
;

610 
EËm’t
 *
–em
;

611 
DŸObjeù
 *
obj
;

612 
i
;

613 
A‰ribu‹Node
 
©Œ
;

614 *
dŸfe_dœ
;

616 
image
 = 
	`g_m®loc0
((
Image
));

617 
–em
 = &
image
->
–em’t
;

618 
obj
 = &
–em
->
objeù
;

620 
obj
->
ty³
 = &
image_ty³
;

621 
obj
->
İs
 = &
image_İs
;

623 
	`–em’t_lßd
(
–em
, 
obj_node
);

625 
image
->
bÜd”_width
 = 0.1;

626 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "border_width");

627 ià(
©Œ
 !ğ
NULL
)

628 
image
->
bÜd”_width
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

630 
image
->
bÜd”_cŞÜ
 = 
cŞÜ_bÏck
;

631 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "border_color");

632 ià(
©Œ
 !ğ
NULL
)

633 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
image
->
bÜd”_cŞÜ
);

635 
image
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

636 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

637 ià(
©Œ
 !ğ
NULL
)

638 
image
->
lše_¡yË
 = 
	`d©a_’um
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

640 
image
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

641 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

642 ià(
©Œ
 !ğ
NULL
)

643 
image
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

645 
image
->
d¿w_bÜd”
 = 
TRUE
;

646 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "draw_border");

647 ià(
©Œ
 !ğ
NULL
)

648 
image
->
d¿w_bÜd”
 = 
	`d©a_boŞ—n
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

650 
image
->
k“p_a¥eù
 = 
TRUE
;

651 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "keep_aspect");

652 ià(
©Œ
 !ğ
NULL
)

653 
image
->
k“p_a¥eù
 = 
	`d©a_boŞ—n
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

655 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "file");

656 ià(
©Œ
 !ğ
NULL
) {

657 
image
->
fe
 = 
	`d©a_f’ame
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

659 
image
->
fe
 = 
	`g_¡rdup
("");

662 
	`–em’t_š™
(
–em
, 8, 
NUM_CONNECTIONS
);

664 
i
=0;i<
NUM_CONNECTIONS
;i++) {

665 
obj
->
cÚÃùiÚs
[
i
] = &
image
->connections[i];

666 
image
->
cÚÃùiÚs
[
i
].
objeù
 = 
obj
;

667 
image
->
cÚÃùiÚs
[
i
].
cÚÃùed
 = 
NULL
;

669 
image
->
cÚÃùiÚs
[8].
æags
 = 
CP_FLAGS_MAIN
;

671 
image
->imagğ
NULL
;

673 ià(
	`¡rcmp
(
image
->
fe
, "")!=0) {

674 
dŸfe_dœ
 = 
	`g‘_dœeùÜy
(
f’ame
);

676 ià(
	`g_·th_is_absŞu‹
(
image
->
fe
)) {

677 
image
->imagğ
	`dŸ_image_lßd
(image->
fe
);

678 ià(
image
->imag=ğ
NULL
) {

680 *
‹mp_¡ršg
;

681 cÚ¡ *
image_fe_Çme
 = 
image
->
fe
;

682 cÚ¡ *
p£p
;

684 
p£p
 = 
	`¡¼chr
(
image
->
fe
, 
G_DIR_SEPARATOR
);

686 ià(!
p£p
)

687 
p£p
 = 
	`¡¼chr
(
image
->
fe
, 
G_DIR_SEPARATOR
 == '/' ? '\\' : '/');

688 ià(
p£p
)

689 
image_fe_Çme
 = 
p£p
 + 1;

691 
‹mp_¡ršg
 = 
	`g_bud_f’ame
(
dŸfe_dœ
, 
image_fe_Çme
, 
NULL
);

693 
image
->imagğ
	`dŸ_image_lßd
(
‹mp_¡ršg
);

695 ià(
image
->imag!ğ
NULL
) {

697 
	`mes§ge_w¬nšg
(
	`_
("The image file '%s' was‚ot found inhat directory.\n"

698 "Usšghf'%s' in¡—d\n"), 
image
->
fe
, 
‹mp_¡ršg
);

699 
	`g_ä“
(
image
->
fe
);

700 
image
->
fe
 = 
‹mp_¡ršg
;

702 
	`g_ä“
(
‹mp_¡ršg
);

704 
image
->imagğ
	`dŸ_image_lßd
((*)
image_fe_Çme
);

705 ià(
image
->imag!ğ
NULL
) {

706 *
tmp
;

708 
	`mes§ge_w¬nšg
(
	`_
("The image file '%s' was‚ot found inhat directory.\n"

709 "Usšghf'%s' in¡—d\n"), 
image
->
fe
, 
image_fe_Çme
);

710 
tmp
 = 
image
->
fe
;

711 
image
->
fe
 = 
	`g_¡rdup
(
image_fe_Çme
);

712 
	`g_ä“
(
tmp
);

714 
	`mes§ge_w¬nšg
(
	`_
("The image file '%s' was‚ot found.\n"),

715 
image_fe_Çme
);

720 *
‹mp_¡ršg
;

722 
‹mp_¡ršg
 = 
	`g_bud_f’ame
 (
dŸfe_dœ
, 
image
->
fe
, 
NULL
);

724 
image
->imagğ
	`dŸ_image_lßd
(
‹mp_¡ršg
);

726 ià(
image
->imag!ğ
NULL
) {

728 
	`g_ä“
(
image
->
fe
);

729 
image
->
fe
 = 
‹mp_¡ršg
;

731 
	`g_ä“
(
‹mp_¡ršg
);

733 
image
->imagğ
	`dŸ_image_lßd
(image->
fe
);

734 ià(
image
->imag=ğ
NULL
) {

736 
	`mes§ge_w¬nšg
(
	`_
("The image file '%s' was‚ot found.\n"),

737 
image
->
fe
);

741 
	`g_ä“
(
dŸfe_dœ
);

746 
¡©
 
¡
;

747 ià(
	`g_¡©
 (
image
->
fe
, &
¡
) != 0)

748 
¡
.
¡_mtime
 = 0;

750 
image
->
mtime
 = 
¡
.
¡_mtime
;

752 
	`image_upd©e_d©a
(
image
);

754  &
image
->
–em’t
.
objeù
;

755 
	}
}

	@O:\tool\dvs50\objects\standard\line.c

20 #ifdeà
HAVE_CONFIG_H


21 
	~<cÚfig.h
>

24 
	~<as£¹.h
>

25 
	~<m©h.h
>

27 
	~"š.h
"

28 
	~"objeù.h
"

29 
	~"cÚÃùiÚ.h
"

30 
	~"cÚÃùiÚpošt.h
"

31 
	~"dŸ»nd””.h
"

32 
	~"©Œibu‹s.h
"

33 
	~"widg‘s.h
"

34 
	~"¬rows.h
"

35 
	~"cÚÅošt_lše.h
"

36 
	~"´İ”t›s.h
"

38 
	~"toŞ-icÚs.h
"

40 
	#DEFAULT_WIDTH
 0.25

	)

42 
_LšePrİ”t›s
 
	tLšePrİ”t›s
;

44 
	s_Lše
 {

45 
CÚÃùiÚ
 
	mcÚÃùiÚ
;

47 
CÚnPoštLše
 *
	mıl
;

49 
CŞÜ
 
	mlše_cŞÜ
;

50 
»®
 
	mlše_width
;

51 
LšeStyË
 
	mlše_¡yË
;

52 
A¼ow
 
	m¡¬t_¬row
, 
	m’d_¬row
;

53 
»®
 
	mdashËngth
;

54 
»®
 
	mabsŞu‹_¡¬t_g­
, 
	mabsŞu‹_’d_g­
;

55 } 
	tLše
;

57 
	s_LšePrİ”t›s
 {

58 
»®
 
	mabsŞu‹_¡¬t_g­
, 
	mabsŞu‹_’d_g­
;

61 
LšePrİ”t›s
 
	gdeçuÉ_´İ”t›s
;

63 
ObjeùChªge
* 
lše_move_hªdË
(
Lše
 *
lše
, 
HªdË
 *
hªdË
,

64 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

65 
HªdËMoveR—sÚ
 
»asÚ
,

66 
Modif›rKeys
 
modif›rs
);

67 
ObjeùChªge
* 
lše_move
(
Lše
 *
lše
, 
Pošt
 *
to
);

68 
lše_£Ëù
(
Lše
 *
lše
, 
Pošt
 *
şicked_pošt
,

69 
DŸR’d””
 *
š‹¿ùive_»nd””
);

70 
lše_d¿w
(
Lše
 *
lše
, 
DŸR’d””
 *
»nd””
);

71 
DŸObjeù
 *
lše_ü—‹
(
Pošt
 *
¡¬ošt
,

72 *
u£r_d©a
,

73 
HªdË
 **
hªdË1
,

74 
HªdË
 **
hªdË2
);

75 
»®
 
lše_di¡ªû_äom
(
Lše
 *
lše
, 
Pošt
 *
pošt
);

76 
lše_upd©e_d©a
(
Lše
 *
lše
);

77 
lše_de¡roy
(
Lše
 *
lše
);

78 
DŸObjeù
 *
lše_cİy
(
Lše
 *
lše
);

80 
PrİDesütiÚ
 *
lše_desüibe_´İs
(
Lše
 *
lše
);

81 
lše_g‘_´İs
(
Lše
 *
lše
, 
GPŒA¼ay
 *
´İs
);

82 
lše_£t_´İs
(
Lše
 *
lše
, 
GPŒA¼ay
 *
´İs
);

83 
lše_cÚÃùiÚ_two_objeù
(
Lše
 *
lše
,
CÚÃùiÚPošt
 *
ı
,
num
);

86 
lše_§ve
(
Lše
 *
lše
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
);

87 
DŸObjeù
 *
lše_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
);

88 
DŸM’u
 *
lše_g‘_objeù_m’u
(
Lše
 *
lše
, 
Pošt
 *
şickedpošt
);

90 
Lše_adju¡_fÜ_absŞu‹_g­
(
Lše
 *
lše
, 
Pošt
 *
g­_’dpošts
);

92 
ObjeùTy³Ops
 
	glše_ty³_İs
 =

94 (
C»©eFunc
è
lše_ü—‹
,

95 (
LßdFunc
è
lše_lßd
,

96 (
SaveFunc
è
lše_§ve
,

97 (
G‘DeçuÉsFunc
è
NULL
,

98 (
AµlyDeçuÉsFunc
è
NULL


101 
DŸObjeùTy³
 
	glše_ty³
 =

105 (**è
lše_icÚ
,

106 &
lše_ty³_İs


109 
DŸObjeùTy³
 *
	g_lše_ty³
 = (DŸObjeùTy³ *è&
lše_ty³
;

111 
ObjeùOps
 
	glše_İs
 = {

112 (
De¡royFunc
è
lše_de¡roy
,

113 (
D¿wFunc
è
lše_d¿w
,

114 (
Di¡ªûFunc
è
lše_di¡ªû_äom
,

115 (
S–eùFunc
è
lše_£Ëù
,

116 (
CİyFunc
è
lše_cİy
,

117 (
MoveFunc
è
lše_move
,

118 (
MoveHªdËFunc
è
lše_move_hªdË
,

119 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

120 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

121 (
ObjeùM’uFunc
è
lše_g‘_objeù_m’u
,

122 (
DesüibePrİsFunc
è
lše_desüibe_´İs
,

123 (
G‘PrİsFunc
è
lše_g‘_´İs
,

124 (
S‘PrİsFunc
è
lše_£t_´İs
,

125 (
TextEd™Func
) 0,

126 (
AµlyPrİ”t›sLi¡Func
) 0,

127 (
Upd©eD©a
è
lše_upd©e_d©a
,

128 (
CÚÃùiÚTwoObjeù
è
lše_cÚÃùiÚ_two_objeù
,

131 
PrİNumD©a
 
	gg­_¿nge
 = { -
G_MAXFLOAT
, G_MAXFLOAT, 0.1};

133 
PrİDesütiÚ
 
	glše_´İs
[] = {

134 
OBJECT_COMMON_PROPERTIES
,

135 
PROP_STD_LINE_WIDTH
,

136 
PROP_STD_LINE_COLOUR
,

137 
PROP_STD_LINE_STYLE
,

138 
PROP_FRAME_BEGIN
("¬rows",
PROP_FLAG_STANDARD
,
N_
("Arrows")),

139 
PROP_STD_START_ARROW
,

140 
PROP_STD_END_ARROW
,

141 
PROP_FRAME_END
("¬rows",
PROP_FLAG_STANDARD
),

142 { "¡¬t_pošt", 
PROP_TYPE_POINT
, 0,

143 
N_
("S¹…ošt"), 
NULL
 },

144 { "’d_pošt", 
PROP_TYPE_POINT
, 0,

145 
N_
("End…ošt"), 
NULL
 },

147 
PROP_FRAME_BEGIN
("g­s",0,
N_
("Line gaps")),

148 { "absŞu‹_¡¬t_g­", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

149 
N_
("AbsŞu‹ s¹ g­"), 
NULL
, &
g­_¿nge
 },

150 { "absŞu‹_’d_g­", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

151 
N_
("AbsŞu‹ƒnd g­"), 
NULL
, &
g­_¿nge
 },

152 
PROP_FRAME_END
("gaps",0),

154 
PROP_DESC_END


157 
PrİDesütiÚ
 *

158 
	$lše_desüibe_´İs
(
Lše
 *
lše
)

160 ià(
lše_´İs
[0].
qu¬k
 == 0)

161 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
lše_´İs
);

162  
lše_´İs
;

163 
	}
}

165 
PrİOff£t
 
	glše_off£ts
[] = {

166 
OBJECT_COMMON_PROPERTIES_OFFSETS
,

167 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Lše
, 
lše_width
) },

168 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Lše
, 
lše_cŞÜ
) },

169 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

170 
off£tof
(
Lše
, 
lše_¡yË
), off£tof(Lše, 
dashËngth
) },

171 { "¡¬t_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
Lše
, 
¡¬t_¬row
) },

172 { "’d_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
Lše
, 
’d_¬row
) },

173 { "¡¬t_pošt", 
PROP_TYPE_POINT
, 
off£tof
(
CÚÃùiÚ
, 
’dpošts
[0]) },

174 { "’d_pošt", 
PROP_TYPE_POINT
, 
off£tof
(
CÚÃùiÚ
, 
’dpošts
[1]) },

175 
PROP_OFFSET_FRAME_BEGIN
("gaps"),

176 { "absŞu‹_¡¬t_g­", 
PROP_TYPE_REAL
, 
off£tof
(
Lše
, 
absŞu‹_¡¬t_g­
) },

177 { "absŞu‹_’d_g­", 
PROP_TYPE_REAL
, 
off£tof
(
Lše
, 
absŞu‹_’d_g­
) },

178 
PROP_OFFSET_FRAME_END
("gaps"),

179 { 
NULL
, 0, 0 }

183 
	$lše_g‘_´İs
(
Lše
 *
lše
, 
GPŒA¼ay
 *
´İs
)

186 
	`objeù_g‘_´İs_äom_off£ts
(&
lše
->
cÚÃùiÚ
.
objeù
,

187 
lše_off£ts
, 
´İs
);

188 
	}
}

191 
	$lše_£t_´İs
(
Lše
 *
lše
, 
GPŒA¼ay
 *
´İs
)

193 
	`objeù_£t_´İs_äom_off£ts
(&
lše
->
cÚÃùiÚ
.
objeù
,

194 
lše_off£ts
, 
´İs
);

195 
	`lše_upd©e_d©a
(
lše
);

196 
	}
}

200 
	$lše_cÚÃùiÚ_two_objeù
(
Lše
 *
lše
,
CÚÃùiÚPošt
 *
ı
,
num
)

203 
lše
->
cÚÃùiÚ
.
’dpošt_hªdËs
[
num
].
cÚÃùed_to
 = 
ı
;

204 
	`lše_upd©e_d©a
(
lše
);

205 
	}
}

208 
	$lše_š™_deçuÉs
() {

209 
deçuÉs_š™Ÿlized
 = 0;

211 ià(!
deçuÉs_š™Ÿlized
) {

212 
deçuÉ_´İ”t›s
.
absŞu‹_¡¬t_g­
 = 0.0;

213 
deçuÉ_´İ”t›s
.
absŞu‹_’d_g­
 = 0.0;

214 
deçuÉs_š™Ÿlized
 = 1;

216 
	}
}

218 
ObjeùChªge
 *

219 
	$lše_add_cÚÅošt_ÿÎback
(
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

221 
ObjeùChªge
 *
oc
;

222 
oc
 = 
	`cÚÅošše_add_pošt
(((
Lše
 *)
obj
)->
ıl
,
şicked
);

223 
	`lše_upd©e_d©a
((
Lše
 *)
obj
);

224  
oc
;

225 
	}
}

227 
ObjeùChªge
 *

228 
	$lše_»move_cÚÅošt_ÿÎback
(
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

230 
ObjeùChªge
 *
oc
;

231 
oc
 = 
	`cÚÅošše_»move_pošt
(((
Lše
 *)
obj
)->
ıl
,
şicked
);

232 
	`lše_upd©e_d©a
((
Lše
 *)
obj
);

233  
oc
;

234 
	}
}

236 
DŸM’uI‹m
 
	gobjeù_m’u_™ems
[] = {

237 { 
N_
("Add cÚÃùiÚ…ošt"), 
lše_add_cÚÅošt_ÿÎback
, 
NULL
, 1 },

238 { 
N_
("D–‘cÚÃùiÚ…ošt"), 
lše_»move_cÚÅošt_ÿÎback
,

239 
NULL
, 1 },

242 
DŸM’u
 
	gobjeù_m’u
 = {

243 
N_
("Line"),

244 (
objeù_m’u_™ems
)/(
DŸM’uI‹m
),

245 
objeù_m’u_™ems
,

246 
NULL


249 
DŸM’u
 *

250 
	$lše_g‘_objeù_m’u
(
Lše
 *
lše
, 
Pošt
 *
şickedpošt
)

252 
CÚnPoštLše
 *
ıl
;

254 
ıl
 = 
lše
->cpl;

256 
objeù_m’u_™ems
[0].
aùive
 =

257 
	`cÚÅošše_ÿn_add_pošt
(
ıl
, 
şickedpošt
);

258 
objeù_m’u_™ems
[1].
aùive
 =

259 
	`cÚÅošše_ÿn_»move_pošt
(
ıl
,
şickedpošt
);

260  &
objeù_m’u
;

261 
	}
}

270 
	$lše_adju¡_fÜ_absŞu‹_g­
(
Lše
 *
lše
, 
Pošt
 *
g­_’dpošts
)

272 
Pošt
 
’dpošts
[2];

273 
»®
 
lše_Ëngth
;

275 
’dpošts
[0] = 
lše
->
cÚÃùiÚ
.endpoints[0];

276 
’dpošts
[1] = 
lše
->
cÚÃùiÚ
.endpoints[1];

278 
lše_Ëngth
 = 
	`di¡ªû_pošt_pošt
(&
’dpošts
[0], &endpoints[1]);

281 
	`pošt_cÚvex
(&
g­_’dpošts
[0], &
’dpošts
[0], &endpoints[1],

282 1 - 
lše
->
absŞu‹_¡¬t_g­
/
lše_Ëngth
);

285 
	`pošt_cÚvex
(&
g­_’dpošts
[1], &
’dpošts
[1], &endpoints[0],

286 1 - 
lše
->
absŞu‹_’d_g­
/
lše_Ëngth
);

287 
	}
}

289 
»®


290 
	$lše_di¡ªû_äom
(
Lše
 *
lše
, 
Pošt
 *
pošt
)

292 
Pošt
 *
’dpošts
;

294 
’dpošts
 = &
lše
->
cÚÃùiÚ
.endpoints[0];

296 ià(
lše
->
absŞu‹_¡¬t_g­
 ||†še->
absŞu‹_’d_g­
 ) {

297 
Pošt
 
g­_’dpošts
[2];

299 
	`lše_adju¡_fÜ_absŞu‹_g­
(
lše
, 
g­_’dpošts
);

300  
	`di¡ªû_lše_pošt
Ğ&
g­_’dpošts
[0], &gap_endpoints[1],

301 
lše
->
lše_width
, 
pošt
);

303  
	`di¡ªû_lše_pošt
Ğ&
’dpošts
[0], &endpoints[1],

304 
lše
->
lše_width
, 
pošt
);

306 
	}
}

309 
	$lše_£Ëù
(
Lše
 *
lše
, 
Pošt
 *
şicked_pošt
,

310 
DŸR’d””
 *
š‹¿ùive_»nd””
)

312 
	`cÚÃùiÚ_upd©e_hªdËs
(&
lše
->
cÚÃùiÚ
);

313 
	}
}

315 
ObjeùChªge
*

316 
	$lše_move_hªdË
(
Lše
 *
lše
, 
HªdË
 *
hªdË
,

317 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

318 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

320 
	`as£¹
(
lše
!=
NULL
);

321 
	`as£¹
(
hªdË
!=
NULL
);

322 
	`as£¹
(
to
!=
NULL
);

324 
	`cÚÃùiÚ_move_hªdË
(&
lše
->
cÚÃùiÚ
, 
hªdË
->
id
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

326 
	`lše_upd©e_d©a
(
lše
);

328  
NULL
;

329 
	}
}

331 
ObjeùChªge
*

332 
	$lše_move
(
Lše
 *
lše
, 
Pošt
 *
to
)

334 
Pošt
 
¡¬t_to_’d
;

335 
Pošt
 *
’dpošts
 = &
lše
->
cÚÃùiÚ
.endpoints[0];

337 
¡¬t_to_’d
 = 
’dpošts
[1];

338 
	`pošt_sub
(&
¡¬t_to_’d
, &
’dpošts
[0]);

340 
’dpošts
[1] =ƒndpošts[0] = *
to
;

341 
	`pošt_add
(&
’dpošts
[1], &
¡¬t_to_’d
);

343 
	`lše_upd©e_d©a
(
lše
);

345  
NULL
;

346 
	}
}

349 
	$lše_d¿w
(
Lše
 *
lše
, 
DŸR’d””
 *
»nd””
)

351 
Pošt
 
g­_’dpošts
[2];

353 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

355 
	`as£¹
(
lše
 !ğ
NULL
);

356 
	`as£¹
(
»nd””
 !ğ
NULL
);

358 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
lše
->
lše_width
);

359 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
lše
->
lše_¡yË
);

360 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
lše
->
dashËngth
);

361 
»nd””_İs
->
	`£t_lšeÿps
(
»nd””
, 
LINECAPS_BUTT
);

363 ià(
lše
->
absŞu‹_¡¬t_g­
 ||†še->
absŞu‹_’d_g­
 ) {

364 
	`lše_adju¡_fÜ_absŞu‹_g­
(
lše
, 
g­_’dpošts
);

366 
»nd””_İs
->
	`d¿w_lše_w™h_¬rows
(
»nd””
,

367 &
g­_’dpošts
[0], &gap_endpoints[1],

368 
lše
->
lše_width
,

369 &
lše
->
lše_cŞÜ
,

370 &
lše
->
¡¬t_¬row
,

371 &
lše
->
’d_¬row
);

373 
»nd””_İs
->
	`d¿w_lše_w™h_¬rows
(
»nd””
,

374 &
lše
->
cÚÃùiÚ
.
’dpošts
[0],

375 &
lše
->
cÚÃùiÚ
.
’dpošts
[1],

376 
lše
->
lše_width
,

377 &
lše
->
lše_cŞÜ
,

378 &
lše
->
¡¬t_¬row
,

379 &
lše
->
’d_¬row
);

382 
	}
}

384 
DŸObjeù
 *

385 
	$lše_ü—‹
(
Pošt
 *
¡¬ošt
,

386 *
u£r_d©a
,

387 
HªdË
 **
hªdË1
,

388 
HªdË
 **
hªdË2
)

390 
Lše
 *
lše
;

391 
CÚÃùiÚ
 *
cÚn
;

392 
DŸObjeù
 *
obj
;

393 
Pošt
 
deçuÉËn
 = { 1.0, 1.0 };

395 
	`lše_š™_deçuÉs
();

397 
lše
 = 
	`g_m®loc0
((
Lše
));

399 
lše
->
lše_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

400 
lše
->
lše_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

401 
lše
->
absŞu‹_¡¬t_g­
 = 
deçuÉ_´İ”t›s
.absolute_start_gap;

402 
lše
->
absŞu‹_’d_g­
 = 
deçuÉ_´İ”t›s
.absolute_end_gap;

404 
cÚn
 = &
lše
->
cÚÃùiÚ
;

405 
cÚn
->
’dpošts
[0] = *
¡¬ošt
;

406 
cÚn
->
’dpošts
[1] = *
¡¬ošt
;

407 
	`pošt_add
(&
cÚn
->
’dpošts
[1], &
deçuÉËn
);

409 
obj
 = &
cÚn
->
objeù
;

411 
obj
->
ty³
 = &
lše_ty³
;

412 
obj
->
İs
 = &
lše_İs
;

414 
	`cÚÃùiÚ_š™
(
cÚn
, 2, 0);

416 
lše
->
ıl
 = 
	`cÚÅošše_ü—‹
(
obj
,1);

418 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
lše
->
lše_¡yË
, &lše->
dashËngth
);

419 
lše
->
¡¬t_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_¡¬t_¬row
();

420 
lše
->
’d_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_’d_¬row
();

421 
	`lše_upd©e_d©a
(
lše
);

423 *
hªdË1
 = 
obj
->
hªdËs
[0];

424 *
hªdË2
 = 
obj
->
hªdËs
[1];

425  &
lše
->
cÚÃùiÚ
.
objeù
;

426 
	}
}

429 
	$lše_de¡roy
(
Lše
 *
lše
)

431 
	`cÚÅošše_de¡roy
(
lše
->
ıl
);

432 
	`cÚÃùiÚ_de¡roy
(&
lše
->
cÚÃùiÚ
);

433 
	}
}

435 
DŸObjeù
 *

436 
	$lše_cİy
(
Lše
 *
lše
)

438 
Lše
 *
Ãwlše
;

439 
CÚÃùiÚ
 *
cÚn
, *
ÃwcÚn
;

440 
DŸObjeù
 *
Ãwobj
;

441 
rcc
 = 0;

443 
cÚn
 = &
lše
->
cÚÃùiÚ
;

445 
Ãwlše
 = 
	`g_m®loc0
((
Lše
));

446 
ÃwcÚn
 = &
Ãwlše
->
cÚÃùiÚ
;

447 
Ãwobj
 = &
ÃwcÚn
->
objeù
;

449 
	`cÚÃùiÚ_cİy
(
cÚn
, 
ÃwcÚn
);

451 
Ãwlše
->
ıl
 = 
	`cÚÅošše_cİy
(
Ãwobj
,
lše
->ıl,&
rcc
);

453 
Ãwlše
->
lše_cŞÜ
 = 
lše
->line_color;

454 
Ãwlše
->
lše_width
 = 
lše
->line_width;

455 
Ãwlše
->
lše_¡yË
 = 
lše
->line_style;

456 
Ãwlše
->
dashËngth
 = 
lše
->dashlength;

457 
Ãwlše
->
¡¬t_¬row
 = 
lše
->start_arrow;

458 
Ãwlše
->
’d_¬row
 = 
lše
->end_arrow;

459 
Ãwlše
->
absŞu‹_¡¬t_g­
 = 
lše
->absolute_start_gap;

460 
Ãwlše
->
absŞu‹_’d_g­
 = 
lše
->absolute_end_gap;

462 
	`lše_upd©e_d©a
(
lše
);

464  &
Ãwlše
->
cÚÃùiÚ
.
objeù
;

465 
	}
}

468 
	$lše_upd©e_d©a
(
Lše
 *
lše
)

470 
CÚÃùiÚ
 *
cÚn
 = &
lše
->
cÚÃùiÚ
;

471 
DŸObjeù
 *
obj
 = &
cÚn
->
objeù
;

472 
LšeBBExŒas
 *
exŒa
 = &
cÚn
->
exŒa_¥acšg
;

473 
Pošt
 
¡¬t
, 
’d
;

475 
exŒa
->
¡¬t_Œªs
 =

476 
exŒa
->
’d_Œªs
 =

477 
exŒa
->
¡¬t_lÚg
 =

478 
exŒa
->
’d_lÚg
 = (
lše
->
lše_width
 / 2.0);

480 ià(
	`cÚÅošt_is_autog­
(
lše
->
cÚÃùiÚ
.
’dpošt_hªdËs
[0].
cÚÃùed_to
) ||

481 
	`cÚÅošt_is_autog­
(
lše
->
cÚÃùiÚ
.
’dpošt_hªdËs
[1].
cÚÃùed_to
)) {

482 
	`cÚÃùiÚ_adju¡_fÜ_autog­
(
cÚn
);

484 ià(
lše
->
absŞu‹_¡¬t_g­
 ||†še->
absŞu‹_’d_g­
 ) {

485 
Pošt
 
g­_’dpošts
[2];

487 
	`lše_adju¡_fÜ_absŞu‹_g­
(
lše
, 
g­_’dpošts
);

488 
	`lše_bbox
(&
g­_’dpošts
[0],&gap_endpoints[1],

489 &
cÚn
->
exŒa_¥acšg
,&cÚn->
objeù
.
boundšg_box
);

490 
¡¬t
 = 
g­_’dpošts
[0];

491 
’d
 = 
g­_’dpošts
[1];

493 
	`cÚÃùiÚ_upd©e_boundšgbox
(
cÚn
);

494 
¡¬t
 = 
cÚn
->
’dpošts
[0];

495 
’d
 = 
cÚn
->
’dpošts
[1];

497 ià(
lše
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

498 
ReùªgË
 
bbox
;

499 
Pošt
 
move_¬row
, 
move_lše
;

500 
Pošt
 
to
 = 
¡¬t
;

501 
Pošt
 
äom
 = 
’d
;

502 
	`ÿlcuÏ‹_¬row_pošt
(&
lše
->
¡¬t_¬row
, &
to
, &
äom
,

503 &
move_¬row
, &
move_lše
, 
lše
->
lše_width
);

505 
	`pošt_sub
(&
to
, &
move_¬row
);

506 
	`pošt_sub
(&
äom
, &
move_lše
);

508 
	`¬row_bbox
 (&
lše
->
¡¬t_¬row
,†še->
lše_width
, &
to
, &
äom
, &
bbox
);

509 
	`»ùªgË_uniÚ
 (&
obj
->
boundšg_box
, &
bbox
);

511 ià(
lše
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

512 
ReùªgË
 
bbox
;

513 
Pošt
 
move_¬row
, 
move_lše
;

514 
Pošt
 
to
 = 
’d
;

515 
Pošt
 
äom
 = 
¡¬t
;

516 
	`ÿlcuÏ‹_¬row_pošt
(&
lše
->
¡¬t_¬row
, &
to
, &
äom
,

517 &
move_¬row
, &
move_lše
, 
lše
->
lše_width
);

519 
	`pošt_sub
(&
to
, &
move_¬row
);

520 
	`pošt_sub
(&
äom
, &
move_lše
);

522 
	`¬row_bbox
 (&
lše
->
’d_¬row
,†še->
lše_width
, &
to
, &
äom
, &
bbox
);

523 
	`»ùªgË_uniÚ
 (&
obj
->
boundšg_box
, &
bbox
);

526 
obj
->
pos™iÚ
 = 
cÚn
->
’dpošts
[0];

528 
	`cÚÅošše_upd©e
(
lše
->
ıl
);

529 
	`cÚÅošše_putÚ®še
(
lše
->
ıl
, &
¡¬t
, &
’d
);

531 
	`cÚÃùiÚ_upd©e_hªdËs
(
cÚn
);

532 
	}
}

536 
	$lše_§ve
(
Lše
 *
lše
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
)

538 #ifdeà
DEBUG


542 
	`cÚÃùiÚ_§ve
(&
lše
->
cÚÃùiÚ
, 
obj_node
);

544 
	`cÚÅošše_§ve
(
lše
->
ıl
,
obj_node
,"numcp");

546 ià(!
	`cŞÜ_equ®s
(&
lše
->
lše_cŞÜ
, &
cŞÜ_bÏck
))

547 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "line_color"),

548 &
lše
->
lše_cŞÜ
);

550 ià(
lše
->
lše_width
 != 0.1)

551 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

552 
lše
->
lše_width
);

554 ià(
lše
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
)

555 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

556 
lše
->
lše_¡yË
);

558 ià(
lše
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

559 
	`§ve_¬row
(
obj_node
, &
lše
->
¡¬t_¬row
,

563 ià(
lše
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

564 
	`§ve_¬row
(
obj_node
, &
lše
->
’d_¬row
,

568 ià(
lše
->
absŞu‹_¡¬t_g­
)

569 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "absolute_start_gap"),

570 
lše
->
absŞu‹_¡¬t_g­
);

571 ià(
lše
->
absŞu‹_’d_g­
)

572 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "absolute_end_gap"),

573 
lše
->
absŞu‹_’d_g­
);

575 ià(
lše
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
 &&†še->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

576 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

577 
lše
->
dashËngth
);

578 
	}
}

580 
DŸObjeù
 *

581 
	$lše_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

583 
Lše
 *
lše
;

584 
CÚÃùiÚ
 *
cÚn
;

585 
DŸObjeù
 *
obj
;

586 
A‰ribu‹Node
 
©Œ
;

588 
lše
 = 
	`g_m®loc0
((
Lše
));

590 
cÚn
 = &
lše
->
cÚÃùiÚ
;

591 
obj
 = &
cÚn
->
objeù
;

593 
obj
->
ty³
 = &
lše_ty³
;

594 
obj
->
İs
 = &
lše_İs
;

596 
	`cÚÃùiÚ_lßd
(
cÚn
, 
obj_node
);

598 
lše
->
lše_cŞÜ
 = 
cŞÜ_bÏck
;

599 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_color");

600 ià(
©Œ
 !ğ
NULL
)

601 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
lše
->
lše_cŞÜ
);

603 
lše
->
lše_width
 = 0.1;

604 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

605 ià(
©Œ
 !ğ
NULL
)

606 
lše
->
lše_width
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

608 
lše
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

609 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

610 ià(
©Œ
 !ğ
NULL
)

611 
lše
->
lše_¡yË
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

613 
	`lßd_¬row
(
obj_node
, &
lše
->
¡¬t_¬row
,

616 
	`lßd_¬row
(
obj_node
, &
lše
->
’d_¬row
,

619 
lše
->
absŞu‹_¡¬t_g­
 = 0.0;

620 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "absolute_start_gap");

621 ià(
©Œ
 !ğ
NULL
)

622 
lše
->
absŞu‹_¡¬t_g­
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

623 
lše
->
absŞu‹_’d_g­
 = 0.0;

624 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "absolute_end_gap");

625 ià(
©Œ
 !ğ
NULL
)

626 
lše
->
absŞu‹_’d_g­
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

628 
lše
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

629 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

630 ià(
©Œ
 !ğ
NULL
)

631 
lše
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

633 
	`cÚÃùiÚ_š™
(
cÚn
, 2, 0);

635 
lše
->
ıl
 = 
	`cÚÅošše_lßd
(
obj
,
obj_node
,"numı",1,
NULL
);

636 
	`lše_upd©e_d©a
(
lše
);

638  &
lše
->
cÚÃùiÚ
.
objeù
;

639 
	}
}

	@O:\tool\dvs50\objects\standard\outline.c

27 
	~<cÚfig.h
>

29 
	~"objeù.h
"

30 
	~"dŸ»nd””.h
"

31 
	~"©Œibu‹s.h
"

32 
	~"´İ”t›s.h
"

33 
	~"boundšgbox.h
"

35 
	~"toŞ-icÚs.h
"

37 #ifdeà
HAVE_CAIRO


38 
	~<ÿœo.h
>

40 #ifdeà
CAIRO_HAS_SVG_SURFACE


41 
	~<ÿœo-svg.h
>

44 
	#NUM_HANDLES
 2

	)

46 
	s_Ouše
 {

47 
DŸObjeù
 
	mobjeù
;

49 *
	mÇme
;

50 
»®
 
	mrÙ©iÚ
;

52 
DŸFÚt
 *
	mfÚt
;

53 
»®
 
	mfÚt_height
;

55 
CŞÜ
 
	mlše_cŞÜ
;

56 
CŞÜ
 
	mfl_cŞÜ
;

57 
gboŞ—n
 
	mshow_background
;

58 
»®
 
	mlše_width
;

60 
HªdË
 
	mhªdËs
[
NUM_HANDLES
];

62 
Pošt
 
	mšk_»ù
[4];

63 
ÿœo_·th_t
 *
	m·th
;

64 
	s_M©rix


66 
»®
 
	mxx
;

67 
»®
 
	mxy
;

68 
»®
 
	myx
;

69 
»®
 
	myy
;

70 } 
	mm©
;

71 } 
	tOuše
;

74 
DŸObjeù
 *
ouše_ü—‹
 (
Pošt
 *
¡¬ošt
,

75 *
u£r_d©a
,

76 
HªdË
 **
hªdË1
,

77 
HªdË
 **
hªdË2
);

78 
DŸObjeù
 *

79 
ouše_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
);

81 
ObjeùTy³Ops
 
	gouše_ty³_İs
 =

83 (
C»©eFunc
)
ouše_ü—‹
,

84 (
LßdFunc
è
ouše_lßd
,

85 (
SaveFunc
è
objeù_§ve_usšg_´İ”t›s
,

86 (
G‘DeçuÉsFunc
è
NULL
,

87 (
AµlyDeçuÉsFunc
è
NULL


90 
DŸObjeùTy³
 
	gouše_ty³
 =

94 (**è
ouše_icÚ
,

96 &
ouše_ty³_İs
,

97 
NULL
,

102 
DŸObjeùTy³
 *
	g_ouše_ty³
 = (DŸObjeùTy³ *è&
ouše_ty³
;

105 
ObjeùChªge
* 
ouše_move_hªdË
 (
Ouše
 *
ouše
,

106 
HªdË
 *
hªdË
,

107 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

108 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

109 
ObjeùChªge
* 
ouše_move
 (
Ouše
 *
ouše
, 
Pošt
 *
to
);

110 
ouše_£Ëù
(
Ouše
 *
ouše
, 
Pošt
 *
şicked_pošt
,

111 
DŸR’d””
 *
š‹¿ùive_»nd””
);

112 
ouše_d¿w
(
Ouše
 *
ouše
, 
DŸR’d””
 *
»nd””
);

113 
»®
 
ouše_di¡ªû_äom
 (
Ouše
 *
ouše
, 
Pošt
 *
pošt
);

114 
ouše_upd©e_d©a
 (
Ouše
 *
ouše
);

115 
ouše_de¡roy
 (
Ouše
 *
ouše
);

116 
DŸObjeù
 *
ouše_cİy
 (
Ouše
 *
ouše
);

117 
DŸM’u
 *
ouše_g‘_objeù_m’u
(
Ouše
 *
ouše
,

118 
Pošt
 *
şickedpošt
);

119 
PrİDesütiÚ
 *
ouše_desüibe_´İs
(
Ouše
 *
ouše
);

120 
ouše_g‘_´İs
(
Ouše
 *
ouše
, 
GPŒA¼ay
 *
´İs
);

121 
ouše_£t_´İs
(
Ouše
 *
ouše
, 
GPŒA¼ay
 *
´İs
);

123 
ObjeùOps
 
	gouše_İs
 = {

124 (
De¡royFunc
è
ouše_de¡roy
,

125 (
D¿wFunc
è
ouše_d¿w
,

126 (
Di¡ªûFunc
è
ouše_di¡ªû_äom
,

127 (
S–eùFunc
è
ouše_£Ëù
,

128 (
CİyFunc
è
ouše_cİy
,

129 (
MoveFunc
è
ouše_move
,

130 (
MoveHªdËFunc
è
ouše_move_hªdË
,

131 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

132 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

133 (
ObjeùM’uFunc
è
ouše_g‘_objeù_m’u
,

134 (
DesüibePrİsFunc
è
ouše_desüibe_´İs
,

135 (
G‘PrİsFunc
è
ouše_g‘_´İs
,

136 (
S‘PrİsFunc
è
ouše_£t_´İs
,

137 (
TextEd™Func
) 0,

138 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

143 
	$ouše_š™_hªdËs
 (
Ouše
 *
ouše
)

145 
DŸObjeù
 *
obj
 = &
ouše
->
objeù
;

146 
i
;

148 
i
 = 0; i < 
NUM_HANDLES
; ++i) {

149 
obj
->
hªdËs
[
i
] = &
ouše
->handles[i];

150 
obj
->
hªdËs
[
i
]->
ty³
 = 
HANDLE_MAJOR_CONTROL
;

151 
obj
->
hªdËs
[
i
]->
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

152 
obj
->
hªdËs
[
i
]->
cÚÃùed_to
 = 
NULL
;

154 
	}
}

157 
DŸObjeù
 *

158 
	$ouše_ü—‹
 (
Pošt
 *
¡¬ošt
,

159 *
u£r_d©a
,

160 
HªdË
 **
hªdË1
,

161 
HªdË
 **
hªdË2
)

163 
Ouše
 *
ouše
;

164 
DŸObjeù
 *
obj
;

166 
ouše
 = 
	`g_Ãw0
 (
Ouše
,1);

167 
obj
 = &
ouše
->
objeù
;

168 
obj
->
ty³
 = &
ouše_ty³
;

169 
obj
->
İs
 = &
ouše_İs
;

171 
	`objeù_š™
 (
obj
, 
NUM_HANDLES
, 0);

172 
obj
->
pos™iÚ
 = *
¡¬ošt
;

174 
	`ouše_š™_hªdËs
 (
ouše
);

176 
	`©Œibu‹s_g‘_deçuÉ_fÚt
 (&
ouše
->
fÚt
, &ouše->
fÚt_height
);

178 
ouše
->
lše_width
 = 0;

179 
ouše
->
lše_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

180 
ouše
->
fl_cŞÜ
 = 
	`©Œibu‹s_g‘_background
();

181 
ouše
->
show_background
 = 
FALSE
;

182 
ouše
->
Çme
 = 
	`g_¡rdup
 ("?");

183 
ouše
->
rÙ©iÚ
 = 0;

185 *
hªdË1
 = 
ouše
->
objeù
.
hªdËs
[0];

186 *
hªdË2
 = 
ouše
->
objeù
.
hªdËs
[1];

188 
	`ouše_upd©e_d©a
 (
ouše
);

190  
obj
;

191 
	}
}

192 
DŸObjeù
 *

193 
	$ouše_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

195  
	`objeù_lßd_usšg_´İ”t›s
(&
ouše_ty³
,

196 
obj_node
,
v”siÚ
,
f’ame
);

197 
	}
}

200 
PrİNumD©a
 
	g_rÙ©iÚ_¿nge
 = { 0.0f, 360.0f, 1.0f };

201 
PrİDesütiÚ
 
	gouše_´İs
[] = {

202 
OBJECT_COMMON_PROPERTIES
,

203 { "Çme", 
PROP_TYPE_STRING
,
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_MERGE
,

204 
N_
("TexˆcÚ‹Á"),
NULL
 },

205 { "rÙ©iÚ", 
PROP_TYPE_REAL
,
PROP_FLAG_VISIBLE
,

206 
N_
("RÙ©iÚ"), N_("AngËØrÙ©thouše"), &
_rÙ©iÚ_¿nge
},

208 
PROP_STD_TEXT_FONT_OPTIONS
(
PROP_FLAG_VISIBLE
),

209 
PROP_STD_TEXT_HEIGHT_OPTIONS
(
PROP_FLAG_VISIBLE
),

210 
PROP_STD_LINE_WIDTH
,

211 
PROP_STD_LINE_COLOUR
,

212 
PROP_STD_FILL_COLOUR
,

213 
PROP_STD_SHOW_BACKGROUND
,

214 
PROP_DESC_END


217 
PrİOff£t
 
	gouše_off£ts
[] = {

218 
OBJECT_COMMON_PROPERTIES_OFFSETS
,

219 { "Çme", 
PROP_TYPE_STRING
, 
off£tof
(
Ouše
, 
Çme
) },

220 { "rÙ©iÚ", 
PROP_TYPE_REAL
, 
off£tof
(
Ouše
, 
rÙ©iÚ
) },

221 { "‹xt_fÚt",
PROP_TYPE_FONT
,
off£tof
(
Ouše
,
fÚt
) },

222 { 
PROP_STDNAME_TEXT_HEIGHT
,
PROP_STDTYPE_TEXT_HEIGHT
,
off£tof
(
Ouše
, 
fÚt_height
) },

223 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Ouše
, 
lše_width
) },

224 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Ouše
, 
lše_cŞÜ
) },

225 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Ouše
, 
fl_cŞÜ
) },

226 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
Ouše
, 
show_background
) },

227 { 
NULL
, 0, 0 }

230 
ÿœo_¡©us_t


231 
	$wr™e_nul
 (*
şosu»
,

232 cÚ¡ *
d©a
,

233 
Ëngth
)

235  
CAIRO_STATUS_SUCCESS
;

236 
	}
}

239 
	$outše_upd©e_hªdËs
(
Ouše
 *
ouše
)

241 
DŸObjeù
 *
obj
 = &
ouše
->
objeù
;

243 
	`g_»tuº_if_ç
 (
obj
->
hªdËs
 !ğ
NULL
);

244 
obj
->
hªdËs
[0]->
id
 = 
HANDLE_RESIZE_NW
;

245 
obj
->
hªdËs
[0]->
pos
 = 
ouše
->
šk_»ù
[0];

247 
obj
->
hªdËs
[1]->
id
 = 
HANDLE_RESIZE_SE
;

248 
obj
->
hªdËs
[1]->
pos
 = 
ouše
->
šk_»ù
[2];

249 
	}
}

252 
	$ouše_upd©e_d©a
 (
Ouše
 *
ouše
)

254 
DŸObjeù
 *
obj
 = &
ouše
->
objeù
;

256 
ÿœo_t
 *
ü
;

257 
ÿœo_surçû_t
 *
surçû
;

258 
ÿœo_‹xt_ex‹Ás_t
 
ex‹Ás
;

259 
»®
 
x
, 
y
;

260 
DŸFÚtStyË
 
¡yË
;

262 ià(
ouše
->
·th
)

263 
	`ÿœo_·th_de¡roy
 (
ouše
->
·th
);

264 
ouše
->
·th
 = 
NULL
;

266 #ifdeà
CAIRO_HAS_SVG_SURFACE


267 
surçû
 = 
	`ÿœo_svg_surçû_ü—‹_fÜ_¡»am
 (
wr™e_nul
, 
NULL
, 100, 100);

270 
surçû
 = 
	`ÿœo_image_surçû_ü—‹
 (
CAIRO_FORMAT_ARGB32
, 100, 100);

272 
ü
 = 
	`ÿœo_ü—‹
 (
surçû
);

273 
	`ÿœo_surçû_de¡roy
 (
surçû
);

274 
¡yË
 = 
	`dŸ_fÚt_g‘_¡yË
 (
ouše
->
fÚt
);

276 
	`ÿœo_£Ëù_fÚt_çû
 (
ü
, 
	`dŸ_fÚt_g‘_çmy
 (
ouše
->
fÚt
),

277 
	`DIA_FONT_STYLE_GET_SLANT
 (
¡yË
è=ğ
DIA_FONT_NORMAL
 ? 
CAIRO_FONT_SLANT_NORMAL
 : 
CAIRO_FONT_SLANT_ITALIC
,

278 
	`DIA_FONT_STYLE_GET_WEIGHT
 (
¡yË
è< 
DIA_FONT_MEDIUM
 ? 
CAIRO_FONT_SLANT_NORMAL
 : 
CAIRO_FONT_WEIGHT_BOLD
);

279 
	`ÿœo_£t_fÚt_size
 (
ü
, 
ouše
->
fÚt_height
);

280 
	`ÿœo_‹xt_ex‹Ás
 (
ü
, 
ouše
->
Çme
, &
ex‹Ás
);

283 
	`ÿœo_rÙ©e
 (
ü
, 
ouše
->
rÙ©iÚ
/(2*
G_PI
));

285 
ouše
->
m©
.
xx
 = 
	`cos
(
G_PI
*ouše->
rÙ©iÚ
/180);

286 
ouše
->
m©
.
xy
 = 
	`sš
(
G_PI
*ouše->
rÙ©iÚ
/180);

287 
ouše
->
m©
.
yx
 = -
	`sš
(
G_PI
*ouše->
rÙ©iÚ
/180);

288 
ouše
->
m©
.
yy
 = 
	`cos
(
G_PI
*ouše->
rÙ©iÚ
/180);

291 
ouše
->
šk_»ù
[0].
x
 = x = 
obj
->
pos™iÚ
.x;

292 
ouše
->
šk_»ù
[0].
y
 = y = 
obj
->
pos™iÚ
.y;

294 
ouše
->
šk_»ù
[1].
x
 = x + 
ex‹Ás
.
width
 * ouše->
m©
.
xx
;

295 
ouše
->
šk_»ù
[1].
y
 = y + 
ex‹Ás
.
width
 * ouše->
m©
.
yx
;

296 
ouše
->
šk_»ù
[2].
x
 = x + 
ex‹Ás
.
width
 * ouše->
m©
.
xx
 +ƒx‹Ás.
height
 * ouše->m©.
xy
;

297 
ouše
->
šk_»ù
[2].
y
 = y + 
ex‹Ás
.
width
 * ouše->
m©
.
yx
 +ƒx‹Ás.
height
 * ouše->m©.
yy
;

298 
ouše
->
šk_»ù
[3].
x
 = x + 
ex‹Ás
.
height
 * ouše->
m©
.
xy
;

299 
ouše
->
šk_»ù
[3].
y
 = y + 
ex‹Ás
.
height
 * ouše->
m©
.
yy
;

303 
PŞyBBExŒas
 
bbex
 = {0, 0, 
ouše
->
lše_width
/2, 0, 0 };

304 
	`pŞylše_bbox
 (&
ouše
->
šk_»ù
[0], 4, &
bbex
, 
TRUE
, &
obj
->
boundšg_box
);

307 
	`outše_upd©e_hªdËs
 (
ouše
),

309 
	`ÿœo_move_to
 (
ü
, -
ex‹Ás
.
x_b—ršg
, -ex‹Ás.
y_b—ršg
);

313 
ouše
->
m©
.
xx
 = 1.0;

314 
ouše
->
m©
.
xy
 = 0.0;

315 
ouše
->
m©
.
yx
 = 0.0;

316 
ouše
->
m©
.
yy
 = 1.0;

319 
	`ÿœo_‹xt_·th
 (
ü
, 
ouše
->
Çme
);

321 
	`ÿœo_rÙ©e
 (
ü
, 0.0);

322 
ouše
->
·th
 = 
	`ÿœo_cİy_·th
 (
ü
);

324 
	`ÿœo_de¡roy
 (
ü
);

325 
	}
}

327 
	$ouše_d¿w
(
Ouše
 *
ouše
, 
DŸR’d””
 *
»nd””
)

329 
DŸObjeù
 *
obj
 = &
ouše
->
objeù
;

330 
i
, 
n
 = 0, 
tÙ®
;

331 
BezPošt
 *
±s
;

332 
»®
 
x
, 
y
;

333 
Pošt
 
ps
 = {0, 0};

335 ià(!
ouše
->
·th
)

337 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`£t_lšewidth
 (»nd””, 
ouše
->
lše_width
);

338 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`£t_lše¡yË
 (»nd””, 
LINESTYLE_SOLID
);

339 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`£t_lšejoš
Ô’d””, 
LINEJOIN_MITER
);

340 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`£t_lšeÿps
Ô’d””, 
LINECAPS_ROUND
);

343 
x
 = 
obj
->
pos™iÚ
.x;

344 
y
 = 
obj
->
pos™iÚ
.y;

347 
tÙ®
 = 0;

348 
i
=0; i < 
ouše
->
·th
->
num_d©a
; i +ğouše->·th->
d©a
[i].
h—d”
.
Ëngth
) {

349 ++
tÙ®
;

352 
±s
 = 
	`g_®loÿ
 ((
BezPošt
)*(
tÙ®
));

353 
i
=0; i < 
ouše
->
·th
->
num_d©a
; i +ğouše->·th->
d©a
[i].
h—d”
.
Ëngth
) {

354 
ÿœo_·th_d©a_t
 *
d©a
 = &
ouše
->
·th
->d©a[
i
];

355 ià(
CAIRO_PATH_MOVE_TO
 =ğ
d©a
->
h—d”
.
ty³
) {

357 
±s
[
n
].
ty³
 = 
BEZ_MOVE_TO
;

358 
ps
.
x
 = 
±s
[
n
].
p1
.x = 
d©a
[1].
pošt
.x * 
ouše
->
m©
.
xx
 + d©a[1].pošt.
y
 * ouše->m©.
xy
 + x;

359 
ps
.
y
 = 
±s
[
n
].
p1
.y = 
d©a
[1].
pošt
.
x
 * 
ouše
->
m©
.
yx
 + d©a[1].pošt.y * ouše->m©.
yy
 + y;

360 ++
n
;

361 } ià(
CAIRO_PATH_LINE_TO
 =ğ
d©a
->
h—d”
.
ty³
) {

362 
±s
[
n
].
ty³
 = 
BEZ_LINE_TO
;

363 
±s
[
n
].
p1
.
x
 = 
d©a
[1].
pošt
.x * 
ouše
->
m©
.
xx
 + d©a[1].pošt.
y
 * ouše->m©.
xy
 + x;

364 
±s
[
n
].
p1
.
y
 = 
d©a
[1].
pošt
.
x
 * 
ouše
->
m©
.
yx
 + d©a[1].pošt.y * ouše->m©.
yy
 + y;

365 ++
n
;

366 } ià(
CAIRO_PATH_CURVE_TO
 =ğ
d©a
->
h—d”
.
ty³
) {

367 
±s
[
n
].
ty³
 = 
BEZ_CURVE_TO
;

368 
±s
[
n
].
p1
.
x
 = 
d©a
[1].
pošt
.x * 
ouše
->
m©
.
xx
 + d©a[1].pošt.
y
 * ouše->m©.
xy
 + x;

369 
±s
[
n
].
p1
.
y
 = 
d©a
[1].
pošt
.
x
 * 
ouše
->
m©
.
yx
 + d©a[1].pošt.y * ouše->m©.
yy
 + y;

370 
±s
[
n
].
p2
.
x
 = 
d©a
[2].
pošt
.x * 
ouše
->
m©
.
xx
 + d©a[2].pošt.
y
 * ouše->m©.
xy
 + x;

371 
±s
[
n
].
p2
.
y
 = 
d©a
[2].
pošt
.
x
 * 
ouše
->
m©
.
yx
 + d©a[2].pošt.y * ouše->m©.
yy
 + y;

372 
±s
[
n
].
p3
.
x
 = 
d©a
[3].
pošt
.x * 
ouše
->
m©
.
xx
 + d©a[3].pošt.
y
 * ouše->m©.
xy
 + x;

373 
±s
[
n
].
p3
.
y
 = 
d©a
[3].
pošt
.
x
 * 
ouše
->
m©
.
yx
 + d©a[3].pošt.y * ouše->m©.
yy
 + y;

374 ++
n
;

375 } ià(
CAIRO_PATH_CLOSE_PATH
 =ğ
d©a
->
h—d”
.
ty³
) {

376 
±s
[
n
].
ty³
 = 
BEZ_LINE_TO
;

377 
±s
[
n
].
p1
.
x
 = 
ps
.x;

378 
±s
[
n
].
p1
.
y
 = 
ps
.y;

379 ++
n
;

383 ià(
ouše
->
show_background
) {

385 
s1
 = 0, 
n1
 = 0;

386 
s2
 = 0;

387 
i
 = 1; i < 
tÙ®
; ++i) {

388 ià(
BEZ_MOVE_TO
 =ğ
±s
[
i
].
ty³
) {

391 
»®
 
di¡
 = 
	`di¡ªû_bez_sh­e_pošt
 (&
±s
[
s1
],

392 
n1
 > 0 ?‚1 : 
i
 - 
s1
, 0, &
±s
[i].
p1
);

393 ià(
s2
 > 
s1
) {

394 
n
 = 
i
 - 
s2
 - 1;

395 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`fl_bez›r
 (»nd””, &
±s
[
s2
], 
n
, &
cŞÜ_wh™e
);

397 
n1
 = 
n
 = 
i
 - 
s1
;

398 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`fl_bez›r
 (»nd””, &
±s
[
s1
], 
n
, &
ouše
->
fl_cŞÜ
);

400 ià(
di¡
 > 0) {

401 
s1
 = 
i
;

402 
n1
 = 0;

403 
s2
 = 0;

405 
s2
 = 
i
;

410 ià(
s2
 > 
s1
) {

411 ià(
s2
 - 
i
 - 1 > 1)

412 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`fl_bez›r
 (»nd””, &
±s
[
s2
], s2 - 
i
 - 1, &
cŞÜ_wh™e
);

414 ià(
s1
 - 
i
 - 1 > 1)

415 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`fl_bez›r
 (»nd””, &
±s
[
s1
], s1 - 
i
 - 1, &
ouše
->
fl_cŞÜ
);

418 
n
 = 0;

419 
i
 = 1; i < 
tÙ®
; ++i) {

420 ià(
BEZ_MOVE_TO
 =ğ
±s
[
i
].
ty³
) {

421 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`d¿w_bez›r
 (»nd””, &
±s
[
n
], 
i
 -‚, &
ouše
->
lše_cŞÜ
);

422 
n
 = 
i
;

426 ià(
i
 - 
n
 - 1 > 0)

427 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`d¿w_bez›r
 (»nd””, &
±s
[
n
], 
i
 -‚ - 1, &
ouše
->
lše_cŞÜ
);

428 
	}
}

430 
DŸM’u
 *

431 
	$ouše_g‘_objeù_m’u
(
Ouše
 *
ouše
, 
Pošt
 *
şickedpošt
)

433  
NULL
;

434 
	}
}

437 
PrİDesütiÚ
 *

438 
	$ouše_desüibe_´İs
 (
Ouše
 *
ouše
)

440 ià(
ouše_´İs
[0].
qu¬k
 == 0)

441 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
ouše_´İs
);

442  
ouše_´İs
;

443 
	}
}

445 
	$ouše_g‘_´İs
 (
Ouše
 *
ouše
, 
GPŒA¼ay
 *
´İs
)

447 
	`objeù_g‘_´İs_äom_off£ts
(&
ouše
->
objeù
, 
ouše_off£ts
, 
´İs
);

448 
	}
}

450 
	$ouše_£t_´İs
 (
Ouše
 *
ouše
, 
GPŒA¼ay
 *
´İs
)

452 
	`objeù_£t_´İs_äom_off£ts
(&
ouše
->
objeù
, 
ouše_off£ts
, 
´İs
);

453 
	`ouše_upd©e_d©a
 (
ouše
);

454 
	}
}

455 
»®


456 
	$ouše_di¡ªû_äom
 (
Ouše
 *
ouše
, 
Pošt
 *
pošt
)

458  
	`di¡ªû_pŞygÚ_pošt
 (&
ouše
->
šk_»ù
[0], 4, ouše->
lše_width
, 
pošt
);

459 
	}
}

460 
ObjeùChªge
*

461 
	$ouše_move_hªdË
 (
Ouše
 *
ouše
,

462 
HªdË
 *
hªdË
,

463 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

464 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

466 
DŸObjeù
 *
obj
 = &
ouše
->
objeù
;

467 
Pošt
 
¡¬t
 = 
obj
->
pos™iÚ
;

468 
Pošt
 
’d
 = 
ouše
->
šk_»ù
[2];

469 
»®
 
di¡
, 
Şd_di¡
 = 
	`di¡ªû_pošt_pošt
 (&
¡¬t
, &
’d
);

470 
Pošt
 
nÜm
 = 
’d
;

471 
	`pošt_sub
 (&
nÜm
, &
¡¬t
);

472 
	`pošt_nÜm®ize
 (&
nÜm
);

474 
hªdË
->
id
) {

475 
HANDLE_RESIZE_NW
 :

476 
¡¬t
 = *
to
;

478 
HANDLE_RESIZE_SE
 :

479 
’d
 = *
to
;

482 
	`g_w¬nšg
 ("Outline unknown handle");

484 
di¡
 = 
	`di¡ªû_pošt_pošt
 (&
¡¬t
, &
’d
);

486 ià(
di¡
 > 0.1) {

487 
obj
->
pos™iÚ
 = 
¡¬t
;

489 
ouše
->
fÚt_height
 *ğ(
di¡
 / 
Şd_di¡
);

491 
	`ouše_upd©e_d©a
 (
ouše
);

493  
NULL
;

494 
	}
}

495 
ObjeùChªge
*

496 
	$ouše_move
 (
Ouše
 *
ouše
, 
Pošt
 *
to
)

498 
DŸObjeù
 *
obj
 = &
ouše
->
objeù
;

500 
obj
->
pos™iÚ
 = *
to
;

502 
	`ouše_upd©e_d©a
 (
ouše
);

503  
NULL
;

504 
	}
}

505 
DŸObjeù
 *

506 
	$ouše_cİy
 (
Ouše
 *
äom
)

508 
Ouše
 *
to
;

510 
to
 = 
	`g_Ãw0
 (
Ouše
, 1);

511 
	`objeù_cİy
 (&
äom
->
objeù
, &
to
->object);

512 
	`ouše_š™_hªdËs
 (
to
);

513 
to
->
Çme
 = 
	`g_¡rdup
 (
äom
->name);

514 
to
->
rÙ©iÚ
 = 
äom
->rotation;

515 
to
->
fÚt
 = 
	`dŸ_fÚt_cİy
 (
äom
->font);

516 
to
->
fÚt_height
 = 
äom
->font_height;

517 
to
->
lše_width
 = 
äom
->line_width;

518 
to
->
lše_cŞÜ
 = 
äom
->line_color;

519 
to
->
fl_cŞÜ
 = 
äom
->fill_color;

520 
to
->
show_background
 = 
äom
->show_background;

522 
	`ouše_upd©e_d©a
 (
to
);

524  &
to
->
objeù
;

525 
	}
}

527 
	$ouše_de¡roy
 (
Ouše
 *
ouše
)

529 ià(
ouše
->
·th
)

530 
	`ÿœo_·th_de¡roy
 (
ouše
->
·th
);

531 
	`g_ä“
 (
ouše
->
Çme
);

532 
	`objeù_de¡roy
(&
ouše
->
objeù
);

534 
	}
}

536 
	$ouše_£Ëù
 (
Ouše
 *
ouše
, 
Pošt
 *
şicked_pošt
,

537 
DŸR’d””
 *
š‹¿ùive_»nd””
)

539 
	`outše_upd©e_hªdËs
 (
ouše
);

540 
	}
}

	@O:\tool\dvs50\objects\standard\polygon.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<as£¹.h
>

24 
	~<m©h.h
>

26 
	~"š.h
"

27 
	~"objeù.h
"

28 
	~"pŞysh­e.h
"

29 
	~"cÚÃùiÚpošt.h
"

30 
	~"dŸ»nd””.h
"

31 
	~"©Œibu‹s.h
"

32 
	~"widg‘s.h
"

33 
	~"dŸm’u.h
"

34 
	~"mes§ge.h
"

35 
	~"´İ”t›s.h
"

37 
	~"toŞ-icÚs.h
"

39 
	~"ü—‹.h
"

49 
	#DEFAULT_WIDTH
 0.15

	)

51 
	s_PŞygÚ
 {

52 
PŞySh­e
 
	mpŞy
;

54 
CŞÜ
 
	mlše_cŞÜ
;

55 
LšeStyË
 
	mlše_¡yË
;

56 
CŞÜ
 
	mšÃr_cŞÜ
;

57 
gboŞ—n
 
	mshow_background
;

58 
»®
 
	mdashËngth
;

59 
»®
 
	mlše_width
;

60 } 
	tPŞygÚ
;

62 
	s_PŞygÚPrİ”t›s
 {

63 
gboŞ—n
 
	mshow_background
;

64 } 
	gdeçuÉ_´İ”t›s
 = { 
TRUE
 };

66 
ObjeùChªge
* 
pŞygÚ_move_hªdË
(
PŞygÚ
 *
pŞygÚ
, 
HªdË
 *
hªdË
,

67 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

68 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

69 
ObjeùChªge
* 
pŞygÚ_move
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
to
);

70 
pŞygÚ_£Ëù
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
şicked_pošt
,

71 
DŸR’d””
 *
š‹¿ùive_»nd””
);

72 
pŞygÚ_d¿w
(
PŞygÚ
 *
pŞygÚ
, 
DŸR’d””
 *
»nd””
);

73 
DŸObjeù
 *
pŞygÚ_ü—‹
(
Pošt
 *
¡¬ošt
,

74 *
u£r_d©a
,

75 
HªdË
 **
hªdË1
,

76 
HªdË
 **
hªdË2
);

77 
»®
 
pŞygÚ_di¡ªû_äom
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
pošt
);

78 
pŞygÚ_upd©e_d©a
(
PŞygÚ
 *
pŞygÚ
);

79 
pŞygÚ_de¡roy
(
PŞygÚ
 *
pŞygÚ
);

80 
DŸObjeù
 *
pŞygÚ_cİy
(
PŞygÚ
 *
pŞygÚ
);

82 
PrİDesütiÚ
 *
pŞygÚ_desüibe_´İs
(
PŞygÚ
 *
pŞygÚ
);

83 
pŞygÚ_g‘_´İs
(
PŞygÚ
 *
pŞygÚ
, 
GPŒA¼ay
 *
´İs
);

84 
pŞygÚ_£t_´İs
(
PŞygÚ
 *
pŞygÚ
, 
GPŒA¼ay
 *
´İs
);

86 
pŞygÚ_§ve
(
PŞygÚ
 *
pŞygÚ
, 
ObjeùNode
 
obj_node
,

87 cÚ¡ *
f’ame
);

88 
DŸObjeù
 *
pŞygÚ_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
,

89 cÚ¡ *
f’ame
);

90 
DŸM’u
 *
pŞygÚ_g‘_objeù_m’u
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
şickedpošt
);

92 
ObjeùTy³Ops
 
	gpŞygÚ_ty³_İs
 =

94 (
C»©eFunc
)
pŞygÚ_ü—‹
,

95 (
LßdFunc
è
pŞygÚ_lßd
,

96 (
SaveFunc
è
pŞygÚ_§ve
,

97 (
G‘DeçuÉsFunc
è
NULL
,

98 (
AµlyDeçuÉsFunc
è
NULL
,

101 
DŸObjeùTy³
 
	gpŞygÚ_ty³
 =

105 (**è
pŞygÚ_icÚ
,

107 &
pŞygÚ_ty³_İs
,

108 
NULL
,

112 
DŸObjeùTy³
 *
	g_pŞygÚ_ty³
 = (DŸObjeùTy³ *è&
pŞygÚ_ty³
;

115 
ObjeùOps
 
	gpŞygÚ_İs
 = {

116 (
De¡royFunc
è
pŞygÚ_de¡roy
,

117 (
D¿wFunc
è
pŞygÚ_d¿w
,

118 (
Di¡ªûFunc
è
pŞygÚ_di¡ªû_äom
,

119 (
S–eùFunc
è
pŞygÚ_£Ëù
,

120 (
CİyFunc
è
pŞygÚ_cİy
,

121 (
MoveFunc
è
pŞygÚ_move
,

122 (
MoveHªdËFunc
è
pŞygÚ_move_hªdË
,

123 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

124 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

125 (
ObjeùM’uFunc
è
pŞygÚ_g‘_objeù_m’u
,

126 (
DesüibePrİsFunc
è
pŞygÚ_desüibe_´İs
,

127 (
G‘PrİsFunc
è
pŞygÚ_g‘_´İs
,

128 (
S‘PrİsFunc
è
pŞygÚ_£t_´İs
,

129 (
TextEd™Func
) 0,

130 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

133 
PrİDesütiÚ
 
	gpŞygÚ_´İs
[] = {

134 
POLYSHAPE_COMMON_PROPERTIES
,

135 
PROP_STD_LINE_WIDTH
,

136 
PROP_STD_LINE_COLOUR
,

137 
PROP_STD_LINE_STYLE
,

138 
PROP_STD_FILL_COLOUR
,

139 
PROP_STD_SHOW_BACKGROUND
,

140 
PROP_DESC_END


143 
PrİDesütiÚ
 *

144 
	$pŞygÚ_desüibe_´İs
(
PŞygÚ
 *
pŞygÚ
)

146 ià(
pŞygÚ_´İs
[0].
qu¬k
 == 0)

147 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
pŞygÚ_´İs
);

148  
pŞygÚ_´İs
;

149 
	}
}

151 
PrİOff£t
 
	gpŞygÚ_off£ts
[] = {

152 
POLYSHAPE_COMMON_PROPERTIES_OFFSETS
,

153 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
PŞygÚ
, 
lše_width
) },

154 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
PŞygÚ
, 
lše_cŞÜ
) },

155 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

156 
off£tof
(
PŞygÚ
, 
lše_¡yË
), off£tof(PŞygÚ, 
dashËngth
) },

157 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
PŞygÚ
, 
šÃr_cŞÜ
) },

158 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
PŞygÚ
, 
show_background
) },

159 { 
NULL
, 0, 0 }

163 
	$pŞygÚ_g‘_´İs
(
PŞygÚ
 *
pŞygÚ
, 
GPŒA¼ay
 *
´İs
)

165 
	`objeù_g‘_´İs_äom_off£ts
(&
pŞygÚ
->
pŞy
.
objeù
,

166 
pŞygÚ_off£ts
, 
´İs
);

167 
	}
}

170 
	$pŞygÚ_£t_´İs
(
PŞygÚ
 *
pŞygÚ
, 
GPŒA¼ay
 *
´İs
)

172 
	`objeù_£t_´İs_äom_off£ts
(&
pŞygÚ
->
pŞy
.
objeù
,

173 
pŞygÚ_off£ts
, 
´İs
);

174 
	`pŞygÚ_upd©e_d©a
(
pŞygÚ
);

175 
	}
}

177 
»®


178 
	$pŞygÚ_di¡ªû_äom
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
pošt
)

180  
	`pŞysh­e_di¡ªû_äom
(&
pŞygÚ
->
pŞy
, 
pošt
,…ŞygÚ->
lše_width
);

181 
	}
}

183 
HªdË
 *
	$pŞygÚ_şo£¡_hªdË
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
pošt
) {

184  
	`pŞysh­e_şo£¡_hªdË
(&
pŞygÚ
->
pŞy
, 
pošt
);

185 
	}
}

187 
	$pŞygÚ_şo£¡_£gm’t
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
pošt
) {

188  
	`pŞysh­e_şo£¡_£gm’t
(&
pŞygÚ
->
pŞy
, 
pošt
,…ŞygÚ->
lše_width
);

189 
	}
}

192 
	$pŞygÚ_£Ëù
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
şicked_pošt
,

193 
DŸR’d””
 *
š‹¿ùive_»nd””
)

195 
	`pŞysh­e_upd©e_d©a
(&
pŞygÚ
->
pŞy
);

196 
	}
}

198 
ObjeùChªge
*

199 
	$pŞygÚ_move_hªdË
(
PŞygÚ
 *
pŞygÚ
, 
HªdË
 *
hªdË
,

200 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

201 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

203 
	`as£¹
(
pŞygÚ
!=
NULL
);

204 
	`as£¹
(
hªdË
!=
NULL
);

205 
	`as£¹
(
to
!=
NULL
);

207 
	`pŞysh­e_move_hªdË
(&
pŞygÚ
->
pŞy
, 
hªdË
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

208 
	`pŞygÚ_upd©e_d©a
(
pŞygÚ
);

210  
NULL
;

211 
	}
}

214 
ObjeùChªge
*

215 
	$pŞygÚ_move
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
to
)

217 
	`pŞysh­e_move
(&
pŞygÚ
->
pŞy
, 
to
);

218 
	`pŞygÚ_upd©e_d©a
(
pŞygÚ
);

220  
NULL
;

221 
	}
}

224 
	$pŞygÚ_d¿w
(
PŞygÚ
 *
pŞygÚ
, 
DŸR’d””
 *
»nd””
)

226 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

227 
PŞySh­e
 *
pŞy
 = &
pŞygÚ
->poly;

228 
Pošt
 *
pošts
;

229 
n
;

231 
pošts
 = &
pŞy
->points[0];

232 
n
 = 
pŞy
->
numpošts
;

234 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
pŞygÚ
->
lše_width
);

235 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
pŞygÚ
->
lše_¡yË
);

236 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
pŞygÚ
->
dashËngth
);

237 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_MITER
);

238 
»nd””_İs
->
	`£t_lšeÿps
(
»nd””
, 
LINECAPS_BUTT
);

240 ià(
pŞygÚ
->
show_background
)

241 
»nd””_İs
->
	`fl_pŞygÚ
(
»nd””
, 
pošts
, 
n
, &
pŞygÚ
->
šÃr_cŞÜ
);

243 
»nd””_İs
->
	`d¿w_pŞygÚ
(
»nd””
, 
pošts
, 
n
, &
pŞygÚ
->
lše_cŞÜ
);

244 
	}
}

246 
DŸObjeù
 *

247 
	$pŞygÚ_ü—‹
(
Pošt
 *
¡¬ošt
,

248 *
u£r_d©a
,

249 
HªdË
 **
hªdË1
,

250 
HªdË
 **
hªdË2
)

252 
PŞygÚ
 *
pŞygÚ
;

253 
PŞySh­e
 *
pŞy
;

254 
DŸObjeù
 *
obj
;

255 
Pošt
 
deçuÉx
 = { 1.0, 0.0 };

256 
Pošt
 
deçuÉy
 = { 0.0, 1.0 };

258 
pŞygÚ
 = 
	`g_Ãw0
(
PŞygÚ
, 1);

259 
pŞy
 = &
pŞygÚ
->poly;

260 
obj
 = &
pŞy
->
objeù
;

262 
obj
->
ty³
 = &
pŞygÚ_ty³
;

263 
obj
->
İs
 = &
pŞygÚ_İs
;

265 ià(
u£r_d©a
 =ğ
NULL
) {

266 
	`pŞysh­e_š™
(
pŞy
, 3);

268 
pŞy
->
pošts
[0] = *
¡¬ošt
;

269 
pŞy
->
pošts
[1] = *
¡¬ošt
;

270 
	`pošt_add
(&
pŞy
->
pošts
[1], &
deçuÉx
);

271 
pŞy
->
pošts
[2] = *
¡¬ošt
;

272 
	`pošt_add
(&
pŞy
->
pošts
[2], &
deçuÉy
);

274 
MuÉoštC»©eD©a
 *
pcd
 = (MuÉoštC»©eD©¨*)
u£r_d©a
;

276 
	`pŞysh­e_š™
(
pŞy
, 
pcd
->
num_pošts
);

277 
	`pŞysh­e_£t_pošts
(
pŞy
, 
pcd
->
num_pošts
,…cd->
pošts
);

280 
pŞygÚ
->
lše_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

281 
pŞygÚ
->
lše_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

282 
pŞygÚ
->
šÃr_cŞÜ
 = 
	`©Œibu‹s_g‘_background
();

283 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
pŞygÚ
->
lše_¡yË
,

284 &
pŞygÚ
->
dashËngth
);

285 
pŞygÚ
->
show_background
 = 
deçuÉ_´İ”t›s
.show_background;

287 
	`pŞygÚ_upd©e_d©a
(
pŞygÚ
);

289 *
hªdË1
 = 
pŞy
->
objeù
.
hªdËs
[0];

290 *
hªdË2
 = 
pŞy
->
objeù
.
hªdËs
[2];

291  &
pŞygÚ
->
pŞy
.
objeù
;

292 
	}
}

295 
	$pŞygÚ_de¡roy
(
PŞygÚ
 *
pŞygÚ
)

297 
	`pŞysh­e_de¡roy
(&
pŞygÚ
->
pŞy
);

298 
	}
}

300 
DŸObjeù
 *

301 
	$pŞygÚ_cİy
(
PŞygÚ
 *
pŞygÚ
)

303 
PŞygÚ
 *
ÃwpŞygÚ
;

304 
PŞySh­e
 *
pŞy
, *
ÃwpŞy
;

305 
DŸObjeù
 *
Ãwobj
;

307 
pŞy
 = &
pŞygÚ
->poly;

309 
ÃwpŞygÚ
 = 
	`g_m®loc0
((
PŞygÚ
));

310 
ÃwpŞy
 = &
ÃwpŞygÚ
->
pŞy
;

311 
Ãwobj
 = &
ÃwpŞy
->
objeù
;

313 
	`pŞysh­e_cİy
(
pŞy
, 
ÃwpŞy
);

315 
ÃwpŞygÚ
->
lše_cŞÜ
 = 
pŞygÚ
->line_color;

316 
ÃwpŞygÚ
->
lše_width
 = 
pŞygÚ
->line_width;

317 
ÃwpŞygÚ
->
lše_¡yË
 = 
pŞygÚ
->line_style;

318 
ÃwpŞygÚ
->
dashËngth
 = 
pŞygÚ
->dashlength;

319 
ÃwpŞygÚ
->
šÃr_cŞÜ
 = 
pŞygÚ
->inner_color;

320 
ÃwpŞygÚ
->
show_background
 = 
pŞygÚ
->show_background;

322  &
ÃwpŞygÚ
->
pŞy
.
objeù
;

323 
	}
}

327 
	$pŞygÚ_upd©e_d©a
(
PŞygÚ
 *
pŞygÚ
)

329 
PŞySh­e
 *
pŞy
 = &
pŞygÚ
->poly;

330 
DŸObjeù
 *
obj
 = &
pŞy
->
objeù
;

331 
EËm’tBBExŒas
 *
exŒa
 = &
pŞy
->
exŒa_¥acšg
;

333 
	`pŞysh­e_upd©e_d©a
(
pŞy
);

335 
exŒa
->
bÜd”_Œªs
 = 
pŞygÚ
->
lše_width
 / 2.0;

336 
	`pŞysh­e_upd©e_boundšgbox
(
pŞy
);

338 
obj
->
pos™iÚ
 = 
pŞy
->
pošts
[0];

339 
	}
}

342 
	$pŞygÚ_§ve
(
PŞygÚ
 *
pŞygÚ
, 
ObjeùNode
 
obj_node
,

343 cÚ¡ *
f’ame
)

345 
	`pŞysh­e_§ve
(&
pŞygÚ
->
pŞy
, 
obj_node
);

347 ià(!
	`cŞÜ_equ®s
(&
pŞygÚ
->
lše_cŞÜ
, &
cŞÜ_bÏck
))

348 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "line_color"),

349 &
pŞygÚ
->
lše_cŞÜ
);

351 ià(
pŞygÚ
->
lše_width
 != 0.1)

352 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

353 
pŞygÚ
->
lše_width
);

355 ià(!
	`cŞÜ_equ®s
(&
pŞygÚ
->
šÃr_cŞÜ
, &
cŞÜ_wh™e
))

356 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "inner_color"),

357 &
pŞygÚ
->
šÃr_cŞÜ
);

359 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
obj_node
, "show_background"),

360 
pŞygÚ
->
show_background
);

362 ià(
pŞygÚ
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
)

363 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

364 
pŞygÚ
->
lše_¡yË
);

366 ià(
pŞygÚ
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
 &&

367 
pŞygÚ
->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

368 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

369 
pŞygÚ
->
dashËngth
);

371 
	}
}

373 
DŸObjeù
 *

374 
	$pŞygÚ_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

376 
PŞygÚ
 *
pŞygÚ
;

377 
PŞySh­e
 *
pŞy
;

378 
DŸObjeù
 *
obj
;

379 
A‰ribu‹Node
 
©Œ
;

381 
pŞygÚ
 = 
	`g_m®loc0
((
PŞygÚ
));

383 
pŞy
 = &
pŞygÚ
->poly;

384 
obj
 = &
pŞy
->
objeù
;

386 
obj
->
ty³
 = &
pŞygÚ_ty³
;

387 
obj
->
İs
 = &
pŞygÚ_İs
;

389 
	`pŞysh­e_lßd
(
pŞy
, 
obj_node
);

391 
pŞygÚ
->
lše_cŞÜ
 = 
cŞÜ_bÏck
;

392 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_color");

393 ià(
©Œ
 !ğ
NULL
)

394 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
pŞygÚ
->
lše_cŞÜ
);

396 
pŞygÚ
->
lše_width
 = 0.1;

397 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

398 ià(
©Œ
 !ğ
NULL
)

399 
pŞygÚ
->
lše_width
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

401 
pŞygÚ
->
šÃr_cŞÜ
 = 
cŞÜ_wh™e
;

402 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "inner_color");

403 ià(
©Œ
 !ğ
NULL
)

404 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
pŞygÚ
->
šÃr_cŞÜ
);

406 
pŞygÚ
->
show_background
 = 
TRUE
;

407 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "show_background");

408 ià(
©Œ
 !ğ
NULL
)

409 
pŞygÚ
->
show_background
 = 
	`d©a_boŞ—n
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

411 
pŞygÚ
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

412 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

413 ià(
©Œ
 !ğ
NULL
)

414 
pŞygÚ
->
lše_¡yË
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

416 
pŞygÚ
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

417 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

418 ià(
©Œ
 !ğ
NULL
)

419 
pŞygÚ
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

421 
	`pŞygÚ_upd©e_d©a
(
pŞygÚ
);

423  &
pŞygÚ
->
pŞy
.
objeù
;

424 
	}
}

426 
ObjeùChªge
 *

427 
	$pŞygÚ_add_cÜÃr_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

429 
PŞygÚ
 *
pŞy
 = (PŞygÚ*è
obj
;

430 
£gm’t
;

431 
ObjeùChªge
 *
chªge
;

433 
£gm’t
 = 
	`pŞygÚ_şo£¡_£gm’t
(
pŞy
, 
şicked
);

434 
chªge
 = 
	`pŞysh­e_add_pošt
(&
pŞy
->pŞy, 
£gm’t
, 
şicked
);

436 
	`pŞygÚ_upd©e_d©a
(
pŞy
);

437  
chªge
;

438 
	}
}

440 
ObjeùChªge
 *

441 
	$pŞygÚ_d–‘e_cÜÃr_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

443 
HªdË
 *
hªdË
;

444 
hªdË_Ä
, 
i
;

445 
PŞygÚ
 *
pŞy
 = (PŞygÚ*è
obj
;

446 
ObjeùChªge
 *
chªge
;

448 
hªdË
 = 
	`pŞygÚ_şo£¡_hªdË
(
pŞy
, 
şicked
);

450 
i
 = 0; i < 
obj
->
num_hªdËs
; i++) {

451 ià(
hªdË
 =ğ
obj
->
hªdËs
[
i
]) ;

453 
hªdË_Ä
 = 
i
;

454 
chªge
 = 
	`pŞysh­e_»move_pošt
(&
pŞy
->pŞy, 
hªdË_Ä
);

456 
	`pŞygÚ_upd©e_d©a
(
pŞy
);

457  
chªge
;

458 
	}
}

461 
DŸM’uI‹m
 
	gpŞygÚ_m’u_™ems
[] = {

462 { 
N_
("Add CÜÃr"), 
pŞygÚ_add_cÜÃr_ÿÎback
, 
NULL
, 1 },

463 { 
N_
("D–‘CÜÃr"), 
pŞygÚ_d–‘e_cÜÃr_ÿÎback
, 
NULL
, 1 },

466 
DŸM’u
 
	gpŞygÚ_m’u
 = {

468 (
pŞygÚ_m’u_™ems
)/(
DŸM’uI‹m
),

469 
pŞygÚ_m’u_™ems
,

470 
NULL


473 
DŸM’u
 *

474 
	$pŞygÚ_g‘_objeù_m’u
(
PŞygÚ
 *
pŞygÚ
, 
Pošt
 *
şickedpošt
)

477 
pŞygÚ_m’u_™ems
[0].
aùive
 = 1;

478 
pŞygÚ_m’u_™ems
[1].
aùive
 = 
pŞygÚ
->
pŞy
.
numpošts
 > 3;

479  &
pŞygÚ_m’u
;

480 
	}
}

	@O:\tool\dvs50\objects\standard\polyline.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<as£¹.h
>

24 
	~<m©h.h
>

26 
	~"š.h
"

27 
	~"objeù.h
"

28 
	~"pŞy_cÚn.h
"

29 
	~"cÚÃùiÚpošt.h
"

30 
	~"dŸ»nd””.h
"

31 
	~"©Œibu‹s.h
"

32 
	~"widg‘s.h
"

33 
	~"dŸm’u.h
"

34 
	~"mes§ge.h
"

35 
	~"´İ”t›s.h
"

37 
	~"ü—‹.h
"

39 
	~"toŞ-icÚs.h
"

41 
	#DEFAULT_WIDTH
 0.15

	)

43 
	s_PŞylše
 {

44 
PŞyCÚn
 
	mpŞy
;

46 
CŞÜ
 
	mlše_cŞÜ
;

47 
LšeStyË
 
	mlše_¡yË
;

48 
»®
 
	mdashËngth
;

49 
»®
 
	mlše_width
;

50 
»®
 
	mcÜÃr_¿dius
;

51 
A¼ow
 
	m¡¬t_¬row
, 
	m’d_¬row
;

52 
»®
 
	mabsŞu‹_¡¬t_g­
, 
	mabsŞu‹_’d_g­
;

53 } 
	tPŞylše
;

56 
ObjeùChªge
* 
pŞylše_move_hªdË
(
PŞylše
 *
pŞylše
, 
HªdË
 *
hªdË
,

57 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

58 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

59 
ObjeùChªge
* 
pŞylše_move
(
PŞylše
 *
pŞylše
, 
Pošt
 *
to
);

60 
pŞylše_£Ëù
(
PŞylše
 *
pŞylše
, 
Pošt
 *
şicked_pošt
,

61 
DŸR’d””
 *
š‹¿ùive_»nd””
);

62 
pŞylše_d¿w
(
PŞylše
 *
pŞylše
, 
DŸR’d””
 *
»nd””
);

63 
DŸObjeù
 *
pŞylše_ü—‹
(
Pošt
 *
¡¬ošt
,

64 *
u£r_d©a
,

65 
HªdË
 **
hªdË1
,

66 
HªdË
 **
hªdË2
);

67 
»®
 
pŞylše_di¡ªû_äom
(
PŞylše
 *
pŞylše
, 
Pošt
 *
pošt
);

68 
pŞylše_upd©e_d©a
(
PŞylše
 *
pŞylše
);

69 
pŞylše_de¡roy
(
PŞylše
 *
pŞylše
);

70 
DŸObjeù
 *
pŞylše_cİy
(
PŞylše
 *
pŞylše
);

72 
PrİDesütiÚ
 *
pŞylše_desüibe_´İs
(
PŞylše
 *
pŞylše
);

73 
pŞylše_g‘_´İs
(
PŞylše
 *
pŞylše
, 
GPŒA¼ay
 *
´İs
);

74 
pŞylše_£t_´İs
(
PŞylše
 *
pŞylše
, 
GPŒA¼ay
 *
´İs
);

76 
pŞylše_§ve
(
PŞylše
 *
pŞylše
, 
ObjeùNode
 
obj_node
,

77 cÚ¡ *
f’ame
);

78 
DŸObjeù
 *
pŞylše_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
,

79 cÚ¡ *
f’ame
);

80 
DŸM’u
 *
pŞylše_g‘_objeù_m’u
(
PŞylše
 *
pŞylše
, 
Pošt
 *
şickedpošt
);

81 
pŞylše_ÿlcuÏ‹_g­_’dpošts
(
PŞylše
 *
pŞylše
, 
Pošt
 *
g­_’dpošts
);

82 
pŞylše_exchªge_g­_pošts
(
PŞylše
 *
pŞylše
, 
Pošt
 *
g­_pošts
);

84 
ObjeùTy³Ops
 
	gpŞylše_ty³_İs
 =

86 (
C»©eFunc
)
pŞylše_ü—‹
,

87 (
LßdFunc
è
pŞylše_lßd
,

88 (
SaveFunc
è
pŞylše_§ve
,

89 (
G‘DeçuÉsFunc
è
NULL
 ,

90 (
AµlyDeçuÉsFunc
è
NULL


93 
DŸObjeùTy³
 
	gpŞylše_ty³
 =

97 (**è
pŞylše_icÚ
,

99 &
pŞylše_ty³_İs
,

100 
NULL
,

104 
DŸObjeùTy³
 *
	g_pŞylše_ty³
 = (DŸObjeùTy³ *è&
pŞylše_ty³
;

107 
ObjeùOps
 
	gpŞylše_İs
 = {

108 (
De¡royFunc
è
pŞylše_de¡roy
,

109 (
D¿wFunc
è
pŞylše_d¿w
,

110 (
Di¡ªûFunc
è
pŞylše_di¡ªû_äom
,

111 (
S–eùFunc
è
pŞylše_£Ëù
,

112 (
CİyFunc
è
pŞylše_cİy
,

113 (
MoveFunc
è
pŞylše_move
,

114 (
MoveHªdËFunc
è
pŞylše_move_hªdË
,

115 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

116 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

117 (
ObjeùM’uFunc
è
pŞylše_g‘_objeù_m’u
,

118 (
DesüibePrİsFunc
è
pŞylše_desüibe_´İs
,

119 (
G‘PrİsFunc
è
pŞylše_g‘_´İs
,

120 (
S‘PrİsFunc
è
pŞylše_£t_´İs
,

121 (
TextEd™Func
) 0,

122 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

125 
PrİNumD©a
 
	gpŞylše_cÜÃr_¿dius_d©a
 = { 0.0, 10.0, 0.1 };

126 
PrİNumD©a
 
	gg­_¿nge
 = { -
G_MAXFLOAT
, G_MAXFLOAT, 0.1};

128 
PrİDesütiÚ
 
	gpŞylše_´İs
[] = {

129 
POLYCONN_COMMON_PROPERTIES
,

130 
PROP_STD_LINE_WIDTH
,

131 
PROP_STD_LINE_COLOUR
,

132 
PROP_STD_LINE_STYLE
,

133 
PROP_STD_START_ARROW
,

134 
PROP_STD_END_ARROW
,

135 { "cÜÃr_¿dius", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

136 
N_
("CÜÃ¸¿dius"), 
NULL
, &
pŞylše_cÜÃr_¿dius_d©a
 },

137 
PROP_FRAME_BEGIN
("g­s",0,
N_
("Line gaps")),

138 { "absŞu‹_¡¬t_g­", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

139 
N_
("AbsŞu‹ s¹ g­"), 
NULL
, &
g­_¿nge
 },

140 { "absŞu‹_’d_g­", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

141 
N_
("AbsŞu‹ƒnd g­"), 
NULL
, &
g­_¿nge
 },

142 
PROP_FRAME_END
("gaps",0),

143 
PROP_DESC_END


146 
PrİDesütiÚ
 *

147 
	$pŞylše_desüibe_´İs
(
PŞylše
 *
pŞylše
)

149 ià(
pŞylše_´İs
[0].
qu¬k
 == 0)

150 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
pŞylše_´İs
);

151  
pŞylše_´İs
;

152 
	}
}

154 
PrİOff£t
 
	gpŞylše_off£ts
[] = {

155 
POLYCONN_COMMON_PROPERTIES_OFFSETS
,

156 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
PŞylše
, 
lše_width
) },

157 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
PŞylše
, 
lše_cŞÜ
) },

158 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

159 
off£tof
(
PŞylše
, 
lše_¡yË
), off£tof(PŞylše, 
dashËngth
) },

160 { "¡¬t_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
PŞylše
, 
¡¬t_¬row
) },

161 { "’d_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
PŞylše
, 
’d_¬row
) },

162 { "cÜÃr_¿dius", 
PROP_TYPE_REAL
, 
off£tof
(
PŞylše
, 
cÜÃr_¿dius
) },

163 
PROP_OFFSET_FRAME_BEGIN
("gaps"),

164 { "absŞu‹_¡¬t_g­", 
PROP_TYPE_REAL
, 
off£tof
(
PŞylše
, 
absŞu‹_¡¬t_g­
) },

165 { "absŞu‹_’d_g­", 
PROP_TYPE_REAL
, 
off£tof
(
PŞylše
, 
absŞu‹_’d_g­
) },

166 
PROP_OFFSET_FRAME_END
("gaps"),

167 { 
NULL
, 0, 0 }

171 
	$pŞylše_g‘_´İs
(
PŞylše
 *
pŞylše
, 
GPŒA¼ay
 *
´İs
)

173 
	`objeù_g‘_´İs_äom_off£ts
(&
pŞylše
->
pŞy
.
objeù
, 
pŞylše_off£ts
,

174 
´İs
);

175 
	}
}

178 
	$pŞylše_£t_´İs
(
PŞylše
 *
pŞylše
, 
GPŒA¼ay
 *
´İs
)

180 
	`objeù_£t_´İs_äom_off£ts
(&
pŞylše
->
pŞy
.
objeù
, 
pŞylše_off£ts
,

181 
´İs
);

182 
	`pŞylše_upd©e_d©a
(
pŞylše
);

183 
	}
}

185 
»®


186 
	$pŞylše_di¡ªû_äom
(
PŞylše
 *
pŞylše
, 
Pošt
 *
pošt
)

188 
PŞyCÚn
 *
pŞy
 = &
pŞylše
->poly;

189 
»®
 
di¡
;

190 
Pošt
 
g­_’dpošts
[2];

191 
	`pŞylše_ÿlcuÏ‹_g­_’dpošts
(
pŞylše
, 
g­_’dpošts
);

192 
	`pŞylše_exchªge_g­_pošts
(
pŞylše
, 
g­_’dpošts
);

193 
di¡
 = 
	`pŞycÚn_di¡ªû_äom
(
pŞy
, 
pošt
, 
pŞylše
->
lše_width
);

194 
	`pŞylše_exchªge_g­_pošts
(
pŞylše
, 
g­_’dpošts
);

195  
di¡
;

196 
	}
}

198 
HªdË
 *
	$pŞylše_şo£¡_hªdË
(
PŞylše
 *
pŞylše
, 
Pošt
 *
pošt
) {

199  
	`pŞycÚn_şo£¡_hªdË
(&
pŞylše
->
pŞy
, 
pošt
);

200 
	}
}

202 
	$pŞylše_şo£¡_£gm’t
(
PŞylše
 *
pŞylše
, 
Pošt
 *
pošt
) {

203 
PŞyCÚn
 *
pŞy
 = &
pŞylše
->poly;

204  
	`pŞycÚn_şo£¡_£gm’t
(
pŞy
, 
pošt
, 
pŞylše
->
lše_width
);

205 
	}
}

208 
	$pŞylše_£Ëù
(
PŞylše
 *
pŞylše
, 
Pošt
 *
şicked_pošt
,

209 
DŸR’d””
 *
š‹¿ùive_»nd””
)

211 
	`pŞycÚn_upd©e_d©a
(&
pŞylše
->
pŞy
);

212 
	}
}

214 
ObjeùChªge
*

215 
	$pŞylše_move_hªdË
(
PŞylše
 *
pŞylše
, 
HªdË
 *
hªdË
,

216 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

217 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

219 
	`as£¹
(
pŞylše
!=
NULL
);

220 
	`as£¹
(
hªdË
!=
NULL
);

221 
	`as£¹
(
to
!=
NULL
);

223 
	`pŞycÚn_move_hªdË
(&
pŞylše
->
pŞy
, 
hªdË
, 
to
, 
ı
, 
»asÚ
, 
modif›rs
);

224 
	`pŞylše_upd©e_d©a
(
pŞylše
);

226  
NULL
;

227 
	}
}

230 
ObjeùChªge
*

231 
	$pŞylše_move
(
PŞylše
 *
pŞylše
, 
Pošt
 *
to
)

233 
	`pŞycÚn_move
(&
pŞylše
->
pŞy
, 
to
);

234 
	`pŞylše_upd©e_d©a
(
pŞylše
);

236  
NULL
;

237 
	}
}

240 
	$pŞylše_ÿlcuÏ‹_g­_’dpošts
(
PŞylše
 *
pŞylše
, 
Pošt
 *
g­_’dpošts
)

242 
Pošt
 
¡¬t_vec
, 
’d_vec
;

243 
CÚÃùiÚPošt
 *
¡¬t_ı
, *
’d_ı
;

244 
n
 = 
pŞylše
->
pŞy
.
numpošts
;

246 
g­_’dpošts
[0] = 
pŞylše
->
pŞy
.
pošts
[0];

247 
g­_’dpošts
[1] = 
pŞylše
->
pŞy
.
pošts
[
n
-1];

249 
¡¬t_ı
 = (
pŞylše
->
pŞy
.
objeù
.
hªdËs
[0])->
cÚÃùed_to
;

250 
’d_ı
 = (
pŞylše
->
pŞy
.
objeù
.
hªdËs
[pŞylše->pŞy.objeù.
num_hªdËs
-1])->
cÚÃùed_to
;

252 ià(
	`cÚÅošt_is_autog­
(
¡¬t_ı
)) {

253 
g­_’dpošts
[0] = 
	`ÿlcuÏ‹_objeù_edge
(&gap_endpoints[0],

254 &
pŞylše
->
pŞy
.
pošts
[1],

255 
¡¬t_ı
->
objeù
);

257 ià(
	`cÚÅošt_is_autog­
(
’d_ı
)) {

258 
g­_’dpošts
[1] = 
	`ÿlcuÏ‹_objeù_edge
(&gap_endpoints[1],

259 &
pŞylše
->
pŞy
.
pošts
[
n
-2],

260 
’d_ı
->
objeù
);

263 
¡¬t_vec
 = 
g­_’dpošts
[0];

264 
	`pošt_sub
(&
¡¬t_vec
, &
pŞylše
->
pŞy
.
pošts
[0]);

265 
	`pošt_nÜm®ize
(&
¡¬t_vec
);

267 
’d_vec
 = 
g­_’dpošts
[1];

268 
	`pošt_sub
(&
’d_vec
, &
pŞylše
->
pŞy
.
pošts
[
n
-1]);

269 
	`pošt_nÜm®ize
(&
’d_vec
);

272 
	`pošt_add_sÿËd
(&
g­_’dpošts
[0], &
¡¬t_vec
, 
pŞylše
->
absŞu‹_¡¬t_g­
);

273 
	`pošt_add_sÿËd
(&
g­_’dpošts
[1], &
’d_vec
, 
pŞylše
->
absŞu‹_’d_g­
);

274 
	}
}

276 
	$pŞylše_exchªge_g­_pošts
(
PŞylše
 *
pŞylše
, 
Pošt
 *
g­_pošts
)

278 
Pošt
 
tmp
[2];

279 
n
 = 
pŞylše
->
pŞy
.
numpošts
;

280 
tmp
[0] = 
g­_pošts
[0];

281 
tmp
[1] = 
g­_pošts
[1];

282 
g­_pošts
[0] = 
pŞylše
->
pŞy
.
pošts
[0];

283 
g­_pošts
[1] = 
pŞylše
->
pŞy
.
pošts
[
n
-1];

284 
pŞylše
->
pŞy
.
pošts
[0] = 
tmp
[0];

285 
pŞylše
->
pŞy
.
pošts
[
n
-1] = 
tmp
[1];

286 
	}
}

290 
	$pŞylše_d¿w
(
PŞylše
 *
pŞylše
, 
DŸR’d””
 *
»nd””
)

292 
Pošt
 
g­_’dpošts
[2];

293 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

294 
PŞyCÚn
 *
pŞy
 = &
pŞylše
->poly;

295 
Pošt
 *
pošts
;

296 
n
;

298 
pošts
 = &
pŞy
->points[0];

299 
n
 = 
pŞy
->
numpošts
;

300 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
pŞylše
->
lše_width
);

301 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
pŞylše
->
lše_¡yË
);

302 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
pŞylše
->
dashËngth
);

303 ià(
pŞylše
->
cÜÃr_¿dius
 > 0.0)

304 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_ROUND
);

306 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_MITER
);

307 
»nd””_İs
->
	`£t_lšeÿps
(
»nd””
, 
LINECAPS_BUTT
);

309 
	`pŞylše_ÿlcuÏ‹_g­_’dpošts
(
pŞylše
, 
g­_’dpošts
);

310 
	`pŞylše_exchªge_g­_pošts
(
pŞylše
, 
g­_’dpošts
);

311 
»nd””_İs
->
	`d¿w_rounded_pŞylše_w™h_¬rows
(
»nd””
,

312 
pošts
, 
n
,

313 
pŞylše
->
lše_width
,

314 &
pŞylše
->
lše_cŞÜ
,

315 &
pŞylše
->
¡¬t_¬row
,

316 &
pŞylše
->
’d_¬row
,

317 
pŞylše
->
cÜÃr_¿dius
);

318 
	`pŞylše_exchªge_g­_pošts
(
pŞylše
, 
g­_’dpošts
);

319 
	}
}

326 
DŸObjeù
 *

327 
	$pŞylše_ü—‹
(
Pošt
 *
¡¬ošt
,

328 *
u£r_d©a
,

329 
HªdË
 **
hªdË1
,

330 
HªdË
 **
hªdË2
)

332 
PŞylše
 *
pŞylše
;

333 
PŞyCÚn
 *
pŞy
;

334 
DŸObjeù
 *
obj
;

335 
Pošt
 
deçuÉËn
 = { 1.0, 1.0 };

338 
pŞylše
 = 
	`g_m®loc0
((
PŞylše
));

339 
pŞy
 = &
pŞylše
->poly;

340 
obj
 = &
pŞy
->
objeù
;

342 
obj
->
ty³
 = &
pŞylše_ty³
;

343 
obj
->
İs
 = &
pŞylše_İs
;

345 ià(
u£r_d©a
 =ğ
NULL
) {

346 
	`pŞycÚn_š™
(
pŞy
, 2);

348 
pŞy
->
pošts
[0] = *
¡¬ošt
;

349 
pŞy
->
pošts
[1] = *
¡¬ošt
;

351 
	`pošt_add
(&
pŞy
->
pošts
[1], &
deçuÉËn
);

353 *
hªdË1
 = 
pŞy
->
objeù
.
hªdËs
[0];

354 *
hªdË2
 = 
pŞy
->
objeù
.
hªdËs
[1];

356 
MuÉoštC»©eD©a
 *
pcd
 = (MuÉoštC»©eD©¨*)
u£r_d©a
;

358 
	`pŞycÚn_š™
(
pŞy
, 
pcd
->
num_pošts
);

361 
	`pŞycÚn_£t_pošts
(
pŞy
, 
pcd
->
num_pošts
,…cd->
pošts
);

363 *
hªdË1
 = 
pŞy
->
objeù
.
hªdËs
[0];

364 *
hªdË2
 = 
pŞy
->
objeù
.
hªdËs
[
pcd
->
num_pošts
-1];

368 
pŞylše
->
lše_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

369 
pŞylše
->
lše_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

370 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
pŞylše
->
lše_¡yË
,

371 &
pŞylše
->
dashËngth
);

372 
pŞylše
->
¡¬t_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_¡¬t_¬row
();

373 
pŞylše
->
’d_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_’d_¬row
();

374 
pŞylše
->
cÜÃr_¿dius
 = 0.0;

376 
	`pŞylše_upd©e_d©a
(
pŞylše
);

378  &
pŞylše
->
pŞy
.
objeù
;

379 
	}
}

382 
	$pŞylše_de¡roy
(
PŞylše
 *
pŞylše
)

384 
	`pŞycÚn_de¡roy
(&
pŞylše
->
pŞy
);

385 
	}
}

387 
DŸObjeù
 *

388 
	$pŞylše_cİy
(
PŞylše
 *
pŞylše
)

390 
PŞylše
 *
ÃwpŞylše
;

391 
PŞyCÚn
 *
pŞy
, *
ÃwpŞy
;

392 
DŸObjeù
 *
Ãwobj
;

394 
pŞy
 = &
pŞylše
->poly;

396 
ÃwpŞylše
 = 
	`g_m®loc0
((
PŞylše
));

397 
ÃwpŞy
 = &
ÃwpŞylše
->
pŞy
;

398 
Ãwobj
 = &
ÃwpŞy
->
objeù
;

400 
	`pŞycÚn_cİy
(
pŞy
, 
ÃwpŞy
);

402 
ÃwpŞylše
->
lše_cŞÜ
 = 
pŞylše
->line_color;

403 
ÃwpŞylše
->
lše_width
 = 
pŞylše
->line_width;

404 
ÃwpŞylše
->
lše_¡yË
 = 
pŞylše
->line_style;

405 
ÃwpŞylše
->
dashËngth
 = 
pŞylše
->dashlength;

406 
ÃwpŞylše
->
¡¬t_¬row
 = 
pŞylše
->start_arrow;

407 
ÃwpŞylše
->
’d_¬row
 = 
pŞylše
->end_arrow;

408 
ÃwpŞylše
->
cÜÃr_¿dius
 = 
pŞylše
->corner_radius;

409 
ÃwpŞylše
->
absŞu‹_¡¬t_g­
 = 
pŞylše
->absolute_start_gap;

410 
ÃwpŞylše
->
absŞu‹_’d_g­
 = 
pŞylše
->absolute_end_gap;

412 
	`pŞylše_upd©e_d©a
(
ÃwpŞylše
);

414  &
ÃwpŞylše
->
pŞy
.
objeù
;

415 
	}
}

418 
	$pŞylše_upd©e_d©a
(
PŞylše
 *
pŞylše
)

420 
PŞyCÚn
 *
pŞy
 = &
pŞylše
->poly;

421 
DŸObjeù
 *
obj
 = &
pŞy
->
objeù
;

422 
PŞyBBExŒas
 *
exŒa
 = &
pŞy
->
exŒa_¥acšg
;

423 
Pošt
 
g­_’dpošts
[2];

425 
	`pŞycÚn_upd©e_d©a
(&
pŞylše
->
pŞy
);

427 
exŒa
->
¡¬t_Œªs
 = (
pŞylše
->
lše_width
 / 2.0);

428 
exŒa
->
’d_Œªs
 = (
pŞylše
->
lše_width
 / 2.0);

429 
exŒa
->
middË_Œªs
 = (
pŞylše
->
lše_width
 / 2.0);

430 
exŒa
->
¡¬t_lÚg
 = (
pŞylše
->
lše_width
 / 2.0);

431 
exŒa
->
’d_lÚg
 = (
pŞylše
->
lše_width
 / 2.0);

433 
	`pŞylše_ÿlcuÏ‹_g­_’dpošts
(
pŞylše
, 
g­_’dpošts
);

434 
	`pŞylše_exchªge_g­_pošts
(
pŞylše
, 
g­_’dpošts
);

436 
	`pŞycÚn_upd©e_boundšgbox
(
pŞy
);

438 ià(
pŞylše
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

439 
ReùªgË
 
bbox
;

440 
Pošt
 
move_¬row
, 
move_lše
;

441 
Pošt
 
to
 = 
g­_’dpošts
[0];

442 
Pošt
 
äom
 = 
pŞy
->
pošts
[1];

443 
	`ÿlcuÏ‹_¬row_pošt
(&
pŞylše
->
¡¬t_¬row
, &
to
, &
äom
,

444 &
move_¬row
, &
move_lše
, 
pŞylše
->
lše_width
);

446 
	`pošt_sub
(&
to
, &
move_¬row
);

447 
	`pošt_sub
(&
äom
, &
move_lše
);

449 
	`¬row_bbox
 (&
pŞylše
->
¡¬t_¬row
,…Şylše->
lše_width
, &
to
, &
äom
, &
bbox
);

450 
	`»ùªgË_uniÚ
 (&
obj
->
boundšg_box
, &
bbox
);

452 ià(
pŞylše
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

453 
ReùªgË
 
bbox
;

454 
n
 = 
pŞylše
->
pŞy
.
numpošts
;

455 
Pošt
 
move_¬row
, 
move_lše
;

456 
Pošt
 
to
 = 
g­_’dpošts
[1];

457 
Pošt
 
äom
 = 
pŞy
->
pošts
[
n
-2];

458 
	`ÿlcuÏ‹_¬row_pošt
(&
pŞylše
->
¡¬t_¬row
, &
to
, &
äom
,

459 &
move_¬row
, &
move_lše
, 
pŞylše
->
lše_width
);

461 
	`pošt_sub
(&
to
, &
move_¬row
);

462 
	`pošt_sub
(&
äom
, &
move_lše
);

464 
	`¬row_bbox
 (&
pŞylše
->
’d_¬row
,…Şylše->
lše_width
, &
to
, &
äom
, &
bbox
);

465 
	`»ùªgË_uniÚ
 (&
obj
->
boundšg_box
, &
bbox
);

468 
	`pŞylše_exchªge_g­_pošts
(
pŞylše
, 
g­_’dpošts
);

470 
obj
->
pos™iÚ
 = 
pŞy
->
pošts
[0];

471 
	}
}

474 
	$pŞylše_§ve
(
PŞylše
 *
pŞylše
, 
ObjeùNode
 
obj_node
,

475 cÚ¡ *
f’ame
)

477 
	`pŞycÚn_§ve
(&
pŞylše
->
pŞy
, 
obj_node
);

479 ià(!
	`cŞÜ_equ®s
(&
pŞylše
->
lše_cŞÜ
, &
cŞÜ_bÏck
))

480 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "line_color"),

481 &
pŞylše
->
lše_cŞÜ
);

483 ià(
pŞylše
->
lše_width
 != 0.1)

484 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

485 
pŞylše
->
lše_width
);

487 ià(
pŞylše
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
)

488 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

489 
pŞylše
->
lše_¡yË
);

491 ià(
pŞylše
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
 &&

492 
pŞylše
->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

493 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

494 
pŞylše
->
dashËngth
);

496 ià(
pŞylše
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

497 
	`§ve_¬row
(
obj_node
, &
pŞylše
->
¡¬t_¬row
, "start_arrow",

501 ià(
pŞylše
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

502 
	`§ve_¬row
(
obj_node
, &
pŞylše
->
’d_¬row
, "end_arrow",

506 ià(
pŞylše
->
absŞu‹_¡¬t_g­
)

507 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "absolute_start_gap"),

508 
pŞylše
->
absŞu‹_¡¬t_g­
);

509 ià(
pŞylše
->
absŞu‹_’d_g­
)

510 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "absolute_end_gap"),

511 
pŞylše
->
absŞu‹_’d_g­
);

513 ià(
pŞylše
->
cÜÃr_¿dius
 > 0.0)

514 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "corner_radius"),

515 
pŞylše
->
cÜÃr_¿dius
);

516 
	}
}

518 
DŸObjeù
 *

519 
	$pŞylše_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

521 
PŞylše
 *
pŞylše
;

522 
PŞyCÚn
 *
pŞy
;

523 
DŸObjeù
 *
obj
;

524 
A‰ribu‹Node
 
©Œ
;

526 
pŞylše
 = 
	`g_m®loc0
((
PŞylše
));

528 
pŞy
 = &
pŞylše
->poly;

529 
obj
 = &
pŞy
->
objeù
;

531 
obj
->
ty³
 = &
pŞylše_ty³
;

532 
obj
->
İs
 = &
pŞylše_İs
;

534 
	`pŞycÚn_lßd
(
pŞy
, 
obj_node
);

536 
pŞylše
->
lše_cŞÜ
 = 
cŞÜ_bÏck
;

537 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_color");

538 ià(
©Œ
 !ğ
NULL
)

539 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
pŞylše
->
lše_cŞÜ
);

541 
pŞylše
->
lše_width
 = 0.1;

542 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

543 ià(
©Œ
 !ğ
NULL
)

544 
pŞylše
->
lše_width
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

546 
pŞylše
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

547 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

548 ià(
©Œ
 !ğ
NULL
)

549 
pŞylše
->
lše_¡yË
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

551 
pŞylše
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

552 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

553 ià(
©Œ
 !ğ
NULL
)

554 
pŞylše
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

556 
	`lßd_¬row
(
obj_node
, &
pŞylše
->
¡¬t_¬row
, "start_arrow",

559 
	`lßd_¬row
(
obj_node
, &
pŞylše
->
’d_¬row
, "end_arrow",

562 
pŞylše
->
absŞu‹_¡¬t_g­
 = 0.0;

563 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "absolute_start_gap");

564 ià(
©Œ
 !ğ
NULL
)

565 
pŞylše
->
absŞu‹_¡¬t_g­
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

566 
pŞylše
->
absŞu‹_’d_g­
 = 0.0;

567 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "absolute_end_gap");

568 ià(
©Œ
 !ğ
NULL
)

569 
pŞylše
->
absŞu‹_’d_g­
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

572 
pŞylše
->
cÜÃr_¿dius
 = 0.0;

573 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "corner_radius");

574 ià(
©Œ
 !ğ
NULL
)

575 
pŞylše
->
cÜÃr_¿dius
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

577 
	`pŞylše_upd©e_d©a
(
pŞylše
);

579  &
pŞylše
->
pŞy
.
objeù
;

580 
	}
}

582 
ObjeùChªge
 *

583 
	$pŞylše_add_cÜÃr_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

585 
PŞylše
 *
pŞy
 = (PŞylše*è
obj
;

586 
£gm’t
;

587 
ObjeùChªge
 *
chªge
;

589 
£gm’t
 = 
	`pŞylše_şo£¡_£gm’t
(
pŞy
, 
şicked
);

590 
chªge
 = 
	`pŞycÚn_add_pošt
(&
pŞy
->pŞy, 
£gm’t
, 
şicked
);

591 
	`pŞylše_upd©e_d©a
(
pŞy
);

592  
chªge
;

593 
	}
}

595 
ObjeùChªge
 *

596 
	$pŞylše_d–‘e_cÜÃr_ÿÎback
 (
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

598 
HªdË
 *
hªdË
;

599 
hªdË_Ä
, 
i
;

600 
PŞylše
 *
pŞy
 = (PŞylše*è
obj
;

601 
ObjeùChªge
 *
chªge
;

603 
hªdË
 = 
	`pŞylše_şo£¡_hªdË
(
pŞy
, 
şicked
);

605 
i
 = 0; i < 
obj
->
num_hªdËs
; i++) {

606 ià(
hªdË
 =ğ
obj
->
hªdËs
[
i
]) ;

608 
hªdË_Ä
 = 
i
;

609 
chªge
 = 
	`pŞycÚn_»move_pošt
(&
pŞy
->pŞy, 
hªdË_Ä
);

610 
	`pŞylše_upd©e_d©a
(
pŞy
);

611  
chªge
;

612 
	}
}

615 
DŸM’uI‹m
 
	gpŞylše_m’u_™ems
[] = {

616 { 
N_
("Add CÜÃr"), 
pŞylše_add_cÜÃr_ÿÎback
, 
NULL
, 1 },

617 { 
N_
("D–‘CÜÃr"), 
pŞylše_d–‘e_cÜÃr_ÿÎback
, 
NULL
, 1 },

620 
DŸM’u
 
	gpŞylše_m’u
 = {

622 (
pŞylše_m’u_™ems
)/(
DŸM’uI‹m
),

623 
pŞylše_m’u_™ems
,

624 
NULL


627 
DŸM’u
 *

628 
	$pŞylše_g‘_objeù_m’u
(
PŞylše
 *
pŞylše
, 
Pošt
 *
şickedpošt
)

631 
pŞylše_m’u_™ems
[0].
aùive
 = 1;

632 
pŞylše_m’u_™ems
[1].
aùive
 = 
pŞylše
->
pŞy
.
numpošts
 > 2;

633  &
pŞylše_m’u
;

634 
	}
}

	@O:\tool\dvs50\objects\standard\standard.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~"objeù.h
"

24 
	~"sh“t.h
"

25 
	~"š.h
"

26 
	~"¶ug-šs.h
"

29 
DŸObjeùTy³
 *
_¬c_ty³
;

30 
DŸObjeùTy³
 *
_box_ty³
;

31 
DŸObjeùTy³
 *
_–l£_ty³
;

32 
DŸObjeùTy³
 *
_lše_ty³
;

33 
DŸObjeùTy³
 *
_zigzaglše_ty³
;

34 
DŸObjeùTy³
 *
_pŞylše_ty³
;

35 
DŸObjeùTy³
 *
_bez›¾še_ty³
;

36 
DŸObjeùTy³
 *
_‹xtobj_ty³
;

37 
DŸObjeùTy³
 *
_image_ty³
;

38 
DŸObjeùTy³
 *
_ouše_ty³
;

39 
DŸObjeùTy³
 *
_pŞygÚ_ty³
;

40 
DŸObjeùTy³
 *
_bez›rgÚ_ty³
;

42 
DIA_PLUGIN_CHECK_INIT


45 
PlugšIn™ResuÉ


46 
	$dŸ_¶ugš_š™
(
PlugšInfo
 *
šfo
)

48 ià(!
	`dŸ_¶ugš_šfo_š™
(
šfo
, "Snd¬d", 
	`_
("Standard objects"),

49 
NULL
, NULL))

50  
DIA_PLUGIN_INIT_ERROR
;

55 
	`objeù_»gi¡”_ty³
(
_lše_ty³
);

61 #ifdeà
HAVE_CAIRO


67  
DIA_PLUGIN_INIT_OK
;

68 
	}
}

	@O:\tool\dvs50\objects\standard\textobj.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<as£¹.h
>

24 
	~<m©h.h
>

26 
	~"š.h
"

27 
	~"objeù.h
"

28 
	~"cÚÃùiÚpošt.h
"

29 
	~"dŸ»nd””.h
"

30 
	~"fÚt.h
"

31 
	~"‹xt.h
"

32 
	~"©Œibu‹s.h
"

33 
	~"widg‘s.h
"

34 
	~"´İ”t›s.h
"

36 
	~"toŞ-icÚs.h
"

38 
	#HANDLE_TEXT
 
HANDLE_CUSTOM1


	)

41 
_V®ign
 
	tV®ign
;

42 
	e_V®ign
 {

43 
	mVALIGN_TOP
,

44 
	mVALIGN_BOTTOM
,

45 
	mVALIGN_CENTER
,

46 
	mVALIGN_FIRST_LINE


48 
_Textobj
 
	tTextobj
;

49 
	s_Textobj
 {

50 
DŸObjeù
 
	mobjeù
;

52 
HªdË
 
	m‹xt_hªdË
;

54 
Text
 *
	m‹xt
;

55 
TextA‰ribu‹s
 
	m©Œs
;

56 
V®ign
 
	mv”t_®ign
;

58 
CŞÜ
 
	mfl_cŞÜ
;

59 
gboŞ—n
 
	mshow_background
;

62 
	s_TextobjPrİ”t›s
 {

63 
Alignm’t
 
	m®ignm’t
;

64 
V®ign
 
	mv”t_®ign
;

65 } 
	gdeçuÉ_´İ”t›s
 = { 
ALIGN_LEFT
, 
VALIGN_FIRST_LINE
 } ;

67 
»®
 
‹xtobj_di¡ªû_äom
(
Textobj
 *
‹xtobj
, 
Pošt
 *
pošt
);

68 
‹xtobj_£Ëù
(
Textobj
 *
‹xtobj
, 
Pošt
 *
şicked_pošt
,

69 
DŸR’d””
 *
š‹¿ùive_»nd””
);

70 
ObjeùChªge
* 
‹xtobj_move_hªdË
(
Textobj
 *
‹xtobj
, 
HªdË
 *
hªdË
,

71 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

72 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

73 
ObjeùChªge
* 
‹xtobj_move
(
Textobj
 *
‹xtobj
, 
Pošt
 *
to
);

74 
‹xtobj_d¿w
(
Textobj
 *
‹xtobj
, 
DŸR’d””
 *
»nd””
);

75 
‹xtobj_upd©e_d©a
(
Textobj
 *
‹xtobj
);

76 
DŸObjeù
 *
‹xtobj_ü—‹
(
Pošt
 *
¡¬ošt
,

77 *
u£r_d©a
,

78 
HªdË
 **
hªdË1
,

79 
HªdË
 **
hªdË2
);

80 
‹xtobj_de¡roy
(
Textobj
 *
‹xtobj
);

82 
PrİDesütiÚ
 *
‹xtobj_desüibe_´İs
(
Textobj
 *
‹xtobj
);

83 
‹xtobj_g‘_´İs
(
Textobj
 *
‹xtobj
, 
GPŒA¼ay
 *
´İs
);

84 
‹xtobj_£t_´İs
(
Textobj
 *
‹xtobj
, 
GPŒA¼ay
 *
´İs
);

86 
‹xtobj_§ve
(
Textobj
 *
‹xtobj
, 
ObjeùNode
 
obj_node
,

87 cÚ¡ *
f’ame
);

88 
DŸObjeù
 *
‹xtobj_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
,

89 cÚ¡ *
f’ame
);

90 
‹xtobj_v®ign_pošt
(
Textobj
 *
‹xtobj
, 
Pošt
* 
p
, 
»®
 
çùÜ
);

92 
ObjeùTy³Ops
 
	g‹xtobj_ty³_İs
 =

94 (
C»©eFunc
è
‹xtobj_ü—‹
,

95 (
LßdFunc
è
‹xtobj_lßd
,

96 (
SaveFunc
è
‹xtobj_§ve
,

97 (
G‘DeçuÉsFunc
è
NULL
,

98 (
AµlyDeçuÉsFunc
è
NULL


106 
DŸObjeùTy³
 
	g‹xtobj_ty³
 =

110 (**è
‹xt_icÚ
,

112 &
‹xtobj_ty³_İs


115 
DŸObjeùTy³
 *
	g_‹xtobj_ty³
 = (DŸObjeùTy³ *è&
‹xtobj_ty³
;

117 
ObjeùOps
 
	g‹xtobj_İs
 = {

118 (
De¡royFunc
è
‹xtobj_de¡roy
,

119 (
D¿wFunc
è
‹xtobj_d¿w
,

120 (
Di¡ªûFunc
è
‹xtobj_di¡ªû_äom
,

121 (
S–eùFunc
è
‹xtobj_£Ëù
,

122 (
CİyFunc
è
objeù_cİy_usšg_´İ”t›s
,

123 (
MoveFunc
è
‹xtobj_move
,

124 (
MoveHªdËFunc
è
‹xtobj_move_hªdË
,

125 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

126 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

127 (
ObjeùM’uFunc
è
NULL
,

128 (
DesüibePrİsFunc
è
‹xtobj_desüibe_´İs
,

129 (
G‘PrİsFunc
è
‹xtobj_g‘_´İs
,

130 (
S‘PrİsFunc
è
‹xtobj_£t_´İs
,

131 (
TextEd™Func
) 0,

132 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

135 
PrİEnumD©a
 
	g´İ_‹xt_v”t_®ign_d©a
[] = {

136 { 
N_
("BÙtom"), 
VALIGN_BOTTOM
 },

137 { 
N_
("Tİ"), 
VALIGN_TOP
 },

138 { 
N_
("C’‹r"), 
VALIGN_CENTER
 },

139 { 
N_
("Fœ¡ Lše"), 
VALIGN_FIRST_LINE
 },

140 { 
NULL
, 0 }

142 
PrİDesütiÚ
 
	g‹xtobj_´İs
[] = {

143 
OBJECT_COMMON_PROPERTIES
,

144 
PROP_STD_TEXT_ALIGNMENT
,

145 { "‹xt_v”t_®ignm’t", 
PROP_TYPE_ENUM
, 
PROP_FLAG_VISIBLE
 | 
PROP_FLAG_OPTIONAL
, \

146 
N_
("V”tiÿÈ‹xˆ®ignm’t"), 
NULL
, 
´İ_‹xt_v”t_®ign_d©a
 },

147 
PROP_STD_TEXT_FONT
,

148 
PROP_STD_TEXT_HEIGHT
,

149 
PROP_STD_TEXT_COLOUR
,

150 
PROP_STD_SAVED_TEXT
,

151 
PROP_STD_FILL_COLOUR_OPTIONAL
,

152 
PROP_STD_SHOW_BACKGROUND_OPTIONAL
,

153 
PROP_DESC_END


156 
PrİDesütiÚ
 *

157 
	$‹xtobj_desüibe_´İs
(
Textobj
 *
‹xtobj
)

159 ià(
‹xtobj_´İs
[0].
qu¬k
 == 0)

160 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
‹xtobj_´İs
);

161  
‹xtobj_´İs
;

162 
	}
}

164 
PrİOff£t
 
	g‹xtobj_off£ts
[] = {

165 
OBJECT_COMMON_PROPERTIES_OFFSETS
,

166 {"‹xt",
PROP_TYPE_TEXT
,
off£tof
(
Textobj
,
‹xt
)},

167 {"‹xt_fÚt",
PROP_TYPE_FONT
,
off£tof
(
Textobj
,
©Œs
.
fÚt
)},

168 {
PROP_STDNAME_TEXT_HEIGHT
,
PROP_STDTYPE_TEXT_HEIGHT
,
off£tof
(
Textobj
,
©Œs
.
height
)},

169 {"‹xt_cŞour",
PROP_TYPE_COLOUR
,
off£tof
(
Textobj
,
©Œs
.
cŞÜ
)},

170 {"‹xt_®ignm’t",
PROP_TYPE_ENUM
,
off£tof
(
Textobj
,
©Œs
.
®ignm’t
)},

171 {"‹xt_v”t_®ignm’t",
PROP_TYPE_ENUM
,
off£tof
(
Textobj
,
v”t_®ign
)},

172 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Textobj
, 
fl_cŞÜ
) },

173 { "show_background", 
PROP_TYPE_BOOL
, 
off£tof
(
Textobj
, 
show_background
) },

174 { 
NULL
, 0, 0 }

178 
	$‹xtobj_g‘_´İs
(
Textobj
 *
‹xtobj
, 
GPŒA¼ay
 *
´İs
)

180 
	`‹xt_g‘_©Œibu‹s
(
‹xtobj
->
‹xt
,&‹xtobj->
©Œs
);

181 
	`objeù_g‘_´İs_äom_off£ts
(&
‹xtobj
->
objeù
,
‹xtobj_off£ts
,
´İs
);

182 
	}
}

185 
	$‹xtobj_£t_´İs
(
Textobj
 *
‹xtobj
, 
GPŒA¼ay
 *
´İs
)

187 
	`objeù_£t_´İs_äom_off£ts
(&
‹xtobj
->
objeù
,
‹xtobj_off£ts
,
´İs
);

188 
	`­¶y_‹x‰r_´İ”t›s
(
´İs
,
‹xtobj
->
‹xt
,"‹xt",&‹xtobj->
©Œs
);

189 
	`‹xtobj_upd©e_d©a
(
‹xtobj
);

190 
	}
}

192 
»®


193 
	$‹xtobj_di¡ªû_äom
(
Textobj
 *
‹xtobj
, 
Pošt
 *
pošt
)

195  
	`‹xt_di¡ªû_äom
(
‹xtobj
->
‹xt
, 
pošt
);

196 
	}
}

199 
	$‹xtobj_£Ëù
(
Textobj
 *
‹xtobj
, 
Pošt
 *
şicked_pošt
,

200 
DŸR’d””
 *
š‹¿ùive_»nd””
)

202 
	`‹xt_£t_cursÜ
(
‹xtobj
->
‹xt
, 
şicked_pošt
, 
š‹¿ùive_»nd””
);

203 
	`‹xt_g¿b_focus
(
‹xtobj
->
‹xt
, &‹xtobj->
objeù
);

204 
	}
}

208 
ObjeùChªge
*

209 
	$‹xtobj_move_hªdË
(
Textobj
 *
‹xtobj
, 
HªdË
 *
hªdË
,

210 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

211 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

213 
	`as£¹
(
‹xtobj
!=
NULL
);

214 
	`as£¹
(
hªdË
!=
NULL
);

215 
	`as£¹
(
to
!=
NULL
);

217 ià(
hªdË
->
id
 =ğ
HANDLE_TEXT
) {

222 
	`‹xtobj_move
(
‹xtobj
, 
to
);

226  
NULL
;

227 
	}
}

229 
ObjeùChªge
*

230 
	$‹xtobj_move
(
Textobj
 *
‹xtobj
, 
Pošt
 *
to
)

232 
‹xtobj
->
objeù
.
pos™iÚ
 = *
to
;

234 
	`‹xtobj_upd©e_d©a
(
‹xtobj
);

236  
NULL
;

237 
	}
}

240 
	$‹xtobj_d¿w
(
Textobj
 *
‹xtobj
, 
DŸR’d””
 *
»nd””
)

242 
	`as£¹
(
‹xtobj
 !ğ
NULL
);

243 
	`as£¹
(
»nd””
 !ğ
NULL
);

245 ià(
‹xtobj
->
show_background
) {

246 
ReùªgË
 
box
;

247 
Pošt
 
ul
, 
Ì
;

248 
	`‹xt_ÿlc_boundšgbox
 (
‹xtobj
->
‹xt
, &
box
);

249 
ul
.
x
 = 
box
.
Ëá
;

250 
ul
.
y
 = 
box
.
tİ
;

251 
Ì
.
x
 = 
box
.
right
;

252 
Ì
.
y
 = 
box
.
bÙtom
;

253 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
)->
	`fl_»ù
 (»nd””, &
ul
, &
Ì
, &
‹xtobj
->
fl_cŞÜ
);

255 
	`‹xt_d¿w
(
‹xtobj
->
‹xt
, 
»nd””
);

256 
	}
}

258 
	$‹xtobj_v®ign_pošt
(
Textobj
 *
‹xtobj
, 
Pošt
* 
p
, 
»®
 
çùÜ
)

261 
ReùªgË
 *
bb
 = &(
‹xtobj
->
objeù
.
boundšg_box
);

262 
»®
 
off£t
 ;

263 
‹xtobj
->
v”t_®ign
){

264 
VALIGN_BOTTOM
:

265 
off£t
 = 
bb
->
bÙtom
 - 
‹xtobj
->
objeù
.
pos™iÚ
.
y
;

266 
p
->
y
 -ğ
off£t
 * 
çùÜ
;

268 
VALIGN_TOP
:

269 
off£t
 = 
bb
->
tİ
 - 
‹xtobj
->
objeù
.
pos™iÚ
.
y
;

270 
p
->
y
 -ğ
off£t
 * 
çùÜ
;

272 
VALIGN_CENTER
:

273 
off£t
 = (
bb
->
bÙtom
 + bb->
tİ
)/2 - 
‹xtobj
->
objeù
.
pos™iÚ
.
y
;

274 
p
->
y
 -ğ
off£t
 * 
çùÜ
;

276 
VALIGN_FIRST_LINE
:

279 
	}
}

281 
	$‹xtobj_upd©e_d©a
(
Textobj
 *
‹xtobj
)

283 
Pošt
 
to2
;

284 
DŸObjeù
 *
obj
 = &
‹xtobj
->
objeù
;

286 
	`‹xt_£t_pos™iÚ
(
‹xtobj
->
‹xt
, &
obj
->
pos™iÚ
);

287 
	`‹xt_ÿlc_boundšgbox
(
‹xtobj
->
‹xt
, &
obj
->
boundšg_box
);

289 
to2
 = 
obj
->
pos™iÚ
;

290 
	`‹xtobj_v®ign_pošt
(
‹xtobj
, &
to2
, 1);

291 
	`‹xt_£t_pos™iÚ
(
‹xtobj
->
‹xt
, &
to2
);

292 
	`‹xt_ÿlc_boundšgbox
(
‹xtobj
->
‹xt
, &
obj
->
boundšg_box
);

294 
‹xtobj
->
‹xt_hªdË
.
pos
 = 
obj
->
pos™iÚ
;

295 
	}
}

297 
DŸObjeù
 *

298 
	$‹xtobj_ü—‹
(
Pošt
 *
¡¬ošt
,

299 *
u£r_d©a
,

300 
HªdË
 **
hªdË1
,

301 
HªdË
 **
hªdË2
)

303 
Textobj
 *
‹xtobj
;

304 
DŸObjeù
 *
obj
;

305 
CŞÜ
 
cŞ
;

306 
DŸFÚt
 *
fÚt
 = 
NULL
;

307 
»®
 
fÚt_height
;

309 
‹xtobj
 = 
	`g_m®loc0
((
Textobj
));

310 
obj
 = &
‹xtobj
->
objeù
;

312 
obj
->
ty³
 = &
‹xtobj_ty³
;

314 
obj
->
İs
 = &
‹xtobj_İs
;

316 
cŞ
 = 
	`©Œibu‹s_g‘_fÜeground
();

317 
	`©Œibu‹s_g‘_deçuÉ_fÚt
(&
fÚt
, &
fÚt_height
);

318 
‹xtobj
->
‹xt
 = 
	`Ãw_‹xt
("", 
fÚt
, 
fÚt_height
,

319 
¡¬ošt
, &
cŞ
, 
deçuÉ_´İ”t›s
.
®ignm’t
 );

321 
obj
->
pos™iÚ
 = *
¡¬ošt
;

323 
	`‹xt_g‘_©Œibu‹s
(
‹xtobj
->
‹xt
,&‹xtobj->
©Œs
);

324 
	`dŸ_fÚt_uÄef
(
fÚt
);

325 
‹xtobj
->
v”t_®ign
 = 
deçuÉ_´İ”t›s
.vert_align;

328 
‹xtobj
->
fl_cŞÜ
 = 
	`©Œibu‹s_g‘_background
();

329 
‹xtobj
->
show_background
 = 
FALSE
;

331 
	`objeù_š™
(
obj
, 1, 0);

333 
obj
->
hªdËs
[0] = &
‹xtobj
->
‹xt_hªdË
;

334 
‹xtobj
->
‹xt_hªdË
.
id
 = 
HANDLE_TEXT
;

335 
‹xtobj
->
‹xt_hªdË
.
ty³
 = 
HANDLE_MAJOR_CONTROL
;

336 
‹xtobj
->
‹xt_hªdË
.
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

337 
‹xtobj
->
‹xt_hªdË
.
cÚÃùed_to
 = 
NULL
;

339 
	`‹xtobj_upd©e_d©a
(
‹xtobj
);

341 *
hªdË1
 = 
NULL
;

342 *
hªdË2
 = 
obj
->
hªdËs
[0];

343  &
‹xtobj
->
objeù
;

344 
	}
}

347 
	$‹xtobj_de¡roy
(
Textobj
 *
‹xtobj
)

349 
	`‹xt_de¡roy
(
‹xtobj
->
‹xt
);

350 
	`dŸ_fÚt_uÄef
(
‹xtobj
->
©Œs
.
fÚt
);

351 
	`objeù_de¡roy
(&
‹xtobj
->
objeù
);

352 
	}
}

355 
	$‹xtobj_§ve
(
Textobj
 *
‹xtobj
, 
ObjeùNode
 
obj_node
, cÚ¡ *
f’ame
)

357 
	`objeù_§ve
(&
‹xtobj
->
objeù
, 
obj_node
);

359 
	`d©a_add_‹xt
(
	`Ãw_©Œibu‹
(
obj_node
, "text"),

360 
‹xtobj
->
‹xt
);

361 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "valign"),

362 
‹xtobj
->
v”t_®ign
);

364 ià(
‹xtobj
->
show_background
) {

365 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "fl_cŞÜ"), &
‹xtobj
->
fl_cŞÜ
);

366 
	`d©a_add_boŞ—n
(
	`Ãw_©Œibu‹
(
obj_node
, "show_background"), 
‹xtobj
->
show_background
);

368 
	}
}

370 
DŸObjeù
 *

371 
	$‹xtobj_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

373 
Textobj
 *
‹xtobj
;

374 
DŸObjeù
 *
obj
;

375 
A‰ribu‹Node
 
©Œ
;

376 
Pošt
 
¡¬ošt
 = {0.0, 0.0};

378 
‹xtobj
 = 
	`g_m®loc0
((
Textobj
));

379 
obj
 = &
‹xtobj
->
objeù
;

381 
obj
->
ty³
 = &
‹xtobj_ty³
;

382 
obj
->
İs
 = &
‹xtobj_İs
;

384 
	`objeù_lßd
(
obj
, 
obj_node
);

386 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "text");

387 ià(
©Œ
 !ğ
NULL
) {

388 
‹xtobj
->
‹xt
 = 
	`d©a_‹xt
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

390 
DŸFÚt
* 
fÚt
 = 
	`dŸ_fÚt_Ãw_äom_¡yË
(
DIA_FONT_MONOSPACE
,1.0);

391 
‹xtobj
->
‹xt
 = 
	`Ãw_‹xt
("", 
fÚt
, 1.0,

392 &
¡¬ošt
, &
cŞÜ_bÏck
, 
ALIGN_CENTER
);

393 
	`dŸ_fÚt_uÄef
(
fÚt
);

396 
	`‹xt_g‘_©Œibu‹s
(
‹xtobj
->
‹xt
,&‹xtobj->
©Œs
);

398 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "valign");

399 ià(
©Œ
 !ğ
NULL
)

400 
‹xtobj
->
v”t_®ign
 = 
	`d©a_’um
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

401 ià(
v”siÚ
 == 0) {

402 
‹xtobj
->
v”t_®ign
 = 
VALIGN_FIRST_LINE
;

406 
‹xtobj
->
fl_cŞÜ
 = 
	`©Œibu‹s_g‘_background
();

407 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "fill_color");

408 ià(
©Œ
)

409 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
‹xtobj
->
fl_cŞÜ
);

410 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "show_background");

411 ià(
©Œ
)

412 
‹xtobj
->
show_background
 = 
	`d©a_boŞ—n
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

414 
‹xtobj
->
show_background
 = 
FALSE
;

416 
	`objeù_š™
(
obj
, 1, 0);

418 
obj
->
hªdËs
[0] = &
‹xtobj
->
‹xt_hªdË
;

419 
‹xtobj
->
‹xt_hªdË
.
id
 = 
HANDLE_TEXT
;

420 
‹xtobj
->
‹xt_hªdË
.
ty³
 = 
HANDLE_MAJOR_CONTROL
;

421 
‹xtobj
->
‹xt_hªdË
.
cÚÃù_ty³
 = 
HANDLE_CONNECTABLE
;

422 
‹xtobj
->
‹xt_hªdË
.
cÚÃùed_to
 = 
NULL
;

424 
	`‹xtobj_upd©e_d©a
(
‹xtobj
);

426  &
‹xtobj
->
objeù
;

427 
	}
}

	@O:\tool\dvs50\objects\standard\tool-icons.h

3 #ifdeà
__SUNPRO_C


4 #´agm¨
®ign
 4 (
¬c_icÚ
)

6 #ifdeà
__GNUC__


7 cÚ¡ 
gušt8
 
	g¬c_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

9 cÚ¡ 
gušt8
 
¬c_icÚ
[] =

85 #ifdeà
__SUNPRO_C


86 #´agm¨
®ign
 4 (
bez›rgÚ_icÚ
)

88 #ifdeà
__GNUC__


89 cÚ¡ 
gušt8
 
	gbez›rgÚ_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

91 cÚ¡ 
gušt8
 
bez›rgÚ_icÚ
[] =

169 #ifdeà
__SUNPRO_C


170 #´agm¨
®ign
 4 (
bez›¾še_icÚ
)

172 #ifdeà
__GNUC__


173 cÚ¡ 
gušt8
 
	gbez›¾še_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

175 cÚ¡ 
gušt8
 
bez›¾še_icÚ
[] =

253 #ifdeà
__SUNPRO_C


254 #´agm¨
®ign
 4 (
box_icÚ
)

256 #ifdeà
__GNUC__


257 cÚ¡ 
gušt8
 
	gbox_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

259 cÚ¡ 
gušt8
 
box_icÚ
[] =

342 #ifdeà
__SUNPRO_C


343 #´agm¨
®ign
 4 (
–l£_icÚ
)

345 #ifdeà
__GNUC__


346 cÚ¡ 
gušt8
 
	g–l£_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

348 cÚ¡ 
gušt8
 
–l£_icÚ
[] =

430 #ifdeà
__SUNPRO_C


431 #´agm¨
®ign
 4 (
image_icÚ
)

433 #ifdeà
__GNUC__


434 cÚ¡ 
gušt8
 
	gimage_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

436 cÚ¡ 
gušt8
 
image_icÚ
[] =

530 #ifdeà
__SUNPRO_C


531 #´agm¨
®ign
 4 (
lše_icÚ
)

533 #ifdeà
__GNUC__


534 cÚ¡ 
gušt8
 
	glše_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

536 cÚ¡ 
gušt8
 
lše_icÚ
[] =

612 #ifdeà
__SUNPRO_C


613 #´agm¨
®ign
 4 (
ouše_icÚ
)

615 #ifdeà
__GNUC__


616 cÚ¡ 
gušt8
 
	gouše_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

618 cÚ¡ 
gušt8
 
ouše_icÚ
[] =

715 #ifdeà
__SUNPRO_C


716 #´agm¨
®ign
 4 (
pŞygÚ_icÚ
)

718 #ifdeà
__GNUC__


719 cÚ¡ 
gušt8
 
	gpŞygÚ_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

721 cÚ¡ 
gušt8
 
pŞygÚ_icÚ
[] =

798 #ifdeà
__SUNPRO_C


799 #´agm¨
®ign
 4 (
pŞylše_icÚ
)

801 #ifdeà
__GNUC__


802 cÚ¡ 
gušt8
 
	gpŞylše_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

804 cÚ¡ 
gušt8
 
pŞylše_icÚ
[] =

881 #ifdeà
__SUNPRO_C


882 #´agm¨
®ign
 4 (
‹xt_icÚ
)

884 #ifdeà
__GNUC__


885 cÚ¡ 
gušt8
 
	g‹xt_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

887 cÚ¡ 
gušt8
 
‹xt_icÚ
[] =

966 #ifdeà
__SUNPRO_C


967 #´agm¨
®ign
 4 (
zigzaglše_icÚ
)

969 #ifdeà
__GNUC__


970 cÚ¡ 
gušt8
 
	gzigzaglše_icÚ
[] 
__©Œibu‹__
 ((
__®igÃd__
 (4))) =

972 cÚ¡ 
gušt8
 
zigzaglše_icÚ
[] =

	@O:\tool\dvs50\objects\standard\zigzagline.c

19 #ifdeà
HAVE_CONFIG_H


20 
	~<cÚfig.h
>

23 
	~<as£¹.h
>

24 
	~<m©h.h
>

26 
	~"š.h
"

27 
	~"objeù.h
"

28 
	~"Üth_cÚn.h
"

29 
	~"cÚÃùiÚpošt.h
"

30 
	~"dŸ»nd””.h
"

31 
	~"©Œibu‹s.h
"

32 
	~"widg‘s.h
"

33 
	~"mes§ge.h
"

34 
	~"´İ”t›s.h
"

35 
	~"autÜou‹.h
"

37 
	~"toŞ-icÚs.h
"

39 
	#DEFAULT_WIDTH
 0.15

	)

41 
	#HANDLE_MIDDLE
 
HANDLE_CUSTOM1


	)

43 
	s_Zigzaglše
 {

44 
O¹hCÚn
 
	mÜth
;

46 
CŞÜ
 
	mlše_cŞÜ
;

47 
LšeStyË
 
	mlše_¡yË
;

48 
»®
 
	mdashËngth
;

49 
»®
 
	mlše_width
;

50 
»®
 
	mcÜÃr_¿dius
;

51 
A¼ow
 
	m¡¬t_¬row
, 
	m’d_¬row
;

52 } 
	tZigzaglše
;

55 
ObjeùChªge
* 
zigzaglše_move_hªdË
(
Zigzaglše
 *
zigzaglše
, 
HªdË
 *
hªdË
,

56 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

57 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
);

58 
ObjeùChªge
* 
zigzaglše_move
(
Zigzaglše
 *
zigzaglše
, 
Pošt
 *
to
);

59 
zigzaglše_£Ëù
(
Zigzaglše
 *
zigzaglše
, 
Pošt
 *
şicked_pošt
,

60 
DŸR’d””
 *
š‹¿ùive_»nd””
);

61 
zigzaglše_d¿w
(
Zigzaglše
 *
zigzaglše
, 
DŸR’d””
 *
»nd””
);

62 
DŸObjeù
 *
zigzaglše_ü—‹
(
Pošt
 *
¡¬ošt
,

63 *
u£r_d©a
,

64 
HªdË
 **
hªdË1
,

65 
HªdË
 **
hªdË2
);

66 
»®
 
zigzaglše_di¡ªû_äom
(
Zigzaglše
 *
zigzaglše
, 
Pošt
 *
pošt
);

67 
zigzaglše_upd©e_d©a
(
Zigzaglše
 *
zigzaglše
);

68 
zigzaglše_de¡roy
(
Zigzaglše
 *
zigzaglše
);

69 
DŸObjeù
 *
zigzaglše_cİy
(
Zigzaglše
 *
zigzaglše
);

70 
DŸM’u
 *
zigzaglše_g‘_objeù_m’u
(
Zigzaglše
 *
zigzaglše
,

71 
Pošt
 *
şickedpošt
);

73 
PrİDesütiÚ
 *
zigzaglše_desüibe_´İs
(
Zigzaglše
 *
zigzaglše
);

74 
zigzaglše_g‘_´İs
(
Zigzaglše
 *
zigzaglše
, 
GPŒA¼ay
 *
´İs
);

75 
zigzaglše_£t_´İs
(
Zigzaglše
 *
zigzaglše
, 
GPŒA¼ay
 *
´İs
);

77 
zigzaglše_§ve
(
Zigzaglše
 *
zigzaglše
, 
ObjeùNode
 
obj_node
,

78 cÚ¡ *
f’ame
);

79 
DŸObjeù
 *
zigzaglše_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
,

80 cÚ¡ *
f’ame
);

82 
ObjeùTy³Ops
 
	gzigzaglše_ty³_İs
 =

84 (
C»©eFunc
)
zigzaglše_ü—‹
,

85 (
LßdFunc
è
zigzaglše_lßd
,

86 (
SaveFunc
è
zigzaglše_§ve
,

87 (
G‘DeçuÉsFunc
è
NULL
,

88 (
AµlyDeçuÉsFunc
è
NULL


91 
DŸObjeùTy³
 
	gzigzaglše_ty³
 =

96 (**è
zigzaglše_icÚ
,

98 &
zigzaglše_ty³_İs


101 
DŸObjeùTy³
 *
	g_zigzaglše_ty³
 = (DŸObjeùTy³ *è&
zigzaglše_ty³
;

104 
ObjeùOps
 
	gzigzaglše_İs
 = {

105 (
De¡royFunc
è
zigzaglše_de¡roy
,

106 (
D¿wFunc
è
zigzaglše_d¿w
,

107 (
Di¡ªûFunc
è
zigzaglše_di¡ªû_äom
,

108 (
S–eùFunc
è
zigzaglše_£Ëù
,

109 (
CİyFunc
è
zigzaglše_cİy
,

110 (
MoveFunc
è
zigzaglše_move
,

111 (
MoveHªdËFunc
è
zigzaglše_move_hªdË
,

112 (
G‘Prİ”t›sFunc
è
objeù_ü—‹_´İs_dŸlog
,

113 (
AµlyPrİ”t›sDŸlogFunc
è
objeù_­¶y_´İs_äom_dŸlog
,

114 (
ObjeùM’uFunc
è
zigzaglše_g‘_objeù_m’u
,

115 (
DesüibePrİsFunc
è
zigzaglše_desüibe_´İs
,

116 (
G‘PrİsFunc
è
zigzaglše_g‘_´İs
,

117 (
S‘PrİsFunc
è
zigzaglše_£t_´İs
,

118 (
TextEd™Func
) 0,

119 (
AµlyPrİ”t›sLi¡Func
è
objeù_­¶y_´İs
,

122 
PrİNumD©a
 
	gzigzaglše_cÜÃr_¿dius_d©a
 = { 0.0, 10.0, 0.1 };

124 
PrİDesütiÚ
 
	gzigzaglše_´İs
[] = {

125 
ORTHCONN_COMMON_PROPERTIES
,

126 
PROP_STD_LINE_WIDTH
,

127 
PROP_STD_LINE_COLOUR
,

128 
PROP_STD_LINE_STYLE
,

129 
PROP_STD_START_ARROW
,

130 
PROP_STD_END_ARROW
,

131 { "cÜÃr_¿dius", 
PROP_TYPE_REAL
, 
PROP_FLAG_VISIBLE
,

132 
N_
("CÜÃ¸¿dius"), 
NULL
, &
zigzaglše_cÜÃr_¿dius_d©a
 },

133 
PROP_DESC_END


136 
PrİDesütiÚ
 *

137 
	$zigzaglše_desüibe_´İs
(
Zigzaglše
 *
zigzaglše
)

139 ià(
zigzaglše_´İs
[0].
qu¬k
 == 0)

140 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
zigzaglše_´İs
);

141  
zigzaglše_´İs
;

142 
	}
}

144 
PrİOff£t
 
	gzigzaglše_off£ts
[] = {

145 
ORTHCONN_COMMON_PROPERTIES_OFFSETS
,

146 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
off£tof
(
Zigzaglše
, 
lše_width
) },

147 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
off£tof
(
Zigzaglše
, 
lše_cŞÜ
) },

148 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
,

149 
off£tof
(
Zigzaglše
, 
lše_¡yË
), off£tof(Zigzaglše, 
dashËngth
) },

150 { "¡¬t_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
Zigzaglše
, 
¡¬t_¬row
) },

151 { "’d_¬row", 
PROP_TYPE_ARROW
, 
off£tof
(
Zigzaglše
, 
’d_¬row
) },

152 { "cÜÃr_¿dius", 
PROP_TYPE_REAL
, 
off£tof
(
Zigzaglše
, 
cÜÃr_¿dius
) },

153 { 
NULL
, 0, 0 }

157 
	$zigzaglše_g‘_´İs
(
Zigzaglše
 *
zigzaglše
, 
GPŒA¼ay
 *
´İs
)

159 
	`objeù_g‘_´İs_äom_off£ts
(&
zigzaglše
->
Üth
.
objeù
, 
zigzaglše_off£ts
,

160 
´İs
);

161 
	}
}

164 
	$zigzaglše_£t_´İs
(
Zigzaglše
 *
zigzaglše
, 
GPŒA¼ay
 *
´İs
)

166 
	`objeù_£t_´İs_äom_off£ts
(&
zigzaglše
->
Üth
.
objeù
, 
zigzaglše_off£ts
,

167 
´İs
);

168 
	`zigzaglše_upd©e_d©a
(
zigzaglše
);

169 
	}
}

171 
»®


172 
	$zigzaglše_di¡ªû_äom
(
Zigzaglše
 *
zigzaglše
, 
Pošt
 *
pošt
)

174 
O¹hCÚn
 *
Üth
 = &
zigzaglše
->orth;

175  
	`ÜthcÚn_di¡ªû_äom
(
Üth
, 
pošt
, 
zigzaglše
->
lše_width
);

176 
	}
}

179 
	$zigzaglše_£Ëù
(
Zigzaglše
 *
zigzaglše
, 
Pošt
 *
şicked_pošt
,

180 
DŸR’d””
 *
š‹¿ùive_»nd””
)

182 
	`ÜthcÚn_upd©e_d©a
(&
zigzaglše
->
Üth
);

183 
	}
}

185 
ObjeùChªge
*

186 
	$zigzaglše_move_hªdË
(
Zigzaglše
 *
zigzaglše
, 
HªdË
 *
hªdË
,

187 
Pošt
 *
to
, 
CÚÃùiÚPošt
 *
ı
,

188 
HªdËMoveR—sÚ
 
»asÚ
, 
Modif›rKeys
 
modif›rs
)

190 
ObjeùChªge
 *
chªge
;

191 
	`as£¹
(
zigzaglše
!=
NULL
);

192 
	`as£¹
(
hªdË
!=
NULL
);

193 
	`as£¹
(
to
!=
NULL
);

195 
chªge
 = 
	`ÜthcÚn_move_hªdË
((
O¹hCÚn
*)
zigzaglše
, 
hªdË
, 
to
, 
ı
,

196 
»asÚ
, 
modif›rs
);

198 
	`zigzaglše_upd©e_d©a
(
zigzaglše
);

200  
chªge
;

201 
	}
}

204 
ObjeùChªge
*

205 
	$zigzaglše_move
(
Zigzaglše
 *
zigzaglše
, 
Pošt
 *
to
)

207 
	`ÜthcÚn_move
(&
zigzaglše
->
Üth
, 
to
);

208 
	`zigzaglše_upd©e_d©a
(
zigzaglše
);

210  
NULL
;

211 
	}
}

214 
	$zigzaglše_d¿w
(
Zigzaglše
 *
zigzaglše
, 
DŸR’d””
 *
»nd””
)

216 
DŸR’d””CÏss
 *
»nd””_İs
 = 
	`DIA_RENDERER_GET_CLASS
 (
»nd””
);

217 
O¹hCÚn
 *
Üth
 = &
zigzaglše
->orth;

218 
Pošt
 *
pošts
;

219 
n
;

221 
pošts
 = &
Üth
->points[0];

222 
n
 = 
Üth
->
numpošts
;

224 
»nd””_İs
->
	`£t_lšewidth
(
»nd””
, 
zigzaglše
->
lše_width
);

225 
»nd””_İs
->
	`£t_lše¡yË
(
»nd””
, 
zigzaglše
->
lše_¡yË
);

226 
»nd””_İs
->
	`£t_dashËngth
(
»nd””
, 
zigzaglše
->
dashËngth
);

227 ià(
zigzaglše
->
cÜÃr_¿dius
 > 0)

228 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_ROUND
);

230 
»nd””_İs
->
	`£t_lšejoš
(
»nd””
, 
LINEJOIN_MITER
);

231 
»nd””_İs
->
	`£t_lšeÿps
(
»nd””
, 
LINECAPS_BUTT
);

233 
»nd””_İs
->
	`d¿w_rounded_pŞylše_w™h_¬rows
(
»nd””
,

234 
pošts
, 
n
,

235 
zigzaglše
->
lše_width
,

236 &
zigzaglše
->
lše_cŞÜ
,

237 &
zigzaglše
->
¡¬t_¬row
,

238 &
zigzaglše
->
’d_¬row
,

239 
zigzaglše
->
cÜÃr_¿dius
);

241 
	}
}

243 
DŸObjeù
 *

244 
	$zigzaglše_ü—‹
(
Pošt
 *
¡¬ošt
,

245 *
u£r_d©a
,

246 
HªdË
 **
hªdË1
,

247 
HªdË
 **
hªdË2
)

249 
Zigzaglše
 *
zigzaglše
;

250 
O¹hCÚn
 *
Üth
;

251 
DŸObjeù
 *
obj
;

254 
zigzaglše
 = 
	`g_m®loc0
((
Zigzaglše
));

255 
Üth
 = &
zigzaglše
->orth;

256 
obj
 = &
Üth
->
objeù
;

258 
obj
->
ty³
 = &
zigzaglše_ty³
;

259 
obj
->
İs
 = &
zigzaglše_İs
;

261 
	`ÜthcÚn_š™
(
Üth
, 
¡¬ošt
);

263 
zigzaglše
->
lše_width
 = 
	`©Œibu‹s_g‘_deçuÉ_lšewidth
();

264 
zigzaglše
->
lše_cŞÜ
 = 
	`©Œibu‹s_g‘_fÜeground
();

265 
	`©Œibu‹s_g‘_deçuÉ_lše_¡yË
(&
zigzaglše
->
lše_¡yË
,

266 &
zigzaglše
->
dashËngth
);

267 
zigzaglše
->
¡¬t_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_¡¬t_¬row
();

268 
zigzaglše
->
’d_¬row
 = 
	`©Œibu‹s_g‘_deçuÉ_’d_¬row
();

269 
zigzaglše
->
cÜÃr_¿dius
 = 0.0;

271 *
hªdË1
 = 
Üth
->
hªdËs
[0];

272 *
hªdË2
 = 
Üth
->
hªdËs
[Üth->
numpošts
-2];

274 
	`zigzaglše_upd©e_d©a
(
zigzaglše
);

276  &
zigzaglše
->
Üth
.
objeù
;

277 
	}
}

280 
	$zigzaglše_de¡roy
(
Zigzaglše
 *
zigzaglše
)

282 
	`ÜthcÚn_de¡roy
(&
zigzaglše
->
Üth
);

283 
	}
}

285 
DŸObjeù
 *

286 
	$zigzaglše_cİy
(
Zigzaglše
 *
zigzaglše
)

288 
Zigzaglše
 *
Ãwzigzaglše
;

289 
O¹hCÚn
 *
Üth
, *
ÃwÜth
;

290 
DŸObjeù
 *
Ãwobj
;

292 
Üth
 = &
zigzaglše
->orth;

294 
Ãwzigzaglše
 = 
	`g_m®loc0
((
Zigzaglše
));

295 
ÃwÜth
 = &
Ãwzigzaglše
->
Üth
;

296 
Ãwobj
 = &
ÃwÜth
->
objeù
;

298 
	`ÜthcÚn_cİy
(
Üth
, 
ÃwÜth
);

300 
Ãwzigzaglše
->
lše_cŞÜ
 = 
zigzaglše
->line_color;

301 
Ãwzigzaglše
->
lše_width
 = 
zigzaglše
->line_width;

302 
Ãwzigzaglše
->
lše_¡yË
 = 
zigzaglše
->line_style;

303 
Ãwzigzaglše
->
dashËngth
 = 
zigzaglše
->dashlength;

304 
Ãwzigzaglše
->
¡¬t_¬row
 = 
zigzaglše
->start_arrow;

305 
Ãwzigzaglše
->
’d_¬row
 = 
zigzaglše
->end_arrow;

306 
Ãwzigzaglše
->
cÜÃr_¿dius
 = 
zigzaglše
->corner_radius;

308 
	`zigzaglše_upd©e_d©a
(
Ãwzigzaglše
);

310  &
Ãwzigzaglše
->
Üth
.
objeù
;

311 
	}
}

314 
	$zigzaglše_upd©e_d©a
(
Zigzaglše
 *
zigzaglše
)

316 
O¹hCÚn
 *
Üth
 = &
zigzaglše
->orth;

317 
DŸObjeù
 *
obj
 = &
Üth
->
objeù
;

318 
PŞyBBExŒas
 *
exŒa
 = &
Üth
->
exŒa_¥acšg
;

320 
	`ÜthcÚn_upd©e_d©a
(&
zigzaglše
->
Üth
);

322 
exŒa
->
¡¬t_lÚg
 =

323 
exŒa
->
’d_lÚg
 =

324 
exŒa
->
middË_Œªs
 =

325 
exŒa
->
¡¬t_Œªs
 =

326 
exŒa
->
’d_Œªs
 = (
zigzaglše
->
lše_width
 / 2.0);

328 
	`ÜthcÚn_upd©e_boundšgbox
(
Üth
);

330 ià(
zigzaglše
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

331 
ReùªgË
 
bbox
;

332 
Pošt
 
move_¬row
, 
move_lše
;

333 
Pošt
 
to
 = 
Üth
->
pošts
[0];

334 
Pošt
 
äom
 = 
Üth
->
pošts
[1];

335 
	`ÿlcuÏ‹_¬row_pošt
(&
zigzaglše
->
¡¬t_¬row
, &
to
, &
äom
,

336 &
move_¬row
, &
move_lše
, 
zigzaglše
->
lše_width
);

338 
	`pošt_sub
(&
to
, &
move_¬row
);

339 
	`pošt_sub
(&
äom
, &
move_lše
);

341 
	`¬row_bbox
 (&
zigzaglše
->
¡¬t_¬row
, zigzaglše->
lše_width
, &
to
, &
äom
, &
bbox
);

342 
	`»ùªgË_uniÚ
 (&
obj
->
boundšg_box
, &
bbox
);

344 ià(
zigzaglše
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

345 
ReùªgË
 
bbox
;

346 
Pošt
 
move_¬row
, 
move_lše
;

347 
n
 = 
Üth
->
numpošts
;

348 
Pošt
 
to
 = 
Üth
->
pošts
[
n
-1];

349 
Pošt
 
äom
 = 
Üth
->
pošts
[
n
-2];

350 
	`ÿlcuÏ‹_¬row_pošt
(&
zigzaglše
->
¡¬t_¬row
, &
to
, &
äom
,

351 &
move_¬row
, &
move_lše
, 
zigzaglše
->
lše_width
);

353 
	`pošt_sub
(&
to
, &
move_¬row
);

354 
	`pošt_sub
(&
äom
, &
move_lše
);

356 
	`¬row_bbox
 (&
zigzaglše
->
’d_¬row
, zigzaglše->
lše_width
, &
to
, &
äom
, &
bbox
);

357 
	`»ùªgË_uniÚ
 (&
obj
->
boundšg_box
, &
bbox
);

359 
	}
}

361 
ObjeùChªge
 *

362 
	$zigzaglše_add_£gm’t_ÿÎback
(
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

364 
ObjeùChªge
 *
chªge
;

365 
chªge
 = 
	`ÜthcÚn_add_£gm’t
((
O¹hCÚn
 *)
obj
, 
şicked
);

366 
	`zigzaglše_upd©e_d©a
((
Zigzaglše
 *)
obj
);

367  
chªge
;

368 
	}
}

370 
ObjeùChªge
 *

371 
	$zigzaglše_d–‘e_£gm’t_ÿÎback
(
DŸObjeù
 *
obj
, 
Pošt
 *
şicked
, 
gpoš‹r
 
d©a
)

373 
ObjeùChªge
 *
chªge
;

374 
chªge
 = 
	`ÜthcÚn_d–‘e_£gm’t
((
O¹hCÚn
 *)
obj
, 
şicked
);

375 
	`zigzaglše_upd©e_d©a
((
Zigzaglše
 *)
obj
);

376  
chªge
;

377 
	}
}

379 
DŸM’uI‹m
 
	gobjeù_m’u_™ems
[] = {

380 { 
N_
("Add segm’t"), 
zigzaglše_add_£gm’t_ÿÎback
, 
NULL
, 1 },

381 { 
N_
("D–‘£gm’t"), 
zigzaglše_d–‘e_£gm’t_ÿÎback
, 
NULL
, 1 },

382 
ORTHCONN_COMMON_MENUS
,

385 
DŸM’u
 
	gobjeù_m’u
 = {

387 (
objeù_m’u_™ems
)/(
DŸM’uI‹m
),

388 
objeù_m’u_™ems
,

389 
NULL


392 
DŸM’u
 *

393 
	$zigzaglše_g‘_objeù_m’u
(
Zigzaglše
 *
zigzaglše
, 
Pošt
 *
şickedpošt
)

395 
O¹hCÚn
 *
Üth
;

397 
Üth
 = &
zigzaglše
->orth;

399 
objeù_m’u_™ems
[0].
aùive
 = 
	`ÜthcÚn_ÿn_add_£gm’t
(
Üth
, 
şickedpošt
);

400 
objeù_m’u_™ems
[1].
aùive
 = 
	`ÜthcÚn_ÿn_d–‘e_£gm’t
(
Üth
, 
şickedpošt
);

401 
	`ÜthcÚn_upd©e_objeù_m’u
(
Üth
, 
şickedpošt
, &
objeù_m’u_™ems
[2]);

403  &
objeù_m’u
;

404 
	}
}

408 
	$zigzaglše_§ve
(
Zigzaglše
 *
zigzaglše
, 
ObjeùNode
 
obj_node
,

409 cÚ¡ *
f’ame
)

411 
	`ÜthcÚn_§ve
(&
zigzaglše
->
Üth
, 
obj_node
);

413 ià(!
	`cŞÜ_equ®s
(&
zigzaglše
->
lše_cŞÜ
, &
cŞÜ_bÏck
))

414 
	`d©a_add_cŞÜ
(
	`Ãw_©Œibu‹
(
obj_node
, "line_color"),

415 &
zigzaglše
->
lše_cŞÜ
);

417 ià(
zigzaglše
->
lše_width
 != 0.1)

418 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
),

419 
zigzaglše
->
lše_width
);

421 ià(
zigzaglše
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
)

422 
	`d©a_add_’um
(
	`Ãw_©Œibu‹
(
obj_node
, "line_style"),

423 
zigzaglše
->
lše_¡yË
);

425 ià(
zigzaglše
->
¡¬t_¬row
.
ty³
 !ğ
ARROW_NONE
) {

426 
	`§ve_¬row
(
obj_node
, &
zigzaglše
->
¡¬t_¬row
, "start_arrow",

430 ià(
zigzaglše
->
’d_¬row
.
ty³
 !ğ
ARROW_NONE
) {

431 
	`§ve_¬row
(
obj_node
, &
zigzaglše
->
’d_¬row
, "end_arrow",

435 ià(
zigzaglše
->
lše_¡yË
 !ğ
LINESTYLE_SOLID
 &&

436 
zigzaglše
->
dashËngth
 !ğ
DEFAULT_LINESTYLE_DASHLEN
)

437 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "dashlength"),

438 
zigzaglše
->
dashËngth
);

440 ià(
zigzaglše
->
cÜÃr_¿dius
 > 0.0)

441 
	`d©a_add_»®
(
	`Ãw_©Œibu‹
(
obj_node
, "corner_radius"),

442 
zigzaglše
->
cÜÃr_¿dius
);

443 
	}
}

445 
DŸObjeù
 *

446 
	$zigzaglše_lßd
(
ObjeùNode
 
obj_node
, 
v”siÚ
, cÚ¡ *
f’ame
)

448 
Zigzaglše
 *
zigzaglše
;

449 
O¹hCÚn
 *
Üth
;

450 
DŸObjeù
 *
obj
;

451 
A‰ribu‹Node
 
©Œ
;

453 
zigzaglše
 = 
	`g_m®loc0
((
Zigzaglše
));

455 
Üth
 = &
zigzaglše
->orth;

456 
obj
 = &
Üth
->
objeù
;

458 
obj
->
ty³
 = &
zigzaglše_ty³
;

459 
obj
->
İs
 = &
zigzaglše_İs
;

461 
	`ÜthcÚn_lßd
(
Üth
, 
obj_node
);

463 
zigzaglše
->
lše_cŞÜ
 = 
cŞÜ_bÏck
;

464 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_color");

465 ià(
©Œ
 !ğ
NULL
)

466 
	`d©a_cŞÜ
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
), &
zigzaglše
->
lše_cŞÜ
);

468 
zigzaglše
->
lše_width
 = 0.1;

469 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, 
PROP_STDNAME_LINE_WIDTH
);

470 ià(
©Œ
 !ğ
NULL
)

471 
zigzaglše
->
lše_width
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

473 
zigzaglše
->
lše_¡yË
 = 
LINESTYLE_SOLID
;

474 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "line_style");

475 ià(
©Œ
 !ğ
NULL
)

476 
zigzaglše
->
lše_¡yË
 = 
	`d©a_’um
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

478 
	`lßd_¬row
(
obj_node
, &
zigzaglše
->
¡¬t_¬row
, "start_arrow",

481 
	`lßd_¬row
(
obj_node
, &
zigzaglše
->
’d_¬row
, "end_arrow",

484 
zigzaglše
->
dashËngth
 = 
DEFAULT_LINESTYLE_DASHLEN
;

485 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "dashlength");

486 ià(
©Œ
 !ğ
NULL
)

487 
zigzaglše
->
dashËngth
 = 
	`d©a_»®
(
	`©Œibu‹_fœ¡_d©a
(
©Œ
));

489 
zigzaglše
->
cÜÃr_¿dius
 = 0.0;

490 
©Œ
 = 
	`objeù_fšd_©Œibu‹
(
obj_node
, "corner_radius");

491 ià(
©Œ
 !ğ
NULL
)

492 
zigzaglše
->
cÜÃr_¿dius
 = 
	`d©a_»®
Ğ
	`©Œibu‹_fœ¡_d©a
(
©Œ
) );

494 
	`zigzaglše_upd©e_d©a
(
zigzaglše
);

496  &
zigzaglše
->
Üth
.
objeù
;

497 
	}
}

	@config.h

5 
	#ENABLE_NLS
 1

	)

7 
	#LIBDIA_COMPILATION
 1

	)

9 
	#GETTEXT_PACKAGE
 "dŸ"

	)

18 
	#HAVE_BIND_TEXTDOMAIN_CODESET
 1

	)

21 
	#HAVE_CAIRO
 1

	)

24 
	#HAVE_DCGETTEXT
 1

	)

27 
	#HAVE_DLFCN_H
 1

	)

31 
	#HAVE_FCNTL_H
 1

	)

34 
	#HAVE_FREETYPE
 1

	)

37 
	#HAVE_GETTEXT
 1

	)

43 
	#HAVE_INTTYPES_H
 1

	)

46 
	#HAVE_ISINF
 1

	)

49 
	#HAVE_LC_MESSAGES
 1

	)

58 
	#HAVE_LIBPNG


	)

61 
	#HAVE_LIBZ


	)

64 
	#HAVE_LOCALE_H
 1

	)

67 
	#HAVE_MATH_H
 1

	)

70 
	#HAVE_MEMORY_H
 1

	)

73 
	#HAVE_PANGOCAIRO_H
 1

	)

76 
	#HAVE_SELECT
 1

	)

79 
	#HAVE_STDDEF_H
 1

	)

82 
	#HAVE_STDINT_H
 1

	)

85 
	#HAVE_STDLIB_H
 1

	)

88 
	#HAVE_STRCSPN
 1

	)

91 
	#HAVE_STRDUP
 1

	)

94 
	#HAVE_STRINGS_H
 1

	)

97 
	#HAVE_STRING_H
 1

	)

100 
	#HAVE_STRTOL
 1

	)

103 
	#HAVE_SYS_STAT_H
 1

	)

106 
	#HAVE_SYS_TYPES_H
 1

	)

109 
	#HAVE_UNISTD_H
 1

	)

112 
	#HAVE_UTIME_H
 1

	)

115 
	#HAVE_ZLIB_H
 1

	)

118 
	#LIBXSLT_PREFIX
 "/u¤/lib"

	)

125 
	#PACKAGE
 "dŸ"

	)

128 
	#PACKAGE_BUGREPORT
 "h‰p://bugzÏ.gnome.Üg/’‹r_bug.cgi?´oduù=dŸ"

	)

131 
	#PACKAGE_NAME
 "dŸ"

	)

134 
	#PACKAGE_STRING
 "dŸ 0.97.4"

	)

137 
	#PACKAGE_TARNAME
 "dŸ"

	)

140 
	#PACKAGE_URL
 ""

	)

143 
	#PACKAGE_VERSION
 "0.97.4"

	)

146 
	#STDC_HEADERS
 1

	)

149 
	#VERSION
 "0.97.4"

	)

	@lib/diamarshal.h

2 #iâdeà
__dŸ_m¬sh®_MARSHAL_H__


3 
	#__dŸ_m¬sh®_MARSHAL_H__


	)

5 
	~<glib-objeù.h
>

6 
	~"dŸv¬.h
"

7 
	gG_BEGIN_DECLS


10 
	#dŸ_m¬sh®_VOID__VOID
 
g_cşosu»_m¬sh®_VOID__VOID


	)

13 
	#dŸ_m¬sh®_VOID__OBJECT
 
g_cşosu»_m¬sh®_VOID__OBJECT


	)

16 
	#dŸ_m¬sh®_VOID__INT
 
g_cşosu»_m¬sh®_VOID__INT


	)

19 
dŸ_m¬sh®_VOID__POINTER_POINTER
 (
GClosu»
 *
şosu»
,

20 
GV®ue
 *
»tuº_v®ue
,

21 
gušt
 
n_·¿m_v®ues
,

22 cÚ¡ 
GV®ue
 *
·¿m_v®ues
,

23 
gpoš‹r
 
švoÿtiÚ_hšt
,

24 
gpoš‹r
 
m¬sh®_d©a
);

27 
dŸ_m¬sh®_VOID__STRING_FLAGS
 (
GClosu»
 *
şosu»
,

28 
GV®ue
 *
»tuº_v®ue
,

29 
gušt
 
n_·¿m_v®ues
,

30 cÚ¡ 
GV®ue
 *
·¿m_v®ues
,

31 
gpoš‹r
 
švoÿtiÚ_hšt
,

32 
gpoš‹r
 
m¬sh®_d©a
);

34 
	gG_END_DECLS


	@lib/geometry.h

20 #iâdeà
GEOMETRY_H


21 
	#GEOMETRY_H


	)

23 #ifdeà
HAVE_CONFIG_H


24 
	~<cÚfig.h
>

27 
	~"dŸty³s.h
"

29 
	~<glib.h
>

30 
	~<m©h.h
>

36 #ifdeà
HAVE_IEEEFP_H


37 
	~<›“å.h
>

39 #iâdeà
HAVE_ISINF


40 
	#isšf
(
a
è(!
	`fš™e
×))

	)

43 #ifdeà
_MSC_VER


46 
	~<æßt.h
>

47 
	#fš™e
(
a
è
	`_fš™e
×)

	)

48 
	#i¢ª
(
a
è
	`_i¢ª
×)

	)

50 #ifdeà
G_OS_WIN32


51 
	#M_PI
 3.14159265358979323846

	)

52 
	#M_SQRT2
 1.41421356237309504880

	)

53 
	#M_SQRT1_2
 0.70710678118654752440

	)

57 #iâdeà
M_PI


58 
	#M_PI
 
G_PI


	)

60 #iâdeà
M_SQRT2


61 
	#M_SQRT2
 
G_SQRT2


	)

63 #iâdeà
M_SQRT1_2


64 
	#M_SQRT1_2
 (1.0/
G_SQRT2
)

	)

67 
G_BEGIN_DECLS


78 
	t»®
;

79 
»®
 
	tcoÜd
;

82 
	s_Pošt
 {

83 
coÜd
 
	mx
;

84 
coÜd
 
	my
;

88 
	s_ReùªgË
 {

89 
coÜd
 
	mËá
;

90 
coÜd
 
	mtİ
;

91 
coÜd
 
	mright
;

92 
coÜd
 
	mbÙtom
;

96 
	s_IÁReùªgË
 {

97 
	mËá
;

98 
	mtİ
;

99 
	mright
;

100 
	mbÙtom
;

106 
	s_BezPošt
 {

108 
	mBEZ_MOVE_TO
,

109 
	mBEZ_LINE_TO
,

110 
	mBEZ_CURVE_TO


111 } 
	mty³
;

112 
Pošt
 
	mp1
;

113 
Pošt
 
	mp2
;

114 
Pošt
 
	mp3
;

118 
	#ROUND
(
x
è((è
	`æoÜ
((x)+0.5))

	)

122 
G_INLINE_FUNC
 
pošt_add
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

123 #ifdeà
G_CAN_INLINE


124 
G_INLINE_FUNC
 

125 
	$pošt_add
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

127 
p1
->
x
 +ğ
p2
->x;

128 
p1
->
y
 +ğ
p2
->y;

129 
	}
}

132 
G_INLINE_FUNC
 
pošt_sub
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

133 #ifdeà
G_CAN_INLINE


134 
G_INLINE_FUNC
 

135 
	$pošt_sub
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

137 
p1
->
x
 -ğ
p2
->x;

138 
p1
->
y
 -ğ
p2
->y;

139 
	}
}

142 
G_INLINE_FUNC
 
»®
 
pošt_dÙ
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

143 #ifdeà
G_CAN_INLINE


144 
G_INLINE_FUNC
 
»®


145 
	$pošt_dÙ
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

147  
p1
->
x
*
p2
->x +…1->
y
*p2->y;

148 
	}
}

151 
G_INLINE_FUNC
 
»®
 
pošt_Ën
(cÚ¡ 
Pošt
 *
p
);

152 #ifdeà
G_CAN_INLINE


153 
G_INLINE_FUNC
 
»®


154 
	$pošt_Ën
(cÚ¡ 
Pošt
 *
p
)

156  
	`sq¹
(
p
->
x
*p->x +…->
y
*p->y);

157 
	}
}

160 
G_INLINE_FUNC
 
pošt_sÿË
(
Pošt
 *
p
, 
»®
 
®pha
);

161 #ifdeà
G_CAN_INLINE


162 
G_INLINE_FUNC
 

163 
	$pošt_sÿË
(
Pošt
 *
p
, 
»®
 
®pha
)

165 
p
->
x
 *ğ
®pha
;

166 
p
->
y
 *ğ
®pha
;

167 
	}
}

170 
G_INLINE_FUNC
 
pošt_nÜm®ize
(
Pošt
 *
p
);

171 #ifdeà
G_CAN_INLINE


172 
G_INLINE_FUNC
 

173 
	$pošt_nÜm®ize
(
Pošt
 *
p
)

175 
»®
 
Ën
;

177 
Ën
 = 
	`sq¹
(
p
->
x
*p->x +…->
y
*p->y);

184 ià(
Ën
 > 0.0) {

185 
p
->
x
 /ğ
Ën
;

186 
p
->
y
 /ğ
Ën
;

188 
p
->
x
 = 0.0;

189 
p
->
y
 = 0.0;

192 
	}
}

195 
G_INLINE_FUNC
 
pošt_rÙ©e
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

196 #ifdeà
G_CAN_INLINE


197 
G_INLINE_FUNC
 

198 
	$pošt_rÙ©e
(
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

200 
p1
->
x
 =…1->x*
p2
->x -…1->
y
*p2->y;

201 
p1
->
y
 =…1->
x
*
p2
->y +…1->y*p2->x;

202 
	}
}

205 
G_INLINE_FUNC
 
pošt_g‘_nÜmed
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
);

206 #ifdeà
G_CAN_INLINE


207 
G_INLINE_FUNC
 

208 
	$pošt_g‘_nÜmed
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
)

210 
»®
 
Ën
;

212 
Ën
 = 
	`sq¹
(
¤c
->
x
*¤c->x + src->
y
*src->y);

214 
d¡
->
x
 = 
¤c
->x / 
Ën
;

215 
d¡
->
y
 = 
¤c
->y / 
Ën
;

216 
	}
}

219 
G_INLINE_FUNC
 
pošt_g‘_³½
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
);

220 #ifdeà
G_CAN_INLINE


221 
G_INLINE_FUNC
 

222 
	$pošt_g‘_³½
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
)

226 
d¡
->
y
 = 
¤c
->
x
;

227 
d¡
->
x
 = -
¤c
->
y
;

228 
	}
}

231 
G_INLINE_FUNC
 
pošt_cİy
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
);

232 #ifdeà
G_CAN_INLINE


233 
G_INLINE_FUNC
 

234 
	$pošt_cİy
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
)

241 
d¡
->
x
 = 
¤c
->x;

242 
d¡
->
y
 = 
¤c
->y;

243 
	}
}

246 
G_INLINE_FUNC
 
pošt_add_sÿËd
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
, 
»®
 
®pha
);

247 #ifdeà
G_CAN_INLINE


248 
G_INLINE_FUNC
 

249 
	$pošt_add_sÿËd
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
, 
»®
 
®pha
)

252 
d¡
->
x
 +ğ
®pha
 * 
¤c
->x;

253 
d¡
->
y
 +ğ
®pha
 * 
¤c
->y;

254 
	}
}

257 
G_INLINE_FUNC
 
pošt_cİy_add_sÿËd
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
,

258 cÚ¡ 
Pošt
 *
vù
,

259 
»®
 
®pha
);

260 #ifdeà
G_CAN_INLINE


261 
G_INLINE_FUNC
 

262 
	$pošt_cİy_add_sÿËd
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c
,

263 cÚ¡ 
Pošt
 *
vù
, 
»®
 
®pha
)

266 
d¡
->
x
 = 
¤c
->x + (
®pha
 * 
vù
->x);

267 
d¡
->
y
 = 
¤c
->y + (
®pha
 * 
vù
->y);

268 
	}
}

271 
DIAVAR
 
pošt_cÚvex
(
Pošt
 *
d¡
, cÚ¡ Pošˆ*
¤c1
, cÚ¡ Pošˆ*
¤c2
, 
»®
 
®pha
);

273 
DIAVAR
 
»ùªgË_uniÚ
(
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
);

274 
DIAVAR
 
št_»ùªgË_uniÚ
(
IÁReùªgË
 *
r1
, cÚ¡ IÁReùªgË *
r2
);

275 
DIAVAR
 
»ùªgË_š‹r£ùiÚ
(
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
);

276 
DIAVAR
 
»ùªgË_š‹r£ùs
(cÚ¡ 
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
);

277 
pošt_š_»ùªgË
(cÚ¡ 
ReùªgË
* 
r
, cÚ¡ 
Pošt
 *
p
);

278 
DIAVAR
 
»ùªgË_š_»ùªgË
(cÚ¡ 
ReùªgË
* 
ou‹r
, cÚ¡ ReùªgË *
šÃr
);

279 
DIAVAR
 
»ùªgË_add_pošt
(
ReùªgË
 *
r
, cÚ¡ 
Pošt
 *
p
);

281 
G_INLINE_FUNC
 
gboŞ—n
 
»ùªgË_equ®s
(cÚ¡ 
ReùªgË
 *
Şd_ex‹Ás
,

282 cÚ¡ 
ReùªgË
 *
Ãw_ex‹Ás
);

283 #ifdeà
G_CAN_INLINE


284 
G_INLINE_FUNC
 
gboŞ—n


285 
	$»ùªgË_equ®s
(cÚ¡ 
ReùªgË
 *
r1
, cÚ¡ ReùªgË *
r2
)

287  ( (
r2
->
Ëá
 =ğ
r1
->left) &&

288 (
r2
->
right
 =ğ
r1
->right) &&

289 (
r2
->
tİ
 =ğ
r1
->top) &&

290 (
r2
->
bÙtom
 =ğ
r1
->bottom) );

291 
	}
}

294 
G_INLINE_FUNC
 
»®
 
di¡ªû_pošt_pošt
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
);

295 #ifdeà
G_CAN_INLINE


296 
G_INLINE_FUNC
 
»®


297 
	$di¡ªû_pošt_pošt
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

299 
»®
 
dx
 = 
p1
->
x
 - 
p2
->x;

300 
»®
 
dy
 = 
p1
->
y
 - 
p2
->y;

301  
	`sq¹
(
dx
*dx + 
dy
*dy);

302 
	}
}

305 
G_INLINE_FUNC
 cÚ¡ 
Pošt
 *
şo£¡_to
(cÚ¡ Pošˆ*
to
, cÚ¡ Pošˆ*
p1
, cÚ¡ Pošˆ*
p2
);

306 #ifdeà
G_CAN_INLINE


307 
G_INLINE_FUNC
 cÚ¡ 
Pošt
 *

308 
	$şo£¡_to
(cÚ¡ 
Pošt
 *
to
, cÚ¡ Pošˆ*
p1
, cÚ¡ Pošˆ*
p2
)

310 ià(
	`di¡ªû_pošt_pošt
(
to
,
p1
è< di¡ªû_pošt_poštÑo,
p2
))

311  
p1
;

312  
p2
;

313 
	}
}

316 
G_INLINE_FUNC
 
»®
 
di¡ªû_pošt_pošt_mªh©n
(cÚ¡ 
Pošt
 *
p1
,

317 cÚ¡ 
Pošt
 *
p2
);

318 #ifdeà
G_CAN_INLINE


319 
G_INLINE_FUNC
 
»®


320 
	$di¡ªû_pošt_pošt_mªh©n
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
)

322 
»®
 
dx
 = 
p1
->
x
 - 
p2
->x;

323 
»®
 
dy
 = 
p1
->
y
 - 
p2
->y;

324  
	`ABS
(
dx
è+ ABS(
dy
);

325 
	}
}

328 
DIAVAR
 
»®
 
di¡ªû_»ùªgË_pošt
(cÚ¡ 
ReùªgË
 *
»ù
, cÚ¡ 
Pošt
 *
pošt
);

329 
DIAVAR
 
»®
 
di¡ªû_lše_pošt
(cÚ¡ 
Pošt
 *
lše_¡¬t
, cÚ¡ Pošˆ*
lše_’d
,

330 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

332 
DIAVAR
 
»®
 
di¡ªû_pŞygÚ_pošt
(cÚ¡ 
Pošt
 *
pŞy
, 
gušt
 
Åošts
,

333 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

336 
DIAVAR
 
»®
 
di¡ªû_bez_£g_pošt
(cÚ¡ 
Pošt
 *
b1
, cÚ¡ Pošˆ*
b2
,

337 cÚ¡ 
Pošt
 *
b3
, cÚ¡ Pošˆ*
b4
,

338 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

339 
DIAVAR
 
»®
 
di¡ªû_bez_lše_pošt
(cÚ¡ 
BezPošt
 *
b
, 
gušt
 
Åošts
,

340 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

341 
DIAVAR
 
»®
 
di¡ªû_bez_sh­e_pošt
(cÚ¡ 
BezPošt
 *
b
, 
gušt
 
Åošts
,

342 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

344 
DIAVAR
 
»®
 
di¡ªû_–l£_pošt
(cÚ¡ 
Pošt
 *
ûÁ»
,„—È
width
,„—È
height
,

345 
»®
 
lše_width
, cÚ¡ 
Pošt
 *
pošt
);

347 
»®
 
	tVeùÜ
[3];

348 
VeùÜ
 
	tM©rix
[3];

350 
DIAVAR
 
ŒªsfÜm_pošt
 (
M©rix
, 
Pošt
 *, Point *);

351 
muÉ_m©rix
 (
M©rix
, Matrix);

352 
DIAVAR
 
id’t™y_m©rix
 (
M©rix
);

353 
Œª¦©e_m©rix
 (
M©rix
, 
»®
,„eal);

354 
sÿË_m©rix
 (
M©rix
, 
»®
,„eal);

355 
DIAVAR
 
rÙ©e_m©rix
 (
M©rix
, 
»®
);

356 
xsh—r_m©rix
 (
M©rix
, 
»®
);

357 
ysh—r_m©rix
 (
M©rix
, 
»®
);

359 
»®
 
dÙ2
(
Pošt
 *
p1
, Pošˆ*
p2
);

360 
lše_cÛf
(
»®
 *
a
,„—È*
b
,„—È*
c
, 
Pošt
 *
p1
, Pošˆ*
p2
);

361 
»®
 
lše_to_pošt
Ô—È
a
,„—È
b
 ,„—È
c
, 
Pošt
 *
p
);

362 
pošt_³½
(
Pošt
 *
p
, 
»®
 
a
,„—È
b
,„—È
c
, Pošˆ*
³½
);

363 
fËt
(
Pošt
 *
p1
, Pošˆ*
p2
, Pošˆ*
p3
, Pošˆ*
p4
,

364 
»®
 
r
, 
Pošt
 *
c
,„—È*
·
,„—È*
¯
);

365 
DIAVAR
 
th»e_pošt_cœşe
(cÚ¡ 
Pošt
 *
p1
, cÚ¡ Pošˆ*
p2
, cÚ¡ Pošˆ*
p3
,

366 
Pošt
* 
ûÁ”
, 
»®
* 
¿dius
);

367 
DIAVAR
 
»®
 
pošt_üoss
(
Pošt
 *
p1
, Pošˆ*
p2
);

368 
DIAVAR
 
Pošt
 
ÿlcuÏ‹_objeù_edge
(Pošˆ*
objmid
, Pošˆ*
’d
, 
DŸObjeù
 *
obj
);

370 
	gG_END_DECLS


	@lib/parent.h

19 #iâdeà
PARENT_H


20 
	#PARENT_H


	)

22 
	~<glib.h
>

23 
	~"geom‘ry.h
"

25 
DIAVAR
 
GLi¡
 *
·»Á_li¡_afãùed
(GLi¡ *
obj_li¡
);

26 
DIAVAR
 
gboŞ—n
 
·»Á_hªdË_ex‹Ás
(
DŸObjeù
 *
obj
, 
ReùªgË
 *
ex‹Ás
);

27 
DIAVAR
 
Pošt
 
·»Á_move_chd_d–
(
ReùªgË
 *
p_ext
, ReùªgË *
c_‹xt
, Pošˆ*
d–
);

28 
DIAVAR
 
·»Á_pošt_ex‹Ás
(
Pošt
 *
pošt
, 
ReùªgË
 *
ex‹Ás
);

29 
gboŞ—n
 
·»Á_li¡_ex·nd
(
GLi¡
 *
obj_li¡
);

30 
DIAVAR
 
GLi¡
 *
·»Á_li¡_afãùed_h›¿rchy
(GLi¡ *
obj_li¡
);

31 
DIAVAR
 
gboŞ—n
 
·»Á_hªdË_move_out_check
(
DŸObjeù
 *
objeù
, 
Pošt
 *
to
);

32 
DIAVAR
 
gboŞ—n
 
·»Á_hªdË_move_š_check
(
DŸObjeù
 *
objeù
, 
Pošt
 *
to
, Pošˆ*
¡¬t_©
);

33 
DIAVAR
 
·»Á_­¶y_to_chd»n
(
DŸObjeù
 *
obj
, 
DŸObjeùFunc
 
func
);

	@lib/prefs.h

21 #iâdeà
PREFS_H


22 
	#PREFS_H


	)

24 #ifdeà
HAVE_CONFIG_H


25 
	~<cÚfig.h
>

28 
	~"dŸty³s.h
"

29 
	~"widg‘s.h
"

31 
DIAVAR
 
´efs_£t_Ëngth_un™
(
gch¬
* 
un™
);

32 
DIAVAR
 
´efs_£t_fÚtsize_un™
(
gch¬
* 
un™
);

34 
DIAVAR
 
DŸUn™
 
´efs_g‘_Ëngth_un™
();

35 
DIAVAR
 
DŸUn™
 
´efs_g‘_fÚtsize_un™
();

	@lib/properties.h

24 #iâdeà
LIB_PROPERTIES_H


25 
	#LIB_PROPERTIES_H


	)

27 #iâdeà
WIDGET


28 #ifdeà
GTK_WIDGET


29 
	#WIDGET
 
GtkWidg‘


	)

31 
	#WIDGET
 

	)

36 #ifdeà
HAVE_STDDEF_H


37 
	~<¡ddef.h
>

40 
	~<glib.h
>

41 
	~"dŸty³s.h
"

43 
	~"geom‘ry.h
"

44 
	~"¬rows.h
"

45 
	~"cŞÜ.h
"

46 
	~"fÚt.h
"

47 
	~"dŸ_xml.h
"

48 
	~"š.h
"

49 
	~"‹x‰r.h
"

51 
G_BEGIN_DECLS


53 
	$gboŞ—n
 (*
	tPrİDescToPrİP»diÿ‹
)(cÚ¡ 
	tPrİDesütiÚ
 *
	tpdesc
);

55 
	s_PrİWidg‘Assoc
 {

56 
Prİ”ty
 *
´İ
;

57 
WIDGET
 *
widg‘
;

60 
	s_PrİDŸlog
 {

61 
WIDGET
 *
widg‘
;

63 
GPŒA¼ay
 *
´İs
;

64 
GA¼ay
 *
´İ_widg‘s
;

67 
GLi¡
 *
objeùs
;

68 
GLi¡
 *
cİ›s
;

70 
GPŒA¼ay
 *
cÚš”s
;

71 
WIDGET
 *
Ï¡cÚt
;

72 
WIDGET
 *
cu¹abË
;

73 
gušt
 
cu¼ow
;

76 
	s_PrİEv’tD©a
 {

77 
PrİDŸlog
 *
dŸlog
;

78 
gušt
 
my_šdex
;

79 
WIDGET
 *
widg‘
;

80 
Prİ”ty
 *
£lf
;

83 
	$gboŞ—n
 (*
	tPrİEv’tHªdËr
è(
	tDŸObjeù
 *
	tobj
, 
	tPrİ”ty
 *
	t´İ
);

85 
	s_PrİEv’tHªdËrChaš
 {

86 
PrİEv’tHªdËr
 
hªdËr
;

87 
PrİEv’tHªdËrChaš
 *
chaš
;

93 
Prİ”ty
 * (*
	tPrİ”tyTy³_New
è(cÚ¡ 
	tPrİDesütiÚ
 *
	tpdesc
,

94 
	tPrİDescToPrİP»diÿ‹
 
	t»asÚ
);

96 (* 
	tPrİ”tyTy³_F»e
)(
	tPrİ”ty
 *
	t´İ
);

98 
Prİ”ty
 *(* 
	tPrİ”tyTy³_Cİy
)(
	tPrİ”ty
 *
	t¤c
);

101 
WIDGET
 *(* 
	tPrİ”tyTy³_G‘Widg‘
)(
	tPrİ”ty
 *
	t´İ
,

102 
	tPrİDŸlog
 *
	tdŸlog
);

105 (* 
	tPrİ”tyTy³_Re£tWidg‘
)(cÚ¡ 
	tPrİ”ty
 *
	t´İ
, 
	tWIDGET
 *
	twidg‘
);

107 (* 
	tPrİ”tyTy³_S‘FromWidg‘
)(
	tPrİ”ty
 *
	t´İ
, 
	tWIDGET
 *
	twidg‘
);

109 (*
	tPrİ”tyTy³_Lßd
)(
	tPrİ”ty
 *
	t´İ
, 
	tA‰ribu‹Node
 
	t©Œ
, 
	tD©aNode
 
	td©a
);

110 (*
	tPrİ”tyTy³_Save
)(
	tPrİ”ty
 *
	t´İ
, 
	tA‰ribu‹Node
 
	t©Œ
);

114 
	$gboŞ—n
 (*
	tPrİ”tyTy³_CªM”ge
)(cÚ¡ 
	tPrİDesütiÚ
 *
	tpd1
,cÚ¡ PrİDesütiÚ *
	tpd2
);

115 (*
	tPrİ”tyTy³_G‘FromOff£t
)(cÚ¡ 
	tPrİ”ty
 *
	t´İ
,

116 *
	tba£
, 
	tgušt
 
	toff£t
, gušˆ
	toff£t2
);

117 (*
	tPrİ”tyTy³_S‘FromOff£t
)(
	tPrİ”ty
 *
	t´İ
,

118 *
	tba£
, 
	tgušt
 
	toff£t
, gušˆ
	toff£t2
);

119 (*
	tPrİ”tyTy³_G‘D©aSize
)(
	tPrİ”ty
 *
	t´İ
);

122 
	s_Prİ”tyOps
 {

123 
Prİ”tyTy³_New
 
Ãw_´İ
;

124 
Prİ”tyTy³_F»e
 
ä“
;

125 
Prİ”tyTy³_Cİy
 
cİy
;

126 
Prİ”tyTy³_Lßd
 
lßd
;

127 
Prİ”tyTy³_Save
 
§ve
;

128 
Prİ”tyTy³_G‘Widg‘
 
g‘_widg‘
;

129 
Prİ”tyTy³_Re£tWidg‘
 
»£t_widg‘
;

130 
Prİ”tyTy³_S‘FromWidg‘
 
£t_äom_widg‘
;

132 
Prİ”tyTy³_CªM”ge
 
ÿn_m”ge
;

134 
Prİ”tyTy³_G‘FromOff£t
 
g‘_äom_off£t
;

135 
Prİ”tyTy³_S‘FromOff£t
 
£t_äom_off£t
;

136 
Prİ”tyTy³_G‘D©aSize
 
g‘_d©a_size
;

139 cÚ¡ 
	tgch¬
 *
	tPrİ”tyTy³
;

142 
	#PROP_TYPE_INVALID
 "šv®id"

	)

143 
	#PROP_TYPE_NOOP
 "noİ"

	)

144 
	#PROP_TYPE_UNIMPLEMENTED
 "unim¶em’‹d"

	)

147 
	#PROP_TYPE_CHAR
 "ch¬"

	)

148 
	#PROP_TYPE_BOOL
 "boŞ"

	)

149 
	#PROP_TYPE_INT
 "št"

	)

150 
	#PROP_TYPE_INTARRAY
 "š¼ay"

	)

151 
	#PROP_TYPE_ENUM
 "’um"

	)

152 
	#PROP_TYPE_ENUMARRAY
 "’um¬¿y"

	)

155 
	#PROP_TYPE_MULTISTRING
 "muÉi¡ršg"

	)

157 
	#PROP_TYPE_STRING
 "¡ršg"

	)

158 
	#PROP_TYPE_FILE
 "fe"

	)

159 
	#PROP_TYPE_TEXT
 "‹xt"

	)

160 
	#PROP_TYPE_STRINGLIST
 "¡ršgli¡"

	)

163 
	#PROP_TYPE_REAL
 "»®"

	)

164 
	#PROP_TYPE_LENGTH
 "Ëngth"

	)

165 
	#PROP_TYPE_FONTSIZE
 "fÚtsize"

	)

166 
	#PROP_TYPE_POINT
 "pošt"

	)

167 
	#PROP_TYPE_POINTARRAY
 "poš¼ay"

	)

168 
	#PROP_TYPE_BEZPOINT
 "bezpošt"

	)

169 
	#PROP_TYPE_BEZPOINTARRAY
 "bezpoš¼ay"

	)

170 
	#PROP_TYPE_RECT
 "»ù"

	)

171 
	#PROP_TYPE_ENDPOINTS
 "’dpošts"

	)

172 
	#PROP_TYPE_CONNPOINT_LINE
 "cÚÅošt_lše"

	)

175 
	#PROP_TYPE_LINESTYLE
 "lše¡yË"

	)

176 
	#PROP_TYPE_ARROW
 "¬row"

	)

177 
	#PROP_TYPE_COLOUR
 "cŞour"

	)

178 
	#PROP_TYPE_FONT
 "fÚt"

	)

181 
	#PROP_TYPE_STATIC
 "¡©ic"

	)

183 
	#PROP_TYPE_BUTTON
 "bu‰Ú"

	)

185 
	#PROP_TYPE_NOTEBOOK_BEGIN
 "nb_begš"

	)

186 
	#PROP_TYPE_NOTEBOOK_END
 "nb_’d"

	)

187 
	#PROP_TYPE_NOTEBOOK_PAGE
 "nb_·ge"

	)

188 
	#PROP_TYPE_MULTICOL_BEGIN
 "mc_begš"

	)

189 
	#PROP_TYPE_MULTICOL_END
 "mc_’d"

	)

190 
	#PROP_TYPE_MULTICOL_COLUMN
 "mc_cŞ"

	)

191 
	#PROP_TYPE_FRAME_BEGIN
 "f_begš"

	)

192 
	#PROP_TYPE_FRAME_END
 "f_’d"

	)

193 
	#PROP_TYPE_LIST
 "li¡"

	)

198 
	#PROP_TYPE_SARRAY
 "§¼ay"

	)

199 
	#PROP_TYPE_DARRAY
 "d¬¿y"

	)

200 
	#PROP_TYPE_DICT
 "diù"

	)

204 
	s_PrİDesütiÚ
 {

205 cÚ¡ 
gch¬
 *
Çme
;

206 
Prİ”tyTy³
 
ty³
;

207 
gušt
 
æags
;

208 cÚ¡ 
gch¬
 *
desütiÚ
;

209 cÚ¡ 
gch¬
 *
toŞt
;

214 
gpoš‹r
 
exŒa_d©a
;

221 
PrİEv’tHªdËr
 
ev’t_hªdËr
;

223 
GQu¬k
 
qu¬k
;

224 
GQu¬k
 
ty³_qu¬k
;

227 
PrİEv’tHªdËrChaš
 
chaš_hªdËr
;

229 cÚ¡ 
Prİ”tyOps
 *
İs
;

232 
	#PROP_FLAG_VISIBLE
 0x0001

	)

233 
	#PROP_FLAG_DONT_SAVE
 0x0002

	)

234 
	#PROP_FLAG_DONT_MERGE
 0x0004

	)

235 
	#PROP_FLAG_NO_DEFAULTS
 0x0008

	)

236 
	#PROP_FLAG_LOAD_ONLY
 0x0010

	)

237 
	#PROP_FLAG_STANDARD
 0x0020

	)

238 
	#PROP_FLAG_MULTIVALUE
 0x0040

	)

239 
	#PROP_FLAG_WIDGET_ONLY
 0x0080

	)

240 
	#PROP_FLAG_OPTIONAL
 0x0100

	)

242 ’um {
PROP_UNION
, 
PROP_INTERSECTION
} 
	tPrİM”geO±iÚ
;

244 
	#PROP_DESC_END
 { 
NULL
, 0, 0, NULL, NULL, NULL, 0 
	}

	)
}

247 
	s_PrİNumD©a
 {

248 
gæßt
 
	mmš
, 
	mmax
, 
	m¡•
;

250 
	s_PrİEnumD©a
 {

251 cÚ¡ 
gch¬
 *
	mÇme
;

252 
gušt
 
	m’umv
;

255 
	$gpoš‹r
 (*
	tNewRecÜdFunc
)();

256 (*
	tF»eRecÜdFunc
)(
	tgpoš‹r
 
	t»c
);

258 
	s_PrİDescCommÚA¼ayExŒa
 {

260 
PrİDesütiÚ
 *
»cÜd
;

261 
PrİOff£t
 *
off£ts
;

262 cÚ¡ 
gch¬
 *
compos™e_ty³
;

265 
	s_PrİDescDA¼ayExŒa
 {

266 
PrİDescCommÚA¼ayExŒa
 
commÚ
;

267 
NewRecÜdFunc
 
Ãw»c
;

268 
F»eRecÜdFunc
 
ä“»c
;

271 
	s_PrİDescSA¼ayExŒa
 {

272 
PrİDescCommÚA¼ayExŒa
 
commÚ
;

273 
gušt
 
–em’t_size
;

274 
gušt
 
¬¿y_Ën
;

281 
	s_Prİ”ty
 {

282 cÚ¡ 
gch¬
 *
Çme
;

283 
GQu¬k
 
Çme_qu¬k
;

284 
Prİ”tyTy³
 
ty³
;

285 
GQu¬k
 
ty³_qu¬k
;

286 cÚ¡ 
PrİDesütiÚ
 *
desü
;

287 
gpoš‹r
 
exŒa_d©a
;

288 
PrİEv’tD©a
 
£lf
;

289 
PrİEv’tHªdËr
 
ev’t_hªdËr
;

290 
PrİDescToPrİP»diÿ‹
 
»asÚ
;

292 
gušt
 
ex³r›nû
;

294 cÚ¡ 
Prİ”tyOps
 *
İs
;

295 cÚ¡ 
Prİ”tyOps
 *
»®_İs
;

299 
	#PXP_COPIED
 0x00000001

	)

300 
	#PXP_COPY
 0x00000002

	)

301 
	#PXP_GET_WIDGET
 0x00000004

	)

302 
	#PXP_RESET_WIDGET
 0x00000008

	)

303 
	#PXP_SET_FROM_WIDGET
 0x00000010

	)

304 
	#PXP_LOADED
 0x00000020

	)

305 
	#PXP_SAVED
 0x00000040

	)

306 
	#PXP_GFO
 0x00000080

	)

307 
	#PXP_SFO
 0x00000100

	)

308 
	#PXP_NOTSET
 0x00000200

	)

309 
	#PXP_SHAMELESS
 0xFFFFFFFF

	)

314 
DIAVAR
 
	`´İ_desc_li¡_ÿlcuÏ‹_qu¬ks
(
PrİDesütiÚ
 *
¶i¡
);

316 
DIAVAR
 cÚ¡ 
PrİDesütiÚ
 *
	`´İ_desc_li¡_fšd_´İ
(cÚ¡ PrİDesütiÚ *
¶i¡
,

317 cÚ¡ 
gch¬
 *
Çme
);

319 
DIAVAR
 
PrİEv’tHªdËr
 
	`´İ_desc_fšd_»®_hªdËr
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

321 
DIAVAR
 
	`´İ_desc_ä“_hªdËr_chaš
(
PrİDesütiÚ
 *
pdesc
);

323 
DIAVAR
 
	`´İ_desc_li¡_ä“_hªdËr_chaš
(
PrİDesütiÚ
 *
pdesc
);

325 
DIAVAR
 
	`´İ_desc_š£¹_hªdËr
(
PrİDesütiÚ
 *
pdesc
,

326 
PrİEv’tHªdËr
 
hªdËr
);

329 
DIAVAR
 
PrİDesütiÚ
 *
	`´İ_desc_li¡s_uniÚ
(
GLi¡
 *
¶i¡s
);

330 
DIAVAR
 
PrİDesütiÚ
 *
	`´İ_desc_li¡s_š‹r£ùiÚ
(
GLi¡
 *
¶i¡s
);

335 
	`´İ_ty³_»gi¡”
(
Prİ”tyTy³
 
ty³
, cÚ¡ 
Prİ”tyOps
 *
İs
);

336 cÚ¡ 
Prİ”tyOps
 *
	`´İ_ty³_g‘_İs
(
Prİ”tyTy³
 
ty³
);

341 
DIAVAR
 
	`´İ_li¡_ä“
(
GPŒA¼ay
 *
¶i¡
);

345 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_cİy
(GPŒA¼ay *
¶i¡
);

347 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_cİy_em±y
(GPŒA¼ay *
¶i¡
);

349 
DIAVAR
 
	`´İ_li¡_add_li¡
 (
GPŒA¼ay
 *
´İs
, cÚ¡ GPŒA¼ay *
±ßdd
);

351 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_äom_descs
(cÚ¡ 
PrİDesütiÚ
 *
¶i¡
,

352 
PrİDescToPrİP»diÿ‹
 
´ed
);

354 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_äom_sšgË
(
Prİ”ty
 *
´İ
);

357 
DIAVAR
 
gboŞ—n
 
	`pdp_Œue
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

358 
DIAVAR
 
gboŞ—n
 
	`pdp_is_visibË
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

359 
gboŞ—n
 
	`pdp_is_visibË_no_¡ªd¬d
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

360 
gboŞ—n
 
	`pdp_is_nÙ_visibË
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

361 
gboŞ—n
 
	`pdp_do_§ve
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

362 
gboŞ—n
 
	`pdp_do_§ve_no_¡ªd¬d
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

363 
gboŞ—n
 
	`pdp_do_lßd
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

364 
gboŞ—n
 
	`pdp_do_nÙ_§ve
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

366 
gboŞ—n
 
	`pdp_deçuÉs
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

368 
gboŞ—n
 
	`pdp_syÁh‘ic
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

369 
gboŞ—n
 
	`pdp_äom_objeù
(cÚ¡ 
PrİDesütiÚ
 *
pdesc
);

377 
DIAVAR
 
GPŒA¼ay
 *
	`´İ_li¡_of_sšgË
(
Prİ”ty
 *
´İ
);

382 
DIAVAR
 
Prİ”ty
 *
	`make_Ãw_´İ
(cÚ¡ *
Çme
, 
Prİ”tyTy³
 
ty³
, 
gušt
 
æags
);

389 #iâdeà
off£tof


390 
	#off£tof
(
ty³
, 
memb”
èĞ(è& (Ñy³*)0è-> memb” )

	)

392 
	s_PrİOff£t
 {

393 cÚ¡ 
gch¬
 *
Çme
;

394 
Prİ”tyTy³
 
ty³
;

395 
off£t
;

396 
off£t2
;

397 
GQu¬k
 
Çme_qu¬k
;

398 
GQu¬k
 
ty³_qu¬k
;

399 cÚ¡ 
Prİ”tyOps
 *
İs
;

407 
gboŞ—n
 
	`objeù_com¶›s_w™h_¡d´İ
(cÚ¡ 
DŸObjeù
 *
obj
);

408 
gboŞ—n
 
	`objeùs_com¶y_w™h_¡d´İ
(
GLi¡
 *
objeùs
);

410 
	`objeù_li¡_g‘_´İs
(
GLi¡
 *
objeùs
, 
GPŒA¼ay
 *
´İs
);

414 
DIAVAR
 cÚ¡ 
PrİDesütiÚ
 *
	`objeù_g‘_´İ_desütiÚs
(cÚ¡ 
DŸObjeù
 *
obj
);

415 cÚ¡ 
PrİDesütiÚ
 *
	`objeù_li¡_g‘_´İ_desütiÚs
(
GLi¡
 *
objeùs
,

416 
PrİM”geO±iÚ
 
İtiÚ
);

418 
DIAVAR
 
gboŞ—n
 
	`objeù_g‘_´İs_äom_off£ts
(
DŸObjeù
 *
obj
, 
PrİOff£t
 *
off£ts
,

419 
GPŒA¼ay
 *
´İs
);

420 
DIAVAR
 
gboŞ—n
 
	`objeù_£t_´İs_äom_off£ts
(
DŸObjeù
 *
obj
, 
PrİOff£t
 *
off£ts
,

421 
GPŒA¼ay
 *
´İs
);

424 
DIAVAR
 
ObjeùChªge
 *
	`objeù_­¶y_´İs
(
DŸObjeù
 *
obj
, 
GPŒA¼ay
 *
´İs
);

430 
DIAVAR
 
WIDGET
 *
	`objeù_ü—‹_´İs_dŸlog
 (
DŸObjeù
 *
obj
, 
gboŞ—n
 
is_deçuÉ
);

431 
DIAVAR
 
WIDGET
 *
	`objeù_li¡_ü—‹_´İs_dŸlog
(
GLi¡
 *
obj
, 
gboŞ—n
 
is_deçuÉ
);

432 
DIAVAR
 
ObjeùChªge
 *
	`objeù_­¶y_´İs_äom_dŸlog
 (
DŸObjeù
 *
obj
, 
WIDGET
 *
dŸlog
);

438 
DIAVAR
 
Prİ”ty
 *
	`objeù_´İ_by_Çme
(
DŸObjeù
 *
obj
, cÚ¡ *
Çme
);

439 
DIAVAR
 
Prİ”ty
 *
	`objeù_´İ_by_Çme_ty³
(
DŸObjeù
 *
obj
, cÚ¡ *
Çme
, cÚ¡ *
ty³
);

442 
DIAVAR
 
	`objeù_lßd_´İs
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
);

443 
DIAVAR
 
	`objeù_§ve_´İs
(
DŸObjeù
 *
obj
, 
ObjeùNode
 
obj_node
);

447 
DIAVAR
 
	`objeù_cİy_´İs
(
DŸObjeù
 *
de¡
, cÚ¡ DŸObjeù *
¤c
,

448 
gboŞ—n
 
is_deçuÉ
);

451 
DIAVAR
 
Prİ”ty
 *
	`objeù_g‘_´İ_by_Çme
 (
DŸObjeù
 *
obj
, cÚ¡ * 
Çme
);

455 
	`¡d´İs_š™
();

473 #ifdeà
G_OS_WIN32


474 
PrİNumD©a
 
´İ_¡d_lše_width_d©a
 = { 0.0f, 10.0f, 0.01à
	}
};

475 
PrİNumD©a
 
	g´İ_¡d_‹xt_height_d©a
 = { 0.1f, 10.0f, 0.1f };

476 
PrİEnumD©a
 
	g´İ_¡d_‹xt_®ign_d©a
[] = {

477 { 
N_
("Leá"), 
ALIGN_LEFT
 },

478 { 
N_
("C’‹r"), 
ALIGN_CENTER
 },

479 { 
N_
("Right"), 
ALIGN_RIGHT
 },

480 { 
NULL
, 0 }

483 
PrİNumD©a
 
´İ_¡d_lše_width_d©a
, 
´İ_¡d_‹xt_height_d©a
;

484 
PrİEnumD©a
 
´İ_¡d_‹xt_®ign_d©a
[];

487 
	#PROP_STDNAME_LINE_WIDTH
 "lše_width"

	)

488 
	#PROP_STDTYPE_LINE_WIDTH
 
PROP_TYPE_LENGTH


	)

489 
	#PROP_STD_LINE_WIDTH
 \

490 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

491 
	`N_
("Lšwidth"), 
NULL
, &
´İ_¡d_lše_width_d©a
 }

	)

492 
	#PROP_STD_LINE_WIDTH_OPTIONAL
 \

493 { 
PROP_STDNAME_LINE_WIDTH
, 
PROP_STDTYPE_LINE_WIDTH
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

494 
	`N_
("Lšwidth"), 
NULL
, &
´İ_¡d_lše_width_d©a
 }

	)

495 
	#PROP_STD_LINE_COLOUR
 \

496 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

497 
	`N_
("LšcŞÜ"), 
NULL
, NULL }

	)

498 
	#PROP_STD_LINE_COLOUR_OPTIONAL
 \

499 { "lše_cŞour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

500 
	`N_
("LšcŞÜ"), 
NULL
, NULL }

	)

501 
	#PROP_STD_LINE_STYLE
 \

502 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

503 
	`N_
("Lš¡yË"), 
NULL
, NULL }

	)

504 
	#PROP_STD_LINE_STYLE_OPTIONAL
 \

505 { "lše_¡yË", 
PROP_TYPE_LINESTYLE
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

506 
	`N_
("Lš¡yË"), 
NULL
, NULL }

	)

508 
	#PROP_STD_FILL_COLOUR
 \

509 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

510 
	`N_
("FÈcŞÜ"), 
NULL
, NULL }

	)

511 
	#PROP_STD_FILL_COLOUR_OPTIONAL
 \

512 { "fl_cŞour", 
PROP_TYPE_COLOUR
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
, \

513 
	`N_
("FÈcŞÜ"), 
NULL
, NULL }

	)

514 
	#PROP_STD_SHOW_BACKGROUND
 \

515 { "show_background", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
, \

516 
	`N_
("D¿w background"), 
NULL
, NULL }

	)

517 
	#PROP_STD_SHOW_BACKGROUND_OPTIONAL
 \

518 { "show_background", 
PROP_TYPE_BOOL
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_OPTIONAL
, \

519 
	`N_
("D¿w background"), 
NULL
, NULL }

	)

521 
	#PROP_STD_START_ARROW
 \

522 { "¡¬t_¬row", 
PROP_TYPE_ARROW
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

523 
	`N_
("S¹‡¼ow"), 
NULL
, NULL }

	)

524 
	#PROP_STD_END_ARROW
 \

525 { "’d_¬row", 
PROP_TYPE_ARROW
, 
PROP_FLAG_VISIBLE
|
PROP_FLAG_STANDARD
, \

526 
	`N_
("End‡¼ow"), 
NULL
, NULL }

	)

528 
	#PROP_STD_TEXT_OPTIONS
(
İtiÚs
) \

529 { "‹xt", 
PROP_TYPE_TEXT
, (
İtiÚs
), \

530 
	`N_
("Text"), 
NULL
, NULL }

	)

531 
	#PROP_STD_TEXT
 
	`PROP_STD_TEXT_OPTIONS
(
PROP_FLAG_DONT_SAVE
)

	)

532 
	#PROP_STD_SAVED_TEXT
 
	`PROP_STD_TEXT_OPTIONS
(0)

	)

534 
	#PROP_STD_TEXT_ALIGNMENT_OPTIONS
(
İtiÚs
) \

535 { "‹xt_®ignm’t", 
PROP_TYPE_ENUM
, (
İtiÚs
), \

536 
	`N_
("Texˆ®ignm’t"), 
NULL
, 
´İ_¡d_‹xt_®ign_d©a
 }

	)

537 
	#PROP_STD_TEXT_ALIGNMENT
 \

538 
	`PROP_STD_TEXT_ALIGNMENT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

540 
	#PROP_STD_TEXT_FONT_OPTIONS
(
İtiÚs
) \

541 { "‹xt_fÚt", 
PROP_TYPE_FONT
, (
İtiÚs
), 
	`N_
("FÚt"), 
NULL
, NULL }

	)

542 
	#PROP_STD_TEXT_FONT
 \

543 
	`PROP_STD_TEXT_FONT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

545 
	#PROP_STDNAME_TEXT_HEIGHT
 "‹xt_height"

	)

546 
	#PROP_STDTYPE_TEXT_HEIGHT
 
PROP_TYPE_FONTSIZE


	)

547 
	#PROP_STD_TEXT_HEIGHT_OPTIONS
(
İtiÚs
) \

548 { 
PROP_STDNAME_TEXT_HEIGHT
, 
PROP_STDTYPE_TEXT_HEIGHT
, (
İtiÚs
), \

549 
	`N_
("FÚˆsize"), 
NULL
, &
´İ_¡d_‹xt_height_d©a
 }

	)

550 
	#PROP_STD_TEXT_HEIGHT
 \

551 
	`PROP_STD_TEXT_HEIGHT_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
)

	)

553 
	#PROP_STD_TEXT_COLOUR_OPTIONS
(
İtiÚs
) \

554 { "‹xt_cŞour", 
PROP_TYPE_COLOUR
, (
İtiÚs
), \

555 
	`N_
("TexˆcŞÜ"), 
NULL
, NULL }

	)

556 
	#PROP_STD_TEXT_COLOUR
 \

557 
	`PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_STANDARD
)

	)

558 
	#PROP_STD_TEXT_COLOUR_OPTIONAL
 \

559 
	`PROP_STD_TEXT_COLOUR_OPTIONS
(
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_STANDARD
|
PROP_FLAG_OPTIONAL
)

	)

562 
	#PROP_NOTEBOOK_BEGIN
(
Çme
) \

563 { "nbook_" 
Çme
, 
PROP_TYPE_NOTEBOOK_BEGIN
, \

564 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
, 
NULL
, NULL}

	)

565 
	#PROP_STD_NOTEBOOK_BEGIN
 
	`PROP_NOTEBOOK_BEGIN
("¡d")

	)

566 
	#PROP_OFFSET_NOTEBOOK_BEGIN
(
Çme
) \

567 { "nbook_" 
Çme
, 
PROP_TYPE_NOTEBOOK_BEGIN
, 0}

	)

568 
	#PROP_OFFSET_STD_NOTEBOOK_BEGIN
 
	`PROP_OFFSET_NOTEBOOK_BEGIN
("¡d")

	)

570 
	#PROP_NOTEBOOK_END
(
Çme
) \

571 { "nbook_" 
Çme
 "_’d", 
PROP_TYPE_NOTEBOOK_END
, \

572 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
, 
NULL
, NULL}

	)

573 
	#PROP_STD_NOTEBOOK_END
 
	`PROP_NOTEBOOK_END
("¡d")

	)

574 
	#PROP_OFFSET_NOTEBOOK_END
(
Çme
) \

575 { "nbook_" 
Çme
 "_’d", 
PROP_TYPE_NOTEBOOK_END
, 0}

	)

576 
	#PROP_OFFSET_STD_NOTEBOOK_END
 
	`PROP_OFFSET_NOTEBOOK_END
("¡d")

	)

578 
	#PROP_NOTEBOOK_PAGE
(
Çme
,
æags
,
desü
) \

579 { "nbook_·ge_" 
Çme
, 
PROP_TYPE_NOTEBOOK_PAGE
, \

580 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
PROP_FLAG_DONT_MERGE
|
æags
,
desü
,
NULL
}

	)

581 
	#PROP_OFFSET_NOTEBOOK_PAGE
(
Çme
) \

582 { "nbook_·ge_" 
Çme
 , 
PROP_TYPE_NOTEBOOK_PAGE
, 0}

	)

584 
	#PROP_MULTICOL_BEGIN
(
Çme
) \

585 { "mcŞ_" 
Çme
, 
PROP_TYPE_MULTICOL_BEGIN
, \

586 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
, 
NULL
, NULL}

	)

587 
	#PROP_OFFSET_MULTICOL_BEGIN
(
Çme
) \

588 { "mcŞ_" 
Çme
, 
PROP_TYPE_NOTEBOOK_BEGIN
, 0}

	)

590 
	#PROP_MULTICOL_END
(
Çme
) \

591 { "mcŞ_" 
Çme
 "_’d", 
PROP_TYPE_MULTICOL_END
, \

592 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
, 
NULL
, NULL}

	)

593 
	#PROP_OFFSET_MULTICOL_END
(
Çme
) \

594 { "mcŞ_" 
Çme
 "_’d", 
PROP_TYPE_MULTICOL_END
, 0}

	)

596 
	#PROP_MULTICOL_COLUMN
(
Çme
) \

597 { "mcŞ_cŞ_" 
Çme
, 
PROP_TYPE_MULTICOL_COLUMN
, \

598 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
,
NULL
,NULL}

	)

599 
	#PROP_OFFSET_MULTICOL_COLUMN
(
Çme
) \

600 { "mcŞ_cŞ_" 
Çme
, 
PROP_TYPE_MULTICOL_COLUMN
, 0}

	)

602 
	#PROP_FRAME_BEGIN
(
Çme
,
æags
,
desü
) \

603 { "äame_" 
Çme
, 
PROP_TYPE_FRAME_BEGIN
, \

604 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
æags
, 
desü
, 
NULL
}

	)

605 
	#PROP_OFFSET_FRAME_BEGIN
(
Çme
) \

606 { "äame_" 
Çme
, 
PROP_TYPE_FRAME_BEGIN
, 0}

	)

608 
	#PROP_FRAME_END
(
Çme
,
æags
) \

609 { "äame_" 
Çme
 "_’d", 
PROP_TYPE_FRAME_END
, \

610 
PROP_FLAG_VISIBLE
|
PROP_FLAG_DONT_SAVE
|
PROP_FLAG_WIDGET_ONLY
|
æags
, 
NULL
, NULL}

	)

611 
	#PROP_OFFSET_FRAME_END
(
Çme
) \

612 { "äame_" 
Çme
 "_’d", 
PROP_TYPE_FRAME_END
, 0}

	)

614 
	gG_END_DECLS


	@lib/widgets.h

18 #iâdeà
WIDGETS_H


19 
	#WIDGETS_H


	)

21 
	~<cÚfig.h
>

23 
	~<gdk/gdk.h
>

24 
	~<gtk/gtkm’u.h
>

25 
	~<gtk/gtkİtiÚm’u.h
>

26 
	~<gtk/gtkd¿wšg¬—.h
>

27 
	~<gtk/gtkcŞÜ£l.h
>

28 
	~<gtk/gtkhbox.h
>

29 
	~<gtk/gtkfe£l.h
>

30 
	~<gtk/gtk¥šbu‰Ú.h
>

31 
	~<gtk/gtkÏb–.h
>

32 
	~<gtk/gtkcŞÜ£ldŸlog.h
>

33 
	~<gtk/gtkm’u™em.h
>

35 
	~"dŸty³s.h
"

36 
	~"fÚt.h
"

37 
	~"cŞÜ.h
"

38 
	~"¬rows.h
"

39 
	~"un™s.h
"

42 
	#DIAFONTSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_fÚt_£ËùÜ_g‘_ty³
 (), 
DŸFÚtS–eùÜ
)

	)

43 
	#DIAFONTSELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_fÚt_£ËùÜ_g‘_ty³
 (), 
DŸFÚtS–eùÜCÏss
)

	)

44 
	#IS_DIAFONTSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_fÚt_£ËùÜ_g‘_ty³
 ())

	)

47 
DIAVAR
 
GTy³
 
dŸ_fÚt_£ËùÜ_g‘_ty³
 ();

48 
DIAVAR
 
GtkWidg‘
* 
dŸ_fÚt_£ËùÜ_Ãw
 ();

49 
DIAVAR
 
dŸ_fÚt_£ËùÜ_£t_fÚt
 (
DŸFÚtS–eùÜ
 *
fs
, 
DŸFÚt
 *
fÚt
);

50 
dŸ_fÚt_£ËùÜ_£t_´ev›w
 (
DŸFÚtS–eùÜ
 *
fs
, 
gch¬
 *
‹xt
);

51 
DIAVAR
 
DŸFÚt
 * 
dŸ_fÚt_£ËùÜ_g‘_fÚt
 (
DŸFÚtS–eùÜ
 *
fs
);

54 
	#DIAALIGNMENTSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_®ignm’t_£ËùÜ_g‘_ty³
 (), 
DŸAlignm’tS–eùÜ
)

	)

55 
	#DIAALIGNMENTSELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_®ignm’t_£ËùÜ_g‘_ty³
 (), 
DŸAlignm’tS–eùÜCÏss
)

	)

56 
	#IS_DIAALIGNMENTSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_®ignm’t_£ËùÜ_g‘_ty³
 ())

	)

59 
DIAVAR
 
GTy³
 
dŸ_®ignm’t_£ËùÜ_g‘_ty³
 ();

60 
DIAVAR
 
GtkWidg‘
* 
dŸ_®ignm’t_£ËùÜ_Ãw
 ();

61 
DIAVAR
 
Alignm’t
 
dŸ_®ignm’t_£ËùÜ_g‘_®ignm’t
 (
DŸAlignm’tS–eùÜ
 *
as
);

62 
DIAVAR
 
dŸ_®ignm’t_£ËùÜ_£t_®ignm’t
 (
DŸAlignm’tS–eùÜ
 *
as
,

63 
Alignm’t
 
®ign
);

66 
	#DIALINESTYLESELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 (), 
DŸLšeStyËS–eùÜ
)

	)

67 
	#DIALINESTYLESELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 (), 
DŸLšeStyËS–eùÜCÏss
)

	)

68 
	#IS_DIALINESTYLESELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 ())

	)

70 
	#DEFAULT_LINESTYLE
 
LINESTYLE_SOLID


	)

71 
	#DEFAULT_LINESTYLE_DASHLEN
 1.0

	)

74 
DIAVAR
 
GTy³
 
dŸ_lše_¡yË_£ËùÜ_g‘_ty³
 ();

75 
DIAVAR
 
GtkWidg‘
* 
dŸ_lše_¡yË_£ËùÜ_Ãw
 ();

76 
DIAVAR
 
dŸ_lše_¡yË_£ËùÜ_g‘_lše¡yË
 (
DŸLšeStyËS–eùÜ
 *
as
,

77 
LšeStyË
 *
lše¡yË
,

78 
»®
 *
dashËngth
);

79 
DIAVAR
 
dŸ_lše_¡yË_£ËùÜ_£t_lše¡yË
 (
DŸLšeStyËS–eùÜ
 *
as
,

80 
LšeStyË
 
lše¡yË
,

81 
»®
 
dashËngth
);

84 
	#DIACOLORSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_cŞÜ_£ËùÜ_g‘_ty³
 (), 
DŸCŞÜS–eùÜ
)

	)

85 
	#DIACOLORSELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_cŞÜ_£ËùÜ_g‘_ty³
 (), 
DŸCŞÜS–eùÜCÏss
)

	)

86 
	#IS_DIACOLORSELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_cŞÜ_£ËùÜ_g‘_ty³
 ())

	)

88 
	#DEFAULT_FG_COLOR
 
cŞÜ_bÏck


	)

89 
	#DEFAULT_BG_COLOR
 
cŞÜ_wh™e


	)

90 
	#DEFAULT_COLOR
 
cŞÜ_wh™e


	)

94 
DIAVAR
 
GTy³
 
dŸ_cŞÜ_£ËùÜ_g‘_ty³
 ();

95 
DIAVAR
 
GtkWidg‘
* 
dŸ_cŞÜ_£ËùÜ_Ãw
 ();

96 
DIAVAR
 
dŸ_cŞÜ_£ËùÜ_g‘_cŞÜ
 (
GtkWidg‘
 *
cs
, 
CŞÜ
 *
cŞÜ
);

97 
DIAVAR
 
dŸ_cŞÜ_£ËùÜ_£t_cŞÜ
 (
GtkWidg‘
 *
cs
,

98 cÚ¡ 
CŞÜ
 *
cŞÜ
);

102 
	#DIA_TYPE_ARROW_SELECTOR
 (
	`dŸ_¬row_£ËùÜ_g‘_ty³
())

	)

103 
	#DIA_ARROW_SELECTOR
(
obj
è(
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_¬row_£ËùÜ_g‘_ty³
 (), 
DŸA¼owS–eùÜ
))

	)

104 
	#DIA_ARROW_SELECTOR_CLASS
(
kÏss
è(
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_¬row_£ËùÜ_g‘_ty³
 (), 
DŸA¼owS–eùÜCÏss
))

	)

105 
	#DIA_IS_ARROW_SELECTOR
(
obj
è(
	`G_TYPE_CHECK_TYPE
 (obj, 
	`dŸ_¬row_£ËùÜ_g‘_ty³
 ()))

	)

106 
	#DIA_ARROW_SELECTOR_GET_CLASS
(
obj
è(
	`G_TYPE_INSTANCE_GET_CLASS
 ((obj), 
DIA_TYPE_ARROW_SELECTOR
, 
DŸA¼owS–eùÜCÏss
))

	)

108 
	#DEFAULT_ARROW
 
ARROW_NONE


	)

109 
	#DEFAULT_ARROW_LENGTH
 
DEFAULT_ARROW_SIZE


	)

110 
	#DEFAULT_ARROW_WIDTH
 
DEFAULT_ARROW_SIZE


	)

113 
DIAVAR
 
GTy³
 
dŸ_¬row_£ËùÜ_g‘_ty³
 ();

114 
DIAVAR
 
GtkWidg‘
* 
dŸ_¬row_£ËùÜ_Ãw
 ();

115 
DIAVAR
 
A¼ow
 
dŸ_¬row_£ËùÜ_g‘_¬row
 (
DŸA¼owS–eùÜ
 *
as
);

116 
DIAVAR
 
dŸ_¬row_£ËùÜ_£t_¬row
 (
DŸA¼owS–eùÜ
 *
as
,

117 
A¼ow
 
¬row
);

121 
	#DIAFILESELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_fe_£ËùÜ_g‘_ty³
 (), 
DŸFeS–eùÜ
)

	)

122 
	#DIAFILESELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_fe_£ËùÜ_g‘_ty³
 (), 
DŸFeS–eùÜCÏss
)

	)

123 
	#IS_DIAFILESELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_fe_£ËùÜ_g‘_ty³
 ())

	)

126 
DIAVAR
 
GTy³
 
dŸ_fe_£ËùÜ_g‘_ty³
 ();

127 
DIAVAR
 
GtkWidg‘
* 
dŸ_fe_£ËùÜ_Ãw
 ();

128 
DIAVAR
 
dŸ_fe_£ËùÜ_£t_fe
 (
DŸFeS–eùÜ
 *
fs
, *
fe
);

129 
DIAVAR
 cÚ¡ 
gch¬
 *
dŸ_fe_£ËùÜ_g‘_fe
 (
DŸFeS–eùÜ
 *
fs
);

132 
	#DIA_SIZE_SELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
 (obj, 
	`dŸ_size_£ËùÜ_g‘_ty³
 (), 
DŸSizeS–eùÜ
)

	)

133 
	#DIA_SIZE_SELECTOR_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
 (kÏss, 
	`dŸ_size_£ËùÜ_g‘_ty³
 (), 
DŸSizeS–eùÜCÏss
)

	)

134 
	#IS_DIA_SIZE_SELECTOR
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
 (obj, 
	`dŸ_size_£ËùÜ_g‘_ty³
 ())

	)

137 
DIAVAR
 
GTy³
 
dŸ_size_£ËùÜ_g‘_ty³
 ();

138 
DIAVAR
 
GtkWidg‘
* 
dŸ_size_£ËùÜ_Ãw
 (
»®
 
width
,„—È
height
);

139 
DIAVAR
 
dŸ_size_£ËùÜ_£t_locked
(
DŸSizeS–eùÜ
 *
ss
, 
gboŞ—n
 
locked
);

140 
DIAVAR
 
dŸ_size_£ËùÜ_£t_size
 (
DŸSizeS–eùÜ
 *
ss
, 
»®
 
width
,„—È
height
);

141 
DIAVAR
 
gboŞ—n
 
dŸ_size_£ËùÜ_g‘_size
 (
DŸSizeS–eùÜ
 *
ss
, 
»®
 *
width
,„—È*
height
);

145 
	#DIA_UNIT_SPINNER
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
(obj, 
	`dŸ_un™_¥šÃr_g‘_ty³
(), 
DŸUn™SpšÃr
)

	)

146 
	#DIA_UNIT_SPINNER_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
(kÏss, 
	`dŸ_un™_¥šÃr_g‘_ty³
(), 
DŸUn™SpšÃrCÏss
)

	)

147 
	#DIA_IS_UNIT_SPINNER
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
(obj, 
	`dŸ_un™_¥šÃr_g‘_ty³
())

	)

149 
_DŸUn™SpšÃr
 
	tDŸUn™SpšÃr
;

150 
_DŸUn™SpšÃrCÏss
 
	tDŸUn™SpšÃrCÏss
;

152 
	s_DŸUn™SpšÃr
 {

153 
GtkSpšBu‰Ú
 
	m·»Á
;

155 
DŸUn™
 
	mun™_num
;

158 
	s_DŸUn™SpšÃrCÏss
 {

159 
GtkSpšBu‰ÚCÏss
 
	m·»Á_şass
;

163 
DIAVAR
 
GTy³
 
dŸ_un™_¥šÃr_g‘_ty³
 ();

164 
DIAVAR
 
GtkWidg‘
 *
dŸ_un™_¥šÃr_Ãw
 (
GtkAdju¡m’t
 *
adju¡m’t
,

165 
DŸUn™
 
adj_un™
);

166 
DIAVAR
 
dŸ_un™_¥šÃr_£t_v®ue
 (
DŸUn™SpšÃr
 *
£lf
, 
gdoubË
 
v®
);

167 
DIAVAR
 
gdoubË
 
dŸ_un™_¥šÃr_g‘_v®ue
 (
DŸUn™SpšÃr
 *
£lf
);

168 
DIAVAR
 
dŸ_un™_¥šÃr_£t_uµ”
 (
DŸUn™SpšÃr
 *
£lf
, 
gdoubË
 
v®
);

170 
DIAVAR
 
GLi¡
 * 
g‘_un™s_Çme_li¡
();

174 
	#DIA_DYNAMIC_MENU
(
obj
è
	`G_TYPE_CHECK_INSTANCE_CAST
(obj, 
	`dŸ_dyÇmic_m’u_g‘_ty³
(), 
DŸDyÇmicM’u
)

	)

175 
	#DIA_DYNAMIC_MENU_CLASS
(
kÏss
è
	`G_TYPE_CHECK_CLASS_CAST
(kÏss, 
	`dŸ_dyÇmic_m’u_g‘_ty³
(), 
DŸDyÇmicM’uCÏss
)

	)

176 
	#DIA_IS_DYNAMIC_MENU
(
obj
è
	`G_TYPE_CHECK_INSTANCE_TYPE
(obj, 
	`dŸ_dyÇmic_m’u_g‘_ty³
())

	)

178 
_DŸDyÇmicM’u
 
	tDŸDyÇmicM’u
;

179 
_DŸDyÇmicM’uCÏss
 
	tDŸDyÇmicM’uCÏss
;

188 ’um { 
	mDDM_SORT_TOP
, 
	mDDM_SORT_NEWEST
, 
	mDDM_SORT_SORT
 } 
	tDdmSÜtTy³
;

190 
	gGtkWidg‘
 *(* 
	tDDMC»©eI‹mFunc
)(
	tDŸDyÇmicM’u
 *, 
	tgch¬
 *);

191 (* 
	tDDMC®lbackFunc
)(
	tDŸDyÇmicM’u
 *, cÚ¡ 
	tgch¬
 *, 
	tgpoš‹r
);

193 
DIAVAR
 
GTy³
 
	`dŸ_dyÇmic_m’u_g‘_ty³
 ();

195 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_dyÇmic_m’u_Ãw
(
DDMC»©eI‹mFunc
 
ü—‹
,

196 
gpoš‹r
 
u£rd©a
,

197 
GtkM’uI‹m
 *
Ùh”™em
, 
gch¬
 *
³rsi¡
);

198 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_dyÇmic_m’u_Ãw_¡ršgba£d
(
GtkM’uI‹m
 *
Ùh”™em
,

199 
gpoš‹r
 
u£rd©a
,

200 
gch¬
 *
³rsi¡
);

201 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_dyÇmic_m’u_Ãw_li¡ba£d
(
DDMC»©eI‹mFunc
 
ü—‹
,

202 
gpoš‹r
 
u£rd©a
,

203 
gch¬
 *
Ùh”_Ïb–
,

204 
GLi¡
 *
™ems
, 
gch¬
 *
³rsi¡
);

205 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_dyÇmic_m’u_Ãw_¡ršgli¡ba£d
(
gch¬
 *
Ùh”_Ïb–
,

206 
GLi¡
 *
™ems
,

207 
gpoš‹r
 
u£rd©a
,

208 
gch¬
 *
³rsi¡
);

209 
DIAVAR
 
	`dŸ_dyÇmic_m’u_add_deçuÉ_’Œy
(
DŸDyÇmicM’u
 *
ddm
, cÚ¡ 
gch¬
 *
’Œy
);

210 
DIAVAR
 
gšt
 
	`dŸ_dyÇmic_m’u_add_’Œy
(
DŸDyÇmicM’u
 *
ddm
, cÚ¡ 
gch¬
 *
’Œy
);

211 
DIAVAR
 
	`dŸ_dyÇmic_m’u_£t_sÜtšg_m‘hod
(
DŸDyÇmicM’u
 *
ddm
, 
DdmSÜtTy³
 
sÜt
);

212 
DIAVAR
 
	`dŸ_dyÇmic_m’u_»£t
(
GtkWidg‘
 *
widg‘
, 
gpoš‹r
 
u£rd©a
);

213 
DIAVAR
 
	`dŸ_dyÇmic_m’u_£t_max_’Œ›s
(
DŸDyÇmicM’u
 *
ddm
, 
gšt
 
max
);

214 
DIAVAR
 
	`dŸ_dyÇmic_m’u_£t_cŞumns
(
DŸDyÇmicM’u
 *
ddm
, 
gšt
 
cŞs
);

215 
DIAVAR
 
gch¬
 *
	`dŸ_dyÇmic_m’u_g‘_’Œy
(
DŸDyÇmicM’u
 *
ddm
);

216 
DIAVAR
 
	`dŸ_dyÇmic_m’u_£Ëù_’Œy
(
DŸDyÇmicM’u
 *
ddm
, cÚ¡ 
gch¬
 *
’Œy
);

223 
DIAVAR
 
GtkWidg‘
 *
	`dŸ_toggË_bu‰Ú_Ãw_w™h_icÚs
(cÚ¡ 
gušt8
 *
Ú_icÚ
,

224 cÚ¡ 
gušt8
 *
off_icÚ
);

227 
DIAVAR
 
GtkWidg‘
* 
	`çùÜy_ü—‹_bu‰Ú_w™h_icÚs
(cÚ¡ 
gušt8
 *
icÚ
);

230 
	#DEFAULT_ALIGNMENT
 
ALIGN_LEFT


	)

232 
	#DEFAULT_LINE_WIDTH
 2*0.05

	)

	@
1
.
0
290
8990
O:\tool\dvs50\app\app_procs.c
O:\tool\dvs50\app\app_procs.h
O:\tool\dvs50\app\authors.h
O:\tool\dvs50\app\autosave.c
O:\tool\dvs50\app\autosave.h
O:\tool\dvs50\app\color_area.c
O:\tool\dvs50\app\color_area.h
O:\tool\dvs50\app\commands.c
O:\tool\dvs50\app\commands.h
O:\tool\dvs50\app\confirm.c
O:\tool\dvs50\app\confirm.h
O:\tool\dvs50\app\connectionpoint_ops.c
O:\tool\dvs50\app\connectionpoint_ops.h
O:\tool\dvs50\app\create_object.c
O:\tool\dvs50\app\create_object.h
O:\tool\dvs50\app\cursor.c
O:\tool\dvs50\app\cursor.h
O:\tool\dvs50\app\cut_n_paste.c
O:\tool\dvs50\app\cut_n_paste.h
O:\tool\dvs50\app\defaults.c
O:\tool\dvs50\app\defaults.h
O:\tool\dvs50\app\dia-app-icons.h
O:\tool\dvs50\app\dia-props.c
O:\tool\dvs50\app\dia-props.h
O:\tool\dvs50\app\diacanvas.c
O:\tool\dvs50\app\diacanvas.h
O:\tool\dvs50\app\diagram.c
O:\tool\dvs50\app\diagram.h
O:\tool\dvs50\app\diagram_tree.c
O:\tool\dvs50\app\diagram_tree.h
O:\tool\dvs50\app\diagram_tree_menu.c
O:\tool\dvs50\app\diagram_tree_menu.h
O:\tool\dvs50\app\diagram_tree_menu_callbacks.c
O:\tool\dvs50\app\diagram_tree_menu_callbacks.h
O:\tool\dvs50\app\diagram_tree_window.c
O:\tool\dvs50\app\diagram_tree_window.h
O:\tool\dvs50\app\diagrid.h
O:\tool\dvs50\app\diapagelayout.c
O:\tool\dvs50\app\diapagelayout.h
O:\tool\dvs50\app\disp_callbacks.c
O:\tool\dvs50\app\disp_callbacks.h
O:\tool\dvs50\app\display.c
O:\tool\dvs50\app\display.h
O:\tool\dvs50\app\dynamic_refresh.c
O:\tool\dvs50\app\dynamic_refresh.h
O:\tool\dvs50\app\exit_dialog.c
O:\tool\dvs50\app\exit_dialog.h
O:\tool\dvs50\app\filedlg.c
O:\tool\dvs50\app\filedlg.h
O:\tool\dvs50\app\find-and-replace.c
O:\tool\dvs50\app\find-and-replace.h
O:\tool\dvs50\app\grid.c
O:\tool\dvs50\app\grid.h
O:\tool\dvs50\app\gtkhwrapbox.c
O:\tool\dvs50\app\gtkhwrapbox.h
O:\tool\dvs50\app\gtkvwrapbox.c
O:\tool\dvs50\app\gtkvwrapbox.h
O:\tool\dvs50\app\gtkwrapbox.c
O:\tool\dvs50\app\gtkwrapbox.h
O:\tool\dvs50\app\handle_ops.c
O:\tool\dvs50\app\handle_ops.h
O:\tool\dvs50\app\highlight.c
O:\tool\dvs50\app\highlight.h
O:\tool\dvs50\app\interface.c
O:\tool\dvs50\app\interface.h
O:\tool\dvs50\app\layer_dialog.c
O:\tool\dvs50\app\layer_dialog.h
O:\tool\dvs50\app\linewidth_area.c
O:\tool\dvs50\app\linewidth_area.h
O:\tool\dvs50\app\load_save.c
O:\tool\dvs50\app\load_save.h
O:\tool\dvs50\app\magnify.c
O:\tool\dvs50\app\magnify.h
O:\tool\dvs50\app\main.c
O:\tool\dvs50\app\menus.c
O:\tool\dvs50\app\menus.h
O:\tool\dvs50\app\modify_tool.c
O:\tool\dvs50\app\modify_tool.h
O:\tool\dvs50\app\navigation.c
O:\tool\dvs50\app\navigation.h
O:\tool\dvs50\app\object_ops.c
O:\tool\dvs50\app\object_ops.h
O:\tool\dvs50\app\pagesetup.c
O:\tool\dvs50\app\pagesetup.h
O:\tool\dvs50\app\plugin-manager.c
O:\tool\dvs50\app\plugin-manager.h
O:\tool\dvs50\app\preferences.c
O:\tool\dvs50\app\preferences.h
O:\tool\dvs50\app\properties-dialog.c
O:\tool\dvs50\app\properties-dialog.h
O:\tool\dvs50\app\recent_files.c
O:\tool\dvs50\app\recent_files.h
O:\tool\dvs50\app\render_gdk.c
O:\tool\dvs50\app\render_gdk.h
O:\tool\dvs50\app\scroll_tool.c
O:\tool\dvs50\app\scroll_tool.h
O:\tool\dvs50\app\select.c
O:\tool\dvs50\app\select.h
O:\tool\dvs50\app\sheets.c
O:\tool\dvs50\app\sheets.h
O:\tool\dvs50\app\sheets_dialog.c
O:\tool\dvs50\app\sheets_dialog.h
O:\tool\dvs50\app\sheets_dialog_callbacks.c
O:\tool\dvs50\app\sheets_dialog_callbacks.h
O:\tool\dvs50\app\splash.c
O:\tool\dvs50\app\textedit.c
O:\tool\dvs50\app\textedit.h
O:\tool\dvs50\app\textedit_tool.c
O:\tool\dvs50\app\textedit_tool.h
O:\tool\dvs50\app\tool.c
O:\tool\dvs50\app\tool.h
O:\tool\dvs50\app\undo.c
O:\tool\dvs50\app\undo.h
O:\tool\dvs50\app\winmain.c
O:\tool\dvs50\config.h
O:\tool\dvs50\dia.rc
O:\tool\dvs50\lib\arrows.c
O:\tool\dvs50\lib\arrows.h
O:\tool\dvs50\lib\attributes.c
O:\tool\dvs50\lib\attributes.h
O:\tool\dvs50\lib\autoroute.c
O:\tool\dvs50\lib\autoroute.h
O:\tool\dvs50\lib\bezier_conn.c
O:\tool\dvs50\lib\bezier_conn.h
O:\tool\dvs50\lib\beziershape.c
O:\tool\dvs50\lib\beziershape.h
O:\tool\dvs50\lib\boundingbox.c
O:\tool\dvs50\lib\boundingbox.h
O:\tool\dvs50\lib\color.c
O:\tool\dvs50\lib\color.h
O:\tool\dvs50\lib\connection.c
O:\tool\dvs50\lib\connection.h
O:\tool\dvs50\lib\connectionpoint.c
O:\tool\dvs50\lib\connectionpoint.h
O:\tool\dvs50\lib\connpoint_line.c
O:\tool\dvs50\lib\connpoint_line.h
O:\tool\dvs50\lib\create.c
O:\tool\dvs50\lib\create.h
O:\tool\dvs50\lib\debug.c
O:\tool\dvs50\lib\debug.h
O:\tool\dvs50\lib\dia-enums.h
O:\tool\dvs50\lib\dia-lib-icons.h
O:\tool\dvs50\lib\dia_dirs.c
O:\tool\dvs50\lib\dia_dirs.h
O:\tool\dvs50\lib\dia_image.c
O:\tool\dvs50\lib\dia_image.h
O:\tool\dvs50\lib\dia_svg.c
O:\tool\dvs50\lib\dia_svg.h
O:\tool\dvs50\lib\dia_xml.c
O:\tool\dvs50\lib\dia_xml.h
O:\tool\dvs50\lib\dia_xml_libxml.h
O:\tool\dvs50\lib\diaarrowchooser.c
O:\tool\dvs50\lib\diaarrowchooser.h
O:\tool\dvs50\lib\diacellrendererproperty.c
O:\tool\dvs50\lib\diacellrendererproperty.h
O:\tool\dvs50\lib\diaerror.c
O:\tool\dvs50\lib\diaerror.h
O:\tool\dvs50\lib\diagdkrenderer.c
O:\tool\dvs50\lib\diagdkrenderer.h
O:\tool\dvs50\lib\diagramdata.c
O:\tool\dvs50\lib\diagramdata.h
O:\tool\dvs50\lib\diainteractiverenderer.c
O:\tool\dvs50\lib\dialib.c
O:\tool\dvs50\lib\dialib.h
O:\tool\dvs50\lib\dialinechooser.c
O:\tool\dvs50\lib\dialinechooser.h
O:\tool\dvs50\lib\dialogs.c
O:\tool\dvs50\lib\dialogs.h
O:\tool\dvs50\lib\diamarshal.c
O:\tool\dvs50\lib\diamarshal.h
O:\tool\dvs50\lib\diamenu.h
O:\tool\dvs50\lib\diarenderer.c
O:\tool\dvs50\lib\diarenderer.h
O:\tool\dvs50\lib\diasvgrenderer.c
O:\tool\dvs50\lib\diasvgrenderer.h
O:\tool\dvs50\lib\diatransform.c
O:\tool\dvs50\lib\diatransform.h
O:\tool\dvs50\lib\diatypes.h
O:\tool\dvs50\lib\diavar.h
O:\tool\dvs50\lib\dummy_dep.h
O:\tool\dvs50\lib\dynamic_obj.c
O:\tool\dvs50\lib\dynamic_obj.h
O:\tool\dvs50\lib\element.c
O:\tool\dvs50\lib\element.h
O:\tool\dvs50\lib\filter.c
O:\tool\dvs50\lib\filter.h
O:\tool\dvs50\lib\focus.c
O:\tool\dvs50\lib\focus.h
O:\tool\dvs50\lib\font.c
O:\tool\dvs50\lib\font.h
O:\tool\dvs50\lib\geometry.c
O:\tool\dvs50\lib\geometry.h
O:\tool\dvs50\lib\group.c
O:\tool\dvs50\lib\group.h
O:\tool\dvs50\lib\handle.h
O:\tool\dvs50\lib\intl.c
O:\tool\dvs50\lib\intl.h
O:\tool\dvs50\lib\layer.c
O:\tool\dvs50\lib\message.c
O:\tool\dvs50\lib\message.h
O:\tool\dvs50\lib\newgroup.c
O:\tool\dvs50\lib\newgroup.h
O:\tool\dvs50\lib\neworth_conn.c
O:\tool\dvs50\lib\neworth_conn.h
O:\tool\dvs50\lib\objchange.c
O:\tool\dvs50\lib\objchange.h
O:\tool\dvs50\lib\object.c
O:\tool\dvs50\lib\object.h
O:\tool\dvs50\lib\object_defaults.c
O:\tool\dvs50\lib\orth_conn.c
O:\tool\dvs50\lib\orth_conn.h
O:\tool\dvs50\lib\paper.c
O:\tool\dvs50\lib\paper.h
O:\tool\dvs50\lib\parent.c
O:\tool\dvs50\lib\parent.h
O:\tool\dvs50\lib\persistence.c
O:\tool\dvs50\lib\persistence.h
O:\tool\dvs50\lib\plug-ins.c
O:\tool\dvs50\lib\plug-ins.h
O:\tool\dvs50\lib\poly_conn.c
O:\tool\dvs50\lib\poly_conn.h
O:\tool\dvs50\lib\polyshape.c
O:\tool\dvs50\lib\polyshape.h
O:\tool\dvs50\lib\prefs.c
O:\tool\dvs50\lib\prefs.h
O:\tool\dvs50\lib\prop_attr.c
O:\tool\dvs50\lib\prop_attr.h
O:\tool\dvs50\lib\prop_basic.c
O:\tool\dvs50\lib\prop_basic.h
O:\tool\dvs50\lib\prop_dict.c
O:\tool\dvs50\lib\prop_dict.h
O:\tool\dvs50\lib\prop_geomtypes.c
O:\tool\dvs50\lib\prop_geomtypes.h
O:\tool\dvs50\lib\prop_inttypes.c
O:\tool\dvs50\lib\prop_inttypes.h
O:\tool\dvs50\lib\prop_sdarray.c
O:\tool\dvs50\lib\prop_sdarray.h
O:\tool\dvs50\lib\prop_text.c
O:\tool\dvs50\lib\prop_text.h
O:\tool\dvs50\lib\prop_widgets.c
O:\tool\dvs50\lib\prop_widgets.h
O:\tool\dvs50\lib\propdesc.c
O:\tool\dvs50\lib\propdialogs.c
O:\tool\dvs50\lib\properties.c
O:\tool\dvs50\lib\properties.h
O:\tool\dvs50\lib\propinternals.h
O:\tool\dvs50\lib\proplist.c
O:\tool\dvs50\lib\propobject.c
O:\tool\dvs50\lib\propoffsets.c
O:\tool\dvs50\lib\propregistry.c
O:\tool\dvs50\lib\render_pixmap.c
O:\tool\dvs50\lib\render_pixmap.h
O:\tool\dvs50\lib\sheet.c
O:\tool\dvs50\lib\sheet.h
O:\tool\dvs50\lib\text.c
O:\tool\dvs50\lib\text.h
O:\tool\dvs50\lib\textattr.h
O:\tool\dvs50\lib\textline.c
O:\tool\dvs50\lib\textline.h
O:\tool\dvs50\lib\units.c
O:\tool\dvs50\lib\units.h
O:\tool\dvs50\lib\utils.c
O:\tool\dvs50\lib\utils.h
O:\tool\dvs50\lib\widgets.c
O:\tool\dvs50\lib\widgets.h
O:\tool\dvs50\objects\Struct\struct.c
O:\tool\dvs50\objects\Struct\struct_class.c
O:\tool\dvs50\objects\Struct\struct_class.h
O:\tool\dvs50\objects\Struct\struct_dialog.c
O:\tool\dvs50\objects\standard\arc.c
O:\tool\dvs50\objects\standard\bezier.c
O:\tool\dvs50\objects\standard\beziergon.c
O:\tool\dvs50\objects\standard\box.c
O:\tool\dvs50\objects\standard\ellipse.c
O:\tool\dvs50\objects\standard\image.c
O:\tool\dvs50\objects\standard\line.c
O:\tool\dvs50\objects\standard\outline.c
O:\tool\dvs50\objects\standard\polygon.c
O:\tool\dvs50\objects\standard\polyline.c
O:\tool\dvs50\objects\standard\standard.c
O:\tool\dvs50\objects\standard\textobj.c
O:\tool\dvs50\objects\standard\tool-icons.h
O:\tool\dvs50\objects\standard\zigzagline.c
config.h
lib/diamarshal.h
lib/geometry.h
lib/parent.h
lib/prefs.h
lib/properties.h
lib/widgets.h
